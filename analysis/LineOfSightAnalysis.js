/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","./Analysis","./LineOfSightAnalysisObserver","./LineOfSightAnalysisTarget","../core/Collection","../core/collectionUtils","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/arrayUtils","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","../geometry/projection","../geometry/support/aaBoundingBox","../support/elevationInfoUtils"],(function(e,t,r,o,n,i,s,l,a,p,c,u,y,f,d,h){"use strict";const g=i.ofType(n);let v=function(t){function r(e){var r;return(r=t.call(this,e)||this).type="line-of-sight",r.observer=null,r.extent=null,r}e._inheritsLoose(r,t);var o=r.prototype;return o.initialize=function(){this.addHandles(a.watch((()=>this._computeExtent()),(e=>{(l.isNone(e)||l.isNone(e.pending))&&this._set("extent",l.isSome(e)?e.extent:null)}),a.syncAndInitial))},o.waitComputeExtent=function(){var t=e._asyncToGenerator((function*(){const e=this._computeExtent();return l.isSome(e)?l.unwrap(e.pending):null}));function r(){return t.apply(this,arguments)}return r}(),o._computeExtent=function(){const e=this.spatialReference;if(l.isNone(this.observer)||l.isNone(this.observer.position)||l.isNone(e))return null;const t=e=>"absolute-height"===h.getGeometryEffectiveElevationMode(e.position,e.elevationInfo),r=this.observer.position,o=d.fromValues(r.x,r.y,r.z,r.x,r.y,r.z);for(const i of this.targets)if(l.isSome(i.position)){const t=f.projectOrLoad(i.position,e);if(l.isSome(t.pending))return{pending:t.pending,extent:null};if(l.isSome(t.geometry)){const{x:e,y:r,z:n}=t.geometry;d.expandWithVec3(o,[e,r,n])}}const n=d.toExtent(o,e);return t(this.observer)&&this.targets.every(t)||(n.zmin=null,n.zmax=null),{pending:null,extent:n}},o.clear=function(){this.observer=null,this.targets.removeAll()},e._createClass(r,[{key:"targets",get:function(){return this._get("targets")||new g},set:function(e){this._set("targets",s.referenceSetter(e,this.targets,g))}},{key:"spatialReference",get:function(){return l.isSome(this.observer)&&l.isSome(this.observer.position)?this.observer.position.spatialReference:null}},{key:"requiredPropertiesForEditing",get:function(){return[l.applySome(this.observer,(e=>e.position))]}}]),r}(r);t.__decorate([p.property({type:["line-of-sight"]})],v.prototype,"type",void 0),t.__decorate([p.property({type:o,json:{read:!0,write:!0}})],v.prototype,"observer",void 0),t.__decorate([p.property({cast:s.castForReferenceSetter,type:g,nonNullable:!0,json:{read:!0,write:!0}})],v.prototype,"targets",null),t.__decorate([p.property({value:null,readOnly:!0})],v.prototype,"extent",void 0),t.__decorate([p.property({readOnly:!0})],v.prototype,"spatialReference",null),t.__decorate([p.property({readOnly:!0})],v.prototype,"requiredPropertiesForEditing",null),v=t.__decorate([y.subclass("esri.analysis.LineOfSightAnalysis")],v);return v}));
