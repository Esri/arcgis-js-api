/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","./Analysis","./LineOfSightAnalysisObserver","./LineOfSightAnalysisTarget","../core/Collection","../core/collectionUtils","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/accessorSupport/decorators/subclass","../geometry/projection","../geometry/support/aaBoundingBox","../support/elevationInfoUtils"],(function(e,t,o,r,n,i,s,a,p,l,c,u,y,d,f,h){"use strict";const g=i.ofType(n);let v=function(t){function o(e){var o;return(o=t.call(this,e)||this).type="line-of-sight",o.observer=null,o.extent=null,o}e._inheritsLoose(o,t);var r=o.prototype;return r.initialize=function(){this.addHandles(p.watch((()=>this._computeExtent()),(e=>{(a.isNone(e)||a.isNone(e.pending))&&this._set("extent",a.isSome(e)?e.extent:null)}),p.syncAndInitial))},r.waitComputeExtent=function(){var t=e._asyncToGenerator((function*(){const e=this._computeExtent();return a.isSome(e)?a.unwrap(e.pending):Promise.resolve()}));function o(){return t.apply(this,arguments)}return o}(),r._computeExtent=function(){const e=this.spatialReference;if(a.isNone(this.observer)||a.isNone(this.observer.position)||a.isNone(e))return null;const t=e=>"absolute-height"===h.getGeometryEffectiveElevationMode(e.position,e.elevationInfo),o=this.observer.position,r=f.fromValues(o.x,o.y,o.z,o.x,o.y,o.z);for(const i of this.targets)if(a.isSome(i.position)){const t=d.projectOrLoad(i.position,e);if(a.isSome(t.pending))return{pending:t.pending,extent:null};if(a.isSome(t.geometry)){const{x:e,y:o,z:n}=t.geometry;f.expandWithVec3(r,[e,o,n])}}const n=f.toExtent(r,e);return t(this.observer)&&this.targets.every(t)||(n.zmin=void 0,n.zmax=void 0),{pending:null,extent:n}},r.clear=function(){this.observer=null,this.targets.removeAll()},e._createClass(o,[{key:"targets",get:function(){return this._get("targets")||new g},set:function(e){this._set("targets",s.referenceSetter(e,this.targets,g))}},{key:"spatialReference",get:function(){return a.isSome(this.observer)&&a.isSome(this.observer.position)?this.observer.position.spatialReference:null}},{key:"requiredPropertiesForEditing",get:function(){return[a.applySome(this.observer,(e=>e.position))]}}]),o}(o);t.__decorate([l.property({type:["line-of-sight"]})],v.prototype,"type",void 0),t.__decorate([l.property({type:r,json:{read:!0,write:!0}})],v.prototype,"observer",void 0),t.__decorate([l.property({cast:s.castForReferenceSetter,type:g,nonNullable:!0,json:{read:!0,write:!0}})],v.prototype,"targets",null),t.__decorate([l.property({value:null,readOnly:!0})],v.prototype,"extent",void 0),t.__decorate([l.property({readOnly:!0})],v.prototype,"spatialReference",null),t.__decorate([l.property({readOnly:!0})],v.prototype,"requiredPropertiesForEditing",null),v=t.__decorate([y.subclass("esri.analysis.LineOfSightAnalysis")],v);return v}));
