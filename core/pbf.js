/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["./has","./ObjectPool"],(function(t,i){"use strict";var e;!function(t){t[t.varint=0]="varint",t[t.fixed64=1]="fixed64",t[t.delimited=2]="delimited",t[t.fixed32=5]="fixed32",t[t.unknown=99]="unknown"}(e||(e={}));const n=4294967296,s=new TextDecoder("utf-8"),o=t("safari")||t("ios")?6:t("ff")?12:32;let r=function(){function t(t,i,n=0,s=(t?t.byteLength:0)){this._tag=0,this._dataType=e.unknown,this._init(t,i,n,s)}var i=t.prototype;return i._init=function(t,i,e,n){this._data=t,this._dataView=i,this._pos=e,this._end=n},i.asUnsafe=function(){return this},i.clone=function(){return new t(this._data,this._dataView,this._pos,this._end)},i.pos=function(){return this._pos},i.move=function(t){this._pos=t},i.nextTag=function(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0},i.next=function(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0},i.empty=function(){return this._pos>=this._end},i.tag=function(){return this._tag},i.getInt32=function(){return this._decodeVarint()},i.getInt64=function(){return this._decodeVarint()},i.getUInt32=function(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))},i.getUInt64=function(){return this._decodeVarint()},i.getSInt32=function(){const t=this.getUInt32();if(void 0!==t)return t>>>1^-(1&t)|0},i.getSInt64=function(){return this._decodeSVarint()},i.getBool=function(){const t=0!==this._data[this._pos];return this._skip(1),t},i.getEnum=function(){return this._decodeVarint()},i.getFixed64=function(){const t=this._dataView,i=this._pos,e=t.getUint32(i,!0)+t.getUint32(i+4,!0)*n;return this._skip(8),e},i.getSFixed64=function(){const t=this._dataView,i=this._pos,e=t.getUint32(i,!0)+t.getInt32(i+4,!0)*n;return this._skip(8),e},i.getDouble=function(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t},i.getFixed32=function(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t},i.getSFixed32=function(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t},i.getFloat=function(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t},i.getString=function(){const t=this._getLength(),i=this._pos,e=this._toString(this._data,i,i+t);return this._skip(t),e},i.getBytes=function(){const t=this._getLength(),i=this._pos,e=this._toBytes(this._data,i,i+t);return this._skip(t),e},i.getLength=function(){return this._getLengthUnsafe()},i.processMessageWithArgs=function(t,i,e,n){const s=this.getMessage(),o=t(s,i,e,n);return s.release(),o},i.processMessage=function(t){const i=this.getMessage(),e=t(i);return i.release(),e},i.getMessage=function(){const i=this._getLength(),e=t.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+i),this._skip(i),e},i.release=function(){t.pool.release(this)},i.dataType=function(){return this._dataType},i.skip=function(){switch(this._dataType){case e.varint:this._decodeVarint();break;case e.fixed64:this._skip(8);break;case e.delimited:this._skip(this._getLength());break;case e.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}},i.skipLen=function(t){this._skip(t)},i._skip=function(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t},i._decodeVarint=function(){const t=this._data;let i=this._pos,e=0,n=0;if(this._end-i>=10)do{if(n=t[i++],e|=127&n,0==(128&n))break;if(n=t[i++],e|=(127&n)<<7,0==(128&n))break;if(n=t[i++],e|=(127&n)<<14,0==(128&n))break;if(n=t[i++],e|=(127&n)<<21,0==(128&n))break;if(n=t[i++],e+=268435456*(127&n),0==(128&n))break;if(n=t[i++],e+=34359738368*(127&n),0==(128&n))break;if(n=t[i++],e+=4398046511104*(127&n),0==(128&n))break;if(n=t[i++],e+=562949953421312*(127&n),0==(128&n))break;if(n=t[i++],e+=72057594037927940*(127&n),0==(128&n))break;if(n=t[i++],e+=0x8000000000000000*(127&n),0==(128&n))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;i!==this._end&&(n=t[i],0!=(128&n));)++i,e+=(127&n)*s,s*=128;if(i===this._end)throw new Error("Varint overrun!");++i,e+=n*s}return this._pos=i,e},i._decodeSVarint=function(){const t=this._data;let i=this._pos,e=0,n=0;const s=1&t[i];if(this._end-i>=10)do{if(n=t[i++],e|=127&n,0==(128&n))break;if(n=t[i++],e|=(127&n)<<7,0==(128&n))break;if(n=t[i++],e|=(127&n)<<14,0==(128&n))break;if(n=t[i++],e|=(127&n)<<21,0==(128&n))break;if(n=t[i++],e+=268435456*(127&n),0==(128&n))break;if(n=t[i++],e+=34359738368*(127&n),0==(128&n))break;if(n=t[i++],e+=4398046511104*(127&n),0==(128&n))break;if(n=t[i++],e+=562949953421312*(127&n),0==(128&n))break;if(n=t[i++],e+=72057594037927940*(127&n),0==(128&n))break;if(n=t[i++],e+=0x8000000000000000*(127&n),0==(128&n))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;i!==this._end&&(n=t[i],0!=(128&n));)++i,e+=(127&n)*s,s*=128;if(i===this._end)throw new Error("Varint overrun!");++i,e+=n*s}return this._pos=i,s?-(e+1)/2:e/2},i._getLength=function(){if(this._dataType!==e.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()},i._getLengthUnsafe=function(){return this.getUInt32()},i._toString=function(t,i,e){if((e=Math.min(this._end,e))-i>o){const n=t.subarray(i,e);return s.decode(n)}let n="",r="";for(let s=i;s<e;++s){const i=t[s];128&i?r+="%"+i.toString(16):(n+=decodeURIComponent(r)+String.fromCharCode(i),r="")}return r.length&&(n+=decodeURIComponent(r)),n},i._toBytes=function(t,i,e){return e=Math.min(this._end,e),new Uint8Array(t.buffer,i,e-i)},t}();return r.pool=new i(r,void 0,(t=>{t._data=null,t._dataView=null})),r}));
