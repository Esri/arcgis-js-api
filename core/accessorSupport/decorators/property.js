/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import t from"../../Logger.js";import{ensureArrayTyped as e,ensureOneOfType as r,isLongFormType as n,ensureLongFormType as o,isOneOf as i,ensureOneOf as s,ensureNArrayTyped as a,ensureArray as c,ensureNArray as p,ensureType as u}from"../ensureType.js";import{get as l}from"../get.js";import{getOwnPropertyMetadata as f,mergeProperty as g}from"../metadata.js";import{set as m}from"../set.js";function d(n={}){return(o,i)=>{if(o===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${o.name}.${i}. Accessor does not support static properties.`);const s=Object.getOwnPropertyDescriptor(o,i),a=f(o,i);s&&(s.get||s.set?(a.get=s.get||a.get,a.set=s.set||a.set):"value"in s&&("value"in n&&t.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${o.constructor.name}" already defined in the metadata`,n),a.value=n.value=s.value)),null!=n.readOnly&&(a.readOnly=n.readOnly);const c=n.aliasOf;if(c){const t="string"==typeof c?c:c.source,e="string"==typeof c?null:!0===c.overridable;let r;a.dependsOn=[t],a.get=function(){let e=l(this,t);if("function"==typeof e){r||(r=t.split(".").slice(0,-1).join("."));const n=l(this,r);n&&(e=e.bind(n))}return e},a.readOnly||(a.set=e?function(t){void 0!==t?this._override(i,t):this._clearOverride(i)}:function(e){m(this,t,e)})}const p=n.type,u=n.types;a.cast||(p?a.cast=h(p):u&&(Array.isArray(u)?a.cast=e(r(u[0])):a.cast=r(u))),n.range&&(a.cast=v(a.cast,n.range)),g(a,n)}}function y(t,e,r){const n=f(t,r);n.json||(n.json={});let o=n.json;return void 0!==e&&(o.origins||(o.origins={}),o.origins[e]||(o.origins[e]={}),o=o.origins[e]),o}function h(t){let e=0,r=t;if(n(t))return o(t);for(;Array.isArray(r)&&1===r.length&&"string"!=typeof r[0]&&"number"!=typeof r[0];)r=r[0],e++;const l=r;if(i(l))return 0===e?s(l):a(s(l),e);if(1===e)return c(l);if(e>1)return p(l,e);const f=t;return f.from?f.from:u(f)}function v(t,e){return r=>{let n=+t(r);return null!=e.step&&(n=Math.round(n/e.step)*e.step),null!=e.min&&(n=Math.max(e.min,n)),null!=e.max&&(n=Math.min(e.max,n)),n}}export{v as ensureRange,d as property,y as propertyJSONMeta};
