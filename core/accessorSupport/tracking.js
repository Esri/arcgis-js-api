/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../has","../Logger","./utils","./tracking/Flags"],(function(e,n,t,r,c){"use strict";const i={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},s=[];let o=i;function a(e){o.onObservableAccessed(e)}let l=!1,g=!1;function u(e,n,t){if(l)return p(e,n,t);d(e);const r=n.call(t);return k(),r}function f(e,n){return u(i,e,n)}function p(e,n,r){const c=l;l=!0,d(e);let i=null;try{i=n.call(r)}catch(s){g&&t.getLogger("esri.core.accessorSupport.tracking").error(s)}return k(),l=c,i}function d(e){o=e,s.push(e)}function k(){const e=s.length;if(e>1){const n=s.pop();o=s[e-2],n.onTrackingEnd()}else if(1===e){const e=s.pop();o=i,e.onTrackingEnd()}else o=i}function T(e,n){if(n.flags&c.Flags.DepTrackingInitialized)return;const t=g;g=!1,n.flags&c.Flags.AutoTracked?p(n,n.metadata.get,e):A(e,n),g=t}const y=[];function A(e,n){n.flags&c.Flags.ExplicitlyTracking||(n.flags|=c.Flags.ExplicitlyTracking,p(n,(()=>{const t=n.metadata.dependsOn||y;for(const n of t)if("string"!=typeof n||n.includes(".")){const t=r.pathToArray(n);for(let n=0,r=e;n<t.length&&null!=r&&"object"==typeof r;++n)r=h(r,t[n],n!==t.length-1)}else h(e,n,!1)})),n.flags&=~c.Flags.ExplicitlyTracking)}function h(e,n,t){const c="?"===n[n.length-1]?n.slice(0,-1):n;if(null!=e.getItemAt||Array.isArray(e)){const n=parseInt(c,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.getItemAt(n)}const i=r.getProperties(e)?.properties.get(c);return i&&(a(i),T(e,i)),t?e[c]:void 0}e.initializeDependencyTracking=T,e.runTracked=u,e.runTrackedNoThrow=p,e.runUntracked=f,e.trackAccess=a,e.trackExplicitDependencies=A,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
