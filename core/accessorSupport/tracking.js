/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import"../has.js";import t from"../Logger.js";import{pathToArray as n,getProperties as r}from"./utils.js";import{Flags as e}from"./tracking/Flags.js";let o,i=[];const c=t.getLogger("esri.core.Accessor");function s(){i=[]}function l(t){void 0!==o&&o.onObservableAccessed(t)}let a=!1,f=!1;function g(t,n,r){if(a)return p(t,n,r);d(t);const e=n.call(r);return m(),e}function u(t,n){return g(void 0,t,n)}function p(t,n,r){const e=a;a=!0,d(t);let o=null;try{o=n.call(r)}catch(i){f&&c.error(i)}return m(),a=e,o}function d(t){o=t,i.push(t)}function m(){const t=i.pop();o=i.length>0?i[i.length-1]:void 0,void 0!==t&&t.onTrackingEnd()}function y(t,n){if(n.flags&e.DepTrackingInitialized)return;const r=f;f=!1,n.flags&e.AutoTracked?p(n,n.metadata.get,t):h(t,n),f=r}const A=[];function h(t,r){r.flags&e.ExplicitlyTracking||(r.flags|=e.ExplicitlyTracking,p(r,(()=>{const e=r.metadata.dependsOn||A;for(const r of e)if("string"!=typeof r||r.includes(".")){const e=n(r);for(let n=0,r=t;n<e.length&&null!=r&&"object"==typeof r;++n)r=k(r,e[n],n!==e.length-1)}else k(t,r,!1)})),r.flags&=~e.ExplicitlyTracking)}function k(t,n,e){const o="?"===n[n.length-1]?n.slice(0,-1):n;if(null!=t.getItemAt||Array.isArray(t)){const n=parseInt(o,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.getItemAt(n)}const i=r(t)?.properties.get(o);return i&&(l(i),y(t,i)),e?t[o]:void 0}export{y as initializeDependencyTracking,s as resetGlobalTarget,g as runTracked,p as runTrackedNoThrow,u as runUntracked,l as trackAccess,h as trackExplicitDependencies};
