/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../arrayUtils","../Error","../Logger","./PropertyOrigin","./utils","./extensions/serializableProperty"],(function(e,r,t,i,n,o,s){"use strict";const u=i.getLogger("esri.core.accessorSupport.write");function l(e,r,t,i,n){var o,s;const u={};return null==(o=r.write)||null==(s=o.writer)||s.call(e,i,u,t,n),u}function a(e,r,i,o,s,l){if(!o||!o.write)return!1;const a=e.get(i);if(!s&&o.write.overridePolicy){const r=o.write.overridePolicy.call(e,a,i,l);void 0!==r&&(s=r)}if(s||(s=o.write),!s||!1===s.enabled)return!1;if((null===a&&!s.allowNull&&!s.writerEnsuresNonNull||void 0===a)&&s.isRequired){const r=new t("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return r&&l&&l.messages?l.messages.push(r):r&&!l&&u.error(r.name,r.message),!1}if(void 0===a)return!1;if(null===a&&!s.allowNull&&!s.writerEnsuresNonNull)return!1;if(f(e,i,l,o,a))return!1;if(void 0!==o.default)return!0;if(!s.ignoreOrigin&&l&&l.origin){if(r.store.originOf(i)<n.nameToId(l.origin))return!1}return!0}function f(e,t,i,n,o){const s=n.default;if(void 0===s)return!1;if(null!=n.defaultEquals)return n.defaultEquals(o);if("function"==typeof s){if(Array.isArray(o)){const n=s.call(e,t,i);return r.equals(n,o)}return!1}return s===o}function c(e,r,t,i){const n=o.getProperties(e),u=n.metadatas,l=s.originSpecificWritePropertyDefinition(u[r],i);return!!l&&a(e,n,r,l,t,i)}function g(e,r,t){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return o.merge(r,e.toJSON());const i=o.getProperties(e),u=i.metadatas;for(const g in u){const p=s.originSpecificWritePropertyDefinition(u[g],t);if(!a(e,i,g,p,void 0,t))continue;const d=e.get(g),w=l(e,p,p.write&&"string"==typeof p.write.target?p.write.target:g,d,t);var f,c;if(Object.keys(w).length>0)r=o.merge(r,w),null!=t&&null!=(f=t.resources)&&null!=(c=f.pendingOperations)&&c.length&&Promise.all(t.resources.pendingOperations).then((()=>o.merge(r,w))),t&&t.writtenProperties&&t.writtenProperties.push({target:e,propName:g,oldOrigin:n.idToReadableName(i.store.originOf(g)),newOrigin:t.origin})}return r}e.default=g,e.willPropertyWrite=c,e.write=g,Object.defineProperty(e,"__esModule",{value:!0})}));
