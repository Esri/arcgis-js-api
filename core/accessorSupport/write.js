/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../Logger","./utils","./extensions/serializableProperty","../Error","./PropertyOrigin","../arrayUtils"],(function(e,r,t,i,n,o,s){"use strict";const u=r.getLogger("esri.core.accessorSupport.write");function l(e,r,t,i,n){var o,s;const u={};return null==(o=r.write)||null==(s=o.writer)||s.call(e,i,u,t,n),u}function a(e,r,t,i,s,l){if(!i||!i.write)return!1;const a=e.get(t);if(!s&&i.write.overridePolicy){const r=i.write.overridePolicy.call(e,a,t,l);void 0!==r&&(s=r)}if(s||(s=i.write),!s||!1===s.enabled)return!1;if((null===a&&!s.allowNull||void 0===a)&&s.isRequired){const r=new n("web-document-write:property-required",`Missing value for required property '${t}' on '${e.declaredClass}'`,{propertyName:t,target:e});return r&&l&&l.messages?l.messages.push(r):r&&!l&&u.error(r.name,r.message),!1}if(void 0===a)return!1;if(null===a&&!s.allowNull)return!1;if(f(e,t,l,i,a))return!1;if(void 0!==i.default)return!0;if(!s.ignoreOrigin&&l&&l.origin){if(r.store.originOf(t)<o.nameToId(l.origin))return!1}return!0}function f(e,r,t,i,n){const o=i.default;if(void 0===o)return!1;if(null!=i.defaultEquals)return i.defaultEquals(n);if("function"==typeof o){if(Array.isArray(n)){const i=o.call(e,r,t);return s.equals(i,n)}return!1}return o===n}function c(e,r,n,o){const s=t.getProperties(e),u=s.metadatas,l=i.originSpecificWritePropertyDefinition(u[r],o);return!!l&&a(e,s,r,l,n,o)}function g(e,r,n){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return t.merge(r,e.toJSON());const s=t.getProperties(e),u=s.metadatas;for(const g in u){const p=i.originSpecificWritePropertyDefinition(u[g],n);if(!a(e,s,g,p,void 0,n))continue;const d=e.get(g),w=l(e,p,p.write&&"string"==typeof p.write.target?p.write.target:g,d,n);var f,c;if(Object.keys(w).length>0)r=t.merge(r,w),null!=n&&null!=(f=n.resources)&&null!=(c=f.pendingOperations)&&c.length&&Promise.all(n.resources.pendingOperations).then((()=>t.merge(r,w))),n&&n.writtenProperties&&n.writtenProperties.push({target:e,propName:g,oldOrigin:o.idToReadableName(s.store.originOf(g)),newOrigin:n.origin})}return r}e.default=g,e.willPropertyWrite=c,e.write=g,Object.defineProperty(e,"__esModule",{value:!0})}));
