/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../Error","../../../Logger","../../../object","./type"],(function(e,r,t,n,i){"use strict";function o(e,r){if(!r.write||r.write.writer||!1===r.write.enabled&&!r.write.overridePolicy)return;const t=e?.ndimArray??0;e&&(1===t||"type"in e&&i.isCollection(e.type))?r.write.writer=y:t>1?r.write.writer=w(t):r.types?Array.isArray(r.types)?r.write.writer=f(r.types[0]):r.write.writer=u(r.types):r.write.writer=a}function u(e){return(r,t,n,i)=>r?s(r,e,i)?a(r,t,n,i):void 0:a(r,t,n,i)}function s(e,n,i){for(const r in n.typeMap)if(e instanceof n.typeMap[r])return!0;if(i?.messages){const o=n.errorContext??"type",u=`Values of type '${("function"!=typeof n.key?e[n.key]:e.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new r(`${o}:unsupported`,u,{definition:e,context:i})),t.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(u)}return!1}function f(e){return(r,t,n,i)=>{if(!r||!Array.isArray(r))return a(r,t,n,i);return a(r.filter((r=>s(r,e,i))),t,n,i)}}function a(e,r,t,i){n.setDeepValue(t,l(e,i),r)}function l(e,r){return e&&"function"==typeof e.write?e.write({},r):e&&"function"==typeof e.toJSON?e.toJSON():"number"==typeof e?p(e):e}function p(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function y(e,r,t,i){let o;null===e?o=null:e&&"function"==typeof e.map?(o=e.map((e=>l(e,i))),"function"==typeof o.toArray&&(o=o.toArray())):o=[l(e,i)],n.setDeepValue(t,o,r)}function c(e,r,t){return 0!==t&&Array.isArray(e)?e.map((e=>c(e,r,t-1))):l(e,r)}function w(e){return(r,t,i,o)=>{let u;if(null===r)u=null;else{u=c(r,o,e);let t=e,n=u;for(;t>0&&Array.isArray(n);)t--,n=n[0];if(void 0!==n)for(let e=0;e<t;e++)u=[u]}n.setDeepValue(i,u,t)}}e.create=o,e.numberToJSON=p,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
