// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","../compilerUtils","../Logger"],(function(e,r,n,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ensureLongFormType=r.isLongFormType=r.types=r.Integer=r.ensureOneOfType=r.ensureOneOf=r.isOneOf=r.ensureNArray=r.ensureNArrayTyped=r.ensureArray=r.ensureArrayTyped=r.ensureType=r.ensureClass=r.requiresType=r.isClassedType=r.ensureInteger=r.ensureNumber=r.ensureString=r.ensureBoolean=r.ensureDate=void 0;var u=t.getLogger("esri.core.Accessor");function o(e){return null==e?e:new Date(e)}function a(e){return null==e?e:!!e}function i(e){return null==e?e:e.toString()}function s(e){return null==e?e:(e=parseFloat(e),isNaN(e)?0:e)}function l(e){return null==e?e:Math.round(parseFloat(e))}function c(e){return e&&e.constructor&&void 0!==e.constructor.__accessorMetadata__}function f(e,r){return null!=r&&e&&!(r instanceof e)}function y(e){return e&&"isCollection"in e}function p(e){return e&&e.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function v(e,r){return!!c(r)&&(u.error("Accessor#set","Assigning an instance of '"+(r.declaredClass||"unknown")+"' which is not a subclass of '"+g(e)+"'"),!0)}function d(e,r){return null==r?r:y(e)?function(e,r){if(!r||!r.constructor||!y(r.constructor))return v(e,r)?r:new e(r);var n=p(e.prototype.itemType),t=p(r.constructor.prototype.itemType);return n?t?n===t?r:n.prototype.isPrototypeOf(t.prototype)?new e(r):(v(e,r),r):new e(r):r}(e,r):f(e,r)?v(e,r)?r:new e(r):r}function g(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}function h(e){switch(e){case Number:return s;case w:return l;case Boolean:return a;case String:return i;case Date:return o;default:return d.bind(null,e)}}function b(e,r){var n=h(e);return 1===arguments.length?n:n(r)}function m(e,r,n){return 1===arguments.length?m.bind(null,e):r?Array.isArray(r)?r.map((function(r){return e(r,n)})):[e(r,n)]:r}function A(e,r,n){return 0!==r&&Array.isArray(n)?n.map((function(n){return A(e,r-1,n)})):e(n)}function T(e,r,n){if(2===arguments.length)return T.bind(null,e,r);if(!n)return n;for(var t=r,u=n=A(e,r,n);t>0&&Array.isArray(u);)t--,u=u[0];if(void 0!==u)for(var o=0;o<t;o++)n=[n];return n}r.ensureDate=o,r.ensureBoolean=a,r.ensureString=i,r.ensureNumber=s,r.ensureInteger=l,r.isClassedType=c,r.requiresType=f,r.ensureClass=d,r.ensureType=b,r.ensureArrayTyped=m,r.ensureArray=function(e,r){return 1===arguments.length?m(b.bind(null,e)):m(b.bind(null,e),r)},r.ensureNArrayTyped=T,r.ensureNArray=function(e,r,n){return 2===arguments.length?T(b.bind(null,e),r):T(b.bind(null,e),r,n)},r.isOneOf=function(e){return!!Array.isArray(e)&&!e.some((function(r){var n=typeof r;return!("string"===n||"number"===n||"function"===n&&e.length>1)}))},r.ensureOneOf=function e(r,n){if(2===arguments.length)return e(r).call(null,n);for(var t=new Set,o=r.filter((function(e){return"function"!=typeof e})),a=r.filter((function(e){return"function"==typeof e})),i=0,s=r;i<s.length;i++){var l=s[i];"string"!=typeof l&&"number"!=typeof l||t.add(l)}var c=null,y=null;return function(e,r){if(null==e)return e;var n=typeof e,i="string"===n||"number"===n;return i&&(t.has(e)||a.some((function(e){return"string"===n&&e===String||"number"===n&&e===Number})))?e:"object"===n&&a.some((function(r){return!f(e,r)}))?e:(i&&o.length?(c||(c=o.map((function(e){return"string"==typeof e?"'"+e+"'":""+e})).join(", ")),u.error("Accessor#set","'"+e+"' is not a valid value for this property, only the following values are valid: "+c)):"object"==typeof e&&a.length?(y||(y=a.map((function(e){return g(e)})).join(", ")),u.error("Accessor#set","'"+e+"' is not a valid value for this property, value must be one of "+y)):u.error("Accessor#set","'"+e+"' is not a valid value for this property"),r&&(r.valid=!1),null)}},r.ensureOneOfType=function e(r,n){if(2===arguments.length)return e(r).call(null,n);var t={},o=[],a=[];for(var i in r.typeMap){var s=r.typeMap[i];t[i]=b(s),o.push(g(s)),a.push(i)}var l=function(){return"'"+o.join("', '")+"'"},y=function(){return"'"+a.join("', '")+"'"},p="string"==typeof r.key?function(e){return e[r.key]}:r.key;return function(e){if(r.base&&!f(r.base,e))return e;if(null==e)return e;var n=p(e)||r.defaultKeyValue,o=t[n];if(!o)return u.error("Accessor#set","Invalid property value, value needs to be one of "+l()+", or a plain object that can autocast (having .type = "+y()+")"),null;if(!f(r.typeMap[n],e))return e;if("string"==typeof r.key&&!c(e)){var a={};for(var i in e)i!==r.key&&(a[i]=e[i]);return o(a)}return o(e)}};var w=function(){};r.Integer=w,r.types={native:function(e){return{type:"native",value:e}},array:function(e){return{type:"array",value:e}},oneOf:function(e){return{type:"one-of",values:e}}},r.isLongFormType=function(e){if(!(e&&"type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0;default:n.neverReachedSilent(e)}return!1},r.ensureLongFormType=function e(r){switch(r.type){case"native":return b(r.value);case"array":return m(e(r.value));case"one-of":return function(e){var r=null;return function(t,o){return function e(r,n){if(null==r)return!0;switch(n.type){case"native":switch(n.value){case Number:case w:return"number"==typeof r;case Boolean:return"boolean"==typeof r;case String:return"string"==typeof r}return r instanceof n.value;case"array":return!!Array.isArray(r)&&!r.some((function(r){return!e(r,n.value)}));case"one-of":return n.values.some((function(n){return e(r,n)}))}}(t,e)?t:(null==r&&(r=function e(r){switch(r.type){case"native":switch(r.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case w:return"integer";case Date:return"date";default:return g(r.value)}case"array":return"array of "+e(r.value);case"one-of":var t=r.values.map((function(r){return e(r)}));return"one of "+t.slice(0,t.length-1)+" or "+t[t.length-1];default:n.neverReached(r)}return"unknown"}(e)),u.error("Accessor#set","Invalid property value, value needs to be of type "+r),o&&(o.valid=!1),null)}}(r);default:return n.neverReached(r),null}},r.default=b}));