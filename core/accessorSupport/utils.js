/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../lang","../maybe","../handleUtils"],(function(r,n,t,e){"use strict";function i(r){return r?r.__accessor__?r.__accessor__:r.propertyInvalidated?r:null:null}function o(r,e,i){return e?Object.keys(e).reduce((function(r,a){let u=null,l="merge";if(i&&(u=i.path?`${i.path}.${a}`:a,l=i.policy(u)),"replace"===l)return r[a]=e[a],r;if(void 0===r[a])return r[a]=n.clone(e[a]),r;let s=r[a],c=e[a];if(s===c)return r;if(Array.isArray(c)||Array.isArray(r))s=s?Array.isArray(s)?r[a]=s.concat():r[a]=[s]:r[a]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach((r=>{-1===s.indexOf(r)&&s.push(r)})));else if(c&&"object"==typeof c)if(i){const n=i.path;i.path=t.assumeNonNull(u),r[a]=o(s,c,i),i.path=n}else r[a]=o(s,c,null);else r.hasOwnProperty(a)&&!e.hasOwnProperty(a)||(r[a]=c);return r}),r||{}):r}function a(r){return Array.isArray(r)?r:r.split(".")}function u(r){return r.indexOf(",")>-1?r.split(",").map((r=>r.trim())):[r.trim()]}function l(r){if(Array.isArray(r)){const n=[];for(const t of r)n.push(...u(t));return n}return u(r)}r.getDependsInfo=function(r,n,t){const e=i(r);return e?e.getDependsInfo(r,n,t,""):""},r.getProperties=i,r.isPropertyDeclared=function(r,n){return null!=r&&r.metadatas&&null!=r.metadatas[n]},r.merge=function(r,n,t){if(t){return o(r,n,{policy:t,path:""})}return o(r,n,null)},r.once=function(r){let n=!1;return()=>{n||(n=!0,r())}},r.parse=function(r,n,t,i){const o=l(n);if(1!==o.length){const n=o.map((n=>i(r,n,t)));return e.handlesGroup(n)}return i(r,o[0],t)},r.parseConditionalPath=function(r){if(-1===r.indexOf("?"))return null;const n=a(r),t=new Array(n.length);for(let r=0;r<n.length;r++){const e=n[r];t[r]="?"===e[e.length-1],t[r]&&(n[r]=e.slice(0,-1))}return{fullPath:n.join("."),conditional:t}},r.pathToArray=a,r.pathToStringOrArray=function(r){return r?"string"==typeof r&&-1===r.indexOf(".")?r:a(r):r},r.splitPath=l,Object.defineProperty(r,"__esModule",{value:!0})}));
