/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","./ObservableBase","./PropertyOrigin","./tracking","./tracking/Flags"],(function(t,e,s,i,n,r){"use strict";let o=function(){function t(t,e,s){this.properties=t,this.propertyName=e,this.metadata=s,this.observerObject=new a,this._accessed=null,this._handles=null,this.observerObject.flags=r.Flags.Dirty|(s.nonNullable?r.Flags.NonNullable:0)|(s.hasOwnProperty("value")?r.Flags.HasDefaultValue:0)|(void 0===s.get?r.Flags.DepTrackingInitialized:0)|(void 0===s.dependsOn?r.Flags.AutoTracked:0),l.register(this,this.observerObject)}var e=t.prototype;return e.destroy=function(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles(),l.unregister(this)},e.getComputed=function(){const t=this.observerObject;n.trackAccess(t);const e=this.properties.store,s=this.propertyName,o=t.flags,a=e.get(s);if(o&r.Flags.Computing)return a;if(~o&r.Flags.Dirty&&e.has(s))return a;t.flags|=r.Flags.Computing;const l=this.properties.host;let c;o&r.Flags.AutoTracked?c=n.runTracked(this,this.metadata.get,l):(n.trackExplicitDependencies(l,this),c=this.metadata.get.call(l)),e.set(s,c,i.OriginId.COMPUTED);const h=e.get(s);return h===a?t.flags&=~r.Flags.Dirty:n.runUntracked(this.commit,this),t.flags&=~r.Flags.Computing,h},e.onObservableAccessed=function(t){t!==this.observerObject&&(null===this._accessed&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))},e.onTrackingEnd=function(){this._clearObservationHandles();const t=this.observerObject;t.flags|=r.Flags.DepTrackingInitialized;const e=this._accessed;if(null===e)return;let s=this._handles;null===s&&(s=this._handles=[]);for(let i=0;i<e.length;++i)s.push(e[i].observe(t));e.length=0},e.notifyChange=function(){const t=this.observerObject;t.onInvalidated(),t.onCommitted()},e.invalidate=function(){this.observerObject.onInvalidated()},e.commit=function(){const t=this.observerObject;t.flags&=~r.Flags.Dirty,t.onCommitted()},e._clearObservationHandles=function(){const t=this._handles;if(null!==t){for(let e=0;e<t.length;++e)t[e].remove();t.length=0}},t}(),a=function(t){function s(){var e;return(e=t.apply(this,arguments)||this).flags=0,e}e._inheritsLoose(s,t);var i=s.prototype;return i.onInvalidated=function(){~this.flags&r.Flags.Overriden&&(this.flags|=r.Flags.Dirty);const t=this._observers;if(t&&t.length>0)for(const e of t)e.onInvalidated()},i.onCommitted=function(){const t=this._observers;if(t&&t.length>0){const e=t.slice();for(const t of e)t.onCommitted()}},i.destroy=function(){this.flags&r.Flags.Dirty&&this.onCommitted(),t.prototype.destroy.call(this)},s}(s.ObservableBase);const l=new FinalizationRegistry((t=>{t.destroy()}));t.Property=o,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
