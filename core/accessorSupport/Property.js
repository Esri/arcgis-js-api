/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","./tracking","./tracking/ObservationHandle"],(function(t,e,s){"use strict";let n=function(){function t(t,e,s){this.properties=t,this.propertyName=e,this.metadata=s,this._observers=null,this._accessed=null,this._handles=null,this.flags=1|(s.nonNullable?8:0)|(s.hasOwnProperty("value")?16:0)|(void 0===s.get?32:0)|(void 0===s.dependsOn?64:0)}var n=t.prototype;return n.destroy=function(){this._accessed=null,this._observers=null,this._clearObservationHandles()},n.getComputed=function(){e.trackAccess(this);const t=this.properties.store,s=this.propertyName,n=this.flags,i=t.get(s);if(4&n)return i;if(1&~n&&t.has(s))return i;this.flags|=4;const o=this.properties.host;let r;64&n?r=e.runTracked(this,this.metadata.get,o):(e.trackExplicitDependencies(o,this),r=this.metadata.get.call(o)),t.set(s,r,1);const l=t.get(s);return l===i?this.flags&=-2:this.commit(),this.flags&=-5,l},n.onObservableAccessed=function(t){t!==this&&(null===this._accessed&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))},n.onTrackingEnd=function(){this._clearObservationHandles(),this.flags|=32;const t=this._accessed;if(null===t)return;let e=this._handles;null===e&&(e=this._handles=[]);for(let s=0;s<t.length;++s)e.push(t[s].observe(this));t.length=0},n.observe=function(t){return null===this._observers&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new s.ObservationHandle(this._observers,t)},n.notifyChange=function(){this.onInvalidated(),this.onCommitted()},n.invalidate=function(){this.onInvalidated()},n.onInvalidated=function(){2&~this.flags&&(this.flags|=1);const t=this._observers;if(null!==t)for(let e=0;e<t.length;++e)t[e].onInvalidated()},n.commit=function(){this.flags&=-2,this.onCommitted()},n.onCommitted=function(){if(null===this._observers)return;const t=this._observers.slice();for(let e=0;e<t.length;++e)t[e].onCommitted()},n._clearObservationHandles=function(){const t=this._handles;if(null!==t){for(let e=0;e<t.length;++e)t[e].remove();t.length=0}},t}();t.Property=n,Object.defineProperty(t,"__esModule",{value:!0})}));
