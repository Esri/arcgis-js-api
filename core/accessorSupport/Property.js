/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","./tracking/ObservationHandle"],(function(s,e){"use strict";let t=!1;function n(){return t}function i(){t=!0}function o(){t=!1}function r(s){return void 0!==s.flags}let a=function(){function s(s,e,t){this.host=s,this.propertyName=e,this.metadata=t,this.flags=1,this._observers=null,this._accessed=null,this._handles=[],this.flags=1|(t.nonNullable?8:0)|(t.hasOwnProperty("value")?16:0)|(void 0===t.get?32:0)|(void 0===t.dependsOn?64:0)}var n=s.prototype;return n.destroy=function(){this._accessed&&(this._accessed.clear(),this._accessed=null),this._observers&&(this._observers.clear(),this._observers=null),this._clearObservationHandles()},n.onObservableAccessed=function(s){s!==this&&(null===this._accessed&&(this._accessed=new Set),this._accessed.add(s))},n.onTrackingEnd=function(){this._clearObservationHandles(),this.flags|=32;const s=this._accessed;if(null===s)return;const e=this._handles;for(const t of s)e.push(t.observe(this));s.clear()},n.observe=function(s){return null===this._observers&&(this._observers=new Set),new e.ObservationHandle(this._observers.add(s),s)},n.notify=function(){2&~this.flags&&(this.flags|=1),this._notifyObservers()},n.invalidate=function(){this.notify()},n.commit=function(){this.flags&=-2,this._notifyObservers()},n._notifyObservers=function(){if(null===this._observers)return;const s=this._observers.size,e=new Array(s);let n=s-1;for(const t of this._observers)e[n--]=t;const i=!t;for(;e.length;){const s=e.pop();if(r(s)){if(2&~s.flags&&(s.flags|=1),null===s._observers)continue;for(const t of s._observers)e.push(t)}else i&&s.notify()}},n._clearObservationHandles=function(){for(const s of this._handles)s.remove();this._handles.length=0},s}();s.Property=a,s.isInvalidating=n,s.startInvalidating=i,s.stopInvalidating=o,Object.defineProperty(s,"__esModule",{value:!0})}));
