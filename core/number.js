// COPYRIGHT © 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../core/string","../intl/locale"],(function(e,r,n,t,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parse=r._parseInfo=r.regexp=r.format=r.getCustoms=void 0;var i={ar:[".",","],bs:[",","."],ca:[",","."],cs:[","," "],da:[",","."],de:[",","."],"de-ch":[".","’"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[","," "],fi:[","," "],fr:[","," "],"fr-ch":[","," "],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[","," "],id:[",","."],it:[",","."],"it-ch":[".","’"],ja:[".",","],ko:[".",","],lt:[","," "],lv:[","," "],mk:[",","."],nb:[","," "],nl:[",","."],pl:[","," "],pt:[",","."],"pt-pt":[","," "],ro:[",","."],ru:[","," "],sk:[","," "],sl:[",","."],sr:[",","."],sv:[","," "],th:[".",","],tr:[",","."],uk:[","," "],vi:[",","."],zh:[".",","]};function s(e){e||(e=a.getLocale());var r=e in i;if(!r){var n=e.split("-");n.length>1&&n[0]in i&&(e=n[0],r=!0),r||(e="en")}var t=i[e],s=t[0],o=t[1],l=t[2];return{decimal:s,group:o,pattern:void 0===l?"#,##0.###":l}}r.getCustoms=s,r.format=function(e,r){var a=s((r=n.__assign({},r)).locale);r.customs=a;var i=r.pattern||a.pattern;return isNaN(e)||Math.abs(e)===1/0?null:function(e,r,n){var a=(n=n||{}).customs.group,i=n.customs.decimal,s=r.split(";"),l=s[0];if(-1!==(r=s[e<0?1:0]||"-"+l).indexOf("%"))e*=100;else if(-1!==r.indexOf("‰"))e*=1e3;else{if(-1!==r.indexOf("¤"))throw new Error("currency notation not supported");if(-1!==r.indexOf("E"))throw new Error("exponential notation not supported")}var p=o,c=l.match(p);if(!c)throw new Error("unable to find a number expression in pattern: "+r);!1===n.fractional&&(n.places=0);return r.replace(p,function(e,r,n){!0===(n=n||{}).places&&(n.places=0);n.places===1/0&&(n.places=6);var a=r.split("."),i="string"==typeof n.places&&n.places.indexOf(","),s=n.places;i?s=n.places.substring(i+1):s>=0||(s=(a[1]||[]).length);n.round<0||(e=Number(e.toFixed(Number(s))));var o=String(Math.abs(e)).split("."),l=o[1]||"";if(a[1]||n.places){i&&(n.places=n.places.substring(0,i));var p=void 0!==n.places?n.places:a[1]&&a[1].lastIndexOf("0")+1;p>l.length&&(o[1]=t.padEnd(l,Number(p),"0")),s<l.length&&(o[1]=l.substr(0,Number(s)))}else o[1]&&o.pop();var c=a[0].replace(",",""),u=c.indexOf("0");-1!==u&&((u=c.length-u)>o[0].length&&(o[0]=t.padStart(o[0],u,"0")),-1===c.indexOf("#")&&(o[0]=o[0].substr(o[0].length-u)));var f,d,g=a[0].lastIndexOf(",");if(-1!==g){f=a[0].length-g-1;var h=a[0].substr(0,g);-1!==(g=h.lastIndexOf(","))&&(d=h.length-g-1)}for(var v=[],x=o[0];x;){var m=x.length-f;v.push(m>0?x.substr(m):x),x=m>0?x.slice(0,m):"",d&&(f=d,d=void 0)}return o[0]=v.reverse().join(n.group||","),o.join(n.decimal||".")}(e,c[0],{decimal:i,group:a,places:n.places,round:n.round}))}(e,i,r)};var o=/[#0,]*[#0](?:\.0*#*)?/;function l(e){var r=s((e=e||{}).locale),n=e.pattern||r.pattern,a=r.group,i=r.decimal,l=1;if(-1!==n.indexOf("%"))l/=100;else if(-1!==n.indexOf("‰"))l/=1e3;else if(-1!==n.indexOf("¤"))throw new Error("currency notation not supported");var u=n.split(";");return 1===u.length&&u.push("-"+u[0]),{regexp:c(u,(function(r){return(r="(?:"+t.escapeRegExpString(r,".")+")").replace(o,(function(r){var n={signed:!1,separator:e.strict?a:[a,""],fractional:e.fractional,decimal:i,exponent:!1},t=r.split("."),s=e.places;1===t.length&&1!==l&&(t[1]="###"),1===t.length||0===s?n.fractional=!1:(void 0===s&&(s=e.pattern?t[1].lastIndexOf("0")+1:1/0),s&&null==e.fractional&&(n.fractional=!0),!e.places&&s<t[1].length&&(s+=","+t[1].length),n.places=s);var o=t[0].split(",");return o.length>1&&(n.groupSize=o.pop().length,o.length>1&&(n.groupSize2=o.pop().length)),"("+function(e){"places"in(e=e||{})||(e.places=1/0);"string"!=typeof e.decimal&&(e.decimal=".");"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]);"exponent"in e||(e.exponent=[!0,!1]);"eSigned"in e||(e.eSigned=[!0,!1]);var r=p(e),n=c(e.fractional,(function(r){var n="";return r&&0!==e.places&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n}),!0),t=c(e.exponent,(function(r){return r?"([eE]"+p({signed:e.eSigned})+")":""})),a=r+n;n&&(a="(?:(?:"+a+")|(?:"+n+"))");return a+t}(n)+")"}))}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:a,decimal:i,factor:l}}function p(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",c(e.signed,(function(e){return e?"[-+]":""}),!0)+c(e.separator,(function(r){if(!r)return"(?:\\d+)";" "===(r=t.escapeRegExpString(r))?r="\\s":" "===r&&(r="\\s\\xa0");var n=e.groupSize,a=e.groupSize2;if(a){var i="(?:0|[1-9]\\d{0,"+(a-1)+"}(?:["+r+"]\\d{"+a+"})*["+r+"]\\d{"+n+"})";return n-a>0?"(?:"+i+"|(?:0|[1-9]\\d{0,"+(n-1)+"}))":i}return"(?:0|[1-9]\\d{0,"+(n-1)+"}(?:["+r+"]\\d{"+n+"})*)"}),!0)}r.regexp=function(e){return l(e).regexp},r._parseInfo=l,r.parse=function(e,r){var n=l(r),t=new RegExp("^"+n.regexp+"$").exec(e);if(!t)return NaN;var a=t[1];if(!t[1]){if(!t[2])return NaN;a=t[2],n.factor*=-1}return a=a.replace(new RegExp("["+n.group+"\\s\\xa0]","g"),"").replace(n.decimal,"."),Number(a)*n.factor};var c=function(e,r,n){if(!(e instanceof Array))return r(e);for(var t=[],a=0;a<e.length;a++)t.push(r(e[a]));return u(t.join("|"),n)},u=function(e,r){return"("+(r?"?:":"")+e+")"}}));