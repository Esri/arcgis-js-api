/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["require","exports","../has","../Error","../promiseUtils","./RemoteClient","./Connection","./WorkerOwner"],(function(e,t,r,n,o,i,a,c){"use strict";function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}let u=r("esri-workers-debug")?1:r("host-browser")?navigator.hardwareConcurrency-1:0;u||(u=r("safari")&&r("mac")||r("trident")?7:2);let l=0;const f=[];function d(){y()}function w(e,t){return m(e,{client:t})}async function m(e,t){const r=new a;return await r.open(e,t),r}async function b(t,a={}){if("string"!=typeof t)throw new n("workers:undefined-module","modulePath is missing");let c=a.strategy||"distributed";if(r("host-webworker")&&!r("esri-workers")&&(c="local"),"local"===c){let r=await i.loadWorker(t);r||(r=await new Promise((function(r,n){e([
/* @vite-ignore */
/* webpackIgnore: true */
t],(function(e){r(s(e))}),n)}))),o.throwIfAborted(a.signal);const n=a.client||r;return m([i.connect(r)],{...a,client:n})}if(await y(),o.throwIfAborted(a.signal),"dedicated"===c){const e=l++%u;return m([await f[e].open(t,a)],a)}if(a.maxNumWorkers&&a.maxNumWorkers>0){const e=Math.min(a.maxNumWorkers,u);if(e<u){const r=new Array(e);for(let n=0;n<e;++n){const e=l++%u;r[n]=f[e].open(t,a)}return m(r,a)}}return m(f.map((e=>e.open(t,a))),a)}function h(){g&&(p.abort(),g=null);for(let e=0;e<f.length;e++)f[e]&&f[e].terminate();f.length=0}let p,g=null;async function y(){if(g)return g;p=o.createAbortController();const e=[];for(let t=0;t<u;t++){const r=c.create(t).then((e=>(f[t]=e,e)));e.push(r)}return g=Promise.all(e),g}t.RemoteClient=i,t.Connection=a,t.initialize=d,t.open=b,t.openWithPorts=w,t.terminate=h,Object.defineProperty(t,"__esModule",{value:!0})}));
