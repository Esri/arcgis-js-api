/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../Error","../has","../promiseUtils","./Connection","./RemoteClient","./WorkerOwner"],(function(e,t,n,r,o,i,u,l,c){"use strict";function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}let a=o("esri-workers-debug")?1:o("host-browser")?navigator.hardwareConcurrency-1:0;a||(a=o("safari")&&o("mac")||o("trident")?7:2);let f=0;const p=[];function d(){P()}function h(e,t){return y(e,{client:t})}function y(e,t){return m.apply(this,arguments)}function m(){return(m=n._asyncToGenerator((function*(e,t){const n=new u;return yield n.open(e,t),n}))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=n._asyncToGenerator((function*(t,n={}){if("string"!=typeof t)throw new r("workers:undefined-module","modulePath is missing");let u=n.strategy||"distributed";if(o("host-webworker")&&!o("esri-workers")&&(u="local"),"local"===u){let r=yield l.loadWorker(t);r||(r=yield new Promise((function(n,r){e([
/* @vite-ignore */
/* webpackIgnore: true */
t],(function(e){n(s(e))}),r)}))),i.throwIfAborted(n.signal);const o=n.client||r;return y([l.connect(r)],{...n,client:o})}if(yield P(),i.throwIfAborted(n.signal),"dedicated"===u){const e=f++%a;return y([yield p[e].open(t,n)],n)}if(n.maxNumWorkers&&n.maxNumWorkers>0){const e=Math.min(n.maxNumWorkers,a);if(e<a){const r=new Array(e);for(let o=0;o<e;++o){const e=f++%a;r[o]=p[e].open(t,n)}return y(r,n)}}return y(p.map((e=>e.open(t,n))),n)}))).apply(this,arguments)}function g(){O&&(k.abort(),O=null);for(let e=0;e<p.length;e++)p[e]&&p[e].terminate();p.length=0}let k,O=null;function P(){return _.apply(this,arguments)}function _(){return(_=n._asyncToGenerator((function*(){if(O)return O;k=i.createAbortController();const e=[];for(let t=0;t<a;t++){const n=c.create(t).then((e=>(p[t]=e,e)));e.push(n)}return O=Promise.all(e),O}))).apply(this,arguments)}t.Connection=u,t.RemoteClient=l,t.initialize=d,t.open=b,t.openWithPorts=h,t.terminate=g,Object.defineProperty(t,"__esModule",{value:!0})}));
