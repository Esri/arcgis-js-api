/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["require","../../chunks/_rollupPluginBabelHelpers","../global","./utils","./RemoteClient"],(function(e,t,n,r,s){"use strict";function o(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}let i=function(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...n)=>e[t](...n)}))};const a=n.MutationObserver||n.WebKitMutationObserver,c=function(){let e;if(n.process&&n.process.nextTick)e=e=>{n.process.nextTick(e)};else if(n.Promise)e=e=>{n.Promise.resolve().then(e)};else if(a){const t=[],n=document.createElement("div");new a((()=>{for(;t.length>0;)t.shift()()})).observe(n,{attributes:!0}),e=e=>{t.push(e),n.setAttribute("queueStatus","1")}}return e}(),u=(()=>{const e=n.MessageEvent;try{new e("message",{data:null})}catch{return(e,t={})=>{const{data:n,bubbles:r=!1,cancelable:s=!1}=t,o=document.createEvent("Event");return o.initEvent(e,r,s),o.data=n,o}}return(t,n)=>new e(t,n)})();return function(){function n(){this._dispatcher=new i,this._workerPostMessage({type:r.MessageType.HANDSHAKE})}var a=n.prototype;return a.terminate=function(){},a.postMessage=function(e){c((()=>{this._workerMessageHandler(u("message",{data:e}))}))},a.dispatchEvent=function(e){return this._dispatcher.dispatchEvent(e)},a.addEventListener=function(e,t,n){this._dispatcher.addEventListener(e,t,n)},a.removeEventListener=function(e,t,n){this._dispatcher.removeEventListener(e,t,n)},a._workerPostMessage=function(e){c((()=>{this.dispatchEvent(u("message",{data:e}))}))},a._workerMessageHandler=async function(t){const n=r.receiveMessage(t);if(n&&n.type===r.MessageType.OPEN){const{modulePath:t,jobId:i}=n;let a=await s.loadWorker(t);a||(a=await new Promise((function(n,r){e([
/* @vite-ignore */
/* webpackIgnore: true */
t],(function(e){n(o(e))}),r)})));const c=s.connect(a);this._workerPostMessage({type:r.MessageType.OPENED,jobId:i,data:c})}},t._createClass(n,[{key:"onmessage",get:function(){return this._onmessageHandler},set:function(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}},{key:"onmessageerror",get:function(){return this._onmessageerrorHandler},set:function(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}},{key:"onerror",get:function(){return this._onerrorHandler},set:function(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}}]),n}()}));
