/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["require","../../chunks/_rollupPluginBabelHelpers","../global","./utils","./RemoteClient"],(function(e,t,s,r,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(s){if("default"!==s){var r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return e[s]}})}})),t.default=e,Object.freeze(t)}let a=function(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...s)=>e[t](...s)}))};const o=s.MutationObserver||s.WebKitMutationObserver,c=function(){let e;if(s.process&&s.process.nextTick)e=e=>{s.process.nextTick(e)};else if(s.Promise)e=e=>{s.Promise.resolve().then(e)};else if(o){const t=[],s=document.createElement("div");new o((()=>{for(;t.length>0;)t.shift()()})).observe(s,{attributes:!0}),e=e=>{t.push(e),s.setAttribute("queueStatus","1")}}return e}(),u=(()=>{const e=s.MessageEvent;try{new e("message",{data:null})}catch{return(e,t={})=>{const{data:s,bubbles:r=!1,cancelable:n=!1}=t,i=document.createEvent("Event");return i.initEvent(e,r,n),i.data=s,i}}return(t,s)=>new e(t,s)})();return function(){function s(){this._dispatcher=new a,this._isInitialized=!1,this._workerPostMessage({type:r.MessageType.HANDSHAKE})}var o=s.prototype;return o.terminate=function(){},o.postMessage=function(e){c((()=>{this._workerMessageHandler(u("message",{data:e}))}))},o.dispatchEvent=function(e){return this._dispatcher.dispatchEvent(e)},o.addEventListener=function(e,t,s){this._dispatcher.addEventListener(e,t,s)},o.removeEventListener=function(e,t,s){this._dispatcher.removeEventListener(e,t,s)},o._workerPostMessage=function(e){c((()=>{this.dispatchEvent(u("message",{data:e}))}))},o._workerMessageHandler=async function(t){const s=r.receiveMessage(t);if(s)switch(s.type){case r.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:r.MessageType.CONFIGURED});break;case r.MessageType.OPEN:{const{modulePath:t,jobId:a}=s;let o=await n.loadWorker(t);o||(o=await new Promise((function(s,r){e([t],(function(e){s(i(e))}),r)})));const c=n.connect(o);this._workerPostMessage({type:r.MessageType.OPENED,jobId:a,data:c});break}}},t._createClass(s,[{key:"onmessage",get:function(){return this._onmessageHandler},set:function(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}},{key:"onmessageerror",get:function(){return this._onmessageerrorHandler},set:function(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}},{key:"onerror",get:function(){return this._onerrorHandler},set:function(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}}]),s}()}));
