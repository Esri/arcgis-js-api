/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../has"],(function(e,t){"use strict";var r;(r=e.MessageType||(e.MessageType={}))[r.HANDSHAKE=0]="HANDSHAKE",r[r.CONFIGURE=1]="CONFIGURE",r[r.CONFIGURED=2]="CONFIGURED",r[r.OPEN=3]="OPEN",r[r.OPENED=4]="OPENED",r[r.RESPONSE=5]="RESPONSE",r[r.INVOKE=6]="INVOKE",r[r.ABORT=7]="ABORT",r[r.CLOSE=8]="CLOSE",r[r.OPEN_PORT=9]="OPEN_PORT",r[r.ON=10]="ON";let s=0;function n(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}function a(e){if(!e||!e.length)return null;if(t("esri-workers-arraybuffer-transfer"))return e;const r=e.filter((e=>{return!((t=e)instanceof ArrayBuffer||t&&t.constructor&&"ArrayBuffer"===t.constructor.name);var t}));return r.length?r:null}e.isTranferableResult=n,e.newJobId=function(){return s++},e.postMessage=function(t,r,s,i){if(r.type===e.MessageType.OPEN_PORT)return void t.postMessage(r,[r.port]);if(r.type!==e.MessageType.INVOKE&&r.type!==e.MessageType.RESPONSE)return void t.postMessage(r);let o;n(s)?(o=a(s.transferList),r.data=s.result):(o=a(i),r.data=s),o?t.postMessage(r,o):t.postMessage(r)},e.receiveMessage=function(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null},e.toInvokeError=function(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null},Object.defineProperty(e,"__esModule",{value:!0})}));
