/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../has"],(function(e,t){"use strict";var s;e.MessageType=void 0,(s=e.MessageType||(e.MessageType={}))[s.HANDSHAKE=0]="HANDSHAKE",s[s.OPEN=1]="OPEN",s[s.OPENED=2]="OPENED",s[s.RESPONSE=3]="RESPONSE",s[s.INVOKE=4]="INVOKE",s[s.ABORT=5]="ABORT",s[s.CLOSE=6]="CLOSE",s[s.OPEN_PORT=7]="OPEN_PORT",s[s.ON=8]="ON";let r=0;function n(){return r++}function a(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}function o(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function i(s,r,n,f){if(r.type===e.MessageType.OPEN_PORT)return void s.postMessage(r,[r.port]);if(r.type!==e.MessageType.INVOKE&&r.type!==e.MessageType.RESPONSE)return void s.postMessage(r);let g;if(a(n)?(g=u(n.transferList),r.data=n.result):(g=u(f),r.data=n),g){if(t("ff"))for(const t of g)if("byteLength"in t&&t.byteLength>267386880){const t="Worker call with large ArrayBuffer would crash Firefox";switch(r.type){case e.MessageType.INVOKE:throw t;case e.MessageType.RESPONSE:return void i(s,{type:e.MessageType.RESPONSE,jobId:r.jobId,error:o(t)})}}s.postMessage(r,g)}else s.postMessage(r)}function f(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function u(e){if(!e||!e.length)return null;if(t("esri-workers-arraybuffer-transfer"))return e;const s=e.filter((e=>!g(e)));return s.length?s:null}function g(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}e.isTranferableResult=a,e.newJobId=n,e.postMessage=i,e.receiveMessage=f,e.toInvokeError=o,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
