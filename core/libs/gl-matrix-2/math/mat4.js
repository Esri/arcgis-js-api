// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","../factories/vec3f64","./common"],(function(t,a,r,n){"use strict";function o(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i(t,a,r){var n=a[0],o=a[1],i=a[2],e=a[3],s=a[4],h=a[5],M=a[6],u=a[7],c=a[8],f=a[9],v=a[10],l=a[11],b=a[12],m=a[13],d=a[14],p=a[15],S=r[0],O=r[1],P=r[2],I=r[3];return t[0]=S*n+O*s+P*c+I*b,t[1]=S*o+O*h+P*f+I*m,t[2]=S*i+O*M+P*v+I*d,t[3]=S*e+O*u+P*l+I*p,S=r[4],O=r[5],P=r[6],I=r[7],t[4]=S*n+O*s+P*c+I*b,t[5]=S*o+O*h+P*f+I*m,t[6]=S*i+O*M+P*v+I*d,t[7]=S*e+O*u+P*l+I*p,S=r[8],O=r[9],P=r[10],I=r[11],t[8]=S*n+O*s+P*c+I*b,t[9]=S*o+O*h+P*f+I*m,t[10]=S*i+O*M+P*v+I*d,t[11]=S*e+O*u+P*l+I*p,S=r[12],O=r[13],P=r[14],I=r[15],t[12]=S*n+O*s+P*c+I*b,t[13]=S*o+O*h+P*f+I*m,t[14]=S*i+O*M+P*v+I*d,t[15]=S*e+O*u+P*l+I*p,t}function e(t,a,r){var n=a[0],o=a[1],i=a[2],e=a[3],s=n+n,h=o+o,M=i+i,u=n*s,c=n*h,f=n*M,v=o*h,l=o*M,b=i*M,m=e*s,d=e*h,p=e*M;return t[0]=1-(v+b),t[1]=c+p,t[2]=f-d,t[3]=0,t[4]=c-p,t[5]=1-(u+b),t[6]=l+m,t[7]=0,t[8]=f+d,t[9]=l-m,t[10]=1-(u+v),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}Object.defineProperty(a,"__esModule",{value:!0}),a.sub=a.mul=a.equals=a.exactEquals=a.multiplyScalarAndAdd=a.multiplyScalar=a.subtract=a.add=a.frob=a.str=a.targetTo=a.lookAt=a.ortho=a.perspectiveFromFieldOfView=a.perspective=a.frustum=a.fromQuat=a.fromRotationTranslationScaleOrigin=a.fromRotationTranslationScale=a.getRotation=a.getScaling=a.getTranslation=a.fromQuat2=a.fromRotationTranslation=a.fromZRotation=a.fromYRotation=a.fromXRotation=a.fromRotation=a.fromScaling=a.fromTranslation=a.rotateZ=a.rotateY=a.rotateX=a.rotate=a.scale=a.translate=a.multiply=a.determinant=a.adjoint=a.invert=a.transpose=a.identity=a.set=a.copy=void 0,a.copy=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},a.set=function(t,a,r,n,o,i,e,s,h,M,u,c,f,v,l,b,m){return t[0]=a,t[1]=r,t[2]=n,t[3]=o,t[4]=i,t[5]=e,t[6]=s,t[7]=h,t[8]=M,t[9]=u,t[10]=c,t[11]=f,t[12]=v,t[13]=l,t[14]=b,t[15]=m,t},a.identity=o,a.transpose=function(t,a){if(t===a){var r=a[1],n=a[2],o=a[3],i=a[6],e=a[7],s=a[11];t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=r,t[6]=a[9],t[7]=a[13],t[8]=n,t[9]=i,t[11]=a[14],t[12]=o,t[13]=e,t[14]=s}else t[0]=a[0],t[1]=a[4],t[2]=a[8],t[3]=a[12],t[4]=a[1],t[5]=a[5],t[6]=a[9],t[7]=a[13],t[8]=a[2],t[9]=a[6],t[10]=a[10],t[11]=a[14],t[12]=a[3],t[13]=a[7],t[14]=a[11],t[15]=a[15];return t},a.invert=function(t,a){var r=a[0],n=a[1],o=a[2],i=a[3],e=a[4],s=a[5],h=a[6],M=a[7],u=a[8],c=a[9],f=a[10],v=a[11],l=a[12],b=a[13],m=a[14],d=a[15],p=r*s-n*e,S=r*h-o*e,O=r*M-i*e,P=n*h-o*s,I=n*M-i*s,E=o*M-i*h,L=u*b-c*l,N=u*m-f*l,q=u*d-v*l,g=c*m-f*b,w=c*d-v*b,x=f*d-v*m,R=p*x-S*w+O*g+P*q-I*N+E*L;return R?(R=1/R,t[0]=(s*x-h*w+M*g)*R,t[1]=(o*w-n*x-i*g)*R,t[2]=(b*E-m*I+d*P)*R,t[3]=(f*I-c*E-v*P)*R,t[4]=(h*q-e*x-M*N)*R,t[5]=(r*x-o*q+i*N)*R,t[6]=(m*O-l*E-d*S)*R,t[7]=(u*E-f*O+v*S)*R,t[8]=(e*w-s*q+M*L)*R,t[9]=(n*q-r*w-i*L)*R,t[10]=(l*I-b*O+d*p)*R,t[11]=(c*O-u*I-v*p)*R,t[12]=(s*N-e*g-h*L)*R,t[13]=(r*g-n*N+o*L)*R,t[14]=(b*S-l*P-m*p)*R,t[15]=(u*P-c*S+f*p)*R,t):null},a.adjoint=function(t,a){var r=a[0],n=a[1],o=a[2],i=a[3],e=a[4],s=a[5],h=a[6],M=a[7],u=a[8],c=a[9],f=a[10],v=a[11],l=a[12],b=a[13],m=a[14],d=a[15];return t[0]=s*(f*d-v*m)-c*(h*d-M*m)+b*(h*v-M*f),t[1]=-(n*(f*d-v*m)-c*(o*d-i*m)+b*(o*v-i*f)),t[2]=n*(h*d-M*m)-s*(o*d-i*m)+b*(o*M-i*h),t[3]=-(n*(h*v-M*f)-s*(o*v-i*f)+c*(o*M-i*h)),t[4]=-(e*(f*d-v*m)-u*(h*d-M*m)+l*(h*v-M*f)),t[5]=r*(f*d-v*m)-u*(o*d-i*m)+l*(o*v-i*f),t[6]=-(r*(h*d-M*m)-e*(o*d-i*m)+l*(o*M-i*h)),t[7]=r*(h*v-M*f)-e*(o*v-i*f)+u*(o*M-i*h),t[8]=e*(c*d-v*b)-u*(s*d-M*b)+l*(s*v-M*c),t[9]=-(r*(c*d-v*b)-u*(n*d-i*b)+l*(n*v-i*c)),t[10]=r*(s*d-M*b)-e*(n*d-i*b)+l*(n*M-i*s),t[11]=-(r*(s*v-M*c)-e*(n*v-i*c)+u*(n*M-i*s)),t[12]=-(e*(c*m-f*b)-u*(s*m-h*b)+l*(s*f-h*c)),t[13]=r*(c*m-f*b)-u*(n*m-o*b)+l*(n*f-o*c),t[14]=-(r*(s*m-h*b)-e*(n*m-o*b)+l*(n*h-o*s)),t[15]=r*(s*f-h*c)-e*(n*f-o*c)+u*(n*h-o*s),t},a.determinant=function(t){var a=t[0],r=t[1],n=t[2],o=t[3],i=t[4],e=t[5],s=t[6],h=t[7],M=t[8],u=t[9],c=t[10],f=t[11],v=t[12],l=t[13],b=t[14],m=t[15];return(a*e-r*i)*(c*m-f*b)-(a*s-n*i)*(u*m-f*l)+(a*h-o*i)*(u*b-c*l)+(r*s-n*e)*(M*m-f*v)-(r*h-o*e)*(M*b-c*v)+(n*h-o*s)*(M*l-u*v)},a.multiply=i,a.translate=function(t,a,r){var n=r[0],o=r[1],i=r[2],e=void 0,s=void 0,h=void 0,M=void 0,u=void 0,c=void 0,f=void 0,v=void 0,l=void 0,b=void 0,m=void 0,d=void 0;return a===t?(t[12]=a[0]*n+a[4]*o+a[8]*i+a[12],t[13]=a[1]*n+a[5]*o+a[9]*i+a[13],t[14]=a[2]*n+a[6]*o+a[10]*i+a[14],t[15]=a[3]*n+a[7]*o+a[11]*i+a[15]):(e=a[0],s=a[1],h=a[2],M=a[3],u=a[4],c=a[5],f=a[6],v=a[7],l=a[8],b=a[9],m=a[10],d=a[11],t[0]=e,t[1]=s,t[2]=h,t[3]=M,t[4]=u,t[5]=c,t[6]=f,t[7]=v,t[8]=l,t[9]=b,t[10]=m,t[11]=d,t[12]=e*n+u*o+l*i+a[12],t[13]=s*n+c*o+b*i+a[13],t[14]=h*n+f*o+m*i+a[14],t[15]=M*n+v*o+d*i+a[15]),t},a.scale=function(t,a,r){var n=r[0],o=r[1],i=r[2];return t[0]=a[0]*n,t[1]=a[1]*n,t[2]=a[2]*n,t[3]=a[3]*n,t[4]=a[4]*o,t[5]=a[5]*o,t[6]=a[6]*o,t[7]=a[7]*o,t[8]=a[8]*i,t[9]=a[9]*i,t[10]=a[10]*i,t[11]=a[11]*i,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},a.rotate=function(t,a,r,o){var i,e,s,h,M,u,c,f,v,l,b,m,d,p,S,O,P,I,E,L,N,q,g,w,x=o[0],R=o[1],T=o[2],y=Math.sqrt(x*x+R*R+T*T);return y<n.EPSILON?null:(x*=y=1/y,R*=y,T*=y,i=Math.sin(r),s=1-(e=Math.cos(r)),h=a[0],M=a[1],u=a[2],c=a[3],f=a[4],v=a[5],l=a[6],b=a[7],m=a[8],d=a[9],p=a[10],S=a[11],O=x*x*s+e,P=R*x*s+T*i,I=T*x*s-R*i,E=x*R*s-T*i,L=R*R*s+e,N=T*R*s+x*i,q=x*T*s+R*i,g=R*T*s-x*i,w=T*T*s+e,t[0]=h*O+f*P+m*I,t[1]=M*O+v*P+d*I,t[2]=u*O+l*P+p*I,t[3]=c*O+b*P+S*I,t[4]=h*E+f*L+m*N,t[5]=M*E+v*L+d*N,t[6]=u*E+l*L+p*N,t[7]=c*E+b*L+S*N,t[8]=h*q+f*g+m*w,t[9]=M*q+v*g+d*w,t[10]=u*q+l*g+p*w,t[11]=c*q+b*g+S*w,a!==t&&(t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t)},a.rotateX=function(t,a,r){var n=Math.sin(r),o=Math.cos(r),i=a[4],e=a[5],s=a[6],h=a[7],M=a[8],u=a[9],c=a[10],f=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=i*o+M*n,t[5]=e*o+u*n,t[6]=s*o+c*n,t[7]=h*o+f*n,t[8]=M*o-i*n,t[9]=u*o-e*n,t[10]=c*o-s*n,t[11]=f*o-h*n,t},a.rotateY=function(t,a,r){var n=Math.sin(r),o=Math.cos(r),i=a[0],e=a[1],s=a[2],h=a[3],M=a[8],u=a[9],c=a[10],f=a[11];return a!==t&&(t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=i*o-M*n,t[1]=e*o-u*n,t[2]=s*o-c*n,t[3]=h*o-f*n,t[8]=i*n+M*o,t[9]=e*n+u*o,t[10]=s*n+c*o,t[11]=h*n+f*o,t},a.rotateZ=function(t,a,r){var n=Math.sin(r),o=Math.cos(r),i=a[0],e=a[1],s=a[2],h=a[3],M=a[4],u=a[5],c=a[6],f=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=i*o+M*n,t[1]=e*o+u*n,t[2]=s*o+c*n,t[3]=h*o+f*n,t[4]=M*o-i*n,t[5]=u*o-e*n,t[6]=c*o-s*n,t[7]=f*o-h*n,t},a.fromTranslation=function(t,a){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},a.fromScaling=function(t,a){return t[0]=a[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=a[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotation=function(t,a,r){var o,i,e,s=r[0],h=r[1],M=r[2],u=Math.sqrt(s*s+h*h+M*M);return u<n.EPSILON?null:(s*=u=1/u,h*=u,M*=u,o=Math.sin(a),e=1-(i=Math.cos(a)),t[0]=s*s*e+i,t[1]=h*s*e+M*o,t[2]=M*s*e-h*o,t[3]=0,t[4]=s*h*e-M*o,t[5]=h*h*e+i,t[6]=M*h*e+s*o,t[7]=0,t[8]=s*M*e+h*o,t[9]=h*M*e-s*o,t[10]=M*M*e+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},a.fromXRotation=function(t,a){var r=Math.sin(a),n=Math.cos(a);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromYRotation=function(t,a){var r=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromZRotation=function(t,a){var r=Math.sin(a),n=Math.cos(a);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotationTranslation=e,a.fromQuat2=function(t,a){var r=s,n=-a[0],o=-a[1],i=-a[2],h=a[3],M=a[4],u=a[5],c=a[6],f=a[7],v=n*n+o*o+i*i+h*h;return v>0?(r[0]=2*(M*h+f*n+u*i-c*o)/v,r[1]=2*(u*h+f*o+c*n-M*i)/v,r[2]=2*(c*h+f*i+M*o-u*n)/v):(r[0]=2*(M*h+f*n+u*i-c*o),r[1]=2*(u*h+f*o+c*n-M*i),r[2]=2*(c*h+f*i+M*o-u*n)),e(t,a,r),t};var s=r.create();function h(t,a,r){return t[0]=a[0]-r[0],t[1]=a[1]-r[1],t[2]=a[2]-r[2],t[3]=a[3]-r[3],t[4]=a[4]-r[4],t[5]=a[5]-r[5],t[6]=a[6]-r[6],t[7]=a[7]-r[7],t[8]=a[8]-r[8],t[9]=a[9]-r[9],t[10]=a[10]-r[10],t[11]=a[11]-r[11],t[12]=a[12]-r[12],t[13]=a[13]-r[13],t[14]=a[14]-r[14],t[15]=a[15]-r[15],t}a.getTranslation=function(t,a){return t[0]=a[12],t[1]=a[13],t[2]=a[14],t},a.getScaling=function(t,a){var r=a[0],n=a[1],o=a[2],i=a[4],e=a[5],s=a[6],h=a[8],M=a[9],u=a[10];return t[0]=Math.sqrt(r*r+n*n+o*o),t[1]=Math.sqrt(i*i+e*e+s*s),t[2]=Math.sqrt(h*h+M*M+u*u),t},a.getRotation=function(t,a){var r=a[0]+a[5]+a[10],n=0;return r>0?(n=2*Math.sqrt(r+1),t[3]=.25*n,t[0]=(a[6]-a[9])/n,t[1]=(a[8]-a[2])/n,t[2]=(a[1]-a[4])/n):a[0]>a[5]&&a[0]>a[10]?(n=2*Math.sqrt(1+a[0]-a[5]-a[10]),t[3]=(a[6]-a[9])/n,t[0]=.25*n,t[1]=(a[1]+a[4])/n,t[2]=(a[8]+a[2])/n):a[5]>a[10]?(n=2*Math.sqrt(1+a[5]-a[0]-a[10]),t[3]=(a[8]-a[2])/n,t[0]=(a[1]+a[4])/n,t[1]=.25*n,t[2]=(a[6]+a[9])/n):(n=2*Math.sqrt(1+a[10]-a[0]-a[5]),t[3]=(a[1]-a[4])/n,t[0]=(a[8]+a[2])/n,t[1]=(a[6]+a[9])/n,t[2]=.25*n),t},a.fromRotationTranslationScale=function(t,a,r,n){var o=a[0],i=a[1],e=a[2],s=a[3],h=o+o,M=i+i,u=e+e,c=o*h,f=o*M,v=o*u,l=i*M,b=i*u,m=e*u,d=s*h,p=s*M,S=s*u,O=n[0],P=n[1],I=n[2];return t[0]=(1-(l+m))*O,t[1]=(f+S)*O,t[2]=(v-p)*O,t[3]=0,t[4]=(f-S)*P,t[5]=(1-(c+m))*P,t[6]=(b+d)*P,t[7]=0,t[8]=(v+p)*I,t[9]=(b-d)*I,t[10]=(1-(c+l))*I,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},a.fromRotationTranslationScaleOrigin=function(t,a,r,n,o){var i=a[0],e=a[1],s=a[2],h=a[3],M=i+i,u=e+e,c=s+s,f=i*M,v=i*u,l=i*c,b=e*u,m=e*c,d=s*c,p=h*M,S=h*u,O=h*c,P=n[0],I=n[1],E=n[2],L=o[0],N=o[1],q=o[2],g=(1-(b+d))*P,w=(v+O)*P,x=(l-S)*P,R=(v-O)*I,T=(1-(f+d))*I,y=(m+p)*I,A=(l+S)*E,D=(m-p)*E,F=(1-(f+b))*E;return t[0]=g,t[1]=w,t[2]=x,t[3]=0,t[4]=R,t[5]=T,t[6]=y,t[7]=0,t[8]=A,t[9]=D,t[10]=F,t[11]=0,t[12]=r[0]+L-(g*L+R*N+A*q),t[13]=r[1]+N-(w*L+T*N+D*q),t[14]=r[2]+q-(x*L+y*N+F*q),t[15]=1,t},a.fromQuat=function(t,a){var r=a[0],n=a[1],o=a[2],i=a[3],e=r+r,s=n+n,h=o+o,M=r*e,u=n*e,c=n*s,f=o*e,v=o*s,l=o*h,b=i*e,m=i*s,d=i*h;return t[0]=1-c-l,t[1]=u+d,t[2]=f-m,t[3]=0,t[4]=u-d,t[5]=1-M-l,t[6]=v+b,t[7]=0,t[8]=f+m,t[9]=v-b,t[10]=1-M-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.frustum=function(t,a,r,n,o,i,e){var s=1/(r-a),h=1/(o-n),M=1/(i-e);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*h,t[6]=0,t[7]=0,t[8]=(r+a)*s,t[9]=(o+n)*h,t[10]=(e+i)*M,t[11]=-1,t[12]=0,t[13]=0,t[14]=e*i*2*M,t[15]=0,t},a.perspective=function(t,a,r,n,o){var i=1/Math.tan(a/2),e=void 0;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(e=1/(n-o),t[10]=(o+n)*e,t[14]=2*o*n*e):(t[10]=-1,t[14]=-2*n),t},a.perspectiveFromFieldOfView=function(t,a,r,n){var o=Math.tan(a.upDegrees*Math.PI/180),i=Math.tan(a.downDegrees*Math.PI/180),e=Math.tan(a.leftDegrees*Math.PI/180),s=Math.tan(a.rightDegrees*Math.PI/180),h=2/(e+s),M=2/(o+i);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=M,t[6]=0,t[7]=0,t[8]=-(e-s)*h*.5,t[9]=(o-i)*M*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},a.ortho=function(t,a,r,n,o,i,e){var s=1/(a-r),h=1/(n-o),M=1/(i-e);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*M,t[11]=0,t[12]=(a+r)*s,t[13]=(o+n)*h,t[14]=(e+i)*M,t[15]=1,t},a.lookAt=function(t,a,r,i){var e=void 0,s=void 0,h=void 0,M=void 0,u=void 0,c=void 0,f=void 0,v=void 0,l=void 0,b=void 0,m=a[0],d=a[1],p=a[2],S=i[0],O=i[1],P=i[2],I=r[0],E=r[1],L=r[2];return Math.abs(m-I)<n.EPSILON&&Math.abs(d-E)<n.EPSILON&&Math.abs(p-L)<n.EPSILON?o(t):(f=m-I,v=d-E,l=p-L,e=O*(l*=b=1/Math.sqrt(f*f+v*v+l*l))-P*(v*=b),s=P*(f*=b)-S*l,h=S*v-O*f,(b=Math.sqrt(e*e+s*s+h*h))?(e*=b=1/b,s*=b,h*=b):(e=0,s=0,h=0),M=v*h-l*s,u=l*e-f*h,c=f*s-v*e,(b=Math.sqrt(M*M+u*u+c*c))?(M*=b=1/b,u*=b,c*=b):(M=0,u=0,c=0),t[0]=e,t[1]=M,t[2]=f,t[3]=0,t[4]=s,t[5]=u,t[6]=v,t[7]=0,t[8]=h,t[9]=c,t[10]=l,t[11]=0,t[12]=-(e*m+s*d+h*p),t[13]=-(M*m+u*d+c*p),t[14]=-(f*m+v*d+l*p),t[15]=1,t)},a.targetTo=function(t,a,r,n){var o=a[0],i=a[1],e=a[2],s=n[0],h=n[1],M=n[2],u=o-r[0],c=i-r[1],f=e-r[2],v=u*u+c*c+f*f;v>0&&(u*=v=1/Math.sqrt(v),c*=v,f*=v);var l=h*f-M*c,b=M*u-s*f,m=s*c-h*u;return(v=l*l+b*b+m*m)>0&&(l*=v=1/Math.sqrt(v),b*=v,m*=v),t[0]=l,t[1]=b,t[2]=m,t[3]=0,t[4]=c*m-f*b,t[5]=f*l-u*m,t[6]=u*b-c*l,t[7]=0,t[8]=u,t[9]=c,t[10]=f,t[11]=0,t[12]=o,t[13]=i,t[14]=e,t[15]=1,t},a.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},a.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},a.add=function(t,a,r){return t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t[3]=a[3]+r[3],t[4]=a[4]+r[4],t[5]=a[5]+r[5],t[6]=a[6]+r[6],t[7]=a[7]+r[7],t[8]=a[8]+r[8],t[9]=a[9]+r[9],t[10]=a[10]+r[10],t[11]=a[11]+r[11],t[12]=a[12]+r[12],t[13]=a[13]+r[13],t[14]=a[14]+r[14],t[15]=a[15]+r[15],t},a.subtract=h,a.multiplyScalar=function(t,a,r){return t[0]=a[0]*r,t[1]=a[1]*r,t[2]=a[2]*r,t[3]=a[3]*r,t[4]=a[4]*r,t[5]=a[5]*r,t[6]=a[6]*r,t[7]=a[7]*r,t[8]=a[8]*r,t[9]=a[9]*r,t[10]=a[10]*r,t[11]=a[11]*r,t[12]=a[12]*r,t[13]=a[13]*r,t[14]=a[14]*r,t[15]=a[15]*r,t},a.multiplyScalarAndAdd=function(t,a,r,n){return t[0]=a[0]+r[0]*n,t[1]=a[1]+r[1]*n,t[2]=a[2]+r[2]*n,t[3]=a[3]+r[3]*n,t[4]=a[4]+r[4]*n,t[5]=a[5]+r[5]*n,t[6]=a[6]+r[6]*n,t[7]=a[7]+r[7]*n,t[8]=a[8]+r[8]*n,t[9]=a[9]+r[9]*n,t[10]=a[10]+r[10]*n,t[11]=a[11]+r[11]*n,t[12]=a[12]+r[12]*n,t[13]=a[13]+r[13]*n,t[14]=a[14]+r[14]*n,t[15]=a[15]+r[15]*n,t},a.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]&&t[8]===a[8]&&t[9]===a[9]&&t[10]===a[10]&&t[11]===a[11]&&t[12]===a[12]&&t[13]===a[13]&&t[14]===a[14]&&t[15]===a[15]},a.equals=function(t,a){var r=t[0],o=t[1],i=t[2],e=t[3],s=t[4],h=t[5],M=t[6],u=t[7],c=t[8],f=t[9],v=t[10],l=t[11],b=t[12],m=t[13],d=t[14],p=t[15],S=a[0],O=a[1],P=a[2],I=a[3],E=a[4],L=a[5],N=a[6],q=a[7],g=a[8],w=a[9],x=a[10],R=a[11],T=a[12],y=a[13],A=a[14],D=a[15];return Math.abs(r-S)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(o-O)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(i-P)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(P))&&Math.abs(e-I)<=n.EPSILON*Math.max(1,Math.abs(e),Math.abs(I))&&Math.abs(s-E)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(h-L)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(M-N)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(N))&&Math.abs(u-q)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(q))&&Math.abs(c-g)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(f-w)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(v-x)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(x))&&Math.abs(l-R)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(b-T)<=n.EPSILON*Math.max(1,Math.abs(b),Math.abs(T))&&Math.abs(m-y)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(y))&&Math.abs(d-A)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(p-D)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))},a.mul=i,a.sub=h}));