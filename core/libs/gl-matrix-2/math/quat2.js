// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","../factories/quatf64","../factories/vec3f64","./common","./mat4","./quat"],(function(t,a,r,n,e,o,u){"use strict";function s(t,a,r){var n=.5*r[0],e=.5*r[1],o=.5*r[2],u=a[0],s=a[1],i=a[2],c=a[3];return t[0]=u,t[1]=s,t[2]=i,t[3]=c,t[4]=n*c+e*i-o*s,t[5]=e*c+o*u-n*i,t[6]=o*c+n*s-e*u,t[7]=-n*u-e*s-o*i,t}Object.defineProperty(a,"__esModule",{value:!0}),a.equals=a.exactEquals=a.str=a.normalize=a.sqrLen=a.squaredLength=a.len=a.length=a.conjugate=a.invert=a.lerp=a.dot=a.scale=a.mul=a.multiply=a.add=a.rotateAroundAxis=a.rotateByQuatPrepend=a.rotateByQuatAppend=a.rotateZ=a.rotateY=a.rotateX=a.translate=a.getTranslation=a.setDual=a.setReal=a.getDual=a.getReal=a.set=a.identity=a.copy=a.fromMat4=a.fromRotation=a.fromTranslation=a.fromRotationTranslation=void 0,a.fromRotationTranslation=s,a.fromTranslation=function(t,a){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*a[0],t[5]=.5*a[1],t[6]=.5*a[2],t[7]=0,t},a.fromRotation=function(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},a.fromMat4=function(t,a){var r=i;o.getRotation(r,a);var n=c;return o.getTranslation(n,a),s(t,r,n),t};var i=r.create(),c=n.create();function h(t,a){return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t}function f(t,a,r){var n=a[0],e=a[1],o=a[2],u=a[3],s=r[4],i=r[5],c=r[6],h=r[7],f=a[4],l=a[5],M=a[6],b=a[7],d=r[0],m=r[1],v=r[2],g=r[3];return t[0]=n*g+u*d+e*v-o*m,t[1]=e*g+u*m+o*d-n*v,t[2]=o*g+u*v+n*m-e*d,t[3]=u*g-n*d-e*m-o*v,t[4]=n*h+u*s+e*c-o*i+f*g+b*d+l*v-M*m,t[5]=e*h+u*i+o*s-n*c+l*g+b*m+M*d-f*v,t[6]=o*h+u*c+n*i-e*s+M*g+b*v+f*m-l*d,t[7]=u*h-n*s-e*i-o*c+b*g-f*d-l*m-M*v,t}a.copy=h,a.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},a.set=function(t,a,r,n,e,o,u,s,i){return t[0]=a,t[1]=r,t[2]=n,t[3]=e,t[4]=o,t[5]=u,t[6]=s,t[7]=i,t},a.getReal=u.copy,a.getDual=function(t,a){return t[0]=a[4],t[1]=a[5],t[2]=a[6],t[3]=a[7],t},a.setReal=u.copy,a.setDual=function(t,a){return t[4]=a[0],t[5]=a[1],t[6]=a[2],t[7]=a[3],t},a.getTranslation=function(t,a){var r=a[4],n=a[5],e=a[6],o=a[7],u=-a[0],s=-a[1],i=-a[2],c=a[3];return t[0]=2*(r*c+o*u+n*i-e*s),t[1]=2*(n*c+o*s+e*u-r*i),t[2]=2*(e*c+o*i+r*s-n*u),t},a.translate=function(t,a,r){var n=a[0],e=a[1],o=a[2],u=a[3],s=.5*r[0],i=.5*r[1],c=.5*r[2],h=a[4],f=a[5],l=a[6],M=a[7];return t[0]=n,t[1]=e,t[2]=o,t[3]=u,t[4]=u*s+e*c-o*i+h,t[5]=u*i+o*s-n*c+f,t[6]=u*c+n*i-e*s+l,t[7]=-n*s-e*i-o*c+M,t},a.rotateX=function(t,a,r){var n=-a[0],e=-a[1],o=-a[2],s=a[3],i=a[4],c=a[5],h=a[6],f=a[7],l=i*s+f*n+c*o-h*e,M=c*s+f*e+h*n-i*o,b=h*s+f*o+i*e-c*n,d=f*s-i*n-c*e-h*o;return u.rotateX(t,a,r),n=t[0],e=t[1],o=t[2],s=t[3],t[4]=l*s+d*n+M*o-b*e,t[5]=M*s+d*e+b*n-l*o,t[6]=b*s+d*o+l*e-M*n,t[7]=d*s-l*n-M*e-b*o,t},a.rotateY=function(t,a,r){var n=-a[0],e=-a[1],o=-a[2],s=a[3],i=a[4],c=a[5],h=a[6],f=a[7],l=i*s+f*n+c*o-h*e,M=c*s+f*e+h*n-i*o,b=h*s+f*o+i*e-c*n,d=f*s-i*n-c*e-h*o;return u.rotateY(t,a,r),n=t[0],e=t[1],o=t[2],s=t[3],t[4]=l*s+d*n+M*o-b*e,t[5]=M*s+d*e+b*n-l*o,t[6]=b*s+d*o+l*e-M*n,t[7]=d*s-l*n-M*e-b*o,t},a.rotateZ=function(t,a,r){var n=-a[0],e=-a[1],o=-a[2],s=a[3],i=a[4],c=a[5],h=a[6],f=a[7],l=i*s+f*n+c*o-h*e,M=c*s+f*e+h*n-i*o,b=h*s+f*o+i*e-c*n,d=f*s-i*n-c*e-h*o;return u.rotateZ(t,a,r),n=t[0],e=t[1],o=t[2],s=t[3],t[4]=l*s+d*n+M*o-b*e,t[5]=M*s+d*e+b*n-l*o,t[6]=b*s+d*o+l*e-M*n,t[7]=d*s-l*n-M*e-b*o,t},a.rotateByQuatAppend=function(t,a,r){var n=r[0],e=r[1],o=r[2],u=r[3],s=a[0],i=a[1],c=a[2],h=a[3];return t[0]=s*u+h*n+i*o-c*e,t[1]=i*u+h*e+c*n-s*o,t[2]=c*u+h*o+s*e-i*n,t[3]=h*u-s*n-i*e-c*o,s=a[4],i=a[5],c=a[6],h=a[7],t[4]=s*u+h*n+i*o-c*e,t[5]=i*u+h*e+c*n-s*o,t[6]=c*u+h*o+s*e-i*n,t[7]=h*u-s*n-i*e-c*o,t},a.rotateByQuatPrepend=function(t,a,r){var n=a[0],e=a[1],o=a[2],u=a[3],s=r[0],i=r[1],c=r[2],h=r[3];return t[0]=n*h+u*s+e*c-o*i,t[1]=e*h+u*i+o*s-n*c,t[2]=o*h+u*c+n*i-e*s,t[3]=u*h-n*s-e*i-o*c,s=r[4],i=r[5],c=r[6],h=r[7],t[4]=n*h+u*s+e*c-o*i,t[5]=e*h+u*i+o*s-n*c,t[6]=o*h+u*c+n*i-e*s,t[7]=u*h-n*s-e*i-o*c,t},a.rotateAroundAxis=function(t,a,r,n){if(Math.abs(n)<e.EPSILON)return h(t,a);var o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);n*=.5;var u=Math.sin(n),s=u*r[0]/o,i=u*r[1]/o,c=u*r[2]/o,f=Math.cos(n),l=a[0],M=a[1],b=a[2],d=a[3];t[0]=l*f+d*s+M*c-b*i,t[1]=M*f+d*i+b*s-l*c,t[2]=b*f+d*c+l*i-M*s,t[3]=d*f-l*s-M*i-b*c;var m=a[4],v=a[5],g=a[6],q=a[7];return t[4]=m*f+q*s+v*c-g*i,t[5]=v*f+q*i+g*s-m*c,t[6]=g*f+q*c+m*i-v*s,t[7]=q*f-m*s-v*i-g*c,t},a.add=function(t,a,r){return t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t[3]=a[3]+r[3],t[4]=a[4]+r[4],t[5]=a[5]+r[5],t[6]=a[6]+r[6],t[7]=a[7]+r[7],t},a.multiply=f,a.mul=f,a.scale=function(t,a,r){return t[0]=a[0]*r,t[1]=a[1]*r,t[2]=a[2]*r,t[3]=a[3]*r,t[4]=a[4]*r,t[5]=a[5]*r,t[6]=a[6]*r,t[7]=a[7]*r,t},a.dot=u.dot,a.lerp=function(t,r,n,e){var o=1-e;return a.dot(r,n)<0&&(e=-e),t[0]=r[0]*o+n[0]*e,t[1]=r[1]*o+n[1]*e,t[2]=r[2]*o+n[2]*e,t[3]=r[3]*o+n[3]*e,t[4]=r[4]*o+n[4]*e,t[5]=r[5]*o+n[5]*e,t[6]=r[6]*o+n[6]*e,t[7]=r[7]*o+n[7]*e,t},a.invert=function(t,r){var n=a.squaredLength(r);return t[0]=-r[0]/n,t[1]=-r[1]/n,t[2]=-r[2]/n,t[3]=r[3]/n,t[4]=-r[4]/n,t[5]=-r[5]/n,t[6]=-r[6]/n,t[7]=r[7]/n,t},a.conjugate=function(t,a){return t[0]=-a[0],t[1]=-a[1],t[2]=-a[2],t[3]=a[3],t[4]=-a[4],t[5]=-a[5],t[6]=-a[6],t[7]=a[7],t},a.length=u.length,a.len=a.length,a.squaredLength=u.squaredLength,a.sqrLen=a.squaredLength,a.normalize=function(t,r){var n=a.squaredLength(r);if(n>0){n=Math.sqrt(n);var e=r[0]/n,o=r[1]/n,u=r[2]/n,s=r[3]/n,i=r[4],c=r[5],h=r[6],f=r[7],l=e*i+o*c+u*h+s*f;t[0]=e,t[1]=o,t[2]=u,t[3]=s,t[4]=(i-e*l)/n,t[5]=(c-o*l)/n,t[6]=(h-u*l)/n,t[7]=(f-s*l)/n}return t},a.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},a.exactEquals=function(t,a){return t[0]===a[0]&&t[1]===a[1]&&t[2]===a[2]&&t[3]===a[3]&&t[4]===a[4]&&t[5]===a[5]&&t[6]===a[6]&&t[7]===a[7]},a.equals=function(t,a){var r=t[0],n=t[1],o=t[2],u=t[3],s=t[4],i=t[5],c=t[6],h=t[7],f=a[0],l=a[1],M=a[2],b=a[3],d=a[4],m=a[5],v=a[6],g=a[7];return Math.abs(r-f)<=e.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-l)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-M)<=e.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(u-b)<=e.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(s-d)<=e.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(i-m)<=e.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(c-v)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-g)<=e.EPSILON*Math.max(1,Math.abs(h),Math.abs(g))}}));