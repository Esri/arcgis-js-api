/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../arcade/featureset/support/errorsupport","../string","../../chunks/datetime"],(function(a,e,r,t){"use strict";let n=function(){function a(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}return a._fixDefaults=function(a){if(null!==a.precision||null!==a.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")},a._parseSecondsComponent=function(a,e){if(e.includes(".")){const r=e.split(".");a.second=parseFloat(r[0]),a.millis=parseInt(r[1],10)}else a.second=parseFloat(e)},a.createFromMilliseconds=function(e){const r=new a;return r.second=e/1e3,r},a.createFromValueAndQualifer=function(e,r,t){let n=null;const l=new a;if(l.op="-"===t?"-":"+","interval-period"===r.type){a._fixDefaults(r);const t=new RegExp("^[0-9]{1,}$");if("year"===r.period||"month"===r.period)throw new Error("Year-Month Intervals not supported");if("second"===r.period){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(e))throw new Error("Illegal Interval");a._parseSecondsComponent(l,e)}else{if(!t.test(e))throw new Error("Illegal Interval");l[r.period]=parseFloat(e)}}else{if(a._fixDefaults(r.start),a._fixDefaults(r.end),"year"===r.start.period||"month"===r.start.period)throw new Error("Year-Month Intervals not supported");if("year"===r.end.period||"month"===r.end.period)throw new Error("Year-Month Intervals not supported");switch(r.start.period){case"day":switch(r.end.period){case"hour":if(n=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!n.test(e))throw new Error("Illegal Interval");l[r.start.period]=parseFloat(e.split(" ")[0]),l[r.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!n.test(e))throw new Error("Illegal Interval");{l[r.start.period]=parseFloat(e.split(" ")[0]);const a=e.split(" ")[1].split(":");l.hour=parseFloat(a[0]),l.minute=parseFloat(a[1])}break;case"second":if(n=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new Error("Illegal Interval");{l[r.start.period]=parseFloat(e.split(" ")[0]);const t=e.split(" ")[1].split(":");l.hour=parseFloat(t[0]),l.minute=parseFloat(t[1]),a._parseSecondsComponent(l,t[2])}break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(r.end.period){case"minute":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!n.test(e))throw new Error("Illegal Interval");l.hour=parseFloat(e.split(":")[0]),l.minute=parseFloat(e.split(":")[1]);break;case"second":if(n=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new Error("Illegal Interval");{const r=e.split(":");l.hour=parseFloat(r[0]),l.minute=parseFloat(r[1]),a._parseSecondsComponent(l,r[2])}break;default:throw new Error("Invalid Interval.")}break;case"minute":if("second"!==r.end.period)throw new Error("Invalid Interval.");if(n=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!n.test(e))throw new Error("Illegal Interval");{const r=e.split(":");l.minute=parseFloat(r[0]),a._parseSecondsComponent(l,r[1])}break;default:throw new Error("Invalid Interval.")}}return l},a.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)},a}();function l(a,e){const r=c[a.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(e.length<r.minParams||e.length>r.maxParams)throw new Error(`Invalid Parameter count for call to ${a.toUpperCase()}`);return r.evaluate(e)}function s(a,e){const r=c[a.toLowerCase()];return null!=r&&e>=r.minParams&&e<=r.maxParams}function o(a){return"string"==typeof a||a instanceof String}function i(a){return a instanceof Date}function u(a){const e=new Date(a.getTime());return e.setHours(0,0,0,0),e}function m(a,r){if(i(a))return r?u(a):a;if(o(a)){const e=t.DateTime.fromSQL(a);if(e.isValid)return r?u(e.toJSDate()):e.toJSDate()}throw new e.SqlError(e.SqlErrorCodes.CannotCastValue)}const c={extract:{minParams:2,maxParams:2,evaluate:([a,e])=>{if(null==e)return null;if(e instanceof Date)switch(a.toUpperCase()){case"SECOND":return e.getSeconds();case"MINUTE":return e.getMinutes();case"HOUR":return e.getHours();case"DAY":return e.getDate();case"MONTH":return e.getMonth()+1;case"YEAR":return e.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:a=>{if(2===a.length){const[e,r]=a;return null==e||null==r?null:e.toString().substring(r-1)}if(3===a.length){const[e,r,t]=a;return null==e||null==r||null==t?null:t<=0?"":e.toString().substring(r-1,r+t-1)}}},position:{minParams:2,maxParams:2,evaluate:([a,e])=>null==a||null==e?null:e.indexOf(a)+1},trim:{minParams:2,maxParams:3,evaluate:a=>{const e=3===a.length,t=e?a[1]:" ",n=e?a[2]:a[1];if(null==t||null==n)return null;const l=`(${r.escapeRegExpString(t)})`;switch(a[0]){case"BOTH":return n.replace(new RegExp(`^${l}*|${l}*$`,"g"),"");case"LEADING":return n.replace(new RegExp(`^${l}*`,"g"),"");case"TRAILING":return n.replace(new RegExp(`${l}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.abs(a[0])},ceiling:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.ceil(a[0])},floor:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.floor(a[0])},log:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.log(a[0])},log10:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.log(a[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.sin(a[0])},cos:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.cos(a[0])},tan:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.tan(a[0])},asin:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.asin(a[0])},acos:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.acos(a[0])},atan:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.atan(a[0])},sign:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0]>0?1:a[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:a=>null==a[0]||null==a[1]?null:a[0]**a[1]},mod:{minParams:2,maxParams:2,evaluate:a=>null==a[0]||null==a[1]?null:a[0]%a[1]},round:{minParams:1,maxParams:2,evaluate:a=>{const e=a[0],r=2===a.length?10**a[1]:1;return null==e?null:Math.round(e*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:a=>null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))},char_length:{minParams:1,maxParams:1,evaluate:a=>"string"==typeof a[0]||a[0]instanceof String?a[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:a=>{let e="";for(let r=0;r<a.length;r++){if(null==a[r])return null;e+=a[r].toString()}return e}},lower:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:a=>{for(const e of a)if(null!==e)return e;return null}},cosh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.cosh(a[0])},sinh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.sinh(a[0])},tanh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.tanh(a[0])},nullif:{minParams:2,maxParams:2,evaluate:a=>{const e=a[0],r=a[1];return(e instanceof Date?e.valueOf():e)===(r instanceof Date?r.valueOf():r)?null:e}},cast:{minParams:2,maxParams:2,evaluate:a=>{const r=a[0],t=a[1];if(null===r)return null;switch(t.type){case"integer":{const a=parseInt(r,10);if(isNaN(a))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);return a}case"smallint":{const a=parseInt(r,10);if(isNaN(a))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);if(a>32767||a<-32767)throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);return a}case"float":case"real":{const a=parseFloat(r);if(isNaN(a))throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);return a}case"date":return m(r,!0);case"timestamp":return m(r,!1);case"varchar":{const a=r.toString();if(a.length>t.size)throw new e.SqlError(e.SqlErrorCodes.CannotCastValue);return a}default:throw new e.SqlError(e.SqlErrorCodes.InvalidDataType)}}}};a.SqlInterval=n,a.evaluateFunction=l,a.isStandardized=s,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})}));
