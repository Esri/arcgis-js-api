/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","./clock","./Error","./events","./Logger","./maybe"],(function(e,r,t,n,o,i){"use strict";function u(e){return Promise.all(e)}function c(e,r){const t=e.slice();return Promise.all(e.map(((e,t)=>r(e,t)))).then((e=>t.filter(((r,t)=>e[t]))))}function s(e){return new Promise(((r,t)=>{try{e(r,t)}catch(n){Promise.resolve().then((()=>t(n)))}}))}function l(e="Aborted"){return new t("AbortError",e)}function f(){return new AbortController}function a(e,r="Aborted"){if(m(e))throw l(r)}function h(e){return i.isSome(e)?"aborted"in e?e:e.signal:e}function m(e){const r=h(e);return i.isSome(r)&&r.aborted}function b(e){if(v(e))throw e}function w(e){if(!v(e))throw e}function p(e,r){const t=h(e);if(!i.isNone(t)){if(!t.aborted)return n.once(t,"abort",(()=>r()));r()}}function d(e,r){const t=h(e);if(!i.isNone(t))return a(t),n.once(t,"abort",(()=>r(l())))}function A(e,r){const t=h(r);return i.isNone(t)?e:new Promise(((t,n)=>{let o=p(r,(()=>n(l())));const u=()=>o=i.removeMaybe(o);e.then(u,u),e.then(t,n)}))}function v(e){return e&&"AbortError"===e.name}function P(e){return e.catch((e=>{if(!v(e))throw e}))}function y(e,r=o.getLogger("esri")){return e.catch((e=>{v(e)||r.error(e)}))}function E(){let e=null;const r=new Promise(((r,t)=>{e={promise:void 0,resolve:r,reject:t}}));return e.promise=r,e}function g(e){if(!e)return;if("function"!=typeof e.forEach){const r=Object.keys(e);return g(r.map((r=>e[r]))).then((e=>{const t={};return r.forEach(((r,n)=>t[r]=e[n])),t}))}const r=e;return s((e=>{const t=[];let n=r.length;0===n&&e(t),r.forEach((r=>{const o={promise:r||Promise.resolve(r)};t.push(o),o.promise.then((e=>{o.value=e})).catch((e=>{o.error=e})).then((()=>{--n,0===n&&e(t)}))}))}))}function j(e){return g(e).then((e=>e.filter((e=>!!e.value)).map((e=>e.value))))}function T(e){return Promise.reject(e)}function N(e){return Promise.resolve(e)}function O(e,r,t){const n=f();return p(t,(()=>n.abort())),new Promise(((t,o)=>{let i=setTimeout((()=>{i=0,t(r)}),e);p(n,(()=>{i&&(clearTimeout(i),o(l()))}))}))}function k(e,r,n,o){const i=n&&"abort"in n?n:null;null!=o||i||(o=n);let u=setTimeout((()=>{u=0,i&&i.abort()}),r);const c=()=>{throw o||new t("promiseUtils:timeout","The wrapped promise did not resolve within "+r+" ms")};return e.then((e=>{if(0===u)throw c();return clearTimeout(u),e}),(e=>{throw clearTimeout(u),0===u?c():e}))}function I(e){return e&&"function"==typeof e.then}function L(e){return C(e)?e:Promise.resolve(e)}function C(e){return e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}function M(e,r=-1){let t,n,o,u,c=null;const s=(...a)=>{if(t){n=a,u&&u.reject(l()),u=E();const e=i.assumeNonNull(u.promise);if(c){const e=c;c=null,e.abort()}return e}if(o=u||E(),u=null,r>0){const n=f();t=L(e(...a,n.signal));const o=t;O(r).then((()=>{t===o&&(u?n.abort():c=n)}))}else t=1,t=L(e(...a));const h=()=>{const e=n;n=o=t=c=null,null!=e&&s(...e)},m=t,b=o;return m.then(h,h),m.then(b.resolve,b.reject),i.assumeNonNull(b.promise)};return s}function S(){let e,t;const n=new Promise(((r,n)=>{e=r,t=n})),o=r=>{e(r)};return o.resolve=r=>e(r),o.reject=e=>t(e),o.timeout=(e,t)=>r.default.setTimeout((()=>o.reject(t)),e),o.promise=n,o}function _(e,r){return e.then(r,r)}function x(e){let r=f();const t=e(r.signal);let n={promise:t,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const o=()=>{n&&(n.finished=!0,n=null),r=null};return t.then(o,o),n}e.after=O,e.all=u,e.always=_,e.create=s,e.createAbortController=f,e.createAbortError=l,e.createDeferred=E,e.createResolver=S,e.createTask=x,e.debounce=M,e.eachAlways=g,e.eachAlwaysValues=j,e.filter=c,e.ignoreAbortErrors=P,e.isAbortError=v,e.isAborted=m,e.isPromise=C,e.isPromiseLike=I,e.logOnError=y,e.onAbort=p,e.onAbortOrThrow=d,e.reject=T,e.resolve=N,e.throwIfAbortError=b,e.throwIfAborted=a,e.throwIfNotAbortError=w,e.timeout=k,e.when=L,e.whenOrAbort=A,Object.defineProperty(e,"__esModule",{value:!0})}));
