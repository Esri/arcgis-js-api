/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","./maybe","./nextTick","./PerformanceSampler","./PooledArray","./promiseUtils","./time"],(function(e,n,t,r,o,s,i){"use strict";let a=function(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1},c=function(){function e(e){this.callback=e,this.isActive=!0}return e.prototype.remove=function(){this.isActive=!1},e}(),l=0,u=0;const m={time:i.Milliseconds(0),deltaTime:i.Milliseconds(0),elapsedFrameTime:i.Milliseconds(0),frameDuration:i.Milliseconds(0)},f=["prepare","preRender","render","postRender","update","finish"],p=[],d=new o;let h=function(){function e(e){this._task=e}var n=e.prototype;return n.remove=function(){this._task.removed=!0},n.pause=function(){this._task.paused=!0},n.resume=function(){this._task.paused=!1},e}();const k={frameTasks:d,willDispatch:!1,clearFrameTasks:A,dispatch:y,executeFrameTasks:b};function w(e){const n=new c(e);return p.push(n),k.willDispatch||(k.willDispatch=!0,t.nextTick(y)),n}function v(e){const n=new a(e);return d.push(n),null==T&&(l=performance.now(),T=requestAnimationFrame(F)),new h(n)}let T=null;function A(e=!1){d.forAll((e=>{e.removed=!0})),e&&g()}function M(e){u=Math.max(0,e)}function F(){const e=performance.now();T=null,T=d.length>0?requestAnimationFrame(F):null,k.executeFrameTasks(e)}function b(e){const n=i.Milliseconds(e-l);l=e;const t=u>0?u:1e3/60,r=Math.max(0,n-t);m.time=e,m.frameDuration=i.Milliseconds(t-r);for(let o=0;o<f.length;o++){const t=performance.now(),r=f[o];d.forAll((t=>{if(t.paused||t.removed)return;0===o&&t.ticks++;t.phases[r]&&(m.elapsedFrameTime=i.Milliseconds(performance.now()-e),m.deltaTime=0===t.ticks?i.Milliseconds(0):n,t.phases[r]?.call(t,m))})),_[o].record(performance.now()-t)}g(),P.record(performance.now()-e)}const x=new o;function g(){d.forAll((e=>{e.removed&&x.push(e)})),d.removeUnorderedMany(x.data,x.length),x.clear()}function y(){for(;p.length;){const e=n.assumeNonNull(p.shift());e.isActive&&e.callback()}k.willDispatch=!1}function D(e=1,n){const r=s.createResolver(),o=()=>{s.isAborted(n)?r.reject(s.createAbortError()):0===e?r():(--e,t.nextTick((()=>o())))};return o(),r.promise}function R(){const e=s.createResolver(),n=v({postRender:()=>{n.remove(),w(e)}});return e.promise}const _=f.map((e=>new r(e))),P=new r("total");e.FrameTaskHandle=h,e.addFrameTask=v,e.debug=k,e.performanceInfo=_,e.performanceTotal=P,e.schedule=w,e.setFrameDuration=M,e.waitAnimationFrame=R,e.waitTicks=D,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
