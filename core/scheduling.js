/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","./maybe","./nextTick","./PerformanceSampler","./PooledArray","./promiseUtils"],(function(e,t,n,r,o,a){"use strict";let s=function(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1},i=function(){function e(e){this.callback=e,this.isActive=!0}return e.prototype.remove=function(){this.isActive=!1},e}(),c=0,l=0;const u={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},m=["prepare","preRender","render","postRender","update"],f=[],p=new o;let d=function(){function e(e){this._task=e}var t=e.prototype;return t.remove=function(){this._task.removed=!0},t.pause=function(){this._task.paused=!0},t.resume=function(){this._task.paused=!1},e}();const h={frameTasks:p,willDispatch:!1,clearFrameTasks:T,dispatch:y,executeFrameTasks:b};function w(e){const t=new i(e);return f.push(t),h.willDispatch||(h.willDispatch=!0,n(y)),t}function k(e){const t=new s(e);return p.push(t),null==v&&(c=performance.now(),v=requestAnimationFrame(F)),new d(t)}let v=null;function T(e=!1){p.forAll((e=>{e.removed=!0})),e&&x()}function A(e){l=Math.max(0,e)}function F(){const e=performance.now();v=null,v=p.length>0?requestAnimationFrame(F):null,h.executeFrameTasks(e)}function b(e){const t=e-c;c=e;const n=l>0?l:1e3/60,r=Math.max(0,t-n);for(let o=0;o<m.length;o++){const a=performance.now(),s=m[o];p.forAll((a=>{var i;if(a.paused||a.removed)return;0===o&&a.ticks++;a.phases[s]&&(u.time=e,u.deltaTime=0===a.ticks?0:t,u.elapsedFrameTime=performance.now()-e,u.frameDuration=n-r,null==(i=a.phases[s])||i.call(a,u))})),g[o].record(performance.now()-a)}x(),M.record(performance.now()-e)}const D=new o;function x(){p.forAll((e=>{e.removed&&D.push(e)})),p.removeUnorderedMany(D.data,D.length),D.clear()}function y(){for(;f.length;){const e=t.assumeNonNull(f.shift());e.isActive&&e.callback()}h.willDispatch=!1}function _(e=1,t){const r=a.createResolver(),o=()=>{a.isAborted(t)?r.reject(a.createAbortError()):0===e?r():(--e,n((()=>o())))};return o(),r.promise}const g=m.map((e=>new r(e))),M=new r("total");e.FrameTaskHandle=d,e.addFrameTask=k,e.debug=h,e.performanceInfo=g,e.performanceTotal=M,e.schedule=w,e.setFrameDuration=A,e.waitTicks=_,Object.defineProperty(e,"__esModule",{value:!0})}));
