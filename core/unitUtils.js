/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","./has","./jsonMap","../geometry/support/WKIDUnitConversion","../geometry/support/spatialReferenceUtils","../geometry/SpatialReference","../geometry/support/Ellipsoid","../geometry/projectionEllipsoid"],(function(e,t,s,r,n,i,a,c){"use strict";const u=a.earth.radius*Math.PI/200,o=/UNIT\[([^\]]+)\]\]$/i,l=r,f=/UNIT\[([^\]]+)\]/i,m=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),U=s.strict()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),d=e=>e*e,p=e=>e*e*e,h={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:d(.001)},"square-centimeters":{inBaseUnits:d(.01)},"square-decimeters":{inBaseUnits:d(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:d(1e3)},"square-inches":{inBaseUnits:d(.0254)},"square-feet":{inBaseUnits:d(.3048)},"square-yards":{inBaseUnits:d(.9144)},"square-miles":{inBaseUnits:d(1609.344)},"square-us-feet":{inBaseUnits:d(1200/3937)},acres:{inBaseUnits:.0015625*d(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*p(.001)},"cubic-centimeters":{inBaseUnits:1e3*p(.01)},"cubic-decimeters":{inBaseUnits:1e3*p(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*p(1e3)},"cubic-inches":{inBaseUnits:1e3*p(.0254)},"cubic-feet":{inBaseUnits:1e3*p(.3048)},"cubic-yards":{inBaseUnits:1e3*p(.9144)},"cubic-miles":{inBaseUnits:1e3*p(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},B=function(){const e={};for(const t in h)for(const s in h[t].units)e[s]=t;return e}();function g(e){const t=B[e];if(t)return t;throw new Error("unknown measure")}function y(e){return h[e].baseUnit}function k(e,t=null){return t=t||g(e),h[t].baseUnit===e}function b(e,t,s){if(t===s)return e;const r=g(t);if(r!==g(s))throw new Error("incompatible units");const n=k(t,r)?e:function(e,t,s){return e*h[s].units[t].inBaseUnits}(e,t,r);return k(s,r)?n:function(e,t,s){return e/h[s].units[t].inBaseUnits}(n,s,r)}function q(e,t){return b(e,t,"meters")<3e3?"meters":"kilometers"}function _(e,t){return b(e,t,"meters")<1e5?"meters":"kilometers"}function S(e,t){return b(e,t,"feet")<1e3?"feet":"miles"}function M(e,t){return b(e,t,"feet")<1e5?"feet":"miles"}function w(e){return U.fromJSON(e.toLowerCase())||null}function P(e,t=a.earth.metersPerDegree){return F(e,!0)||t}function F(e,t=!1){let s,r,i=null;if(null!=e&&("object"==typeof e?(s=e.wkid,r=e.wkt):"number"==typeof e?s=e:"string"==typeof e&&(r=e)),s){if(n.isWKIDFromMars(s))return a.mars.metersPerDegree;if(n.isWKIDFromMoon(s))return a.moon.metersPerDegree;i=l.values[l[s]],!i&&t&&m.has(s)&&(i=u)}else if(r)if(-1!==r.search(/^PROJCS/i)){const e=o.exec(r);e&&e[1]&&(i=parseFloat(e[1].split(",")[1]))}else if(-1!==r.search(/^GEOCCS/i)){const e=f.exec(r);e&&e[1]&&(i=parseFloat(e[1].split(",")[1]))}return i}function I(e){let t,s,r=null;if(null!=e&&("object"==typeof e?(t=e.wkid,s=e.wkt):"number"==typeof e?t=e:"string"==typeof e&&(s=e)),t)r=l.units[l[t]];else if(s&&-1!==s.search(/^PROJCS/i)){let e=o.exec(s);e&&e[1]&&(e=/[\\"\\']{1}([^\\"\\']+)/.exec(e[1]),r=e&&e[1])}return r?w(r):null}e.baseUnitForMeasure=y,e.baseUnitForUnit=function(e){return y(g(e))},e.convertUnit=b,e.getDefaultUnitSystem=function(e){if(!e)return null;switch(I(e)){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric";case null:case void 0:return null}return null},e.getMetersPerUnit=F,e.getMetersPerUnitForSR=P,e.getMetersPerVerticalUnitForSR=function(e){if(e&&"object"==typeof e&&!n.isEarth(e))return 1;const t=P(e);return t>1e5?1:t},e.getUnitString=I,e.getVerticalUnitStringForSR=function(e){return P(e)>=(e instanceof i?c.getReferenceEllipsoid(e).metersPerDegree:1e5)?"meters":I(e)},e.inchesPerMeter=39.37,e.isBaseUnit=k,e.isMeasurementSystem=function(e){return"imperial"===e||"metric"===e},e.lengthToDegrees=function(e,t,s){return b(e,t,"meters")/(s*Math.PI/180)},e.measureForUnit=g,e.measurementAreaUnits=["metric","imperial","square-inches","square-feet","square-yards","square-miles","square-us-feet","square-meters","square-kilometers","acres","ares","hectares"],e.measurementLengthUnits=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],e.preferredImperialAreaUnit=function(e,t){return b(e,t,"square-feet")<1e6?"square-feet":"square-miles"},e.preferredImperialLengthUnit=S,e.preferredImperialVerticalLengthUnit=M,e.preferredLengthUnit=function(e,t,s){switch(s){case"metric":return q(e,t);case"imperial":return S(e,t);default:return s}},e.preferredMetricAreaUnit=function(e,t){return b(e,t,"square-meters")<3e6?"square-meters":"square-kilometers"},e.preferredMetricLengthUnit=q,e.preferredMetricVerticalLengthUnit=_,e.preferredVerticalLengthUnit=function(e,t,s){switch(s){case"metric":return _(e,t);case"imperial":return M(e,t);default:return s}},e.unitFromRESTJSON=w,e.unitToRESTJSON=function(e){return U.toJSON(e)||null},Object.defineProperty(e,"__esModule",{value:!0})}));
