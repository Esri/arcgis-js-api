// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","./compilerUtils","./jsonMap","./SetUtils","../geometry/support/geodesicConstants","../geometry/support/WKIDUnitConversion"],(function(e,t,r,i,n,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultUnitSystem=t.getUnitString=t.getMetersPerUnit=t.getMetersPerUnitForSR=t.getVerticalUnitStringForSR=t.getMetersPerVerticalUnitForSR=t.unitToRESTJSON=t.unitFromRESTJSON=t.lengthToDegrees=t.preferredImperialAreaUnit=t.preferredMetricAreaUnit=t.preferredImperialVerticalLengthUnit=t.preferredImperialLengthUnit=t.preferredMetricVerticalLengthUnit=t.preferredMetricLengthUnit=t.preferredVerticalLengthUnit=t.preferredLengthUnit=t.convertUnit=t.isBaseUnit=t.baseUnitForUnit=t.baseUnitForMeasure=t.measureForUnit=t.measurementLengthUnits=t.measurementAreaUnits=t.inchesPerMeter=void 0,t.inchesPerMeter=39.37;var u=s.metersPerDegree,c=s.earthRadius*Math.PI/200,o=/UNIT\[([^\]]+)\]\]$/i,l=a,f=n.SetFromValues([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),m=i.strict()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),U=function(e){return e*e},d=function(e){return e*e*e},h={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:U(.001)},"square-centimeters":{inBaseUnits:U(.01)},"square-decimeters":{inBaseUnits:U(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:U(1e3)},"square-inches":{inBaseUnits:U(.0254)},"square-feet":{inBaseUnits:U(.3048)},"square-yards":{inBaseUnits:U(.9144)},"square-miles":{inBaseUnits:U(1609.344)},"square-us-feet":{inBaseUnits:U(1200/3937)},acres:{inBaseUnits:.0015625*U(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*d(.001)},"cubic-centimeters":{inBaseUnits:1e3*d(.01)},"cubic-decimeters":{inBaseUnits:1e3*d(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*d(1e3)},"cubic-inches":{inBaseUnits:1e3*d(.0254)},"cubic-feet":{inBaseUnits:1e3*d(.3048)},"cubic-yards":{inBaseUnits:1e3*d(.9144)},"cubic-miles":{inBaseUnits:1e3*d(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},g=function(){var e={};for(var t in h)for(var r in h[t].units)e[r]=t;return e}();function p(e){var t=g[e];if(t)return t;throw new Error("unknown measure")}function B(e){return h[e].baseUnit}function b(e,t){return void 0===t&&(t=null),t=t||p(e),h[t].baseUnit===e}function k(e,t,r){if(t===r)return e;var i=p(t);if(i!==p(r))throw new Error("incompatible units");var n=b(t,i)?e:function(e,t,r){return e*h[r].units[t].inBaseUnits}(e,t,i);return b(r,i)?n:function(e,t,r){return e/h[r].units[t].inBaseUnits}(n,r,i)}function y(e,t){return k(e,t,"meters")<3e3?"meters":"kilometers"}function v(e,t){return k(e,t,"meters")<1e5?"meters":"kilometers"}function S(e,t){return k(e,t,"feet")<1e3?"feet":"miles"}function q(e,t){return k(e,t,"feet")<1e5?"feet":"miles"}function _(e){return m.fromJSON(e.toLowerCase())||null}function M(e,t){return void 0===t&&(t=u),F(e,!0)||t}function F(e,t){var r,i,n;if(void 0===t&&(t=!1),null!=e&&("object"==typeof e?(r=e.wkid,i=e.wkt):"number"==typeof e?r=e:"string"==typeof e&&(i=e)),r)!(n=l.values[l[r]])&&t&&f.has(r)&&(n=c);else if(i&&-1!==i.search(/^PROJCS/i)){var s=o.exec(i);s&&s[1]&&(n=parseFloat(s[1].split(",")[1]))}return n}function L(e){var t,r,i;if(null!=e&&("object"==typeof e?(t=e.wkid,r=e.wkt):"number"==typeof e?t=e:"string"==typeof e&&(r=e)),t)i=l.units[l[t]];else if(r&&-1!==r.search(/^PROJCS/i)){var n=o.exec(r);n&&n[1]&&(i=(n=/[\\"\\']{1}([^\\"\\']+)/.exec(n[1]))&&n[1])}return i?_(i):null}t.measurementAreaUnits=["metric","imperial","square-inches","square-feet","square-yards","square-miles","square-us-feet","square-meters","square-kilometers","acres","ares","hectares"],t.measurementLengthUnits=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],t.measureForUnit=p,t.baseUnitForMeasure=B,t.baseUnitForUnit=function(e){return B(p(e))},t.isBaseUnit=b,t.convertUnit=k,t.preferredLengthUnit=function(e,t,r){switch(r){case"metric":return y(e,t);case"imperial":return S(e,t);default:return r}},t.preferredVerticalLengthUnit=function(e,t,r){switch(r){case"metric":return v(e,t);case"imperial":return q(e,t);default:return r}},t.preferredMetricLengthUnit=y,t.preferredMetricVerticalLengthUnit=v,t.preferredImperialLengthUnit=S,t.preferredImperialVerticalLengthUnit=q,t.preferredMetricAreaUnit=function(e,t){return k(e,t,"square-meters")<3e6?"square-meters":"square-kilometers"},t.preferredImperialAreaUnit=function(e,t){return k(e,t,"square-feet")<1e6?"square-feet":"square-miles"},t.lengthToDegrees=function(e,t,r){return void 0===r&&(r=s.earthRadius),k(e,t,"meters")/(r*Math.PI/180)},t.unitFromRESTJSON=_,t.unitToRESTJSON=function(e){return m.toJSON(e)||null},t.getMetersPerVerticalUnitForSR=function(e){var t=M(e);return t>1e5?1:t},t.getVerticalUnitStringForSR=function(e){return M(e)>1e5?"meters":L(e)},t.getMetersPerUnitForSR=M,t.getMetersPerUnit=F,t.getUnitString=L,t.getDefaultUnitSystem=function(e){if(!e)return null;var t=L(e);switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric";case null:case void 0:return null;default:r.neverReached(t)}return null}}));