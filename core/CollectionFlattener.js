/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","./accessorSupport/decorators/property","./accessorSupport/decorators/subclass","./Collection","./Handles"],(function(t,e,o,i,s,r){"use strict";let n=function(e){function o(t){var o;return(o=e.call(this,t)||this)._handles=new r,o.root=null,o}t._inheritsLoose(o,e);var i=o.prototype;return i.initialize=function(){this._handles.add(this.rootCollectionNames.map((t=>this.watch("root."+t,(()=>this.updateCollections()),!0)))),this.updateCollections()},i.destroy=function(){this.root=null,this.refresh(),this._handles.destroy(),this._handles=null},i.updateCollections=function(){this._collections=this.rootCollectionNames.map((t=>this.get("root."+t))).filter((t=>null!=t)),this.refresh()},i.refresh=function(){const t=this._handles;t.remove("collections");const e=new Array;let o=0;for(const t of this._collections)o=this._processCollection(e,o,t);this.splice(o,this.length);for(const o of e)t.add(o.on("after-changes",(()=>this.refresh())),"collections")},i._createNewInstance=function(t){return new s(t)},i._processCollection=function(t,e,o){return o?(t.push(o),o.forEach((o=>{if(o){if(!this.itemFilterFunction||this.itemFilterFunction(o)){const t=this.indexOf(o,e);t>=0?t!==e&&this.reorder(o,e):this.add(o,e),++e}this.getChildrenFunction&&(e=this._processCollection(t,e,this.getChildrenFunction(o)))}})),e):e},o}(s);return e.__decorate([o.property()],n.prototype,"rootCollectionNames",void 0),e.__decorate([o.property()],n.prototype,"root",void 0),e.__decorate([o.property()],n.prototype,"getChildrenFunction",void 0),e.__decorate([o.property()],n.prototype,"itemFilterFunction",void 0),n=e.__decorate([i.subclass("esri.core.CollectionFlattener")],n),n}));
