/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","./Collection","./HandleOwner","./maybe","./accessorSupport/decorators/property","./has","./accessorSupport/ensureType","./Logger","./accessorSupport/decorators/subclass","./accessorSupport/trackingUtils"],(function(t,e,o,i,r,n,s,c,l,u,p){"use strict";let a=function(e){function i(t){var o;return(o=e.call(this,t)||this).getCollections=null,o}t._inheritsLoose(i,e);var n=i.prototype;return n.initialize=function(){this.handles.add(p.autorun((()=>this.refresh())))},n.destroy=function(){this.getCollections=null},n.refresh=function(){const t=r.isSome(this.getCollections)?this.getCollections():null;if(r.isNone(t))return void this.removeAll();let e=0;for(const o of t)r.isSome(o)&&(e=this._processCollection(e,o));this.splice(e,this.length)},n._createNewInstance=function(t){return new o(t)},n._processCollection=function(t,e){if(!e)return t;const o=this.itemFilterFunction?this.itemFilterFunction:t=>!!t;for(const i of e)if(i){if(o(i)){const e=this.indexOf(i,t);e>=0?e!==t&&this.reorder(i,t):this.add(i,t),++t}if(this.getChildrenFunction){const e=this.getChildrenFunction(i);if(Array.isArray(e))for(const o of e)t=this._processCollection(t,o);else t=this._processCollection(t,e)}}return t},i}(i.HandleOwnerMixin(o));return e.__decorate([n.property()],a.prototype,"getCollections",void 0),e.__decorate([n.property()],a.prototype,"getChildrenFunction",void 0),e.__decorate([n.property()],a.prototype,"itemFilterFunction",void 0),a=e.__decorate([u.subclass("esri.core.CollectionFlattener")],a),a}));
