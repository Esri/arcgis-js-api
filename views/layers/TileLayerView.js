/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Error","../../core/maybe","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../renderers/support/clickToleranceUtils"],(function(e,r,t,o,a,s,n,c,i,u,l,p){"use strict";const y=e=>{let c=function(e){function t(){return e.apply(this,arguments)||this}return r._inheritsLoose(t,e),t.prototype.fetchPopupFeatures=function(){var e=r._asyncToGenerator((function*(e,t){var n=this;const{layer:c}=this;if(!e)return Promise.reject(new o("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:c}));if("tile"!==c.type)return Promise.reject(new o("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:c.type}));const i=this.get("view.scale"),u=c.allSublayers.toArray().filter((e=>{const r=0===e.minScale||i<=e.minScale,t=0===e.maxScale||i>=e.maxScale;return e.popupTemplate&&e.popupEnabled&&e.visible&&r&&t}));return s.eachAlways(u.map(function(){var o=r._asyncToGenerator((function*(r){const o=r.createQuery(),s=a.isSome(t)?t.event:null,c=p.calculateTolerance({renderer:r.renderer,event:s});o.geometry=n.createFetchPopupFeaturesQueryGeometry(e,c),o.outFields=yield r.popupTemplate.getRequiredFields();return(yield r.queryFeatures(o)).features}));return function(e){return o.apply(this,arguments)}}())).then((e=>[].concat(...e.map((e=>e.value)).filter(Boolean))))}));function t(r,t){return e.apply(this,arguments)}return t}(),t}(e);return t.__decorate([n.property()],c.prototype,"layer",void 0),c=t.__decorate([l.subclass("esri.layers.mixins.TileLayerView")],c),c};e.TileLayerView=y,e.default=y,Object.defineProperty(e,"__esModule",{value:!0})}));
