/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Collection","../../core/collectionUtils","../../core/maybe","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","./LayerView"],(function(i,e,s,r,t,l,a,y,n,o,h){"use strict";let c=function(e){function a(i){var r;return(r=e.call(this,i)||this).type="group",r.layerViews=new s,r}i._inheritsLoose(a,e);var y=a.prototype;return y._allLayerViewVisibility=function(i){this.layerViews.forEach((e=>{e.visible=i}))},y.initialize=function(){this.handles.add([this.layerViews.on("change",(i=>this._layerViewsChangeHandler(i))),l.watch((()=>this.layer.visibilityMode),(()=>this._applyVisibility((()=>this._allLayerViewVisibility(this.visible)),(()=>this._applyExclusiveVisibility(null)))),l.sync),l.watch((()=>this.visible),(i=>{this._applyVisibility((()=>this._allLayerViewVisibility(i)),(()=>{}))}),l.sync)],"grouplayerview"),this._layerViewsChangeHandler({target:null,added:this.layerViews.toArray(),removed:[],moved:[]})},y.isUpdating=function(){return this.layerViews.some((i=>i.updating))},y._hasLayerViewVisibleOverrides=function(){return this.layerViews.some((i=>i._isOverridden("visible")))},y._findLayerViewForLayer=function(i){return i&&this.layerViews.find((e=>e.layer===i))},y._firstVisibleOnLayerOrder=function(){const i=this.layer.layers.find((i=>this._findLayerViewForLayer(i)?.visible));return i&&this._findLayerViewForLayer(i)},y._applyExclusiveVisibility=function(i){t.isNone(i)&&(i=this._firstVisibleOnLayerOrder(),t.isNone(i)&&this.layerViews.length>0&&(i=this._findLayerViewForLayer(this.layer.layers.getItemAt(0)))),this.layerViews.forEach((e=>{e.visible=e===i}))},y._layerViewsChangeHandler=function(i){this.handles.remove("grouplayerview:visible"),this.handles.add(this.layerViews.map((i=>l.watch((()=>i.visible),(e=>this._applyVisibility((()=>{e!==this.visible&&(i.visible=this.visible)}),(()=>this._applyExclusiveVisibility(e?i:null)))),l.sync))).toArray(),"grouplayerview:visible");const e=i.added[i.added.length-1];this._applyVisibility((()=>this._allLayerViewVisibility(this.visible)),(()=>this._applyExclusiveVisibility(e?.visible?e:null)))},y._applyVisibility=function(i,e){this._hasLayerViewVisibleOverrides()&&("inherited"===this.layer?.visibilityMode?i():"exclusive"===this.layer?.visibilityMode&&e())},i._createClass(a,[{key:"layerViews",set:function(i){this._set("layerViews",r.referenceSetter(i,this._get("layerViews")))}},{key:"updatingProgress",get:function(){return 0===this.layerViews.length?1:this.layerViews.reduce(((i,e)=>i+e.updatingProgress),0)/this.layerViews.length}}]),a}(h);e.__decorate([a.property({cast:r.castForReferenceSetter})],c.prototype,"layerViews",null),e.__decorate([a.property({readOnly:!0})],c.prototype,"updatingProgress",null),e.__decorate([a.property()],c.prototype,"view",void 0),c=e.__decorate([o.subclass("esri.views.layers.GroupLayerView")],c);return c}));
