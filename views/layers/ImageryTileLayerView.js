/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Graphic","../../core/Error","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../../layers/support/commonProperties","../../layers/support/rasterFunctions/rasterProjectionHelper","./support/popupUtils"],(function(e,t,r,n,o,a,i,s,l,u,p,c){"use strict";const y=i=>{let s=function(t){function a(){var e;return(e=t.apply(this,arguments)||this)._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.tileInfo=null,e}e._inheritsLoose(a,t);var i=a.prototype;return i._getfullExtent=function(){return this.projectFullExtent(this.view.spatialReference)},i.supportsSpatialReference=function(e){return!!this.projectFullExtent(e)},i.projectFullExtent=function(e){const t=o.unwrap(this.layer.fullExtent),r=p.getDefaultDatumTransformationForDataset(t,e,!1);return p.projectExtent(t,e,r)},i.fetchPopupFeatures=function(){var t=e._asyncToGenerator((function*(e,t){const{layer:a}=this;if(!e)throw new n("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:a});const{popupEnabled:i}=a,s=c.getFetchPopupTemplate(a,t);if(!i||o.isNone(s))throw new n("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:i,popupTemplate:s});const l=[],{value:u,magdirValue:p}=yield a.identify(e,{timeExtent:this.timeExtent});let y="";if(u&&u.length){y="imagery-tile"===a.type&&a.hasStandardTime()&&null!=u[0]?u.map((e=>a.getStandardTimeValue(e))).join(", "):u.join(", ");const e={ObjectId:0};e["Raster.ServicePixelValue"]=y;const t=a.rasterInfo.attributeTable;if(o.isSome(t)){const{fields:r,features:n}=t,o=r.find((({name:e})=>"value"===e.toLowerCase())),a=o?n.find((e=>String(e.attributes[o.name])===y)):null;if(a)for(const t in a.attributes)if(a.attributes.hasOwnProperty(t)){e[this._rasterFieldPrefix+t]=a.attributes[t]}}const n=a.rasterInfo.dataType;"vector-magdir"!==n&&"vector-uv"!==n||(e["Raster.Magnitude"]=p?.[0],e["Raster.Direction"]=p?.[1]);const i=new r(this.fullExtent.clone(),null,e);i.layer=a,i.sourceLayer=i.layer,l.push(i)}return l}));function a(e,r){return t.apply(this,arguments)}return a}(),e._createClass(a,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"datumTransformation",get:function(){return p.getDefaultDatumTransformationForDataset(o.unwrap(this.layer.fullExtent),this.view.spatialReference,!0)}}]),a}(i);return t.__decorate([a.property()],s.prototype,"layer",void 0),t.__decorate([a.property(u.combinedViewLayerTimeExtentProperty)],s.prototype,"timeExtent",void 0),t.__decorate([a.property()],s.prototype,"view",void 0),t.__decorate([a.property()],s.prototype,"fullExtent",null),t.__decorate([a.property()],s.prototype,"tileInfo",void 0),t.__decorate([a.property({readOnly:!0})],s.prototype,"hasTilingEffects",null),s=t.__decorate([l.subclass("esri.views.layers.ImageryTileLayerView")],s),s};return y}));
