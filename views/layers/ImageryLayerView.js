/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Error","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../geometry/Point","../../layers/support/commonProperties","../../rest/support/Query","./support/popupUtils"],(function(e,t,r,o,s,p,i,a,n,u,c,l,y,d){"use strict";const h=e=>{let i=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).view=null,t}t._inheritsLoose(r,e);var p=r.prototype;return p.fetchPopupFeatures=function(){var e=t._asyncToGenerator((function*(e,t){const{layer:r}=this;if(!e)throw new o("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:r});const{popupEnabled:p}=r,i=d.getFetchPopupTemplate(r,t);if(!p||!s.isSome(i))throw new o("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:p,popupTemplate:i});const a=yield i.getRequiredFields(),n=new y;n.timeExtent=this.timeExtent,n.geometry=e,n.outFields=a,n.outSpatialReference=e.spatialReference;const u=this.view.resolution,l="2d"===this.view.type?new c(u,u,this.view.spatialReference):new c(.5*u,.5*u,this.view.spatialReference),{returnTopmostRaster:h,showNoDataRecords:m}=i.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},w={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:l,showNoDataRecords:m,signal:s.isSome(t)?t.signal:null};return r.queryVisibleRasters(n,w).then((e=>e))}));function r(t,r){return e.apply(this,arguments)}return r}(),p.canResume=function(){var t;return!!e.prototype.canResume.call(this)&&(null==(t=this.timeExtent)||!t.isEmpty)},r}(e);return r.__decorate([p.property()],i.prototype,"layer",void 0),r.__decorate([p.property()],i.prototype,"suspended",void 0),r.__decorate([p.property(l.combinedViewLayerTimeExtentProperty)],i.prototype,"timeExtent",void 0),r.__decorate([p.property()],i.prototype,"view",void 0),i=r.__decorate([u.subclass("esri.views.layers.ImageryLayerView")],i),i};e.ImageryLayerView=h,e.default=h,Object.defineProperty(e,"__esModule",{value:!0})}));
