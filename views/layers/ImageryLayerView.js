/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Error","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../../geometry/Point","../../layers/support/commonProperties","../../rest/support/Query","./support/popupUtils"],(function(e,t,r,o,s,p,i,n,a,u,c,l){"use strict";const y=p=>{let i=function(t){function s(){var e;return(e=t.apply(this,arguments)||this).view=null,e}e._inheritsLoose(s,t);var p=s.prototype;return p.fetchPopupFeatures=function(){var t=e._asyncToGenerator((function*(e,t){const{layer:s}=this;if(!e)throw new r("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:s});const{popupEnabled:p}=s,i=l.getFetchPopupTemplate(s,t);if(!p||o.isNone(i))throw new r("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:p,popupTemplate:i});const n=yield i.getRequiredFields(),u=new c;u.timeExtent=this.timeExtent,u.geometry=e,u.outFields=n,u.outSpatialReference=e.spatialReference;const y=this.view.resolution,d="2d"===this.view.type?new a(y,y,this.view.spatialReference):new a(.5*y,.5*y,this.view.spatialReference),{returnTopmostRaster:h,showNoDataRecords:m}=i.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},w={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:d,showNoDataRecords:m,signal:o.isSome(t)?t.signal:null};return s.queryVisibleRasters(u,w).then((e=>e))}));function s(e,r){return t.apply(this,arguments)}return s}(),p.canResume=function(){return!!t.prototype.canResume.call(this)&&!this.timeExtent?.isEmpty},s}(p);return t.__decorate([s.property()],i.prototype,"layer",void 0),t.__decorate([s.property()],i.prototype,"suspended",void 0),t.__decorate([s.property(u.combinedViewLayerTimeExtentProperty)],i.prototype,"timeExtent",void 0),t.__decorate([s.property()],i.prototype,"view",void 0),i=t.__decorate([n.subclass("esri.views.layers.ImageryLayerView")],i),i};return y}));
