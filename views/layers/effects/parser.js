/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/Error","../../../colorUtils","../../../chunks/_commonjsHelpers","./effects"],(function(t,e,r,n,u){"use strict";var a=n.createCommonjsModule((function(t){n.commonjsGlobal,t.exports&&(t.exports=function(){function t(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function e(t,r,n,u){this.message=t,this.expected=r,this.found=n,this.location=u,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}function r(t,r){r=void 0!==r?r:{};var n,u={},a={start:Kt},c=Kt,o=Pt("none"),i="none",s=Bt("none",!1),f=function(){return[]},l=")",p=Bt(")",!1),h=function(t,e){return{type:"function",name:t,parameters:e||[]}},m=",",g=Bt(",",!1),d=function(t,e){return e.length>0?ie(t,e,3):[t]},v=function(t){return{type:"quantity",value:t.value,unit:t.unit}},y=function(t){return{type:"color",colorType:t.type,value:t.value}},A=Pt("whitespace"),w=/^[ \t\n\r]/,x=Ht([" ","\t","\n","\r"],!1,!1),b=Pt("function"),E="(",C=Bt("(",!1),F=function(t){return t},$=Pt("identifier"),j=/^[a-z\-]/,k=Ht([["a","z"],"-"],!1,!1),M=function(){return _t()},S=Pt("percentage"),q="%",R=Bt("%",!1),z=function(t){return{value:t,unit:"%"}},O=Pt("length"),T="px",I=Bt("px",!1),_=function(t){return{value:t,unit:"px"}},B="cm",H=Bt("cm",!1),N=function(t){return{value:t,unit:"cm"}},P="mm",U=Bt("mm",!1),D=function(t){return{value:t,unit:"mm"}},G="in",J=Bt("in",!1),K=function(t){return{value:t,unit:"in"}},L="pt",Q=Bt("pt",!1),V=function(t){return{value:t,unit:"pt"}},W="pc",X=Bt("pc",!1),Y=function(t){return{value:t,unit:"pc"}},Z=Pt("angle"),tt="deg",et=Bt("deg",!1),rt=function(t){return{value:t,unit:"deg"}},nt="rad",ut=Bt("rad",!1),at=function(t){return{value:t,unit:"rad"}},ct="grad",ot=Bt("grad",!1),it=function(t){return{value:t,unit:"grad"}},st="turn",ft=Bt("turn",!1),lt=function(t){return{value:t,unit:"turn"}},pt=Pt("number"),ht=function(t){return{value:t,unit:null}},mt=Pt("color"),gt="#",dt=Bt("#",!1),vt=/^[0-9a-fA-F]/,yt=Ht([["0","9"],["a","f"],["A","F"]],!1,!1),At=function(){return{type:"hex",value:_t()}},wt=function(t){return{type:"function",value:t}},xt=function(){return{type:"named",value:_t()}},bt=/^[+\-]/,Et=Ht(["+","-"],!1,!1),Ct=/^[0-9]/,Ft=Ht([["0","9"]],!1,!1),$t=".",jt=Bt(".",!1),kt="e",Mt=Bt("e",!1),St=function(){return parseFloat(_t())},qt=0,Rt=0,zt=[{line:1,column:1}],Ot=0,Tt=[],It=0;if("startRule"in r){if(!(r.startRule in a))throw new Error("Can't start parsing from rule \""+r.startRule+'".');c=a[r.startRule]}function _t(){return t.substring(Rt,qt)}function Bt(t,e){return{type:"literal",text:t,ignoreCase:e}}function Ht(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Nt(){return{type:"end"}}function Pt(t){return{type:"other",description:t}}function Ut(e){var r,n=zt[e];if(n)return n;for(r=e-1;!zt[r];)r--;for(n={line:(n=zt[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return zt[e]=n,n}function Dt(t,e){var r=Ut(t),n=Ut(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Gt(t){qt<Ot||(qt>Ot&&(Ot=qt,Tt=[]),Tt.push(t))}function Jt(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}function Kt(){var t;return(t=Lt())===u&&(t=Qt()),t}function Lt(){var e,r;return It++,e=qt,Yt()!==u?(t.substr(qt,4)===i?(r=i,qt+=4):(r=u,0===It&&Gt(s)),r!==u&&Yt()!==u?(Rt=e,e=f()):(qt=e,e=u)):(qt=e,e=u),It--,e===u&&0===It&&Gt(o),e}function Qt(){var t,e;if(t=[],(e=Vt())!==u)for(;e!==u;)t.push(e),e=Vt();else t=u;return t}function Vt(){var e,r,n,a;return e=qt,Yt()!==u&&(r=Zt())!==u&&Yt()!==u?((n=Wt())===u&&(n=null),n!==u&&Yt()!==u?(41===t.charCodeAt(qt)?(a=l,qt++):(a=u,0===It&&Gt(p)),a!==u&&Yt()!==u?(Rt=e,e=h(r,n)):(qt=e,e=u)):(qt=e,e=u)):(qt=e,e=u),e}function Wt(){var e,r,n,a,c,o,i,s;if(e=qt,(r=Xt())!==u){for(n=[],a=qt,(c=Yt())!==u?(44===t.charCodeAt(qt)?(o=m,qt++):(o=u,0===It&&Gt(g)),o===u&&(o=null),o!==u&&(i=Yt())!==u&&(s=Xt())!==u?a=c=[c,o,i,s]:(qt=a,a=u)):(qt=a,a=u);a!==u;)n.push(a),a=qt,(c=Yt())!==u?(44===t.charCodeAt(qt)?(o=m,qt++):(o=u,0===It&&Gt(g)),o===u&&(o=null),o!==u&&(i=Yt())!==u&&(s=Xt())!==u?a=c=[c,o,i,s]:(qt=a,a=u)):(qt=a,a=u);n!==u?(Rt=e,e=r=d(r,n)):(qt=e,e=u)}else qt=e,e=u;return e}function Xt(){var t,e;return t=qt,(e=ee())===u&&(e=re())===u&&(e=ne())===u&&(e=ue()),e!==u&&(Rt=t,e=v(e)),(t=e)===u&&(t=qt,(e=ae())!==u&&(Rt=t,e=y(e)),t=e),t}function Yt(){var e,r;for(It++,e=[],w.test(t.charAt(qt))?(r=t.charAt(qt),qt++):(r=u,0===It&&Gt(x));r!==u;)e.push(r),w.test(t.charAt(qt))?(r=t.charAt(qt),qt++):(r=u,0===It&&Gt(x));return It--,e===u&&(r=u,0===It&&Gt(A)),e}function Zt(){var e,r,n;return It++,e=qt,(r=te())!==u?(40===t.charCodeAt(qt)?(n=E,qt++):(n=u,0===It&&Gt(C)),n!==u?(Rt=e,e=r=F(r)):(qt=e,e=u)):(qt=e,e=u),It--,e===u&&(r=u,0===It&&Gt(b)),e}function te(){var e,r,n;if(It++,e=qt,r=[],j.test(t.charAt(qt))?(n=t.charAt(qt),qt++):(n=u,0===It&&Gt(k)),n!==u)for(;n!==u;)r.push(n),j.test(t.charAt(qt))?(n=t.charAt(qt),qt++):(n=u,0===It&&Gt(k));else r=u;return r!==u&&(Rt=e,r=M()),It--,(e=r)===u&&(r=u,0===It&&Gt($)),e}function ee(){var e,r,n;return It++,e=qt,Yt()!==u&&(r=ce())!==u?(37===t.charCodeAt(qt)?(n=q,qt++):(n=u,0===It&&Gt(R)),n!==u?(Rt=e,e=z(r)):(qt=e,e=u)):(qt=e,e=u),It--,e===u&&0===It&&Gt(S),e}function re(){var e,r,n;return It++,e=qt,Yt()!==u&&(r=ce())!==u?(t.substr(qt,2)===T?(n=T,qt+=2):(n=u,0===It&&Gt(I)),n!==u?(Rt=e,e=_(r)):(qt=e,e=u)):(qt=e,e=u),e===u&&(e=qt,Yt()!==u&&(r=ce())!==u?(t.substr(qt,2)===B?(n=B,qt+=2):(n=u,0===It&&Gt(H)),n!==u?(Rt=e,e=N(r)):(qt=e,e=u)):(qt=e,e=u),e===u&&(e=qt,Yt()!==u&&(r=ce())!==u?(t.substr(qt,2)===P?(n=P,qt+=2):(n=u,0===It&&Gt(U)),n!==u?(Rt=e,e=D(r)):(qt=e,e=u)):(qt=e,e=u),e===u&&(e=qt,Yt()!==u&&(r=ce())!==u?(t.substr(qt,2)===G?(n=G,qt+=2):(n=u,0===It&&Gt(J)),n!==u?(Rt=e,e=K(r)):(qt=e,e=u)):(qt=e,e=u),e===u&&(e=qt,Yt()!==u&&(r=ce())!==u?(t.substr(qt,2)===L?(n=L,qt+=2):(n=u,0===It&&Gt(Q)),n!==u?(Rt=e,e=V(r)):(qt=e,e=u)):(qt=e,e=u),e===u&&(e=qt,Yt()!==u&&(r=ce())!==u?(t.substr(qt,2)===W?(n=W,qt+=2):(n=u,0===It&&Gt(X)),n!==u?(Rt=e,e=Y(r)):(qt=e,e=u)):(qt=e,e=u)))))),It--,e===u&&0===It&&Gt(O),e}function ne(){var e,r,n;return It++,e=qt,(r=ce())!==u?(t.substr(qt,3)===tt?(n=tt,qt+=3):(n=u,0===It&&Gt(et)),n!==u?(Rt=e,e=r=rt(r)):(qt=e,e=u)):(qt=e,e=u),e===u&&(e=qt,(r=ce())!==u?(t.substr(qt,3)===nt?(n=nt,qt+=3):(n=u,0===It&&Gt(ut)),n!==u?(Rt=e,e=r=at(r)):(qt=e,e=u)):(qt=e,e=u),e===u&&(e=qt,(r=ce())!==u?(t.substr(qt,4)===ct?(n=ct,qt+=4):(n=u,0===It&&Gt(ot)),n!==u?(Rt=e,e=r=it(r)):(qt=e,e=u)):(qt=e,e=u),e===u&&(e=qt,(r=ce())!==u?(t.substr(qt,4)===st?(n=st,qt+=4):(n=u,0===It&&Gt(ft)),n!==u?(Rt=e,e=r=lt(r)):(qt=e,e=u)):(qt=e,e=u)))),It--,e===u&&(r=u,0===It&&Gt(Z)),e}function ue(){var t,e;return It++,t=qt,Yt()!==u&&(e=ce())!==u?(Rt=t,t=ht(e)):(qt=t,t=u),It--,t===u&&0===It&&Gt(pt),t}function ae(){var e,r,n,a;if(It++,e=qt,35===t.charCodeAt(qt)?(r=gt,qt++):(r=u,0===It&&Gt(dt)),r!==u){if(n=[],vt.test(t.charAt(qt))?(a=t.charAt(qt),qt++):(a=u,0===It&&Gt(yt)),a!==u)for(;a!==u;)n.push(a),vt.test(t.charAt(qt))?(a=t.charAt(qt),qt++):(a=u,0===It&&Gt(yt));else n=u;n!==u?(Rt=e,e=r=At()):(qt=e,e=u)}else qt=e,e=u;return e===u&&(e=qt,(r=Vt())!==u&&(Rt=e,r=wt(r)),(e=r)===u&&(e=qt,(r=te())!==u&&(Rt=e,r=xt()),e=r)),It--,e===u&&(r=u,0===It&&Gt(mt)),e}function ce(){var e,r,n,a,c,o,i,s;if(e=qt,bt.test(t.charAt(qt))?(r=t.charAt(qt),qt++):(r=u,0===It&&Gt(Et)),r===u&&(r=null),r!==u){for(n=qt,a=[],Ct.test(t.charAt(qt))?(c=t.charAt(qt),qt++):(c=u,0===It&&Gt(Ft));c!==u;)a.push(c),Ct.test(t.charAt(qt))?(c=t.charAt(qt),qt++):(c=u,0===It&&Gt(Ft));if(a!==u)if(46===t.charCodeAt(qt)?(c=$t,qt++):(c=u,0===It&&Gt(jt)),c!==u){if(o=[],Ct.test(t.charAt(qt))?(i=t.charAt(qt),qt++):(i=u,0===It&&Gt(Ft)),i!==u)for(;i!==u;)o.push(i),Ct.test(t.charAt(qt))?(i=t.charAt(qt),qt++):(i=u,0===It&&Gt(Ft));else o=u;o!==u?n=a=[a,c,o]:(qt=n,n=u)}else qt=n,n=u;else qt=n,n=u;if(n===u)if(n=[],Ct.test(t.charAt(qt))?(a=t.charAt(qt),qt++):(a=u,0===It&&Gt(Ft)),a!==u)for(;a!==u;)n.push(a),Ct.test(t.charAt(qt))?(a=t.charAt(qt),qt++):(a=u,0===It&&Gt(Ft));else n=u;if(n!==u){if(a=qt,101===t.charCodeAt(qt)?(c=kt,qt++):(c=u,0===It&&Gt(Mt)),c!==u)if(bt.test(t.charAt(qt))?(o=t.charAt(qt),qt++):(o=u,0===It&&Gt(Et)),o===u&&(o=null),o!==u){if(i=[],Ct.test(t.charAt(qt))?(s=t.charAt(qt),qt++):(s=u,0===It&&Gt(Ft)),s!==u)for(;s!==u;)i.push(s),Ct.test(t.charAt(qt))?(s=t.charAt(qt),qt++):(s=u,0===It&&Gt(Ft));else i=u;i!==u?a=c=[c,o,i]:(qt=a,a=u)}else qt=a,a=u;else qt=a,a=u;a===u&&(a=null),a!==u?(Rt=e,e=r=St()):(qt=e,e=u)}else qt=e,e=u}else qt=e,e=u;return e}function oe(t,e){return t.map((function(t){return t[e]}))}function ie(t,e,r){return[t].concat(oe(e,r))}if((n=c())!==u&&qt===t.length)return n;throw n!==u&&qt<t.length&&Gt(Nt()),Jt(Tt,Ot<t.length?t.charAt(Ot):null,Ot<t.length?Dt(Ot,Ot+1):Dt(Ot,Ot))}return t(e,Error),e.buildMessage=function(t,e){var r={literal:function(t){return'"'+u(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function u(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function c(t){return r[t.type](t)}function o(t){var e,r,n=new Array(t.length);for(e=0;e<t.length;e++)n[e]=c(t[e]);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}function i(t){return t?'"'+u(t)+'"':"end of input"}return"Expected "+o(t)+" but "+i(e)+" found."},{SyntaxError:e,parse:r}}())}));function c(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function(t){let e=1;o(t.parameters,1),1===t.parameters.length&&(e=p(t.parameters[0]));return new u.ColorMatrixEffect(t.name,e)}(t);case"opacity":return function(t){let e=1;o(t.parameters,1),1===t.parameters.length&&(e=p(t.parameters[0]));return new u.OpacityEffect(e)}(t);case"hue-rotate":return function(t){let r=0;o(t.parameters,1),1===t.parameters.length&&(function(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==f[t.unit])throw new e("effect:type-error",`Expected <angle>, Actual: ${i(t)}`,{term:t})}(n=t.parameters[0]),r=n.value*f[n.unit]||0);var n;return new u.HueRotateEffect(r)}(t);case"blur":return function(t){let e=0;o(t.parameters,1),1===t.parameters.length&&(e=m(t.parameters[0]),s(e,t.parameters[0]));return new u.BlurEffect(e)}(t);case"drop-shadow":return function(t){const r=[];let n;for(const u of t.parameters)if("color"===u.type){if(r.length&&Object.freeze(r),n)throw new e("effect:type-error","Accepts only one color",{});n=g(u)}else{const t=m(u);if(Object.isFrozen(r))throw new e("effect:type-error","<length> parameters not consecutive",{lengths:r});r.push(t),3===r.length&&s(t,u)}if(r.length<2||r.length>3)throw new e("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${r.length}}`,{lengths:r});return new u.DropShadowEffect(r[0],r[1],r[2]||0,n||d("black"))}(t);case"bloom":return function(t){let e=1,r=0,n=0;o(t.parameters,3),t.parameters[0]&&(e=p(t.parameters[0]));t.parameters[1]&&(r=m(t.parameters[1]),s(r,t.parameters[1]));t.parameters[2]&&(n=p(t.parameters[2]));return new u.BloomEffect(e,r,n)}(t)}}catch(e){throw e.details.filter=t,e}throw new e("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function o(t,r){if(t.length>r)throw new e("effect:type-error",`Function supports up to ${r} parameters, Actual: ${t.length}`,{parameters:t})}function i(t){return"color"===t.type?"<color>":l[t.unit]?"<length>":f[t.unit]?"<angle>":"%"===t.unit?"<percentage>":"<double>"}function s(t,r){if(t<0)throw new e("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:r})}const f={deg:1,grad:.9,rad:180/Math.PI,turn:360};const l={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/73};function p(t){!function(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new e("effect:type-error",`Expected <double> or <percentage>, Actual: ${i(t)}`,{term:t})}(t);const r=t.value;return s(r,t),"%"===t.unit?.01*r:r}function h(t){return function(t){if("quantity"!==t.type||null!==t.unit)throw new e("effect:type-error",`Expected <double>, Actual: ${i(t)}`,{term:t})}(t),s(t.value,t),t.value}function m(t){return function(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==l[t.unit])throw new e("effect:type-error",`Expected <length>, Actual: ${i(t)}`,{term:t})}(t),t.value*l[t.unit]||0}function g(t){switch(t.colorType){case"hex":return r.hex2rgba(t.value);case"named":return d(t.value);case"function":return function(t){if(o(t.parameters,4),v.test(t.name))return[p(t.parameters[0]),p(t.parameters[1]),p(t.parameters[2]),t.parameters[3]?p(t.parameters[3]):1];if(y.test(t.name))return r.hsla2rgba(h(t.parameters[0]),p(t.parameters[1]),p(t.parameters[2]),t.parameters[3]?p(t.parameters[3]):1);throw new e("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}(t.value)}}function d(t){const n=r.getNamedColorCopy(t);if(!n)throw new e("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return n}const v=/^rgba?/i,y=/^hsla?/i;t.parse=function(t){let r;try{r=t?a.parse(t):[]}catch(r){return{input:t,parsedFunctions:[],effects:[],error:new e("effect:invalid-syntax","Invalid effect syntax",{input:t,error:r})}}const n={input:t,parsedFunctions:r,effects:[],error:null};try{for(const t of r)n.effects.push(c(t))}catch(t){n.effects.length=0,n.error=t}return n},Object.defineProperty(t,"__esModule",{value:!0})}));
