/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Evented","../../core/screenUtils"],(function(e,t,o,r,n,s,i,c,a,p,u,l,h){"use strict";let d=function(t){function o(){var e;return(e=t.apply(this,arguments)||this)._hasZ=null,e.interactiveUndoDisabled=!1,e.history=[],e.redoHistory=[],e.snapToScene=!1,e.view=null,e.elevationInfo=null,e.defaultZ=0,e}e._inheritsLoose(o,t);var n=o.prototype;return n.canUndo=function(){return this.history.length>0},n.canRedo=function(){return this.redoHistory.length>0},n.undo=function(){if(!this.canUndo())return;const e=this.history.pop();e.undo(),this.redoHistory.push(e)},n.redo=function(){if(!this.canRedo())return;const e=this.redoHistory.pop();e.redo(),this.history.push(e)},n.getCoordsFromScreenPoint=function(e){const t=this.screenToMap(e);return r.isSome(t)?t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]:null},n.getCoordsAndPointFromScreenPoint=function(e){const t=this.screenToMap(e);return r.isSome(t)?t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}:null},n.isDuplicateVertex=function(e,t){if(e.length){const[o,r]=e[e.length-1];return o===t[0]&&r===t[1]}return!1},n.getGeometryZValue=function(){return this.defaultZ},n.screenToMap=function(e){let t=null;if("3d"===this.view.type)if(this.hasZ){const o=r.unwrapOr(this.elevationInfo,y);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(h.createScreenPointArray(e.x,e.y),o,this.getGeometryZValue())}else{const o=r.unwrapOr(this.elevationInfo,f);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(h.createScreenPointArray(e.x,e.y),o,0),r.isSome(t)&&(t.z=void 0)}else t=this.view.toMap(e),r.isSome(t)&&(t.z=this.hasZ?this.getGeometryZValue():void 0);return t},e._createClass(o,[{key:"hasZ",get:function(){return r.isSome(this._hasZ)?this._hasZ:"3d"===this.view.type},set:function(e){this._hasZ=e,this.notifyChange("hasZ")}}]),o}(l.EventedAccessor);t.__decorate([i.property({type:Boolean,nonNullable:!0})],d.prototype,"interactiveUndoDisabled",void 0),t.__decorate([i.property({readOnly:!0})],d.prototype,"history",void 0),t.__decorate([i.property({readOnly:!0})],d.prototype,"redoHistory",void 0),t.__decorate([i.property()],d.prototype,"snapToScene",void 0),t.__decorate([i.property()],d.prototype,"view",void 0),t.__decorate([i.property()],d.prototype,"elevationInfo",void 0),t.__decorate([i.property({nonNullable:!0})],d.prototype,"defaultZ",void 0),t.__decorate([i.property({dependsOn:["view"]})],d.prototype,"hasZ",null),d=t.__decorate([c.subclass("esri.views.draw.DrawAction")],d);const y={mode:"absolute-height",offset:0},f={mode:"on-the-ground",offset:0};return d}));
