/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Handles","../input/InputManager","../support/screenUtils","../input/recognizers/PointerClickHoldAndDrag","./DrawAction","./input/DrawEvents","./input/Keys","../3d/interactive/editingTools/draw/DrawTool"],(function(e,t,o,i,r,s,n,a,c,l,d,h,w,u,p,_,v,m,P,D){"use strict";e.PointDrawAction=function(e){function o(t){var o;return(o=e.call(this,t)||this)._clickDelay=_.DefaultParameters.maximumClickDelay,o._cursorMoved=!1,o._cursorScreenPoint=null,o._pointerDownEvent=null,o._viewHandles=new w,o.coordinates=[],o}t._inheritsLoose(o,e);var i=o.prototype;return i.initialize=function(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)},i.destroy=function(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this.emit("destroy")):(this._removeDrawTool(),this.emit("destroy"))},i.complete=function(){if("2d"===this.view.type){if(this._cursorScreenPoint){const e=this.getCoordsFromScreenPoint(this._cursorScreenPoint);r.isSome(e)&&(this._set("coordinates",e),this._completeDrawing())}}else this._drawTool.completeCreateOperation()},i._addViewHandles=function(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(e=>{e.stopPropagation();const t=this.getCoordsFromScreenPoint(e.screenPoint);r.isSome(t)&&(this._set("coordinates",t),this._drawCompleteHandler(e))}),u.ViewEventPriorities.TOOL),this.view.on("pointer-down",(e=>{this._pointerDownEvent=e,this._cursorMoved=!1}),u.ViewEventPriorities.TOOL),this.view.on("pointer-move",(e=>{this._cursorMoved=!0,this._cursorScreenPoint=p.createScreenPointFromEvent(e),this._cursorUpdateHandler(e)}),u.ViewEventPriorities.TOOL),this.view.on("pointer-up",(e=>{if(this._pointerDownEvent&&!this._cursorMoved&&e.timestamp-this._pointerDownEvent.timestamp>this._clickDelay){this._cursorScreenPoint=p.createScreenPointFromEvent(e);const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);r.isSome(t)&&(this._set("coordinates",t),this._drawCompleteHandler(e))}}),u.ViewEventPriorities.TOOL),this.view.on("key-down",(e=>{if(e.key===P.KEYS.drawCompleteKey&&this._cursorScreenPoint){const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);r.isSome(t)&&(this._set("coordinates",t),this._drawCompleteHandler(e))}}),u.ViewEventPriorities.TOOL)])},i._removeViewHandles=function(){this._viewHandles.removeAll()},i._addDrawTool=function(e){this._drawTool=new D.DrawTool({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new m.CursorUpdateEvent(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new m.DrawCompleteEvent(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))},i._removeDrawTool=function(){r.isSome(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)},i._updateCursor=function(e,t){r.isSome(e)?this.emit("cursor-update",new m.CursorUpdateEvent(this.view,t,0,[e])):this.emit("cursor-update",new m.CursorUpdateEvent(this.view,t,null,null))},i._completeDrawing=function(e){this._cursorMoved=!1,this._pointerDownEvent=null;const t=new m.DrawCompleteEvent(e,[this.coordinates]);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()},i._cursorUpdateHandler=function(e){this._updateCursor(this.getCoordsFromScreenPoint(this._cursorScreenPoint),e.native)},i._drawCompleteHandler=function(e){this._completeDrawing(e.native)},o}(v),o.__decorate([a.property({readOnly:!0})],e.PointDrawAction.prototype,"coordinates",void 0),e.PointDrawAction=o.__decorate([c.subclass("esri.views.draw.PointDrawAction")],e.PointDrawAction),Object.defineProperty(e,"__esModule",{value:!0})}));
