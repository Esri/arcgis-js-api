/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../core/lang","../../../core/maybe","../../../core/arrayUtils","../../../geometry/support/spatialReferenceUtils","../../../geometry/Point","../../../geometry/Multipoint","../../../geometry/support/coordsUtils","../../../geometry/Polygon","../../../geometry/Polyline","../../../geometry","../../../core/unitUtils","../../../geometry/Circle","../../../geometry/geometryEngine","./surfaceCoordinateSystems"],(function(e,t,a,n,o,r,i,c,s,l,u,y,f,m,x){"use strict";function p(e,t,n=null){return a.isSome(n)?[e,t,n]:[e,t]}function h(e,t){const a=new r({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(a.z=e[2]),a}function M(e,t){return new i({points:e,spatialReference:t})}function P(e,t,a){const n=new l({paths:e,spatialReference:t});return a&&c.unnormalizeGeometryOnDatelineCrossing(n),n}function S(e,a,r,i=!0){const l=t.clone(e);l.forEach((e=>{const t=e[0],a=e[e.length-1];n.equals(t,a)&&1!==e.length||e.push(e[0])}));let u=new s({rings:l,spatialReference:a});return u.rings.forEach((e=>{c.isClockwise(e,!1,!1)||e.reverse()})),r&&c.unnormalizeGeometryOnDatelineCrossing(u),i&&u.isSelfIntersecting&&o.isValid(a)&&(u=m.simplify(u)),u}function g(e,t,n){const o=t.mapToLocalMultiple(e),r=[],i={x:o[0].x,y:o[0].y},c={x:o[1].x,y:o[1].y},s=Math.round(c.x-i.x),l=Math.round(c.y-i.y),u=Math.max(Math.abs(s),Math.abs(l));if(n){const e={x:i.x+u,y:i.y+u},t={x:i.x-u,y:i.y-u};r.push(x.makeSurfacePoint(e.x,t.y),x.makeSurfacePoint(t.x,t.y),x.makeSurfacePoint(t.x,e.y),x.makeSurfacePoint(e.x,e.y))}else{const e={x:s>0?i.x+u:i.x-u,y:l>0?i.y+u:i.y-u};r.push(x.makeSurfacePoint(i.x,i.y),x.makeSurfacePoint(e.x,i.y),x.makeSurfacePoint(e.x,e.y),x.makeSurfacePoint(i.x,e.y))}return S([a.filterNones(r.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function k(e,t,n){let o=t.mapToLocalMultiple(e);if(1===o.length){const e=48,t=o[0];o=[x.makeSurfacePoint(t.x-e,t.y+e),x.makeSurfacePoint(t.x+e,t.y-e),x.makeSurfacePoint(t.x+e,t.y-e),x.makeSurfacePoint(t.x-e,t.y+e)]}const r=[],i={x:o[0].x,y:o[0].y},c={x:o[1].x,y:o[1].y};if(n){const e=Math.round(c.x-i.x),t=Math.round(c.y-i.y);r.push(x.makeSurfacePoint(i.x-e,i.y-t),x.makeSurfacePoint(c.x,i.y-t),x.makeSurfacePoint(c.x,c.y),x.makeSurfacePoint(i.x-e,c.y))}else r.push(x.makeSurfacePoint(i.x,i.y),x.makeSurfacePoint(c.x,i.y),x.makeSurfacePoint(c.x,c.y),x.makeSurfacePoint(i.x,c.y));return S([a.filterNones(r.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function d(e,t,n,r){const i=t.mapToLocalMultiple(e);let s=null,l=null;if(n)s=i[0],l=i[1];else{const e=i[0],t=i[1],a=Math.round(t.x-e.x),n=Math.round(t.y-e.y),o=Math.max(Math.abs(a),Math.abs(n));s=x.makeSurfacePoint(a>0?e.x+o/2:e.x-o/2,n>0?e.y+o/2:e.y-o/2),l=x.makeSurfacePoint(Math.abs(a)>Math.abs(n)?s.x-o/2:s.x,Math.abs(a)>Math.abs(n)?s.y:s.y-o/2)}const u=t.localToMap(s),p=t.localToMap(l);if(a.isNone(u)||a.isNone(p))return null;t.doUnnormalization&&c.unnormalizeVerticesOnDatelineCrossing([[u,p]],t.spatialReference);const M=h(u,t.spatialReference),P=h(p,t.spatialReference),g=y.getMetersPerUnitForSR(t.spatialReference);let k=0;if(o.isValid(t.spatialReference))k=g*m.distance(M,P,null);else{const e=s.x-l.x,t=s.y-l.y;k=g*Math.sqrt(e*e+t*t)*(r||1)}const d=new f({center:M,radius:k,radiusUnit:"meters",spatialReference:t.spatialReference});return S(d.rings,d.spatialReference,!1)}function R(e,t,n){const o=t.mapToLocalMultiple(e),r=o[0],i=o[1],c=Math.round(i.x-r.x),s=Math.round(i.y-r.y),l=x.makeSurfacePoint(n?r.x:r.x+c/2,n?r.y:r.y+s/2),u=n?c:c/2,y=n?s:s/2,f=60,m=[],p=2*Math.PI/f;for(let a=0;a<f;a++){const e=Math.cos(a*p),t=Math.sin(a*p),n=x.makeSurfacePoint(u*e+l.x,y*t+l.y);m.push(n)}return m.push(m[0]),S([a.filterNones(m.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}e.createCircle=d,e.createEllipse=R,e.createMultipoint=M,e.createPoint=h,e.createPolygon=S,e.createPolyline=P,e.createRectangle=k,e.createSquare=g,e.makeMapPoint=p,Object.defineProperty(e,"__esModule",{value:!0})}));
