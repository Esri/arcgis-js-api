/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../geometry/Point","../../../geometry","../../../chunks/vec3f64","../../../chunks/vec3","../../../chunks/quatf64","../../../chunks/quat","../../../chunks/mat2d","../../../chunks/mat2df64"],(function(e,r,t,n,o,a,s,i,l,c,f){"use strict";function u(e,r,n=null){return t.isSome(n)?[e,r,n]:[e,r]}function m(e,r,n=null){return t.isSome(n)?{x:e,y:r,z:n}:{x:e,y:r}}let d=function(){function e(e){this.spatialReference=e}return e.prototype.mapToLocalMultiple=function(e){return t.filterNones(e.map((e=>this.mapToLocal(e))))},r._createClass(e,[{key:"doUnnormalization",get:function(){return!1}}]),e}(),h=function(e){function t(r,t,n=null){var o;return(o=e.call(this,t)||this).defaultZ=n,o.transform=f.create(),o.transformInv=f.create(),o.transform=f.clone(r),c.invert(o.transformInv,o.transform),o}r._inheritsLoose(t,e);var n=t.prototype;return n.makeMapPoint=function(e,r){return u(e,r,this.defaultZ)},n.mapToLocal=function(e){return m(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])},n.localToMap=function(e){return u(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)},t}(d),p=function(e){function o(r,t){var n;(n=e.call(this,r.spatialReference)||this).view=r,n.defaultZ=null,n.pWS=a.create(),n.tangentFrameUpWS=a.create(),n.tangentFrameRightWS=a.create(),n.tangentFrameForwardWS=a.create(),n.localFrameRightWS=a.create(),n.localFrameUpWS=a.create(),n.worldToLocalTransform=i.create(),n.localToWorldTransform=i.create(),n.scale=1,n.scale=r.resolution,n.referenceMapPoint=t,n.defaultZ=t.hasZ?t.z:null;const o=r.state.camera.viewRight;n.view.renderCoordsHelper.toRenderCoords(n.referenceMapPoint,n.pWS),n.view.renderCoordsHelper.worldBasisAtPosition(n.pWS,0,n.tangentFrameRightWS),n.view.renderCoordsHelper.worldBasisAtPosition(n.pWS,1,n.tangentFrameUpWS),n.view.renderCoordsHelper.worldBasisAtPosition(n.pWS,2,n.tangentFrameForwardWS);const c=a.create();return s.scale(c,n.tangentFrameForwardWS,s.dot(o,n.tangentFrameForwardWS)),s.subtract(n.localFrameRightWS,o,c),s.normalize(n.localFrameRightWS,n.localFrameRightWS),s.cross(n.localFrameUpWS,n.tangentFrameForwardWS,n.localFrameRightWS),l.rotationTo(n.worldToLocalTransform,n.localFrameRightWS,n.tangentFrameRightWS),l.invert(n.localToWorldTransform,n.worldToLocalTransform),n}r._inheritsLoose(o,e);var c=o.prototype;return c.makeMapPoint=function(e,r){return u(e,r,this.defaultZ)},c.mapToLocal=function(e){const r=a.create();this.view.renderCoordsHelper.toRenderCoords(new n({x:e[0],y:e[1],spatialReference:this.spatialReference}),r),s.transformQuat(r,r,this.worldToLocalTransform);const o=this.view.renderCoordsHelper.fromRenderCoords(r,this.view.spatialReference);return t.isSome(o)?m(o.x/this.scale,o.y/this.scale):null},c.localToMap=function(e){const r=a.create();this.view.renderCoordsHelper.toRenderCoords(new n({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),r),s.transformQuat(r,r,this.localToWorldTransform);const o=this.view.renderCoordsHelper.fromRenderCoords(r,this.view.spatialReference);return t.isSome(o)?u(o.x,o.y,this.defaultZ):null},r._createClass(o,[{key:"doUnnormalization",get:function(){return"global"===this.view.viewingMode}}]),o}(d);function w(e,r){if("2d"===e.type)return new h(e.state.transform,e.spatialReference,r.length>2?r[2]:null);if("3d"===e.type){const t=r.length>2?new n({x:r[0],y:r[1],z:r[2],spatialReference:e.spatialReference}):new n({x:r[0],y:r[1],spatialReference:e.spatialReference});return new p(e,t)}return null}e.AffineCoordinateSystem=h,e.SceneViewCoordinateSystem=p,e.SurfaceCoordinateSystem=d,e.createViewAlignedCoordinateSystem=w,e.makeMapPoint=u,e.makeSurfacePoint=m,Object.defineProperty(e,"__esModule",{value:!0})}));
