/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/mathUtils","../../core/screenUtils","./InputHandler","./InputManager","./IViewEvents"],(function(e,t,n,a,r,i,o,s){"use strict";const p=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],c={};function l(e){return!!c[e]}function u(e){for(const t of e)if(!l(t))return!1;return!0}p.forEach((e=>{c[e]=!0}));let d=function(){function e(e){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=e,this.inputManager=null}var t=e.prototype;return t.connect=function(e){e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((({handler:e,priority:t},n)=>this.inputManager.installHandlers(n,[e],t)))},t.disconnect=function(){this.inputManager&&this.handlers.forEach(((e,t)=>this.inputManager.uninstallHandlers(t))),this.inputManager=null},t.destroy=function(){this.disconnect(),this.handlers.clear(),this.view=null},t.on=function(e,t,n,a){const r=Array.isArray(e)?e:e.split(",");if(!u(r))return r.some(l)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let i,s;Array.isArray(t)?s=t:(i=t,s=[]),"function"==typeof n?i=n:a=n,a=null!=a?a:o.ViewEventPriorities.DEFAULT;const p=this._createUniqueGroupName(),c=new m(this.view,r,s,i);this.handlers.set(p,{handler:c,priority:a});for(const o of r){const e=this.handlerCounts.get(o)||0;this.handlerCounts.set(o,e+1)}return this.inputManager&&this.inputManager.installHandlers(p,[c],a),{remove:()=>this._removeHandler(p,r)}},t.hasHandler=function(e){return!!this.handlerCounts.get(e)},t._removeHandler=function(e,t){if(this.handlers.has(e)){this.handlers.delete(e);for(const e of t){const t=this.handlerCounts.get(e);void 0===t?console.error("Trying to remove handler for event that has no handlers registered: ",e):1===t?this.handlerCounts.delete(e):this.handlerCounts.set(e,t-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)},t._createUniqueGroupName=function(){return this.counter+=1,`viewEvents_${this.counter}`},e}(),m=function(e){function n(t,n,a,r){var i;(i=e.call(this,!0)||this).view=t;for(const e of n)switch(e){case"click":i.registerIncoming("click",a,(e=>r(i._wrapClick(e))));break;case"double-click":i.registerIncoming("double-click",a,(e=>r(i._wrapDoubleClick(e))));break;case"immediate-click":i.registerIncoming("immediate-click",a,(e=>r(i._wrapImmediateClick(e))));break;case"immediate-double-click":i.registerIncoming("immediate-double-click",a,(e=>r(i._wrapImmediateDoubleClick(e))));break;case"hold":i.registerIncoming("hold",a,(e=>r(i._wrapHold(e))));break;case"drag":i.registerIncoming("drag",a,(e=>{const t=i._wrapDrag(e);t&&r(t)}));break;case"key-down":i.registerIncoming("key-down",a,(e=>r(i._wrapKeyDown(e))));break;case"key-up":i.registerIncoming("key-up",a,(e=>r(i._wrapKeyUp(e))));break;case"pointer-down":i.registerIncoming("pointer-down",a,(e=>r(i._wrapPointer(e,"pointer-down"))));break;case"pointer-move":i.registerIncoming("pointer-move",a,(e=>r(i._wrapPointer(e,"pointer-move"))));break;case"pointer-up":i.registerIncoming("pointer-up",a,(e=>r(i._wrapPointer(e,"pointer-up"))));break;case"pointer-drag":i.registerIncoming("pointer-drag",a,(e=>r(i._wrapPointerDrag(e))));break;case"mouse-wheel":i.registerIncoming("mouse-wheel",a,(e=>r(i._wrapMouseWheel(e))));break;case"pointer-enter":i.registerIncoming("pointer-enter",a,(e=>r(i._wrapPointer(e,"pointer-enter"))));break;case"pointer-leave":i.registerIncoming("pointer-leave",a,(e=>r(i._wrapPointer(e,"pointer-leave"))));break;case"gamepad":i.registerIncoming("gamepad",a,(e=>{r(i._wrapGamepad(e))}));break;case"focus":i.registerIncoming("focus",a,(e=>{r(i._wrapFocus(e))}));break;case"blur":i.registerIncoming("blur",a,(e=>{r(i._wrapBlur(e))}))}return i}t._inheritsLoose(n,e);var i=n.prototype;return i._wrapFocus=function(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapBlur=function(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapClick=function(e){const{pointerType:t,button:n,buttons:a,x:i,y:o,native:s,eventId:p}=e.data,{cancelable:c,timestamp:l}=e;return{type:"click",pointerType:t,button:n,buttons:a,x:i,y:o,native:s,timestamp:l,screenPoint:r.createScreenPoint(i,o),mapPoint:this._getMapPoint(i,o),eventId:p,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapDoubleClick=function(e){const{pointerType:t,button:n,buttons:a,x:r,y:i,native:o,eventId:s}=e.data,{cancelable:p,timestamp:c}=e;return{type:"double-click",pointerType:t,button:n,buttons:a,x:r,y:i,native:o,timestamp:c,mapPoint:this._getMapPoint(r,i),eventId:s,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapImmediateClick=function(e){const{pointerType:t,button:n,buttons:a,x:r,y:i,native:o,eventId:s}=e.data,p=o.pointerId,{cancelable:c,timestamp:l}=e;return{type:"immediate-click",pointerId:p,pointerType:t,button:n,buttons:a,x:r,y:i,native:o,timestamp:l,mapPoint:this._getMapPoint(r,i),eventId:s,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapImmediateDoubleClick=function(e){const{pointerType:t,button:n,buttons:a,x:r,y:i,native:o,eventId:s}=e.data,p=o.pointerId,{cancelable:c,timestamp:l}=e;return{type:"immediate-double-click",pointerId:p,pointerType:t,button:n,buttons:a,x:r,y:i,native:o,timestamp:l,mapPoint:this._getMapPoint(r,i),eventId:s,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapHold=function(e){const{pointerType:t,button:n,buttons:a,x:r,y:i,native:o}=e.data,{cancelable:s,timestamp:p}=e;return{type:"hold",pointerType:t,button:n,buttons:a,x:r,y:i,native:o,timestamp:p,mapPoint:this._getMapPoint(r,i),cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._getMapPoint=function(e,t){return this.view.toMap(r.createScreenPoint(e,t),{exclude:[]})},i._wrapDrag=function(e){const t=e.data,{x:n,y:r}=t.center,{action:i,pointerType:o,button:s}=t;if("start"===i&&(this.latestDragStart=t),!this.latestDragStart)return;const p=t.pointer.native,c=t.buttons,{cancelable:l,timestamp:u}=e,d={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===i&&(this.latestDragStart=void 0),{type:"drag",action:i,x:n,y:r,origin:d,pointerType:o,button:s,buttons:c,radius:t.radius,angle:a.rad2deg(t.angle),native:p,timestamp:u,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapKeyDown=function(e){const{key:t,repeat:n,native:a}=e.data,{cancelable:r,timestamp:i}=e;return{type:"key-down",key:t,repeat:n,native:a,timestamp:i,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapKeyUp=function(e){const{key:t,native:n}=e.data,{cancelable:a,timestamp:r}=e;return{type:"key-up",key:t,native:n,timestamp:r,cancelable:a,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapPointer=function(e,t){const{x:n,y:a,button:r,buttons:i,native:o,eventId:s}=e.data,p=o.pointerId,c=o.pointerType,{cancelable:l,timestamp:u}=e;return{type:t,x:n,y:a,pointerId:p,pointerType:c,button:r,buttons:i,native:o,timestamp:u,eventId:s,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapPointerDrag=function(e){const{x:t,y:n,buttons:a,native:r,eventId:i}=e.data.currentEvent,{button:o}=e.data.startEvent,s=e.data.startEvent.native.pointerId,p=e.data.startEvent.native.pointerType,c=e.data.action,l={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:u,timestamp:d}=e;return{type:"pointer-drag",x:t,y:n,pointerId:s,pointerType:p,button:o,buttons:a,action:c,origin:l,native:r,timestamp:d,eventId:i,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapMouseWheel=function(e){const{cancelable:t,data:n,timestamp:a}=e,{x:r,y:i,deltaY:o,native:s}=n;return{type:"mouse-wheel",x:r,y:i,deltaY:o,native:s,timestamp:a,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},i._wrapGamepad=function(e){const{action:t,state:n,device:a}=e.data,{cancelable:r,timestamp:i}=e,{buttons:o,axes:s}=n;return{type:"gamepad",device:a,timestamp:i,action:t,buttons:o,axes:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}},n}(i.InputHandler);Object.defineProperty(e,"MouseButton",{enumerable:!0,get:()=>s.MouseButton}),e.ViewEvents=d,e.eventTypes=p,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
