/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/arrayUtils","../../../core/Evented","../../../core/maybe","../../../geometry/Polygon","../../../geometry/Polyline","../coordinateHelper"],(function(e,t,n,s,i,o,r,c){"use strict";let h=function(){function e(e){this.left=null,this.right=null,this.type="vertex",this.index=null,this.component=e}return t._createClass(e,[{key:"pos",get:function(){return this._pos},set:function(e){this._pos=e,this.component.unnormalizeVertexPositions()}}]),e}(),l=function(e,t,n){this.type="edge",this.component=e,this.left=t,this.right=n,t.right=this,n.left=this},u=function(){function e(e){this.vertices=[],this.edges=[],this.data=e}var t=e.prototype;return t.unnormalizeVertexPositions=function(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices)},t.updateVertexIndex=function(e,t){if(0===this.vertices.length)return;const n=this.vertices[0];let s=null,i=e,o=t;do{s=i,s.index=o++,i=s.right?s.right.right:null}while(null!=i&&i!==n);s.left&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)},t.getFirstVertex=function(){return 0===this.vertices.length?null:this.vertices[0]},t.getLastVertex=function(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]},t.isClosed=function(){return this.vertices.length>2&&null!==this.vertices[0].left},t.swapVertices=function(e,t){const n=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=n},t.iterateVertices=function(e){if(0===this.vertices.length)return;const t=this.vertices[0];let n=t;do{e(n,n.index),n=i.isSome(n.right)?n.right.right:null}while(n!==t&&null!=n)},e}(),a=function(e){function s(t){var n;return(n=e.call(this)||this).coordinateHelper=t,n.undoStack=[],n.redoStack=[],n.components=[],n}t._inheritsLoose(s,e);var a=s.prototype;return a.apply=function(e,t=1){return 0!==t&&!i.isNone(this.lastOperation)&&this.lastOperation.accumulate(e)||(e.apply(),this.undoStack.push(e),this.redoStack=[]),e},a.undo=function(){if(this.undoStack.length>0){const e=this.undoStack.pop();return e.undo(),this.redoStack.push(e),e}return null},a.redo=function(){if(this.redoStack.length>0){const e=this.redoStack.pop();return e.apply(),this.undoStack.push(e),e}return null},a.toPoint=function(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)},a.toPolyline=function(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach(((n,s)=>{const i=[];let o=n.vertices.find((e=>null==e.left));const r=o;do{i.push(t(o.pos)),o=o.right?o.right.right:null}while(o&&o!==r);e.push(i)})),new r({paths:e,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})},a.toPolygon=function(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach(((n,s)=>{const o=[],r=n.vertices[0];let c=r;const h=c;do{o.push(t(c.pos)),c=i.isSome(c.right)?c.right.right:null}while(c&&c!==h);n.isClosed()&&o.push(t(r.pos)),e.push(o)})),new o({rings:e,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})},s.fromGeometry=function(e,t){const i=c.createCoordinateHelper(e.hasZ,e.hasM,e.spatialReference,t),o=new s(i);switch(e.type){case"polygon":{const t=e.rings;for(let e=0;e<t.length;++e){const s=t[e],r=new u(o),c=s.length>2&&n.equals(s[0],s[s.length-1]),a=c?s.length-1:s.length;for(let e=0;e<a;++e){const t=i.fromArray(s[e]),n=new h(r);r.vertices.push(n),n.pos=t,n.index=e}const p=r.vertices.length-1;for(let e=0;e<p;++e){const t=r.vertices[e],n=r.vertices[e+1],s=new l(r,t,n);r.edges.push(s)}if(c){const e=new l(r,r.vertices[r.vertices.length-1],r.vertices[0]);r.edges.push(e)}o.components.push(r)}}break;case"polyline":for(const t of e.paths){const e=new u(o),n=t.length;for(let o=0;o<n;++o){const n=i.fromArray(t[o]),s=new h(e);e.vertices.push(s),s.pos=n,s.index=o}const s=e.vertices.length-1;for(let t=0;t<s;++t){const n=e.vertices[t],s=e.vertices[t+1],i=new l(e,n,s);e.edges.push(i)}o.components.push(e)}break;case"point":{const t=new u(o),n=new h(t);n.index=0,n.pos=o.coordinateHelper.fromPoint(e),t.vertices.push(n),o.components.push(t)}}return o},t._createClass(s,[{key:"canUndo",get:function(){return this.undoStack.length>0}},{key:"lastOperation",get:function(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}},{key:"canRedo",get:function(){return this.redoStack.length>0}}]),s}(s);e.Component=u,e.Edge=l,e.EditGeometry=a,e.Vertex=h,Object.defineProperty(e,"__esModule",{value:!0})}));
