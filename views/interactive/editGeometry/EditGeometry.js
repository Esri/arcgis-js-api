/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/arrayUtils","../../../core/Evented","../../../core/maybe","../../../geometry/Polygon","../../../geometry/Polyline","../coordinateHelper","./unnormalizationHelper"],(function(e,t,n,i,s,o,r,c,h){"use strict";let l=function(){function e(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}return t._createClass(e,[{key:"pos",get:function(){return this._pos},set:function(e){this._pos=e,this.component.unnormalizeVertexPositions()}}]),e}(),a=function(e,t,n){this.component=e,this.leftVertex=t,this.rightVertex=n,this.type="edge",t.rightEdge=this,n.leftEdge=this},g=function(){function e(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}var t=e.prototype;return t.unnormalizeVertexPositions=function(){this.vertices.length<=1||h.unnormalize(this.vertices,h.getUnnormalizationInfo(this._spatialReference,this._viewingMode))},t.updateVertexIndex=function(e,t){if(0===this.vertices.length)return;const n=this.vertices[0];let i=null,s=e,o=t;do{i=s,i.index=o++,s=i.rightEdge?i.rightEdge.rightVertex:null}while(null!=s&&s!==n);i.leftEdge&&i!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(i),this.vertices.length-1)},t.getFirstVertex=function(){return 0===this.vertices.length?null:this.vertices[0]},t.getLastVertex=function(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]},t.isClosed=function(){return this.vertices.length>2&&null!==this.vertices[0].leftEdge},t.swapVertices=function(e,t){const n=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=n},t.iterateVertices=function(e){if(0===this.vertices.length)return;const t=this.vertices[0];let n=t;do{e(n,n.index),n=s.isSome(n.rightEdge)?n.rightEdge.rightVertex:null}while(n!==t&&null!=n)},e}(),u=function(e){function i(t,n){var i;return(i=e.call(this)||this).type=t,i.coordinateHelper=n,i._geometry=null,i._dirty=!0,i.components=[],i}t._inheritsLoose(i,e);var h=i.prototype;return h.notifyChanges=function(e){this._dirty=!0,this.emit("change",e)},h._toPoint=function(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)},h._toPolyline=function(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[];let s=n.vertices.find((e=>null==e.leftEdge));const o=s;do{i.push(t(s.pos)),s=s.rightEdge?s.rightEdge.rightVertex:null}while(s&&s!==o);e.push(i)}return new r({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})},h._toPolygon=function(){const e=[],t=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const i=[],o=n.vertices[0];let r=o;const c=r;do{i.push(t(r.pos)),r=s.isSome(r.rightEdge)?r.rightEdge.rightVertex:null}while(r&&r!==c);n.isClosed()&&i.push(t(o.pos)),e.push(i)}return new o({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})},i.fromGeometry=function(e,t){const s=e.spatialReference,o=c.createCoordinateHelper(e.hasZ,e.hasM,s),r=new i(e.type,o);switch(e.type){case"polygon":{const i=e.rings;for(let e=0;e<i.length;++e){const c=i[e],h=new g(s,t);h.index=e;const u=c.length>2&&n.equals(c[0],c[c.length-1]),p=u?c.length-1:c.length;for(let e=0;e<p;++e){const t=o.arrayToVector(c[e]),n=new l(h);h.vertices.push(n),n.pos=t,n.index=e}const d=h.vertices.length-1;for(let e=0;e<d;++e){const t=h.vertices[e],n=h.vertices[e+1],i=new a(h,t,n);h.edges.push(i)}if(u){const e=new a(h,h.vertices[h.vertices.length-1],h.vertices[0]);h.edges.push(e)}r.components.push(h)}break}case"polyline":{const n=e.paths;for(let e=0;e<n.length;++e){const i=n[e],c=new g(s,t);c.index=e;const h=i.length;for(let e=0;e<h;++e){const t=o.arrayToVector(i[e]),n=new l(c);c.vertices.push(n),n.pos=t,n.index=e}const u=c.vertices.length-1;for(let e=0;e<u;++e){const t=c.vertices[e],n=c.vertices[e+1],i=new a(c,t,n);c.edges.push(i)}r.components.push(c)}break}case"point":{const n=new g(s,t);n.index=0;const i=new l(n);i.index=0,i.pos=o.pointToVector(e),n.vertices.push(i),r.components.push(n);break}}return r},t._createClass(i,[{key:"geometry",get:function(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon()}this._dirty=!1}return this._geometry}},{key:"spatialReference",get:function(){return this.coordinateHelper.spatialReference}}]),i}(i);e.Component=g,e.Edge=a,e.EditGeometry=u,e.Vertex=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
