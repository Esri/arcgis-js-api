/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../geometry/Polygon","../../../geometry/Polyline","../../../geometry","../../../core/Evented","../coordinateHelper"],(function(t,e,n,s,i,o,r,c){"use strict";let h=function(){function t(t){this.left=null,this.right=null,this.type="vertex",this.index=null,this.component=t}return e._createClass(t,[{key:"pos",get:function(){return this._pos},set:function(t){this._pos=t,this.component.unnormalizeVertexPositions()}}]),t}(),l=function(t,e,n){this.type="edge",this.component=t,this.left=e,this.right=n,e.right=this,n.left=this},u=function(){function t(t){this.vertices=[],this.edges=[],this.data=t}var e=t.prototype;return e.unnormalizeVertexPositions=function(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices)},e.updateVertexIndex=function(t,e){if(0===this.vertices.length)return;const n=this.vertices[0];let s=null,i=t,o=e;do{s=i,s.index=o++,i=s.right?s.right.right:null}while(null!=i&&i!==n);s.left&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)},e.getFirstVertex=function(){return 0===this.vertices.length?null:this.vertices[0]},e.getLastVertex=function(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]},e.swapVertices=function(t,e){const n=this.vertices[t];this.vertices[t]=this.vertices[e],this.vertices[e]=n},e.iterateVertices=function(t){if(0===this.vertices.length)return;const e=this.vertices[0];let s=e;do{t(s,s.index),s=n.isSome(s.right)?s.right.right:null}while(s!==e&&null!=s)},t}(),a=function(t){function o(e){var n;return(n=t.call(this)||this).coordinateHelper=e,n.undoStack=[],n.redoStack=[],n.components=[],n}e._inheritsLoose(o,t);var r=o.prototype;return r.apply=function(t,e=1){0!==e&&!n.isNone(this.lastOperation)&&this.lastOperation.accumulate(t)||(t.apply(),this.undoStack.push(t),this.redoStack=[])},r.undo=function(){if(this.undoStack.length>0){const t=this.undoStack.pop();return t.undo(),this.redoStack.push(t),t}return null},r.redo=function(){if(this.redoStack.length>0){const t=this.redoStack.pop();return t.apply(),this.undoStack.push(t),t}return null},r.toPoint=function(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)},r.toPolyline=function(){const t=[],e=this.coordinateHelper.toArray;return this.components.forEach(((n,s)=>{const i=[];let o=n.vertices.find((t=>null==t.left));const r=o;do{i.push(e(o.pos)),o=o.right?o.right.right:null}while(o&&o!==r);t.push(i)})),new i({paths:t,spatialReference:this.coordinateHelper.spatialReference})},r.toPolygon=function(){const t=[],e=this.coordinateHelper.toArray;return this.components.forEach(((s,i)=>{const o=[],r=s.vertices[0];let c=r;const h=c;do{o.push(e(c.pos)),c=n.isSome(c.right)?c.right.right:null}while(c&&c!==h);o.push(e(r.pos)),t.push(o)})),new s({rings:t,spatialReference:this.coordinateHelper.spatialReference})},o.fromGeometry=function(t,e){const n=c.createCoordinateHelper(t.hasZ,t.hasM,t.spatialReference,e),s=new o(n);switch(t.type){case"polygon":{const e=t.rings;for(let t=0;t<e.length;++t){const i=e[t],o=new u(s),r=i.length-1;for(let t=0;t<r;++t){const e=n.fromArray(i[t]),s=new h(o);o.vertices.push(s),s.pos=e,s.index=t}const c=o.vertices.length-1;for(let t=0;t<c;++t){const e=o.vertices[t],n=o.vertices[t+1],s=new l(o,e,n);o.edges.push(s)}const a=new l(o,o.vertices[o.vertices.length-1],o.vertices[0]);o.edges.push(a),s.components.push(o)}}break;case"polyline":for(const e of t.paths){const t=new u(s),i=e.length;for(let s=0;s<i;++s){const i=n.fromArray(e[s]),o=new h(t);t.vertices.push(o),o.pos=i,o.index=s}const o=t.vertices.length-1;for(let e=0;e<o;++e){const n=t.vertices[e],s=t.vertices[e+1],i=new l(t,n,s);t.edges.push(i)}s.components.push(t)}break;case"point":{const e=new u(s),n=new h(e);n.index=0,n.pos=s.coordinateHelper.fromPoint(t),e.vertices.push(n),s.components.push(e)}}return s},e._createClass(o,[{key:"canUndo",get:function(){return this.undoStack.length>0}},{key:"lastOperation",get:function(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}},{key:"canRedo",get:function(){return this.redoStack.length>0}}]),o}(r);t.Component=u,t.Edge=l,t.EditGeometry=a,t.Vertex=h,Object.defineProperty(t,"__esModule",{value:!0})}));
