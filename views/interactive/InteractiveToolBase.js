/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Accessor","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../DOMContainer","./interfaces","./ManipulatorCollection"],(function(t,e,i,o,a,n,r,s,l,c,u,h,d,p,v){"use strict";const _=a.getLogger("esri.views.interactive.InteractiveToolBase");t.InteractiveToolBase=function(t){function i(e){var i;return(i=t.call(this,e)||this).manipulators=new v.ManipulatorCollection,i.updating=!1,i.automaticManipulatorSelection=!0,i._editableFlags=new Map([[p.EditableFlag.MANAGER,!0],[p.EditableFlag.USER,!0]]),i._creationStartedResolver=r.createResolver(),i._creationFinishedResolver=r.createResolver(),i}e._inheritsLoose(i,t);var o=i.prototype;return o.initialize=function(){this._syncVisible()},o.destroy=function(){this.manipulators.destroy(),this._set("view",null)},o.activate=function(){n.isNone(this.view)?_.error("Can't activate tool if view is not defined."):(d.isDOMContainer(this.view)&&this.view.focus(),this.onActivate())},o.deactivate=function(){this.onDeactivate()},o.handleInputEvent=function(t){this.onInputEvent(t)},o.handleInputEventAfter=function(t){this.onInputEventAfter(t)},o.setEditableFlag=function(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===p.EditableFlag.USER&&this.notifyChange("editable"),this.onEditableChange()},o.getEditableFlag=function(t){return this._editableFlags.get(t)},o.whenCreationStarted=function(){return this._creationStartedResolver.promise},o.whenCreated=function(){return this._creationFinishedResolver.promise},o.rejectCreation=function(t){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(t)},o.onActivate=function(){},o.onDeactivate=function(){},o.onShow=function(){},o.onHide=function(){},o.onEditableChange=function(){},o.onInputEvent=function(t){},o.onInputEventAfter=function(t){},o.startToolCreation=function(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error(`Unexpected tool state ${this.toolState}`)},o.finishToolCreation=function(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error(`Unexpected tool state ${this.toolState}`)}},o._syncVisible=function(){if("pending"!==this.toolState)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)},o._show=function(){this._updateManipulatorAttachment(),this.onShow()},o._hide=function(){this._updateManipulatorAttachment(),this.onHide()},o._updateManipulatorAttachment=function(){this.visible?this.manipulators.attach():this.manipulators.detach()},e._createClass(i,[{key:"toolState",set:function(t){this._set("toolState",t),this._syncVisible()}},{key:"active",get:function(){return null!=this.view&&this.view.activeTool===this}},{key:"visible",set:function(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}},{key:"editable",get:function(){return this.getEditableFlag(p.EditableFlag.USER)},set:function(t){this.setEditableFlag(p.EditableFlag.USER,t)}},{key:"created",get:function(){return"created"===this.toolState}},{key:"cursor",get:function(){return null}},{key:"internallyEditable",get:function(){return this.getEditableFlag(p.EditableFlag.USER)&&this.getEditableFlag(p.EditableFlag.MANAGER)}}]),i}(o),i.__decorate([s.property({value:"pending"})],t.InteractiveToolBase.prototype,"toolState",null),i.__decorate([s.property({constructOnly:!0})],t.InteractiveToolBase.prototype,"view",void 0),i.__decorate([s.property({readOnly:!0})],t.InteractiveToolBase.prototype,"active",null),i.__decorate([s.property({value:!0})],t.InteractiveToolBase.prototype,"visible",null),i.__decorate([s.property({value:!0})],t.InteractiveToolBase.prototype,"editable",null),i.__decorate([s.property({readOnly:!0})],t.InteractiveToolBase.prototype,"created",null),i.__decorate([s.property({readOnly:!0})],t.InteractiveToolBase.prototype,"manipulators",void 0),i.__decorate([s.property({readOnly:!0})],t.InteractiveToolBase.prototype,"updating",void 0),i.__decorate([s.property()],t.InteractiveToolBase.prototype,"cursor",null),i.__decorate([s.property()],t.InteractiveToolBase.prototype,"automaticManipulatorSelection",void 0),t.InteractiveToolBase=i.__decorate([h.subclass("esri.views.interactive.InteractiveToolBase")],t.InteractiveToolBase),Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
