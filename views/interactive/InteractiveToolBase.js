/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Accessor","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../DOMContainer","./ManipulatorCollection"],(function(t,e,o,i,a,n,r,s,c,l,h,d,u,p){"use strict";const v=a.getLogger("esri.views.interactive.InteractiveToolBase");t.InteractiveToolBase=function(t){function o(e){var o;return(o=t.call(this,e)||this).toolState="pending",o.completed=!1,o.manipulators=new p.ManipulatorCollection,o.updating=!1,o.automaticManipulatorSelection=!0,o._editableFlags=new Map([[1,!0],[0,!0]]),o._creationStartedResolver=r.createResolver(),o._creationFinishedResolver=r.createResolver(),o}e._inheritsLoose(o,t);var i=o.prototype;return i.attach=function(){this.attached?v.warn("Tool is already attached. Ignoring attach request."):(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))},i.detach=function(){this.attached?(this.visible&&this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1)):v.error("Tool isn't currently attached. Ignoring detach request.")},i.activate=function(){n.isNone(this.view)?v.error("Can't activate tool if view is not defined."):this.active?v.warn("Tool is already active, ignoring activation request."):(u.isDOMContainer(this.view)&&this.view.focus(),this.onActivate())},i.deactivate=function(){this.active?this.onDeactivate():v.warn("Tool is not active, ignoring deactivation request.")},i.handleInputEvent=function(t){this.attached?this.onInputEvent(t):v.warn("handleInputEvent() called on detached tool")},i.handleInputEventAfter=function(t){this.attached?this.onInputEventAfter(t):v.warn("handleInputEventAfter() called on detached tool")},i.destroy=function(){this.manipulators.destroy(),this._set("view",null),this._set("completed",!1)},i.setEditableFlag=function(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),0===t&&this.notifyChange("editable"),this.onEditableChange()},i.getEditableFlag=function(t){return this._editableFlags.get(t)},i.whenCreationStarted=function(){return this._creationStartedResolver.promise},i.whenCreated=function(){return this._creationFinishedResolver.promise},i.rejectCreation=function(t){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(t)},i.onActivate=function(){},i.onDeactivate=function(){},i.onAttach=function(){},i.onDetach=function(){},i.onShow=function(){},i.onHide=function(){},i.onEditableChange=function(){},i.onInputEvent=function(t){},i.onInputEventAfter=function(t){},i.startToolCreation=function(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error(`Unexpected tool state ${this.toolState}`)},i.finishToolCreation=function(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error(`Unexpected tool state ${this.toolState}`)}},i.complete=function(){this.finishToolCreation(),this._set("completed",!0)},i._show=function(){this._updateManipulatorAttachment(),this.onShow()},i._hide=function(){this._updateManipulatorAttachment(),this.onHide()},i._updateManipulatorAttachment=function(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()},e._createClass(o,[{key:"active",get:function(){return null!=this.view&&this.view.activeTool===this}},{key:"visible",set:function(t){this._set("visible",t),t||this.active&&(this.view.activeTool=null),this.attached&&(t?this._show():this._hide())}},{key:"editable",get:function(){return this.getEditableFlag(0)},set:function(t){this.setEditableFlag(0,t)}},{key:"attached",get:function(){return this._get("attached")}},{key:"created",get:function(){return"created"===this.toolState}},{key:"cursor",get:function(){return null}},{key:"internallyEditable",get:function(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}}]),o}(i),o.__decorate([s.property()],t.InteractiveToolBase.prototype,"toolState",void 0),o.__decorate([s.property({constructOnly:!0})],t.InteractiveToolBase.prototype,"view",void 0),o.__decorate([s.property({readOnly:!0})],t.InteractiveToolBase.prototype,"active",null),o.__decorate([s.property({value:!0})],t.InteractiveToolBase.prototype,"visible",null),o.__decorate([s.property({value:!0})],t.InteractiveToolBase.prototype,"editable",null),o.__decorate([s.property({value:!1,readOnly:!0})],t.InteractiveToolBase.prototype,"attached",null),o.__decorate([s.property({readOnly:!0})],t.InteractiveToolBase.prototype,"created",null),o.__decorate([s.property({readOnly:!0})],t.InteractiveToolBase.prototype,"completed",void 0),o.__decorate([s.property({readOnly:!0})],t.InteractiveToolBase.prototype,"manipulators",void 0),o.__decorate([s.property({readOnly:!0})],t.InteractiveToolBase.prototype,"updating",void 0),o.__decorate([s.property()],t.InteractiveToolBase.prototype,"cursor",null),o.__decorate([s.property()],t.InteractiveToolBase.prototype,"automaticManipulatorSelection",void 0),t.InteractiveToolBase=o.__decorate([d.subclass("esri.views.interactive.InteractiveToolBase")],t.InteractiveToolBase),Object.defineProperty(t,"__esModule",{value:!0})}));
