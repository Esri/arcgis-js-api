/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/lang","../../core/maybe","../../core/handleUtils","../../geometry/support/webMercatorUtils","../../core/mathUtils","../../core/screenUtils","../draw/support/drawUtils"],(function(e,t,n,r,a,o,c,s){"use strict";function l(e,t){let r=null,a=null;return o=>{if("cancel"===o.action)return void(n.isSome(a)&&(a.execute({action:"cancel"}),r=null,a=null));const c={action:o.action,screenStart:o.start,screenEnd:o.screenPoint};"start"===o.action&&n.isNone(r)&&(r=new D,a=new D,t(e,r,a,o.pointerType,c)),n.isSome(r)&&r.execute(c),"end"===o.action&&n.isSome(r)&&(r=null,a=null)}}function i(e,t){return e.events.on("drag",l(e,t))}function u(e,t){const n=[];for(const r of e)n.push(i(r,t));return r.handlesGroup(n)}function p(e,t){const n=[e.x,e.y,e.z],r=t,a=[Math.cos(r),Math.sin(r)],o=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===o)return null;a[0]/=o,a[1]/=o;const c=e=>{const t=(e.x-n[0])*a[0]+(e.y-n[1])*a[1];e.x=n[0]+t*a[0],e.y=n[1]+t*a[1]};return e=>(c(e.mapStart),c(e.mapEnd),e)}function m(e,t){let r=null;const o=n.isSome(e[t])?e[t].spatialReference:null;function c(e,t){return n.isNone(e)||"mesh"===e.type?null:e.spatialReference.equals(t)?e.clone():a.canProject(e,t)?a.project(e,t):null}return l=>{if("start"===l.action&&n.isSome(e[t])&&(r=c(e[t],l.mapStart.spatialReference)),n.isNone(r))return null;const i=l.mapEnd.x-l.mapStart.x,u=l.mapEnd.y-l.mapStart.y,p=l.mapEnd.z-l.mapStart.z,m=s.move(r.clone(),i,u,p);return m.spatialReference.equals(o)?e[t]=m:e[t]=a.project(m,o),{...l,translationX:i,translationY:u,translationZ:p}}}function d(e){return m(e,"geometry")}function f(e,t=null,r){let o=null;const c=n.isSome(t)&&!e.spatialReference.equals(t)?e=>n.isSome(e)?a.project(e,t):e:e=>e,s={exclude:[],...r};return t=>{if("start"===t.action&&(o=c(e.toMap(t.screenStart,s))),n.isNone(o))return null;const r=c(e.toMap(t.screenEnd,s));return n.isSome(r)?{...t,mapStart:o,mapEnd:r}:null}}function S(e){const t=e.map((e=>n.unwrap(d(e)))).filter((e=>n.isSome(e)));return e=>{const n=e.mapEnd.x-e.mapStart.x,r=e.mapEnd.y-e.mapStart.y,a=e.mapEnd.z-e.mapStart.z;return t.forEach((t=>t(e))),{...e,translationX:n,translationY:r,translationZ:a}}}function y(e,n){const r=new Map;for(const a of n)r.set(a,t.clone(e[a]));return t=>(r.forEach(((t,n)=>{e[n]=t})),t)}function E(e){return y(e,["geometry"])}function x(e){const t=e.map((e=>n.unwrap(E(e)))).filter((e=>n.isSome(e)));return e=>(t.forEach((t=>t(e))),e)}function h(e){const t=n.isSome(e.symbol)?e.symbol.clone():null;return n=>(e.symbol=t,n)}function M(){let e=0,t=0,n=0;return r=>{"start"===r.action&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z);const a=r.mapEnd.x-e,o=r.mapEnd.y-t,c=r.mapEnd.z-n;return e=r.mapEnd.x,t=r.mapEnd.y,n=r.mapEnd.z,{...r,mapDeltaX:a,mapDeltaY:o,mapDeltaZ:c,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function g(){let e=0,t=0;return n=>{"start"===n.action&&(e=n.screenStart.x,t=n.screenStart.y);const r=n.screenEnd.x-e,a=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:r,screenDeltaY:a}}}function w(e,t){let n=null,r=0,a=0;return s=>{if("start"===s.action&&(n=e.toScreen(t),n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(r=s.screenStart.x-n.x,a=s.screenStart.y-n.y)),null==n)return null;const l=o.clamp(s.screenEnd.x-r,0,e.width),i=o.clamp(s.screenEnd.y-a,0,e.height),u=c.createScreenPoint(l,i);return s.screenStart=n,s.screenEnd=u,s}}let D=function(){function e(){this.execute=()=>{}}return e.prototype.next=function(t,r=new e){return n.isSome(t)&&(this.execute=e=>{const a=t(e);n.isSome(a)&&r.execute(a)}),r},e}();e.EventPipeline=D,e.addMapDelta=M,e.addScreenDelta=g,e.constrainToMapAxis=p,e.createDragEventPipelineCallback=l,e.createManipulatorDragEventPipeline=i,e.createManipulatorDragEventPipelineMany=u,e.dragAtLocation=w,e.dragGeometry=m,e.dragGraphic=d,e.dragGraphicMany=S,e.resetGraphic=E,e.resetGraphicMany=x,e.resetProperties=y,e.resetSymbol=h,e.screenToMap=f,Object.defineProperty(e,"__esModule",{value:!0})}));
