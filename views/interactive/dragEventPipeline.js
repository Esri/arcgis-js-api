// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../../core/handleUtils","../../core/lang","../../core/mathUtils","../../core/maybe","../../core/screenUtils","../../geometry/support/webMercatorUtils","../draw/support/drawUtils"],(function(e,n,r,t,a,i,o,c,s,l){"use strict";function u(e,n){var r=null,t=null;return function(a){if("cancel"!==a.action){var i={action:a.action,screenStart:a.start,screenEnd:a.screenPoint};"start"===a.action&&o.isNone(r)&&(r=new g,t=new g,n(e,r,t,i)),o.isSome(r)&&r.execute(i),"end"===a.action&&o.isSome(r)&&(r=null,t=null)}else o.isSome(t)&&(t.execute({action:"cancel"}),r=null,t=null)}}function p(e,n){return e.events.on("drag",u(e,n))}function f(e,n){var t=null,a=o.isSome(e[n])?e[n].spatialReference:null;return function(i){var c,u;if("start"===i.action&&o.isSome(e[n])&&(c=e[n],u=i.mapStart.spatialReference,t=o.isNone(c)||"mesh"===c.type?null:c.spatialReference.equals(u)?c.clone():s.canProject(c,u)?s.project(c,u):null),o.isNone(t))return null;var p=i.mapEnd.x-i.mapStart.x,f=i.mapEnd.y-i.mapStart.y,m=i.mapEnd.z-i.mapStart.z,d=l.move(t.clone(),p,f,m);return d.spatialReference.equals(a)?e[n]=d:e[n]=s.project(d,a),r.__assign(r.__assign({},i),{translationX:p,translationY:f,translationZ:m})}}function m(e){return f(e,"geometry")}function d(e,n){for(var r=new Map,t=0,i=n;t<i.length;t++){var o=i[t];r.set(o,a.clone(e[o]))}return function(n){return r.forEach((function(n,r){e[r]=n})),n}}function v(e){return d(e,["geometry"])}Object.defineProperty(n,"__esModule",{value:!0}),n.EventPipeline=n.dragAtLocation=n.addScreenDelta=n.addMapDelta=n.allDegreesOfFreedom=n.verticalDegreesOfFreedom=n.horizontalDegreesOfFreedom=n.resetSymbol=n.resetGraphicMany=n.resetGraphic=n.resetProperties=n.dragGraphicMany=n.screenToMap=n.dragGraphic=n.dragGeometry=n.constrainToMapAxis=n.createManipulatorDragEventPipelineMany=n.createManipulatorDragEventPipeline=n.createDragEventPipelineCallback=void 0,n.createDragEventPipelineCallback=u,n.createManipulatorDragEventPipeline=p,n.createManipulatorDragEventPipelineMany=function(e,n){for(var r=[],a=0,i=e;a<i.length;a++){var o=i[a];r.push(p(o,n))}return t.handlesGroup(r)},n.constrainToMapAxis=function(e,n){var r=[e.x,e.y,e.z],t=n,a=[Math.cos(t),Math.sin(t)],i=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===i)return null;a[0]/=i,a[1]/=i;var o=function(e){var n=(e.x-r[0])*a[0]+(e.y-r[1])*a[1];e.x=r[0]+n*a[0],e.y=r[1]+n*a[1]};return function(e){return o(e.mapStart),o(e.mapEnd),e}},n.dragGeometry=f,n.dragGraphic=m,n.screenToMap=function(e,n,t){void 0===n&&(n=null);var a=null,i=o.isSome(n)&&!e.spatialReference.equals(n)?function(e){return o.isSome(e)?s.project(e,n):e}:function(e){return e},c=r.__assign({exclude:[]},t);return function(n){if("start"===n.action&&(a=i(e.toMap(n.screenStart,c))),o.isNone(a))return null;var t=i(e.toMap(n.screenEnd,c));return o.isSome(t)?r.__assign(r.__assign({},n),{mapStart:a,mapEnd:t}):null}},n.dragGraphicMany=function(e){var n=e.map((function(e){return o.unwrap(m(e))})).filter((function(e){return o.isSome(e)}));return function(e){var t=e.mapEnd.x-e.mapStart.x,a=e.mapEnd.y-e.mapStart.y,i=e.mapEnd.z-e.mapStart.z;return n.forEach((function(n){return n(e)})),r.__assign(r.__assign({},e),{translationX:t,translationY:a,translationZ:i})}},n.resetProperties=d,n.resetGraphic=v,n.resetGraphicMany=function(e){var n=e.map((function(e){return o.unwrap(v(e))})).filter((function(e){return o.isSome(e)}));return function(e){return n.forEach((function(n){return n(e)})),e}},n.resetSymbol=function(e){var n=o.isSome(e.symbol)?e.symbol.clone():null;return function(r){return e.symbol=n,r}},n.horizontalDegreesOfFreedom=3,n.verticalDegreesOfFreedom=4,n.allDegreesOfFreedom=7,n.addMapDelta=function(e){void 0===e&&(e=n.allDegreesOfFreedom);var t=0,a=0,i=0;return function(n){"start"===n.action&&(t=n.mapStart.x,a=n.mapStart.y,i=n.mapStart.z);var o=1&e?n.mapEnd.x-t:0,c=2&e?n.mapEnd.y-a:0,s=4&e?n.mapEnd.z-i:0;return t=n.mapEnd.x,a=n.mapEnd.y,i=n.mapEnd.z,r.__assign(r.__assign({},n),{mapDeltaX:o,mapDeltaY:c,mapDeltaZ:s,mapDeltaSpatialReference:n.mapStart.spatialReference})}},n.addScreenDelta=function(e){void 0===e&&(e=n.allDegreesOfFreedom);var t=0,a=0;return function(n){"start"===n.action&&(t=n.screenStart.x,a=n.screenStart.y);var i=1&e?n.screenEnd.x-t:0,o=2&e?n.screenEnd.y-a:0;return t=n.screenEnd.x,a=n.screenEnd.y,r.__assign(r.__assign({},n),{screenDeltaX:i,screenDeltaY:o})}},n.dragAtLocation=function(e,n){var r=null,t=0,a=0;return function(o){if("start"===o.action&&((r=e.toScreen(n)).x<0||r.x>e.width||r.y<0||r.y>e.height?r=null:(t=o.screenStart.x-r.x,a=o.screenStart.y-r.y)),null==r)return null;var s=i.clamp(o.screenEnd.x-t,0,e.width),l=i.clamp(o.screenEnd.y-a,0,e.height),u=c.createScreenPoint(s,l);return o.screenStart=r,o.screenEnd=u,o}};var g=function(){function e(){this.execute=function(){}}return e.prototype.next=function(n,r){return void 0===r&&(r=new e),o.isSome(n)&&(this.execute=function(e){var t=n(e);o.isSome(t)&&r.execute(t)}),r},e}();n.EventPipeline=g}));