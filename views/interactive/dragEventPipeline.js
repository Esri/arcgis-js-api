/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../core/handleUtils","../../core/lang","../../core/mathUtils","../../core/maybe","../../core/screenUtils","../../chunks/vec3f64","../../geometry/projection","../draw/support/drawUtils"],(function(e,t,n,r,a,o,c,i,s){"use strict";function l(e,t){let n=null,r=null;return o=>{if("cancel"===o.action)return void(a.isSome(r)&&(r.execute({action:"cancel"}),n=null,r=null));const c={action:o.action,screenStart:o.start,screenEnd:o.screenPoint};"start"===o.action&&a.isNone(n)&&(n=new G,r=new G,t(e,n,r,o.pointerType,c)),a.isSome(n)&&n.execute(c),"end"===o.action&&a.isSome(n)&&(n=null,r=null)}}function u(e,t){return e.events.on("drag",l(e,t))}function p(e,n){const r=[];for(const t of e)r.push(u(t,n));return t.handlesGroup(r)}function m(e,t){const n=[e.x,e.y,e.z],r=t,a=[Math.cos(r),Math.sin(r)],o=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===o)return null;a[0]/=o,a[1]/=o;const c=e=>{const t=(e.x-n[0])*a[0]+(e.y-n[1])*a[1];e.x=n[0]+t*a[0],e.y=n[1]+t*a[1]};return e=>(c(e.mapStart),c(e.mapEnd),e)}function f(e,t){let n=null;return r=>{if("start"===r.action&&(n=y(e,r.mapStart.spatialReference,t)),a.isNone(n))return null;const o=r.mapEnd.x-r.mapStart.x,c=r.mapEnd.y-r.mapStart.y,i=r.mapEnd.z-r.mapStart.z;return n.move(o,c,i),{...r,translationX:o,translationY:c,translationZ:i}}}function d(e,t){return a.isNone(e)?null:e.spatialReference.equals(t)?e.clone():i.project(e,t)}function y(e,t,n){const r=e.geometry;if(a.isNone(r))return null;if("mesh"===r.type)return S(e,r,t,n);const o=d(r,t),c=r.spatialReference;return a.isNone(o)?null:{move:(t,n,r)=>{const a=s.move(o.clone(),t,n,r);a.spatialReference.equals(c)?e.geometry=a:e.geometry=i.project(a,c)}}}function S(e,t,n,r){if(a.isSome(t.transform))return x(e,t,t.transform,n);if(!t.spatialReference.equals(n))return null;let o=0,c=0,i=0;return{move:(n,a,s)=>{const l=n-o,u=a-c,p=s-i;if(l||u||p){const m=t.origin.clone().offset(l,u,p);t.centerAt(m,{geographic:1===r}),e.notifyGeometryChanged(),o=n,c=a,i=s}}}}function x(e,t,n,r){const o=d(n.getOriginPoint(t.spatialReference),r),l=t.spatialReference;return a.isNone(o)?null:{move:(t,r,u)=>{const p=s.move(o.clone(),t,r,u);if(p.spatialReference.equals(l))n.origin=c.fromValues(p.x,p.y,p.z);else{const e=i.project(p,l);a.isSome(e)&&(n.origin=c.fromValues(e.x,e.y,e.z))}e.notifyGeometryChanged()}}}function E(e,t=null,n){let r=null;const o=a.isSome(t)&&!e.spatialReference.equals(t)?e=>a.isSome(e)?i.project(e,t):e:e=>e,c={exclude:[],...n};return t=>{if("start"===t.action&&(r=o(e.toMap(t.screenStart,c))),a.isNone(r))return null;const n=o(e.toMap(t.screenEnd,c));return a.isSome(n)?{...t,mapStart:r,mapEnd:n}:null}}function h(e,t){const n=e.map((e=>a.unwrap(f(e,t)))).filter((e=>a.isSome(e)));return e=>{const t=e.mapEnd.x-e.mapStart.x,r=e.mapEnd.y-e.mapStart.y,a=e.mapEnd.z-e.mapStart.z;return n.forEach((t=>t(e))),{...e,translationX:t,translationY:r,translationZ:a}}}function g(e,t){const r=new Map;for(const a of t)r.set(a,n.clone(e[a]));return t=>(r.forEach(((t,n)=>{e[n]=t})),t)}function v(e){return a.isSome(e.geometry)&&"mesh"===e.geometry.type?M(e,e.geometry):g(e,["geometry"])}function M(e,t){const n=a.isSome(t.transform)?t.transform.clone():null,r=t.vertexAttributes.clonePositional();return a=>(t.transform=n,t.vertexAttributes=r,e.notifyGeometryChanged(),a)}function D(e){const t=e.map((e=>a.unwrap(v(e)))).filter((e=>a.isSome(e)));return e=>(t.forEach((t=>t(e))),e)}function R(e){return g(e,["symbol"])}function w(){let e=0,t=0,n=0;return r=>{"start"===r.action&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z);const a=r.mapEnd.x-e,o=r.mapEnd.y-t,c=r.mapEnd.z-n;return e=r.mapEnd.x,t=r.mapEnd.y,n=r.mapEnd.z,{...r,mapDeltaX:a,mapDeltaY:o,mapDeltaZ:c,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function z(){let e=0,t=0;return n=>{"start"===n.action&&(e=n.screenStart.x,t=n.screenStart.y);const r=n.screenEnd.x-e,a=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:r,screenDeltaY:a}}}function P(e,t){let n=null,a=0,c=0;return i=>{if("start"===i.action&&(n=e.toScreen(t),n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(a=i.screenStart.x-n.x,c=i.screenStart.y-n.y)),null==n)return null;const s=r.clamp(i.screenEnd.x-a,0,e.width),l=r.clamp(i.screenEnd.y-c,0,e.height),u=o.createScreenPoint(s,l);return i.screenStart=n,i.screenEnd=u,i}}let G=function(){function e(){this.execute=()=>{}}return e.prototype.next=function(t,n=new e){return a.isSome(t)&&(this.execute=e=>{const r=t(e);a.isSome(r)&&n.execute(r)}),n},e}();e.EventPipeline=G,e.addMapDelta=w,e.addScreenDelta=z,e.constrainToMapAxis=m,e.createDragEventPipelineCallback=l,e.createManipulatorDragEventPipeline=u,e.createManipulatorDragEventPipelineMany=p,e.dragAtLocation=P,e.dragGraphic=f,e.dragGraphicMany=h,e.resetGraphic=v,e.resetGraphicMany=D,e.resetProperties=g,e.resetSymbol=R,e.screenToMap=E,Object.defineProperty(e,"__esModule",{value:!0})}));
