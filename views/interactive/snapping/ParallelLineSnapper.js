/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec2","../../../chunks/vec2f64","../../../support/elevationInfoUtils","./Settings","./SnappingAlgorithm","./snappingUtils","./candidates/ParallelLineSnappingCandidate","../support/viewUtils","../../support/geometry2dUtils"],(function(e,t,n,i,o,r,a,s,l,c,d,h){"use strict";let p=function(e){function o(){return e.apply(this,arguments)||this}t._inheritsLoose(o,e);var s=o.prototype;return s.snapNewVertex=function(e,t){const n=t.editGeometryOperations.data.components[0],i=n.edges.length,o=n.vertices.length,a=[];if(i<2)return a;const{view:s}=this,c=d.anyMapPointToScreenPoint(e,t.coordinateHelper,r.absoluteHeightElevationInfo,s),h=l.convertPointElevation(n.vertices[o-1].pos,s,t),p=l.convertPointElevation(n.vertices[0].pos,s,t),g=n.edges[i-1];let u=g;do{if(this.edgeExceedsShortLineThreshold(u,t)){const n=l.editEdgeToSnappingEdge(u,s,t);this._checkEdgeForParalleLines(n,h,e,c,t,a),this._checkEdgeForParalleLines(n,p,e,c,t,a)}u=u.leftVertex.leftEdge}while(u&&u!==g);return a},s.snapExistingVertex=function(e,t){const i=[],o=n.unwrap(t.vertexHandle),a=o.component;if(a.edges.length<3)return i;const{view:s}=this,c=d.anyMapPointToScreenPoint(e,t.coordinateHelper,r.absoluteHeightElevationInfo,s),h=o.leftEdge,p=o.rightEdge,g=a.vertices[0],u=l.convertPointElevation(g.pos,s,t),f=a.vertices.length,v=a.vertices[f-1],P=l.convertPointElevation(v.pos,s,t),E=a.edges[0];let L=E;do{if(L!==h&&L!==p&&this.edgeExceedsShortLineThreshold(L,t)){const n=l.editEdgeToSnappingEdge(L,s,t);h&&this._checkEdgeForParalleLines(n,l.convertPointElevation(h.leftVertex.pos,s,t),e,c,t,i),p&&this._checkEdgeForParalleLines(n,l.convertPointElevation(p.rightVertex.pos,s,t),e,c,t,i),o===g?this._checkEdgeForParalleLines(n,P,e,c,t,i):o===v&&this._checkEdgeForParalleLines(n,u,e,c,t,i)}L=L.rightVertex.rightEdge}while(L&&L!==E);return i},s._checkEdgeForParalleLines=function(e,t,n,o,s,p){const u=e.left,f=e.right;if(h.projectPointToLine(g,t,u,f),i.squaredDistance(g,t)<a.defaults.parallelLineThreshold)return;h.projectPointToLine(g,n,u,f,t);const{coordinateHelper:v,pointer:P}=s,E=v.fromXYZ(g,v.getZ(n,0));if(l.squaredScreenDistance(o,d.anyMapPointToScreenPoint(E,v,r.absoluteHeightElevationInfo,this.view))<this.squaredProximityThreshold(P)){if(this._parallelToPreviousCandidate(e,p))return;p.push(new c.ParallelLineSnappingCandidate({coordinateHelper:v,referenceLine:e,lineStart:t,targetPoint:E,elevationInfo:v.hasZ()?r.absoluteHeightElevationInfo:null}))}},s._parallelToPreviousCandidate=function(e,t){const n=e.left,o=e.right;for(const r of t)if(h.projectPointToLine(g,o,r.constraint.start,r.constraint.end,n),i.squaredDistance(g,o)<a.defaults.parallelLineThreshold)return r.addReferenceLine(e),!0;return!1},o}(s.SnappingAlgorithm);const g=o.create();e.ParallelLineSnapper=p,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
