/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec2f64","../../../chunks/vec2","./Settings","./snappingUtils","./SnappingAlgorithm","../../support/geometry2dUtils","./candidates/ParallelLineSnappingCandidate"],(function(e,t,n,i,r,o,s,a,l,c){"use strict";let p=function(e){function a(){var t;return(t=e.apply(this,arguments)||this)._tmpProjection=i.create(),t}t._inheritsLoose(a,e);var p=a.prototype;return p.snapNewVertex=function(e,t){const n=t.geometry.editGeometry.components[0],i=n.edges.length,r=n.vertices.length,o=[];if(i<2)return o;const a=s.anyMapPointToScreenPoint(e,t.coordinateHelper,t.elevationInfo,this.view),l=n.vertices[r-1],c=n.vertices[0],p=n.edges[i-1];let h=p;do{this.edgeExceedsShortLineThreshold(h,t)&&(this._checkEdgeForParalleLines(h,l.pos,e,a,t,o),this._checkEdgeForParalleLines(h,c.pos,e,a,t,o)),h=h.left.left}while(h&&h!==p);return o},p.snapExistingVertex=function(e,t){const i=[],r=n.unwrap(t.vertexHandle),o=r.component;if(o.edges.length<3)return i;const a=s.anyMapPointToScreenPoint(e,t.coordinateHelper,t.elevationInfo,this.view),l=r.left,c=r.right,p=o.vertices[0],h=o.vertices.length,d=o.vertices[h-1],g=o.edges[0];let u=g;do{u!==l&&u!==c&&this.edgeExceedsShortLineThreshold(u,t)&&(l&&this._checkEdgeForParalleLines(u,l.left.pos,e,a,t,i),c&&this._checkEdgeForParalleLines(u,c.right.pos,e,a,t,i),r===p?this._checkEdgeForParalleLines(u,d.pos,e,a,t,i):r===d&&this._checkEdgeForParalleLines(u,p.pos,e,a,t,i)),u=u.right.right}while(u&&u!==g);return i},p._checkEdgeForParalleLines=function(e,t,n,i,a,p){const h=e.left.pos,d=e.right.pos;if(l.projectPointToLine(this._tmpProjection,t,h,d),r.squaredDistance(this._tmpProjection,t)<o.defaults.parallelLineThreshold)return;l.projectPointToLine(this._tmpProjection,n,h,d,t);const g=a.coordinateHelper,u=g.fromXYZ(this._tmpProjection,g.getZ(n,0));if(s.squareDistance(i,s.anyMapPointToScreenPoint(u,g,a.elevationInfo,this.view))<this.squaredProximityTreshold(a.pointer)){if(this.parallelToPreviousCandidate(e,p))return;p.push(new c.ParallelLineSnappingCandidate({coordinateHelper:g,referenceLine:e,lineStart:t,targetPoint:u}))}},p.parallelToPreviousCandidate=function(e,t){const n=e.left.pos,i=e.right.pos;for(const s of t)if(l.projectPointToLine(this._tmpProjection,i,s.constraint.start,s.constraint.end,n),r.squaredDistance(this._tmpProjection,i)<o.defaults.parallelLineThreshold)return s.addReferenceLine(e),!0;return!1},a}(a.SnappingAlgorithm);e.ParallelLineSnapper=p,Object.defineProperty(e,"__esModule",{value:!0})}));
