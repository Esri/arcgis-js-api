/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/HandleOwner","../../../../core/handleUtils","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/accessorSupport/decorators/subclass","../../../3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle","./sceneLayerSource/SceneLayerSnappingSourceWorkerHandle"],(function(e,r,t,n,o,i,a,s,c,d,p,l,u){"use strict";e.I3SSnappingSource=function(e){function t(r){var t;return(t=e.call(this,r)||this).availability=1,t._abortController=new AbortController,t}r._inheritsLoose(t,e);var n=t.prototype;return n.destroy=function(){this._tracker=i.removeMaybe(this._tracker),this._abortController=i.abortMaybe(this._abortController)},n.initialize=function(){var e=this;const{view:t}=this,n=t.resourceController;var a;this._edgeWorker=new l.EdgeWorkerHandle((e=>n.immediate.schedule(e))),this._workerHandle=new u.SceneLayerSnappingSourceWorkerHandle({renderCoordsHelper:this.view.renderCoordsHelper,schedule:e=>n.immediate.schedule(e),fetchEdgeLocations:(a=r._asyncToGenerator((function*(r,t){if(i.isNone(e._tracker))throw new Error("tracker-not-initialized");return e._tracker.fetchEdgeLocations(r,e._edgeWorker,t)})),function(e,r){return a.apply(this,arguments)})}),this.updatingHandles.addPromise(this._setupLayerView()),this.handles.add([o.destroyHandle(this._workerHandle),o.destroyHandle(this._edgeWorker)])},n.fetchCandidates=function(){var e=r._asyncToGenerator((function*(e,r){return this._workerHandle.fetchCandidates(e,r)}));function t(r,t){return e.apply(this,arguments)}return t}(),n.refresh=function(){},n._setupLayerView=function(){var e=r._asyncToGenerator((function*(){if(this.destroyed)return;const e=i.applySome(this._abortController,(e=>e.signal)),r=yield this.getLayerView();i.isNone(r)||a.isAborted(e)||(this._tracker=r.trackSnappingSources({add:(r,t)=>{this.updatingHandles.addPromise(this._workerHandle.add({id:r,bounds:t},e))},remove:r=>{this.updatingHandles.addPromise(this._workerHandle.remove({id:r},e))}}))}));function t(){return e.apply(this,arguments)}return t}(),r._createClass(t,[{key:"updating",get:function(){return this.updatingHandles.updating}}]),t}(n.HandleOwner),t.__decorate([s.property({constructOnly:!0})],e.I3SSnappingSource.prototype,"getLayerView",void 0),t.__decorate([s.property({constructOnly:!0})],e.I3SSnappingSource.prototype,"view",void 0),t.__decorate([s.property({readOnly:!0})],e.I3SSnappingSource.prototype,"updating",null),t.__decorate([s.property({readOnly:!0})],e.I3SSnappingSource.prototype,"availability",void 0),e.I3SSnappingSource=t.__decorate([p.subclass("esri.views.interactive.snapping.featureSources.I3SSnappingSource")],e.I3SSnappingSource),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
