/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/promiseUtils","../../../../../core/asyncUtils","../../../../../geometry/support/aaBoundingRect"],(function(t,e,s,r,a,n){"use strict";let u=function(){function t(t,e){this.data=t,this.resolution=e,this.state={type:0},this.alive=!0}var u=t.prototype;return u.process=function(t){switch(this.state.type){case 0:return this.state=this.gotoFetchCount(this.state,t),this.state.task.promise.then(t.resume,t.resume);case 1:break;case 2:return this.state=this.gotoFetchFeatures(this.state,t),this.state.task.promise.then(t.resume,t.resume);case 3:break;case 4:this.state=this.goToDone(this.state,t)}return null},u.gotoFetchCount=function(t,e){return{type:1,previous:t,task:r.createTask((async t=>{const s=await a.resultOrAbort(e.fetchCount(this,t));1===this.state.type&&(this.state=this.gotoFetchedCount(this.state,s.ok?s.value:1/0))}))}},u.gotoFetchedCount=function(t,e){return{type:2,featureCount:e,previous:t}},u.gotoFetchFeatures=function(t,e){return{type:3,previous:t,task:r.createTask((async s=>{const r=await a.resultOrAbort(e.fetchFeatures(this,t.featureCount,s));3===this.state.type&&(this.state=this.gotoFetchedFeatures(this.state,r.ok?r.value:[]))}))}},u.gotoFetchedFeatures=function(t,e){return{type:4,previous:t,features:e}},u.goToDone=function(t,e){return e.finish(this,t.features),{type:5,previous:t}},u.reset=function(){const t=this.state;switch(this.state={type:0},t.type){case 0:case 2:case 4:case 5:break;case 1:case 3:t.task.abort()}},u.intersects=function(t){return!(!s.isNone(t)&&this.data.extent)||(n.fromExtent(t,o),n.intersects(this.data.extent,o))},e._createClass(t,[{key:"debugInfo",get:function(){return{data:this.data,featureCount:this.featureCount,state:this.stateToString}}},{key:"featureCount",get:function(){switch(this.state.type){case 0:case 1:return 0;case 2:return this.state.featureCount;case 3:return this.state.previous.featureCount;case 4:return this.state.features.length;case 5:return this.state.previous.features.length}}},{key:"stateToString",get:function(){switch(this.state.type){case 0:return"created";case 1:return"fetch-count";case 2:return"fetched-count";case 3:return"fetch-features";case 4:return"fetched-features";case 5:return"done"}}}]),t}();const o=n.create();t.PendingFeatureTile=u,Object.defineProperty(t,"__esModule",{value:!0})}));
