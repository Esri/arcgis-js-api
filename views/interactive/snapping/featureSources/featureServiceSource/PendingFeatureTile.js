/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/asyncUtils","../../../../../core/maybe","../../../../../geometry/support/aaBoundingRect"],(function(t,e,a,s,r){"use strict";let n=function(){function n(e,a){this.data=e,this.resolution=a,this.state={type:t.StateType.CREATED},this.alive=!0}var T=n.prototype;return T.process=function(e){switch(this.state.type){case t.StateType.CREATED:return this.state=this._gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case t.StateType.FETCH_COUNT:break;case t.StateType.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case t.StateType.FETCH_FEATURES:break;case t.StateType.FETCHED_FEATURES:this.state=this._goToDone(this.state,e);case t.StateType.DONE:}return null},T._gotoFetchCount=function(s,r){var n=this;return{type:t.StateType.FETCH_COUNT,previous:s,task:a.createTask(function(){var s=e._asyncToGenerator((function*(e){const s=yield a.resultOrAbort(r.fetchCount(n,e));n.state.type===t.StateType.FETCH_COUNT&&(n.state=n._gotoFetchedCount(n.state,s.ok?s.value:1/0))}));return function(t){return s.apply(this,arguments)}}())}},T._gotoFetchedCount=function(e,a){return{type:t.StateType.FETCHED_COUNT,featureCount:a,previous:e}},T._gotoFetchFeatures=function(s,r){var n=this;return{type:t.StateType.FETCH_FEATURES,previous:s,task:a.createTask(function(){var T=e._asyncToGenerator((function*(e){const T=yield a.resultOrAbort(r.fetchFeatures(n,s.featureCount,e));n.state.type===t.StateType.FETCH_FEATURES&&(n.state=n._gotoFetchedFeatures(n.state,T.ok?T.value:[]))}));return function(t){return T.apply(this,arguments)}}())}},T._gotoFetchedFeatures=function(e,a){return{type:t.StateType.FETCHED_FEATURES,previous:e,features:a}},T._goToDone=function(e,a){return a.finish(this,e.features),{type:t.StateType.DONE,previous:e}},T.reset=function(){const e=this.state;switch(this.state={type:t.StateType.CREATED},e.type){case t.StateType.CREATED:case t.StateType.FETCHED_COUNT:case t.StateType.FETCHED_FEATURES:case t.StateType.DONE:break;case t.StateType.FETCH_COUNT:case t.StateType.FETCH_FEATURES:e.task.abort()}},T.intersects=function(t){return!(!s.isNone(t)&&this.data.extent)||(r.fromExtent(t,u),r.intersects(this.data.extent,u))},e._createClass(n,[{key:"debugInfo",get:function(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}},{key:"_featureCount",get:function(){switch(this.state.type){case t.StateType.CREATED:case t.StateType.FETCH_COUNT:return 0;case t.StateType.FETCHED_COUNT:return this.state.featureCount;case t.StateType.FETCH_FEATURES:return this.state.previous.featureCount;case t.StateType.FETCHED_FEATURES:return this.state.features.length;case t.StateType.DONE:return this.state.previous.features.length}}},{key:"_stateToString",get:function(){switch(this.state.type){case t.StateType.CREATED:return"created";case t.StateType.FETCH_COUNT:return"fetch-count";case t.StateType.FETCHED_COUNT:return"fetched-count";case t.StateType.FETCH_FEATURES:return"fetch-features";case t.StateType.FETCHED_FEATURES:return"fetched-features";case t.StateType.DONE:return"done"}}}]),n}();var T;t.StateType=void 0,(T=t.StateType||(t.StateType={}))[T.CREATED=0]="CREATED",T[T.FETCH_COUNT=1]="FETCH_COUNT",T[T.FETCHED_COUNT=2]="FETCHED_COUNT",T[T.FETCH_FEATURES=3]="FETCH_FEATURES",T[T.FETCHED_FEATURES=4]="FETCHED_FEATURES",T[T.DONE=5]="DONE";const u=r.create();t.PendingFeatureTile=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
