/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{HandleOwner as r}from"../../../../core/HandleOwner.js";import{destroyHandle as t}from"../../../../core/handleUtils.js";import{abortMaybe as o,isNone as s}from"../../../../core/maybe.js";import{property as i}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/arrayUtils.js";import"../../../../core/has.js";import"../../../../core/accessorSupport/ensureType.js";import{subclass as a}from"../../../../core/accessorSupport/decorators/subclass.js";import n from"../../../3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle.js";import{SceneLayerSnappingSourceWorkerHandle as d}from"./sceneLayerSource/SceneLayerSnappingSourceWorkerHandle.js";let c=class extends r{constructor(e){super(e),this.availability=1,this.abortController=new AbortController}get updating(){return this.updatingHandles.updating}get layer(){return this.layerSource.layer}destroy(){this.abortController=o(this.abortController)}initialize(){const e=this.view.resourceController;this.edgeWorker=new n((r=>e.schedule(r))),this.workerHandle=new d({view:this.view,schedule:r=>e.schedule(r),fetchEdgeLocations:async(e,r)=>{if(s(this.tracker))throw new Error("tracker-not-initialized");return this.tracker.fetchEdgeLocations(e,this.edgeWorker,r)}}),this.updatingHandles.addPromise(this._setupLayerView()),this.handles.add([t(this.workerHandle),t(this.edgeWorker)])}async fetchCandidates(e,r){return this.workerHandle.fetchCandidates(e,r)}refresh(){}async _setupLayerView(){const e=await this.view.whenLayerView(this.layer);if("scene-layer-graphics-3d"===e.type)return;const r={add:(e,r)=>this.updatingHandles.addPromise(this.workerHandle.add({id:e,bounds:r},this.abortController.signal)),remove:e=>this.updatingHandles.addPromise(this.workerHandle.remove({id:e},this.abortController.signal))};this.tracker=e.trackSnappingSources(r),this.handles.add(this.tracker)}};e([i({constructOnly:!0})],c.prototype,"layerSource",void 0),e([i({constructOnly:!0})],c.prototype,"view",void 0),e([i({readOnly:!0})],c.prototype,"updating",null),e([i({readOnly:!0})],c.prototype,"availability",void 0),c=e([a("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],c);export{c as SceneLayerSnappingSource};
