/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/accessorSupport/decorators/subclass","./I3SSnappingSource"],(function(e,r,n,t,o,i,c,a,s,u,p){"use strict";e.SceneLayerSnappingSource=function(e){function n(r){var n;return(n=e.call(this,r)||this).availability=1,n._i3sSources=[],n}r._inheritsLoose(n,e);var t=n.prototype;return t.destroy=function(){this._i3sSources.forEach((e=>e.destroy())),this._i3sSources.length=0},t.initialize=function(){const{view:e}=this,r=this.layerSource.layer;this._i3sSources="building-scene"===r.type?this._getBuildingSceneI3SSources(e,r):[this._getSceneLayerI3SSource(e,r)]},t.fetchCandidates=function(){var e=r._asyncToGenerator((function*(e,r){const n=yield Promise.all(this._i3sSources.map((n=>n.fetchCandidates(e,r))));return i.throwIfAborted(r),n.flat()}));function n(r,n){return e.apply(this,arguments)}return n}(),t.refresh=function(){this._i3sSources.forEach((e=>e.refresh()))},t._getBuildingSceneI3SSources=function(e,n){return n.allSublayers.toArray().map((t=>{return"building-component"===t.type?new p.I3SSnappingSource({getLayerView:(o=r._asyncToGenerator((function*(){return(yield e.whenLayerView(n)).whenSublayerView(t)})),function(){return o.apply(this,arguments)}),view:e}):null;var o})).filter(o.isSome)},t._getSceneLayerI3SSource=function(e,n){return new p.I3SSnappingSource({getLayerView:(t=r._asyncToGenerator((function*(){const r=yield e.whenLayerView(n);return"scene-layer-graphics-3d"===r.type?void 0:r})),function(){return t.apply(this,arguments)}),view:e});var t},r._createClass(n,[{key:"updating",get:function(){return this._i3sSources.some((e=>e.updating))}}]),n}(t),n.__decorate([c.property({constructOnly:!0})],e.SceneLayerSnappingSource.prototype,"layerSource",void 0),n.__decorate([c.property({constructOnly:!0})],e.SceneLayerSnappingSource.prototype,"view",void 0),n.__decorate([c.property({readOnly:!0})],e.SceneLayerSnappingSource.prototype,"updating",null),n.__decorate([c.property({readOnly:!0})],e.SceneLayerSnappingSource.prototype,"availability",void 0),e.SceneLayerSnappingSource=n.__decorate([u.subclass("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],e.SceneLayerSnappingSource),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
