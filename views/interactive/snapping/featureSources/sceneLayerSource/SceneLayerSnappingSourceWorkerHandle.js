/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/HandleOwner","../../../../../core/accessorSupport/decorators/property","../../../../../core/arrayUtils","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/vec3f64","../../../../../core/workers/WorkerHandle","../../../../../chunks/sphere","../../../../../support/elevationInfoUtils","../../candidates/EdgeSnappingCandidate","../../candidates/VertexSnappingCandidate"],(function(e,t,r,n,o,i,a,s,c,d,p,l,u,h){"use strict";e.SceneLayerSnappingSourceWorkerHandle=function(e){function r(t){var r;return(r=e.call(this,t)||this).availability=0,r._ids=new Set,r._tmpP=c.create(),r}t._inheritsLoose(r,e);var n=r.prototype;return n.destroy=function(){this._workerHandle.destroy(),this._workerHandle=null},n.initialize=function(){this._workerHandle=new f(this.schedule,{fetchAllEdgeLocations:(e,t)=>this._fetchAllEdgeLocations(e,t)})},n.fetchCandidates=function(){var e=t._asyncToGenerator((function*(e,t){const r=e.coordinateHelper,n=r.toXYZ(e.point);this.renderCoordsHelper.toRenderCoords(n,r.spatialReference,n);const o=e.distance,i="number"==typeof o?o:o.distance,a=yield this._workerHandle.invoke({bounds:p.fromValues(n[0],n[1],n[2],i),types:e.types},t);return a.candidates.sort(((e,t)=>e.distance-t.distance)),a.candidates.map((e=>this._convertCandidate(r,e)))}));function r(t,r){return e.apply(this,arguments)}return r}(),n.add=function(){var e=t._asyncToGenerator((function*(e,t){this._ids.add(e.id),yield this._workerHandle.invokeMethod("add",e,t)}));function r(t,r){return e.apply(this,arguments)}return r}(),n.remove=function(){var e=t._asyncToGenerator((function*(e,t){this._ids.delete(e.id),yield this._workerHandle.invokeMethod("remove",e,t)}));function r(t,r){return e.apply(this,arguments)}return r}(),n._convertCandidate=function(e,t){switch(t.type){case"edge":return new u.EdgeSnappingCandidate({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),elevationInfo:l.absoluteHeightElevationInfo});case"vertex":return new h.VertexSnappingCandidate({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),elevationInfo:l.absoluteHeightElevationInfo})}},n._convertRenderCoordinate=function(e,t){return this.renderCoordsHelper.fromRenderCoords(t,this._tmpP,e.spatialReference),e.fromXYZ(this._tmpP)},n._fetchAllEdgeLocations=function(){var e=t._asyncToGenerator((function*(e,r){var n=this;const o=[],i=[];for(const{id:a,uid:s}of e.components)this._ids.has(a)&&o.push(t._asyncToGenerator((function*(){const e=yield n.fetchEdgeLocations(a,r.signal);return i.push(e.locations.buffer),{id:a,uid:s,objectIds:e.objectIds,locations:e.locations.buffer,origin:e.origin,type:e.type}}))());return{result:{components:(yield Promise.all(o)).filter((({id:e})=>this._ids.has(e)))},transferList:i}}));function r(t,r){return e.apply(this,arguments)}return r}(),r}(n.HandleOwner),r.__decorate([o.property({constructOnly:!0})],e.SceneLayerSnappingSourceWorkerHandle.prototype,"renderCoordsHelper",void 0),r.__decorate([o.property({constructOnly:!0})],e.SceneLayerSnappingSourceWorkerHandle.prototype,"fetchEdgeLocations",void 0),r.__decorate([o.property({constructOnly:!0})],e.SceneLayerSnappingSourceWorkerHandle.prototype,"schedule",void 0),r.__decorate([o.property({readOnly:!0})],e.SceneLayerSnappingSourceWorkerHandle.prototype,"availability",void 0),e.SceneLayerSnappingSourceWorkerHandle=r.__decorate([s.subclass("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],e.SceneLayerSnappingSourceWorkerHandle);let f=function(e){function r(t,r){return e.call(this,"SceneLayerSnappingSourceWorker","fetchCandidates",{},t,{strategy:"dedicated",client:r})||this}return t._inheritsLoose(r,e),r}(d.WorkerHandle);Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
