/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec2f64","./SnappingAlgorithm","./snappingUtils","./candidates/LineSnappingCandidate","../../support/geometry2dUtils"],(function(e,t,n,o,i,r,s,a){"use strict";let d=function(e){function i(){return e.apply(this,arguments)||this}t._inheritsLoose(i,e);var d=i.prototype;return d.snapNewVertex=function(e,t){const n=t.editGeometryOperations.data.components[0],o=n.edges.length,i=[];if(o<1)return i;const s=t.coordinateHelper,a=r.anyMapPointToScreenPoint(e,s,t.elevationInfo,this.view),d=n.edges[o-1];let p=d;do{this.edgeExceedsShortLineThreshold(p,t)&&this._processCandidateProposal(p.leftVertex.pos,p.rightVertex.pos,e,a,t,i),p=p.leftVertex.leftEdge}while(p&&p!==d);return i},d.snapExistingVertex=function(e,t){const o=[],i=n.unwrap(t.vertexHandle),s=i.component;if(s.edges.length<2)return o;const a=t.coordinateHelper,d=r.anyMapPointToScreenPoint(e,a,t.elevationInfo,this.view),p=i.leftEdge,l=i.rightEdge;p&&l&&this.edgeExceedsShortLineThreshold(p,t)&&this.edgeExceedsShortLineThreshold(l,t)&&this._processCandidateProposal(p.leftVertex.pos,l.rightVertex.pos,e,d,t,o);const h=s.edges[0];let c=h;do{c!==i.leftEdge&&c!==i.rightEdge&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(c.leftVertex.pos,c.rightVertex.pos,e,d,t,o),c=c.rightVertex.rightEdge}while(c&&c!==h);return o},d._processCandidateProposal=function(e,t,n,i,d,p){const l=a.projectPointToLine(o.create(),n,e,t),h=d.coordinateHelper,c=h.fromXYZ(l,h.getZ(n,0));r.squareDistance(i,r.anyMapPointToScreenPoint(c,h,d.elevationInfo,this.view))<this.squaredProximityTreshold(d.pointer)&&p.push(new s.LineSnappingCandidate({coordinateHelper:d.coordinateHelper,lineStart:e,lineEnd:t,targetPoint:c}))},i}(i.SnappingAlgorithm);e.LineSnapper=d,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
