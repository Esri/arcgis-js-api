/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec2f64","./snappingUtils","./SnappingAlgorithm","../../support/geometry2dUtils","./candidates/LineSnappingCandidate"],(function(e,t,n,o,i,r,s,a){"use strict";let p=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var p=r.prototype;return p.snapNewVertex=function(e,t){const n=t.geometry.editGeometry.components[0],o=n.edges.length,r=[];if(o<1)return r;const s=t.coordinateHelper,a=i.anyMapPointToScreenPoint(e,s,t.elevationInfo,this.view),p=n.edges[o-1];let d=p;do{this.edgeExceedsShortLineThreshold(d,t)&&this._processCandidateProposal(d.left.pos,d.right.pos,e,a,t,r),d=d.left.left}while(d&&d!==p);return r},p.snapExistingVertex=function(e,t){const o=[],r=n.unwrap(t.vertexHandle),s=r.component;if(s.edges.length<2)return o;const a=t.coordinateHelper,p=i.anyMapPointToScreenPoint(e,a,t.elevationInfo,this.view),d=r.left,l=r.right;d&&l&&this.edgeExceedsShortLineThreshold(d,t)&&this.edgeExceedsShortLineThreshold(l,t)&&this._processCandidateProposal(d.left.pos,l.right.pos,e,p,t,o);const h=s.edges[0];let c=h;do{c!==r.left&&c!==r.right&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(c.left.pos,c.right.pos,e,p,t,o),c=c.right.right}while(c&&c!==h);return o},p._processCandidateProposal=function(e,t,n,r,p,d){const l=s.projectPointToLine(o.create(),n,e,t),h=p.coordinateHelper,c=h.fromXYZ(l,h.getZ(n,0));i.squareDistance(r,i.anyMapPointToScreenPoint(c,h,p.elevationInfo,this.view))<this.squaredProximityTreshold(p.pointer)&&d.push(new a.LineSnappingCandidate({coordinateHelper:p.coordinateHelper,lineStart:e,lineEnd:t,targetPoint:c}))},r}(r.SnappingAlgorithm);e.LineSnapper=p,Object.defineProperty(e,"__esModule",{value:!0})}));
