/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec2","../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","./Settings","./snappingUtils","../../support/geometry3dUtils","../../support/geometry2dUtils"],(function(t,e,n,i,r,o,s,c,a,l,u){"use strict";let f=function(){function t(t){this.coordinateHelper=t}return t.prototype.intersect=function(t){return V(this,t)},t}(),h=function(t){function n(e,n){var i;return(i=t.call(this,e)||this).point=n,i.pointXYZ=e.toXYZ(n),i}e._inheritsLoose(n,t);var i=n.prototype;return i.equals=function(t){return A(t)&&a.objectEqual(this.point,t.point)},i.check=function(t){const e=this.coordinateHelper.toXYZ(t,g);return o.squaredDistance(e,this.pointXYZ)<c.defaults.pointThreshold},i.closestTo=function(){return this.coordinateHelper.clone(this.point)},n}(f),p=function(t){function n(e,n,i,r){var o;return(o=t.call(this,e)||this).start=n,o.end=i,o.type=r,o.startXYZ=e.toXYZ(n),o.endXYZ=e.toXYZ(i),o.lineLike={start:o.startXYZ,end:o.endXYZ,type:o.type},o}e._inheritsLoose(n,t);var i=n.prototype;return i.equals=function(t){return C(t)&&this.type===t.type&&a.objectEqual(this.start,t.start)&&a.objectEqual(this.end,t.end)},i.check=function(t){const e=this.coordinateHelper.toXYZ(t,g);return l.pointToLineLikeDistance(this.lineLike,e)<c.defaults.pointOnLineThreshold},i.closestTo=function(t){const e=this.coordinateHelper,n=e.toXYZ(t,g),i=l.projectPointToLineLike(n,this.lineLike);return e.fromXYZ(i)},n}(f),d=function(t){function n(e,n,i){return t.call(this,e,n,i,u.LineType.LINE)||this}return e._inheritsLoose(n,t),n}(p),L=function(t){function n(e,n,i,r){var o;return(o=t.call(this,e)||this).intersection=n,o.first=i,o.second=r,o}e._inheritsLoose(n,t);var i=n.prototype;return i.equals=function(t){return t instanceof n&&this.first.equals(t.first)&&this.second.equals(t.second)},i.check=function(){return!1},i.closestTo=function(){return this.coordinateHelper.clone(this.intersection)},n}(f),Z=function(t){function n(e,n,i,r){var o;return(o=t.call(this,e)||this).basePoint=n,o.first=i,o.second=r,o}e._inheritsLoose(n,t);var i=n.prototype;return i.equals=function(t){return t instanceof n&&this.first.equals(t.first)&&this.second.equals(t.second)},i.check=function(){return!1},i.closestTo=function(t){const e=this.basePoint,n=this.coordinateHelper,i=n.toXYZ(t,g),r=o.set(_,e[0],e[1],i[2]);return n.fromXYZ(r)},n}(f),k=function(t){function n(e,n,i){var r;return(r=t.call(this,e)||this).center=n,r.radius=i,r.centerXYZ=e.toXYZ(n),r}e._inheritsLoose(n,t);var i=n.prototype;return i.equals=function(t){return H(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius},i.check=function(){return!1},i.closestTo=function(t){const e=this.coordinateHelper,n=e.toXYZ(t,g),i=l.projectPointToCircle(n,this.centerXYZ,this.radius);return i[2]=e.getZ(t,this.centerXYZ[2]),e.fromXYZ(i)},n}(f),P=function(t){function n(e,n,i,r){var o;return(o=t.call(this,e)||this).start=n,o.end=i,o.type=r,o.planeLike={start:n,end:i,type:r},o}e._inheritsLoose(n,t);var r=n.prototype;return r.equals=function(t){return m(t)&&this.type===t.type&&a.objectEqual(this.start,t.start)&&a.objectEqual(this.end,t.end)},r.check=function(t){const e=this.coordinateHelper.toXYZ(t,g);return l.pointToVerticalPlaneDistance(e,this.planeLike)<c.defaults.pointOnLineThreshold},r.closestTo=function(t){const e=this.coordinateHelper,n=e.toXYZ(t,g),i=l.projectPointToVerticalPlane(n,this.planeLike);return e.fromXYZ(i)},r.closestEndTo=function(t){const{start:e,end:n}=this;return Math.sign(i.dot(i.subtract(j,n,e),i.subtract(E,t,e)))>0?n:e},n}(f),X=function(t){function n(e,n,i){return t.call(this,e,n,i,l.VerticalPlaneType.HALF_PLANE)||this}return e._inheritsLoose(n,t),n}(P),Y=function(t){function n(e,n,i){return t.call(this,e,n,i,l.VerticalPlaneType.PLANE)||this}return e._inheritsLoose(n,t),n}(P),T=function(t){function i(e,n,i,r){var o;return(o=t.call(this,e)||this).start=n,o.end=i,o.getZ=r,o.planeLike={start:n,end:i,type:l.VerticalPlaneType.HALF_PLANE},o}e._inheritsLoose(i,t);var r=i.prototype;return r.equals=function(t){return b(t)&&a.objectEqual(this.start,t.start)&&a.objectEqual(this.end,t.end)&&this.getZ===t.getZ},r.check=function(t){const e=this.coordinateHelper.toXYZ(t,g),n=y(this,e);return o.squaredDistance(e,n)<c.defaults.pointThreshold},r.closestTo=function(t){const e=this.coordinateHelper,n=y(this,e.toXYZ(t,g));return e.fromXYZ(n)},r.addIfOnTheGround=function(t,e){for(const i of e){const e=this.getZ(i[0],i[1],i[2]);n.isSome(e)&&Math.abs(i[2]-e)<l.epsilon&&(i[2]=e,t.push(i))}},i}(f);function y(t,e){const i=l.projectPointToVerticalPlane(e,t.planeLike),r=t.getZ(e[0],e[1],e[2]);return n.isSome(r)&&(i[2]=r),i}function V(t,e){let n=[];if(A(t)){const{pointXYZ:i}=t;C(e)?n=l.intersectLineAndPoint(e.lineLike,i):H(e)?n=l.intersectCircleAndPoint(e.centerXYZ,e.radius,i):m(e)?n=l.intersectVerticalPlaneAndPoint(e.planeLike,i):b(e)&&(n=q(e,t))}else if(C(t)){const{lineLike:i}=t;A(e)?n=l.intersectLineAndPoint(i,e.pointXYZ):C(e)?n=l.intersectLineLike(i,e.lineLike):H(e)?n=l.intersectLineLikeAndCircle(i,e.centerXYZ,e.radius):m(e)?n=l.intersectVerticalPlaneAndLineLike(e.planeLike,i):b(e)&&(n=q(e,t))}else if(H(t)){const{centerXYZ:i,radius:r}=t;C(e)?n=l.intersectLineLikeAndCircle(e.lineLike,i,r):A(e)?n=l.intersectCircleAndPoint(i,r,e.pointXYZ):m(e)?n=l.intersectVerticalPlaneAndCircle(e.planeLike,i,r):b(e)&&(n=q(e,t))}else if(m(t)){const{planeLike:i,coordinateHelper:r}=t;if(m(e))return l.intersectVerticalPlane(i,e.planeLike).map((n=>new Z(r,r.fromXYZ(n),t,e)));A(e)?n=l.intersectVerticalPlaneAndPoint(i,e.pointXYZ):C(e)?n=l.intersectVerticalPlaneAndLineLike(i,e.lineLike):H(e)?n=l.intersectVerticalPlaneAndCircle(i,e.centerXYZ,e.radius):b(e)&&(n=q(e,t))}else b(t)&&(n=q(t,e));return v(n,t,e)}function q(t,e){const{planeLike:i,getZ:r}=t,o=[];if(A(e))t.addIfOnTheGround(o,l.intersectVerticalPlaneAndPoint(i,e.pointXYZ));else if(C(e))t.addIfOnTheGround(o,l.intersectVerticalPlaneAndLineLike(i,e.lineLike));else if(H(e))t.addIfOnTheGround(o,l.intersectVerticalPlaneAndCircle(i,e.centerXYZ,e.radius));else if(m(e)||b(e))for(const[c,a]of l.intersectVerticalPlane(i,e.planeLike)){const t=r(c,a,0);n.isSome(t)&&o.push(s.fromValues(c,a,t))}return o}function v(t,e,n){const i=e.coordinateHelper;return t.map((t=>new L(i,i.fromXYZ(t),e,n)))}function A(t){return t instanceof h}function C(t){return t instanceof p}function H(t){return t instanceof k}function m(t){return t instanceof P}function b(t){return t instanceof T}const g=s.create(),_=s.create(),j=r.create(),E=r.create();t.DrapedLineConstraint=T,t.IntersectionConstraint=L,t.LineConstraint=d,t.LineLikeConstraint=p,t.PlanarCircleConstraint=k,t.PointConstraint=h,t.SnappingConstraint=f,t.VerticalHalfPlaneConstraint=X,t.VerticalLineIntersectionConstraint=Z,t.VerticalPlaneConstraint=Y,t.VerticalPlaneLikeConstraint=P,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
