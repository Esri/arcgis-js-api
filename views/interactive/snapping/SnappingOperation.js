/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import r from"../../../core/Accessor.js";import{isSome as s,abortMaybe as o,removeMaybe as e,isNone as i}from"../../../core/maybe.js";import{debounce as a}from"../../../core/promiseUtils.js";import{property as n}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import{subclass as p}from"../../../core/accessorSupport/decorators/subclass.js";import{TaskPriority as l,ImmediateTask as c}from"../../support/Scheduler.js";let h=class extends r{constructor(t){super(t),this.stagedPoint=null,this._abortController=null,this._snap=a((async(t,r,s,o)=>{const e=await this._frameTask.schedule((()=>r.snap(t,s,o)),o);e.valid&&await this._frameTask.schedule((()=>{this.stagedPoint=e.apply(),t!==this._snapMapPoint&&(this.stagedPoint=r.update(this._snapMapPoint,s))}),o)}))}initialize(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=s(t)?t.registerTask(l.SNAPPING):c}destroy(){this._abortController=o(this._abortController),this._frameTask=e(this._frameTask)}async snap(t,r,s){return this.stagedPoint=r.update(t,s),this._snapMapPoint=t,i(this._abortController)&&(this._abortController=new AbortController),this._snap(t,r,s,this._abortController.signal)}abort(){this._abortController=o(this._abortController)}};t([n({constructOnly:!0})],h.prototype,"view",void 0),t([n()],h.prototype,"stagedPoint",void 0),h=t([p("esri.views.interactive.snapping.SnappingOperation")],h);export{h as SnappingOperation};
