/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/maybe","../../../core/promiseUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/accessorSupport/decorators/subclass","../../support/Scheduler"],(function(t,n,e,o,r,s,i,a,p,c,l){"use strict";t.SnappingOperation=function(t){function e(e){var o;return(o=t.call(this,e)||this).constrainResult=t=>t,o._snapPoints=null,o._frameTask=null,o._abortController=null,o._stagedPoint=null,o._snap=s.debounce(function(){var t=n._asyncToGenerator((function*(t,n,e,s){const i=o._frameTask;if(r.isNone(i))return;const a=yield i.schedule((()=>n.snap({...t,context:e,signal:s})),s);a.valid&&(yield i.schedule((()=>{o.stagedPoint=a.apply(),t!==o._snapPoints&&r.isSome(o._snapPoints)&&(o.stagedPoint=n.update({...o._snapPoints,context:e}))}),s))}));return function(n,e,o,r){return t.apply(this,arguments)}}()),o}n._inheritsLoose(e,t);var o=e.prototype;return o.initialize=function(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=r.isSome(t)?t.registerTask(l.TaskPriority.SNAPPING):l.ImmediateTask},o.destroy=function(){this._abortController=r.abortMaybe(this._abortController),this._frameTask=r.removeMaybe(this._frameTask)},o.update=function(t,n,e){this._snapPoints=t;const{point:o,scenePoint:r}=t,s=n.update({point:o,scenePoint:r,context:e});return this.stagedPoint=s,s},o.snap=function(){var t=n._asyncToGenerator((function*(t,n,e){const{point:o,scenePoint:s}=t;return this.stagedPoint=n.update({point:o,scenePoint:s,context:e}),this._snapPoints=t,r.isNone(this._abortController)&&(this._abortController=new AbortController),this._snap(t,n,e,this._abortController.signal)}));function e(n,e,o){return t.apply(this,arguments)}return e}(),o.resnap=function(){var t=n._asyncToGenerator((function*(t,n){r.isNone(this._snapPoints)||(yield this.snap(this._snapPoints,t,n))}));function e(n,e){return t.apply(this,arguments)}return e}(),o.abort=function(){this._abortController=r.abortMaybe(this._abortController),this._snapPoints=null},n._createClass(e,[{key:"stagedPoint",get:function(){return this._stagedPoint},set:function(t){this._stagedPoint=this.constrainResult(t)}}]),e}(o),e.__decorate([i.property({constructOnly:!0})],t.SnappingOperation.prototype,"view",void 0),e.__decorate([i.property()],t.SnappingOperation.prototype,"stagedPoint",null),e.__decorate([i.property()],t.SnappingOperation.prototype,"constrainResult",void 0),e.__decorate([i.property()],t.SnappingOperation.prototype,"_stagedPoint",void 0),t.SnappingOperation=e.__decorate([c.subclass("esri.views.interactive.snapping.SnappingOperation")],t.SnappingOperation),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
