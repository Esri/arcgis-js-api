/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/maybe","../../../core/promiseUtils","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","../../support/Scheduler"],(function(t,e,o,n,r,s,i,a,p,c,l){"use strict";t.SnappingOperation=function(t){function o(o){var n;return(n=t.call(this,o)||this).constrainResult=t=>t,n._snapPoints=null,n._abortController=null,n._stagedPoint=null,n._snap=s.debounce(function(){var t=e._asyncToGenerator((function*(t,e,o,s){const i=yield n._frameTask.schedule((()=>e.snap({...t,context:o,signal:s})),s);i.valid&&(yield n._frameTask.schedule((()=>{n.stagedPoint=i.apply(),t!==n._snapPoints&&r.isSome(n._snapPoints)&&(n.stagedPoint=e.update({...n._snapPoints,context:o}))}),s))}));return function(e,o,n,r){return t.apply(this,arguments)}}()),n}e._inheritsLoose(o,t);var n=o.prototype;return n.initialize=function(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=r.isSome(t)?t.registerTask(l.TaskPriority.SNAPPING):l.ImmediateTask},n.destroy=function(){this._abortController=r.abortMaybe(this._abortController),this._frameTask=r.removeMaybe(this._frameTask)},n.snap=function(){var t=e._asyncToGenerator((function*(t,e,o){const{point:n,scenePoint:s}=t;return this.stagedPoint=e.update({point:n,scenePoint:s,context:o}),this._snapPoints=t,r.isNone(this._abortController)&&(this._abortController=new AbortController),this._snap(t,e,o,this._abortController.signal)}));function o(e,o,n){return t.apply(this,arguments)}return o}(),n.abort=function(){this._abortController=r.abortMaybe(this._abortController)},e._createClass(o,[{key:"stagedPoint",get:function(){return this._stagedPoint},set:function(t){this._stagedPoint=this.constrainResult(t)}}]),o}(n),o.__decorate([i.property({constructOnly:!0})],t.SnappingOperation.prototype,"view",void 0),o.__decorate([i.property()],t.SnappingOperation.prototype,"stagedPoint",null),o.__decorate([i.property()],t.SnappingOperation.prototype,"constrainResult",void 0),o.__decorate([i.property()],t.SnappingOperation.prototype,"_stagedPoint",void 0),t.SnappingOperation=o.__decorate([c.subclass("esri.views.interactive.snapping.SnappingOperation")],t.SnappingOperation),Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
