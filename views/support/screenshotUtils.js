/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../core/mathUtils"],(function(t,e,i){"use strict";const h=2048,n=1.5,o=8;function a(t,e){const{format:h,quality:n,rotation:o,disableDecorations:a}=t||{},r=D(t,e.padding),l=y(t,{width:e.width-r.left-r.right,height:e.height-r.top-r.bottom}),{width:g,height:d}=p(t,l),u=j(h),f=C[u];return{format:u,quality:i.clamp(null!=n?n:f,0,100),area:l,width:g,height:d,rotation:o,disableDecorations:!!a,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function r(t,e){const i=a(t,e),h=i.area,n=i.width/h.width,o=D(i,e.padding),r=o.left+o.right,l=o.top+o.bottom,g=e.width-r,d=e.height-l,u=Math.floor(g*n+r),f=Math.floor(d*n+l),c=t&&t.layers?t.layers:[],s=i.ignoreBackground,w=i.ignorePadding;return{framebufferWidth:u,framebufferHeight:f,region:{x:Math.floor(h.x*n)+o.left,y:Math.floor(h.y*n)+o.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:n,layers:c,disableDecorations:i.disableDecorations,ignoreBackground:s,ignorePadding:w}}function l(t,e,i,h){h.premultipliedAlpha&&q(t),i.width=t.width,i.height=t.height;const n=i.getContext("2d");n.putImageData(t,0,0),h.flipY&&I(n);const o=n.getImageData(0,0,t.width,t.height),a=g(i,e);return i.width=0,i.height=0,{dataUrl:a,data:o}}function g(t,e){const i=v[e.format],h=e.quality/100;return t.toDataURL(i,h)}function d(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(m)try{return new ImageData(t,e)}catch(h){m=!1}return s(t,e,i)}function u(t,e,i,h){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(m)try{return new ImageData(t,e,i)}catch(o){m=!1}const n=s(e,i,h);return n.data.set(t,0),n}function f(t,e,i,h=0,n=0,o=t.width-h,a=t.height-n,r=!1){const{data:l}=t,{width:g,height:d,data:u}=e,f=o/g,c=a/d,s=Math.ceil(f/2),w=Math.ceil(c/2),m=t.width;for(let M=0;M<d;M++)for(let t=0;t<g;t++){const e=4*(t+(r?d-M-1:M)*g);let o=0,a=0,p=0,y=0,x=0,b=0;const D=(M+.5)*c;for(let r=Math.floor(M*c);r<(M+1)*c;r++){const e=Math.abs(D-(r+.5))/w,g=(t+.5)*f,d=e*e;for(let u=Math.floor(t*f);u<(t+1)*f;u++){const t=Math.abs(g-(u+.5))/s,e=Math.sqrt(d+t*t);if(e>=1)continue;let f=2*e*e*e-3*e*e+1;const c=4*(h+u+(n+r)*m);b+=f*l[c+3],a+=f,!i&&l[c+3]<255&&(f=f*l[c+3]/255),p+=f*l[c],y+=f*l[c+1],x+=f*l[c+2],o+=f}}u[e]=p/o,u[e+1]=y/o,u[e+2]=x/o,u[e+3]=b/a}return e}function c(t,e,i){if(!e)return t;const{framebufferWidth:a,framebufferHeight:r,pixelRatio:l,region:g}=t,d=D(t,i),u=d.left+d.right,f=d.top+d.bottom,c=a-u,s=r-f,w=Math.min(o,Math.min((h-u)/c,(h-f)/s));return w<n?t:{...t,framebufferWidth:Math.round(c*w)+u,framebufferHeight:Math.round(s*w)+f,pixelRatio:l*w,resample:{region:{x:Math.round((g.x-d.left)*w)+d.left,y:Math.round((g.y-d.top)*w)+d.top,width:Math.round(g.width*w),height:Math.round(g.height*w)},width:a,height:r}}}function s(t,e,i){return i||(i=M()),i.getContext("2d").createImageData(t,e)}let w=null,m=!0;function M(){return w||(w=document.createElement("canvas"),w.width=1,w.height=1),w}function p(t,e){if(!t)return e;const i=t.width,h=t.height;if(null!=i&&null!=h)return{width:Math.floor(i),height:Math.floor(h)};if(null==i&&null==h)return e;const n=e.width/e.height;return null==h?{width:Math.floor(i),height:Math.floor(i/n)}:{width:Math.floor(h*n),height:Math.floor(h)}}function y(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){null!=t.area.x&&(i.x=Math.floor(t.area.x)),null!=t.area.y&&(i.y=Math.floor(t.area.y));const h=null!=t.area.width?Math.floor(t.area.width):null,n=null!=t.area.height?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,null!=h&&null!=n)i.width=Math.min(i.width,h),i.height=Math.min(i.height,n);else if(null==h&&null!=n){const t=Math.min(i.width,h);i.height=t/i.width*i.height,i.width=t}else if(null!=h&&null==n){const t=Math.min(i.height,n);i.width=t/i.height*i.width,i.height=t}}return x(b(i,t),e)}function x(t,e){const i=Math.floor(Math.max(t.x,0)),h=Math.floor(Math.max(t.y,0)),n={x:i,y:h,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-h))},o=n.width/n.height,a=t.width/t.height;if(a===o)return n;if(a>o){const t=Math.floor(n.width/a),e=n.height-t;return{x:n.x,y:Math.floor(n.y+e/2),width:n.width,height:t}}const r=Math.floor(n.height*a),l=n.width-r;return{x:Math.floor(n.x+l/2),y:n.y,width:r,height:n.height}}function b(t,e){if(!e||null==e.width||null==e.height)return t;const i=e.width/e.height,h=t.width/t.height;if(h===i)return t;if(h<i){const e=Math.floor(t.height*i);return t.x-=(e-t.width)/2,t.width=e,t}const n=Math.floor(t.width/i);return t.y-=(n-t.height)/2,t.height=n,t}function D(t,e){return!e||t&&t.ignorePadding?S:e}function j(t){switch(t){case"png":case"jpg":case"jpeg":return t;case null:case void 0:default:return R}}function I(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function q(t){const e=t.data,i=e.length;for(let h=0;h<i;h+=4){const t=e[h+3];if(t>0){const i=t/255;e[h+0]=e[h+0]/i,e[h+1]=e[h+1]/i,e[h+2]=e[h+2]/i}}}const v={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},P=98,R="png",C={png:100,jpg:P,jpeg:P},S={top:0,right:0,bottom:0,left:0};t.completeUserSettings=a,t.createEmptyImageData=d,t.encodeResult=l,t.resampleHermite=f,t.screenshotSuperSampleSettings=c,t.toDataUrl=g,t.toRenderSettings=r,t.wrapImageData=u,Object.defineProperty(t,"__esModule",{value:!0})}));
