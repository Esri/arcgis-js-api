/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../core/mathUtils","../../core/maybe","../../core/imageUtils"],(function(t,e,i,h,o){"use strict";const a=2048,n=1.5,r=8;function l(t,e){const{format:h,quality:o,rotation:a,disableDecorations:n}=t||{},r=S(t,e.padding),l=D(t,{width:e.width-r.left-r.right,height:e.height-r.top-r.bottom}),{width:g,height:u}=b(t,l),d=q(h),f=B[d];return{format:d,quality:i.clamp(null!=o?o:f,0,100),area:l,width:g,height:u,rotation:a,disableDecorations:!!n,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function g(t,e){const i=l(t,e),h=i.area,o=i.width/h.width,a=S(i,e.padding),n=a.left+a.right,r=a.top+a.bottom,g=e.width-n,u=e.height-r,d=Math.floor(g*o+n),f=Math.floor(u*o+r),c=t&&t.layers?t.layers:[],s=i.ignoreBackground,m=i.ignorePadding;return{framebufferWidth:d,framebufferHeight:f,region:{x:Math.floor(h.x*o)+a.left,y:Math.floor(h.y*o)+a.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:o,layers:c,disableDecorations:i.disableDecorations,ignoreBackground:s,ignorePadding:m,objectAndLayerIdColor:!1}}function u(t,e,i){const{ctx:h,canvas:o}=f(t,i),a=h.getImageData(0,0,t.width,t.height),n=w(o,e);return c(o),{dataUrl:n,data:a}}function d(t,e){const{ctx:i,canvas:h}=f(t,e),o=i.getImageData(0,0,t.width,t.height);return c(h),o}function f(t,e){const i=s();e.premultipliedAlpha&&P(t),i.width=t.width,i.height=t.height;const h=i.getContext("2d");return h.putImageData(t,0,0),e.flipY&&I(h),{ctx:h,canvas:i}}function c(t){t.width=0,t.height=0}function s(){return h.isNone(m)&&(m=document.createElement("canvas")),m}let m=null;function w(t,e){const i=R[e.format],h=e.quality/100;return t.toDataURL(i,h)}function M(t,e){const h=q(t),o=B[h];return{format:h,quality:i.clamp(null!=e?e:o,0,100)}}function p(t,e){return e/Math.max(t[0],t[1])}function y(t,e,i,h=0,o=0,a=t.width-h,n=t.height-o,r=!1){const{data:l}=t,{width:g,height:u,data:d}=e,f=a/g,c=n/u,s=Math.ceil(f/2),m=Math.ceil(c/2),w=t.width;for(let M=0;M<u;M++)for(let t=0;t<g;t++){const e=4*(t+(r?u-M-1:M)*g);let a=0,n=0,p=0,y=0,x=0,b=0;const D=(M+.5)*c;for(let r=Math.floor(M*c);r<(M+1)*c;r++){const e=Math.abs(D-(r+.5))/m,g=(t+.5)*f,u=e*e;for(let d=Math.floor(t*f);d<(t+1)*f;d++){const t=Math.abs(g-(d+.5))/s,e=Math.sqrt(u+t*t);if(e>=1)continue;let f=2*e*e*e-3*e*e+1;const c=4*(h+d+(o+r)*w);b+=f*l[c+3],n+=f,!i&&l[c+3]<255&&(f=f*l[c+3]/255),p+=f*l[c],y+=f*l[c+1],x+=f*l[c+2],a+=f}}d[e]=p/a,d[e+1]=y/a,d[e+2]=x/a,d[e+3]=b/n}return e}function x(t,e,i){if(!e)return t;const{framebufferWidth:h,framebufferHeight:o,pixelRatio:l,region:g}=t,u=S(t,i),d=u.left+u.right,f=u.top+u.bottom,c=h-d,s=o-f,m=Math.min(r,Math.min((a-d)/c,(a-f)/s));return m<n?t:{...t,framebufferWidth:Math.round(c*m)+d,framebufferHeight:Math.round(s*m)+f,pixelRatio:l*m,resample:{region:{x:Math.round((g.x-u.left)*m)+u.left,y:Math.round((g.y-u.top)*m)+u.top,width:Math.round(g.width*m),height:Math.round(g.height*m)},width:h,height:o}}}function b(t,e){if(!t)return e;const i=t.width,h=t.height;if(null!=i&&null!=h)return{width:Math.floor(i),height:Math.floor(h)};if(null==i&&null==h)return e;const o=e.width/e.height;return null==h?{width:Math.floor(i),height:Math.floor(i/o)}:{width:Math.floor(h*o),height:Math.floor(h)}}function D(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){null!=t.area.x&&(i.x=Math.floor(t.area.x)),null!=t.area.y&&(i.y=Math.floor(t.area.y));const h=null!=t.area.width?Math.floor(t.area.width):null,o=null!=t.area.height?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,null!=h&&null!=o)i.width=Math.min(i.width,h),i.height=Math.min(i.height,o);else if(null==h&&null!=o){const t=Math.min(i.width,h);i.height=t/i.width*i.height,i.width=t}else if(null!=h&&null==o){const t=Math.min(i.height,o);i.width=t/i.height*i.width,i.height=t}}return j(v(i,t),e)}function j(t,e){const i=Math.floor(Math.max(t.x,0)),h=Math.floor(Math.max(t.y,0)),o={x:i,y:h,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-h))},a=o.width/o.height,n=t.width/t.height;if(n===a)return o;if(n>a){const t=Math.floor(o.width/n),e=o.height-t;return{x:o.x,y:Math.floor(o.y+e/2),width:o.width,height:t}}const r=Math.floor(o.height*n),l=o.width-r;return{x:Math.floor(o.x+l/2),y:o.y,width:r,height:o.height}}function v(t,e){if(!e||null==e.width||null==e.height)return t;const i=e.width/e.height,h=t.width/t.height;if(h===i)return t;if(h<i){const e=Math.floor(t.height*i);return t.x-=(e-t.width)/2,t.width=e,t}const o=Math.floor(t.width/i);return t.y-=(o-t.height)/2,t.height=o,t}function S(t,e){return!e||t&&t.ignorePadding?H:e}function q(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return k}}function I(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function P(t){const e=t.data,i=e.length;for(let h=0;h<i;h+=4){const t=e[h+3];if(255!==t&&t>0){const i=255/t;e[h+0]=e[h+0]*i,e[h+1]=e[h+1]*i,e[h+2]=e[h+2]*i}}}const R={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},U=98,k="png",B={png:100,jpg:U,jpeg:U},H={top:0,right:0,bottom:0,left:0};t.createEmptyImageData=o.createEmptyImageData,t.completeUserSettings=l,t.encode=u,t.encodeData=d,t.getFormatAndQuality=M,t.getMaximumResolutionScale=p,t.resampleHermite=y,t.screenshotSuperSampleSettings=x,t.toDataUrl=w,t.toRenderSettings=g,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
