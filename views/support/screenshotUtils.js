/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../core/mathUtils"],(function(t,e,i){"use strict";function h(t,e){const{format:h,quality:n,rotation:a,disableDecorations:o}=t||{},r=l(t,e.padding),g=function(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){null!=t.area.x&&(i.x=Math.floor(t.area.x)),null!=t.area.y&&(i.y=Math.floor(t.area.y));const h=null!=t.area.width?Math.floor(t.area.width):null,n=null!=t.area.height?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,null!=h&&null!=n)i.width=Math.min(i.width,h),i.height=Math.min(i.height,n);else if(null==h&&null!=n){const t=Math.min(i.width,h);i.height=t/i.width*i.height,i.width=t}else if(null!=h&&null==n){const t=Math.min(i.height,n);i.width=t/i.height*i.width,i.height=t}}return function(t,e){const i=Math.floor(Math.max(t.x,0)),h=Math.floor(Math.max(t.y,0)),n=Math.floor(Math.min(t.width,e.width-i)),a=Math.floor(Math.min(t.height,e.height-h)),o={x:i,y:h,width:n,height:a},r=o.width/o.height,l=t.width/t.height;if(l===r)return o;if(l>r){const t=Math.floor(o.width/l),e=o.height-t;return{x:o.x,y:Math.floor(o.y+e/2),width:o.width,height:t}}const g=Math.floor(o.height*l),d=o.width-g;return{x:Math.floor(o.x+d/2),y:o.y,width:g,height:o.height}}(function(t,e){if(!e||null==e.width||null==e.height)return t;const i=e.width/e.height,h=t.width/t.height;if(h===i)return t;if(h<i){const e=Math.floor(t.height*i);return t.x-=(e-t.width)/2,t.width=e,t}const n=Math.floor(t.width/i);return t.y-=(n-t.height)/2,t.height=n,t}(i,t),e)}(t,{width:e.width-r.left-r.right,height:e.height-r.top-r.bottom}),{width:f,height:c}=function(t,e){if(!t)return e;const i=t.width,h=t.height;if(null!=i&&null!=h)return{width:Math.floor(i),height:Math.floor(h)};if(null==i&&null==h)return e;const n=e.width/e.height;if(null==h)return{width:Math.floor(i),height:Math.floor(i/n)};return{width:Math.floor(h*n),height:Math.floor(h)}}(t,g),s=function(t){switch(t){case"png":case"jpg":case"jpeg":return t;case null:case void 0:default:return d}}(h),w=u[s];return{format:s,quality:i.clamp(null!=n?n:w,0,100),area:g,width:f,height:c,rotation:a,disableDecorations:!!o,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function n(t,e){const i=g[e.format],h=e.quality/100;return t.toDataURL(i,h)}function a(t,e,i){return i||(i=function(){o||(o=document.createElement("canvas"),o.width=1,o.height=1);return o}()),i.getContext("2d").createImageData(t,e)}let o=null,r=!0;function l(t,e){return!e||t&&t.ignorePadding?f:e}const g={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},d="png",u={png:100,jpg:98,jpeg:98},f={top:0,right:0,bottom:0,left:0};t.completeUserSettings=h,t.createEmptyImageData=function(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(r)try{return new ImageData(t,e)}catch(t){r=!1}return a(t,e,i)},t.encodeResult=function(t,e,i,h){h.premultipliedAlpha&&function(t){const e=t.data,i=e.length;for(let t=0;t<i;t+=4){const i=e[t+3];if(i>0){const h=i/255;e[t+0]=e[t+0]/h,e[t+1]=e[t+1]/h,e[t+2]=e[t+2]/h}}}(t),i.width=t.width,i.height=t.height;const a=i.getContext("2d");a.putImageData(t,0,0),h.flipY&&function(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}(a);const o=a.getImageData(0,0,t.width,t.height),r=n(i,e);return i.width=0,i.height=0,{dataUrl:r,data:o}},t.resampleHermite=function(t,e,i,h=0,n=0,a=t.width-h,o=t.height-n,r=!1){const{data:l}=t,{width:g,height:d,data:u}=e,f=a/g,c=o/d,s=Math.ceil(f/2),w=Math.ceil(c/2),m=t.width;for(let t=0;t<d;t++)for(let e=0;e<g;e++){const a=4*(e+(r?d-t-1:t)*g);let o=0,M=0,p=0,y=0,x=0,b=0;const D=(t+.5)*c;for(let a=Math.floor(t*c);a<(t+1)*c;a++){const t=Math.abs(D-(a+.5))/w,r=(e+.5)*f,g=t*t;for(let t=Math.floor(e*f);t<(e+1)*f;t++){const e=Math.abs(r-(t+.5))/s,d=Math.sqrt(g+e*e);if(d>=1)continue;let u=2*d*d*d-3*d*d+1;const f=4*(h+t+(n+a)*m);b+=u*l[f+3],M+=u,!i&&l[f+3]<255&&(u=u*l[f+3]/255),p+=u*l[f],y+=u*l[f+1],x+=u*l[f+2],o+=u}}u[a]=p/o,u[a+1]=y/o,u[a+2]=x/o,u[a+3]=b/M}return e},t.screenshotSuperSampleSettings=function(t,e,i){if(!e)return t;const{framebufferWidth:h,framebufferHeight:n,pixelRatio:a,region:o}=t,r=l(t,i),g=r.left+r.right,d=r.top+r.bottom,u=h-g,f=n-d,c=Math.min(8,Math.min((2048-g)/u,(2048-d)/f));return c<1.5?t:{...t,framebufferWidth:Math.round(u*c)+g,framebufferHeight:Math.round(f*c)+d,pixelRatio:a*c,resample:{region:{x:Math.round((o.x-r.left)*c)+r.left,y:Math.round((o.y-r.top)*c)+r.top,width:Math.round(o.width*c),height:Math.round(o.height*c)},width:h,height:n}}},t.toDataUrl=n,t.toRenderSettings=function(t,e){const i=h(t,e),n=i.area,a=i.width/n.width,o=l(i,e.padding),r=o.left+o.right,g=o.top+o.bottom,d=e.width-r,u=e.height-g,f=Math.floor(d*a+r),c=Math.floor(u*a+g),s=t&&t.layers?t.layers:[],w=i.ignoreBackground,m=i.ignorePadding;return{framebufferWidth:f,framebufferHeight:c,region:{x:Math.floor(n.x*a)+o.left,y:Math.floor(n.y*a)+o.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:a,layers:s,disableDecorations:i.disableDecorations,ignoreBackground:w,ignorePadding:m}},t.wrapImageData=function(t,e,i,h){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(r)try{return new ImageData(t,e,i)}catch(t){r=!1}const n=a(e,i,h);return n.data.set(t,0),n},Object.defineProperty(t,"__esModule",{value:!0})}));
