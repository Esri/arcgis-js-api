/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/domUtils","../core/Logger","../core/maybe","../core/reactiveUtils","../core/scheduling","../core/accessorSupport/decorators/property","../core/arrayUtils","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","./overlay/ViewOverlay","../widgets/Popup"],(function(e,t,i,s,r,o,n,a,d,u,h,c,l,p){"use strict";const _=[0,0];function y(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return _[0]=i.left+(t?.pageXOffset??0),_[1]=i.top+(t?.pageYOffset??0),_}function f(e){e&&(s.empty(e),e.parentNode&&e.parentNode.removeChild(e))}function v(e){const t=document.createElement("div");return e.appendChild(t),t}const g=16,m=750,w=512,C=2,b=e=>{let u=function(e){function i(...i){var s;return(s=e.call(this,...i)||this)._freqInfo={freq:g,time:m},s._overlayRenderTaskHandle=null,s.height=0,s.overlay=null,s.position=null,s.resizing=!1,s.root=null,s.surface=null,s.suspended=!0,s.ui=null,s.userContent=null,s.width=0,s.widthBreakpoint=null,0!==i.length&&void 0!==i[0]?.popup||(s.popup=new p({view:t._assertThisInitialized(s)})),s.handles.add([n.watch((()=>s.cursor),(e=>{const{surface:i}=t._assertThisInitialized(s);i&&i.setAttribute("data-cursor",e)})),n.watch((()=>s.interacting),(e=>{const{surface:i}=t._assertThisInitialized(s);i&&i.setAttribute("data-interacting",e.toString())}))]),s}t._inheritsLoose(i,e);var d=i.prototype;return d.initialize=function(){this.handles.add(n.watch((()=>this.ui),((e,t)=>this._handleUIChange(e,t)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])},d.destroy=function(){this.destroyed||(this.ui=o.destroyMaybe(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)},d.blur=function(){this.surface&&this.surface.blur()},d.focus=function(){this.surface&&this.surface.focus()},d.pageToContainer=function(e,t,i){const s=this.position;return e-=s?s[0]:0,t-=s?s[1]:0,i?(i[0]=e,i[1]=t):i=[e,t],i},d.containerToPage=function(e,t,i){const s=this.position;return e+=s?s[0]:0,t+=s?s[1]:0,i?(i[0]=e,i[1]=t):i=[e,t],i},d._handleUIChange=function(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)},d._wireUI=function(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([n.watch((()=>this.root),(t=>{e.container=t?v(t):null}),n.initial),n.watch((()=>this.popup),((t,i)=>{const s="popup",r="manual";i&&e.remove(i,s),t&&(t.view=e.view,e.add(t,{key:s,position:r}))}),n.initial)],"ui"))},d._stopMeasuring=function(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)},d._startMeasuring=function(){const e=this._freqInfo;e.freq=g,e.time=m,this.handles.add([(()=>{const t=()=>{e.freq=g,e.time=m};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),a.addFrameTask({prepare:e=>{const t=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,t&&(i.freq=g,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const s=this._position();i.freq=s||t?g:Math.min(m,i.freq*C),!t&&i.freq>=w&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()},d._measure=function(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const s=this.width,r=this.height;return t===s&&i===r?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:r,width:t,height:i}),!0)},d._position=function(){const e=this.container,t=this.position,i=e&&y(e);return!!i&&((!t||i[0]!==t[0]||i[1]!==t[1])&&(this._set("position",[i[0],i[1]]),!0))},d.forceDOMReadyCycle=function(){},t._createClass(i,[{key:"container",get:function(){return this._get("container")??null},set:function(e){const t=this._get("container"),i=s.byId(e),d=i instanceof HTMLDivElement?i:null;if(d||"string"!=typeof e||r.getLogger(this.declaredClass).error("#container",`element with id '${e}' not found`),t===d)return;const u="dom-size";if(this.handles.remove(u),this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(f(this.root),this._set("root",null)),this.userContent&&(s.reparent(this.userContent,t),f(this.userContent),this._set("userContent",null))),!d)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);d.classList.add("esri-view");const h=document.createElement("div");h.className="esri-view-user-storage",s.reparent(d,h),d.appendChild(h),this._set("userContent",h);const c=document.createElement("div");c.className="esri-view-root",d.insertBefore(c,d.firstChild),this._set("root",c);const p=document.createElement("div");p.className="esri-view-surface",p.setAttribute("role","application"),p.tabIndex=0,c.appendChild(p),this._set("surface",p);const _=new l;c.appendChild(_.surface),this._set("overlay",_),n.watch((()=>_.needsRender),(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=a.addFrameTask({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=o.removeMaybe(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this.handles.add(n.watch((()=>this.size),(e=>{const[t,i]=e,s="esri-view-surface--inset-outline";t>=document.body.clientWidth||i>=document.body.clientHeight?p.classList.add(s):p.classList.remove(s)}),n.initial),u),this._set("container",d),this._startMeasuring()}},{key:"focused",get:function(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}},{key:"popup",set:function(e){const t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}},{key:"size",get:function(){return[this.width,this.height]}}]),i}(e);return i.__decorate([d.property()],u.prototype,"container",null),i.__decorate([d.property({readOnly:!0})],u.prototype,"focused",null),i.__decorate([d.property({readOnly:!0})],u.prototype,"height",void 0),i.__decorate([d.property({type:p})],u.prototype,"popup",null),i.__decorate([d.property({type:l})],u.prototype,"overlay",void 0),i.__decorate([d.property({readOnly:!0})],u.prototype,"position",void 0),i.__decorate([d.property({readOnly:!0})],u.prototype,"resizing",void 0),i.__decorate([d.property({readOnly:!0})],u.prototype,"root",void 0),i.__decorate([d.property({value:null,readOnly:!0})],u.prototype,"size",null),i.__decorate([d.property({readOnly:!0})],u.prototype,"surface",void 0),i.__decorate([d.property({readOnly:!0})],u.prototype,"suspended",void 0),i.__decorate([d.property()],u.prototype,"ui",void 0),i.__decorate([d.property({readOnly:!0})],u.prototype,"userContent",void 0),i.__decorate([d.property({readOnly:!0})],u.prototype,"width",void 0),i.__decorate([d.property()],u.prototype,"widthBreakpoint",void 0),u=i.__decorate([c.subclass("esri.views.DOMContainer")],u),u};e.DOMContainer=b,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
