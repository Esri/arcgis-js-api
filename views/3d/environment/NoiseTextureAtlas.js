/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","../../../chunks/vec2","../../../chunks/NoiseTextureAtlas.glsl","./NoiseTextureAtlasConfiguration","./NoiseTextureAtlasDimensions","./NoiseTextureAtlasTechnique","../webgl-engine/lib/glUtil3D","../../webgl/enums","../../webgl/FramebufferObject"],(function(e,t,r,s,i,o,a,n,u,h,c,l,T,_,d,p,f){"use strict";e.NoiseTextureAtlas=function(e){function r(t){var r;return(r=e.call(this,t)||this)._needsRender=!0,r._passParameters=new c.NoiseTextureAtlasPassParameters,r._frameBuffer=new f.FramebufferObject(t.context.renderContext.rctx,{colorTarget:p.TargetType.TEXTURE,width:T.ATLAS_SIZE,height:T.ATLAS_SIZE},{target:p.TextureType.TEXTURE_2D,pixelFormat:p.PixelFormat.RGBA,dataType:p.PixelType.UNSIGNED_BYTE,wrapMode:p.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:p.TextureSamplingMode.LINEAR,hasMipmap:!1,width:T.ATLAS_SIZE,height:T.ATLAS_SIZE}),r._vao=d.createQuadVAO(t.context.renderContext.rctx),r}t._inheritsLoose(r,e);var s=r.prototype;return s._setDirty=function(){this._needsRender=!0},s.updateWeatherMap=function(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(h.copy(this._passParameters.weatherTile,e),this._setDirty())},s.destroy=function(){this._fullTechniqueCached=i.releaseMaybe(this._fullTechniqueCached),this._weatherMapTechniqueCached=i.releaseMaybe(this._weatherMapTechniqueCached),this._frameBuffer=i.disposeMaybe(this._frameBuffer),this._vao=i.disposeMaybe(this._vao)},s._render=function(e){if(i.isNone(this._vao)||i.isNone(this._frameBuffer))return null;const t=e===l.NoiseTextureRenderMode.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,T.ATLAS_SIZE,T.ATLAS_SIZE),r.bindFramebuffer(this._frameBuffer);const o=r.bindTechnique(t,this._passParameters,null);return r.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture},t._createClass(r,[{key:"_techniqueRepository",get:function(){return this.context.shaderTechniqueRepository}},{key:"textureAtlas",get:function(){return i.isSome(this._texture)?i.isSome(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(l.NoiseTextureRenderMode.WeatherMap)):i.isSome(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(l.NoiseTextureRenderMode.Full)),this._texture}},{key:"_fullTechnique",get:function(){if(i.isNone(this._fullTechniqueCached)){const e=new l.NoiseTextureAtlasTechniqueConfiguration;e.mode=l.NoiseTextureRenderMode.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(_.NoiseTextureAtlasTechnique,e)}return this._fullTechniqueCached}},{key:"_weatherMapTechnique",get:function(){if(i.isNone(this._weatherMapTechniqueCached)){const e=new l.NoiseTextureAtlasTechniqueConfiguration;e.mode=l.NoiseTextureRenderMode.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(_.NoiseTextureAtlasTechnique,e)}return this._weatherMapTechniqueCached}}]),r}(s),r.__decorate([o.property({constructOnly:!0})],e.NoiseTextureAtlas.prototype,"context",void 0),r.__decorate([o.property({readOnly:!0})],e.NoiseTextureAtlas.prototype,"_techniqueRepository",null),e.NoiseTextureAtlas=r.__decorate([u.subclass("esri.views.3d.environment.NoiseTextureAtlas")],e.NoiseTextureAtlas),Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
