/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../analysis/dimensionUtils","../../../../core/has","../../../../core/maybe","../../../../chunks/vec3","../../../../geometry/support/vectorStacks","./lengthDimensionManipulatorUtils","./lengthDimensionUtils","./settings"],(function(e,t,n,i,o,s,r,a,c){"use strict";var d;function m(t,n){if(a.isGeodesicDimension(t))return e.LengthDimensionConstraint.Direct;const{geometry:r}=t;if(i.isNone(r)||o.exactEquals(r.directSegment.startRenderSpace,r.directSegment.endRenderSpace))return null;const{constraintThresholdPx:d}=c.settings,{camera:m}=n.state,l=a.directUp(s.sv3d.get(),r,n.renderCoordsHelper),u=a.directStartToEnd(s.sv3d.get(),r),g=o.scale(s.sv3d.get(),l,o.dot(u,l)),P=o.subtract(s.sv3d.get(),u,g),p=o.squaredLength(P),S=o.squaredLength(g),{startRenderSpace:h,endRenderSpace:D}=r.directSegment,C=Math.max(m.computeRenderPixelSizeAt(h)*d,m.computeRenderPixelSizeAt(D)*d)**2;return p<C?e.LengthDimensionConstraint.Vertical:S<C?e.LengthDimensionConstraint.Horizontal:null}function l(n,o,s){const{constraint:a,elevationAlignedStartPoint:c,elevationAlignedEndPoint:d,unconstrainedGeometry:m,view:l}=s,{dimension:u,previousConstraint:g,preConstraintProperties:P}=n;if(i.isNone(c)||i.isNone(d))return;const p=()=>{"startPoint"in o?u.startPoint=o.startPoint:"endPoint"in o&&(u.endPoint=o.endPoint)};if(i.isNone(a))p(),i.isSome(g)&&i.isSome(P)&&(u.measureType=P.measureType,u.orientation=P.orientation);else switch(u.measureType=t.LengthDimensionMeasureType.Direct,a){case e.LengthDimensionConstraint.Horizontal:if(a!==g&&(u.orientation=0),"startPoint"in o){const e=o.startPoint;i.isSome(e)&&(e.z=d.z),u.startPoint=e}else if("endPoint"in o){const e=o.endPoint;i.isSome(e)&&(e.z=c.z),u.endPoint=e}break;case e.LengthDimensionConstraint.Vertical:if(a!==g&&(u.orientation=r.automaticHeadingFromCamera(m,l)),"startPoint"in o){const e=o.startPoint;i.isSome(e)&&(e.x=d.x,e.y=d.y),u.startPoint=e}else if("endPoint"in o){const e=o.endPoint;i.isSome(e)&&(e.x=c.x,e.y=c.y),u.endPoint=e}break;case e.LengthDimensionConstraint.Direct:a!==g&&i.isSome(P)&&(u.orientation=P.orientation),p()}n.previousConstraint=a}e.LengthDimensionConstraint=void 0,(d=e.LengthDimensionConstraint||(e.LengthDimensionConstraint={}))[d.Horizontal=0]="Horizontal",d[d.Vertical=1]="Vertical",d[d.Direct=2]="Direct",e.applyConstraint=l,e.computeConstraint=m,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
