/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../analysis/dimensionUtils","../../../../core/Accessor","../../../../core/Handles","../../../../core/Logger","../../../../core/maybe","../../../../core/reactiveUtils","../../../../core/unitUtils","../../../../core/accessorSupport/decorators/property","../../../../core/arrayUtils","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/subclass","./lengthDimensionUtils"],(function(e,t,o,n,s,i,r,a,l,c,d,u,p,m,y){"use strict";e.DimensionController=function(e){function o(t){var o;return(o=e.call(this,t)||this)._handles=new i,o}t._inheritsLoose(o,e);var s=o.prototype;return s.initialize=function(){const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles(e.on("change",(({added:e,removed:t})=>{for(const o of t)this._removeComputation(o);for(const o of e)this._addComputation(o)})))},s.destroy=function(){this._handles=a.destroyMaybe(this._handles)},s._addComputation=function(e){this._handles.has(e)||this._handles.add(l.watch((()=>y.computationToGeometryDependencies(e)),(t=>{const{measureType:o}=t;if(y.isGeodesicDimension(t)&&o!==n.LengthDimensionMeasureType.Direct){const t=Math.round(c.convertUnit(y.GEODESIC_DISTANCE_THRESHOLD,"meters","kilometers"));return r.getLogger(this.declaredClass).warnOnce(`A ${o} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${t} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const s=y.computeGeometryFromDimension(t,this.view.renderCoordsHelper,e.geometry);e.geometry=s,e.result.length=y.computeLength(s,o,this._defaultUnit)}),l.syncAndInitial),e)},s._removeComputation=function(e){this._handles.remove(e)},t._createClass(o,[{key:"analysis",get:function(){return this.analysisViewData.analysis}},{key:"_defaultUnit",get:function(){return c.getDefaultUnitForView(this.view)}}]),o}(s),o.__decorate([d.property({constructOnly:!0})],e.DimensionController.prototype,"analysisViewData",void 0),o.__decorate([d.property({constructOnly:!0})],e.DimensionController.prototype,"view",void 0),o.__decorate([d.property()],e.DimensionController.prototype,"analysis",null),o.__decorate([d.property()],e.DimensionController.prototype,"_defaultUnit",null),e.DimensionController=o.__decorate([m.subclass("esri.views.3d.analysis.Dimension.support.DimensionController")],e.DimensionController),Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
