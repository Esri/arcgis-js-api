/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Handles","../../../../core/maybe","../../../../core/reactiveUtils","../../../../core/watchUtils","../../../../core/accessorSupport/decorators/property","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/subclass","../../../../chunks/mat4","../../../../chunks/vec3","../../../../geometry/support/vectorStacks","../../interactive/analysisTools/slice/sliceToolConfig","../../interactive/analysisTools/slice/sliceToolUtils","../../webgl-engine/materials/lineStippleUtils"],(function(e,i,t,s,a,l,n,r,o,c,u,d,p,h,_,y,V,v,m){"use strict";e.SliceVisualization=function(e){function t(i){var t;return(t=e.call(this,i)||this)._handles=new a,t._gridVisualElement=null,t._outlineVisualElement=null,t.state="pending",t.showGrid=!1,t.editable=!0,t}i._inheritsLoose(t,e);var s=t.prototype;return s.initialize=function(){this._initialize()},s._initialize=function(){var e=i._asyncToGenerator((function*(){if("destroyed"===this.state||"ready"===this.state)return;yield r.whenOnce(this.view,"ready",!0);const e=this.analysisView.analysisViewData;if(l.isNone(e))throw new Error("expected internal object to be valid");this._gridVisualElement=v.createGridVisualElement(this.view),this._outlineVisualElement=v.createOutlineVisualElement(this.view),this._handles.add([n.react((()=>({visible:l.isSome(e.plane)&&this.analysisView.visible,active:this.analysisView.active,editable:this.editable,showGrid:this.showGrid})),(e=>this._updateMaterials(e)),n.syncAndInitial),n.react((()=>e.plane),(e=>this._updatePlane(e)),n.syncAndInitial)],"internal"),this._set("state","ready")}));function t(){return e.apply(this,arguments)}return t}(),s.destroy=function(){"destroyed"!==this.state&&"pending"!==this.state&&(this._handles.destroy(),this._gridVisualElement=l.destroyMaybe(this._gridVisualElement),this._outlineVisualElement=l.destroyMaybe(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))},s.whenReady=function(){var e=i._asyncToGenerator((function*(){return yield r.whenOnce(this,"ready"),this}));function t(){return e.apply(this,arguments)}return t}(),s._updatePlane=function(e){if(l.isNone(e))return;const i=_.set(y.sv3d.get(),_.length(e.basis1),_.length(e.basis2),1),t=h.fromScaling(y.sm4d.get(),i),s=v.calculateBoundedPlaneTranslateRotate(e,y.sm4d.get()),a=h.multiply(t,s,t);this._outlineVisualElement.transform=a,this._gridVisualElement.transform=a},s._updateMaterials=function({visible:e,active:i,editable:t,showGrid:s}){this._outlineVisualElement.color=V.PLANE_OUTLINE_COLOR,this._outlineVisualElement.width=t?V.PLANE_OUTLINE_WIDTH:V.PLANE_PREVIEW_OUTLINE_WIDTH,this._outlineVisualElement.stipplePattern=i?null:m.createStipplePatternSimple(5);const a=s?V.GRID_COLOR:[0,0,0,0];this._gridVisualElement.backgroundColor=V.PLANE_BACKGROUND_COLOR,this._gridVisualElement.gridColor=a,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e},i._createClass(t,[{key:"ready",get:function(){return"ready"===this.state}}]),t}(s),t.__decorate([o.property({readOnly:!0})],e.SliceVisualization.prototype,"state",void 0),t.__decorate([o.property()],e.SliceVisualization.prototype,"view",void 0),t.__decorate([o.property()],e.SliceVisualization.prototype,"analysis",void 0),t.__decorate([o.property()],e.SliceVisualization.prototype,"analysisView",void 0),t.__decorate([o.property()],e.SliceVisualization.prototype,"ready",null),t.__decorate([o.property()],e.SliceVisualization.prototype,"showGrid",void 0),t.__decorate([o.property()],e.SliceVisualization.prototype,"editable",void 0),e.SliceVisualization=t.__decorate([p.subclass("esri.views.3d.analysis.Slice.SliceVisualization")],e.SliceVisualization),Object.defineProperty(e,"__esModule",{value:!0})}));
