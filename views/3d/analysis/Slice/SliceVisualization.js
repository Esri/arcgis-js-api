/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Handles","../../../../core/maybe","../../../../core/reactiveUtils","../../../../core/watchUtils","../../../../core/accessorSupport/decorators/property","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/subclass","../../../../chunks/mat4","../../../../chunks/vec3","../../../../geometry/support/vectorStacks","../../interactive/analysisTools/slice/sliceToolConfig","../../interactive/analysisTools/slice/sliceToolUtils","../../webgl-engine/materials/lineStippleUtils"],(function(e,t,i,s,a,l,n,r,o,c,u,d,h,p,_,y,V,v,m){"use strict";e.SliceVisualization=function(e){function i(t){var i;return(i=e.call(this,t)||this)._handles=new a,i._gridVisualElement=null,i._outlineVisualElement=null,i.state="pending",i.showGrid=!1,i.editable=!0,i}t._inheritsLoose(i,e);var s=i.prototype;return s.initialize=function(){this._initialize()},s._initialize=function(){var e=t._asyncToGenerator((function*(){if("destroyed"===this.state||"ready"===this.state)return;yield r.whenOnce(this.view,"ready",!0);const e=this.analysisViewData;if(l.isNone(e))throw new Error("expected internal object to be valid");this._gridVisualElement=v.createGridVisualElement(this.view),this._outlineVisualElement=v.createOutlineVisualElement(this.view),this._handles.add([n.watch((()=>({visible:l.isSome(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,editable:this.editable,showGrid:this.showGrid})),(e=>this._updateMaterials(e)),n.syncAndInitial),n.watch((()=>e.plane),(e=>this._updatePlane(e)),n.syncAndInitial)],"internal"),this._set("state","ready")}));function i(){return e.apply(this,arguments)}return i}(),s.destroy=function(){"destroyed"!==this.state&&"pending"!==this.state&&(this._handles.destroy(),this._gridVisualElement=l.destroyMaybe(this._gridVisualElement),this._outlineVisualElement=l.destroyMaybe(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))},s.whenReady=function(){var e=t._asyncToGenerator((function*(){return yield r.whenOnce(this,"ready"),this}));function i(){return e.apply(this,arguments)}return i}(),s._updatePlane=function(e){if(l.isNone(e))return;const t=_.set(y.sv3d.get(),_.length(e.basis1),_.length(e.basis2),1),i=p.fromScaling(y.sm4d.get(),t),s=v.calculateBoundedPlaneTranslateRotate(e,y.sm4d.get()),a=p.multiply(i,s,i);this._outlineVisualElement.transform=a,this._gridVisualElement.transform=a},s._updateMaterials=function({visible:e,active:t,editable:i,showGrid:s}){this._outlineVisualElement.color=V.PLANE_OUTLINE_COLOR,this._outlineVisualElement.width=i?V.PLANE_OUTLINE_WIDTH:V.PLANE_PREVIEW_OUTLINE_WIDTH,this._outlineVisualElement.stipplePattern=t?null:m.createStipplePatternSimple(5);const a=s?V.GRID_COLOR:[0,0,0,0];this._gridVisualElement.backgroundColor=V.PLANE_BACKGROUND_COLOR,this._gridVisualElement.gridColor=a,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e},t._createClass(i,[{key:"ready",get:function(){return"ready"===this.state}}]),i}(s),i.__decorate([o.property({readOnly:!0})],e.SliceVisualization.prototype,"state",void 0),i.__decorate([o.property()],e.SliceVisualization.prototype,"view",void 0),i.__decorate([o.property()],e.SliceVisualization.prototype,"analysis",void 0),i.__decorate([o.property()],e.SliceVisualization.prototype,"analysisViewData",void 0),i.__decorate([o.property()],e.SliceVisualization.prototype,"ready",null),i.__decorate([o.property()],e.SliceVisualization.prototype,"showGrid",void 0),i.__decorate([o.property()],e.SliceVisualization.prototype,"editable",void 0),e.SliceVisualization=i.__decorate([h.subclass("esri.views.3d.analysis.Slice.SliceVisualization")],e.SliceVisualization),Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
