/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import t from"../../../../core/Accessor.js";import i from"../../../../core/Handles.js";import{isNone as s,isSome as r,destroyMaybe as o}from"../../../../core/maybe.js";import{whenOnce as a,watch as l,syncAndInitial as n}from"../../../../core/reactiveUtils.js";import{property as p}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/arrayUtils.js";import"../../../../core/has.js";import"../../../../core/accessorSupport/ensureType.js";import{subclass as h}from"../../../../core/accessorSupport/decorators/subclass.js";import{u as d,m}from"../../../../chunks/mat4.js";import{s as u,l as c}from"../../../../chunks/vec3.js";import{Z as y}from"../../../../chunks/vec4f64.js";import{sv3d as v,sm4d as w}from"../../../../geometry/support/vectorStacks.js";import{PLANE_OUTLINE_COLOR as _,PLANE_PREVIEW_OUTLINE_WIDTH as V,PLANE_OUTLINE_WIDTH as f,PLANE_BACKGROUND_COLOR as g,GRID_COLOR as j}from"./sliceToolConfig.js";import{createGridVisualElement as E,createOutlineVisualElement as b,calculateBoundedPlaneTranslateRotate as S}from"./sliceToolUtils.js";import{createStipplePatternSimple as k}from"../../webgl-engine/materials/lineStippleUtils.js";let G=class extends t{constructor(e){super(e),this._handles=new i,this._gridVisualElement=null,this._outlineVisualElement=null,this.state="pending",this.showGrid=!1,this.preview=!0}get ready(){return"ready"===this.state}initialize(){this._initialize()}async _initialize(){if("destroyed"===this.state||"ready"===this.state)return;await a((()=>this.view.ready));const e=this.analysisViewData;if(s(e))throw new Error("expected internal object to be valid");this._gridVisualElement=E(this.view),this._outlineVisualElement=b(this.view),this._handles.add([l((()=>({visible:r(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid})),(e=>this._updateMaterials(e)),n),l((()=>e.plane),(e=>this._updatePlane(e)),n)],"internal"),this._set("state","ready")}destroy(){"destroyed"!==this.state&&"pending"!==this.state&&(this._handles.destroy(),this._gridVisualElement=o(this._gridVisualElement),this._outlineVisualElement=o(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed"))}async whenReady(){await a((()=>this.view.ready))}_updatePlane(e){if(s(e))return;const t=u(v.get(),c(e.basis1),c(e.basis2),1),i=d(w.get(),t),r=S(e,w.get()),o=m(i,r,i);this._outlineVisualElement.transform=o,this._gridVisualElement.transform=o}_updateMaterials({visible:e,active:t,preview:i,showGrid:s}){this._outlineVisualElement.color=_,this._outlineVisualElement.width=i?V:f,this._outlineVisualElement.stipplePattern=t?null:k(5),this._gridVisualElement.backgroundColor=g,this._gridVisualElement.gridColor=s?j:y,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};e([p({readOnly:!0})],G.prototype,"state",void 0),e([p()],G.prototype,"view",void 0),e([p()],G.prototype,"analysis",void 0),e([p()],G.prototype,"analysisViewData",void 0),e([p()],G.prototype,"ready",null),e([p()],G.prototype,"showGrid",void 0),e([p()],G.prototype,"preview",void 0),G=e([h("esri.views.3d.analysis.Slice.SliceVisualization")],G);export{G as SliceVisualization};
