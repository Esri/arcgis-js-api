/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../analysis/SlicePlane","../../../../core/clock","../../../../core/Handles","../../../../core/maybe","../../../../core/reactiveUtils","../../../../core/scheduling","../../../../core/screenUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/accessorSupport/decorators/subclass","../../../../chunks/mat4","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/boundedPlane","../../../../geometry/support/plane","../../../../geometry/support/ray","../../../../geometry/support/vectorStacks","./sliceToolConfig","./sliceToolUtils","./images/Factory","../../interactive/manipulatorUtils","../../interactive/editingTools/dragEventPipeline3D","../../support/geometryUtils/ray","../../webgl-engine/lib/Intersector","../../webgl-engine/lib/IntersectorInterfaces","../../../interactive/AnalysisToolBase","../../../interactive/dragEventPipeline","../../../support/screenUtils"],(function(e,t,i,a,n,s,r,o,l,c,h,p,u,d,_,y,P,v,f,g,w,m,M,T,D,S,E,V,b,R,O){"use strict";var k;let H=k=function(t){function c(e){var i;return(i=t.call(this,e)||this)._clock=a.clock,i._previewPlaneOpacity=1,i.removeIncompleteOnCancel=!1,i.layersMode="none",i.shiftManipulator=null,i.rotateHeadingManipulator=null,i.rotateTiltManipulator=null,i.resizeManipulators=null,i._handles=new n,i._viewHandles=new n,i._frameTask=null,i._pointerMoveTimerMs=w.POINTER_MOVE_TIMER_MS,i._prevPointerMoveTimeout=null,i._previewPlaneGridVisualElement=null,i._previewPlaneOutlineVisualElement=null,i._startPlane=P.create(),i._previewPlane=null,i._activeKeyModifiers={},i._lastCursorPosition=l.createScreenPoint(),i._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],i._intersector=E.newIntersector(e.view.state.viewingMode),i._intersector.options.store=V.StoreResults.MIN,i}e._inheritsLoose(c,t);var h=c.prototype;return h.initialize=function(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this._rotateHeadingImage=M.getRotateHeadingTexture(this.view.toolViewManager.textures),this._rotateTiltImage=M.getTiltRotateTexture(this.view.toolViewManager.textures);const e=e=>{this._updateManipulatorsInteractive(e),e.grabbing||(s.isSome(this.analysisViewData.plane)&&P.copy(this.analysisViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=m.createShiftManipulator(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(t=>{this._onShiftGrab(t),e(this.shiftManipulator)})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=m.createRotateManipulator(this.view,this._rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(t=>{this._onRotateHeadingGrab(t),e(this.rotateHeadingManipulator)})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=m.createRotateManipulator(this.view,this._rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(t=>{this._onRotateTiltGrab(t),e(this.rotateTiltManipulator)})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map(((t,i)=>{const a=m.createResizeManipulator(this.view,t);return a.events.on("grab-changed",(t=>{this._onResizeGrab(t,i),e(a)})),this._handles.add(this._createResizeDragPipeline(a)),a})),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=m.createGridVisualElement(this.view),this._previewPlaneOutlineVisualElement=m.createOutlineVisualElement(this.view),this._previewPlaneOutlineVisualElement.width=w.PLANE_PREVIEW_OUTLINE_WIDTH,this._handles.add(r.watch((()=>this.analysisViewData.plane),(()=>this._updateManipulators()),r.sync));const t=r.watch((()=>this.state),(e=>{"sliced"===e&&this.finishToolCreation()}),r.syncAndInitial);this._handles.add([t,r.watch((()=>this.view.state.camera),(()=>this._onCameraChange()))])},h.destroy=function(){this._rotateHeadingImage=s.releaseMaybe(this._rotateHeadingImage),this._rotateTiltImage=s.releaseMaybe(this._rotateTiltImage),this._handles=s.destroyMaybe(this._handles),this._viewHandles=s.destroyMaybe(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=s.destroyMaybe(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=s.destroyMaybe(this._previewPlaneGridVisualElement)},h.enterExcludeLayerMode=function(){s.isNone(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))},h.exitExcludeLayerMode=function(){s.isNone(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))},h.onDeactivate=function(){this._set("layersMode","none"),this._updatePreviewPlane(null)},h.onShow=function(){this._updateVisibility(!0)},h.onHide=function(){this._updateVisibility(!1)},h._updateVisibility=function(e){this._updateManipulators(),e||this._clearPointerMoveTimeout()},h.onInputEvent=function(e){switch(e.type){case"pointer-drag":if(!N(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!N(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!N(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}},h.onEditableChange=function(){this.analysisViewData.editable=this.internallyEditable},h._onPointerDrag=function(e){const t=this.inputState;if(e.pointerId===this._creatingPointerId&&s.isSome(t)&&"shift"===t.type){const i=O.createScreenPointFromEvent(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1},h._onPointerMove=function(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane(O.createScreenPointFromEvent(e),this._activeKeyModifiers)},h._onCameraChange=function(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()},h._onPointerUp=function(e){if(e.pointerId===this._creatingPointerId&&s.isSome(this.analysisViewData.plane)){const t=O.createScreenPointFromEvent(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),P.copy(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1},h._onClickPlacePlane=function(e){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){const t=O.createScreenPointFromEvent(e),a=P.create();if(this._pickPlane(t,!1,this._activeKeyModifiers,a)){if(P.copy(a,this._startPlane),this.analysis.shape=m.planeToShape(a,this.view,this.view.spatialReference,new i),"pointer-drag"===e.type){const i=this._calculatePickRay(t);this.inputState=I(i,e.pointerId,a.origin,a)}return!0}}return!1},h._onClickExcludeLayer=function(e){return!("exclude"!==this.layersMode||!this.created)&&(this.view.hitTest(O.createScreenPointFromEvent(e)).then((e=>{if(e.results.length){const t=e.results[0],i="graphic"===t?.type&&t.graphic;if(i){const e=i.sourceLayer||i.layer;e&&this.analysis.excludedLayers.push(e)}}else e.ground.layer?this.analysis.excludedLayers.push(e.ground.layer):this.analysis.excludeGroundSurface=!0})),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),!0)},h._onKeyDown=function(e){return(e.key===w.forceVerticalModifier||e.key===w.forceHorizontalModifier)&&(this._activeKeyModifiers[e.key]=!0,s.isSome(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)},h._onKeyUp=function(e){return!(e.key!==w.forceVerticalModifier&&e.key!==w.forceHorizontalModifier||!this._activeKeyModifiers[e.key])&&(delete this._activeKeyModifiers[e.key],s.isSome(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)},h._onShiftGrab=function(e){if("start"!==e.action||s.isNone(this.analysisViewData.plane)||!e.screenPoint)return;const t=this._calculatePickRay(e.screenPoint);P.copy(this.analysisViewData.plane,this._startPlane),this.inputState=I(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)},h._createShiftDragPipeline=function(e){return R.createManipulatorDragEventPipeline(e,((e,t,i)=>{const a=this.inputState;if(s.isNone(a)||"shift"!==a.type)return;const n=s.isSome(this.analysisViewData.plane)?P.copy(this.analysisViewData.plane,P.create()):null;t.next(D.screenToRenderPlane(this.view,a.shiftPlane)).next(this._shiftDragAdjustSensitivity(a)).next(this._shiftDragUpdatePlane(a)),i.next((()=>{s.isSome(n)&&this._updateBoundedPlane(n)}))}))},h._shiftDragAdjustSensitivity=function(e){return t=>{if(s.isNone(this.analysisViewData.plane))return null;const i=.001,a=Math.min((1-Math.abs(_.dot(P.normal(this.analysisViewData.plane),t.ray.direction)/_.length(t.ray.direction)))/i,1),n=-v.signedDistance(this._startPlane.plane,t.renderEnd),r=-v.signedDistance(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-a)+n*a-r,t}},h._shiftDragUpdatePlane=function(e){return()=>{if(s.isNone(this.analysisViewData.plane))return;const t=_.copy(g.sv3d.get(),this._startPlane.origin),i=_.copy(g.sv3d.get(),P.normal(this._startPlane));_.scale(i,i,-e.depth),_.add(i,i,t);const a=P.fromValues(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,P.create());this._updateBoundedPlane(a)}},h._onRotateHeadingGrab=function(e){if("start"!==e.action||s.isNone(this.analysisViewData.plane)||!e.screenPoint)return;const t=m.createRotatePlane(this.analysisViewData.plane,this.view.renderCoordsHelper,m.RotationAxis.HEADING,v.create()),i=this._calculatePickRay(e.screenPoint),a=y.create();v.intersectRay(t,i,a)&&(P.copy(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})},h._createRotateHeadingDragPipeline=function(e){return R.createManipulatorDragEventPipeline(e,((e,t,i)=>{const a=this.inputState;if(s.isNone(a)||"rotate"!==a.type)return;const n=s.isSome(this.analysisViewData.plane)?P.copy(this.analysisViewData.plane,P.create()):null;t.next(D.screenToRenderPlane(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{s.isSome(n)&&this._updateBoundedPlane(n)}))}))},h._onRotateTiltGrab=function(e){if("start"!==e.action||s.isNone(this.analysisViewData.plane)||!e.screenPoint)return;const t=m.createRotatePlane(this.analysisViewData.plane,this.view.renderCoordsHelper,m.RotationAxis.TILT,v.create()),i=this._calculatePickRay(e.screenPoint),a=y.create();v.intersectRay(t,i,a)&&(P.copy(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})},h._createRotateTiltDragPipeline=function(e){return R.createManipulatorDragEventPipeline(e,((e,t,i)=>{const a=this.inputState;if(s.isNone(a)||"rotate"!==a.type)return;const n=s.isSome(this.analysisViewData.plane)?P.copy(this.analysisViewData.plane,P.create()):null;t.next(D.screenToRenderPlane(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{s.isSome(n)&&this._updateBoundedPlane(n)}))}))},h._rotateDragRenderPlaneToRotate=function(e){return t=>{if(s.isNone(this.analysisViewData.plane))return null;const i=v.normal(e.rotatePlane),a=T.calculateInputRotationTransform(e.startPoint,t.renderEnd,this.analysisViewData.plane.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}},h._rotateDragUpdatePlaneFromRotate=function(){return e=>{if(s.isNone(this.analysisViewData.plane))return;const t=d.fromRotation(g.sm4d.get(),e.rotateAngle,e.rotateAxis);if(s.isNone(t))return;const i=_.transformMat4(g.sv3d.get(),this._startPlane.basis1,t),a=_.transformMat4(g.sv3d.get(),this._startPlane.basis2,t),n=P.fromValues(this.analysisViewData.plane.origin,i,a,P.create());this._updateBoundedPlane(n)}},h._onResizeGrab=function(e,t){if("start"!==e.action||s.isNone(this.analysisViewData.plane)||!e.screenPoint)return;const i=this._calculatePickRay(e.screenPoint),a=g.sv3d.get();v.intersectRay(this.analysisViewData.plane.plane,i,a)&&(P.copy(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:y.clone(a)})},h._createResizeDragPipeline=function(e){return R.createManipulatorDragEventPipeline(e,((e,t,i)=>{const a=this.inputState;if(s.isNone(a)||"resize"!==a.type||s.isNone(this.analysisViewData.plane))return;const n=P.copy(this.analysisViewData.plane,P.create());t.next(D.screenToRenderPlane(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(a)),i.next((()=>{this._updateBoundedPlane(n)}))}))},h._resizeDragUpdatePlane=function(e){return t=>{if(s.isNone(this.analysisViewData.plane))return;const i=this._resizeHandles[e.activeHandleIdx],a=m.resizePlane(i,e.startPoint,t.renderEnd,this.view.state.camera,this._startPlane,P.copy(this.analysisViewData.plane));this._updateBoundedPlane(a)}},h._updateBoundedPlane=function(e){const t=this.analysisViewData;if(!s.isSome(t))throw new Error("valid internal object expected");t.plane=e},h._updatePreviewPlane=function(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,s.isNone(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const a=s.isSome(i)?i:P.create();if(i=s.isSome(i)?P.copy(i,C):null,this._pickPlane(e,!0,t,a)){const e=w.PREVIEW_FADE_DOT_THRESHOLD;let t=!1;s.isSome(i)&&(t=_.dot(i.plane,a.plane)<e||_.dot(_.normalize(g.sv3d.get(),i.basis1),_.normalize(g.sv3d.get(),a.basis1))<e),t&&(this._previewPlaneOpacity=0),this._previewPlane=a}}s.isSome(this._previewPlane)&&s.isNone(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=o.addFrameTask({update:({deltaTime:e})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+e/(1e3*w.PREVIEW_FADE_DURATION_SECONDS),1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask()}}):s.isNone(this._previewPlane)&&s.isSome(this._frameTask)?this._removeFrameTask():s.isSome(this._previewPlane)&&this._updateManipulators()},h._removeFrameTask=function(){this._frameTask=s.removeMaybe(this._frameTask)},h._calculatePickRay=function(e){const t=f.create(),i=l.screenPointObjectToArray(e,x);return S.fromScreen(this.view.state.camera,i,t),_.normalize(t.direction,t.direction),t},h._pickMinResult=function(e){const t=l.screenPointObjectToArray(e,g.sv2d.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min},h._pickPlane=function(e,t,i,a){const n=this._pickMinResult(e),s=g.sv3d.get();if(!n.getIntersectionPoint(s))return!1;const r=n.getTransformedNormal(g.sv3d.get()),o=this.view.state.camera;_.dot(r,o.viewForward)>0&&_.scale(r,r,-1);const l=m.calculatePlaneHalfSize(s,o),c=(t?1:-1)*l*w.INITIAL_DEPTH_OFFSET_FRAC,h=_.scale(g.sv3d.get(),r,c);_.add(h,h,s);const p=this.analysis.tiltEnabled?m.SliceOrientation.TILTED:m.SliceOrientation.HORIZONTAL_OR_VERTICAL,u=i[w.forceVerticalModifier]?m.SliceOrientation.VERTICAL:i[w.forceHorizontalModifier]?m.SliceOrientation.HORIZONTAL:p;return m.createPlane(h,r,l,l,o,u,this.view.renderCoordsHelper,a),!0},h._clearPointerMoveTimeout=function(){this._prevPointerMoveTimeout=s.removeMaybe(this._prevPointerMoveTimeout)},h._resetPointerMoveTimeout=function(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=m.DidPointerMoveRecentlyFlag,this.rotateHeadingManipulator.state|=m.DidPointerMoveRecentlyFlag,this.rotateTiltManipulator.state|=m.DidPointerMoveRecentlyFlag,this._prevPointerMoveTimeout=this._clock.setTimeout((()=>{this.shiftManipulator.state&=~m.DidPointerMoveRecentlyFlag,this.rotateHeadingManipulator.state&=~m.DidPointerMoveRecentlyFlag,this.rotateTiltManipulator.state&=~m.DidPointerMoveRecentlyFlag}),this._pointerMoveTimerMs)},h._updateManipulators=function(){if(k.disableEngineLayers)return;let e,t=!1;if(s.isSome(this.analysisViewData.plane))e=this.analysisViewData.plane,t=!1;else{if(!s.isSome(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((e=>e.available=!1)),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);e=this._previewPlane,t=!0}const i=m.calculateBoundedPlaneTranslateRotate(e,g.sm4d.get());t?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((e=>e.available=!1)),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach((e=>e.available=!0)),m.updateShiftRestartHandle(this.shiftManipulator,i,e,this.view.state.camera),m.updateRotateHeadingHandle(this.rotateHeadingManipulator,i,e,this.view.renderCoordsHelper),m.updateRotateTiltHandle(this.rotateTiltManipulator,i,e),this.resizeManipulators.forEach(((t,a)=>m.updateResizeHandle(t,this._resizeHandles[a],i,e))),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=_.set(g.sv3d.get(),_.length(e.basis1),_.length(e.basis2),1),n=d.fromScaling(g.sm4d.get(),a),r=d.multiply(n,i,n);this._previewPlaneOutlineVisualElement.transform=r,this._previewPlaneGridVisualElement.transform=r,this._updateMaterials()},h._updateMaterials=function(){const e=[w.PLANE_OUTLINE_COLOR[0],w.PLANE_OUTLINE_COLOR[1],w.PLANE_OUTLINE_COLOR[2],w.PLANE_OUTLINE_COLOR[3]*this._previewPlaneOpacity];this._previewPlaneOutlineVisualElement.color=e;const t=[w.PLANE_BACKGROUND_COLOR[0],w.PLANE_BACKGROUND_COLOR[1],w.PLANE_BACKGROUND_COLOR[2],w.PLANE_BACKGROUND_COLOR[3]*this._previewPlaneOpacity],i=[0,0,0,0];this._previewPlaneGridVisualElement.backgroundColor=t,this._previewPlaneGridVisualElement.gridColor=i},h._updateManipulatorsInteractive=function(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((e=>{e.interactive=!0}));this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach((t=>{t.interactive=t===e}))},h.testData=function(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:e=>{this._pointerMoveTimerMs=e}}},e._createClass(c,[{key:"state",get:function(){const e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}},{key:"cursor",get:function(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":s.isSome(this._creatingPointerId)?"grabbing":null}},{key:"analysis",set:function(e){if(null==e)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}},{key:"inputState",get:function(){return this._get("inputState")},set:function(e){this._set("inputState",e),this.analysisViewData.showGrid=s.isSome(e)&&"resize"===e.type,this._updateMaterials()}},{key:"_isPlacingSlicePlane",get:function(){return!this.inputState&&!this.analysisViewData.plane&&this.active}},{key:"_creatingPointerId",get:function(){return s.isSome(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}}]),c}(b.AnalysisToolBase);function I(e,t,i,a){const n=m.createShiftPlane(i,P.normal(a),e.direction,v.create()),s=y.create();return v.intersectRay(n,e,s)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:n,depth:0,startPoint:s}:null}function N(e){return"mouse"!==e.pointerType||0===e.button}H.disableEngineLayers=!1,t.__decorate([c.property()],H.prototype,"_clock",void 0),t.__decorate([c.property({constructOnly:!0})],H.prototype,"view",void 0),t.__decorate([c.property()],H.prototype,"analysisViewData",void 0),t.__decorate([c.property({readOnly:!0})],H.prototype,"state",null),t.__decorate([c.property({readOnly:!0})],H.prototype,"cursor",null),t.__decorate([c.property()],H.prototype,"analysis",null),t.__decorate([c.property()],H.prototype,"removeIncompleteOnCancel",void 0),t.__decorate([c.property({readOnly:!0})],H.prototype,"layersMode",void 0),t.__decorate([c.property({value:null})],H.prototype,"inputState",null),t.__decorate([c.property()],H.prototype,"_isPlacingSlicePlane",null),t.__decorate([c.property()],H.prototype,"_creatingPointerId",null),H=k=t.__decorate([u.subclass("esri.views.3d.analysis.Slice.SliceTool")],H);const C=P.create(),x=l.createScreenPointArray();return H}));
