/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as s}from"../../../chunks/tslib.es6.js";import i from"../../../core/Accessor.js";import o from"../../../core/Collection.js";import{abortMaybe as t,destroyMaybe as e}from"../../../core/maybe.js";import{on as n}from"../../../core/reactiveUtils.js";import{property as r}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import{subclass as a}from"../../../core/accessorSupport/decorators/subclass.js";import{AnalysisView3D as m}from"./AnalysisView3D.js";import{DimensioningTool as l}from"./Dimensioning/DimensioningTool.js";import{DimensioningVisualization as p}from"./Dimensioning/DimensioningVisualization.js";import{LengthDimensionComputation as c}from"./Dimensioning/LengthDimensionComputation.js";import{connectAnalysisViewToTool as d,removeAnalysisViewTool as u,activateTemporaryAnalysisViewTool as h}from"../../analysis/analysisViewUtils.js";let y=class extends(m(i)){constructor(s){super(s),this.type="dimensioning-view-3d",this.tool=null,this._computations=new o,this._dimensionsToResults=new Map,this._placementTask=null}initialize(){this.own([d(this,l),n((()=>this.analysis.dimensions),"change",(({added:s,removed:i})=>{for(const o of i)this._removeDimension(o);for(const o of s)this._addDimension(o)}),{onListenerAdd:s=>{for(const i of s)this._addDimension(i)},onListenerRemove:s=>{for(const i of s)this._removeDimension(i)}})]),this._analysisVisualization=new p({view:this.view,computations:this._computations})}destroy(){this._placementTask=t(this._placementTask),this._analysisVisualization=e(this._analysisVisualization),this._computations.drain((s=>s.destroy())),u(this)}get results(){return this.analysis.dimensions.map((s=>this._dimensionsToResults.get(s)))}get testInfo(){return{visualization:this._analysisVisualization}}async createLengthDimensions(s){return this._placementTask=t(this._placementTask),this._placementTask=h(this,l,s),this._placementTask.promise}_addDimension(s){const i=this._dimensionsToResults;if(i.has(s))return;const o=this._computations,t=new c({dimension:s});o.add(t),i.set(s,t.result)}_removeDimension(s){const i=this._computations,o=this._dimensionsToResults,t=i.findIndex((i=>i.dimension===s)),n=i.removeAt(t);o.delete(s),e(n)}};s([r({readOnly:!0})],y.prototype,"type",void 0),s([r({constructOnly:!0,nonNullable:!0})],y.prototype,"analysis",void 0),s([r()],y.prototype,"tool",void 0),s([r({readOnly:!0})],y.prototype,"results",null),s([r()],y.prototype,"_analysisVisualization",void 0),s([r()],y.prototype,"_computations",void 0),s([r()],y.prototype,"_dimensionsToResults",void 0),s([r()],y.prototype,"_placementTask",void 0),y=s([a("esri.views.3d.analysis.DimensioningAnalysisView3D")],y);const _=y;export{_ as default};
