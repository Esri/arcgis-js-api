/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{ShaderOutput as e}from"../core/shaderLibrary/ShaderOutputOptions.js";import{ReloadableShaderModule as t}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as i}from"../core/shaderTechnique/ShaderTechnique.js";import{TransparencyPassType as r}from"../lib/basicInterfaces.js";import{blendingDefault as n,oitBlending as l,oitDepthTest as s,oitDepthWrite as o}from"../lib/OrderIndependentTransparency.js";import{Program as c}from"../lib/Program.js";import{RenderSlot as a}from"../lib/RenderSlot.js";import{stencilWriteMaskOn as p,stencilToolMaskBaseParams as u,stencilBaseAllZerosParams as d,depthCompareAlways as h,stencilToolTransparentOccluderParams as T,stencilWriteMaskOff as m,stencilToolMaskOccluderParams as f,depthCompareLess as P}from"../lib/StencilUtils.js";import{VertexAttribute as g}from"../lib/VertexAttribute.js";import{L as O}from"../../../../chunks/LineMarker.glsl.js";import{makePipelineState as S,defaultDepthWriteParams as E,defaultColorWriteParams as b}from"../../../webgl/renderState.js";const A=new Map([[g.POSITION,0],[g.UV0,2],[g.AUXPOS1,3],[g.SIZE,6],[g.SIZEFEATUREATTRIBUTE,6],[g.COLOR,5],[g.COLORFEATUREATTRIBUTE,5],[g.OPACITYFEATUREATTRIBUTE,7]]);class R extends i{initializeProgram(e){const t=R.shader.get().build(this.configuration);return new c(e.rctx,t,A)}_makePipelineState(t,i){const c=this.configuration,a=t===r.NONE;return S({blending:c.output===e.Color||c.output===e.Alpha?a?n:l(t):null,depthTest:{func:s(t)},depthWrite:a?c.writeDepth&&E:o(t),colorWrite:b,stencilWrite:c.hasOccludees?p:null,stencilTest:c.hasOccludees?i?u:d:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=S({blending:n,depthTest:h,depthWrite:null,colorWrite:b,stencilWrite:null,stencilTest:T}),this._occluderPipelineOpaque=S({blending:n,depthTest:h,depthWrite:null,colorWrite:b,stencilWrite:m,stencilTest:f}),this._occluderPipelineMaskWrite=S({blending:null,depthTest:P,depthWrite:null,colorWrite:null,stencilWrite:p,stencilTest:u})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===a.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===a.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}R.shader=new t(O,(()=>import("./LineMarker.glsl.js")));export{R as LineMarkerTechnique,A as markerVertexAttributeLocations};
