/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/DefaultVertexAttributeLocations","../lib/OrderIndependentTransparency","../lib/Program","../../../../chunks/ShadowAccumulation.glsl","../../../webgl/renderState"],(function(e,i,r,t,a,o,n,s,l,u,c,h){"use strict";let p=function(e){function i(){return e.apply(this,arguments)||this}r._inheritsLoose(i,e);var t=i.prototype;return t.initializeProgram=function(e){const r=i.shader.get().build(this.configuration);return new u.Program(e.rctx,r,s.Default3D)},t.initializePipeline=function(e){return 0===this.configuration.pass?h.makePipelineState({blending:h.separateBlendingParams(1,1,1,1),colorWrite:h.defaultColorWriteParams,depthTest:null,depthWrite:null}):1===this.configuration.pass||2===this.configuration.pass?h.makePipelineState({blending:l.blendingDefault,colorWrite:h.defaultColorWriteParams,depthTest:null,depthWrite:null}):h.makePipelineState({})},t.bindPass=function(e){if(0===this.configuration.pass||2===this.configuration.pass){const i=e;this.program.bindTexture(i.linearDepthTexture,"depthMap"),i.shadowMap.bind(this.program),i.shadowMap.bindView(this.program,i.camera.center),this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",i.inverseView),this.program.setUniform4fv("projInfo",i.projInfo),this.program.setUniform2fv("zScale",i.zScale)}else if(1===this.configuration.pass){const i=e;if(this.program.bindTexture(i.shadowAccumulationMap,"shadowAccumulationMap"),this.program.setUniform1f("sampleScale",i.sampleScale),this.program.setUniform1f("opacityFromElevation",i.opacityFromElevation),0===this.configuration.visualization){const i=e;this.program.bindTexture(i.colorRamp,"colorRamp"),this.program.setUniform1f("rampSize",i.rampSize),this.configuration.bandsEnabled&&this.program.setUniform1f("bandSize",i.bandSize)}else if(1===this.configuration.visualization){const i=e;this.program.setUniform1f("threshold",i.threshold),this.program.setUniform4fv("colors",i.colors)}}},r._createClass(i,[{key:"primitiveType",get:function(){return 5}}]),i}(o.ShaderTechnique);p.shader=new a.ReloadableShaderModule(c.ShadowAccumulationShader,(()=>new Promise((function(i,r){e(["./ShadowAccumulation.glsl"],i,r)}))));let d=function(e){function i(){var i;return(i=e.apply(this,arguments)||this).pass=0,i.visualization=0,i.bandsEnabled=!1,i}return r._inheritsLoose(i,e),i}(n.ShaderTechniqueConfiguration);t.__decorate([n.parameter({count:3})],d.prototype,"pass",void 0),t.__decorate([n.parameter()],d.prototype,"visualization",void 0),t.__decorate([n.parameter()],d.prototype,"bandsEnabled",void 0),i.ShadowAccumulationTechnique=p,i.ShadowAccumulationTechniqueConfiguration=d,Object.defineProperty(i,"__esModule",{value:!0})}));
