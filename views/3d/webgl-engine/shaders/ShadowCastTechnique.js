/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/DefaultVertexAttributeLocations","../lib/OrderIndependentTransparency","../lib/Program","../../../../chunks/ShadowCast.glsl","../../../webgl/renderState"],(function(e,i,t,r,a,n,o,s,l,h,u,p){"use strict";let d=function(e){function i(){return e.apply(this,arguments)||this}t._inheritsLoose(i,e);var r=i.prototype;return r.initializeProgram=function(e){const t=i.shader.get().build(this.configuration);return new h.Program(e.rctx,t,s.Default3D)},r.initializePipeline=function(e){return 0===this.configuration.pass?p.makePipelineState({blending:p.separateBlendingParams(1,1,1,1),colorWrite:p.defaultColorWriteParams,depthTest:null,depthWrite:null}):1===this.configuration.pass||2===this.configuration.pass?p.makePipelineState({blending:l.blendingDefault,colorWrite:p.defaultColorWriteParams,depthTest:null,depthWrite:null}):p.makePipelineState({})},r.bindPass=function(e){if(0===this.configuration.pass||2===this.configuration.pass){const i=e;this.program.bindTexture(i.linearDepthTexture,"depthMap"),i.shadowMap.bind(this.program),i.shadowMap.bindView(this.program,i.camera.center),this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",i.inverseView),this.program.setUniform4fv("projInfo",i.projInfo),this.program.setUniform2fv("zScale",i.zScale)}else if(1===this.configuration.pass){const i=e;if(this.program.bindTexture(i.shadowCastMap,"shadowCastMap"),this.program.setUniform1f("sampleScale",i.sampleScale),this.program.setUniform1f("opacityFromElevation",i.opacityFromElevation),this.program.setUniform4fv("color",i.color),0===this.configuration.visualization&&this.configuration.bandsEnabled){const i=e;this.program.setUniform1f("bandSize",i.bandSize)}else if(1===this.configuration.visualization){const i=e;this.program.setUniform1f("threshold",i.threshold)}}},t._createClass(i,[{key:"primitiveType",get:function(){return 5}}]),i}(n.ShaderTechnique);d.shader=new a.ReloadableShaderModule(u.ShadowCastShader,(()=>new Promise((function(i,t){e(["./ShadowCast.glsl"],i,t)}))));let c=function(e){function i(){var i;return(i=e.apply(this,arguments)||this).pass=0,i.visualization=0,i.bandsEnabled=!1,i}return t._inheritsLoose(i,e),i}(o.ShaderTechniqueConfiguration);r.__decorate([o.parameter({count:3})],c.prototype,"pass",void 0),r.__decorate([o.parameter()],c.prototype,"visualization",void 0),r.__decorate([o.parameter()],c.prototype,"bandsEnabled",void 0),i.ShadowCastTechnique=d,i.ShadowCastTechniqueConfiguration=c,Object.defineProperty(i,"__esModule",{value:!0})}));
