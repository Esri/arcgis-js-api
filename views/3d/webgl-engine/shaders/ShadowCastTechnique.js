/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/DefaultVertexAttributeLocations","../lib/OrderIndependentTransparency","../lib/Program","../../../../chunks/ShadowCast.glsl","../../../webgl/enums","../../../webgl/renderState"],(function(e,a,t,i,r,o,s,n,l,u,d,h,c){"use strict";let p=function(e){function a(a,t){var i;return i=e.call(this,a,t,(()=>i.destroy()))||this}t._inheritsLoose(a,e);var i=a.prototype;return i.initializeProgram=function(e){const t=a.shader.get().build(this.configuration);return new u.Program(e.rctx,t,n.Default3D)},i.initializePipeline=function(e){switch(this.configuration.pass){case d.ShadowCastPass.Accumulate:return c.makePipelineState({blending:c.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendFactor.ONE),colorWrite:c.defaultColorWriteParams,depthTest:null,depthWrite:null});case d.ShadowCastPass.Visualize:case d.ShadowCastPass.VisualizeCurrent:return c.makePipelineState({blending:l.blendingDefault,colorWrite:c.defaultColorWriteParams,depthTest:null,depthWrite:null})}return c.makePipelineState({})},i.bindPass=function(e){if(this.configuration.pass===d.ShadowCastPass.Accumulate||this.configuration.pass===d.ShadowCastPass.VisualizeCurrent){const a=e;this.program.bindTexture(a.linearDepthTexture,"depthMap"),a.shadowMap.bind(this.program),a.shadowMap.bindView(this.program,a.camera.center),this.program.setUniform2fv("nearFar",a.camera.nearFar),this.program.setUniformMatrix4fv("inverseViewMatrix",a.inverseViewMatrix),this.program.setUniform4fv("projInfo",a.projInfo),this.program.setUniform2fv("zScale",a.zScale)}else if(this.configuration.pass===d.ShadowCastPass.Visualize){const a=e;if(this.program.bindTexture(a.shadowCastMap,"shadowCastMap"),this.program.setUniform1f("sampleScale",a.sampleScale),this.program.setUniform1f("opacityFromElevation",a.opacityFromElevation),this.program.setUniform4fv("uColor",a.color),this.configuration.visualization===d.ShadowCastVisualization.Gradient&&this.configuration.bandsEnabled){const a=e;this.program.setUniform1f("bandSize",a.bandSize)}else if(this.configuration.visualization===d.ShadowCastVisualization.Threshold){const a=e;this.program.setUniform1f("threshold",a.threshold)}}},t._createClass(a,[{key:"primitiveType",get:function(){return h.PrimitiveType.TRIANGLE_STRIP}}]),a}(o.ShaderTechnique);p.shader=new r.ReloadableShaderModule(d.ShadowCast,(()=>new Promise(((a,t)=>e(["./ShadowCast.glsl"],a,t)))));let f=function(e){function a(){var a;return(a=e.apply(this,arguments)||this).pass=d.ShadowCastPass.Accumulate,a.visualization=d.ShadowCastVisualization.Gradient,a.bandsEnabled=!1,a}return t._inheritsLoose(a,e),a}(s.ShaderTechniqueConfiguration);i.__decorate([s.parameter({count:d.ShadowCastPass.COUNT})],f.prototype,"pass",void 0),i.__decorate([s.parameter()],f.prototype,"visualization",void 0),i.__decorate([s.parameter()],f.prototype,"bandsEnabled",void 0),a.ShadowCastTechnique=p,a.ShadowCastTechniqueConfiguration=f,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
