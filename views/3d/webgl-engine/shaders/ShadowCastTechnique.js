/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/DefaultVertexAttributeLocations","../lib/OrderIndependentTransparency","../lib/Program","../../../../chunks/ShadowCast.glsl","../../../webgl/renderState"],(function(e,i,r,t,a,n,o,s,l,h,u,c){"use strict";let d=function(e){function i(){return e.apply(this,arguments)||this}r._inheritsLoose(i,e);var t=i.prototype;return t.initializeProgram=function(e){const r=i.shader.get().build(this.configuration);return new h.Program(e.rctx,r,s.Default3D)},t.initializePipeline=function(e){switch(this.configuration.pass){case 0:return c.makePipelineState({blending:c.separateBlendingParams(1,1,1,1),colorWrite:c.defaultColorWriteParams,depthTest:null,depthWrite:null});case 1:case 2:return c.makePipelineState({blending:l.blendingDefault,colorWrite:c.defaultColorWriteParams,depthTest:null,depthWrite:null})}return c.makePipelineState({})},t.bindPass=function(e){if(0===this.configuration.pass||2===this.configuration.pass){const i=e;this.program.bindTexture(i.linearDepthTexture,"depthMap"),i.shadowMap.bind(this.program),i.shadowMap.bindView(this.program,i.camera.center),this.program.setUniform2fv("nearFar",i.camera.nearFar),this.program.setUniformMatrix4fv("inverseView",i.inverseView),this.program.setUniform4fv("projInfo",i.projInfo),this.program.setUniform2fv("zScale",i.zScale)}else if(1===this.configuration.pass){const i=e;if(this.program.bindTexture(i.shadowCastMap,"shadowCastMap"),this.program.setUniform1f("sampleScale",i.sampleScale),this.program.setUniform1f("opacityFromElevation",i.opacityFromElevation),this.program.setUniform4fv("color",i.color),0===this.configuration.visualization&&this.configuration.bandsEnabled){const i=e;this.program.setUniform1f("bandSize",i.bandSize)}else if(1===this.configuration.visualization){const i=e;this.program.setUniform1f("threshold",i.threshold)}}},r._createClass(i,[{key:"primitiveType",get:function(){return 5}}]),i}(n.ShaderTechnique);d.shader=new a.ReloadableShaderModule(u.ShadowCast,(()=>new Promise(((i,r)=>e(["./ShadowCast.glsl"],i,r)))));let p=function(e){function i(){var i;return(i=e.apply(this,arguments)||this).pass=0,i.visualization=0,i.bandsEnabled=!1,i}return r._inheritsLoose(i,e),i}(o.ShaderTechniqueConfiguration);t.__decorate([o.parameter({count:3})],p.prototype,"pass",void 0),t.__decorate([o.parameter()],p.prototype,"visualization",void 0),t.__decorate([o.parameter()],p.prototype,"bandsEnabled",void 0),i.ShadowCastTechnique=d,i.ShadowCastTechniqueConfiguration=p,Object.defineProperty(i,"__esModule",{value:!0})}));
