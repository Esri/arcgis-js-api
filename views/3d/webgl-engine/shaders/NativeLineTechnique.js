/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/maybe","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/DefaultVertexAttributeLocations","../../../webgl/Program","../../../webgl/renderState","../core/shaderLibrary/util/View.glsl","../core/shaderLibrary/Slice.glsl","../core/shaderLibrary/output/OutputHighlight.glsl","../lib/StencilUtils","../../../../chunks/NativeLine.glsl"],(function(e,t,i,r,a,l,n,s,o,p,u,c,d,h,f,g){"use strict";let b=function(e){function t(t,i){var r;return(r=e.call(this,t,i)||this).stipplePattern=null,r.stippleTextureBind=null,r.stippleTextureRepository=t.stippleTextureRepository,r}i._inheritsLoose(t,e);var r=t.prototype;return r.initializeProgram=function(e){const i=t.shader.get(),r=this.configuration,a=i.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:r.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:r.stippleIntegerRepeatsEnabled});return new p(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),o.Default3D)},r.dispose=function(){e.prototype.dispose.call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null},r.bindPass=function(e,t,i){if(c.View.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.stipplePattern!==t.stipplePattern){const e=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,e),this.stipplePattern=e}if(this.configuration.stippleEnabled){const t=a.isSome(this.stippleTextureBind)?this.stippleTextureBind(e,0)*i.camera.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/t),this.program.setUniform2f("ndcToPixel",i.camera.fullViewport[2]/2,i.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*i.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const e=a.unwrap(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",e[0],e[1],e[2],e.length>3?e[3]:1)}4===this.configuration.output&&h.OutputHighlight.bindOutputHighlight(e,this.program,i)},r.bindDraw=function(e){c.View.bindView(this.program,e),d.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},r.initializePipeline=function(){const e=this.configuration,t=u.separateBlendingParams(770,1,771,771),i=(t,i=null,r=null)=>u.makePipelineState({blending:i,depthTest:f.depthCompareLess,depthWrite:r,colorWrite:u.defaultColorWriteParams,stencilWrite:e.sceneHasOcludees?f.stencilWriteMaskOn:null,stencilTest:e.sceneHasOcludees?t?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null});return 0===e.output?(this._occludeePipelineState=i(!0,e.transparent||e.stippleEnabled?t:null,u.defaultDepthWriteParams),i(!1,e.transparent||e.stippleEnabled?t:null,u.defaultDepthWriteParams)):i(!1)},r.getPipelineState=function(e){return e?this._occludeePipelineState:this.pipeline},i._createClass(t,[{key:"primitiveType",get:function(){return 1}}]),t}(n.ShaderTechnique);b.shader=new l.ReloadableShaderModule(g.NativeLineShader,(()=>new Promise((function(t,i){e(["./NativeLine.glsl"],t,i)}))));let m=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).output=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!1,t.stippleEnabled=!1,t.stippleOffColorEnabled=!1,t.stippleIntegerRepeatsEnabled=!1,t.sceneHasOcludees=!1,t}return i._inheritsLoose(t,e),t}(s.ShaderTechniqueConfiguration);r.__decorate([s.parameter({count:8})],m.prototype,"output",void 0),r.__decorate([s.parameter()],m.prototype,"slicePlaneEnabled",void 0),r.__decorate([s.parameter()],m.prototype,"sliceHighlightDisabled",void 0),r.__decorate([s.parameter()],m.prototype,"vertexColors",void 0),r.__decorate([s.parameter()],m.prototype,"transparent",void 0),r.__decorate([s.parameter()],m.prototype,"stippleEnabled",void 0),r.__decorate([s.parameter()],m.prototype,"stippleOffColorEnabled",void 0),r.__decorate([s.parameter()],m.prototype,"stippleIntegerRepeatsEnabled",void 0),r.__decorate([s.parameter()],m.prototype,"sceneHasOcludees",void 0),t.NativeLineTechnique=b,t.NativeLineTechniqueConfiguration=m,Object.defineProperty(t,"__esModule",{value:!0})}));
