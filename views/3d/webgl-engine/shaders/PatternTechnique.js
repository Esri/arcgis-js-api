/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/DefaultVertexAttributeLocations","../../../webgl/Program","../../../webgl/renderState","../core/shaderLibrary/util/View.glsl","../core/shaderLibrary/Slice.glsl","../core/shaderLibrary/output/OutputHighlight.glsl","../lib/OrderIndependentTransparency","../lib/StencilUtils","../../../../chunks/Pattern.glsl"],(function(e,t,r,i,a,o,n,s,l,c,p,u,d,h,g,f){"use strict";let m=function(e){function t(){return e.apply(this,arguments)||this}r._inheritsLoose(t,e);var i=t.prototype;return i.initializeProgram=function(e){const r=t.shader.get(),i=this.configuration,a=r.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,style:i.style,patternSpacing:i.patternSpacing,lineWidth:i.lineWidth,draped:i.draped,OITEnabled:0===i.transparencyPassType});return new l(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),s.Default3D)},i.bindPass=function(e,t,r){p.View.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform4fv("matColor",t.color),this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/r.screenToWorldRatioGlobalWM),this.program.setUniform1f("texelSize",1/r.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/r.camera.perScreenPixelRatio),4===this.configuration.output&&d.OutputHighlight.bindOutputHighlight(e,this.program,r),1===this.configuration.output&&this.program.setUniform2fv("nearFar",r.camera.nearFar)},i.bindDraw=function(e){p.View.bindView(this.program,e),p.View.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),u.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},i.setPipelineState=function(e,t){const r=this.configuration,i=3===e,a=2===e;return c.makePipelineState({blending:0===r.output||7===r.output?r.transparent&&i?h.blendingDefault:h.OITBlending(e):null,culling:(o=r.cullFace,0!==o&&{face:1===o?1028:1029,mode:2305}),depthTest:{func:h.OITDepthTest(e)},depthWrite:i?r.writeDepth&&c.defaultDepthWriteParams:h.OITDepthWrite(e),colorWrite:c.defaultColorWriteParams,stencilWrite:r.sceneHasOcludees?g.stencilWriteMaskOn:null,stencilTest:r.sceneHasOcludees?t?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:null,polygonOffset:i||a?r.polygonOffset&&y:h.getOITPolygonOffset(r.enableOffset)});var o},i.initializePipeline=function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)},i.getPipelineState=function(e){return e?this._occludeePipelineState:this.pipeline},t}(o.ShaderTechnique);m.shader=new a.ReloadableShaderModule(f.PatternShader,(()=>new Promise((function(t,r){e(["./Pattern.glsl"],t,r)}))));const y={factor:1,units:1};let b=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.vertexColors=!1,t.transparent=!0,t.polygonOffset=!1,t.writeDepth=!0,t.sceneHasOcludees=!1,t.enableOffset=!0,t.transparencyPassType=3,t}return r._inheritsLoose(t,e),t}(n.ShaderTechniqueConfiguration);i.__decorate([n.parameter({count:8})],b.prototype,"output",void 0),i.__decorate([n.parameter({count:3})],b.prototype,"cullFace",void 0),i.__decorate([n.parameter()],b.prototype,"slicePlaneEnabled",void 0),i.__decorate([n.parameter()],b.prototype,"sliceHighlightDisabled",void 0),i.__decorate([n.parameter()],b.prototype,"vertexColors",void 0),i.__decorate([n.parameter()],b.prototype,"transparent",void 0),i.__decorate([n.parameter()],b.prototype,"polygonOffset",void 0),i.__decorate([n.parameter()],b.prototype,"writeDepth",void 0),i.__decorate([n.parameter()],b.prototype,"sceneHasOcludees",void 0),i.__decorate([n.parameter({count:6})],b.prototype,"style",void 0),i.__decorate([n.parameter()],b.prototype,"patternSpacing",void 0),i.__decorate([n.parameter()],b.prototype,"lineWidth",void 0),i.__decorate([n.parameter()],b.prototype,"enableOffset",void 0),i.__decorate([n.parameter()],b.prototype,"draped",void 0),i.__decorate([n.parameter({count:4})],b.prototype,"transparencyPassType",void 0),t.PatternTechnique=m,t.PatternTechniqueConfiguration=b,Object.defineProperty(t,"__esModule",{value:!0})}));
