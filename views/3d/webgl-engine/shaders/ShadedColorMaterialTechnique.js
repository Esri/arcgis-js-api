/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../chunks/vec4f64","../core/shaderLibrary/ScreenSizeScaling.glsl","../core/shaderLibrary/Slice.glsl","../core/shaderLibrary/shading/MultipassTerrainTest.glsl","../core/shaderLibrary/util/View.glsl","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/OrderIndependentTransparency","../lib/Program","../../../../chunks/ShadedColorMaterial.glsl","../../../webgl/renderState"],(function(e,r,a,i,t,n,o,s,l,d,c,p,u,h,g,b){"use strict";let m=function(e){function r(){return e.apply(this,arguments)||this}a._inheritsLoose(r,e);var i=r.prototype;return i.initializeProgram=function(e){const a=r.shader.get(),i=this.configuration,t=a.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new h.Program(e.rctx,t,T)},i.bindPass=function(e,r){const{screenSizeEnabled:a,shadingEnabled:i}=this.configuration,{color:t,shadingTint:o,shadingDirection:d}=e;l.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform4fv("color",t),r.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",r.camera.nearFar),this.program.setUniform2fv("inverseViewport",r.inverseViewport),s.bindMultipassTerrainTexture(this.program,r)),i&&(this.program.setUniform4fv("shadedColor",this.blendColor(v,o,t)),this.program.setUniform3fv("shadingDirection",d),this.program.setUniformMatrix4fv("viewNormal",r.camera.viewInverseTransposeMatrix)),a&&n.bindScreenSizeScalingUniforms(this.program,e,r)},i.bindDraw=function(e){l.bindView(this.program,e),l.bindCameraPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),o.bindSliceUniformsWithOrigin(this.program,this.configuration,e),this.program.rebindTextures()},i.blendColor=function(e,r,a){const i=1-r[3],t=r[3]+a[3]*i;return 0===t?(e[3]=t,e):(e[0]=(r[0]*r[3]+a[0]*a[3]*i)/t,e[1]=(r[1]*r[3]+a[1]*a[3]*i)/t,e[2]=(r[2]*r[3]+a[2]*a[3]*i)/t,e[3]=a[3],e)},i.setPipelineState=function(e){const r=this.configuration,a=3===e,i=2===e;return b.makePipelineState({blending:0!==r.output&&7!==r.output||!r.transparent?null:a?u.blendingDefault:u.OITBlending(e),culling:b.cullingParams(r.cullFace),depthTest:{func:i?513:r.shadingEnabled?515:513},depthWrite:a?r.writeDepth&&b.defaultDepthWriteParams:u.OITDepthWrite(e),colorWrite:b.defaultColorWriteParams,polygonOffset:a||i?null:u.OITPolygonOffset})},i.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)},r}(c.ShaderTechnique);m.shader=new d.ReloadableShaderModule(g.ShadedColorMaterialShader,(()=>new Promise((function(r,a){e(["./ShadedColorMaterial.glsl"],r,a)}))));let f=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).output=0,r.cullFace=0,r.slicePlaneEnabled=!1,r.transparent=!1,r.writeDepth=!0,r.screenSizeEnabled=!0,r.shadingEnabled=!0,r.transparencyPassType=3,r.multipassTerrainEnabled=!1,r.cullAboveGround=!1,r}return a._inheritsLoose(r,e),r}(p.ShaderTechniqueConfiguration);i.__decorate([p.parameter({count:8})],f.prototype,"output",void 0),i.__decorate([p.parameter({count:3})],f.prototype,"cullFace",void 0),i.__decorate([p.parameter()],f.prototype,"slicePlaneEnabled",void 0),i.__decorate([p.parameter()],f.prototype,"transparent",void 0),i.__decorate([p.parameter()],f.prototype,"writeDepth",void 0),i.__decorate([p.parameter()],f.prototype,"screenSizeEnabled",void 0),i.__decorate([p.parameter()],f.prototype,"shadingEnabled",void 0),i.__decorate([p.parameter({count:4})],f.prototype,"transparencyPassType",void 0),i.__decorate([p.parameter()],f.prototype,"multipassTerrainEnabled",void 0),i.__decorate([p.parameter()],f.prototype,"cullAboveGround",void 0);const T=new Map([["position",0],["normal",1],["offset",2]]),v=t.create();r.ShadedColorMaterialTechnique=m,r.ShadedColorMaterialTechniqueConfiguration=f,r.ShadedColorMaterialVertexAttrLocations=T,Object.defineProperty(r,"__esModule",{value:!0})}));
