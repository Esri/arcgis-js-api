/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../chunks/vec4f64","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../../../webgl/Program","../../../webgl/renderState","../core/shaderLibrary/util/View.glsl","../core/shaderLibrary/Slice.glsl","../lib/OrderIndependentTransparency","../core/shaderLibrary/shading/MultipassTerrainTest.glsl","../core/shaderLibrary/ScreenSizeScaling.glsl","../../../../chunks/ShadedColorMaterial.glsl"],(function(e,r,a,i,t,n,o,s,l,d,c,p,u,h,g,m){"use strict";let b=function(e){function r(){return e.apply(this,arguments)||this}a._inheritsLoose(r,e);var i=r.prototype;return i.initializeProgram=function(e){const a=r.shader.get(),i=this.configuration,t=a.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new l(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),v)},i.bindPass=function(e,r,a){const{screenSizeEnabled:i,shadingEnabled:t}=this.configuration,{color:n,shadingTint:o,shadingDirection:s}=r;c.View.bindProjectionMatrix(this.program,a.camera.projectionMatrix),this.program.setUniform4fv("color",n),a.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",a.camera.nearFar),this.program.setUniform2fv("inverseViewport",a.inverseViewport),h.bindMultipassTerrainUniforms(this.program,e,a)),t&&(this.program.setUniform4fv("shadedColor",this.blendColor(S,o,n)),this.program.setUniform3fv("shadingDirection",s),this.program.setUniformMatrix4fv("viewNormal",a.camera.viewInverseTransposeMatrix)),i&&g.ScreenSizeScaling.bindPassUniforms(this.program,r,a)},i.blendColor=function(e,r,a){const i=1-r[3],t=r[3]+a[3]*i;return 0===t?(e[3]=t,e):(e[0]=(r[0]*r[3]+a[0]*a[3]*i)/t,e[1]=(r[1]*r[3]+a[1]*a[3]*i)/t,e[2]=(r[2]*r[3]+a[2]*a[3]*i)/t,e[3]=a[3],e)},i.bindDraw=function(e){c.View.bindView(this.program,e),c.View.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),p.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},i.setPipelineState=function(e){const r=this.configuration,a=3===e,i=2===e,t=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return d.makePipelineState({blending:0!==r.output&&7!==r.output||!r.transparent?null:a?u.blendingDefault:u.OITBlending(e),culling:t(r.cullFace),depthTest:{func:i?513:r.shadingEnabled?515:513},depthWrite:a?r.writeDepth&&d.defaultDepthWriteParams:u.OITDepthWrite(e),colorWrite:d.defaultColorWriteParams,polygonOffset:a||i?null:u.OITPolygonOffset})},i.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)},r}(o.ShaderTechnique);b.shader=new n.ReloadableShaderModule(m.ShadedColorMaterialShader,(()=>new Promise((function(r,a){e(["./ShadedColorMaterial.glsl"],r,a)}))));let f=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).output=0,r.cullFace=0,r.slicePlaneEnabled=!1,r.transparent=!1,r.writeDepth=!0,r.screenSizeEnabled=!0,r.shadingEnabled=!0,r.transparencyPassType=3,r.multipassTerrainEnabled=!1,r.cullAboveGround=!0,r}return a._inheritsLoose(r,e),r}(s.ShaderTechniqueConfiguration);i.__decorate([s.parameter({count:8})],f.prototype,"output",void 0),i.__decorate([s.parameter({count:3})],f.prototype,"cullFace",void 0),i.__decorate([s.parameter()],f.prototype,"slicePlaneEnabled",void 0),i.__decorate([s.parameter()],f.prototype,"transparent",void 0),i.__decorate([s.parameter()],f.prototype,"writeDepth",void 0),i.__decorate([s.parameter()],f.prototype,"screenSizeEnabled",void 0),i.__decorate([s.parameter()],f.prototype,"shadingEnabled",void 0),i.__decorate([s.parameter({count:4})],f.prototype,"transparencyPassType",void 0),i.__decorate([s.parameter()],f.prototype,"multipassTerrainEnabled",void 0),i.__decorate([s.parameter()],f.prototype,"cullAboveGround",void 0);const v={position:0,normal:1,offset:2},S=t.create();r.ShadedColorMaterialTechnique=b,r.ShadedColorMaterialTechniqueConfiguration=f,r.ShadedColorMaterialVertexAttrLocations=v,Object.defineProperty(r,"__esModule",{value:!0})}));
