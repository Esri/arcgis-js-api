/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../chunks/vec4f64","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../../../webgl/Program","../../../webgl/renderState","../core/shaderLibrary/util/View.glsl","../core/shaderLibrary/Slice.glsl","../lib/OrderIndependentTransparency","../core/shaderLibrary/ScreenSizeScaling.glsl","../../../../chunks/ShadedColorMaterial.glsl"],(function(e,r,t,i,a,n,o,s,l,d,c,h,p,u,g){"use strict";let f=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var i=r.prototype;return i.initializeProgram=function(e){const t=r.shader.get(),i=this.configuration,a=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:i.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType});return new l(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),m)},i.bindPass=function(e,r,t){const{screenSizeEnabled:i,shadingEnabled:a}=this.configuration,{color:n,shadingTint:o,shadingDirection:s}=r;c.View.bindProjectionMatrix(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",n),a&&(this.program.setUniform4fv("shadedColor",this.blendColor(S,o,n)),this.program.setUniform3fv("shadingDirection",s),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&u.ScreenSizeScaling.bindPassUniforms(this.program,r,t)},i.blendColor=function(e,r,t){const i=1-r[3],a=r[3]+t[3]*i;return 0===a?(e[3]=a,e):(e[0]=(r[0]*r[3]+t[0]*t[3]*i)/a,e[1]=(r[1]*r[3]+t[1]*t[3]*i)/a,e[2]=(r[2]*r[3]+t[2]*t[3]*i)/a,e[3]=t[3],e)},i.bindDraw=function(e){c.View.bindView(this.program,e),c.View.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),h.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},i.setPipelineState=function(e){const r=this.configuration,t=3===e,i=2===e;return d.makePipelineState({blending:0!==r.output&&7!==r.output||!r.transparent?null:t?p.blendingDefault:p.OITBlending(e),culling:(a=r.cullFace,0!==a&&{face:1===a?1028:1029,mode:2305}),depthTest:{func:i?513:r.shadingEnabled?515:513},depthWrite:t?r.writeDepth&&d.defaultDepthWriteParams:p.OITDepthWrite(e),colorWrite:d.defaultColorWriteParams,polygonOffset:t||i?null:p.OITPolygonOffset});var a},i.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)},r}(o.ShaderTechnique);f.shader=new n.ReloadableShaderModule(g.ShadedColorMaterialShader,(()=>new Promise((function(r,t){e(["./ShadedColorMaterial.glsl"],r,t)}))));let b=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).output=0,r.cullFace=0,r.slicePlaneEnabled=!1,r.sliceHighlightDisabled=!1,r.transparent=!1,r.writeDepth=!0,r.screenSizeEnabled=!0,r.shadingEnabled=!0,r.transparencyPassType=3,r}return t._inheritsLoose(r,e),r}(s.ShaderTechniqueConfiguration);i.__decorate([s.parameter({count:8})],b.prototype,"output",void 0),i.__decorate([s.parameter({count:3})],b.prototype,"cullFace",void 0),i.__decorate([s.parameter()],b.prototype,"slicePlaneEnabled",void 0),i.__decorate([s.parameter()],b.prototype,"sliceHighlightDisabled",void 0),i.__decorate([s.parameter()],b.prototype,"transparent",void 0),i.__decorate([s.parameter()],b.prototype,"writeDepth",void 0),i.__decorate([s.parameter()],b.prototype,"screenSizeEnabled",void 0),i.__decorate([s.parameter()],b.prototype,"shadingEnabled",void 0),i.__decorate([s.parameter({count:4})],b.prototype,"transparencyPassType",void 0);const m={position:0,normal:1,offset:2},S=a.create();r.ShadedColorMaterialTechnique=f,r.ShadedColorMaterialTechniqueConfiguration=b,r.ShadedColorMaterialVertexAttrConstants={POSITION:"position",NORMAL:"normal",OFFSET:"offset"},r.ShadedColorMaterialVertexAttrLocations=m,Object.defineProperty(r,"__esModule",{value:!0})}));
