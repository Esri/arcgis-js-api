/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderLibrary/ShaderOutputOptions","../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl","../core/shaderLibrary/terrain/Overlay.glsl","../../../../chunks/Terrain.glsl","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/basicInterfaces","../lib/DefaultVertexAttributeLocations","../lib/Program","../lib/StencilUtils","../../../webgl/enums","../../../webgl/renderState"],(function(e,r,t,a,i,o,n,d,l,c,s,u,p,h,b,g,_){"use strict";let v=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).useStencil=!1,r}t._inheritsLoose(r,e);var a=r.prototype;return a.initializeProgram=function(e){const t=r.shader.get(),a=this.configuration,i=t.build({overlayMode:a.overlayMode,output:a.output,viewingMode:e.viewingMode,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:a.textureFadingEnabled&&!a.renderOccluded,hasBackgroundColor:a.hasBackgroundColor,useGrid:a.useGrid,receiveShadows:a.receiveShadows&&!a.renderOccluded,receiveAmbientOcclusion:!1,atmosphere:a.atmosphere,tileBorders:a.tileBorders,screenSizePerspective:a.screenSizePerspective,pbrMode:o.PBRMode.Disabled,ssrEnabled:a.ssrEnabled,highStepCount:!1});return new h.Program(e.rctx,i,p.Default3D)},a.initializePipeline=function(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)},a._createPipeline=function(e){const r=this.configuration,t=r.backfaceCullingEnabled&&!r.renderOccluded;return _.makePipelineState({blending:r.renderOccluded?_.simpleBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:t&&_.backFaceCullingParams,depthTest:!r.renderOccluded&&{func:g.CompareFunction.LESS},depthWrite:!r.renderOccluded&&_.defaultDepthWriteParams,colorWrite:_.defaultColorWriteParams,stencilTest:e?b.renderWhenBitIsNotSet(u.StencilBits.IntegratedMeshMaskExcluded):null})},a.getPipelineState=function(r,t){return this.useStencil?this._stencilPipelineState:e.prototype.getPipelineState.call(this,r,t)},r}(c.ShaderTechnique);v.shader=new l.ReloadableShaderModule(d.TerrainShader,(()=>new Promise(((r,t)=>e(["../core/shaderLibrary/terrain/Terrain.glsl"],r,t)))));let S=function(e){function r(){var r;return(r=e.apply(this,arguments)||this).output=i.ShaderOutput.Color,r.overlayMode=n.OverlayMode.Disabled,r.atmosphere=!1,r.receiveShadows=!1,r.slicePlaneEnabled=!1,r.backfaceCullingEnabled=!1,r.stencilEnabled=!1,r.textureFadingEnabled=!1,r.hasBackgroundColor=!1,r.useGrid=!1,r.renderOccluded=!1,r.ssrEnabled=!1,r.tileBorders=!1,r.screenSizePerspective=!1,r}return t._inheritsLoose(r,e),r}(s.ShaderTechniqueConfiguration);a.__decorate([s.parameter({count:i.ShaderOutput.COUNT})],S.prototype,"output",void 0),a.__decorate([s.parameter({count:n.OverlayMode.COUNT})],S.prototype,"overlayMode",void 0),a.__decorate([s.parameter()],S.prototype,"atmosphere",void 0),a.__decorate([s.parameter()],S.prototype,"receiveShadows",void 0),a.__decorate([s.parameter()],S.prototype,"slicePlaneEnabled",void 0),a.__decorate([s.parameter()],S.prototype,"backfaceCullingEnabled",void 0),a.__decorate([s.parameter()],S.prototype,"stencilEnabled",void 0),a.__decorate([s.parameter()],S.prototype,"textureFadingEnabled",void 0),a.__decorate([s.parameter()],S.prototype,"hasBackgroundColor",void 0),a.__decorate([s.parameter()],S.prototype,"useGrid",void 0),a.__decorate([s.parameter()],S.prototype,"renderOccluded",void 0),a.__decorate([s.parameter()],S.prototype,"ssrEnabled",void 0),a.__decorate([s.parameter()],S.prototype,"tileBorders",void 0),a.__decorate([s.parameter()],S.prototype,"screenSizePerspective",void 0),r.TerrainTechnique=v,r.TerrainTechniqueConfiguration=S,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
