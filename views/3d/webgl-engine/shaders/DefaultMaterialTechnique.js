/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f64","../../../../chunks/vec3f64","../../../../chunks/vec4f64","../../../ViewingMode","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/attributes/NormalAttribute.glsl","../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../core/shaderLibrary/attributes/VertexNormal.glsl","../core/shaderLibrary/util/AlphaCutoff","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../lib/basicInterfaces","../lib/DefaultVertexAttributeLocations","../lib/Material","../lib/OrderIndependentTransparency","../lib/Program","../lib/StencilUtils","../lib/TransparencyPassType","../../../../chunks/DefaultMaterial.glsl","../../../webgl/context-util","../../../webgl/enums","../../../webgl/renderState"],(function(e,t,r,a,i,n,l,o,s,u,c,h,d,p,f,b,m,g,y,T,P,v,S,O,x){"use strict";let M=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).isSchematic=!1,t.usePBR=!1,t.mrrFactors=i.fromValues(0,1,.5),t.hasVertexColors=!1,t.hasSymbolColors=!1,t.doubleSided=!1,t.doubleSidedType="normal",t.cullFace=f.CullFaceOptions.Back,t.emissiveFactor=i.fromValues(0,0,0),t.instancedDoublePrecision=!1,t.normalType=s.NormalAttributeType.Attribute,t.receiveSSAO=!0,t.receiveShadows=!0,t.castShadows=!0,t.shadowMappingEnabled=!1,t.ambient=i.fromValues(.2,.2,.2),t.diffuse=i.fromValues(.8,.8,.8),t.externalColor=n.fromValues(1,1,1,1),t.colorMixMode="multiply",t.opacity=1,t.layerOpacity=1,t.origin=i.create(),t.hasSlicePlane=!1,t.hasSliceHighlight=!0,t.offsetTransparentBackfaces=!1,t.vvSizeEnabled=!1,t.vvSizeMinSize=[1,1,1],t.vvSizeMaxSize=[100,100,100],t.vvSizeOffset=[0,0,0],t.vvSizeFactor=[1,1,1],t.vvSizeValue=[1,1,1],t.vvColorEnabled=!1,t.vvColorValues=[0,0,0,0,0,0,0,0],t.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],t.vvSymbolAnchor=[0,0,0],t.vvSymbolRotationMatrix=a.create(),t.vvOpacityEnabled=!1,t.vvOpacityValues=[],t.vvOpacityOpacities=[],t.transparent=!1,t.writeDepth=!0,t.customDepthTest=f.DepthTestFunction.Less,t.textureAlphaMode=f.AlphaDiscardMode.Blend,t.textureAlphaCutoff=h.defaultMaskAlphaCutoff,t.textureAlphaPremultiplied=!1,t.hasOccludees=!1,t.renderOccluded=m.RenderOccludedFlag.Occlude,t}return r._inheritsLoose(t,e),t}(c.VertexNormalPassParameters),C=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).origin=i.create(),t.slicePlaneLocalOrigin=t.origin,t}return r._inheritsLoose(t,e),t}(c.VertexNormalDrawParameters),D=function(e){function t(){return e.apply(this,arguments)||this}r._inheritsLoose(t,e);var a=t.prototype;return a.initializeConfiguration=function(e,t){t.hasWebGL2Context=e.rctx.type===S.ContextType.WEBGL2,t.spherical=e.viewingMode===l.ViewingMode.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,t.textureCoordinateType=t.hasColorTexture||t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture||t.hasNormalTexture?u.TextureCoordinateAttributeType.Default:u.TextureCoordinateAttributeType.None,t.objectAndLayerIdColorInstanced=t.instanced},a.initializeProgram=function(e){return this._initializeProgram(e,t.shader)},a._initializeProgram=function(e,t){return new y.Program(e.rctx,t.get().build(this.configuration),b.Default3D)},a._convertDepthTestFunction=function(e){return e===f.DepthTestFunction.Lequal?O.CompareFunction.LEQUAL:O.CompareFunction.LESS},a._makePipeline=function(e,t){const r=this.configuration,a=e===P.TransparencyPassType.NONE,i=e===P.TransparencyPassType.FrontFace;return x.makePipelineState({blending:r.output!==o.ShaderOutput.Color&&r.output!==o.ShaderOutput.Alpha||!r.transparent?null:a?g.blendingDefault:g.oitBlending(e),culling:A(r)?x.cullingParams(r.cullFace):null,depthTest:{func:g.oitDepthTest(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(a||i)&&r.writeDepth?x.defaultDepthWriteParams:null,colorWrite:x.defaultColorWriteParams,stencilWrite:r.hasOccludees?T.stencilWriteMaskOn:null,stencilTest:r.hasOccludees?t?T.stencilToolMaskBaseParams:T.stencilBaseAllZerosParams:null,polygonOffset:a||i?null:g.getOITPolygonOffset(r.enableOffset)})},a.initializePipeline=function(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)},a.getPipelineState=function(t,r){return r?this._occludeePipelineState:e.prototype.getPipelineState.call(this,t,r)},t}(p.ShaderTechnique);function A(e){return e.cullFace!==f.CullFaceOptions.None||!e.hasSlicePlane&&(!e.transparent&&!e.doubleSidedMode)}D.shader=new d.ReloadableShaderModule(v.DefaultMaterial,(()=>new Promise(((t,r)=>e(["./DefaultMaterial.glsl"],t,r))))),t.DefaultMaterialDrawParameters=C,t.DefaultMaterialPassParameters=M,t.DefaultMaterialTechnique=D,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
