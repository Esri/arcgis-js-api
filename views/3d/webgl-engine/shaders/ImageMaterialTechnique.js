/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/DefaultVertexAttributeLocations","../../../webgl/Program","../../../webgl/renderState","../core/shaderLibrary/util/View.glsl","../core/shaderLibrary/Slice.glsl","../lib/OrderIndependentTransparency","../core/shaderLibrary/shading/MultipassTerrainTest.glsl","../lib/StencilUtils","../../../../chunks/ImageMaterial.glsl"],(function(e,t,r,a,i,n,o,s,l,c,u,p,d,h,m,f){"use strict";let g=function(e){function t(){return e.apply(this,arguments)||this}r._inheritsLoose(t,e);var a=t.prototype;return a.initializeProgram=function(e){const r=t.shader.get(),a=this.configuration,i=r.build({output:a.output,slicePlaneEnabled:a.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===a.transparencyPassType,multipassTerrainEnabled:a.multipassTerrainEnabled,cullAboveGround:a.cullAboveGround});return new l(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),s.Default3D)},a.bindPass=function(e,t,r){u.View.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),r.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",r.camera.nearFar),this.program.setUniform2fv("inverseViewport",r.inverseViewport),h.bindMultipassTerrainUniforms(this.program,e,r))},a.bindDraw=function(e){u.View.bindView(this.program,e),p.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},a.setPipelineState=function(e,t){const r=this.configuration,a=3===e,i=2===e,n=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return c.makePipelineState({blending:0!==r.output&&7!==r.output||!r.transparent?null:a?b:d.OITBlending(e),culling:n(r.cullFace),depthTest:{func:d.OITDepthTest(e)},depthWrite:a?r.writeDepth&&c.defaultDepthWriteParams:d.OITDepthWrite(e),colorWrite:c.defaultColorWriteParams,stencilWrite:r.sceneHasOcludees?m.stencilWriteMaskOn:null,stencilTest:r.sceneHasOcludees?t?m.stencilToolMaskBaseParams:m.stencilBaseAllZerosParams:null,polygonOffset:a||i?null:d.getOITPolygonOffset(r.enableOffset)})},a.initializePipeline=function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)},a.getPipelineState=function(e){return e?this._occludeePipelineState:this.pipeline},t}(n.ShaderTechnique);g.shader=new i.ReloadableShaderModule(f.ImageMaterialShader,(()=>new Promise((function(t,r){e(["./ImageMaterial.glsl"],t,r)}))));const b=c.simpleBlendingParams(1,771);let y=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.transparent=!1,t.enableOffset=!0,t.writeDepth=!0,t.sceneHasOcludees=!1,t.transparencyPassType=3,t.multipassTerrainEnabled=!1,t.cullAboveGround=!0,t}return r._inheritsLoose(t,e),t}(o.ShaderTechniqueConfiguration);a.__decorate([o.parameter({count:8})],y.prototype,"output",void 0),a.__decorate([o.parameter({count:3})],y.prototype,"cullFace",void 0),a.__decorate([o.parameter()],y.prototype,"slicePlaneEnabled",void 0),a.__decorate([o.parameter()],y.prototype,"transparent",void 0),a.__decorate([o.parameter()],y.prototype,"enableOffset",void 0),a.__decorate([o.parameter()],y.prototype,"writeDepth",void 0),a.__decorate([o.parameter()],y.prototype,"sceneHasOcludees",void 0),a.__decorate([o.parameter({count:4})],y.prototype,"transparencyPassType",void 0),a.__decorate([o.parameter()],y.prototype,"multipassTerrainEnabled",void 0),a.__decorate([o.parameter()],y.prototype,"cullAboveGround",void 0),t.ImageMaterialTechnique=g,t.ImageMaterialTechniqueConfiguration=y,Object.defineProperty(t,"__esModule",{value:!0})}));
