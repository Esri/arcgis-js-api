/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../lib/DefaultVertexAttributeLocations","../../../webgl/Program","../../../webgl/renderState","../core/shaderLibrary/util/View.glsl","../core/shaderLibrary/Slice.glsl","../lib/OrderIndependentTransparency","../lib/StencilUtils","../../../../chunks/ImageMaterial.glsl"],(function(e,t,i,r,a,n,o,s,l,c,p,u,d,h,g){"use strict";let f=function(e){function t(){return e.apply(this,arguments)||this}i._inheritsLoose(t,e);var r=t.prototype;return r.initializeProgram=function(e){const i=t.shader.get(),r=this.configuration,a=i.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType});return new l(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),s.Default3D)},r.bindPass=function(e,t,i){p.View.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity)},r.bindDraw=function(e){p.View.bindView(this.program,e),u.Slice.bindUniformsWithOrigin(this.program,this.configuration,e)},r.setPipelineState=function(e,t){const i=this.configuration,r=3===e,a=2===e;return c.makePipelineState({blending:0!==i.output&&7!==i.output||!i.transparent?null:r?y:d.OITBlending(e),culling:(n=i.cullFace,0!==n&&{face:1===n?1028:1029,mode:2305}),depthTest:{func:d.OITDepthTest(e)},depthWrite:r?i.writeDepth&&c.defaultDepthWriteParams:d.OITDepthWrite(e),colorWrite:c.defaultColorWriteParams,stencilWrite:i.sceneHasOcludees?h.stencilWriteMaskOn:null,stencilTest:i.sceneHasOcludees?t?h.stencilToolMaskBaseParams:h.stencilBaseAllZerosParams:null,polygonOffset:r||a?i.polygonOffset&&m:d.getOITPolygonOffset(i.enableOffset)});var n},r.initializePipeline=function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)},r.getPipelineState=function(e){return e?this._occludeePipelineState:this.pipeline},t}(n.ShaderTechnique);f.shader=new a.ReloadableShaderModule(g.ImageMaterialShader,(()=>new Promise((function(t,i){e(["./ImageMaterial.glsl"],t,i)}))));const m={factor:1,units:1},y=c.simpleBlendingParams(1,771);let b=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).output=0,t.cullFace=0,t.slicePlaneEnabled=!1,t.sliceHighlightDisabled=!1,t.transparent=!1,t.polygonOffset=!1,t.enableOffset=!0,t.writeDepth=!0,t.sceneHasOcludees=!1,t.transparencyPassType=3,t}return i._inheritsLoose(t,e),t}(o.ShaderTechniqueConfiguration);r.__decorate([o.parameter({count:8})],b.prototype,"output",void 0),r.__decorate([o.parameter({count:3})],b.prototype,"cullFace",void 0),r.__decorate([o.parameter()],b.prototype,"slicePlaneEnabled",void 0),r.__decorate([o.parameter()],b.prototype,"sliceHighlightDisabled",void 0),r.__decorate([o.parameter()],b.prototype,"transparent",void 0),r.__decorate([o.parameter()],b.prototype,"polygonOffset",void 0),r.__decorate([o.parameter()],b.prototype,"enableOffset",void 0),r.__decorate([o.parameter()],b.prototype,"writeDepth",void 0),r.__decorate([o.parameter()],b.prototype,"sceneHasOcludees",void 0),r.__decorate([o.parameter({count:4})],b.prototype,"transparencyPassType",void 0),t.ImageMaterialTechnique=f,t.ImageMaterialTechniqueConfiguration=b,Object.defineProperty(t,"__esModule",{value:!0})}));
