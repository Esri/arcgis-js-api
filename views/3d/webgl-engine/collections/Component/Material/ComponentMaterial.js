/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../chunks/tslib.es6","../../../../../../core/maybe","../../../../../../chunks/vec3","../../../../../../chunks/vec3f32","../../../../../../chunks/vec4","../../../../../../chunks/vec4f32","../../../../../../chunks/vec4f64","./ComponentTechnique","../../../../../../chunks/ComponentShader.glsl","../../../core/material/MaterialBase","../../../core/shaderLibrary/util/AlphaDiscard.glsl"],(function(e,t,a,r,o,s,i,n,l,c,p,u,d){"use strict";let h=function(e){function a(){var t;return(t=e.apply(this,arguments)||this).baseColor=n.fromValues(1,1,1,1),t.usePBR=!1,t.hasParametersFromSource=!1,t.mrrFactors=s.fromValues(1,1,.5),t.emissiveFactor=s.fromValues(0,0,0),t.baseColorTexture=null,t.metallicRoughnessTexture=null,t.emissionTexture=null,t.occlusionTexture=null,t.normalTexture=null,t.overlayTexOffset=l.fromValues(-1,-1,-1,-1),t.overlayTexScale=l.fromValues(0,0,0,0),t.overlayColor=null,t.overlayHighlight=null,t.overlayNormal=null,t.objectOpacity=1,t.commonMaterialParameters=new m,t.componentParameters=new _,t.alphaCutoff=d.defaultMaskAlphaCutoff,t.alphaDiscardMode=1,t.isIntegratedMesh=!1,t.polygonOffsetEnabled=!1,t.ellipsoidMode=1,t.sceneHasOcludees=!1,t._techniqueConfig=new c.ComponentTechniqueConfiguration,t}t._inheritsLoose(a,e);var o=a.prototype;return o.dispose=function(){this._technique=r.releaseMaybe(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null},o.getTechnique=function(e,t,a){const o=this._techniqueConfig;if(o.hasVertexColors=a.colors,o.hasNormals=a.normals,o.vertexTextureCoordinates=a.textureCoordinates,o.usePBR=this.usePBR,o.hasMetalnessAndRoughnessTexture=r.isSome(this.metallicRoughnessTexture),o.hasEmissionTexture=r.isSome(this.emissionTexture),o.hasOcclusionTexture=r.isSome(this.occlusionTexture),o.hasNormalTexture=r.isSome(this.normalTexture),o.transparencyPassType=0===t.identifier&&null!=t.transparencyPassType?t.transparencyPassType:3,o.multipassTerrainEnabled=0===t.identifier&&null!=t.multipassTerrainParams&&t.multipassTerrainParams.multipassTerrainEnabled,o.cullAboveGround=0===t.identifier&&null!=t.multipassTerrainParams&&t.multipassTerrainParams.cullAboveGround,o.ellipsoidMode=this.ellipsoidMode,this.dirty){o.componentData=this.componentParameters.type,o.cullFace=this.commonMaterialParameters.cullFace,o.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,o.baseColorTexture=r.isSome(this.baseColorTexture),o.isSchematic=this.hasParametersFromSource&&!r.isSome(this.baseColorTexture);const e=this._computeWhichMaterialPass();o.blendingEnabled=1===e||2===e,o.alphaDiscardMode=this.alphaDiscardMode,o.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.overlayNormal?3:2:1:0,o.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean()}return o.slicePlaneEnabled=t.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled,1===t.identifier?(o.output=3,o.vertexDiscardMode=0):2===t.identifier?(o.output=4,o.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?o.vertexDiscardMode=t.transparent?2:1:o.vertexDiscardMode=0,o.output=v(t.subPass),1===t.subPass&&(o.sceneHasOcludees=t.sceneHasOcludees),0===t.subPass?(o.receiveAmbientOcclusion=t.ambientOcclusionEnabled,o.sceneHasOcludees=t.sceneHasOcludees,o.receiveShadows=t.shadowsEnabled,o.ssrEnabled=t.ssrParams.ssrEnabled):(o.receiveAmbientOcclusion=!1,o.receiveShadows=!1)),this._technique=e.releaseAndAcquire(c.ComponentTechnique,o,this._technique),this._technique},o.submit=function(e,t){if(0===this.objectOpacity)return;const a=t.renderable.geometry,o=t.components,s=t.renderable.drawParameters,i=t.renderable.meta.cameraDepthSquared,n=o.geometryRanges,l=o.highlightRanges,c=o.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case 0:e.materialOpaque.submitDraw(this,a,n,s,i);break;case 1:e.materialTransparent.submitDraw(this,a,n,s,i);break;case 2:e.materialOpaque.submitDraw(this,a,n,s,i),e.materialTransparent.submitDraw(this,a,n,s,i);break;case 3:e.materialIntegratedMesh.submitDraw(this,a,n,s,i),this.overlayHighlight&&e.highlightIntegratedMesh.submitDraw(this,a,n,s,i)}r.isSome(e.shadowMap)&&2!==this.componentParameters.castShadows&&e.shadowMap.submitDraw(this,a,n,s,i),r.isSome(e.highlight)&&r.isSome(l)&&e.highlight.submitDraw(this,a,l,s,i),r.isSome(e.highlightShadowMap)&&2!==this.componentParameters.castShadows&&r.isSome(l)&&e.highlightShadowMap.submitDraw(this,a,l,s,i),r.isSome(e.defaultShadowMap)&&2!==this.componentParameters.castShadows&&r.isSome(c)&&e.defaultShadowMap.submitDraw(this,a,c,s,i)},o._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:this.objectOpacity<1?1:0===this.componentParameters.opaqueOverride?0:this.baseColor[3]<1||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2},t._createClass(a,[{key:"attributeLocations",get:function(){return p.attributeLocations}}]),a}(u.MaterialBase);a.__decorate([u.parameter({vectorOps:i.vec4})],h.prototype,"baseColor",void 0),a.__decorate([u.parameter()],h.prototype,"usePBR",void 0),a.__decorate([u.parameter()],h.prototype,"hasParametersFromSource",void 0),a.__decorate([u.parameter({vectorOps:o.vec3})],h.prototype,"mrrFactors",void 0),a.__decorate([u.parameter({vectorOps:o.vec3})],h.prototype,"emissiveFactor",void 0),a.__decorate([u.parameter({dispose:!0})],h.prototype,"baseColorTexture",void 0),a.__decorate([u.parameter({dispose:!0})],h.prototype,"metallicRoughnessTexture",void 0),a.__decorate([u.parameter({dispose:!0})],h.prototype,"emissionTexture",void 0),a.__decorate([u.parameter({dispose:!0})],h.prototype,"occlusionTexture",void 0),a.__decorate([u.parameter({dispose:!0})],h.prototype,"normalTexture",void 0),a.__decorate([u.parameter({vectorOps:{equals:i.exactEquals,copy:i.copy}})],h.prototype,"overlayTexOffset",void 0),a.__decorate([u.parameter({vectorOps:{equals:i.exactEquals,copy:i.copy}})],h.prototype,"overlayTexScale",void 0),a.__decorate([u.parameter()],h.prototype,"overlayColor",void 0),a.__decorate([u.parameter()],h.prototype,"overlayHighlight",void 0),a.__decorate([u.parameter()],h.prototype,"overlayNormal",void 0),a.__decorate([u.parameter()],h.prototype,"objectOpacity",void 0),a.__decorate([u.parameterBlock()],h.prototype,"commonMaterialParameters",void 0),a.__decorate([u.parameterBlock()],h.prototype,"componentParameters",void 0),a.__decorate([u.parameter()],h.prototype,"alphaCutoff",void 0),a.__decorate([u.parameter()],h.prototype,"alphaDiscardMode",void 0),a.__decorate([u.parameter()],h.prototype,"isIntegratedMesh",void 0),a.__decorate([u.parameter()],h.prototype,"polygonOffsetEnabled",void 0),a.__decorate([u.parameter()],h.prototype,"ellipsoidMode",void 0),a.__decorate([u.parameter()],h.prototype,"sceneHasOcludees",void 0);let m=function(e){function a(){var t;return(t=e.apply(this,arguments)||this).doubleSided=!1,t.cullFace=2,t.slicePlaneEnabled=!0,t}return t._inheritsLoose(a,e),a}(u.MaterialParameterBlock);a.__decorate([u.parameter()],m.prototype,"doubleSided",void 0),a.__decorate([u.parameter()],m.prototype,"cullFace",void 0),a.__decorate([u.parameter()],m.prototype,"slicePlaneEnabled",void 0);let _=function(e){function a(){var t;return(t=e.apply(this,arguments)||this).externalColor=n.fromValues(1,1,1,1),t.externalColorMixMode=1,t.castShadows=0,t}return t._inheritsLoose(a,e),t._createClass(a,[{key:"transparent",get:function(){return this.externalColor[3]<1?0:2}},{key:"opaqueOverride",get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2}},{key:"visible",get:function(){return this.externalColor[3]>0?0:2}},{key:"type",get:function(){return 0}}]),a}(u.MaterialParameterBlock);a.__decorate([u.parameter({vectorOps:i.vec4})],_.prototype,"externalColor",void 0),a.__decorate([u.parameter()],_.prototype,"externalColorMixMode",void 0),a.__decorate([u.parameter()],_.prototype,"castShadows",void 0);let y=function(e){function a(){var t;return(t=e.apply(this,arguments)||this).texture=null,t.transparent=2,t.opaqueOverride=2,t.castShadows=2,t}return t._inheritsLoose(a,e),t._createClass(a,[{key:"type",get:function(){return 1}}]),a}(u.MaterialParameterBlock);function v(e){switch(e){case 0:return 0;case 1:return 7;case 2:return 1;case 3:return 2;case 4:return 8}}a.__decorate([u.parameter()],y.prototype,"texture",void 0),a.__decorate([u.parameter()],y.prototype,"transparent",void 0),a.__decorate([u.parameter()],y.prototype,"opaqueOverride",void 0),a.__decorate([u.parameter()],y.prototype,"castShadows",void 0),e.CommonMaterialParameters=m,e.ComponentMaterial=h,e.ComponentParametersUniform=_,e.ComponentParametersVarying=y,Object.defineProperty(e,"__esModule",{value:!0})}));
