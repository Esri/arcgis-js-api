/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../chunks/tslib.es6","../../../../../../core/maybe","../../../../../../chunks/vec3","../../../../../../chunks/vec4f64","../../../../../../chunks/vec4","../../../../../../chunks/vec3f32","../../../core/shaderLibrary/util/AlphaDiscard.glsl","../../../../../../chunks/vec4f32","../../../../../../chunks/ComponentShader.glsl","./ComponentTechnique","../../../core/material/MaterialBase"],(function(e,t,r,a,o,s,i,n,l,c,p,u,d){"use strict";let h=function(e){function r(){var t;return(t=e.call(this)||this).baseColor=c.fromValues(1,1,1,1),t.usePBR=!1,t.mrrFactors=n.fromValues(1,1,.5),t.emissiveFactor=n.fromValues(0,0,0),t.baseColorTexture=null,t.metallicRoughnessTexture=null,t.emissionTexture=null,t.occlusionTexture=null,t.normalTexture=null,t.overlayTexOffset=s.fromValues(-1,-1,-1,-1),t.overlayTexScale=s.fromValues(0,0,0,0),t.overlayColorInner=null,t.overlayColorOuter=null,t.overlayHighlightInner=null,t.overlayHighlightOuter=null,t.overlayNormalInner=null,t.overlayNormalOuter=null,t.objectOpacity=1,t.commonMaterialParameters=new m,t.componentParameters=new v,t.alphaCutoff=l.defaultMaskAlphaCutoff,t.alphaDiscardMode=1,t.isIntegratedMesh=!1,t.polygonOffsetEnabled=!1,t.ellipsoidMode=1,t.sceneHasOcludees=!1,t._techniqueConfig=new u.ComponentTechniqueConfiguration,t}t._inheritsLoose(r,e);var o=r.prototype;return o.dispose=function(e){this._technique&&(e.release(this._technique),this._technique=void 0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null},o.getTechnique=function(e,t,r){const o=this._techniqueConfig;if(o.hasVertexColors=r.colors,o.hasNormals=r.normals,o.vertexTextureCoordinates=r.textureCoordinates,o.usePBR=this.usePBR,o.hasMetalnessAndRoughnessTexture=a.isSome(this.metallicRoughnessTexture),o.hasEmissionTexture=a.isSome(this.emissionTexture),o.hasOcclusionTexture=a.isSome(this.occlusionTexture),o.hasNormalTexture=a.isSome(this.normalTexture),o.transparencyPassType=0===t.identifier&&null!=t.transparencyPassType?t.transparencyPassType:3,o.ellipsoidMode=this.ellipsoidMode,this.dirty){o.componentData=this.componentParameters.type,o.cullFace=this.commonMaterialParameters.cullFace,o.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,o.baseColorTexture=a.isSome(this.baseColorTexture);const e=this._computeWhichMaterialPass();o.blendingEnabled=1===e||2===e,o.alphaDiscardMode=this.alphaDiscardMode,o.integratedMeshMode=this.isIntegratedMesh?this.overlayColorInner||this.overlayColorOuter?this.overlayNormalInner||this.overlayNormalOuter?3:2:1:0,o.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean()}return o.slicePlaneEnabled=t.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled,1===t.identifier?(o.output=3,o.vertexDiscardMode=0):2===t.identifier?(o.output=4,o.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?o.vertexDiscardMode=t.transparent?2:1:o.vertexDiscardMode=0,o.output=function(e){switch(e){case 0:return 0;case 1:return 7;case 2:return 1;case 3:return 2;case 4:return 8}}(t.subPass),1===t.subPass&&(o.sceneHasOcludees=t.sceneHasOcludees),0===t.subPass?(o.receiveAmbientOcclusion=t.ambientOcclusionEnabled,o.sceneHasOcludees=t.sceneHasOcludees,o.receiveShadows=t.shadowsEnabled,o.ssrEnabled=t.ssrParams.ssrEnabled):(o.receiveAmbientOcclusion=!1,o.receiveShadows=!1)),this._technique=e.repository.acquireAndReleaseExisting(u.ComponentTechnique,o,this._technique),this._technique},o.submit=function(e,t){const r=t.renderable.geometry,o=t.components,s=t.renderable.drawParameters,i=t.renderable.meta.cameraDepthSquared,n=o.geometryRanges,l=o.highlightRanges;switch(this._computeWhichMaterialPass()){case 0:e.materialOpaque.submitDraw(this,r,n,s,i);break;case 1:e.materialTransparent.submitDraw(this,r,n,s,i);break;case 2:e.materialOpaque.submitDraw(this,r,n,s,i),e.materialTransparent.submitDraw(this,r,n,s,i);break;case 3:e.materialIntegratedMesh.submitDraw(this,r,n,s,i),(this.overlayHighlightInner||this.overlayHighlightOuter)&&e.highlightIntegratedMesh.submitDraw(this,r,n,s,i)}a.isSome(e.shadowMap)&&2!==this.componentParameters.castShadows&&e.shadowMap.submitDraw(this,r,n,s,i),a.isSome(e.highlight)&&a.isSome(l)&&e.highlight.submitDraw(this,r,l,s,i)},o._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:this.objectOpacity<1?1:0===this.componentParameters.opaqueOverride?0:this.baseColor[3]<1||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2},t._createClass(r,[{key:"attributeLocations",get:function(){return p.attributeLocations}}]),r}(d.MaterialBase);r.__decorate([d.parameter({vectorOps:i.vec4})],h.prototype,"baseColor",void 0),r.__decorate([d.parameter()],h.prototype,"usePBR",void 0),r.__decorate([d.parameter({vectorOps:o.vec3})],h.prototype,"mrrFactors",void 0),r.__decorate([d.parameter({vectorOps:o.vec3})],h.prototype,"emissiveFactor",void 0),r.__decorate([d.parameter({dispose:!0})],h.prototype,"baseColorTexture",void 0),r.__decorate([d.parameter({dispose:!0})],h.prototype,"metallicRoughnessTexture",void 0),r.__decorate([d.parameter({dispose:!0})],h.prototype,"emissionTexture",void 0),r.__decorate([d.parameter({dispose:!0})],h.prototype,"occlusionTexture",void 0),r.__decorate([d.parameter({dispose:!0})],h.prototype,"normalTexture",void 0),r.__decorate([d.parameter({vectorOps:{equals:i.exactEquals,copy:i.copy}})],h.prototype,"overlayTexOffset",void 0),r.__decorate([d.parameter({vectorOps:{equals:i.exactEquals,copy:i.copy}})],h.prototype,"overlayTexScale",void 0),r.__decorate([d.parameter()],h.prototype,"overlayColorInner",void 0),r.__decorate([d.parameter()],h.prototype,"overlayColorOuter",void 0),r.__decorate([d.parameter()],h.prototype,"overlayHighlightInner",void 0),r.__decorate([d.parameter()],h.prototype,"overlayHighlightOuter",void 0),r.__decorate([d.parameter()],h.prototype,"overlayNormalInner",void 0),r.__decorate([d.parameter()],h.prototype,"overlayNormalOuter",void 0),r.__decorate([d.parameter()],h.prototype,"objectOpacity",void 0),r.__decorate([d.parameterBlock()],h.prototype,"commonMaterialParameters",void 0),r.__decorate([d.parameterBlock()],h.prototype,"componentParameters",void 0),r.__decorate([d.parameter()],h.prototype,"alphaCutoff",void 0),r.__decorate([d.parameter()],h.prototype,"alphaDiscardMode",void 0),r.__decorate([d.parameter()],h.prototype,"isIntegratedMesh",void 0),r.__decorate([d.parameter()],h.prototype,"polygonOffsetEnabled",void 0),r.__decorate([d.parameter()],h.prototype,"ellipsoidMode",void 0),r.__decorate([d.parameter()],h.prototype,"sceneHasOcludees",void 0);let m=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).doubleSided=!1,t.cullFace=2,t.slicePlaneEnabled=!0,t}return t._inheritsLoose(r,e),r}(d.MaterialParameterBlock);r.__decorate([d.parameter()],m.prototype,"doubleSided",void 0),r.__decorate([d.parameter()],m.prototype,"cullFace",void 0),r.__decorate([d.parameter()],m.prototype,"slicePlaneEnabled",void 0);let v=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).externalColor=c.fromValues(1,1,1,1),t.externalColorMixMode=1,t.castShadows=0,t}return t._inheritsLoose(r,e),t._createClass(r,[{key:"transparent",get:function(){return this.externalColor[3]<1?0:2}},{key:"opaqueOverride",get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2}},{key:"visible",get:function(){return this.externalColor[3]>0?0:2}},{key:"type",get:function(){return 0}}]),r}(d.MaterialParameterBlock);r.__decorate([d.parameter({vectorOps:i.vec4})],v.prototype,"externalColor",void 0),r.__decorate([d.parameter()],v.prototype,"externalColorMixMode",void 0),r.__decorate([d.parameter()],v.prototype,"castShadows",void 0);let y=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).texture=null,t.transparent=2,t.opaqueOverride=2,t.castShadows=2,t}return t._inheritsLoose(r,e),t._createClass(r,[{key:"type",get:function(){return 1}}]),r}(d.MaterialParameterBlock);r.__decorate([d.parameter()],y.prototype,"texture",void 0),r.__decorate([d.parameter()],y.prototype,"transparent",void 0),r.__decorate([d.parameter()],y.prototype,"opaqueOverride",void 0),r.__decorate([d.parameter()],y.prototype,"castShadows",void 0),e.CommonMaterialParameters=m,e.ComponentMaterial=h,e.ComponentParametersUniform=v,e.ComponentParametersVarying=y,Object.defineProperty(e,"__esModule",{value:!0})}));
