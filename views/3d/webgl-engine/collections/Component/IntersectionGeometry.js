/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../chunks/vec3f64","../../../../../chunks/vec3","../../../support/buffer/BufferView","../../../../../geometry/support/aaBoundingBox","../../lib/geometryDataUtils","../../materials/internal/MaterialUtil","../../lib/ComponentUtils"],(function(t,e,n,i,s,o,r,p,c){"use strict";let a=function(){function n(t,n){this._indices=e.isSome(t.indices)?t.indices:r.generateDefaultIndexArray(t.positions.length/3),this._positions=new s.BufferViewVec3f(t.positions),this._components=n}var o=n.prototype;return o.getComponentAabb=function(t,n){if(e.isSome(this._perComponentAabbs)){for(let e=0;e<6;e++)n[e]=this._perComponentAabbs[6*t+e];return n}return this._computePerComponentAabbs(),this.getComponentAabb(t,n)},o.getComponentPositions=function(t,e){e.indices=this._indices,e.data=this._positions.typedBuffer,e.stride=this._positions.typedBufferStride,e.startIndex=this._components.offsets[t],e.endIndex=this._components.offsets[t+1]},o.intersect=function(t,n,s,o,r,a){const b={data:this._positions.typedBuffer,strideIdx:this._positions.typedBufferStride,offsetIdx:0,size:3},m=this._indices,h=this._components.offsets,_=p.computeInvDir(t,n,f);this._components.visibility.forEachComponent((f=>{if(!c.getVisibility(this._components.pickability,f))return!0;const d=this.getComponentAabb(f,u);if(e.isSome(r)&&r.applyToAabb(d),!p.intersectAabbInvDir(d,t,_,s))return!0;const l=h[f]/3,A=h[f+1]/3;return p.intersectTriangles(t,n,l,A,m,b,void 0,r,((t,e,n)=>a(f,t,i.transformMat3(e,e,o),n))),!0}))},o._computePerComponentAabbs=function(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);for(let e=0;e<t;e++)this._computeAABB(e)},o._computeAABB=function(t){const e=this._indices,n=this._positions,s=this._components.offsets,o=s[t],r=s[t+1],p=[0,0,0],c=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(let t=o;t<r;t++){const s=e[t];n.getVec(s,p),i.min(c,c,p),i.max(a,a,p)}let f=6*t;this._perComponentAabbs[f++]=c[0],this._perComponentAabbs[f++]=c[1],this._perComponentAabbs[f++]=c[2],this._perComponentAabbs[f++]=a[0],this._perComponentAabbs[f++]=a[1],this._perComponentAabbs[f]=a[2]},t._createClass(n,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]),n}();const f=n.create(),u=o.create();return a}));
