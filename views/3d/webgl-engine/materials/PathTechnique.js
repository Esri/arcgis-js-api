/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["require","exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../core/shaderTechnique/ShaderTechniqueConfiguration","../../../webgl/Program","../../../webgl/renderState","../core/shaderLibrary/util/View.glsl","../core/shaderLibrary/Slice.glsl","../lib/OrderIndependentTransparency","../lib/StencilUtils","../core/shaderLibrary/shading/ReadShadowMap.glsl","../core/shaderLibrary/attributes/VertexNormal.glsl","../core/shaderLibrary/attributes/PathVertexPosition.glsl","../../../../chunks/Path.glsl"],(function(e,t,r,i,o,a,n,s,p,c,l,u,d,h,f,g,v){"use strict";const m={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};let b=function(e){function t(){return e.apply(this,arguments)||this}r._inheritsLoose(t,e);var i=t.prototype;return i.initializeProgram=function(e){const r=t.shader.get(),i=this.configuration,o=r.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,useOldSceneLightInterface:!1,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:i.receiveSSAO,doubleSidedMode:i.doubleSidedMode});return new s(e.rctx,o.generateSource("vertex"),o.generateSource("fragment"),m)},i.bindPass=function(e,t,r){c.View.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform3fv("size",t.size),0!==this.configuration.output&&7!==this.configuration.output||this.program.setUniform1f("opacity",t.opacity),0===this.configuration.output?(r.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",t.ambient),this.program.setUniform3fv("diffuse",t.diffuse),this.program.setUniform3fv("specular",t.specular),this.program.setUniform1f("opacity",t.opacity)):1!==this.configuration.output&&3!==this.configuration.output||c.View.bindNearFar(this.program,r.camera.nearFar),g.setVVUniforms(this.program,t)},i.bindDraw=function(e){c.View.bindView(this.program,e),l.Slice.bindUniformsWithOrigin(this.program,this.configuration,e),0!==this.configuration.output&&7!==this.configuration.output||c.View.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&h.ReadShadowMap.bindView(this.program,e),2===this.configuration.output&&f.VertexNormal.bindUniforms(this.program,e.camera.viewInverseTransposeMatrix)},i.setPipelineState=function(e){const t=this.configuration,r=3===e,i=2===e;return p.makePipelineState({blending:0!==t.output&&7!==t.output||!t.transparent?null:r?u.blendingDefault:u.OITBlending(e),culling:(o=t,(e=>!e.slicePlaneEnabled&&!(e.transparent||0===e.doubleSidedMode))(o)&&{face:1028,mode:2305}),depthTest:{func:u.OITDepthTest(e)},depthWrite:r||i?p.defaultDepthWriteParams:null,colorWrite:p.defaultColorWriteParams,stencilWrite:t.sceneHasOcludees?d.stencilWriteMaskOn:null,stencilTest:t.sceneHasOcludees?d.stencilBaseAllZerosParams:null,polygonOffset:r||i?null:u.OITPolygonOffset});var o},i.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)},t}(a.ShaderTechnique);b.shader=new o.ReloadableShaderModule(v.PathShader,(()=>new Promise((function(t,r){e(["../shaders/Path.glsl"],t,r)}))));let y=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).output=0,t.doubleSidedMode=0,t.receiveShadows=!1,t.receiveSSAO=!1,t.vvSize=!1,t.vvColor=!1,t.vvOpacity=!1,t.slicePlaneEnabled=!1,t.shadowMap=!1,t.transparent=!1,t.sceneHasOcludees=!1,t.transparencyPassType=3,t}return r._inheritsLoose(t,e),t}(n.ShaderTechniqueConfiguration);i.__decorate([n.parameter({count:8})],y.prototype,"output",void 0),i.__decorate([n.parameter({count:3})],y.prototype,"doubleSidedMode",void 0),i.__decorate([n.parameter()],y.prototype,"receiveShadows",void 0),i.__decorate([n.parameter()],y.prototype,"receiveSSAO",void 0),i.__decorate([n.parameter()],y.prototype,"vvSize",void 0),i.__decorate([n.parameter()],y.prototype,"vvColor",void 0),i.__decorate([n.parameter()],y.prototype,"vvOpacity",void 0),i.__decorate([n.parameter()],y.prototype,"slicePlaneEnabled",void 0),i.__decorate([n.parameter()],y.prototype,"shadowMap",void 0),i.__decorate([n.parameter()],y.prototype,"transparent",void 0),i.__decorate([n.parameter()],y.prototype,"sceneHasOcludees",void 0),i.__decorate([n.parameter({count:4})],y.prototype,"transparencyPassType",void 0),t.PathTechnique=b,t.PathTechniqueConfiguration=y,t.PathVertexAttrConstants={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"},t.pathVertexAttributeLocations=m,Object.defineProperty(t,"__esModule",{value:!0})}));
