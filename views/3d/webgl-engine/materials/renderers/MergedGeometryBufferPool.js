/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{isSome as t}from"../../../../../core/maybe.js";import{RemoveMode as e,MIN_PRIORITY as r}from"../../../../../core/MemCache.js";import{generateUID as o}from"../../../../../core/uid.js";import{StaticFloat32ArrayObject as c}from"../../lib/StaticFloat32ArrayObject.js";const s=r+1;class h{constructor(t,e,r){this._rctx=t,this._locations=e,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${o()}`,i)}dispose(){this._cache.destroy()}newBuffer(e){const r=e.toString(),o=this._cache.pop(r);if(t(o)){const t=o.pop();return o.length>0&&this._cache.put(r,o,t.array.byteLength*o.length,s),t}return new c(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const r=e.array.byteLength,o=e.array.length.toString(),c=this._cache.pop(o);return t(c)?(c.push(e),this._cache.put(o,c,r*c.length,-1)):this._cache.put(o,[e],r,-1),null}}function i(t,r){if(r===e.ALL)return void t.forEach((t=>t.dispose()));const o=t.pop(),c=t.length*o.array.byteLength;return o.dispose(),c}export{h as MergedGeometryBufferPool};
