/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../webgl/BufferObject","../../../webgl/FramebufferObject","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../webgl/checkWebGLError","../../../webgl/enums","../../../../chunks/builtins","../../../webgl/renderState","../../../webgl/Texture","../../../webgl/VertexArrayObject","../lib/Util"],(function(e,t,r,n,i,o,a,c,u,s,l,h,f){"use strict";let d=function(){function e(e){this._rctx=e,this.cache=new Map}var r=e.prototype;return r.dispose=function(){this.cache.forEach((e=>e.texture=t.disposeMaybe(e.texture))),this.cache.clear()},r.acquire=function(e){if(t.isNone(e))return null;const r=this.patternId(e),n=this.cache.get(r);if(n)return n.refCount++,n.bind;const i=2,{encodedData:o,sdfNormalizer:a}=this.patternToTextureData(e,i),c=o.length/4,u=c/i,s={refCount:1,texture:null,bind:e=>(t.isNone(s.texture)&&(s.texture=new l(this._rctx,{width:c,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},o)),e.bindTexture(s.texture,"stipplePatternTexture"),{pixelSize:u,sdfNormalizer:a})};return this.cache.set(r,s),s.bind},r.release=function(e){if(t.isNone(e))return;const r=this.patternId(e),n=this.cache.get(r);n&&(n.refCount--,0===n.refCount&&(t.isSome(n.texture)&&n.texture.dispose(),this.cache.delete(r)))},r.swap=function(e,t){const r=this.acquire(t);return this.release(e),r},r.patternId=function(e){return e.join(",")},r.patternToTextureData=function(e,t){const r=Math.floor(e.reduce(((e,t)=>e+t))*t),n=.5*(e.reduce(((e,t)=>Math.max(e,t)))+1)*t,i=new Uint8Array(4*r);let o=1,a=0;for(const c of e){const e=c*t;for(let t=0;t<e;t++){const r=o*(Math.min(t,e-t)+.5)/n*.5+.5;f.packFloatRGBA(r,i,a),a+=4}o=-o}return{encodedData:i,sdfNormalizer:n}},e}();e.StippleTextureRepository=d,Object.defineProperty(e,"__esModule",{value:!0})}));
