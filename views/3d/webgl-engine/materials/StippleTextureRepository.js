/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/floatRGBA","../../../../core/maybe","../core/shaderModules/interfaces","../../../webgl/enums","../../../webgl/Texture"],(function(e,t,r,n,o,i,s){"use strict";let a=function(){function e(e){this._rctx=e,this._cache=new Map}var t=e.prototype;return t.dispose=function(){this._cache.forEach((e=>n.disposeMaybe(e.stippleTexture))),this._cache.clear()},t._acquire=function(e){if(n.isNone(e))return null;const t=this._patternId(e),r=this._cache.get(t);if(r)return r.refCount++,r;const{encodedData:o,paddedPixels:a}=u(e),l=new c(new s.Texture(this._rctx,{width:a,height:1,internalFormat:i.PixelFormat.RGBA,pixelFormat:i.PixelFormat.RGBA,dataType:i.PixelType.UNSIGNED_BYTE,wrapMode:i.TextureWrapMode.CLAMP_TO_EDGE},o));return this._cache.set(t,l),l},t.release=function(e){if(n.isNone(e))return;const t=this._patternId(e),r=this._cache.get(t);r&&(r.refCount--,0===r.refCount&&(n.isSome(r.stippleTexture)&&r.stippleTexture.dispose(),this._cache.delete(t)))},t.swap=function(e,t){const r=this._acquire(t);return this.release(e),r},t._patternId=function(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`},e}(),c=function(e){function r(t){var r;return(r=e.call(this)||this).stippleTexture=t,r.refCount=1,r}return t._inheritsLoose(r,e),r}(o.NoParameters);function u(e){const t=l(e),n=1/e.pixelRatio,o=p(e),i=h(e),s=(Math.floor(.5*(i-1))+.5)*n,a=[];let c=1;for(const r of t){for(let e=0;e<r;e++){const t=c*(Math.min(e,r-1-e)+.5)*n/s*.5+.5;a.push(t)}c=-c}const u=Math.round(t[0]/2),d=[...a.slice(u),...a.slice(0,u)],_=o+f,x=new Uint8Array(4*_);let T=4;for(const l of d)r.packFloatRGBA(l,x,T),T+=4;return x.copyWithin(0,T-4,T),x.copyWithin(T,4,8),{encodedData:x,paddedPixels:_}}function l(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function p(e){if(n.isNone(e))return 1;const t=l(e);return Math.floor(t.reduce(((e,t)=>e+t)))}function h(e){return l(e).reduce(((e,t)=>Math.max(e,t)))}const f=2;e.STIPPLE_TEXTURE_PADDING=f,e.StippleTextureRepository=a,e.computeLongestPattern=h,e.computeTextureSize=p,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
