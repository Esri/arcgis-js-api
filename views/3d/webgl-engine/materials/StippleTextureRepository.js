/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../core/floatRGBA","../../../../core/maybe","../../../webgl/BufferObject","../../../webgl/FramebufferObject","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../webgl/checkWebGLError","../../../webgl/enums","../../../../chunks/builtins","../../../webgl/Texture","../../../webgl/VertexArrayObject"],(function(e,t,r,n,i,o,c,s,a,u,l,h){"use strict";let p=function(){function e(e){this._rctx=e,this.cache=new Map}var t=e.prototype;return t.dispose=function(){this.cache.forEach((e=>e.texture=r.disposeMaybe(e.texture))),this.cache.clear()},t.acquire=function(e){if(r.isNone(e))return null;const t=this.patternId(e),n=this.cache.get(t);if(n)return n.refCount++,n.bind;const i=e.pixelRatio,{encodedData:o,sdfNormalizer:c,pixels:s,paddedPixels:a}=d(e.pattern,i),u=s/i,h={refCount:1,texture:null,bind:e=>(r.isNone(h.texture)&&(h.texture=new l(this._rctx,{width:a,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},o)),e.bindTexture(h.texture,"stipplePatternTexture"),{pixelSize:u,sdfNormalizer:c,pixels:s})};return this.cache.set(t,h),h.bind},t.release=function(e){if(r.isNone(e))return;const t=this.patternId(e),n=this.cache.get(t);n&&(n.refCount--,0===n.refCount&&(r.isSome(n.texture)&&n.texture.dispose(),this.cache.delete(t)))},t.swap=function(e,t){const r=this.acquire(t);return this.release(e),r},t.patternId=function(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`},e}();function d(e,r){const n=e.map((e=>Math.round(e*r))),i=1/r,o=Math.floor(n.reduce(((e,t)=>e+t))),c=n.reduce(((e,t)=>Math.max(e,t))),s=(Math.floor(.5*(c-1))+.5)*i,a=[];let u=1;for(const t of n){for(let e=0;e<t;e++){const r=u*(Math.min(e,t-1-e)+.5)*i/s*.5+.5;a.push(r)}u=-u}const l=Math.round(n[0]/2),h=[...a.slice(l),...a.slice(0,l)],p=o+2,d=new Uint8Array(4*p);let f=4;for(const x of h)t.packFloatRGBA(x,d,f),f+=4;return d.copyWithin(0,f-4,f),d.copyWithin(f,4,8),{encodedData:d,sdfNormalizer:s,paddedPixels:p,pixels:o}}e.StippleTextureRepository=p,Object.defineProperty(e,"__esModule",{value:!0})}));
