/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../core/shaderLibrary/ShaderOutputOptions","../lib/AnimationTimer","../lib/GLMaterials","../lib/Material","../lib/OrderIndependentTransparency","../lib/RenderSlot","./WaterGLMaterial","./WaterTechnique","./internal/DefaultBufferWriter","./internal/MaterialUtil","./internal/waterMaterialUtils"],(function(e,t,r,a,i,n,s,u,o,l,h,c,p){"use strict";let d=function(e){function n(t){var r;return(r=e.call(this,t,p.defaultWaterMaterialParameters)||this)._techniqueConfig=new l.WaterTechniqueConfiguration,r.animation=new a.AnimationTimer,r}t._inheritsLoose(n,e);var d=n.prototype;return d.getTechniqueConfig=function(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.useSSR=this.parameters.ssrEnabled,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<s.OITPolygonOffsetLimit,this._techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this._techniqueConfig.cullAboveGround=t.cullAboveGround,this._techniqueConfig},d.update=function(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<f;const r=this.animation.advance(e);return this.animation.enabled&&r},d.intersect=function(e,t,r,a,i,n,s){c.intersectTriangleGeometry(e,t,a,i,n,void 0,s)},d.requiresSlot=function(e,t){switch(i.outputFromPass(t)){case r.ShaderOutput.Normal:return e===u.RenderSlot.DRAPED_WATER;case r.ShaderOutput.Color:if(this.parameters.isDraped)return e===u.RenderSlot.DRAPED_MATERIAL;break;case r.ShaderOutput.Highlight:return e===u.RenderSlot.OPAQUE_MATERIAL||e===u.RenderSlot.DRAPED_MATERIAL}let a=u.RenderSlot.OPAQUE_MATERIAL;return this.parameters.transparent&&(a=this.parameters.writeDepth?u.RenderSlot.TRANSPARENT_MATERIAL:u.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===a},d.createGLMaterial=function(e){if(e.output===r.ShaderOutput.Color&&this.parameters.isDraped)return e.output=r.ShaderOutput.Draped,new o.WaterGLMaterial(e);switch(e.output){case r.ShaderOutput.Color:case r.ShaderOutput.Normal:case r.ShaderOutput.Highlight:case r.ShaderOutput.Alpha:return new o.WaterGLMaterial(e)}return null},d.createBufferWriter=function(){return new h.DefaultBufferWriter(h.PositionUVLayout)},n}(n.Material);const f=35e3;e.WaterMaterial=d,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
