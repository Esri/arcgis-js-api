/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2f32","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutputOptions","../core/shaderLibrary/hud/HUD.glsl","../lib/GLMaterial","../lib/Material","../lib/RenderSlot","../lib/VertexAttribute","./internal/bufferWriterUtils","../shaders/LineCalloutTechnique"],(function(e,t,r,i,n,a,s,u,o,l,c,f){"use strict";let h=function(e){function r(t){var i;return(i=e.call(this,t,p)||this).techniqueConfig=new f.LineCalloutTechniqueConfiguration,i._uniqueMaterialIdentifier=r.uniqueMaterialIdentifier(i.parameters),i}t._inheritsLoose(r,e);var i=r.prototype;return i.getPassParameters=function(){return this.parameters},i.getTechniqueConfig=function(e,t){const r=(null==t?void 0:t.slot)!==o.RenderSlot.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?a.HUDSpace.Screen:a.HUDSpace.World,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig},i.intersect=function(){},i.requiresSlot=function(e){switch(e){case o.RenderSlot.LINE_CALLOUTS:case o.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1},i.createGLMaterial=function(e){return e.output===n.ShaderOutput.Color?new d(e):null},i.createBufferWriter=function(){return new O},i.validateParameters=function(e){const t=r.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)},r.uniqueMaterialIdentifier=function(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})},t._createClass(r,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]),r}(u.Material),d=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var i=r.prototype;return i.updateParameters=function(e){return this.ensureTechnique(f.LineCalloutTechnique,e)},i.beginSlot=function(e){return this.updateParameters(e)},i.bind=function(e,t){t.bindPass(this._material.getPassParameters(),e)},r}(s);const p={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...u.DefaultMaterialParameters},b=i.newLayout().vec3f(l.VertexAttribute.POSITION).vec3f(l.VertexAttribute.NORMAL).vec2f(l.VertexAttribute.UV0).vec4f(l.VertexAttribute.AUXPOS1),g=[r.fromValues(0,0),r.fromValues(1,0),r.fromValues(0,1),r.fromValues(1,0),r.fromValues(1,1),r.fromValues(0,1)];let O=function(){function e(){this.vertexBufferLayout=b}var t=e.prototype;return t.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},t.elementCount=function(e){return 6*e.indices.get(l.VertexAttribute.POSITION).length},t.write=function(e,t,r,i){c.writePosition(t.indices.get(l.VertexAttribute.POSITION),t.vertexAttributes.get(l.VertexAttribute.POSITION).data,e.transformation,r.position,i,6),c.writeNormal(t.indices.get(l.VertexAttribute.NORMAL),t.vertexAttributes.get(l.VertexAttribute.NORMAL).data,e.invTranspTransformation,r.normal,i,6),c.writeBufferVec4(t.indices.get(l.VertexAttribute.AUXPOS1),t.vertexAttributes.get(l.VertexAttribute.AUXPOS1).data,r.auxpos1,i,6);for(let n=0;n<g.length;++n)r.uv0.setVec(i+n,g[n])},e}();e.LineCalloutMaterial=h,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
