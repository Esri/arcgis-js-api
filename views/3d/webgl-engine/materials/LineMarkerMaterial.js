/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3","../../../../chunks/vec3f64","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../lib/GLTextureMaterial","../lib/Material","../lib/RenderSlot","../lib/VertexAttribute","./VisualVariablePassParameters","../shaders/LineMarkerTechnique","../shaders/LineMarkerTechniqueConfiguration","../shaders/RibbonLineTechniqueConfiguration"],(function(e,t,r,a,i,n,s,u,o,c,h,l,p,d,A){"use strict";let f=function(e){function r(t){var r;return(r=e.call(this,t,new S)||this)._vertexAttributeLocations=p.vertexAttributeLocations,r._configuration=new d.LineMarkerTechniqueConfiguration,r._layout=r.createLayout(),r}t._inheritsLoose(r,e);var a=r.prototype;return a.dispose=function(){},a.getConfiguration=function(e,t){return this._configuration.output=e,this._configuration.space=t.slot===c.RenderSlot.DRAPED_MATERIAL?d.LineMarkerSpace.Draped:this.parameters.worldSpace?d.LineMarkerSpace.World:d.LineMarkerSpace.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==A.CapType.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.occluder=this.parameters.renderOccluded===o.RenderOccludedFlag.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration},a.intersect=function(){},a.createLayout=function(){const e=n.newLayout().vec3f(h.VertexAttribute.POSITION).vec2f(h.VertexAttribute.UV0).vec3f(h.VertexAttribute.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(h.VertexAttribute.NORMAL),this.parameters.vvSizeEnabled?e.f32(h.VertexAttribute.SIZEFEATUREATTRIBUTE):e.f32(h.VertexAttribute.SIZE),this.parameters.vvColorEnabled?e.f32(h.VertexAttribute.COLORFEATUREATTRIBUTE):e.vec4f(h.VertexAttribute.COLOR),this.parameters.vvOpacityEnabled&&e.f32(h.VertexAttribute.OPACITYFEATUREATTRIBUTE),e},a.createBufferWriter=function(){return new b(this._layout,this.parameters)},a.requiresSlot=function(e,t){if(t===s.ShaderOutput.Color||t===s.ShaderOutput.Alpha||t===s.ShaderOutput.Highlight||t===s.ShaderOutput.Depth){if(e===c.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===o.RenderOccludedFlag.OccludeAndTransparentStencil)return e===c.RenderSlot.OPAQUE_MATERIAL||e===c.RenderSlot.OCCLUDER_MATERIAL||e===c.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;if(t===s.ShaderOutput.Color||t===s.ShaderOutput.Alpha){return e===(this.parameters.writeDepth?c.RenderSlot.TRANSPARENT_MATERIAL:c.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}return e===c.RenderSlot.OPAQUE_MATERIAL}return!1},a.createGLMaterial=function(e){return new T(e)},r}(o.Material),T=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var a=r.prototype;return a._updateParameters=function(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(p.LineMarkerTechnique,e)},a._updateOccludeeState=function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})},a.beginSlot=function(e){return this._output!==s.ShaderOutput.Color&&this._output!==s.ShaderOutput.Alpha||this._updateOccludeeState(e),this._updateParameters(e)},r}(u.GLTextureMaterial),S=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).width=0,t.color=[1,1,1,1],t.placement="end",t.cap=A.CapType.BUTT,t.anchor=d.LineMarkerAnchor.Center,t.hasTip=!1,t.worldSpace=!1,t.hideOnShortSegments=!1,t.writeDepth=!0,t.hasSlicePlane=!1,t.vvFastUpdate=!1,t.hasOccludees=!1,t}return t._inheritsLoose(r,e),r}(l.VisualVariablePassParameters),b=function(){function e(e,t){this.vertexBufferLayout=e,this._parameters=t}var t=e.prototype;return t.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},t.elementCount=function(){return"begin-end"===this._parameters.placement?12:6},t.write=function(e,t,i,n,s){const u=i.vertexAttributes.get(h.VertexAttribute.POSITION).data,o=u.length/3;let c=[1,0,0];const l=i.vertexAttributes.get(h.VertexAttribute.NORMAL);this._parameters.worldSpace&&r.isSome(l)&&(c=l.data);let p=1,d=0;this._parameters.vvSizeEnabled?d=i.vertexAttributes.get(h.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(h.VertexAttribute.SIZE)&&(p=i.vertexAttributes.get(h.VertexAttribute.SIZE).data[0]);let A=[1,1,1,1],f=0;this._parameters.vvColorEnabled?f=i.vertexAttributes.get(h.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(h.VertexAttribute.COLOR)&&(A=i.vertexAttributes.get(h.VertexAttribute.COLOR).data);let T=0;this._parameters.vvOpacityEnabled&&(T=i.vertexAttributes.get(h.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const S=new Float32Array(n.buffer);let b=s*(this.vertexBufferLayout.stride/4);const _=(e,t,r,a)=>{if(S[b++]=e[0],S[b++]=e[1],S[b++]=e[2],S[b++]=r[0],S[b++]=r[1],S[b++]=t[0],S[b++]=t[1],S[b++]=t[2],this._parameters.worldSpace&&(S[b++]=c[0],S[b++]=c[1],S[b++]=c[2]),this._parameters.vvSizeEnabled?S[b++]=d:S[b++]=p,this._parameters.vvColorEnabled)S[b++]=f;else{const e=Math.min(4*a,A.length-4);S[b++]=A[e+0],S[b++]=A[e+1],S[b++]=A[e+2],S[b++]=A[e+3]}this._parameters.vvOpacityEnabled&&(S[b++]=T)};let m;!function(e){e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=-1]="DESCENDING"}(m||(m={}));const O=(t,r)=>{const i=a.set(E,u[3*t],u[3*t+1],u[3*t+2]),n=v;let s=t+r;do{a.set(n,u[3*s],u[3*s+1],u[3*s+2]),s+=r}while(a.equals(i,n)&&s>=0&&s<o);e&&(a.transformMat4(i,i,e),a.transformMat4(n,n,e)),_(i,n,[-1,-1],t),_(i,n,[1,-1],t),_(i,n,[1,1],t),_(i,n,[-1,-1],t),_(i,n,[1,1],t),_(i,n,[-1,1],t)},R=this._parameters.placement;"begin"!==R&&"begin-end"!==R||O(0,m.ASCENDING),"end"!==R&&"begin-end"!==R||O(o-1,m.DESCENDING)},e}();const E=i.create(),v=i.create();e.LineMarkerMaterial=f,e.Parameters=S,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
