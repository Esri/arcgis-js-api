/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3","../../../../chunks/vec3f64","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutputOptions","../lib/basicInterfaces","../lib/GLMaterial","../lib/Material","../lib/RenderSlot","../lib/VertexAttribute","../shaders/MeasurementArrowTechnique"],(function(e,t,r,n,i,s,o,a,u,c,l,f){"use strict";let p=function(e){function r(t){var r;return(r=e.call(this,t,d)||this).techniqueConfig=new f.MeasurementArrowTechniqueConfiguration,r}t._inheritsLoose(r,e);var n=r.prototype;return n.getTechniqueConfig=function(e,t){var r;return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=null!=(r=null==t?void 0:t.transparencyPassType)?r:o.TransparencyPassType.NONE,this.techniqueConfig},n.dispose=function(){},n.getPassParameters=function(){return this.parameters},n.intersect=function(){},n.requiresSlot=function(e){return e===c.RenderSlot.OPAQUE_MATERIAL},n.createGLMaterial=function(e){return e.output===s.ShaderOutput.Color?new h(e):null},n.createBufferWriter=function(){return new M},r}(u.Material),h=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var n=r.prototype;return n.updateParameters=function(e){return this.ensureTechnique(f.MeasurementArrowTechnique,e)},n.beginSlot=function(e){return this.updateParameters(e)},n.bind=function(e,t){t.bindPass(this._material.getPassParameters(),e)},r}(a);const d={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1,...u.DefaultMaterialParameters},b=i.newLayout().vec3f(l.VertexAttribute.POSITION).vec3f(l.VertexAttribute.NORMAL).vec2f(l.VertexAttribute.UV0).f32(l.VertexAttribute.AUXPOS1),m=n.create(),g=n.create(),v=n.create(),A=n.create(),O=n.create();let M=function(){function e(){this.vertexBufferLayout=b}var t=e.prototype;return t.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},t.elementCount=function(e){return 2*(e.indices.get(l.VertexAttribute.POSITION).length/2+1)},t.write=function(e,t,n,i){const s=t.vertexAttributes.get(l.VertexAttribute.POSITION).data,o=t.vertexAttributes.get(l.VertexAttribute.NORMAL).data,a=s.length/3,u=t&&t.indices&&t.indices.get(l.VertexAttribute.POSITION);u&&u.length!==2*(a-1)&&console.warn("MeasurementArrowMaterial does not support indices");const c=m,f=g,p=v,h=A,d=O,b=e.transformation,M=e.invTranspTransformation,y=n.position,P=n.normal,T=n.uv0;let x=0;for(let l=0;l<a;++l){const e=3*l;if(r.set(c,s[e],s[e+1],s[e+2]),l<a-1){const e=3*(l+1);r.set(f,s[e],s[e+1],s[e+2]),r.set(d,o[e],o[e+1],o[e+2]),r.normalize(d,d),r.subtract(p,f,c),r.normalize(p,p),r.cross(h,d,p),r.normalize(h,h)}const t=r.distance(c,f);b&&M&&(r.transformMat4(c,c,b),r.transformMat4(f,f,b),r.transformMat4(h,h,M));const n=i+2*l,u=n+1;y.setVec(n,c),y.setVec(u,c),P.setVec(n,h),P.setVec(u,h),T.set(n,0,x),T.set(n,1,-1),T.set(u,0,x),T.set(u,1,1),l<a-1&&(x+=t)}const C=n.auxpos1;for(let r=0;r<2*a;++r)C.set(i+r,x)},e}();e.MeasurementArrowMaterial=p,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
