/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3","../../../../chunks/vec3f64","../../support/buffer/InterleavedLayout","../lib/GLMaterial","../lib/Material","../shaders/MeasurementArrowTechnique"],(function(e,t,r,n,i,o,s,a){"use strict";let u=function(e){function r(t){var r;return(r=e.call(this,t,l)||this).techniqueConfig=new a.MeasurementArrowTechniqueConfiguration,r}t._inheritsLoose(r,e);var n=r.prototype;return n.getTechniqueConfig=function(e,t){var r;return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=null!=(r=null==t?void 0:t.transparencyPassType)?r:3,this.techniqueConfig},n.dispose=function(){},n.getPassParameters=function(){return this.parameters},n.intersect=function(){},n.requiresSlot=function(e){return 2===e},n.createGLMaterial=function(e){return 0===e.output?new c(e):null},n.createBufferWriter=function(){return new v},r}(s.Material),c=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var n=r.prototype;return n.updateParameters=function(e){return this.ensureTechnique(a.MeasurementArrowTechnique,e)},n.beginSlot=function(e){return this.updateParameters(e)},n.bind=function(e,t){t.bindPass(this._material.getPassParameters(),e)},r}(o);const l={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1,...s.materialParametersDefaults},f=i.newLayout().vec3f("position").vec3f("normal").vec2f("uv0").f32("auxpos1"),p=n.create(),h=n.create(),m=n.create(),d=n.create(),g=n.create();let v=function(){function e(){this.vertexBufferLayout=f}var t=e.prototype;return t.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},t.elementCount=function(e){return 2*(e.indices.get("position").length/2+1)},t.write=function(e,t,n,i){const o=t.vertexAttributes.get("position").data,s=t.vertexAttributes.get("normal").data,a=o.length/3,u=t&&t.indices&&t.indices.get("position");u&&u.length!==2*(a-1)&&console.warn("MeasurementArrowMaterial does not support indices");const c=p,l=h,f=m,v=d,y=g,M=e.transformation,C=e.invTranspTransformation,b=n.position,w=n.normal,P=n.uv0;let q=0;for(let p=0;p<a;++p){const e=3*p;if(r.set(c,o[e],o[e+1],o[e+2]),p<a-1){const e=3*(p+1);r.set(l,o[e],o[e+1],o[e+2]),r.set(y,s[e],s[e+1],s[e+2]),r.normalize(y,y),r.subtract(f,l,c),r.normalize(f,f),r.cross(v,y,f),r.normalize(v,v)}const t=r.distance(c,l);M&&C&&(r.transformMat4(c,c,M),r.transformMat4(l,l,M),r.transformMat4(v,v,C));const n=i+2*p,u=n+1;b.setVec(n,c),b.setVec(u,c),w.setVec(n,v),w.setVec(u,v),P.set(n,0,q),P.set(n,1,-1),P.set(u,0,q),P.set(u,1,1),p<a-1&&(q+=t)}const L=n.auxpos1;for(let r=0;r<2*a;++r)L.set(i+r,q)},e}();e.MeasurementArrowMaterial=u,Object.defineProperty(e,"__esModule",{value:!0})}));
