/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../core/libs/gl-matrix-2/types/vec2","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../lib/GLMaterial","../lib/Material","../lib/RenderSlot","../lib/VertexAttribute","./internal/bufferWriterUtils","../shaders/HeatmapDensityTechnique"],(function(e,t,r,i,n,a,u,s,o,c,l,f,b,h){"use strict";const p=2;let d=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).isAttributeDriven=!1,t.usesHalfFloats=!1,t}return t._inheritsLoose(r,e),r}(h.HeatmapDensityPassParameters),A=function(e){function n(t){var r;return(r=e.call(this,t,new d)||this)._configuration=new h.HeatmapDensityTechniqueConfiguration,r}t._inheritsLoose(n,e);var u=n.prototype;return u.requiresSlot=function(e,t){return e===l.RenderSlot.DRAPED_MATERIAL&&t===s.ShaderOutput.Color},u.getConfiguration=function(){return this._configuration.isAttributeDriven=this.parameters.isAttributeDriven,this._configuration.usesHalfFloat=this.parameters.usesHalfFloats,this._configuration},u.createGLMaterial=function(e){return new T(e)},u.intersect=function(e,t,n,u,s,o,c,l,b){if(r.isNone(b)||!a.isVec2(o))return;const h=e.vertexAttributes.get(f.VertexAttribute.POSITION),{parameters:d}=this,{searchRadius:A}=d,{screenToWorldRatio:T}=e,g=A*T+p*T,v=g*g,y=h.data.length/h.size;for(let r=0;r<y;r++){const e=r*h.size,t=i.set(x,h.data[e],h.data[e+1]);i.squaredDistance(t,o)<v&&c(b.dist,b.normal,-1,!1)}},u.createBufferWriter=function(){return new g(this.parameters.isAttributeDriven?y:v)},n}(c.Material),T=function(e){function r(){return e.apply(this,arguments)||this}return t._inheritsLoose(r,e),r.prototype.beginSlot=function(e){return this.ensureTechnique(h.HeatmapDensityTechnique,e)},r}(o),g=function(){function e(e){this.vertexBufferLayout=e}var t=e.prototype;return t.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},t.elementCount=function(e){return e.indices.get(f.VertexAttribute.POSITION).length*V},t.write=function(e,t,r,i,n){b.writePosition(r.indices.get(f.VertexAttribute.POSITION),r.vertexAttributes.get(f.VertexAttribute.POSITION).data,e,i.position,n,V);const a=r.indices.get(f.VertexAttribute.POSITION).length,u=i.uv0;let s=n;for(let c=0;c<a;++c)u.setValues(s++,-1,-1),u.setValues(s++,1,-1),u.setValues(s++,1,1),u.setValues(s++,1,1),u.setValues(s++,-1,1),u.setValues(s++,-1,-1);const o="featureAttribute"in i?i.featureAttribute:null;o&&b.writeBufferFloat(r.indices.get(f.VertexAttribute.FEATUREATTRIBUTE),r.vertexAttributes.get(f.VertexAttribute.FEATUREATTRIBUTE).data,o,n,V)},e}();const v=u.newLayout().vec3f(f.VertexAttribute.POSITION).vec2f(f.VertexAttribute.UV0),y=v.clone().f32(f.VertexAttribute.FEATUREATTRIBUTE),V=6;function m(e){return e instanceof A}const x=n.create();Object.defineProperty(e,"RadiusMode",{enumerable:!0,get:()=>h.RadiusMode}),e.HeatmapDensityMaterial=A,e.HeatmapDensityMaterialParameters=d,e.isHeatMapDensityMaterial=m,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
