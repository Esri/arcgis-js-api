/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2","../../../../chunks/vec2f64","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../lib/GLMaterial","../lib/Material","../lib/RenderSlot","../lib/VertexAttribute","./internal/bufferWriterUtils","../shaders/HeatmapDensityTechnique"],(function(t,e,r,i,n,u,a,s,o,c,l,f){"use strict";const h=2;let b=function(t){function r(){var e;return(e=t.apply(this,arguments)||this).isAttributeDriven=!1,e.usesHalfFloats=!1,e}return e._inheritsLoose(r,t),r}(f.HeatmapDensityPassParameters),A=function(t){function i(e){var r;return(r=t.call(this,e,new b)||this)._configuration=new f.HeatmapDensityTechniqueConfiguration,r}e._inheritsLoose(i,t);var n=i.prototype;return n.requiresSlot=function(t,e){return t===o.RenderSlot.DRAPED_MATERIAL&&e===u.ShaderOutput.Color},n.getConfiguration=function(){return this._configuration.isAttributeDriven=this.parameters.isAttributeDriven,this._configuration.usesHalfFloat=this.parameters.usesHalfFloats,this._configuration},n.createGLMaterial=function(t){return new p(t)},n.intersect=function(){},n.intersectDraped=function(t,e,i,n,u,a){const s=t.vertexAttributes.get(c.VertexAttribute.POSITION),{parameters:o}=this,{searchRadius:l}=o,{screenToWorldRatio:f}=t,b=l*f+h*f,A=b*b,p=s.data.length/s.size;for(let c=0;c<p;c++){const t=c*s.size,e=r.set(V,s.data[t],s.data[t+1]);r.squaredDistance(e,n)<A&&u(a.dist,a.normal,-1,!1)}},n.createBufferWriter=function(){return new T(this.parameters.isAttributeDriven?g:d)},i}(s.Material),p=function(t){function r(){return t.apply(this,arguments)||this}return e._inheritsLoose(r,t),r.prototype.beginSlot=function(t){return this.ensureTechnique(f.HeatmapDensityTechnique,t)},r}(a),T=function(){function t(t){this.vertexBufferLayout=t}var e=t.prototype;return e.allocate=function(t){return this.vertexBufferLayout.createBuffer(t)},e.elementCount=function(t){return t.indices.get(c.VertexAttribute.POSITION).length*v},e.write=function(t,e,r,i,n){l.writePosition(r.indices.get(c.VertexAttribute.POSITION),r.vertexAttributes.get(c.VertexAttribute.POSITION).data,t,i.position,n,v);const u=r.indices.get(c.VertexAttribute.POSITION).length,a=i.uv0;let s=n;for(let c=0;c<u;++c)a.setValues(s++,-1,-1),a.setValues(s++,1,-1),a.setValues(s++,1,1),a.setValues(s++,1,1),a.setValues(s++,-1,1),a.setValues(s++,-1,-1);const o=c.VertexAttribute.FEATUREATTRIBUTE in i?i.featureAttribute:null;o&&l.writeBufferFloat(r.indices.get(c.VertexAttribute.FEATUREATTRIBUTE),r.vertexAttributes.get(c.VertexAttribute.FEATUREATTRIBUTE).data,o,n,v)},t}();const d=n.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0),g=d.clone().f32(c.VertexAttribute.FEATUREATTRIBUTE),v=6,V=i.create();t.HeatmapDensityMaterial=A,t.HeatmapDensityMaterialParameters=b,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
