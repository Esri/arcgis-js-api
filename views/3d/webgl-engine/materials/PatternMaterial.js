/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f64","../../../../geometry/support/buffer/BufferView","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../lib/basicInterfaces","../lib/GLMaterial","../lib/Material","../lib/OrderIndependentTransparency","../lib/RenderSlot","../lib/Util","../lib/VertexAttribute","./PatternStyle","./internal/bufferWriterUtils","./internal/DefaultBufferWriter","./internal/MaterialUtil","../shaders/PatternTechnique"],(function(e,t,r,i,a,n,s,u,o,l,c,f,h,p,d,g,_,b){"use strict";let A=function(e){function r(t){var r;return(r=e.call(this,t,new m)||this).supportsEdges=!0,r._vertexAttributeLocations=b.vertexAttributeLocations,r._configuration=new b.PatternTechniqueConfiguration,r}t._inheritsLoose(r,e);var i=r.prototype;return i.getConfiguration=function(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<l.OITPolygonOffsetLimit,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration},i.intersect=function(e,t,r,i,a,n,s){_.intersectTriangleGeometry(e,t,i,a,n,void 0,s)},i.requiresSlot=function(e,t){if(t===n.ShaderOutput.Color||t===n.ShaderOutput.Alpha||t===n.ShaderOutput.Highlight||t===n.ShaderOutput.Depth&&this.parameters.writeLinearDepth){if(e===c.RenderSlot.DRAPED_MATERIAL)return!0;if(t===n.ShaderOutput.Highlight)return e===c.RenderSlot.OPAQUE_MATERIAL;return e===(this.parameters.writeDepth?c.RenderSlot.TRANSPARENT_MATERIAL:c.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}return!1},i.createGLMaterial=function(e){return new O(e)},i.createBufferWriter=function(){const e=a.newLayout().vec3f(h.VertexAttribute.POSITION).vec4u8(h.VertexAttribute.COLOR).vec4f(h.VertexAttribute.UVMAPSPACE);return this.parameters.draped||e.mat3f(h.VertexAttribute.BOUNDINGRECT),new S(e)},r}(o.Material),O=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var i=r.prototype;return i._updateParameters=function(e){return this.ensureTechnique(b.PatternTechnique,e)},i._updateOccludeeState=function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})},i.beginSlot=function(e){return this._output!==n.ShaderOutput.Color&&this._output!==n.ShaderOutput.Alpha||this._updateOccludeeState(e),this._updateParameters(e)},r}(u),S=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var a=r.prototype;return a.write=function(e,t,r,a,n){for(const s of this.vertexBufferLayout.fieldNames){const t=r.vertexAttributes.get(s),u=r.indices.get(s);if(t&&u)switch(s){case h.VertexAttribute.POSITION:{f.assert(3===t.size);const r=a.getField(s,i.BufferViewVec3f);r&&d.writePosition(u,t.data,e,r,n);break}case h.VertexAttribute.COLOR:{f.assert(3===t.size||4===t.size);const e=a.getField(s,i.BufferViewVec4u8);e&&d.writeColor(u,t.data,t.size,e,n);break}case h.VertexAttribute.UVMAPSPACE:{f.assert(4===t.size);const e=a.getField(s,i.BufferViewVec4f);e&&d.writeBufferVec4(u,t.data,e,n);break}case h.VertexAttribute.BOUNDINGRECT:{f.assert(9===t.size);const r=a.getField(s,i.BufferViewMat3f);r&&this.writeBoundingRect(u,t.data,e,r,n);break}}}},a.writeBoundingRect=function(e,t,r,i,a){const n=r,s=i.typedBuffer,u=i.typedBufferStride,o=e.length;a*=u;for(let l=0;l<o;++l){const r=9*e[l],i=t[r],o=t[r+1],c=t[r+2];s[a]=n[0]*i+n[4]*o+n[8]*c+n[12],s[a+1]=n[1]*i+n[5]*o+n[9]*c+n[13],s[a+2]=n[2]*i+n[6]*o+n[10]*c+n[14];for(let e=3;e<9;++e)s[a+e]=t[r+e];a+=u}},r}(g.DefaultBufferWriter),m=function(e){function i(){var t;return(t=e.apply(this,arguments)||this).color=r.fromValues(1,1,1,1),t.writeDepth=!0,t.writeLinearDepth=!1,t.hasVertexColors=!1,t.polygonOffset=!1,t.hasSlicePlane=!1,t.cullFace=s.CullFaceOptions.None,t.hasOccludees=!1,t.style=p.Style.Cross,t.patternSpacing=10,t.lineWidth=1,t.draped=!0,t}return t._inheritsLoose(i,e),i}(o.MaterialParameters);e.Parameters=m,e.PatternMaterial=A,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
