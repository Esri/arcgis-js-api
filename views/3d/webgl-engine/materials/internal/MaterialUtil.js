/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../../../geometry/support/aaBoundingBox","../../lib/ContentObjectType","../../lib/screenSizePerspectiveUtils","../../lib/Util","../../lib/VertexAttribute"],(function(t,e,n,i,o,r,c,s,a,l,u){"use strict";const f=c.create();function p(t,e,n,i,o,r){if(t.visible)if(t.boundingInfo){l.assert(t.type===s.ContentObjectType.Mesh);const c=e.tolerance;b(t.boundingInfo,n,i,c,o,r)}else{const e=t.indices.get(u.VertexAttribute.POSITION),c=t.vertexAttributes.get(u.VertexAttribute.POSITION);d(n,i,0,e.length/3,e,c,void 0,o,r)}}const m=r.create();function b(t,e,n,o,r,s){if(i.isNone(t))return;const a=v(e,n,m);if(c.setMin(f,t.bbMin),c.setMax(f,t.bbMax),i.isSome(r)&&r.applyToAabb(f),T(f,e,a,o)){const{primitiveIndices:i,indices:c,position:a}=t,l=i?i.length:c.length/3;if(l>P){const i=t.getChildren();if(void 0!==i){for(const t of i)b(t,e,n,o,r,s);return}}d(e,n,0,l,c,a,i,r,s)}}const h=r.create();function d(t,e,n,o,r,c,s,a,l){if(s)return x(t,e,n,o,r,c,s,a,l);const{data:u,stride:f}=c,p=t[0],m=t[1],b=t[2],d=e[0]-p,M=e[1]-m,g=e[2]-b;for(let x=n,v=3*n;x<o;++x){let t=f*r[v++],e=u[t++],n=u[t++],o=u[t];t=f*r[v++];let c=u[t++],s=u[t++],T=u[t];t=f*r[v++];let I=u[t++],S=u[t++],A=u[t];i.isSome(a)&&([e,n,o]=a.applyToVertex(e,n,o,x),[c,s,T]=a.applyToVertex(c,s,T,x),[I,S,A]=a.applyToVertex(I,S,A,x));const O=c-e,V=s-n,N=T-o,P=I-e,L=S-n,D=A-o,E=M*D-L*g,U=g*P-D*d,j=d*L-P*M,B=O*E+V*U+N*j;if(Math.abs(B)<=Number.EPSILON)continue;const C=p-e,W=m-n,k=b-o,z=C*E+W*U+k*j;if(B>0){if(z<0||z>B)continue}else if(z>0||z<B)continue;const G=W*N-V*k,H=k*O-N*C,R=C*V-O*W,Y=d*G+M*H+g*R;if(B>0){if(Y<0||z+Y>B)continue}else if(Y>0||z+Y<B)continue;const q=(P*G+L*H+D*R)/B;if(q>=0){l(q,y(O,V,N,P,L,D,h),x,!1)}}}function x(t,e,n,o,r,c,s,a,l){const{data:u,stride:f}=c,p=t[0],m=t[1],b=t[2],d=e[0]-p,x=e[1]-m,M=e[2]-b;for(let g=n;g<o;++g){const t=s[g];let e=3*t,n=f*r[e++],o=u[n++],c=u[n++],v=u[n];n=f*r[e++];let T=u[n++],I=u[n++],S=u[n];n=f*r[e];let A=u[n++],O=u[n++],V=u[n];i.isSome(a)&&([o,c,v]=a.applyToVertex(o,c,v,g),[T,I,S]=a.applyToVertex(T,I,S,g),[A,O,V]=a.applyToVertex(A,O,V,g));const N=T-o,P=I-c,L=S-v,D=A-o,E=O-c,U=V-v,j=x*U-E*M,B=M*D-U*d,C=d*E-D*x,W=N*j+P*B+L*C;if(Math.abs(W)<=Number.EPSILON)continue;const k=p-o,z=m-c,G=b-v,H=k*j+z*B+G*C;if(W>0){if(H<0||H>W)continue}else if(H>0||H<W)continue;const R=z*L-P*G,Y=G*N-L*k,q=k*P-N*z,w=d*R+x*Y+M*q;if(W>0){if(w<0||H+w>W)continue}else if(w>0||H+w<W)continue;const F=(D*R+E*Y+U*q)/W;if(F>=0){l(F,y(N,P,L,D,E,U,h),t,!1)}}}const M=r.create(),g=r.create();function y(t,e,n,i,r,c,s){return o.set(M,t,e,n),o.set(g,i,r,c),o.cross(s,M,g),o.normalize(s,s),s}function v(t,e,n){return o.set(n,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function T(t,e,n,i){return I(t,e,n,i,1/0)}function I(t,e,n,i,o){const r=(t[0]-i-e[0])*n[0],c=(t[3]+i-e[0])*n[0];let s=Math.min(r,c),a=Math.max(r,c);const l=(t[1]-i-e[1])*n[1],u=(t[4]+i-e[1])*n[1];if(a=Math.min(a,Math.max(l,u)),a<0)return!1;if(s=Math.max(s,Math.min(l,u)),s>a)return!1;const f=(t[2]-i-e[2])*n[2],p=(t[5]+i-e[2])*n[2];return a=Math.min(a,Math.max(f,p)),!(a<0)&&(s=Math.max(s,Math.min(f,p)),!(s>a)&&s<o)}function S(t,e,o,r,c){let s=(o.screenLength||0)*t.pixelRatio;i.isSome(c)&&(s=a.scale(s,r,e,c));const l=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return n.clamp(l*e,o.minWorldLength||0,null!=o.maxWorldLength?o.maxWorldLength:1/0)}function A(t,e){const n=e?A(e):{};for(const i in t){let e=t[i];e&&e.forEach&&(e=V(e)),null==e&&i in n||(n[i]=e)}return n}function O(t,n){let i=!1;for(const o in n){const r=n[o];void 0!==r&&(Array.isArray(r)?null===t[o]?(t[o]=r.slice(),i=!0):e.update(t[o],r)&&(i=!0):t[o]!==r&&(i=!0,t[o]=r))}return i}function V(t){const e=[];return t.forEach((t=>e.push(t))),e}const N={multiply:1,ignore:2,replace:3,tint:4},P=1e3;t.colorMixModes=N,t.computeInvDir=v,t.computeNormal=y,t.copyParameters=A,t.intersectAabbInvDir=T,t.intersectAabbInvDirBefore=I,t.intersectTriangleGeometry=p,t.intersectTriangles=d,t.updateParameters=O,t.verticalOffsetAtDistance=S,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
