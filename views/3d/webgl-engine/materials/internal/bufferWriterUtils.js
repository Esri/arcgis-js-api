/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../support/buffer/BufferView","../../lib/Util"],(function(e,t,f){"use strict";function r(e,t,f,r){const s=f.typedBuffer,o=f.typedBufferStride,i=e.length;r*=o;for(let n=0;n<i;++n){const f=2*e[n];s[r]=t[f],s[r+1]=t[f+1],r+=o}}function s(e,t,f,r,s){const o=f.typedBuffer,i=f.typedBufferStride,n=e.length;if(r*=i,null==s||1===s)for(let c=0;c<n;++c){const f=3*e[c];o[r]=t[f],o[r+1]=t[f+1],o[r+2]=t[f+2],r+=i}else for(let c=0;c<n;++c){const f=3*e[c];for(let e=0;e<s;++e)o[r]=t[f],o[r+1]=t[f+1],o[r+2]=t[f+2],r+=i}}function o(e,t,f,r,s=1){const o=f.typedBuffer,i=f.typedBufferStride,n=e.length;if(r*=i,1===s)for(let c=0;c<n;++c){const f=4*e[c];o[r]=t[f],o[r+1]=t[f+1],o[r+2]=t[f+2],o[r+3]=t[f+3],r+=i}else for(let c=0;c<n;++c){const f=4*e[c];for(let e=0;e<s;++e)o[r]=t[f],o[r+1]=t[f+1],o[r+2]=t[f+2],o[r+3]=t[f+3],r+=i}}function i(e,t,f,r){const s=f.typedBuffer,o=f.typedBufferStride,i=e.length;r*=o;for(let n=0;n<i;++n){const f=9*e[n];for(let e=0;e<9;++e)s[r+e]=t[f+e];r+=o}}function n(e,t,f,r){const s=f.typedBuffer,o=f.typedBufferStride,i=e.length;r*=o;for(let n=0;n<i;++n){const f=16*e[n];for(let e=0;e<16;++e)s[r+e]=t[f+e];r+=o}}function c(e,t,f,r,o,i=1){if(f){const s=r.typedBuffer,n=r.typedBufferStride,c=e.length,l=f[0],u=f[1],a=f[2],d=f[4],B=f[5],p=f[6],y=f[8],g=f[9],w=f[10],V=f[12],b=f[13],h=f[14];if(o*=n,1===i)for(let f=0;f<c;++f){const r=3*e[f],i=t[r],c=t[r+1],z=t[r+2];s[o]=l*i+d*c+y*z+V,s[o+1]=u*i+B*c+g*z+b,s[o+2]=a*i+p*c+w*z+h,o+=n}else for(let f=0;f<c;++f){const r=3*e[f],c=t[r],z=t[r+1],M=t[r+2],S=l*c+d*z+y*M+V,k=u*c+B*z+g*M+b,F=a*c+p*z+w*M+h;for(let e=0;e<i;++e)s[o]=S,s[o+1]=k,s[o+2]=F,o+=n}}else s(e,t,r,o,i)}function l(e,t,f,r,o,i){if(f){const s=f,n=r.typedBuffer,c=r.typedBufferStride,l=e.length,u=s[0],a=s[1],d=s[2],B=s[4],p=s[5],y=s[6],g=s[8],w=s[9],V=s[10],b=Math.abs(1-u*u+B*B+g*g)>1e-5||Math.abs(1-a*a+p*p+w*w)>1e-5||Math.abs(1-d*d+y*y+V*V)>1e-5,h=1e-6,z=1-h;if(o*=c,1===i)for(let f=0;f<l;++f){const r=3*e[f],s=t[r],i=t[r+1],l=t[r+2];let M=u*s+B*i+g*l,S=a*s+p*i+w*l,k=d*s+y*i+V*l;if(b){const e=M*M+S*S+k*k;if(e<z&&e>h){const t=Math.sqrt(e);M/=t,S/=t,k/=t}}n[o+0]=M,n[o+1]=S,n[o+2]=k,o+=c}else for(let f=0;f<l;++f){const r=3*e[f],s=t[r],l=t[r+1],M=t[r+2];let S=u*s+B*l+g*M,k=a*s+p*l+w*M,F=d*s+y*l+V*M;if(b){const e=S*S+k*k+F*F;if(e<z&&e>h){const t=Math.sqrt(e);S/=t,k/=t,F/=t}}for(let e=0;e<i;++e)n[o+0]=S,n[o+1]=k,n[o+2]=F,o+=c}}else s(e,t,r,o,i)}function u(e,t,f,r,s,o=1){const i=r.typedBuffer,n=r.typedBufferStride,c=e.length;if(s*=n,1===o){if(4===f)for(let l=0;l<c;++l){const f=4*e[l];i[s]=t[f],i[s+1]=t[f+1],i[s+2]=t[f+2],i[s+3]=t[f+3],s+=n}else if(3===f)for(let l=0;l<c;++l){const f=3*e[l];i[s]=t[f],i[s+1]=t[f+1],i[s+2]=t[f+2],i[s+3]=255,s+=n}}else if(4===f)for(let l=0;l<c;++l){const f=4*e[l];for(let e=0;e<o;++e)i[s]=t[f],i[s+1]=t[f+1],i[s+2]=t[f+2],i[s+3]=t[f+3],s+=n}else if(3===f)for(let l=0;l<c;++l){const f=3*e[l];for(let e=0;e<o;++e)i[s]=t[f],i[s+1]=t[f+1],i[s+2]=t[f+2],i[s+3]=255,s+=n}}function a(e,s,i,n,a,d){for(const B of s.fieldNames){const s=e.vertexAttributes.get(B),p=e.indices.get(B);if(s&&p)switch(B){case"position":{f.assert(3===s.size);const e=a.getField(B,t.BufferViewVec3f);e&&c(p,s.data,i,e,d);break}case"normal":{f.assert(3===s.size);const e=a.getField(B,t.BufferViewVec3f);e&&l(p,s.data,n,e,d,1);break}case"uv0":{f.assert(2===s.size);const e=a.getField(B,t.BufferViewVec2f);e&&r(p,s.data,e,d);break}case"color":{f.assert(3===s.size||4===s.size);const e=a.getField(B,t.BufferViewVec4u8);e&&u(p,s.data,s.size,e,d);break}case"symbolColor":{f.assert(3===s.size||4===s.size);const e=a.getField(B,t.BufferViewVec4u8);e&&u(p,s.data,s.size,e,d);break}case"tangent":{f.assert(4===s.size);const e=a.getField(B,t.BufferViewVec4f);e&&o(p,s.data,e,d);break}}}}e.writeBufferMat3f=i,e.writeBufferMat4f=n,e.writeBufferVec2=r,e.writeBufferVec3=s,e.writeBufferVec4=o,e.writeColor=u,e.writeDefaultAttributes=a,e.writeNormal=l,e.writePosition=c,Object.defineProperty(e,"__esModule",{value:!0})}));
