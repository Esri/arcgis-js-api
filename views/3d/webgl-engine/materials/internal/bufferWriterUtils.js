/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],(function(e,t,f,r,o){"use strict";function i(e,t,f,r,o=1){const i=f.typedBuffer,s=f.typedBufferStride,n=e.length;if(r*=s,1===o)for(let c=0;c<n;++c)i[r]=t[e[c]],r+=s;else for(let c=0;c<n;++c){const f=t[e[c]];for(let e=0;e<o;e++)i[r]=f,r+=s}}function s(e,t,f,r){const o=f.typedBuffer,i=f.typedBufferStride,s=e.length;r*=i;for(let n=0;n<s;++n){const f=2*e[n];o[r]=t[f],o[r+1]=t[f+1],r+=i}}function n(e,t,f,r,o){const i=f.typedBuffer,s=f.typedBufferStride,n=e.length;if(r*=s,null==o||1===o)for(let c=0;c<n;++c){const f=3*e[c];i[r]=t[f],i[r+1]=t[f+1],i[r+2]=t[f+2],r+=s}else for(let c=0;c<n;++c){const f=3*e[c];for(let e=0;e<o;++e)i[r]=t[f],i[r+1]=t[f+1],i[r+2]=t[f+2],r+=s}}function c(e,t,f,r,o=1){const i=f.typedBuffer,s=f.typedBufferStride,n=e.length;if(r*=s,1===o)for(let c=0;c<n;++c){const f=4*e[c];i[r]=t[f],i[r+1]=t[f+1],i[r+2]=t[f+2],i[r+3]=t[f+3],r+=s}else for(let c=0;c<n;++c){const f=4*e[c];for(let e=0;e<o;++e)i[r]=t[f],i[r+1]=t[f+1],i[r+2]=t[f+2],i[r+3]=t[f+3],r+=s}}function l(e,t,f,r){const o=f.typedBuffer,i=f.typedBufferStride,s=e.length;r*=i;for(let n=0;n<s;++n){const f=9*e[n];for(let e=0;e<9;++e)o[r+e]=t[f+e];r+=i}}function u(e,t,f,r){const o=f.typedBuffer,i=f.typedBufferStride,s=e.length;r*=i;for(let n=0;n<s;++n){const f=16*e[n];for(let e=0;e<16;++e)o[r+e]=t[f+e];r+=i}}function d(e,t,f,r,o,i=1){if(!f)return void n(e,t,r,o,i);const s=r.typedBuffer,c=r.typedBufferStride,l=e.length,u=f[0],d=f[1],a=f[2],B=f[4],p=f[5],V=f[6],g=f[8],y=f[9],b=f[10],w=f[12],h=f[13],S=f[14];if(o*=c,1===i)for(let n=0;n<l;++n){const f=3*e[n],r=t[f],i=t[f+1],l=t[f+2];s[o]=u*r+B*i+g*l+w,s[o+1]=d*r+p*i+y*l+h,s[o+2]=a*r+V*i+b*l+S,o+=c}else for(let n=0;n<l;++n){const f=3*e[n],r=t[f],l=t[f+1],A=t[f+2],O=u*r+B*l+g*A+w,z=d*r+p*l+y*A+h,M=a*r+V*l+b*A+S;for(let e=0;e<i;++e)s[o]=O,s[o+1]=z,s[o+2]=M,o+=c}}function a(e,f,r,o,i,s=1){if(!r)return void n(e,f,o,i,s);const c=r,l=o.typedBuffer,u=o.typedBufferStride,d=e.length,a=c[0],B=c[1],p=c[2],V=c[4],g=c[5],y=c[6],b=c[8],w=c[9],h=c[10],S=!t.isOrthoNormal(c),A=1e-6,O=1-A;if(i*=u,1===s)for(let t=0;t<d;++t){const r=3*e[t],o=f[r],s=f[r+1],n=f[r+2];let c=a*o+V*s+b*n,d=B*o+g*s+w*n,z=p*o+y*s+h*n;if(S){const e=c*c+d*d+z*z;if(e<O&&e>A){const t=1/Math.sqrt(e);c*=t,d*=t,z*=t}}l[i+0]=c,l[i+1]=d,l[i+2]=z,i+=u}else for(let t=0;t<d;++t){const r=3*e[t],o=f[r],n=f[r+1],c=f[r+2];let d=a*o+V*n+b*c,z=B*o+g*n+w*c,M=p*o+y*n+h*c;if(S){const e=d*d+z*z+M*M;if(e<O&&e>A){const t=1/Math.sqrt(e);d*=t,z*=t,M*=t}}for(let e=0;e<s;++e)l[i+0]=d,l[i+1]=z,l[i+2]=M,i+=u}}function B(e,f,r,o,i,s=1){if(!r)return void c(e,f,o,i,s);const n=r,l=o.typedBuffer,u=o.typedBufferStride,d=e.length,a=n[0],B=n[1],p=n[2],V=n[4],g=n[5],y=n[6],b=n[8],w=n[9],h=n[10],S=!t.isOrthoNormal(n),A=1e-6,O=1-A;if(i*=u,1===s)for(let t=0;t<d;++t){const r=4*e[t],o=f[r],s=f[r+1],n=f[r+2],c=f[r+3];let d=a*o+V*s+b*n,z=B*o+g*s+w*n,M=p*o+y*s+h*n;if(S){const e=d*d+z*z+M*M;if(e<O&&e>A){const t=1/Math.sqrt(e);d*=t,z*=t,M*=t}}l[i+0]=d,l[i+1]=z,l[i+2]=M,l[i+3]=c,i+=u}else for(let t=0;t<d;++t){const r=4*e[t],o=f[r],n=f[r+1],c=f[r+2],d=f[r+3];let z=a*o+V*n+b*c,M=B*o+g*n+w*c,x=p*o+y*n+h*c;if(S){const e=z*z+M*M+x*x;if(e<O&&e>A){const t=1/Math.sqrt(e);z*=t,M*=t,x*=t}}for(let e=0;e<s;++e)l[i+0]=z,l[i+1]=M,l[i+2]=x,l[i+3]=d,i+=u}}function p(e,t,f,r,o,i=1){const s=r.typedBuffer,n=r.typedBufferStride,c=e.length;if(o*=n,1===i){if(4===f)for(let l=0;l<c;++l){const f=4*e[l];s[o]=t[f],s[o+1]=t[f+1],s[o+2]=t[f+2],s[o+3]=t[f+3],o+=n}else if(3===f)for(let l=0;l<c;++l){const f=3*e[l];s[o]=t[f],s[o+1]=t[f+1],s[o+2]=t[f+2],s[o+3]=255,o+=n}}else if(4===f)for(let l=0;l<c;++l){const f=4*e[l];for(let e=0;e<i;++e)s[o]=t[f],s[o+1]=t[f+1],s[o+2]=t[f+2],s[o+3]=t[f+3],o+=n}else if(3===f)for(let l=0;l<c;++l){const f=3*e[l];for(let e=0;e<i;++e)s[o]=t[f],s[o+1]=t[f+1],s[o+2]=t[f+2],s[o+3]=255,o+=n}}function V(e,t,i,n,c,l){for(const u of t.fieldNames){const t=e.vertexAttributes.get(u),V=e.indices.get(u);if(t&&V)switch(u){case o.VertexAttribute.POSITION:{r.assert(3===t.size);const e=c.getField(u,f.BufferViewVec3f);e&&d(V,t.data,i,e,l);break}case o.VertexAttribute.NORMAL:{r.assert(3===t.size);const e=c.getField(u,f.BufferViewVec3f);e&&a(V,t.data,n,e,l);break}case o.VertexAttribute.UV0:{r.assert(2===t.size);const e=c.getField(u,f.BufferViewVec2f);e&&s(V,t.data,e,l);break}case o.VertexAttribute.COLOR:{r.assert(3===t.size||4===t.size);const e=c.getField(u,f.BufferViewVec4u8);e&&p(V,t.data,t.size,e,l);break}case o.VertexAttribute.SYMBOLCOLOR:{r.assert(3===t.size||4===t.size);const e=c.getField(u,f.BufferViewVec4u8);e&&p(V,t.data,t.size,e,l);break}case o.VertexAttribute.TANGENT:{r.assert(4===t.size);const e=c.getField(u,f.BufferViewVec4f);e&&B(V,t.data,n,e,l);break}}}}e.writeBufferFloat=i,e.writeBufferMat3f=l,e.writeBufferMat4f=u,e.writeBufferVec2=s,e.writeBufferVec3=n,e.writeBufferVec4=c,e.writeColor=p,e.writeDefaultAttributes=V,e.writeNormal=a,e.writePosition=d,e.writeTangent=B,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
