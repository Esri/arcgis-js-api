/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/maybe","../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],(function(e,t,r,f,o,i){"use strict";function s(e,t,r,f,o=1){const i=r.typedBuffer,s=r.typedBufferStride,n=e.length;if(f*=s,1===o)for(let l=0;l<n;++l)i[f]=t[e[l]],f+=s;else for(let l=0;l<n;++l){const r=t[e[l]];for(let e=0;e<o;e++)i[f]=r,f+=s}}function n(e,t,r,f){const o=r.typedBuffer,i=r.typedBufferStride,s=e.length;f*=i;for(let n=0;n<s;++n){const r=2*e[n];o[f]=t[r],o[f+1]=t[r+1],f+=i}}function l(e,t,r,f,o){const i=r.typedBuffer,s=r.typedBufferStride,n=e.length;if(f*=s,null==o||1===o)for(let l=0;l<n;++l){const r=3*e[l];i[f]=t[r],i[f+1]=t[r+1],i[f+2]=t[r+2],f+=s}else for(let l=0;l<n;++l){const r=3*e[l];for(let e=0;e<o;++e)i[f]=t[r],i[f+1]=t[r+1],i[f+2]=t[r+2],f+=s}}function c(e,t,r,f,o=1){const i=r.typedBuffer,s=r.typedBufferStride,n=e.length;if(f*=s,1===o)for(let l=0;l<n;++l){const r=4*e[l];i[f]=t[r],i[f+1]=t[r+1],i[f+2]=t[r+2],i[f+3]=t[r+3],f+=s}else for(let l=0;l<n;++l){const r=4*e[l];for(let e=0;e<o;++e)i[f]=t[r],i[f+1]=t[r+1],i[f+2]=t[r+2],i[f+3]=t[r+3],f+=s}}function u(e,t,r,f){const o=r.typedBuffer,i=r.typedBufferStride,s=e.length;f*=i;for(let n=0;n<s;++n){const r=9*e[n];for(let e=0;e<9;++e)o[f+e]=t[r+e];f+=i}}function d(e,t,r,f){const o=r.typedBuffer,i=r.typedBufferStride,s=e.length;f*=i;for(let n=0;n<s;++n){const r=16*e[n];for(let e=0;e<16;++e)o[f+e]=t[r+e];f+=i}}function a(e,t,r,f,o,i=1){if(!r)return void l(e,t,f,o,i);const s=f.typedBuffer,n=f.typedBufferStride,c=e.length,u=r[0],d=r[1],a=r[2],B=r[4],y=r[5],b=r[6],V=r[8],g=r[9],w=r[10],h=r[12],A=r[13],O=r[14];o*=n;let S=0,x=0,z=0;const L=p(r)?e=>{S=t[e]+h,x=t[e+1]+A,z=t[e+2]+O}:e=>{const r=t[e],f=t[e+1],o=t[e+2];S=u*r+B*f+V*o+h,x=d*r+y*f+g*o+A,z=a*r+b*f+w*o+O};if(1===i)for(let l=0;l<c;++l)L(3*e[l]),s[o]=S,s[o+1]=x,s[o+2]=z,o+=n;else for(let l=0;l<c;++l){L(3*e[l]);for(let e=0;e<i;++e)s[o]=S,s[o+1]=x,s[o+2]=z,o+=n}}function B(e,t,f,o,i,s=1){if(!f)return void l(e,t,o,i,s);const n=f,c=o.typedBuffer,u=o.typedBufferStride,d=e.length,a=n[0],B=n[1],y=n[2],b=n[4],V=n[5],g=n[6],w=n[8],h=n[9],A=n[10],O=!r.isOrthoNormal(n),S=1e-6,x=1-S;i*=u;let z=0,L=0,M=0;const N=p(n)?e=>{z=t[e],L=t[e+1],M=t[e+2]}:e=>{const r=t[e],f=t[e+1],o=t[e+2];z=a*r+b*f+w*o,L=B*r+V*f+h*o,M=y*r+g*f+A*o};if(1===s)if(O)for(let r=0;r<d;++r){N(3*e[r]);const t=z*z+L*L+M*M;if(t<x&&t>S){const e=1/Math.sqrt(t);c[i]=z*e,c[i+1]=L*e,c[i+2]=M*e}else c[i]=z,c[i+1]=L,c[i+2]=M;i+=u}else for(let r=0;r<d;++r)N(3*e[r]),c[i]=z,c[i+1]=L,c[i+2]=M,i+=u;else for(let r=0;r<d;++r){if(N(3*e[r]),O){const e=z*z+L*L+M*M;if(e<x&&e>S){const t=1/Math.sqrt(e);z*=t,L*=t,M*=t}}for(let e=0;e<s;++e)c[i]=z,c[i+1]=L,c[i+2]=M,i+=u}}function y(e,t,f,o,i,s=1){if(!f)return void c(e,t,o,i,s);const n=f,l=o.typedBuffer,u=o.typedBufferStride,d=e.length,a=n[0],B=n[1],y=n[2],b=n[4],V=n[5],g=n[6],p=n[8],w=n[9],h=n[10],A=!r.isOrthoNormal(n),O=1e-6,S=1-O;if(i*=u,1===s)for(let r=0;r<d;++r){const f=4*e[r],o=t[f],s=t[f+1],n=t[f+2],c=t[f+3];let d=a*o+b*s+p*n,x=B*o+V*s+w*n,z=y*o+g*s+h*n;if(A){const e=d*d+x*x+z*z;if(e<S&&e>O){const t=1/Math.sqrt(e);d*=t,x*=t,z*=t}}l[i]=d,l[i+1]=x,l[i+2]=z,l[i+3]=c,i+=u}else for(let r=0;r<d;++r){const f=4*e[r],o=t[f],n=t[f+1],c=t[f+2],d=t[f+3];let x=a*o+b*n+p*c,z=B*o+V*n+w*c,L=y*o+g*n+h*c;if(A){const e=x*x+z*z+L*L;if(e<S&&e>O){const t=1/Math.sqrt(e);x*=t,z*=t,L*=t}}for(let e=0;e<s;++e)l[i]=x,l[i+1]=z,l[i+2]=L,l[i+3]=d,i+=u}}function b(e,t,r,f,o,i=1){const s=f.typedBuffer,n=f.typedBufferStride,l=e.length;if(o*=n,r!==t.length||4!==r)if(1!==i)if(4!==r)for(let c=0;c<l;++c){const r=3*e[c];for(let e=0;e<i;++e)s[o]=t[r],s[o+1]=t[r+1],s[o+2]=t[r+2],s[o+3]=255,o+=n}else for(let c=0;c<l;++c){const r=4*e[c];for(let e=0;e<i;++e)s[o]=t[r],s[o+1]=t[r+1],s[o+2]=t[r+2],s[o+3]=t[r+3],o+=n}else{if(4===r){for(let r=0;r<l;++r){const f=4*e[r];s[o]=t[f],s[o+1]=t[f+1],s[o+2]=t[f+2],s[o+3]=t[f+3],o+=n}return}for(let r=0;r<l;++r){const f=3*e[r];s[o]=t[f],s[o+1]=t[f+1],s[o+2]=t[f+2],s[o+3]=255,o+=n}}else{s[o]=t[0],s[o+1]=t[1],s[o+2]=t[2],s[o+3]=t[3];const e=new Uint32Array(f.typedBuffer.buffer,f.start),r=n/4,c=e[o/=4];o+=r;const u=l*i;for(let t=1;t<u;++t)e[o]=c,o+=r}}function V(e,t,r,f,o=1){const i=t.typedBuffer,s=t.typedBufferStride;if(f*=s,1===o)for(let n=0;n<r;++n)i[f]=e[0],i[f+1]=e[1],i[f+2]=e[2],i[f+3]=e[3],f+=s;else for(let n=0;n<r;++n)for(let t=0;t<o;++t)i[f]=e[0],i[f+1]=e[1],i[f+2]=e[2],i[f+3]=e[3],f+=s}function g(e,r,s,l,c,u){for(const d of r.fieldNames){const r=e.vertexAttributes.get(d),g=e.indices.get(d);if(r&&g)switch(d){case i.VertexAttribute.POSITION:{o.assert(3===r.size);const e=c.getField(d,f.BufferViewVec3f);e&&a(g,r.data,s,e,u);break}case i.VertexAttribute.NORMAL:{o.assert(3===r.size);const e=c.getField(d,f.BufferViewVec3f);e&&B(g,r.data,l,e,u);break}case i.VertexAttribute.UV0:{o.assert(2===r.size);const e=c.getField(d,f.BufferViewVec2f);e&&n(g,r.data,e,u);break}case i.VertexAttribute.COLOR:{o.assert(3===r.size||4===r.size);const e=c.getField(d,f.BufferViewVec4u8);e&&b(g,r.data,r.size,e,u);break}case i.VertexAttribute.SYMBOLCOLOR:{o.assert(3===r.size||4===r.size);const e=c.getField(d,f.BufferViewVec4u8);e&&b(g,r.data,r.size,e,u);break}case i.VertexAttribute.TANGENT:{o.assert(4===r.size);const e=c.getField(d,f.BufferViewVec4f);e&&y(g,r.data,l,e,u);break}}else if(d===i.VertexAttribute.OBJECTANDLAYERIDCOLOR&&t.isSome(e.objectAndLayerIdColor)&&4===e.objectAndLayerIdColor.length){const t=e.indices.get(i.VertexAttribute.POSITION);if(t){const r=t.length,o=c.getField(d,f.BufferViewVec4u8);V(e.objectAndLayerIdColor,o,r,u)}}}}function p(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}e.writeBufferFloat=s,e.writeBufferMat3f=u,e.writeBufferMat4f=d,e.writeBufferVec2=n,e.writeBufferVec3=l,e.writeBufferVec4=c,e.writeColor=b,e.writeDefaultAttributes=g,e.writeNormal=B,e.writeObjectAndLayerIdColor=V,e.writePosition=a,e.writeTangent=y,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
