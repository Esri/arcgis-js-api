/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../../../geometry/support/aaBoundingBox","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/shading/Normals.glsl","../lib/GLMaterial","../lib/Material","../lib/PathGeometry","../lib/RenderSlot","../lib/VertexAttribute","./DefaultBufferWriter","./PathTechnique","./internal/MaterialUtil"],(function(e,t,r,a,i,s,n,o,u,h,c,l,d,p,S,f){"use strict";let b=function(e){function u(t){var r;return(r=e.call(this,t,new v)||this).supportsEdges=!0,r._vertexAttributeLocations=S.vertexAttributeLocations,r._configuration=new S.PathTechniqueConfiguration,r._vertexBufferLayout=u.getVertexBufferLayout(),r}t._inheritsLoose(u,e);var h=u.prototype;return h.getConfiguration=function(e,t){return this._configuration.output=e,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==n.ShaderOutput.Color&&e!==n.ShaderOutput.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?o.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?o.NormalsDoubleSidedMode.WindingOrder:o.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!t.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration},h.isVisibleForOutput=function(e){return e!==n.ShaderOutput.Shadow&&e!==n.ShaderOutput.ShadowExcludeHighlight&&e!==n.ShaderOutput.ShadowHighlight||this.parameters.castShadows},h.isVisible=function(){return e.prototype.isVisible.call(this)&&this.parameters.opacity>0},h.intersect=function(e,t,s,n,o,u){const h=e;if(!c.isPathGeometry(h))return;const l=h.path,d=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const e=this.parameters.vvSizeOffset,t=this.parameters.vvSizeFactor,a=this.parameters.vvSizeMinSize,i=this.parameters.vvSizeMaxSize,s=l.sizeAttributeValue;d[0]*=r.clamp(e[0]+s*t[0],a[0],i[0]),d[1]*=r.clamp(e[2]+s*t[2],a[2],i[2])}const p=Math.max(d[0],d[1]),S=e.boundingInfo;if(a.isNone(S))return void this._intersectTriangles(l,d,n,o,u);const b=i.fromValues(S.bbMin[0]-p,S.bbMin[1]-p,S.bbMin[2]-p,S.bbMax[0]+p,S.bbMax[1]+p,S.bbMax[2]+p),m=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],v=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),g=[v/m[0],v/m[1],v/m[2]];f.intersectAabbInvDir(b,n,g,s.tolerance)&&this._intersectTriangles(l,d,n,o,u)},h._intersectTriangles=function(e,t,r,a,i){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,a,i)},h.createBufferWriter=function(){return new p.DefaultBufferWriter(this._vertexBufferLayout)},h.requiresSlot=function(e,t){switch(t){case n.ShaderOutput.Shadow:case n.ShaderOutput.ShadowHighlight:case n.ShaderOutput.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case n.ShaderOutput.Color:case n.ShaderOutput.Alpha:case n.ShaderOutput.Depth:case n.ShaderOutput.Normal:case n.ShaderOutput.Highlight:case n.ShaderOutput.ObjectAndLayerIdColor:return e===(this.parameters.transparent?l.RenderSlot.TRANSPARENT_MATERIAL:l.RenderSlot.OPAQUE_MATERIAL)||e===l.RenderSlot.DRAPED_MATERIAL;default:return!1}},h.createGLMaterial=function(e){return new m(e)},u.getVertexBufferLayout=function(){return s.newLayout().vec3f(d.VertexAttribute.POSITION).vec4f(d.VertexAttribute.PROFILERIGHT).vec4f(d.VertexAttribute.PROFILEUP).vec4f(d.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(d.VertexAttribute.FEATUREVALUE)},u}(h.Material),m=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var i=r.prototype;return i._updateOccludeeState=function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})},i._updateShadowState=function(e){(a.isNone(this.technique)||e.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})},i.beginSlot=function(e){return this._output!==n.ShaderOutput.Color&&this._output!==n.ShaderOutput.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(S.PathTechnique,e)},r}(u),v=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).doubleSided=!1,t.doubleSidedType="normal",t.receiveSSAO=!0,t.receiveShadows=!1,t.castShadows=!0,t.hasSlicePlane=!1,t.transparent=!1,t.hasOccludees=!1,t}return t._inheritsLoose(r,e),r}(S.PathPassParameters);e.PathMaterial=b,e.PathMaterialParameters=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
