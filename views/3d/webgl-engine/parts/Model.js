/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/has","../../../../core/Logger","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/decorators/subclass","../../../../core/urlUtils","../../../../core/uuid","../../../../portal/support/resourceExtension","../../../../core/Accessor","../../support/mathUtils","../lib/Util","../lib/localOrigin","../lib/WebGLLayer","../lib/RenderGeometry","../lib/ModelDirtySet"],(function(e,t,o,n,r,i,s,a,c,d,l,u,h,f,g,p,y,_){"use strict";const b=f.assert,m=f.logWithBase,S=1e4,M=10;e.Model=function(e){function o(){var o;return(o=e.call(this)||this).dirtySet=new _({model:t._assertThisInitialized(o)}),o._id2origin=new Map,o._content=new Map,o}t._inheritsLoose(o,e);var n=o.prototype;return n.getObject=function(e){return this._content.get(e)},n.add=function(e){const t=e.id;b(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),p.isWebGLLayer(e)&&this.dirtySet.layerAdded(e)},n.remove=function(e){b(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),p.isWebGLLayer(e)&&this.dirtySet.layerRemoved(e)},n.addMany=function(e){for(const t of e)b(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t)},n.removeMany=function(e){for(const t of e)b(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()},n.forEachOfType=function(e,t){this._content.forEach((o=>{o.type===e&&t(o)}))},n._getOrigin=function(e){let t=0;const o=e[3]*M/S;o>1&&(t=Math.ceil(m(o,2)));const n=2**t*S,r=Math.round(e[0]/n),i=Math.round(e[1]/n),s=Math.round(e[2]/n),a=t+"_"+r+"_"+i+"_"+s;let c=this._id2origin.get(a);return null==c&&(c=g.fromValues(r*n,i*n,s*n,a),this._id2origin.set(a,c)),c},n.getRenderGeometry=function(e,t){const o=t.geometry,n=e.getCombinedStaticTransformation(t),r=h.maxScale(n),i=t.origin,s=new y.RenderGeometry(o,t.material,null,null,o.boundingInfo,n,t.shaderTransformation,r,e.castShadow);return s.id=t.id,s.origin=i||this._getOrigin(s.boundingSphere),s.instanceParameters=t.instanceParameters,s},n.updateRenderGeometryTransformation=function(e,t,o){const n=e.getCombinedStaticTransformation(t,o.transformation);o.updateTransformation(n);const r=this._getOrigin(o.boundingSphere);return o.origin!==r},n.getStats=function(){const e={},t=Array.from(this._content.values());for(let o=0;o<5;++o)e[o]=t.filter((e=>e.type===o)).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}},t._createClass(o,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]),o}(u),o.__decorate([s.property({constructOnly:!0})],e.Model.prototype,"dirtySet",void 0),e.Model=o.__decorate([a.subclass("esri.views.3d.webgl-engine.parts.Model")],e.Model),Object.defineProperty(e,"__esModule",{value:!0})}));
