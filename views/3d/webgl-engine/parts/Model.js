/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../support/mathUtils","../lib/Util","../lib/localOrigin","../lib/RenderGeometry","../lib/ModelDirtySet"],(function(t,e,n,i,o,r){"use strict";const s=n.assert,a=n.logWithBase;let d=function(){function t(){this.dirtySet=new r(this),this._id2origin={},this._content=new Array(5);for(let t=0;t<5;++t)this._content[t]=new Map}var n=t.prototype;return n.getAll=function(t){const e=this._content[t];return s(void 0!==e),e},n.get=function(t,e){return this.getAll(t).get(e)},n.add=function(t,e){const n=this._content[t];s(void 0!==n);const i=e.id;s(!n.has(i),"Model/Stage already contains object to be added"),n.set(i,e),0===t&&this.notifyDirty(e,"layerAdded")},n.remove=function(t,e){const n=this._content[t];s(void 0!==n);const i=n.get(e);return s(void 0!==i,"Model/Stage doesn't contain object to be removed"),n.delete(e),4===t&&i.unload(),0===t&&this.notifyDirty(i,"layerRemoved"),i},n.getDirtySet=function(){return this.dirtySet},n.notifyDirty=function(t,e,n){this.dirtySet.handleUpdate(t,e,n)},n.getOrigin=function(t,e,n=10){let o=0;const r=e*n/1e4;r>1&&(o=Math.ceil(a(r,2)));const s=1e4*Math.pow(2,o),d=Math.round(t[0]/s),c=Math.round(t[1]/s),l=Math.round(t[2]/s),u=o+"_"+d+"_"+c+"_"+l;let g=this._id2origin[u];return null==g&&(g=i.fromValues(d*s,c*s,l*s,u),this._id2origin[u]=g),g},n.getGeometryRenderGeometries=function(t,n,i){const r=n.geometry,s=t.getCombinedStaticTransformation(n),a=e.maxScale(s),d=n.origin,c=new o(r.data,r.boundingInfo,n.material,s,n.shaderTransformation,a,t.castShadow);c.uniqueName=n.id,c.origin=d||this.getOrigin(c.center,c.bsRadius),c.instanceParameters=n.instanceParameters,i.push(c)},n.updateRenderGeometryTransformation=function(t,e,n){const i=t.getCombinedStaticTransformation(e,n.transformation);n.updateTransformation(i);const o=this.getOrigin(n.center,n.bsRadius);return n.origin!==o},n.getStats=function(){const t={};for(let e=0;e<5;++e)t[e]=this.getAll(e).size;return{contentTypes:t,dirtySet:this.dirtySet.formatDebugInfo()}},n.validateObject=function(t){const e=t.geometryRecords;for(let t=0;t<e.length;++t){const n=e[t];s(null!=this.get(2,n.geometry.id)),s(null!=this.get(3,n.material.id))}},n.validateLayer=function(t){const e=t.getObjects();for(let t=0;t<e.length;++t){const n=this.get(1,e[t].id);s(null!=n)}},t}();t.Model=d,Object.defineProperty(t,"__esModule",{value:!0})}));
