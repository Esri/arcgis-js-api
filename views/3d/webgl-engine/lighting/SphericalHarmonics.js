/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../core/mathUtils","../../../../chunks/vec3f64","../../../../chunks/vec3","./Lightsources","../lib/LongVectorMath"],(function(n,t,i,e,s,c){"use strict";function o(n){return(n+1)*(n+1)}function r(n){return t.clamp(Math.floor(Math.sqrt(n)-1),0,2)}function a(n,t,i){const e=n[0],s=n[1],c=n[2],r=i||[];return r.length=o(t),t>=0&&(r[0]=.28209479177),t>=1&&(r[1]=.4886025119*e,r[2]=.4886025119*c,r[3]=.4886025119*s),t>=2&&(r[4]=1.09254843059*e*s,r[5]=1.09254843059*s*c,r[6]=.31539156525*(3*c*c-1),r[7]=1.09254843059*e*c,r[8]=.54627421529*(e*e-s*s)),r}function h(n,t){const i=o(n),e=t||{r:[],g:[],b:[]};e.r.length=e.g.length=e.b.length=i;for(let n=0;n<i;n++)e.r[n]=e.g[n]=e.b[n]=0;return e}function f(n,t){const i=r(t.r.length);for(const s of n)e.negate(b,s.direction),a(b,i,m),c.elementwiseProduct(m,y),c.scalarProduct(m,s.intensity[0],p),c.add(t.r,p),c.scalarProduct(m,s.intensity[1],p),c.add(t.g,p),c.scalarProduct(m,s.intensity[2],p),c.add(t.b,p);return t}function u(n,t){a(b,0,m);for(const i of n)t.r[0]+=m[0]*y[0]*i.intensity[0]*4*Math.PI,t.g[0]+=m[0]*y[0]*i.intensity[1]*4*Math.PI,t.b[0]+=m[0]*y[0]*i.intensity[2]*4*Math.PI;return t}const l=[],d=[],g=[],m=[0],p=[0],b=i.create(),y=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];n.combineLights=function(n,t,i){h(t,i.sphericalHarmonics.sh),e.set(i.main.intensity,0,0,0);let o=!1;const r=l,a=d,m=g;r.length=0,a.length=0,m.length=0;for(const t of n)t instanceof s.MainLight&&!o?(e.copy(i.main.direction,t.direction),i.main.intensity[0]=t.intensity[0],i.main.intensity[1]=t.intensity[1],i.main.intensity[2]=t.intensity[2],i.main.castShadows=t.castShadows,o=!0):t instanceof s.MainLight||t instanceof s.FillLight?r.push(t):t instanceof s.AmbientLight?a.push(t):t instanceof s.SphericalHarmonicsLight&&m.push(t);f(r,i.sphericalHarmonics.sh),u(a,i.sphericalHarmonics.sh);for(const n of m)c.add(i.sphericalHarmonics.sh.r,n.sh.r),c.add(i.sphericalHarmonics.sh.g,n.sh.g),c.add(i.sphericalHarmonics.sh.b,n.sh.b)},n.computeCoefficients=a,n.initSHCoefficients=h,n.numberOfCoefficients=o,n.numberOfCoefficientsInBand=function(n){return 2*n+1},n.orderFromNumberOfCoefficients=r,n.projectAmbientLights=u,n.projectFillLights=f,Object.defineProperty(n,"__esModule",{value:!0})}));
