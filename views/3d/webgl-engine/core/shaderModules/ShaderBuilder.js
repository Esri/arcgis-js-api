/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Logger"],(function(e,t,n){"use strict";const r=n.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let i=function(){function e(){this.includedModules=new Map}return e.prototype.include=function(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&r.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))},e}(),o=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).vertex=new a,t.fragment=new a,t.attributes=new c,t.varyings=new h,t.extensions=new d,t.constants=new l,t}return t._inheritsLoose(n,e),n.prototype.generateSource=function(e){const t=this.extensions.generateSource(e),n=this.attributes.generateSource(e),r=this.varyings.generateSource(),i="vertex"===e?this.vertex:this.fragment,o=i.uniforms.generateSource(),s=i.code.generateSource(),u="vertex"===e?f:S,a=this.constants.generateSource().concat(i.constants.generateSource());return`\n${t.join("\n")}\n\n${u}\n\n${a.join("\n")}\n\n${o.join("\n")}\n\n${n.join("\n")}\n\n${r.join("\n")}\n\n${s.join("\n")}`},t._createClass(n,[{key:"builder",get:function(){return this}}]),n}(i),s=function(){function e(){this._entries=new Array,this._set=new Set}var t=e.prototype;return t.add=function(e,t,n){const r=`${e}_${t}_${n}`;return this._set.has(r)||(this._entries.push([e,t,n]),this._set.add(r)),this},t.generateSource=function(){const e=e=>e?`[${e}]`:"";return this._entries.map((t=>`uniform ${t[1]} ${t[0]}${e(t[2])};`))},e}(),u=function(){function e(){this._entries=new Array}var t=e.prototype;return t.add=function(e){this._entries.push(e)},t.generateSource=function(){return this._entries},e}(),a=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).uniforms=new s,t.code=new u,t.constants=new l,t}return t._inheritsLoose(n,e),t._createClass(n,[{key:"builder",get:function(){return this}}]),n}(i),c=function(){function e(){this._entries=new Array}var t=e.prototype;return t.add=function(e,t){this._entries.push([e,t])},t.generateSource=function(e){return"fragment"===e?[]:this._entries.map((e=>`attribute ${e[1]} ${e[0]};`))},e}(),h=function(){function e(){this._entries=new Array}var t=e.prototype;return t.add=function(e,t){this._entries.push([e,t])},t.generateSource=function(){return this._entries.map((e=>`varying ${e[1]} ${e[0]};`))},e}(),d=function(){function e(){this._entries=new Set}var t=e.prototype;return t.add=function(e){this._entries.add(e)},t.generateSource=function(t){const n="vertex"===t?e.ALLOWLIST_VERTEX:e.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>n.includes(e))).map((e=>`#extension ${e} : enable`))},e}();d.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],d.ALLOWLIST_VERTEX=[];let l=function(){function e(){this._entries=[]}var t=e.prototype;return t.add=function(t,n,r){let i="ERROR_CONSTRUCTOR_STRING";switch(n){case"float":i=e.numberToFloatStr(r);break;case"int":i=e.numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${e.numberToFloatStr(r[0])},                            ${e.numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${e.numberToFloatStr(r[0])},                            ${e.numberToFloatStr(r[1])},                            ${e.numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${e.numberToFloatStr(r[0])},                            ${e.numberToFloatStr(r[1])},                            ${e.numberToFloatStr(r[2])},                            ${e.numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${e.numberToIntStr(r[0])},                             ${e.numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${e.numberToIntStr(r[0])},                             ${e.numberToIntStr(r[1])},                             ${e.numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${e.numberToIntStr(r[0])},                             ${e.numberToIntStr(r[1])},                             ${e.numberToIntStr(r[2])},                             ${e.numberToIntStr(r[3])})`;break;case"bvec2":i=`bvec2(${r[0].toString()},                             ${r[1].toString()})`;break;case"bvec3":i=`bvec3(${r[0].toString()},                             ${r[1].toString()},                             ${r[2].toString()})`;break;case"bvec4":i=`bvec4(${r[0].toString()},                             ${r[1].toString()},                             ${r[2].toString()},                             ${r[3].toString()})`;break;case"mat2":case"mat3":case"mat4":i=`${n}(${Array.prototype.map.call(r,(t=>e.numberToFloatStr(t))).join(", ")})`}return this._entries.push(`const ${n} ${t} = ${i};`),this},e.numberToIntStr=function(e){return e.toFixed(0)},e.numberToFloatStr=function(e){return Number.isInteger(e)?e.toFixed(1):e.toString()},t.generateSource=function(){return Array.from(this._entries)},e}();const S="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",f="precision highp float;\nprecision highp sampler2D;";e.Code=u,e.Includes=i,e.ShaderBuilder=o,e.Stage=a,Object.defineProperty(e,"__esModule",{value:!0})}));
