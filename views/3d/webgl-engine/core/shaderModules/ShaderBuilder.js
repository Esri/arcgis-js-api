/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Logger"],(function(e,t,n){"use strict";const r=n.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let i=function(){function e(){this.includedModules=new Map}return e.prototype.include=function(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&r.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))},e}(),o=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).vertex=new a,t.fragment=new a,t.attributes=new c,t.varyings=new l,t.extensions=new _,t.constants=new f,t}return t._inheritsLoose(n,e),n.prototype.generateSource=function(e){const t=this.extensions.generateSource(e),n=this.attributes.generateSource(e),r=this.varyings.generateSource(),i="vertex"===e?this.vertex:this.fragment,o=i.uniforms.generateSource(),s=i.code.generateSource(),u="vertex"===e?d:h,a=this.constants.generateSource().concat(i.constants.generateSource());return`\n${t.join("\n")}\n\n${u}\n\n${a.join("\n")}\n\n${o.join("\n")}\n\n${n.join("\n")}\n\n${r.join("\n")}\n\n${s.join("\n")}`},t._createClass(n,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms}},{key:"builder",get:function(){return this}}]),n}(i),s=function(){function e(){this._entries=new Map}var n=e.prototype;return n.add=function(e,t,n){const r=`${e}_${t}_${n}`;return this._entries.set(r,{name:e,type:t,arraySize:n}),this},n.generateSource=function(){const e=e=>e?`[${e}]`:"";return Array.from(this._entries.values()).map((t=>`uniform ${t.type} ${t.name}${e(t.arraySize)};`))},t._createClass(e,[{key:"entries",get:function(){return Array.from(this._entries.values())}}]),e}(),u=function(){function e(){this._entries=new Array}var t=e.prototype;return t.add=function(e){this._entries.push(e)},t.generateSource=function(){return this._entries},e}(),a=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).uniforms=new s,t.code=new u,t.constants=new f,t}return t._inheritsLoose(n,e),t._createClass(n,[{key:"builder",get:function(){return this}}]),n}(i),c=function(){function e(){this._entries=new Array}var t=e.prototype;return t.add=function(e,t){this._entries.push([e,t])},t.generateSource=function(e){return"fragment"===e?[]:this._entries.map((e=>`attribute ${e[1]} ${e[0]};`))},e}(),l=function(){function e(){this._entries=new Array}var t=e.prototype;return t.add=function(e,t){this._entries.push([e,t])},t.generateSource=function(){return this._entries.map((e=>`varying ${e[1]} ${e[0]};`))},e}(),_=function(){function e(){this._entries=new Set}var t=e.prototype;return t.add=function(e){this._entries.add(e)},t.generateSource=function(t){const n="vertex"===t?e.ALLOWLIST_VERTEX:e.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>n.includes(e))).map((e=>`#extension ${e} : enable`))},e}();_.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],_.ALLOWLIST_VERTEX=[];let f=function(){function e(){this._entries=[]}var t=e.prototype;return t.add=function(t,n,r){let i="ERROR_CONSTRUCTOR_STRING";switch(n){case"float":i=e._numberToFloatStr(r);break;case"int":i=e._numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${e._numberToFloatStr(r[0])},                            ${e._numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${e._numberToFloatStr(r[0])},                            ${e._numberToFloatStr(r[1])},                            ${e._numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${e._numberToFloatStr(r[0])},                            ${e._numberToFloatStr(r[1])},                            ${e._numberToFloatStr(r[2])},                            ${e._numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${e._numberToIntStr(r[0])},                             ${e._numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${e._numberToIntStr(r[0])},                             ${e._numberToIntStr(r[1])},                             ${e._numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${e._numberToIntStr(r[0])},                             ${e._numberToIntStr(r[1])},                             ${e._numberToIntStr(r[2])},                             ${e._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${n}(${Array.prototype.map.call(r,(t=>e._numberToFloatStr(t))).join(", ")})`}return this._entries.push(`const ${n} ${t} = ${i};`),this},e._numberToIntStr=function(e){return e.toFixed(0)},e._numberToFloatStr=function(e){return Number.isInteger(e)?e.toFixed(1):e.toString()},t.generateSource=function(){return Array.from(this._entries)},e}();const h="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",d="precision highp float;\nprecision highp sampler2D;";e.Code=u,e.Includes=i,e.ShaderBuilder=o,e.Stage=a,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
