/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/PooledArray","../../lib/basicInterfaces","../../../../webgl/enums"],(function(e,t,s,r,a,n){"use strict";var i;e.RenderPassSorting=void 0,(i=e.RenderPassSorting||(e.RenderPassSorting={}))[i.FrontToBack=0]="FrontToBack",i[i.BackToFront=1]="BackToFront";let o=function(){function n(t,s,a=e.RenderPassSorting.FrontToBack){this._rctx=t,this._techniqueRepository=s,this._sorting=a,this._draws=new r({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._passBoundTechniques=new Set,this._previouslyBoundMaterials=new Map,this._previouslyBoundDraw=new Map}var i=n.prototype;return i.submitDraw=function(e,t,r,a,n){const i=this._draws.pushNew();i.geometry=t,i.geometryRanges=r,i.material=e,i.bindDrawParams=a,i.depthSquaredHint=n,i.indexType=t.indexed?s.unwrap(t.vao.indexBuffer).indexType:0},i.dispatch=function(e){const t=this._rctx;this._passBoundTechniques.clear(),this._previouslyBoundMaterials.clear(),this._previouslyBoundDraw.clear();let s=null;const r=this._draws.map((t=>t.material.prepareTechnique(this._techniqueRepository,e,t.geometry.parameters))),n=this._draws.length;for(let i=0;i<n;i++){const n=r[i];n===s&&n.configuration.transparencyPassType===a.TransparencyPassType.NONE||(t.useTechnique(n,e.slot),s=n),this._passBoundTechniques.has(n)||(n.bindPass(e),this._passBoundTechniques.add(n));const o=this._draws.data[i],d=o.geometry;t.bindVAO(d.vao),this._previouslyBoundMaterials.get(n)!==o.material&&(n.bindMaterial(o.material,e),this._previouslyBoundMaterials.set(n,o.material)),this._previouslyBoundDraw.get(n)!==o.bindDrawParams&&(n.bindDraw(o.bindDrawParams),this._previouslyBoundDraw.set(n,o.bindDrawParams));const l=o.geometryRanges,c=l.length;if(0!==o.indexType){const e=u.get(o.indexType);for(let s=0;s<c;s+=2){const r=l[s],a=l[s+1];t.drawElements(d.primitiveType,a,o.indexType,r*e)}}else for(let e=0;e<c;e+=2){const s=l[e],r=l[e+1];t.drawArrays(d.primitiveType,s,r)}}},i.prepareSubmit=function(){this._draws.clear()},i.finishSubmit=function(){const t=this._sorting===e.RenderPassSorting.FrontToBack?1:-1;this._draws.sort(((e,s)=>{const r=t*(e.depthSquaredHint-s.depthSquaredHint);return 0!==r?r:e.geometry.vao.size-s.geometry.vao.size}))},t._createClass(n,[{key:"count",get:function(){return this._draws.length}}]),n}();const u=new Map;u.set(n.DataType.UNSIGNED_BYTE,1),u.set(n.DataType.UNSIGNED_SHORT,2),u.set(n.DataType.UNSIGNED_INT,4),e.RenderPass=o,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
