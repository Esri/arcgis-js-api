/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/PooledArray"],(function(e,t,i){"use strict";let s=function(){function e(e,t,s=0){this._rctx=e,this._techniqueRepository=t,this._sorting=s,this._draws=new i({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._passBoundTechniques=new Set,this._previouslyBoundMaterials=new Map,this._previouslyBoundDraw=new Map}var s=e.prototype;return s.submitDraw=function(e,t,i,s,r){const a=this._draws.pushNew();a.geometry=t,a.geometryRanges=i,a.material=e,a.bindDrawParams=s,a.depthSquaredHint=r,a.indexType=t.indexed?t.vao.indexBuffer.indexType:0},s.dispatch=function(e){const t=this._rctx;this._passBoundTechniques.clear(),this._previouslyBoundMaterials.clear(),this._previouslyBoundDraw.clear();let i=null;const s={repository:this._techniqueRepository},a=this._draws.length;for(let n=0;n<a;n++){const a=this._draws.data[n],o=a.geometry,l=a.material.getTechnique(s,e,o.parameters);if(this._passBoundTechniques.has(l)||(l.bindPass(t,e),this._passBoundTechniques.add(l)),t.bindVAO(o.vao),l===i&&3===l.configuration.transparencyPassType||(t.bindProgram(l.program),t.setPipelineState(l.pipeline),i=l),this._previouslyBoundMaterials.get(l)!==a.material&&(l.bindMaterial(t,a.material,e),this._previouslyBoundMaterials.set(l,a.material)),this._previouslyBoundDraw.get(l)!==a.bindDrawParams&&(l.bindDraw(a.bindDrawParams,a.material,e),this._previouslyBoundMaterials.set(l,a.material)),0!==a.indexType){const e=r.get(a.indexType);for(let i=0;i<a.geometryRanges.length;i+=2){const s=a.geometryRanges[i],r=a.geometryRanges[i+1];t.drawElements(o.primitiveType,r,a.indexType,s*e)}}else for(let e=0;e<a.geometryRanges.length;e+=2){const i=a.geometryRanges[e],s=a.geometryRanges[e+1];t.drawArrays(o.primitiveType,i,s)}}},s.prepareSubmit=function(){this._draws.clear()},s.finishSubmit=function(){const e=0===this._sorting?1:-1;this._draws.sort(((t,i)=>{const s=e*(t.depthSquaredHint-i.depthSquaredHint);return 0!==s?s:t.geometry.vao.size-i.geometry.vao.size}))},t._createClass(e,[{key:"count",get:function(){return this._draws.length}}]),e}();const r=new Map;r.set(5121,1),r.set(5123,2),r.set(5125,4),e.RenderPass=s,Object.defineProperty(e,"__esModule",{value:!0})}));
