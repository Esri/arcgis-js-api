/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/PooledArray","../../lib/TransparencyPassType","../../../../webgl/enums"],(function(e,t,r,n,a,s){"use strict";var i;e.RenderPassSorting=void 0,(i=e.RenderPassSorting||(e.RenderPassSorting={}))[i.FrontToBack=0]="FrontToBack",i[i.BackToFront=1]="BackToFront";let o=function(){function s(t,r,a=e.RenderPassSorting.FrontToBack){this._rctx=t,this._techniqueRepository=r,this._sorting=a,this._draws=new n({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}var i=s.prototype;return i.submitDraw=function(e,t,n,a){const s=this._draws.pushNew();s.geometry=t,s.geometryRanges=n,s.material=e,s.depthSquaredHint=a,s.indexType=(t.indexed?r.unwrap(t.vao.indexBuffer).indexType:null)??0},i.dispatch=function(e,t){const r=this._rctx;this._previouslyBoundDraw.clear();let n=null;const s=this._draws.map((r=>r.material.prepareTechnique(this._techniqueRepository,e,t,r.geometry.parameters))),i=this._draws.length;for(let o=0;o<i;o++){const i=s[o];i===n&&i.configuration.transparencyPassType===a.TransparencyPassType.NONE||(r.bindTechnique(i,e,t),n=i);const d=this._draws.data[o],u=d.geometry;r.bindVAO(u.vao),this._previouslyBoundDraw.get(i)!==d.material&&(i.program.bindDraw(d.material,t,e),this._previouslyBoundDraw.set(i,d.material));const c=d.geometryRanges,p=c.length;if(0!==d.indexType){const e=l.get(d.indexType);for(let t=0;t<p;t+=2){const n=c[t],a=c[t+1];r.drawElements(u.primitiveType,a,d.indexType,n*e)}}else for(let e=0;e<p;e+=2){const t=c[e],n=c[e+1];r.drawArrays(u.primitiveType,t,n)}}},i.prepareSubmit=function(){this._draws.clear()},i.finishSubmit=function(){const t=this._sorting===e.RenderPassSorting.FrontToBack?1:-1;this._draws.sort(((e,r)=>{const n=t*(e.depthSquaredHint-r.depthSquaredHint);return 0!==n?n:e.geometry.vao.size-r.geometry.vao.size}))},t._createClass(s,[{key:"count",get:function(){return this._draws.length}}]),s}();const l=new Map;l.set(s.DataType.UNSIGNED_BYTE,1),l.set(s.DataType.UNSIGNED_SHORT,2),l.set(s.DataType.UNSIGNED_INT,4),e.RenderPass=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
