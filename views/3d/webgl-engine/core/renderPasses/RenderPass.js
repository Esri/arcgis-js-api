/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/PooledArray"],(function(e,t,s,i){"use strict";let r=function(){function e(e,t,s=0){this._rctx=e,this._techniqueRepository=t,this._sorting=s,this._draws=new i({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._passBoundTechniques=new Set,this._previouslyBoundMaterials=new Map,this._previouslyBoundDraw=new Map}var r=e.prototype;return r.submitDraw=function(e,t,i,r,n){const a=this._draws.pushNew();a.geometry=t,a.geometryRanges=i,a.material=e,a.bindDrawParams=r,a.depthSquaredHint=n,a.indexType=t.indexed?s.unwrap(t.vao.indexBuffer).indexType:0},r.dispatch=function(e){const t=this._rctx;this._passBoundTechniques.clear(),this._previouslyBoundMaterials.clear(),this._previouslyBoundDraw.clear();let s=null;const i=this._draws.length;for(let r=0;r<i;r++){const i=this._draws.data[r],a=i.geometry,o=i.material.getTechnique(this._techniqueRepository,e,a.parameters);o===s&&3===o.configuration.transparencyPassType||(t.useProgram(o.program),o.bindPipelineState(t,e.slot),s=o),this._passBoundTechniques.has(o)||(o.bindPass(e),this._passBoundTechniques.add(o)),t.bindVAO(a.vao),this._previouslyBoundMaterials.get(o)!==i.material&&(o.bindMaterial(i.material,e),this._previouslyBoundMaterials.set(o,i.material)),this._previouslyBoundDraw.get(o)!==i.bindDrawParams&&(o.bindDraw(i.bindDrawParams),this._previouslyBoundDraw.set(o,i.bindDrawParams));const u=i.geometryRanges,d=u.length;if(0!==i.indexType){const e=n.get(i.indexType);for(let s=0;s<d;s+=2){const r=u[s],n=u[s+1];t.drawElements(a.primitiveType,n,i.indexType,r*e)}}else for(let e=0;e<d;e+=2){const s=u[e],i=u[e+1];t.drawArrays(a.primitiveType,s,i)}}return i>0},r.prepareSubmit=function(){this._draws.clear()},r.finishSubmit=function(){const e=0===this._sorting?1:-1;this._draws.sort(((t,s)=>{const i=e*(t.depthSquaredHint-s.depthSquaredHint);return 0!==i?i:t.geometry.vao.size-s.geometry.vao.size}))},t._createClass(e,[{key:"count",get:function(){return this._draws.length}}]),e}();const n=new Map;n.set(5121,1),n.set(5123,2),n.set(5125,4),e.RenderPass=r,Object.defineProperty(e,"__esModule",{value:!0})}));
