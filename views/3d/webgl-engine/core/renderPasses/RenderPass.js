/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/PooledArray"],(function(e,t,i,s){"use strict";let r=function(){function e(e,t,i=0){this._rctx=e,this._techniqueRepository=t,this._sorting=i,this._draws=new s({initialSize:32,allocator:e=>e||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._passBoundTechniques=new Set,this._previouslyBoundMaterials=new Map,this._previouslyBoundDraw=new Map}var r=e.prototype;return r.submitDraw=function(e,t,s,r,a){const n=this._draws.pushNew();n.geometry=t,n.geometryRanges=s,n.material=e,n.bindDrawParams=r,n.depthSquaredHint=a,n.indexType=t.indexed?i.unwrap(t.vao.indexBuffer).indexType:0},r.dispatch=function(e){const t=this._rctx;this._passBoundTechniques.clear(),this._previouslyBoundMaterials.clear(),this._previouslyBoundDraw.clear();let i=null;const s=this._draws.length;for(let r=0;r<s;r++){const s=this._draws.data[r],n=s.geometry,o=s.material.getTechnique(this._techniqueRepository,e,n.parameters);o===i&&3===o.configuration.transparencyPassType||(t.useProgram(o.program),t.setPipelineState(o.pipeline),i=o),this._passBoundTechniques.has(o)||(o.bindPass(e),this._passBoundTechniques.add(o)),t.bindVAO(n.vao),this._previouslyBoundMaterials.get(o)!==s.material&&(o.bindMaterial(s.material,e),this._previouslyBoundMaterials.set(o,s.material)),this._previouslyBoundDraw.get(o)!==s.bindDrawParams&&(o.bindDraw(s.bindDrawParams,s.material,e),this._previouslyBoundDraw.set(o,s.bindDrawParams));const u=s.geometryRanges,l=u.length;if(0!==s.indexType){const e=a.get(s.indexType);for(let i=0;i<l;i+=2){const r=u[i],a=u[i+1];t.drawElements(n.primitiveType,a,s.indexType,r*e)}}else for(let e=0;e<l;e+=2){const i=u[e],s=u[e+1];t.drawArrays(n.primitiveType,i,s)}}return s>0},r.prepareSubmit=function(){this._draws.clear()},r.finishSubmit=function(){const e=0===this._sorting?1:-1;this._draws.sort(((t,i)=>{const s=e*(t.depthSquaredHint-i.depthSquaredHint);return 0!==s?s:t.geometry.vao.size-i.geometry.vao.size}))},t._createClass(e,[{key:"count",get:function(){return this._draws.length}}]),e}();const a=new Map;a.set(5121,1),a.set(5123,2),a.set(5125,4),e.RenderPass=r,Object.defineProperty(e,"__esModule",{value:!0})}));
