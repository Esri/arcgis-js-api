/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/promiseUtils"],(function(e,t,n,r){"use strict";let o=function(e){this.technique=e,this.refCount=0,this.refZeroFrame=0},s=function(){function e(e){this._context=e,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=1200}var s=e.prototype;return s.dispose=function(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.dispose())))),this._perConstructorInstances.clear()},s.acquire=function(e,t){const n=t.key;let r=this._perConstructorInstances.get(e);r||(r=new Map,this._perConstructorInstances.set(e,r));let s=r.get(n);return void 0===s&&(s=new o(new e(this._context,t)),r.set(n,s)),++s.refCount,s.technique},s.acquireAndReleaseExisting=function(e,t,r){return n.isNone(r)?this.acquire(e,t):t.key===r.key&&r instanceof e?r:(this.release(r),this.acquire(e,t))},s.release=function(e){const t=this._perConstructorInstances.get(e.constructor).get(e.key);t.refCount-=1,0===t.refCount&&(t.refZeroFrame=this._frameCounter)},s.frameUpdate=function(){this._frameCounter++,this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((t,n)=>{0===t.refCount&&t.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(t.technique.dispose(),e.delete(n))})),0===e.size&&this._perConstructorInstances.delete(t)}))},s.getProgramsUsingUniform=function(e){return this._context.commonUniformStore.getPrograms(e)},s.hotReload=async function(){const e=new Array;this._perConstructorInstances.forEach(((t,n)=>{e.push((async(e,t)=>{const n=t.shader;n&&(await n.reload(),e.forEach((e=>{e.technique.reload(this._context)})))})(t,n))})),await r.all(e)},t._createClass(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]),e}();e.ShaderTechniqueRepository=s,Object.defineProperty(e,"__esModule",{value:!0})}));
