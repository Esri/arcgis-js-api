/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PerformanceSampler","../../../../core/time","../../../../core/accessorSupport/utils","../../../webgl/TimerPool"],(function(e,t,i,r,o,a,s){"use strict";var n;e.PerformanceCategory=void 0,(n=e.PerformanceCategory||(e.PerformanceCategory={})).OVERLAY="overlay",n.PREPARE="prepare",n.SHADOW_MAP="shadow map",n.LINEAR_DEPTH="linear depth",n.ACCUMULATED_SHADOWS="accumulated shadows",n.NORMALS="normals",n.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",n.SSAO="SSAO",n.OPAQUE="opaque",n.OPAQUE_EDGES="opaque edges",n.VOXEL="voxel",n.TRANSPARENT="transparent",n.TRANSPARENT_EDGES="transparent edges",n.HUD_VISIBILITY="HUD visibility",n.TRANSPARENT_TERRAIN="transparent terrain",n.ENVIRONMENT="environment",n.LASER_LINE="laser line",n.OCCLUDED="occluded",n.ANTIALIASING="antialiasing",n.HIGHLIGHTS="highlights",n.HUD="HUD",n.HUD_OCCLUDED="HUD occluded",n.FINISH="finish";const m="Total";let l=function(){function n(t){this._rctx=t,this._startTimeStampCPU=o.Milliseconds(0),this._lastTimeStampCPU=o.Milliseconds(0),this._totalCPUTime=new r(m),this._cpuTimeSamplers=new Map(Object.values(e.PerformanceCategory).map((e=>[e,new r(e)]))),this._enableGPUTimer=0,this._totalGPUTime=new r("GPU"),this._gpuTimeSamplers=new Map(Object.values(e.PerformanceCategory).map((e=>[e,new r(e)]))),this._totalTime=o.Milliseconds(0),this._totalFrameCount=0}var l=n.prototype;return l.enableGPUPerformanceInfo=function(){if(i.isNone(this._gpuTimerPool)){const t=[...Object.values(e.PerformanceCategory),m];this._gpuTimerPool=s.createElapsedTimerPool(this._rctx,t)}return i.isNone(this._gpuTimerPool)?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:a.once((()=>{--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=i.disposeMaybe(this._gpuTimerPool))}))})},l.startFrame=function(){this._startTimeStampCPU=this._lastTimeStampCPU=o.Milliseconds(performance.now()),i.isSome(this._gpuTimerPool)&&this._gpuTimerPool.start()},l.advance=function(e){const t=o.Milliseconds(performance.now());if(this._cpuTimeSamplers.get(e).record(t-this._lastTimeStampCPU),this._lastTimeStampCPU=t,i.isSome(this._gpuTimerPool)){const t=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(t),this._gpuTimerPool.start()}},l.finishFrame=function(){if(i.isSome(this._gpuTimerPool)){const t=this._gpuTimerPool.stop(e.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(e.PerformanceCategory.FINISH).record(t)}const t=o.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=o.Milliseconds(this._totalTime+t),this._totalCPUTime.record(t),i.isSome(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce(((e,t)=>e+(t.last||0)),0)),++this._totalFrameCount},t._createClass(n,[{key:"totalCPUTimeSampler",get:function(){return this._totalCPUTime}},{key:"cpuTimeSamplers",get:function(){return Array.from(this._cpuTimeSamplers.values())}},{key:"totalGPUTimeSampler",get:function(){return this._totalGPUTime}},{key:"gpuTimeSamplers",get:function(){return Array.from(this._gpuTimeSamplers.values())}},{key:"gpuSamplingEnabled",get:function(){return i.isSome(this._gpuTimerPool)}},{key:"totalTime",get:function(){return this._totalTime}},{key:"totalFrameCount",get:function(){return this._totalFrameCount}},{key:"elapsedTime",get:function(){return o.Milliseconds(performance.now()-this._startTimeStampCPU)}}]),n}();e.RendererPerformanceInfo=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
