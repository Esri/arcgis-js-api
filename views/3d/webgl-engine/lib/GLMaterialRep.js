/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../../core/Logger","../../../../core/maybe","../core/shaderLibrary/ShaderOutputOptions","./Util"],(function(t,e,i,r){"use strict";const a=t.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep");let n=function(){function t(t){this.refCnt=0,this.glMaterial=t}var e=t.prototype;return e.incRefCnt=function(){++this.refCnt},e.decRefCnt=function(){--this.refCnt,r.assert(this.refCnt>=0)},e.getRefCnt=function(){return this.refCnt},e.getGLMaterial=function(){return this.glMaterial},t}();return function(){function t(t,e,i){this._textureRep=t,this._techniqueRep=e,this.onMaterialChanged=i,this._id2glMaterialRef=new Map}var r=t.prototype;return r.dispose=function(){this._textureRep.dispose()},r.acquire=function(t,e){this.ownMaterial(t);const r=i.getShaderOutputID(t.id,e);let a=this._id2glMaterialRef.get(r);if(null==a){const i=t.getGLMaterial({material:t,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:e});return a=new n(i),a.incRefCnt(),this._id2glMaterialRef.set(r,a),i}return a.incRefCnt(),a.getGLMaterial()},r.release=function(t,e){const r=i.getShaderOutputID(t.id,e),a=this._id2glMaterialRef.get(r);if(a.decRefCnt(),0===a.getRefCnt()){const t=a.getGLMaterial();t&&t.dispose(),this._id2glMaterialRef.delete(r)}},r.materialChanged=function(t){for(const e of i.ShaderOutputTypes)if(5!==e.output&&6!==e.output){const r=this._id2glMaterialRef.get(i.getShaderOutputID(t.id,e.output));if(r&&r.getGLMaterial()){const t=r.getGLMaterial();t.updateParameters&&t.updateParameters()}}this.onMaterialChanged&&this.onMaterialChanged(t)},r.ownMaterial=function(t){e.isSome(t.materialRepository)&&t.materialRepository!==this&&a.error("Material is already owned by a different material repository"),t.materialRepository=this},t}()}));
