/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../chunks/vec3","../../../../../chunks/vec3f64"],(function(e,t,n,o,c){"use strict";const r=-1;var a;function s(e,c,a,s=h){const p=e.vertices.position,v=e.vertices.componentIndex,m=n.deg2rad(s.anglePlanar),y=n.deg2rad(s.angleSignificantEdge),A=Math.cos(y),w=Math.cos(m),E=u.edge,I=E.position0,S=E.position1,V=E.faceNormal0,x=E.faceNormal1,N=d(e),T=f(e),b=T.length/4,D=c.allocate(b);let F=0;const C=b,L=a.allocate(C);let M=0,O=0,P=0;const k=t.range(0,b),H=new Float32Array(b);H.forEach(((e,t,n)=>{p.getVec(T[4*t+0],I),p.getVec(T[4*t+1],S),n[t]=o.distance(I,S)})),k.sort(((e,t)=>H[t]-H[e]));const K=new Array,U=new Array;for(let t=0;t<b;t++){const e=k[t],n=H[e],s=T[4*e+0],f=T[4*e+1],d=T[4*e+2],u=T[4*e+3],h=u===r;if(p.getVec(s,I),p.getVec(f,S),h)o.set(V,N[3*d+0],N[3*d+1],N[3*d+2]),o.copy(x,V),E.componentIndex=v.get(s),E.cosAngle=o.dot(V,x);else{if(o.set(V,N[3*d+0],N[3*d+1],N[3*d+2]),o.set(x,N[3*u+0],N[3*u+1],N[3*u+2]),E.componentIndex=v.get(s),E.cosAngle=o.dot(V,x),l(E,w))continue;E.cosAngle<-.9999&&o.copy(x,V)}O+=n,P++,h||i(E,A)?(c.write(D,F++,E),K.push(n)):g(E,m)&&(a.write(L,M++,E),U.push(n))}const j=new Float32Array(K.reverse()),z=new Float32Array(U.reverse());return{regular:{instancesData:c.trim(D,F),lodInfo:{lengths:j}},silhouette:{instancesData:a.trim(L,M),lodInfo:{lengths:z}},averageEdgeLength:O/P}}function i(e,t){return e.cosAngle<t}function l(e,t){return e.cosAngle>t}function g(e,t){const c=n.acosClamped(e.cosAngle),r=u.fwd,a=u.ortho;o.direction(r,e.position1,e.position0);return c*(o.dot(o.cross(a,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function f(e){const t=e.faces.length/3,n=e.faces,o=e.neighbors;let c=0;for(let i=0;i<t;i++){const e=o[3*i+0],t=o[3*i+1],a=o[3*i+2],s=n[3*i+0],l=n[3*i+1],g=n[3*i+2];c+=e===r||s<l?1:0,c+=t===r||l<g?1:0,c+=a===r||g<s?1:0}const a=new Int32Array(4*c);let s=0;for(let i=0;i<t;i++){const e=o[3*i+0],t=o[3*i+1],c=o[3*i+2],l=n[3*i+0],g=n[3*i+1],f=n[3*i+2];(e===r||l<g)&&(a[s++]=l,a[s++]=g,a[s++]=i,a[s++]=e),(t===r||g<f)&&(a[s++]=g,a[s++]=f,a[s++]=i,a[s++]=t),(c===r||f<l)&&(a[s++]=f,a[s++]=l,a[s++]=i,a[s++]=c)}return a}function d(e){const t=e.faces.length/3,n=e.vertices.position,c=e.faces,r=p.v0,a=p.v1,s=p.v2,i=new Float32Array(3*t);for(let l=0;l<t;l++){const e=c[3*l+0],t=c[3*l+1],g=c[3*l+2];n.getVec(e,r),n.getVec(t,a),n.getVec(g,s),o.subtract(a,a,r),o.subtract(s,s,r),o.cross(r,a,s),o.normalize(r,r),i[3*l+0]=r[0],i[3*l+1]=r[1],i[3*l+2]=r[2]}return i}e.EdgeType=void 0,(a=e.EdgeType||(e.EdgeType={}))[a.SOLID=0]="SOLID",a[a.SKETCH=1]="SKETCH";const u={edge:{position0:c.create(),position1:c.create(),faceNormal0:c.create(),faceNormal1:c.create(),componentIndex:0,cosAngle:0},ortho:c.create(),fwd:c.create()},p={v0:c.create(),v1:c.create(),v2:c.create()},h={anglePlanar:4,angleSignificantEdge:35};e.extractEdges=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
