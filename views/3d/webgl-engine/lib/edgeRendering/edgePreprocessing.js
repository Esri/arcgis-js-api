/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../core/typedArrayUtil","../../../../../chunks/vec3","../../../../../chunks/vec3f64"],(function(e,t,n,o,c,r){"use strict";const a=-1;function s(e,r,s,p=h){const m=e.vertices.position,v=e.vertices.componentIndex,A=n.deg2rad(p.anglePlanar),y=n.deg2rad(p.angleSignificantEdge),w=Math.cos(y),I=Math.cos(A),V=u.edge,x=V.position0,N=V.position1,E=V.faceNormal0,b=V.faceNormal1,F=d(e),M=f(e),P=M.length/4,U=r.allocate(P);let k=0;const D=P,S=s.allocate(D);let _=0,j=0,z=0;const C=t.range(0,P),L=new Float32Array(P);o.forEach(L,((e,t,n)=>{m.getVec(M[4*t+0],x),m.getVec(M[4*t+1],N),n[t]=c.distance(x,N)})),C.sort(((e,t)=>L[t]-L[e]));const O=new Array,q=new Array;for(let t=0;t<P;t++){const e=C[t],n=L[e],o=M[4*e+0],f=M[4*e+1],d=M[4*e+2],u=M[4*e+3],p=u===a;if(m.getVec(o,x),m.getVec(f,N),p)c.set(E,F[3*d+0],F[3*d+1],F[3*d+2]),c.copy(b,E),V.componentIndex=v.get(o),V.cosAngle=c.dot(E,b);else{if(c.set(E,F[3*d+0],F[3*d+1],F[3*d+2]),c.set(b,F[3*u+0],F[3*u+1],F[3*u+2]),V.componentIndex=v.get(o),V.cosAngle=c.dot(E,b),l(V,I))continue;V.cosAngle<-.9999&&c.copy(b,E)}j+=n,z++,p||i(V,w)?(r.write(U,k++,V),O.push(n)):g(V,A)&&(s.write(S,_++,V),q.push(n))}const B=new Float32Array(O.reverse()),G=new Float32Array(q.reverse());return{regular:{instancesData:r.trim(U,k),lodInfo:{lengths:B}},silhouette:{instancesData:s.trim(S,_),lodInfo:{lengths:G}},averageEdgeLength:j/z}}function i(e,t){return e.cosAngle<t}function l(e,t){return e.cosAngle>t}function g(e,t){const o=n.acosClamped(e.cosAngle),r=u.fwd,a=u.ortho;c.direction(r,e.position1,e.position0);return o*(c.dot(c.cross(a,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function f(e){const t=e.faces.length/3,n=e.faces,o=e.neighbors;let c=0;for(let i=0;i<t;i++){const e=o[3*i+0],t=o[3*i+1],r=o[3*i+2],s=n[3*i+0],l=n[3*i+1],g=n[3*i+2];c+=e===a||s<l?1:0,c+=t===a||l<g?1:0,c+=r===a||g<s?1:0}const r=new Int32Array(4*c);let s=0;for(let i=0;i<t;i++){const e=o[3*i+0],t=o[3*i+1],c=o[3*i+2],l=n[3*i+0],g=n[3*i+1],f=n[3*i+2];(e===a||l<g)&&(r[s++]=l,r[s++]=g,r[s++]=i,r[s++]=e),(t===a||g<f)&&(r[s++]=g,r[s++]=f,r[s++]=i,r[s++]=t),(c===a||f<l)&&(r[s++]=f,r[s++]=l,r[s++]=i,r[s++]=c)}return r}function d(e){const t=e.faces.length/3,n=e.vertices.position,o=e.faces,r=p.v0,a=p.v1,s=p.v2,i=new Float32Array(3*t);for(let l=0;l<t;l++){const e=o[3*l+0],t=o[3*l+1],g=o[3*l+2];n.getVec(e,r),n.getVec(t,a),n.getVec(g,s),c.subtract(a,a,r),c.subtract(s,s,r),c.cross(r,a,s),c.normalize(r,r),i[3*l+0]=r[0],i[3*l+1]=r[1],i[3*l+2]=r[2]}return i}const u={edge:{position0:r.create(),position1:r.create(),faceNormal0:r.create(),faceNormal1:r.create(),componentIndex:0,cosAngle:0},ortho:r.create(),fwd:r.create()},p={v0:r.create(),v1:r.create(),v2:r.create()},h={anglePlanar:4,angleSignificantEdge:35};e.extractEdges=s,Object.defineProperty(e,"__esModule",{value:!0})}));
