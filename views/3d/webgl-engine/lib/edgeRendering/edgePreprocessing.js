/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/typedArrayUtil","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../chunks/vec3f64","../../../../../chunks/vec3","../../../support/mathUtils"],(function(e,t,n,o,c,r,a){"use strict";const s=-1;function i(e,c,a,i=m){const h=e.vertices.position,v=e.vertices.componentIndex,A=o.deg2rad(i.anglePlanar),y=o.deg2rad(i.angleSignificantEdge),w=Math.cos(y),I=Math.cos(A),V=p.edge,x=V.position0,N=V.position1,E=V.faceNormal0,F=V.faceNormal1,b=u(e),U=d(e),M=U.length/4,P=c.allocate(M);let k=0;const D=M,S=a.allocate(D);let _=0,j=0,z=0;const C=n.range(0,M),L=new Float32Array(M);t.forEach(L,((e,t,n)=>{h.getVec(U[4*t+0],x),h.getVec(U[4*t+1],N),n[t]=r.distance(x,N)})),C.sort(((e,t)=>L[t]-L[e]));const O=new Array,T=new Array;for(let t=0;t<M;t++){const e=C[t],n=L[e],o=U[4*e+0],i=U[4*e+1],d=U[4*e+2],u=U[4*e+3],p=u===s;if(h.getVec(o,x),h.getVec(i,N),p)r.set(E,b[3*d+0],b[3*d+1],b[3*d+2]),r.copy(F,E),V.componentIndex=v.get(o),V.cosAngle=r.dot(E,F);else{if(r.set(E,b[3*d+0],b[3*d+1],b[3*d+2]),r.set(F,b[3*u+0],b[3*u+1],b[3*u+2]),V.componentIndex=v.get(o),V.cosAngle=r.dot(E,F),g(V,I))continue;V.cosAngle<-.9999&&r.copy(F,E)}j+=n,z++,p||l(V,w)?(c.write(P,k++,V),O.push(n)):f(V,A)&&(a.write(S,_++,V),T.push(n))}const q=new Float32Array(O.reverse()),B=new Float32Array(T.reverse());return{regular:{instancesData:c.trim(P,k),lodInfo:{lengths:q}},silhouette:{instancesData:a.trim(S,_),lodInfo:{lengths:B}},averageEdgeLength:j/z}}function l(e,t){return e.cosAngle<t}function g(e,t){return e.cosAngle>t}function f(e,t){const n=o.acosClamped(e.cosAngle),c=p.fwd,s=p.ortho;a.directionFromTo(c,e.position1,e.position0);return n*(r.dot(r.cross(s,e.faceNormal0,e.faceNormal1),c)>0?-1:1)>t}function d(e){const t=e.faces.length/3,n=e.faces,o=e.neighbors;let c=0;for(let i=0;i<t;i++){const e=o[3*i+0],t=o[3*i+1],r=o[3*i+2],a=n[3*i+0],l=n[3*i+1],g=n[3*i+2];c+=e===s||a<l?1:0,c+=t===s||l<g?1:0,c+=r===s||g<a?1:0}const r=new Int32Array(4*c);let a=0;for(let i=0;i<t;i++){const e=o[3*i+0],t=o[3*i+1],c=o[3*i+2],l=n[3*i+0],g=n[3*i+1],f=n[3*i+2];(e===s||l<g)&&(r[a++]=l,r[a++]=g,r[a++]=i,r[a++]=e),(t===s||g<f)&&(r[a++]=g,r[a++]=f,r[a++]=i,r[a++]=t),(c===s||f<l)&&(r[a++]=f,r[a++]=l,r[a++]=i,r[a++]=c)}return r}function u(e){const t=e.faces.length/3,n=e.vertices.position,o=e.faces,c=h.v0,a=h.v1,s=h.v2,i=new Float32Array(3*t);for(let l=0;l<t;l++){const e=o[3*l+0],t=o[3*l+1],g=o[3*l+2];n.getVec(e,c),n.getVec(t,a),n.getVec(g,s),r.subtract(a,a,c),r.subtract(s,s,c),r.cross(c,a,s),r.normalize(c,c),i[3*l+0]=c[0],i[3*l+1]=c[1],i[3*l+2]=c[2]}return i}const p={edge:{position0:c.create(),position1:c.create(),faceNormal0:c.create(),faceNormal1:c.create(),componentIndex:0,cosAngle:0},ortho:c.create(),fwd:c.create()},h={v0:c.create(),v1:c.create(),v2:c.create()},m={anglePlanar:4,angleSignificantEdge:35};e.extractEdges=i,Object.defineProperty(e,"__esModule",{value:!0})}));
