/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../core/maybe","../../../../core/NestedMap","./Util"],(function(e,t,i,r,n,o){"use strict";const s=i.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");let a=function(){function e(e){this._glMaterial=e,this.refCnt=0,this._glMaterial=e}var i=e.prototype;return i.incRefCnt=function(){++this.refCnt},i.decRefCnt=function(){--this.refCnt,o.assert(this.refCnt>=0)},i.getRefCnt=function(){return this.refCnt},t._createClass(e,[{key:"glMaterial",get:function(){return this._glMaterial}}]),e}(),l=function(){function e(e,t,i,r){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new n.NestedMap}var t=e.prototype;return t.dispose=function(){this._textureRepository.dispose()},t.acquire=function(e,t){this._ownMaterial(e);let i=this._id2glMaterialRef.get(t,e.id);if(r.isNone(i)){const r=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});i=new a(r),this._id2glMaterialRef.set(t,e.id,i)}return i.incRefCnt(),i.glMaterial},t.release=function(e,t){const i=this._id2glMaterialRef.get(t,e.id);r.isSome(i)&&(i.decRefCnt(),0===i.getRefCnt()&&(r.disposeMaybe(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))},t._ownMaterial=function(e){r.isSome(e.repository)&&e.repository!==this&&s.error("Material is already owned by a different material repository"),e.repository=this},e}();e.GLMaterialRepository=l,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
