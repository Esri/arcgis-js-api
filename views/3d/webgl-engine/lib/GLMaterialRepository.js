/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../core/maybe","../../../../core/NestedMap","./Util"],(function(e,t,i,r,o,n){"use strict";let s=function(){function e(e,t,i,r){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new o.NestedMap}var t=e.prototype;return t.dispose=function(){this._textureRepository.destroy()},t.acquire=function(e,t,i){if(this._ownMaterial(e),!e.requiresSlot(t,i))return null;let o=this._id2glMaterialRef.get(i,e.id);if(r.isNone(o)){const t=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});o=new a(t),this._id2glMaterialRef.set(i,e.id,o)}return o.ref(),o.glMaterial},t.release=function(e,t){const i=this._id2glMaterialRef.get(t,e.id);r.isSome(i)&&(i.unref(),i.referenced||(r.disposeMaybe(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))},t._ownMaterial=function(e){r.isSome(e.repository)&&e.repository!==this&&i.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this},e}(),a=function(){function e(e){this.glMaterial=e,this._refCnt=0}var i=e.prototype;return i.ref=function(){++this._refCnt},i.unref=function(){--this._refCnt,n.assert(this._refCnt>=0)},t._createClass(e,[{key:"referenced",get:function(){return this._refCnt>0}}]),e}();e.GLMaterialRepository=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
