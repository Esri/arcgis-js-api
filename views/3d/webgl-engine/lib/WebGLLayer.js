/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray","../../../../core/Evented","../../../../chunks/vec3f64","../../../../core/Handles","./ContentObject","./DirtyEvents","./Octree"],(function(e,t,i,s,n,r,o,a,c,h){"use strict";let l=function(e){function a(t,i=""){var a;return(a=e.call(this)||this).apiLayerUid=i,a.type=0,a.events=new n,a.isSliceable=!1,a._objects=new s,a._stageHandles=new o,a.apiLayerUid=i,t=t||{},a.group=t.group||"",a.isVisible=null==t.isVisible||t.isVisible,a.isPickable=null==t.isPickable||t.isPickable,a.translation=t.translation?r.clone(t.translation):r.create(),a}t._inheritsLoose(a,e);var l=a.prototype;return l.destroy=function(){this.detachStage(),this._stage=null},l.attachStage=function(e){this.detachStage(),this._stage=e;for(const t of c.DirtyEventNames)this._stageHandles.add(this.events.on(t,(i=>e.handleEvent(t,i))))},l.detachStage=function(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()},l.getObjectIds=function(){return this._objects.map((e=>e.id))},l.getObjects=function(){return this._objects},l.add=function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),i.isSome(this._octree)&&this._octree.add([e])},l.remove=function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),i.isSome(this._octree)&&this._octree.remove([e]))},l.addMany=function(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),i.isSome(this._octree)&&this._octree.add(e)},l.removeMany=function(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),i.isSome(this._octree)&&this._octree.remove(t)}},l.commit=function(){i.isSome(this._stage)&&this._stage.processDirtyLayer(this.id)},l.notifyObjectBBChanged=function(e,t){i.isSome(this._octree)&&this._octree.update(e,t)},l.getSpatialQueryAccelerator=function(){return i.isNone(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree},l.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)},l.invalidateSpatialQueryAccelerator=function(){this._octree=i.destroyMaybe(this._octree)},l._createOctree=function(){this._octree=new h((e=>e.getBounds())),this._octree.add(this._objects.data,this._objects.length)},a}(a.ContentObject);function d(e){return i.isSome(e)&&0===e.type}e.WebGLLayer=l,e.isWebGLLayer=d,Object.defineProperty(e,"__esModule",{value:!0})}));
