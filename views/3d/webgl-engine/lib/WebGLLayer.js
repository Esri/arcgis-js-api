/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Evented","../../../../core/Handles","../../../../core/maybe","../../../../core/PooledArray","./basicInterfaces","./ContentObject","./ContentObjectType","./DirtyEvents","./Octree"],(function(e,t,i,s,o,n,r,a,c,h,l){"use strict";let d=function(e){function a(t,o=""){var a;return(a=e.call(this)||this).apiLayerUid=o,a.type=c.ContentObjectType.Layer,a.events=new i,a.isSliceable=!1,a._objects=new n,a._stageHandles=new s,a.apiLayerUid=o,a.isVisible=t?.isVisible??!0,a.isPickable=t?.isPickable??!0,a.updatePolicy=t?.updatePolicy??r.UpdatePolicy.ASYNC,a}t._inheritsLoose(a,e);var d=a.prototype;return d.destroy=function(){this.detachStage(),this._stage=null},d.attachStage=function(e){this.detachStage(),this._stage=e;for(const t of h.DirtyEventNames)this._stageHandles.add(this.events.on(t,(i=>e.handleEvent(t,i))))},d.detachStage=function(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()},d.add=function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),o.isSome(this._octree)&&this._octree.add([e])},d.remove=function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),o.isSome(this._octree)&&this._octree.remove([e]))},d.addMany=function(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),o.isSome(this._octree)&&this._octree.add(e)},d.removeMany=function(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),o.isSome(this._octree)&&this._octree.remove(t)}},d.sync=function(){o.isSome(this._stage)&&this.updatePolicy!==r.UpdatePolicy.SYNC&&this._stage.syncLayer(this.id)},d.notifyObjectBBChanged=function(e,t){o.isSome(this._octree)&&this._octree.update(e,t)},d.getSpatialQueryAccelerator=function(){return o.isNone(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree},d.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)},d.invalidateSpatialQueryAccelerator=function(){this._octree=o.destroyMaybe(this._octree)},d._createOctree=function(){this._octree=new l((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)},t._createClass(a,[{key:"objects",get:function(){return this._objects}}]),a}(a.ContentObject);function y(e){return o.isSome(e)&&e.type===c.ContentObjectType.Layer}e.WebGLLayer=d,e.isWebGLLayer=y,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
