/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec4","../../../../chunks/vec4f64","./glUtil3D","../shaders/ShadowCastTechnique","../../../webgl/Util"],(function(i,t,e,s,a,n,o,h){"use strict";const u=a.fromValues(.01,0,.25,1),r=4e4,l=5e4,d=1/512;let _=function(){function i(i,t,e,s){this._techniqueRep=i,this._rctx=t,this._shadowAccumulator=e,this._requestRender=s,this._enabled=!1,this._vao=n.createQuadVAO(t),this._visualizationConfig=new o.ShadowCastTechniqueConfiguration,this._visualizationConfig.pass=1,this._visualizationConfig.visualization=0,this._visualizeShadowCastTechnique=i.acquire(o.ShadowCastTechnique,this._visualizationConfig),this._visualizationParams={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:u,threshold:.5,bandSize:.1,opacityFromElevation:1}}var a=i.prototype;return a.dispose=function(){this._stop(),this._vao=e.disposeMaybe(this._vao),this._visualizeShadowCastTechnique=e.disposeMaybe(this._visualizeShadowCastTechnique),this._shadowAccumulator=null},a.render=function(){this._isRenderingVisualization&&(this._sampleScale=1/this._computedSamples,this._rctx.bindVAO(this._vao),this._rctx.useProgram(this._visualizeShadowCastTechnique.program),this._visualizeShadowCastTechnique.bindPipelineState(this._rctx),this._visualizeShadowCastTechnique.bindPass(this._visualizationParams),this._rctx.drawArrays(this._visualizeShadowCastTechnique.primitiveType,0,h.vertexCount(this._vao,"geometry")))},a.setOptions=function(i){void 0!==i.enabled&&this._setEnabled(i.enabled),void 0!==i.color&&this._setColor(i.color),void 0!==i.threshold&&(this._threshold=i.threshold),void 0!==i.visualization&&(this._visualization=i.visualization),void 0!==i.bandSize&&(this._bandSize=i.bandSize),void 0!==i.bandsEnabled&&(this._bandsEnabled=i.bandsEnabled)},a._setColor=function(i){const t=this._visualizationParams.color;s.exactEquals(i,t)||(s.copy(this._visualizationParams.color,i),this._requestRenderIfRunning())},a._setEnabled=function(i){i!==this._enabled&&(i?this._start():this._stop())},a._requestRenderIfRunning=function(){this._enabled&&this._requestRender()},a._start=function(){this._enabled=!0,this._requestRender()},a._stop=function(){this._enabled=!1,this._requestRender()},t._createClass(i,[{key:"opacityFromElevation",get:function(){return this._visualizationParams.opacityFromElevation},set:function(i){this._visualizationParams.opacityFromElevation=i}},{key:"_isRenderingVisualization",get:function(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>d}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},{key:"_shadowCastTexture",get:function(){return this._shadowAccumulator.shadowCastTexture}},{key:"_sampleScale",get:function(){return this._visualizationParams.sampleScale},set:function(i){this._visualizationParams.sampleScale=i}},{key:"_threshold",get:function(){return this._visualizationParams.threshold},set:function(i){this._threshold!==i&&(this._visualizationParams.threshold=i,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._visualizationConfig.visualization},set:function(i){if(i===this._visualization)return;const t=this._visualizationConfig;t.visualization=i,this._visualizeShadowCastTechnique=this._techniqueRep.releaseAndAcquire(o.ShadowCastTechnique,t,this._visualizeShadowCastTechnique),this._requestRenderIfRunning()}},{key:"_bandSize",get:function(){return this._visualizationParams.bandSize},set:function(i){i!==this._bandSize&&(this._visualizationParams.bandSize=i,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._visualizationConfig.bandsEnabled},set:function(i){if(i===this._bandsEnabled)return;const t=this._visualizationConfig;t.bandsEnabled=i,this._visualizeShadowCastTechnique=this._techniqueRep.releaseAndAcquire(o.ShadowCastTechnique,t,this._visualizeShadowCastTechnique),this._requestRenderIfRunning()}}]),i}();i.ShadowCastRenderer=_,i.shadowCastDisableElevationMax=l,i.shadowCastDisableElevationMin=r,i.shadowCastDisabledElevationThreshold=d,Object.defineProperty(i,"__esModule",{value:!0})}));
