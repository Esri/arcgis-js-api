/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils","./depthRange","./RenderSlot","./Util"],(function(e,n,t,r,s,i){"use strict";let o=function(){function e(e){this.context=e,this.renderPlugins=new Array,this.slots=[];for(let n=0;n<s.RenderSlot.MAX_SLOTS;++n)this.slots[n]=[]}var o=e.prototype;return o.add=function(e,n,r){const s=()=>{this.renderPlugins.push(n);for(const t of e)this.slots[t].push(n);this.context.requestRender()},i=n.initializeRenderContext(this.context,r);if(t.isPromiseLike(i))return i.then(s);s()},o.remove=function(e){const n=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter((n=>n!==e)),i.assert(this.renderPlugins.length<n,"Removing non-added render plugin");for(let t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter((n=>n!==e));e.uninitializeRenderContext(),this.context.requestRender()},o.prepareRender=function(e,n){for(const t of this.renderPlugins)t.prepareRender&&t.prepareRender(e,n)},o.updateAnimation=function(e){let n=!1;return this.renderPlugins.forEach((t=>{t.updateAnimation&&(n=t.updateAnimation(e)||n)})),n},o.render=function(){const e=this.slots[this.context.renderContext.slot],n=new Array;e.filter((e=>{if(!e.canRender)return!1;if(u(e)){const t=e.prepareTechnique(this.context.renderContext);return!!t&&(n.push(t),!0)}return n.push(null),!0})).forEach(((e,t)=>e.render(this.context.renderContext,n[t])))},o.queryDepthRange=function(e){const n=l;n.near=1/0,n.far=-1/0;for(const t of this.renderPlugins)if(t.queryDepthRange){const s=t.queryDepthRange(e);s&&r.union(n,s,n)}return n},n._createClass(e,[{key:"needsTransparentPass",get:function(){return this.renderPlugins.some((e=>e.needsTransparentPass))}},{key:"needsHighlight",get:function(){return this.renderPlugins.some((e=>e.needsHighlight))}},{key:"needsLinearDepth",get:function(){return this.renderPlugins.some((e=>e.needsLinearDepth))}},{key:"needsLaserlineWithContrastControl",get:function(){const e=this.slots[s.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}},{key:"renderOccludedFlags",get:function(){let e=0;return this.renderPlugins.forEach((n=>{n.renderOccludedFlags&&(e|=n.renderOccludedFlags)})),e}}]),e}();function u(e){return"prepareTechnique"in e}const l={near:0,far:0};e.RenderPluginManager=o,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
