/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../core/maybe","../../../webgl/Util","./glUtil3D","../shaders/CompositingTechnique"],(function(e,t,i,o){"use strict";let n=function(){function n(e,t){this._rctx=e,this._techniqueRepository=t,this._techniques=new Set}var s=n.prototype;return s.dispose=function(){this._techniques.forEach((e=>this._techniqueRepository.release(e))),this._techniques.clear(),e.isSome(this._vao)&&(this._vao.dispose(),this._vao=null)},s.composite=function(e,t=0,i=1){this.compositeInternal(e,t,i,0)},s.compositeTransparent=function(e,i,n,s=1){const c=this._rctx;r.alphaMode=1,r.function=3,r.hasOpacityFactor=1!==s;const a=this._techniqueRepository.acquire(o.CompositingTechnique,r);c.bindProgram(a.program),a.bindPipelineState(c),a.program.setUniform1i("colorTexture",1),c.bindTexture(e,1),a.program.setUniform1i("alphaTexture",2),c.bindTexture(i,2),a.program.setUniform1i("frontFaceTexture",3),c.bindTexture(n,3);const u=this.ensureVAO();c.bindVAO(u),c.drawArrays(5,0,t.vertexCount(u,"geometry")),this._techniqueRepository.release(a)},s.compositeSpecial=function(e,t){this.compositeInternal(e,0,1,t)},s.compositeInternal=function(e,i,n,s){const c=this._rctx;r.alphaMode=i,r.function=s,r.hasOpacityFactor=1!==n;const a=this._techniqueRepository.acquire(o.CompositingTechnique,r);c.bindProgram(a.program),a.bindPipelineState(c),a.program.setUniform1i("tex",1),r.hasOpacityFactor&&a.program.setUniform1f("opacity",n),c.bindTexture(e,1);const u=this.ensureVAO();c.bindVAO(u),c.drawArrays(5,0,t.vertexCount(u,"geometry")),this._techniqueRepository.release(a)},s.ensureVAO=function(){return e.isNone(this._vao)&&(this._vao=i.createQuadVAO(this._rctx)),this._vao},n}();const r=new o.CompositingTechniqueConfiguration;return n}));
