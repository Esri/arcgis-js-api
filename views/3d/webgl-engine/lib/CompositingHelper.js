/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../../core/maybe","../../terrain/interfaces","./glUtil3D","../../../../chunks/Compositing.glsl","../shaders/CompositingTechnique","../../../webgl/enums","../../../webgl/Util"],(function(e,t,i,n,o,r,s){"use strict";let a=function(){function a(e,t){this._rctx=e,this._techniqueRepository=t}var u=a.prototype;return u.dispose=function(){this._vao=e.disposeMaybe(this._vao)},u.compositeTransparent=function(e,t,i,a=1){const u=this._rctx;c.alphaMode=o.AlphaMode.Alpha,c.function=n.CompositingFunction.Transparency,c.hasOpacityFactor=1!==a;const h=this._techniqueRepository.acquire(o.CompositingTechnique,c),p=u.useTechnique(h);p.bindTexture(e,"colorTexture"),p.bindTexture(t,"alphaTexture"),p.bindTexture(i,"frontFaceTexture");const T=this._ensureVAO();u.bindVAO(T),u.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,s.vertexCount(T,"geometry")),h.release()},u.composite=function(e,i=o.AlphaMode.None,a=1,u=n.CompositingFunction.Standard,h=t.OverlayIndex.INNER){const p=this._rctx;c.alphaMode=i,c.function=u,c.hasOpacityFactor=1!==a;const T=this._techniqueRepository.acquire(o.CompositingTechnique,c),d=p.useTechnique(T);d.bindTexture(e,"tex"),c.hasOpacityFactor&&d.setUniform1f("opacity",a),u===n.CompositingFunction.OverlayWithTransparency&&d.setUniform1i("overlayIdx",h);const y=this._ensureVAO();p.bindVAO(y),p.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,s.vertexCount(y,"geometry")),T.release()},u._ensureVAO=function(){return e.isNone(this._vao)&&(this._vao=i.createQuadVAO(this._rctx)),this._vao},a}();const c=new o.CompositingTechniqueConfiguration;return a}));
