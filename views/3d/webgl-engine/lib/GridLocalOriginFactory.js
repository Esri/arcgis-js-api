/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../../core/maybe","../../../../geometry/SpatialReference","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../geometry/projection","../../../../chunks/mat4f64","./Geometry","./Object3D","./localOrigin","./WebGLLayer","../materials/RibbonLineMaterial"],(function(t,i,e,n,r,s,o,a,c,h,_){"use strict";let l=0;const u="rg_";let d=function(){function e(){this.ROOT_ORIGIN_ID=u+"root_"+l++,this._origins=new Map,this._gridSize=42e5}var d=e.prototype;return d.getOrigin=function(i){const r=this._origins.get(this.ROOT_ORIGIN_ID);if(null==r){if(t.isSome(e.testOrigin)){const t=e.testOrigin;return this._origins.set(this.ROOT_ORIGIN_ID,c.fromValues(t[0],t[1],t[2],this.ROOT_ORIGIN_ID)),this.getOrigin(i)}const n=c.fromValues(i[0]+Math.random()-.5,i[1]+Math.random()-.5,i[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,n),n}n.subtract(g,i,r.vec3),g[0]=Math.abs(g[0]),g[1]=Math.abs(g[1]),g[2]=Math.abs(g[2]);const s=this._gridSize;if(g[0]<s&&g[1]<s&&g[2]<s)return r;const o=Math.round(i[0]/s),a=Math.round(i[1]/s),h=Math.round(i[2]/s),_=`${u}${o}/${a}/${h}`;let l=this._origins.get(_);return l||(l=c.fromValues(o*s,a*s,h*s,_),this._origins.set(_,l)),l},d._drawOriginBox=function(t){const e=window.view,n=e._stage;if(null==this._object){this._material=new _.RibbonLineMaterial({width:2,color:[0,1,0,1]}),n.add(this._material);const t=new h.WebGLLayer({isPickable:!1});this._object=new a.Object3D({castShadow:!1}),n.add(this._object),t.add(this._object),n.add(t)}const c=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=c.length,u=new Array(3*l),d=new Uint16Array(2*(l-1)),g=.5*this._gridSize;for(let i=0;i<l;i++)u[3*i+0]=t[0]+(1&c[i]?g:-g),u[3*i+1]=t[1]+(2&c[i]?g:-g),u[3*i+2]=t[2]+(4&c[i]?g:-g),i>0&&(d[2*i+0]=i-1,d[2*i+1]=i);r.projectBuffer(u,i.WebMercator,0,u,e.spatialReference,0,l);const O=new o.Geometry([["position",{size:3,data:u,exclusive:!0}]],[["position",d]],2);n.add(O),this._object.addGeometry(O,this._material,s.IDENTITY),console.log(this._origins.size,t)},e}();const g=e.create();return function(t){t.testOrigin=null}(d||(d={})),d}));
