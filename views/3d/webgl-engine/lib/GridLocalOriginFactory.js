/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../core/uid","../../../../chunks/mat4f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/projection","./basicInterfaces","./Geometry","./LocalOriginFactory","./Object3D","./VertexAttribute","./WebGLLayer","../materials/RibbonLineMaterial"],(function(t,e,i,r,n,o,s,a,c,h,d,u,g,l){"use strict";let b=function(){function t(t,e=125e4){this._originSR=t,this._gridSize=e,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+i.generateUID()}var o=t.prototype;return o.getOrigin=function(t){const i=this._origins.get(this._rootOriginId);if(null==i){if(e.isSome(_))return this._origins.set(this._rootOriginId,h.fromValues(_[0],_[1],_[2],this._rootOriginId)),this.getOrigin(t);const i=h.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}const r=this._gridSize,o=Math.round(t[0]/r),s=Math.round(t[1]/r),a=Math.round(t[2]/r),c=`${o}/${s}/${a}`;let d=this._origins.get(c);const u=.5*r;if(n.subtract(m,t,i.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]),m[0]<u&&m[1]<u&&m[2]<u){if(d){const e=Math.max(...m);n.subtract(m,t,d.vec3),m[0]=Math.abs(m[0]),m[1]=Math.abs(m[1]),m[2]=Math.abs(m[2]);if(Math.max(...m)<e)return d}return i}return d||(d=h.fromValues(o*r,s*r,a*r,c),this._origins.set(c,d)),d},o._drawOriginBox=function(t,e=[1,1,0,1]){const i=window.view,n=i._stage,o=e.toString();if(!this._objects.has(o)){this._material=new l.RibbonLineMaterial({width:2,color:e}),n.add(this._material);const t=new g.WebGLLayer({isPickable:!1}),i=new d.Object3D({castShadow:!1});n.add(i),t.add(i),n.add(t),this._objects.set(o,i)}const h=this._objects.get(o),b=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],_=b.length,f=new Array(3*_),m=new Uint16Array(2*(_-1)),M=.5*this._gridSize;for(let r=0;r<_;r++)f[3*r+0]=t[0]+(1&b[r]?M:-M),f[3*r+1]=t[1]+(2&b[r]?M:-M),f[3*r+2]=t[2]+(4&b[r]?M:-M),r>0&&(m[2*r+0]=r-1,m[2*r+1]=r);s.projectBuffer(f,this._originSR,0,f,i.renderSpatialReference,0,_);const O=new c.Geometry([[u.VertexAttribute.POSITION,{size:3,data:f,exclusive:!0}]],[[u.VertexAttribute.POSITION,m]],a.PrimitiveType.Line);n.add(O),h.addGeometry(O,this._material,r.IDENTITY)},t}(),_=null;function f(t){_=t}const m=o.create();t.GridLocalOriginFactory=b,t.default=f,t.setTestRootOrigin=f,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
