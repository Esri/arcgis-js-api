/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../core/uid","../../../../chunks/mat4f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/projection","./Geometry","./localOrigin","./Object3D","./WebGLLayer","../materials/RibbonLineMaterial"],(function(t,i,e,r,o,n,s,a,c,h,d,g){"use strict";let u=function(){function t(t,i=125e4){this._originSR=t,this._gridSize=i,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+e.generateUID()}var n=t.prototype;return n.getOrigin=function(t){const e=this._origins.get(this._rootOriginId);if(null==e){if(i.isSome(_))return this._origins.set(this._rootOriginId,c.fromValues(_[0],_[1],_[2],this._rootOriginId)),this.getOrigin(t);const e=c.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,e),e}const r=this._gridSize,n=Math.round(t[0]/r),s=Math.round(t[1]/r),a=Math.round(t[2]/r),h=`${n}/${s}/${a}`;let d=this._origins.get(h);const g=.5*r;if(o.subtract(f,t,e.vec3),f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1]),f[2]=Math.abs(f[2]),f[0]<g&&f[1]<g&&f[2]<g){if(d){const i=Math.max(...f);o.subtract(f,t,d.vec3),f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1]),f[2]=Math.abs(f[2]);if(Math.max(...f)<i)return d}return e}return d||(d=c.fromValues(n*r,s*r,a*r,h),this._origins.set(h,d)),d},n._drawOriginBox=function(t,i=[1,1,0,1]){const e=window.view,o=e._stage,n=i.toString();if(!this._objects.has(n)){this._material=new g.RibbonLineMaterial({width:2,color:i}),o.add(this._material);const t=new d.WebGLLayer({isPickable:!1}),e=new h.Object3D({castShadow:!1});o.add(e),t.add(e),o.add(t),this._objects.set(n,e)}const c=this._objects.get(n),u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],_=u.length,l=new Array(3*_),f=new Uint16Array(2*(_-1)),b=.5*this._gridSize;for(let r=0;r<_;r++)l[3*r+0]=t[0]+(1&u[r]?b:-b),l[3*r+1]=t[1]+(2&u[r]?b:-b),l[3*r+2]=t[2]+(4&u[r]?b:-b),r>0&&(f[2*r+0]=r-1,f[2*r+1]=r);s.projectBuffer(l,this._originSR,0,l,e.renderSpatialReference,0,_);const m=new a.Geometry([["position",{size:3,data:l,exclusive:!0}]],[["position",f]],2);o.add(m),c.addGeometry(m,this._material,r.IDENTITY)},t}(),_=null;function l(t){_=t}const f=n.create();t.GridLocalOriginFactory=u,t.default=l,t.setTestRootOrigin=l,Object.defineProperty(t,"__esModule",{value:!0})}));
