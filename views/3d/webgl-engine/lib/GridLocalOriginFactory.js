/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/uid","../../../../chunks/mat4f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4f64","../../../../geometry/projection","./basicInterfaces","./Geometry","./LocalOriginFactory","./Object3D","./testUtils","./VertexAttribute","./WebGLLayer","../materials/RibbonLineMaterial"],(function(t,e,i,r,s,o,n,a,c,h,d,u,g,l,_,b,f){"use strict";let m=function(){function t(t){this._originSR=t,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+r.generateUID()}var n=t.prototype;return n.getOrigin=function(t){const e=this._origins.get(this._rootOriginId);if(null==e){const e=l.gridLocalOriginFactory.rootOrigin;if(i.isSome(e))return this._origins.set(this._rootOriginId,u.fromValues(e[0],e[1],e[2],this._rootOriginId)),this.getOrigin(t);const r=u.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),a=Math.round(t[2]/r),c=`${s}/${n}/${a}`;let h=this._origins.get(c);const d=.5*r;if(o.subtract(M,t,e.vec3),M[0]=Math.abs(M[0]),M[1]=Math.abs(M[1]),M[2]=Math.abs(M[2]),M[0]<d&&M[1]<d&&M[2]<d){if(h){const e=Math.max(...M);o.subtract(M,t,h.vec3),M[0]=Math.abs(M[0]),M[1]=Math.abs(M[1]),M[2]=Math.abs(M[2]);if(Math.max(...M)<e)return h}return e}return h||(h=u.fromValues(s*r,n*r,a*r,c),this._origins.set(c,h)),h},n._drawOriginBox=function(t,e=a.fromValues(1,1,0,1)){const i=window.view,r=i._stage,o=e.toString();if(!this._objects.has(o)){this._material=new f.RibbonLineMaterial({width:2,color:e}),r.add(this._material);const t=new b.WebGLLayer({isPickable:!1}),i=new g.Object3D({castShadow:!1});r.add(i),t.add(i),r.add(t),this._objects.set(o,i)}const n=this._objects.get(o),u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=u.length,m=new Array(3*l),M=new Array,O=.5*this._gridSize;for(let s=0;s<l;s++)m[3*s+0]=t[0]+(1&u[s]?O:-O),m[3*s+1]=t[1]+(2&u[s]?O:-O),m[3*s+2]=t[2]+(4&u[s]?O:-O),s>0&&M.push(s-1,s);c.projectBuffer(m,this._originSR,0,m,i.renderSpatialReference,0,l);const y=new d.Geometry([[_.VertexAttribute.POSITION,{size:3,data:m,exclusive:!0}]],[[_.VertexAttribute.POSITION,M]],h.PrimitiveType.Line);r.add(y),n.addGeometry(y,this._material,s.IDENTITY)},e._createClass(t,[{key:"test",get:function(){const t=this;return{set gridSize(e){t._gridSize=e}}}}]),t}();const M=n.create();t.GridLocalOriginFactory=m,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
