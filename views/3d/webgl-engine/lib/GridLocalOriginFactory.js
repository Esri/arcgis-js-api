/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/mat4f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/projection","./Geometry","./localOrigin","./Object3D","./WebGLLayer","../materials/RibbonLineMaterial"],(function(t,e,i,r,s,n,a,o,c,h,_,u){"use strict";let d=0;const g="rg_";let l=function(){function t(t){this._originSR=t,this.ROOT_ORIGIN_ID=g+"root_"+d++,this._origins=new Map,this._gridSize=125e4,this._objects=new Map}var n=t.prototype;return n.getOrigin=function(t){const e=this._origins.get(this.ROOT_ORIGIN_ID);if(null==e){if(i.isSome(O))return this._origins.set(this.ROOT_ORIGIN_ID,c.fromValues(O[0],O[1],O[2],this.ROOT_ORIGIN_ID)),this.getOrigin(t);const e=c.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,e),e}const r=this._gridSize,n=Math.round(t[0]/r),a=Math.round(t[1]/r),o=Math.round(t[2]/r),h=`${g}${n}/${a}/${o}`;let _=this._origins.get(h);const u=.5*r;if(s.subtract(f,t,e.vec3),f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1]),f[2]=Math.abs(f[2]),f[0]<u&&f[1]<u&&f[2]<u){if(_){const e=Math.max(...f);s.subtract(f,t,_.vec3),f[0]=Math.abs(f[0]),f[1]=Math.abs(f[1]),f[2]=Math.abs(f[2]);if(Math.max(...f)<e)return _}return e}return _||(_=c.fromValues(n*r,a*r,o*r,h),this._origins.set(h,_)),_},n._drawOriginBox=function(t,e=[1,1,0,1]){const i=window.view,s=i._stage,n=e.toString();if(!this._objects.has(n)){this._material=new u.RibbonLineMaterial({width:2,color:e}),s.add(this._material);const t=new _.WebGLLayer({isPickable:!1}),i=new h.Object3D({castShadow:!1});s.add(i),t.add(i),s.add(t),this._objects.set(n,i)}const c=this._objects.get(n),d=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],g=d.length,l=new Array(3*g),O=new Uint16Array(2*(g-1)),b=.5*this._gridSize;for(let r=0;r<g;r++)l[3*r+0]=t[0]+(1&d[r]?b:-b),l[3*r+1]=t[1]+(2&d[r]?b:-b),l[3*r+2]=t[2]+(4&d[r]?b:-b),r>0&&(O[2*r+0]=r-1,O[2*r+1]=r);a.projectBuffer(l,this._originSR,0,l,i.renderSpatialReference,0,g);const f=new o.Geometry([["position",{size:3,data:l,exclusive:!0}]],[["position",O]],2);s.add(f),c.addGeometry(f,this._material,r.IDENTITY)},e._createClass(t,[{key:"test",get:function(){const t=this;return{get gridSize(){return t._gridSize},set gridSize(e){t._gridSize=e}}}}]),t}(),O=null;function b(t){O=t}const f=n.create();t.GridLocalOriginFactory=l,t.setTestRootOrigin=b,Object.defineProperty(t,"__esModule",{value:!0})}));
