/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../ViewingMode","../core/shaderLibrary/shading/ReadShadowMap.glsl","./glUtil3D","../shaders/ShadowHighlightTechnique","../../../webgl/Util"],(function(e,t,a,i,s,r,h,n,o,c,d){"use strict";const u=.001953125,_=4e4,p=5e4;let l=function(){function e(e,t){this._rctx=e,this._viewingMode=t,this._maxOpacity=1,this._passParameters=new c.ShadowHighlightPassParameters,this._drawParameters=new n.ReadShadowMapBindParameters,this._vao=o.createQuadVAO(this._rctx)}var r=e.prototype;return r.render=function(e,t){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const a=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(t),this._rctx.bindTechnique(a,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(a.primitiveType,0,d.vertexCount(this._vao,"geometry"))},r.setDefaultOptions=function(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()},r.updateParameters=function(e,t){this._passParameters.opacityElevation=1-a.smoothstep(_,p,e.relativeElevation);const i=this._viewingMode===h.ViewingMode.Global?s.normalize(m,e.center):s.set(m,0,0,1),r=s.dot(i,t);this._passParameters.dayNightTerminator=a.smoothstep(0,1,a.clamp(30*r,0,1))},r.dispose=function(){this._vao=i.disposeMaybe(this._vao),this._techniqueCached=i.releaseMaybe(this._techniqueCached)},r._updateMaxOpacity=function(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]},t._createClass(e,[{key:"_technique",get:function(){return i.isNone(this._techniqueCached)&&(this._techniqueCached=new c.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}},{key:"gpuMemoryUsage",get:function(){return this._vao?.size??0}},{key:"isVisible",get:function(){const{opacityElevation:e,dayNightTerminator:t}=this._passParameters;return this._maxOpacity*e*t>=u}}]),e}();const m=r.create();e.ShadowHighlight=l,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
