/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../chunks/mat4","../../../../chunks/mat3f64","../../../../chunks/mat4f64","../../../../chunks/quatf64","../../../../chunks/vec4f64","../../../../chunks/mat3","../../../../chunks/vec4","../../../../chunks/quat","../../../../chunks/vec3f32","../../../../chunks/sphere","../../../../chunks/boundedPlane","../../support/geometryUtils","./Object3D"],(function(t,e,r,i,n,s,a,o,h,c,f,l,u,p,m,d,b,y){"use strict";function g(t){return(e,r,i)=>(n.lerp(N,e,r,i),!d.extrusionContainsPoint(t,N))}let v=function(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2},O=function(){function t(){this._transform=o.create(),this._transformInverse=new S({value:this._transform},s.invert,o.create),this._transformInverseTranspose=new S(this._transformInverse,s.transpose,o.create),this._transformTranspose=new S({value:this._transform},s.transpose,o.create),this._transformInverseRotation=new S({value:this._transform},f.normalFromMat4Legacy,a.create)}var r=t.prototype;return r.invalidateLazyTransforms=function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()},r.setTransformMatrix=function(t){s.copy(this._transform,t)},r.multiplyTransform=function(t){s.multiply(this._transform,this._transform,t)},r.set=function(t){s.copy(this._transform,t),this.invalidateLazyTransforms()},r.setAndInvalidateLazyTransforms=function(t,e){this.setTransformMatrix(t),this.multiplyTransform(e),this.invalidateLazyTransforms()},e._createClass(t,[{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]),t}(),S=function(){function t(t,e,r){this.original=t,this.update=e,this.dirty=!0,this.transform=r()}return t.prototype.invalidate=function(){this.dirty=!0},e._createClass(t,[{key:"value",get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}]),t}(),T=function(){function t(){this.min=new _,this.max=new _,this.hud=new _,this.ground=new _}return t.prototype.init=function(t){this.min.init(t),this.max.init(t),this.hud.init(t),this.ground.init(t),this.all=[]},t}(),_=function(){function t(t){this.normal=i.create(),this.transformation=o.create(),this._ray=b.ray.create(),this.init(t)}var r=t.prototype;return r.getIntersectionPoint=function(t){return!!this.hasIntersectionPoint&&(n.scale(A,this.ray.direction,this.dist),n.add(t,this.ray.origin,A),!0)},r.getTransformedNormal=function(t){return n.copy(C,this.normal),C[3]=0,l.transformMat4(C,C,this.transformation),n.copy(t,C),n.normalize(t,t),t},r.init=function(t){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",t?b.ray.copy(t,this._ray):this._ray=b.ray.create()},r.set=function(t,e,r,a,o,h,c,f,l,u){t instanceof y.Object3D&&(t={type:"stage",obj:t}),this.dist=r,n.copy(this.normal,a),s.copy(this.transformation,o),this.target=t,this.name=e,this.drapedLayerOrder=h,this.center=c?i.clone(c):null,this.geometryId=f,this.triangleNr=l,this.drapedLayerGraphicOrder=u},r.copyFrom=function(t){b.ray.copy(t._ray,this._ray),this.dist=t.dist,this.target=t.target,this.name=t.name,this.drapedLayerOrder=t.drapedLayerOrder,this.center=t.center?i.clone(t.center):null,this.geometryId=t.geometryId,this.triangleNr=t.triangleNr,this.intersector=t.intersector,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,n.copy(this.normal,t.normal),s.copy(this.transformation,t.transformation)},r.toOwner=function(t){if(!this.target)return null;switch(this.target.type){case"stage":return I(this.target.obj.metadata,t);case"external":switch(this.intersector){case"PointRenderer":return V(this.target,t);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return I(this.target.metadata,t);case"TerrainRenderer":return t.map&&t.map.ground}}return null},r.toGraphic=function(t){if(!this.target)return null;switch(this.target.type){case"stage":return z(this.target.obj.metadata,t);case"external":switch(this.intersector){case"PointRenderer":return L(this.target);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return z(this.target.metadata,t)}}return null},e._createClass(t,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return n.scale(A,this.ray.direction,this.dist),n.length(A)}}]),t}();function I(t,e){return r.isNone(t)||null==t.layerUid?null:r.isSome(e.graphicsView)&&t.layerUid===e.graphicsView.graphics3d.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid)}function z(t,e){if(r.isNone(t))return null;const i=I(t,e);if(r.isNone(i))return null;if(i===e.graphics)return r.isSome(e.graphicsView)?r.unwrap(e.graphicsView.getGraphicFromGraphicUid(t.graphicUid)):null;const n=e.allLayerViews.find((t=>t.layer===i));return n?M(n,t):null}function M(t,e){return!t||t.suspended?null:"getGraphicFromIntersectorMetadata"in t&&e?t.getGraphicFromIntersectorMetadata(e):"getGraphicFromGraphicUid"in t&&null!=e.graphicUid?t.getGraphicFromGraphicUid(e.graphicUid):null}function V(t,e){const r=t.metadata.layerUid;return null!=r?e.map.findLayerByUid(r):null}function L(t){return t.metadata.createGraphic()}let x=function(){function t(t=0){this.offset=t,this.tmpVertex=i.create()}var e=t.prototype;return e.applyToVertex=function(t,e,r){const i=t+this.localOrigin[0],n=e+this.localOrigin[1],s=r+this.localOrigin[2],a=this.offset/Math.sqrt(i*i+n*n+s*s);return this.tmpVertex[0]=t+i*a,this.tmpVertex[1]=e+n*a,this.tmpVertex[2]=r+s*a,this.tmpVertex},e.applyToAabb=function(t){const e=t[0]+this.localOrigin[0],r=t[1]+this.localOrigin[1],i=t[2]+this.localOrigin[2],n=t[3]+this.localOrigin[0],s=t[4]+this.localOrigin[1],a=t[5]+this.localOrigin[2],o=this.offset/Math.sqrt(e*e+r*r+i*i);t[0]+=e*o,t[1]+=r*o,t[2]+=i*o;const h=this.offset/Math.sqrt(n*n+s*s+a*a);return t[3]+=n*h,t[4]+=s*h,t[5]+=a*h,t},t}(),k=function(){function t(t=0){this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=i.create(),this.mbs=c.create(),this.obb={center:i.create(),halfSize:p.create(),quaternion:null}}var r=t.prototype;return r.applyToVertex=function(t,e,r){const i=t,n=e,s=r+this.componentLocalOriginLength,a=this.offset/Math.sqrt(i*i+n*n+s*s);return this.tmpVertex[0]=t+i*a,this.tmpVertex[1]=e+n*a,this.tmpVertex[2]=r+s*a,this.tmpVertex},r.applyToAabb=function(t){const e=t[0],r=t[1],i=t[2]+this.componentLocalOriginLength,n=t[3],s=t[4],a=t[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(e*e+r*r+i*i);t[0]+=e*o,t[1]+=r*o,t[2]+=i*o;const h=this.offset/Math.sqrt(n*n+s*s+a*a);return t[3]+=n*h,t[4]+=s*h,t[5]+=a*h,t},r.applyToMbs=function(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/e;return this.mbs[0]=t[0]+t[0]*r,this.mbs[1]=t[1]+t[1]*r,this.mbs[2]=t[2]+t[2]*r,this.mbs[3]=t[3]+t[3]*this.offset/e,this.mbs},r.applyToObb=function(t){const e=t.center,r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);this.obb.center[0]=e[0]+e[0]*r,this.obb.center[1]=e[1]+e[1]*r,this.obb.center[2]=e[2]+e[2]*r,n.transformQuat(this.obb.halfSize,t.halfSize,t.quaternion),n.add(this.obb.halfSize,this.obb.halfSize,t.center);const i=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*i,this.obb.halfSize[1]+=this.obb.halfSize[1]*i,this.obb.halfSize[2]+=this.obb.halfSize[2]*i,n.subtract(this.obb.halfSize,this.obb.halfSize,t.center),u.conjugate(D,t.quaternion),n.transformQuat(this.obb.halfSize,this.obb.halfSize,D),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=t.quaternion,this.obb},e._createClass(t,[{key:"localOrigin",set:function(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}}]),t}(),w=function(){function t(t=0){this.offset=t,this.sphere=m.create(),this.tmpVertex=i.create()}var e=t.prototype;return e.applyToVertex=function(t,e,r){const i=this.objectTransform.transform;let n=i[0]*t+i[4]*e+i[8]*r+i[12],s=i[1]*t+i[5]*e+i[9]*r+i[13],a=i[2]*t+i[6]*e+i[10]*r+i[14];const o=this.offset/Math.sqrt(n*n+s*s+a*a);n+=n*o,s+=s*o,a+=a*o;const h=this.objectTransform.inverse;return this.tmpVertex[0]=h[0]*n+h[4]*s+h[8]*a+h[12],this.tmpVertex[1]=h[1]*n+h[5]*s+h[9]*a+h[13],this.tmpVertex[2]=h[2]*n+h[6]*s+h[10]*a+h[14],this.tmpVertex},e.applyToMinMax=function(t,e){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i},e.applyToAabb=function(t){const e=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*e,t[1]+=t[1]*e,t[2]+=t[2]*e;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t},e.applyToBoundingSphere=function(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/e;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/e,this.sphere},t}();const q=new w;function G(t){return r.isSome(t)?(q.offset=t,q):null}const R=new k;function U(t){return r.isSome(t)?(R.offset=t,R):null}const j=new x;function P(t){return r.isSome(t)?(j.offset=t,j):null}const F="terrain",N=i.create(),A=i.create(),C=c.create(),D=h.create();t.I3SVerticalOffsetGlobalViewingMode=k,t.IntersectorOptions=v,t.IntersectorResult=_,t.IntersectorResults=T,t.IntersectorTransform=O,t.Object3DVerticalOffsetGlobalViewingMode=w,t.TERRAIN_ID=F,t.TerrainVerticalOffsetGlobalViewingMode=x,t.getVerticalOffsetI3S=U,t.getVerticalOffsetObject3D=G,t.getVerticalOffsetTerrain=P,t.sliceFilterPredicate=g,Object.defineProperty(t,"__esModule",{value:!0})}));
