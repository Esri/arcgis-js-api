/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe"],(function(e,t,i){"use strict";let n=function(){function e(e,t,i=2048){this.text=e,this._parameters=t,this.maxSize=i,this._lineWidths=new Array,this._renderPixelRatio=null,this._displayWidth=null,this.key=`${this._parameters.key}--${e}`,this._lines=e.split(/\r?\n/),this._lineHeight=this.computeLineHeight()}var n=e.prototype;return n.getLineXOffset=function(e){return Math.round((this.renderedWidth-this._lineWidths[e]*this.renderPixelRatio)/2)},n.render=function(e,t=0,i=0){const n=this.renderedLineHeight,h=this.renderedHaloSize,o=s(e.textAlign,this.renderedWidth)+h,a=h+r;e.save(),h>0&&this.renderHalo(e,o,a,t,i),this.setFontProperties(e,this.renderedFontSize),i+=a,t+=o;for(let s=0;s<this._lines.length;++s){e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)";const r=this._lines[s],h=this.getLineXOffset(s);e.fillText(r,t+h,i),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.fillStyle,e.fillText(r,t+this.getLineXOffset(s),i),i+=n}e.restore()},n.renderHalo=function(e,t,i,n,s){const r=this.renderedWidth,h=this.renderedHeight,d=o(a,Math.max(r,l),Math.max(h,l)),f=d.getContext("2d");f.clearRect(0,0,r,h),this.setFontProperties(f,this.renderedFontSize),f.fillStyle=this._parameters.haloStyle,f.strokeStyle=this._parameters.haloStyle;const u=this.renderedHaloSize<3;f.lineJoin=u?"miter":"round",u?this.renderHaloEmulated(f,t,i):this.renderHaloNative(f,t,i),e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(d,0,0,r,h,n,s,r,h),e.globalAlpha=1},n.renderHaloEmulated=function(e,t,i){const n=this.renderedLineHeight,s=this.renderedHaloSize;for(let r=0;r<this._lines.length;++r){const o=this._lines[r],a=this.getLineXOffset(r);for(const[n,r]of h)e.fillText(o,t+a+s*n,i+s*r);i+=n}},n.renderHaloNative=function(e,t,i){const n=this.renderedLineHeight,s=this.renderedHaloSize;for(let r=0;r<this._lines.length;++r){const h=2*s,o=this._lines[r],a=this.getLineXOffset(r),l=5,d=.1;for(let n=0;n<l;n++){const s=1-(l-1)*d+n*d;e.lineWidth=s*h,e.strokeText(o,t+a,i)}i+=n}},n.setFontProperties=function(e,t){const i=this._parameters.definition.font,n=`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`;e.font=n,e.textAlign="left",e.textBaseline="top"},n._ensureTextWidth=function(){if(i.isSome(this._displayWidth))return this._displayWidth;const e=o(a,l,l).getContext("2d");this.setFontProperties(e,this._parameters.definition.size);let t=0,n=2*this._parameters.haloSize;this._lineWidths.length=0;const s=this._parameters.definition.font;("italic"===s.style||"oblique"===s.style||"string"==typeof s.weight&&("bold"===s.weight||"bolder"===s.weight)||"number"==typeof s.weight&&s.weight>600)&&(n+=.3*e.measureText("A").width);for(const i of this._lines){const s=Math.round(e.measureText(i).width+n);this._lineWidths.push(s),t=Math.max(t,s)}return this._displayWidth=t,this._displayWidth},n.computeLineHeight=function(){const e=1.275*this._parameters.definition.size;return Math.ceil(e+2*this._parameters.haloSize)+r},t._createClass(e,[{key:"displayWidth",get:function(){return this._ensureTextWidth()}},{key:"displayHeight",get:function(){return this._lineHeight*this._lines.length}},{key:"renderedWidth",get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)}},{key:"renderedHeight",get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)}},{key:"renderedLineHeight",get:function(){return Math.round(this._lineHeight*this.renderPixelRatio)}},{key:"renderedFontSize",get:function(){return this._parameters.definition.size*this.renderPixelRatio}},{key:"renderedHaloSize",get:function(){return this._parameters.haloSize*this.renderPixelRatio}},{key:"renderPixelRatio",get:function(){if(i.isNone(this._renderPixelRatio)){const e=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/(this.displayWidth*e),this.maxSize/(this.displayHeight*e))):this._renderPixelRatio=e}return this._renderPixelRatio}}]),e}();function s(e,t){return"center"===e?.5*t:"right"===e?t:0}const r=1,h=[];{const e=16;for(let t=0;t<360;t+=360/e)h.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}function o(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}const a={canvas:null},l=512;e.TextRenderer=n,e.default=n,e.getTextHelperCanvas=o,Object.defineProperty(e,"__esModule",{value:!0})}));
