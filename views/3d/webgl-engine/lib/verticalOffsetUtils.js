/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/mat3","../../../../chunks/mat3f64","../../../../chunks/mat4","../../../../chunks/mat4f64","../../../../chunks/quat","../../../../chunks/quatf64","../../../../chunks/vec3","../../../../chunks/vec3f32","../../../../chunks/vec3f64","../../../../chunks/sphere"],(function(t,e,s,i,n,r,o,a,h,f,l,c,u){"use strict";let _=function(){function t(){this._transform=o.create(),this._transformInverse=new b({value:this._transform},r.invert,o.create),this._transformInverseTranspose=new b(this._transformInverse,r.transpose,o.create),this._transformTranspose=new b({value:this._transform},r.transpose,o.create),this._transformInverseRotation=new b({value:this._transform},i.normalFromMat4Legacy,n.create)}var s=t.prototype;return s._invalidateLazyTransforms=function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()},s.setTransformMatrix=function(t){r.copy(this._transform,t)},s.multiplyTransform=function(t){r.multiply(this._transform,this._transform,t)},s.set=function(t){r.copy(this._transform,t),this._invalidateLazyTransforms()},s.setAndInvalidateLazyTransforms=function(t,e){this.setTransformMatrix(t),this.multiplyTransform(e),this._invalidateLazyTransforms()},e._createClass(t,[{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]),t}(),b=function(){function t(t,e,s){this._original=t,this._update=e,this._dirty=!0,this._transform=s()}return t.prototype.invalidate=function(){this._dirty=!0},e._createClass(t,[{key:"value",get:function(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}]),t}(),m=function(){function t(t=0){this.offset=t,this.tmpVertex=c.create()}var e=t.prototype;return e.applyToVertex=function(t,e,s){const i=t+this.localOrigin[0],n=e+this.localOrigin[1],r=s+this.localOrigin[2],o=this.offset/Math.sqrt(i*i+n*n+r*r);return this.tmpVertex[0]=t+i*o,this.tmpVertex[1]=e+n*o,this.tmpVertex[2]=s+r*o,this.tmpVertex},e.applyToAabb=function(t){for(let n=0;n<3;++n)p[n]=t[0+n]+this.localOrigin[n],M[n]=t[3+n]+this.localOrigin[n],O[n]=p[n];const e=this.applyToVertex(p[0],p[1],p[2]);for(let n=0;n<3;++n)t[n]=e[n],t[n+3]=e[n];const s=e=>{const s=this.applyToVertex(e[0],e[1],e[2]);for(let i=0;i<3;++i)t[i+0]=Math.min(t[i+0],s[i]),t[i+3]=Math.max(t[i+3],s[i])};for(let n=1;n<8;++n){for(let t=0;t<3;++t)O[t]=0==(n&1<<t)?p[t]:M[t];s(O)}let i=0;for(let n=0;n<3;++n){p[n]*M[n]<0&&(i|=1<<n)}if(0!==i&&7!==i)for(let n=0;n<8;++n)if(0==(i&n)){for(let t=0;t<3;++t)i[t]?O[t]=0:O[t]=0!=(n&1<<t)?p[t]:M[t];s(O)}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t},t}();const p=c.create(),M=c.create(),O=c.create();let v=function(){function t(t=0){this.componentLocalOriginLength=0,this._tmpVertex=c.create(),this._mbs=u.create(),this._obb={center:c.create(),halfSize:l.create(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}var s=t.prototype;return s._resetOffset=function(t){this._offset=t,this._totalOffset=t},s.applyToVertex=function(t,e,s){const i=t,n=e,r=s+this.componentLocalOriginLength,o=this._totalOffset/Math.sqrt(i*i+n*n+r*r);return this._tmpVertex[0]=t+i*o,this._tmpVertex[1]=e+n*o,this._tmpVertex[2]=s+r*o,this._tmpVertex},s.applyToAabb=function(t){const e=t[0],s=t[1],i=t[2]+this.componentLocalOriginLength,n=t[3],r=t[4],o=t[5]+this.componentLocalOriginLength,a=e*n<0?0:Math.min(Math.abs(e),Math.abs(n)),h=s*r<0?0:Math.min(Math.abs(s),Math.abs(r)),f=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),l=Math.sqrt(a*a+h*h+f*f);if(l<this._totalOffset)return t[0]-=e<0?this._totalOffset:0,t[1]-=s<0?this._totalOffset:0,t[2]-=i<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=r>0?this._totalOffset:0,t[5]+=o>0?this._totalOffset:0,t;const c=Math.max(Math.abs(e),Math.abs(n)),u=Math.max(Math.abs(s),Math.abs(r)),_=Math.max(Math.abs(i),Math.abs(o)),b=Math.sqrt(c*c+u*u+_*_),m=this._totalOffset/b,p=this._totalOffset/l;return t[0]+=e*(e>0?m:p),t[1]+=s*(s>0?m:p),t[2]+=i*(i>0?m:p),t[3]+=n*(n<0?m:p),t[4]+=r*(r<0?m:p),t[5]+=o*(o<0?m:p),t},s.applyToMbs=function(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),s=this._totalOffset/e;return this._mbs[0]=t[0]+t[0]*s,this._mbs[1]=t[1]+t[1]*s,this._mbs[2]=t[2]+t[2]*s,this._mbs[3]=t[3]+t[3]*this._totalOffset/e,this._mbs},s.applyToObb=function(t){const e=t.center,s=this._totalOffset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);this._obb.center[0]=e[0]+e[0]*s,this._obb.center[1]=e[1]+e[1]*s,this._obb.center[2]=e[2]+e[2]*s,f.transformQuat(this._obb.halfSize,t.halfSize,t.quaternion),f.add(this._obb.halfSize,this._obb.halfSize,t.center);const i=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*i,this._obb.halfSize[1]+=this._obb.halfSize[1]*i,this._obb.halfSize[2]+=this._obb.halfSize[2]*i,f.subtract(this._obb.halfSize,this._obb.halfSize,t.center),a.conjugate(q,t.quaternion),f.transformQuat(this._obb.halfSize,this._obb.halfSize,q),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb},e._createClass(t,[{key:"offset",get:function(){return this._offset},set:function(t){this._resetOffset(t)}},{key:"componentOffset",set:function(t){this._totalOffset=this._offset+t}},{key:"localOrigin",set:function(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}}]),t}(),y=function(){function t(t=0){this.offset=t,this.sphere=u.create(),this.tmpVertex=c.create()}var e=t.prototype;return e.applyToVertex=function(t,e,s){const i=this.objectTransform.transform;let n=i[0]*t+i[4]*e+i[8]*s+i[12],r=i[1]*t+i[5]*e+i[9]*s+i[13],o=i[2]*t+i[6]*e+i[10]*s+i[14];const a=this.offset/Math.sqrt(n*n+r*r+o*o);n+=n*a,r+=r*a,o+=o*a;const h=this.objectTransform.inverse;return this.tmpVertex[0]=h[0]*n+h[4]*r+h[8]*o+h[12],this.tmpVertex[1]=h[1]*n+h[5]*r+h[9]*o+h[13],this.tmpVertex[2]=h[2]*n+h[6]*r+h[10]*o+h[14],this.tmpVertex},e.applyToMinMax=function(t,e){const s=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*s,t[1]+=t[1]*s,t[2]+=t[2]*s;const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i},e.applyToAabb=function(t){const e=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*e,t[1]+=t[1]*e,t[2]+=t[2]*e;const s=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*s,t[4]+=t[4]*s,t[5]+=t[5]*s,t},e.applyToBoundingSphere=function(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),s=this.offset/e;return this.sphere[0]=t[0]+t[0]*s,this.sphere[1]=t[1]+t[1]*s,this.sphere[2]=t[2]+t[2]*s,this.sphere[3]=t[3]+t[3]*this.offset/e,this.sphere},t}();const g=new y;function S(t){return s.isSome(t)?(g.offset=t,g):null}const T=new v;function z(t){return s.isSome(t)?(T.offset=t,T):null}const V=new m;function x(t){return s.isSome(t)?(V.offset=t,V):null}const d="terrain",q=h.create();t.I3SVerticalOffsetGlobalViewingMode=v,t.IntersectorTransform=_,t.Object3DVerticalOffsetGlobalViewingMode=y,t.TERRAIN_ID=d,t.TerrainVerticalOffsetGlobalViewingMode=m,t.getVerticalOffsetI3S=z,t.getVerticalOffsetObject3D=S,t.getVerticalOffsetTerrain=x,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
