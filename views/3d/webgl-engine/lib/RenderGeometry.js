/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3f64","../../../../chunks/vec3","../../support/mathUtils","../../../../chunks/mat4","../../../../chunks/mat4f64","./geometryDataUtils","./Util","./Object3DStateSet","../materials/renderers/utils"],(function(t,n,i,r,a,e,s,o,h,u,c){"use strict";return function(){function m(t,n,r,a,e,s,o){this.uniqueName=null,this.shaderTransformationDirty=!0,this.data=t.toRenderData(),this.boundingInfo=n,this.material=r,this.origin=null,this.center=i.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=e,a&&this.updateTransformation(a,s),this.castShadow=o,this.instanceParameters={highlights:null,occludees:null,visible:!0}}var f=m.prototype;return f.updateTransformation=function(t,n){this.transformation=t,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(t,n,this.center)},f.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},f.getBoundingSphere=function(t,n,i){return n=n||a.maxScale(t),r.transformMat4(i,this.boundingInfo.getCenter(),t),this.boundingInfo.getBSRadius()*n},f.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=s.create()),e.copy(this.shaderTransformation,this.calculateShaderTransformation(n.unwrapOr(this.transformation,s.IDENTITY))),this.shaderTransformationDirty=!1),this.shaderTransformation):n.unwrapOr(this.transformation,s.IDENTITY)},f.computeAttachmentOrigin=function(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(n.isSome(this.transformation)&&r.transformMat4(t,t,this.transformation),!0);const i=this.getIndices(h.VertexAttrConstants.POSITION),a=this.getAttribute(h.VertexAttrConstants.POSITION);return!!o.computeAttachmentOriginTriangles(a,i,t)&&(n.isSome(this.transformation)&&r.transformMat4(t,t,this.transformation),!0)},f.getIndices=function(t){return"indices"in this.data?this.data.indices[t]:null},f.getAttribute=function(t){return"vertexAttr"in this.data?this.data.vertexAttr[t]:null},f.addHighlight=function(){const t=u.generateObject3DStateId(0),n=this.instanceParameters;return n.highlights=c.addObject3DStateID(n.highlights,t),t},f.removeHighlight=function(t){const n=this.instanceParameters;n.highlights=c.removeObject3DStateID(n.highlights,t)},t._createClass(m,[{key:"hasShaderTransformation",get:function(){return!!this.calculateShaderTransformation}}]),m}()}));
