/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray","../../../webgl/checkWebGLError","../../../webgl/Program"],(function(e,t,r,n,i,s){"use strict";let u=function(e){function s(t,r,s){var u;return(u=e.call(this,t,r.generateSource("vertex"),r.generateSource("fragment"),s)||this)._textures=new Map,u._freeTextureUnits=new n({deallocator:null}),u._fragmentUniforms=i.webglDebugEnabled()?r.fragmentUniforms.entries:null,u}t._inheritsLoose(s,e);var u=s.prototype;return u.stop=function(){this._textures.clear(),this._freeTextureUnits.clear()},u.bindTexture=function(e,t){if(r.isNone(e)||null==e.glName){const e=this._textures.get(t);return e&&(this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(t)),null}let n=this._textures.get(t);return null==n?(n=this._allocTextureUnit(e),this._textures.set(t,n)):n.texture=e,this._context.useProgram(this),this.setUniform1i(t,n.unit),this._context.bindTexture(e,n.unit),n.unit},u.rebindTextures=function(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),r.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach((e=>{if(("sampler2D"===e.type||"samplerCube"===e.type)&&!this._textures.has(e.name))throw new Error(`Texture sampler ${e.name} has no bound texture`)}))},u._allocTextureUnit=function(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}},u._freeTextureUnit=function(e){this._freeTextureUnits.push(e.unit)},s}(s.Program);e.Program=u,Object.defineProperty(e,"__esModule",{value:!0})}));
