/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./GLMaterial"],(function(e,t,i){"use strict";return function(i){function r(e){var t;return(t=i.call(this,e)||this)._numLoading=0,t._disposed=!1,t._textureRepository=e.textureRep,t._textureId=e.textureId,t._acquire(e.textureId).then((e=>t._texture=e)),t._acquire(e.normalTextureId).then((e=>t._textureNormal=e)),t._acquire(e.emissiveTextureId).then((e=>t._textureEmissive=e)),t._acquire(e.occlusionTextureId).then((e=>t._textureOcclusion=e)),t._acquire(e.metallicRoughnessTextureId).then((e=>t._textureMetallicRoughness=e)),t}e._inheritsLoose(r,i);var s=r.prototype;return s.dispose=function(){this._texture=t.releaseMaybe(this._texture),this._textureNormal=t.releaseMaybe(this._textureNormal),this._textureEmissive=t.releaseMaybe(this._textureEmissive),this._textureOcclusion=t.releaseMaybe(this._textureOcclusion),this._textureMetallicRoughness=t.releaseMaybe(this._textureMetallicRoughness),this._disposed=!0},s.ensureResources=function(e){return 0===this._numLoading?2:1},s.updateTexture=function(e){(t.isNone(this._texture)||e!==this._texture.id)&&(this._texture=t.releaseMaybe(this._texture),this._textureId=e,this._acquire(this._textureId).then((e=>this._texture=e)))},s.bindTextures=function(e){t.isSome(this._texture)&&e.bindTexture(this._texture.glTexture,"tex"),t.isSome(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture"),t.isSome(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,"texEmission"),t.isSome(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),t.isSome(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")},s.bindTextureScale=function(e){const i=t.isSome(this._texture)?this._texture.glTexture:null;t.isSome(i)&&i.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",i.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)},s._acquire=function(e){return t.isNone(e)?Promise.resolve(null):(++this._numLoading,this._textureRepository.acquire(e).then((e=>this._disposed?(t.releaseMaybe(e),null):e)).finally((()=>--this._numLoading)))},r}(i)}));
