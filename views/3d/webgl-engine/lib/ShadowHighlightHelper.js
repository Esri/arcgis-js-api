/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4f32","./glUtil3D","../shaders/ShadowHighlightTechnique","../../../webgl/Util"],(function(t,e,i,a,s,r,n,o,h,c){"use strict";const u=.001953125,p=4e4,l=5e4;let d=function(){function t(t,e){this._rctx=t,this._viewingMode=e,this._maxOpacity=1,this._parameters={shadowColor:n.fromValues(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1,opacityElevation:1,dayNightTerminator:1},this._vao=o.createQuadVAO(this._rctx)}var r=t.prototype;return r.render=function(t,e){if(this._updateParameters(t),!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const i=this.technique;this._rctx.bindFramebuffer(e),this._rctx.useProgram(i.program),i.bindPipelineState(this._rctx),i.bindPass(this._parameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,c.vertexCount(this._vao,"geometry"))},r.setDefaultOptions=function(t){this._parameters={...this._parameters,...t},this._updateMaxOpacity()},r._updateParameters=function(t){this._parameters.opacityElevation=1-i.smoothstep(p,l,t.camera.relativeElevation);const e=1===this._viewingMode?s.normalize(_,t.camera.center):s.set(_,0,0,1),a=s.dot(e,t.lighting.lightingMainDirection);this._parameters.dayNightTerminator=i.smoothstep(0,1,i.clamp(30*a,0,1))},r.dispose=function(){this._vao=a.disposeMaybe(this._vao),this._technique=a.disposeMaybe(this._technique)},r._updateMaxOpacity=function(){const t=this._parameters,e=t.shadowColor,i=Math.max(t.shadowOpacity,t.occludedShadowOpacity);this._maxOpacity=i*e[3]},e._createClass(t,[{key:"technique",get:function(){return a.isNone(this._technique)&&(this._technique=new h.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode},null)),this._technique}},{key:"gpuMemoryUsage",get:function(){var t,e;return null!=(t=null==(e=this._vao)?void 0:e.size)?t:0}},{key:"isVisible",get:function(){return this._maxOpacity*this._parameters.opacityElevation*this._parameters.dayNightTerminator>=u}}]),t}();const _=r.create();t.ShadowHighlightHelper=d,Object.defineProperty(t,"__esModule",{value:!0})}));
