/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4f32","../../../ViewingMode","./glUtil3D","../shaders/ShadowHighlightTechnique","../../../webgl/Util"],(function(e,t,i,a,s,o,r,n,h,c,u){"use strict";const l=.001953125,d=4e4,p=5e4;let _=function(){function e(e,t){this._rctx=e,this._viewingMode=t,this._maxOpacity=1,this._parameters={shadowColor:r.fromValues(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1,opacityElevation:1,dayNightTerminator:1},this._vao=h.createQuadVAO(this._rctx)}var o=e.prototype;return o.render=function(e,t){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this.technique;this._rctx.bindFramebuffer(t),this._rctx.useTechnique(i),i.bindPass(this._parameters,e),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,u.vertexCount(this._vao,"geometry"))},o.setDefaultOptions=function(e){this._parameters={...this._parameters,...e},this._updateMaxOpacity()},o.updateParameters=function(e,t){this._parameters.opacityElevation=1-i.smoothstep(d,p,e.relativeElevation);const a=this._viewingMode===n.ViewingMode.Global?s.normalize(m,e.center):s.set(m,0,0,1),o=s.dot(a,t);this._parameters.dayNightTerminator=i.smoothstep(0,1,i.clamp(30*o,0,1))},o.dispose=function(){this._vao=a.disposeMaybe(this._vao),this._technique=a.releaseMaybe(this._technique)},o._updateMaxOpacity=function(){const e=this._parameters,t=e.shadowColor,i=Math.max(e.shadowOpacity,e.occludedShadowOpacity);this._maxOpacity=i*t[3]},t._createClass(e,[{key:"technique",get:function(){return a.isNone(this._technique)&&(this._technique=new c.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}},{key:"gpuMemoryUsage",get:function(){var e,t;return null!=(e=null==(t=this._vao)?void 0:t.size)?e:0}},{key:"isVisible",get:function(){const{opacityElevation:e,dayNightTerminator:t}=this._parameters;return this._maxOpacity*e*t>=l}}]),e}();const m=o.create();e.ShadowHighlightHelper=_,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
