/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec4f32","./glUtil3D","../shaders/ShadowHighlightTechnique","../../../webgl/Util"],(function(t,i,e,h,s,a,o){"use strict";const n=.001953125;let c=function(){function t(t,i){this._rctx=t,this._maxOpacity=1,this._defaultOptions={shadowColor:h.fromValues(1,0,1,1),shadowOpacity:.2,occludedShadowOpacity:.1},this._technique=new a.ShadowHighlightTechnique({rctx:t,viewingMode:i},null),this._vao=s.createQuadVAO(this._rctx)}var c=t.prototype;return c.render=function(t,i){t.shadowMap.enabled&&t.linearDepthTexture&&this.isVisible&&(this._rctx.bindFramebuffer(i),this._rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this._rctx),this._technique.bindPass(this._defaultOptions,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(this._technique.primitiveType,0,o.vertexCount(this._vao,"geometry")))},c.getGpuMemoryUsage=function(){return this._vao?this._vao.size:0},c.setDefaultOptions=function(t){this._defaultOptions=t,this._updateMaxOpacity()},c.dispose=function(){this._vao=e.disposeMaybe(this._vao),this._technique=e.disposeMaybe(this._technique)},c._updateMaxOpacity=function(){const t=this._defaultOptions,i=t.shadowColor,e=Math.max(t.shadowOpacity,t.occludedShadowOpacity);this._maxOpacity=e*i[3]},i._createClass(t,[{key:"highlightShadowMapSlot",get:function(){return this._technique.highlightShadowMapSlot}},{key:"defaultSnapshotSlot",get:function(){return this._technique.defaultSnapshotSlot}},{key:"isVisible",get:function(){return this._maxOpacity*this._technique.opacityElevation*this._technique.dayNightTerminator>=n}}]),t}();t.ShadowHighlightHelper=c,Object.defineProperty(t,"__esModule",{value:!0})}));
