/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Logger","../../../../core/mathUtils","../../../webgl/Texture"],(function(e,t,r,n){"use strict";const o=t.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),a=542327876,i=131072,s=4;function u(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function l(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const c=u("DXT1"),d=u("DXT3"),h=u("DXT5"),m=31,p=0,g=1,f=2,w=3,D=4,x=7,C=20,b=21;function T(e,t,r){const{textureData:o,internalFormat:a,width:i,height:s}=M(r,t.hasMipmap);return t.samplingMode=o.levels.length>1?9987:9729,t.hasMipmap=o.levels.length>1,t.internalFormat=a,t.width=i,t.height=s,new n(e,t,o)}function M(e,t){const n=new Int32Array(e,0,m);if(n[p]!==a)return o.error("Invalid magic number in DDS header"),null;if(!(n[C]&s))return o.error("Unsupported format, must contain a FourCC code"),null;const u=n[b];let T,M;switch(u){case c:T=8,M=33776;break;case d:T=16,M=33778;break;case h:T=16,M=33779;break;default:return o.error("Unsupported FourCC code:",l(u)),null}let v=1,A=n[D],F=n[w];0==(3&A)&&0==(3&F)||(o.warn("Rounding up compressed texture size to nearest multiple of 4."),A=A+3&-4,F=F+3&-4);const S=A,U=F;let y,k;n[f]&i&&!1!==t&&(v=Math.max(1,n[x])),1===v||r.isPowerOfTwo(A)&&r.isPowerOfTwo(F)||(o.warn("Ignoring mipmaps of non power of two sized compressed texture."),v=1);let I=n[g]+4;const O=[];for(let r=0;r<v;++r)k=(A+3>>2)*(F+3>>2)*T,y=new Uint8Array(e,I,k),O.push(y),I+=k,A=Math.max(1,A>>1),F=Math.max(1,F>>1);return{textureData:{type:"compressed",levels:O},internalFormat:M,width:S,height:U}}e.createDDSTexture=T,e.createDDSTextureData=M,Object.defineProperty(e,"__esModule",{value:!0})}));
