/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Logger","../../../../core/mathUtils","../../../../core/maybe","../../../webgl/enums","../../../webgl/Texture"],(function(e,r,t,o,n,a){"use strict";const i=r.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),s=542327876,u=131072,l=4;function c(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function m(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const d=c("DXT1"),p=c("DXT3"),h=c("DXT5"),T=31,g=0,w=1,D=2,C=3,f=4,S=7,x=20,M=21;function _(e,r,t){const{textureData:i,internalFormat:s,width:u,height:l}=o.unwrapOrThrow(A(t,r.hasMipmap??!1));return r.samplingMode=i.levels.length>1?n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:n.TextureSamplingMode.LINEAR,r.hasMipmap=i.levels.length>1,r.internalFormat=s,r.width=u,r.height=l,new a.Texture(e,r,i)}function A(e,r){const o=new Int32Array(e,0,T);if(o[g]!==s)return i.error("Invalid magic number in DDS header"),null;if(!(o[x]&l))return i.error("Unsupported format, must contain a FourCC code"),null;const a=o[M];let c,_;switch(a){case d:c=8,_=n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case p:c=16,_=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case h:c=16,_=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return i.error("Unsupported FourCC code:",m(a)),null}let A=1,E=o[f],b=o[C];0==(3&E)&&0==(3&b)||(i.warn("Rounding up compressed texture size to nearest multiple of 4."),E=E+3&-4,b=b+3&-4);const R=E,X=b;let F,P;o[D]&u&&!1!==r&&(A=Math.max(1,o[S])),1===A||t.isPowerOfTwo(E)&&t.isPowerOfTwo(b)||(i.warn("Ignoring mipmaps of non power of two sized compressed texture."),A=1);let I=o[w]+4;const O=[];for(let t=0;t<A;++t)P=(E+3>>2)*(b+3>>2)*c,F=new Uint8Array(e,I,P),O.push(F),I+=P,E=Math.max(1,E>>1),b=Math.max(1,b>>1);return{textureData:{type:"compressed",levels:O},internalFormat:_,width:R,height:X}}e.createDDSTexture=_,e.createDDSTextureData=A,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
