/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../../core/maybe","../../../../chunks/vec3f64","../../../../core/Handles","../../../../core/watchUtils","../../../../chunks/mat4","../../../../core/MapUtils","../../../../core/TimeProfiler","../../../../chunks/mat4f64","../../../../chunks/vec2f64","./glUtil3D","./Camera","../../support/debugFlags","./Material","./BoundingInfo","./RenderContext","./rendererUtils","../../../webgl/Measurement","../statistics/RendererPerformanceInfo","../materials/renderers/MergedRenderer","../lighting/SceneLighting","./depthRange","./depthRangeUtils","../core/renderPasses/RenderPassManager","./HighlightHelper","./OffscreenRendering","./RenderPluginManager","./ShadowMap","./SliceHelper","./SmaaRenderPass","./SSAOHelper","./edgeRendering/EdgeView"],(function(e,r,t,n,s,i,a,h,o,d,l,c,p,_,u,g,f,m,R,x,b,T,P,C,y,H,w,M,D,E,I,S,v){"use strict";let O=function(){function r(e,r,t,a,h,o,d,c,u){this._materialRep=e,this._rctx=a,this._compositingHelper=h,this._magnifierHelper=o,this.requestRender=d,this._stage=u,this._materialRenderers=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._hasWater=!1,this._camera=new p(n.fromValues(0,100,-100)),this._content=new Map,this._isRendering=!1,this._bindParameters={slot:null,camera:null,inverseViewport:l.create(),shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:null,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1,lighting:new T.SceneLighting},this._fallbackDepthStencilTexture=null,this.performanceInfo=new x.RendererPerformanceInfo,this._antialiasing=1,this._oitEnabled=!0,this._handles=new s,this.renderHiddenTransparentEdges=()=>{},this._shaderTechniqueRepository=t,this._smaaPass=new I(this._rctx),this.camera.viewport[2]=c[0],this.camera.viewport[3]=c[1],this.requestRender(),this._offscreenRendering=new w.OffscreenRendering(this._rctx,this._compositingHelper),this._sliceHelper=new E,this._shadowMap=new D(this._rctx,t.viewingMode),this._ssaoHelper=new S(t,this._rctx,(()=>this.requestRender())),this._highlightHelper=new H(t,this._rctx),this._renderPlugins=new M.RenderPluginManager({rctx:this._rctx,shaderTechniqueRep:t,textureRep:r,materialRep:this._materialRep,requestRender:this.requestRender}),this.renderPassManager=new y.RenderPassManager(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._renderContext=new f(this._rctx,this._offscreenRendering,this._bindParameters.lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderContext.ssrParams={camera:null,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1},this._handles.add(i.init(_,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",(e=>{this.renderHiddenTransparentEdges=e?()=>this.renderEdges(1):()=>{},this.requestRender()})))}var d=r.prototype;return d.dispose=function(){this._handles.destroy(),this._smaaPass.disable(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers=null,this._edgeView=t.destroyMaybe(this._edgeView),this._offscreenRendering=t.disposeMaybe(this._offscreenRendering),this._fallbackDepthStencilTexture=t.disposeMaybe(this._fallbackDepthStencilTexture),this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose()),this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose()),this._highlightHelper&&(this._highlightHelper.enabled=!1),g.tmpIndices.prune(),this._content.clear(),this._content=null},d.ensureEdgeView=function(){return t.isNone(this._edgeView)&&(this._edgeView=new v.EdgeView(this._rctx,this._shaderTechniqueRepository,{setNeedsRender:()=>this.requestRender()},this._stage.scheduler)),this._edgeView},d.setLighting=function(e){this._bindParameters.lighting.set(e)},d.setRenderParameters=function(e){void 0!==e.screenSpaceReflectionsEnabled&&(this.renderPassManager.screenSpaceReflectionsEnabled=e.screenSpaceReflectionsEnabled),void 0!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this.renderPassManager.shadowCastingEnabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._shadowMap.maxCascades=e.shadowMapMaxCascades),this._highlightHelper.enabled=!0,void 0!==e.ssao&&(this._ssaoHelper.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._ssaoHelper.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._ssaoHelper.radius=e.ssaoRadius),void 0!==e.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter."),void 0!==e.ssaoSamples&&(this._ssaoHelper.samples=e.ssaoSamples),e.background&&(this._offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this._antialiasing=e.antialiasingEnabled?1:0),void 0!==e.orderIndependentTransparencyEnabled&&(this._oitEnabled=e.orderIndependentTransparencyEnabled),void 0!==e.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(e.defaultHighlightOptions),void 0!==e.slicePlane&&(this._sliceHelper.plane=t.unwrap(e.slicePlane)),void 0!==e.waterReflectionEnabled&&(this._waterReflectionEnabled=this._rctx.parameters.maxTextureImageUnits>=10&&e.waterReflectionEnabled),this.requestRender()},d.getFramebufferTexture=function(e){switch(e){case"color":return this._offscreenRendering.colorTexture;case"hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case"shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case"linearDepth":return this._offscreenRendering.linearDepthTexture;case"normals":return this._offscreenRendering.normalTexture;case"highlight":return this._offscreenRendering.highlightTexture;default:return null}},d.modify=function(e,r=(e?e.length:0),t,n=(t?t.length:0),s,i=(s?s.length:0)){this._isRendering&&console.warn("Renderer.modify called while rendering");for(let e=0;e<n;++e)this._content.delete(t[e].uniqueName);for(let t=0;t<r;++t)this._content.set(e[t].uniqueName,e[t]);if(r||n||i){const a=m.splitRenderGeometryChangeSetByMaterial({toAdd:e,numToAdd:r,toRemove:t,numToRemove:n,toUpdate:s,numToUpdate:i});let o=!1;a.forEach(((e,r)=>{let t=this._materialRenderers.get(r);!t&&e.toAdd.length>0&&(t=new b(this._rctx,this._materialRep,r),this._materialRenderers.set(r,t)),t&&(t.modify(e),t.isEmpty&&(o=!0))})),o&&this._materialRenderers.forEach(((e,r)=>{e.isEmpty&&(this._materialRenderers.delete(r),e.dispose())})),this._hasHighlights=h.someMap(this._materialRenderers,(e=>e.hasHighlights)),this._hasOccludees=h.someMap(this._materialRenderers,(e=>e.hasOccludees)),this._hasWater=h.someMap(this._materialRenderers,(e=>e.hasWater)),this.requestRender()}},d.updateLogic=function(e){let r=!1;return this._materialRenderers.forEach((t=>{t.updateLogic&&(r=t.updateLogic(e)||r)})),r},d.render=function(e,r,n){this.performanceInfo.prerender(this._rctx),this._isRendering=!0,this.setLighting(this._stage.lighting),this._renderContext.hasOccludees=this._hasOccludees,this._renderContext.transparencyPassType=3,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;const s=this._offscreenRendering;s.needLastFrameColorTexture=this._waterReflectionEnabled,s.advanceCurrentRenderTarget();const i=this._sliceHelper.plane;n&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),r.setGLViewport(this._rctx),this._renderPlugins.prepareRender(r),this.performanceInfo.advance(0),this.renderShadowMap(e,r,this._stage.mainLightDirection),this.performanceInfo.advance(1),this.ensureBindParameters(this._renderContext,r),s.initializeFrame(r),this.renderLinearDepth(),this.performanceInfo.advance(2),this.renderNormal(),this.performanceInfo.advance(3),this.ensureBindParametersSSR(this._renderContext),this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(r,s.linearDepthTexture,s.normalTexture),this._ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository),this.performanceInfo.stats.reset(),this.performanceInfo.advance(4),this._renderContext.pass=0,s.bindFramebuffer(),this._renderPlugins.render(0,this._renderContext),this.renderOpaqueGeometry(this._renderContext),this.performanceInfo.advance(5),this.renderEdges(2),this.performanceInfo.advance(6),this.renderHiddenTransparentEdges(),this.renderOrderIndependentTransparency((()=>this.renderTransparentGeometry(this._renderContext)),!1),this.performanceInfo.advance(7),this.renderEdges(1),this.performanceInfo.advance(8);const a={hudVisibility:!1,transparentTerrain:!1};a.hudVisibility=this.renderHUDVisibility(this._renderContext),this.renderInternalSlot(20,this._renderContext),this.performanceInfo.advance(9),a.transparentTerrain=this.renderTransparentTerrain(this._renderContext),a.transparentTerrain&&a.hudVisibility&&(s.compositeTransparentTerrainOntoHUDVisibility(),this.renderHUD(0,s.framebuffer),this.performanceInfo.advance(16)),this.performanceInfo.advance(10),a.transparentTerrain&&s.compositeTransparentTerrainOntoMain(),s.renderToTargets((()=>{this.renderInternalSlot(8,this._renderContext),this._renderPlugins.render(15,this._renderContext),this._renderPlugins.render(16,this._renderContext)}),s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(11),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain((()=>{this._renderPlugins.render(17,this._renderContext)}),2),this.performanceInfo.advance(12),this.renderOccluded(),this.performanceInfo.advance(13);const h=!n&&this._magnifierHelper.enabled,o=h&&t.isNone(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(o),this.renderAntiAliasing(this._antialiasing,this._offscreenRendering.colorTexture)||this._compositingHelper.composite(this._offscreenRendering.colorTexture,0),this.performanceInfo.advance(14),this.renderHUD(1,o),this.performanceInfo.advance(17),this.renderHighlights(this._renderContext.camera,e),this.performanceInfo.advance(15),h&&this._magnifierHelper.render(this._rctx,this._bindParameters),o!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,0)),this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera),this._sliceHelper.plane=i,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()},d.readDepthPixels=function(e,r,t,n,s){const i=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this.needsLinearDepth()){this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const e=17664;this._rctx.clearSafe(e,255),this.renderGeometryPass(2),this._rctx.gl.flush(),this._rctx.gl.finish()}i.readPixels(e,r,t,n,6408,5121,s)},d.renderEdges=function(e){const r=this._edgeView;t.isSome(r)&&r.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain((()=>r.render(this._bindParameters,e)),1)},d.renderShadowMap=function(e,r,t){const n=this._shadowMap;if(n.enabled){_.ENABLE_PROFILE_DEPTH_RANGE&&o.begin("depthRange");const s=this.computeDepthRange(r);_.ENABLE_PROFILE_DEPTH_RANGE&&o.end("depthRange"),n.prepare(r,t,s);const i=n.getCascades();for(let e=0;e<i.length;++e){const r=i[e];r.camera.setGLViewport(this._rctx),this.ensureCameraBindParameters(this._renderContext,r.camera),this.renderGeometryPass(4)}n.finish(e),r.setGLViewport(this._rctx)}n.bindToAllPrograms(this._shaderTechniqueRepository)},d.needsLinearDepth=function(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled},d.renderLinearDepth=function(){this.needsLinearDepth()?this._offscreenRendering.renderToTargets((()=>this.renderGeometryPass(2)),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)},d.renderNormal=function(){this._ssaoHelper.enabled?this._offscreenRendering.renderToTargets((()=>{this.renderGeometryPass(3)}),this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)},d.computeDepthRange=function(e){const r=C.depthRangeFromScene(e,this._content,this._stage.getLayers());return P.union(r,this.renderPlugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r},d.renderGeometryPass=function(e){this._renderContext.pass=e,this.renderOpaqueGeometry(this._renderContext),this.renderTransparentGeometry(this._renderContext),this.renderTransparentTerrain(this._renderContext)},d.renderOpaqueGeometry=function(e){this._renderPlugins.render(1,e),this._renderPlugins.render(2,e),this.renderInternalSlot(3,e),this._renderPlugins.render(4,e),e.ssaoHelper&&e.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository),this._renderPlugins.render(14,this._renderContext)},d.renderTransparentGeometry=function(e){this.renderInternalSlot(5,e),this._renderPlugins.render(6,e),e.ssaoHelper&&e.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository)},d.renderTransparentTerrain=function(e){return this._renderPlugins.render(7,e)},d.renderHUDVisibility=function(e){let r=!1;return e.offscreenRenderingHelper&&e.offscreenRenderingHelper.renderHUDVisibility((()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper?this._renderContext.offscreenRenderingHelper.hudVisibilityTexture:null,r=this.renderInternalSlot(12,e)})),r},d.renderHUD=function(e,r){this._oitEnabled?(this.renderOrderIndependentTransparency((()=>this.renderHUDElements(e)),!0),this._rctx.bindFramebuffer(r),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,2)):0===e?this._offscreenRendering.renderToTargets((()=>this.renderHUDElements(0)),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this.renderHUDElements(e)},d.renderHUDElements=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this.renderInternalSlot(21,this._renderContext),this.renderInternalSlot(18,this._renderContext),this.renderInternalSlot(19,this._renderContext)},d.renderHighlights=function(e,r){const n=this._highlightHelper;if(!(!!n&&n.enabled&&(this._hasHighlights||this._renderPlugins.needsHighlight)))return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const s=n.profilingCallback&&R.startMeasurement(this._renderContext.rctx);this._renderContext.highlightDepthTexture=this._bindParameters.highlightDepthTexture;const i=this._offscreenRendering.renderToTargets((()=>{this.renderGeometryPass(5),this._rctx.clearSafe(256),this.renderHUDElements(2)}),this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);n.render(e,i,r),t.isSome(s)&&n.profilingCallback&&s.stop((e=>{n.profilingCallback&&n.profilingCallback(e)}))},d.renderOrderIndependentTransparency=function(e,r){if(this._oitEnabled&&this._rctx.capabilities.textureFloat&&this._rctx.capabilities.textureFloat.textureFloat&&this._rctx.capabilities.colorBufferFloat&&this._rctx.capabilities.colorBufferFloat.textureFloat){const t=t=>{this._renderContext.transparencyPassType=t,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._offscreenRendering.renderOITPass((()=>e()),t,r)},n=this._renderContext.pass;this._renderContext.pass=1,t(1),this._renderContext.pass=0,t(0),t(2),this._offscreenRendering.compositeTransparentOntoOpaque(r),this._renderContext.transparencyPassType=3,this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType,this._renderContext.pass=n}else e()},d.renderOccluded=function(){let e=0;this._materialRenderers.forEach(((r,t)=>{t&&t.isVisible()&&8===t.renderOccluded&&(e|=t.renderOccluded,V.push(t))}));const r=this._offscreenRendering,t=this._renderContext,n=(t,n,s=(()=>i(n)),a=!0,h=!0)=>{0!=(e&n)&&(r.renderToTargets(s,r.tmpColor,r.mainDepth,[0,0,0,0],a,h),r.compositeOccludedOntoMain(t))};0!==V.length&&(this.renderInternalSlot(10,t,V),n(.5,8,(()=>this.renderInternalSlot(11,t,V)),!1,!1),V.length=0),this._materialRenderers.forEach(((r,t)=>{t&&t.isVisible()&&(4===t.renderOccluded||2===t.renderOccluded||16===t.renderOccluded)&&(e|=t.renderOccluded,F.push(t))}));const s=this._renderPlugins.renderOccludedFlags;if(e|=s,!e)return;const i=e=>{t.renderOccludedMask=e,s>1&&this._renderPlugins.render(9,t),this.renderInternalSlot(3,t,F),this.renderInternalSlot(5,t,F),this.renderInternalSlot(8,t,F),t.resetRenderOccludedMask()};t.pass=0,n(.5,4,(()=>i(4)),!0,2),n(.5,2,(()=>i(2)),!0,2),n(1,16,(()=>i(16)),!0,2),F.length=0},d.renderAntiAliasing=function(e,r){if(1===e){if(this._smaaPass.loadResources((()=>this.requestRender())),this._smaaPass.enable())return this._smaaPass.render({colorTexture:r}),!0}else this._smaaPass.disable();return!1},d.ensureCameraBindParameters=function(e,r){this._renderContext.camera=r,this._bindParameters.camera=e.camera,this._bindParameters.inverseViewport[0]=1/e.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/e.camera.fullViewport[3]},d.ensureBindParameters=function(e,r){this.ensureCameraBindParameters(e,r);const t=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=e.shadowMap,this._bindParameters.shadowMappingEnabled=!!e.shadowMap&&e.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!e.ssaoHelper&&e.ssaoHelper.enabled,this._bindParameters.slicePlane=e.sliceHelper&&e.sliceHelper.plane,this._bindParameters.hasOccludees=e.hasOccludees,this._bindParameters.linearDepthTextureID=3,this._bindParameters.lastFrameColorTextureID=4,this._bindParameters.hudVisibilityTexture=t?t.hudVisibilityTexture:null,this._bindParameters.highlightDepthTexture=t&&t.depthTexture||this.getFallbackDepthTexture()},d.ensureBindParametersSSR=function(e){this._waterReflectionEnabled?(a.translate(k,e.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),a.translate(G,e.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),a.invert(G,G),a.invert(q,e.camera.projectionMatrix),a.multiply(L,G,q),a.multiply(L,k,L),a.multiply(L,e.lastFrameCamera.projectionMatrix,L),this._renderContext.ssrParams.camera=e.camera,this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=L,this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null,this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this._waterReflectionEnabled},d.renderInternalSlot=function(e,r,n){const s=0===r.pass?this.performanceInfo.stats:null;let i=!1;return this._bindParameters.slot=e,t.isSome(n)?n.forEach((n=>{if(!u.materialPredicate(n,r))return;const s=this._materialRenderers.get(n);t.isSome(s)&&(i=s.render(e,r,this._bindParameters)||i)})):this._materialRenderers.forEach(((t,n)=>{u.materialPredicate(n,r)&&(i=t.render(e,r,this._bindParameters,s)||i)})),i},d.getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=c.createEmptyDepthTexture(this._rctx)),this._fallbackDepthStencilTexture},d.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}},e._createClass(r,[{key:"updating",get:function(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources}},{key:"camera",set:function(e){this._camera.copyFrom(e),this.requestRender()},get:function(){return this._camera}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return null===this._bindParameters.reprojectionMat||a.equals(this._bindParameters.reprojectionMat,U)}},{key:"hasShadowsEnabled",get:function(){var e;return!(null==(e=this._shadowMap)||!e.enabled)}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"canRender",get:function(){return this._camera.fullWidth>0&&this._camera.fullHeight>0}},{key:"test",get:function(){return{antialiasing:this._antialiasing,offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,materialRenderers:this._materialRenderers,oitEnabled:this._oitEnabled}}}]),r}();const F=[],V=[],k=d.create(),q=d.create(),G=d.create(),L=d.create(),U=d.create();return O}));
