/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./Util","./BoundingInfo","./ContentObject","./geometryDataUtils"],(function(t,e,n,i,r,o,s){"use strict";let u=function(t){function o(e,n=[],i=0,r=-1){var o;(o=t.call(this)||this)._primitiveType=i,o.edgeIndicesLength=r,o.type=2,o._vertexAttributes=new Map,o._indices=new Map,o._boundingInfo=null;for(const[t,s]of e)s&&o._vertexAttributes.set(t,{...s});if(null==n||0===n.length){const t=c(o._vertexAttributes),e=s.generateDefaultIndexArray(t);o.edgeIndicesLength=o.edgeIndicesLength<0?t:o.edgeIndicesLength;for(const n of o._vertexAttributes.keys())o._indices.set(n,e)}else for(const[t,s]of n)s&&(o._indices.set(t,g(s)),"position"===t&&(o.edgeIndicesLength=o.edgeIndicesLength<0?o._indices.get(t).length:o.edgeIndicesLength));return o}e._inheritsLoose(o,t);var u=o.prototype;return u.getMutableAttribute=function(t){const e=this._vertexAttributes.get(t);return e&&!e.exclusive&&(e.data=Array.from(e.data),e.exclusive=!0),e},u.computeAttachmentOrigin=function(t){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(t):this.computeAttachmentOriginPoints(t)},u.computeAttachmentOriginTriangles=function(t){const e=this.indices.get("position"),n=this.vertexAttributes.get("position");return s.computeAttachmentOriginTriangles(n,e,t)},u.computeAttachmentOriginPoints=function(t){const e=this.indices.get("position"),n=this.vertexAttributes.get("position");return s.computeAttachmentOriginPoints(n,e,t)},u.invalidateBoundingInfo=function(){this._boundingInfo=null},u._calculateBoundingInfo=function(){const t=this.indices.get("position");if(0===t.length)return null;const e=0===this.primitiveType?3:1;i.assert(t.length%e==0,"Indexing error: "+t.length+" not divisible by "+e);const n=s.generateDefaultIndexArray(t.length/e),o=this.vertexAttributes.get("position");return new r.BoundingInfo(n,e,t,o)},e._createClass(o,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const t=this._indices.values().next().value;return t?t.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){return n.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}}]),o}(o.ContentObject);function c(t){const e=t.values().next().value;return null==e?0:e.data.length/e.size}function g(t){if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}t.Geometry=u,Object.defineProperty(t,"__esModule",{value:!0})}));
