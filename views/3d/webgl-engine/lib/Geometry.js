/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./BoundingInfo","./ContentObject","./geometryDataUtils","./Util"],(function(t,e,n,i,r,o,s){"use strict";let u=function(t){function r(e,n=[],i=0,r=-1){var s;(s=t.call(this)||this)._primitiveType=i,s.edgeIndicesLength=r,s.type=2,s._vertexAttributes=new Map,s._indices=new Map,s._boundingInfo=null;for(const[t,o]of e)o&&s._vertexAttributes.set(t,{...o});if(null==n||0===n.length){const t=c(s._vertexAttributes),e=o.generateDefaultIndexArray(t);s.edgeIndicesLength=s.edgeIndicesLength<0?t:s.edgeIndicesLength;for(const n of s._vertexAttributes.keys())s._indices.set(n,e)}else for(const[t,o]of n)o&&(s._indices.set(t,g(o)),"position"===t&&(s.edgeIndicesLength=s.edgeIndicesLength<0?s._indices.get(t).length:s.edgeIndicesLength));return s}e._inheritsLoose(r,t);var u=r.prototype;return u.getMutableAttribute=function(t){const e=this._vertexAttributes.get(t);return e&&!e.exclusive&&(e.data=Array.from(e.data),e.exclusive=!0),e},u.computeAttachmentOrigin=function(t){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(t):this.computeAttachmentOriginPoints(t)},u.computeAttachmentOriginTriangles=function(t){const e=this.indices.get("position"),n=this.vertexAttributes.get("position");return o.computeAttachmentOriginTriangles(n,e,t)},u.computeAttachmentOriginPoints=function(t){const e=this.indices.get("position"),n=this.vertexAttributes.get("position");return o.computeAttachmentOriginPoints(n,e,t)},u.invalidateBoundingInfo=function(){this._boundingInfo=null},u._calculateBoundingInfo=function(){const t=this.indices.get("position");if(0===t.length)return null;const e=0===this.primitiveType?3:1;s.assert(t.length%e==0,"Indexing error: "+t.length+" not divisible by "+e);const n=o.generateDefaultIndexArray(t.length/e),r=this.vertexAttributes.get("position");return new i.BoundingInfo(n,e,t,r)},e._createClass(r,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const t=this._indices.values().next().value;return t?t.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){return n.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}}]),r}(r.ContentObject);function c(t){const e=t.values().next().value;return null==e?0:e.data.length/e.size}function g(t){if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}t.Geometry=u,Object.defineProperty(t,"__esModule",{value:!0})}));
