/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/mat4f64","../../../../chunks/vec3","./AttributeArray","./basicInterfaces","./BoundingInfo","./ContentObject","./ContentObjectType","./geometryDataUtils","./Indices","./Object3DStateID","./Util","./VertexAttribute","../materials/renderers/utils"],(function(t,e,n,i,r,s,o,u,a,c,h,g,l,d,f,b){"use strict";let m=function(t){function a(e,n,i=[],r=null,s=c.ContentObjectType.Mesh,o=null,u=-1){var a;(a=t.call(this)||this).material=e,a.mapPositions=r,a.type=s,a.objectAndLayerIdColor=o,a.edgeIndicesLength=u,a.visible=!0,a._vertexAttributes=new Map,a._indices=new Map,a._boundingInfo=null;for(const[t,c]of n)c&&a._vertexAttributes.set(t,{...c});if(null==i||0===i.length){const t=I(a._vertexAttributes),e=g.generateDefaultIndexArray(t);a.edgeIndicesLength=a.edgeIndicesLength<0?t:a.edgeIndicesLength;for(const n of a._vertexAttributes.keys())a._indices.set(n,e)}else for(const[t,c]of i)c&&(a._indices.set(t,g.compactIndices(c)),t===f.VertexAttribute.POSITION&&(a.edgeIndicesLength=a.edgeIndicesLength<0?a._indices.get(t).length:a.edgeIndicesLength));return a}e._inheritsLoose(a,t);var m=a.prototype;return m.instantiate=function(t={}){const e=new a(t.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach(((t,n)=>{t.exclusive=!1,e._vertexAttributes.set(n,t)})),this._indices.forEach(((t,n)=>e._indices.set(n,t))),e._boundingInfo=this._boundingInfo,e.transformation=t.transformation||this.transformation,e},m.getMutableAttribute=function(t){let e=this._vertexAttributes.get(t);return e&&!e.exclusive&&(e={...e,exclusive:!0,data:s.cloneAttributeData(e.data)},this._vertexAttributes.set(t,e)),e},m.computeAttachmentOrigin=function(t){return!!(this.type===c.ContentObjectType.Mesh?this._computeAttachmentOriginTriangles(t):this.type===c.ContentObjectType.Line?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(n.isSome(this._transformation)&&r.transformMat4(t,t,this._transformation),!0)},m._computeAttachmentOriginTriangles=function(t){const e=this.indices.get(f.VertexAttribute.POSITION),n=this.vertexAttributes.get(f.VertexAttribute.POSITION);return h.computeAttachmentOriginTriangles(n,e,t)},m._computeAttachmentOriginLines=function(t){const e=this.vertexAttributes.get(f.VertexAttribute.POSITION),n=this.indices.get(f.VertexAttribute.POSITION);return h.computeAttachmentOriginLines(e,n,n&&_(this.material.parameters,e,n),t)},m._computeAttachmentOriginPoints=function(t){const e=this.indices.get(f.VertexAttribute.POSITION),n=this.vertexAttributes.get(f.VertexAttribute.POSITION);return h.computeAttachmentOriginPoints(n,e,t)},m.invalidateBoundingInfo=function(){this._boundingInfo=null},m._calculateBoundingInfo=function(){const t=this.indices.get(f.VertexAttribute.POSITION),e=this.vertexAttributes.get(f.VertexAttribute.POSITION);if(!t||0===t.length||!e)return null;const n=this.type===c.ContentObjectType.Mesh?3:1;d.assert(t.length%n==0,"Indexing error: "+t.length+" not divisible by "+n);const i=g.generateDefaultIndexArray(t.length/n);return new u.BoundingInfo(i,n,t,e)},m.addHighlight=function(){const t=new l.Object3DStateID(o.Object3DState.Highlight);return this.highlights=b.addObject3DStateID(this.highlights,t),t},m.removeHighlight=function(t){this.highlights=b.removeObject3DStateID(this.highlights,t)},e._createClass(a,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const t=this._indices.values().next().value;return t?t.length:0}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){return n.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}},{key:"transformation",get:function(){return n.unwrapOr(this._transformation,i.IDENTITY)},set:function(t){this._transformation=t&&t!==i.IDENTITY?i.clone(t):null}},{key:"shaderTransformation",get:function(){return n.isSome(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}},{key:"shaderTransformer",get:function(){return this._shaderTransformer},set:function(t){this._shaderTransformer=t}},{key:"hasVolatileTransformation",get:function(){return n.isSome(this._shaderTransformer)}}]),a}(a.ContentObject);function I(t){const e=t.values().next().value;return null==e?0:e.data.length/e.size}function _(t,e,n){return!(!("isClosed"in t)||!t.isClosed)&&(n?n.length>2:e.data.length>6)}t.Geometry=m,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
