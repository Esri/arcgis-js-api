/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],(function(e,t,a){"use strict";function i(e,t){return new m(e,h,t)}function r(e,t){const{curvatureDependent:a,scaleStart:i,scaleFallOffRange:r}=h;return new m(e,{curvatureDependent:{min:{curvature:a.min.curvature,tiltAngle:a.min.tiltAngle,scaleFallOffFactor:v.curvatureDependent.min.scaleFallOffFactor},max:{curvature:a.max.curvature,tiltAngle:a.max.tiltAngle,scaleFallOffFactor:v.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:r,minPixelSize:v.minPixelSize},t)}function n(e){return Math.abs(e*e*e)}function l(e,t,a){const i=a.parameters,r=a.paddingPixelsOverride;return P.scale=Math.min(i.divisor/(t-i.offset),1),P.factor=n(e),P.minPixelSize=i.minPixelSize,P.paddingPixels=r,P}function c(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function s(e,t){return Math.max(a.lerp(e*t.scale,e,t.factor),c(e,t))}function o(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,c(e[1],t)/e[1]),1);return i[0]=a.lerp(e[0]*r,e[0],t.factor),i[1]=a.lerp(e[1]*r,e[1],t.factor),i}function u(e,t,a){const i=l(e,t,a);return i.minPixelSize=0,i.paddingPixels=0,s(1,i)}function d(e,t,a,i){i.scale=u(e,t,a),i.factor=0,i.minPixelSize=a.parameters.minPixelSize,i.paddingPixels=a.paddingPixelsOverride}function f(e,t,a=[0,0]){const i=Math.min(Math.max(t.scale,c(e[1],t)/e[1]),1);return a[0]=e[0]*i,a[1]=e[1]*i,a}function p(e,t,a,i){return s(e,l(t,a,i))}let m=function(){function e(e,t,a,i=g(),r){this.viewingMode=e,this.description=t,this.ellipsoidRadius=a,this.parameters=i,this._paddingPixelsOverride=r,2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}var i=e.prototype;return i.update=function(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this.calculateParameters(e,this.ellipsoidRadius,this.parameters),!0)},i.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this},i.calculateParameters=function(e,t,a){const{scaleStart:i,scaleFallOffRange:r,minPixelSize:n}=this.description,{fovY:l,distance:c}=e,s=this.calculateCurvatureDependentParameters(e,t),o=this.coverageCompensation(e,t,s),{tiltAngle:u,scaleFallOffFactor:d}=s,f=Math.sin(u)*c,p=.5*Math.PI-u-l*(.5-i*o),m=f/Math.cos(p),h=p+l*r*o,v=(m-d*(f/Math.cos(h)))/(1-d);return a.camera.fovY=e.fovY,a.camera.distance=e.distance,a.offset=v,a.divisor=m-v,a.minPixelSize=n,a},i.calculateCurvatureDependentParametersLocal=function(e,t,a=x){return a.tiltAngle=this.description.curvatureDependent.min.tiltAngle,a.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,a},i.calculateCurvatureDependentParametersGlobal=function(e,t,i=x){const r=this.description.curvatureDependent,n=1+e.distance/t,l=Math.sqrt(n*n-1),[c,s]=[r.min.curvature,r.max.curvature],o=a.clamp((l-c)/(s-c),0,1),[u,d]=[r.min,r.max];return i.tiltAngle=a.lerp(u.tiltAngle,d.tiltAngle,o),i.scaleFallOffFactor=a.lerp(u.scaleFallOffFactor,d.scaleFallOffFactor,o),i},i.surfaceCoverageCompensationLocal=function(e,t,a){return(e.fovY-a.tiltAngle)/e.fovY},i.surfaceCoverageCompensationGlobal=function(e,t,a){const i=t*t,r=a.tiltAngle+.5*Math.PI,{fovY:n,distance:l}=e,c=l*l+i-2*Math.cos(r)*l*t,s=Math.sqrt(c),o=Math.sqrt(c-i);return(Math.acos(o/s)-Math.asin(t/(s/Math.sin(r)))+.5*n)/n},t._createClass(e,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]),e}();const h={curvatureDependent:{min:{curvature:a.deg2rad(10),tiltAngle:a.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:a.deg2rad(70),tiltAngle:a.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},v={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function g(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const P={scale:0,factor:0,minPixelSize:0,paddingPixels:0},x={tiltAngle:0,scaleFallOffFactor:0};e.applyPrecomputedScaleFactor=f,e.applyScaleFactor=s,e.applyScaleFactorVec2=o,e.getLabelSettings=r,e.getSettings=i,e.precomputeScaleFactor=d,e.scale=p,Object.defineProperty(e,"__esModule",{value:!0})}));
