/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../core/mathUtils","../../../../chunks/vec3f64","../../../../chunks/vec3","../../support/mathUtils","../../../../chunks/mat3f64","../../../../chunks/mat3"],(function(t,e,i,s,n,o){"use strict";const a=e.create(),c=e.create(),r=e.create(),h=e.create(),p=e.create(),u=e.create(),l={upward:e.fromValues(0,0,1),forward:e.fromValues(0,1,0),sideway:e.fromValues(1,0,0)},d=n.create();return function(){function m(t=1){this.viewingMode=t,this.center=e.create(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=e.clone(l.forward)}var w=m.prototype;return w.pixelsPerPanAtZoom=function(t){return this.size/2/(this._zoomToPanScale*t)},w.zoomAtPixelsPerPan=function(t){return this.size/2/(this._zoomToPanScale*t)},w.pixelsPerRotateAtZoom=function(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t},w.compareTo=function(t,e){if(e||(e={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),1===this.viewingMode){const n=(i.length(this.center)+i.length(t.center))/2;e.pan=s.angle(this.center,t.center)*n}else e.pan=i.distance(this.center,t.center);let n=Math.abs(t.yaw-this.yaw);n>=Math.PI&&(n=2*Math.PI-n);const o=Math.abs(t.pitch-this.pitch);return e.rotate=Math.max(n,o),e.sourceZoom=this.distance,e.targetZoom=t.distance,e},w.interpolate=function(e,n,o){1===this.viewingMode?s.slerp(e.center,n.center,o.pan,this.center):i.lerp(this.center,e.center,n.center,o.pan),this.distance=t.lerp(e.distance,n.distance,o.zoom),this.pitch=t.lerp(e.pitch,n.pitch,o.rotate);let a=e.yaw;const c=n.yaw;Math.abs(c-a)>=Math.PI&&(a+=2*(a<c?1:-1)*Math.PI),this.yaw=t.lerp(a,c,o.rotate)},w.copyFrom=function(t){i.copy(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,i.copy(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode},w.copyFromRenderCamera=function(t){const e=this._lookAtOrientation(t.center,d);i.copy(this.center,t.center),i.subtract(h,t.center,t.eye),i.transformMat3(h,h,e),i.transformMat3(p,t.up,e),this.distance=i.length(h),h[0]/=this.distance,h[1]/=this.distance,h[2]/=this.distance,this.pitch=this._eyeUpToPitch(h),this.yaw=this._eyeUpToYaw(h,p),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)},w.copyFromCommon=function(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)},w.copyToRenderCamera=function(t){const e=this._lookAtOrientation(this.center,d);o.transpose(e,e),this._axisAngleVec3(l.sideway,this.pitch-Math.PI/2,l.forward,h),this._axisAngleVec3(l.upward,this.yaw,h),this._axisAngleVec3(l.sideway,this.pitch-Math.PI/2,l.upward,p),this._axisAngleVec3(l.upward,this.yaw,p),i.scale(h,h,this.distance),i.transformMat3(h,h,e),i.transformMat3(p,p,e),t.center=this.center,t.eye=i.subtract(h,this.center,h),t.up=p},w._axisAngleVec3=function(t,e,s,n=s){const o=Math.cos(e),h=Math.sin(e);return i.scale(a,s,o),i.cross(c,t,s),i.scale(c,c,h),i.scale(r,t,(1-o)*i.dot(t,s)),i.add(n,i.add(n,a,c),r)},w._lookAtOrientation=function(t,e){return this._upAtLookAt(t,r),i.cross(a,this.lookAtDirection,r),i.normalize(a,a),0===a[0]&&0===a[1]&&0===a[2]&&i.copy(a,l.sideway),i.cross(c,r,a),i.normalize(c,c),e||(e=n.create()),e[0]=a[0],e[1]=c[0],e[2]=r[0],e[3]=a[1],e[4]=c[1],e[5]=r[1],e[6]=a[2],e[7]=c[2],e[8]=r[2],e},w._upAtLookAt=function(t,e){return 2===this.viewingMode?i.copy(e,l.upward):i.normalize(e,t)},w._eyeUpToPitch=function(t){return Math.PI-s.angle(l.upward,t)},w._eyeUpToYaw=function(t,e){const n=u;return Math.abs(e[2])<.5?(i.copy(n,e),t[2]>0&&i.scale(n,n,-1)):i.copy(n,t),i.cross(c,n,l.upward),i.normalize(c,c),s.angle(l.sideway,c,l.upward)},m}()}));
