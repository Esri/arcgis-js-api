/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../geometry","../../../core/Error","../../../core/mathUtils","../../../core/maybe","../../../core/unitUtils","../../../geometry/Extent","../../../geometry/projection","../../../geometry/SpatialReference","../../../geometry/support/aaBoundingRect","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils","../../../layers/support/LOD","../../../layers/support/TileInfo","../../../geometry/Point"],(function(e,i,t,n,s,o,l,r,a,c,u,h,f,g,p,m){"use strict";const x=12;let v=function(){function e(i){const t=e.checkUnsupported(i);if(o.isSome(t))throw t;const n=o.unwrap(i);this.spatialReference=n.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=a.canProjectToWGS84ComparableLonLat(this.spatialReference)||h.isMars(this.spatialReference)||h.isMoon(this.spatialReference),this.origin=[n.origin.x,n.origin.y],this.pixelSize=n.size[0],this.dpi=n.dpi;const s=n.lods.reduce(((e,i,t)=>(i.level<e.min&&(e.min=i.level,e.minIndex=t),e.max=Math.max(e.max,i.level),e)),{min:1/0,minIndex:0,max:-1/0}),l=n.lods[s.minIndex],r=2**l.level;let c=l.resolution*r,u=l.scale*r;this.levels=new Array(s.max+1);for(let e=0;e<this.levels.length;e++)this.levels[e]={resolution:c,scale:u,tileSize:[c*n.size[0],c*n.size[1]]},c/=2,u/=2}var t=e.prototype;return t.clone=function(){return new e(this.toTileInfo())},t.toTileInfo=function(){return new p({dpi:this.dpi,origin:new m({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(((e,i)=>new g({level:i,scale:e.scale,resolution:e.resolution})))})},t.getExtent=function(e,i,t,n){const s=this.levels[e],o=s.tileSize[0],l=s.tileSize[1];n[0]=this.origin[0]+t*o,n[2]=this.origin[0]+(t+1)*o,n[3]=this.origin[1]-i*l,n[1]=this.origin[1]-(i+1)*l},t.convertExtentToRadians=function(e,i){this._isWebMercator?(i[0]=f.x2lon(e[0]),i[1]=f.y2lat(e[1]),i[2]=f.x2lon(e[2]),i[3]=f.y2lat(e[3])):this._isGCS&&(i[0]=s.deg2rad(e[0]),i[1]=s.deg2rad(e[1]),i[2]=s.deg2rad(e[2]),i[3]=s.deg2rad(e[3]))},t.getExtentGeometry=function(e,i,t,n=new r){return this.getExtent(e,i,t,M),n.spatialReference=this.spatialReference,n.xmin=M[0],n.ymin=M[1],n.xmax=M[2],n.ymax=M[3],n.zmin=void 0,n.zmax=void 0,n},t.ensureMaxLod=function(e){if(null==e)return!1;let i=!1;for(;this.levels.length<=e;){const e=this.levels[this.levels.length-1],t=e.resolution/2;this.levels.push({resolution:t,scale:e.scale/2,tileSize:[t*this.pixelSize,t*this.pixelSize]}),i=!0}return i},t.capMaxLod=function(e){this.levels.length>e+1&&(this.levels.length=e+1)},t.getMaxLod=function(){return this.levels.length-1},t.scaleAtLevel=function(e){return this.levels[0].scale/2**e},t.levelAtScale=function(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E},t.resolutionAtLevel=function(e){return this.levels[0].resolution/2**e},t.compatibleWith=function(i){if(!(i instanceof e)){if(e.checkUnsupported(i))return!1;i=new e(i)}if(!i.spatialReference.equals(this.spatialReference))return!1;if(i.pixelSize!==this.pixelSize)return!1;const t=Math.min(this.levels.length,i.levels.length)-1,n=this.levels[t].resolution;let o=.5*n;if(!s.floatEqualAbsolute(i.origin[0],this.origin[0],o)||!s.floatEqualAbsolute(i.origin[1],this.origin[1],o))return!1;return o=.5*n/2**t/this.pixelSize*x,s.floatEqualAbsolute(n,i.levels[t].resolution,o)},t.rootTilesInExtent=function(i,t=null,n=1/0){const s=new Array,l=this.levels[0].tileSize;if(o.isNone(i)||0===l[0]||0===l[1])return s;e.computeRowColExtent(i,l,this.origin,M);let r=M[1],a=M[3],c=M[0],u=M[2];const h=u-c,f=a-r;if(h*f>n){const e=Math.floor(Math.sqrt(n));f>e&&(r=r+Math.floor(.5*f)-Math.floor(.5*e),a=r+e),h>e&&(c=c+Math.floor(.5*h)-Math.floor(.5*e),u=c+e)}for(let e=r;e<a;e++)for(let i=c;i<u;i++)s.push([0,e,i]);return o.isSome(t)&&(t[0]=this.origin[0]+c*l[0],t[1]=this.origin[1]-a*l[1],t[2]=this.origin[0]+u*l[0],t[3]=this.origin[1]-r*l[1]),s},e.computeRowColExtent=function(e,i,t,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-t[0])/i[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-t[0])/i[0])),n[1]=Math.max(0,Math.floor((t[1]-e[3]+s)/i[1])),n[3]=Math.max(0,Math.ceil((t[1]-e[1]-s)/i[1]))},e.isPowerOfTwo=function(e){const i=e.lods,t=i[0].resolution*2**i[0].level;return!i.some((e=>!s.floatEqualRelative(e.resolution,t/2**e.level)))},e.hasGapInLevels=function(e){const i=e.lods.map((e=>e.level));i.sort(((e,i)=>e-i));for(let t=1;t<i.length;t++)if(i[t]!==i[0]+t)return!0;return!1},e.tileSizeSupported=function(e){const i=e.size[1];return i===e.size[0]&&0==(i&i-1)&&i>=128&&i<=512},e.hasOriginPerLODs=function(e){const i=e.origin;return e.lods.some((e=>null!=e.origin&&(e.origin[0]!==i.x||e.origin[1]!==i.y)))},e.getMissingTileInfoError=function(){return new n("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")},e.checkUnsupported=function(i){return o.isNone(i)?d():i.lods.length<1?new n("tilingscheme:generic","Tiling scheme must have at least one level"):e.isPowerOfTwo(i)?e.hasGapInLevels(i)?new n("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):e.tileSizeSupported(i)?e.hasOriginPerLODs(i)?new n("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new n("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new n("tilingscheme:power-of-two","Tiling scheme must be power of two")},e.fromExtent=function(i,t){const n=i[2]-i[0],s=i[3]-i[1],o=l.getMetersPerUnitForSR(t),r=1.2*Math.max(n,s),a=256,c=96,u=.0254,h=new e(new p({size:[a,a],origin:new m({x:i[0]-.5*(r-n),y:i[3]+.5*(r-s)}),lods:[new g({level:0,resolution:r/a,scale:1/(a/c*u/(r*o))})],spatialReference:t}));return h.ensureMaxLod(20),h},e.makeWebMercatorAuxiliarySphere=function(i){const t=new e(e.WebMercatorAuxiliarySphereTileInfo);return t.ensureMaxLod(i),t},e.makeGCSWithTileSize=function(i,t=256,n=16){const s=256/t,o=new e(new p({size:[t,t],origin:new m({x:-180,y:90,spatialReference:i}),spatialReference:i,lods:[new g({level:0,resolution:.703125*s,scale:295497598.570834*s})]}));return o.ensureMaxLod(n),o},i._createClass(e,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]),e}();function d(){return new n("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}v.WebMercatorAuxiliarySphereTileInfo=new p({size:[256,256],origin:new m({x:-20037508.342787,y:20037508.342787,spatialReference:c.WebMercator}),spatialReference:c.WebMercator,lods:[new g({level:0,resolution:156543.03392800014,scale:591657527.591555})]}),v.WebMercatorAuxiliarySphere=v.makeWebMercatorAuxiliarySphere(19);const M=u.create();e.TilingScheme=v,e.getMissingTileInfoError=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
