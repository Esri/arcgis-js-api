/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../chunks/vec2f64","../../../chunks/vec3","../../../geometry/support/aaBoundingBox","../../../geometry/support/buffer/BufferPool","../support/buffer/InterleavedLayout","./terrainUtils","../webgl-engine/lib/VertexAttribute"],(function(t,e,n,i,s,r,o,u,a){"use strict";let l=function(){this.indices=null,this.vertexAttributes=null,this.boundingBox=s.empty(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]},c=function(){function t(t,e,n,i,s){this.attributes=t,this.localOrigin=e,this.index0=n,this.stride=i,this.count=s}var e=t.prototype;return e.getVertexIndex=function(t){return this.getAttributeIndex(t)},e.getAttributeIndex=function(t){return u.internalAssert(0<=t&&t<this.count),this.index0+this.stride*t},e._getVertexRaw=function(t,e){this.attributes.position.getVec(t,e)},e._getNormalRaw=function(t,e){this.attributes.normalCompressed.getVec(t,e)},e.getVertexPos=function(t,e){this._getVertexRaw(this.getAttributeIndex(e),t),i.add(t,t,this.localOrigin)},e.getNormal=function(t,e){const i=n.create();this._getNormalRaw(this.getAttributeIndex(e),i),x(t,i)},e._setNormal=function(t,e,n,i){m(this.attributes.normalCompressed,t,e,n,i)},e._setUV=function(t,e,n){p(this.attributes.uv0,t,e,n)},e.setNormalFromValues=function(t,e,n,i){this._setNormal(this.getAttributeIndex(t),e,n,i)},e.setVertexFromValuesRawPositionUV=function(t,e,n,i,s,r){const o=this.getAttributeIndex(t);this.attributes.position.setValues(o,e,n,i),this._setUV(o,s,r)},e.setVertexFromValuesRawPositionUVNormal=function(t,e,n,i,s,r,o,u,a){const l=this.getAttributeIndex(t);this.attributes.position.setValues(l,e,n,i),this._setUV(l,s,r),this._setNormal(l,o,u,a)},t}();const h=o.newLayout().vec3f(a.VertexAttribute.POSITION).vec2i16(a.VertexAttribute.UV0).vec2i16(a.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}),f=new r.BufferPool((t=>h.createBuffer(t)),(t=>t.count));function d(){f.clear()}function b(t){return f.acquire(t)}function g(t){f.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}function m(t,e,n,i,s){const r=1/(Math.abs(n)+Math.abs(i)+Math.abs(s)),o=n*r,u=i*r,a=s<=0?(o>=0?1:-1)*(1-Math.abs(u)):o,l=s<=0?(u>=0?1:-1)*(1-Math.abs(o)):u;t.setValues(e,A(a),A(l))}function x(t,e){const n=M(e[0]),s=M(e[1]),r=1-Math.abs(n)-Math.abs(s);t[2]=r,r<0?(t[0]=(n>=0?1:-1)*(1-Math.abs(s)),t[1]=(s>=0?1:-1)*(1-Math.abs(n))):(t[0]=n,t[1]=s),i.normalize(t,t)}const V=16384;function p(t,e,n,i){t.setValues(e,n*V,i*V)}function A(t){return e.clamp(Math.round(32767*t),-32767,32767)}function M(t){return e.clamp(t/32767,-1,1)}function v(t,e,n,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),n<i[2]?i[2]=n:n>i[5]&&(i[5]=n)}t.EdgeDescriptor=c,t.PatchGeometry=l,t.acquireTerrainAttributes=b,t.clearCaches=d,t.decodeInt16=M,t.decodeNormal=x,t.encodeInt16=A,t.encodeNormalToBufferFromValues=m,t.encodeUVInBuffer=p,t.minMaxBoundingBox=v,t.releaseGeometry=g,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
