/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import e from"../../../core/ObjectPool.js";import t from"../../../core/PooledArray.js";import{c as s}from"../../../chunks/vec4.js";import{c as i}from"../../../chunks/vec4f64.js";class r{constructor(){this.extent=i(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class u{constructor(){this._queries=new t({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new t({initialSize:30}),this._queryPool=new e(r)}queryVisibleLevelRange(e,t,i,r){const u=this._queryPool.acquire();s(u.extent,e),u.minLevel=t||-Number.MAX_VALUE,u.maxLevel=null!=i?i:Number.MAX_VALUE,u.callback=r,this._queryQueue.push(u)}hasPendingQueries(){return 0!==this._queryQueue.length}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}processQueries(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear()}scaleQueriesForTile(e){const t=e.level;let s=0;for(;s<this._queriesInvPtr;){const i=this._queries.data[s],r=i.extent;t>=i.minLevel&&t<=i.maxLevel&&r[0]<=e.extent[2]&&r[2]>=e.extent[0]&&r[1]<=e.extent[3]&&r[3]>=e.extent[1]?(this._queries.swapElements(s,this._queriesInvPtr-1),this._queriesInvPtr--):s++}}}export{u as ScaleRangeQueries};
