/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection","../../../geometry/SpatialReference","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../../../geometry/support/spatialReferenceUtils","./interfaces","./PatchGeometryFactory","./Tile","../webgl-engine/materials/internal/MaterialUtil"],(function(e,t,r,i,n,a,o,s,l,c,u,h,d){"use strict";let p=function(e){function p(t,r,i){var n;return(n=e.call(this)||this)._horizontalScaleFactor=1,n._extentInRenderSR=s.create(),void 0!==t&&n.init(t,r,i),n}t._inheritsLoose(p,e);var S=p.prototype;return S.init=function(t,o,s){e.prototype.init.call(this,t,o,s);const c=s.view.renderSpatialReference,u=s.spatialReference,h=r.isSome(c)&&l.isPlateCarree(c)&&r.isSome(u)&&u.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=h;const d=this.surface.isWebMercatorOnPlateeCarree,p=this._extentInRenderSR,f=this.extent;if(d){const e=i.fromValues(f[0],f[1],0);n.projectVectorToVector(e,a.WebMercator,e,a.PlateCarree);const t=i.fromValues(f[2],f[3],0);n.projectVectorToVector(t,a.WebMercator,t,a.PlateCarree),p[0]=e[0],p[1]=e[1],p[2]=t[0],p[3]=t[1]}else for(let e=0;e<4;++e)p[e]=f[e]*h;this.centerAtSeaLevel[0]=.5*(p[0]+p[2]),this.centerAtSeaLevel[1]=.5*(p[1]+p[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(p[2]-p[0],p[3]-p[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()},S.updateRadiusAndCenter=function(){this._updateCenter();const e=this._extentInRenderSR,t=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),i=Math.sqrt(t*t+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),a=Math.max(i,n);this._center[h.CenterPosition.MIDDLE][3]=a},S._calculateFrustumVisibilityStatus=function(e){const t=this._aabb(),r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5];let l=!0;for(let u=0;u<6;u++){const t=e[u],h=t[0],d=t[1],p=t[2],f=t[3];if(h*(h>0?r:a)+d*(d>0?i:o)+p*(p>0?n:s)+f>=0)return c.TileFrustumVisibility.OUTSIDE;l=l&&h*(h<0?r:a)+d*(d<0?i:o)+p*(p<0?n:s)+f<=0}return l?c.TileFrustumVisibility.INSIDE:c.TileFrustumVisibility.INTERSECTS},S._aabb=function(){const e=this._extentInRenderSR;return o.wrap(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])},S.intersectsRay=function(e,t,r,i){return f[0]=1/t[0],f[1]=1/t[1],f[2]=1/t[2],d.intersectAabbInvDirBefore(this._aabb(),e,f,r,i)},S.createGeometry=function(){u.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()},S.getDefaultVerticesPerRowOnLevel=function(){return this.level<9?3:2},S.updateCornerElevations=function(){u.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)},S.updateEdgeElevations=function(){u.updateEdgesAndCornersPlanar(this.renderData,this._horizontalScaleFactor)},t._createClass(p,[{key:"horizontalScale",get:function(){return this._horizontalScaleFactor}}]),p}(h.Tile);const f=i.create();e.PlanarPatch=p,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
