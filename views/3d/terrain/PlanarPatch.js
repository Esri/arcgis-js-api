/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection","../../../geometry/SpatialReference","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../../../geometry/support/frustum","../../../geometry/support/spatialReferenceUtils","./PatchGeometryFactory","./Tile","../webgl-engine/materials/internal/MaterialUtil"],(function(e,t,r,n,i,a,o,s,c,l,h,u,d){"use strict";let p=function(e){function p(t,r,n){var i;return(i=e.call(this)||this).horizontalScaleFactor=1,i.isWebmercatorOnPlateeCaree=!1,i.extentInRenderSR=s.create(),void 0!==t&&i.init(t,r,n),i}t._inheritsLoose(p,e);var b=p.prototype;return b.init=function(t,o,s){e.prototype.init.call(this,t,o,s);const c=s.view.renderSpatialReference,h=s.spatialReference,u=r.isSome(c)&&l.isPlateCarree(c),d=u&&h.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=d,this.isWebmercatorOnPlateeCaree=u&&h.isWebMercator;const p=this.extentInRenderSR,f=this.extent;if(this.isWebmercatorOnPlateeCaree){const e=n.fromValues(f[0],f[1],0);i.projectVectorToVector(e,a.WebMercator,e,a.PlateCarree);const t=n.fromValues(f[2],f[3],0);i.projectVectorToVector(t,a.WebMercator,t,a.PlateCarree),p[0]=e[0],p[1]=e[1],p[2]=t[0],p[3]=t[1]}else for(let e=0;e<4;++e)p[e]=f[e]*d;this.centerAtSeaLevel[0]=.5*(p[0]+p[2]),this.centerAtSeaLevel[1]=.5*(p[1]+p[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(p[2]-p[0],p[3]-p[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()},b.updateRadiusAndCenter=function(){this._updateCenter();const e=this.extentInRenderSR,t=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),n=Math.sqrt(t*t+r*r),i=.5*(this.elevationBounds[0]-this.elevationBounds[1]),a=Math.max(n,i);this._center[u.CenterPosition.MIDDLE][3]=a},b._isVisible=function(e){return c.intersectsAABB(e,this._aabb())},b._aabb=function(){const e=this.extentInRenderSR;return o.wrap(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])},b.intersectsRay=function(e,t,r,n,i){f[0]=1/t[0],f[1]=1/t[1],f[2]=1/t[2];const a=i*(this.extent[2]-this.extent[0])*this.horizontalScaleFactor*.1;return d.intersectAabbInvDirBefore(this._aabb(),e,f,r+a,n)},b.createGeometry=function(e,t){h.createPlanarGlobePatch(e,this.extent,t,this.horizontalScaleFactor,this.isWebmercatorOnPlateeCaree,this.renderData),this.setMemoryDirty()},b.getDefaultVerticesPerRowOnLevel=function(){return this.level<9?3:2},p}(u.Tile);const f=n.create();e.PlanarPatch=p,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
