/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../Color","../../../core/Accessor","../../../core/maybe","../../../core/ObjectPool","../../../core/PooledArray","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","../../../chunks/mat4","../../../chunks/mat4f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../chunks/vec4","../../../chunks/vec4f64","../../../geometry/support/aaBoundingBox","../../../geometry/support/buffer/BufferView","../../../support/requestImageUtils","./OverlayRenderer","./PatchGeometryFactory","./PatchRenderData","./ScaleRangeQueries","./TerrainConst","./TileRenderer","./tileUtils","../webgl-engine/collections/Component/ComponentIntersectionData","../webgl-engine/core/shaderLibrary/Slice.glsl","../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl","../webgl-engine/core/shaderLibrary/util/View.glsl","../webgl-engine/lib/glUtil3D","../webgl-engine/lib/Intersector","../webgl-engine/lib/screenSizePerspectiveUtils","../webgl-engine/lib/verticalOffsetUtils","../webgl-engine/materials/internal/MaterialUtil","../webgl-engine/shaders/TerrainTechnique"],(function(e,t,i,r,n,s,a,o,l,c,d,h,u,f,g,p,T,y,m,b,v,_,R,x,S,k,O,D,C,q,P,w,B,U,E,I,N,G){"use strict";const M=7,A=10,F=m.create(),L=y.create();let z=function(t){function r(e){var i;return(i=t.call(this,e)||this).type=2,i.isGround=!0,i.tileSize=256,i.rctx=null,i._isTransparent=!1,i._scaleRangeQueries=new S.ScaleRangeQueries,i.renderDataPool=new s(x.PatchRenderData),i._patchGroups=new a({allocator:e=>e||{root:null,origin:null,patches:new a},deallocator:e=>(e.root=null,e.origin=null,e.patches.clear(),e)}),i.patchGroupsDirty=!0,i.patchGroupsMap=new Map,i.tileIterator=new D.IteratorPreorder,i.highestVisibleLODTile=null,i.visible=!0,i._opaque=!0,i._skirtScale=1,i._velvetOverground=!0,i.castShadows=!0,i._ssrEnabled=!1,i.emptyTex=null,i.tileRenderer=null,i.tileBackgroundInitialized=!1,i.tileBackgroundUpdating=!1,i.stencilEnabledLayerExtents=[],i.numTrianglesRendered=0,i.numTilesRendered=0,i.numTilesCulled=0,i.numOriginsRendered=0,i.overlayOpacity=1,i.needsHighlight=!1,i.renderOccludedFlags=1,i}e._inheritsLoose(r,t);var o=r.prototype;return o.initialize=function(){const e=[1,6,8];this.stage.addRenderPlugin(e,this)},o.destroy=function(){this.stage.removeRenderPlugin(this),R.clearCaches()},o.setDebugScreenSizePerspective=function(e){this.shaderTechniqueConfig.screenSizePerspective!==e&&(this.shaderTechniqueConfig.screenSizePerspective=e,this.setNeedsRender())},o.setRootTiles=function(e){this._rootTiles=e,this.setNeedsRender()},o.setNeedsHighlight=function(e){this.needsHighlight=e,this.setNeedsRender()},o.setRenderOccludedOverlay=function(e){this.renderOccludedFlags=e?_.overlayRenderOccludedFlag:1,this.setNeedsRender()},o.setStencilEnabledLayerExtents=function(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()},o.setTileSize=function(e){this.tileSize=e,this.tileRenderer&&(this.tileRenderer.tileSize=e),this.setNeedsRender()},o.loadTile=function(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e)),this.updateTileGeometry(e),this.updateTileTexture(e,128)},o.queryVisibleLevelRange=function(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()},o.updateTileTexture=function(e,t){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(e,128===t?0:2),this.setNeedsRender(),e.resetPendingUpdate(t))},o.updateTileGeometry=function(e){for(const t of e.layerInfo[0])t.pendingUpdates&=-33;e.resetPendingUpdate(32),e.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()},o.unloadTile=function(e){e.renderData&&(e.renderData.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(e.renderData),e.renderData.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())},o._getLocalOriginOfTile=function(e){const t=A-M,i=Math.max(0,Math.floor((e.level-t)/M)*M);if(this.isGlobal&&0===i)return p.ZEROS;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel},o.setVisibility=function(e){this.visible=e,this.setNeedsRender()},o.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}},o.setNeedsRender=function(e=1){this.patchGroupsDirty=!0,this.context.requestRender(e)},o.setTileBackground=function(e){this.tileBackground=e,this._updateTileBackground()},o.initializeRenderContext=function(e){this.context=e,this.rctx=e.renderContext.rctx,this.shaderTechniques=e.shaderTechniqueRep,this.shaderTechniqueConfig=new G.TerrainTechniqueConfiguration,this.tileRenderer=new O.TileRenderer(this.rctx,this.tileSize,this.shaderTechniques),this.tileBackground&&this._updateTileBackground(),this.emptyTex=B.createEmptyTexture(this.rctx)},o.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null),this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)},o.intersect=function(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=Z,a=Y;g.subtract(s,r,i),g.set(a,1/s[0],1/s[1],1/s[2]);const o=e.results.min,l=e.results.max,c=e.results.ground,d=0===e.options.store,h=!!e.results.ground.target,u=I.getVerticalOffsetTerrain(e.verticalOffset),p=this._skirtScale,T=e.tolerance;let y,v=d&&n.isSome(o.dist)?o.dist:1/0;const _=h=>{const _=h.renderData;if(null==_)return;const x=_.geometryInfo;m.set(F,x.boundingBox);const S=_.localOrigin;n.isSome(u)&&(u.localOrigin=S,u.applyToAabb(F));const k=-p*x.skirtLength;if(0!==k){const e=h.up;m.expandWithOffset(F,k*e[0],k*e[1],k*e[2])}const O=F;if(K[0]=i[0]-S[0],K[1]=i[1]-S[1],K[2]=i[2]-S[2],!N.intersectAabbInvDirBefore(O,K,a,T,v))return;const D=(e,t,i)=>{e.set(this.type,h,t,i,f.IDENTITY),v=d&&n.isSome(o.dist)?o.dist:1/0},q=(a,d)=>{if(n.isSome(d)&&a>=0&&(e.options.backfacesTerrain||g.dot(d,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||null==t||t(i,r,a))){if((null==c.dist||a<c.dist)&&D(c,a,d),e.options.isFiltered)return;2===e.options.store&&(n.isNone(y)?(y=U.newIntersectorResult(e.ray),D(y,a,d),e.results.all.push(y)):a<y.dist&&D(y,a,d)),(null==o.dist||a<o.dist)&&D(o,a,d),0!==e.options.store&&(null==l.dist||a>l.dist)&&D(l,a,d)}},P=J;g.subtract(P,r,S);const w=x.indices,B=x.vertexAttributes,E={data:B.getField("position",b.BufferViewVec3f).typedBuffer,size:3,stride:B.stride/4},I=x.numWithoutSkirtIndices/3;if(!n.isSome(u)&&I>C.componentMinimalSizeForIntersectionData){const e=h.renderData;n.isSome(e.intersectionData)||(e.intersectionData=new C.ComponentIntersectionData(w,0,I,E)),e.intersectionData.intersectRay({r0:K,r1:P},q)}else N.intersectTriangles(K,P,0,I,w,E,null,u,q);if(0!==k){const e=w.length/3;if(this.isGlobal){const t=e-I;if(!n.isSome(u)&&t>C.componentMinimalSizeForIntersectionData){const i=h.renderData;if(!n.isSome(i.skirtIntersectionData)){const r=R.getGlobalSkirtGeometry(w,I,e,B,k,S);i.skirtIntersectionData=new C.ComponentIntersectionData(r.indices,0,t,{data:r.vertices,stride:3})}i.skirtIntersectionData.intersectRay({r0:K,r1:P},q)}else R.intersectSkirtsGlobal(K,P,I,e,w,B,k,S,u,q)}else R.intersectSkirtsLocal(K,P,I,e,w,B,k,u,q)}},x=this._rootTiles;if(n.isSome(x)){(()=>{const t=this.tileIterator;t.reset(x);const r=e.options.invisibleTerrain;for(;!t.done;){const e=t.next();!(e.visible||r&&e.intersectsClippingArea)||!n.isSome(u)&&!e.intersectsRay(i,s,T,v,p)||h&&this._useStencilForTile(e)?t.skipSubtree():_(e)}})()}},o.render=function(e){if(8===e.slot){if(0==(e.renderOccludedMask&_.overlayRenderOccludedFlag))return!1}else{const t=this.opaque?1:6;if(e.slot!==t)return!1}const t=e.pass,i=1===e.scenelightingData.globalFactor,r=this._updatePatchGroups();let n=!1;switch(t){case 0:{const t=e.shadowMap&&e.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==t&&(this.shaderTechniqueConfig.receiveShadows=t);const i=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==i&&(this.shaderTechniqueConfig.overlayMode=i);const s=8===e.slot?3:1;this._renderMaterialPass(e,0,r,s),n=!0;break}case 4:case 6:this.castShadows&&i&&(this._renderAuxiliaryPass(e,3,r,0),n=!0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||(this._renderAuxiliaryPass(e,1,r,0),n=!0);break;case 3:this._renderAuxiliaryPass(e,2,r,0),n=!0;break;case 5:this.needsHighlight&&(this._renderAuxiliaryPass(e,4,r,2),e.rctx.clearSafe(256),n=!0)}return this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender(),n},o._renderMaterialPass=function(e,t,i,r){const{rctx:n,camera:s}=e;this._ssrEnabled=e.ssrParams.ssrEnabled,this._setTerrainTechnique(t,3===r);const a=this._shaderTechnique.program;n.useProgram(a),0!==this.shaderTechniqueConfig.overlayMode&&1===r&&e.ssrParams&&P.bindSSRUniforms(a,e.ssrParams),e.shadowMap.bind(a),e.ssaoHelper.bind(a,e.camera),this._bindOverlayData(a,r),a.setUniformMatrix4fv("viewNormal",s.viewInverseTransposeMatrix),w.bindProjectionMatrix(a,s.projectionMatrix),e.scenelightingData.setUniforms(a,!0);const o=s.viewMatrix;g.set(j,o[12],o[13],o[14]),g.normalize(j,j),a.setUniform3fv("viewDirection",j),this.numTilesRendered=0,this.numTilesCulled=0,this.numTrianglesRendered=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,a,i,r):e.offscreenRenderingHelper.renderToTargets((()=>this._renderPatchGroups(e,a,i,r)),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()},o._renderAuxiliaryPass=function(e,t,i,r){this._setTerrainTechnique(t,3===r);const n=e.rctx,s=this._shaderTechnique.program;if(n.useProgram(s),5===e.pass){const t=e.offscreenRenderingHelper;s.bindTexture(t.depthTexture,"depthTex"),s.setUniform4f("highlightViewportPixelSz",0,0,1/t.width,1/t.height)}else s.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),2!==e.pass&&4!==e.pass&&6!==e.pass||s.setUniform2fv("nearFar",e.camera.nearFar);this._renderPatchGroupsAuxiliary(e,s,i,r)},o._updateTileBackground=function(){if(!this.tileRenderer)return;this.tileBackgroundUpdating=!0;const e=()=>{this.tileBackgroundInitialized=!0,this.tileBackgroundUpdating=!1,this.shaderTechniqueConfig.useGrid=this.tileRenderer.backgroundIsGrid,this.shaderTechniqueConfig.hasBackgroundColor=!this.tileRenderer.backgroundIsGrid&&!!n.isSome(this.tileRenderer.backgroundColor),this.allTiles.forAll((e=>this.tileRenderer.updateTileTexture(e,0))),this.setNeedsRender()};if("string"==typeof this.tileBackground){const t=this.tileBackground;v.requestImage(t).then((i=>{t===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(i,this.tileBackground===k.DEFAULT_TILE_BACKGROUND),e())}))}else{const t=this.tileBackground?i.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(t,!1),e()}},o._updatePatchGroups=function(){const e=this._patchGroups;if(!this.patchGroupsDirty)return e;if(this.highestVisibleLODTile=null,this._renderCollectOrigins(e),0!==this.renderOrder){for(let t=0;t<e.length;t++)D.sortTiles(this.renderOrder,e.data[t].patches);e.sort(((e,t)=>H(e,t,this.renderOrder)))}return this.patchGroupsDirty=!1,e},o._renderCollectOrigins=function(e){const t=this._rootTiles;if(n.isNone(t))return;const i=this.isGlobal;e.clear();for(const r of t){const t=e.pushNew();t.root=r,t.origin=i?p.ZEROS:r.centerAtSeaLevel,t.patches.clear(),this._renderCollectOriginsForRoot(e,t)}e.filterInPlace((e=>e.patches.length>0))},o._renderCollectOriginsForRoot=function(e,t){const i=this.tileIterator;i.resetOne(t.root);const r=this.patchGroupsMap;for(r.clear(),r.set(t.origin,t);!i.done;){const t=i.next(),n=t.renderData;if(!n||t.visible){if(t.level%M==0){const i=e.pushNew();i.root=t,i.origin=t.centerAtSeaLevel,r.set(t.centerAtSeaLevel,i),i.patches.clear()}if(t.rendered){if(n){const e=r.get(n.localOrigin);e&&e.patches.push(t),(!this.highestVisibleLODTile||t.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=t),i.skipSubtree()}}else this.numTilesCulled++}else this.numTilesCulled++,i.skipSubtree()}},o._useStencilForTile=function(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1},o._renderPatchGroupsAuxiliary=function(e,t,i,r){const n=e.rctx;this._shaderTechnique.useStencil=!1,this._shaderTechnique.bindPipelineState(n,e.slot);const s=this.stencilEnabledLayerExtents.length>0;t.setUniformMatrix4fv("proj",e.camera.projectionMatrix),t.setUniform1f("skirtScale",this._skirtScale),0!==r&&this._bindOverlayData(t,r);for(let a=0;a<i.length;a++){const n=i.data[a];this._bindPatchGroupData(t,n,e.camera.eye,e.camera.viewMatrix);for(let i=0;i<n.patches.length;i++)this._renderPatch(e,t,n.patches.data[i],4,s,r)}e.rctx.bindVAO(null)},o._renderPatchGroups=function(e,t,i,r){const s=e.rctx,a=e.camera,o=a.viewMatrix;if(this._shaderTechnique.useStencil=!1,this._shaderTechnique.bindPipelineState(s,e.slot),this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){const e=E.getSettings(this.stage.viewingMode,this.ellipsoidRadius),i=this.pointsOfInterest.centerOnSurfaceFrequent.distance;e.update({distance:i,fovY:a.fovY}),N.bindScreenSizePerspective(e,t,"screenSizePerspective")}const l=this.stencilEnabledLayerExtents.length>0,c=3===r;c&&(t.bindTexture(this.emptyTex,"tex"),t.setUniform1f("blend",1),t.setUniform4fv("texOffsetAndScale",y.ZEROS));const d=n.isSome(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:p.ZEROS;this.shaderTechniqueConfig.hasBackgroundColor&&t.setUniform3fv("backgroundColor",d);const h=c?0:this._skirtScale;t.setUniform1f("skirtScale",h);const u=this.wireframe?1:4;this.shaderTechniqueConfig.textureFadingEnabled&&t.bindTexture(this.emptyTex,"texNext");for(let f=0;f<i.length;f++){const s=i.data[f],d=s.patches;this._bindPatchGroupData(t,s,a.eye,o);const h=e.sliceHelper&&e.sliceHelper.plane;q.bindSliceUniforms(t,this._shaderTechnique.configuration,h,s.origin),e.shadowMap&&e.shadowMap.bindView(t,s.origin),this.numOriginsRendered++;for(let i=0;i<d.length;i++){const s=d.data[i],a=s.renderData.textureReference;if(n.isNone(a))continue;if(!c){this._scaleRangeQueries.scaleQueriesForTile(s),Q(s.renderData.geometryInfo.uvOffsetAndScale,a.offsetAndScale,L),t.setUniform4fv("texOffsetAndScale",L),t.bindTexture(a.texture.texture,"tex");const e=s.renderData.textureFadeFactor,i=e<1?s.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&n.isSome(i)&&e<1?(Q(s.renderData.geometryInfo.uvOffsetAndScale,i.offsetAndScale,L),t.setUniform1f("fadeFactor",e),t.setUniform4fv("nextTexOffsetAndScale",L),t.setUniform3fv("nextTexOpacities",i.opacities),t.bindTexture(i.texture.texture,"texNext")):t.setUniform1f("fadeFactor",1),s.renderData.textureIsFading&&this.setNeedsRender(),t.setUniform3fv("textureOpacities",a.opacities)}const o=this._renderPatch(e,t,s,u,l,r);s.renderOrder=this.numTilesRendered,this.numTilesRendered++,this.numTrianglesRendered+=o/3}}s.bindVAO(null)},o._renderPatch=function(e,t,i,r,s,a){if(n.isNone(i.renderData.vao.indexBuffer))return 0;0!==a&&this._bindOverlayPatchData(t,i.renderData.overlay),s&&(this._shaderTechnique.useStencil=this._useStencilForTile(i),this._shaderTechnique.bindPipelineState(e.rctx,e.slot));const o=0===this._skirtScale?i.renderData.geometryInfo.numWithoutSkirtIndices:i.renderData.vao.indexBuffer.size;return e.rctx.bindVAO(i.renderData.vao),t.assertCompatibleVertexAttributeLocations(i.renderData.vao),e.rctx.drawElements(r,o,i.renderData.vao.indexBuffer.indexType,0),o},o._bindPatchGroupData=function(e,t,i,r){e.setUniform3fv("origin",t.origin),u.translate(W,r,t.origin),e.setUniformMatrix4fv("view",W),e.setUniform3f("camPos",i[0]-t.origin[0],i[1]-t.origin[1],i[2]-t.origin[2])},o._bindOverlayData=function(e,t){if(0===this.shaderTechniqueConfig.overlayMode)return;e.setUniform1f("overlayOpacity",this.overlayOpacity);const i=this.overlayRenderer.overlays;if(i.length>0){const r=i[0],s=r.getColorTexture(t);if(e.bindTexture(n.isSome(s)?s:this.emptyTex,"ovColorTex"),2===this.shaderTechniqueConfig.overlayMode){const i=r.getNormalTexture(t);e.bindTexture(n.isSome(i)?i:this.emptyTex,"ovWaterTex")}}},o._bindOverlayPatchData=function(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)},o._setTerrainTechnique=function(e,t){this.shaderTechniqueConfig.output=e,0===e&&(this.shaderTechniqueConfig.atmosphere=this.isGlobal&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled),this.shaderTechniqueConfig.renderOccluded=t,this.shaderTechniqueConfig.stencilEnabled=!1,this._shaderTechnique=this.shaderTechniques.releaseAndAcquire(G.TerrainTechnique,this.shaderTechniqueConfig,this._shaderTechnique)},e._createClass(r,[{key:"isGlobal",get:function(){return 1===this.stage.viewingMode}},{key:"updating",get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}},{key:"canRender",get:function(){return this.visible&&!!this._rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}},{key:"opaque",get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}},{key:"skirtScale",get:function(){return this._skirtScale},set:function(e){e!==this._skirtScale&&(this._skirtScale=e,this.setNeedsRender())}},{key:"renderPatchBorders",get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(e){this.shaderTechniqueConfig.tileBorders!==e&&(this.shaderTechniqueConfig.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(e){this.shaderTechniqueConfig.backfaceCullingEnabled!==e&&(this.shaderTechniqueConfig.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(e){this._set("renderOrder",e),this.setNeedsRender()}},{key:"velvetOverground",set:function(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}},{key:"layerUid",get:function(){return I.TERRAIN_ID}},{key:"slicePlaneEnabled",get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(e){this.shaderTechniqueConfig.slicePlaneEnabled!==e&&(this.shaderTechniqueConfig.slicePlaneEnabled=e,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(e){this.shaderTechniqueConfig.textureFadingEnabled!==e&&(this.shaderTechniqueConfig.textureFadingEnabled=e,this.setNeedsRender())}},{key:"wireframe",set:function(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll((t=>{var i;return null==(i=t.renderData)?void 0:i.updateGeometry(this.rctx,e)})),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]),r}(r);t.__decorate([o.property()],z.prototype,"tileBackgroundInitialized",void 0),t.__decorate([o.property()],z.prototype,"tileBackgroundUpdating",void 0),t.__decorate([o.property({constructOnly:!0})],z.prototype,"overlayRenderer",void 0),t.__decorate([o.property({constructOnly:!0})],z.prototype,"stage",void 0),t.__decorate([o.property({readOnly:!0})],z.prototype,"isGlobal",null),t.__decorate([o.property({constructOnly:!0})],z.prototype,"allTiles",void 0),t.__decorate([o.property({constructOnly:!0})],z.prototype,"ellipsoidRadius",void 0),t.__decorate([o.property({readOnly:!0})],z.prototype,"updating",null),t.__decorate([o.property({value:!1})],z.prototype,"renderingDisabled",null),t.__decorate([o.property()],z.prototype,"renderPatchBorders",null),t.__decorate([o.property()],z.prototype,"cullBackFaces",null),t.__decorate([o.property({value:1})],z.prototype,"renderOrder",null),t.__decorate([o.property()],z.prototype,"wireframe",null),z=t.__decorate([h.subclass("esri.views.3d.terrain.TerrainRenderer")],z);const V=z;function H(e,t,i){return 0===e.patches.length?-i:0===t.patches.length?i:D.compareTiles(e.patches.data[0],t.patches.data[0],i)}function Q(e,t,i){const r=e[0]*t[2]+t[0],n=e[1]*t[3]+t[1],s=e[2]*t[2],a=e[3]*t[3];T.set(i,r,n,s,a)}const W=f.create(),j=p.create(),Z=p.create(),Y=p.create(),K=p.create(),J=p.create();return V}));
