/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/maybe","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/ObjectPool","../../../core/PooledArray","../../../core/Accessor","../../../Color","../../../chunks/vec3f64","../../../chunks/vec3","../../../chunks/mat4","../../../chunks/mat4f64","../../../chunks/vec4f64","../../../chunks/vec4","../support/buffer/BufferView","../../../geometry/support/aaBoundingBox","../../../support/requestImageUtils","../webgl-engine/core/shaderLibrary/util/View.glsl","../webgl-engine/lib/glUtil3D","../webgl-engine/lib/intersectorUtils","../webgl-engine/lib/screenSizePerspectiveUtils","../webgl-engine/materials/internal/MaterialUtil","../webgl-engine/core/shaderLibrary/Slice.glsl","../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl","./OverlayRenderer","./PatchGeometryFactory","./tileUtils","./PatchRenderData","./TileRenderer","../webgl-engine/shaders/TerrainTechnique","../webgl-engine/statistics/tracer"],(function(e,t,i,r,n,s,a,o,l,c,d,h,u,f,p,g,T,v,b,y,m,x,R,_,S,k,O,P,D,q,E,w,C,U,I,B,N,A){"use strict";const L=R.create(),M=y.create();let F=function(){this.extent=y.create(),this.minLevel=0,this.maxLevel=0,this.callback=null},G=function(t){function i(e){var i;return(i=t.call(this,e)||this).type="Terrain",i.isGround=!0,i.tileSize=256,i.rctx=null,i._isTransparent=!1,i.renderDataPool=new h(I.PatchRenderData),i.patchGroups=new u({allocator:e=>e||{root:null,origin:null,patches:new u},deallocator:e=>(e.root=null,e.origin=null,e.patches.clear(),e)}),i.patchGroupsDirty=!0,i.patchGroupsMap=new Map,i.tileIterator=new U.IteratorPreorder,i.highestVisibleLODTile=null,i.visible=!0,i._opaque=!0,i._skirtScale=1,i._velvetOverground=!0,i.castShadows=!0,i._ssrEnabled=!1,i.emptyTex=null,i.tileRenderer=null,i.tileBackgroundInitialized=!1,i.tileBackgroundUpdating=!1,i.stencilEnabledLayerExtents=[],i.numTrianglesRendered=0,i.numTilesRendered=0,i.numTilesCulled=0,i.numOriginsRendered=0,i.clippingExtent=null,i.overlayOpacity=1,i.needsHighlight=!1,i.renderOccludedFlags=1,i.visibleScaleRangeQueries=new u({initialSize:10}),i.visibleScaleRangeQueriesInvPtr=0,i.visibleScaleRangeQueryQueue=new u({initialSize:30}),i.visibleScaleRangeQueryPool=new h(F),i}e._inheritsLoose(i,t);var n=i.prototype;return n.destroy=function(){C.clearCaches()},n.install=function(e){e.addRenderPlugin([2,7,9],this)},n.uninstall=function(e){e.removeRenderPlugin(this)},n.setDebugScreenSizePerspective=function(e){this.shaderTechniqueConfig.screenSizePerspective!==e&&(this.shaderTechniqueConfig.screenSizePerspective=e,this.setNeedsRender())},n.setRootTiles=function(e){this.rootTiles=e,this.setNeedsRender()},n.setNeedsHighlight=function(e){this.needsHighlight=e,this.setNeedsRender()},n.setRenderOccludedOverlay=function(e){this.renderOccludedFlags=e?w.overlayRenderOccludedFlag:1,this.setNeedsRender()},n.setStencilEnabledLayerExtents=function(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()},n.setTileSize=function(e){this.tileSize=e,this.tileRenderer&&(this.tileRenderer.tileSize=e),this.setNeedsRender()},n.loadTile=function(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e)),this.updateTileGeometry(e),this.updateTileTexture(e)},n.queryVisibleLevelRange=function(e,t,i,r){const n=this.visibleScaleRangeQueryPool.acquire();m.copy(n.extent,e),n.minLevel=t||-Number.MAX_VALUE,n.maxLevel=null!=i?i:Number.MAX_VALUE,n.callback=r,this.visibleScaleRangeQueryQueue.push(n),this.setNeedsRender()},n.updateTileTexture=function(e){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(e),this.setNeedsRender(),e.resetPendingUpdate(64))},n.updateTileGeometry=function(e){for(const t of e.layerInfo[0])t.pendingUpdates&=-33;e.resetPendingUpdate(32),e.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()},n.unloadTile=function(e){e.renderData&&(this.releaseTileGeometry(e.renderData),e.renderData.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())},n._getLocalOriginOfTile=function(e){const t=Math.max(0,7*Math.floor((e.lij[0]-3)/7));if("spherical"===this.manifold&&0===t)return g.ZEROS;for(;e.parent&&e.lij[0]>t;)e=e.parent;return e.centerAtSeaLevel},n.setVisibility=function(e){this.visible=e,this.setNeedsRender()},n.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}},n.setNeedsRender=function(e=1){this.patchGroupsDirty=!0,this.initContext.requestRender(e)},n.setTileBackground=function(e){this.tileBackground=e,this._updateTileBackground()},n.initializeRenderContext=function(e){this.initContext=e,this.rctx=e.rctx,this.shaderTechniques=e.shaderTechniqueRep,this.shaderTechniqueConfig=new N.TerrainTechniqueConfiguration,this.tileRenderer=new B(this.rctx,this.tileSize,this.shaderTechniques),this.tileBackground&&this._updateTileBackground(),this.emptyTex=k.createEmptyTexture(this.rctx)},n.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null),this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)},n.intersect=function(e,t,i,n){if(!this.rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=j,a=W;T.subtract(s,n,i),T.set(a,1/s[0],1/s[1],1/s[2]);const o=e.results.min,l=e.results.max,c=e.results.ground,d=0===e.options.store,h=!!e.results.ground.target;let u=null;const f=this.clippingExtent,p=this.tileIterator;p.reset(this.rootTiles);const g=O.getVerticalOffsetTerrain(e.verticalOffset);for(;!p.done;){const v=p.next();if(null===v.renderData||h&&this._useStencilForTile(v))continue;if(e.options.invisibleTerrain){if(!v.visible&&f&&!v.intersectsExtent(f))continue}else if(!v.visible)continue;const y=v.renderData.geometryInfo,m=v.renderData.localOrigin,_=-this._skirtScale*y.skirtLength;if(R.set(L,y.boundingBox),r.isSome(g)&&(g.localOrigin=m,g.applyToAabb(L)),0!==_){const e=v.up;R.expandWithOffset(L,_*e[0],_*e[1],_*e[2])}const S=L;T.subtract(Y,i,m);const k=d&&null!=o.dist?o.dist:1/0;if(!D.intersectAabbInvDirBefore(S,Y,a,e.tolerance,k))continue;const P=(e,t,i,r)=>{e.set(void 0,U.tile2str(t),i,r,b.IDENTITY,void 0),e.intersector=X,e.target={type:"external",metadata:{tile:t}}},q=(a,d)=>{if(a>=0&&(e.options.backfacesTerrain||T.dot(d,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||null==t||t(i,n,a))){if((null==c.dist||a<c.dist)&&P(c,v,a,d),e.options.isFiltered)return;2===e.options.store&&(r.isNone(u)?(u=new O.IntersectorResult(e.ray),P(u,v,a,d),e.results.all.push(u)):a<u.dist&&P(u,v,a,d)),(null==o.dist||a<o.dist)&&P(o,v,a,d),0!==e.options.store&&(null==l.dist||a>l.dist)&&P(l,v,a,d)}},E=Z;T.subtract(E,n,m);const w=y.indices,I=y.vertexAttributes,B={data:I.getField("position",x.BufferViewVec3f).typedBuffer,size:3,offsetIdx:0,strideIdx:I.stride/4},N=y.numWithoutSkirtIndices/3;if(D.intersectTriangles(Y,E,0,N,w,B,null,g,q),0!==_){const e="spherical"===this.manifold?e=>T.scale(e,e,_/T.length(e)):e=>T.set(e,0,0,_),t=w.length/3;C.intersectSkirts(Y,E,N,t,w,I,e,g,q)}}},n.render=function(e){if(9===e.slot){if(0==(e.renderOccludedMask&w.overlayRenderOccludedFlag))return!1}else{const t=this.opaque?2:7;if(e.slot!==t)return!1}A.trace("# BEGIN RENDER TERRAIN");const t=e.pass,i=1===e.scenelightingData.globalFactor,r=this._updatePatchGroups();switch(t){case 0:{const t=e.shadowMap&&e.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==t&&(this.shaderTechniqueConfig.receiveShadows=t);const i=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==i&&(this.shaderTechniqueConfig.overlayMode=i);const n=9===e.slot?3:1;this._renderMaterialPass(e,0,r,n);break}case 4:this.castShadows&&i&&this._renderAuxiliaryPass(e,3,r,0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,1,r,0);break;case 3:this._renderAuxiliaryPass(e,2,r,0);break;case 5:this.needsHighlight&&(this._renderAuxiliaryPass(e,4,r,2),e.rctx.clearSafe(256))}return A.trace("# END RENDER TERRAIN"),0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender(),!0},n._renderMaterialPass=function(e,t,i,r){const n=e.rctx,s=e.camera;this._ssrEnabled=e.ssrParams.ssrEnabled,this._setTerrainTechnique(t,3===r);const a=this.shaderTechnique.program;e.rctx.bindProgram(a),n.bindProgram(a),1===r&&e.ssrParams&&(e.ssrParams.lastFrameColorTextureID=9,e.ssrParams.linearDepthTextureID=8,E.ScreenSpaceReflections.bindUniforms(a,n,e.ssrParams)),e.shadowMap&&e.shadowMap.bind(a,7),e.ssaoHelper&&e.ssaoHelper.setUniforms(a,6),a.setUniform1i("tex",0),a.setUniform1i("texNext",1),this._bindOverlayData(a,r),a.setUniformMatrix4fv("viewNormal",s.viewInverseTransposeMatrix),S.View.bindProjectionMatrix(a,s.projectionMatrix),e.scenelightingData.setUniforms(a,!0);const o=s.viewMatrix;T.set(H,o[12],o[13],o[14]),T.normalize(H,H),a.setUniform3fv("viewDirection",H),this.numTilesRendered=0,this.numTilesCulled=0,this.numTrianglesRendered=0,this.numOriginsRendered=0,this._prepareScaleRangeQueries(),this.opaque?this._renderPatchGroups(e,a,i,r):e.offscreenRenderingHelper.renderToTargets((()=>this._renderPatchGroups(e,a,i,r)),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._processScaleRangeQueries()},n._renderAuxiliaryPass=function(e,t,i,r){this._setTerrainTechnique(t,3===r);const n=this.shaderTechnique.program;if(e.rctx.bindProgram(n),5===e.pass){const t=e.offscreenRenderingHelper;e.rctx.bindTexture(t.depthTexture,6),n.setUniform1i("depthTex",6),n.setUniform4f("highlightViewportPixelSz",0,0,1/t.width,1/t.height)}else n.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),2!==e.pass&&4!==e.pass||n.setUniform2fv("nearFar",e.camera.nearFar);this._renderPatchGroupsAuxiliary(e,n,i,r)},n._updateTileBackground=function(){if(!this.tileRenderer)return;this.tileBackgroundUpdating=!0;const e=()=>{this.tileBackgroundInitialized=!0,this.tileBackgroundUpdating=!1,this.rootTiles&&U.traverseTilesPreorder(this.rootTiles,(e=>{this.tileRenderer.updateTileTexture(e),this.setNeedsRender()})),this.setNeedsRender()};if("string"==typeof this.tileBackground){const t=this.tileBackground;_.requestImage(t).then((i=>{t===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(i),e())}))}else{const t=this.tileBackground?p.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(t),e()}},n._updatePatchGroups=function(){const e=this.patchGroups;if(!this.patchGroupsDirty)return e;if(this.highestVisibleLODTile=null,this._renderCollectOrigins(e),0!==this.renderOrder){for(let t=0;t<e.length;t++)U.sortTiles(this.renderOrder,e.data[t].patches);e.sort(((e,t)=>function(e,t,i){if(0===e.patches.length)return-i;if(0===t.patches.length)return i;return U.compareTiles(e.patches.data[0],t.patches.data[0],i)}(e,t,this.renderOrder)))}return this.patchGroupsDirty=!1,e},n._renderCollectOrigins=function(e){const t=this.rootTiles,i="spherical"===this.manifold;e.clear();for(const r of t){const t=e.pushNew();t.root=r,t.origin=i?g.ZEROS:r.centerAtSeaLevel,t.patches.clear(),this._renderCollectOriginsForRoot(e,t)}e.filterInPlace((e=>e.patches.length>0))},n._renderCollectOriginsForRoot=function(e,t){const i=this.tileIterator;i.resetOne(t.root);const r=this.patchGroupsMap;for(r.clear(),r.set(t.origin,t);!i.done;){const t=i.next(),n=t.renderData;if(!n||t.visible){if(t.lij[0]%7==0){const i=e.pushNew();i.root=t,i.origin=t.centerAtSeaLevel,r.set(t.centerAtSeaLevel,i),i.patches.clear()}if(t.rendered){if(n){const e=r.get(n.localOrigin);e&&e.patches.push(t),(!this.highestVisibleLODTile||t.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=t),i.skipSubtree()}}else this.numTilesCulled++}else this.numTilesCulled++,i.skipSubtree()}},n._scaleQueriesForTile=function(e){const t=e.extent,i=e.lij[0];let r=0;for(;r<this.visibleScaleRangeQueriesInvPtr;){const e=this.visibleScaleRangeQueries.data[r],n=e.extent;i>=e.minLevel&&i<=e.maxLevel&&n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]?(this.visibleScaleRangeQueries.swapElements(r,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):r++}},n._useStencilForTile=function(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1},n._renderPatchGroupsAuxiliary=function(e,t,i,r){this.shaderTechnique.bindPipelineState(e.rctx);const n=this.stencilEnabledLayerExtents.length>0;t.setUniformMatrix4fv("proj",e.camera.projectionMatrix),t.setUniform1f("skirtScale",this._skirtScale),0!==r&&this._bindOverlayData(t,r);for(let s=0;s<i.length;s++){const a=i.data[s];this._bindPatchGroupData(t,a,e.camera.eye,e.camera.viewMatrix);for(let i=0;i<a.patches.length;i++)this._renderPatch(e.rctx,t,a.patches.data[i],4,n,r)}e.rctx.bindVAO(null)},n._renderPatchGroups=function(e,t,i,n){const s=e.rctx,a=e.camera,o=a.viewMatrix;if(this.shaderTechnique.bindPipelineState(s),this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){const e=P.getSettings("spherical"===this.manifold?1:2,this.ellipsoidRadius),i=this.pointsOfInterest.centerOnSurfaceFrequent.distance;e.update({distance:i,fovY:a.fovY}),D.bindScreenSizePerspective(e,t,"screenSizePerspective")}const l=this.stencilEnabledLayerExtents.length>0,c=3===n;c&&(s.bindTexture(this.emptyTex,0),t.setUniform1f("blend",1),t.setUniform4fv("texOffsetAndScale",y.ZEROS));const d=c?0:this._skirtScale;t.setUniform1f("skirtScale",d);const h=this.wireframe?1:4;for(let d=0;d<i.length;d++){const u=i.data[d],f=u.patches;if(0===f.length)continue;this._bindPatchGroupData(t,u,a.eye,o);const p=e.sliceHelper&&e.sliceHelper.plane;q.Slice.bindUniforms(t,this.shaderTechnique.configuration,p,u.origin),e.shadowMap&&e.shadowMap.bindView(t,u.origin),this.numOriginsRendered++;for(let e=0;e<f.length;e++){const i=f.data[e],a=i.renderData.textureReference;if(r.isNone(a))continue;if(A.trace("# RENDER TILE "+U.tile2str(i)+", screenDepth:"+i.screenDepth),!c){this._scaleQueriesForTile(i),z(i.renderData.geometryInfo.uvOffsetAndScale,a.offsetAndScale,M),t.setUniform4fv("texOffsetAndScale",M),s.bindTexture(a.texture.texture,0);const e=i.renderData.textureFadeFactor,n=e<1?i.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&r.isSome(n)?(z(i.renderData.geometryInfo.uvOffsetAndScale,n.offsetAndScale,M),t.setUniform1f("textureFadeFactor",e),t.setUniform4fv("nextTexOffsetAndScale",M),s.bindTexture(n.texture.texture,1)):(t.setUniform1f("textureFadeFactor",1),s.bindTexture(this.emptyTex,1)),i.renderData.textureIsFading&&this.setNeedsRender(),t.setUniform1f("opacity",i.renderData.opacity)}const o=this._renderPatch(s,t,i,h,l,n);i.renderOrder=this.numTilesRendered,this.numTilesRendered++,this.numTrianglesRendered+=o/3}}s.bindVAO(null)},n._renderPatch=function(e,t,i,r,n,s){0!==s&&this._bindOverlayPatchData(t,i.renderData.overlay),n&&(this._useStencilForTile(i)?this.stencilShaderTechnique.bindPipelineState(e):this.shaderTechnique.bindPipelineState(e));const a=0===this._skirtScale?i.renderData.geometryInfo.numWithoutSkirtIndices:i.renderData.vao.indexBuffer.size;return e.bindVAO(i.renderData.vao),t.assertCompatibleVertexAttributeLocations(i.renderData.vao),e.drawElements(r,a,i.renderData.vao.indexBuffer.indexType,0),a},n._bindPatchGroupData=function(e,t,i,r){e.setUniform3fv("origin",t.origin),v.translate(V,r,t.origin),e.setUniformMatrix4fv("view",V),e.setUniform3f("camPos",i[0]-t.origin[0],i[1]-t.origin[1],i[2]-t.origin[2])},n._bindOverlayData=function(e,t){e.setUniform1i("ovInnerColorTex",2),e.setUniform1i("ovOuterColorTex",3),e.setUniform1i("ovInnerWaterTex",4),e.setUniform1i("ovOuterWaterTex",5),e.setUniform1f("overlayOpacity",this.overlayOpacity);const i=this.overlayRenderer.overlays,n=e=>{if(r.isSome(i)){const r=i[e],n=(1===t?r.renderTargets.color:2===t?r.renderTargets.highlight:r.renderTargets.occluded).fbo.getTexture();this.rctx.bindTexture(n,2+e);const s=1===t?r.renderTargets.water:null;if(s){const t=s.fbo.getTexture();this.rctx.bindTexture(t,4+e)}else this.rctx.bindTexture(this.emptyTex,4+e)}else this.rctx.bindTexture(this.emptyTex,2+e),this.rctx.bindTexture(this.emptyTex,4+e)};n(0),n(1)},n._bindOverlayPatchData=function(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)},n._setTerrainTechnique=function(e,t){if(this.shaderTechniqueConfig.output=e,0===e){const e="spherical"===this.manifold;this.shaderTechniqueConfig.atmosphere=e&&this._velvetOverground,this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled}this.shaderTechniqueConfig.renderOccluded=t,this.shaderTechniqueConfig.stencilEnabled=!1,this.shaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(N.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique),this.shaderTechniqueConfig.stencilEnabled=!0,this.stencilShaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(N.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)},n.releaseTileGeometry=function(e){e.releaseGeometry()&&this.setNeedsRender(),this.renderDataPool.release(e)},n._prepareScaleRangeQueries=function(){const e=this.visibleScaleRangeQueries,t=this.visibleScaleRangeQueryQueue;for(;e.length<e.data.length&&t.length>0;){const i=t.pop();e.push(i)}this.visibleScaleRangeQueriesInvPtr=e.length},n._processScaleRangeQueries=function(){const e=this.visibleScaleRangeQueries,t=this.visibleScaleRangeQueryPool;for(let i=0;i<e.length;i++){const r=e.data[i];t.release(r),r.callback(i>=this.visibleScaleRangeQueriesInvPtr),r.callback=null}e.clear()},e._createClass(i,[{key:"updating",get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}},{key:"canRender",get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}},{key:"opaque",set:function(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())},get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",set:function(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())},get:function(){return this._isTransparent}},{key:"skirtScale",set:function(e){e!==this._skirtScale&&(this._skirtScale=e,this.setNeedsRender())},get:function(){return this._skirtScale}},{key:"renderPatchBorders",get:function(){return!!this.shaderTechniqueConfig.tileBorders},set:function(e){this.shaderTechniqueConfig.tileBorders!==e&&(this.shaderTechniqueConfig.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(e){this.shaderTechniqueConfig.backfaceCullingEnabled!==e&&(this.shaderTechniqueConfig.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(e){this._set("renderOrder",e),this.setNeedsRender()}},{key:"velvetOverground",set:function(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}},{key:"intersectionHandlerId",get:function(){return O.TERRAIN_ID}},{key:"slicePlane",get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(e){this.shaderTechniqueConfig.slicePlaneEnabled!==e&&(this.shaderTechniqueConfig.slicePlaneEnabled=e,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(e){this.shaderTechniqueConfig.textureFadingEnabled!==e&&(this.shaderTechniqueConfig.textureFadingEnabled=e,this.setNeedsRender())}},{key:"wireframe",set:function(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.rootTiles&&(U.traverseTilesPreorder(this.rootTiles,(t=>{t.renderData&&t.renderData.updateGeometry(this.rctx,e)})),this.setNeedsRender()))}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]),i}(f);t.__decorate([a.property()],G.prototype,"tileBackgroundInitialized",void 0),t.__decorate([a.property()],G.prototype,"tileBackgroundUpdating",void 0),t.__decorate([a.property({constructOnly:!0})],G.prototype,"manifold",void 0),t.__decorate([a.property({constructOnly:!0})],G.prototype,"overlayRenderer",void 0),t.__decorate([a.property({constructOnly:!0})],G.prototype,"ellipsoidRadius",void 0),t.__decorate([a.property({readOnly:!0,dependsOn:["tileBackgroundInitialized","tileBackgroundUpdating"]})],G.prototype,"updating",null),t.__decorate([a.property({value:!1})],G.prototype,"renderingDisabled",null),t.__decorate([a.property()],G.prototype,"renderPatchBorders",null),t.__decorate([a.property()],G.prototype,"cullBackFaces",null),t.__decorate([a.property({value:1})],G.prototype,"renderOrder",null),t.__decorate([a.property()],G.prototype,"wireframe",null),G=t.__decorate([o.subclass("esri.views.3d.terrain.TerrainRenderer")],G);var Q=G;function z(e,t,i){const r=e[0]*t[2]+t[0],n=e[1]*t[3]+t[1],s=e[2]*t[2],a=e[3]*t[3];m.set(i,r,n,s,a)}const V=b.create(),H=g.create(),j=g.create(),W=g.create(),Y=g.create(),Z=g.create(),X="TerrainRenderer";return Q}));
