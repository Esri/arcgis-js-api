/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../core/Collection","../../../core/maybe","../../../geometry/support/spatialReferenceUtils","../../../layers/support/layerUtils","../../ViewingMode","../support/StreamDataLoader","./interfaces","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical"],(function(e,n,t,r,i,o,l,a,s,u){"use strict";const T={[o.ViewingMode.Global]:u.terrainUtilsSpherical,[o.ViewingMode.Local]:s.terrainUtilsPlanar};function c(e,n){e||console.warn("Terrain: "+n)}function f(n){e.ENABLE_WATERPROOFNESS_TESTS=n,e.ENABLE_TERRAIN_INTERNAL_CHECKS=e.ENABLE_TERRAIN_INTERNAL_CHECKS||n}function E(n){e.ENABLE_TERRAIN_INTERNAL_CHECKS=n}function S(n,t){if(e.ENABLE_TERRAIN_INTERNAL_CHECKS&&!n){const e=(new Error).stack?.slice(5);throw console.warn("Terrain internal: "+(t||"")+" at "+e),new Error("Assertion failed"+(t?": "+t:""))}}function I(e){return d(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function N(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function d(e){return"imagery-tile-3d"===e?.type}function g(e){return"tile-3d"===e?.type}function h(e){return"vector-tile-3d"===e?.type}function x(e){return"wmts-3d"===e?.type}function b(e){return"elevation-3d"===e?.type}function y(e){return"group"===e?.type}function p(e){return e&&(g(e)||x(e)||d(e)||h(e))}function R(e){return e&&(g(e)||d(e)||h(e)||x(e))}function _(e){return R(e)||b(e)}function A(e){const n=e?.sourceLayerInfo?.data;return t.isSome(n)&&"type"in n&&"raster-tile"===n.type}function H(e){const n=e?.sourceLayerInfo?.data;return t.isSome(n)&&"type"in n&&"vector-tile"===n.type}function L(e){const n=e?.sourceLayerInfo?.data;return t.isSome(n)&&"type"in n&&"tile-texture"===n.type}function O(e){const n=e?.sourceLayerInfo?.data;return n instanceof HTMLImageElement||n instanceof l.ImageWithType||n instanceof HTMLCanvasElement||n instanceof ImageData}function m(e){return t.isSome(e)&&"release"in e&&e.release(),null}function W(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function C(e,n,t,r){return T[r].checkIfTileInfoSupportedForViewSR(e,t,n)}function w(e,n,r){let i=null,l=null;if("wmts"===e?.type){const t=U(e,n,r);i=t.tileInfo,l=t.fullExtent}else{l=N(e)?e.getCompatibleFullExtent(n):e.fullExtent;const t=r===o.ViewingMode.Local;if(N(e))i=e.getCompatibleTileInfo(n,l,t);else if("vector-tile"===e?.type){const r=t&&!V(n)||M.force512VTL,o=e.tileInfo.spatialReference.isGeographic;i=r?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,o?1:2)}else i=e.tileInfo}return t.isSome(i)&&t.isSome(l)&&null==C(i,l,n,r)?{tileInfo:i,fullExtent:l}:null}function U(e,r,o){const l=i.getTileMaxtrixSetFromActiveLayer(e);if(t.isSome(l)){if(!n.isCollection(l))return{tileInfo:l.tileInfo,fullExtent:l.fullExtent};{const e=l.find((e=>null==C(e.tileInfo,e.fullExtent,r,o)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function V(e){return e.isWGS84||e.isWebMercator||r.isCGCS2000(e)||!r.isEarth(e)}e.ENABLE_TERRAIN_INTERNAL_CHECKS=!1,e.ENABLE_WATERPROOFNESS_TESTS=!1;const M={force512VTL:!1};function v(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function F(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function k(e,n,t=X){return Math.abs(e-n)<t}function B(e){return e===a.NeighborIndex.NORTH_EAST?a.NeighborIndex.SOUTH_WEST:e===a.NeighborIndex.NORTH_WEST?a.NeighborIndex.SOUTH_EAST:e===a.NeighborIndex.SOUTH_WEST?a.NeighborIndex.NORTH_EAST:a.NeighborIndex.NORTH_WEST}function P(e){return e===a.NeighborIndex.NORTH?a.NeighborIndex.SOUTH:e===a.NeighborIndex.EAST?a.NeighborIndex.WEST:e===a.NeighborIndex.SOUTH?a.NeighborIndex.NORTH:a.NeighborIndex.EAST}function G(e){return e===a.NeighborIndex.NORTH_WEST||e===a.NeighborIndex.SOUTH_WEST}function K(e){return e===a.NeighborIndex.NORTH_WEST||e===a.NeighborIndex.NORTH_EAST}function D(e){return e===a.NeighborIndex.NORTH_WEST||e===a.NeighborIndex.WEST||e===a.NeighborIndex.SOUTH_WEST}function j(e){return e===a.NeighborIndex.NORTH_EAST||e===a.NeighborIndex.EAST||e===a.NeighborIndex.SOUTH_EAST}function q(e){return e===a.NeighborIndex.SOUTH_EAST||e===a.NeighborIndex.SOUTH||e===a.NeighborIndex.SOUTH_WEST}function z(e){return e===a.NeighborIndex.NORTH_EAST||e===a.NeighborIndex.NORTH||e===a.NeighborIndex.NORTH_WEST}const J=[a.NeighborIndex.NORTH,a.NeighborIndex.EAST,a.NeighborIndex.SOUTH,a.NeighborIndex.WEST],Q=[a.NeighborIndex.NORTH_EAST,a.NeighborIndex.SOUTH_EAST,a.NeighborIndex.SOUTH_WEST,a.NeighborIndex.NORTH_WEST],X=1e-5;e.almostEquals=k,e.checkIfTileInfoSupportedForView=C,e.enableTerrainInternalChecks=E,e.enableTerrainWaterproofnessChecks=f,e.eps=X,e.getLayerWithExtentRange=I,e.getTileInfoAndExtentFromWMTSLayer=U,e.getTiledLayerInfo=w,e.internalAssert=S,e.isBlendableLayerView=p,e.isEast=j,e.isElevationLayerView=b,e.isGroupLayerView=y,e.isImageryTileLayerView=d,e.isImageryTileRenderInfo=A,e.isMapTileLayerView=R,e.isNorth=z,e.isNorthCorner=K,e.isProjectableRasterLayer=N,e.isRasterTileRenderInfo=O,e.isSouth=q,e.isSurfaceLayerView=_,e.isTextureTileRenderInfo=L,e.isTileLayerView=g,e.isVectorTileLayerView=h,e.isVectorTileRenderInfo=H,e.isWMTSLayerView=x,e.isWest=D,e.isWestCorner=G,e.lij2s=v,e.neighborCornerIndices=Q,e.neighborEdgeIndices=J,e.oppositeCorner=B,e.oppositeEdge=P,e.releaseTileData=m,e.test=M,e.useFetchTileForLayer=W,e.v32s=F,e.vtlAssumes256PixelSizeAsDefault=V,e.weakAssert=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
