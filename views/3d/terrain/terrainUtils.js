/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../support/StreamDataLoader","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical"],(function(e,t,n,i,l){"use strict";const r={1:l.terrainUtilsSpherical,2:i.terrainUtilsPlanar};function o(e,t){e||console.warn("Terrain: "+t)}const a=1.2,u=80/180*Math.PI,s=110/180*Math.PI;function c(e,n,i){const l=r[e.viewingMode];let o;if(l.isInsideExtent(e,n))o=t.unwrapOr(e.getElevation(n[0],n[1],n[1],e.spatialReference),0);else{if(!l.isInsideExtent(e,n,a))return 0;const i=e.getTileWithElevation(n[0],n[1],n[1],e.spatialReference);o=.5*((t.isSome(i)?i.elevationBounds[0]:e.elevationBounds.min)+(t.isSome(i)?i.elevationBounds[1]:e.elevationBounds.max));const r=l.tiltToExtentEdge(e,n,o);if(r>u&&r<s)return 0}const c=n[2]-o;return Math.abs(c)<i?0:c<0?-1:1}function f(e){return p(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function d(e){return"vector-tile"===(null==e?void 0:e.type)}function y(e){return"imagery-tile"===(null==e?void 0:e.type)||"wcs"===(null==e?void 0:e.type)}function p(e){return"imagery-tile-3d"===(null==e?void 0:e.type)}function m(e){return"tile-3d"===(null==e?void 0:e.type)}function v(e){return"vector-tile-3d"===(null==e?void 0:e.type)}function I(e){return"wmts-3d"===(null==e?void 0:e.type)}function T(e){return"elevation-3d"===(null==e?void 0:e.type)}function S(e){return e&&(m(e)||p(e)||T(e)||v(e)||I(e))}function x(e){var n;const i=null==e||null==(n=e.sourceLayerInfo)?void 0:n.data;return t.isSome(i)&&"type"in i&&"raster-tile"===i.type}function L(e){var n;const i=null==e||null==(n=e.sourceLayerInfo)?void 0:n.data;return t.isSome(i)&&"type"in i&&"vector-tile"===i.type}function E(e){var n;const i=null==e||null==(n=e.sourceLayerInfo)?void 0:n.data;return t.isSome(i)&&"type"in i&&"tile-texture"===i.type}function h(e){var t;const i=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return i instanceof HTMLImageElement||i instanceof n.ImageWithType||i instanceof HTMLCanvasElement||i instanceof ImageData}function g(e){return t.isSome(e)&&"release"in e&&e.release(),null}function w(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function V(e,t,n,i){return r[i].checkIfTileInfoSupportedForViewSR(e,n,t)}function M(e,n,i){let l=null,r=null;if("wmts"===e.type){const t=e.activeLayer;if(t){const e=t.tileMatrixSet;if(e)l=e.tileInfo,r=e.fullExtent;else{const e=t.tileMatrixSets;if(e){const t=e.find((e=>null==V(e.tileInfo,e.fullExtent,n,i)));if(t)return{tileInfo:t.tileInfo,fullExtent:t.fullExtent}}}}}else r=y(e)?e.getCompatibleFullExtent(n):e.fullExtent,l=d(e)&&!R.force512VTL?e.compatibleTileInfo256:y(e)?e.getCompatibleTileInfo(n,r,2===i):e.tileInfo;return t.isSome(l)&&t.isSome(r)&&null==V(l,r,n,i)?{tileInfo:l,fullExtent:r}:null}const R={force512VTL:!1};e.checkIfTileInfoSupportedForView=V,e.computeSkirtScale=c,e.getLayerWithExtentRange=f,e.getTiledLayerInfo=M,e.isElevationLayerView=T,e.isImageryTileLayerView=p,e.isImageryTileRenderInfo=x,e.isProjectableRasterLayer=y,e.isRasterTileRenderInfo=h,e.isSurfaceLayerView=S,e.isTextureTileRenderInfo=E,e.isTileLayerView=m,e.isVectorTileLayer=d,e.isVectorTileLayerView=v,e.isVectorTileRenderInfo=L,e.isWMTSLayerView=I,e.releaseTileData=g,e.test=R,e.useFetchTileForLayer=w,e.weakAssert=o,Object.defineProperty(e,"__esModule",{value:!0})}));
