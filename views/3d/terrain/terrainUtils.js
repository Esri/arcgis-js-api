/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../../2d/engine/vectorTiles/VectorTile","../support/StreamDataLoader","./RasterTile","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical","./TileTexture"],(function(e,t,n,i,l,r,o,a){"use strict";const u={1:o.terrainUtilsSpherical,2:r.terrainUtilsPlanar};function c(e,t){e||console.warn("Terrain: "+t)}const s=1.2,f=80/180*Math.PI,d=110/180*Math.PI;function y(e,n,i){const l=u[e.viewingMode];let r;if(l.isInsideExtent(e,n))r=t.unwrapOr(e.getElevation(n[0],n[1],n[1],e.spatialReference),0);else{if(!l.isInsideExtent(e,n,s))return 0;const i=e.getTileWithElevation(n[0],n[1],n[1],e.spatialReference);r=.5*((t.isSome(i)?i.elevationBounds[0]:e.elevationBounds.min)+(t.isSome(i)?i.elevationBounds[1]:e.elevationBounds.max));const o=l.tiltToExtentEdge(e,n,r);if(o>f&&o<d)return 0}const o=n[2]-r;return Math.abs(o)<i?0:o<0?-1:1}function T(e){return p(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function v(e){return"vector-tile"===(null==e?void 0:e.type)}function I(e){return"imagery-tile"===(null==e?void 0:e.type)||"wcs"===(null==e?void 0:e.type)}function p(e){return"imagery-tile-3d"===(null==e?void 0:e.type)}function m(e){return"tile-3d"===(null==e?void 0:e.type)}function x(e){return"vector-tile-3d"===(null==e?void 0:e.type)}function L(e){return"wmts-3d"===(null==e?void 0:e.type)}function E(e){return"elevation-3d"===(null==e?void 0:e.type)}function S(e){return e&&(m(e)||p(e)||E(e)||x(e)||L(e))}function g(e){var t;return(null==e||null==(t=e.sourceLayerInfo)?void 0:t.data)instanceof l}function h(e){var t;return(null==e||null==(t=e.sourceLayerInfo)?void 0:t.data)instanceof n.VectorTile}function w(e){var t;return(null==e||null==(t=e.sourceLayerInfo)?void 0:t.data)instanceof a}function V(e){var t;const n=null==e||null==(t=e.sourceLayerInfo)?void 0:t.data;return n instanceof HTMLImageElement||n instanceof i.ImageWithType||n instanceof HTMLCanvasElement||n instanceof ImageData}function R(e){return t.isSome(e)&&"release"in e&&e.release(),null}function M(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function b(e,t,n,i){return u[i].checkIfTileInfoSupportedForViewSR(e,n,t)}function k(e,t,n){let i,l;if("wmts"===e.type){const r=e.activeLayer;if(r){const e=r.tileMatrixSet;if(e)i=e.tileInfo,l=e.fullExtent;else{const e=r.tileMatrixSets;if(e){const i=e.find((e=>null==b(e.tileInfo,e.fullExtent,t,n)));if(i)return{tileInfo:i.tileInfo,fullExtent:i.fullExtent}}}}}else l=I(e)?e.getCompatibleFullExtent(t):e.fullExtent,i=v(e)&&!F.force512VTL?e.compatibleTileInfo256:I(e)?e.getCompatibleTileInfo(t,l,2===n):e.tileInfo;return i&&l&&null==b(i,l,t,n)?{tileInfo:i,fullExtent:l}:{tileInfo:null,fullExtent:null}}const F={force512VTL:!1};e.checkIfTileInfoSupportedForView=b,e.computeSkirtScale=y,e.getLayerWithExtentRange=T,e.getTiledLayerInfo=k,e.isElevationLayerView=E,e.isImageryTileLayerView=p,e.isImageryTileRenderInfo=g,e.isProjectableRasterLayer=I,e.isRasterTileRenderInfo=V,e.isSurfaceLayerView=S,e.isTextureTileRenderInfo=w,e.isTileLayerView=m,e.isVectorTileLayer=v,e.isVectorTileLayerView=x,e.isVectorTileRenderInfo=h,e.isWMTSLayerView=L,e.releaseTileData=R,e.test=F,e.useFetchTileForLayer=M,e.weakAssert=c,Object.defineProperty(e,"__esModule",{value:!0})}));
