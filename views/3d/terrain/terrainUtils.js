/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../../../layers/ElevationLayer","../../../layers/TileLayer","../../../layers/VectorTileLayer","../support/StreamDataLoader","../../2d/engine/vectorTiles/VectorTile","./RasterTile","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical","./TileTexture"],(function(e,t,n,r,i,a,l,o,s,c,f){"use strict";const u={planar:s.terrainUtilsPlanar,spherical:c.terrainUtilsSpherical};const y=80/180*Math.PI,T=110/180*Math.PI;function I(e){return"imagery-tile"===e.type||"wcs"===e.type}function d(e){return e&&"esri.views.3d.layers.ImageryTileLayerView3D"===e.declaredClass}function L(e){return e&&"esri.views.3d.layers.TileLayerView3D"===e.declaredClass}function p(e){return e&&"esri.views.3d.layers.VectorTileLayerView3D"===e.declaredClass}function m(e){return e&&"esri.views.3d.layers.WMTSLayerView3D"===e.declaredClass}function E(e){return e&&"esri.views.3d.layers.ElevationLayerView3D"===e.declaredClass}function w(e,t,n,r){let i;return i=2===r||"planar"===r?"planar":"spherical",u[i].checkIfTileInfoSupportedForViewSR(e,n,t)}const x={force512VTL:!1};e.checkIfTileInfoSupportedForView=w,e.computeSkirtScale=function(e,t,n){const r=u[e.manifold];let i;if(r.isInsideExtent(e,t))i=e.getElevation(t[0],t[1],t[1],e.spatialReference);else{if(!r.isInsideExtent(e,t,1.2))return 0;const n=r.tiltToExtentEdge(e,t);if(n>y&&n<T)return 0;const a=e.elevationBounds;i=.5*(a.min+a.max)}const a=t[2]-i;return Math.abs(a)<n?0:a<0?-1:1},e.getLayerWithExtentRange=function(e){return d(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer},e.getTiledLayerInfo=function(e,t,n){let r,i;if("wmts"===e.type){const a=e.activeLayer;if(a){const e=a.tileMatrixSet;if(e)r=e.tileInfo,i=e.fullExtent;else{const e=a.tileMatrixSets;if(e){const r=e.find((e=>null==w(e.tileInfo,e.fullExtent,t,n)));if(r)return{tileInfo:r.tileInfo,fullExtent:r.fullExtent}}}}}else i=I(e)?e.getCompatibleFullExtent(t):e.fullExtent,r="vector-tile"!==e.type||x.force512VTL?I(e)?e.getCompatibleTileInfo(t,i):e.tileInfo:e.compatibleTileInfo256;return r&&i&&null==w(r,i,t,n)?{tileInfo:r,fullExtent:i}:{tileInfo:null,fullExtent:null}},e.isElevationLayerView=E,e.isImageryTileLayerView=d,e.isImageryTileRenderInfo=function(e){return e&&e.sourceLayerInfo&&e.sourceLayerInfo.data instanceof o},e.isProjectableRasterLayer=I,e.isRasterTileRenderInfo=function(e){const t=e&&e.sourceLayerInfo&&e.sourceLayerInfo.data;return t instanceof HTMLImageElement||t instanceof a.ImageWithType||t instanceof HTMLCanvasElement||t instanceof ImageData},e.isSurfaceLayerView=function(e){return e&&(L(e)||d(e)||E(e)||p(e)||m(e))},e.isTextureTileRenderInfo=function(e){return e&&e.sourceLayerInfo&&e.sourceLayerInfo.data instanceof f},e.isTileLayerView=L,e.isVectorTileLayer=function(e){return e&&e instanceof i},e.isVectorTileLayerView=p,e.isVectorTileRenderInfo=function(e){return e&&e.sourceLayerInfo&&e.sourceLayerInfo.data instanceof l.VectorTile},e.isWMTSLayerView=m,e.releaseTileData=function(e){return t.isSome(e)&&!(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData)&&e.release(),null},e.test=x,e.useFetchTileForLayer=function(e){return e.fetchTile&&!(e.fetchTile===r.prototype.fetchTile||e.fetchTile===n.prototype.fetchTile)},e.weakAssert=function(e,t){e||console.warn("Terrain: "+t)},Object.defineProperty(e,"__esModule",{value:!0})}));
