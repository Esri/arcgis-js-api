/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../core/Collection","../../../core/maybe","../../../geometry/support/spatialReferenceUtils","../../../layers/support/layerUtils","../../ViewingMode","../support/StreamDataLoader","./interfaces","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical"],(function(e,n,t,r,i,o,l,a,s,u){"use strict";const T={[o.ViewingMode.Global]:u.terrainUtilsSpherical,[o.ViewingMode.Local]:s.terrainUtilsPlanar};function c(e,n){e||console.warn("Terrain: "+n)}function f(n){e.ENABLE_WATERPROOFNESS_TESTS=n,e.ENABLE_TERRAIN_INTERNAL_CHECKS=e.ENABLE_TERRAIN_INTERNAL_CHECKS||n}function E(n){e.ENABLE_TERRAIN_INTERNAL_CHECKS=n}function S(n,t){if(e.ENABLE_TERRAIN_INTERNAL_CHECKS&&!n){const e=(new Error).stack.slice(5);throw console.warn("Terrain internal: "+(t||"")+" at "+e),new Error("Assertion failed"+(t?": "+t:""))}}function I(e){return d(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function N(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function d(e){return"imagery-tile-3d"===e?.type}function g(e){return"tile-3d"===e?.type}function h(e){return"vector-tile-3d"===e?.type}function x(e){return"wmts-3d"===e?.type}function b(e){return"elevation-3d"===e?.type}function p(e){return"group"===e?.type}function y(e){return"group"===e?.type}function R(e){return e&&(g(e)||x(e)||d(e)||h(e))}function _(e){return e&&(g(e)||d(e)||h(e)||x(e))}function A(e){return _(e)||b(e)}function L(e){const n=e?.sourceLayerInfo?.data;return t.isSome(n)&&"type"in n&&"raster-tile"===n.type}function H(e){const n=e?.sourceLayerInfo?.data;return t.isSome(n)&&"type"in n&&"vector-tile"===n.type}function O(e){const n=e?.sourceLayerInfo?.data;return t.isSome(n)&&"type"in n&&"tile-texture"===n.type}function m(e){const n=e?.sourceLayerInfo?.data;return n instanceof HTMLImageElement||n instanceof l.ImageWithType||n instanceof HTMLCanvasElement||n instanceof ImageData}function W(e){return t.isSome(e)&&"release"in e&&e.release(),null}function C(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function w(e,n,t,r){return T[r].checkIfTileInfoSupportedForViewSR(e,t,n)}function U(e,n,r){let i=null,l=null;if("wmts"===e?.type){const t=V(e,n,r);i=t.tileInfo,l=t.fullExtent}else{l=N(e)?e.getCompatibleFullExtent(n):e.fullExtent;const t=r===o.ViewingMode.Local;if(N(e))i=e.getCompatibleTileInfo(n,l,t);else if("vector-tile"===e?.type){const r=t&&!M(n)||v.force512VTL,o=e.tileInfo.spatialReference.isGeographic;i=r?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,o?1:2)}else i=e.tileInfo}return t.isSome(i)&&t.isSome(l)&&null==w(i,l,n,r)?{tileInfo:i,fullExtent:l}:null}function V(e,r,o){const l=i.getTileMaxtrixSetFromActiveLayer(e);if(t.isSome(l)){if(!n.isCollection(l))return{tileInfo:l.tileInfo,fullExtent:l.fullExtent};{const e=l.find((e=>null==w(e.tileInfo,e.fullExtent,r,o)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function M(e){return e.isWGS84||e.isWebMercator||r.isCGCS2000(e)||!r.isEarth(e)}e.ENABLE_TERRAIN_INTERNAL_CHECKS=!1,e.ENABLE_WATERPROOFNESS_TESTS=!1;const v={force512VTL:!1};function F(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function k(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function B(e,n,t=Y){return Math.abs(e-n)<t}function P(e){return e===a.NeighborIndex.NORTH_EAST?a.NeighborIndex.SOUTH_WEST:e===a.NeighborIndex.NORTH_WEST?a.NeighborIndex.SOUTH_EAST:e===a.NeighborIndex.SOUTH_WEST?a.NeighborIndex.NORTH_EAST:a.NeighborIndex.NORTH_WEST}function G(e){return e===a.NeighborIndex.NORTH?a.NeighborIndex.SOUTH:e===a.NeighborIndex.EAST?a.NeighborIndex.WEST:e===a.NeighborIndex.SOUTH?a.NeighborIndex.NORTH:a.NeighborIndex.EAST}function K(e){return e===a.NeighborIndex.NORTH_WEST||e===a.NeighborIndex.SOUTH_WEST}function D(e){return e===a.NeighborIndex.NORTH_WEST||e===a.NeighborIndex.NORTH_EAST}function j(e){return e===a.NeighborIndex.NORTH_WEST||e===a.NeighborIndex.WEST||e===a.NeighborIndex.SOUTH_WEST}function q(e){return e===a.NeighborIndex.NORTH_EAST||e===a.NeighborIndex.EAST||e===a.NeighborIndex.SOUTH_EAST}function z(e){return e===a.NeighborIndex.SOUTH_EAST||e===a.NeighborIndex.SOUTH||e===a.NeighborIndex.SOUTH_WEST}function J(e){return e===a.NeighborIndex.NORTH_EAST||e===a.NeighborIndex.NORTH||e===a.NeighborIndex.NORTH_WEST}const Q=[a.NeighborIndex.NORTH,a.NeighborIndex.EAST,a.NeighborIndex.SOUTH,a.NeighborIndex.WEST],X=[a.NeighborIndex.NORTH_EAST,a.NeighborIndex.SOUTH_EAST,a.NeighborIndex.SOUTH_WEST,a.NeighborIndex.NORTH_WEST],Y=1e-5;e.almostEquals=B,e.checkIfTileInfoSupportedForView=w,e.enableTerrainInternalChecks=E,e.enableTerrainWaterproofnessChecks=f,e.eps=Y,e.getLayerWithExtentRange=I,e.getTileInfoAndExtentFromWMTSLayer=V,e.getTiledLayerInfo=U,e.internalAssert=S,e.isBlendableLayerView=R,e.isEast=q,e.isElevationLayerView=b,e.isGroupLayer=y,e.isGroupLayerView=p,e.isImageryTileLayerView=d,e.isImageryTileRenderInfo=L,e.isMapTileLayerView=_,e.isNorth=J,e.isNorthCorner=D,e.isProjectableRasterLayer=N,e.isRasterTileRenderInfo=m,e.isSouth=z,e.isSurfaceLayerView=A,e.isTextureTileRenderInfo=O,e.isTileLayerView=g,e.isVectorTileLayerView=h,e.isVectorTileRenderInfo=H,e.isWMTSLayerView=x,e.isWest=j,e.isWestCorner=K,e.lij2s=F,e.neighborCornerIndices=X,e.neighborEdgeIndices=Q,e.oppositeCorner=P,e.oppositeEdge=G,e.releaseTileData=W,e.test=v,e.useFetchTileForLayer=C,e.v32s=k,e.vtlAssumes256PixelSizeAsDefault=M,e.weakAssert=c,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
