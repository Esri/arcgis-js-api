/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import e from"../../../core/Collection.js";import{neverReached as t}from"../../../core/compilerUtils.js";import{isSome as n}from"../../../core/maybe.js";import{isCGCS2000 as r,isEarth as o}from"../../../geometry/support/spatialReferenceUtils.js";import{getTileMaxtrixSetFromActiveLayer as i}from"../../../layers/support/layerUtils.js";import{ViewingMode as c}from"../../ViewingMode.js";import{ImageWithType as a}from"../support/StreamDataLoader.js";import{NeighborIndex as s}from"./interfaces.js";import{t as l}from"../../../chunks/terrainUtilsPlanar.js";import{t as u}from"../../../chunks/terrainUtilsSpherical.js";const f={[c.Global]:u,[c.Local]:l};function T(e,t){e||console.warn("Terrain: "+t)}const p=!1;let m=!1;function S(e){m=e}function E(e,t){}function y(e){return O(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function H(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function O(e){return"imagery-tile-3d"===e?.type}function g(e){return"tile-3d"===e?.type}function _(e){return"vector-tile-3d"===e?.type}function d(e){return"wmts-3d"===e?.type}function I(e){return"elevation-3d"===e?.type}function R(e){return"group"===e?.type}function U(e){return e&&(g(e)||d(e)||O(e)||_(e))}function W(e){return e&&(g(e)||O(e)||_(e)||d(e))}function x(e){return W(e)||I(e)}function N(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return t(e.type),!1}}function b(e){const t=e?.sourceLayerInfo?.data;return n(t)&&"type"in t&&"raster-tile"===t.type}function h(e){const t=e?.sourceLayerInfo?.data;return n(t)&&"type"in t&&"vector-tile"===t.type}function A(e){const t=e?.sourceLayerInfo?.data;return n(t)&&"type"in t&&"tile-texture"===t.type}function w(e){const t=e?.sourceLayerInfo?.data;return t instanceof HTMLImageElement||t instanceof a||t instanceof HTMLCanvasElement||t instanceof ImageData}function j(e){return n(e)&&"release"in e&&e.release(),null}function v(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile}function L(e,t,n,r){return f[r].checkIfTileInfoSupportedForViewSR(e,n,t)}function C(e,t,r){let o=null,i=null;if("wmts"===e?.type){const n=k(e,t,r);o=n.tileInfo,i=n.fullExtent}else{i=H(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=r===c.Local;if(H(e))o=e.getCompatibleTileInfo(t,i,n);else if("vector-tile"===e?.type){const r=n&&!M(t)||V.force512VTL,i=e.tileInfo.spatialReference.isGeographic;o=r?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,i?1:2)}else o=e.tileInfo}return n(o)&&n(i)&&null==L(o,i,t,r)?{tileInfo:o,fullExtent:i}:null}function k(t,r,o){const c=i(t);if(n(c)){if(!e.isCollection(c))return{tileInfo:c.tileInfo,fullExtent:c.fullExtent};{const e=c.find((e=>null==L(e.tileInfo,e.fullExtent,r,o)));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function M(e){return e.isWGS84||e.isWebMercator||r(e)||!o(e)}const V={force512VTL:!1};function F(e){return"["+e[0]+","+e[1]+","+e[2]+"]"}function G(e){return"("+e[0]+","+e[1]+","+e[2]+")"}function D(e,t,n=$){return Math.abs(e-t)<n}function P(e){return e===s.NORTH_EAST?s.SOUTH_WEST:e===s.NORTH_WEST?s.SOUTH_EAST:e===s.SOUTH_WEST?s.NORTH_EAST:s.NORTH_WEST}function q(e){return e===s.NORTH?s.SOUTH:e===s.EAST?s.WEST:e===s.SOUTH?s.NORTH:s.EAST}function z(e){return e===s.NORTH_WEST||e===s.SOUTH_WEST}function B(e){return e===s.NORTH_WEST||e===s.NORTH_EAST}function J(e){return e===s.NORTH_WEST||e===s.WEST||e===s.SOUTH_WEST}function K(e){return e===s.NORTH_EAST||e===s.EAST||e===s.SOUTH_EAST}function Q(e){return e===s.SOUTH_EAST||e===s.SOUTH||e===s.SOUTH_WEST}function X(e){return e===s.NORTH_EAST||e===s.NORTH||e===s.NORTH_WEST}const Y=[s.NORTH,s.EAST,s.SOUTH,s.WEST],Z=[s.NORTH_EAST,s.SOUTH_EAST,s.SOUTH_WEST,s.NORTH_WEST],$=1e-5;export{p as ENABLE_TERRAIN_INTERNAL_CHECKS,m as ENABLE_WATERPROOFNESS_TESTS,D as almostEquals,L as checkIfTileInfoSupportedForView,S as enableWaterproofnessTests,$ as eps,y as getLayerWithExtentRange,k as getTileInfoAndExtentFromWMTSLayer,C as getTiledLayerInfo,E as internalAssert,U as isBlendableLayerView,K as isEast,I as isElevationLayerView,R as isGroupLayer,O as isImageryTileLayerView,b as isImageryTileRenderInfo,W as isMapTileLayerView,X as isNorth,B as isNorthCorner,H as isProjectableRasterLayer,w as isRasterTileRenderInfo,Q as isSouth,x as isSurfaceLayerView,N as isTerrainSurfaceLayer,A as isTextureTileRenderInfo,g as isTileLayerView,_ as isVectorTileLayerView,h as isVectorTileRenderInfo,d as isWMTSLayerView,J as isWest,z as isWestCorner,F as lij2s,Z as neighborCornerIndices,Y as neighborEdgeIndices,P as oppositeCorner,q as oppositeEdge,j as releaseTileData,V as test,v as useFetchTileForLayer,G as v32s,M as vtlAssumes256PixelSizeAsDefault,T as weakAssert};
