/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../../../layers/ElevationLayer","../../../layers/TileLayer","../../../layers/VectorTileLayer","../support/StreamDataLoader","../../2d/engine/vectorTiles/VectorTile","./RasterTile","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical","./TileTexture"],(function(e,t,n,r,i,a,l,o,s,c,f){"use strict";const u={planar:s.terrainUtilsPlanar,spherical:c.terrainUtilsSpherical};function y(e,t){e||console.warn("Terrain: "+t)}const T=1.2,d=80/180*Math.PI,I=110/180*Math.PI;function L(e,n,r){const i=u[e.manifold];let a;if(i.isInsideExtent(e,n))a=t.unwrapOr(e.getElevation(n[0],n[1],n[1],e.spatialReference),0);else{if(!i.isInsideExtent(e,n,T))return 0;const t=i.tiltToExtentEdge(e,n);if(t>d&&t<I)return 0;const r=e.elevationBounds;a=.5*(r.min+r.max)}const l=n[2]-a;return Math.abs(l)<r?0:l<0?-1:1}function p(e){return x(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function m(e){return e&&e instanceof i}function w(e){return"imagery-tile"===e.type||"wcs"===e.type}function x(e){return e&&"esri.views.3d.layers.ImageryTileLayerView3D"===e.declaredClass}function V(e){return e&&"esri.views.3d.layers.TileLayerView3D"===e.declaredClass}function E(e){return e&&"esri.views.3d.layers.VectorTileLayerView3D"===e.declaredClass}function h(e){return e&&"esri.views.3d.layers.WMTSLayerView3D"===e.declaredClass}function S(e){return e&&"esri.views.3d.layers.ElevationLayerView3D"===e.declaredClass}function g(e){return e&&(V(e)||x(e)||S(e)||E(e)||h(e))}function v(e){return e&&e.sourceLayerInfo&&e.sourceLayerInfo.data instanceof o}function M(e){return e&&e.sourceLayerInfo&&e.sourceLayerInfo.data instanceof l.VectorTile}function R(e){return e&&e.sourceLayerInfo&&e.sourceLayerInfo.data instanceof f}function C(e){const t=e&&e.sourceLayerInfo&&e.sourceLayerInfo.data;return t instanceof HTMLImageElement||t instanceof a.ImageWithType||t instanceof HTMLCanvasElement||t instanceof ImageData}function D(e){return t.isSome(e)&&"release"in e&&e.release(),null}function b(e){return e.fetchTile&&!(e.fetchTile===r.prototype.fetchTile||e.fetchTile===n.prototype.fetchTile)}function k(e,t,n,r){let i;return i=2===r||"planar"===r?"planar":"spherical",u[i].checkIfTileInfoSupportedForViewSR(e,n,t)}function P(e,t,n){let r,i;if("wmts"===e.type){const a=e.activeLayer;if(a){const e=a.tileMatrixSet;if(e)r=e.tileInfo,i=e.fullExtent;else{const e=a.tileMatrixSets;if(e){const r=e.find((e=>null==k(e.tileInfo,e.fullExtent,t,n)));if(r)return{tileInfo:r.tileInfo,fullExtent:r.fullExtent}}}}}else i=w(e)?e.getCompatibleFullExtent(t):e.fullExtent,r="vector-tile"!==e.type||F.force512VTL?w(e)?e.getCompatibleTileInfo(t,i):e.tileInfo:e.compatibleTileInfo256;return r&&i&&null==k(r,i,t,n)?{tileInfo:r,fullExtent:i}:{tileInfo:null,fullExtent:null}}const F={force512VTL:!1};e.checkIfTileInfoSupportedForView=k,e.computeSkirtScale=L,e.getLayerWithExtentRange=p,e.getTiledLayerInfo=P,e.isElevationLayerView=S,e.isImageryTileLayerView=x,e.isImageryTileRenderInfo=v,e.isProjectableRasterLayer=w,e.isRasterTileRenderInfo=C,e.isSurfaceLayerView=g,e.isTextureTileRenderInfo=R,e.isTileLayerView=V,e.isVectorTileLayer=m,e.isVectorTileLayerView=E,e.isVectorTileRenderInfo=M,e.isWMTSLayerView=h,e.releaseTileData=D,e.test=F,e.useFetchTileForLayer=b,e.weakAssert=y,Object.defineProperty(e,"__esModule",{value:!0})}));
