/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./interfaces","../webgl-engine/lib/basicInterfaces","../webgl-engine/lib/LocalOriginFactory"],(function(e,t,r,i,s,a,n){"use strict";var o;e.OverlaySource=void 0,(o=e.OverlaySource||(e.OverlaySource={}))[o.None=0]="None",o[o.ColorAndWater=1]="ColorAndWater",o[o.Highlight=2]="Highlight",o[o.Occluded=3]="Occluded";let l=function(){function r(e,t){this.index=e,this.renderTargets=t,this.extent=i.create(),this.resolution=0,this.renderLocalOrigin=n.fromValues(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new g,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}var o=r.prototype;return o.getValidTarget=function(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null},o.getColorTexture=function(t){const r=t===e.OverlaySource.ColorAndWater?this.renderTargets.getTarget(s.RenderTargetType.Color):t===e.OverlaySource.Highlight?this.renderTargets.getTarget(s.RenderTargetType.Highlight):this.renderTargets.getTarget(s.RenderTargetType.Occluded);return r?r.getTexture():null},o.getNormalTexture=function(t){const r=t===e.OverlaySource.ColorAndWater?this.renderTargets.getTarget(s.RenderTargetType.Water):null;return r?r.getTexture():null},o.draw=function(e,t){const r=this.computeRenderTargetValidityBitfield(),i=this.needsColorWithoutRasterImage;for(const a of this.renderTargets.renderTargets)a.type===s.RenderTargetType.ColorNoRasterImage&&!1===i?this.validTargets[a.type]=!1:this.validTargets[a.type]=e.drawTarget(this,a,t);return r^this.computeRenderTargetValidityBitfield()?a.ValidationState.CHANGED:a.ValidationState.UNCHANGED},o.computeRenderTargetValidityBitfield=function(){const e=this.validTargets;return+e[s.RenderTargetType.Color]|+e[s.RenderTargetType.ColorNoRasterImage]<<1|+e[s.RenderTargetType.Highlight]<<2|+e[s.RenderTargetType.Water]<<3|+e[s.RenderTargetType.Occluded]<<4},o.setupGeometryViewsCyclical=function(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this.extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];i.offset(this.extent,e.range,0,t)}if(this.extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];i.offset(this.extent,-e.range,0,t)}},o.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1,i.copy(this.canvasGeometries.extents[0],this.extent)},o.hasSomeSizedView=function(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1},o.applyViewport=function(e){e.setViewport(this.index===s.OverlayIndex.INNER?0:this.resolution,0,this.resolution,this.resolution)},t._createClass(r,[{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]),r}();function u(e,t,i){return Math.min(r.nextHighestPowerOfTwo(Math.max(e,t)+256),i)}let g=function(){this.extents=[i.create(),i.create(),i.create()],this.numViews=0};e.Overlay=l,e.computeOverlayResolution=u,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
