/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec4f64"],(function(t,e,i,n){"use strict";let s=function(){function t(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}var n=t.prototype;return n.clear=function(){this._current=i.destroyMaybe(this._current),this._next=i.destroyMaybe(this._next),this._waiting=i.destroyMaybe(this._waiting),this._delayed=i.destroyMaybe(this._delayed)},n.push=function(t,e,n,s,a=0){this._delayed=i.destroyMaybe(this._delayed);const h=i.isSome(t)?new r(t,e,n,s):null;this._push(h,a)},n._push=function(t,e){if(this._isFading||this.clear(),i.isNone(this._current))return void(this._current=t);const n=performance.now();return 0!==e?(this._delayed=t,void(this._delayedTime=n+e)):i.isNone(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(n))):void(i.isNone(t)||(i.destroyMaybe(this._waiting),this._waiting=t))},n._alignFadeStart=function(t){const e=this._getFadeDuration();return t+e-t%e},e._createClass(t,[{key:"current",get:function(){if(i.isNone(this._current))return null;if(!this._isFading){const t=this._delayed||this._waiting||this._next||this._current;t!==this._current&&(this._current=null,this.clear(),this._current=t)}let t=0;if(i.isSome(this._delayed)&&(t=performance.now(),t>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null)),i.isSome(this._next)){t=t||performance.now();const e=this._fadeDuration;t-this._fadeStart>=e&&(i.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(i.isNone(this._next))return 1;const t=Math.max(0,performance.now()-this._fadeStart),e=this._fadeDuration;return t>e?0:1-t/e}},{key:"isFading",get:function(){return i.isSome(this._next)||i.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return i.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFading",get:function(){return this._getFadeDuration()>0}}]),t}(),r=function(){function t(t,e,i,s){this.texture=t,t.retain(),this.offsetAndScale=n.fromValues(e,i,s,s)}return t.prototype.destroy=function(){this.texture.release()},t}();t.TextureReference=r,t.default=s,Object.defineProperty(t,"__esModule",{value:!0})}));
