/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe"],(function(t,e){"use strict";return function(){function i(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}var n=i.prototype;return n.clear=function(){this._current=e.destroyMaybe(this._current),this._next=e.destroyMaybe(this._next),this._waiting=e.destroyMaybe(this._waiting),this._delayed=e.destroyMaybe(this._delayed)},n.push=function(t,i=0){this._delayed=e.destroyMaybe(this._delayed),this._push(t,i)},n._push=function(t,i){if(this._isFadingEnabled||this.clear(),e.isNone(this._current))return void(this._current=t);const n=performance.now();return 0!==i?(this._delayed=t,void(this._delayedTime=n+i)):e.isNone(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(n))):void(e.isNone(t)||(e.destroyMaybe(this._waiting),this._waiting=t))},n._alignFadeStart=function(t){const e=this._getFadeDuration();return t+e-t%e},t._createClass(i,[{key:"current",get:function(){if(e.isNone(this._current))return null;if(!this._isFadingEnabled){const t=this._delayed||this._waiting||this._next||this._current;t!==this._current&&(this._current=null,this.clear(),this._current=t)}let t=0;if(e.isSome(this._delayed)&&(t=performance.now(),t>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null)),e.isSome(this._next)){t=t||performance.now();const i=this._fadeDuration,n=e.isSome(this._current)&&this._next.texture===this._current.texture,s=0!==this._next.type,r=t-this._fadeStart>=i;(n||s||r)&&(e.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(e.isNone(this._next))return 1;const t=Math.max(0,performance.now()-this._fadeStart),i=this._fadeDuration;return t>i?0:1-t/i}},{key:"isFading",get:function(){return e.isSome(this._next)||e.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return e.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return this._getFadeDuration()>0}}]),i}()}));
