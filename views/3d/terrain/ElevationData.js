/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../core/maybe","../../../layers/support/ElevationSamplerData","../support/mathUtils","./TerrainConst"],(function(t,e,a,o,l,i){"use strict";let n=function(){function t(t,e,a){this.type="elevation",this.level=t[0],this.i=t[1],this.j=t[2],this.extent=e;const l=a.noDataValue,i=a.values;let n=1/0,s=-1/0,r=!0,h=!1;for(let o=0;o<i.length;o++){const t=i[o];t!==l?(n=t<n?t:n,s=t>s?t:s,r=!1):h=!0}r&&(n=0,s=0),s=s>-3e38?s:0,this.samplerData=new o.ElevationSamplerData(a,e),this.bounds=[n,s],this.hasNoDataValues=h}var e=t.prototype;return e.release=function(){this.samplerData=null,this.bounds=null},e.computeMinMaxValue=function(t,e,a,o){o.min=1/0,o.max=-1/0,o.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return o;const s=2**n;if(!(Math.floor(e/s)===this.i&&Math.floor(a/s)===this.j))return o;let r=1/0,h=-1/0;const u=this.samplerData.width,f=this.samplerData.pixelData,c=.5*i.ELEVATION_NODATA_VALUE;let p=(u-1)/s,m=(a-this.j*s)*p,M=(e-this.i*s)*p;if(p<1){const t=Math.floor(m),e=Math.floor(M),a=t+e*u,i=f[a],n=f[a+1],s=f[a+u],r=f[a+u+1];if(i+n+s+r<c){const a=m-t,h=M-e,u=l.bilerp(i,n,s,r,a,h),f=l.bilerp(i,n,s,r,a+p,h),c=l.bilerp(i,n,s,r,a,h+p),D=l.bilerp(i,n,s,r,a+p,h+p);return o.min=Math.min(u,f,c,D),o.max=Math.max(u,f,c,D),o}m=t,M=e,p=1}else m=Math.floor(m),M=Math.floor(M),p=Math.ceil(p);for(let l=m;l<=m+p;l++)for(let t=M;t<=M+p;t++){const e=f[l+t*u];e<c?(r=Math.min(r,e),h=Math.max(h,e)):o.hasNoDataValues=!0}return o.min=r,o.max=h,o},t}();const s=.5*i.ELEVATION_NODATA_VALUE;function r(t,o,l){if(a.isNone(l))return null;for(const a of l){if(!a)continue;const l=a.safeWidth;let i=e.clamp(a.dy*(a.y1-o),0,l),n=e.clamp(a.dx*(t-a.x0),0,l);const r=Math.floor(i),h=Math.floor(n),u=a.width,f=r*u+h,c=a.pixelData,p=c[f],m=c[f+1],M=f+u,D=c[M],x=c[M+1];if(p+D+m+x<s){i-=r,n-=h;const t=p+(m-p)*n;return t+(D+(x-D)*n-t)*i}}return null}t.ElevationData=n,t.sampleElevation=r,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
