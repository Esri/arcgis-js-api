/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../core/maybe","../../../layers/support/ElevationSamplerData","../support/mathUtils","./TerrainConst"],(function(t,a,e,o,i,l){"use strict";let n=function(){function t(t,a,e){this.type="elevation",this.level=t[0],this.i=t[1],this.j=t[2],this.extent=a,this.samplerData=new o.ElevationSamplerData(e,a)}return t.prototype.computeMinMaxValue=function(t,a,e,o){o.min=1/0,o.max=-1/0,o.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return o;const r=2**n;if(!(Math.floor(a/r)===this.i&&Math.floor(e/r)===this.j))return o;let s=1/0,h=-1/0;const f=this.samplerData.data.width,u=this.samplerData.data.values,c=.5*l.ELEVATION_NODATA_VALUE;let m=(f-1)/r,p=(e-this.j*r)*m,M=(a-this.i*r)*m;if(m<1){const t=Math.floor(p),a=Math.floor(M),e=t+a*f,l=u[e],n=u[e+1],r=u[e+f],s=u[e+f+1];if(l+n+r+s<c){const e=p-t,h=M-a,f=i.bilerp(l,n,r,s,e,h),u=i.bilerp(l,n,r,s,e+m,h),c=i.bilerp(l,n,r,s,e,h+m),d=i.bilerp(l,n,r,s,e+m,h+m);return o.min=Math.min(f,u,c,d),o.max=Math.max(f,u,c,d),o}p=t,M=a,m=1}else p=Math.floor(p),M=Math.floor(M),m=Math.ceil(m);for(let i=p;i<=p+m;i++)for(let t=M;t<=M+m;t++){const a=u[i+t*f];a<c?(s=Math.min(s,a),h=Math.max(h,a)):o.hasNoDataValues=!0}return o.min=s,o.max=h,o},t}();const r=.5*l.ELEVATION_NODATA_VALUE;function s(t,o,i){if(e.isNone(i))return null;for(const e of i){if(!e)continue;const i=e.safeWidth;let l=a.clamp(e.dy*(e.y1-o),0,i),n=a.clamp(e.dx*(t-e.x0),0,i);const s=Math.floor(l),h=Math.floor(n),f=e.data.width,u=s*f+h,c=e.data.values,m=c[u],p=c[u+1],M=u+f,d=c[M],v=c[M+1];if(m+d+p+v<r){l-=s,n-=h;const t=m+(p-m)*n;return t+(d+(v-d)*n-t)*l}}return null}t.ElevationData=n,t.sampleElevation=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
