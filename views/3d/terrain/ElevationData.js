/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],(function(t,a,e,i){"use strict";let l=function(){function t(t,a,e){this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=a;const i=e.noDataValue,l=e.values;let o=1/0,s=-1/0,n=!0,h=!1;for(let t=0;t<l.length;t++){const a=l[t];a!==i?(o=a<o?a:o,s=a>s?a:s,n=!1):h=!0}n&&(o=0,s=0),s=s>-3e38?s:0,this.samplerData={pixelData:e.values,width:e.width,height:e.height,noDataValue:i,safeWidth:.99999999*(e.width-1),dx:(e.width-1)/(a[2]-a[0]),dy:(e.width-1)/(a[3]-a[1]),x0:a[0],y1:a[3]},this.bounds=[o,s],this.hasNoDataValues=h}var l=t.prototype;return l.release=function(){this.samplerData=null,this.bounds=null},l.computeMinMaxValue=function(t,a,l,o){o.min=1/0,o.max=-1/0,o.hasNoDataValues=!1;const s=t-this.level;if(s<=0)return o;const n=Math.pow(2,s);if(!(Math.floor(a/n)===this.i&&Math.floor(l/n)===this.j))return o;let h=1/0,r=-1/0;const u=this.samplerData.width,f=this.samplerData.pixelData,c=.5*i.ELEVATION_NODATA_VALUE;let p=(u-1)/n,m=(l-this.j*n)*p,d=(a-this.i*n)*p;if(p<1){const t=Math.floor(m),a=Math.floor(d),i=t+a*u,l=f[i],s=f[i+1],n=f[i+u],h=f[i+u+1];if(l+s+n+h<c){const i=m-t,r=d-a,u=e.bilerp(l,s,n,h,i,r),f=e.bilerp(l,s,n,h,i+p,r),c=e.bilerp(l,s,n,h,i,r+p),M=e.bilerp(l,s,n,h,i+p,r+p);return o.min=Math.min(u,f,c,M),o.max=Math.max(u,f,c,M),o}m=t,d=a,p=1}else m=Math.floor(m),d=Math.floor(d),p=Math.ceil(p);for(let t=m;t<=m+p;t++)for(let a=d;a<=d+p;a++){const e=f[t+a*u];e<c?(h=Math.min(h,e),r=Math.max(r,e)):o.hasNoDataValues=!0}return o.min=h,o.max=r,o},t.sample=function(t,e,l){for(const o of l){if(!o)continue;const l=o.safeWidth,s=o.width,n=o.pixelData;let h=a.clamp(o.dy*(o.y1-e),0,l),r=a.clamp(o.dx*(t-o.x0),0,l);const u=Math.floor(h),f=Math.floor(r),c=u*s+f,p=c+s,m=n[c],d=n[p],M=n[c+1],D=n[p+1];if(m+d+M+D<.5*i.ELEVATION_NODATA_VALUE){h-=u,r-=f;const t=m+(M-m)*r;return t+(d+(D-d)*r-t)*h}}return null},t}();t.ElevationData=l,Object.defineProperty(t,"__esModule",{value:!0})}));
