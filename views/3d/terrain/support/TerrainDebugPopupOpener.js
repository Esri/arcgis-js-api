/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/has","../../../../core/Logger","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/decorators/subclass","../../../../core/urlUtils","../../../../core/uuid","../../../../portal/support/resourceExtension","../../../../symbols/FillSymbol3DLayer","../../../../symbols/PolygonSymbol3D","../../../../chunks/symbols","../../../../Graphic","../../../../core/watchUtils","../../../../geometry/support/aaBoundingRect","../../../../core/HandleOwner","../../support/debugFlags","../tileUtils"],(function(e,t,r,n,o,i,s,a,c,l,p,u,h,d,b,f,y,m,g,T){"use strict";e.TerrainDebugPopupOpener=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var n=r.prototype;return n.initialize=function(){this.handles.add(this.surface.view.on("click",this._clickEvent.bind(this))),g.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!0,this.surface.view.popup.autoOpenEnabled=!1,f.whenFalse(this.surface.view.popup,"visible",(()=>{this._removeTileBoundaryGraphic()}))},n.destroy=function(){this.surface.view.popup.autoOpenEnabled=!0},n._clickEvent=function(e){this.surface.view.hitTest(e).then((t=>{const r=t.intersector.results.min;if("TerrainRenderer"===r.intersector){const t=this.surface.getTile(r.name);this.surface.view.popup.actions.removeAll(),this.surface.view.popup.open({title:`Tile ${r.name}`,location:e.mapPoint,content:this._createTileDataTable(t)}),this._removeTileBoundaryGraphic(),this.tileBoundaryGraphic=this._createTileBoundaryGraphic(t),this.surface.view.graphics.add(this.tileBoundaryGraphic)}}))},n._createTileDataTable=function(e){const t=this.surface.test.getTiles(),r=t.indexOf(e),n=document.createElement("table");n.innerHTML=`<tr><th>Position</th><th>${r} of ${t.length}</th></tr>\n      <tr>\n        <th style='text-align:center;font-weight:bold'>type&nbsp;&nbsp;&nbsp;</th>\n        <th style='text-align:center;font-weight:bold'>layer&nbsp;&nbsp;&nbsp;</th>\n        <th style='text-align:center;font-weight:bold'>data from tile&nbsp;&nbsp;&nbsp;</th>\n      </tr>`;for(let t=0;t<e.layerInfo.length;t++){const r=e.layerInfo[t];for(let o=0;o<r.length;o++){const i=r[o],s=document.createElement("tr");let a;a=document.createElement("td"),a.textContent=0===o?v[t]:"",s.appendChild(a),a=document.createElement("td"),a.textContent=o.toString(),s.appendChild(a);const c=i.data?e:i.upsampleInfo?i.upsampleInfo.tile:null;a=document.createElement("td"),a.textContent=c?T.tile2str(c):"no data",s.appendChild(a),n.appendChild(s)}}return n},n._removeTileBoundaryGraphic=function(){this.tileBoundaryGraphic&&(this.surface.view.graphics.remove(this.tileBoundaryGraphic),this.tileBoundaryGraphic=null)},n._createTileBoundaryGraphic=function(e){const t=y.toExtent(e.extent,this.surface.spatialReference),r=new h({symbolLayers:[new u({material:{color:"rgba(0, 0, 0, 0)"},outline:{size:"3px",color:"red"}})]});return new b({geometry:t,symbol:r})},r}(m.HandleOwner),r.__decorate([s.property({constructOnly:!0})],e.TerrainDebugPopupOpener.prototype,"surface",void 0),e.TerrainDebugPopupOpener=r.__decorate([a.subclass("esri.views.3d.terrain.support.TerrainDebugPopupOpener")],e.TerrainDebugPopupOpener);const v=["elev","map"];Object.defineProperty(e,"__esModule",{value:!0})}));
