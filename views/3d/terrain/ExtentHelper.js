/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import t from"../../../core/Accessor.js";import r from"../../../core/Handles.js";import{isSome as s,isNone as n}from"../../../core/maybe.js";import{property as i}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import{subclass as o}from"../../../core/accessorSupport/decorators/subclass.js";import{projectWithoutEngine as l}from"../../../geometry/projection.js";import{fromExtent as a,empty as c,expand as p,allFinite as u,equals as y}from"../../../geometry/support/aaBoundingRect.js";import{isTiledLayer as d}from"../../../layers/support/layerUtils.js";import{ViewingMode as f}from"../../ViewingMode.js";import{WEBMERCATOR_WORLD_EXTENT as m,GEOGRAPHIC_WORLD_EXTENT as h}from"./TerrainConst.js";import{getTiledLayerInfo as E,isProjectableRasterLayer as x}from"./terrainUtils.js";let w=class extends t{constructor(e){super(e),this._handles=new r}initialize(){this._handles.add([this.layerViews.on("change",(()=>this.notifyChange("stencilEnabledExtents")))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach((t=>{const r=t.layer;if("IntegratedMeshLayer"===r.operationalLayerType&&null!=this.viewSpatialReference){const t=j(r.fullExtent,this.viewSpatialReference);s(t)&&e.push(a(t))}})),e}};function g(e,t){return e===f.Global?new _(t):new L(t)}e([i({readOnly:!0})],w.prototype,"layerViewsExtent",null),e([i({readOnly:!0})],w.prototype,"tiledLayersExtent",null),e([i({readOnly:!0})],w.prototype,"stencilEnabledExtents",null),e([i()],w.prototype,"viewSpatialReference",void 0),e([i()],w.prototype,"tilingScheme",void 0),e([i()],w.prototype,"defaultTiledLayersExtent",void 0),e([i({constructOnly:!0})],w.prototype,"layers",void 0),e([i({constructOnly:!0})],w.prototype,"layerViews",void 0),w=e([o("esri.views.3d.terrain.ExtentHelper")],w);let _=class extends w{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?m:h}};_=e([o("esri.views.3d.terrain.ExtentHelperGlobal")],_);let L=class extends w{_computeLayerViewsExtent(){const e=c(),t=this.viewSpatialReference;this.layerViews.forEach((r=>{const s=r.layer;if(r.isResolved()&&("graphics"!==s.type||!s.internal)){const s=j("fullExtentInLocalViewSpatialReference"in r&&r.fullExtentInLocalViewSpatialReference||r.layer.fullExtent,t);p(e,s,e)}}));const r=u(e)?e:null,s=this._get("layerViewsExtent");return y(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=c();this.layers.forEach((i=>{if(i.loaded&&d(i)){const o=E(i,t,f.Local);if(n(o))return;const{tileInfo:l,fullExtent:a}=o;s(l)&&s(a)&&(x(i)||e.compatibleWith(l)&&a.spatialReference.equals(e.spatialReference))&&p(r,a,r)}})),p(r,this.defaultTiledLayersExtent,r);const i=u(r)?r:null,o=this._get("tiledLayersExtent");return y(i,o)?o:i}};function j(e,t){return s(e)&&!e.spatialReference.equals(t)?l(e,e.spatialReference,t):e}L=e([o("esri.views.3d.terrain.ExtentHelperLocal")],L);export{w as ExtentHelper,g as create};
