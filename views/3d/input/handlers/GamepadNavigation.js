/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import a from"../../../../core/Handles.js";import{watch as e,initial as t}from"../../../../core/reactiveUtils.js";import{GamepadKeyboardController as r}from"../../state/controllers/GamepadKeyboardController.js";import{InputHandler as i}from"../../../input/InputHandler.js";class l extends i{constructor(e){super(!0),this.view=e,this.watchHandles=new a,this.handle=this.registerIncoming("gamepad",(a=>this._handleEventGamepad(a))),this.handle.pause()}onInstall(a){super.onInstall(a),this.watchHandles.add([e((()=>this.view.navigation.gamepad.enabled),(a=>{a?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))}),t),e((()=>this.view.navigation.gamepad.device),(a=>{this.cameraControllerGamepad&&a&&this.cameraControllerGamepad.gamepadDevice!==a&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)}))])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(a){const e=this.view.navigation.gamepad.device;if(e&&a.data.device!==e)return;const t=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(t||r.activatesFor(this.view,a.data)){if(!t){const e=new r({view:this.view,gamepadDevice:a.data.device});this.view.state.switchCameraController(e)&&(this.cameraControllerGamepad=e)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===a.data.device&&this.cameraControllerGamepad.handleEventGamepad(a.data)}}}export{l as GamepadNavigation};
