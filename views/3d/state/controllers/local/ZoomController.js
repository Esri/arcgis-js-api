/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/mathUtils","../../../../../core/screenUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/vec2","../../../../../chunks/vec2f64","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../../../geometry/support/plane","../../../camera/constraintUtils","../../../camera/constraintUtils/common","../InteractiveController","../../utils/navigationUtils"],(function(t,e,i,r,n,a,s,o,c,h,m,p,l,u,C,P,y,d,v){"use strict";t.ZoomController=function(t){function i(e){var i;return(i=t.call(this,e)||this).view=null,i.tmpP=u.create(),i.tmpDir=u.create(),i.tmpN=u.create(),i.tmpP0=p.create(),i.tmpPoi=u.create(),i.tmpRayDir=u.create(),i.dragBeginPoint=n.createScreenPointArray(),i.normalizedAnchorPoint=p.create(),i.constraintOptions={selection:y.ConstraintTypes.ALL,interactionType:y.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:u.create(),tiltMode:y.TiltMode.TUMBLE},i.plane=C.create(),i}e._inheritsLoose(i,t);var a=i.prototype;return a.begin=function(t){if(!this.active)return;let e;m.copy(this.dragBeginPoint,t),v.normalizeCoordinate(this.startCamera,t,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(t,this.tmpP),l.subtract(this.tmpDir,this.tmpP,this.startCamera.eye),l.normalize(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(e=Math.abs(this.view.camera.position.z));let i=r.clamp(v.PIVOT_DISTANCE_MODIFIER*e,v.DISTANCE_CLAMP_VALUES[0],v.DISTANCE_CLAMP_VALUES[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),t[0],t[1],this.view.state.camera,v.SCREEN_PIXEL_AREA);i=i>n?n:i,l.scale(this.tmpDir,this.tmpDir,i),l.add(this.tmpP,this.startCamera.eye,this.tmpDir),l.subtract(this.tmpN,this.startCamera.eye,this.startCamera.center),l.normalize(this.tmpN,this.tmpN),this.tmpN[1]<0&&l.negate(this.tmpN,this.tmpN),C.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera},a.update=function(t){if(!this.active)return;v.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||l.copy(this.tmpPoi,this.currentCamera.center),v.normalizeCoordinate(this.currentCamera,t,this.tmpP0);let e=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);m.copy(this.normalizedAnchorPoint,this.tmpP0),l.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=l.length(this.tmpRayDir);let r=i*(1-e);l.copy(this.constraintOptions.interactionDirection,this.tmpRayDir),l.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(e)/i);const n=this.view.state.constraints.minimumPoiDistance;e>=0&&r<n&&(r=n,e=-(r-i)/i),Math.abs(i-r)<1e-6||(l.scale(this.tmpRayDir,this.tmpRayDir,e),this.currentCamera.eye=l.add(D,this.currentCamera.eye,this.tmpRayDir),l.lerp(D,this.currentCamera.center,this.tmpPoi,e),this.tmpPoi[2]>this.startCamera.center[2]?D[2]=Math.max(this.startCamera.center[2],D[2]):D[2]=Math.min(this.startCamera.center[2],D[2]),this.currentCamera.center=D,this.constraintOptions.interactionFactor=P.pixelDistanceToInteractionFactor(this.dragBeginPoint,t),P.applyAll(this.view,this.currentCamera,this.constraintOptions))},a.end=function(){this.active&&this.finishController()},e._createClass(i,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]),i}(d.InteractiveController),i.__decorate([a.property({constructOnly:!0})],t.ZoomController.prototype,"view",void 0),t.ZoomController=i.__decorate([h.subclass("esri.views.3d.state.controllers.local.ZoomController")],t.ZoomController);const D=u.create();Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
