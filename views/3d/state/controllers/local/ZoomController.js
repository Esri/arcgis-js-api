/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/screenUtils","../../../../../core/Logger","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/Error","../../../../../core/has","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/vec2","../../../../../chunks/vec2f64","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../../../geometry/support/plane","../../../camera/constraintUtils","../../../camera/constraintUtils/ConstraintTypes","../../../camera/constraintUtils/InteractionType","../../../camera/constraintUtils/TiltMode","../InteractiveController","../../utils/navigationUtils","../../../webgl-engine/lib/verticalOffsetUtils"],(function(t,e,i,r,a,n,s,o,c,h,m,l,p,_,u,C,P,y,d,D,g,v,A,M){"use strict";t.ZoomController=function(t){function i(){var e;return(e=t.apply(this,arguments)||this)._tmpP=C.create(),e._tmpDir=C.create(),e._tmpN=C.create(),e._tmpP0=_.create(),e._tmpPoi=C.create(),e._tmpRayDir=C.create(),e.dragBeginPoint=n.createScreenPointArray(),e._normalizedAnchorPoint=_.create(),e._constraintOptions={selection:d.ConstraintTypes.ALL,interactionType:D.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:C.create(),tiltMode:g.TiltMode.TUMBLE},e._plane=P.create(),e}e._inheritsLoose(i,t);var s=i.prototype;return s.begin=function(t){if(!this.active)return;p.copy(this.dragBeginPoint,t),A.normalizeCoordinate(this.startCamera,t,this._normalizedAnchorPoint);const e=this._intersectionHelper.intersectScreenFreePointFallback(t,this._tmpP,0===this.view.map.ground.opacity?S:{});u.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);const i=u.length(this._tmpDir);let n;u.normalize(this._tmpDir,this._tmpDir),this.view.camera.position.hasZ&&(n=Math.abs(this.view.camera.position.z));let s=r.clamp(A.PIVOT_DISTANCE_MODIFIER*n,A.DISTANCE_CLAMP_VALUES[0],A.DISTANCE_CLAMP_VALUES[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,A.SCREEN_PIXEL_AREA);s=a.isSome(o)?Math.min(s,o):s,s=e?Math.min(s,i):s,u.scale(this._tmpDir,this._tmpDir,s),u.add(this._tmpP,this.startCamera.eye,this._tmpDir),u.subtract(this._tmpN,this.startCamera.eye,this.startCamera.center),u.normalize(this._tmpN,this._tmpN),this._tmpN[1]<0&&u.negate(this._tmpN,this._tmpN),P.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera},s.update=function(t){if(!this.active)return;A.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||u.copy(this._tmpPoi,this.currentCamera.center),A.normalizeCoordinate(this.currentCamera,t,this._tmpP0);let e=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);p.copy(this._normalizedAnchorPoint,this._tmpP0),u.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=u.length(this._tmpRayDir);let r=i*(1-e);u.copy(this._constraintOptions.interactionDirection,this._tmpRayDir),u.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(e)/i);const a=this.view.state.constraints.minimumPoiDistance;e>=0&&r<a&&(r=a,e=-(r-i)/i),Math.abs(i-r)<1e-6||(u.scale(this._tmpRayDir,this._tmpRayDir,e),this.currentCamera.eye=u.add(f,this.currentCamera.eye,this._tmpRayDir),u.lerp(f,this.currentCamera.center,this._tmpPoi,e),this._tmpPoi[2]>this.startCamera.center[2]?f[2]=Math.max(this.startCamera.center[2],f[2]):f[2]=Math.min(this.startCamera.center[2],f[2]),this.currentCamera.center=f,this._constraintOptions.interactionFactor=y.pixelDistanceToInteractionFactor(p.distance(this.dragBeginPoint,t)),y.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())},s.end=function(){this.active&&this.finishController()},e._createClass(i,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]),i}(v.InteractiveController),t.ZoomController=i.__decorate([l.subclass("esri.views.3d.state.controllers.local.ZoomController")],t.ZoomController);const f=C.create(),S={exclude:new Set([M.TERRAIN_ID])};Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
