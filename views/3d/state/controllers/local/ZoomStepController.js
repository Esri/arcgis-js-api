/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/time","../../../../../core/Logger","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/set","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../camera/constraintUtils","../../../camera/constraintUtils/common","../PointToPointAnimationController","../../../webgl-engine/lib/Camera","../../../webgl-engine/lib/Intersector","../../../../animation/easing"],(function(t,e,i,o,a,n,r,s,c,m,l,p,h,u,y,C,d,g){"use strict";const b=.6,v=4,w=60,S=14,f=20;t.ZoomStepController=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).zoomLocation=p.create(),e.tmpCamera=new C.default,e.tmpRayDir=p.create(),e.tmpCenter=p.create(),e.constraintOptions={selection:u.ConstraintTypes.ALL,interactionType:u.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new C.default,interactionDirection:null,tiltMode:u.TiltMode.TUMBLE},e}e._inheritsLoose(i,t);var a=i.prototype;return a.zoomStep=function(t,e){if(!this.active)return;const i=this.view.state,{interactionStartCamera:o}=this.constraintOptions;this.animation.finished?o.copyFrom(i.camera):this.animation.cameraAt(1,o),this.tmpCamera.copyFrom(i.camera);const a=d.newIntersector(this.view.state.viewingMode);t>0?(this.intersectionHelper.intersectScreenFreePointFallback(e,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,a,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,a,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:l.copy(this.zoomLocation,this.tmpCamera.center);const n=b**t;let r=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),e[0],e[1],this.view.state.camera,w);const s=Math.max(S*Math.abs(this.view.camera.position.z),f);if(r=r?Math.min(r,s):s,r){const t=p.create();l.subtract(t,this.zoomLocation,this.tmpCamera.eye),r<l.length(t)&&(l.normalize(t,t),l.add(this.zoomLocation,this.tmpCamera.eye,l.scale(t,t,r)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)},a.animationSettings=function(){return{apex:null,duration:o.Milliseconds(600),easing:g.outExpo}},a._updateCamera=function(t,e,i){l.subtract(this.tmpRayDir,i,t.eye);const o=l.length(this.tmpRayDir);let a=o*e;const n=e<=1,r=Math.max(v,1.01*t.nearFar[0]);n&&a<r&&(a=r,e=a/o),Math.abs(o-a)<1e-6||(l.scale(this.tmpRayDir,this.tmpRayDir,e),t.eye=l.subtract(M,i,this.tmpRayDir),t.center=l.lerp(M,t.center,i,1-e),h.applyAll(this.view,t,this.constraintOptions))},i}(y.PointToPointAnimationController),t.ZoomStepController=i.__decorate([m.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],t.ZoomStepController);const M=p.create();Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
