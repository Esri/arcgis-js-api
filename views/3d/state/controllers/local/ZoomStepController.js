/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/has","../../../../../core/Logger","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/urlUtils","../../../../../core/uuid","../../../../../portal/support/resourceExtension","../../../../../chunks/vec3f64","../../../../../chunks/vec3","../../../../../support/featureFlags","../../../webgl-engine/lib/Intersector","../../../../animation/easing","../../../camera/constraintUtils","../../../webgl-engine/lib/Camera","../PointToPointAnimationController"],(function(t,e,i,o,a,r,n,s,c,m,p,l,h,u,C,y,g,d,b){"use strict";t.ZoomStepController=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).zoomLocation=l.create(),e.tmpCamera=new d,e.tmpRayDir=l.create(),e.tmpCenter=l.create(),e.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new d,interactionDirection:null,tiltMode:0},e}e._inheritsLoose(i,t);var o=i.prototype;return o.zoomStep=function(t,e){if(!this.active)return;const i=this.view.state,{interactionStartCamera:o}=this.constraintOptions;this.animation.finished?o.copyFrom(i.camera):this.animation.cameraAt(1,o),this.tmpCamera.copyFrom(i.camera);const a=new C.Intersector(this.view.state.mode);t>0?(this.intersectionHelper.intersectScreenFreePointFallback(e,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,a,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,a,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:h.copy(this.zoomLocation,this.tmpCamera.center);const r=Math.pow(.6,t);if(!u.disableContextNavigation()&&this.view._stage.getCamera()._contextNavigation){let t=this.view._stage.renderView.getMinimalDepthForArea(e[0],e[1],this.view._stage.getCamera(),60);const i=Math.max(14*Math.abs(this.view.camera.position.z),20);if(t=t?Math.min(t,i):i,t){const e=l.create();h.subtract(e,this.zoomLocation,this.tmpCamera.eye),t<h.length(e)&&(h.normalize(e,e),h.add(this.zoomLocation,this.tmpCamera.eye,h.scale(e,e,t)))}}this.updateCamera(this.tmpCamera,r,this.zoomLocation),this.begin(this.tmpCamera)},o.animationSettings=function(){return{apex:null,duration:.6,easing:y.outExpo}},o.updateCamera=function(t,e,i){h.subtract(this.tmpRayDir,i,t.eye);const o=h.length(this.tmpRayDir);let a=o*e;e<=1&&a<4&&(a=4,e=a/o),Math.abs(o-a)<1e-6||(h.scale(this.tmpRayDir,this.tmpRayDir,e),h.subtract(t.eye,i,this.tmpRayDir),h.lerp(t.center,t.center,i,1-e),g.applyAll(this.view,t,this.constraintOptions))},i}(b.PointToPointAnimationController),t.ZoomStepController=i.__decorate([s.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],t.ZoomStepController),Object.defineProperty(t,"__esModule",{value:!0})}));
