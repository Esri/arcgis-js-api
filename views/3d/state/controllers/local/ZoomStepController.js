/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/maybe","../../../../../core/time","../../../../../core/Logger","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/Error","../../../../../core/has","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../camera/constraintUtils","../../../camera/constraintUtils/ConstraintTypes","../../../camera/constraintUtils/InteractionType","../../../camera/constraintUtils/TiltMode","../PointToPointAnimationController","../../../webgl-engine/lib/Camera","../../../webgl-engine/lib/Intersector","../../../webgl-engine/lib/verticalOffsetUtils","../../../../animation/easing"],(function(t,e,i,a,o,r,n,s,c,m,l,h,p,_,u,y,C,b,d,g,v,w){"use strict";const M=.6,S=4,f=60,L=14,z=200;t.ZoomStepController=function(t){function i(){var e;return(e=t.apply(this,arguments)||this)._zoomLocation=p.create(),e._tmpCamera=new d.Camera,e._tmpRayDir=p.create(),e._tmpCenter=p.create(),e._constraintOptions={selection:u.ConstraintTypes.ALL,interactionType:y.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new d.Camera,interactionDirection:null,tiltMode:C.TiltMode.TUMBLE},e}e._inheritsLoose(i,t);var r=i.prototype;return r.zoomStep=function(t,e){if(!this.active)return;const i=this.view.state,{interactionStartCamera:o}=this._constraintOptions;this.animation.finished?o.copyFrom(i.camera):this.animation.cameraAt(1,o),this._tmpCamera.copyFrom(i.camera);const r=g.newIntersector(this.view.state.viewingMode);t>0?(0===this.view.map.ground.opacity?this.intersectionHelper.intersectScreenFreePointFallback(e,this._zoomLocation,F):this.intersectionHelper.intersectScreenFreePointFallback(e,this._zoomLocation),this.intersectionHelper.intersectRay(this._tmpCamera.ray,r,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,r,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:h.copy(this._zoomLocation,this._tmpCamera.center);const n=M**t;let s=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,f);h.subtract(D,this._tmpCamera.eye,this._zoomLocation),h.normalize(D,D);const c=Math.max(Math.min(L,1/Math.abs(h.dot(R,D)))*Math.abs(this.view.camera.position.z),z);if(s=a.isSome(s)?Math.min(s,c):c,s){const t=p.create();h.subtract(t,this._zoomLocation,this._tmpCamera.eye),s<h.length(t)&&(h.normalize(t,t),h.add(this._zoomLocation,this._tmpCamera.eye,h.scale(t,t,s)))}this._updateCamera(this._tmpCamera,n,this._zoomLocation),this.begin(this._tmpCamera)},r.animationSettings=function(){return{apex:null,duration:o.Milliseconds(600),easing:w.outExpo}},r._updateCamera=function(t,e,i){h.subtract(this._tmpRayDir,i,t.eye);const a=h.length(this._tmpRayDir);let o=a*e;const r=e<=1,n=Math.max(S,1.01*t.nearFar[0]);0!==o&&(r&&o<n&&(o=n,e=o/a),Math.abs(a-o)<1e-6||(h.scale(this._tmpRayDir,this._tmpRayDir,e),t.eye=h.subtract(T,i,this._tmpRayDir),t.center=h.lerp(T,t.center,i,1-e),_.applyAll(this.view,t,this._constraintOptions)))},i}(b.PointToPointAnimationController),t.ZoomStepController=i.__decorate([l.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],t.ZoomStepController);const T=p.create(),R=p.fromValues(0,0,1),D=p.create(),F={exclude:new Set([v.TERRAIN_ID])};Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
