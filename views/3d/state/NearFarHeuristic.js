/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../chunks/vec3f64","../../../chunks/vec3","../../../geometry/projectionEllipsoid","../../../core/unitUtils"],(function(e,t,n,i,r,s){"use strict";function a(e,t,n){return 1===e?new c(n):new o(t,n)}let o=function(){function e(e,t){this.elevationProvider=e,this._referenceEllipsoid=r.getReferenceEllipsoid(t),this.unitInMeters=s.getMetersPerUnitForSR(t,this._referenceEllipsoid.metersPerDegree)}return e.prototype.compute=function(e,n,r,s,a){a||(a={near:0,far:0});let o=e[2]*this.unitInMeters;const c=o,h=o-s,p=this.elevationProvider?this.elevationProvider.elevationBounds:null;p&&(o=h>=0?c-this.unitInMeters*p.min:this.unitInMeters*p.max-c);const d={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},y=Math.max(d.x,d.y,d.z);i.subtract(f,n,e),M[0]=f[0]>0?r.xmax:r.xmin,M[1]=f[1]>0?r.ymax:r.ymin,M[2]=f[2]>0?y/2:-y/2,i.subtract(M,M,e),i.normalize(f,f);const v=1.1*i.dot(M,f)*this.unitInMeters,E=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),I=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),g=I*m*this.unitInMeters,_=I*x*this.unitInMeters;let b=t.clamp((o-_)/(g-_),0,1);b*=b*b;let P=t.lerp(E,v,b);return P*=Math.max(Math.log(Math.abs(h)),1),P=Math.min(P,Math.max(34064e4,y)),P/=this.unitInMeters,u(P,l,this.unitInMeters,a)},e}(),c=function(){function e(e){this._referenceEllipsoid=r.getReferenceEllipsoid(e)}return e.prototype.compute=function(e,n,r,s,a){a||(a={near:0,far:0});const o=i.length(e)-this._referenceEllipsoid.radius,c=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),h=Math.max(l,Math.abs(o));return u(1.2*Math.sqrt(h*(h+2*c)),t.clamp(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,a)},e}();function u(e,t,n,i){const r=h/n;return e/t>r?(i.far=e,i.near=i.far/t):(i.near=r,i.far=i.near*t),i}const l=2e4,h=2,m=.001,x=1e-4,M=n.create(),f=n.create();e.createNearFarHeuristic=a,Object.defineProperty(e,"__esModule",{value:!0})}));
