/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../chunks/vec3f64","../../../chunks/vec3","../../../geometry/projectionEllipsoid","../../../core/unitUtils"],(function(e,t,n,i,r,s){"use strict";let a=function(){function e(e,t){this.elevationProvider=e,this._referenceEllipsoid=r.getReferenceEllipsoid(t),this.unitInMeters=s.getMetersPerUnitForSR(t,this._referenceEllipsoid.metersPerDegree)}return e.prototype.compute=function(e,n,r,s,a){a||(a={near:0,far:0});let o=e[2]*this.unitInMeters;const l=o,f=o-s,p=this.elevationProvider?this.elevationProvider.elevationBounds:null;p&&(o=f>=0?l-this.unitInMeters*p.min:this.unitInMeters*p.max-l);const d={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},y=Math.max(d.x,d.y,d.z);i.subtract(M,n,e),x[0]=M[0]>0?r.xmax:r.xmin,x[1]=M[1]>0?r.ymax:r.ymin,x[2]=M[2]>0?y/2:-y/2,i.subtract(x,x,e),i.normalize(M,M);const v=1.1*i.dot(x,M)*this.unitInMeters,E=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),I=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),g=I*h*this.unitInMeters,_=I*m*this.unitInMeters;let b=t.clamp((o-_)/(g-_),0,1);b*=b*b;let P=t.lerp(E,v,b);return P*=Math.max(Math.log(Math.abs(f)),1),P=Math.min(P,Math.max(34064e4,y)),P/=this.unitInMeters,c(P,u,this.unitInMeters,a)},e}(),o=function(){function e(e){this._referenceEllipsoid=r.getReferenceEllipsoid(e)}return e.prototype.compute=function(e,n,r,s,a){a||(a={near:0,far:0});const o=i.length(e)-this._referenceEllipsoid.radius,u=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),h=Math.max(l,Math.abs(o));return c(1.2*Math.sqrt(h*(h+2*u)),t.clamp(2e4-(Math.log(h)-7.983)/9.011*19e3,1e3,2e4),1,a)},e}();function c(e,t,n,i){const r=l/n;return e/t>r?(i.far=e,i.near=i.far/t):(i.near=r,i.far=i.near*t),i}const u=2e4,l=2,h=.001,m=1e-4,x=n.create(),M=n.create();e.createNearFarHeuristic=function(e,t,n){return 1===e?new o(n):new a(t,n)},Object.defineProperty(e,"__esModule",{value:!0})}));
