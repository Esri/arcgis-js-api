/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/vec3f64","../../../chunks/vec3","../../../chunks/mat3f64","../../../chunks/quatf64","../../../chunks/vec4f64","../../../chunks/mat3","../../../chunks/vec4","../../../chunks/quat","../../../geometry/support/aaBoundingBox","../../../chunks/vec3f32","./geometryUtils","../../../chunks/quatf32","./dito"],(function(e,t,n,a,r,c,i,s,o,f,u,h,l,z){"use strict";const S=r.create(),b=t.create(),m=t.create(),M=c.create(),p=a.create();function d(e=[0,0,0],n=[-1,-1,-1],a=[0,0,0,1]){return{center:t.clone(e),halfSize:u.clone(n),quaternion:l.clone(a)}}function q(e,t){const n=h.plane.signedDistance(t,e.center),a=y(e,h.plane.normal(t));return n>a?1:n<-a?-1:0}const g=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],k=(()=>{const e=new Int8Array(162);let t=0;const n=n=>{for(let a=0;a<n.length;a++)e[t+a]=n[a];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function y(e,t){o.conjugate(S,e.quaternion),n.transformQuat(b,t,S);const a=e.halfSize;return Math.abs(b[0]*a[0])+Math.abs(b[1]*a[1])+Math.abs(b[2]*a[2])}e.ObbArray=function(e){const n=56*e;this.buffer=new ArrayBuffer(n),this.obbs=new Array(e);for(let n=0;n<e;n++)this.obbs[n]={center:t.createView(this.buffer,56*n+0),halfSize:u.createView(this.buffer,56*n+24),quaternion:l.createView(this.buffer,56*n+36)}},e.clone=function(e){return d(e.center,e.halfSize,e.quaternion)},e.compute=function(e,t){return t=t||d(),z.computeOBB(e,t),t},e.corners=function(e,t){for(let a=0;a<8;++a){const r=t[a];r[0]=1&a?-e.halfSize[0]:e.halfSize[0],r[1]=2&a?-e.halfSize[1]:e.halfSize[1],r[2]=4&a?-e.halfSize[2]:e.halfSize[2],n.transformQuat(r,r,e.quaternion),n.add(r,r,e.center)}},e.create=d,e.intersectLine=function(e,t,a,r=0){o.conjugate(S,e.quaternion),n.subtract(b,t,e.center);const c=n.transformQuat(b,b,S),i=n.transformQuat(m,a,S);let s=-1/0,f=1/0;for(let t=0;t<3;t++)if(Math.abs(i[t])>1e-6){const n=(r+e.halfSize[t]-c[t])/i[t],a=(-r-e.halfSize[t]-c[t])/i[t];s=Math.max(s,Math.min(n,a)),f=Math.min(f,Math.max(n,a))}else if(c[t]>e.halfSize[t]+r||c[t]<-e.halfSize[t]-r)return!1;return s<=f},e.intersectPlane=q,e.isVisible=function(e,t){return q(e,t.planes[0])<=0&&q(e,t.planes[1])<=0&&q(e,t.planes[2])<=0&&q(e,t.planes[3])<=0&&q(e,t.planes[4])<=0&&q(e,t.planes[5])<=0},e.maximumDistancePlane=function(e,t){return h.plane.signedDistance(t,e.center)+y(e,h.plane.normal(t))},e.minimumDistancePlane=function(e,t){return h.plane.signedDistance(t,e.center)-y(e,h.plane.normal(t))},e.projectedArea=function(e,t,a,r,c){o.conjugate(S,e.quaternion),n.sub(b,t,e.center),n.transformQuat(b,b,S);const f=b[0]<-e.halfSize[0]?-1:b[0]>e.halfSize[0]?1:0,u=b[1]<-e.halfSize[1]?-1:b[1]>e.halfSize[1]?1:0,h=b[2]<-e.halfSize[2]?-1:b[2]>e.halfSize[2]?1:0,l=Math.abs(f)+Math.abs(u)+Math.abs(h);if(0===l)return 1/0;const z=1===l?4:6,m=6*(f+3*u+9*h+13);i.fromQuat(p,e.quaternion),i.scale(p,p,e.halfSize);for(let t=0;t<z;t++){const r=k[m+t];n.set(b,((1&r)<<1)-1,(2&r)-1,((4&r)>>1)-1),n.transformMat3(b,b,p),n.add(M,e.center,b),M[3]=1,s.transformMat4(M,M,a);const c=1/Math.max(1e-6,M[3]);g[2*t]=M[0]*c,g[2*t+1]=M[1]*c}const d=2*z-2;let q=g[0]*(g[3]-g[d+1])+g[d]*(g[1]-g[d-1]);for(let e=2;e<d;e+=2)q+=g[e]*(g[e+3]-g[e-1]);return Math.abs(q)*r*c*.125},e.projectedRadius=y,e.set=function(e,t){n.copy(t.center,e.center),n.copy(t.halfSize,e.halfSize),o.copy(t.quaternion,e.quaternion)},e.toAaBoundingBox=function(e,t){t||(t=f.create());const n=i.fromQuat(p,e.quaternion),a=e.halfSize[0]*Math.abs(n[0])+e.halfSize[1]*Math.abs(n[3])+e.halfSize[2]*Math.abs(n[6]),r=e.halfSize[0]*Math.abs(n[1])+e.halfSize[1]*Math.abs(n[4])+e.halfSize[2]*Math.abs(n[7]),c=e.halfSize[0]*Math.abs(n[2])+e.halfSize[1]*Math.abs(n[5])+e.halfSize[2]*Math.abs(n[8]);return t[0]=e.center[0]-a,t[1]=e.center[1]-r,t[2]=e.center[2]-c,t[3]=e.center[0]+a,t[4]=e.center[1]+r,t[5]=e.center[2]+c,t},Object.defineProperty(e,"__esModule",{value:!0})}));
