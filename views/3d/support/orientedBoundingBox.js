/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/vec3f64","../../../chunks/vec3","../../../chunks/mat3f64","../../../chunks/quatf64","../../../chunks/vec4f64","../../../chunks/mat3","../../../chunks/vec4","../../../chunks/quat","../../../geometry/support/aaBoundingBox","../../../chunks/vec3f32","./geometryUtils","../../../chunks/quatf32","./dito"],(function(e,t,n,a,r,c,i,o,s,f,u,h,l,z){"use strict";const S=r.create(),b=t.create(),m=t.create(),M=c.create(),p=a.create();let d=function(e){const n=56,a=0,r=24,c=36,i=e*n;this.buffer=new ArrayBuffer(i),this.obbs=new Array(e);for(let o=0;o<e;o++)this.obbs[o]={center:t.createView(this.buffer,n*o+a),halfSize:u.createView(this.buffer,n*o+r),quaternion:l.createView(this.buffer,n*o+c)}};function q(e=[0,0,0],n=[-1,-1,-1],a=[0,0,0,1]){return{center:t.clone(e),halfSize:u.clone(n),quaternion:l.clone(a)}}function g(e){return q(e.center,e.halfSize,e.quaternion)}function k(e,t){n.copy(t.center,e.center),n.copy(t.halfSize,e.halfSize),s.copy(t.quaternion,e.quaternion)}function y(e,t){return t=t||q(),z.computeOBB(e,t),t}function x(e,t){const n=h.plane.signedDistance(t,e.center),a=V(e,h.plane.normal(t));return n>a?1:n<-a?-1:0}function B(e,t){t||(t=f.create());const n=i.fromQuat(p,e.quaternion),a=e.halfSize[0]*Math.abs(n[0])+e.halfSize[1]*Math.abs(n[3])+e.halfSize[2]*Math.abs(n[6]),r=e.halfSize[0]*Math.abs(n[1])+e.halfSize[1]*Math.abs(n[4])+e.halfSize[2]*Math.abs(n[7]),c=e.halfSize[0]*Math.abs(n[2])+e.halfSize[1]*Math.abs(n[5])+e.halfSize[2]*Math.abs(n[8]);return t[0]=e.center[0]-a,t[1]=e.center[1]-r,t[2]=e.center[2]-c,t[3]=e.center[0]+a,t[4]=e.center[1]+r,t[5]=e.center[2]+c,t}function Q(e,t){return h.plane.signedDistance(t,e.center)-V(e,h.plane.normal(t))}function j(e,t){return h.plane.signedDistance(t,e.center)+V(e,h.plane.normal(t))}function v(e,t){return x(e,t[0])<=0&&x(e,t[1])<=0&&x(e,t[2])<=0&&x(e,t[3])<=0&&x(e,t[4])<=0&&x(e,t[5])<=0}function w(e,t,a,r=0){s.conjugate(S,e.quaternion),n.subtract(b,t,e.center);const c=n.transformQuat(b,b,S),i=n.transformQuat(m,a,S);let o=-1/0,f=1/0;for(let n=0;n<3;n++)if(Math.abs(i[n])>1e-6){const t=(r+e.halfSize[n]-c[n])/i[n],a=(-r-e.halfSize[n]-c[n])/i[n];o=Math.max(o,Math.min(t,a)),f=Math.min(f,Math.max(t,a))}else if(c[n]>e.halfSize[n]+r||c[n]<-e.halfSize[n]-r)return!1;return o<=f}function A(e,t,a,r,c){s.conjugate(S,e.quaternion),n.sub(b,t,e.center),n.transformQuat(b,b,S);const f=b[0]<-e.halfSize[0]?-1:b[0]>e.halfSize[0]?1:0,u=b[1]<-e.halfSize[1]?-1:b[1]>e.halfSize[1]?1:0,h=b[2]<-e.halfSize[2]?-1:b[2]>e.halfSize[2]?1:0,l=Math.abs(f)+Math.abs(u)+Math.abs(h);if(0===l)return 1/0;const z=1===l?4:6,m=6*(f+3*u+9*h+13);i.fromQuat(p,e.quaternion),i.scale(p,p,e.halfSize);for(let i=0;i<z;i++){const t=P[m+i];n.set(b,((1&t)<<1)-1,(2&t)-1,((4&t)>>1)-1),n.transformMat3(b,b,p),n.add(M,e.center,b),M[3]=1,o.transformMat4(M,M,a);const r=1/Math.max(1e-6,M[3]);D[2*i]=M[0]*r,D[2*i+1]=M[1]*r}const d=2*z-2;let q=D[0]*(D[3]-D[d+1])+D[d]*(D[1]-D[d-1]);for(let n=2;n<d;n+=2)q+=D[n]*(D[n+3]-D[n-1]);return Math.abs(q)*r*c*.125}const D=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],P=(()=>{const e=new Int8Array(162);let t=0;const n=n=>{for(let a=0;a<n.length;a++)e[t+a]=n[a];t+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),e})();function V(e,t){s.conjugate(S,e.quaternion),n.transformQuat(b,t,S);const a=e.halfSize;return Math.abs(b[0]*a[0])+Math.abs(b[1]*a[1])+Math.abs(b[2]*a[2])}function O(e,t){for(let a=0;a<8;++a){const r=t[a];r[0]=1&a?-e.halfSize[0]:e.halfSize[0],r[1]=2&a?-e.halfSize[1]:e.halfSize[1],r[2]=4&a?-e.halfSize[2]:e.halfSize[2],n.transformQuat(r,r,e.quaternion),n.add(r,r,e.center)}}e.ObbArray=d,e.clone=g,e.compute=y,e.corners=O,e.create=q,e.intersectLine=w,e.intersectPlane=x,e.isVisible=v,e.maximumDistancePlane=j,e.minimumDistancePlane=Q,e.projectedArea=A,e.projectedRadius=V,e.set=k,e.toAaBoundingBox=B,Object.defineProperty(e,"__esModule",{value:!0})}));
