// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],(function(t,e,n,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cyclicalDeg=e.cyclicalPI=e.cyclical2PI=e.planeFromPoints=e.Cyclical=e.makePiecewiseLinearFunction=e.angle=e.slerp=e.bilerp=e.directionFromTo=e.sphericalToCartesian=e.cartesianToSpherical=e.moduloPositive=e.tangentFrame=e.makeOrthonormal=e.scaleFromMatrix=e.maxScale=e.fovy2fovx=e.fovx2fovy=e.cosCapped=void 0,e.cosCapped=function(t,e){return t>e?Math.cos(e):Math.cos(t)},e.fovx2fovy=function(t,e,n){return 2*Math.atan(n*Math.tan(.5*t)/e)},e.fovy2fovx=function(t,e,n){return 2*Math.atan(e*Math.tan(.5*t)/n)},e.maxScale=function(t){var e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],n=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(Math.max(e,n),i))},e.scaleFromMatrix=function(t,e){var n=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),o=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return i.vec3.set(t,n,r,o),t},e.makeOrthonormal=function(t,e,n){n=n||t;var r=i.vec3.dot(t,e);i.vec3.set(n,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),i.vec3.normalize(n,n)},e.tangentFrame=function(t,e,n){Math.abs(t[0])>Math.abs(t[1])?i.vec3.set(e,0,1,0):i.vec3.set(e,1,0,0),i.vec3.cross(n,t,e),i.vec3.normalize(e,e),i.vec3.cross(e,n,t),i.vec3.normalize(n,n)},e.moduloPositive=function(t,e){return(t%e+e)%e},e.cartesianToSpherical=function(t,e){var r=i.vec3.length(t),o=n.asinClamped(t[2]/r),a=Math.atan2(t[1]/r,t[0]/r);return i.vec3.set(e,r,o,a),e},e.sphericalToCartesian=function(t,e){var n=t[0],r=t[1],o=t[2],a=Math.cos(r);i.vec3.set(e,n*a*Math.cos(o),n*a*Math.sin(o),n*Math.sin(r))},e.directionFromTo=function(t,e,n){var i=n[0]-e[0],r=n[1]-e[1],o=n[2]-e[2],a=i*i+r*r+o*o;return a?(a=1/Math.sqrt(a),t[0]=i*a,t[1]=r*a,t[2]=o*a,t):(t[0]=0,t[1]=0,t[2]=0,t)},e.bilerp=function(t,e,n,i,r,o){var a=t+(e-t)*r;return a+(n+(i-n)*r-a)*o},e.slerp=function(t,e,n,o){void 0===o&&(o=r.vec3f64.create());var a=i.vec3.length(t),c=i.vec3.length(e),s=i.vec3.dot(t,e)/(a*c);if(s<.9999999999999999){var v=Math.acos(s),f=((1-n)*a+n*c)/Math.sin(v),h=f/a*Math.sin((1-n)*v),m=f/c*Math.sin(n*v);return i.vec3.scale(l,t,h),i.vec3.scale(u,e,m),i.vec3.add(o,l,u)}return i.vec3.lerp(o,t,e,n)},e.angle=function(t,e,r){t=i.vec3.normalize(l,t),e=i.vec3.normalize(u,e);var o=n.acosClamped(i.vec3.dot(t,e));if(r){var a=i.vec3.cross(v,t,e);if(i.vec3.dot(a,r)<0)return-o}return o},e.makePiecewiseLinearFunction=function(t){var e=t.length;return function(n){if(n<=t[0][0])return t[0][1];if(n>=t[e-1][0])return t[e-1][1];for(var i=1;n>t[i][0];)i++;var r=t[i-1][0],o=t[i][0],a=(o-n)/(o-r);return a*t[i-1][1]+(1-a)*t[i][1]}};var o=function(){function t(t,e){this.min=t,this.max=e,this.range=e-t}return t.prototype.ndiff=function(t,e){return void 0===e&&(e=0),Math.ceil((t-e)/this.range)*this.range+e},t.prototype._normalize=function(t,e,n,i,r){return void 0===i&&(i=0),void 0===r&&(r=!1),(n-=i)<t?n+=this.ndiff(t-n):n>e&&(n-=this.ndiff(n-e)),r&&n===e&&(n=t),n+i},t.prototype.normalize=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=!1),this._normalize(this.min,this.max,t,e,n)},t.prototype.clamp=function(t,e){return void 0===e&&(e=0),n.clamp(t-e,this.min,this.max)+e},t.prototype.monotonic=function(t,e,n){return t<e?e:e+this.ndiff(t-e,n)},t.prototype.minimalMonotonic=function(t,e,n){return this._normalize(t,t+this.range,e,n)},t.prototype.center=function(t,e,n){return e=this.monotonic(t,e,n),this.normalize((t+e)/2,n)},t.prototype.diff=function(t,e,n){return this.monotonic(t,e,n)-t},t.prototype.shortestSignedDiff=function(t,e){t=this.normalize(t);var n=(e=this.normalize(e))-t,i=e<t?this.minimalMonotonic(t,e)-t:e-this.minimalMonotonic(e,t);return Math.abs(n)<Math.abs(i)?n:i},t.prototype.contains=function(t,e,n){return e=this.minimalMonotonic(t,e),(n=this.minimalMonotonic(t,n))>t&&n<e},t}();e.Cyclical=o,e.planeFromPoints=function(t,e,n,r){i.vec3.subtract(a,e,t),i.vec3.subtract(c,n,t),i.vec3.cross(r,a,c),i.vec3.normalize(r,r),r[3]=-i.vec3.dot(t,r)};var a=r.vec3f64.create(),c=r.vec3f64.create();function s(t){for(var e in t){var n=t[e];n instanceof Function&&(t[e]=n.bind(t))}return t}e.cyclical2PI=s(new o(0,2*Math.PI)),e.cyclicalPI=s(new o(-Math.PI,Math.PI)),e.cyclicalDeg=s(new o(0,360));var v=r.vec3f64.create(),l=r.vec3f64.create(),u=r.vec3f64.create()}));