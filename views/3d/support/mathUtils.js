// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],(function(t,n,e,r,i){Object.defineProperty(n,"__esModule",{value:!0}),n.cosCapped=function(t,n){return t>n?Math.cos(n):Math.cos(t)},n.fovx2fovy=function(t,n,e){return 2*Math.atan(e*Math.tan(.5*t)/n)},n.fovy2fovx=function(t,n,e){return 2*Math.atan(n*Math.tan(.5*t)/e)},n.maxScale=function(t){var n=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],e=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(Math.max(n,e),r))},n.scaleFromMatrix=function(t,n){var e=Math.sqrt(n[0]*n[0]+n[4]*n[4]+n[8]*n[8]),i=Math.sqrt(n[1]*n[1]+n[5]*n[5]+n[9]*n[9]),o=Math.sqrt(n[2]*n[2]+n[6]*n[6]+n[10]*n[10]);return r.vec3.set(t,e,i,o),t},n.makeOrthonormal=function(t,n,e){e=e||t;var i=r.vec3.dot(t,n);r.vec3.set(e,t[0]-i*n[0],t[1]-i*n[1],t[2]-i*n[2]),r.vec3.normalize(e,e)},n.tangentFrame=function(t,n,e){Math.abs(t[0])>Math.abs(t[1])?r.vec3.set(n,0,1,0):r.vec3.set(n,1,0,0),r.vec3.cross(e,t,n),r.vec3.normalize(n,n),r.vec3.cross(n,e,t),r.vec3.normalize(e,e)},n.moduloPositive=function(t,n){return(t%n+n)%n},n.cartesianToSpherical=function(t,n){var i=r.vec3.length(t),o=e.asinClamped(t[2]/i),a=Math.atan2(t[1]/i,t[0]/i);return r.vec3.set(n,i,o,a),n},n.sphericalToCartesian=function(t,n){var e=t[0],i=t[1],o=t[2],a=Math.cos(i);r.vec3.set(n,e*a*Math.cos(o),e*a*Math.sin(o),e*Math.sin(i))},n.directionFromTo=function(t,n,e){var r=e[0]-n[0],i=e[1]-n[1],o=e[2]-n[2],a=r*r+i*i+o*o;return a?(a=1/Math.sqrt(a),t[0]=r*a,t[1]=i*a,t[2]=o*a,t):(t[0]=0,t[1]=0,t[2]=0,t)},n.bilerp=function(t,n,e,r,i,o){var a=t+(n-t)*i;return a+(e+(r-e)*i-a)*o},n.slerp=function(t,n,e,o){void 0===o&&(o=i.vec3f64.create());var a=r.vec3.length(t),c=r.vec3.length(n),s=r.vec3.dot(t,n)/(a*c);if(s<.9999999999999999){var u=Math.acos(s),h=((1-e)*a+e*c)/Math.sin(u),l=h/a*Math.sin((1-e)*u),m=h/c*Math.sin(e*u);return r.vec3.scale(v,t,l),r.vec3.scale(f,n,m),r.vec3.add(o,v,f)}return r.vec3.lerp(o,t,n,e)},n.angle=function(t,n,i){t=r.vec3.normalize(v,t),n=r.vec3.normalize(f,n);var o=e.acosClamped(r.vec3.dot(t,n));if(i){var a=r.vec3.cross(u,t,n);if(r.vec3.dot(a,i)<0)return-o}return o},n.makePiecewiseLinearFunction=function(t){var n=t.length;return function(e){if(e<=t[0][0])return t[0][1];if(e>=t[n-1][0])return t[n-1][1];for(var r=1;e>t[r][0];)r++;var i=t[r-1][0],o=t[r][0],a=(o-e)/(o-i);return a*t[r-1][1]+(1-a)*t[r][1]}},n.vectorEquals=function(t,n){if(null==t||null==n)return t!==n;if(t.length!==n.length)return!1;for(var e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0};var o=function(){function t(t,n){this.min=t,this.max=n,this.range=n-t}return t.prototype.ndiff=function(t,n){return void 0===n&&(n=0),Math.ceil((t-n)/this.range)*this.range+n},t.prototype._normalize=function(t,n,e,r){return void 0===r&&(r=0),(e-=r)<t?e+=this.ndiff(t-e):e>n&&(e-=this.ndiff(e-n)),e+r},t.prototype.normalize=function(t,n){return this._normalize(this.min,this.max,t,n)},t.prototype.clamp=function(t,n){return void 0===n&&(n=0),e.clamp(t-n,this.min,this.max)+n},t.prototype.monotonic=function(t,n,e){return t<n?n:n+this.ndiff(t-n,e)},t.prototype.minimalMonotonic=function(t,n,e){return this._normalize(t,t+this.range,n,e)},t.prototype.center=function(t,n,e){return n=this.monotonic(t,n,e),this.normalize((t+n)/2,e)},t.prototype.diff=function(t,n,e){return this.monotonic(t,n,e)-t},t.prototype.shortestSignedDiff=function(t,n){t=this.normalize(t);var e=(n=this.normalize(n))-t,r=n<t?this.minimalMonotonic(t,n)-t:n-this.minimalMonotonic(n,t);return Math.abs(e)<Math.abs(r)?e:r},t.prototype.contains=function(t,n,e){return n=this.minimalMonotonic(t,n),(e=this.minimalMonotonic(t,e))>t&&e<n},t}();n.Cyclical=o,n.planeFromPoints=function(t,n,e,i){r.vec3.subtract(a,n,t),r.vec3.subtract(c,e,t),r.vec3.cross(i,a,c),r.vec3.normalize(i,i),i[3]=-r.vec3.dot(t,i)};var a=i.vec3f64.create(),c=i.vec3f64.create();function s(t){for(var n in t){var e=t[n];e instanceof Function&&(t[n]=e.bind(t))}return t}n.cyclical2PI=s(new o(0,2*Math.PI)),n.cyclicalPI=s(new o(-Math.PI,Math.PI)),n.cyclicalDeg=s(new o(0,360));var u=i.vec3f64.create(),v=i.vec3f64.create(),f=i.vec3f64.create()}));