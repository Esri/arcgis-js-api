/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/has","../../../core/maybe","../../../core/mathUtils","../../../chunks/vec3f64","../../../chunks/vec3","../../../chunks/builtins","./buffer/glUtil","./buffer/InterleavedLayout","../../webgl/BufferObject","../../webgl/VertexArrayObject","../../webgl/FramebufferObject","../../webgl/RenderingContext","../webgl-engine/shaders/LaserlinePathTechnique"],(function(e,t,r,s,n,i,u,o,a,c,f,h,l,d,_){"use strict";let b=function(){function e(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=i.create(),this._dirty=!1,this._count=0,this._vao=null}var r=e.prototype;return r.draw=function(e){const t=this.ensureVAO(e);s.isSome(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))},r.dispose=function(){s.isSome(this._vao)&&this._vao.dispose()},r.ensureVAO=function(e){return s.isNone(this._buffers)?null:(s.isNone(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)},r.createVAO=function(e,t){const r=this.createDataBuffer(t);return this._dirty=!1,new h(e,_.LaserlinePathTechnique.attributeLocations,{data:a.glLayout(p)},{data:f.createVertex(e,35044,r)})},r.ensureVertexData=function(e,t){if(!this._dirty)return;const r=this.createDataBuffer(t);e.vertexBuffers.data.setData(r),this._dirty=!1},r.numberOfRenderVertices=function(e){return 3*(2*(e.length/3-1))},r.createDataBuffer=function(e){const t=e.reduce(((e,t)=>e+this.numberOfRenderVertices(t)),0);this._count=t;const r=p.createBuffer(t),s=this._origin;let n=0,i=0;for(const t of e){for(let e=0;e<t.length;e+=3){const o=u.set(g,t[e+0],t[e+1],t[e+2]);0===e?i=this._renderCoordsHelper.getAltitude(o):this._renderCoordsHelper.setAltitude(i,o);const a=this._renderCoordsHelper.worldUpAtPosition(o,V),c=n+2*e,f=u.subtract(g,o,s);if(e<t.length-3){r.up.setVec(c,a),r.up.setVec(c+3,a),r.up.setVec(c+5,a);for(let e=0;e<6;e++)r.start.setVec(c+e,f);r.extrude.setValues(c+0,0,-1),r.extrude.setValues(c+1,1,-1),r.extrude.setValues(c+2,1,1),r.extrude.setValues(c+3,0,-1),r.extrude.setValues(c+4,1,1),r.extrude.setValues(c+5,0,1)}if(e>0){r.up.setVec(c-2,a),r.up.setVec(c-4,a),r.up.setVec(c-5,a);for(let e=-6;e<0;e++)r.end.setVec(c+e,f)}}n+=this.numberOfRenderVertices(t)}return r.buffer},t._createClass(e,[{key:"vertices",set:function(e){const t=new Float64Array(3*e.length);let r=0;for(const s of e)t[r++]=s[0],t[r++]=s[1],t[r++]=s[2];this.buffers=[t]}},{key:"buffers",set:function(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);u.set(this._origin,e[t+0],e[t+1],e[t+2])}else u.set(this._origin,0,0,0);this._dirty=!0}},{key:"origin",get:function(){return this._origin}}]),e}();const V=i.create(),g=i.create(),p=c.newLayout().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude");e.LaserlinePathData=b,Object.defineProperty(e,"__esModule",{value:!0})}));
