/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/has","../../../core/maybe","../../../geometry/SpatialReference","../../../chunks/vec3","../../../geometry/projectionEllipsoid","../../../core/unitUtils","../../../chunks/mat4","../../../geometry/projection","../../../layers/graphics/dehydratedFeatures","./stack","./geometryUtils","./geometryUtils/coordinateSystem"],(function(e,t,o,i,n,r,s,a,c,d,l,u,h,f){"use strict";let y=function(){function e(e,t,o,i){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=o,this.coordinateSystem=i,this._coordinateSystem=f.create(i)}var o=e.prototype;return o.getAltitude=function(e){return f.altitudeAt(this.coordinateSystem,e)},o.setAltitude=function(e,t){f.setAltitudeAt(this.coordinateSystem,t,e,t)},o.setAltitudeOfTransformation=function(e,t){f.setAltitudeOfTransformation(this.coordinateSystem,t,e,t)},o.worldUpAtPosition=function(e,t){return f.normalAt(this.coordinateSystem,e,t)},o.worldBasisAtPosition=function(e,t,o){return f.axisAt(this.coordinateSystem,e,t,o)},o.basisMatrixAtPosition=function(e,t){const o=this.worldBasisAtPosition(e,0,u.sv3d.get()),i=this.worldBasisAtPosition(e,1,u.sv3d.get()),n=this.worldBasisAtPosition(e,2,u.sv3d.get());return c.set(t,o[0],o[1],o[2],0,i[0],i[1],i[2],0,n[0],n[1],n[2],0,0,0,0,1),t},o.intersectManifoldClosestSilhouette=function(e,t,o){return f.elevate(this.coordinateSystem,t,this._coordinateSystem),f.intersectRayClosestSilhouette(this._coordinateSystem,e,o),o},o.intersectManifold=function(e,t,o){f.elevate(this.coordinateSystem,t,this._coordinateSystem);const i=u.sv3d.get();return!!f.intersectRay(this._coordinateSystem,e,i)&&(r.copy(o,i),!0)},o.intersectInfiniteManifold=function(e,t,o){if(1===this.viewingMode)return this.intersectManifold(e,t,o);f.elevate(this.coordinateSystem,t,this._coordinateSystem);const i=this._coordinateSystem.value,n=u.sv3d.get();return!!h.plane.intersectRay(i.plane,e,n)&&(r.copy(o,n),!0)},o.toRenderCoords=function(e,t,o){return l.isDehydratedPoint(e)?d.projectPointToVector(e,t,this.spatialReference):d.projectVectorToVector(e,t,o,this.spatialReference)},o.fromRenderCoords=function(e,t,o){return l.isDehydratedPoint(t)?d.projectVectorToDehydratedPoint(e,this.spatialReference,t,o):t instanceof n?d.projectVectorToPoint(e,this.spatialReference,t):d.projectVectorToVector(e,this.spatialReference,t,i.unwrap(o))},e.createGlobal=function(t){return new e(1,t,1,f.fromValues(h.sphere,h.sphere.fromValues(s.getReferenceEllipsoid(t).radius,[0,0,0])))},e.createLocal=function(t){const o=f.fromValues(h.boundedPlane,h.boundedPlane.fromValues([0,0,0],[m,0,0],[0,m,0]));return new e(2,t,a.getMetersPerUnitForSR(t),o)},e.createMode=function(t,o){switch(t){case 2:return e.createLocal(o);case 1:return e.createGlobal(o);default:return}},t._createClass(e,[{key:"extent",set:function(e){e&&f.setExtent(this.coordinateSystem,e,this.coordinateSystem)}}]),e}();const m=Math.pow(2,50);e.RenderCoordsHelper=y,Object.defineProperty(e,"__esModule",{value:!0})}));
