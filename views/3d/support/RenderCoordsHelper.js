/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/mathUtils","../../../core/maybe","../../../core/unitUtils","../../../chunks/mat4","../../../chunks/vec3","../../../core/libs/gl-matrix-2/types/vec3","../../../geometry/projection","../../../geometry/support/Axis","../../../geometry/support/coordinateSystem","../../../geometry/support/plane","../../../geometry/support/vector","../../../geometry/support/vectorStacks","../../../layers/graphics/dehydratedFeatureUtils","../../ViewingMode","../../support/spatialReferenceSupport"],(function(t,e,i,o,n,r,s,a,c,d,l,u,p,h,m,f,y){"use strict";let g=function(){function t(t,e,i,o){this.viewingMode=t,this.spatialReference=e,this.unitInMeters=i,this._coordinateSystem=o,this._tmpCoordinateSystem=l.create(o)}var y=t.prototype;return y.getAltitude=function(t){return l.altitudeAt(this._coordinateSystem,t)},y.setAltitude=function(t,e,i=t){return l.setAltitudeAt(this._coordinateSystem,i,e,t)},y.setAltitudeOfTransformation=function(t,e){l.setAltitudeOfTransformation(this._coordinateSystem,e,t,e)},y.worldUpAtPosition=function(t,e){return l.normalAt(this._coordinateSystem,t,e)},y.worldBasisAtPosition=function(t,e,i){return l.axisAt(this._coordinateSystem,t,e,i)},y.basisMatrixAtPosition=function(t,e){const i=this.worldBasisAtPosition(t,d.Axis.X,h.sv3d.get()),o=this.worldBasisAtPosition(t,d.Axis.Y,h.sv3d.get()),n=this.worldBasisAtPosition(t,d.Axis.Z,h.sv3d.get());return r.set(e,i[0],i[1],i[2],0,o[0],o[1],o[2],0,n[0],n[1],n[2],0,0,0,0,1),e},y.headingAtPosition=function(t,e){const o=this.worldUpAtPosition(t,h.sv3d.get()),n=this.worldBasisAtPosition(t,d.Axis.Y,h.sv3d.get()),r=p.angleAroundAxis(e,n,o);return i.rad2deg(r)},y.intersectManifoldClosestSilhouette=function(t,e,i){return l.elevate(this._coordinateSystem,e,this._tmpCoordinateSystem),l.intersectRayClosestSilhouette(this._tmpCoordinateSystem,t,i),i},y.intersectManifold=function(t,e,i){l.elevate(this._coordinateSystem,e,this._tmpCoordinateSystem);const o=h.sv3d.get();return l.intersectRay(this._tmpCoordinateSystem,t,o)?s.copy(i,o):null},y.intersectInfiniteManifold=function(t,e,i){if(this.viewingMode===f.ViewingMode.Global)return this.intersectManifold(t,e,i);l.elevate(this._coordinateSystem,e,this._tmpCoordinateSystem);const o=this._tmpCoordinateSystem.value,n=h.sv3d.get();return u.intersectRay(o.plane,t,n)?s.copy(i,n):null},y.toRenderCoords=function(t,e,i){return m.isDehydratedPoint(t)?c.projectPointToVector(t,e,this.spatialReference):c.projectVectorToVector(t,e,i,this.spatialReference)},y.fromRenderCoords=function(t,e,i=null){return m.isDehydratedPoint(e)?(o.isSome(i)&&(e.spatialReference=i),c.projectVectorToDehydratedPoint(t,this.spatialReference,e)):a.isVec3(e)?c.projectVectorToVector(t,this.spatialReference,e,i)?e:null:c.projectVectorToPoint(t,this.spatialReference,e)},t.create=function(e,i){switch(e){case f.ViewingMode.Local:return new t(f.ViewingMode.Local,i,n.getMetersPerUnitForSR(i),l.createLocal());case f.ViewingMode.Global:return new t(f.ViewingMode.Global,i,1,l.createGlobal(i))}},t.renderUnitScaleFactor=function(t,e){return S(t)/S(e)},e._createClass(t,[{key:"extent",set:function(t){t&&l.setExtent(this._coordinateSystem,t,this._coordinateSystem)}}]),t}();function S(t){if(y.isSpatialReferenceSupported(t,f.ViewingMode.Global))return 1;const e=l.renderSRFromViewSR(!1,t);return n.getMetersPerUnitForSR(e)}t.RenderCoordsHelper=g,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
