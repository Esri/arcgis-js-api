/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Evented","../../../core/maybe","../../../core/promiseUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../layers/graphics/ElevationQuery"],(function(e,r,t,o,i,n,s,a,c,l,u,v,h){"use strict";function d(e,r,t,o,i,s,a){for(const c of r){const r=c.getElevation(t,o,i,s,a);n.isSome(r)&&(e=n.isSome(e)?Math.max(r,e):r)}return e}e.CombinedElevationProvider=function(e){function t(r){var t;return(t=e.call(this,r)||this).im=new Array,t.ground=new Array,t.scene=new Array,t.handles=new Map,t}r._inheritsLoose(t,e);var o=t.prototype;return o.destroy=function(){this._elevationQuery=n.destroyMaybe(this._elevationQuery)},o.getElevation=function(e,r,t,o,i){let s=null;return s=d(s,this.im,e,r,t,o,i),n.isNone(s)&&(s=d(s,this.ground,e,r,t,o,i)),"scene"===i&&(s=d(s,this.scene,e,r,t,o,i)),s},o.queryElevation=function(e,r,t,o,i,n=null,a=0){const c=s.createResolver();return this.elevationQuery.queryElevation(e,r,n,a).then((n=>{"scene"===i&&(n=d(n,this.scene,e,r,t,o,i)),c.resolve(n)})).catch((n=>{s.isAbortError(n)?c.reject(n):c.resolve(this.getElevation(e,r,t,o,i))})),c.promise},o.register=function(e,r){this.handles.set(r,r.on("elevation-change",(e=>this.emit("elevation-change",e)))),this[e].push(r)},o.unregister=function(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const r of[this.im,this.ground,this.scene]){const t=r.indexOf(e);t>-1&&r.splice(t,1)}},r._createClass(t,[{key:"elevationQuery",get:function(){return n.isNone(this._elevationQuery)&&(this._elevationQuery=new h.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,(()=>this.view.map&&this.view.map.ground),{maximumAutoTileRequests:4})),this._elevationQuery}}]),t}(i.EventedMixin(o)),t.__decorate([a.property({constructOnly:!0})],e.CombinedElevationProvider.prototype,"view",void 0),t.__decorate([a.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],e.CombinedElevationProvider.prototype,"spatialReference",void 0),e.CombinedElevationProvider=t.__decorate([v.subclass("esri.views.3d.support.CombinedElevationProvider")],e.CombinedElevationProvider),Object.defineProperty(e,"__esModule",{value:!0})}));
