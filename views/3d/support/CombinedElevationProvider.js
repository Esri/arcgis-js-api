/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/maybe","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/promiseUtils","../../../core/Accessor","../../../core/Evented","../layers/graphics/ElevationQuery"],(function(e,r,t,o,i,s,n,a,c,l,u,v,h,d,p,y){"use strict";function m(e,r,t,o,s,n,a){for(const c of r){const r=c.getElevation(t,o,s,n,a);i.isSome(r)&&(e=i.isSome(e)?Math.max(r,e):r)}return e}e.CombinedElevationProvider=function(e){function t(r){var t;return(t=e.call(this,r)||this).im=new Array,t.ground=new Array,t.scene=new Array,t.handles=new Map,t}r._inheritsLoose(t,e);var o=t.prototype;return o.destroy=function(){this._elevationQuery=i.destroyMaybe(this._elevationQuery)},o.getElevation=function(e,r,t,o,s){let n=null;return n=m(n,this.im,e,r,t,o,s),i.isNone(n)&&(n=m(n,this.ground,e,r,t,o,s)),"scene"===s&&(n=m(n,this.scene,e,r,t,o,s)),n},o.queryElevation=function(e,r,t,o,i,s=null,n=0){const a=h.createResolver();return this.elevationQuery.queryElevation(e,r,s,n).then((s=>{"scene"===i&&(s=m(s,this.scene,e,r,t,o,i)),a.resolve(s)})).catch((s=>{h.isAbortError(s)?a.reject(s):a.resolve(this.getElevation(e,r,t,o,i))})),a.promise},o.register=function(e,r){this.handles.set(r,r.on("elevation-change",(e=>this.emit("elevation-change",e)))),this[e].push(r)},o.unregister=function(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const r of[this.im,this.ground,this.scene]){const t=r.indexOf(e);t>-1&&r.splice(t,1)}},r._createClass(t,[{key:"elevationQuery",get:function(){return i.isNone(this._elevationQuery)&&(this._elevationQuery=new y.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,(()=>this.view.map&&this.view.map.ground),{maximumAutoTileRequests:4})),this._elevationQuery}}]),t}(p.EventedMixin(d)),t.__decorate([a.property({constructOnly:!0})],e.CombinedElevationProvider.prototype,"view",void 0),t.__decorate([a.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],e.CombinedElevationProvider.prototype,"spatialReference",void 0),e.CombinedElevationProvider=t.__decorate([c.subclass("esri.views.3d.support.CombinedElevationProvider")],e.CombinedElevationProvider),Object.defineProperty(e,"__esModule",{value:!0})}));
