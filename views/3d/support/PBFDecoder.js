/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../geometry/SpatialReference","../../../Graphic","../../support/Scheduler","../../../layers/support/Field","../../../core/workers/WorkerHandle"],(function(e,r,t,o,n,s,i){"use strict";let a=function(){function e(e){this._handle=new f(e),this._frameTask=e.registerTask(n.Task.REMOTE_CLIENT,(e=>this._frameTask.processQueue(e)),(()=>!1))}var r=e.prototype;return r.destroy=function(){this._frameTask.remove(),this._handle.destroy()},r.invoke=function(e,r){return e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof t&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()}),this._handle.invoke(e,r).then((e=>this._frameTask.schedule((()=>{if(e.spatialReference=t.fromJSON(e.spatialReference),e.fields)for(let t=0;t<e.fields.length;t++)e.fields[t]=s.fromJSON(e.fields[t]);const r=e.spatialReference;for(const t of e.features)t.uid=o.generateUID(),t.geometry&&(t.geometry.spatialReference=r);return e}))))):Promise.resolve(null)},e}(),f=function(e){function t(r){return e.call(this,"PBFDecoderWorker","_parseFeatureQuery",r)||this}return r._inheritsLoose(t,e),t.prototype.getTransferList=function(e){return[e.buffer]},t}(i.WorkerHandle);e.PBFDecoder=a,Object.defineProperty(e,"__esModule",{value:!0})}));
