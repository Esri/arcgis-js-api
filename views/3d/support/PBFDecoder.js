/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../Graphic","../../../core/maybe","../../../core/typedArrayUtil","../../../core/workers/WorkerHandle","../../../geometry/SpatialReference","../../../layers/support/Field"],(function(e,r,t,n,o,s,a,i){"use strict";let l=function(){function e(e){this._controller=e,this._handle=new u((r=>e.schedule(r)))}var o=e.prototype;return o.destroy=function(){this._handle.destroy()},o.invoke=function(e,o){var s=this;return e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof a&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()}),this._handle.invoke(e,o).then((e=>{let o=0,l=0;const u=function(){var p=r._asyncToGenerator((function*(r){if(e.spatialReference=a.fromJSON(e.spatialReference),e.fields)for(;o<e.fields.length;)if(e.fields[o]=i.fromJSON(e.fields[o]),o++,r.madeProgress())return s._controller.reschedule((e=>u(e)));const p=e.spatialReference;for(;l<e.features.length;){const o=e.features[l];if(++l,o.uid=t.generateUID(),n.isSome(o.geometry)&&(o.geometry.spatialReference=p,c(o.geometry),r.madeProgress()))return s._controller.reschedule((e=>u(e)))}return e}));return function(e){return p.apply(this,arguments)}}();return this._controller.schedule((e=>u(e)))}))):Promise.resolve(null)},e}();function c(e){switch(e.type){case"polyline":e.paths.reduce(((e,r)=>e+r.length),0)<o.NATIVE_ARRAY_MAX_SIZE&&(e.paths=e.hasZ||e.hasM?e.paths.map((e=>e.map((e=>[e[0],e[1],e[2]])))):e.paths.map((e=>e.map((e=>[e[0],e[1]])))));break;case"polygon":e.rings.reduce(((e,r)=>e+r.length),0)<o.NATIVE_ARRAY_MAX_SIZE&&(e.rings=e.hasZ||e.hasM?e.rings.map((e=>e.map((e=>[e[0],e[1],e[2]])))):e.rings.map((e=>e.map((e=>[e[0],e[1]])))))}}let u=function(e){function t(r){return e.call(this,"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:e=>[e.buffer]},r)||this}return r._inheritsLoose(t,e),t}(s.WorkerHandle);e.PBFDecoder=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
