/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/promiseUtils","../../../geometry/SpatialReference","../../../Graphic","../../../layers/support/Field","../../support/Scheduler","./WorkerHandle"],(function(e,r,t,n,o,s,i,a){"use strict";let f=function(){function e(e){this._handle=new l(e),this._frameTask=e.registerTask(i.Task.REMOTE_CLIENT,(()=>{}),(()=>!1))}var r=e.prototype;return r.destroy=function(){this._frameTask.remove(),this._handle.destroy()},r.invoke=function(e,r){return e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof n&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()}),this._handle.invoke(e,r).then((e=>this._frameTask.schedule((()=>{if(e.spatialReference=n.fromJSON(e.spatialReference),e.fields)for(let r=0;r<e.fields.length;r++)e.fields[r]=s.fromJSON(e.fields[r]);const r=e.spatialReference;for(const t of e.features)t.uid=o.generateUID(),t.geometry&&(t.geometry.spatialReference=r);return e}))))):t.resolve(null)},e}(),l=function(e){function t(r){return e.call(this,"PBFDecoderWorker","_parseFeatureQuery",r)||this}return r._inheritsLoose(t,e),t.prototype.getTransferList=function(e){return[e.buffer]},t}(a.WorkerHandle);e.PBFDecoder=f,Object.defineProperty(e,"__esModule",{value:!0})}));
