/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],(function(t,s,e){"use strict";let i=function(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new n},n=function(){this.requests=0,this.size=0,this.duration=0,this.speed=0},r=function(){function t(t,s,e,n){this._workerFunc=t,this._callbackFunc=s,this._maxTotalNumWorkers=e,this._totalNumWorkers=0,this._clients=n.map((t=>new i(t)))}var n=t.prototype;return n.hasQuota=function(t){const s=this._clients[t];return!!s&&s.typeWorkerQuota>s.numWorkers+s.tasks.length},n.push=function(t){const s=this._clients[t.client];s&&(this._totalNumWorkers<this._maxTotalNumWorkers?(s.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,((t,s)=>this._taskCallback(t,s)))):s.tasks.push(t))},n.getStatsForType=function(t){const s=this._clients[t];return s?{quota:s.typeWorkerQuota,workers:s.numWorkers,queueSize:s.tasks.length,requestStats:s.statistics}:null},n.cancel=function(t){this._taskFinished(t),t._cancelled=!0},n.destroy=function(){this._clients.length=0},n._taskFinished=function(t){const s=this._clients[t.client];this._totalNumWorkers--,s.numWorkers--,s.statistics.requests++,s.statistics.size+=t.size||0,s.statistics.duration+=t.duration||0,s.statistics.speed=s.statistics.duration>0?s.statistics.size/s.statistics.duration:0,e.assert(s.numWorkers>=0),this._next()},n._next=function(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return},n._processQueue=function(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),((t,s)=>this._taskCallback(t,s))))return t.numWorkers++,this._totalNumWorkers++,!0;return!1},n._taskCallback=function(t,s){t._cancelled||(this._callbackFunc(t,s),this._taskFinished(t))},s._createClass(t,[{key:"test",get:function(){const t=this;return{set workerFunc(s){t._workerFunc=s}}}}]),t}();t.AsyncWorkerQueue=r,t.BaseTask=function(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0},Object.defineProperty(t,"__esModule",{value:!0})}));
