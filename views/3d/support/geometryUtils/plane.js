// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../stack"],(function(e,t,r,n,c,i){"use strict";function o(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function u(e,t){return void 0===t&&(t=o()),a(e[0],e[1],e[2],e[3],t)}function a(e,t,r,n,c){return void 0===c&&(c=o()),c[0]=e,c[1]=t,c[2]=r,c[3]=n,c}function s(e,t,r){void 0===r&&(r=o()),n.vec3.copy(r,t);var c=n.vec3.dot(t,t);return Math.abs(c-1)>1e-5&&c>1e-12&&n.vec3.scale(r,r,1/Math.sqrt(c)),y(r,e,r),r}function f(e,t,r,c){return void 0===c&&(c=o()),b(n.vec3.subtract(i.sv3d.get(),e,t),n.vec3.subtract(i.sv3d.get(),r,t),e,c)}function v(e,t,r,c,i){if(e.count<3)return!1;e.getVec(r,l);for(var o=c,u=!1;o<e.count-1&&!u;)e.getVec(o,m),o++,u=!n.vec3.exactEquals(l,m);if(!u)return!1;for(o=Math.max(o,i),u=!1;o<e.count&&!u;)e.getVec(o,g),o++,n.vec3.subtract(p,l,m),n.vec3.normalize(p,p),n.vec3.subtract(P,m,g),n.vec3.normalize(P,P),u=!n.vec3.exactEquals(l,g)&&!n.vec3.exactEquals(m,g)&&Math.abs(n.vec3.dot(p,P))<d;return u?(f(l,m,g,t),!0):(0!==r||1!==c||2!==i)&&v(e,t,0,1,2)}Object.defineProperty(t,"__esModule",{value:!0}),t.UP=t.normal=t.signedDistance=t.distance=t.projectVector=t.projectPoint=t.clipInfinite=t.clip=t.isAABBFullyInside=t.isPointOutside=t.isPointInside=t.isSphereFullyOutside=t.isSphereFullyInside=t.intersectLineSegmentClamp=t.intersectLineSegment=t.intersectRay=t.fromVectorsAndPoint=t.negate=t.setOffsetFromPoint=t.fromManyPointsSampleAt=t.fromManyPoints=t.fromPoints=t.fromPositionAndNormal=t.fromNormalAndOffset=t.fromValues=t.copy=t.wrap=t.create=void 0,t.create=o,t.wrap=function(e,t,r,n){return a(e,t,r,n,i.sv4d.get())},t.copy=u,t.fromValues=a,t.fromNormalAndOffset=function(e,t,r){return void 0===r&&(r=o()),n.vec3.copy(r,e),r[3]=t,r},t.fromPositionAndNormal=s,t.fromPoints=f,t.fromManyPoints=function(e,t){return v(e,t,0,1,2)},t.fromManyPointsSampleAt=v;var d=.99619469809,l=c.vec3f64.create(),m=c.vec3f64.create(),g=c.vec3f64.create(),p=c.vec3f64.create(),P=c.vec3f64.create();function y(e,t,r){return e!==r&&u(e,r),r[3]=-n.vec3.dot(r,t),r}function b(e,t,r,c){return void 0===c&&(c=o()),s(r,n.vec3.cross(i.sv3d.get(),t,e),c)}function A(e,t,r){var c=n.vec3.scale(i.sv3d.get(),e,n.vec3.dot(e,t));return n.vec3.subtract(r,t,c),r}function h(e,t){return n.vec3.dot(e,t)+e[3]}function M(e,t,c,i,o,u){var a=n.vec3.dot(e,c);if(0===a)return!1;var s=-(n.vec3.dot(e,t)+e[3])/a;return o&&(s=i?Math.max(0,s):r.clamp(s,0,1)),!(s<0||!i&&s>1)&&(n.vec3.add(u,t,n.vec3.scale(u,c,s)),!0)}function S(e){return e}t.setOffsetFromPoint=y,t.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},t.fromVectorsAndPoint=b,t.intersectRay=function(e,t,r){return M(e,t.origin,t.direction,!0,!1,r)},t.intersectLineSegment=function(e,t,r){return M(e,t.origin,t.vector,!1,!1,r)},t.intersectLineSegmentClamp=function(e,t,r){return M(e,t.origin,t.vector,!1,!0,r)},t.isSphereFullyInside=function(e,t){var r=t.center,n=t.radius;return h(e,r)-n>=0},t.isSphereFullyOutside=function(e,t){var r=t.center,n=t.radius;return h(e,r)+n<0},t.isPointInside=function(e,t){return h(e,t)>=0},t.isPointOutside=function(e,t){return h(e,t)<0},t.isAABBFullyInside=function(e,t){var r=t[0],n=t[1],c=t[2],i=t[3],o=t[4],u=t[5];return e[0]*(e[0]>0?r:i)+e[1]*(e[1]>0?n:o)+e[2]*(e[2]>0?c:u)+e[3]>=0},t.clip=function(e,t){var r=n.vec3.dot(e,t.ray.direction),c=-h(e,t.ray.origin);if(c<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return c>0;if((c<0||r<0)&&!(c<0&&r<0))return!0;var i=c/r;return r>0?i<t.c1&&(t.c1=i):i>t.c0&&(t.c0=i),t.c0<=t.c1},t.clipInfinite=function(e,t){var r=n.vec3.dot(e,t.ray.direction),c=-h(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return c>0;var i=c/r;return r>0?i<t.c1&&(t.c1=i):i>t.c0&&(t.c0=i),t.c0<=t.c1},t.projectPoint=function(e,t,r){var c=n.vec3.scale(i.sv3d.get(),e,-e[3]),o=A(e,n.vec3.subtract(i.sv3d.get(),t,c),i.sv3d.get());return n.vec3.add(r,o,c),r},t.projectVector=A,t.distance=function(e,t){return Math.abs(h(e,t))},t.signedDistance=h,t.normal=S,t.UP=[0,0,1,0]}));