/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../support/Scheduler"],(function(e,t,r,s){"use strict";let u=function(){function e(e,t){this._stage=e,this._textureRequests=new Map,this._frameTask=r.isSome(t)?t.registerTask(s.TaskPriority.TEXTURE_UNLOAD):s.ImmediateTask}var u=e.prototype;return u.destroy=function(){this._frameTask.remove(),this._textureRequests.forEach((e=>this._releaseTextureRequest(e))),this._textureRequests.clear()},u.fromData=function(e,t){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null},this._stage&&(this._stage.add(s.texture),this._stage.loadSynchronous(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}},u._release=function(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule((()=>this._releaseNow(e)))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)},u._releaseNow=function(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))},u._releaseTextureRequest=function(e){var t;e.texture?null==(t=this._stage)||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)},u.makeUid=function(e,t=null){return r.isSome(t)?`${e}.${t}px`:e},t._createClass(e,[{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]),e}();e.TextureCollection=u,Object.defineProperty(e,"__esModule",{value:!0})}));
