/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/has","../../../../core/maybe","../../../../core/Logger","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/decorators/subclass","../../../../core/urlUtils","../../../../core/uuid","../../../../portal/support/resourceExtension","../../../../geometry/Point","../../../../core/mathUtils","../../../../core/screenUtils","../../../../chunks/vec3f64","../../../../chunks/vec3","../geometryUtils","../debugFlags","../PropertiesPool","./PointOfInterest","../debugUtils"],(function(e,r,t,o,n,s,c,a,i,l,u,p,d,h,y,f,g,_,P,O,m,S){"use strict";const b=Array;e.Focus=function(e){function t(t){var o;return(o=e.call(this,t)||this)._propertiesPool=new O.PropertiesPool({location:d,renderLocation:b},r._assertThisInitialized(o)),o}r._inheritsLoose(t,e);var o=t.prototype;return o.destroy=function(){this._propertiesPool.destroy(),this._propertiesPool=null,L=n.removeMaybe(L)},o.calculateScreenHorizontalEdgeOnSurface=function(e){const r=this.state.camera,t=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),o=this.renderCoordsHelper.getAltitude(r.eye)>=t,n=r.getRenderCenter(y.createRenderScreenPointArray3());if(n[1]=o?r.padding[2]:r.fullHeight-r.padding[0],r.unprojectFromRenderScreen(n,C)){g.subtract(C,C,r.eye);const o=g.normalize(C,C);if(this.renderCoordsHelper.intersectManifold(_.ray.wrap(r.eye,o),t,e))return e}return g.copy(e,r.eye),this.renderCoordsHelper.setAltitude(t,e),e},o.updateRenderLocation=function(){},r._createClass(t,[{key:"location",get:function(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}},{key:"renderLocation",get:function(){const e=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,t=this.calculateScreenHorizontalEdgeOnSurface(F);g.subtract(H,e,this.state.camera.eye),g.normalize(H,H),r.worldUpAtPosition(e,v);const o=Math.abs(Math.acos(g.dot(v,H))-.5*Math.PI),s=this._propertiesPool.get("renderLocation");if(Number.isNaN(o))g.copy(s,e);else{const r=1-h.clamp(o/(.5*Math.PI),0,1),n=r*r*r;g.lerp(s,e,t,n)}return n.isSome(L)&&(P.SHOW_POI?L.showPoint(s,this.renderCoordsHelper.spatialReference):L.remove()),s}}]),t}(m.PointOfInterest),t.__decorate([a.property({constructOnly:!0})],e.Focus.prototype,"centerOnSurface",void 0),t.__decorate([a.property({readOnly:!0})],e.Focus.prototype,"location",null),t.__decorate([a.property({readOnly:!0})],e.Focus.prototype,"renderLocation",null),t.__decorate([a.property({readOnly:!0,aliasOf:"centerOnSurface.updating"})],e.Focus.prototype,"updating",void 0),e.Focus=t.__decorate([i.subclass("esri.views.3d.support.CenterOnSurface")],e.Focus);const H=f.create(),v=f.create(),C=f.create(),F=f.create();let L;var M=e.Focus;e.default=M,e.setupFocusDebugGraphic=function(e){n.removeMaybe(L),L=new S.GraphicsHandle(e,"green")},Object.defineProperty(e,"__esModule",{value:!0})}));
