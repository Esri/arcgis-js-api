/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/has","../../../../core/Logger","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/decorators/subclass","../../../../core/urlUtils","../../../../core/uuid","../../../../portal/support/resourceExtension","../../../../core/Accessor","../../../../core/Evented","../../../../chunks/vec3f64","../../../../core/Handles","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],(function(e,t,r,s,o,n,a,c,p,i,d,u,l,y,h,f,_){"use strict";e.SurfaceGeometryUpdates=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).handles=new h,t._tileGeometryUpdateExtent=f.empty(),t._tileGeometryUpdateSpatialReference=null,t.events=new l,t.updating=!1,t}t._inheritsLoose(r,e);var s=r.prototype;return s.initialize=function(){this.handles.add([this.surface.on("elevation-change",(e=>this._tileGeometryChanged(e))),this.scheduler.registerTask(_.Task.SURFACE_GEOMETRY_UPDATES,(()=>this.update()),(()=>this.updating))])},s.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)},s.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",m),f.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))},s._tileGeometryChanged=function(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,f.expand(this._tileGeometryUpdateExtent,e.tile.extent),this._set("updating",!0)},s._furthestCenterOnSurface=function(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e},s._centerIntersectsExtent=function(e,t){const r=this.state.camera.eye,s=U,o=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,S,t),this.renderCoordsHelper.fromRenderCoords(o.renderLocation,G,t),S[0]<G[0]?(s[0]=S[0],s[2]=G[0]):(s[0]=G[0],s[2]=S[0]),S[1]<G[1]?(s[1]=S[1],s[3]=G[1]):(s[1]=G[1],s[3]=S[1]),f.intersects(s,e)},r}(u),r.__decorate([a.property({constructOnly:!0})],e.SurfaceGeometryUpdates.prototype,"state",void 0),r.__decorate([a.property({constructOnly:!0})],e.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0),r.__decorate([a.property({constructOnly:!0})],e.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0),r.__decorate([a.property({constructOnly:!0})],e.SurfaceGeometryUpdates.prototype,"scheduler",void 0),r.__decorate([a.property({constructOnly:!0})],e.SurfaceGeometryUpdates.prototype,"surface",void 0),r.__decorate([a.property({readOnly:!0})],e.SurfaceGeometryUpdates.prototype,"updating",void 0),e.SurfaceGeometryUpdates=r.__decorate([c.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],e.SurfaceGeometryUpdates);const m={},S=y.create(),G=y.create(),U=f.empty();var g=e.SurfaceGeometryUpdates;e.default=g,Object.defineProperty(e,"__esModule",{value:!0})}));
