/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/arrayUtils","../../../core/Handles","../../../geometry/projectionEllipsoid","../webgl-engine/lib/screenSizePerspectiveUtils","./TextureCollection"],(function(e,t,s,i,r,n){"use strict";let c=function(){function e(e){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=e.viewState,this.view=e.view,this.pointsOfInterest=e.pointsOfInterest,this.objectResourceCache=e.objectResourceCache,this.streamDataRequester=e.resourceController.createStreamDataRequester(4),this.textures=new n.TextureCollection(this.streamDataRequester,e.view._stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}},e.resourceController.scheduler);const t=i.getReferenceEllipsoid(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=r.getSettings(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=r.getLabelSettings(e.viewingMode,t)}var c=e.prototype;return c.destroy=function(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null},c.addGraphicsOwner=function(e){if(!e)return{remove(){}};this.graphicsOwners.push(e);const s="layer"in e?e.watch("layer.screenSizePerspectiveEnabled",(()=>this.updateScreenSizePerspectiveEnabled())):null;return this.updateScreenSizePerspectiveEnabled(),{remove:()=>{s&&(s.remove(),t.removeUnordered(this.graphicsOwners,e),this.updateScreenSizePerspectiveEnabled())}}},c.updateScreenSizePerspectiveEnabled=function(){const e=this.graphicsOwners.some((e=>!0===e.get("layer.screenSizePerspectiveEnabled")));if(e&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new s;const e=()=>this.updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",e,!0),this.viewState.events.on("camera-projection-changed",e)]),this.updateScreenSizePerspectiveSettings()}else!e&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)},c.updateScreenSizePerspectiveSettings=function(){const e=this.pointsOfInterest;a.distance=e.centerOnSurfaceInfrequent.distance,a.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(a),this.screenSizePerspectiveSettingsLabels.update(a),this.view._stage.renderView.setNeedsRender()},e}();const a={distance:0,fovY:0};e.SharedSymbolResources=c,e.default=c,Object.defineProperty(e,"__esModule",{value:!0})}));
