/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports"],(function(t){"use strict";const n=1e-6,r=[0,0,0],i=[0,0,0];const o=[0,0,0],e=[0,0,0],s=[0,0,0],a=[0,0,0],f=[0,0,0],c=[0,0,0],h=[0,0,0],u=[0,0,0];const m=[0,0,0];const l=[0,0];const P=[0,0,0],j=[0,0,0],x=[0,0,0],I=[0,0,0],d=[0,0,0],b=[0,0,0];function N(t,r,i,o,e,s){if(K(r)<n)return;H(P,i,r),H(j,o,r),H(x,e,r),V(t,r,l),d[1]=l[0],I[1]=l[1],b[1]=I[1]-d[1];const a=[i,o,e],f=[P,j,x];for(let n=0;n<3;++n){V(t,a[n],l),d[0]=l[0],I[0]=l[1],V(t,f[n],l),d[2]=l[0],I[2]=l[1],b[0]=I[0]-d[0],b[2]=I[2]-d[2];const i=B(b);i<s.quality&&(D(s.b0,a[n]),D(s.b1,r),D(s.b2,f[n]),s.quality=i)}}const y=[0,0,0];function V(t,n,r){const{data:i,offsetIdx:o,strideIdx:e}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let t=o;t<i.length;t+=e){const o=i[t]*n[0]+i[t+1]*n[1]+i[t+2]*n[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function q(t,n,r){D(r.center,t),C(r.halfSize,n,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const w=[0,0,0],A=[0,0,0],M=[0,0,0],F=[0,0,0],T=[0,0,0],E=[0,0,0];function v(t,r,i){D(w,r),Math.abs(r[0])>Math.abs(r[1])&&Math.abs(r[0])>Math.abs(r[2])?w[0]=0:Math.abs(r[1])>Math.abs(r[2])?w[1]=0:w[2]=0,K(w)<n&&(w[0]=w[1]=w[2]=1),H(A,r,w),J(A,A),H(M,r,A),J(M,M),_(t,r,A,M,F,T),k(E,T,F),S(r,A,M,F,T,E,i)}function _(t,n,r,i,o,e){V(t,n,l),o[0]=l[0],e[0]=l[1],V(t,r,l),o[1]=l[0],e[1]=l[1],V(t,i,l),o[2]=l[0],e[2]=l[1]}const g=[0,0,0],Y=[1,0,0,0,1,0,0,0,1],O=[0,0,0];function S(t,n,r,i,o,e,s){Y[0]=t[0],Y[1]=t[1],Y[2]=t[2],Y[3]=n[0],Y[4]=n[1],Y[5]=n[2],Y[6]=r[0],Y[7]=r[1],Y[8]=r[2],function(t,n){const r=n[0]+n[4]+n[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(n[5]-n[7])*i,t[1]=(n[6]-n[2])*i,t[2]=(n[1]-n[3])*i}else{let r=0;n[4]>n[0]&&(r=1),n[8]>n[3*r+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;let e=Math.sqrt(n[3*r+r]-n[3*i+i]-n[3*o+o]+1);t[r]=.5*e,e=.5/e,t[3]=(n[3*i+o]-n[3*o+i])*e,t[i]=(n[3*i+r]+n[3*r+i])*e,t[o]=(n[3*o+r]+n[3*r+o])*e}}(s.quaternion,Y),G(O,i,o),C(O,O,.5),C(s.center,t,O[0]),C(g,n,O[1]),G(s.center,s.center,g),C(g,r,O[2]),G(s.center,s.center,g),C(s.halfSize,e,.5)}let p=function(t){this.minVert=new Array(7),this.maxVert=new Array(7);this.buffer=new ArrayBuffer(448);let n=0;this.minProj=new Float64Array(this.buffer,n,7),n+=56,this.maxProj=new Float64Array(this.buffer,n,7),n+=56;for(let t=0;t<7;++t)this.minVert[t]=new Float64Array(this.buffer,n,3),n+=24;for(let t=0;t<7;++t)this.maxVert[t]=new Float64Array(this.buffer,n,3),n+=24;for(let t=0;t<7;++t)this.minProj[t]=Number.POSITIVE_INFINITY,this.maxProj[t]=Number.NEGATIVE_INFINITY;const r=new Array(7),i=new Array(7),{data:o,offsetIdx:e,strideIdx:s}=t;for(let t=e;t<o.length;t+=s){let n=o[t];n<this.minProj[0]&&(this.minProj[0]=n,r[0]=t),n>this.maxProj[0]&&(this.maxProj[0]=n,i[0]=t),n=o[t+1],n<this.minProj[1]&&(this.minProj[1]=n,r[1]=t),n>this.maxProj[1]&&(this.maxProj[1]=n,i[1]=t),n=o[t+2],n<this.minProj[2]&&(this.minProj[2]=n,r[2]=t),n>this.maxProj[2]&&(this.maxProj[2]=n,i[2]=t),n=o[t]+o[t+1]+o[t+2],n<this.minProj[3]&&(this.minProj[3]=n,r[3]=t),n>this.maxProj[3]&&(this.maxProj[3]=n,i[3]=t),n=o[t]+o[t+1]-o[t+2],n<this.minProj[4]&&(this.minProj[4]=n,r[4]=t),n>this.maxProj[4]&&(this.maxProj[4]=n,i[4]=t),n=o[t]-o[t+1]+o[t+2],n<this.minProj[5]&&(this.minProj[5]=n,r[5]=t),n>this.maxProj[5]&&(this.maxProj[5]=n,i[5]=t),n=o[t]-o[t+1]-o[t+2],n<this.minProj[6]&&(this.minProj[6]=n,r[6]=t),n>this.maxProj[6]&&(this.maxProj[6]=n,i[6]=t)}for(let t=0;t<7;++t){let n=r[t];D(this.minVert[t],o,n),n=i[t],D(this.maxVert[t],o,n)}},z=function(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0};function B(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function G(t,n,r){t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2]}function k(t,n,r){t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2]}function C(t,n,r){t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r}function D(t,n,r=0){t[0]=n[r+0],t[1]=n[r+1],t[2]=n[r+2]}function H(t,n,r){const i=n[0],o=n[1],e=n[2],s=r[0],a=r[1],f=r[2];t[0]=o*f-e*a,t[1]=e*s-i*f,t[2]=i*a-o*s}function J(t,n){const r=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(r>0){const i=1/Math.sqrt(r);t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i}}function K(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function L(t,n){const r=n[0]-t[0],i=n[1]-t[1],o=n[2]-t[2];return r*r+i*i+o*o}function Q(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}t.computeOBB=function(t,P){const{data:j,strideIdx:x}=t,I=j.length/x;if(I<=0)return;const d=new p(t);G(r,d.minProj,d.maxProj),C(r,r,.5),k(i,d.maxProj,d.minProj);const b=B(i),V=new z;V.quality=b,I<14&&(t={data:new Float64Array(d.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});const w=[0,0,0],A=[0,0,0],M=[0,0,0],E=[0,0,0],g=[0,0,0],Y=[0,0,0],O=[0,0,0];switch(function(t,r,i,o,e,s,a,f,c,h){if(function(t,n,r){let i=L(t.maxVert[0],t.minVert[0]),o=0;for(let n=1;n<7;++n){const r=L(t.maxVert[n],t.minVert[n]);r>i&&(i=r,o=n)}D(n,t.minVert[o]),D(r,t.maxVert[o])}(t,o,e),L(o,e)<n)return 1;k(a,o,e),J(a,a);if(function(t,n,r,i){const{data:o,offsetIdx:e,strideIdx:s}=t;let a=Number.NEGATIVE_INFINITY,f=0;for(let t=e;t<o.length;t+=s){m[0]=o[t]-n[0],m[1]=o[t+1]-n[1],m[2]=o[t+2]-n[2];const i=r[0]*m[0]+r[1]*m[1]+r[2]*m[2],e=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],s=m[0]*m[0]+m[1]*m[1]+m[2]*m[2]-i*i/e;s>a&&(a=s,f=t)}return D(i,o,f),a}(r,o,a,s)<n)return 2;return k(f,e,s),J(f,f),k(c,s,o),J(c,c),H(i,f,a),J(i,i),N(r,i,a,f,c,h),0}(d,t,O,w,A,M,E,g,Y,V)){case 1:return void q(r,i,P);case 2:return void v(t,E,P)}!function(t,r,i,m,P,j,x,I,d){(function(t,r,i,o,e){!function(t,n,r,i,o){const{data:e,offsetIdx:s,strideIdx:a}=t;D(i,e,s),D(o,i),r[0]=Q(y,n),r[1]=r[0];for(let t=s+a;t<e.length;t+=a){const s=e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2];s<r[0]&&(r[0]=s,D(i,e,t)),s>r[1]&&(r[1]=s,D(o,e,t))}}(t,r,l,e,o);const s=Q(i,r);l[1]-n<=s&&(o[0]=void 0);l[0]+n>=s&&(e[0]=void 0)})(t,r,i,o,e),void 0!==o[0]&&(k(s,o,i),J(s,s),k(a,o,m),J(a,a),k(f,o,P),J(f,f),H(c,a,j),J(c,c),H(h,f,x),J(h,h),H(u,s,I),J(u,u),N(t,c,j,a,s,d),N(t,h,x,f,a,d),N(t,u,I,s,f,d));void 0!==e[0]&&(k(s,e,i),J(s,s),k(a,e,m),J(a,a),k(f,e,P),J(f,f),H(c,a,j),J(c,c),H(h,f,x),J(h,h),H(u,s,I),J(u,u),N(t,c,j,a,s,d),N(t,h,x,f,a,d),N(t,u,I,s,f,d))}(t,O,w,A,M,E,g,Y,V),_(t,V.b0,V.b1,V.b2,F,T);const K=[0,0,0];k(K,T,F),V.quality=B(K),V.quality<b?S(V.b0,V.b1,V.b2,F,T,K,P):q(r,i,P)},Object.defineProperty(t,"__esModule",{value:!0})}));
