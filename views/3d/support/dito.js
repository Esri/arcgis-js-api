/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports"],(function(t){"use strict";const n=1e-6,i=[0,0,0],r=[0,0,0];function o(t,n){const{data:o,size:s}=t,a=o.length/s;if(a<=0)return;const c=new J(t);Q(i,c.minProj,c.maxProj),U(i,i,.5),R(r,c.maxProj,c.minProj);const h=L(r),u=new K;u.quality=h,a<14&&(t={data:new Float64Array(c.buffer,112,42),size:3});const f=[0,0,0],m=[0,0,0],l=[0,0,0],j=[0,0,0],b=[0,0,0],x=[0,0,0],I=[0,0,0];switch(e(c,t,I,f,m,l,j,b,x,u)){case 1:return void E(i,r,n);case 2:return void p(t,j,n)}P(t,I,f,m,l,j,b,x,u),B(t,u.b0,u.b1,u.b2,Y,O);const N=[0,0,0];R(N,O,Y),u.quality=L(N),u.quality<h?D(u.b0,u.b1,u.b2,Y,O,N,n):E(i,r,n)}function e(t,i,r,o,e,s,a,c,h,u){if(j(t,o,e),tt(o,e)<n)return 1;R(a,o,e),Z(a,a);return x(i,o,a,s)<n?2:(R(c,e,s),Z(c,c),R(h,s,o),Z(h,h),X(r,c,a),Z(r,r),M(i,r,a,c,h,u),0)}const s=[0,0,0],a=[0,0,0],c=[0,0,0],h=[0,0,0],u=[0,0,0],f=[0,0,0],m=[0,0,0],l=[0,0,0];function P(t,n,i,r,o,e,P,j,b){N(t,n,i,s,a),void 0!==s[0]&&(R(c,s,i),Z(c,c),R(h,s,r),Z(h,h),R(u,s,o),Z(u,u),X(f,h,e),Z(f,f),X(m,u,P),Z(m,m),X(l,c,j),Z(l,l),M(t,f,e,h,c,b),M(t,m,P,u,h,b),M(t,l,j,c,u,b)),void 0!==a[0]&&(R(c,a,i),Z(c,c),R(h,a,r),Z(h,h),R(u,a,o),Z(u,u),X(f,h,e),Z(f,f),X(m,u,P),Z(m,m),X(l,c,j),Z(l,l),M(t,f,e,h,c,b),M(t,m,P,u,h,b),M(t,l,j,c,u,b))}function j(t,n,i){let r=tt(t.maxVert[0],t.minVert[0]),o=0;for(let e=1;e<7;++e){const n=tt(t.maxVert[e],t.minVert[e]);n>r&&(r=n,o=e)}W(n,t.minVert[o]),W(i,t.maxVert[o])}const b=[0,0,0];function x(t,n,i,r){const{data:o,size:e}=t;let s=Number.NEGATIVE_INFINITY,a=0;for(let c=0;c<o.length;c+=e){b[0]=o[c]-n[0],b[1]=o[c+1]-n[1],b[2]=o[c+2]-n[2];const t=i[0]*b[0]+i[1]*b[1]+i[2]*b[2],r=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],e=b[0]*b[0]+b[1]*b[1]+b[2]*b[2]-t*t/r;e>s&&(s=e,a=c)}return W(r,o,a),s}const I=[0,0];function N(t,i,r,o,e){z(t,i,I,e,o);const s=nt(r,i);I[1]-n<=s&&(o[0]=void 0),I[0]+n>=s&&(e[0]=void 0)}const y=[0,0,0],V=[0,0,0],d=[0,0,0],q=[0,0,0],w=[0,0,0],A=[0,0,0];function M(t,i,r,o,e,s){if($(i)<n)return;X(y,r,i),X(V,o,i),X(d,e,i),T(t,i,I),w[1]=I[0],q[1]=I[1],A[1]=q[1]-w[1];const a=[r,o,e],c=[y,V,d];for(let n=0;n<3;++n){T(t,a[n],I),w[0]=I[0],q[0]=I[1],T(t,c[n],I),w[2]=I[0],q[2]=I[1],A[0]=q[0]-w[0],A[2]=q[2]-w[2];const r=L(A);r<s.quality&&(W(s.b0,a[n]),W(s.b1,i),W(s.b2,c[n]),s.quality=r)}}const F=[0,0,0];function T(t,n,i){const{data:r,size:o}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<r.length;e+=o){const t=r[e]*n[0]+r[e+1]*n[1]+r[e+2]*n[2];i[0]=Math.min(i[0],t),i[1]=Math.max(i[1],t)}}function z(t,n,i,r,o){const{data:e,size:s}=t;W(r,e),W(o,r),i[0]=nt(F,n),i[1]=i[0];for(let a=s;a<e.length;a+=s){const t=e[a]*n[0]+e[a+1]*n[1]+e[a+2]*n[2];t<i[0]&&(i[0]=t,W(r,e,a)),t>i[1]&&(i[1]=t,W(o,e,a))}}function E(t,n,i){W(i.center,t),U(i.halfSize,n,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const v=[0,0,0],_=[0,0,0],g=[0,0,0],Y=[0,0,0],O=[0,0,0],S=[0,0,0];function p(t,i,r){W(v,i),Math.abs(i[0])>Math.abs(i[1])&&Math.abs(i[0])>Math.abs(i[2])?v[0]=0:Math.abs(i[1])>Math.abs(i[2])?v[1]=0:v[2]=0,$(v)<n&&(v[0]=v[1]=v[2]=1),X(_,i,v),Z(_,_),X(g,i,_),Z(g,g),B(t,i,_,g,Y,O),R(S,O,Y),D(i,_,g,Y,O,S,r)}function B(t,n,i,r,o,e){T(t,n,I),o[0]=I[0],e[0]=I[1],T(t,i,I),o[1]=I[0],e[1]=I[1],T(t,r,I),o[2]=I[0],e[2]=I[1]}const G=[0,0,0],k=[1,0,0,0,1,0,0,0,1],C=[0,0,0];function D(t,n,i,r,o,e,s){k[0]=t[0],k[1]=t[1],k[2]=t[2],k[3]=n[0],k[4]=n[1],k[5]=n[2],k[6]=i[0],k[7]=i[1],k[8]=i[2],it(s.quaternion,k),Q(C,r,o),U(C,C,.5),U(s.center,t,C[0]),U(G,n,C[1]),Q(s.center,s.center,G),U(G,i,C[2]),Q(s.center,s.center,G),U(s.halfSize,e,.5)}const H=7;let J=function(t){this.minVert=new Array(H),this.maxVert=new Array(H);const n=64*H;this.buffer=new ArrayBuffer(n);let i=0;this.minProj=new Float64Array(this.buffer,i,H),i+=8*H,this.maxProj=new Float64Array(this.buffer,i,H),i+=8*H;for(let a=0;a<H;++a)this.minVert[a]=new Float64Array(this.buffer,i,3),i+=24;for(let a=0;a<H;++a)this.maxVert[a]=new Float64Array(this.buffer,i,3),i+=24;for(let a=0;a<H;++a)this.minProj[a]=Number.POSITIVE_INFINITY,this.maxProj[a]=Number.NEGATIVE_INFINITY;const r=new Array(H),o=new Array(H),{data:e,size:s}=t;for(let a=0;a<e.length;a+=s){let t=e[a];t<this.minProj[0]&&(this.minProj[0]=t,r[0]=a),t>this.maxProj[0]&&(this.maxProj[0]=t,o[0]=a),t=e[a+1],t<this.minProj[1]&&(this.minProj[1]=t,r[1]=a),t>this.maxProj[1]&&(this.maxProj[1]=t,o[1]=a),t=e[a+2],t<this.minProj[2]&&(this.minProj[2]=t,r[2]=a),t>this.maxProj[2]&&(this.maxProj[2]=t,o[2]=a),t=e[a]+e[a+1]+e[a+2],t<this.minProj[3]&&(this.minProj[3]=t,r[3]=a),t>this.maxProj[3]&&(this.maxProj[3]=t,o[3]=a),t=e[a]+e[a+1]-e[a+2],t<this.minProj[4]&&(this.minProj[4]=t,r[4]=a),t>this.maxProj[4]&&(this.maxProj[4]=t,o[4]=a),t=e[a]-e[a+1]+e[a+2],t<this.minProj[5]&&(this.minProj[5]=t,r[5]=a),t>this.maxProj[5]&&(this.maxProj[5]=t,o[5]=a),t=e[a]-e[a+1]-e[a+2],t<this.minProj[6]&&(this.minProj[6]=t,r[6]=a),t>this.maxProj[6]&&(this.maxProj[6]=t,o[6]=a)}for(let a=0;a<H;++a){let t=r[a];W(this.minVert[a],e,t),t=o[a],W(this.maxVert[a],e,t)}},K=function(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0};function L(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function Q(t,n,i){t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2]}function R(t,n,i){t[0]=n[0]-i[0],t[1]=n[1]-i[1],t[2]=n[2]-i[2]}function U(t,n,i){t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i}function W(t,n,i=0){t[0]=n[i+0],t[1]=n[i+1],t[2]=n[i+2]}function X(t,n,i){const r=n[0],o=n[1],e=n[2],s=i[0],a=i[1],c=i[2];t[0]=o*c-e*a,t[1]=e*s-r*c,t[2]=r*a-o*s}function Z(t,n){const i=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(i>0){const r=1/Math.sqrt(i);t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r}}function $(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function tt(t,n){const i=n[0]-t[0],r=n[1]-t[1],o=n[2]-t[2];return i*i+r*r+o*o}function nt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function it(t,n){const i=n[0]+n[4]+n[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(n[5]-n[7])*r,t[1]=(n[6]-n[2])*r,t[2]=(n[1]-n[3])*r}else{let i=0;n[4]>n[0]&&(i=1),n[8]>n[3*i+i]&&(i=2);const r=(i+1)%3,o=(i+2)%3;let e=Math.sqrt(n[3*i+i]-n[3*r+r]-n[3*o+o]+1);t[i]=.5*e,e=.5/e,t[3]=(n[3*r+o]-n[3*o+r])*e,t[r]=(n[3*r+i]+n[3*i+r])*e,t[o]=(n[3*o+i]+n[3*i+o])*e}}t.computeOBB=o,Object.defineProperty(t,"__esModule",{value:!0})}));
