// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports"],(function(r,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeOBB=void 0;var i=[0,0,0],a=[0,0,0];t.computeOBB=function(r,t){var P=r.data,j=r.strideIdx,x=P.length/j;if(!(x<=0)){var d=new p(r);G(i,d.minProj,d.maxProj),C(i,i,.5),k(a,d.maxProj,d.minProj);var I=z(a),b=new S;b.quality=I,x<14&&(r={data:new Float64Array(d.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var y=[0,0,0],q=[0,0,0],w=[0,0,0],A=[0,0,0],T=[0,0,0],g=[0,0,0],B=[0,0,0];switch(function(r,t,i,a,n,e,o,s,f,h){if(function(r,t,i){for(var a=L(r.maxVert[0],r.minVert[0]),n=0,e=1;e<7;++e){var o=L(r.maxVert[e],r.minVert[e]);o>a&&(a=o,n=e)}D(t,r.minVert[n]),D(i,r.maxVert[n])}(r,a,n),L(a,n)<1e-6)return 1;if(k(o,a,n),J(o,o),function(r,t,i,a){for(var n=r.data,e=r.offsetIdx,o=r.strideIdx,s=Number.NEGATIVE_INFINITY,f=0,h=e;h<n.length;h+=o){v[0]=n[h]-t[0],v[1]=n[h+1]-t[1],v[2]=n[h+2]-t[2];var u=i[0]*v[0]+i[1]*v[1]+i[2]*v[2],m=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],c=v[0]*v[0]+v[1]*v[1]+v[2]*v[2]-u*u/m;c>s&&(s=c,f=h)}return D(a,n,f),s}(t,a,o,e)<1e-6)return 2;return k(s,n,e),J(s,s),k(f,e,a),J(f,f),H(i,s,o),J(i,i),l(t,i,o,s,f,h),0}(d,r,B,y,q,w,A,T,g,b)){case 1:return void V(i,a,t);case 2:return void E(r,A,t)}!function(r,t,i,a,v,P,j,x,d){(function(r,t,i,a,n){!function(r,t,i,a,n){var e=r.data,o=r.offsetIdx,s=r.strideIdx;D(a,e,o),D(n,a),i[0]=Q(N,t),i[1]=i[0];for(var f=o+s;f<e.length;f+=s){var h=e[f]*t[0]+e[f+1]*t[1]+e[f+2]*t[2];h<i[0]&&(i[0]=h,D(a,e,f)),h>i[1]&&(i[1]=h,D(n,e,f))}}(r,t,c,n,a);var e=Q(i,t);c[1]-1e-6<=e&&(a[0]=void 0);c[0]+1e-6>=e&&(n[0]=void 0)})(r,t,i,n,e),void 0!==n[0]&&(k(o,n,i),J(o,o),k(s,n,a),J(s,s),k(f,n,v),J(f,f),H(h,s,P),J(h,h),H(u,f,j),J(u,u),H(m,o,x),J(m,m),l(r,h,P,s,o,d),l(r,u,j,f,s,d),l(r,m,x,o,f,d));void 0!==e[0]&&(k(o,e,i),J(o,o),k(s,e,a),J(s,s),k(f,e,v),J(f,f),H(h,s,P),J(h,h),H(u,f,j),J(u,u),H(m,o,x),J(m,m),l(r,h,P,s,o,d),l(r,u,j,f,s,d),l(r,m,x,o,f,d))}(r,B,y,q,w,A,T,g,b),_(r,b.b0,b.b1,b.b2,M,F);var O=[0,0,0];k(O,F,M),b.quality=z(O),b.quality<I?Y(b.b0,b.b1,b.b2,M,F,O,t):V(i,a,t)}};var n=[0,0,0],e=[0,0,0],o=[0,0,0],s=[0,0,0],f=[0,0,0],h=[0,0,0],u=[0,0,0],m=[0,0,0];var v=[0,0,0];var c=[0,0];var P=[0,0,0],j=[0,0,0],x=[0,0,0],d=[0,0,0],I=[0,0,0],b=[0,0,0];function l(r,t,i,a,n,e){if(!(K(t)<1e-6)){H(P,i,t),H(j,a,t),H(x,n,t),y(r,t,c),I[1]=c[0],d[1]=c[1],b[1]=d[1]-I[1];for(var o=[i,a,n],s=[P,j,x],f=0;f<3;++f){y(r,o[f],c),I[0]=c[0],d[0]=c[1],y(r,s[f],c),I[2]=c[0],d[2]=c[1],b[0]=d[0]-I[0],b[2]=d[2]-I[2];var h=z(b);h<e.quality&&(D(e.b0,o[f]),D(e.b1,t),D(e.b2,s[f]),e.quality=h)}}}var N=[0,0,0];function y(r,t,i){var a=r.data,n=r.offsetIdx,e=r.strideIdx;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(var o=n;o<a.length;o+=e){var s=a[o]*t[0]+a[o+1]*t[1]+a[o+2]*t[2];i[0]=Math.min(i[0],s),i[1]=Math.max(i[1],s)}}function V(r,t,i){D(i.center,r),C(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}var q=[0,0,0],w=[0,0,0],A=[0,0,0],M=[0,0,0],F=[0,0,0],T=[0,0,0];function E(r,t,i){D(q,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?q[0]=0:Math.abs(t[1])>Math.abs(t[2])?q[1]=0:q[2]=0,K(q)<1e-6&&(q[0]=q[1]=q[2]=1),H(w,t,q),J(w,w),H(A,t,w),J(A,A),_(r,t,w,A,M,F),k(T,F,M),Y(t,w,A,M,F,T,i)}function _(r,t,i,a,n,e){y(r,t,c),n[0]=c[0],e[0]=c[1],y(r,i,c),n[1]=c[0],e[1]=c[1],y(r,a,c),n[2]=c[0],e[2]=c[1]}var g=[0,0,0],B=[1,0,0,0,1,0,0,0,1],O=[0,0,0];function Y(r,t,i,a,n,e,o){B[0]=r[0],B[1]=r[1],B[2]=r[2],B[3]=t[0],B[4]=t[1],B[5]=t[2],B[6]=i[0],B[7]=i[1],B[8]=i[2],function(r,t){var i=t[0]+t[4]+t[8];if(i>0){var a=Math.sqrt(i+1);r[3]=.5*a,a=.5/a,r[0]=(t[5]-t[7])*a,r[1]=(t[6]-t[2])*a,r[2]=(t[1]-t[3])*a}else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var e=(n+1)%3,o=(n+2)%3;a=Math.sqrt(t[3*n+n]-t[3*e+e]-t[3*o+o]+1);r[n]=.5*a,a=.5/a,r[3]=(t[3*e+o]-t[3*o+e])*a,r[e]=(t[3*e+n]+t[3*n+e])*a,r[o]=(t[3*o+n]+t[3*n+o])*a}}(o.quaternion,B),G(O,a,n),C(O,O,.5),C(o.center,r,O[0]),C(g,t,O[1]),G(o.center,o.center,g),C(g,i,O[2]),G(o.center,o.center,g),C(o.halfSize,e,.5)}var p=function(r){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);var t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(var i=0;i<7;++i)this.minVert[i]=new Float64Array(this.buffer,t,3),t+=24;for(i=0;i<7;++i)this.maxVert[i]=new Float64Array(this.buffer,t,3),t+=24;for(i=0;i<7;++i)this.minProj[i]=Number.POSITIVE_INFINITY,this.maxProj[i]=Number.NEGATIVE_INFINITY;var a=new Array(7),n=new Array(7),e=r.data,o=r.offsetIdx,s=r.strideIdx;for(i=o;i<e.length;i+=s){var f=e[i];f<this.minProj[0]&&(this.minProj[0]=f,a[0]=i),f>this.maxProj[0]&&(this.maxProj[0]=f,n[0]=i),(f=e[i+1])<this.minProj[1]&&(this.minProj[1]=f,a[1]=i),f>this.maxProj[1]&&(this.maxProj[1]=f,n[1]=i),(f=e[i+2])<this.minProj[2]&&(this.minProj[2]=f,a[2]=i),f>this.maxProj[2]&&(this.maxProj[2]=f,n[2]=i),(f=e[i]+e[i+1]+e[i+2])<this.minProj[3]&&(this.minProj[3]=f,a[3]=i),f>this.maxProj[3]&&(this.maxProj[3]=f,n[3]=i),(f=e[i]+e[i+1]-e[i+2])<this.minProj[4]&&(this.minProj[4]=f,a[4]=i),f>this.maxProj[4]&&(this.maxProj[4]=f,n[4]=i),(f=e[i]-e[i+1]+e[i+2])<this.minProj[5]&&(this.minProj[5]=f,a[5]=i),f>this.maxProj[5]&&(this.maxProj[5]=f,n[5]=i),(f=e[i]-e[i+1]-e[i+2])<this.minProj[6]&&(this.minProj[6]=f,a[6]=i),f>this.maxProj[6]&&(this.maxProj[6]=f,n[6]=i)}for(i=0;i<7;++i){var h=a[i];D(this.minVert[i],e,h),h=n[i],D(this.maxVert[i],e,h)}},S=function(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0};function z(r){return r[0]*r[1]+r[0]*r[2]+r[1]*r[2]}function G(r,t,i){r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2]}function k(r,t,i){r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2]}function C(r,t,i){r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i}function D(r,t,i){void 0===i&&(i=0),r[0]=t[i+0],r[1]=t[i+1],r[2]=t[i+2]}function H(r,t,i){var a=t[0],n=t[1],e=t[2],o=i[0],s=i[1],f=i[2];r[0]=n*f-e*s,r[1]=e*o-a*f,r[2]=a*s-n*o}function J(r,t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){var a=1/Math.sqrt(i);r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a}}function K(r){return r[0]*r[0]+r[1]*r[1]+r[2]*r[2]}function L(r,t){var i=t[0]-r[0],a=t[1]-r[1],n=t[2]-r[2];return i*i+a*a+n*n}function Q(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}}));