/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../chunks/mat4","../../../chunks/mat4f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../chunks/SunCalc"],(function(t,e,i,n,o,a,l){"use strict";const u={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8e5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function s(t,i){const n=i[2],a=g;o.set(a.ambient.color,1,1,1),a.ambient.intensity=u.global.ambient,o.set(a.diffuse.color,1,1,1),a.diffuse.intensity=u.global.diffuse;let s=(Math.abs(n)-u.local.altitude)/(u.global.altitude-u.local.altitude);s=e.clamp(s,0,1),a.globalFactor=s;const c=l.SunCalc.getTimes(t,i[1],i[0]);if(s<1){const i=h(t,c);o.lerp(a.ambient.color,i.ambient.color,a.ambient.color,s),a.ambient.intensity=e.lerp(i.ambient.intensity,a.ambient.intensity,s),o.lerp(a.diffuse.color,i.diffuse.color,a.diffuse.color,s),a.diffuse.intensity=e.lerp(i.diffuse.intensity,a.diffuse.intensity,s)}return a.noonFactor=b(t,c),a}function c(t,n,s,c){c||(c=a.create());const r=d,f=i.identity(m);if("global"===s)l.SunCalc.getPosition(t,0,0,r),o.set(c,0,0,-1),i.rotateX(f,f,-r.azimuth),i.rotateY(f,f,-r.altitude),o.transformMat4(c,c,f);else{const a=u.planarDirection,s=a.globalAngles,m=n[2];let d=(Math.abs(m)-a.localAltitude)/(a.globalAltitude-a.localAltitude);d=e.clamp(d,0,1),d<1?(l.SunCalc.getPosition(t,n[1],n[0],r),r.azimuth=(1-d)*r.azimuth+d*s.azimuth,r.altitude=(1-d)*r.altitude+d*s.altitude):(r.azimuth=s.azimuth,r.altitude=s.altitude),o.set(c,0,-1,0),i.rotateZ(f,f,-r.azimuth),i.rotateX(f,f,-r.altitude),o.transformMat4(c,c,f)}return c}function r(t,e){if("global"===e)return!0;{const e=u.planarDirection,i=t[2];return Math.abs(i)<e.localAltitude}}function f(t,e,i,n,o){const a=o.length;if(a<1)return o;const l=t.getTime(),u=(e.getTime()-l)/a;for(let s=0;s<a;++s)p.setTime(l+u*s),c(p,i,n,o[s]);return o}const m=n.create(),d={azimuth:0,altitude:0},g={ambient:{color:a.create(),intensity:0},diffuse:{color:a.create(),intensity:0,directionToLightSource:a.create()},globalFactor:0,noonFactor:0};function b(t,i){const n=t.valueOf();let o,a;i.polarException===l.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):i.polarException===l.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,a=n-1):(o=i.sunrise.valueOf(),a=i.sunset.valueOf());const u=o+(a-o)/2;return 1-e.clamp(Math.abs(n-u)/432e5,0,1)}function h(t,e){const i=t.valueOf();let n,o;e.polarException===l.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(n=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,o=n+432e6):e.polarException===l.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(n=i-2,o=i-1):(n=e.sunrise.valueOf(),o=e.sunset.valueOf());const s=o-n,c=n+s/2,r=s/4,f=c-r,m=c+r,d=.06*s,g=n-d/2,b=n+d/2,h=o-d/2,p=o+d/2,O=u.local,y=[.01,O.ambientAtNight],N=[.8,.8,1],T=[.01,.01,.01],P=[O.diffuseAtTwilight,O.ambientAtTwilight],C=[1,.75,.75],E=[.8,.8,1],I=[.9*O.diffuseAtNoon,O.ambientAtNoon],M=[1,.98,.98],S=[.98,.98,1],v=[O.diffuseAtNoon,O.ambientAtNoon],_=[1,1,1],z=[1,1,1],D=I,L=M,w=S,H=P,R=C,X=E;let k,x,F=[0,0],G=[0,0,0],U=[0,0,0];return i<g||i>p?(F=y,G=T,U=N,x="night"):i<b?(k=b-g,F=A(i-g,k,y,P),G=A(i-g,k,T,C),U=A(i-g,k,N,E),x="sun rising"):i<f?(k=f-b,F=A(i-b,k,P,I),G=A(i-b,k,C,M),U=A(i-b,k,E,S),x="early morning"):i<c?(k=c-f,F=A(i-f,k,I,v),G=A(i-f,k,M,_),U=A(i-f,k,S,z),x="late morning"):i<m?(k=m-c,F=A(i-c,k,v,D),G=A(i-c,k,_,L),U=A(i-c,k,z,w),x="early afternoon"):i<h?(k=h-m,F=A(i-m,k,D,H),G=A(i-m,k,L,R),U=A(i-m,k,w,X),x="late afternoon"):i<p&&(k=p-h,F=A(i-h,k,H,y),G=A(i-h,k,R,T),U=A(i-h,k,X,N),x="sun setting"),{diffuse:{intensity:F[0],color:a.fromValues(G[0],G[1],G[2])},ambient:{intensity:F[1],color:a.fromValues(U[0],U[1],U[2])},timeOfDay:x}}function A(t,e,i,n){const o=[];for(let a=0;a<i.length;a++)o[a]=(n[a]-i[a])*t/e+i[a];return o}const p=new Date(0);t.computeColorAndIntensity=s,t.computeDirection=c,t.computeDirectionsOverTime=f,t.computeShadowsEnabled=r,t.settings=u,Object.defineProperty(t,"__esModule",{value:!0})}));
