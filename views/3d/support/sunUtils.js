/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../chunks/mat4","../../../chunks/mat4f64","../../../chunks/vec3","../../../chunks/vec3f64","../../ViewingMode","../../../chunks/SunCalc"],(function(t,e,n,i,o,a,l,r){"use strict";const c={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function s(t,n,i,l,s,d,g){o.set(g.ambient.color,1,1,1),g.ambient.intensity=c.global.ambient,o.set(g.direct.color,1,1,1),g.direct.intensity=c.global.direct;const f=n[2],b=e.clamp((Math.abs(f)-c.local.altitude)/(c.global.altitude-c.local.altitude),0,1);let h;if(g.globalFactor=b,"sun"===d&&(h=r.SunCalc.getTimes(t,n[1],n[0])),b<1){let n;if("sun"===d)n=S(t,h,l);else{const t=A(l);n={direct:{intensity:c.local.directAtNoon*t.direct,color:a.fromValues(1,1,1)},ambient:{intensity:c.local.ambientAtNoon*t.ambient,color:a.fromValues(1,1,1)},timeOfDay:"early afternoon"}}o.lerp(g.ambient.color,n.ambient.color,g.ambient.color,b),g.ambient.intensity=e.lerp(n.ambient.intensity,g.ambient.intensity,b),o.lerp(g.direct.color,n.direct.color,g.direct.color,b),g.direct.intensity=e.lerp(n.direct.intensity,g.direct.intensity,b),g.specularStrength="rainy"===l||"snowy"===l||"foggy"===l?0:1,g.environmentStrength="rainy"===l?.7:"snowy"===l||"foggy"===l?.75:1}g.noonFactor="sun"===d?p(t,h):1,"sun"===d?m(t,n,i,g.direct.directionToLightSource):u(s,i,g.direct.directionToLightSource)}function u(t,e,i){e===l.ViewingMode.Global?o.normalize(v,t.eye):o.set(v,0,0,1),n.fromRotation(N,O,t.viewRight),o.transformMat4(i,v,N),n.fromRotation(N,P,v),o.transformMat4(i,i,N)}function m(t,i,a,s){const u=y,m=n.identity(h);if(a===l.ViewingMode.Global)r.SunCalc.getPosition(t,0,0,u),o.set(s,0,0,-1),n.rotateX(m,m,-u.azimuth),n.rotateY(m,m,-u.altitude),o.transformMat4(s,s,m);else{const a=c.planarDirection,l=a.globalAngles,d=i[2];let g=(Math.abs(d)-a.localAltitude)/(a.globalAltitude-a.localAltitude);g=e.clamp(g,0,1),g<1?(r.SunCalc.getPosition(t,i[1],i[0],u),u.azimuth=(1-g)*u.azimuth+g*l.azimuth,u.altitude=(1-g)*u.altitude+g*l.altitude):(u.azimuth=l.azimuth,u.altitude=l.altitude),o.set(s,0,-1,0),n.rotateZ(m,m,-u.azimuth),n.rotateX(m,m,-u.altitude),o.transformMat4(s,s,m)}}function d(t,e){if(e===l.ViewingMode.Global)return!0;const n=c.planarDirection;return Math.abs(t)<n.localAltitude}function g(t,e,n,i,o){const l=t.getTime(),r=e.getTime()-l,c=Math.floor(r/n)+1,s=new Array(c);for(let u=0;u<c;++u)T.setTime(l+n*u),s[u]=a.create(),m(T,i,o,s[u]);return s}const f=a.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);let b=function(){this.ambient={color:a.fromValues(1,1,1),intensity:.55},this.direct={color:a.fromValues(1,1,1),intensity:.55,directionToLightSource:a.clone(f)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1};const h=i.create(),y={azimuth:0,altitude:0};function p(t,n){const i=t.valueOf();let o,a;n.polarException===r.SunCalc.PolarException.MIDNIGHT_SUN?(o=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):n.polarException===r.SunCalc.PolarException.POLAR_NIGHT?(o=i-2,a=i-1):(o=n.sunrise.valueOf(),a=n.sunset.valueOf());const l=o+(a-o)/2;return 1-e.clamp(Math.abs(i-l)/432e5,0,1)}function A(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function M(t,e){const n=(t[0]+t[1]+t[2])/3;for(let i=0;i<3;i++)t[i]=t[i]+(n-t[i])*e;return t}function S(t,e,n){const i=t.valueOf();let o,l;e.polarException===r.SunCalc.PolarException.MIDNIGHT_SUN?(o=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,l=o+432e6):e.polarException===r.SunCalc.PolarException.POLAR_NIGHT?(o=i-2,l=i-1):(o=e.sunrise.valueOf(),l=e.sunset.valueOf());const s=l-o,u=o+s/2,m=s/4,d=u-m,g=u+m,f=.06*s,b=o-f/2,h=o+f/2,y=l-f/2,p=l+f/2,S=c.local,T=[.01,S.ambientAtNight],N=[.8,.8,1],v=[.01,.01,.01],O=[S.directAtTwilight,S.ambientAtTwilight],P=[1,.6,.5],V=[.8,.8,1],z=[.9*S.directAtNoon,S.ambientAtNoon],C=[1,.98,.98],I=[.98,.98,1],x=[S.directAtNoon,S.ambientAtNoon],D=[1,1,1],E=[1,1,1],G=z,H=C,_=I,k=O,L=P,R=V;let F,U,X=[0,0],j=[0,0,0],Y=[0,0,0];i<b||i>p?(X=T,j=v,Y=N,U="night"):i<h?(F=h-b,X=w(i-b,F,T,O),j=w(i-b,F,v,P),Y=w(i-b,F,N,V),U="sun rising"):i<d?(F=d-h,X=w(i-h,F,O,z),j=w(i-h,F,P,C),Y=w(i-h,F,V,I),U="early morning"):i<u?(F=u-d,X=w(i-d,F,z,x),j=w(i-d,F,C,D),Y=w(i-d,F,I,E),U="late morning"):i<g?(F=g-u,X=w(i-u,F,x,G),j=w(i-u,F,D,H),Y=w(i-u,F,E,_),U="early afternoon"):i<y?(F=y-g,X=w(i-g,F,G,k),j=w(i-g,F,H,L),Y=w(i-g,F,_,R),U="late afternoon"):i<p&&(F=p-y,X=w(i-y,F,k,T),j=w(i-y,F,L,v),Y=w(i-y,F,R,N),U="sun setting");let Z=0;switch(n){case"rainy":case"foggy":Z=.9;case"snowy":Z=.5}Z>0&&(j=M(j,Z),Y=M(Y,Z));const q=a.fromValues(j[0],j[1],j[2]),B=a.fromValues(Y[0],Y[1],Y[2]),J=A(n);return{direct:{intensity:X[0]*J.direct,color:q},ambient:{intensity:X[1]*J.ambient,color:B},timeOfDay:U}}function w(t,e,n,i){const o=[];for(let a=0;a<n.length;a++)o[a]=(i[a]-n[a])*t/e+n[a];return o}const T=new Date(0),N=i.create(),v=a.create(),O=.35,P=-.5;t.ColorAndIntensity=b,t.computeColorAndIntensity=s,t.computeDirectionsOverTime=g,t.computeShadowsEnabled=d,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
