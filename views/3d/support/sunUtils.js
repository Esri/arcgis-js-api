/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../chunks/mat4","../../../chunks/mat4f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../chunks/SunCalc"],(function(t,e,i,n,o,a,l){"use strict";const u={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8e5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function s(t,i,n,a){const s=i[2];o.set(a.ambient.color,1,1,1),a.ambient.intensity=u.global.ambient,o.set(a.diffuse.color,1,1,1),a.diffuse.intensity=u.global.diffuse;const r=e.clamp((Math.abs(s)-u.local.altitude)/(u.global.altitude-u.local.altitude),0,1);a.globalFactor=r;const f=l.SunCalc.getTimes(t,i[1],i[0]);if(r<1){const i=A(t,f);o.lerp(a.ambient.color,i.ambient.color,a.ambient.color,r),a.ambient.intensity=e.lerp(i.ambient.intensity,a.ambient.intensity,r),o.lerp(a.diffuse.color,i.diffuse.color,a.diffuse.color,r),a.diffuse.intensity=e.lerp(i.diffuse.intensity,a.diffuse.intensity,r)}a.noonFactor=g(t,f),c(t,i,n,a.diffuse.directionToLightSource)}function c(t,n,a,s){const c=b,r=i.identity(h);if(1===a)l.SunCalc.getPosition(t,0,0,c),o.set(s,0,0,-1),i.rotateX(r,r,-c.azimuth),i.rotateY(r,r,-c.altitude),o.transformMat4(s,s,r);else{const a=u.planarDirection,f=a.globalAngles,m=n[2];let d=(Math.abs(m)-a.localAltitude)/(a.globalAltitude-a.localAltitude);d=e.clamp(d,0,1),d<1?(l.SunCalc.getPosition(t,n[1],n[0],c),c.azimuth=(1-d)*c.azimuth+d*f.azimuth,c.altitude=(1-d)*c.altitude+d*f.altitude):(c.azimuth=f.azimuth,c.altitude=f.altitude),o.set(s,0,-1,0),i.rotateZ(r,r,-c.azimuth),i.rotateX(r,r,-c.altitude),o.transformMat4(s,s,r)}}function r(t,e){if(1===e)return!0;const i=u.planarDirection;return Math.abs(t)<i.localAltitude}function f(t,e,i,n,o){const l=t.getTime(),u=e.getTime()-l,s=Math.floor(u/i)+1,r=new Array(s);for(let f=0;f<s;++f)y.setTime(l+i*f),r[f]=a.create(),c(y,n,o,r[f]);return r}const m=a.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);let d=function(){this.ambient={color:a.fromValues(1,1,1),intensity:.55},this.diffuse={color:a.fromValues(1,1,1),intensity:.55,directionToLightSource:a.clone(m)},this.noonFactor=.5,this.globalFactor=0};const h=n.create(),b={azimuth:0,altitude:0};function g(t,i){const n=t.valueOf();let o,a;i.polarException===l.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):i.polarException===l.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,a=n-1):(o=i.sunrise.valueOf(),a=i.sunset.valueOf());const u=o+(a-o)/2;return 1-e.clamp(Math.abs(n-u)/432e5,0,1)}function A(t,e){const i=t.valueOf();let n,o;e.polarException===l.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(n=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,o=n+432e6):e.polarException===l.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(n=i-2,o=i-1):(n=e.sunrise.valueOf(),o=e.sunset.valueOf());const s=o-n,c=n+s/2,r=s/4,f=c-r,m=c+r,d=.06*s,h=n-d/2,b=n+d/2,g=o-d/2,A=o+d/2,y=u.local,O=[.01,y.ambientAtNight],T=[.8,.8,1],N=[.01,.01,.01],P=[y.diffuseAtTwilight,y.ambientAtTwilight],C=[1,.75,.75],I=[.8,.8,1],M=[.9*y.diffuseAtNoon,y.ambientAtNoon],E=[1,.98,.98],S=[.98,.98,1],v=[y.diffuseAtNoon,y.ambientAtNoon],_=[1,1,1],z=[1,1,1],D=M,L=E,w=S,H=P,R=C,X=I;let k,x,V=[0,0],F=[0,0,0],G=[0,0,0];return i<h||i>A?(V=O,F=N,G=T,x="night"):i<b?(k=b-h,V=p(i-h,k,O,P),F=p(i-h,k,N,C),G=p(i-h,k,T,I),x="sun rising"):i<f?(k=f-b,V=p(i-b,k,P,M),F=p(i-b,k,C,E),G=p(i-b,k,I,S),x="early morning"):i<c?(k=c-f,V=p(i-f,k,M,v),F=p(i-f,k,E,_),G=p(i-f,k,S,z),x="late morning"):i<m?(k=m-c,V=p(i-c,k,v,D),F=p(i-c,k,_,L),G=p(i-c,k,z,w),x="early afternoon"):i<g?(k=g-m,V=p(i-m,k,D,H),F=p(i-m,k,L,R),G=p(i-m,k,w,X),x="late afternoon"):i<A&&(k=A-g,V=p(i-g,k,H,O),F=p(i-g,k,R,N),G=p(i-g,k,X,T),x="sun setting"),{diffuse:{intensity:V[0],color:a.fromValues(F[0],F[1],F[2])},ambient:{intensity:V[1],color:a.fromValues(G[0],G[1],G[2])},timeOfDay:x}}function p(t,e,i,n){const o=[];for(let a=0;a<i.length;a++)o[a]=(n[a]-i[a])*t/e+i[a];return o}const y=new Date(0);t.ColorAndIntensity=d,t.computeColorAndIntensity=s,t.computeDirectionsOverTime=f,t.computeShadowsEnabled=r,Object.defineProperty(t,"__esModule",{value:!0})}));
