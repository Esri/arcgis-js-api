/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../core/mathUtils","../../../chunks/mat4","../../../chunks/mat4f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../chunks/SunCalc"],(function(t,e,i,n,o,a,l){"use strict";const c={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function r(t,i,n,a,r){const u=i[2];o.set(a.ambient.color,1,1,1),a.ambient.intensity=c.global.ambient,o.set(a.direct.color,1,1,1),a.direct.intensity=c.global.direct;const m=e.clamp((Math.abs(u)-c.local.altitude)/(c.global.altitude-c.local.altitude),0,1);a.globalFactor=m;const d=l.SunCalc.getTimes(t,i[1],i[0]);if(m<1){const i=y(t,d,r);o.lerp(a.ambient.color,i.ambient.color,a.ambient.color,m),a.ambient.intensity=e.lerp(i.ambient.intensity,a.ambient.intensity,m),o.lerp(a.direct.color,i.direct.color,a.direct.color,m),a.direct.intensity=e.lerp(i.direct.intensity,a.direct.intensity,m)}a.noonFactor=g(t,d),s(t,i,n,a.direct.directionToLightSource)}function s(t,n,a,r){const s=f,u=i.identity(h);if(1===a)l.SunCalc.getPosition(t,0,0,s),o.set(r,0,0,-1),i.rotateX(u,u,-s.azimuth),i.rotateY(u,u,-s.altitude),o.transformMat4(r,r,u);else{const a=c.planarDirection,m=a.globalAngles,d=n[2];let b=(Math.abs(d)-a.localAltitude)/(a.globalAltitude-a.localAltitude);b=e.clamp(b,0,1),b<1?(l.SunCalc.getPosition(t,n[1],n[0],s),s.azimuth=(1-b)*s.azimuth+b*m.azimuth,s.altitude=(1-b)*s.altitude+b*m.altitude):(s.azimuth=m.azimuth,s.altitude=m.altitude),o.set(r,0,-1,0),i.rotateZ(u,u,-s.azimuth),i.rotateX(u,u,-s.altitude),o.transformMat4(r,r,u)}}function u(t,e){if(1===e)return!0;const i=c.planarDirection;return Math.abs(t)<i.localAltitude}function m(t,e,i,n,o){const l=t.getTime(),c=e.getTime()-l,r=Math.floor(c/i)+1,u=new Array(r);for(let m=0;m<r;++m)O.setTime(l+i*m),u[m]=a.create(),s(O,n,o,u[m]);return u}const d=a.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);let b=function(){this.ambient={color:a.fromValues(1,1,1),intensity:.55},this.direct={color:a.fromValues(1,1,1),intensity:.55,directionToLightSource:a.clone(d)},this.noonFactor=.5,this.globalFactor=0};const h=n.create(),f={azimuth:0,altitude:0};function g(t,i){const n=t.valueOf();let o,a;i.polarException===l.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):i.polarException===l.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,a=n-1):(o=i.sunrise.valueOf(),a=i.sunset.valueOf());const c=o+(a-o)/2;return 1-e.clamp(Math.abs(n-c)/432e5,0,1)}function A(t){switch(t){case"disabled":case"sunny":return{direct:1,ambient:1};case"cloudy":return{direct:.8,ambient:1.1};case"rainy":return{direct:.4,ambient:1};case"foggy":return{direct:.3,ambient:1.6}}}function y(t,e,i){const n=t.valueOf();let o,r;e.polarException===l.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,r=o+432e6):e.polarException===l.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,r=n-1):(o=e.sunrise.valueOf(),r=e.sunset.valueOf());const s=r-o,u=o+s/2,m=s/4,d=u-m,b=u+m,h=.06*s,f=o-h/2,g=o+h/2,y=r-h/2,O=r+h/2,T=c.local,N=[.01,T.ambientAtNight],P=[.8,.8,1],C=[.01,.01,.01],I=[T.directAtTwilight,T.ambientAtTwilight],M=[1,.6,.5],E=[.8,.8,1],S=[.9*T.directAtNoon,T.ambientAtNoon],v=[1,.98,.98],_=[.98,.98,1],z=[T.directAtNoon,T.ambientAtNoon],w=[1,1,1],D=[1,1,1],L=S,H=v,R=_,X=I,k=M,x=E;let V,F,G=[0,0],U=[0,0,0],j=[0,0,0];n<f||n>O?(G=N,U=C,j=P,F="night"):n<g?(V=g-f,G=p(n-f,V,N,I),U=p(n-f,V,C,M),j=p(n-f,V,P,E),F="sun rising"):n<d?(V=d-g,G=p(n-g,V,I,S),U=p(n-g,V,M,v),j=p(n-g,V,E,_),F="early morning"):n<u?(V=u-d,G=p(n-d,V,S,z),U=p(n-d,V,v,w),j=p(n-d,V,_,D),F="late morning"):n<b?(V=b-u,G=p(n-u,V,z,L),U=p(n-u,V,w,H),j=p(n-u,V,D,R),F="early afternoon"):n<y?(V=y-b,G=p(n-b,V,L,X),U=p(n-b,V,H,k),j=p(n-b,V,R,x),F="late afternoon"):n<O&&(V=O-y,G=p(n-y,V,X,N),U=p(n-y,V,k,C),j=p(n-y,V,x,P),F="sun setting");const Y=a.fromValues(U[0],U[1],U[2]),Z=a.fromValues(j[0],j[1],j[2]),q=A(i);return{direct:{intensity:G[0]*q.direct,color:Y},ambient:{intensity:G[1]*q.ambient,color:Z},timeOfDay:F}}function p(t,e,i,n){const o=[];for(let a=0;a<i.length;a++)o[a]=(n[a]-i[a])*t/e+i[a];return o}const O=new Date(0);t.ColorAndIntensity=b,t.computeColorAndIntensity=r,t.computeDirectionsOverTime=m,t.computeShadowsEnabled=u,Object.defineProperty(t,"__esModule",{value:!0})}));
