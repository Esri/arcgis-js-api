/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../chunks/vec2","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection","../../../ViewingMode","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/ContentObjectType","../../webgl-engine/lib/DoubleArray","../../webgl-engine/lib/FloatArray","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/VertexAttribute"],(function(t,e,r,n,i,o,u,a,s,l,b,c,A,p,T){"use strict";function f(t,e,r=null){const n=[],i=[],o=e.mapPositions;h(e,i,n);const u=i[0][1].data,a=n[0][1].length,s=new Array(a).fill(0);return g(e,i,n,s),O(e,i,n,s),E(e,i,n,s),w(e,i,n,s),y(e,i,n,s),I(e,i,n,s),R(e,i,n,u),new p.Geometry(t,i,n,o,b.ContentObjectType.Line,r)}function h(t,e,r){const{attributeData:{position:n},removeDuplicateStartEnd:i}=t,o=S(n)&&i,u=n.length/3-(o?1:0),a=new Array(2*(u-1)),s=o?n.slice(0,n.length-3):n;let b=0;for(let l=0;l<u-1;l++)a[b++]=l,a[b++]=l+1;e.push([T.VertexAttribute.POSITION,new l.Attribute(s,3,o)]),r.push([T.VertexAttribute.POSITION,a])}function g(t,r,n,i){if(e.isSome(t.attributeData.colorFeature))return;const u=t.attributeData.color;r.push([T.VertexAttribute.COLOR,new l.Attribute(e.unwrapOr(u,o.ONES),4)]),n.push([T.VertexAttribute.COLOR,i])}function E(t,r,n,i){if(!e.isSome(t.attributeData.normal))return;const o=t.attributeData.normal;r.push([T.VertexAttribute.NORMAL,new l.Attribute(o,3)]),n.push([T.VertexAttribute.NORMAL,i])}function w(t,r,n,i){const o=t.attributeData.colorFeature;e.isNone(o)||(r.push([T.VertexAttribute.COLORFEATUREATTRIBUTE,new l.Attribute([o],1,!0)]),n.push([T.VertexAttribute.COLOR,i]))}function O(t,r,n,i){if(e.isSome(t.attributeData.sizeFeature))return;const o=t.attributeData.size;r.push([T.VertexAttribute.SIZE,new l.Attribute([e.unwrapOr(o,1)],1,!0)]),n.push([T.VertexAttribute.SIZE,i])}function y(t,r,n,i){const o=t.attributeData.sizeFeature;e.isNone(o)||(r.push([T.VertexAttribute.SIZEFEATUREATTRIBUTE,new l.Attribute([o],1,!0)]),n.push([T.VertexAttribute.SIZEFEATUREATTRIBUTE,i]))}function I(t,r,n,i){const o=t.attributeData.opacityFeature;e.isNone(o)||(r.push([T.VertexAttribute.OPACITYFEATUREATTRIBUTE,new l.Attribute([o],1,!0)]),n.push([T.VertexAttribute.OPACITYFEATUREATTRIBUTE,i]))}function R(t,i,o,b){if(e.isNone(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==s.ViewingMode.Global||!t.overlayInfo.spatialReference.isGeographic)return;const p=c.newDoubleArray(b.length),f=u.getReferenceEllipsoid(t.overlayInfo.spatialReference);for(let e=0;e<p.length;e+=3)a.lonLatToWebMercatorComparable(b,e,p,e,f);const h=b.length/3,g=A.newFloatArray(h+1);let E=V,w=m,O=0,y=0;n.set(E,p[y++],p[y++],p[y++]),g[0]=0;for(let e=1;e<h+1;++e)e===h&&(y=0),n.set(w,p[y++],p[y++],p[y++]),O+=r.dist(E,w),g[e]=O,[E,w]=[w,E];i.push([T.VertexAttribute.DISTANCETOSTART,new l.Attribute(g,1,!0)]),o.push([T.VertexAttribute.DISTANCETOSTART,o[0][1]])}function S(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const V=i.create(),m=i.create();function x(t,r){if(e.isNone(t)||0===t.length)return[];const n=[];return t.forEach((t=>{const e=t.length,i=c.newDoubleArray(3*e);t.forEach(((t,e)=>{i[3*e+0]=t[0],i[3*e+1]=t[1],i[3*e+2]=t[2]}));const o={attributeData:{position:i,normal:r},removeDuplicateStartEnd:!1};n.push(o)})),n}t.createGeometry=f,t.lineStripsToParameters=x,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
