/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../core/typedArrayUtil","../../../../chunks/vec2","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4f64","../../../../geometry/projection","../../../../geometry/projectionEllipsoid","../../../ViewingMode","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/VertexAttribute"],(function(t,e,r,i,a,n,o,u,s,c,l,A,b){"use strict";function p(t,e=null){const r=[],i=[];E(t,i,r);const a=i[0][1].data,n=r[0][1].length,o=new Array(n).fill(0);return f(t,i,r),T(t,i,r,o),O(t,i,r,o),h(t,i,r,o),d(t,i,r,o),R(t,i,r,o),g(t,i,r,o),S(t,i,r,a),new A.Geometry(i,r,l.PrimitiveType.Line,e)}function E(t,e,i){const{attributeData:{position:a},removeDuplicateStartEnd:n}=t,o=y(a)&&n,u=a.length/3-(o?1:0),s=new Array(2*(u-1)),c=o?r.slice(a,0,a.length-3):a;let l=0;for(let r=0;r<u-1;r++)s[l++]=r,s[l++]=r+1;e.push([b.VertexAttribute.POSITION,{size:3,data:c,exclusive:o}]),i.push([b.VertexAttribute.POSITION,s])}function f(t,r,i){const a=t.attributeData.mapPosition;e.isNone(a)||(i.push([b.VertexAttribute.MAPPOS,i[0][1]]),r.push([b.VertexAttribute.MAPPOS,{size:3,data:a}]))}function T(t,r,i,a){if(e.isSome(t.attributeData.colorFeature))return;const n=t.attributeData.color;r.push([b.VertexAttribute.COLOR,{size:4,data:e.unwrapOr(n,o.ONES)}]),i.push([b.VertexAttribute.COLOR,a])}function h(t,r,i,a){if(!e.isSome(t.attributeData.normal))return;const n=t.attributeData.normal;r.push([b.VertexAttribute.NORMAL,{size:3,data:n}]),i.push([b.VertexAttribute.NORMAL,a])}function d(t,r,i,a){const n=t.attributeData.colorFeature;e.isNone(n)||(r.push([b.VertexAttribute.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),i.push([b.VertexAttribute.COLOR,a]))}function O(t,r,i,a){if(e.isSome(t.attributeData.sizeFeature))return;const n=t.attributeData.size;r.push([b.VertexAttribute.SIZE,{size:1,data:[e.unwrapOr(n,1)]}]),i.push([b.VertexAttribute.SIZE,a])}function R(t,r,i,a){const n=t.attributeData.sizeFeature;e.isNone(n)||(r.push([b.VertexAttribute.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),i.push([b.VertexAttribute.SIZEFEATUREATTRIBUTE,a]))}function g(t,r,i,a){const n=t.attributeData.opacityFeature;e.isNone(n)||(r.push([b.VertexAttribute.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),i.push([b.VertexAttribute.OPACITYFEATUREATTRIBUTE,a]))}function S(t,r,n,o){if(e.isNone(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==c.ViewingMode.Global||!t.overlayInfo.spatialReference.isGeographic)return;const l=new Float64Array(o.length),A=s.getReferenceEllipsoid(t.overlayInfo.spatialReference);for(let e=0;e<l.length;e+=3)u.lonLatToWebMercatorComparable(o,e,l,e,A);const p=o.length/3,E=new Float32Array(p+1);let f=m,T=I,h=0,d=0;a.set(f,l[d++],l[d++],l[d++]),E[0]=0;for(let e=1;e<p+1;++e)e===p&&(d=0),a.set(T,l[d++],l[d++],l[d++]),h+=i.dist(f,T),E[e]=h,[f,T]=[T,f];r.push([b.VertexAttribute.DISTANCETOSTART,{size:1,data:E}]),n.push([b.VertexAttribute.DISTANCETOSTART,n[0][1]])}function y(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}var V;t.RemoveDuplicateStartEnd=void 0,(V=t.RemoveDuplicateStartEnd||(t.RemoveDuplicateStartEnd={}))[V.KEEP=0]="KEEP",V[V.REMOVE=1]="REMOVE";const m=n.create(),I=n.create();function x(t,r){if(e.isNone(t)||0===t.length)return[];const i=[];return t.forEach((t=>{const e=t.length,a=new Float64Array(3*e);t.forEach(((t,e)=>{a[3*e+0]=t[0],a[3*e+1]=t[1],a[3*e+2]=t[2]}));const n={attributeData:{position:a,normal:r},removeDuplicateStartEnd:!1};i.push(n)})),i}t.createGeometry=p,t.lineStripsToParameters=x,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
