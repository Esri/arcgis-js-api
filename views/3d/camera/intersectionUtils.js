/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/vec3f64","../../../chunks/vec3","../../../geometry/projectionEllipsoid","../../../geometry/support/aaBoundingRect","../webgl-engine/lib/Intersector"],(function(e,t,n,r,i,o){"use strict";function a(e,t){return e.elevationProvider&&e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")||0}function c(e,t,r){if(!e.state.isGlobal)return!1;const i=a(e,t),o=e.stateManager.constraintsManager.nearFarHeuristic,{far:c}=o.compute(t,r,e.dataExtent,i,f),s=c*c;return n.squaredDistance(t,r)>s}const s={},l=t.create(),d=t.create(),u=t.create(),f={near:0,far:0};e.cameraOnContentAlongViewDirection=function(e,i,a,l){const f=e.state.camera.clone();i&&(f.eye=i),a&&(f.center=a),l&&(f.up=l),function(e,i,a=t.create()){let l=s[e.viewingMode];l||(l=new o.Intersector(e.state.mode),l.options.backfacesTerrain=!e.state.isGlobal,l.options.invisibleTerrain=!0,s[e.viewingMode]=l);const{isGlobal:d}=e.state;if(e.sceneIntersectionHelper.intersectRay(i,l,a)&&!c(e,i.origin,a))return!0;if(!e.renderCoordsHelper.intersectManifold(i,0,a)||c(e,i.origin,a))return!!d&&function(e,t,r){const i=n.dot(e.origin,e.origin),o=i-r*r,a=o>0?Math.sqrt(o)/3:1;return n.scale(t,e.direction,a/n.length(e.direction)),n.add(t,t,e.origin),!0}(i,a,r.getReferenceEllipsoid(e.spatialReference).radius);return!0}(e,f.ray,d)||n.copy(d,f.center);const g=e.state.constraints,p=g.minimumPoiDistance;if(n.squaredDistance(f.eye,d)<p){const t=g.collision.enabled;n.copy(u,f.viewForward),n.scale(u,u,p),t?n.subtract(f.eye,d,u):n.add(d,f.eye,u);const r=e.renderCoordsHelper,i=r.getAltitude(f.eye),o=g.collision.elevationMargin;t&&i<o&&(n.subtract(u,d,f.eye),r.setAltitude(o,f.eye),n.add(d,f.eye,u))}return f.center=d,f},e.eyeWithinExtent=function(e,t,n,r){return e.renderCoordsHelper.fromRenderCoords(t.eye,l,r)&&i.containsPoint(n,l)},e.surfaceElevationBelowRenderLocation=a,Object.defineProperty(e,"__esModule",{value:!0})}));
