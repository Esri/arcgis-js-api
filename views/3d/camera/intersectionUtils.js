/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/ellipsoidUtils","../../../geometry/support/aaBoundingRect","../webgl-engine/lib/Intersector"],(function(e,t,n,r,i,o,a){"use strict";function s(e,n,r,i){return t.isSome(e.renderCoordsHelper.fromRenderCoords(n.eye,p,i))&&o.containsPoint(r,p)}function c(e,n){return e.elevationProvider?t.unwrapOr(e.elevationProvider.getElevation(n[0],n[1],n[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function l(e,t,r,i){const o=e.state.camera.clone();t&&r&&i&&(o.eye=t,o.center=r,o.up=i),u(e,o.ray,y)||n.copy(y,o.center);const a=e.state.constraints,s=a.minimumPoiDistance;if(n.squaredDistance(o.eye,y)<s){const t=a.collision.enabled;n.copy(v,o.viewForward),n.scale(v,v,s),t?o.eye=n.subtract(p,y,v):n.add(y,o.eye,v);const r=e.renderCoordsHelper,i=r.getAltitude(o.eye),c=a.collision.elevationMargin;t&&i<c&&(n.subtract(v,y,o.eye),o.eye=r.setAltitude(p,c,o.eye),n.add(y,o.eye,v))}return o.center=y,o}function d(e,t,r){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const i=c(e,t),o=e.stateManager.constraintsManager.nearFarHeuristic,{far:a}=o.compute(t,r,e.renderDataExtent,i,b),s=a*a;return n.squaredDistance(t,r)>s}function u(e,t,n){let r=f[e.viewingMode];r||(r=a.newIntersector(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,f[e.viewingMode]=r);const{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,n)||d(e,t.origin,n))||(!(!e.renderCoordsHelper.intersectManifold(t,0,n)||d(e,t.origin,n))||!!o&&g(t,n,i.getReferenceEllipsoid(e.spatialReference).radius))}function g(e,t,r){const i=n.dot(e.origin,e.origin)-r*r,o=i>0?Math.sqrt(i)/3:1;return n.scale(t,e.direction,o/n.length(e.direction)),n.add(t,t,e.origin),!0}const f={},p=r.create(),y=r.create(),v=r.create(),b={near:0,far:0};e.cameraOnContentAlongViewDirection=l,e.eyeWithinExtent=s,e.surfaceElevationBelowRenderLocation=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
