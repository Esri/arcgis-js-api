/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{isSome as e,unwrapOr as r}from"../../../core/maybe.js";import{c as n,d as t,g as o,b as i,a as s,e as a,l as c}from"../../../chunks/vec3.js";import{c as l}from"../../../chunks/vec3f64.js";import{getReferenceEllipsoid as d}from"../../../geometry/projectionEllipsoid.js";import{containsPoint as u}from"../../../geometry/support/aaBoundingRect.js";import{newIntersector as f}from"../webgl-engine/lib/Intersector.js";function p(r,n,t,o){return e(r.renderCoordsHelper.fromRenderCoords(n.eye,j,o))&&u(t,j)}function m(e,n){return e.elevationProvider?r(e.elevationProvider.getElevation(n[0],n[1],n[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function g(e,r,a,c){const l=e.state.camera.clone();r&&(l.eye=r,l.center=a,l.up=c),v(e,l.ray,w)||n(w,l.center);const d=e.state.constraints,u=d.minimumPoiDistance;if(t(l.eye,w)<u){const r=d.collision.enabled;n(H,l.viewForward),o(H,H,u),r?l.eye=i(j,w,H):s(w,l.eye,H);const t=e.renderCoordsHelper,a=t.getAltitude(l.eye),c=d.collision.elevationMargin;r&&a<c&&(i(H,w,l.eye),l.eye=t.setAltitude(j,c,l.eye),s(w,l.eye,H))}return l.center=w,l}function y(e,r,n){if(!e.state.isGlobal)return!1;const o=m(e,r),i=e.stateManager.constraintsManager.nearFarHeuristic,{far:s}=i.compute(r,n,e.renderDataExtent,o,C),a=s*s;return t(r,n)>a}function v(e,r,n){let t=M[e.viewingMode];t||(t=f(e.state.viewingMode),t.options.backfacesTerrain=!e.state.isGlobal,t.options.invisibleTerrain=!0,M[e.viewingMode]=t);const{isGlobal:o}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(r,t,n)||y(e,r.origin,n))||(!(!e.renderCoordsHelper.intersectManifold(r,0,n)||y(e,r.origin,n))||!!o&&b(r,n,d(e.spatialReference).radius))}function b(e,r,n){const t=a(e.origin,e.origin)-n*n,i=t>0?Math.sqrt(t)/3:1;return o(r,e.direction,i/c(e.direction)),s(r,r,e.origin),!0}const M={},j=l(),w=l(),H=l(),C={near:0,far:0};export{g as cameraOnContentAlongViewDirection,p as eyeWithinExtent,m as surfaceElevationBelowRenderLocation};
