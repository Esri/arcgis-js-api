/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/ray","../../../../chunks/sphere","./common","./InteractionType"],(function(e,t,n,r,i,o,c,a){"use strict";function s(e,t,n=c.defaultConstraintOptions){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;y.min=0,y.max=r,f(e,n,y);const i=d(e,t),o=y.max-i;return o>=-1e-6?0:o}function u(e,r,a=c.defaultConstraintOptions){const u=s(e,r,a);if(0===u)return!1;const f=e.pointsOfInterest.surfaceOrigin;if(!f.renderLocation)return!1;const y=d(e,r)+u,I=n.copy(m,r.eye),L=c.interactionDirectionTowardsConstraintMinimization(r,a.interactionDirection,p(r,f.renderLocation,g),l);if(!o.intersectRay(o.fromCenterAndRadius(f.renderLocation,y),i.wrap(r.eye,L),C))return!1;r.eye=C;const T=n.subtract(O,r.eye,I);r.center=n.add(C,r.center,T);const x=e.renderCoordsHelper.getAltitude(r.center),b=e.renderCoordsHelper.intersectInfiniteManifold(r.ray,x,C);return t.isSome(b)&&(r.center=b),!0}function f(e,t,n){const r=t.interactionType;if(r===a.InteractionType.NONE)return;const{min:i,max:o}=n,{interactionStartCamera:u,interactionFactor:f}=t;if(!u)return;const p=r===a.InteractionType.ZOOM||r===a.InteractionType.PAN,y=s(e,u),m=0===y?0:d(e,u);n.min=i,n.max=o;const O=.05*m;c.adjustRangeForInteraction(y,m,p,f,O,n)}function d(e,t){const r=e.pointsOfInterest.surfaceOrigin;return r.renderLocation?n.distance(t.eye,r.renderLocation):0}function p(e,t,r){return n.direction(r,e.eye,t)}const y={min:0,max:0},m=r.create(),O=r.create(),l=r.create(),g=r.create(),C=r.create();e.applyDistanceConstraint=u,e.getDistanceConstraintError=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
