/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../../core/maybe.js";import{i as n,c as r,r as t,b as o,a as i}from"../../../../chunks/vec3.js";import{c as s}from"../../../../chunks/vec3f64.js";import{wrap as c}from"../../../../geometry/support/ray.js";import{h as a,l as f}from"../../../../chunks/sphere.js";import{defaultApplyOptions as m,interactionDirectionTowardsConstraintMinimization as u,InteractionType as p,adjustRangeForInteraction as d}from"./common.js";function y(e,n,r=m){if(!e.state.isLocal)return 0;const t=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||t===1/0)return 0;x.min=0,x.max=t,g(e,r,x);const o=j(e,n),i=x.max-o;return i>=-1e-6?0:i}function O(n,t,s=m){const p=y(n,t,s);if(0===p)return!1;const d=n.pointsOfInterest.surfaceOrigin,O=j(n,t)+p,g=r(h,t.eye),x=u(t,s.interactionDirection,l(n,t,k),L);if(!a(f(d.renderLocation,O),c(t.eye,x),C))return!1;t.eye=C;const N=o(I,t.eye,g);t.center=i(C,t.center,N);const b=n.renderCoordsHelper.getAltitude(t.center),v=n.renderCoordsHelper.intersectInfiniteManifold(t.ray,b,C);return e(v)&&(t.center=v),!0}function g(e,n,r){const t=n.interactionType;if(t===p.NONE)return;const{min:o,max:i}=r,{interactionStartCamera:s,interactionFactor:c}=n,a=t===p.ZOOM||t===p.PAN,f=y(e,s),m=0===f?0:j(e,s);r.min=o,r.max=i;d(f,m,a,c,.05*m,r)}function j(e,r){const t=e.pointsOfInterest.surfaceOrigin;return n(r.eye,t.renderLocation)}function l(e,n,r){const o=e.pointsOfInterest.surfaceOrigin;return t(r,n.eye,o.renderLocation)}const x={min:0,max:0},h=s(),I=s(),L=s(),k=s(),C=s();export{O as applyDistanceConstraint,y as getDistanceConstraintError};
