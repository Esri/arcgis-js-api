/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../core/mathUtils","../../../../chunks/vec3f64","../../../../chunks/vec3","../../support/geometryUtils","./common","../../support/intersectionUtils"],(function(t,e,n,r,i,o,a){"use strict";function s(t,n,r=o.defaultApplyOptions){if(!function(t,e){const n=t.state.constraints.altitude;if(!t.state.isGlobal||!n)return!1;if(2===e.interactionType&&o.hasConstraintType(e.selection,1))return!1;return!0}(t,r))return 0;const i=function(t,e){return e.min=t.min,e.max=t.max,e}(t.state.constraints.altitude,c);!function(t,e,n){const r=e.interactionType;if(0===r)return;const{min:i,max:a}=n,{interactionStartCamera:c,interactionFactor:u}=e,l=2===r||1===r,d=s(t,c),p=0===d?0:t.renderCoordsHelper.getAltitude(c.eye);n.min=i,n.max=a;const m=.05*p;o.adjustRangeForInteraction(d,p,l,u,m,n)}(t,r,i);const a=t.renderCoordsHelper.getAltitude(n.eye),u=e.clamp(a,i.min,i.max)-a;return Math.abs(u)<=1e-6?0:u}const c={min:0,max:0},u=n.create(),l=n.create(),d=n.create();t.applyAltitudeConstraint=function(t,n,c=o.defaultApplyOptions){const p=s(t,n,c);if(0===p)return!1;const m=t.renderCoordsHelper,y=m.getAltitude(n.eye)+p,f=o.interactionDirectionTowardsConstraintMinimization(n,c.interactionDirection,function(t,e,n,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),r.scale(i,i,n),i}(t,n,e.sign(p),l),u),A=r.copy(d,n.viewForward);return m.intersectInfiniteManifold(i.ray.wrap(n.eye,f),y,n.eye)||m.setAltitude(y,n.eye),a.closestPointOnRay(n.eye,A,n.center,n.center),n.markViewDirty(),!0},t.getAltitudeConstraintError=s,Object.defineProperty(t,"__esModule",{value:!0})}));
