/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../core/mathUtils","../../../../core/maybe","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/ray","./common","../../support/intersectionUtils"],(function(t,e,n,r,i,o,a,s){"use strict";function c(t,i,c=a.defaultApplyOptions){const l=u(t,i,c);if(0===l)return!1;const d=t.renderCoordsHelper,m=d.getAltitude(i.eye)+l,y=a.interactionDirectionTowardsConstraintMinimization(i,c.interactionDirection,p(t,i,e.sign(l),A),f),x=r.copy(C,i.viewForward),h=d.intersectInfiniteManifold(o.wrap(i.eye,y),m,g);return i.eye=n.isSome(h)?h:d.setAltitude(g,m,i.eye),i.center=s.closestPointOnRay(g,i.eye,x,i.center),!0}function u(t,n,r=a.defaultApplyOptions){if(!l(t,r))return 0;const i=m(t.state.constraints.altitude,y);d(t,r,i);const o=t.renderCoordsHelper.getAltitude(n.eye),s=e.clamp(o,i.min,i.max)-o;return Math.abs(s)<=1e-6?0:s}function l(t,e){const n=t.state.constraints.altitude;return!(!t.state.isGlobal||!n)&&(2!==e.interactionType||!a.hasConstraintType(e.selection,1))}function d(t,e,n){const r=e.interactionType;if(0===r)return;const{min:i,max:o}=n,{interactionStartCamera:s,interactionFactor:c}=e,l=2===r||1===r,d=u(t,s),p=0===d?0:t.renderCoordsHelper.getAltitude(s.eye);n.min=i,n.max=o;const m=.05*p;a.adjustRangeForInteraction(d,p,l,c,m,n)}function p(t,e,n,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),r.scale(i,i,n),i}function m(t,e){return e.min=t.min,e.max=t.max,e}const y={min:0,max:0},f=i.create(),A=i.create(),C=i.create(),g=i.create();t.applyAltitudeConstraint=c,t.getAltitudeConstraintError=u,Object.defineProperty(t,"__esModule",{value:!0})}));
