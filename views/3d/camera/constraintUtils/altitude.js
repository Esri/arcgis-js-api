/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../core/mathUtils","../../../../core/maybe","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/ray","./common","./ConstraintTypes","./InteractionType","../../support/intersectionUtils"],(function(t,e,n,r,i,o,a,s,c,u){"use strict";function l(t,e,i=a.defaultConstraintOptions){const s=p(t,e,i);if(0===s)return!1;const c=t.renderCoordsHelper,l=c.getAltitude(e.eye)+s,d=a.interactionDirectionTowardsConstraintMinimization(e,i.interactionDirection,m(t,e,Math.sign(s),g),C),y=r.copy(M,e.viewForward),f=c.intersectInfiniteManifold(o.wrap(e.eye,d),l,I);return e.eye=n.isSome(f)?f:c.setAltitude(I,l,e.eye),e.center=u.closestPointOnRay(I,e.eye,y,e.center),!0}function p(t,n,r=a.defaultConstraintOptions){if(!d(t,r))return 0;const i=f(t.state.constraints.altitude,T);y(t,r,i);const o=t.renderCoordsHelper.getAltitude(n.eye),s=e.clamp(o,i.min,i.max)-o;return Math.abs(s)<=1e-6?0:s}function d(t,e){const n=t.state.constraints.altitude;return!(!t.state.isGlobal||!n)&&(e.interactionType!==c.InteractionType.TUMBLE||!a.hasConstraintType(e.selection,s.ConstraintTypes.TILT))}function y(t,e,n){const r=e.interactionType;if(r===c.InteractionType.NONE)return;const{min:i,max:o}=n,{interactionStartCamera:s,interactionFactor:u}=e,l=r===c.InteractionType.TUMBLE||r===c.InteractionType.ZOOM,d=p(t,s),y=0===d?0:t.renderCoordsHelper.getAltitude(s.eye);n.min=i,n.max=o;const m=.05*y;a.adjustRangeForInteraction(d,y,l,u,m,n)}function m(t,e,n,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),r.scale(i,i,n),i}function f(t,e){return e.min=t.min,e.max=t.max,e}const T={min:0,max:0},C=i.create(),g=i.create(),M=i.create(),I=i.create();t.applyAltitudeConstraint=l,t.getAltitudeConstraintError=p,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
