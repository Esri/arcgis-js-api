/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../core/mathUtils","../../../../chunks/vec3f64","../../../../chunks/vec3","../../support/geometryUtils","./common","../../support/intersectionUtils"],(function(t,e,n,r,i,o,a){"use strict";function s(t,n,s=o.defaultApplyOptions){const u=c(t,n,s);if(0===u)return!1;const l=t.renderCoordsHelper,p=l.getAltitude(n.eye)+u,m=o.interactionDirectionTowardsConstraintMinimization(n,s.interactionDirection,d(t,n,e.sign(u),f),y),C=r.copy(A,n.viewForward);return l.intersectInfiniteManifold(i.ray.wrap(n.eye,m),p,n.eye)||l.setAltitude(p,n.eye),a.closestPointOnRay(n.eye,C,n.center,n.center),n.markViewDirty(),!0}function c(t,n,r=o.defaultApplyOptions){if(!u(t,r))return 0;const i=p(t.state.constraints.altitude,m);l(t,r,i);const a=t.renderCoordsHelper.getAltitude(n.eye),s=e.clamp(a,i.min,i.max)-a;return Math.abs(s)<=1e-6?0:s}function u(t,e){const n=t.state.constraints.altitude;return!(!t.state.isGlobal||!n)&&(2!==e.interactionType||!o.hasConstraintType(e.selection,1))}function l(t,e,n){const r=e.interactionType;if(0===r)return;const{min:i,max:a}=n,{interactionStartCamera:s,interactionFactor:u}=e,l=2===r||1===r,d=c(t,s),p=0===d?0:t.renderCoordsHelper.getAltitude(s.eye);n.min=i,n.max=a;const m=.05*p;o.adjustRangeForInteraction(d,p,l,u,m,n)}function d(t,e,n,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),r.scale(i,i,n),i}function p(t,e){return e.min=t.min,e.max=t.max,e}const m={min:0,max:0},y=n.create(),f=n.create(),A=n.create();t.applyAltitudeConstraint=s,t.getAltitudeConstraintError=c,Object.defineProperty(t,"__esModule",{value:!0})}));
