/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/maybe","../../../core/watchUtils","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","./LayerView3D","./graphics/Graphics3DFrustumVisibility","./graphics/Graphics3DGraphicLikeLayerView","./graphics/graphicUtils","./support/projectExtentUtils","../../layers/LayerView"],(function(e,i,t,r,s,a,n,p,c,h,o,u,d,l,y){"use strict";const g=1.2;let f=function(i){function s(){var e;return(e=i.apply(this,arguments)||this).type="graphics-3d",e.frustumVisibility=new o,e.slicePlaneEnabled=!1,e.drapeSourceType=1,e.suspendResumeExtent=null,e.fullExtentInLocalViewSpatialReference=null,e}e._inheritsLoose(s,i);var a=s.prototype;return a.initialize=function(){this._set("graphics3d",new u({owner:this,layer:this.layer,scaleVisibilityEnabled:!0})),this.graphics3d.setup(),this.frustumVisibility.setup(this),this.setupSuspendResumeExtent(),this.updatingHandles.add(this,"fullOpacity",(()=>this.graphics3d.graphicsCore.opacityChange())),this.handles.add(this.layer.on("graphic-update",(e=>this.graphics3d.graphicsCore.graphicUpdateHandler(e)))),this.addResolvingPromise(l.toViewIfLocal(this).then((e=>this.fullExtentInLocalViewSpatialReference=e))),this.layer.internal?this.notifyChange("updating"):this.handles.add(r.whenTrueOnce(this.view,"basemapTerrain.ready",(()=>this.notifyChange("updating"))))},a.destroy=function(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))},a.fetchPopupFeatures=function(){var i=e._asyncToGenerator((function*(e,i){return t.isSome(i)?i.clientGraphics:null}));function r(e,t){return i.apply(this,arguments)}return r}(),a.notifyGraphicGeometryChanged=function(e){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e)},a.notifyGraphicVisibilityChanged=function(e){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e)},a.getGraphicFromGraphicUid=function(e){return this.graphics3d.getGraphicFromGraphicUid(e)},a.whenGraphicBounds=function(e,i){return this.graphics3d.whenGraphicBounds(e,i)},a.computeAttachmentOrigin=function(e,i){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,i):null},a.getSymbolLayerSize=function(e,i){return this.graphics3d.getSymbolLayerSize(e,i)},a.queryGraphics=function(){return Promise.resolve(this.loadedGraphics)},a.maskOccludee=function(e){return this.graphics3d.maskOccludee(e)},a.highlight=function(e){return this.graphics3d.highlight(e)},a.canResume=function(){var e;return i.prototype.canResume.call(this)&&!(null!=(e=this.graphics3d)&&e.suspended)},a.isUpdating=function(){var e,i;return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&(this.layer.internal||null!=(e=this.view)&&null!=(i=e.basemapTerrain)&&i.ready))},a.setupSuspendResumeExtent=function(){const e=()=>{this.suspendResumeExtent=d.enlargeExtent(this.graphics3d.graphicsCore.computedExtent,this.suspendResumeExtent,g,this.graphics3d.graphicsCore.extentPadding),this.frustumVisibility.setExtent(this.suspendResumeExtent)};r.init(this.graphics3d.graphicsCore,"computedExtent",(()=>e()),!0),r.watch(this.graphics3d.graphicsCore,"extentPadding",(()=>e()),!0)},e._createClass(s,[{key:"legendEnabled",get:function(){return this.canResume()&&!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){var e;const i={};return t.isSome(this.graphics3d.scaleVisibility)&&this.graphics3d.scaleVisibility.suspended&&(i.outsideScaleRange=!0),i.outsideOfView=!(null==(e=this.frustumVisibility)||!e.suspended),i}},{key:"graphics3DGraphics",get:function(){return this.graphics3d.graphicsCore.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d.graphicsCore.symbolUpdateType}},{key:"updatePolicy",get:function(){var e;return(null==(e=this.graphics3d)?void 0:e.graphicsCore.effectiveUpdatePolicy)||1}},{key:"performanceInfo",get:function(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}}}]),s}(h.LayerView3D(y));i.__decorate([s.property({aliasOf:"layer.graphics"})],f.prototype,"loadedGraphics",void 0),i.__decorate([s.property({readOnly:!0})],f.prototype,"suspended",void 0),i.__decorate([s.property({readOnly:!0})],f.prototype,"legendEnabled",null),i.__decorate([s.property({readOnly:!0})],f.prototype,"updating",void 0),i.__decorate([s.property()],f.prototype,"layer",void 0),i.__decorate([s.property({readOnly:!0})],f.prototype,"frustumVisibility",void 0),i.__decorate([s.property({readOnly:!0})],f.prototype,"graphics3d",void 0),i.__decorate([s.property({type:Boolean})],f.prototype,"slicePlaneEnabled",void 0),i.__decorate([s.property({readOnly:!0})],f.prototype,"suspendInfo",null),f=i.__decorate([c.subclass("esri.views.3d.layers.GraphicsLayerView3D")],f);return f}));
