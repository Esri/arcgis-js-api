// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.16/esri/copyright.txt for details.

define(["require","exports","tslib","../../../core/maybe","../../../core/promiseUtils","../../../core/watchUtils","../../../core/accessorSupport/decorators","./LayerView3D","./graphics/Graphics3DFrustumVisibility","./graphics/Graphics3DGraphicLikeLayerView","./graphics/graphicUtils","./support/projectExtentUtils","../../layers/LayerView"],(function(e,t,i,r,s,p,a,n,o,u,c,h,d){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.frustumVisibility=new o,t.slicePlaneEnabled=!1,t.drapeSourceType=1,t.suspendResumeExtent=null,t.fullExtentInLocalViewSpatialReference=null,t}return i.__extends(t,e),t.prototype.initialize=function(){var e=this;this._set("graphics3d",new u({owner:this,layer:this.layer,scaleVisibilityEnabled:!0})),this.graphics3d.setup(),this.frustumVisibility.setup(this),this.setupSuspendResumeExtent(),this.updatingHandles.add(this,"fullOpacity",(function(){return e.graphics3d.graphicsCore.opacityChange()})),this.handles.add(this.layer.on("graphic-update",(function(t){return e.graphics3d.graphicsCore.graphicUpdateHandler(t)})));var t=h.toViewIfLocal(this).then((function(t){e.fullExtentInLocalViewSpatialReference=t}));t&&this.addResolvingPromise(t),this.handles.add(p.whenTrueOnce(this.view,"basemapTerrain.ready",(function(){return e.notifyChange("updating")})))},t.prototype.destroy=function(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))},t.prototype.fetchPopupFeatures=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return[2,r.isSome(t)?t.clientGraphics:null]}))}))},t.prototype.notifyGraphicUpdate=function(e,t){this.graphics3d.graphicsCore.notifyGraphicUpdate(e,t)},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d.graphicsCore.graphics3DGraphics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0}),t.prototype.getGraphicFromGraphicUid=function(e){return this.graphics3d.getGraphicFromGraphicUid(e)},t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d.whenGraphicBounds(e,t)},t.prototype.computeAttachmentOrigin=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,t):null},t.prototype.getSymbolLayerSize=function(e,t){return this.graphics3d.getSymbolLayerSize(e,t)},t.prototype.queryGraphics=function(){return s.resolve(this.loadedGraphics)},t.prototype.occlude=function(e){return this.graphics3d.occlude(e)},t.prototype.highlight=function(e){return this.graphics3d.highlight(e)},t.prototype.canResume=function(){return!(!e.prototype.canResume.call(this)||this.frustumVisibility&&this.frustumVisibility.suspended||this.graphics3d&&this.graphics3d.suspended)},t.prototype.isUpdating=function(){return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.ready))},t.prototype.setupSuspendResumeExtent=function(){var e=this;p.init(this.graphics3d.graphicsCore,"computedExtent",(function(t){e.suspendResumeExtent=c.enlargeExtent(t,e.suspendResumeExtent,1.2),e.frustumVisibility.setExtent(e.suspendResumeExtent)}),!0)},Object.defineProperty(t.prototype,"performanceInfo",{get:function(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}},enumerable:!0,configurable:!0}),i.__decorate([a.property({aliasOf:"layer.graphics"})],t.prototype,"loadedGraphics",void 0),i.__decorate([a.property({dependsOn:["frustumVisibility.suspended","graphics3d.suspended"]})],t.prototype,"suspended",void 0),i.__decorate([a.property({dependsOn:["frustumVisibility.updating","graphics3d.updating"]})],t.prototype,"updating",void 0),i.__decorate([a.property()],t.prototype,"layer",void 0),i.__decorate([a.property({readOnly:!0})],t.prototype,"frustumVisibility",void 0),i.__decorate([a.property({readOnly:!0})],t.prototype,"graphics3d",void 0),i.__decorate([a.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),i.__decorate([a.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),t=i.__decorate([a.subclass("esri.views.3d.layers.GraphicsLayerView3D")],t)}(n.LayerView3D(d))}));