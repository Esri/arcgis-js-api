/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/maybe","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/watchUtils","./graphics/graphicUtils","./LayerView3D","../../layers/LayerView","./support/projectExtentUtils","./graphics/Graphics3DFrustumVisibility","./graphics/Graphics3DGraphicLikeLayerView"],(function(e,i,t,s,r,a,n,p,c,h,o,u,d,l,g,y,f,m){"use strict";const b=1.2;let V=function(i){function t(){var e;return(e=i.apply(this,arguments)||this).frustumVisibility=new f,e.slicePlaneEnabled=!1,e.drapeSourceType=1,e.suspendResumeExtent=null,e.fullExtentInLocalViewSpatialReference=null,e}e._inheritsLoose(t,i);var r=t.prototype;return r.initialize=function(){this._set("graphics3d",new m({owner:this,layer:this.layer,scaleVisibilityEnabled:!0})),this.graphics3d.setup(),this.frustumVisibility.setup(this),this.setupSuspendResumeExtent(),this.updatingHandles.add(this,"fullOpacity",(()=>this.graphics3d.graphicsCore.opacityChange())),this.handles.add(this.layer.on("graphic-update",(e=>this.graphics3d.graphicsCore.graphicUpdateHandler(e))));const e=y.toViewIfLocal(this).then((e=>{this.fullExtentInLocalViewSpatialReference=e}));e&&this.addResolvingPromise(e),this.layer.internal?this.notifyChange("updating"):this.handles.add(u.whenTrueOnce(this.view,"basemapTerrain.ready",(()=>this.notifyChange("updating"))))},r.destroy=function(){this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null)),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null))},r.fetchPopupFeatures=async function(e,i){return s.isSome(i)?i.clientGraphics:null},r.notifyGraphicGeometryChanged=function(e){this.graphics3d.graphicsCore.notifyGraphicGeometryChanged(e)},r.notifyGraphicVisibilityChanged=function(e){this.graphics3d.graphicsCore.notifyGraphicVisibilityChanged(e)},r.getGraphicFromGraphicUid=function(e){return this.graphics3d.getGraphicFromGraphicUid(e)},r.whenGraphicBounds=function(e,i){return this.graphics3d.whenGraphicBounds(e,i)},r.computeAttachmentOrigin=function(e,i){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(e,i):null},r.getSymbolLayerSize=function(e,i){return this.graphics3d.getSymbolLayerSize(e,i)},r.queryGraphics=function(){return Promise.resolve(this.loadedGraphics)},r.maskOccludee=function(e){return this.graphics3d.maskOccludee(e)},r.highlight=function(e){return this.graphics3d.highlight(e)},r.canResume=function(){var e;return i.prototype.canResume.call(this)&&!(null!=(e=this.graphics3d)&&e.suspended)},r.isUpdating=function(){var e,i;return!(!(this.graphics3d&&this.graphics3d.updating||this.frustumVisibility&&this.frustumVisibility.updating)&&(this.layer.internal||null!=(e=this.view)&&null!=(i=e.basemapTerrain)&&i.ready))},r.setupSuspendResumeExtent=function(){const e=()=>{this.suspendResumeExtent=d.enlargeExtent(this.graphics3d.graphicsCore.computedExtent,this.suspendResumeExtent,b,this.graphics3d.graphicsCore.extentPadding),this.frustumVisibility.setExtent(this.suspendResumeExtent)};u.init(this.graphics3d.graphicsCore,"computedExtent",(()=>e()),!0),u.watch(this.graphics3d.graphicsCore,"extentPadding",(()=>e()),!0)},e._createClass(t,[{key:"legendEnabled",get:function(){return this.canResume()&&!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){var e;const i={};return s.isSome(this.graphics3d.scaleVisibility)&&this.graphics3d.scaleVisibility.suspended&&(i.outsideScaleRange=!0),i.outsideOfView=!(null==(e=this.frustumVisibility)||!e.suspended),i}},{key:"graphics3DGraphics",get:function(){return this.graphics3d.graphicsCore.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d.graphicsCore.symbolUpdateType}},{key:"performanceInfo",get:function(){return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.frustumVisibility.suspended}}}]),t}(l.LayerView3D(g));return i.__decorate([n.property({aliasOf:"layer.graphics"})],V.prototype,"loadedGraphics",void 0),i.__decorate([n.property({readOnly:!0})],V.prototype,"suspended",void 0),i.__decorate([n.property({readOnly:!0})],V.prototype,"legendEnabled",null),i.__decorate([n.property({readOnly:!0})],V.prototype,"updating",void 0),i.__decorate([n.property()],V.prototype,"layer",void 0),i.__decorate([n.property({readOnly:!0})],V.prototype,"frustumVisibility",void 0),i.__decorate([n.property({readOnly:!0})],V.prototype,"graphics3d",void 0),i.__decorate([n.property({type:Boolean})],V.prototype,"slicePlaneEnabled",void 0),i.__decorate([n.property({readOnly:!0})],V.prototype,"suspendInfo",null),V=i.__decorate([p.subclass("esri.views.3d.layers.GraphicsLayerView3D")],V),V}));
