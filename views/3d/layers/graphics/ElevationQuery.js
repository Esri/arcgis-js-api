/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/arrayUtils","../../../../core/promiseUtils","../../../../geometry/Multipoint","../../../../geometry","../../../support/Scheduler"],(function(e,t,r,i,n,o,s,a){"use strict";let l=function(){function e(e,t){this.spatialReference=e,this.view=t}var t=e.prototype;return t.getElevation=function(e,t,r){return this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)},t.queryElevation=async function(e,t,r,i,n){return this.view.elevationProvider.queryElevation(e,t,0,this.spatialReference,n,r,i)},e}(),u=function(){function e(e,t,r,i){this.spatialReference=t,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...i,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(a.Task.ELEVATION_QUERY,(()=>this._update()),(()=>this._queries.length>0))}var s=e.prototype;return s.destroy=function(){this._frameTask.remove()},s.queryElevation=function(e,t,r,o=0){return new Promise(((s,a)=>{const l={x:e,y:t,minDemResolution:o,result:{resolve:s,reject:a},signal:r};this._queries.push(l),n.onAbort(r,(()=>{i.remove(this._queries,l),a(n.createAbortError())}))}))},s._update=function(){const e=this._queries;this._queries=[];const t=this._getElevationQueryProvider();if(!t)return void e.forEach((e=>e.result.reject()));const i=e.map((e=>[e.x,e.y])),s=e.reduce(((e,t)=>Math.min(e,t.minDemResolution)),1/0),a=new o({points:i,spatialReference:this.spatialReference}),l=e.length>1&&e.some((e=>!!e.signal))?n.createAbortController():null,u=r.isSome(l)?l.signal:e[0].signal;if(r.isSome(l)){let t=0;e.forEach((r=>n.onAbort(r.signal,(()=>{t++,r.result.reject(n.createAbortError()),t===e.length&&l.abort()}))))}const c={...this._queryOptions,minDemResolution:s,signal:u};t.queryElevation(a,c).then((t=>{e.forEach(((e,i)=>{r.isSome(e.signal)&&e.signal.aborted?e.result.reject(n.createAbortError()):e.result.resolve(t.geometry.points[i][2])}))})).catch((t=>{e.forEach((e=>e.result.reject(t)))}))},t._createClass(e,[{key:"test",get:function(){const e=this;return{update:()=>e._queries.length>0&&e._update()}}}]),e}();e.ElevationQuery=u,e.ViewElevationProvider=l,Object.defineProperty(e,"__esModule",{value:!0})}));
