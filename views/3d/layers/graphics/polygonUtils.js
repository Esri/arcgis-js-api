/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../geometry","../../../../core/maybe","../../../../geometry/projection","../../../../geometry/support/triangulationUtils","./elevationAlignmentUtils","../../terrain/OverlayRenderer","../../webgl-engine/lib/Geometry","../../../../geometry/Extent","../../../../geometry/Polygon"],(function(t,e,o,i,n,s,a,r,u,p){"use strict";function c(t){const e=[["position",t.indices]],i=[["position",{size:3,data:t.attributeData.position,exclusive:!0}]];return o.isSome(t.attributeData.color)&&(i.push(["color",{size:4,data:t.attributeData.color,exclusive:!0}]),e.push(["color",new Uint32Array(t.indices.length)])),o.isSome(t.attributeData.uvMapSpace)&&(i.push(["uvMapSpace",{size:4,data:t.attributeData.uvMapSpace,exclusive:!0}]),e.push(["uvMapSpace",t.indices])),o.isSome(t.attributeData.boundingRect)&&(i.push(["boundingRect",{size:9,data:t.attributeData.boundingRect,exclusive:!0}]),e.push(["boundingRect",t.indices])),o.isSome(t.attributeData.mapPosition)&&(i.push(["mapPos",{size:3,data:t.attributeData.mapPosition,exclusive:!0}]),e.push(["mapPos",t.indices])),new r.Geometry(i,e)}function l(t){const e=[["position",t.indices],["uv0",t.indices]],i=[["position",{size:3,data:t.attributeData.position,exclusive:!0}],["uv0",{size:2,data:t.attributeData.uv0,exclusive:!0}]];return o.isSome(t.attributeData.mapPosition)&&(i.push(["mapPos",{size:3,data:t.attributeData.mapPosition,exclusive:!0}]),e.push(["mapPos",t.indices])),new r.Geometry(i,e)}function d(t){switch(t.type){case"extent":if(t instanceof u)return p.fromExtent(t);break;case"polygon":return t}return null}function g(t,e,o,i){const a=n.pathsToTriangulationInfo(t.rings,t.hasZ,1),r=new Float64Array(a.position.length),u=s.applyPerVertexElevationAlignment(a.position,t.spatialReference,0,r,0,a.position,0,a.position.length/3,e,o,i),p=null!=u;return{position:a.position,mapPosition:r,polygons:f(a.polygons,a.position,r),outlines:y(a.outlines,a.position,r),projectionSuccess:p,sampledElevation:u}}function m(t,e){const o=n.pathsToTriangulationInfo(t.rings,!1,1),s=i.projectBuffer(o.position,t.spatialReference,0,o.position,e,0,o.position.length/3);for(let i=2;i<o.position.length;i+=3)o.position[i]=a.DRAPED_Z;return{position:o.position,polygons:f(o.polygons,o.position),outlines:y(o.outlines,o.position),projectionSuccess:s}}function y(t,e,o){const i=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const t=3*n,a=t+3*s;i.push({index:n,count:s,position:e.subarray(t,a),mapPosition:o?o.subarray(t,a):void 0})}return i}function f(t,e,o){const i=new Array;for(const{index:n,count:s,holeIndices:a,pathLengths:r}of t){if(s<=1)continue;const t=3*n,u=t+3*s,p=a.map((t=>t-n));i.push({index:n,count:s,holeIndices:p,pathLengths:r,position:e.subarray(t,u),mapPosition:o?o.subarray(t,u):void 0})}return i}t.createColorGeometry=c,t.createWaterGeometry=l,t.geometryAsPolygon=d,t.geometryToRenderInfo=g,t.geometryToRenderInfoDraped=m,Object.defineProperty(t,"__esModule",{value:!0})}));
