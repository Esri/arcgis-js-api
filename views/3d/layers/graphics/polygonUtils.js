/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../geometry/Extent","../../../../geometry/Polygon","../../../../geometry","../../../../geometry/projection","../../../../geometry/support/triangulationUtils","../../webgl-engine/lib/Util","../../webgl-engine/lib/GeometryData","./elevationAlignmentUtils","../../terrain/OverlayRenderer"],(function(t,e,n,o,i,a,s,r,u,p,c){"use strict";function l(t,e,n){const o=new Array;for(const{index:i,count:a}of t){if(a<=1)continue;const t=3*i,s=t+3*a;o.push({index:i,count:a,position:e.subarray(t,s),mapPosition:n?n.subarray(t,s):void 0})}return o}function d(t,e,n){const o=new Array;for(const{index:i,count:a,holeIndices:s,pathLengths:r}of t){if(a<=1)continue;const t=3*i,u=t+3*a,p=s.map((t=>t-i));o.push({index:i,count:a,holeIndices:p,pathLengths:r,position:e.subarray(t,u),mapPosition:n?n.subarray(t,u):void 0})}return o}t.createColorGeometryData=function(t){const n={},o={};if(o[r.VertexAttrConstants.POSITION]={size:3,data:t.attributeData.position},n[r.VertexAttrConstants.POSITION]=t.indices,e.isSome(t.attributeData.color)){const e=new Uint32Array(t.indices.length);o[r.VertexAttrConstants.COLOR]={size:4,data:t.attributeData.color},n[r.VertexAttrConstants.COLOR]=e}return e.isSome(t.attributeData.uvMapSpace)&&(o[r.VertexAttrConstants.UVMAPSPACE]={size:4,data:t.attributeData.uvMapSpace},n[r.VertexAttrConstants.UVMAPSPACE]=t.indices),e.isSome(t.attributeData.bound1)&&(o[r.VertexAttrConstants.BOUND1]={size:3,data:t.attributeData.bound1},n[r.VertexAttrConstants.BOUND1]=t.indices),e.isSome(t.attributeData.bound2)&&(o[r.VertexAttrConstants.BOUND2]={size:3,data:t.attributeData.bound2},n[r.VertexAttrConstants.BOUND2]=t.indices),e.isSome(t.attributeData.bound3)&&(o[r.VertexAttrConstants.BOUND3]={size:3,data:t.attributeData.bound3},n[r.VertexAttrConstants.BOUND3]=t.indices),e.isSome(t.attributeData.mapPosition)&&(o.mapPos={size:3,data:t.attributeData.mapPosition},n.mapPos=t.indices),new u.GeometryData(o,n)},t.createWaterGeometryData=function(t){const n={},o={};return o[r.VertexAttrConstants.POSITION]={size:3,data:t.attributeData.position},n[r.VertexAttrConstants.POSITION]=t.indices,o[r.VertexAttrConstants.UV0]={size:2,data:t.attributeData.uv0},n[r.VertexAttrConstants.UV0]=t.indices,e.isSome(t.attributeData.mapPosition)&&(o.mapPos={size:3,data:t.attributeData.mapPosition},n.mapPos=t.indices),new u.GeometryData(o,n)},t.geometryAsPolygon=function(t){switch(t.type){case"extent":if(t instanceof n)return o.fromExtent(t);break;case"polygon":return t}return null},t.geometryToRenderInfo=function(t,e,n,o){const i=s.pathsToTriangulationInfo(t.rings,t.hasZ,1),a=new Float64Array(i.position.length),r=p.applyPerVertexElevationAlignment(i.position,t.spatialReference,0,a,0,i.position,0,i.position.length/3,e,n,o),u=null!=r;return{position:i.position,mapPosition:a,polygons:d(i.polygons,i.position,a),outlines:l(i.outlines,i.position,a),projectionSuccess:u,sampledElevation:r}},t.geometryToRenderInfoDraped=function(t,e){const n=s.pathsToTriangulationInfo(t.rings,!1,1),o=a.projectBuffer(n.position,t.spatialReference,0,n.position,e,0,n.position.length/3);for(let t=2;t<n.position.length;t+=3)n.position[t]=c.DRAPED_Z;return{position:n.position,polygons:d(n.polygons,n.position),outlines:l(n.outlines,n.position),projectionSuccess:o}},Object.defineProperty(t,"__esModule",{value:!0})}));
