/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import"../../../../geometry.js";import{isSome as t}from"../../../../core/maybe.js";import{projectBuffer as i}from"../../../../geometry/projection.js";import{pathsToTriangulationInfo as o,CounterClockwiseMode as e}from"../../../../geometry/support/triangulationUtils.js";import{applyPerVertexElevationAlignment as n}from"./elevationAlignmentUtils.js";import{DRAPED_Z as s}from"../../terrain/OverlayRenderer.js";import{Geometry as a}from"../../webgl-engine/lib/Geometry.js";import{VertexAttribute as r}from"../../webgl-engine/lib/VertexAttribute.js";import u from"../../../../geometry/Extent.js";import p from"../../../../geometry/Polygon.js";function c(i){const o=[[r.POSITION,i.indices]],e=[[r.POSITION,{size:3,data:i.attributeData.position,exclusive:!0}]];return t(i.attributeData.color)&&(e.push([r.COLOR,{size:4,data:i.attributeData.color,exclusive:!0}]),o.push([r.COLOR,new Uint32Array(i.indices.length)])),t(i.attributeData.uvMapSpace)&&(e.push([r.UVMAPSPACE,{size:4,data:i.attributeData.uvMapSpace,exclusive:!0}]),o.push([r.UVMAPSPACE,i.indices])),t(i.attributeData.boundingRect)&&(e.push([r.BOUNDINGRECT,{size:9,data:i.attributeData.boundingRect,exclusive:!0}]),o.push([r.BOUNDINGRECT,i.indices])),t(i.attributeData.mapPosition)&&(e.push([r.MAPPOS,{size:3,data:i.attributeData.mapPosition,exclusive:!0}]),o.push([r.MAPPOS,i.indices])),new a(e,o)}function l(i){const o=[[r.POSITION,i.indices],[r.UV0,i.indices]],e=[[r.POSITION,{size:3,data:i.attributeData.position,exclusive:!0}],[r.UV0,{size:2,data:i.attributeData.uv0,exclusive:!0}]];return t(i.attributeData.mapPosition)&&(e.push([r.MAPPOS,{size:3,data:i.attributeData.mapPosition,exclusive:!0}]),o.push([r.MAPPOS,i.indices])),new a(e,o)}function m(t){switch(t.type){case"extent":if(t instanceof u)return p.fromExtent(t);break;case"polygon":return t}return null}function d(t,i,s,a){const r=o(t.rings,t.hasZ,e.CCW_IS_HOLE),u=new Float64Array(r.position.length),p=n(r.position,t.spatialReference,0,u,0,r.position,0,r.position.length/3,i,s,a),c=null!=p;return{position:r.position,mapPosition:u,polygons:b(r.polygons,r.position,u),outlines:g(r.outlines,r.position,u),projectionSuccess:c,sampledElevation:p}}function f(t,n){const a=o(t.rings,!1,e.CCW_IS_HOLE),r=i(a.position,t.spatialReference,0,a.position,n,0,a.position.length/3);for(let i=2;i<a.position.length;i+=3)a.position[i]=s;return{position:a.position,polygons:b(a.polygons,a.position),outlines:g(a.outlines,a.position),projectionSuccess:r}}function g(t,i,o){const e=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const t=3*n,a=t+3*s;e.push({index:n,count:s,position:i.subarray(t,a),mapPosition:o?o.subarray(t,a):void 0})}return e}function b(t,i,o){const e=new Array;for(const{index:n,count:s,holeIndices:a,pathLengths:r}of t){if(s<=1)continue;const t=3*n,u=t+3*s,p=a.map((t=>t-n));e.push({index:n,count:s,holeIndices:p,pathLengths:r,position:i.subarray(t,u),mapPosition:o?o.subarray(t,u):void 0})}return e}export{c as createColorGeometry,l as createWaterGeometry,m as geometryAsPolygon,d as geometryToRenderInfo,f as geometryToRenderInfoDraped};
