/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../geometry/Extent","../../../../geometry/Polygon","../../../../geometry","../../../../geometry/projection","../../../../geometry/support/triangulationUtils","../../webgl-engine/lib/Geometry","./elevationAlignmentUtils","../../terrain/OverlayRenderer"],(function(t,e,o,i,n,s,a,r,u,p){"use strict";function c(t){const o=[["position",t.indices]],i=[["position",{size:3,data:t.attributeData.position,exclusive:!0}]];return e.isSome(t.attributeData.color)&&(i.push(["color",{size:4,data:t.attributeData.color,exclusive:!0}]),o.push(["color",new Uint32Array(t.indices.length)])),e.isSome(t.attributeData.uvMapSpace)&&(i.push(["uvMapSpace",{size:4,data:t.attributeData.uvMapSpace,exclusive:!0}]),o.push(["uvMapSpace",t.indices])),e.isSome(t.attributeData.boundingRect)&&(i.push(["boundingRect",{size:9,data:t.attributeData.boundingRect,exclusive:!0}]),o.push(["boundingRect",t.indices])),e.isSome(t.attributeData.mapPosition)&&(i.push(["mapPos",{size:3,data:t.attributeData.mapPosition,exclusive:!0}]),o.push(["mapPos",t.indices])),new r.Geometry(i,o)}function l(t){const o=[["position",t.indices],["uv0",t.indices]],i=[["position",{size:3,data:t.attributeData.position,exclusive:!0}],["uv0",{size:2,data:t.attributeData.uv0,exclusive:!0}]];return e.isSome(t.attributeData.mapPosition)&&(i.push(["mapPos",{size:3,data:t.attributeData.mapPosition,exclusive:!0}]),o.push(["mapPos",t.indices])),new r.Geometry(i,o)}function d(t){switch(t.type){case"extent":if(t instanceof o)return i.fromExtent(t);break;case"polygon":return t}return null}function g(t,e,o,i){const n=a.pathsToTriangulationInfo(t.rings,t.hasZ,1),s=new Float64Array(n.position.length),r=u.applyPerVertexElevationAlignment(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,o,i),p=null!=r;return{position:n.position,mapPosition:s,polygons:f(n.polygons,n.position,s),outlines:y(n.outlines,n.position,s),projectionSuccess:p,sampledElevation:r}}function m(t,e){const o=a.pathsToTriangulationInfo(t.rings,!1,1),i=s.projectBuffer(o.position,t.spatialReference,0,o.position,e,0,o.position.length/3);for(let n=2;n<o.position.length;n+=3)o.position[n]=p.DRAPED_Z;return{position:o.position,polygons:f(o.polygons,o.position),outlines:y(o.outlines,o.position),projectionSuccess:i}}function y(t,e,o){const i=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const t=3*n,a=t+3*s;i.push({index:n,count:s,position:e.subarray(t,a),mapPosition:o?o.subarray(t,a):void 0})}return i}function f(t,e,o){const i=new Array;for(const{index:n,count:s,holeIndices:a,pathLengths:r}of t){if(s<=1)continue;const t=3*n,u=t+3*s,p=a.map((t=>t-n));i.push({index:n,count:s,holeIndices:p,pathLengths:r,position:e.subarray(t,u),mapPosition:o?o.subarray(t,u):void 0})}return i}t.createColorGeometry=c,t.createWaterGeometry=l,t.geometryAsPolygon=d,t.geometryToRenderInfo=g,t.geometryToRenderInfoDraped=m,Object.defineProperty(t,"__esModule",{value:!0})}));
