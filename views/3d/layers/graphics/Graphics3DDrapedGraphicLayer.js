/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/aaBoundingRect","./graphicUtils","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/ModelDirtyTypes"],(function(e,t,r,i,n,o,s,a,d){"use strict";let h=function(){function o(e,t,r){this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this._graphicsCoreOwner=null,this.isElevationSource=!1}var h=o.prototype;return h.initialize=function(e,t,r){this.stage=e,this._graphicsCoreOwner=r,this._overlayRenderer=this._graphicsCoreOwner.view.basemapTerrain.overlayManager.renderer},h.setVisibility=function(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._overlayRenderer.addGeometries(this.renderGeometries,this._graphicsCoreOwner,d.ModelDirty.Geometry.ADD);if(e||this._addedToStage){for(const e of this.renderGeometries)e.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._graphicsCoreOwner,d.ModelDirty.State.VISIBILITIES)}}},h.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._graphicsCoreOwner,d.ModelDirty.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null},h.getCenterObjectSpace=function(e=i.create()){return r.set(e,0,0,0)},h.getBoundingBoxObjectSpace=function(e=n.create()){return n.empty(e)},h.addObjectState=function(e,t){e===a.Object3DState.Highlight&&(this.renderGeometries.forEach((e=>{const r=e.addHighlight();t.addRenderGeometry(e,r,this)})),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner))},h.removeObjectState=function(e){this.renderGeometries.forEach((t=>{e.removeRenderGeometry(t)}))},h.removeRenderGeometryObjectState=function(e,t){e.removeHighlight(t),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._graphicsCoreOwner)},h.computeAttachmentOrigin=function(e){for(const t of this.renderGeometries)t.computeAttachmentOrigin(u)&&(e.draped.origin[0]+=u[0],e.draped.origin[1]+=u[1],e.draped.num++)},h.getProjectedBoundingBox=function(){var r=e._asyncToGenerator((function*(e,r,i,o,a){n.empty(a);for(let t=0;t<this.renderGeometries.length;t++){const r=this.renderGeometries[t];this._getRenderGeometryProjectedBoundingRect(r,e,c,i),n.expandWithRect(a,c)}if(r){let e;n.center(a,u);const i=s.demResolutionForBoundingBox(a,r);try{e=yield r.service.queryElevation(u[0],u[1],o,i,"ground")}catch(d){}t.isSome(e)&&(a[2]=Math.min(a[2],e),a[5]=Math.max(a[5],e))}return a}));function i(e,t,i,n,o){return r.apply(this,arguments)}return i}(),h._getRenderGeometryProjectedBoundingRect=function(e,t,r,i){if(this.boundingBox)n.set(g,this.boundingBox);else{const t=e.boundingSphere,r=t[3];g[0]=t[0]-r,g[1]=t[1]-r,g[2]=t[2]-r,g[3]=t[0]+r,g[4]=t[1]+r,g[5]=t[2]+r}return t(g,0,2),this.calculateRelativeScreenBounds&&i.push({location:n.center(g),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),n.toRect(g,r)},o}();const c=o.create(),g=n.create(),u=i.create();return h}));
