/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils","../../glTF/DefaultLoadingContext","../../glTF/loader","./wosrLoader"],(function(e,t,o,r,n,s,a){"use strict";let i=function(){function e(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",(()=>{})),this._wosrMemCache=e("wosr-resources",(()=>{}))}var i=e.prototype;return i.destroy=function(){this._gltfLoading.forEach((e=>e.abortController.abort())),this._wosrLoading.forEach((e=>e.abortController.abort())),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()},i.loadGLTF=function(e,t,r){const a=r?`gltfPBR:${e}`:`gltf:${e}`,i=this._gltfMemCache.get(a);return o.isSome(i)?Promise.resolve(i):this._loadOnce(this._gltfLoading,this._gltfMemCache,a,(t=>s.loadGLTF(new n.DefaultLoadingContext(t.streamDataRequester),e,t,r)),t)},i.loadWOSR=function(e,t){const r=`wosr:${e}:${t.disableTextures}`,n=this._wosrMemCache.get(r);return o.isSome(n)?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,(t=>a.load(e,t)),t)},i._loadOnce=function(){var e=t._asyncToGenerator((function*(e,t,n,s,a){r.throwIfAborted(a);const i=r.onAbort(a,(()=>this._abortLoad(e,n)));let l=e.get(n);if(l)l.refCount++;else{const t=new AbortController;l={refCount:1,abortController:t,promise:s({...a,signal:t.signal})},e.set(n,l)}try{const s=yield l.promise;return t.put(n,s,s.size),e.delete(n),r.throwIfAborted(a),s}finally{o.removeMaybe(i)}}));function n(t,o,r,n,s){return e.apply(this,arguments)}return n}(),i._abortLoad=function(e,t){const r=e.get(t);if(o.isSome(r)){if(--r.refCount>0)return}e.delete(t),o.isSome(r)&&r.abortController.abort()},e}();e.ObjectResourceCache=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
