/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils","../../glTF/DefaultLoadingContext","../../glTF/loader","./wosrLoader"],(function(e,t,o,r,s,n,a){"use strict";let i=function(){function e(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",(()=>{})),this._wosrMemCache=e("wosr-resources",(()=>{}))}var i=e.prototype;return i.destroy=function(){this._gltfLoading.forEach((e=>e.abortController.abort())),this._wosrLoading.forEach((e=>e.abortController.abort())),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()},i.loadGLTF=function(e,t,r){const a=r?`gltfPBR:${e}`:`gltf:${e}`,i=this._gltfMemCache.get(a);return o.isSome(i)?Promise.resolve(i):this._loadOnce(this._gltfLoading,this._gltfMemCache,a,(t=>n.loadGLTF(new s.DefaultLoadingContext(t.streamDataRequester),e,t,r)),t)},i.loadWOSR=function(e,t){const r=`wosr:${e}:${t.disableTextures}`,s=this._wosrMemCache.get(r);return o.isSome(s)?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,(t=>a.load(e,t)),t)},i._loadOnce=function(){var e=t._asyncToGenerator((function*(e,t,s,n,a){r.throwIfAborted(a);const i=r.onAbort(a,(()=>this._abortLoad(e,s)));let l=e.get(s);if(l)l.refCount++;else{const t=new AbortController;l={refCount:1,abortController:t,promise:n({...a,signal:t.signal})},e.set(s,l)}try{const n=yield l.promise;return t.put(s,n,n.size),e.delete(s),r.throwIfAborted(a),n}finally{o.removeMaybe(i)}}));function s(t,o,r,s,n){return e.apply(this,arguments)}return s}(),i._abortLoad=function(e,t){const r=e.get(t);if(o.isSome(r)){if(--r.refCount>0)return}e.delete(t),o.isSome(r)&&r.abortController.abort()},e}();e.ObjectResourceCache=i,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
