/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],(function(t,e,n,r,o){"use strict";const i=.05;let s=function(){function t(){this._extents=new n({allocator:t=>t||r.create()}),this._tmpExtent=r.create(),this._dirty=!1}var s=t.prototype;return s.clear=function(){this._extents.clear()},s.add=function(t){this._contains(t)||(this._removeContained(t),r.copy(this._extents.pushNew(),t),this._dirty=!0)},s.pop=function(){return this._dirty&&this._mergeTight(),this._extents.pop()},s.merge=function(t){return this._mergeTight(t),t.hasProgressed},s._mergeTight=function(t=o.noBudget){const e=this._extents,n=new Set;let s=0;for(;s!==e.length;){e.sort(((t,e)=>t[0]-e[0])),s=e.length,n.clear();for(let o=0;o<e.length;++o){if(t.done)return;const s=e.getItemAt(o);if(s){for(let t=o+1;t<e.length;++t){const r=e.getItemAt(t);if(null==r||r[0]>=s[2])break;n.add(r)}n.forEach((o=>{if(s===o)return;if(o[2]<=s[0])return void n.delete(o);const c=r.area(s),a=r.area(o),u=this._tmpExtent;r.expand(s,o,u);const h=c+a;(r.area(u)-h)/h<i&&(r.copy(s,u),n.delete(o),e.remove(o),t.madeProgress())})),n.add(s)}}}this._dirty=!1},s._contains=function(t){return this._extents.some((e=>r.contains(e,t)))},s._removeContained=function(t){this._extents.filterInPlace((e=>!r.contains(t,e)))},e._createClass(t,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"test",get:function(){const t=this;return{containsPoint:e=>t._extents.some((t=>r.containsPoint(t,e)))}}}]),t}();t.ExtentSet=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
