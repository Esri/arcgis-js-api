/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../core/promiseUtils","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],(function(e,t,r,n,c,o){"use strict";const u=r.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function a(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function s(e){const t=e&&e.expression;if("string"==typeof t){const e=g(t);if(null!=e)return{cachedResult:e}}return null}function l(e,t,r,n){return i.apply(this,arguments)}function i(){return i=t._asyncToGenerator((function*(e,t,r,c){const u=e&&e.expression;if("string"!=typeof u)return null;const a=g(u);if(null!=a)return{cachedResult:a};const s=yield o.loadArcade();n.throwIfAborted(r);const l=s.arcadeUtils,i=l.createSyntaxTree(u);return l.dependsOnView(i)?(null!=c&&c.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:l.createFunction(i),context:l.createExecContext(null,{sr:t}),modules:s}}})),i.apply(this,arguments)}function d(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function f(e,t){if(null!=e&&!h(e)){if(!t||!e.arcade)return void u.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=c.hydrateGeometry(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function p(e){if(null!=e){if(h(e))return e.cachedResult;const t=e.arcade;let r=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function x(e,t=!1){let r=e&&e.featureExpressionInfo;const n=r&&r.expression;return t||"0"===n||(r=null),r??null}const y={cachedResult:0};function h(e){return null!=e.cachedResult}function g(e){return"0"===e?0:null}e.clone=a,e.createContext=l,e.createContextWithoutExpressionSupport=s,e.createFeature=d,e.execute=p,e.extractExpressionInfo=x,e.setContextFeature=f,e.zeroContext=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
