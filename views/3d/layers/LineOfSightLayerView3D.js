/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/asyncUtils","../../../core/Error","../../../core/maybe","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","./LayerView3D","../../layers/LayerView"],(function(e,s,i,a,t,n,r,o,l,y,c,u){"use strict";const h=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),w="analysis-view-handles";let d=function(i){function l(e){var s;return(s=i.call(this,e)||this).type="line-of-sight-3d",s._analysisModule=null,s}s._inheritsLoose(l,i);var y=l.prototype;return y.initialize=function(){this.handles.add(o.watch((()=>this.layer.analysis),(e=>{this._destroyAnalysisView(),n.isSome(e)&&this._createAnalysisView(e)}),o.syncAndInitial),w)},y.destroy=function(){this.handles.remove(w),this._destroyAnalysisView()},y.whenAnalysisView=function(){var e=s._asyncToGenerator((function*(){if(n.isSome(this.analysisView))return this.analysisView;if(n.isSome(this._createAnalysisViewTask))return this._createAnalysisViewTask.promise;throw new t("layerview:no-analysisview-for-analysis","The analysis has not been set on the LineOfSightLayer of this layer view")}));function i(){return e.apply(this,arguments)}return i}(),y.isUpdating=function(){return n.isSome(this._createAnalysisViewTask)||n.isSome(this.analysisView)&&this.analysisView.updating},y._createAnalysisView=function(e){var i=this;const t=a.createTask(function(){var a=s._asyncToGenerator((function*(s){return i.analysisView=yield i._createAnalysisViewPromise(e,s),i._createAnalysisViewTask===t&&(i._createAnalysisViewTask=null),i.analysisView}));return function(e){return a.apply(this,arguments)}}());this._createAnalysisViewTask=t},y._destroyAnalysisView=function(){this.analysisView=n.destroyMaybe(this.analysisView),this._createAnalysisViewTask=n.abortMaybe(this._createAnalysisViewTask)},y._createAnalysisViewPromise=function(){var e=s._asyncToGenerator((function*(e,s){let i=this._analysisModule;if(n.isNone(i)){const e=yield this._loadAnalysisModule();this._analysisModule=e,i=e}const a=new i.default({analysis:e,view:this.view,parent:this});if(yield a.when(),r.isAborted(s))throw a.destroy(),new t("layerview:no-analysisview-for-analysis","The analysis has not been added to the LineOfSightLayer of this layer view",{analysis:e});return a}));function i(s,i){return e.apply(this,arguments)}return i}(),y._loadAnalysisModule=function(){return new Promise(((s,i)=>e(["../analysis/LineOfSightAnalysisView3D"],(e=>s(h(e))),i)))},l}(c.LayerView3D(u));i.__decorate([l.property()],d.prototype,"type",void 0),i.__decorate([l.property()],d.prototype,"layer",void 0),i.__decorate([l.property()],d.prototype,"analysisView",void 0),i.__decorate([l.property()],d.prototype,"_createAnalysisViewTask",void 0),d=i.__decorate([y.subclass("esri.views.3d.layers.LineOfSightLayerView3D")],d);return d}));
