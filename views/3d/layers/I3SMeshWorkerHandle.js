/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Logger","../../../core/PooledArray","../../../geometry/projection","../support/WorkerHandle"],(function(e,t,o,n,r,s){"use strict";const i=o.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");let c=function(e){function o(t){return e.call(this,"SceneLayerWorker","process",t,{hasInitialize:!0})||this}t._inheritsLoose(o,e);var n=o.prototype;return n.getTransferList=function(e){return[e.geometryBuffer]},n.setModifications=function(e,t,o){const n={context:e,modifications:f(t,o),isGeodetic:o.isGeographic};this.broadcast(n,"setModifications")},n.setLegacySchema=function(e,t){const o=JSON.stringify(t);this.broadcast({context:e,jsonSchema:o},"setLegacySchema")},n.destroyContext=function(e){return this.broadcast(e,"destroyContext")},o}(s.WorkerHandle);const a=new n({deallocator:null}),l=[0,0,0];function f(e,t){a.clear();for(const o of e){const e="clip"===o.type?2:"mask"===o.type?1:0,n=o.geometry;let s=e=>e;if(n.spatialReference){if(!r.canProjectWithoutEngine(n.spatialReference,t)){i.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}s=e=>(r.projectVectorToVector(e,n.spatialReference,l,t),l)}else n.hasZ||(l[2]=0,s=e=>(l[0]=e[0],l[1]=e[1],l));a.push(e),a.push(n.rings.length);for(const e of n.rings){a.push(e.length);for(const t of e){const e=s(t);a.push(e[0]),a.push(e[1]),a.push(e[2])}}}a.push(3);const o=new Float64Array(a.length);for(let e=0;e<a.length;++e)o[e]=a.getItemAt(e);return o}e.I3SMeshWorkerHandle=c,e.toWasmModification=f,Object.defineProperty(e,"__esModule",{value:!0})}));
