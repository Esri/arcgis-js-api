/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Logger","../../../core/PooledArray","../../../geometry/projection","../../../core/workers/WorkerHandle"],(function(e,t,o,n,r,s){"use strict";const i=o.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");let c=function(e){function o(t){return e.call(this,"SceneLayerWorker","process",t,{hasInitialize:!0})||this}t._inheritsLoose(o,e);var n=o.prototype;return n.getTransferList=function(e){return[e.geometryBuffer]},n.setModifications=function(e,t,o){const n={context:e,modifications:f(t,o),isGeodetic:o.isGeographic};this.broadcast(n,"setModifications")},n.setLegacySchema=function(e,t){const o=JSON.stringify(t);this.broadcast({context:e,jsonSchema:o},"setLegacySchema")},n.destroyContext=function(e){return this.broadcast(e,"destroyContext")},o}(s.WorkerHandle);const a=new n({deallocator:null}),l=[0,0,0];function f(e,t){a.clear();for(const n of e){const e="clip"===n.type?2:"mask"===n.type?1:0,o=n.geometry;let s=e=>e;if(o.spatialReference){if(!r.canProjectWithoutEngine(o.spatialReference,t)){i.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}s=e=>(r.projectVectorToVector(e,o.spatialReference,l,t),l)}else o.hasZ||(l[2]=0,s=e=>(l[0]=e[0],l[1]=e[1],l));a.push(e),a.push(o.rings.length);for(const t of o.rings){a.push(t.length);for(const e of t){const t=s(e);a.push(t[0]),a.push(t[1]),a.push(t[2])}}}a.push(3);const o=new Float64Array(a.length);for(let n=0;n<a.length;++n)o[n]=a.getItemAt(n);return o}e.I3SMeshWorkerHandle=c,e.toWasmModification=f,Object.defineProperty(e,"__esModule",{value:!0})}));
