/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Logger","../../../core/maybe","../../../core/PooledArray","../../../core/workers/WorkerHandle","../../../geometry/projection"],(function(e,s,t,o,n,r,h){"use strict";const u=t.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");let i=function(e){function t(s){return e.call(this,"SceneLayerWorker","process",s,{hasInitialize:!0})||this}s._inheritsLoose(t,e);var o=t.prototype;return o.getTransferList=function(e){return[e.geometryBuffer]},o.setModifications=function(e,s,t,o){const n={context:e,modifications:a(s,t,o),isGeodetic:o.isGeographic};this.broadcast(n,"setModifications")},o.setLegacySchema=function(e,s){const t=JSON.stringify(s);this.broadcast({context:e,jsonSchema:t},"setLegacySchema")},o.destroyContext=function(e){return this.broadcast(e,"destroyContext")},t}(r.WorkerHandle);const p=new n({deallocator:null}),c=[0,0,0];function a(e,s,t){p.clear();let n=1/0,r=1/0,i=-1/0,a=-1/0,l=!1;for(const o of s){const e="clip"===o.type?2:"mask"===o.type?1:0,s=o.geometry;let f=e=>e;if(s.spatialReference){if(!h.canProjectWithoutEngine(s.spatialReference,t)){u.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}f=e=>(h.projectVectorToVector(e,s.spatialReference,c,t),c)}else s.hasZ||(c[2]=0,f=e=>(c[0]=e[0],c[1]=e[1],c));l=l||1===e,p.push(e),p.push(s.rings.length);for(const t of s.rings){p.push(t.length);for(const e of t){const s=f(e);p.push(s[0]),p.push(s[1]),p.push(s[2]),n=Math.min(n,s[0]),r=Math.min(r,s[1]),i=Math.max(i,s[0]),a=Math.max(a,s[1])}}}if(o.isSome(e))if(l){const s=1e-4;p.push(2),p.push(2),p.push(4),p.push(n-s),p.push(r-s),p.push(0),p.push(i+s),p.push(r-s),p.push(0),p.push(i+s),p.push(a+s),p.push(0),p.push(n-s),p.push(a+s),p.push(0),p.push(4),p.push(e[0]),p.push(e[1]),p.push(0),p.push(e[2]),p.push(e[1]),p.push(0),p.push(e[2]),p.push(e[3]),p.push(0),p.push(e[0]),p.push(e[3]),p.push(0)}else p.push(1),p.push(1),p.push(4),p.push(e[0]),p.push(e[1]),p.push(0),p.push(e[2]),p.push(e[1]),p.push(0),p.push(e[2]),p.push(e[3]),p.push(0),p.push(e[0]),p.push(e[3]),p.push(0);p.push(3);const f=new Float64Array(p.length);for(let o=0;o<p.length;++o)f[o]=p.getItemAt(o);return f}e.I3SMeshWorkerHandle=i,e.toWasmModification=a,Object.defineProperty(e,"__esModule",{value:!0})}));
