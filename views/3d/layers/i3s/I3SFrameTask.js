/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/arrayUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/subclass","../../../support/Scheduler"],(function(e,t,r,n,s,o,i,a,c){"use strict";let l=function(e){function r(){var t;return(t=e.call(this)||this).referenceCount=0,t.callbacks=new Array,t.runIndex=0,t}t._inheritsLoose(r,e);var n=r.prototype;return n.runTask=function(e){this._sort();const t=this.callbacks,r={numIndexLoading:0,numNodesLoading:0};for(let n=0;n<t.length&&!e.done;++n)t[n].priority=t[n].runTask(e,r),this.runIndex=n},n._sort=function(){const e=this.callbacks;let t=e.length;for(let r=this.runIndex;r>0;r--){const n=e[r-1];let s=r;for(;s<e.length&&n.priority<=e[s].priority&&(s!==t||n.priority<e[s].priority);)e[s-1]=e[s],s++;e[s-1]=n,t=s-1}this.runIndex=0},n.add=function(e){this._sort(),e.priority=1/0,this.callbacks.unshift(e),this.notifyChange("running")},n.remove=function(e){s.removeUnordered(this.callbacks,e),this.runIndex=this.callbacks.length,this._sort(),this.notifyChange("running")},t._createClass(r,[{key:"running",get:function(){return this.callbacks.some((e=>e.running))}}]),r}(n);r.__decorate([o.property({readOnly:!0})],l.prototype,"running",null),l=r.__decorate([a.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],l);let u=function(e,t){this.task=e,this.handle=t};const h=new Map;function d(e,t){let r=h.get(e);if(null==r){const t=new l,n=e.registerTask(c.TaskPriority.I3S_CONTROLLER,t);r=new u(t,n),h.set(e,r)}return r.task.add(t),{remove:()=>{if(null==r)return;r.task.remove(t);r.task.callbacks.length>0||(h.delete(e),r.handle.remove(),r.task.destroy()),r=null}}}e.addCallback=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
