/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/arrayUtils","../../../../core/maybe","../../../support/Scheduler"],(function(e,t,n,r,s){"use strict";let i=function(){function e(e){this.referenceCount=0,this.callbacks=[],this.runIndex=0,this.handle=e.registerTask(s.TaskPriority.I3S_CONTROLLER,this)}var i=e.prototype;return i.destroy=function(){this.handle=r.removeMaybe(this.handle)},i.runTask=function(e){this._sort();const t=this.callbacks,n={numIndexLoading:0,numNodesLoading:0};for(let r=0;r<t.length&&!e.done;++r)t[r].priority=t[r].update(e,n),this.runIndex=r},i._sort=function(){const e=this.callbacks;let t=e.length;for(let n=this.runIndex;n>0;n--){const r=e[n-1];let s=n;for(;s<e.length&&r.priority<=e[s].priority&&(s!==t||r.priority<e[s].priority);)e[s-1]=e[s],s++;e[s-1]=r,t=s-1}this.runIndex=0},i.add=function(e){this._sort(),e.priority=1/0,this.callbacks.unshift(e)},i.remove=function(e){n.removeUnordered(this.callbacks,e),this.runIndex=this.callbacks.length,this._sort()},t._createClass(e,[{key:"running",get:function(){for(const e of this.callbacks)if(e.needsUpdate())return!0;return!1}}]),e}();const o=new Map;function l(e,t){let n=o.get(e);return null==n&&(n=new i(e),o.set(e,n)),n.add(t),{remove:()=>{if(null==n)return;n.remove(t);n.callbacks.length>0||(o.delete(e),n.destroy()),n=null}}}e.addTask=l,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
