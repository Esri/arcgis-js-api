/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../support/orientedBoundingBox","../../webgl-engine/lib/Intersector","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/verticalOffsetUtils"],(function(e,t,i,n,r,s){"use strict";let o=function(){function e(e){this.type=r.IntersectorType.I3S,this.layerUid=e.layerUid,this.sublayerUid=e.sublayerUid,this.collection=e.collection,this.traverseNodeHierarchy=e.traverseNodeHierarchy,this.slicePlaneEnabled=e.slicePlaneEnabled,this.isGround=e.isGround}return e.prototype.intersect=function(e,o,c,d){const a=e.results,u=e.options.store===r.StoreResults.ALL,b=e.ray.direction,y=e.tolerance;let f=e=>e,h=e=>e;const p=s.getVerticalOffsetI3S(e.verticalOffset);t.isSome(p)&&(f=e=>p.applyToMbs(e),h=e=>p.applyToObb(e)),this.traverseNodeHierarchy(((r,s)=>!(t.isSome(r.serviceObbInRenderSR)&&!i.intersectLine(h(r.serviceObbInRenderSR),c,b,y))&&(!s||t.isSome(r.geometryObb)&&!i.intersectLine(h(r.geometryObb),c,b,y)||!t.isSome(r.serviceObbInRenderSR)&&!l(f(r.renderMbs),c,b,y)||this.collection.intersect(s,c,d,y,p,((t,i,s,l)=>{if(i>=0){if(null!=o&&!o(c,d,i))return;const b=e=>{const n={layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:r.index,componentIndex:t,triangleNr:l};e.set(this.type,n,i,s)};if(this.isGround&&(null==a.ground.dist||i<a.ground.dist)&&b(a.ground),e.options.isFiltered)return;if((null==a.min.dist||i<a.min.dist)&&b(a.min),(null==a.max.dist||i>a.max.dist)&&b(a.max),u){const t=n.newIntersectorResult(e.ray);b(t),e.results.all.push(t)}}})),!0)))},e}();function l(e,t,i,n=0){const r=e[3]+n,s=t[0]-e[0],o=t[1]-e[1],l=t[2]-e[2],c=i[0],d=i[1],a=i[2],u=c*s+d*o+a*l;return u*u-(c*c+d*d+a*a)*(s*s+o*o+l*l-r*r)>=0}e.I3SIntersectionHandler=o,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
