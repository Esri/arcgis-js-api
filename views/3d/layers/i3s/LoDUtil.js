/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/vec3"],(function(e,t){"use strict";const n=[!1],l=[null],o=[!1],r=[null];function d(e,t,n){let l=e;for(;l>0;){const e=t.indexOf(l);if(e>=0)return e;l=n.getParentId(l)}return t.indexOf(l)}function u(e,t,n){const l=[t.remove[0]],o=[];for(;1===l.length;){const e=l.pop();o.length=0;for(let r=0;r<t.load.length;r++){let d=t.load[r],u=n.getParentId(d);for(;u!==e;)d=u,u=n.getParentId(d);let h=l.indexOf(d);h<0&&(h=l.length,l.push(d),o.push([])),o[h].push(t.load[r])}}t.load=l;for(let t=0;t<l.length;t++)o[t].length>1?e.push({remove:[l[t]],load:o[t]}):l[t]=o[t][0]}e.nodeDiff=function(e,t,u){for(let e=0;e<t.length;e++)o[e]=!1,r[e]=null;for(let t=0;t<e.length;t++)n[t]=!1,l[t]=null;for(let n=0;n<t.length;n++){const r=d(t[n],e,u);r>=0&&(o[n]=!0,null!=l[r]?l[r].push(t[n]):l[r]=[t[n]])}for(let l=0;l<e.length;l++){const o=d(e[l],t,u);o>=0&&(n[l]=!0,null!=r[o]?r[o].push(e[l]):r[o]=[e[l]])}const h=[];for(let t=0;t<e.length;t++)null!=l[t]||n[t]||h.push({load:[],remove:[e[t]]});for(let e=0;e<t.length;e++)null!=r[e]||o[e]||h.push({load:[t[e]],remove:[]});for(let e=0;e<t.length;e++)null!=r[e]&&(r[e].length>1||r[e][0]!==t[e])&&h.push({load:[t[e]],remove:r[e]});for(let t=0;t<e.length;t++)null!=l[t]&&(l[t].length>1||l[t][0]!==e[t])&&h.push({load:l[t],remove:[e[t]]});return h},e.sortFrontToBack=function(e,n,l){return e.sort(((e,o)=>{if(0===e.load.length&&0===o.load.length)return 0;if(0===e.load.length)return-1;if(0===o.load.length)return 1;if(0===e.remove.length&&0===o.remove.length){const r=l.getRenderCenter(e.load[0]),d=l.getRenderCenter(o.load[0]);return t.dot(r,n)-t.dot(d,n)}if(0===e.remove.length)return-1;if(0===o.remove.length)return 1;if(1===e.load.length&&1===o.load.length){const r=l.getRenderCenter(e.load[0]),d=l.getRenderCenter(o.load[0]);return t.dot(r,n)-t.dot(d,n)}if(1===e.load.length)return-1;if(1===o.load.length)return 1;{const r=l.getRenderCenter(e.remove[0]),d=l.getRenderCenter(o.remove[0]);return t.dot(r,n)-t.dot(d,n)}}))},e.splitWorkEntries=function(e,t,n){for(let l=0;l<e.length;++l){const o=e[l];o.load.length>t&&1===o.remove.length&&u(e,o,n)}},e.splitWorkEntry=u,Object.defineProperty(e,"__esModule",{value:!0})}));
