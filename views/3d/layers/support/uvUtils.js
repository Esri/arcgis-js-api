/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../chunks/mat4f64","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/projection","../../../../geometry/projectionEllipsoid","../../../../geometry/support/plane","../../../../geometry/support/buffer/BufferView"],(function(e,t,o,c,r,a,s,n,u,f,i){"use strict";function l(e,t,o,r,a=1){if(o.isGeographic&&2!==r){const e=new Float64Array(t.typedBuffer.length),c=3*t.count,r=u.getReferenceEllipsoid(o);for(let o=0;o<c;o+=3)n.lonLatToWebMercatorComparable(t.typedBuffer,o,e,o,r);t=i.BufferViewVec3f64.fromTypedArray(e)}c.set(b,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<t.count;c++)t.getVec(c,I),b[0]=Math.min(b[0],I[0]),b[1]=Math.min(b[1],I[1]);const s=b[0]%a,f=b[1]%a;T[0]=b[0]-s,T[1]=b[1]-f;for(let c=0;c<t.count;c++)t.getVec(c,I),e.setValues(c,(I[0]-T[0])/a,(I[1]-T[1])/a,T[0]/a,T[1]/a)}function d(e,t,o,r,s=1){a.set(N,1,0,0),a.set(V,0,1,0),a.set(h,0,0,1),k(m,t),E(t,p)&&S(p,N,V,h,o,m),c.set(b,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c.set(M,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let c=0;c<t.count;c++){t.getVec(c,I);const e=a.dot(N,I),o=a.dot(V,I);b[0]=Math.min(b[0],e),b[1]=Math.min(b[1],o),M[0]=Math.max(M[0],e),M[1]=Math.max(M[1],o)}const n=a.dot(h,m);O(y,b[0],b[1],n,N,V,h),O(g,M[0],b[1],n,N,V,h),O(A,b[0],M[1],n,N,V,h),a.subtract(g,g,y),a.scale(g,g,.5),a.subtract(A,A,y),a.scale(A,A,.5),a.add(y,y,g),a.add(y,y,A);const u=b[0]%s,f=b[1]%s;T[0]=b[0]-u,T[1]=b[1]-f;for(let c=0;c<t.count;c++){t.getVec(c,I),e.setValues(c,(a.dot(N,I)-T[0])/s,(a.dot(V,I)-T[1])/s,T[0]/s,T[1]/s);for(let e=0;e<3;e++)r.set(c,e,y[e]),r.set(c,e+3,g[e]),r.set(c,e+6,A[e])}}const m=s.create(),I=s.create(),p=f.create(),N=s.create(),V=s.create(),h=s.create(),b=r.create(),M=r.create(),T=r.create(),y=s.create(),g=s.create(),A=s.create();function E(e,t){const o=e.count-1;return f.fromManyPointsSampleAt(e,t,0,Math.floor(o/3),Math.floor(o*(2/3)))}function S(e,o,c,r,s,n){t.isSome(s)?(s.basisMatrixAtPosition(n,_),a.set(F,_[0],_[1],_[2]),a.set(P,_[4],_[5],_[6]),a.set(Y,_[8],_[9],_[10])):(a.set(F,1,0,0),a.set(P,0,1,0),a.set(Y,0,0,1));const u=f.normal(e);a.dot(u,Y)<0&&a.scale(u,u,-1),a.copy(r,u);const i=a.dot(u,P),l=a.dot(u,F);Math.abs(i)<Math.abs(l)?(a.scaleAndAdd(o,F,u,-l),a.normalize(o,o),a.cross(c,o,u),a.normalize(c,c),a.scale(c,c,-1)):(a.scaleAndAdd(c,P,u,-i),a.normalize(c,c),a.cross(o,c,u),a.normalize(o,o))}const _=o.create(),F=s.create(),P=s.create(),Y=s.create();function k(e,t){a.set(v,0,0,0);for(let o=0;o<t.count-1;o++)t.getVec(o,I),a.add(v,v,I);a.scale(e,v,1/(t.count-1))}const v=s.create();function O(e,t,o,c,r,s,n){a.set(e,t*r[0]+o*s[0]+c*n[0],t*r[1]+o*s[1]+c*n[1],t*r[2]+o*s[2]+c*n[2])}e.createMapSpaceUVCoords=d,e.createMapSpaceUVCoordsDraped=l,Object.defineProperty(e,"__esModule",{value:!0})}));
