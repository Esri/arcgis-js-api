/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../geometry/SpatialReference","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../geometry/projection","../../../../chunks/mat4f64","../../../../chunks/vec2f64","../../../../chunks/vec2","../../support/buffer/BufferView","../../../../chunks/plane","../../webgl-engine/materials/PatternMaterial"],(function(e,t,r,c,a,o,n,s,u,i,f){"use strict";const l=r.create(),d=r.create(),I=i.create(),m=r.create(),p=r.create(),V=r.create(),N=n.create(),M=n.create(),h=n.create(),b=r.create(),T=r.create(),g=r.create();const y=o.create(),A=r.create(),P=r.create(),E=r.create();const S=r.create();function _(e,t,r,a,o,n,s){c.set(e,t*o[0]+r*n[0]+a*s[0],t*o[1]+r*n[1]+a*s[1],t*o[2]+r*n[2]+a*s[2])}e.createMapSpaceUVCoords=function(e,t,r,a,o,n,u=1){c.set(m,1,0,0),c.set(p,0,1,0),c.set(V,0,0,1),function(e,t){c.set(S,0,0,0);for(let e=0;e<t.count-1;e++)t.getVec(e,d),c.add(S,S,d);c.scale(e,S,1/(t.count-1))}(l,t),function(e,t){const r=e.count-1;return i.fromManyPointsSampleAt(e,t,0,Math.floor(r/3),Math.floor(r*(2/3)))}(t,I)&&function(e,t,r,a,o,n){o.basisMatrixAtPosition(n,y),c.set(A,y[0],y[1],y[2]),c.set(P,y[4],y[5],y[6]),c.set(E,y[8],y[9],y[10]);const s=i.normal(e);c.dot(s,E)<0&&c.scale(s,s,-1);c.copy(a,s);const u=c.dot(s,P),f=c.dot(s,A);Math.abs(u)<Math.abs(f)?(c.scaleAndAdd(t,A,s,-f),c.normalize(t,t),c.cross(r,t,s),c.normalize(r,r),c.scale(r,r,-1)):(c.scaleAndAdd(r,P,s,-u),c.normalize(r,r),c.cross(t,r,s),c.normalize(t,t))}(I,m,p,V,r,l),s.set(N,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s.set(M,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let e=0;e<t.count;e++){t.getVec(e,d);const r=c.dot(m,d),a=c.dot(p,d);N[0]=Math.min(N[0],r),N[1]=Math.min(N[1],a),M[0]=Math.max(M[0],r),M[1]=Math.max(M[1],a)}const f=c.dot(V,l);_(b,N[0],N[1],f,m,p,V),_(T,M[0],N[1],f,m,p,V),_(g,N[0],M[1],f,m,p,V);const F=N[0]%u,k=N[1]%u;h[0]=N[0]-F,h[1]=N[1]-k;for(let r=0;r<t.count;r++)t.getVec(r,d),e.setValues(r,(c.dot(m,d)-h[0])/u,(c.dot(p,d)-h[1])/u,h[0]/u,h[1]/u),a&&o&&n&&(a.setVec(r,b),o.setVec(r,T),n.setVec(r,g))},e.createMapSpaceUVCoordsDraped=function(e,r,c,o=1){if(c.isGeographic){const e=new Float64Array(r.typedBuffer.length);a.projectBuffer(r.typedBuffer,c,0,e,t.WebMercator,0,r.count),r=u.BufferViewVec3f64.fromTypedArray(e),c=t.WebMercator}s.set(N,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let e=0;e<r.count;e++)r.getVec(e,d),N[0]=Math.min(N[0],d[0]),N[1]=Math.min(N[1],d[1]);const n=N[0]%o,i=N[1]%o;h[0]=N[0]-n,h[1]=N[1]-i;for(let t=0;t<r.count;t++)r.getVec(t,d),e.setValues(t,(d[0]-h[0])/o,(d[1]-h[1])/o,h[0]/o,h[1]/o)},e.requiresUVUpdates=function(e){return e.material instanceof f.PatternMaterial&&!e.material.params.draped},Object.defineProperty(e,"__esModule",{value:!0})}));
