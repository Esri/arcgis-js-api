/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../chunks/mat4f64","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection","../../../../geometry/support/plane","../../../ViewingMode","../../webgl-engine/lib/DoubleArray"],(function(e,t,o,a,c,n,r,s,l,i,d,I){"use strict";function m(e,t,o,c,n=1){if(o.isGeographic&&c===d.ViewingMode.Global){const e=I.newDoubleArray(t.length),a=t.length,c=s.getReferenceEllipsoid(o);for(let o=0;o<a;o+=3)l.lonLatToWebMercatorComparable(t,o,e,o,c);t=e}a.set(p,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.length;a+=3)p[0]=Math.min(p[0],t[a]),p[1]=Math.min(p[1],t[a+1]);const r=p[0]%n,i=p[1]%n,m=p[0]-r,u=p[1]-i;for(let a=0;a<t.length;a+=3){const o=a/3*4;e[o]=(t[a]-m)/n,e[o+1]=(t[a+1]-u)/n,e[o+2]=m/n,e[o+3]=u/n}}function u(e,t,o,c,r=1){n.set(g,1,0,0),n.set(N,0,1,0),n.set(M,0,0,1),k(h,o),V(o,b)&&E(b,g,N,M,c,h),a.set(p,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a.set(T,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let a=0;a<o.length;a+=3){n.set(f,o[a],o[a+1],o[a+2]);const e=n.dot(g,f),t=n.dot(N,f);p[0]=Math.min(p[0],e),p[1]=Math.min(p[1],t),T[0]=Math.max(T[0],e),T[1]=Math.max(T[1],t)}const s=n.dot(M,h);O(y,p[0],p[1],s,g,N,M),O(A,T[0],p[1],s,g,N,M),O(S,p[0],T[1],s,g,N,M),n.subtract(A,A,y),n.scale(A,A,.5),n.subtract(S,S,y),n.scale(S,S,.5),n.add(y,y,A),n.add(y,y,S);const l=p[0]%r,i=p[1]%r,d=p[0]-l,I=p[1]-i;for(let a=0;a<o.length;a+=3){n.set(f,o[a],o[a+1],o[a+2]);const c=a/3,s=4*c;e[s]=(n.dot(g,f)-d)/r,e[s+1]=(n.dot(N,f)-I)/r,e[s+2]=d/r,e[s+3]=I/r;const l=9*c;for(let e=0;e<3;e++)t[l+e]=y[e],t[l+e+3]=A[e],t[l+e+6]=S[e]}}const h=r.create(),f=r.create(),b=i.create(),g=r.create(),N=r.create(),M=r.create(),p=c.create(),T=c.create(),y=r.create(),A=r.create(),S=r.create();function V(e,t){const o=e.length/3-1;return i.fromManyPointsSampleAt(e,t,0,Math.floor(o/3),Math.floor(o*(2/3)))}function E(e,o,a,c,r,s){t.isSome(r)?(r.basisMatrixAtPosition(s,P),n.set(F,P[0],P[1],P[2]),n.set(Y,P[4],P[5],P[6]),n.set(_,P[8],P[9],P[10])):(n.set(F,1,0,0),n.set(Y,0,1,0),n.set(_,0,0,1));const l=i.normal(e);n.dot(l,_)<0&&n.scale(l,l,-1),n.copy(c,l);const d=n.dot(l,Y),I=n.dot(l,F);Math.abs(d)<Math.abs(I)?(n.scaleAndAdd(o,F,l,-I),n.normalize(o,o),n.cross(a,o,l),n.normalize(a,a),n.scale(a,a,-1)):(n.scaleAndAdd(a,Y,l,-d),n.normalize(a,a),n.cross(o,a,l),n.normalize(o,o))}const P=o.create(),F=r.create(),Y=r.create(),_=r.create();function k(e,t){n.set(v,0,0,0);for(let o=0;o<t.length-3;o+=3)v[0]+=t[o],v[1]+=t[o+1],v[2]+=t[o+2];n.scale(e,v,1/(t.length/3-1))}const v=r.create();function O(e,t,o,a,c,r,s){n.set(e,t*c[0]+o*r[0]+a*s[0],t*c[1]+o*r[1]+a*s[1],t*c[2]+o*r[2]+a*s[2])}e.createMapSpaceUVCoords=u,e.createMapSpaceUVCoordsDraped=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
