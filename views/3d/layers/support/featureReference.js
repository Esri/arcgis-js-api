/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/byteSizeEstimations","../../../../core/has","../../../../geometry/SpatialReference","../../../../geometry/support/aaBoundingBox","../../../../core/mathUtils","../../../../geometry/Extent","../../../../geometry/Geometry","../../../../geometry/Multipoint","../../../../geometry/Point","../../../../geometry/Polygon","../../../../geometry/Polyline","../../../../geometry/support/typeUtils","../../../../layers/support/Field","../../../../layers/graphics/dehydratedFeatureComparison"],(function(e,t,i,n,s,r,o,u,h,l,f,a,c,g,_,y){"use strict";let V=function(){function e(e,t){this._highestResolutionVersion=null,this.versions=[],this.ref(e,t)}var i=e.prototype;return i.ref=function(e,t){const i=this.feature;p.oldVersion=i,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});for(const s of this.versions)if(s.resolution===t){s.refCount++;const t=this._highestResolutionVersion===s&&!y.equals(e,s.feature);return(t||this._highestResolutionVersion!==s)&&(s.feature=e),p.newVersion=t?e:i,p}const n={feature:e,resolution:t,refCount:1};return this.versions.push(n),!this._highestResolutionVersion||t<this._highestResolutionVersion.resolution?(p.newVersion=e,this._highestResolutionVersion=n):p.newVersion=i,p},i.unref=function(e){for(let t=0;t<this.versions.length;t++){const i=this.versions[t];if(i.resolution===e)return i.refCount--,p.oldVersion=this.feature,0===i.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this._highestResolutionVersion===i&&(this._recalculateHighestResolutionVersion(),p.oldVersion=i.feature)),p.newVersion=this.feature,p}return null},i._recalculateHighestResolutionVersion=function(){if(0===this.versions.length)return void(this._highestResolutionVersion=null);let e=this.versions[0];for(let t=1;t<this.versions.length;t++){const i=this.versions[t];i.resolution<e.resolution&&(e=i)}this._highestResolutionVersion=e},t._createClass(e,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},{key:"feature",get:function(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}}]),e}(),d=function(){function e(e){this._feature=e,this._refCount=1}var i=e.prototype;return i.ref=function(e){return++this._refCount,p.oldVersion=this._feature,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0}),y.equals(this._feature,e)||(this._feature=e),p.newVersion=this._feature,p},i.unref=function(){return p.oldVersion=this._feature,this._refCount>0&&(this._refCount--,!this.isReferenced)?(p.newVersion=null,p):(p.newVersion=this._feature,p)},t._createClass(e,[{key:"isReferenced",get:function(){return 0!==this._refCount}},{key:"isSingle",get:function(){return 1===this._refCount}},{key:"feature",get:function(){return this._feature}}]),e}();const p={oldVersion:null,newVersion:null};e.MultiFeatureReference=V,e.SingleFeatureReference=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
