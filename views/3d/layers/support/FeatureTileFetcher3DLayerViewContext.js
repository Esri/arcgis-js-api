/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],(function(e,t,r,i,a){"use strict";let l=function(){function e(e){this.memoryCache=null,this._capabilities=null;const t=e.layerView.layer;this.layerView=e.layerView,this.objectIdField=t.objectIdField,this.returnZ=e.returnZ,this.returnM=e.returnM;const r=this.layerView.view.resourceController;this.query=a.createFeatureTileQuery3D(t,r.scheduler),r&&this.memoryCacheEnabled&&(this.memoryCache=r.memoryController.getMemCache(t.uid))}var l=e.prototype;return l.destroy=function(){r.destroyMaybe(this.memoryCache),this.query.destroy()},l.createQuery=function(){const e=this.layerView.layer.createQuery();return e.outFields=this.layerView.availableFields,e.returnZ=this.returnZ,e.returnM=this.returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e},l.logFetchError=function(e,t){e.error("#fetchTile()",this.layerView.layer,t&&t.message?t.message:t)},t._createClass(e,[{key:"memoryCacheEnabled",get:function(){switch(this.layerView.layer.source.type){case"feature-layer":case"ogc-feature":return!0;case"csv":case"geojson":case"memory":case"stream-layer":return!1}}},{key:"viewingMode",get:function(){return this.layerView.view.state.mode}},{key:"tilingScheme",get:function(){return this.layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const e=this.layerView.view.resourceController;return e?e.scheduler:null}},{key:"geometryType",get:function(){return this.layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this.layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this.layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return r.isSome(this._capabilities)||(this._capabilities=i.contextCapabilitiesFromLayer(this.layerView.layer)),this._capabilities}}]),e}();e.FeatureTileFetcher3DLayerViewContext=l,Object.defineProperty(e,"__esModule",{value:!0})}));
