/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],(function(e,t,r,i,a){"use strict";let l=function(){function e(e){this._memoryCache=null,this._capabilities=null;const t=e.layerView.layer;this._layerView=e.layerView,this.objectIdField=t.objectIdField,this.globalIdField="globalIdField"in t?t.globalIdField:null,this._returnZ=e.returnZ,this._returnM=e.returnM;const r=this._layerView.view.resourceController;this.query=a.createFeatureTileQuery3D(t,(e=>r.schedule(e))),r&&this._memoryCacheEnabled&&(this._memoryCache=r.memoryController.newCache(t.uid))}var l=e.prototype;return l.destroy=function(){this._memoryCache=r.destroyMaybe(this._memoryCache),this.query.destroy()},l.createQuery=function(){const e=this._layerView.layer.createQuery();return e.outFields=this._layerView.availableFields,e.returnZ=this._returnZ,e.returnM=this._returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e},l.logFetchError=function(e,t){e.error("#fetchTile()",this._layerView.layer,t&&t.message?t.message:t)},t._createClass(e,[{key:"_memoryCacheEnabled",get:function(){switch(this._layerView.layer.source.type){case"feature-layer":case"ogc-feature":case"oriented-imagery":return!0;case"csv":case"geojson":case"memory":case"wfs":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this._layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this._layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const e=this._layerView.view.resourceController;return e?e.scheduler:null}},{key:"geometryType",get:function(){return this._layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this._layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this._layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return r.isSome(this._capabilities)||(this._capabilities=i.contextCapabilitiesFromLayer(this._layerView.layer)),this._capabilities}}]),e}();e.FeatureTileFetcher3DLayerViewContext=l,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
