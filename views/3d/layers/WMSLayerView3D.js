/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/Error","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/promiseUtils","../../../geometry/Extent","../../../layers/support/ExportWMSImageParameters","../../layers/WMSLayerView","./DynamicLayerView3D"],(function(e,t,r,s,a,i,o,n,p,c,l,u,h,d,y,m){"use strict";let f=function(t){function r(){return t.apply(this,arguments)||this}e._inheritsLoose(r,t);var s=r.prototype;return s.initialize=function(){this.layer.supportsSpatialReference(this.view.spatialReference)||this.addResolvingPromise(u.reject(new n("layerview:spatial-reference-incompatible","The spatial references supported by this WMS layer are incompatible with the spatial reference of the view")));const{layer:e,view:t}=this;this._exportWMSImageParameters=new d({layer:e,view:t}),this.updatingHandles.add(this._exportWMSImageParameters,"version",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())}))},s.destroy=function(){this._exportWMSImageParameters&&(this._exportWMSImageParameters.layer=null,this._exportWMSImageParameters.destroy(),this._exportWMSImageParameters=null)},s.createFetchPopupFeaturesQuery=function(e){const t=this.findExtentInfoAt(e),r=t.extent,s=new h(r[0],r[1],r[2],r[3],t.spatialReference),a=t.imageSize,i=a.width,o=a.height,n=s.width/i;return{extent:s,width:i,height:o,x:Math.round((e.x-s.xmin)/n),y:Math.round((s.ymax-e.y)/n)}},s.getFetchOptions=function(){return{timeExtent:this._exportWMSImageParameters.timeExtent}},r}(y.WMSLayerView(m));return t.__decorate([i.property({dependsOn:["view.spatialReference","layer.spatialReferences"]})],f.prototype,"suspended",void 0),f=t.__decorate([o.subclass("esri.views.3d.layers.WMSLayerView3D")],f),f}));
