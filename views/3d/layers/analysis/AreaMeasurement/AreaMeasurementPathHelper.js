/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../geometry","../../../../../core/Evented","../../../../../core/Handles","../../../../../core/maybe","../../../../../core/watchUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/accessorSupport/ensureType","../../../../../core/Logger","../../../../../core/accessorSupport/decorators/subclass","../../../../interactive/coordinateHelper","../../../../interactive/editGeometry/EditGeometry","../../../../interactive/editGeometry/operations/AppendVertex","../../../../interactive/editGeometry/operations/SetVertexPosition","../../../../interactive/editGeometry/operations/CloseComponent","../../../../../geometry/Point"],(function(e,t,i,r,n,o,s,a,h,c,m,l,d,u,y,p,_,g,G){"use strict";e.AreaMeasurement3DPathHelper=function(e){function i(t={}){var i;return(i=e.call(this,t)||this)._handles=new o,i._version=0,i._internalGeometryChange=!1,i}t._inheritsLoose(i,e);var r=i.prototype;return r._initialize=function(e,t){this._handles.removeAll(),this._handles.add(a.init(e,"geometry",(()=>this._updateEditGeometryFromModelGeometry(e,t)),!0)),this._makeDirty(!0)},r._makeDirty=function(e=!1){this.notifyChange("isValidPolygon"),this.notifyChange("initialized"),e&&this.notifyChange("numVertices")},r._updateEditGeometryFromModelGeometry=function(e,t){this._version++,this._internalGeometryChange||(this._handles.remove("EditGeometry"),this._editGeometry=s.isSome(e.geometry)?y.EditGeometry.fromGeometry(e.geometry,t.viewingMode):new y.EditGeometry(u.createCoordinateHelper(!0,!1,t.spatialReference,t.viewingMode)),this._makeDirty(!0),this.emit("change",{type:"change"}),this._handles.add(this._editGeometry.on("change",(t=>{this._makeDirty(null!=t.addedVertices||null!=t.removedVertices),this._internalGeometryChange=!0,e.geometry=this.numVertices>0?this._editGeometry.toPolygon():null,this._internalGeometryChange=!1})),"EditGeometry"))},r.getVertex=function(e){if(!this.initialized||0===this._editGeometry.components.length||0===this._editGeometry.components[0].vertices.length)return null;const t=this._editGeometry.components[0].vertices[0];let i=t;do{if(i.index===e)return i;i=i.right.right}while(i!==t&&null!=i);return null},r.getVertexPositionAsPoint=function(e){return this._editGeometry.coordinateHelper.createPoint(e.pos)},r.getVertexPositionAsPointFromIndex=function(e){return this._editGeometry.coordinateHelper.createPoint(this.getVertex(e).pos)},r.forEachVertex=function(e){this.initialized&&this._editGeometry.components.length>0&&this._editGeometry.components[0].iterateVertices(e)},r.forEachVertexPosition=function(e){const t=this._editGeometry.coordinateHelper;this.forEachVertex(((i,r)=>{t.toPoint(i.pos,f),e(f,r)}))},r.clear=function(){s.isSome(this.areaMeasurement)&&(this.areaMeasurement.geometry=null)},r.add=function(e){if(!this.initialized)return null;0===this._editGeometry.components.length&&this._editGeometry.components.push(new y.Component(this._editGeometry));const t=new p.AppendVertex(this._editGeometry,this._editGeometry.components[0],this._editGeometry.coordinateHelper.fromPoint(e));return this._editGeometry.apply(t),this.emit("change",{type:"change"}),t},r.close=function(){if(!this.initialized)return null;if(0===this._editGeometry.components.length)return null;const e=this._editGeometry.components[0],t=new g.CloseComponent(this._editGeometry,e);return this._editGeometry.apply(t),this.emit("change",{type:"change"}),t},r.ensureContains=function(e,t=""){let i=!1;if(this._editGeometry.components.forEach((t=>{t.iterateVertices((t=>{t===e&&(i=!0)}))})),!i)throw new Error(`vertex doesnt exist ${t}`);return i},r.setVertexPosition=function(e,t){if(!this.initialized)return null;const i=new _.SetVertexPosition(this._editGeometry,e,this._editGeometry.coordinateHelper.fromPoint(t));return this._editGeometry.apply(i),this.emit("change",{type:"change"}),i},r.equals=function(e){if(this.numVertices!==e.numVertices)return!1;let t=!0;return this.forEachVertexPosition(((i,r)=>{const n=e.getVertexPositionAsPointFromIndex(r);i.equals(n)||(t=!1)})),!!t},t._createClass(i,[{key:"areaMeasurement",set:function(e){this._set("areaMeasurement",e),s.isSome(e)&&s.isSome(this.view)&&this._initialize(e,this.view)}},{key:"view",set:function(e){this._set("view",e),s.isSome(e)&&s.isSome(this.areaMeasurement)&&this._initialize(this.areaMeasurement,e)}},{key:"initialized",get:function(){return s.isSome(this.areaMeasurement)&&s.isSome(this.view)}},{key:"version",get:function(){return this._version}},{key:"isValidPolygon",get:function(){return this.initialized&&this._editGeometry.components.length>0&&this._editGeometry.components[0].isClosed()}},{key:"vertices",get:function(){const e=[];return this.forEachVertex((t=>{e.push(t)})),e}},{key:"numVertices",get:function(){return this.initialized&&this._editGeometry.components.length>0?this._editGeometry.components[0].vertices.length:0}},{key:"lastPoint",get:function(){if(this.initialized&&this._editGeometry.components.length>0){const e=this._editGeometry.components[0].getLastVertex();if(s.isSome(e))return this._editGeometry.coordinateHelper.createPoint(e.pos)}return null}}]),i}(n.EventedAccessor),i.__decorate([h.property({value:null})],e.AreaMeasurement3DPathHelper.prototype,"areaMeasurement",null),i.__decorate([h.property({value:null})],e.AreaMeasurement3DPathHelper.prototype,"view",null),i.__decorate([h.property()],e.AreaMeasurement3DPathHelper.prototype,"isValidPolygon",null),i.__decorate([h.property()],e.AreaMeasurement3DPathHelper.prototype,"numVertices",null),e.AreaMeasurement3DPathHelper=i.__decorate([d.subclass("esri.views.3d.interactive.graphics.AreaMeasurement3D.AreaMeasurement3DPathHelper")],e.AreaMeasurement3DPathHelper);const f=new G;e.Component=y.Component,e.Edge=y.Edge,e.EditGeometry=y.EditGeometry,e.Vertex=y.Vertex,Object.defineProperty(e,"__esModule",{value:!0})}));
