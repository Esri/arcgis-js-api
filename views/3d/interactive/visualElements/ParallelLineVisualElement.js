/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/screenUtils","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../core/Handles","../../../../chunks/mat4f64","../../../../chunks/vec2","../../../../chunks/vec4","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Geometry","../../webgl-engine/shaders/RibbonLineTechnique","../../webgl-engine/materials/RibbonLineMaterial","../../../../chunks/vec4f32","./Object3DVisualElement"],(function(e,t,r,i,n,s,a,o,c,l,u,h,d,f,m,_){"use strict";let y=function(e){function i(t){var r;return(r=e.call(this,t)||this)._handles=new a,r._location=n.create(),r._direction=n.fromValues(1,0,0),r._width=1,r._offset=1,r._length=18,r._color=m.fromValues(1,0,1,1),r._renderOccluded=4,r.applyProps(t),r}t._inheritsLoose(i,e);var _=i.prototype;return _.setDirectionFromPoints=function(e,t){s.normalize(this._direction,s.subtract(this._direction,t,e)),this.updateGeometry()},_.createExternalResources=function(){const e=new f.RibbonLineMaterial(this.materialParameters,"parallelLineVisualElement");this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry()}))),this._externalResources={material:e}},_.destroyExternalResources=function(){this._handles.removeAll(),this._externalResources=null},_.createGeometries=function(e){const t=new h(u.createPolylineGeometry([n.create(),n.create()]),"parallelLineVisualElement"),i=new h(u.createPolylineGeometry([n.create(),n.create()]),"parallelLineVisualElement"),s=r.unwrap(this._externalResources).material;e.addGeometry(t,s,o.IDENTITY),e.addGeometry(i,s,o.IDENTITY),this.updateVertices(e)},_.forEachExternalResource=function(e){r.isSome(this._externalResources)&&e(this._externalResources.material)},_.updateMaterial=function(){if(r.isNone(this._externalResources))return;this._externalResources.material.setParameterValues(this.materialParameters)},_.updateGeometry=function(){const e=this.object;r.isNone(e)||this.updateVertices(e)},_.updateVertices=function(e){const t=this.view.state.camera;t.projectToScreen(this.location,g),s.add(p,this.location,this.direction),t.projectToScreen(p,b),c.normalize(b,c.subtract(b,b,g)),this.updateVertexAttributes(t,e,0,g,b,1),this.updateVertexAttributes(t,e,1,g,b,-1)},_.updateVertexAttributes=function(e,t,r,i,n,s){const a=t.geometryRecords[r].geometry.data.getVertexAttr()[d.RibbonVertexAttributeConstants.POSITION].data,o=c.scale(w,c.set(w,n[1]*s,n[0]*-s),this.offset+this.width/2),l=c.add(x,c.add(x,c.add(x,i,c.scale(x,n,this.length/2)),o),o),u=c.add(V,l,c.scale(V,n,-this.length));e.unprojectFromScreen(l,p),a[0]=p[0],a[1]=p[1],a[2]=p[2],e.unprojectFromScreen(u,p),a[3]=p[0],a[4]=p[1],a[5]=p[2],t.geometryVertexAttrsUpdated(r)},t._createClass(i,[{key:"location",get:function(){return this._location},set:function(e){s.exactEquals(this._location,e)||(s.copy(this._location,e),this.updateGeometry())}},{key:"direction",get:function(){return this._direction},set:function(e){s.exactEquals(this._direction,e)||(s.copy(this._direction,e),this.updateGeometry())}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"offset",get:function(){return this._offset},set:function(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}},{key:"length",get:function(){return this._length},set:function(e){e!==this._length&&(this._length=e,this.updateGeometry())}},{key:"color",get:function(){return this._color},set:function(e){l.exactEquals(e,this._color)||(l.copy(this._color,e),this.updateMaterial())}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}}]),i}(_.Object3DVisualElement);const p=n.create(),g=i.createScreenPointArray(),b=i.createScreenPointArray(),w=i.createScreenPointArray(),x=i.createScreenPointArray(),V=i.createScreenPointArray();e.ParallelLineVisualElement=y,Object.defineProperty(e,"__esModule",{value:!0})}));
