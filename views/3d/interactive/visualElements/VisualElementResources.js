/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/watchUtils","../../webgl-engine/lib/Object3D","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/Layer","../../webgl-engine/lib/Texture"],(function(e,s,t,r,o,i,c,n){"use strict";let u=function(){function e(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}var u=e.prototype;return u.destroy=function(){this._destroyResources()},u.recreate=function(){this.attached&&this._createResources()},u.recreateGeometry=function(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if(t.isNone(this._resources)||!e)return;const s=this._resources.object;this._resources.external.forEach((s=>{s instanceof i&&e.remove(2,s.id)})),s.removeAllGeometries();const r=this.resourceFactory.recreateGeometry(this._resources.external,s,this._resources.layer);for(const s of r)e.add(2,s)},u._createOrDestroyResources=function(){this._attached?this._resources||this._createResources():this._destroyResources()},u._createResources=function(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const s=new c("element",{isPickable:!1});e.add(0,s),e.addToViewContent([s.id]);const t=new o({idHint:"element",castShadow:!1}),i=this.resourceFactory.createResources(t,s);i.forEach((s=>{e.add(this._contentTypeFromResource(s),s)})),e.add(1,t),s.addObject(t),t.setVisible(this._visible);const n=this.resourceFactory.cameraChanged?r.init(this.resourceFactory.view.state,"camera",(e=>this.resourceFactory.cameraChanged(e))):null;this._resources={layer:s,object:t,external:i,cameraHandle:n}},u._contentTypeFromResource=function(e){return e instanceof i?2:e instanceof n?4:3},u._destroyResources=function(){if(t.isNone(this._resources))return;const e=this.resourceFactory.view._stage;null==e||e.remove(1,this._resources.object.id),null==e||e.remove(0,this._resources.layer.id),this._resources.external.forEach((s=>{null==e||e.remove(this._contentTypeFromResource(s),s.id),"dispose"in s&&s.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null},u._syncVisible=function(){t.isNone(this._resources)||this._resources.object.setVisible(this._visible)},s._createClass(e,[{key:"object",get:function(){return t.isSome(this._resources)?this._resources.object:null}},{key:"resources",get:function(){return t.isSome(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncVisible())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}}]),e}();e.VisualElementResources=u,Object.defineProperty(e,"__esModule",{value:!0})}));
