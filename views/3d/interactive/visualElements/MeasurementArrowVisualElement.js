/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../core/Handles","../../../../chunks/mat4f64","../../support/stack","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Geometry","./Object3DVisualElement","../../webgl-engine/materials/MeasurementArrowMaterial"],(function(e,r,t,i,s,n,o,a,l,h,c,d){"use strict";let u=function(e){function c(r){var t;return(t=e.call(this,r)||this)._parameters=_,t._handles=null,t._origin=i.create(),t._originTransform=o.create(),t._arrowCenter=i.create(),t._renderOccluded=4,t._geometry=null,t._stripeLength=1,t.applyProps(r),t}r._inheritsLoose(c,e);var u=c.prototype;return u.createExternalResources=function(){this._arrowMaterial=new d.MeasurementArrowMaterial({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:this._parameters.arrowStripeEvenColor,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0},"arrow"),this._handles=new n,this._handles.add(this.view.state.watch("camera",(()=>{this.viewChanged()})))},u.destroyExternalResources=function(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null},u.forEachExternalResource=function(e){e(this._arrowMaterial)},u.createGeometries=function(e){if(t.isNone(this._geometry)||t.isNone(this._geometry.startRenderSpace)||t.isNone(this._geometry.endRenderSpace))return;const r=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(r,this._arrowMaterial,this._originTransform),this.viewChanged()},u._createArrowGeometry=function(e,r,t,i){const n=this.view.renderCoordsHelper,o=[],c=[],d=(e,r)=>{const i=a.sv3d.get();s.subtract(i,e,t),o.push(i),c.push(r)};if("euclidean"===i.type){i.eval(.5,this._arrowCenter);const t=a.sv3d.get();n.worldUpAtPosition(this._arrowCenter,t),d(e,t),d(r,t)}else{i.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let r=0;r<e;++r){const t=r/(e-1),s=a.sv3d.get(),o=a.sv3d.get();i.eval(t,s),n.worldUpAtPosition(s,o),d(s,o)}}return new h(l.createPolylineGeometry(o,c),"arrow")},u.geometryChanged=function(){this.recreateGeometry()},u.viewChanged=function(){if(this.view.ready&&this.attached&&t.isSome(this._geometry)){const e=this.view._stage.getCamera().computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}},r._createClass(c,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}}]),c}(c.Object3DVisualElement);const _={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};e.MeasurementArrowVisualElement=u,Object.defineProperty(e,"__esModule",{value:!0})}));
