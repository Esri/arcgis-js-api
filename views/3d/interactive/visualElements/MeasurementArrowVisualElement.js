/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../core/Handles","../../../../chunks/mat4f64","../../support/stack","../../webgl-engine/lib/GeometryUtil","./Object3DVisualElement","../../webgl-engine/materials/MeasurementArrowMaterial"],(function(e,t,r,s,i,a,n,o,l,h,c){"use strict";let d=function(e){function h(t){var r;return(r=e.call(this,t)||this)._parameters=u,r._handles=null,r._origin=s.create(),r._originTransform=n.create(),r._arrowCenter=s.create(),r._renderOccluded=4,r._geometry=null,r._stripeLength=1,r._stripesEnabled=!0,r.applyProps(t),r}t._inheritsLoose(h,e);var d=h.prototype;return d.createExternalResources=function(){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial=new c.MeasurementArrowMaterial({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:e,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new a,this._handles.add(this.view.state.watch("camera",(()=>{this.viewChanged()})))},d.destroyExternalResources=function(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null},d.forEachExternalMaterial=function(e){e(this._arrowMaterial)},d.createGeometries=function(e){if(r.isNone(this._geometry)||r.isNone(this._geometry.startRenderSpace)||r.isNone(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this.viewChanged()},d._createArrowGeometry=function(e,t,r,s){const a=this.view.renderCoordsHelper,n=[],h=[],c=(e,t)=>{const s=o.sv3d.get();i.subtract(s,e,r),n.push(s),h.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const r=o.sv3d.get();a.worldUpAtPosition(this._arrowCenter,r),c(e,r),c(t,r)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const r=t/(e-1),i=o.sv3d.get(),n=o.sv3d.get();s.eval(r,i),a.worldUpAtPosition(i,n),c(i,n)}}return l.createPolylineGeometry(n,h)},d.geometryChanged=function(){this.recreateGeometry()},d.viewChanged=function(){if(this.view.ready&&this.attached&&r.isSome(this._geometry)){const e=this.view._stage.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*e})}},t._createClass(h,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:e}))}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}},{key:"stripesEnabled",get:function(){return this._stripesEnabled},set:function(e){if(this._stripesEnabled=e,this.attached){const e=this._stripesEnabled?this._parameters.arrowStripeEvenColor:this._parameters.arrowStripeOddColor;this._arrowMaterial.setParameterValues({stripeEvenColor:e})}}}]),h}(h.Object3DVisualElement);const u={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};e.MeasurementArrowVisualElement=d,Object.defineProperty(e,"__esModule",{value:!0})}));
