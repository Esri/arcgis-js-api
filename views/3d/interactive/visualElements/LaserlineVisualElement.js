// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../../../../core/maybe","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","./VisualElement","../../support/geometryUtils","../../support/LaserLineRenderer","../../webgl-engine/shaders/Laserlines.glsl"],(function(e,t,n,i,s,r,o,l,a,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LaserlineVisualElement=void 0;var c=function(e){function t(t){var n=e.call(this,t.view)||this;return n._angleCutoff=h.defaultAngleCutoff,n._style={},n._heightManifoldTarget=r.vec3f64.create(),n._heightManifoldEnabled=!1,n._intersectsLine=l.lineSegment.create(),n._intersectsLineEnabled=!1,n._intersectsLineInfinite=!1,n._pathVerticalPlaneBuffers=null,n.applyProps(t),n}return n.__extends(t,e),t.prototype.createResources=function(){this.ensureRenderer()},t.prototype.destroyResources=function(){this.disposeRenderer()},t.prototype.updateVisibility=function(e){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane()},Object.defineProperty(t.prototype,"angleCutoff",{get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(e){this._style=e,this.syncStyle()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"heightManifoldTarget",{get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){i.isSome(e)?(s.vec3.copy(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intersectsWorldUpAtLocation",{set:function(e){if(i.isNone(e))this.intersectsLine=null;else{var t=this.view.renderCoordsHelper.worldUpAtPosition(e,f);this.intersectsLine=l.lineSegment.fromValues(e,t),this.intersectsLineInfinite=!0}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intersectsLine",{get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){i.isSome(e)?(l.lineSegment.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intersectsLineInfinite",{get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pathVerticalPlane",{get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncRenderer()},enumerable:!1,configurable:!0}),t.prototype.syncRenderer=function(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||i.isSome(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()},t.prototype.ensureRenderer=function(){i.isSome(this.renderer)||(this.renderer=new a.LaserLineRenderer(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))},t.prototype.syncStyle=function(){i.isNone(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))},t.prototype.syncAngleCutoff=function(){i.isNone(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})},t.prototype.syncHeightManifold=function(){i.isNone(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))},t.prototype.syncIntersectsLine=function(){i.isNone(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))},t.prototype.syncIntersectsLineInfinite=function(){i.isNone(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)},t.prototype.syncPathVerticalPlane=function(){i.isNone(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=i.isSome(this._pathVerticalPlaneBuffers)&&this.visible,i.isSome(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))},t.prototype.disposeRenderer=function(){i.isSome(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)},t}(o.VisualElement);t.LaserlineVisualElement=c;var f=r.vec3f64.create()}));