/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/lineSegment","./VisualElement","../../support/LaserLineRenderer","../../../../chunks/Laserlines.glsl"],(function(e,t,n,i,s,r,l,a,h){"use strict";let c=function(e){function l(t){var n;return(n=e.call(this,t.view)||this)._angleCutoff=h.defaultAngleCutoff,n._style={},n._heightManifoldTarget=s.create(),n._heightManifoldEnabled=!1,n._intersectsLine=r.create(),n._intersectsLineEnabled=!1,n._intersectsLineInfinite=!1,n._lineVerticalPlaneSegment=null,n._pathVerticalPlaneBuffers=null,n._pointDistanceLine=null,n.applyProps(t),n}t._inheritsLoose(l,e);var c=l.prototype;return c.createResources=function(){this._ensureRenderer()},c.destroyResources=function(){this._disposeRenderer()},c.updateVisibility=function(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()},c._syncRenderer=function(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||n.isSome(this._pointDistanceLine)||n.isSome(this._pathVerticalPlaneBuffers))?this._ensureRenderer():this._disposeRenderer()},c._ensureRenderer=function(){n.isSome(this.renderer)||(this.renderer=new a.LaserLineRenderer(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))},c._syncStyle=function(){n.isNone(this.renderer)||(this.renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))},c._syncAngleCutoff=function(){n.isNone(this.renderer)||this.renderer.setParameters({angleCutoff:this._angleCutoff})},c._syncHeightManifold=function(){n.isNone(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))},c._syncIntersectsLine=function(){n.isNone(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))},c._syncIntersectsLineInfinite=function(){n.isNone(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)},c._syncPathVerticalPlane=function(){n.isNone(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=n.isSome(this._pathVerticalPlaneBuffers)&&this.visible,n.isSome(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))},c._syncLineVerticalPlane=function(){n.isNone(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=n.isSome(this._lineVerticalPlaneSegment)&&this.visible,n.isSome(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))},c._syncPointDistance=function(){n.isNone(this.renderer)||(this.renderer.pointDistanceEnabled=n.isSome(this._pointDistanceLine)&&this.visible,n.isSome(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))},c._disposeRenderer=function(){n.isSome(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)},t._createClass(l,[{key:"testData",get:function(){return this.renderer}},{key:"angleCutoff",get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}},{key:"style",get:function(){return this._style},set:function(e){this._style=e,this._syncStyle()}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){n.isSome(e)?(i.copy(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}},{key:"intersectsWorldUpAtLocation",set:function(e){if(n.isNone(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,o);this.intersectsLine=r.fromValues(e,t),this.intersectsLineInfinite=!0}},{key:"intersectsLine",get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){n.isSome(e)?(r.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(e){this._lineVerticalPlaneSegment=n.isSome(e)?r.copy(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}},{key:"pathVerticalPlane",get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}},{key:"pointDistanceLine",get:function(){return this._pointDistanceLine},set:function(e){this._pointDistanceLine=n.isSome(e)?{origin:s.clone(e.origin),target:s.clone(e.target)}:null,this._syncPointDistance(),this._syncRenderer()}}]),l}(l.VisualElement);const o=s.create();e.LaserlineVisualElement=c,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
