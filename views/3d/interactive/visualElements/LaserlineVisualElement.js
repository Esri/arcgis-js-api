/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3f64","../../../../chunks/vec3","../../support/geometryUtils","./VisualElement","../../../../chunks/Laserlines.glsl","../../support/LaserLineRenderer"],(function(e,t,n,i,s,r,l,a,h){"use strict";let c=function(e){function l(t){var n;return(n=e.call(this,t.view)||this)._angleCutoff=a.defaultAngleCutoff,n._style={},n._heightManifoldTarget=i.create(),n._heightManifoldEnabled=!1,n._intersectsLine=r.lineSegment.create(),n._intersectsLineEnabled=!1,n._intersectsLineInfinite=!1,n._lineVerticalPlaneSegment=null,n._pathVerticalPlaneBuffers=null,n._pointDistanceLine=null,n.applyProps(t),n}t._inheritsLoose(l,e);var c=l.prototype;return c.createResources=function(){this.ensureRenderer()},c.destroyResources=function(){this.disposeRenderer()},c.updateVisibility=function(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance()},c.syncRenderer=function(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||n.isSome(this._pointDistanceLine)||n.isSome(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()},c.ensureRenderer=function(){n.isSome(this.renderer)||(this.renderer=new h.LaserLineRenderer(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))},c.syncStyle=function(){n.isNone(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))},c.syncAngleCutoff=function(){n.isNone(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})},c.syncHeightManifold=function(){n.isNone(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))},c.syncIntersectsLine=function(){n.isNone(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))},c.syncIntersectsLineInfinite=function(){n.isNone(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)},c.syncPathVerticalPlane=function(){n.isNone(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=n.isSome(this._pathVerticalPlaneBuffers)&&this.visible,n.isSome(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))},c.syncLineVerticalPlane=function(){n.isNone(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=n.isSome(this._lineVerticalPlaneSegment)&&this.visible,n.isSome(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))},c.syncPointDistance=function(){n.isNone(this.renderer)||(this.renderer.pointDistanceEnabled=n.isSome(this._pointDistanceLine)&&this.visible,n.isSome(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))},c.disposeRenderer=function(){n.isSome(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)},t._createClass(l,[{key:"testData",get:function(){return this.renderer}},{key:"angleCutoff",get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())}},{key:"style",get:function(){return this._style},set:function(e){this._style=e,this.syncStyle()}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){n.isSome(e)?(s.copy(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()}},{key:"intersectsWorldUpAtLocation",set:function(e){if(n.isNone(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,o);this.intersectsLine=r.lineSegment.fromValues(e,t),this.intersectsLineInfinite=!0}},{key:"intersectsLine",get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){n.isSome(e)?(r.lineSegment.copy(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(e){this._lineVerticalPlaneSegment=n.isSome(e)?r.lineSegment.copy(e):null,this.syncLineVerticalPlane(),this.syncRenderer()}},{key:"pathVerticalPlane",get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer()}},{key:"pointDistanceLine",get:function(){return this._pointDistanceLine},set:function(e){this._pointDistanceLine=n.isSome(e)?{origin:i.clone(e.origin),target:i.clone(e.target)}:null,this.syncPointDistance(),this.syncRenderer()}}]),l}(l.VisualElement);const o=i.create();e.LaserlineVisualElement=c,Object.defineProperty(e,"__esModule",{value:!0})}));
