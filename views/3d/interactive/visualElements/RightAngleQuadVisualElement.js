/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../core/Handles","../../../../chunks/mat4","../../../../chunks/mat4f64","../../../../chunks/vec4","../../support/stack","../../webgl-engine/lib/GeometryData","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Geometry","../../webgl-engine/materials/RibbonLineMaterial","../../webgl-engine/materials/ColorMaterial","../../../../chunks/vec4f32","./Object3DVisualElement"],(function(e,t,i,r,a,n,s,o,u,l,c,h,d,_,m,f,p){"use strict";let g=function(e){function p(t){var i;return(i=e.call(this,t)||this)._handles=new n,i._quadMaterial=null,i._outlineMaterial=null,i._maxSize=0,i._position=r.create(),i._up=r.create(),i._right=r.create(),i._transform=o.create(),i._renderOccluded=4,i._color=f.fromValues(1,0,0,1),i._outlineColor=f.fromValues(0,0,0,1),i._outlineSize=0,i._size=32,i._outlineRenderOccluded=16,i.applyProps(t),i}t._inheritsLoose(p,e);var g=p.prototype;return g.createExternalResources=function(){this._quadMaterial=new m.ColorMaterial(this.quadMaterialParameters,"right-angle-quad"),this._outlineMaterial=new _.RibbonLineMaterial(this.outlineMaterialParameters,"right-angle-quad-outline"),this._handles.add(this.view.state.watch("camera",(()=>{this._updateTransform()})))},g.destroyExternalResources=function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()},g.forEachExternalResource=function(e){e(this._quadMaterial),e(this._outlineMaterial)},g.createGeometries=function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)},g._createQuadGeometry=function(e){const t=new d(this._quadGeometryData(this._up,this._right),"right-angle-quad");e.addGeometry(t,this._quadMaterial)},g._createOutlineGeometry=function(e){if(0===this._outlineSize)return;const t=a.add(l.sv3d.get(),this._up,this._right),i=new d(h.createPolylineGeometry([this._up,t,this._right]),"right-angle-quad-outline");e.addGeometry(i,this._outlineMaterial)},g._updateTransform=function(e=this.object){const t=this.view.state.camera,r=this._size*t.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,r);s.identity(this._transform),s.translate(this._transform,this._transform,this._position),s.scale(this._transform,this._transform,[a,a,a]),i.isSome(e)&&(e.objectTransformation=this._transform)},g._quadGeometryData=function(e,t){const i=a.add(l.sv3d.get(),e,t);return new c.GeometryData({position:{size:3,data:[0,0,0,...t,...e,...i]}},{position:new Uint32Array([0,1,2,1,2,3])})},g._updateQuadMaterial=function(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)},g._updateOutlineMaterial=function(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)},t._createClass(p,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){u.copy(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){u.copy(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function({previous:e,center:t,next:i}){this._maxSize=Math.min(a.distance(t,e),a.distance(t,i))/3,a.normalize(this._up,a.subtract(this._up,e,t)),a.normalize(this._right,a.subtract(this._right,i,t)),a.copy(this._position,t),this.recreateGeometry()}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}}]),p}(p.Object3DVisualElement);e.RightAngleQuadVisualElement=g,Object.defineProperty(e,"__esModule",{value:!0})}));
