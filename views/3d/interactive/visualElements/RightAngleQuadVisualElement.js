/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../core/Handles","../../../../chunks/mat4","../../../../chunks/mat4f64","../../../../chunks/vec4","../../../../chunks/vec4f32","../../support/stack","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/materials/RibbonLineMaterial","../../webgl-engine/materials/ColorMaterial","./Object3DVisualElement"],(function(e,t,i,r,a,n,s,o,u,l,c,h,d,_,m,f){"use strict";let p=function(e){function o(t){var i;return(i=e.call(this,t)||this)._handles=new n,i._quadMaterial=null,i._outlineMaterial=null,i._maxSize=0,i._position=r.create(),i._up=r.create(),i._right=r.create(),i._renderOccluded=4,i._color=l.fromValues(1,0,0,1),i._outlineColor=l.fromValues(0,0,0,1),i._outlineSize=0,i._size=32,i._outlineRenderOccluded=16,i.applyProps(t),i}t._inheritsLoose(o,e);var f=o.prototype;return f.createExternalResources=function(){this._quadMaterial=new m.ColorMaterial(this.quadMaterialParameters),this._outlineMaterial=new _.RibbonLineMaterial(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))},f.destroyExternalResources=function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()},f.forEachExternalMaterial=function(e){e(this._quadMaterial),e(this._outlineMaterial)},f.createGeometries=function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)},f._createQuadGeometry=function(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)},f._createOutlineGeometry=function(e){if(0===this._outlineSize)return;const t=a.add(c.sv3d.get(),this._up,this._right),i=d.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)},f._updateTransform=function(e=this.object){const t=this.view.state.camera,r=this._size*t.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,r);s.identity(y),s.translate(y,y,this._position),s.scale(y,y,[a,a,a]),i.isSome(e)&&(e.transformation=y)},f._quadGeometryData=function(e,t){const i=a.add(c.sv3d.get(),e,t);return new h.Geometry([["position",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])},f._updateQuadMaterial=function(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)},f._updateOutlineMaterial=function(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)},t._createClass(o,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){u.copy(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){u.copy(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function({previous:e,center:t,next:i}){this._maxSize=Math.min(a.distance(t,e),a.distance(t,i))/3,a.normalize(this._up,a.subtract(this._up,e,t)),a.normalize(this._right,a.subtract(this._right,i,t)),a.copy(this._position,t),this.recreateGeometry()}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}}]),o}(f.Object3DVisualElement);const y=o.create();e.RightAngleQuadVisualElement=p,Object.defineProperty(e,"__esModule",{value:!0})}));
