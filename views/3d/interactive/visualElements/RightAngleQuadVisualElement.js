/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Handles","../../../../core/maybe","../../../../chunks/mat4","../../../../chunks/mat4f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4","../../../../chunks/vec4f32","../../../../geometry/support/vectorStacks","./Object3DVisualElement","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Material","../../webgl-engine/lib/VertexAttribute","../../webgl-engine/materials/ColorMaterial","../../webgl-engine/materials/RibbonLineMaterial"],(function(e,t,i,r,a,n,s,l,o,u,c,d,h,_,m,f,p,g){"use strict";let M=function(e){function n(t){var r;return(r=e.call(this,t)||this)._handles=new i,r._quadMaterial=null,r._outlineMaterial=null,r._maxSize=0,r._position=l.create(),r._up=l.create(),r._right=l.create(),r._renderOccluded=m.RenderOccludedFlag.OccludeAndTransparent,r._color=u.fromValues(1,0,0,1),r._outlineColor=u.fromValues(0,0,0,1),r._outlineSize=0,r._size=32,r._outlineRenderOccluded=m.RenderOccludedFlag.Opaque,r.applyProps(t),r}t._inheritsLoose(n,e);var d=n.prototype;return d.createExternalResources=function(){this._quadMaterial=new p.ColorMaterial(this.quadMaterialParameters),this._outlineMaterial=new g.RibbonLineMaterial(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))},d.destroyExternalResources=function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()},d.forEachExternalMaterial=function(e){e(this._quadMaterial),e(this._outlineMaterial)},d.createGeometries=function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)},d._createQuadGeometry=function(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)},d._createOutlineGeometry=function(e){if(0===this._outlineSize)return;const t=s.add(c.sv3d.get(),this._up,this._right),i=_.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)},d._updateTransform=function(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);a.fromTranslation(y,this._position),a.scale(y,y,[n,n,n]),r.isSome(e)&&(e.transformation=y)},d._quadGeometryData=function(e,t){const i=s.add(c.sv3d.get(),e,t);return new h.Geometry([[f.VertexAttribute.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[f.VertexAttribute.POSITION,new Uint16Array([0,1,2,1,2,3])]])},d._updateQuadMaterial=function(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)},d._updateOutlineMaterial=function(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)},t._createClass(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){o.copy(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){o.copy(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function({previous:e,center:t,next:i}){this._maxSize=Math.min(s.distance(t,e),s.distance(t,i))/3,s.normalize(this._up,s.subtract(this._up,e,t)),s.normalize(this._right,s.subtract(this._right,i,t)),s.copy(this._position,t),this.recreateGeometry()}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}}]),n}(d.Object3DVisualElement);const y=n.create();e.RightAngleQuadVisualElement=M,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
