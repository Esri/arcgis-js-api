/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/mat4","../../../../chunks/mat4f64","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../chunks/vec4","../../../../chunks/vec4f32","./Object3DVisualElement","../../layers/graphics/lineUtils","../../webgl-engine/materials/RibbonLineMaterial"],(function(e,t,i,r,n,s,o,a,l,h,c,u){"use strict";let p=function(e){function n(t){var i;return(i=e.call(this,t)||this)._renderOccluded=4,i._width=1,i._color=l.fromValues(1,0,1,1),i._innerWidth=1,i._innerColor=null,i._stipplePattern=null,i._stippleOffColor=null,i._stippleIntegerRepeats=!1,i._writeDepthEnabled=!0,i._falloff=0,i._polygonOffset=!1,i.applyProps(t),i}t._inheritsLoose(n,e);var h=n.prototype;return h.setGeometryFromRenderSpacePoint=function(e){const t=1e3,i=[];i.push([[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]]),i.push([[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]]),i.push([[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]),this.geometry=i},h.setGeometryFromExtent=function(e){const t=this.view.spatialReference,i=o.create(),r=o.create(),n=100,a=[];s.set(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),s.set(i,e[2],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),s.set(i,e[2],e[3],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),s.set(i,e[0],e[3],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),s.set(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),s.set(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),this.geometry=[a]},h.setGeometryFromFrustum=function(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]},h.setGeometryFromBoundedPlane=function(e){const t=[],i=e.origin,r=e.basis1,n=e.basis2,s=.5,a=o.create(),l=o.create(),h=o.create(),c=o.create();a[0]=i[0]-r[0]*s-n[0]*s,a[1]=i[1]-r[1]*s-n[1]*s,a[2]=i[2]-r[2]*s-n[2]*s,l[0]=i[0]-r[0]*s+n[0]*s,l[1]=i[1]-r[1]*s+n[1]*s,l[2]=i[2]-r[2]*s+n[2]*s,h[0]=i[0]+r[0]*s+n[0]*s,h[1]=i[1]+r[1]*s+n[1]*s,h[2]=i[2]+r[2]*s+n[2]*s,c[0]=i[0]+r[0]*s-n[0]*s,c[1]=i[1]+r[1]*s-n[1]*s,c[2]=i[2]+r[2]*s-n[2]*s,t.push([a[0],a[1],a[2]]),t.push([l[0],l[1],l[2]]),t.push([h[0],h[1],h[2]]),t.push([c[0],c[1],c[2]]),t.push([a[0],a[1],a[2]]),this.geometry=[t]},h.setGeometryFromSegment=function(e){const t=e.endRenderSpace;r.identity(f),r.translate(f,f,t),this.transform=f;const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]},h.setGeometryFromSegments=function(e,t=o.ZEROS){r.identity(f),r.translate(f,f,t),this.transform=f,this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))},h.createExternalResources=function(){this._material=new u.RibbonLineMaterial(this.materialParameters)},h.destroyExternalResources=function(){this._material=null},h.createGeometries=function(e){const t=this._createLineGeometries();if(0!==t.length)for(let i=0;i<t.length;++i){const r=c.createGeometry(t[i]);e.addGeometry(r,this._material)}},h.forEachExternalMaterial=function(e){e(this._material)},h._updateMaterial=function(){this.attached&&this._material.setParameterValues(this.materialParameters)},h._createLineGeometries=function(){const e=this.geometry;if(i.isNone(e)||0===e.length)return[];const t=[];return e.forEach((e=>{const i=e.length,r=new Float64Array(3*i);e.forEach(((e,t)=>{r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e[2]}));const n={attributeData:{position:r},removeDuplicateStartEnd:0};t.push(n)})),t},t._createClass(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){a.exactEquals(e,this._color)||(a.copy(this._color,e),this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){i.isSome(e)?!i.isNone(this._innerColor)&&a.exactEquals(e,this._innerColor)||(this._innerColor=a.copy(l.create(),e),this._updateMaterial()):i.isSome(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){const t=i.isSome(e)!==i.isSome(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){(i.isNone(e)||i.isNone(this._stippleOffColor)||!a.exactEquals(e,this._stippleOffColor))&&(this._stippleOffColor=i.isSome(e)?l.clone(e):null,this._updateMaterial())}},{key:"stippleIntegerRepeats",get:function(){return this._stippleIntegerRepeats},set:function(e){this._stippleIntegerRepeats!==e&&(this._stippleIntegerRepeats=e,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}}]),n}(h.Object3DVisualElement);const f=n.create();e.LineVisualElement=p,Object.defineProperty(e,"__esModule",{value:!0})}));
