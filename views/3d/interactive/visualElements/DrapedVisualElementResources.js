/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Identifiable","../../../../core/maybe","../../../../core/accessorSupport/decorators/property","../../../../core/arrayUtils","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/subclass","../../layers/interfaces","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/ModelDirtyTypes"],(function(e,r,s,t,o,i,c,n,u,a,d,_,h){"use strict";let l=function(){function e(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}var s=e.prototype;return s.destroy=function(){this._destroyResources()},s.recreate=function(){this.attached&&this._createResources()},s.recreateGeometry=function(){this._resourceFactory.recreateGeometry?i.isNone(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()},s._createOrDestroyResources=function(){this._attached?i.isNone(this._resources)&&this._createResources():this._destroyResources()},s._createResources=function(){this._destroyResources();const e=this._resourceFactory.createResources(),r=new y({view:this._resourceFactory.view}),s=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new y({view:this._resourceFactory.view}),external:e,geometriesAdded:!1},s&&(this._resources.drapeSourceRenderer=s.registerGeometryDrapeSource(r)),this._syncGeometriesToRenderer()},s._destroyResources=function(){if(i.isNone(this._resources))return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resources=null},s._syncGeometriesToRenderer=function(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()},s._ensureRenderGeometriesRemoved=function(){if(i.isNone(this._resources)||i.isNone(this._resources.drapeSourceRenderer))return;if(!this._resources.geometriesAdded)return;this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,h.DirtyOperation.UPDATE),this._resources.geometriesAdded=!1},s._ensureRenderGeometriesAdded=function(){if(i.isNone(this._resources)||i.isNone(this._resources.drapeSourceRenderer))return;if(this._resources.geometriesAdded)return;this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,h.DirtyOperation.UPDATE),this._resources.geometriesAdded=!0},r._createClass(e,[{key:"resources",get:function(){return i.isSome(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}}]),e}(),y=function(e){function s(r){var s;return(s=e.call(this,r)||this).drapeSourceType=d.DrapeSourceType.Features,s.updatePolicy=_.UpdatePolicy.SYNC,s}return r._inheritsLoose(s,e),s}(o.IdentifiableMixin(t));s.__decorate([c.property({constructOnly:!0})],y.prototype,"view",void 0),s.__decorate([c.property({readOnly:!0})],y.prototype,"drapeSourceType",void 0),y=s.__decorate([a.subclass("DrapedVisualElementLayerView")],y),e.DrapedVisualElementResources=l,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
