/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/has","../../../../../core/maybe","../../../../../core/Logger","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/urlUtils","../../../../../core/uuid","../../../../../portal/support/resourceExtension","../../../../../geometry/Point","../../../../../core/Collection","../../../../../Color","../../../../../core/screenUtils","../../../../../chunks/vec3f64","../../../../../chunks/vec3","../../../../../core/Handles","../../../../../core/watchUtils","../../../../support/Scheduler","../../../../../chunks/mat4f64","../../../../../layers/graphics/dehydratedFeatures","../../../support/stack","../../../../../chunks/ray","../../../support/geometryUtils","../../../webgl-engine/lib/Object3D","../../../webgl-engine/lib/Intersector","../../../webgl-engine/lib/Layer","../../../terrain/tileUtils","../../../../interactive/dragEventPipeline","../../../support/LaserLineRenderer","../../../../interactive/InteractiveToolBase","./lineOfSightToolConfig","./lineOfSightToolUtils","../../../../../widgets/LineOfSight/LineOfSightTarget"],(function(e,t,i,n,r,s,o,a,l,c,h,d,u,p,_,g,v,f,y,m,b,O,T,L,S,C,I,w,R,k,M,E,P,G,V,A){"use strict";const H=p.ofType(A);e.LineOfSightTool=function(e){function i(t){var i;return(i=e.call(this,t)||this).deferCreation=!0,i.observer=null,i.targets=new H,i.configuration=null,i.updating=!1,i._handles=new y,i._manipulatorHandles=new y,i._observer=null,i._tracker=null,i._analyses=new p,i._screenPixelSize=0,i._grabbedManipulator=null,i._showTracker=!0,i}t._inheritsLoose(i,e);var n=i.prototype;return n.initialize=function(){const e=m.init(this,"state",(e=>{switch(e){case"created":this.complete();break;default:this.create()}}),!0),t=this.configuration=new G.Configuration;this._intersector=new w.Intersector(this.view.state.mode),this._intersector.options.hud=!1,this._intersector.options.store=0,this._engineLayer=new R("line-of-sight-analysis",{isPickable:!1});const i=this.view._stage;i.addToViewContent([this._engineLayer.id]),i.add(0,this._engineLayer),this._createEngineResources(),this._observer={location:null,intersection:null,manipulator:this._addManipulator({size:t.observerManipulatorSize,color:t.observerManipulatorColor,visible:!1})},this._tracker=this._createLineOfSightAnalysis(new A({location:new u})),this._tracker.point.manipulator.available=!1,this._tracker.point.manipulator.interactive=!1;const n=this._handles;n.add([e,this.view.state.watch("camera",(()=>this._onCameraChange())),this.view.watch("map.ground.opacity",((e,t)=>this._onGroundOpacityChange(e,t))),m.init(this.view,"slicePlane",(()=>this._onSlicePlaneChange())),m.init(this,"observer",(e=>this._onObserverChange(e)),!0),m.on(this,"targets","change",(e=>this._onTargetCollectionChange(e)),(e=>this._onTargetsChange(e)),null,!0),m.watch(this.configuration,["laserLineEnabled","laserLineGlowColor","laserLineGlowWidth","laserLineInnerColor","laserLineInnerWidth","laserLineGlobalAlpha","lineOfSightInnerWidth","lineOfSightOuterWidth","lineOfSightVisibleInnerColor","lineOfSightVisibleOuterColor","lineOfSightOccludedInnerColor","lineOfSightOccludedOuterColor","lineOfSightUndefinedInnerColor","lineOfSightUndefinedOuterColor","lineOfSightUndefinedStipplePattern","lineOfSightUndefinedStipplePatternOffColor"],(()=>this._createEngineResources())),m.watch(this.configuration,["observerManipulatorSize","observerManipulatorColor"],(()=>this._recreateManipulator(this._observer))),m.watch(this.configuration,["targetManipulatorSize","targetManipulatorVisibleColor","targetManipulatorOccludedColor","targetManipulatorUndefinedColor"],(()=>this._analyses.forEach((e=>this._recreateManipulator(e.point)))))]);const r=this.view.pointsOfInterest;r&&n.add([r.contentGeometryUpdates.events.on("request-update",(()=>this._onContentChange())),this.view.elevationProvider.on("elevation-change",(()=>this._onContentChange()))]);const s=this.view.resourceController&&this.view.resourceController.scheduler;s&&(this._frameTask=s.registerTask(b.Task.LINE_OF_SIGHT_TOOL,(e=>this._updateAnalyses(e)),(()=>this.updating)),n.add(this._frameTask)),this.continue()},n.destroy=function(){this.detach(),this._handles.destroy(),this._handles=null,this._manipulatorHandles.destroy(),this._manipulatorHandles=null,this.manipulators.remove(this._observer.manipulator),this._destroyLineOfSightAnalysis(this._tracker),this._analyses.forEach((e=>{this._destroyLineOfSightAnalysis(e)}));const e=this.view._stage;e.removeFromViewContent([this._engineLayer.id]),e.remove(0,this._engineLayer.id),this._removeEngineResources(),this._engineLayer=null,e.removeRenderPlugin(this._engineResources.laserLineRenderer),this._engineResources.laserLineRenderer=null,this._engineResources=null,this._intersector=null,this.observer=null,this._set("targets",null)},n.continue=function(){this.view.activeTool=this,this._showTracker=!0,this._updateTrackerVisibility()},n.stop=function(){this._showTracker=!1,this._setDirty(b.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE),this._updateTrackerVisibility()},n.onInputEvent=function(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}},n.onInputEventAfter=function(e){switch(e.type){case"immediate-click":this._clickHandler(e)}},n._setDirty=function(e){this.updating?e===b.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE&&this._frameTask&&(this._frameTask.task=e):(this._set("updating",!0),this._frameTask&&(this._frameTask.task=e))},n._updateTrackerVisibility=function(){this._tracker.shouldRender=this._showTracker&&!this.manipulators.some((e=>e.manipulator.focused)),this._updateLaserLineRenderer()},n._manipulatorFocusChanged=function(){this._updateTrackerVisibility(),this.notifyChange("cursor")},n._addManipulator=function(e){const t=V.createSphereManipulator(this.view,e);return this._manipulatorHandles.add([this._createManipulatorDragPipeline(t),t.events.on("focus-changed",(()=>this._manipulatorFocusChanged())),t.events.on("grab-changed",(e=>this._manipulatorGrabChanged(t,e))),t.events.on("immediate-click",(e=>e.stopPropagation()))],t),this.manipulators.add(t),t},n._removeManipulator=function(e){this.manipulators.remove(e),this._manipulatorHandles.remove(e)},n._recreateManipulator=function(e){const t=this.configuration,i=e.manipulator;this._removeManipulator(i);const n=e===this._observer?{size:t.observerManipulatorSize,color:t.observerManipulatorColor,visible:i.available}:{size:t.targetManipulatorSize,customColor1:t.targetManipulatorVisibleColor,customColor2:t.targetManipulatorOccludedColor,customColor3:t.targetManipulatorUndefinedColor};e.manipulator=this._addManipulator(n),e.manipulator.location=i.location,this._setDirty(b.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)},n._screenToIntersection=function(){return e=>{const t=this._getScreenPointIntersection(e.screenEnd);return r.isNone(t)?null:{...e,intersection:t}}},n._createManipulatorDragPipeline=function(e){return M.createManipulatorDragEventPipeline(e,((t,i,n)=>{i.next(this._screenToIntersection()).next(e===this._observer.manipulator?this._updateObserverDragStep():this._updateAnalysisDragStep(e)).next((()=>this._updateLaserLineRenderer())),n.next(e===this._observer.manipulator?this._cancelObserverDragStep():this._cancelAnalysisDragStep(e)).next((()=>this._updateLaserLineRenderer()))}))},n._updateObserverDragStep=function(){return e=>(this.observer=e.intersection.point,this._observer.intersection=e.intersection,e)},n._cancelObserverDragStep=function(){const e=r.isSome(this.observer)?this.observer.clone():null,t=this._observer.intersection;return i=>(this.observer=e,this._observer.intersection=t,i)},n._updateAnalysisDragStep=function(e){return t=>{const i=this._analyses.find((t=>t.point.manipulator===e));return i.target.location=t.intersection.point,i.point.intersection=t.intersection,t}},n._cancelAnalysisDragStep=function(e){const t=this._analyses.find((t=>t.point.manipulator===e)),i=r.isSome(t.target.location)?t.target.location.clone():null,n=t.point.intersection;return e=>(t.target.location=i,t.point.intersection=n,e)},n._updateLaserLineRenderer=function(){const e=this._engineResources.laserLineRenderer;if(!this.configuration.laserLineEnabled)return e.heightManifoldEnabled=!1,void(e.lineVerticalPlaneEnabled=!1);const t=r.isSome(this._grabbedManipulator)?this._grabbedManipulator:this._tracker.shouldRender&&this.observer?this._tracker.point.manipulator:null;this.configuration.laserLineEnabled&&r.isSome(t)?(e.heightManifoldEnabled=!0,e.heightManifoldTarget=t.renderLocation,t!==this._observer.manipulator?(e.lineVerticalPlaneEnabled=!0,e.lineVerticalPlaneSegment=C.lineSegment.fromPoints(this._observer.manipulator.renderLocation,t.renderLocation,j)):e.lineVerticalPlaneEnabled=!1):(e.heightManifoldEnabled=!1,e.lineVerticalPlaneEnabled=!1)},n._createLaserLineRenderer=function(){const e=this.configuration;return new E.LaserLineRenderer(this.view.renderCoordsHelper,{glowColor:_.toUnitRGB(e.laserLineGlowColor),glowWidth:e.laserLineGlowWidth,innerColor:_.toUnitRGB(e.laserLineInnerColor),innerWidth:e.laserLineInnerWidth,globalAlpha:e.laserLineGlobalAlpha})},n._removeEngineResources=function(){const e=this.view._stage;e.remove(3,this._engineResources.visibleLineMaterialInner.id),e.remove(3,this._engineResources.visibleLineMaterialOuter.id),e.remove(3,this._engineResources.occludedLineMaterialInner.id),e.remove(3,this._engineResources.occludedLineMaterialOuter.id),e.remove(3,this._engineResources.undefinedLineMaterialInner.id),e.remove(3,this._engineResources.undefinedLineMaterialOuter.id)},n._createEngineResources=function(){const e=this.view._stage,t=this.configuration;this._engineResources&&(this._removeEngineResources(),e.removeRenderPlugin(this._engineResources.laserLineRenderer)),this._engineResources={laserLineRenderer:this._createLaserLineRenderer(),visibleLineMaterialInner:V.createPolylineMaterial(t.lineOfSightInnerWidth,t.lineOfSightVisibleInnerColor),visibleLineMaterialOuter:V.createPolylineMaterial(t.lineOfSightOuterWidth,t.lineOfSightVisibleOuterColor),occludedLineMaterialInner:V.createPolylineMaterial(t.lineOfSightInnerWidth,t.lineOfSightOccludedInnerColor),occludedLineMaterialOuter:V.createPolylineMaterial(t.lineOfSightOuterWidth,t.lineOfSightOccludedOuterColor),undefinedLineMaterialInner:V.createPolylineMaterial(t.lineOfSightInnerWidth,t.lineOfSightUndefinedInnerColor),undefinedLineMaterialOuter:V.createPolylineMaterial(t.lineOfSightOuterWidth,t.lineOfSightUndefinedOuterColor)},e.addRenderPlugin(this._engineResources.laserLineRenderer.renderSlots,this._engineResources.laserLineRenderer),e.add(3,this._engineResources.visibleLineMaterialInner),e.add(3,this._engineResources.visibleLineMaterialOuter),e.add(3,this._engineResources.occludedLineMaterialInner),e.add(3,this._engineResources.occludedLineMaterialOuter),e.add(3,this._engineResources.undefinedLineMaterialInner),e.add(3,this._engineResources.undefinedLineMaterialOuter),this._setDirty(b.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)},n._onObserverChange=function(e){if(r.isNone(e))return this._observer.manipulator.available=!1,void this.targets.removeAll();this._observer.location=e,this._observer.intersection=null,this._observer.manipulator.available=!0,this._observer.manipulator.location=e,this._tracker.point.manipulator.location=e,this._analyses.forEach((e=>{e.isDirty=!0,e.isValid=!1})),this._setDirty(b.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)},n._onTargetsChange=function(e){this._analyses.forEach((e=>{this._destroyLineOfSightAnalysis(e)})),this._analyses.removeAll(),e.items&&this._onTargetCollectionChange({target:e,added:e.items,removed:[],moved:[]})},n._onTargetCollectionChange=function(e){e.added.forEach((e=>{if(!this._analyses.some((t=>t.target===e))){const t=this._createLineOfSightAnalysis(e);this._analyses.add(t)}this._setDirty(b.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)})),e.removed.forEach((e=>{const t=this._analyses.find((t=>t.point.location===e.location));this._destroyLineOfSightAnalysis(t),this._analyses.remove(t)}))},n._onTargetLocationChange=function(e,t){e.isValid=!1,e.point.location=t,e.point.intersection=null,e.point.manipulator.location=t,e.isDirty=!0,this._setDirty(b.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE)},n._onGroundOpacityChange=function(e,t){this._analyses.length&&(1!==e&&1!==t||e===t||(this._setDirty(b.Task.LINE_OF_SIGHT_TOOL),this._analyses.forEach((e=>e.isDirty=!0))))},n._onContentChange=function(){this._analyses.forEach((e=>{e.isDirty=!0,e.shouldIntersect=!0})),this._setDirty(b.Task.LINE_OF_SIGHT_TOOL)},n._onCameraChange=function(){if(!this._analyses.length)return;let e=!1;if(r.isSome(this.observer)){this.view.renderCoordsHelper.toRenderCoords(this.observer,D);const t=this.view.state.camera.computeScreenPixelSizeAt(D);e=e||Math.abs((t-this._screenPixelSize)/this._screenPixelSize)>.1}this._analyses.some((e=>!e.isValid))&&(e=!0),e&&(this._setDirty(b.Task.LINE_OF_SIGHT_TOOL),this._analyses.forEach((e=>e.isDirty=!0)))},n._onSlicePlaneChange=function(){this._analyses.length&&(this._setDirty(b.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE),this._analyses.forEach((e=>e.isDirty=!0)))},n._addPointFromClickEvent=function(e){const t=this._getScreenPointIntersection(e);if(!r.isNone(t)&&!r.isNone(t.point))if(this.observer){const e=new A({location:t.point}),i=this._createLineOfSightAnalysis(e);this._analyses.add(i),i.point.intersection=t,this.targets.add(e)}else this.observer=t.point,this._observer.intersection=t},n._clickHandler=function(e){this._showTracker&&(this._addPointFromClickEvent({x:e.x,y:e.y}),e.stopPropagation())},n._doubleClickHandler=function(e){this._showTracker&&(this.stop(),e.stopPropagation())},n._keyDownHandler=function(e){this._showTracker&&"Escape"===e.key&&(this.stop(),e.stopPropagation())},n._pointerMoveHandler=function(e){if(!this._showTracker)return;const t={x:e.x,y:e.y},i=this._getScreenPointIntersection(t);r.isSome(i)&&r.isSome(i.point)&&(this._tracker.point.manipulator.location=i.point,this._tracker.isDirty=!0,this._updateLaserLineRenderer(),this._setDirty(b.Task.LINE_OF_SIGHT_TOOL_INTERACTIVE))},n._getScreenPointIntersection=function(e){const t=g.screenPointObjectToArray(e,L.sv2d.get()),i=S.fromScreen(this.view.state.camera,t,U);return this._getRayIntersection(i)},n._getRayIntersection=function(e){if(r.isNone(e))return null;this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this._intersector);const t=this._intersector.results.min;if(!t||!t.getIntersectionPoint(D))return null;const i=new u;this.view.renderCoordsHelper.fromRenderCoords(D,i,this.view.spatialReference);const n=v.create();f.copy(n,t.normal);const s=f.dot(n,e.direction)>0?-1:1;f.scale(n,n,s);const o=t.toGraphic(this.view);if(r.isSome(o)){const r=o.layer,s=o.sourceLayer;let a;if(s)switch(s.type){case"scene":a=T.getObjectId(o,s.objectIdField);break;case"integrated-mesh":{const e=t.target;a=`${e.metadata.nodeIndex}/${e.metadata.componentIndex}`;break}default:a=o.uid}else a=o.uid;return{type:"Graphic",id:`${r.uid}/${a}`,ray:S.copy(e),normal:n,point:i}}if("TerrainRenderer"===t.intersector){return{type:"Terrain",id:t.target.metadata.tile.lij.slice(),ray:S.copy(e),normal:n,point:i}}return null},n._createLineOfSightAnalysis=function(e){const t=this.configuration,i={isValid:!1,isDirty:!0,shouldRender:!0,shouldIntersect:!1,point:{location:e.location,manipulator:this._addManipulator({size:t.targetManipulatorSize,customColor1:t.targetManipulatorVisibleColor,customColor2:t.targetManipulatorOccludedColor,customColor3:t.targetManipulatorUndefinedColor}),intersection:null},isTargetVisible:!1,hasIntersection:!1,target:e,targetHandle:null,engine:{points:{observer:v.create(),target:v.create(),intersection:v.create(),intersectionObserver:v.create(),intersectionTarget:v.create()},visualization:new I}};return r.isSome(e.location)&&(i.point.manipulator.location=e.location),i.targetHandle=m.init(e,"location",(e=>this._onTargetLocationChange(i,e)),!0),this.manipulators.add(i.point.manipulator),this.view._stage.add(1,i.engine.visualization),this._engineLayer.addObject(i.engine.visualization),i},n._destroyLineOfSightAnalysis=function(e){e.targetHandle.remove(),this.manipulators.remove(e.point.manipulator),this.view._stage.remove(1,e.engine.visualization.id),this._engineLayer.removeObject(e.engine.visualization)},n._canComputeAnalysis=function(e){if(r.isNone(this.observer)||r.isNone(e.point)||r.isNone(e.point.location))return!1;this.view.renderCoordsHelper.toRenderCoords(this.observer,D);const t=this.view.frustum.intersectsPoint(D);this.view.renderCoordsHelper.toRenderCoords(e.point.location,D);const i=this.view.frustum.intersectsPoint(D);return t&&i},n._manipulatorGrabChanged=function(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null)}this._updateTrackerVisibility()},n._canUpdateFromIntersectionResult=function(e,t){if(r.isNone(e)||!t||e.type!==t.type)return!1;if("Terrain"===e.type){const i=e.id,n=t.id;return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]||k.tilesAreRelated(i,n)}return("Graphic"===e.type||"I3S"===e.type)&&e.id===t.id},n._updateFromIntersectionResult=function(e){let t;if("Terrain"===e.type&&r.isSome(e.point)){this.view.renderCoordsHelper.toRenderCoords(e.point,N),this.view.renderCoordsHelper.worldUpAtPosition(N,x);const i=this.view.basemapTerrain.elevationBounds,n=this.view.renderCoordsHelper.getAltitude(N),r=i?Math.abs(i.max-i.min)/Math.abs(n):100,s=n>0?1:-1;f.normalize(x,x),f.scale(x,x,s*r),f.add(z,N,x),S.fromPoints(z,N,U),t=this._getRayIntersection(U)}else t=this._getRayIntersection(e.ray);return this._canUpdateFromIntersectionResult(t,e)?t.point:null},n._updateAnalyses=function(e){if(!this.observer)return void this._set("updating",!1);if(this._analyses.some((e=>e.shouldIntersect))){const e=this._observer.intersection,t=e&&this._updateFromIntersectionResult(e);r.isSome(t)&&(this._observer.manipulator.location=t)}this._set("updating",this._updateAnalysis(this._tracker,"tracker")||this._analyses.items.some(((t,i)=>this._updateAnalysis(t,`${i}`,e))))},n._updateAnalysis=function(e,t,i){if(!e.shouldRender)return e.engine.visualization.removeAllGeometries(),e.isDirty=!1,!1;if(!e.isDirty)return!1;if(e.shouldIntersect){const t=e.point.intersection,i=t&&this._updateFromIntersectionResult(t);r.isSome(i)&&(e.point.manipulator.location=i),e.shouldIntersect=!1}this.view.renderCoordsHelper.toRenderCoords(e.point.manipulator.location,e.engine.points.target),this.view.renderCoordsHelper.toRenderCoords(this._observer.manipulator.location,e.engine.points.observer);const n="tracker"===t||this._canComputeAnalysis(e),s=e.engine,o=s.points.observer,a=s.points.target;this._screenPixelSize=this.view.state.camera.computeScreenPixelSizeAt(o),this._observer.intersection?f.copy(x,this._observer.intersection.normal):f.subtract(x,a,o);const l=this._screenPixelSize;f.normalize(x,x),f.scale(x,x,Math.min(l,1)),f.add(z,o,x),e.point.intersection?f.copy(x,e.point.intersection.normal):f.subtract(x,o,a);const c=this.view.state.camera.computeScreenPixelSizeAt(a);if(f.normalize(x,x),f.scale(x,x,Math.min(c,1)),f.add(N,a,x),n){const t=S.fromPoints(z,N,U);if(this.view.sceneIntersectionHelper.intersectToolIntersectorRay(t,this._intersector),e.hasIntersection=!!this._intersector.results.min&&this._intersector.results.min.getIntersectionPoint(F),e.isTargetVisible=!0,e.hasIntersection){f.copy(s.points.intersection,F),f.copy(s.points.intersectionObserver,z),f.copy(s.points.intersectionTarget,N),this.view.renderCoordsHelper.fromRenderCoords(s.points.intersection,D,this.view.spatialReference);const t=1-f.dist(N,a)/f.dist(o,a);e.isTargetVisible=f.dist(o,s.points.intersection)>=t*f.dist(o,a)}e.isValid=!0;const i=new u(D,this.view.spatialReference);e.target.intersectedLocation=e.isTargetVisible?null:i,e.target.intersectedGraphic=e.isTargetVisible?null:this._intersector.results.min.toGraphic(this.view),e.target.visible=!!e.hasIntersection&&e.isTargetVisible}else if(e.isValid){f.copy(F,s.points.intersection);const t=f.dist(e.engine.points.intersectionObserver,s.points.intersection)/f.dist(e.engine.points.intersectionObserver,e.engine.points.intersectionTarget);f.sub(W,z,e.engine.points.intersectionObserver),f.scale(W,W,1-t),f.add(F,F,W),f.sub(W,N,e.engine.points.intersectionTarget),f.scale(W,W,t),f.add(F,F,W)}else e.hasIntersection=!1,e.target.intersectedLocation=null,e.target.intersectedGraphic=null,e.target.visible=void 0;return $[12]=s.points.observer[0],$[13]=s.points.observer[1],$[14]=s.points.observer[2],f.subtract(z,z,s.points.observer),f.subtract(N,N,s.points.observer),f.subtract(F,F,s.points.observer),e.engine.visualization.removeAllGeometries(),e.isValid?(e.point.manipulator.state=e.isTargetVisible?16:32,e.engine.visualization.addGeometry(V.createPolylineGeometry(z,e.isTargetVisible?N:F,`${t}-visible-inner`),this._engineResources.visibleLineMaterialInner,$),e.isTargetVisible?e.engine.visualization.addGeometry(V.createPolylineGeometry(z,e.isTargetVisible?N:F,`${t}-visible-outer`),this._engineResources.visibleLineMaterialOuter,$):(e.engine.visualization.addGeometry(V.createPolylineGeometry(F,N,`${t}-occluded-inner`),this._engineResources.occludedLineMaterialInner,$),e.engine.visualization.addGeometry(V.createPolylineGeometry(z,N,`${t}-occluded-outer`),this._engineResources.occludedLineMaterialOuter,$))):(e.point.manipulator.state=64,e.engine.visualization.addGeometry(V.createPolylineGeometry(z,N,`${t}-observer-inner`),this._engineResources.undefinedLineMaterialInner,$),e.engine.visualization.addGeometry(V.createPolylineGeometry(z,N,`${t}-observer-inner`),this._engineResources.undefinedLineMaterialOuter,$)),e.isDirty=!1,!!i&&(i.madeProgress(),i.done)},t._createClass(i,[{key:"state",get:function(){return this._showTracker?"creating":this.observer?"created":"ready"}},{key:"cursor",get:function(){return this.manipulators.some((({manipulator:e})=>e.focused))?null:this._showTracker?"crosshair":null}},{key:"isSupported",get:function(){return"3d"===this.get("view.type")}}]),i}(P.InteractiveToolBase),i.__decorate([a.property({constructOnly:!0})],e.LineOfSightTool.prototype,"view",void 0),i.__decorate([a.property({dependsOn:["_showTracker","observer"],readOnly:!0})],e.LineOfSightTool.prototype,"state",null),i.__decorate([a.property({readOnly:!0,dependsOn:["_showTracker"]})],e.LineOfSightTool.prototype,"cursor",null),i.__decorate([a.property({dependsOn:["view.type"],readOnly:!0})],e.LineOfSightTool.prototype,"isSupported",null),i.__decorate([a.property({type:u})],e.LineOfSightTool.prototype,"observer",void 0),i.__decorate([a.property({type:H,nonNullable:!0})],e.LineOfSightTool.prototype,"targets",void 0),i.__decorate([a.property({type:G.Configuration})],e.LineOfSightTool.prototype,"configuration",void 0),i.__decorate([a.property({readOnly:!0})],e.LineOfSightTool.prototype,"updating",void 0),i.__decorate([a.property()],e.LineOfSightTool.prototype,"_showTracker",void 0),e.LineOfSightTool=i.__decorate([l.subclass("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],e.LineOfSightTool);const D=v.create(),z=v.create(),N=v.create(),F=v.create(),x=v.create(),U=S.create(),W=v.create(),$=O.create(),j=C.lineSegment.create();e.LineOfSightTargetCollection=H,Object.defineProperty(e,"__esModule",{value:!0})}));
