/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../geometry","../../../../../analysis/SlicePlane","../../../../../core/compilerUtils","../../../../../core/Logger","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/screenUtils","../../../../../chunks/mat4","../../../../../chunks/mat4f64","../../../../../chunks/quat","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../../../geometry/projection","../../../../../geometry/support/Axis","../../../../../chunks/boundedPlane","../../../../../geometry/support/plane","../../../../../geometry/support/ray","../../../../../geometry/support/vector","../../../../../geometry/support/vectorStacks","../../../analysis/support/projectionUtils","../../Manipulator3D","../../manipulatorUtils","./sliceToolConfig","../../visualElements/LineVisualElement","../../visualElements/SlicePlaneVisualElement","../../../support/RenderCoordsHelper","../../../support/geometryUtils/ray","../../../webgl-engine/lib/basicInterfaces","../../../webgl-engine/lib/Geometry","../../../webgl-engine/lib/GeometryUtil","../../../webgl-engine/lib/Material","../../../webgl-engine/lib/VertexAttribute","../../../webgl-engine/materials/ColorMaterial","../../../webgl-engine/materials/ImageMaterial","../../../webgl-engine/materials/NativeLineMaterial","../../../webgl-engine/materials/RibbonLineMaterial","../../../../interactive/interfaces","../../../../../geometry/Extent"],(function(e,t,a,n,s,i,r,o,c,l,d,u,g,p,T,m,R,E,_,O,A,S,f,I,b,h,L,y,N,M,v,F,P,C,H,w,D,U,V){"use strict";const G=s.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function k(e,t,a,n,s,i,r,o){return x(t,r.worldUpAtPosition(e,O.sv3d.get()),s,i,o.basis1,o.basis2),u.scale(o.basis1,o.basis1,a),u.scale(o.basis2,o.basis2,n),u.copy(o.origin,e),R.fromVectorsAndPoint(o.basis2,o.basis1,o.origin,o.plane),o}function x(t,a,n,s,i,r){const o=u.dot(t,a),c=O.sv3d.get(),l=O.sv3d.get();switch(s===e.SliceOrientation.HORIZONTAL_OR_VERTICAL?Math.abs(o)>I.VERTICAL_DOT_THRESHOLD?e.SliceOrientation.HORIZONTAL:e.SliceOrientation.VERTICAL:s){case e.SliceOrientation.VERTICAL:{const e=Math.abs(o)<=I.SMALL_ANGLE_DOT_THRESHOLD?t:n.viewUp;u.cross(c,e,a),u.copy(l,a);break}case e.SliceOrientation.HORIZONTAL:u.cross(c,n.viewUp,a),u.cross(l,a,c);break;case e.SliceOrientation.TILTED:{const e=Math.abs(o)<=I.SMALL_ANGLE_DOT_THRESHOLD?a:n.viewUp;u.cross(c,e,t),u.cross(l,t,c);break}}const d=u.cross(O.sv3d.get(),c,l);u.dot(d,n.viewForward)>0&&u.scale(l,l,-1),u.normalize(i,c),u.normalize(r,l)}function z(e,t,a){const n=t.worldUpAtPosition(e.origin,O.sv3d.get()),s=e.basis1,i=Re(e,n),r=Math.round(i/Ne)*Ne;return m.rotate(e,r-i,s,a)}function Z(e,t,a,n,s,i){const r=u.copy(O.sv3d.get(),s.origin);u.add(r,r,u.scale(O.sv3d.get(),s.basis1,e.direction[0]<0?1:-1)),u.add(r,r,u.scale(O.sv3d.get(),s.basis2,e.direction[1]<0?1:-1));const o=u.length(s.basis1),c=u.length(s.basis2),l=u.subtract(O.sv3d.get(),a,r),d=u.subtract(O.sv3d.get(),t,r);let g=0,p=0;if(se(e)){const t=ne(s),a=ne(i);g=o-.5*e.direction[0]*u.dot(s.basis1,d)/o,p=c-.5*e.direction[1]*u.dot(s.basis2,d)/c;const n=a/t;g*=n,p*=n}const T=g+.5*e.direction[0]*u.dot(s.basis1,l)/o,R=p+.5*e.direction[1]*u.dot(s.basis2,l)/c,E=u.scale(O.sv3d.get(),s.basis1,T/o),_=u.scale(O.sv3d.get(),s.basis2,R/c);(T<=0||te(i.origin,E,n)<=I.PLANE_MIN_BASIS_SCREEN_LEN2)&&u.copy(E,i.basis1),(R<=0||te(i.origin,_,n)<=I.PLANE_MIN_BASIS_SCREEN_LEN2)&&u.copy(_,i.basis2);const A=u.copy(O.sv3d.get(),r);return u.add(A,A,u.scale(O.sv3d.get(),E,e.direction[0]<0?-1:1)),u.add(A,A,u.scale(O.sv3d.get(),_,e.direction[1]<0?-1:1)),m.fromValues(A,E,_,i)}function j(e,t){return I.INITIAL_PLANE_HALF_SIZE_VIEW_PROPORTION*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function W(e,t,a,n){const s=u.cross(O.sv3d.get(),t,a);return u.cross(s,s,t),R.fromPositionAndNormal(e,s,n)}function B(e,t){return f.calculateTranslateRotateFromBases(e.basis1,e.basis2,e.origin,t)}function X(t,a,n,s){const i=a.worldUpAtPosition(t.origin,O.sv3d.get()),r=O.sv3d.get();switch(n){case e.RotationAxis.HEADING:u.copy(r,i);break;case e.RotationAxis.TILT:u.copy(r,t.basis1)}return R.fromPositionAndNormal(t.origin,r,s)}function Y(e,t,a,n){const s=ee(a,J.NEGATIVE_X),i=O.sm4d.get();c.rotateZ(i,t,s.edge*Math.PI/2);const r=u.normalize(O.sv3d.get(),s.basis);let l=u.scale(O.sv3d.get(),r,s.direction*n.computeScreenPixelSizeAt(s.position)*I.SHIFT_RESTART_OFFSET_DISTANCE);u.add(l,l,s.position);const d=n.projectToRenderScreen(l,o.castRenderScreenPointArray3(O.sv3d.get())),p=q(n,d);y.fromRender(n,d,ye),u.normalize(ye.direction,ye.direction);const T=O.sv3d.get();!p&&m.intersectRay(a,ye,T)&&(l=T),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=g.clone(l),p?e.state|=Le:e.state&=~Le}function q(e,t){const[a,n,s,i]=e.viewport,r=Math.min(s,i)/16;let o=!0;return t[0]<a+r?(t[0]=a+r,o=!1):t[0]>a+s-r&&(t[0]=a+s-r,o=!1),t[1]<n+r?(t[1]=n+r,o=!1):t[1]>n+i-r&&(t[1]=n+i-r,o=!1),o}function Q(e,t,a,n){const s=u.length(n.basis1),i=u.length(n.basis2),r=ae(n),o=ne(n),l=u.set(O.sv3d.get(),0,0,0);u.add(l,u.scale(O.sv3d.get(),n.basis1,t.direction[0]),u.scale(O.sv3d.get(),n.basis2,t.direction[1])),u.add(l,n.origin,l);let d=0,g=1;if(se(t))1===t.direction[0]&&-1===t.direction[1]?d=Ne:1===t.direction[0]&&1===t.direction[1]?d=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(d=3*Math.PI/2),g=o;else{const e=0!==t.direction[0]?1:2;d=1===e?Ne:0,g=(1===e?i:s)-r}const p=c.fromZRotation(O.sm4d.get(),d);c.scale(p,p,u.set(O.sv3d.get(),g,g,g)),c.multiply(p,a,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=l}function K(e,t,a,n){const s=n.worldUpAtPosition(a.origin,O.sv3d.get()),i=ee(a,J.POSITIVE_X),r=c.fromZRotation(O.sm4d.get(),i.edge*Math.PI/2);c.rotateX(r,r,-Re(a,s)),c.multiply(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=i.position}function $(e,t,a){const n=ee(a,J.POSITIVE_Y),s=c.fromZRotation(O.sm4d.get(),n.edge*Math.PI/2);c.rotateX(s,s,Ne),c.multiply(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=n.position}var J;function ee(e,t){switch(t){case J.POSITIVE_X:return{basis:e.basis1,direction:1,position:u.add(O.sv3d.get(),e.origin,e.basis1),edge:t};case J.POSITIVE_Y:return{basis:e.basis2,direction:1,position:u.add(O.sv3d.get(),e.origin,e.basis2),edge:t};case J.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:u.subtract(O.sv3d.get(),e.origin,e.basis1),edge:t};case J.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:u.subtract(O.sv3d.get(),e.origin,e.basis2),edge:t}}}function te(e,t,a){const n=a.projectToRenderScreen(u.add(O.sv3d.get(),e,t),o.castRenderScreenPointArray3(O.sv3d.get())),s=a.projectToRenderScreen(u.subtract(O.sv3d.get(),e,t),o.castRenderScreenPointArray3(O.sv3d.get()));return u.squaredLength(u.subtract(n,n,s))}function ae(e){const t=u.length(e.basis1),a=u.length(e.basis2);return I.RESIZE_HANDLE_EDGE_PADDING_FRAC*Math.min(t,a)}function ne(e){return ae(e)}function se(e){return 0!==e.direction[0]&&0!==e.direction[1]}function ie(t,a=e.OffsetMode.CENTER_ON_ARROW){const n=a===e.OffsetMode.CENTER_ON_CALLOUT?I.SHIFT_RESTART_OFFSET_DISTANCE:0,s=[g.fromValues(n,0,-I.SHIFT_RESTART_ARROW_LENGTH/2),g.fromValues(n,0,I.SHIFT_RESTART_ARROW_LENGTH/2)],i=ge(s,!0),r=(e,t)=>de(s,s,{tubeRadius:I.SHIFT_RESTART_TUBE_RADIUS,tipRadius:I.SHIFT_RESTART_TIP_RADIUS,tipLength:I.SHIFT_RESTART_TIP_LENGTH,tubeFocusMultiplier:I.SHIFT_RESTART_TUBE_FOCUS_MULTIPLIER,tipFocusMultiplier:I.SHIFT_RESTART_TIP_FOCUS_MULTIPLIER,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),o=r(0,!1),c=r(I.SHIFT_RESTART_ARROW_OUTLINE_WIDTH,!0),l=new C.ColorMaterial({color:I.SHIFT_RESTART_ARROW_TIP_COLOR,cullFace:N.CullFaceOptions.Back,renderOccluded:F.RenderOccludedFlag.Opaque}),d=new C.ColorMaterial({color:I.SHIFT_RESTART_ARROW_CAP_COLOR,cullFace:N.CullFaceOptions.Back,renderOccluded:F.RenderOccludedFlag.Opaque}),u=new C.ColorMaterial({color:I.SHIFT_RESTART_TUBE_COLOR,cullFace:N.CullFaceOptions.Back,renderOccluded:F.RenderOccludedFlag.Opaque}),p=new C.ColorMaterial({color:I.SHIFT_RESTART_OUTLINE_COLOR,transparent:!0,writeDepth:!1,cullFace:N.CullFaceOptions.Front,renderOccluded:F.RenderOccludedFlag.Transparent}),T=v.createPolylineGeometry([[n,0,0],[n-I.SHIFT_RESTART_OFFSET_DISTANCE,0,0]]),m=v.createPolylineGeometry([[n,0,0],[n-I.SHIFT_RESTART_OFFSET_DISTANCE,0,0]]),R=new w.NativeLineMaterial({color:I.SHIFT_RESTART_CALLOUT_COLOR,renderOccluded:F.RenderOccludedFlag.OccludeAndTransparent});return new S.Manipulator3D({view:t,renderObjects:[...o.normal.map((({part:e,geometry:t,transform:a})=>({geometry:t,material:"tip"===e?l:"cap"===e?d:u,transform:a,stateMask:U.ManipulatorStateFlags.Unfocused|Ie}))),...c.normal.map((({geometry:e,transform:t})=>({geometry:e,material:p,transform:t,stateMask:U.ManipulatorStateFlags.Unfocused|Ie}))),{geometry:T,material:R,stateMask:U.ManipulatorStateFlags.Unfocused|Ie|Le},...o.focused.map((({part:e,geometry:t,transform:a})=>({geometry:t,material:"tip"===e?l:"cap"===e?d:u,transform:a,stateMask:U.ManipulatorStateFlags.Focused|Ie}))),...c.focused.map((({geometry:e,transform:t})=>({geometry:e,material:p,transform:t,stateMask:U.ManipulatorStateFlags.Focused|Ie}))),{geometry:m,material:R,stateMask:U.ManipulatorStateFlags.Focused|Ie|Le}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[i]},collisionPriority:1,radius:I.SHIFT_RESTART_TIP_RADIUS,state:Ie})}function re(e,t){const a=new H.ImageMaterial({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:F.RenderOccludedFlag.Opaque}),n=I.ROTATE_HEADING_OFFSET_DISTANCE,s=I.ROTATE_HEADING_DISC_RADIUS,i=s*I.ROTATE_HEADING_DISC_RADIUS_FOCUS_MULTIPLIER,r=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new M.Geometry([[P.VertexAttribute.POSITION,{size:3,data:[n-e,-e,0,n+e,-e,0,n+e,e,0,n-e,e,0],exclusive:!0}],[P.VertexAttribute.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[P.VertexAttribute.POSITION,t],[P.VertexAttribute.UV0,t]])},o=v.createPolylineGeometry([[0,0,0],[n-s,0,0]]),c=v.createPolylineGeometry([[0,0,0],[n-i,0,0]]),l=new w.NativeLineMaterial({color:I.ROTATE_HEADING_CALLOUT_COLOR,renderOccluded:F.RenderOccludedFlag.OccludeAndTransparent}),d=[{geometry:r(s),material:a,stateMask:U.ManipulatorStateFlags.Unfocused|Ie},{geometry:o,material:l,stateMask:U.ManipulatorStateFlags.Unfocused|Ie},{geometry:r(i),material:a,stateMask:U.ManipulatorStateFlags.Focused|Ie},{geometry:c,material:l,stateMask:U.ManipulatorStateFlags.Focused|Ie}];return new S.Manipulator3D({view:e,renderObjects:d,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[n,0,0]},collisionPriority:1,radius:s/2,state:Ie})}function oe(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new b.LineVisualElement({view:e,attached:!0,color:I.PLANE_OUTLINE_COLOR,width:I.PLANE_OUTLINE_WIDTH,writeDepthEnabled:!1,renderOccluded:F.RenderOccludedFlag.OccludeAndTransparent,geometry:[t]})}function ce(e){return new h.SlicePlaneVisualElement({view:e,attached:!0,backgroundColor:[...I.PLANE_BACKGROUND_COLOR],gridColor:I.GRID_COLOR,gridWidth:4,renderOccluded:F.RenderOccludedFlag.OccludeAndTransparent})}function le(e,t){const a=se(t),n=a?[g.fromValues(1,0,0),g.fromValues(0,0,0),g.fromValues(0,1,0)]:[g.fromValues(1,0,0),g.fromValues(-1,0,0)],s=v.createPolylineGeometry(n),i=I.RESIZE_HANDLE_COLOR,r=e=>new D.RibbonLineMaterial({color:i,width:e,renderOccluded:F.RenderOccludedFlag.OccludeAndTransparent}),o=()=>new w.NativeLineMaterial({color:i,renderOccluded:F.RenderOccludedFlag.OccludeAndTransparent}),c=a?I.RESIZE_HANDLE_CORNER_WIDTH:I.RESIZE_HANDLE_EDGE_WIDTH,l=c*I.DISPLAY_FOCUS_MULTIPLIER,d=I.RESIZE_HANDLE_EDGE_WIDTH,u=e=>e>1?r(e):o(),p=[{geometry:s,material:u(c),stateMask:U.ManipulatorStateFlags.Unfocused|Me},{geometry:s,material:u(l),stateMask:U.ManipulatorStateFlags.Focused|Me},{geometry:s,material:u(d),stateMask:ve}],T=new S.Manipulator3D({view:e,renderObjects:p,collisionType:{type:"line",paths:[n]},autoScaleRenderObjects:!1,worldSized:!0,radius:a?I.RESIZE_HANDLE_CORNER_INPUT_RADIUS:I.RESIZE_HANDLE_EDGE_INPUT_RADIUS});return T.state=Me,T}function de(e,t,a){const n=n=>{const s=(n?t:e).slice(0),i=u.subtract(O.sv3d.get(),s[0],s[1]);u.normalize(i,i);const o=u.subtract(O.sv3d.get(),s[s.length-1],s[s.length-2]);if(u.normalize(o,o),a.padding>0){const e=u.scale(g.create(),o,-a.padding);if(s[s.length-1]=u.add(e,e,s[s.length-1]),a.bothEnds){const e=u.scale(g.create(),i,-a.padding);s[0]=u.add(e,e,s[0])}}const p=n?a.tipFocusMultiplier:1,T=a.tipLength*(a.focusTipLength?p:1),m=a.tipRadius*p,R=c.identity(O.sm4d.get());if(a.padding>0){const e=T/4,t=u.set(O.sv3d.get(),0,e,0),n=1+a.padding/e;c.translate(R,R,t),c.scale(R,R,u.set(O.sv3d.get(),n,n,n)),c.translate(R,R,u.scale(t,t,-1/n))}const E=c.identity(l.create()),_=g.fromValues(0,1,0),A=c.fromQuat(l.create(),d.rotationTo(O.sq4d.get(),_,o));A[12]=s[s.length-1][0],A[13]=s[s.length-1][1],A[14]=s[s.length-1][2],c.multiply(A,A,R);const S=[{part:"tube",geometry:ue(a.tubeRadius*(n?a.tubeFocusMultiplier:1)+a.padding,a.flat,s),transform:E}];let f,I;if(r.isSome(a.flat)?f=v.createExtrudedTriangle(T,m,m,a.flat.thickness):(f=v.createConeGeometry(T,m,24,!1,!1,!0),I=v.createConeGeometry(T,m,24,!1,!0,!1)),S.push({part:"tip",geometry:f,transform:A}),I&&S.push({part:"cap",geometry:I,transform:A}),a.bothEnds){const e=c.fromQuat(l.create(),d.rotationTo(O.sq4d.get(),_,i));e[12]=s[0][0],e[13]=s[0][1],e[14]=s[0][2],c.multiply(e,e,R),S.push({part:"tip",geometry:f,transform:e}),I&&S.push({part:"cap",geometry:I,transform:e})}return S};return{normal:n(!1),focused:n(!0)}}function ue(e,t,a){const n=[];if(r.isSome(t))n.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let a=0;a<t;a++){const s=a/t*2*Math.PI;n.push([Math.cos(s)*e,Math.sin(s)*e])}}return v.createPathExtrusionGeometry(n,a,[],[],!1)}function ge(e,t){const a=u.subtract(g.create(),e[e.length-1],e[e.length-2]);if(u.normalize(a,a),u.scale(a,a,I.ROTATE_HEADING_TIP_LENGTH),u.add(a,a,e[e.length-1]),t){const t=u.subtract(g.create(),e[0],e[1]);return u.normalize(t,t),u.scale(t,t,I.ROTATE_HEADING_TIP_LENGTH),u.add(t,t,e[0]),[t,...e,a]}return[...e,a]}function pe(e,t,n,s=new a){if(r.isNone(e))return null;const{renderCoordsHelper:o}=t,c=o.fromRenderCoords(e.origin,t.spatialReference);if(r.isNone(c))return null;const l=p.tryProjectWithZConversion(c,n);if(r.isNone(l))return null;s.position=l;const d=o.worldUpAtPosition(e.origin,O.sv3d.get()),g=o.worldBasisAtPosition(e.origin,T.Axis.Y,O.sv3d.get()),m=2*u.length(e.basis1),R=2*u.length(e.basis2),E=L.RenderCoordsHelper.renderUnitScaleFactor(t.spatialReference,n);return s.width=m*E,s.height=R*E,s.tilt=i.rad2deg(Re(e,d)),s.heading=i.rad2deg(Ee(e,d,g)),s}function Te(e,t,a){if(r.isNone(e)||r.isNone(e.position))return null;const{spatialReference:n}=e.position,s=me(Ae(e,{renderCoordsHelper:t,spatialReference:n},a),t,n);return!e.position.hasZ&&r.isSome(s)&&(s.zmin=null,s.zmax=null),s}function me(e,t,a){if(r.isNone(e))return null;const n=e.origin,s=O.sv3d.get(),i=O.sv3d.get(),o=O.sv3d.get(),c=O.sv3d.get();let l,d,g,p,T,m;u.add(s,n,e.basis1),u.add(s,s,e.basis2),u.add(i,n,e.basis1),u.sub(i,i,e.basis2),u.sub(o,n,e.basis1),u.sub(o,o,e.basis2),u.sub(c,n,e.basis1),u.add(c,c,e.basis2);for(const u of[s,i,o,c]){const e=t.fromRenderCoords(u,u,a);if(r.isNone(e))return null;l=null==l?e[0]:Math.min(l,e[0]),d=null==d?e[0]:Math.max(d,e[0]),g=null==g?e[1]:Math.min(g,e[1]),p=null==p?e[1]:Math.max(p,e[1]),T=null==T?e[2]:Math.min(T,e[2]),m=null==m?e[2]:Math.max(m,e[2])}return new V({xmin:l,xmax:d,ymin:g,ymax:p,zmin:T,zmax:m,spatialReference:a})}function Re(e,t){return _.angleAroundAxis(t,e.basis2,e.basis1)+Ne}function Ee(e,t,a){return _.angleAroundAxis(e.basis1,a,t)-Ne}function _e(e,t,a,n,s,r,o=m.create()){return r.toRenderCoords(e,o.origin)?(r.worldBasisAtPosition(o.origin,T.Axis.X,o.basis1),r.worldBasisAtPosition(o.origin,T.Axis.Y,o.basis2),R.fromVectorsAndPoint(o.basis2,o.basis1,o.origin,o.plane),m.rotate(o,-i.deg2rad(t),m.normal(o),o),m.rotate(o,i.deg2rad(a),o.basis1,o),u.scale(o.basis1,o.basis1,n/2),u.scale(o.basis2,o.basis2,s/2),m.updateUnboundedPlane(o),o):(G.error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Oe(e,t){if(r.isNone(e)||r.isNone(e.position))return null;const a=A.applyProjectionAndElevationAlignment(e.position,t.spatialReference,t.elevationProvider);if(r.isNone(a))return null;const n=L.RenderCoordsHelper.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),s=e.width*n,i=e.height*n;return{position:a,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:i}}function Ae(e,t,a,n=m.create()){const s=Oe(e,t);return r.isNone(s)?null:Se(s,t,a,n)}function Se(e,t,a,n=m.create()){if(r.isNone(e))return null;const s=_e(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,n);return!a.tiltEnabled&&r.isSome(s)&&z(s,t.renderCoordsHelper,s),s}function fe(e){switch(e.type){case"analysis":case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return n.neverReached(e.type),!1}}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(J||(J={}));const Ie=U.ManipulatorStateCustomFlags.Custom1;var be,he;e.RotationAxis=void 0,(be=e.RotationAxis||(e.RotationAxis={}))[be.HEADING=1]="HEADING",be[be.TILT=2]="TILT",e.SliceOrientation=void 0,(he=e.SliceOrientation||(e.SliceOrientation={}))[he.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",he[he.HORIZONTAL=1]="HORIZONTAL",he[he.VERTICAL=2]="VERTICAL",he[he.TILTED=3]="TILTED";const Le=U.ManipulatorStateCustomFlags.Custom2,ye=E.create(),Ne=Math.PI/2,Me=U.ManipulatorStateCustomFlags.Custom1,ve=U.ManipulatorStateCustomFlags.Custom2;var Fe;function Pe(e){const t="building-scene-3d"===e.type?e:null;return r.isSome(t)}e.OffsetMode=void 0,(Fe=e.OffsetMode||(e.OffsetMode={}))[Fe.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",Fe[Fe.CENTER_ON_ARROW=1]="CENTER_ON_ARROW",e.DidPointerMoveRecentlyFlag=Ie,e.IsShiftEdgeOnScreenFlag=Le,e.addArrowTips=ge,e.calculateBoundedPlaneTranslateRotate=B,e.calculateDiagonalResizeHandleScale=ne,e.calculatePlaneHalfSize=j,e.calculateResizeHandlePadding=ae,e.calculateScreenSpaceBasisLength2=te,e.createArrowGeometry=de,e.createGridVisualElement=ce,e.createOutlineVisualElement=oe,e.createPlane=k,e.createResizeManipulator=le,e.createRotateManipulator=re,e.createRotatePlane=X,e.createShiftManipulator=ie,e.createShiftPlane=W,e.forceHorizontalOrVertical=z,e.isAlwaysDrapedLayer=fe,e.isDiagonalResizeHandle=se,e.isIBuildingSceneLayerView3D=Pe,e.normalToBases=x,e.planeToExtent=me,e.planeToShape=pe,e.projectAndElevationAlignShape=Oe,e.projectedShapeToPlane=Se,e.resizeNormal=Me,e.resizeOutlineOnly=ve,e.resizePlane=Z,e.shapeToExtent=Te,e.shapeToPlane=Ae,e.updateResizeHandle=Q,e.updateRotateHeadingHandle=K,e.updateRotateTiltHandle=$,e.updateShiftRestartHandle=Y,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
