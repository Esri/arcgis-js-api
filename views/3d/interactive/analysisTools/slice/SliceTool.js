/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/clock","../../../../../core/Handles","../../../../../core/maybe","../../../../../core/scheduling","../../../../../core/screenUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/accessorSupport/ensureType","../../../../../core/Logger","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/mat4","../../../../../chunks/vec3","../../../../../chunks/vec3f64","../../../../../chunks/boundedPlane","../../../../../geometry/support/plane","../../../../../geometry/support/ray","../../../../../geometry/support/vectorStacks","../../manipulatorUtils","./sliceToolConfig","./sliceToolUtils","./images/heading-rotate-png","./images/tilt-rotate-png","../../editingTools/dragEventPipeline3D","../../../support/geometryUtils/ray","../../../webgl-engine/lib/Intersector","../../../webgl-engine/lib/Texture","../../../../interactive/dragEventPipeline","../../../../interactive/InteractiveToolBase","../../../../interactive/interactiveToolUtils","../../../../support/screenUtils","../../../../../widgets/Slice/SlicePlane"],(function(e,t,i,a,n,r,s,o,l,h,c,u,p,d,_,y,v,P,w,f,g,m,M,T,D,V,b,E,S,R,k,O,H){"use strict";let x=function(t){function o(e){var n;return(n=t.call(this,e)||this).clock=i.default,n._previewPlaneOpacity=1,n.layerView=null,n.cursor=null,n.layersMode="none",n.tiltEnabled=!1,n.shiftManipulator=null,n.rotateHeadingManipulator=null,n.rotateTiltManipulator=null,n.resizeManipulators=null,n.disableEngineLayers=!1,n._handles=new a,n._viewHandles=new a,n._frameTask=null,n._prevPointerMoveTimeout=null,n._previewPlaneGridVisualElement=null,n._previewPlaneOutlineVisualElement=null,n._startPlane=y.create(),n._previewPlane=null,n._activeKeyModifiers={},n._lastCursorPosition=s.createScreenPoint(),n._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],n._intersector=new b.Intersector(e.view.state.viewingMode),n._intersector.options.store=0,n}e._inheritsLoose(o,t);var l=o.prototype;return l.onAttach=function(){this.created&&this.visible&&this._updateManipulators()},l.initialize=function(){this._initialize()},l._initialize=function(){var t=e._asyncToGenerator((function*(){const e=()=>{switch(this.toolState){case"created":case"creating":throw new Error("unexpected toolState");case"destroyed":return!1}return!0};if(!e())return;if(this.layerView=yield this.view.whenLayerView(this.analysis),!e())return;if(null==this.analysis)throw new Error("SliceTool requires valid model, but null was provided.");if(n.isNone(this.layerView.layerViewData))throw new Error("expected internal object to be defined.");this.layerViewData=this.layerView.layerViewData,this.rotateHeadingTexture=new E.Texture(M,{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.rotateTiltTexture=new E.Texture(T,{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&(this.view._stage.add(this.rotateHeadingTexture),this.view._stage.add(this.rotateTiltTexture));const t=this.watch("state",(e=>{switch(e){case"ready":case"slicing":this.finishToolCreation();break;case"sliced":this.complete()}}),!0);"sliced"===this.state?this.complete():this.startToolCreation(),this._handles.add([t,this.view.state.watch("camera",(()=>this._onCameraChange()))]);const i=e=>{this.updateManipulatorsInteractive(e),e.grabbing||(n.isSome(this.layerViewData.plane)&&y.copy(this.layerViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=m.createShiftManipulator(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(e=>{this._onShiftGrab(e),i(this.shiftManipulator)})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=m.createRotateManipulator(this.view,this.rotateHeadingTexture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(e=>{this._onRotateHeadingGrab(e),i(this.rotateHeadingManipulator)})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=m.createRotateManipulator(this.view,this.rotateTiltTexture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(e=>{this._onRotateTiltGrab(e),i(this.rotateTiltManipulator)})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map(((e,t)=>{const a=m.createResizeManipulator(this.view,e);return a.events.on("grab-changed",(e=>{this._onResizeGrab(e,t),i(a)})),this._handles.add(this._createResizeDragPipeline(a)),a})),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=m.createGridVisualElement(this.view),this._previewPlaneOutlineVisualElement=m.createOutlineVisualElement(this.view),this._previewPlaneOutlineVisualElement.width=g.PLANE_PREVIEW_OUTLINE_WIDTH,this._handles.add(this.layerViewData.watch("plane",(()=>this._updateManipulators()),!0)),this._updateManipulators(),this._updateVisibility(this.visible)}));function i(){return t.apply(this,arguments)}return i}(),l.destroy=function(){switch(this.toolState){case"pending":return this._handles=n.destroyMaybe(this._handles),void(this._viewHandles=n.destroyMaybe(this._viewHandles));case"destroyed":return}this.view._stage&&(this.view._stage.remove(this.rotateHeadingTexture),this.view._stage.remove(this.rotateTiltTexture)),this.detach(),this._handles.destroy(),this._handles=null,this._viewHandles.destroy(),this._viewHandles=null,this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=n.destroyMaybe(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=n.destroyMaybe(this._previewPlaneGridVisualElement)},l.enterExcludeLayerMode=function(){n.isNone(this.layerViewData.plane)||(this._set("layersMode","exclude"),k.setActive(this,!0))},l.exitExcludeLayerMode=function(){n.isNone(this.layerViewData.plane)||(this._set("layersMode","none"),k.setActive(this,!1))},l.deactivate=function(){this._updateMouseCursor(),this._set("layersMode","none"),this._updatePreviewPlane(null)},l.onDetach=function(){this.created&&this._set("layersMode","none")},l.onShow=function(){this._updateVisibility(!0)},l.onHide=function(){this._updateVisibility(!1)},l._updateVisibility=function(e){this.analysis.visible=e,this.created&&(this._updateMouseCursor(),this._updateManipulators(),this._updateVisualElementVisibility(),e||this._clearPointerMoveTimeout())},l.onInputEvent=function(e){switch(e.type){case"pointer-drag":if(!N(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&(e.stopPropagation(),this._updateMouseCursor()):this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e),this._updateMouseCursor();break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!N(e))return;this._onClickPlacePlane(e)&&(e.stopPropagation(),this._updateMouseCursor());break;case"click":if(!N(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}},l.onEditableChange=function(){this.layerView.editable=this.editable},l._onPointerDrag=function(e){if(e.pointerId===this._creatingPointerId){const t=O.createScreenPointFromEvent(e);return this.shiftManipulator.events.emit("drag",{action:"start",pointerType:e.pointerType,start:t,screenPoint:t}),!0}return!1},l._onPointerMove=function(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane(O.createScreenPointFromEvent(e),this._activeKeyModifiers)},l._onCameraChange=function(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()},l._onPointerUp=function(e){return!(e.pointerId!==this._creatingPointerId||!n.isSome(this.layerViewData.plane))&&(y.copy(this.layerViewData.plane,this._startPlane),this.inputState=null,!0)},l._onClickPlacePlane=function(e){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){const t=O.createScreenPointFromEvent(e),i=y.create();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){y.copy(i,this._startPlane);const a=this._calculatePickRay(t);return this.analysis.plane=m.planeToShape(i,this.view.renderCoordsHelper,this.view.spatialReference,new H),this.inputState=C(a,e.pointerId,i.origin,i),!0}}return!1},l._onClickExcludeLayer=function(e){return!("exclude"!==this.layersMode||!this.created)&&(this.view.hitTest(O.createScreenPointFromEvent(e)).then((e=>{if(e.results.length){const t=e.results[0],i=t&&t.graphic;if(i){const e=i.sourceLayer||i.layer;e&&this.layerViewData.excludedLayers.push(e)}}else e.ground.layer?this.layerViewData.excludedLayers.push(e.ground.layer):this.layerViewData.excludeGroundSurface=!0})),this._set("layersMode","none"),k.setActive(this,!1),!0)},l._onKeyDown=function(e){return(e.key===g.forceVerticalModifier||e.key===g.forceHorizontalModifier)&&(this._activeKeyModifiers[e.key]=!0,n.isSome(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)},l._onKeyUp=function(e){return!(e.key!==g.forceVerticalModifier&&e.key!==g.forceHorizontalModifier||!this._activeKeyModifiers[e.key])&&(delete this._activeKeyModifiers[e.key],n.isSome(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)},l._onShiftGrab=function(e){if("start"!==e.action||n.isNone(this.layerViewData.plane))return;const t=this._calculatePickRay(e.screenPoint);y.copy(this.layerViewData.plane,this._startPlane),this.inputState=C(t,null,this.shiftManipulator.renderLocation,this.layerViewData.plane)},l._createShiftDragPipeline=function(e){return S.createManipulatorDragEventPipeline(e,((e,t,i)=>{const a=this.inputState;if(!a||"shift"!==a.type)return;const r=n.isSome(this.layerViewData.plane)?y.copy(this.layerViewData.plane,y.create()):null;t.next(D.screenToRenderPlane(this.view,a.shiftPlane)).next(this._shiftDragAdjustSensitivity(a)).next(this._shiftDragUpdatePlane(a)),i.next((()=>{n.isSome(r)&&this._updateBoundedPlane(r)}))}))},l._shiftDragAdjustSensitivity=function(e){return t=>{if(n.isNone(this.layerViewData.plane))return null;const i=.001,a=Math.min((1-Math.abs(d.dot(y.normal(this.layerViewData.plane),t.ray.direction)/d.length(t.ray.direction)))/i,1),r=-v.signedDistance(this._startPlane.plane,t.renderEnd),s=-v.signedDistance(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-a)+r*a-s,t}},l._shiftDragUpdatePlane=function(e){return()=>{if(n.isNone(this.layerViewData.plane))return;const t=d.copy(w.sv3d.get(),this._startPlane.origin),i=d.copy(w.sv3d.get(),y.normal(this._startPlane));d.scale(i,i,-e.depth),d.add(i,i,t);const a=y.fromValues(i,this.layerViewData.plane.basis1,this.layerViewData.plane.basis2,y.create());this._updateBoundedPlane(a)}},l._onRotateHeadingGrab=function(e){if("start"!==e.action||n.isNone(this.layerViewData.plane))return;const t=m.createRotatePlane(this.layerViewData.plane,this.view.renderCoordsHelper,1,v.create()),i=this._calculatePickRay(e.screenPoint),a=_.create();v.intersectRay(t,i,a)&&(y.copy(this.layerViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})},l._createRotateHeadingDragPipeline=function(e){return S.createManipulatorDragEventPipeline(e,((e,t,i)=>{const a=this.inputState;if(!a||"rotate"!==a.type)return;const r=n.isSome(this.layerViewData.plane)?y.copy(this.layerViewData.plane,y.create()):null;t.next(D.screenToRenderPlane(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{n.isSome(r)&&this._updateBoundedPlane(r)}))}))},l._onRotateTiltGrab=function(e){if("start"!==e.action||n.isNone(this.layerViewData.plane))return;const t=m.createRotatePlane(this.layerViewData.plane,this.view.renderCoordsHelper,2,v.create()),i=this._calculatePickRay(e.screenPoint),a=_.create();v.intersectRay(t,i,a)&&(y.copy(this.layerViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})},l._createRotateTiltDragPipeline=function(e){return S.createManipulatorDragEventPipeline(e,((e,t,i)=>{const a=this.inputState;if(!a||"rotate"!==a.type)return;const r=n.isSome(this.layerViewData.plane)?y.copy(this.layerViewData.plane,y.create()):null;t.next(D.screenToRenderPlane(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{n.isSome(r)&&this._updateBoundedPlane(r)}))}))},l._rotateDragRenderPlaneToRotate=function(e){return t=>{if(n.isNone(this.layerViewData.plane))return null;const i=v.normal(e.rotatePlane),a=f.calculateInputRotationTransform(this.inputState.startPoint,t.renderEnd,this.layerViewData.plane.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}},l._rotateDragUpdatePlaneFromRotate=function(){return e=>{if(n.isNone(this.layerViewData.plane))return;const t=p.identity(w.sm4d.get());p.rotate(t,t,e.rotateAngle,e.rotateAxis);const i=d.transformMat4(w.sv3d.get(),this._startPlane.basis1,t),a=d.transformMat4(w.sv3d.get(),this._startPlane.basis2,t),r=y.fromValues(this.layerViewData.plane.origin,i,a,y.create());this._updateBoundedPlane(r)}},l._onResizeGrab=function(e,t){if("start"!==e.action||n.isNone(this.layerViewData.plane))return;const i=this._calculatePickRay(e.screenPoint),a=w.sv3d.get();v.intersectRay(this.layerViewData.plane.plane,i,a)&&(y.copy(this.layerViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:_.clone(a)})},l._createResizeDragPipeline=function(e){return S.createManipulatorDragEventPipeline(e,((e,t,i)=>{const a=this.inputState;if(!a||"resize"!==a.type||n.isNone(this.layerViewData.plane))return;const r=y.copy(this.layerViewData.plane,y.create());t.next(D.screenToRenderPlane(this.view,this.layerViewData.plane.plane)).next(this._resizeDragUpdatePlane(a)),i.next((()=>{this._updateBoundedPlane(r)}))}))},l._resizeDragUpdatePlane=function(e){return t=>{if(n.isNone(this.layerViewData.plane))return;const i=this._resizeHandles[e.activeHandleIdx],a=m.resizePlane(i,this.inputState.startPoint,t.renderEnd,this.view.state.camera,this._startPlane,y.copy(this.layerViewData.plane));this._updateBoundedPlane(a)}},l._updateBoundedPlane=function(e){const t=this.layerViewData;if(!n.isSome(t))throw new Error("valid internal object expected");t.plane=e},l._updatePreviewPlane=function(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,n.isNone(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.layerViewData.plane&&this.active){const a=n.isSome(i)?i:y.create();if(i=n.isSome(i)?y.copy(i,L):null,this._pickPlane(e,!0,t,a)){const e=g.PREVIEW_FADE_DOT_THRESHOLD;let t=!1;n.isSome(i)&&(t=d.dot(i.plane,a.plane)<e||d.dot(d.normalize(w.sv3d.get(),i.basis1),d.normalize(w.sv3d.get(),a.basis1))<e),t&&(this._previewPlaneOpacity=0),this._previewPlane=a}}n.isSome(this._previewPlane)&&n.isNone(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=r.addFrameTask({update:({deltaTime:e})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+e/(1e3*g.PREVIEW_FADE_DURATION_SECONDS),1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask()}}):n.isNone(this._previewPlane)&&n.isSome(this._frameTask)?this._removeFrameTask():n.isSome(this._previewPlane)&&this._updateManipulators()},l._removeFrameTask=function(){n.isSome(this._frameTask)&&(this._frameTask.remove(),this._frameTask=null)},l._calculatePickRay=function(e){const t=P.create(),i=s.screenPointObjectToArray(e,I);return V.fromScreen(this.view.state.camera,i,t),d.normalize(t.direction,t.direction),t},l._pickMinResult=function(e){const t=s.screenPointObjectToArray(e,w.sv2d.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min},l._pickPlane=function(e,t,i,a){const n=this._pickMinResult(e),r=w.sv3d.get();if(!n.getIntersectionPoint(r))return!1;const s=n.getTransformedNormal(w.sv3d.get()),o=this.view.state.camera;d.dot(s,o.viewForward)>0&&d.scale(s,s,-1);const l=m.calculatePlaneHalfSize(r,o),h=(t?1:-1)*l*g.INITIAL_DEPTH_OFFSET_FRAC,c=d.scale(w.sv3d.get(),s,h);d.add(c,c,r);const u=this.tiltEnabled?3:0,p=i[g.forceVerticalModifier]?2:i[g.forceHorizontalModifier]?1:u;return m.createPlane(c,s,l,l,o,p,this.view.renderCoordsHelper,a),!0},l._updateMouseCursor=function(){this._set("cursor",null),this._isPlacingSlicePlane||"exclude"===this.layersMode?this._set("cursor","crosshair"):n.isSome(this._creatingPointerId)&&this._set("cursor","grabbing")},l._clearPointerMoveTimeout=function(){this._prevPointerMoveTimeout&&(this._prevPointerMoveTimeout.remove(),this._prevPointerMoveTimeout=null)},l._resetPointerMoveTimeout=function(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=m.DidPointerMoveRecentlyFlag,this.rotateHeadingManipulator.state|=m.DidPointerMoveRecentlyFlag,this.rotateTiltManipulator.state|=m.DidPointerMoveRecentlyFlag,this._prevPointerMoveTimeout=this.clock.setTimeout((()=>{this.shiftManipulator.state&=~m.DidPointerMoveRecentlyFlag,this.rotateHeadingManipulator.state&=~m.DidPointerMoveRecentlyFlag,this.rotateTiltManipulator.state&=~m.DidPointerMoveRecentlyFlag}),g.POINTER_MOVE_TIMER_MS)},l._updateManipulators=function(){if(this.disableEngineLayers)return;let e=null,t=!1;if(n.isSome(this.layerViewData.plane))e=this.layerViewData.plane,t=!1;else{if(!n.isSome(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((e=>e.available=!1)),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);e=this._previewPlane,t=!0}const i=m.calculateBoundedPlaneTranslateRotate(e,w.sm4d.get());t?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((e=>e.available=!1)),this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.tiltEnabled,this.resizeManipulators.forEach((e=>e.available=!0)),m.updateShiftRestartHandle(this.shiftManipulator,i,e,this.view.state.camera),m.updateRotateHeadingHandle(this.rotateHeadingManipulator,i,e,this.view.renderCoordsHelper),m.updateRotateTiltHandle(this.rotateTiltManipulator,i,e),this.resizeManipulators.forEach(((t,a)=>m.updateResizeHandle(t,this._resizeHandles[a],i,e))),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=d.set(w.sv3d.get(),d.length(e.basis1),d.length(e.basis2),1),r=p.fromScaling(w.sm4d.get(),a),s=p.multiply(r,i,r);this._previewPlaneOutlineVisualElement.transform=s,this._previewPlaneGridVisualElement.transform=s,this._updateMaterials()},l._updateVisualElementVisibility=function(){this.disableEngineLayers},l._updateMaterials=function(){const e=[g.PLANE_OUTLINE_COLOR[0],g.PLANE_OUTLINE_COLOR[1],g.PLANE_OUTLINE_COLOR[2],g.PLANE_OUTLINE_COLOR[3]*this._previewPlaneOpacity];this._previewPlaneOutlineVisualElement.color=e;const t=[g.PLANE_BACKGROUND_COLOR[0],g.PLANE_BACKGROUND_COLOR[1],g.PLANE_BACKGROUND_COLOR[2],g.PLANE_BACKGROUND_COLOR[3]*this._previewPlaneOpacity],i=[0,0,0,0];this._previewPlaneGridVisualElement.backgroundColor=t,this._previewPlaneGridVisualElement.gridColor=i},l.updateManipulatorsInteractive=function(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((e=>{e.interactive=!0}));this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach((t=>{t.interactive=t===e}))},l.testData=function(){return{plane:n.isSome(this.layerViewData.plane)?this.layerViewData.plane:null}},e._createClass(o,[{key:"state",get:function(){const e=!!this.layerViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}},{key:"isSupported",get:function(){return"3d"===this.get("view.type")}},{key:"analysis",set:function(e){if(null==e)throw new Error("SliceTool requires valid model, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}},{key:"inputState",get:function(){return this._get("inputState")},set:function(e){this._set("inputState",e),this.layerView.showGrid=e&&"resize"===e.type,this._updateMaterials()}},{key:"_isPlacingSlicePlane",get:function(){return!this.inputState&&!this.layerViewData.plane&&this.active}},{key:"_creatingPointerId",get:function(){return this.inputState&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}}]),o}(R.InteractiveToolBase);function C(e,t,i,a){const n=m.createShiftPlane(i,y.normal(a),e.direction,v.create()),r=_.create();return v.intersectRay(n,e,r)?{type:"shift",creatingPointerId:t,shiftPlane:n,depth:0,startPoint:r}:null}function N(e){return"mouse"!==e.pointerType||0===e.button}t.__decorate([o.property()],x.prototype,"clock",void 0),t.__decorate([o.property({constructOnly:!0})],x.prototype,"view",void 0),t.__decorate([o.property()],x.prototype,"layerView",void 0),t.__decorate([o.property()],x.prototype,"layerViewData",void 0),t.__decorate([o.property({readOnly:!0})],x.prototype,"state",null),t.__decorate([o.property({readOnly:!0})],x.prototype,"isSupported",null),t.__decorate([o.property({readOnly:!0})],x.prototype,"cursor",void 0),t.__decorate([o.property()],x.prototype,"analysis",null),t.__decorate([o.property({readOnly:!0})],x.prototype,"layersMode",void 0),t.__decorate([o.property({aliasOf:"analysis.tiltEnabled"})],x.prototype,"tiltEnabled",void 0),t.__decorate([o.property({value:null})],x.prototype,"inputState",null),x=t.__decorate([u.subclass("esri.views.3d.interactive.analysisTools.slice.SliceTool")],x);const L=y.create(),I=s.createScreenPointArray();return x}));
