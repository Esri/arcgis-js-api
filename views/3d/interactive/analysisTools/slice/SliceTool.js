/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/has","../../../../../core/maybe","../../../../../core/Logger","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/urlUtils","../../../../../core/uuid","../../../../../portal/support/resourceExtension","../../../../../core/clock","../../../../../core/scheduling","../../../../../core/Collection","../../../../../core/screenUtils","../../../../../core/collectionUtils","../../../../../chunks/vec3f64","../../../../../chunks/vec3","../../../../../core/Handles","../../../../../layers/Layer","../../../../../core/watchUtils","../../../../../chunks/mat4","../../../../../layers/buildingSublayers/BuildingComponentSublayer","../../../../interactive/interactiveToolUtils","../../../../support/screenUtils","../../../support/stack","../../../support/geometryUtils","../../../webgl-engine/lib/Intersector","../../../webgl-engine/lib/Texture","../../../../interactive/dragEventPipeline","../../../../interactive/InteractiveToolBase","../../editingTools/dragEventPipeline3D","../../manipulatorUtils","./sliceToolConfig","./sliceToolUtils","./images/heading-rotate-png","./images/tilt-rotate-png"],(function(e,t,i,a,n,r,s,o,l,u,c,h,p,d,_,v,y,P,g,f,M,m,w,b,T,S,R,O,k,E,L,C,x,D,H,I,N){"use strict";const z=n.getLogger("esri.views.3d.interactive.analysisTools.slice.SliceTool");let A=function(t){function i(e){var i;return(i=t.call(this,e)||this).clock=h.default,i.deferCreation=!0,i.cursor=null,i.layersMode="none",i.shiftManipulator=null,i.rotateHeadingManipulator=null,i.rotateTiltManipulator=null,i.resizeManipulators=null,i.disableEngineLayers=!1,i._handles=new g,i._viewHandles=new g,i._frameTask=null,i._prevPointerMoveTimeout=null,i._previewOutlineManipulator=null,i._previewOutlineMaterial=null,i._outlineManipulator=null,i._gridManipulator=null,i._gridMaterial=null,i._startPlane=R.boundedPlane.create(),i._previewPlane=null,i._activeKeyModifiers={},i._lastCursorPosition=_.createScreenPoint(),i._baseOpacity=1,i._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],i._intersector=new O.Intersector(e.view.state.mode),i._intersector.options.store=0,i}e._inheritsLoose(i,t);var n=i.prototype;return n.initialize=function(){this.rotateHeadingTexture=new k(I,"slice-rotate-heading",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.rotateTiltTexture=new k(N,"slice-rotate-tilt",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&(this.view._stage.add(4,this.rotateHeadingTexture),this.view._stage.add(4,this.rotateTiltTexture));const e=M.init(this,"state",(e=>{"ready"!==e&&this.create(),"sliced"===e&&this.complete()}),!0);this._handles.add([e,this.view.state.watch("camera",(()=>this._onCameraChange())),this.excludedLayers.on("before-add",(e=>{const t=e.item;null!=t&&(t instanceof f||t instanceof w)?t instanceof f&&H.isAlwaysDrapedLayer(t)?(z.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.excludedLayers.includes(t)&&e.preventDefault():(z.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())}))]);const t=e=>{this.updateManipulatorsInteractive(e),e.grabbing||(a.isSome(this.plane)&&R.boundedPlane.copy(this.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=H.createShiftManipulator(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(e=>{this._onShiftGrab(e),t(this.shiftManipulator)})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=H.createRotateManipulator(this.view,this.rotateHeadingTexture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(e=>{this._onRotateHeadingGrab(e),t(this.rotateHeadingManipulator)})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=H.createRotateManipulator(this.view,this.rotateTiltTexture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(e=>{this._onRotateTiltGrab(e),t(this.rotateTiltManipulator)})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map(((e,i)=>{const a=H.createResizeManipulator(this.view,e);return a.events.on("grab-changed",(e=>{this._onResizeGrab(e,i),t(a)})),this._handles.add(this._createResizeDragPipeline(a)),a})),this.manipulators.addMany(this.resizeManipulators);const{manipulator:i,material:n}=H.createOutlineManipulator(this.view);this._previewOutlineManipulator=i,this._previewOutlineMaterial=n,this.manipulators.add(this._previewOutlineManipulator,2),this._outlineManipulator=H.createOutlineManipulator(this.view).manipulator,this.manipulators.add(this._outlineManipulator,1);const{manipulator:r,material:s}=H.createGridManipulator(this.view);this._gridManipulator=r,this._gridMaterial=s,this.manipulators.add(this._gridManipulator,2)},n.destroy=function(){this.view._stage&&(this.view._stage.remove(4,this.rotateHeadingTexture.id),this.view._stage.remove(4,this.rotateTiltTexture.id)),this.detach(),this._handles.destroy(),this._handles=null,this._viewHandles.destroy(),this._viewHandles=null,this._removeFrameTask(),this._clearPointerMoveTimeout()},n.internalSetPlane=function(e){this._set("plane",e),this.planeChanged()},n.planeChanged=function(){this.view&&(this._updateLayerViews(),this.visible&&this.attached&&(this.view.slicePlane=this.plane,this._updateManipulators()))},n.enterExcludeLayerMode=function(){this.created&&(this._set("layersMode","exclude"),b.setActive(this,!0))},n.exitExcludeLayerMode=function(){this.created&&(this._set("layersMode","none"),b.setActive(this,!1))},n.deactivate=function(){this._updateMouseCursor(),this._set("layersMode","none"),this._updatePreviewPlane(null)},n.onDetach=function(){this.plane=null,this._set("layersMode","none")},n.onShow=function(){this._updateMouseCursor(),this._updateLayerViews(),this._updateManipulators();const e=this.view;e.slicePlane=this.plane,0===this._viewHandles.size&&this._viewHandles.add([e.allLayerViews.on("change",(()=>this._updateLayerViews())),this.excludedLayers.on("change",(()=>this._updateLayerViews()))])},n.onHide=function(){this._updateMouseCursor(),this._updateLayerViews(),this.view.slicePlane=null,this._viewHandles.removeAll(),this._clearPointerMoveTimeout()},n.onInputEvent=function(e){switch(e.type){case"pointer-down":if(!F(e))return;this._onPointerDown(e)&&(e.stopPropagation(),this._updateMouseCursor());break;case"pointer-drag":if(!F(e))return;this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e),this._updateMouseCursor();break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"click":if(!F(e))return;this._onClick(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}},n._updateLayerViews=function(){const e=!(!this.plane||!this.visible),t=[],i=e=>{"layers"in e?e.layers.forEach(i):t.push(e)};this.excludedLayers.forEach(i),this.view.allLayerViews.forEach((i=>{"slicePlaneEnabled"in i&&(i.slicePlaneEnabled=e&&t.indexOf(i.layer)<0),"sublayerViews"in i&&i.sublayerViews.forEach((i=>{i.slicePlaneEnabled=e&&t.indexOf(i.sublayer)<0}))})),this.view.basemapTerrain.slicePlaneEnabled=e&&!this.excludeGroundSurface},n._onPointerDown=function(e){if("exclude"===this.layersMode)return!0;if(this._isTargeting){const t=T.createScreenPointFromEvent(e),i=R.boundedPlane.create();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){R.boundedPlane.copy(i,this._startPlane);const a=this._calculatePickRay(t);return this.inputState=U(a,e.pointerId,i.origin,i),this.internalSetPlane(i),!0}}return!1},n._onPointerDrag=function(e){if(e.pointerId===this._creatingPointerId){const t=T.createScreenPointFromEvent(e);return this.shiftManipulator.events.emit("drag",{action:"start",pointerType:e.pointerType,start:t,screenPoint:t}),!0}return!1},n._onPointerMove=function(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane(T.createScreenPointFromEvent(e),this._activeKeyModifiers)},n._onCameraChange=function(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()},n._onPointerUp=function(e){return!(e.pointerId!==this._creatingPointerId||!a.isSome(this.plane))&&(R.boundedPlane.copy(this.plane,this._startPlane),this.inputState=null,!0)},n._onClick=function(e){return!("exclude"!==this.layersMode||!this.created)&&(this.view.hitTest(T.createScreenPointFromEvent(e)).then((e=>{if(e.results.length){const t=e.results[0],i=t&&t.graphic;if(i){const e=i.sourceLayer||i.layer;e&&this.excludedLayers.push(e)}}else e.ground.layer?this.excludedLayers.push(e.ground.layer):this.excludeGroundSurface=!0})),this._set("layersMode","none"),b.setActive(this,!1),!0)},n._onKeyDown=function(e){return(e.key===D.forceVerticalModifier||e.key===D.forceHorizontalModifier)&&(this._activeKeyModifiers[e.key]=!0,a.isSome(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)},n._onKeyUp=function(e){return!(e.key!==D.forceVerticalModifier&&e.key!==D.forceHorizontalModifier||!this._activeKeyModifiers[e.key])&&(delete this._activeKeyModifiers[e.key],a.isSome(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)},n._onShiftGrab=function(e){if("start"!==e.action||a.isNone(this.plane))return;const t=this._calculatePickRay(e.screenPoint);R.boundedPlane.copy(this.plane,this._startPlane),this.inputState=U(t,null,this.shiftManipulator.renderLocation,this.plane)},n._createShiftDragPipeline=function(e){return E.createManipulatorDragEventPipeline(e,((e,t)=>{const i=this.inputState;i&&"shift"===i.type&&t.next(C.screenToRenderPlane(this.view,i.shiftPlane)).next(this._shiftDragAdjustSensitivity(i)).next(this._shiftDragUpdatePlane(i))}))},n._shiftDragAdjustSensitivity=function(e){return t=>{if(a.isNone(this.plane))return null;const i=Math.min((1-Math.abs(P.dot(R.boundedPlane.normal(this.plane),t.ray.direction)/P.length(t.ray.direction)))/.001,1),n=-R.plane.signedDistance(this._startPlane.plane,t.renderEnd),r=-R.plane.signedDistance(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-i)+n*i-r,t}},n._shiftDragUpdatePlane=function(e){return()=>{if(a.isNone(this.plane))return;const t=P.copy(S.sv3d.get(),this._startPlane.origin),i=P.copy(S.sv3d.get(),R.boundedPlane.normal(this._startPlane));P.scale(i,i,-e.depth),P.add(i,i,t),R.boundedPlane.fromValues(i,this.plane.basis1,this.plane.basis2,this.plane),this.planeChanged(),this.notifyChange("plane")}},n._onRotateHeadingGrab=function(e){if("start"!==e.action||a.isNone(this.plane))return;const t=H.createRotatePlane(this.plane,this.view.renderCoordsHelper,1,R.plane.create()),i=this._calculatePickRay(e.screenPoint),n=y.create();R.plane.intersectRay(t,i,n)&&(R.boundedPlane.copy(this.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:n})},n._createRotateHeadingDragPipeline=function(e){return E.createManipulatorDragEventPipeline(e,((e,t)=>{const i=this.inputState;i&&"rotate"===i.type&&t.next(C.screenToRenderPlane(this.view,i.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(i)).next(this._rotateDragUpdatePlaneFromRotate())}))},n._onRotateTiltGrab=function(e){if("start"!==e.action||a.isNone(this.plane))return;const t=H.createRotatePlane(this.plane,this.view.renderCoordsHelper,2,R.plane.create()),i=this._calculatePickRay(e.screenPoint),n=y.create();R.plane.intersectRay(t,i,n)&&(R.boundedPlane.copy(this.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:n})},n._createRotateTiltDragPipeline=function(e){return E.createManipulatorDragEventPipeline(e,((e,t)=>{const i=this.inputState;i&&"rotate"===i.type&&t.next(C.screenToRenderPlane(this.view,i.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(i)).next(this._rotateDragUpdatePlaneFromRotate())}))},n._rotateDragRenderPlaneToRotate=function(e){return t=>{if(a.isNone(this.plane))return null;const i=R.plane.normal(e.rotatePlane),n=x.calculateInputRotationTransform(this.inputState.startPoint,t.renderEnd,this.plane.origin,i);return{...t,rotateAxis:i,rotateAngle:n}}},n._rotateDragUpdatePlaneFromRotate=function(){return e=>{if(a.isNone(this.plane))return;const t=m.identity(S.sm4d.get());m.rotate(t,t,e.rotateAngle,e.rotateAxis);const i=P.transformMat4(S.sv3d.get(),this._startPlane.basis1,t),n=P.transformMat4(S.sv3d.get(),this._startPlane.basis2,t);R.boundedPlane.fromValues(this.plane.origin,i,n,this.plane),this.planeChanged(),this.notifyChange("plane")}},n._onResizeGrab=function(e,t){if("start"!==e.action||a.isNone(this.plane))return;const i=this._calculatePickRay(e.screenPoint),n=S.sv3d.get();R.plane.intersectRay(this.plane.plane,i,n)&&(R.boundedPlane.copy(this.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:y.clone(n)})},n._createResizeDragPipeline=function(e){return E.createManipulatorDragEventPipeline(e,((e,t)=>{const i=this.inputState;i&&"resize"===i.type&&!a.isNone(this.plane)&&t.next(C.screenToRenderPlane(this.view,this.plane.plane)).next(this._resizeDragUpdatePlane(i))}))},n._resizeDragUpdatePlane=function(e){return t=>{if(a.isNone(this.plane))return;const i=this._resizeHandles[e.activeHandleIdx];H.resizePlane(i,this.inputState.startPoint,t.renderEnd,this.view._stage.getCamera(),this._startPlane,this.plane),this.planeChanged(),this.notifyChange("plane")}},n._updatePreviewPlane=function(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,a.isNone(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.plane&&this.active){const n=a.isSome(i)?i:R.boundedPlane.create();if(i=a.isSome(i)?R.boundedPlane.copy(i,V):null,this._pickPlane(e,!0,t,n)){const e=D.PREVIEW_FADE_DOT_THRESHOLD;let t=!1;a.isSome(i)&&(t=P.dot(i.plane,n.plane)<e||P.dot(P.normalize(S.sv3d.get(),i.basis1),P.normalize(S.sv3d.get(),n.basis1))<e),t&&(this._baseOpacity=0),this._previewPlane=n}}a.isSome(this._previewPlane)&&a.isNone(this._frameTask)&&0===this._baseOpacity?this._frameTask=p.addFrameTask({update:({deltaTime:e})=>{this._baseOpacity=Math.min(this._baseOpacity+e/(1e3*D.PREVIEW_FADE_DURATION_SECONDS),1),this._updateManipulators(),1===this._baseOpacity&&this._removeFrameTask()}}):a.isNone(this._previewPlane)&&a.isSome(this._frameTask)?this._removeFrameTask():a.isSome(this._previewPlane)&&this._updateManipulators()},n._removeFrameTask=function(){a.isSome(this._frameTask)&&(this._frameTask.remove(),this._frameTask=null)},n._calculatePickRay=function(e){const t=R.ray.create(),i=_.screenPointObjectToArray(e,G);return R.ray.fromScreen(this.view.state.camera,i,t),P.normalize(t.direction,t.direction),t},n._pickMinResult=function(e){const t=_.screenPointObjectToArray(e,S.sv2d.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min},n._pickPlane=function(e,t,i,a){const n=this._pickMinResult(e),r=S.sv3d.get();if(!n.getIntersectionPoint(r))return!1;const s=n.getTransformedNormal(S.sv3d.get()),o=this.view._stage.getCamera();P.dot(s,o.viewForward)>0&&P.scale(s,s,-1);const l=H.calculatePlaneHalfSize(r,o),u=(t?1:-1)*l*D.INITIAL_DEPTH_OFFSET_FRAC,c=P.scale(S.sv3d.get(),s,u);P.add(c,c,r);const h=this.tiltEnabled?3:0,p=i[D.forceVerticalModifier]?2:i[D.forceHorizontalModifier]?1:h;return H.createPlane(c,s,l,l,o,p,this.view.renderCoordsHelper,a),!0},n._updateMouseCursor=function(){this._set("cursor",null),this._isTargeting||"exclude"===this.layersMode?this._set("cursor","crosshair"):a.isSome(this._creatingPointerId)&&this._set("cursor","grabbing")},n._clearPointerMoveTimeout=function(){this._prevPointerMoveTimeout&&(this._prevPointerMoveTimeout.remove(),this._prevPointerMoveTimeout=null)},n._resetPointerMoveTimeout=function(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=H.DidPointerMoveRecentlyFlag,this.rotateHeadingManipulator.state|=H.DidPointerMoveRecentlyFlag,this.rotateTiltManipulator.state|=H.DidPointerMoveRecentlyFlag,this._prevPointerMoveTimeout=this.clock.setTimeout((()=>{this.shiftManipulator.state&=~H.DidPointerMoveRecentlyFlag,this.rotateHeadingManipulator.state&=~H.DidPointerMoveRecentlyFlag,this.rotateTiltManipulator.state&=~H.DidPointerMoveRecentlyFlag}),D.POINTER_MOVE_TIMER_MS)},n._updateManipulators=function(){if(this.disableEngineLayers)return;const e=a.isSome(this.plane)?this.plane:a.isSome(this._previewPlane)?this._previewPlane:null,t=a.isSome(e)&&e===this.plane,i=a.isSome(e)&&e===this._previewPlane,n=a.isSome(e)?H.calculateBoundedPlaneTranslateRotate(e,S.sm4d.get()):null;if(this.shiftManipulator.available=t,this.rotateHeadingManipulator.available=t,this.rotateTiltManipulator.available=t&&this.tiltEnabled,this.resizeManipulators.forEach((e=>{e.available=t})),t&&(H.updateShiftRestartHandle(this.shiftManipulator,n,e,this.view._stage.getCamera()),H.updateRotateHeadingHandle(this.rotateHeadingManipulator,n,e,this.view.renderCoordsHelper),H.updateRotateTiltHandle(this.rotateTiltManipulator,n,e),this.resizeManipulators.forEach(((t,i)=>{H.updateResizeHandle(t,this._resizeHandles[i],n,e)}))),this._previewOutlineManipulator.available=i,this._outlineManipulator.available=t,this._gridManipulator.available=a.isSome(e),a.isSome(e)){const t=P.set(S.sv3d.get(),P.length(e.basis1),P.length(e.basis2),1),i=m.fromScaling(S.sm4d.get(),t),a=m.multiply(i,n,i);a[12]=0,a[13]=0,a[14]=0;const r=P.set(S.sv3d.get(),n[12],n[13],n[14]);this._previewOutlineManipulator.modelTransform=a,this._previewOutlineManipulator.renderLocation=r,this._outlineManipulator.modelTransform=a,this._outlineManipulator.renderLocation=r,this._gridManipulator.modelTransform=a,this._gridManipulator.renderLocation=r,this._updateMaterials()}},n._updateMaterials=function(){const e=[D.PLANE_OUTLINE_COLOR[0],D.PLANE_OUTLINE_COLOR[1],D.PLANE_OUTLINE_COLOR[2],D.PLANE_OUTLINE_COLOR[3]*this._baseOpacity];this._previewOutlineMaterial.setParameterValues({color:e});const t=[D.PLANE_BACKGROUND_COLOR[0],D.PLANE_BACKGROUND_COLOR[1],D.PLANE_BACKGROUND_COLOR[2],D.PLANE_BACKGROUND_COLOR[3]*this._baseOpacity],i=this.inputState&&"resize"===this.inputState.type?D.GRID_COLOR:[0,0,0,0];this._gridMaterial.setParameterValues({backgroundColor:t,gridColor:i})},n.updateManipulatorsInteractive=function(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((e=>{e.interactive=!0}));this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach((t=>{t.interactive=t===e}))},e._createClass(i,[{key:"state",get:function(){const e=!!this.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}},{key:"isSupported",get:function(){return"3d"===this.get("view.type")}},{key:"plane",set:function(e){this.view?a.isSome(e)&&!this.tiltEnabled?this.internalSetPlane(H.forceHorizontalOrVertical(e,this.view.renderCoordsHelper,R.boundedPlane.create())):this.internalSetPlane(e):this._set("plane",e)}},{key:"excludedLayers",get:function(){return this._get("excludedLayers")||new d},set:function(e){this._set("excludedLayers",v.referenceSetter(e,this._get("excludedLayers")))}},{key:"excludeGroundSurface",set:function(e){this._set("excludeGroundSurface",e),this.view&&this._updateLayerViews()}},{key:"tiltEnabled",set:function(e){e!==this._get("tiltEnabled")&&(this._set("tiltEnabled",e),this.view&&(this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),a.isSome(this.plane)&&!e&&(this.plane=R.boundedPlane.copy(this.plane)),this._updateManipulators()))}},{key:"inputState",get:function(){return this._get("inputState")},set:function(e){this._set("inputState",e),this._updateMaterials()}},{key:"_isTargeting",get:function(){return!this.inputState&&!this.plane&&this.active}},{key:"_creatingPointerId",get:function(){return this.inputState&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}}]),i}(L.InteractiveToolBase);function U(e,t,i,a){const n=H.createShiftPlane(i,R.boundedPlane.normal(a),e.direction,R.plane.create()),r=y.create();return R.plane.intersectRay(n,e,r)?{type:"shift",creatingPointerId:t,shiftPlane:n,depth:0,startPoint:r}:null}function F(e){return"mouse"!==e.pointerType||0===e.button}t.__decorate([s.property()],A.prototype,"clock",void 0),t.__decorate([s.property({constructOnly:!0})],A.prototype,"view",void 0),t.__decorate([s.property({dependsOn:["plane","inputState"],readOnly:!0})],A.prototype,"state",null),t.__decorate([s.property({dependsOn:["view.type"],readOnly:!0})],A.prototype,"isSupported",null),t.__decorate([s.property({readOnly:!0})],A.prototype,"cursor",void 0),t.__decorate([s.property({value:null})],A.prototype,"plane",null),t.__decorate([s.property({readOnly:!0})],A.prototype,"layersMode",void 0),t.__decorate([s.property({cast:v.castForReferenceSetter})],A.prototype,"excludedLayers",null),t.__decorate([s.property({type:Boolean,value:!1})],A.prototype,"excludeGroundSurface",null),t.__decorate([s.property({type:Boolean,value:!1})],A.prototype,"tiltEnabled",null),t.__decorate([s.property({value:null})],A.prototype,"inputState",null),A=t.__decorate([o.subclass("esri.views.3d.interactive.analysisTools.slice.SliceTool")],A);const V=R.boundedPlane.create(),G=_.createScreenPointArray();return A}));
