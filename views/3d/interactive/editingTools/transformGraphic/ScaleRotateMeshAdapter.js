/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/HandleOwner","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/support/axisAngleDegrees","../../../../ViewingMode","./undoRecords"],(function(e,t,r,o,a,s,i,n,c,l,h,p,d,g,u){"use strict";e.ScaleRotateMeshAdapter=function(e){function r(t){var r;return(r=e.call(this,t)||this).angle=0,r.scale=1,r.initialAngle=0,r.previousAngle=0,r.previousScale=1,r}t._inheritsLoose(r,e);var o=r.prototype;return o.initialize=function(){this.restart()},o.restart=function(){this.handles.remove(y);const e=this.geometry.transform;if(this.scale=1,s.isSome(e)){const t=d.axis(e.rotation)[2];Math.abs(t)>.999999&&(this.angle=a.deg2rad(d.angle(e.rotation))*Math.sign(t))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(i.watch((()=>({angle:this.angle,scale:this.scale})),(e=>this._update(e)),i.sync),y)},o.cancel=function(){this.scale=1,this.angle=this.initialAngle},o.createUndoRecord=function(){return u.createGraphicGeometryUndoRecord(this.graphic)},o._update=function({scale:e,angle:t}){const r=this.geometry.anchor,o=this.viewingMode===g.ViewingMode.Global;e!==this.previousScale&&(this.geometry.scale(e/this.previousScale,{origin:r,geographic:o}),this.previousScale=e,s.isSome(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()),t!==this.previousAngle&&(this.geometry.rotate(0,0,a.rad2deg(t-this.previousAngle),{origin:r,geographic:o}),this.previousAngle=t,s.isSome(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged())},r}(o.HandleOwner),r.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"graphic",void 0),r.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"geometry",void 0),r.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"viewingMode",void 0),r.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"angle",void 0),r.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"scale",void 0),e.ScaleRotateMeshAdapter=r.__decorate([p.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],e.ScaleRotateMeshAdapter);const y="scale-heading-update-key";Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
