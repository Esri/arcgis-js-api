/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/HandleOwner","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/ensureType","../../../../../core/arrayUtils","../../../../../core/accessorSupport/decorators/subclass"],(function(e,t,o,i,r,n,a,l,c,s,p,y){"use strict";function h(e){return-n.deg2rad(e)}e.ScaleRotateObjectSymbol3DAdapter=function(e){function o(t){var o;return(o=e.call(this,t)||this).sizeAxis=null,o._interactionState=null,o}t._inheritsLoose(o,e);var i=o.prototype;return i.initialize=function(){this.addHandles(l.when((()=>a.isSome(this._interactionState)?this._interactionState.state:null),(e=>{this._updateSymbol(e)}),l.sync))},i.startInteraction=function(){const e=this._graphicSymbol,t=this.findLayerView();if(a.isSome(this._interactionState)||a.isNone(e)||a.isNone(t))return d;const o=e.symbolLayers.map((o=>"object"===o.type?t.getSymbolLayerSize(e,o):null)).toArray(),i=e.clone(),r=this.angle,n=new S({originalSymbol:i,angle:r,initialSizes:o});this._interactionState=n;const l=()=>{this._interactionState=null};return{state:n,done:l,cancel:()=>{this._graphicSymbol=i,l()}}},i.createUndoRecord=function(){let e=this.graphic.symbol,t=null;return{undo:o=>{t=o.symbol,o.symbol=e},redo:o=>{e=o.symbol,o.symbol=t}}},i._updateSymbol=function({scale:e,angle:t,originalSymbol:o,initialSizes:i}){const r=this._graphicSymbol;if(a.isNone(r)||"point-3d"!==r.type)return;const l=r.clone(),c=-n.rad2deg(t-this.initialAngle);let s=!1;this._forEachObjectSymbolLayerPair(o,l,((t,o,r)=>{const n=a.unwrapOr(t.heading,0)+c;o.heading!==n&&(o.heading=n,s=!0);const l=i[r];if(a.isSome(l)&&"width"in l){l.width=this.sizeFilter(l.width),l.height=this.sizeFilter(l.height),l.depth=this.sizeFilter(l.depth);const t=l.width*e;o.width!==t&&(o.width=t,s=!0);const i=l.depth*e;o.depth!==i&&(o.depth=i,s=!0);const r=l.height*e;o.height!==r&&(o.height=r,s=!0)}})),s&&(this._graphicSymbol=l)},i._forEachObjectSymbolLayerPair=function(e,t,o){e.symbolLayers.forEach(((e,i)=>{const r=t.symbolLayers.getItemAt(i);"object"===e.type&&"object"===r.type&&o(e,r,i)}))},t._createClass(o,[{key:"angle",get:function(){return a.isSome(this._interactionState)?this._interactionState.angle:a.isSome(this._orientationReferenceSymbolLayer)?h(this._orientationReferenceSymbolLayer.heading??0):0}},{key:"scale",get:function(){return a.isSome(this._interactionState)?this._interactionState.scale:1}},{key:"relativeAngle",get:function(){return this.angle-this.initialAngle}},{key:"initialAngle",get:function(){return a.isSome(this._interactionState)?this._interactionState.initialAngle:0}},{key:"size",get:function(){const e=this._sizeReferenceSymbolLayer;if(a.isNone(e))return null;const t=this.findLayerView(),o=this._graphicSymbol;if(a.isNone(t)||a.isNone(o)||"point-3d"!==o.type)return null;const i=t.getSymbolLayerSize(o,e);if("size"in i&&a.isSome(i.size))return i.size;const r=this.sizeAxis;return"width"in i&&a.isSome(i.width)&&(a.isNone(r)||"width"===r||"all"===r||"width-and-depth"===r)?i.width:"depth"in i&&a.isSome(e.depth)&&(a.isNone(r)||"depth"===r||"all"===r||"width-and-depth"===r)?i.depth:"height"in i&&a.isSome(e.height)&&(a.isNone(r)||"height"===r||"all"===r)?i.height:null}},{key:"_sizeReferenceSymbolLayer",get:function(){const e=this._graphicSymbol;return a.isNone(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}},{key:"_orientationReferenceSymbolLayer",get:function(){const e=this._graphicSymbol;return a.isNone(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&a.isSome(e.heading)))}},{key:"_graphicSymbol",get:function(){return a.isSome(this.graphic)&&a.isSome(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null},set:function(e){this.graphic.symbol=e}}]),o}(r.HandleOwner),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"angle",null),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"scale",null),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"relativeAngle",null),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"initialAngle",null),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"size",null),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"sizeAxis",void 0),o.__decorate([c.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"graphic",void 0),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_interactionState",void 0),o.__decorate([c.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"findLayerView",void 0),o.__decorate([c.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"sizeFilter",void 0),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_sizeReferenceSymbolLayer",null),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_orientationReferenceSymbolLayer",null),o.__decorate([c.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"_graphicSymbol",null),e.ScaleRotateObjectSymbol3DAdapter=o.__decorate([y.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],e.ScaleRotateObjectSymbol3DAdapter);const d={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let S=function(e){function o(t){var o;return(o=e.call(this,t)||this).angle=0,o.initialAngle=0,o.scale=1,o.initialAngle=t.angle,o}return t._inheritsLoose(o,e),t._createClass(o,[{key:"state",get:function(){const{originalSymbol:e,angle:t,initialAngle:o,scale:i,initialSizes:r}=this;return{originalSymbol:e,angle:t,initialAngle:o,scale:i,initialSizes:r}}}]),o}(i);o.__decorate([c.property()],S.prototype,"originalSymbol",void 0),o.__decorate([c.property()],S.prototype,"angle",void 0),o.__decorate([c.property()],S.prototype,"initialAngle",void 0),o.__decorate([c.property()],S.prototype,"initialSizes",void 0),o.__decorate([c.property()],S.prototype,"scale",void 0),o.__decorate([c.property()],S.prototype,"state",null),S=o.__decorate([y.subclass("InteractionState")],S),e.headingToAngle=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
