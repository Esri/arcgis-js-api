/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/HandleOwner","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/subclass"],(function(e,t,o,i,s,r,a,l,c,n,h,p){"use strict";e.ScaleRotateObjectSymbol3DAdapter=function(e){function o(t){var o;return(o=e.call(this,t)||this).angle=0,o.scale=1,o.symbol=null,o.initialAngle=0,o}t._inheritsLoose(o,e);var i=o.prototype;return i.initialize=function(){this.restart()},i.restart=function(){this.handles.remove(y);const e=r.isSome(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:r.none;if(this.symbol=r.isSome(e)?e.clone():null,this.initialSizes=[],r.isSome(e)){const t=this.findLayerView();r.isSome(t)&&(this.initialSizes=e.symbolLayers.map((o=>"object"===o.type?t.getSymbolLayerSize(e,o):null)).toArray())}this.angle=0,r.isSome(e)&&e.symbolLayers.some((e=>!("object"!==e.type||!r.isSome(e.heading))&&(this.angle=-s.deg2rad(e.heading),!0))),this.initialAngle=this.angle,this.scale=1,this.handles.add(a.watch((()=>({angle:this.angle,scale:this.scale})),(e=>this._updateSymbol(e)),a.sync),y)},i.cancel=function(){this.graphic.symbol=this.symbol},i.createUndoRecord=function(){let e=this.graphic.symbol,t=null;return{undo:o=>{t=o.symbol,o.symbol=e,this.restart()},redo:o=>{e=o.symbol,o.symbol=t,this.restart()}}},i._updateSymbol=function({scale:e,angle:t}){const o=this.graphic.symbol;if(r.isNone(this.symbol)||r.isNone(o)||"point-3d"!==o.type)return;const i=o.clone(),a=-s.rad2deg(t-this.initialAngle);let l=!1;this._forEachObjectSymbolLayerPair(this.symbol,i,((t,o,i)=>{const s=r.unwrapOr(t.heading,0)+a;o.heading!==s&&(o.heading=s,l=!0);const c=this.initialSizes[i];if(r.isSome(c)&&"width"in c){c.width=this.sizeFilter(c.width),c.height=this.sizeFilter(c.height),c.depth=this.sizeFilter(c.depth);const t=c.width*e;o.width!==t&&(o.width=t,l=!0);const i=c.depth*e;o.depth!==i&&(o.depth=i,l=!0);const s=c.height*e;o.height!==s&&(o.height=s,l=!0)}})),l&&(this.graphic.symbol=i)},i._forEachObjectSymbolLayerPair=function(e,t,o){e.symbolLayers.forEach(((e,i)=>{const s=t.symbolLayers.getItemAt(i);"object"===e.type&&"object"===s.type&&o(e,s,i)}))},o}(i.HandleOwner),o.__decorate([l.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"angle",void 0),o.__decorate([l.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"scale",void 0),o.__decorate([l.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"graphic",void 0),o.__decorate([l.property()],e.ScaleRotateObjectSymbol3DAdapter.prototype,"symbol",void 0),o.__decorate([l.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"findLayerView",void 0),o.__decorate([l.property({constructOnly:!0})],e.ScaleRotateObjectSymbol3DAdapter.prototype,"sizeFilter",void 0),e.ScaleRotateObjectSymbol3DAdapter=o.__decorate([p.subclass("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],e.ScaleRotateObjectSymbol3DAdapter);const y="scale-heading-update-key";Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
