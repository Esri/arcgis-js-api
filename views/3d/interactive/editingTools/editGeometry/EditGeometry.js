/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../geometry/Polygon","../../../../../geometry/Polyline","../../../../../geometry","../coordinateHelper"],(function(t,e,n,s,i,o){"use strict";let r=function(){function t(t){this.left=null,this.right=null,this.type="vertex",this.index=null,this.component=t}return e._createClass(t,[{key:"pos",get:function(){return this._pos},set:function(t){this._pos=t,this.component.unnormalizeVertexPositions()}}]),t}(),c=function(t,e,n){this.type="edge",this.component=t,this.left=e,this.right=n,e.right=this,n.left=this},h=function(){function t(t){this.vertices=[],this.edges=[],this.data=t}var e=t.prototype;return e.unnormalizeVertexPositions=function(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices)},e.updateVertexIndex=function(t,e){if(0===this.vertices.length)return;const n=this.vertices[0];let s=null,i=t,o=e;do{s=i,s.index=o++,i=s.right?s.right.right:null}while(null!=i&&i!==n);s.left&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)},e.findEndVertex=function(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]},e.swapVertices=function(t,e){const n=this.vertices[t];this.vertices[t]=this.vertices[e],this.vertices[e]=n},t}(),l=function(){function t(t){this.coordinateHelper=t,this.undoStack=[],this.redoStack=[],this.components=[]}var i=t.prototype;return i.apply=function(t){t.apply(),this.undoStack.push(t),this.redoStack=[]},i.undo=function(){if(this.undoStack.length>0){const t=this.undoStack.pop();t.undo(),this.redoStack.push(t)}},i.redo=function(){if(this.redoStack.length>0){const t=this.redoStack.pop();t.apply(),this.undoStack.push(t)}},i.toPoint=function(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)},i.toPolyline=function(){const t=[],e=this.coordinateHelper.toArray;return this.components.forEach(((n,s)=>{const i=[];let o=n.vertices.find((t=>null==t.left));const r=o;do{i.push(e(o.pos)),o=o.right?o.right.right:null}while(o&&o!==r);t.push(i)})),new s({paths:t,spatialReference:this.coordinateHelper.spatialReference})},i.toPolygon=function(){const t=[],e=this.coordinateHelper.toArray;return this.components.forEach(((n,s)=>{const i=[],o=n.vertices[0];let r=o;const c=r;do{i.push(e(r.pos)),r=r.right.right}while(r&&r!==c);i.push(e(o.pos)),t.push(i)})),new n({rings:t,spatialReference:this.coordinateHelper.spatialReference})},t.fromGeometry=function(e,n){const s=o.createCoordinateHelper(e.hasZ,e.hasM,e.spatialReference,n),i=new t(s);switch(e.type){case"polygon":{const t=e.rings;for(let e=0;e<t.length;++e){const n=t[e],o=new h(i),l=n.length-1;for(let t=0;t<l;++t){const e=s.fromArray(n[t]),i=new r(o);o.vertices.push(i),i.pos=e,i.index=t}const u=o.vertices.length-1;for(let t=0;t<u;++t){const e=o.vertices[t],n=o.vertices[t+1],s=new c(o,e,n);o.edges.push(s)}const p=new c(o,o.vertices[o.vertices.length-1],o.vertices[0]);o.edges.push(p),i.components.push(o)}}break;case"polyline":{const t=e.paths;for(let e=0;e<t.length;++e){const n=t[e],o=new h(i),l=n.length;for(let t=0;t<l;++t){const e=s.fromArray(n[t]),i=new r(o);o.vertices.push(i),i.pos=e,i.index=t}const u=o.vertices.length-1;for(let t=0;t<u;++t){const e=o.vertices[t],n=o.vertices[t+1],s=new c(o,e,n);o.edges.push(s)}i.components.push(o)}}}return i},e._createClass(t,[{key:"canUndo",get:function(){return this.undoStack.length>0}},{key:"lastOperation",get:function(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}},{key:"canRedo",get:function(){return this.redoStack.length>0}}]),t}();t.Component=h,t.Edge=c,t.EditGeometry=l,t.Vertex=r,Object.defineProperty(t,"__esModule",{value:!0})}));
