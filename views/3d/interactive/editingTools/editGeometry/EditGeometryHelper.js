/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/Evented","./EditGeometry"],(function(e,t,i,s,r){"use strict";let n=function(e){function i(t,i){var s;return(s=e.call(this)||this).data=t,s.type=i,s._dirty=!0,s._geometry=null,s}t._inheritsLoose(i,e);var s=i.prototype;return s.splitEdge=function(e,t){const i=new o(this,e,t);return this.data.apply(i),this._dirty=!0,i},s.moveVertices=function(e,t,i,s){let r=null;return this.data.lastOperation instanceof h&&this.data.lastOperation.canAccumulate(e)?(r=this.data.lastOperation,r.accumulate(t,i,s)):(r=new h(this,e,t,i,s),this.data.apply(r)),this._dirty=!0,r},s.removeVertices=function(e){let t=0;switch(this.type){case"point":t=1;break;case"polyline":t=2;break;case"polygon":t=3}const i=new d(this,e,t);return this.data.apply(i),this._dirty=!0,i},s.appendVertex=function(e){if(0===this.data.components.length)return null;const t=new c(this,this.data.components[0],e);return this.data.apply(t),this._dirty=!0,t},s.canRemoveVertex=function(){let e=0;switch(this.type){case"point":e=1;break;case"polyline":e=2;break;case"polygon":e=3}return this.data.components[0].vertices.length>e},s.undo=function(){this.data.undo(),this._dirty=!0},s.redo=function(){this.data.redo(),this._dirty=!0},t._createClass(i,[{key:"canUndo",get:function(){return this.data.canUndo}},{key:"canRedo",get:function(){return this.data.canRedo}},{key:"geometry",get:function(){if(this._dirty){switch(this.type){case"point":this._geometry=this.data.toPoint();break;case"polyline":this._geometry=this.data.toPolyline();break;case"polygon":this._geometry=this.data.toPolygon()}this._dirty=!1}return this._geometry}}]),i}(s),o=function(){function e(e,t,i){this.helper=e,this.edge=t,this.t=i,this.createdVertex=null,this.left=null,this.right=null}var t=e.prototype;return t.apply=function(){let e="redo";const t=this.edge,s=t.component,n=t.component.data,o=t.left,h=t.right;s.edges.splice(s.edges.indexOf(t),1),i.isNone(this.createdVertex)&&(e="apply",this.createdVertex=new r.Vertex(t.component)),s.vertices.push(this.createdVertex),this.createdVertex.pos=n.coordinateHelper.lerp(t.left.pos,t.right.pos,this.t,n.coordinateHelper.createNew()),i.isNone(this.left)&&(this.left=new r.Edge(s,o,this.createdVertex)),this.left.left.left?s.edges.push(this.left):s.edges.unshift(this.left),o.right=this.left,i.isNone(this.right)&&(this.right=new r.Edge(s,this.createdVertex,h)),s.edges.push(this.right),h.left=this.right,s.updateVertexIndex(this.createdVertex,o.index+1);const d={type:"vertex-add",vertices:[this.createdVertex],operation:e};this.helper.emit("vertex-add",d)},t.undo=function(){if(i.isNone(this.createdVertex)||i.isNone(this.left)||i.isNone(this.right))return null;const e=this.edge,t=e.component,s=this.createdVertex.left,r=this.createdVertex.right,n=s.left,o=r.right;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this.left),1),t.edges.splice(t.edges.indexOf(this.right),1),this.edge.left.left?t.edges.push(this.edge):t.edges.unshift(this.edge),n.right=e,o.left=e,t.updateVertexIndex(n,n.index);const h={type:"vertex-remove",vertices:[this.createdVertex],operation:"undo"};this.helper.emit("vertex-remove",h)},e}(),h=function(){function e(e,t,i,s,r){this.helper=e,this.applied=!1,this.vertices=t,this.dx=i,this.dy=s,this.dz=r}var t=e.prototype;return t.apply=function(){this.vertices.forEach((e=>{this.helper.data.coordinateHelper.addDelta(e.pos,this.dx,this.dy,this.dz)})),this.helper.data.components.forEach((e=>{e.unnormalizeVertexPositions()}));const e={type:"vertex-update",vertices:this.vertices,operation:this.applied?"redo":"apply"};this.helper.emit("vertex-update",e),this.applied=!0},t.undo=function(){this.vertices.forEach((e=>{this.helper.data.coordinateHelper.addDelta(e.pos,-this.dx,-this.dy,-this.dz)}));const e={type:"vertex-update",vertices:this.vertices,operation:"undo"};this.helper.emit("vertex-update",e)},t.canAccumulate=function(e){if(e.length!==this.vertices.length)return!1;for(let t=0;t<e.length;++t)if(e[t]!==this.vertices[t])return!1;return!0},t.accumulate=function(e,t,i){this.vertices.forEach((s=>{this.helper.data.coordinateHelper.addDelta(s.pos,e,t,i)})),this.dx+=e,this.dy+=t,this.dz+=i;const s={type:"vertex-update",vertices:this.vertices,operation:"apply"};this.helper.emit("vertex-update",s)},e}(),d=function(){function e(e,t,i=0){this.helper=e,this.removedVertices=null,this._minNumberOfVertices=0,this.vertices=t,this._minNumberOfVertices=i}var t=e.prototype;return t.apply=function(){let e="redo";null==this.removedVertices?(this.removedVertices=[],this.vertices.forEach((e=>{const t=this._removeVertex(e);i.isSome(t)&&this.removedVertices.push(t)})),e="apply"):this.removedVertices.forEach((e=>{this._redoRemoveVertex(e)}));const t={type:"vertex-remove",vertices:this.vertices,operation:e};this.helper.emit("vertex-remove",t)},t.undo=function(){this.removedVertices.forEach((e=>{this._undoRemoveVertex(e)}));const e={type:"vertex-add",vertices:this.vertices,operation:"undo"};this.helper.emit("vertex-add",e)},t._removeVertex=function(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},s=e.left,n=e.right;return t.vertices.splice(t.vertices.indexOf(e),1),s&&(t.edges.splice(t.edges.indexOf(s),1),s.left.right=null),n&&(t.edges.splice(t.edges.indexOf(n),1),n.right.left=null),0===e.index&&n&&this.vertices.length>0&&t.swapVertices(t.vertices.indexOf(n.right),0),s&&n&&(i.createdEdge=new r.Edge(t,s.left,n.right),t.edges.push(i.createdEdge)),n&&t.updateVertexIndex(n.right,n.right.index-1),i},t._redoRemoveVertex=function(e){console.warn("redo remove vertex not implemented yet")},t._undoRemoveVertex=function(e){const t=e.removedVertex,i=e.removedVertex.component,s=t.left,r=t.right;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),s&&(i.edges.push(s),s.left.right=s),r&&(i.edges.push(r),r.right.left=r),i.updateVertexIndex(t,t.index)},e}(),c=function(){function e(e,t,i){this.helper=e,this.component=t,this.pos=i,this.addedVertex=null,this.originalEdge=null,this.left=null,this.right=null}var t=e.prototype;return t.apply=function(){let e="redo";if(i.isNone(this.addedVertex)&&(e="apply",this.addedVertex=new r.Vertex(this.component)),0===this.component.vertices.length)this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{const e=i.unwrap(this.component.findEndVertex());let t=null;e.right&&(this.originalEdge=e.right,t=this.originalEdge.right,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1)),this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,i.isNone(this.left)&&(this.left=new r.Edge(this.component,e,this.addedVertex)),this.component.edges.push(this.left),e.right=this.left,i.isSome(this.originalEdge)&&i.isSome(t)&&(i.isNone(this.right)&&(this.right=new r.Edge(this.component,this.addedVertex,t)),this.component.edges.push(this.right),t.left=this.right),this.component.updateVertexIndex(this.addedVertex,e.index+1)}const t={type:"vertex-add",vertices:[this.addedVertex],operation:e};this.helper.emit("vertex-add",t)},t.undo=function(){if(i.isNone(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1),i.isSome(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.left.right=null),i.isSome(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.right.left=null),i.isSome(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.left.right=this.originalEdge,this.originalEdge.right.left=this.originalEdge),i.isSome(this.left)?this.component.updateVertexIndex(this.left.left,this.left.left.index):this.component.updateVertexIndex(this.addedVertex,0);const e={type:"vertex-remove",vertices:[this.addedVertex],operation:"undo"};this.helper.emit("vertex-remove",e)},e}();e.Component=r.Component,e.Edge=r.Edge,e.EditGeometry=r.EditGeometry,e.Vertex=r.Vertex,e.AppendVertexOperation=c,e.EditGeometryHelper=n,e.RemoveVerticesOperation=d,e.SplitEdgeOperation=o,e.UpdateVerticesOperation=h,Object.defineProperty(e,"__esModule",{value:!0})}));
