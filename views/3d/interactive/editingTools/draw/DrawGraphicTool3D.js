/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/handleUtils","../../../../../core/maybe","../../../../../core/watchUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/subclass","../../../../../support/elevationInfoUtils","../../../../../symbols/support/ElevationInfo","../../SnappingVisualizer3D","../settings","../../visualElements/OutlineVisualElement","../../visualElements/VerticesVisualElement","../../../layers/graphics/GraphicState","../../../../draw/DrawGraphicTool","../../../../draw/DrawOperation","../../../../draw/drawSurfaces"],(function(e,t,i,a,r,n,s,l,o,c,u,h,p,d,v,m,w,f,y,V,_){"use strict";e.DrawGraphicTool3D=function(e){function i(t){var i;return(i=e.call(this,t)||this)._activeVertexVisualElement=null,i._createGraphicState=null,i._outlineVisualElement=null,i._verticesVisualElement=null,i.geometryType=null,i.type="draw-3d",i}t._inheritsLoose(i,e);var s=i.prototype;return s.initialize=function(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new p({mode:e,offset:t})},s.normalizeCtorArgs=function(e){if(!e.elevationInfo){var t;const i=null==(t=e.hasZ)||t;return{...e,elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}}}return e},s.initializeGraphic=function(e){return this._createGraphicState=new f.GraphicState({graphic:e}),a.handlesGroup([this.view.maskOccludee(e),this.view.trackGraphicState(this._createGraphicState),n.init(this._createGraphicState,"isDraped",(e=>{r.isSome(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)}))])},s.makeDrawOperation=function(){return new V.DrawOperation({view:this.view,manipulators:this.manipulators,geometryType:y.geometryTypeToDrawOperationGeometryType(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new _.SceneDrawSurface(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new _.ElevationDrawSurface(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new d.SnappingVisualizer3D})},s.onActiveVertexChanged=function(e){return r.isSome(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new w.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:v.settings.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=v.settings.colorToVec4(v.settings.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,a.makeHandle((()=>{this._activeVertexVisualElement=r.destroyMaybe(this._activeVertexVisualElement)})))},s.onOutlineChanged=function(e){if(r.isSome(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new m.OutlineVisualElement({view:this.view,geometry:e,elevationInfo:t,isDraped:r.isSome(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===h.getEffectiveElevationMode(this.hasZ,t),attached:!1}),v.settings.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),v.settings.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,a.makeHandle((()=>{this._outlineVisualElement=r.destroyMaybe(this._outlineVisualElement)}))},s.onRegularVerticesChanged=function(e){return r.isSome(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new w.VerticesVisualElement({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:v.settings.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,a.makeHandle((()=>{this._verticesVisualElement=r.destroyMaybe(this._verticesVisualElement)})))},i}(y.DrawGraphicTool),i.__decorate([s.property({constructOnly:!0})],e.DrawGraphicTool3D.prototype,"elevationInfo",void 0),i.__decorate([s.property({constructOnly:!0})],e.DrawGraphicTool3D.prototype,"geometryType",void 0),i.__decorate([s.property({readOnly:!0})],e.DrawGraphicTool3D.prototype,"type",void 0),i.__decorate([s.property({constructOnly:!0,nonNullable:!0})],e.DrawGraphicTool3D.prototype,"view",void 0),e.DrawGraphicTool3D=i.__decorate([u.subclass("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],e.DrawGraphicTool3D),Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
