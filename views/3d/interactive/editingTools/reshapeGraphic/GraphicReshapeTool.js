/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/has","../../../../../core/maybe","../../../../../core/Logger","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/urlUtils","../../../../../core/uuid","../../../../../portal/support/resourceExtension","../../../../../core/Evented","../../../../../core/Handles","../../../../../core/watchUtils","../../../../interactive/InteractiveToolBase","../../../../interactive/snapping/SnappingOptions","./isSupportedGraphic","./ReshapeOperation"],(function(e,t,o,r,i,a,p,n,s,h,c,l,d,u,y,_,m,g,G){"use strict";e.GraphicReshapeTool=function(e){function o(t){var o;return(o=e.call(this,t)||this)._handles=new u,o._reshapeOperation=null,o._internalGeometryUpdate=!1,o.enableZ=!0,o.enableMoveGraphic=!0,o.type="reshape-3d",o.snappingOptions=new m.SnappingOptions,o}t._inheritsLoose(o,e);var r=o.prototype;return r.destroy=function(){this._handles.removeAll(),this._reshapeOperation&&(this._reshapeOperation.destroy(),this._reshapeOperation=null),this._set("view",null),this._set("graphic",null)},r._updateGeometry=function(){const e=this.graphic.geometry;0!==g.isSupportedGraphic(this.graphic)||!i.isSome(e)||"polygon"!==e.type&&"polyline"!==e.type?this._reshapeOperation.inputGeometry=null:this._reshapeOperation.inputGeometry=e.clone()},r._updateGraphic=function(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==g.isSupportedGraphic(this.graphic))return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")},r.manipulatorSelectionChanged=function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()},r._onReshapeGeometryChanged=function(){i.isNone(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)},r.initialize=function(){this._reshapeOperation=new G.ReshapeOperation({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(()=>this.emit("immediate-click"))),y.init(this,"graphic",(()=>{this._updateGraphic()}),!0)])},r.beforeUndo=function(){this._reshapeOperation.snappingEngine.doneSnapping()},r.onInputEvent=function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()},r.reset=function(){},t._createClass(o,[{key:"selectionManagementDisabled",get:function(){return!0}}]),o}(d.EventedMixin(_.InteractiveToolBase)),o.__decorate([n.property({constructOnly:!0,nonNullable:!0})],e.GraphicReshapeTool.prototype,"view",void 0),o.__decorate([n.property({constructOnly:!0})],e.GraphicReshapeTool.prototype,"graphic",void 0),o.__decorate([n.property({constructOnly:!0,nonNullable:!0})],e.GraphicReshapeTool.prototype,"enableZ",void 0),o.__decorate([n.property({constructOnly:!0,nonNullable:!0})],e.GraphicReshapeTool.prototype,"enableMoveGraphic",void 0),o.__decorate([n.property({readOnly:!0})],e.GraphicReshapeTool.prototype,"type",void 0),o.__decorate([n.property()],e.GraphicReshapeTool.prototype,"snappingOptions",void 0),e.GraphicReshapeTool=o.__decorate([s.subclass("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],e.GraphicReshapeTool),Object.defineProperty(e,"__esModule",{value:!0})}));
