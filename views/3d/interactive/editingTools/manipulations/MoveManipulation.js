/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import i from"../../../../../core/Handles.js";import{handlesGroup as a}from"../../../../../core/handleUtils.js";import t from"../../../../../core/has.js";import{isSome as e}from"../../../../../core/maybe.js";import{when as n}from"../../../../../core/reactiveUtils.js";import{ManipulatorType as s}from"../ManipulatorType.js";import{DISC_RADIUS_SMALL as o,DISC_RADIUS as r}from"./config.js";import{Manipulation as l}from"./Manipulation.js";import{MoveXYAxisManipulation as p}from"./MoveXYAxisManipulation.js";import{MoveXYDiscManipulation as h}from"./MoveXYDiscManipulation.js";import{MoveZManipulation as u}from"./MoveZManipulation.js";class c extends l{constructor(a){super(),this._handles=new i,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:e,snapToScene:n,radius:s}=a;this._view=e,this.xyManipulation=new h({tool:t,view:e,snapToScene:n,radius:s}),this.xyAxisManipulation=new p({tool:t,view:e,radius:s}),this.zManipulation=new u({tool:t,view:e,radius:s}),this.xyManipulation.available=a.xyAvailable,this.xyAxisManipulation.available=a.xyAxisAvailable,this.zManipulation.available=a.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((i=>{this._handles.add(i.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(i,t,e){return a([this.xyManipulation.createGraphicDragPipeline(((a,t,e,n,s)=>i(d.XY,a,t,e,n,s)),t,e),this.xyAxisManipulation.createGraphicDragPipeline(((a,t,e,n,s)=>i(d.XY_AXIS,a,t,e,n,s)),t,e),this.zManipulation.createGraphicDragPipeline(((a,t,e,n,s)=>i(d.Z,a,t,e,n,s)),t,e)])}createDragPipeline(i,t,e,n){return a([this.xyManipulation.createDragPipeline(((a,t,e,n,s)=>i(d.XY,a,t,e,n,s)),t,e,n),this.xyAxisManipulation.createDragPipeline(((a,t,e,n,s)=>i(d.XY_AXIS,a,t,e,n,s)),t,e,n),this.zManipulation.createDragPipeline(((a,t,e,n,s)=>i(d.Z,a,t,e,n,s)),e)])}set snapToScene(i){this.xyManipulation.snapToScene=i}set angle(i){this._angleDeferred=null,this.xyAxisManipulation.angle=i}set angleDeferred(i){this.xyAxisVisible?this.angle=i():this._angleDeferred=i}set interactive(i){this._interactive!==i&&(this._interactive=i,this._updateManipulatorInteractivity())}set radius(i){this.xyAxisManipulation.radius=i,this.xyManipulation.radius=i,this.zManipulation.radius=i}set displayScale(i){this.xyManipulation.displayScale=i,this.xyAxisManipulation.displayScale=i}forEachManipulator(i){this.xyManipulation.forEachManipulator((a=>i(a,s.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((a=>i(a,s.TRANSLATE_XY))),this.zManipulation.forEachManipulator((a=>i(a,s.TRANSLATE_Z)))}get xyAxisVisible(){const i=this.xyManipulation.someManipulator((i=>i.focused))||this.xyAxisManipulation.someManipulator((i=>i.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||i}_autoHideXYAxis(){const i=this.xyAxisManipulation,a=this.xyManipulation;if(t("esri-mobile"))return;const s=[];a.forEachManipulator((i=>s.push(i))),i.forEachManipulator((i=>s.push(i)));const o=()=>{const a=[];this.xyAxisVisible?e(this._angleDeferred)&&(this.angle=this._angleDeferred()):i.forEachManipulator((i=>a.push(i.disableDisplay()))),this._handles.remove(M),this._handles.add(a,M)};for(const t of s)this._handles.add(t.events.on("focus-changed",o));this._view.inputManager&&this._handles.add(n((()=>this._view.inputManager?.latestPointerType),o)),o()}_updateManipulatorInteractivity(){const i=this.grabbing;this.forEachManipulator((a=>{a.interactive=!i&&this._interactive||a.grabbing}))}static radiusForSymbol(i){const a=e(i)&&"point-3d"===i.type&&i.symbolLayers;return!!a&&a.length>0&&a.some((i=>"icon"===i.type))?o:r}}const M="disable-xy-axis-display";var d;!function(i){i[i.XY=0]="XY",i[i.XY_AXIS=1]="XY_AXIS",i[i.Z=2]="Z"}(d||(d={}));export{d as ManipulationType,c as MoveManipulation};
