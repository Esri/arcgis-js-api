/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/Handles","../../../../../core/maybe","../../../../../core/watchUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/accessorSupport/ensureType","../../../../../core/Logger","../../../../../core/accessorSupport/decorators/subclass","../../../../../chunks/mat4","../../../../../chunks/vec3","../../../../../geometry/support/vectorStacks","../../analysisTools/slice/sliceToolConfig","../../analysisTools/slice/sliceToolUtils","../../../webgl-engine/materials/lineStippleUtils"],(function(e,t,i,s,a,l,r,n,o,c,u,d,h,_,p,y,w,V){"use strict";e.SliceView=function(e){function i(t){var i;return(i=e.call(this,t)||this)._handles=new a,i._gridVisualElement=null,i._outlineVisualElement=null,i.state="pending",i}t._inheritsLoose(i,e);var s=i.prototype;return s.initialize=function(){this._initialize()},s._initialize=function(){var e=t._asyncToGenerator((function*(){switch(this.state){case"pending":break;case"destroyed":return;case"ready":throw new Error("state error")}if(yield r.whenOnce(this.view,"ready",!0),l.isNone(this.layerView.layerViewData))throw new Error("expected internal object to be valid");this._gridVisualElement=w.createGridVisualElement(this.view),this._outlineVisualElement=w.createOutlineVisualElement(this.view),this._handles.add([this.analysis.watch("opacity",(()=>this._updateMaterials()),!0)],"analysis"),this._handles.add([this.layerView.watch("visible",(()=>this._updateMaterials()),!0),this.layerView.layerViewData.watch("plane",(()=>this._updatePlane()),!0),this.layerView.watch("active",(()=>this._updateMaterials()),!0)],"internal"),this._updatePlane(),this._set("state","ready")}));function i(){return e.apply(this,arguments)}return i}(),s.destroy=function(){switch(this.state){case"destroyed":case"pending":return}this._handles.destroy(),this._gridVisualElement=l.destroyMaybe(this._gridVisualElement),this._outlineVisualElement=l.destroyMaybe(this._outlineVisualElement),this.set("view",null),this._set("state","destroyed")},s.whenReady=function(){var e=t._asyncToGenerator((function*(){return yield r.whenOnce(this,"ready"),this}));function i(){return e.apply(this,arguments)}return i}(),s._update=function(){switch(this.state){case"pending":case"destroyed":return}},s._updatePlane=function(){const e=this.layerView.layerViewData.plane,t=l.isSome(e)?w.calculateBoundedPlaneTranslateRotate(e,p.sm4d.get()):null;if(this._outlineVisualElement.width=y.PLANE_OUTLINE_WIDTH,l.isSome(e)){const i=_.set(p.sv3d.get(),_.length(e.basis1),_.length(e.basis2),1),s=h.fromScaling(p.sm4d.get(),i),a=h.multiply(s,t,s);this._outlineVisualElement.transform=a,this._gridVisualElement.transform=a}this._updateMaterials()},s._updateMaterials=function(){const e=this.layerView.layerViewData.plane&&this.analysis.visible,t=this.layerView.active,i=[y.PLANE_OUTLINE_COLOR[0],y.PLANE_OUTLINE_COLOR[1],y.PLANE_OUTLINE_COLOR[2],y.PLANE_OUTLINE_COLOR[3]];this._outlineVisualElement.color=i,this._outlineVisualElement.width=this.editable?y.PLANE_OUTLINE_WIDTH:y.PLANE_PREVIEW_OUTLINE_WIDTH,this._outlineVisualElement.stipplePattern=t?null:V.createStipplePatternSimple(5);const s=[y.PLANE_BACKGROUND_COLOR[0],y.PLANE_BACKGROUND_COLOR[1],y.PLANE_BACKGROUND_COLOR[2],y.PLANE_BACKGROUND_COLOR[3]],a=!!l.isSome(this.layerView.layerViewData)&&this.showGrid?y.GRID_COLOR:[0,0,0,0];this._gridVisualElement.backgroundColor=s,this._gridVisualElement.gridColor=a,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e},t._createClass(i,[{key:"ready",get:function(){return"ready"===this.state}},{key:"showGrid",set:function(e){this._set("showGrid",e),this._updateMaterials()}},{key:"editable",set:function(e){this._set("editable",e),this._updateMaterials()}}]),i}(s),i.__decorate([n.property({readOnly:!0})],e.SliceView.prototype,"state",void 0),i.__decorate([n.property()],e.SliceView.prototype,"view",void 0),i.__decorate([n.property()],e.SliceView.prototype,"analysis",void 0),i.__decorate([n.property()],e.SliceView.prototype,"layerView",void 0),i.__decorate([n.property()],e.SliceView.prototype,"ready",null),i.__decorate([n.property({value:!1})],e.SliceView.prototype,"showGrid",null),i.__decorate([n.property({value:!0})],e.SliceView.prototype,"editable",null),e.SliceView=i.__decorate([d.subclass("esri.views.3d.interactive.graphics.Slice.SliceView")],e.SliceView),Object.defineProperty(e,"__esModule",{value:!0})}));
