/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../Color","../../../core/has","../../../core/handleUtils","../../../core/maybe","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/projection","../../../support/elevationInfoUtils","./visualElements/ExtendedLineVisualElement","./visualElements/ParallelLineVisualElement","./visualElements/PointVisualElement","./visualElements/RightAngleQuadVisualElement","../layers/interfaces","../webgl-engine/lib/Material","../../interactive/snapping/Settings","../../interactive/snapping/SnappingDomain","../../interactive/snapping/SnappingPoint","../../interactive/snapping/snappingUtils","../../interactive/snapping/SnappingVisualizer","../../interactive/snapping/hints/LineSnappingHint","../../interactive/support/viewUtils"],(function(e,n,i,t,a,l,r,o,s,d,p,u,c,g,f,h,v,E,S,m,R,H,P){"use strict";let y=function(e){function t(){return e.apply(this,arguments)||this}n._inheritsLoose(t,e);var o=t.prototype;return o.sortUniqueHints=function(e){return e.sort(((e,n)=>(n instanceof H.LineSnappingHint?n.length:0)-(e instanceof H.LineSnappingHint?e.length:0)))},o.visualizeIntersectionPoint=function(e,n){const{spatialReference:t,view:l}=n;return a.destroyHandle(new c.PointVisualElement({view:l,primitive:"circle",geometry:S.snappingPointToDehydratedPoint(e.intersectionPoint,t),elevationInfo:e.isDraped?d.onTheGroundElevationInfo:d.absoluteHeightElevationInfo,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:i.toUnitRGBA(v.defaults.orange),pixelSnappingEnabled:!1}))},o.visualizePoint=function(e,n){const{view:t,spatialReference:l}=n,r=this._alignPoint(e.point,e.domain,n);return a.destroyHandle(new c.PointVisualElement({view:t,primitive:"circle",geometry:S.snappingPointToDehydratedPoint(r,l),elevationInfo:this._hintElevationInfo(e,n),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:i.toUnitRGBA(v.defaults.orange),pixelSnappingEnabled:!1}))},o.visualizeLine=function(e,n){const{view:i,spatialReference:t}=n,l=this._alignPoint(e.lineStart,e.domain,n),r=this._alignPoint(e.lineEnd,e.domain,n);return a.destroyHandle(this._createLineSegmentHint(e.type,l,r,t,this._hintElevationInfo(e,n),i,e.isDraped,e.fadeLeft,e.fadeRight))},o.visualizeParallelSign=function(e,n){const{view:t,spatialReference:l}=n,{isDraped:o}=e,s=this._hintElevationInfo(e,n),d=this._alignPoint(e.lineStart,e.domain,n),p=this._alignPoint(e.lineEnd,e.domain,n),c=w(d,l,s,t,o),g=w(p,l,s,t,o),E=r.lerp(g,c,g,.5),S=new u.ParallelLineVisualElement({view:t,attached:!1,offset:v.defaults.parallelLineHintOffset,length:v.defaults.parallelLineHintLength,width:v.defaults.parallelLineHintWidth,color:i.toUnitRGBA(v.defaults.orange),location:E,renderOccluded:o?h.RenderOccludedFlag.OccludeAndTransparent:h.RenderOccludedFlag.Opaque,isDraped:o,renderGroup:f.DrapedRenderGroup.SnappingHint});return S.setDirectionFromPoints(c,E),S.attached=!0,a.destroyHandle(S)},o.visualizeRightAngleQuad=function(e,n){const{view:t,spatialReference:l}=n,r=this._hintElevationInfo(e,n),{isDraped:o}=e,s=this._alignPoint(e.previousVertex,e.domain,n),d=this._alignPoint(e.centerVertex,e.domain,n),p=this._alignPoint(e.nextVertex,e.domain,n),u=w(s,l,r,t,o),c=w(d,l,r,t,o),E=w(p,l,r,t,o);return a.destroyHandle(new g.RightAngleQuadVisualElement({view:t,attached:!0,color:o?i.toUnitRGBA(v.defaults.orangeTransparent):i.toUnitRGBA(v.defaults.orange),renderOccluded:o?h.RenderOccludedFlag.OccludeAndTransparent:h.RenderOccludedFlag.Transparent,outlineRenderOccluded:o?h.RenderOccludedFlag.OccludeAndTransparent:h.RenderOccludedFlag.Opaque,outlineColor:i.toUnitRGBA(v.defaults.orange),outlineSize:v.defaults.rightAngleHintOutlineSize,size:v.defaults.rightAngleHintSize,isDraped:o,geometry:{previous:u,center:c,next:E},renderGroup:f.DrapedRenderGroup.SnappingHint}))},o._createLineSegmentHint=function(e,n,t,a,l,r,o=!1,s=!0,d=!0){const u=w(n,a,l,r,o),c=w(t,a,l,r,o),g=new p.ExtendedLineVisualElement({view:r,extensionType:p.ExtensionType.FADED,start:u,end:c,isDraped:o,color:i.toUnitRGBA(v.defaults.orange),renderOccluded:o?h.RenderOccludedFlag.OccludeAndTransparent:h.RenderOccludedFlag.Opaque,renderGroup:f.DrapedRenderGroup.SnappingHint});switch(e){case m.LineSegmentHintType.TARGET:g.width=v.defaults.lineHintWidthTarget,g.fadedExtensions={start:0,end:v.defaults.lineHintFadedExtensions};break;case m.LineSegmentHintType.REFERENCE_EXTENSION:g.width=v.defaults.lineHintWidthReference,g.fadedExtensions={start:0,end:0};break;case m.LineSegmentHintType.REFERENCE:g.width=v.defaults.lineHintWidthReference,g.fadedExtensions={start:s?v.defaults.lineHintFadedExtensions:0,end:d?v.defaults.lineHintFadedExtensions:0}}return g.attached=!0,g},o._alignPoint=function(e,n,i){const t=this._getSelfSnappingZ(n,i);return l.isNone(t)?e:S.createSnappingPoint(e[0],e[1],t)},o._hintElevationInfo=function(e,n){return l.isSome(this._getSelfSnappingZ(e.domain,n))?l.unwrap(n.selfSnappingZ).elevationInfo:e.isDraped?d.onTheGroundElevationInfo:d.absoluteHeightElevationInfo},o._getSelfSnappingZ=function(e,{selfSnappingZ:n}){return e===E.SnappingDomain.SELF&&l.isSome(n)?n.value:null},t}(R.SnappingVisualizer);function w(e,n,i,t,a,l=o.create()){if(a){const i=t.basemapTerrain.overlayManager.renderer.spatialReference;s.projectVectorToVector(e,n,l,i)}else P.vectorToRender(e,n,i,t,l);return l}e.SnappingVisualizer3D=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
