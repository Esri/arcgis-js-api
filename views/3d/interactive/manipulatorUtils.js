/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../../../chunks/vec3","../../../chunks/mat4","../../../chunks/vec4f64","../support/stack","../webgl-engine/lib/GeometryUtil","../../../layers/graphics/hydratedFeatures","../layers/graphics/graphicUtils","../webgl-engine/materials/ColorMaterial","./Manipulator3D","../webgl-engine/materials/ShadedColorMaterial"],(function(e,t,r,n,a,o,i,c,l,s,u,m){"use strict";function p(e,t=4){const r=a.fromValues(e[0],e[1],e[2],e.length>3?e[3]:1),n=e[3]<1;return new m.ShadedColorMaterial({color:r,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t})}function d(e,t=4){const r=a.fromValues(e[0],e[1],e[2],4===e.length?e[3]:1);return new s.ColorMaterial({color:r,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function g(e,t,r){return new u.Manipulator3D({view:e,renderObjects:[{geometry:i.createSphereGeometry(1,32,32),material:p(a.fromValues(t[0],t[1],t[2],null!=r?r:1))}]})}function h(e,t,a,i){const c=r.subtract(o.sv3d.get(),e,a),l=f(c,r.cross(o.sv3d.get(),i,c),a,o.sm4d.get());n.invert(l,l);const s=r.transformMat4(o.sv3d.get(),t,l);return Math.atan2(s[1],s[0])}function f(e,t,n,a){const i=r.normalize(o.sv3d.get(),e),c=r.normalize(o.sv3d.get(),t),l=r.cross(o.sv3d.get(),i,c);return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=0,a[4]=c[0],a[5]=c[1],a[6]=c[2],a[7]=0,a[8]=l[0],a[9]=l[1],a[10]=l[2],a[11]=0,a[12]=n[0],a[13]=n[1],a[14]=n[2],a[15]=1,a}function M(e,r){const n=e.getViewForGraphic(r);return t.isSome(n)&&"computeAttachmentOrigin"in n?n.computeAttachmentOrigin(r,e.spatialReference):null}function v(e,r,n){const a=M(e,n);t.isSome(a)?r.elevationAlignedLocation=a:y(r,n.geometry)}function y(e,r){if(t.isNone(r))return;const n=l.computeCentroid(r);t.isNone(n)||(e.location=c.hydrateGeometry(n))}e.calculateInputRotationTransform=h,e.calculateTranslateRotateFromBases=f,e.createManipulatorMaterial=p,e.createManipulatorOutlineMaterial=d,e.createSphereManipulator=g,e.getGraphicAttachmentOrigin=M,e.placeAtGraphic=v,Object.defineProperty(e,"__esModule",{value:!0})}));
