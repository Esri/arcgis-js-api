/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../../../chunks/vec3","../../../chunks/mat4","../../../chunks/vec4f64","../support/stack","../webgl-engine/lib/GeometryUtil","../../../layers/graphics/hydratedFeatures","../layers/graphics/graphicUtils","../webgl-engine/lib/Geometry","../webgl-engine/materials/ColorMaterial","./Manipulator3D","../webgl-engine/materials/ShadedColorMaterial"],(function(e,t,r,n,a,o,i,c,l,s,u,m,p){"use strict";function g(e,t=4){const r=a.fromValues(e[0],e[1],e[2],e.length>3?e[3]:1),n=e[3]<1;return new p.ShadedColorMaterial({color:r,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t},"manipulator")}function d(e,t,n,a){const i=r.normalize(o.sv3d.get(),e),c=r.normalize(o.sv3d.get(),t),l=r.cross(o.sv3d.get(),i,c);return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=0,a[4]=c[0],a[5]=c[1],a[6]=c[2],a[7]=0,a[8]=l[0],a[9]=l[1],a[10]=l[2],a[11]=0,a[12]=n[0],a[13]=n[1],a[14]=n[2],a[15]=1,a}function h(e,r){const n=e.getViewForGraphic(r);return t.isSome(n)&&"computeAttachmentOrigin"in n?n.computeAttachmentOrigin(r,e.spatialReference):null}e.calculateInputRotationTransform=function(e,t,a,i){const c=r.subtract(o.sv3d.get(),e,a),l=d(c,r.cross(o.sv3d.get(),i,c),a,o.sm4d.get());n.invert(l,l);const s=r.transformMat4(o.sv3d.get(),t,l);return Math.atan2(s[1],s[0])},e.calculateTranslateRotateFromBases=d,e.createManipulatorMaterial=g,e.createManipulatorOutlineMaterial=function(e,t=4){const r=a.fromValues(e[0],e[1],e[2],4===e.length?e[3]:1);return new u.ColorMaterial({color:r,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t},"manipulator-outline")},e.createSphereManipulator=function(e,t,r){return new m.Manipulator3D({view:e,renderObjects:[{geometry:new s(i.createSphereGeometry(1,32,32),"manipulator"),material:g(a.fromValues(t[0],t[1],t[2],null!=r?r:1))}]})},e.getGraphicAttachmentOrigin=h,e.placeAtGraphic=function(e,r,n){const a=h(e,n);t.isSome(a)?r.elevationAlignedLocation=a:function(e,r){if(t.isNone(r))return;const n=l.computeCentroid(r);if(t.isNone(n))return;e.location=c.hydrateGeometry(n)}(r,n.geometry)},Object.defineProperty(e,"__esModule",{value:!0})}));
