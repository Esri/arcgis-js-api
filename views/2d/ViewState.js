/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/JSONSupport","../../geometry/Point","../../geometry/Extent","../../geometry","../../chunks/common","../../Viewpoint","../../chunks/vec2f64","../../chunks/mat3","../../chunks/vec2","../../chunks/mat2d","../../chunks/mat2df64","./viewpointUtils","../../chunks/mat2df32","../../chunks/mat3f32","../../chunks/vec2f32","../../core/libs/gl-matrix-2/types/vec2"],(function(t,e,i,s,r,o,n,a,c,p,l,h,u,f,d,m,y,v,w,_,R,g,x,M,k,z){"use strict";var S;const V=[0,0];let N=S=function(e){function i(...t){var i;return(i=e.call(this,...t)||this)._viewpoint2D={center:y.create(),rotation:0,scale:0,spatialReference:null},i.center=[0,0],i.extent=new u,i.id=0,i.inverseTransform=R.create(),i.resolution=0,i.rotation=0,i.scale=0,i.transform=R.create(),i.transformNoRotation=R.create(),i.displayMat3=M.create(),i.displayViewMat3=M.create(),i.viewMat3=M.create(),i.viewMat2d=x.create(),i.worldScreenWidth=0,i.size=[0,0],i}t._inheritsLoose(i,e);var s=i.prototype;return s.copy=function(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=g.copy(i,t.viewpoint),this._set("size",w.copy(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this},s.clone=function(){return new S({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})},s.toMap=function(t,e,i){return z.isVec2(e)?w.transformMat2d(t,e,this.inverseTransform):(V[0]=e,V[1]=i,w.transformMat2d(t,V,this.inverseTransform))},s.toScreen=function(t,e,i){return z.isVec2(e)?w.transformMat2d(t,e,this.transform):(V[0]=e,V[1]=i,w.transformMat2d(t,V,this.transform))},s.toScreenNoRotation=function(t,e,i){return z.isVec2(e)?w.transformMat2d(t,e,this.transformNoRotation):(V[0]=e,V[1]=i,w.transformMat2d(t,V,this.transformNoRotation))},s.getScreenTransform=function(t,e){const{center:i}=this._viewpoint2D,s=this._get("pixelRatio")||1,r=this._get("size");return g.getMatrix(t,i,r,e,0,s),t},s._update=function(){const{center:t,spatialReference:e,scale:i,rotation:s}=this._viewpoint2D,r=this._get("pixelRatio")||1,o=this._get("size"),n=new m({targetGeometry:new h(t[0],t[1],e),scale:i,rotation:s});if(this._set("viewpoint",n),!o||!e||!i)return;this.resolution=g.getResolution(n),this.rotation=s,this.scale=i,this.spatialReference=e,w.copy(this.center,t);const a=0!==o[0]?2/o[0]:0,c=0!==o[1]?-2/o[1]:0;v.set(this.displayMat3,a,0,0,0,c,0,-1,1,1);const p=v.identity(this.viewMat3),l=k.fromValues(o[0]/2,o[1]/2),u=k.fromValues(-o[0]/2,-o[1]/2),f=d.toRadian(s);v.translate(p,p,l),v.rotate(p,p,f),v.translate(p,p,u),v.multiply(this.displayViewMat3,this.displayMat3,p);const y=_.identity(this.viewMat2d);return _.translate(y,y,l),_.rotate(y,y,f),_.translate(y,y,u),g.getExtent(this.extent,n,o),g.getTransform(this.transform,n,o,r),_.invert(this.inverseTransform,this.transform),g.getTransformNoRotation(this.transformNoRotation,n,o,r),this.worldScreenWidth=g.getWorldScreenWidth(this.spatialReference,this.resolution),this._set("id",this.id+1),this},t._createClass(i,[{key:"pixelRatio",set:function(t){this._set("pixelRatio",t),this._update()}},{key:"size",set:function(t){this._set("size",t),this._update()}},{key:"viewpoint",set:function(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}}]),i}(l.JSONSupport);return e.__decorate([o.property({readOnly:!0})],N.prototype,"id",void 0),e.__decorate([o.property({value:1,json:{write:!0}})],N.prototype,"pixelRatio",null),e.__decorate([o.property({json:{write:!0}})],N.prototype,"size",null),e.__decorate([o.property({type:m,json:{write:!0}})],N.prototype,"viewpoint",null),N=S=e.__decorate([n.subclass("esri.views.2d.ViewState")],N),N}));
