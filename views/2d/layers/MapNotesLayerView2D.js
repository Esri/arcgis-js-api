/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/maybe","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/Collection","../../../Graphic","../../layers/LayerView","./graphics/GraphicsView2D","./LayerView2D"],(function(e,i,t,r,s,a,o,n,c,l,p,h,u,f,d,g){"use strict";const w=Object.freeze({remove(){},pause(){},resume(){}});let y=function(i){function t(){return i.apply(this,arguments)||this}e._inheritsLoose(t,i);var s=t.prototype;return s.fetchPopupFeatures=async function(e){return(await Promise.all(Array.from(this.graphicsViews(),(i=>i.searchFeatures(e).then((e=>e.filter((e=>!!e.popupTemplate)))))))).flat()},s.graphicsViews=function*(){r.isSome(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():r.isSome(this._graphicsViews)?yield*this._graphicsViews:yield*[]},s.hitTest=async function(e,i){if(this.suspended)return null;const t=Array.from(this.graphicsViews(),(async t=>{const s=await t.hitTest(e,i);if(s){if(s.layer=this.layer,s.sourceLayer=this.layer,r.isSome(this._graphicsViewsFeatureCollectionMap)){const e=this._graphicsViewsFeatureCollectionMap.get(t);!s.popupTemplate&&e.popupTemplate&&(s.popupTemplate=e.popupTemplate)}return s}return null}));return(await Promise.all(t)).filter((e=>!!e))[0]||null},s.highlight=function(e){let i;if("number"==typeof e?i=[e]:e instanceof u?i=[e.uid]:Array.isArray(e)&&e.length>0?i="number"==typeof e[0]?e:e.map((e=>e&&e.uid)):h.isCollection(e)&&(i=e.map((e=>e&&e.uid)).toArray()),i=i.filter((e=>null!=e)),!i.length)return w;for(const e of this.graphicsViews())e.addHighlight(i);return{remove:()=>{for(const e of this.graphicsViews())e.removeHighlight(i)}}},s.update=function(e){for(const i of this.graphicsViews())i.processUpdate(e)},s.attach=function(){var e;const i=this.view,t=()=>this.requestUpdate(),r=()=>this.notifyChange("updating");if(null!=(e=this.layer.featureCollections)&&e.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const e of this.layer.featureCollections){const s=new d({view:i,graphics:e.source,renderer:e.renderer,requestUpdateCallback:t});this._graphicsViewsFeatureCollectionMap.set(s,e),this.container.addChild(s.container),this.handles.add(s.watch("updating",r),"layerview-updating")}}else{const e=[this.layer.polygonGraphics,this.layer.lineGraphics,this.layer.pointGraphics,this.layer.textGraphics].map((e=>new d({view:i,graphics:e,requestUpdateCallback:t})));for(const i of e)this.handles.add(i.watch("updating",r),"layerview-updating"),this.container.addChild(i.container);this._graphicsViews=e}},s.detach=function(){this.container.removeAllChildren(),this.handles.remove("layerview-updating");for(const e of this.graphicsViews())e.destroy(),e.view=null,e.renderer=null;this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null},s.moveStart=function(){},s.moveEnd=function(){},s.viewChange=function(){for(const e of this.graphicsViews())e.viewChange()},s.isUpdating=function(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1},t}(g.LayerView2DMixin(f));return y=i.__decorate([n.subclass("esri.views.2d.layers.MapNotesLayerView2D")],y),y}));
