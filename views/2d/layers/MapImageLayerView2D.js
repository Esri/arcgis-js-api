/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/promiseUtils","../../../support/GraphicsCollection","../../layers/RefreshableLayerView","../../layers/LayerView","../../support/drapedUtils","./graphics/GraphicsView2D","../../layers/MapImageLayerView","../engine/BitmapContainer","./LayerView2D","./support/ExportStrategy","./graphics/HighlightGraphicContainer"],(function(e,t,i,r,a,s,o,n,h,p,c,u,d,g,l,m,y,f,w,v,_){"use strict";const b=r.getLogger("esri.views.2d.layers.MapImageLayerView2D");let C=function(t){function i(){var e;return(e=t.apply(this,arguments)||this)._highlightGraphics=new u.default,e}e._inheritsLoose(i,t);var r=i.prototype;return r.hitTest=function(){return null},r.update=function(e){this.strategy.update(e).catch((e=>{c.isAbortError(e)||b.error(e)}))},r.attach=function(){const{imageMaxWidth:e,imageMaxHeight:t,version:i}=this.layer,r=i>=10.3,a=i>=10;this._bitmapContainer=new f.BitmapContainer,this.container.addChild(this._bitmapContainer);const s=new m({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new _(this.view.featuresTilingScheme)});this.container.addChild(s.container),this.strategy=new v({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:r,imageNormalizationSupported:a,hidpi:!0}),this.handles.add(this.watch("exportImageVersion",(()=>this.requestUpdate())),"exportImageVersion"),this.requestUpdate()},r.detach=function(){this.handles.remove("exportImageVersion"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()},r.moveStart=function(){},r.viewChange=function(){},r.moveEnd=function(){this.requestUpdate()},r.highlight=function(e,t){return this._highlightGraphics.add(e),{remove:()=>{this._highlightGraphics.remove(e)}}},r.createFetchPopupFeaturesQueryGeometry=function(e,t){return l.createQueryGeometry(e,t,this.view)},r.doRefresh=async function(){this.requestUpdate()},r.isUpdating=function(){return this.strategy.updating||this.updateRequested},r.fetchImage=function(e,t,i,r){return this.layer.fetchImage(e,t,i,{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp,...r})},i}(y.MapImageLayerView(d.RefreshableLayerView(w.LayerView2DMixin(g))));return t.__decorate([s.property()],C.prototype,"strategy",void 0),t.__decorate([s.property()],C.prototype,"updating",void 0),C=t.__decorate([o.subclass("esri.views.2d.layers.MapImageLayerView2D")],C),C}));
