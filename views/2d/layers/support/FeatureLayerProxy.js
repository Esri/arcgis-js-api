/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Promise","../../../../core/promiseUtils","../../../../core/workers/workers","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/accessorSupport/ensureType","../../../../core/Logger","../../../../core/accessorSupport/decorators/subclass"],(function(t,e,r,n,o,i,s,c,u,a){"use strict";function l(t){return Array.isArray(t)}let p=function(e){function r(t){var r;return(r=e.call(this,t)||this)._startupResolver=n.createResolver(),r.isReady=!1,r}t._inheritsLoose(r,e);var i=r.prototype;return i.initialize=function(){this._controller=n.createAbortController(),this.addResolvingPromise(this._startWorker(this._controller.signal))},i.destroy=function(){this._controller.abort(),this._connection&&this._connection.close()},i.startup=function(){var e=t._asyncToGenerator((function*(t,e,r,n){yield this.when();const o=this._controller.signal,i=l(r.source)?{transferList:r.source,signal:o}:void 0,s={service:r,config:e,tileInfo:t.tileInfo.toJSON(),tiles:n};yield this._connection.invoke("startup",s,i),this._startupResolver.resolve(),this._set("isReady",!0)}));function r(t,r,n,o){return e.apply(this,arguments)}return r}(),i.updateTiles=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("updateTiles",t))}));function r(t){return e.apply(this,arguments)}return r}(),i.update=function(){var e=t._asyncToGenerator((function*(t){const e={config:t};return yield this._startupResolver.promise,this._connection.invoke("update",e)}));function r(t){return e.apply(this,arguments)}return r}(),i.applyUpdate=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,this._connection.invoke("applyUpdate",t)}));function r(t){return e.apply(this,arguments)}return r}(),i.setHighlight=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",t))}));function r(t){return e.apply(this,arguments)}return r}(),i.refresh=function(){var e=t._asyncToGenerator((function*(){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("controller.refresh"))}));function r(){return e.apply(this,arguments)}return r}(),i.querySummaryStatistics=function(){var e=t._asyncToGenerator((function*(t,e,r){return yield this._startupResolver.promise,this._connection.invoke("controller.querySummaryStatistics",{query:t.toJSON(),params:e},r)}));function r(t,r,n){return e.apply(this,arguments)}return r}(),i.queryFeatures=function(){var e=t._asyncToGenerator((function*(t,e){return yield this._startupResolver.promise,this._connection.invoke("controller.queryFeatures",t.toJSON(),e)}));function r(t,r){return e.apply(this,arguments)}return r}(),i.queryObjectIds=function(){var e=t._asyncToGenerator((function*(t,e){return yield this._startupResolver.promise,this._connection.invoke("controller.queryObjectIds",t.toJSON(),e)}));function r(t,r){return e.apply(this,arguments)}return r}(),i.queryFeatureCount=function(){var e=t._asyncToGenerator((function*(t,e){return yield this._startupResolver.promise,this._connection.invoke("controller.queryFeatureCount",t.toJSON(),e)}));function r(t,r){return e.apply(this,arguments)}return r}(),i.queryExtent=function(){var e=t._asyncToGenerator((function*(t,e){return this._connection.invoke("controller.queryExtent",t.toJSON(),e)}));function r(t,r){return e.apply(this,arguments)}return r}(),i.queryLatestObservations=function(){var e=t._asyncToGenerator((function*(t,e){return yield this._startupResolver.promise,this._connection.invoke("controller.queryLatestObservations",t.toJSON(),e)}));function r(t,r){return e.apply(this,arguments)}return r}(),i.queryStatistics=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,this._connection.invoke("controller.queryStatistics",t)}));function r(t){return e.apply(this,arguments)}return r}(),i.getObjectId=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,this._connection.invoke("controller.getObjectId",t)}));function r(t){return e.apply(this,arguments)}return r}(),i.getDisplayId=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,this._connection.invoke("controller.getDisplayId",t)}));function r(t){return e.apply(this,arguments)}return r}(),i.getFeature=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,this._connection.invoke("controller.getFeature",t)}));function r(t){return e.apply(this,arguments)}return r}(),i.getAggregate=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,this._connection.invoke("controller.getAggregate",t)}));function r(t){return e.apply(this,arguments)}return r}(),i.getAggregates=function(){var e=t._asyncToGenerator((function*(){return yield this._startupResolver.promise,this._connection.invoke("controller.getAggregates")}));function r(){return e.apply(this,arguments)}return r}(),i.getAggregateValueRanges=function(){var e=t._asyncToGenerator((function*(){return yield this._startupResolver.promise,this._connection.invoke("controller.getAggregateValueRanges")}));function r(){return e.apply(this,arguments)}return r}(),i.mapValidDisplayIds=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,this._connection.invoke("controller.mapValidDisplayIds",t)}));function r(t){return e.apply(this,arguments)}return r}(),i.onEdits=function(){var e=t._asyncToGenerator((function*(t){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("controller.onEdits",t))}));function r(t){return e.apply(this,arguments)}return r}(),i.enableEvent=function(){var e=t._asyncToGenerator((function*(t,e){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:t,value:e}))}));function r(t,r){return e.apply(this,arguments)}return r}(),i._startWorker=function(){var e=t._asyncToGenerator((function*(t){try{this._connection=yield o.open("Pipeline",{client:this.client,strategy:"dedicated",signal:t})}catch(e){n.throwIfNotAbortError(e)}}));function r(t){return e.apply(this,arguments)}return r}(),t._createClass(r,[{key:"tileRenderer",set:function(t){this.client.tileRenderer=t}},{key:"closed",get:function(){return this._connection.closed}}]),r}(r.EsriPromise);return e.__decorate([i.property()],p.prototype,"isReady",void 0),e.__decorate([i.property()],p.prototype,"client",void 0),e.__decorate([i.property()],p.prototype,"tileRenderer",null),p=e.__decorate([a.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],p),p}));
