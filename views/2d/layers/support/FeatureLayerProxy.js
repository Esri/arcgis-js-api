/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Promise","../../../../core/promiseUtils","../../../../core/workers/workers","../../../../core/accessorSupport/decorators/property","../../../../core/arrayUtils","../../../../core/has","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/subclass"],(function(r,t,e,n,o,i,s,u,c,a){"use strict";function l(r){return Array.isArray(r)}let p=function(t){function e(r){var e;return(e=t.call(this,r)||this)._startupResolver=n.createResolver(),e.isReady=!1,e}r._inheritsLoose(e,t);var i=e.prototype;return i.initialize=function(){this._controller=new AbortController,this.addResolvingPromise(this._startWorker(this._controller.signal))},i.destroy=function(){this._controller.abort(),this._connection&&this._connection.close()},i.startup=function(){var t=r._asyncToGenerator((function*(r,t,e,n){yield this.when();const o=this._controller.signal,i=l(e.source)?{transferList:e.source,signal:o}:void 0,s={service:e,config:t,tileInfo:r.tileInfo.toJSON(),tiles:n};yield this._connection.invoke("startup",s,i),this._startupResolver.resolve(),this._set("isReady",!0)}));function e(r,e,n,o){return t.apply(this,arguments)}return e}(),i.updateTiles=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("updateTiles",r))}));function e(r){return t.apply(this,arguments)}return e}(),i.update=function(){var t=r._asyncToGenerator((function*(r){const t={config:r};return yield this._startupResolver.promise,this._connection.invoke("update",t)}));function e(r){return t.apply(this,arguments)}return e}(),i.applyUpdate=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,this._connection.invoke("applyUpdate",r)}));function e(r){return t.apply(this,arguments)}return e}(),i.setHighlight=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("controller.setHighlight",r))}));function e(r){return t.apply(this,arguments)}return e}(),i.stop=function(){var t=r._asyncToGenerator((function*(){if(yield this._startupResolver.promise,!this.closed)return n.ignoreAbortErrors(this._connection.invoke("stop"))}));function e(){return t.apply(this,arguments)}return e}(),i.refresh=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("controller.refresh",r))}));function e(r){return t.apply(this,arguments)}return e}(),i.querySummaryStatistics=function(){var t=r._asyncToGenerator((function*(r,t,e){return yield this._startupResolver.promise,this._connection.invoke("controller.querySummaryStatistics",{query:r.toJSON(),params:t},e)}));function e(r,e,n){return t.apply(this,arguments)}return e}(),i.queryUniqueValues=function(){var t=r._asyncToGenerator((function*(r,t,e){return yield this._startupResolver.promise,this._connection.invoke("controller.queryUniqueValues",{query:r.toJSON(),params:t},e)}));function e(r,e,n){return t.apply(this,arguments)}return e}(),i.queryClassBreaks=function(){var t=r._asyncToGenerator((function*(r,t,e){return yield this._startupResolver.promise,this._connection.invoke("controller.queryClassBreaks",{query:r.toJSON(),params:t},e)}));function e(r,e,n){return t.apply(this,arguments)}return e}(),i.queryHistogram=function(){var t=r._asyncToGenerator((function*(r,t,e){return yield this._startupResolver.promise,this._connection.invoke("controller.queryHistogram",{query:r.toJSON(),params:t},e)}));function e(r,e,n){return t.apply(this,arguments)}return e}(),i.queryFeatures=function(){var t=r._asyncToGenerator((function*(r,t){return yield this._startupResolver.promise,this._connection.invoke("controller.queryFeatures",r.toJSON(),t)}));function e(r,e){return t.apply(this,arguments)}return e}(),i.queryVisibleFeatures=function(){var t=r._asyncToGenerator((function*(r,t){return yield this._startupResolver.promise,this._connection.invoke("controller.queryVisibleFeatures",r.toJSON(),t)}));function e(r,e){return t.apply(this,arguments)}return e}(),i.queryObjectIds=function(){var t=r._asyncToGenerator((function*(r,t){return yield this._startupResolver.promise,this._connection.invoke("controller.queryObjectIds",r.toJSON(),t)}));function e(r,e){return t.apply(this,arguments)}return e}(),i.queryFeatureCount=function(){var t=r._asyncToGenerator((function*(r,t){return yield this._startupResolver.promise,this._connection.invoke("controller.queryFeatureCount",r.toJSON(),t)}));function e(r,e){return t.apply(this,arguments)}return e}(),i.queryExtent=function(){var t=r._asyncToGenerator((function*(r,t){return this._connection.invoke("controller.queryExtent",r.toJSON(),t)}));function e(r,e){return t.apply(this,arguments)}return e}(),i.queryLatestObservations=function(){var t=r._asyncToGenerator((function*(r,t){return yield this._startupResolver.promise,this._connection.invoke("controller.queryLatestObservations",r.toJSON(),t)}));function e(r,e){return t.apply(this,arguments)}return e}(),i.queryStatistics=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,this._connection.invoke("controller.queryStatistics",r)}));function e(r){return t.apply(this,arguments)}return e}(),i.getObjectId=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,this._connection.invoke("controller.getObjectId",r)}));function e(r){return t.apply(this,arguments)}return e}(),i.getDisplayId=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,this._connection.invoke("controller.getDisplayId",r)}));function e(r){return t.apply(this,arguments)}return e}(),i.getFeatures=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,this._connection.invoke("controller.getFeatures",r)}));function e(r){return t.apply(this,arguments)}return e}(),i.getAggregates=function(){var t=r._asyncToGenerator((function*(){return yield this._startupResolver.promise,this._connection.invoke("controller.getAggregates")}));function e(){return t.apply(this,arguments)}return e}(),i.getAggregateValueRanges=function(){var t=r._asyncToGenerator((function*(){return yield this._startupResolver.promise,this._connection.invoke("controller.getAggregateValueRanges")}));function e(){return t.apply(this,arguments)}return e}(),i.mapValidDisplayIds=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,this._connection.invoke("controller.mapValidDisplayIds",r)}));function e(r){return t.apply(this,arguments)}return e}(),i.onEdits=function(){var t=r._asyncToGenerator((function*(r){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("controller.onEdits",r))}));function e(r){return t.apply(this,arguments)}return e}(),i.enableEvent=function(){var t=r._asyncToGenerator((function*(r,t){return yield this._startupResolver.promise,n.ignoreAbortErrors(this._connection.invoke("controller.enableEvent",{name:r,value:t}))}));function e(r,e){return t.apply(this,arguments)}return e}(),i.pauseStream=function(){return n.ignoreAbortErrors(this._connection.invoke("controller.pauseStream"))},i.resumeStream=function(){return n.ignoreAbortErrors(this._connection.invoke("controller.resumeStream"))},i._startWorker=function(){var t=r._asyncToGenerator((function*(r){try{this._connection=yield o.open("Pipeline",{client:this.client,strategy:"dedicated",signal:r})}catch(t){n.throwIfNotAbortError(t)}}));function e(r){return t.apply(this,arguments)}return e}(),r._createClass(e,[{key:"tileRenderer",set:function(r){this.client.tileRenderer=r}},{key:"closed",get:function(){return this._connection.closed}}]),e}(e.EsriPromise);t.__decorate([i.property()],p.prototype,"isReady",void 0),t.__decorate([i.property()],p.prototype,"client",void 0),t.__decorate([i.property()],p.prototype,"tileRenderer",null),p=t.__decorate([a.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],p);return p}));
