/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../Graphic","../../../core/Logger","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/watchUtils","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","../engine/flow/FlowView2D","./LayerView2D","./imagery/ImageryTileView2D","./imagery/VectorFieldTileView2D","./support/util","../../layers/ImageryTileLayerView","../../layers/LayerView","../../layers/RefreshableLayerView"],(function(e,t,i,s,r,n,a,o,u,c,h,l,d,w,v,y,b,p,f,g){"use strict";const _=s.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let L=function(t){function s(){var e;return(e=t.apply(this,arguments)||this)._useWebGLForProcessing=!0,e._useProgressiveUpdate=!0,e.subview=null,e}e._inheritsLoose(s,t);var o=s.prototype;return o.update=function(e){this.subview.update(e),this.notifyChange("updating")},o.isUpdating=function(){return!this.subview||this.subview.updating},o.attach=function(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([a.watch(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],((e,t,i)=>{const s="multidimensionalDefinition"===i,n="interpolation"===i&&("majority"===e||"majority"===t)&&b.canUseMajorityInterpolationOnDataSource(this.layer),a="renderer"===i&&t.type!==e.type;a&&this._updateSubview();const o=s||n||a;this.subview.redrawOrRefetch(o).catch((e=>{r.isAbortError(e)||_.error(e)})),this.notifyChange("updating")})),n.watch((()=>{var e;return null!=(e=this.layer.blendMode)?e:"normal"}),(e=>{this.subview.container.blendMode=e}),n.syncAndInitial),n.watch((()=>{var e;return null!=(e=this.layer.effect)?e:null}),(e=>{this.subview.container.effect=e}),n.syncAndInitial),n.watch((()=>this.timeExtent),(()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch(!0).catch((e=>{r.isAbortError(e)||_.error(e)}))}),n.initial)],"attach")},o.detach=function(){var e;this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null==(e=this.subview)||e.destroy(),this.subview=null},o.moveStart=function(){this.requestUpdate()},o.viewChange=function(){this.requestUpdate()},o.moveEnd=function(){this.subview.moveEnd()},o.hitTest=function(){var t=e._asyncToGenerator((function*(e,t){return[new i({attributes:{},geometry:e.clone()})]}));function s(e,i){return t.apply(this,arguments)}return s}(),o.doRefresh=function(){return this.subview.doRefresh()},o._updateSubview=function(){const e="vector-field"===this.layer.renderer.type?"rasterVF":"flow"===this.layer.renderer.type?"flow":"raster";if(this.subview){var t;if(this.subview.type===e)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null==(t=this.subview)||t.destroy(),this.subview=null}const{layer:i}=this;let s;s="rasterVF"===e?new y({layer:i,layerView:this}):"flow"===e?new d({layer:i,layerView:this}):new v({layer:i,layerView:this}),"useWebGLForProcessing"in s&&(s.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in s&&(s.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in s&&(s.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),this._attachSubview(s),this.subview=s,this.requestUpdate()},o._attachSubview=function(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)},o._detachSubview=function(e){null!=e&&e.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)},e._createClass(s,[{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}}]),s}(p.ImageryTileLayerView(g.RefreshableLayerView(w.LayerView2DMixin(f))));t.__decorate([o.property()],L.prototype,"subview",void 0),t.__decorate([o.property()],L.prototype,"useWebGLForProcessing",null),t.__decorate([o.property()],L.prototype,"useProgressiveUpdate",null),L=t.__decorate([l.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],L);return L}));
