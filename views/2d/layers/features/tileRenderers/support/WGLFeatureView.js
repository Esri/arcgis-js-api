/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/promiseUtils","../../../../engine/brushes","../../../../engine/FeatureContainer","../../../../engine/webgl/enums"],(function(e,t,s,i,a,r){"use strict";let n=function(e){function a(t,s,i,a){var r;return(r=e.call(this,t)||this)._pointToCallbacks=new Map,r._layer=i,r._layerView=s,r._onUpdate=a,r}t._inheritsLoose(a,e);var n=a.prototype;return n.renderChildren=function(t){if(this.attributeView.update(),this.hasAnimation){t.painter.effects.integrate.draw(t,t.attributeView)}e.prototype.renderChildren.call(this,t)},n.isUpdating=function(){return this.attributeView.isUpdating()},n.hitTest=function(e,t){const i=[e,t],a=s.createResolver();return this._pointToCallbacks.set(i,a),this.requestRender(),a.promise},n.onTileData=function(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()},n.onTileError=function(e){this.contains(e)||this.addChild(e)},n.doRender=function(t){const{minScale:s,maxScale:i}=this._layer,a=t.state.scale;a<=(s||1/0)&&a>=i&&e.prototype.doRender.call(this,t)},n.onAttributeStoreUpdate=function(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._onUpdate()},n.prepareRenderPasses=function(t){const s=t.registerRenderPass({name:"label",brushes:[i.brushes.label],target:()=>this.hasLabels?this.children:null,drawPhase:r.WGLDrawPhase.LABEL|r.WGLDrawPhase.LABEL_ALPHA}),a=t.registerRenderPass({name:"geometry",brushes:[i.brushes.fill,i.brushes.line,i.brushes.marker,i.brushes.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.hasEffects,effects:[{apply:t.effects.outsideEffect,enable:()=>this._layerView.hasEffects,args:()=>this._layerView.effectLists.excluded},{apply:t.effects.insideEffect,enable:()=>this._layerView.hasEffects,args:()=>this._layerView.effectLists.included},{apply:t.effects.hittest,enable:()=>!!this._pointToCallbacks.size,args:()=>this._pointToCallbacks}]}),n=t.registerRenderPass({name:"highlight",brushes:[i.brushes.fill,i.brushes.line,i.brushes.marker,i.brushes.text],target:()=>this.children,drawPhase:r.WGLDrawPhase.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:t.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});return[...e.prototype.prepareRenderPasses.call(this,t),a,n,s]},t._createClass(a,[{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"hasLabels",get:function(){if("sublayers"in this._layer)return this._layer.sublayers.some((e=>e.labelingInfo&&e.labelingInfo.length&&e.labelsVisible));const e=this._layer.featureReduction,t=e&&"cluster"===e.type&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!t}}]),a}(a.FeatureContainer);e.WGLFeatureView=n,Object.defineProperty(e,"__esModule",{value:!0})}));
