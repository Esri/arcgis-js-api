/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../../../../core/has","../../../../../core/Logger","../../../../../core/accessorSupport/ensureType","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/urlUtils","../../../../../core/uuid","../../../../../portal/support/resourceExtension","../../../../../geometry/support/aaBoundingRect","../../../engine/webgl/WGLTile","../support/rendererUtils","./support/visualVariablesUtils","./BaseTileRenderer","./support/WGLFeatureView"],(function(e,t,i,s,r,a,l,n,o,u,c,f,h,p,d,w){"use strict";let V=function(t){function i(){return t.apply(this,arguments)||this}e._inheritsLoose(i,t);var s=i.prototype;return s.install=function(e){const t=new w.WGLFeatureView(this.tileInfoView,this.layerView,this.layer);this.featuresView=t,e.addChild(t)},s.uninstall=function(e){e.removeChild(this.featuresView),this.featuresView.destroy()},s.hitTest=function(e,t){return this.featuresView.hitTest(e,t)},s.supportsRenderer=function(e){return null!=e&&-1!==["simple","class-breaks","unique-value","dot-density","dictionary"].indexOf(e.type)},s.onConfigUpdate=function(e){let t=null;if("visualVariables"in e){const i=(h.simplifyVVRenderer(e).visualVariables||[]).map((e=>{const t=e.clone();return"normalizationField"in e&&(t.normalizationField=null),e.valueExpression&&"$view.scale"!==e.valueExpression&&(t.valueExpression=null,t.field="nop"),t}));t=p.convertVisualVariables(i)}this.featuresView.setRendererInfo(e,t,this.layerView.effects)},s.onTileData=function(e){const t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileData(t,e.data),this.layerView.view.labelManager.requestUpdate()},s.onTileError=function(e){const t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)},s.forceAttributeTextureUpload=function(){this.featuresView.attributeView.forceTextureUpload()},s.lockGPUUploads=function(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((e=>e.lockUploads()))},s.unlockGPUUploads=function(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((e=>e.unlockUploads()))},s.getMaterialItems=async function(e){return this.featuresView.getMaterialItems(e)},s.invalidateLabels=function(){this.featuresView.hasLabels&&(this.tiles.forEach((e=>e.isDirty=!0)),this.layerView.view.labelManager.requestUpdate())},s.createTile=function(e){const t=this.tileInfoView.getTileBounds(c.create(),e),i=new f.WGLTile(e,t);return this.featuresView.hasLabels&&this.layerView.view.labelManager.addTile(this.layerView,i),i},s.disposeTile=function(e){this.featuresView.removeChild(e),this.featuresView.hasLabels&&this.layerView.view.labelManager.removeTile(this.layerView,e.key.id),e.destroy(),this.layerView.view.labelManager.requestUpdate()},i}(d);return V=t.__decorate([l.subclass("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],V),V}));
