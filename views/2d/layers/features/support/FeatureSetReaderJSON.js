/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../layers/graphics/featureConversionUtils","./FeatureSetReader"],(function(t,e,r,n){"use strict";let s=function(t){function s(e,r,n){var s;return(s=t.call(this,e)||this)._featureIndex=-1,s._dateFields=new Set,s._geometryType=n,s._features=r,s}e._inheritsLoose(s,t),s.fromFeatures=function(t,e,n){const i=r.convertFromFeatures([],t,e,!1,!1,n);for(let e=0;e<i.length;e++)i[e].displayId=t[e].displayId;return s.fromOptimizedFeatures(i,e)},s.fromFeatureSet=function(t,e){const n=r.convertFromFeatureSet(t,e);return s.fromOptimizedFeatureSet(n)},s.fromOptimizedFeatureSet=function(t){const{features:e,geometryType:r}=t,n=s.fromOptimizedFeatures(e,r);n._exceededTransferLimit=t.exceededTransferLimit,n._transform=t.transform;for(const e of t.fields)"esriFieldTypeDate"===e.type&&n._dateFields.add(e.name);return n},s.fromOptimizedFeatures=function(t,e,r){const i=new s(n.FeatureSetReader.createInstance(),t,e);return i._transform=r,i};var i=s.prototype;return i.getApproximateSize=function(){return this._features.length},i.getCursor=function(){return this.copy()},i.getQuantizationTransform=function(){return this._transform},i.getAttributeHash=function(){let t="";for(const e in this._current.attributes)t+=this._current.attributes[e];return t},i.getIndex=function(){return this._featureIndex},i.setIndex=function(t){this._featureIndex=t},i.getObjectId=function(){return this._current.objectId},i.getDisplayId=function(){return this._current.displayId},i.setDisplayId=function(t){this._current.displayId=t},i.getGroupId=function(){return this._current.groupId},i.setGroupId=function(t){this._current.groupId=t},i.copy=function(){const t=new s(this.instance,this._features,this.geometryType);return this.copyInto(t),t},i.next=function(){if(!this._hasFilter)return++this._featureIndex<this._features.length;for(;++this._featureIndex<this._features.length&&!this._passesFilter(););return this._featureIndex<this._features.length},i.readLegacyFeature=function(){return r.convertToFeature(this._current,this.geometryType,this.hasZ,this.hasM)},i.readOptimizedFeature=function(){return this._current},i.readLegacyPointGeometry=function(){const t=this.readGeometry();return t?{x:t.coords[0],y:t.coords[1]}:null},i.readLegacyGeometry=function(){const t=this.readGeometry();return r.convertToGeometry(t,this.geometryType,this.hasZ,this.hasM)},i.readLegacyCentroid=function(){const t=this.readCentroid();return t?{x:t.coords[0],y:t.coords[1]}:null},i.readGeometryArea=function(){return r.getQuantizedArea(this._current.geometry,2)},i.readUnquantizedGeometry=function(){const t=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!t)return t;const e=t.clone();return function({coords:t,lengths:e}){let r=0;for(const n of e){for(let e=1;e<n;e++)t[2*(r+e)]+=t[2*(r+e)-2],t[2*(r+e)+1]+=t[2*(r+e)-1];r+=n}}(e),e},i.readHydratedGeometry=function(){const t=this._current.geometry;if(!t)return null;const e=t.clone();return r.unquantizeOptimizedGeometry(e,e,this.hasZ,this.hasM,this._transform),e},i.getXHydrate=function(){const t=this._current.geometry.coords[0]+this._tx,e=this.getQuantizationTransform();return t*e.scale[0]+e.translate[0]},i.getYHydrate=function(){const t=this._current.geometry.coords[1]+this._ty,e=this.getQuantizationTransform();return e.translate[1]-t*e.scale[1]},i.readGeometry=function(){if(!this._current.hasGeometry)return null;const t=this._current.geometry.clone();if(t.isPoint)return t.coords[0]+=this._tx,t.coords[1]+=this._ty,t;let e=0;for(const r of t.lengths)t.coords[2*e]+=this._tx,t.coords[2*e+1]+=this._ty,e+=r;return t},i.readCentroid=function(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){const t=this._computeCentroid();if(!t)return null;t.coords[0]-=this._tx,t.coords[1]-=this._ty,this._current.centroid=t}const t=this._current.centroid.clone();return t.coords[0]+=this._tx,t.coords[1]+=this._ty,t},i._readAttribute=function(t,e){const r=this._current.attributes[t];if(void 0!==r)return e&&this._dateFields.has(t)?new Date(r):r;const n=this.readAttributes(),s=t.toLocaleLowerCase().trim();for(const t in n)if(t.toLocaleLowerCase().trim()===s){const e=this._current.attributes[t];return this._dateFields.has(t)?new Date(e):e}},i.copyInto=function(e){t.prototype.copyInto.call(this,e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._dateFields=this._dateFields},i._readAttributes=function(){return this._current.attributes},i._passesFilter=function(){if(!this._hasFilter)return!0;let t=0,e=0;switch(this.geometryType){case"esriGeometryPoint":{const r=this._current.geometry;if(!r)return!1;[t,e]=r.coords;break}case"esriGeometryPolygon":{const r=this.readCentroid();if(!r)return!1;[t,e]=r.coords,t-=this._tx,e-=this._ty;break}default:return!1}return t>=this._xmin&&t<=this._xmax&&e>=this._ymin&&e<=this._ymax},e._createClass(s,[{key:"_current",get:function(){return this._features[this._featureIndex]}},{key:"geometryType",get:function(){return this._geometryType}},{key:"hasFeatures",get:function(){return!!this._features.length}},{key:"hasNext",get:function(){return this._featureIndex+1<this._features.length}},{key:"exceededTransferLimit",get:function(){return this._exceededTransferLimit}},{key:"hasZ",get:function(){return!1}},{key:"hasM",get:function(){return!1}}]),s}(n.FeatureSetReader);t.FeatureSetReaderJSON=s,Object.defineProperty(t,"__esModule",{value:!0})}));
