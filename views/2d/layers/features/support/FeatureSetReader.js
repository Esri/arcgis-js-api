/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/has","../../../../../core/maybe","../../../../../geometry/support/jsonUtils","../../../../../geometry","../../../../../layers/graphics/OptimizedGeometry","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/centroid","./StaticBitSet"],(function(t,e,i,n,r,s,o,u,a,d){"use strict";let h=0,c=function(){function t(t){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._xmin=-1,this._xmax=0,this._ymin=0,this._ymax=0,this._deleted=null,this._joined=[],this.instance=t}t.createInstance=function(){return h++,h=h>65535?0:h,h};var i=t.prototype;return i.setArcadeSpatialReference=function(t){this._arcadeSpatialReference=t},i.attachStorage=function(t){this._storage=t},i.getQuantizationTransform=function(){throw new Error("Unable to find transform for featureSet")},i.getStorage=function(){return this._storage},i.getComputedNumeric=function(t){return this.getComputedNumericAtIndex(0)},i.setComputedNumeric=function(t,e){return this.setComputedNumericAtIndex(e,0)},i.getComputedString=function(t){return this.getComputedStringAtIndex(0)},i.setComputedString=function(t,e){return this.setComputedStringAtIndex(0,e)},i.getComputedNumericAtIndex=function(t){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),t)},i.setComputedNumericAtIndex=function(t,e){this._storage.setComputedNumericAtIndex(this.getDisplayId(),t,e)},i.getComputedStringAtIndex=function(t){return this._storage.getComputedStringAtIndex(this.getDisplayId(),t)},i.setComputedStringAtIndex=function(t,e){return this._storage.setComputedStringAtIndex(this.getDisplayId(),t,e)},i.transform=function(t,e,i,n){const r=this.copy();return r._tx+=t,r._ty+=e,r._sx*=i,r._sy*=n,r},i.extent=function(t,e,i,n){const r=this.copy();return r._xmin=t,r._xmax=i,r._ymin=e,r._ymax=n,r},i.hasFilter=function(){return this._hasFilter},i.readAttribute=function(t,e=!1){const i=this._readAttribute(t,e);if(void 0!==i)return i;for(const n of this._joined){n.setIndex(this.getIndex());const i=n._readAttribute(t,e);if(void 0!==i)return i}},i.readAttributes=function(){return this._readAttributes()},i.joinAttributes=function(t){this._joined.push(t)},i.readArcadeFeature=function(){return this},i.geometry=function(){const t=this.readHydratedGeometry(),e=u.convertToGeometry(t,this.geometryType,this.hasZ,this.hasM),i=r.fromJSON(e);return i.spatialReference=this._arcadeSpatialReference,i},i.field=function(t){return this.readAttribute(t,!0)},i.hasField=function(t){return!0},i.setField=function(t,e){},i.keys=function(){return[]},i.castToText=function(){return""},i.removeAtIndex=function(t){n.isNone(this._deleted)&&(this._deleted=d.StaticBitSet.create(this.getApproximateSize())),this._deleted.set(t)},i._getExists=function(){return n.isNone(this._deleted)||!this._deleted.has(this.getIndex())},i._computeCentroid=function(){if("esriGeometryPolygon"!==this.geometryType)return null;const t=this.readUnquantizedGeometry();if(!t||t.hasIndeterminateRingOrder)return null;const e=n.unwrapOr(this.getQuantizationTransform(),null);return a.getCentroidOptimizedGeometry(new o,t,this.hasM,this.hasZ,e)},i.copyInto=function(t){t.seen=this.seen,t._storage=this._storage,t._arcadeSpatialReference=this._arcadeSpatialReference,t._joined=this._joined,t._tx=this._tx,t._ty=this._ty,t._sx=this._sx,t._sy=this._sy,t._xmin=this._xmin,t._xmax=this._xmax,t._ymin=this._ymin,t._ymax=this._ymax},e._createClass(t,[{key:"isEmpty",get:function(){return n.isSome(this._deleted)&&this._deleted.countSet()===this.getApproximateSize()}},{key:"_hasFilter",get:function(){return-1!==this._xmin}}]),t}();t.FeatureSetReader=c,Object.defineProperty(t,"__esModule",{value:!0})}));
