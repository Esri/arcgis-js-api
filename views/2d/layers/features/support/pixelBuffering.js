/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/promiseUtils","../../../../../core/screenUtils","../../../engine/webgl/definitions","../../../../../symbols/cim/Rect","../../../../../symbols/cim/CIMSymbolHelper","../../graphics/graphicsUtils"],(function(t,e,i,r,n,s,a){"use strict";const o={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1};const c=[0,0,0,0];function u(t,e){return null==t?e:t}const l={sdf:!0,code:99,metrics:r.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new n(0,0,24,24),page:0,textureBinding:2};async function p(t,e){if("simple-marker"===t.type){const i=Math.max(u(t.size,12),e);return f(t)+.707*i}if("picture-marker"===t.type){const i=Math.max(u(t.height,12),e),r=u(t.width,12)*(i/u(t.height,12))/2,n=i/2;return f(t)+Math.sqrt(r*r+n*n)}if("text"===t.type){const e=function(t){const e=t.text&&t.text.length;if(!e)return{glyphMosaicItems:[l]};const i=[];for(let r=0;r<e;r++)i.push({...l,code:t.text.charCodeAt(r)});return{glyphMosaicItems:i}}(t);a.getTextSymbolSize(c,t.toJSON(),e);const i=Math.abs(c[0]),r=Math.abs(c[1]),n=c[2],s=c[3];return Math.max(i,r)+Math.max(n,s)}if("simple-line"===t.type){const i=t,r=Math.max(u(i.width,.75),e)/2;return i.marker?Math.max(6*i.width,2*e):r}if("simple-fill"===t.type||"picture-fill"===t.type)return Math.max(function(t,e){return null==t.outline?e:u(t.outline.width,e)}(t,0),e)/2;if("cim"===t.type){const e=s.CIMSymbolHelper.getEnvelope(t.data);return e?Math.sqrt(e.width*e.width+e.height*e.height):0}return"web-style"===t.type?p(await t.fetchCIMSymbol(),e):0}async function m(t,e){return function(t){return t.type in o}(t)?Math.min(await p(t,e),75):0}function f(t){const e=u(t.xoffset,0),i=u(t.yoffset,0);return Math.sqrt(e*e+i*i)}function h(t,e){return Math.max(t,e)}t.computePxBuffer=async function(t,r,n){if(!t||n&&"cluster"===n.type)return 0;if("heatmap"===t.type)return Math.round(3*t.blurRadius);if("dot-density"===t.type)return 0;if("dictionary"===t.type)return"esriGeometryPoint"===r||"esriGeometryMultipoint"===r?100:200;const s=t.getSymbols(),a=function(t){if(!("visualVariables"in t))return 0;if(!t.hasVisualVariables("size"))return 0;const e=t.getVisualVariablesForType("size");if(!e[0])return 0;const i=e[0];return"stops"===i.transformationType?i.stops.map((t=>t.size)).reduce(h,0):"clamped-linear"===i.transformationType?"number"==typeof i.maxSize?i.maxSize:i.maxSize.stops.map((t=>t.size)).reduce(h,0):"real-world-size"===i.transformationType?30:void 0}(t),o=[];for(const t of s)o.push(m(t,a));const c=await e.all(o);return i.pt2px(c.reduce(h,0))},Object.defineProperty(t,"__esModule",{value:!0})}));
