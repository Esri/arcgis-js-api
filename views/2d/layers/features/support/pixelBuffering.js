/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/screenUtils","../../../../../symbols/cim/CIMSymbolHelper","../../../../../symbols/cim/Rect","../../../engine/webgl/definitions","../../graphics/graphicsUtils","../../support/cimSymbolUtils"],(function(e,t,r,i,n,s,o,a){"use strict";const u={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1},l=.707;function c(e,t){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;const r=e.getVisualVariablesForType("size");if(!r[0])return 0;const i=r[0];if(t&&"cluster_count"===i.field&&"cluster"===t.type)return t.clusterMaxSize;if("outline"===i.target)return 0;if("stops"===i.transformationType)return i.stops.map((e=>e.size)).reduce(T,0);if("clamped-linear"===i.transformationType){let e=-1/0,t=-1/0;return e="number"==typeof i.maxSize?i.maxSize:i.maxSize.stops.map((e=>e.size)).reduce(T,0),t="number"==typeof i.minSize?i.minSize:i.minSize.stops.map((e=>e.size)).reduce(T,0),Math.max(e,t)}return"real-world-size"===i.transformationType?30:void 0}function p(e){return e.type in u}function m(e,t,r,i,n,s){return f.apply(this,arguments)}function f(){return(f=t._asyncToGenerator((function*(e,t,i,n,s,o){if(!e||o&&"cluster"===o.type)return 0;if("heatmap"===e.type)return Math.round(r.pt2px(e.radius));if("dot-density"===e.type)return 0;if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?100:200;const a=e.getSymbols(),u=c(e),l=[];for(const r of a)l.push(S(r,u,i,t,n,s));const p=yield Promise.all(l);return r.pt2px(p.reduce(T,0))}))).apply(this,arguments)}const y=[0,0,0,0];function h(e,t){return e??t}function d(e,t){return null==e.outline?t:h(e.outline.width,t)}const x={sdf:!0,code:99,metrics:s.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new n(0,0,24,24),page:0,textureBinding:2};function M(e){const t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[x]};const r=[];for(let i=0;i<t;i++)r.push({...x,code:e.text.charCodeAt(i)});return{glyphMosaicItems:r}}function g(e,t,r,i,n,s){return b.apply(this,arguments)}function b(){return(b=t._asyncToGenerator((function*(e,t,r,n,s,u){if("simple-marker"===e.type){const r=Math.max(h(e.size,12),t);return w(e)+r*l}if("picture-marker"===e.type){const r=Math.max(h(e.height,12),t),i=h(e.width,12)*(r/h(e.height,12))/2,n=r/2;return w(e)+Math.sqrt(i*i+n*n)}if("text"===e.type){const t=M(e);o.getTextSymbolSize(y,e.toJSON(),t);const r=Math.abs(y[0]),i=Math.abs(y[1]),n=y[2],s=y[3];return Math.max(r,i)+Math.max(n,s)}if("simple-line"===e.type){const r=e,i=Math.max(h(r.width,.75),t)/2;return r.marker?Math.max(6*r.width,2*t):i}if("simple-fill"===e.type||"picture-fill"===e.type)return Math.max(d(e,0),t)/2;if("cim"===e.type){const o={geometryType:n,fields:s,spatialReference:u},l={type:"cim",rendererKey:0,data:e.data,maxVVSize:t};yield a.expandSymbol(l,o,r);const c=i.CIMSymbolHelper.getEnvelope(e.data,null,r);return c?Math.sqrt(c.width*c.width+c.height*c.height):0}return"web-style"===e.type?g(yield e.fetchCIMSymbol(),t,r,n,s,u):0}))).apply(this,arguments)}function S(e,t,r,i,n,s){return z.apply(this,arguments)}function z(){return(z=t._asyncToGenerator((function*(e,t,r,i,n,s){return p(e)?Math.min(yield g(e,t,r,i,n,s),75):0}))).apply(this,arguments)}function w(e){const t=h(e.xoffset,0),r=h(e.yoffset,0);return Math.sqrt(t*t+r*r)}function T(e,t){return Math.max(e,t)}e.computePxBuffer=m,e.getPtMaxVVSize=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
