/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/screenUtils","../../../../../symbols/cim/CIMSymbolHelper","../../../../../symbols/cim/Rect","../../../engine/webgl/definitions","../../graphics/graphicsUtils"],(function(t,e,r,i,n,s,o){"use strict";const a={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1},u=.707;function l(t){if(!("visualVariables"in t))return 0;if(!t.hasVisualVariables("size"))return 0;const e=t.getVisualVariablesForType("size");if(!e[0])return 0;const r=e[0];if("stops"===r.transformationType)return r.stops.map((t=>t.size)).reduce(w,0);if("clamped-linear"===r.transformationType){let t=-1/0,e=-1/0;return t="number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((t=>t.size)).reduce(w,0),e="number"==typeof r.minSize?r.minSize:r.minSize.stops.map((t=>t.size)).reduce(w,0),Math.max(t,e)}return"real-world-size"===r.transformationType?30:void 0}function c(t){return t.type in a}function p(t,e,r){return f.apply(this,arguments)}function f(){return(f=e._asyncToGenerator((function*(t,e,i){if(!t||i&&"cluster"===i.type)return 0;if("heatmap"===t.type)return Math.round(3*t.blurRadius);if("dot-density"===t.type)return 0;if("dictionary"===t.type)return"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?100:200;const n=t.getSymbols(),s=l(t),o=[];for(const r of n)o.push(g(r,s));const a=yield Promise.all(o);return r.pt2px(a.reduce(w,0))}))).apply(this,arguments)}const m=[0,0,0,0];function h(t,e){return null==t?e:t}function y(t,e){return null==t.outline?e:h(t.outline.width,e)}const d={sdf:!0,code:99,metrics:s.AVERAGE_GLYPH_MOSAIC_ITEM.metrics,rect:new n(0,0,24,24),page:0,textureBinding:2};function M(t){const e=t.text&&t.text.length;if(!e)return{glyphMosaicItems:[d]};const r=[];for(let i=0;i<e;i++)r.push({...d,code:t.text.charCodeAt(i)});return{glyphMosaicItems:r}}function x(t,e){return b.apply(this,arguments)}function b(){return(b=e._asyncToGenerator((function*(t,e){if("simple-marker"===t.type){const r=Math.max(h(t.size,12),e);return S(t)+r*u}if("picture-marker"===t.type){const r=Math.max(h(t.height,12),e),i=h(t.width,12)*(r/h(t.height,12))/2,n=r/2;return S(t)+Math.sqrt(i*i+n*n)}if("text"===t.type){const e=M(t);o.getTextSymbolSize(m,t.toJSON(),e);const r=Math.abs(m[0]),i=Math.abs(m[1]),n=m[2],s=m[3];return Math.max(r,i)+Math.max(n,s)}if("simple-line"===t.type){const r=t,i=Math.max(h(r.width,.75),e)/2;return r.marker?Math.max(6*r.width,2*e):i}if("simple-fill"===t.type||"picture-fill"===t.type)return Math.max(y(t,0),e)/2;if("cim"===t.type){const e=i.CIMSymbolHelper.getEnvelope(t.data);return e?Math.sqrt(e.width*e.width+e.height*e.height):0}return"web-style"===t.type?x(yield t.fetchCIMSymbol(),e):0}))).apply(this,arguments)}function g(t,e){return z.apply(this,arguments)}function z(){return(z=e._asyncToGenerator((function*(t,e){return c(t)?Math.min(yield x(t,e),75):0}))).apply(this,arguments)}function S(t){const e=h(t.xoffset,0),r=h(t.yoffset,0);return Math.sqrt(e*e+r*r)}function w(t,e){return Math.max(t,e)}t.computePxBuffer=p,t.getPtMaxVVSize=l,Object.defineProperty(t,"__esModule",{value:!0})}));
