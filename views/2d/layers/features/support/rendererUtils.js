/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/Logger","../../../../../core/screenUtils"],(function(e,l,t){"use strict";const o=l.getLogger("esri.renderers.visualVariables.support.utils");function r(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function s(e){return e.stops=function(e,l){if(l.length<=8)return l;if(o.warn(`Found ${l.length} Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified.`),l.length>16)return function(e,l){const[o,...r]=l,s=r.pop(),i=r[0].value,n=r[r.length-1].value,u=(n-i)/6,c=[];for(let o=i;o<n;o+=u){let s=0;for(;o>=r[s].value;)s++;const i=r[s],n=l[s-1],u=o-n.value,p=i.value===n.value?1:u/(i.value-n.value);if("color"===e){const e=r[s],t=l[s-1],i=e.color.clone();i.r=a(t.color.r,i.r,p),i.g=a(t.color.g,i.g,p),i.b=a(t.color.b,i.b,p),i.a=a(t.color.a,i.a,p),c.push({value:o,color:i,label:e.label})}else if("size"===e){const e=r[s],i=l[s-1],n=t.toPt(e.size),u=a(t.toPt(i.size),n,p);c.push({value:o,size:u,label:e.label})}else{const e=r[s],t=a(l[s-1].opacity,e.opacity,p);c.push({value:o,opacity:t,label:e.label})}}return[o,...c,s]}(e,l);return function(e){const[l,...t]=e,o=t.pop();for(;t.length>6;){let e=0,l=0;for(let o=1;o<t.length;o++){const r=t[o-1],s=t[o],a=Math.abs(s.value-r.value);a>l&&(l=a,e=o)}t.splice(e,1)}return[l,...t,o]}(l)}(e.type,e.stops),e}function a(e,l,t){return(1-t)*e+t*l}e.simplifyVVRenderer=e=>{if(!("visualVariables"in e)||!e.visualVariables||!e.visualVariables.length)return e;const l=e.clone(),t=l.visualVariables.map((e=>r(e)?s(e):e));return l.visualVariables=t,l},e.simplifyVisualVariables=function(e){return e.map((e=>r(e)?s(e.clone()):e))},Object.defineProperty(e,"__esModule",{value:!0})}));
