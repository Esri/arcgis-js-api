/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../Graphic","../../../PopupTemplate","../../../core/Collection","../../../core/watchUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../../renderers/SimpleRenderer","../../../renderers/support/jsonUtils","../../../rest/support/FeatureSet","./LayerView2D","./graphics/GraphicContainer","./graphics/GraphicsView2D","../../layers/LayerView"],(function(e,i,r,s,t,o,n,p,a,l,h,c,y,u,g,m,w,f){"use strict";let d=function(i){function n(){var e;return(e=i.apply(this,arguments)||this)._graphicsViewMap={},e._popupTemplates=new Map,e.graphicsViews=[],e}e._inheritsLoose(n,i);var p=n.prototype;return p.hitTest=function(e,i){if(this.suspended||!this.graphicsViews.length)return Promise.resolve(null);const r=this.graphicsViews.reverse().map((r=>r.hitTest(e,i)));return Promise.all(r).then((e=>e.filter(((e,i)=>(e&&(e.popupTemplate=this._popupTemplates.get(this.graphicsViews[i]),e.layer=this.layer,e.sourceLayer=this.layer),!!e)))[0]||null))},p.update=function(e){if(this.graphicsViews)for(const i of this.graphicsViews)i.processUpdate(e)},p.attach=function(){this.layer.featureCollections.forEach((e=>{const i=u.fromJSON(e.featureSet),o=new(t.ofType(r))(i.features);let n;if(this._graphicsViewMap[i.geometryType])n=this._graphicsViewMap[i.geometryType],n.graphics.addMany(o);else{const r=e.layerDefinition.drawingInfo,t=e.popupInfo?s.fromJSON(e.popupInfo):null,p=y.fromJSON(r.renderer);n=new w({requestUpdateCallback:()=>this.requestUpdate(),view:this.view,graphics:o,renderer:p,container:new m(this.view.featuresTilingScheme)}),this._graphicsViewMap[i.geometryType]=n,this._popupTemplates.set(n,t),"polygon"!==i.geometryType||this.layer.polygonSymbol?"polyline"!==i.geometryType||this.layer.lineSymbol?"point"!==i.geometryType||this.layer.pointSymbol||(this.layer.pointSymbol=p.symbol):this.layer.lineSymbol=p.symbol:this.layer.polygonSymbol=p.symbol,this.graphicsViews.push(n),this.container.addChild(n.container)}})),this.handles.add([o.init(this.layer,"polygonSymbol",(e=>{this._graphicsViewMap.polygon.renderer=new c({symbol:e})})),o.init(this.layer,"lineSymbol",(e=>{this._graphicsViewMap.polyline.renderer=new c({symbol:e})})),o.init(this.layer,"pointSymbol",(e=>{this._graphicsViewMap.point.renderer=new c({symbol:e})}))])},p.detach=function(){this.container.removeAllChildren();for(const e of this.graphicsViews)e.destroy();this.graphicsViews.length=0},p.moveStart=function(){},p.moveEnd=function(){},p.viewChange=function(){for(const e of this.graphicsViews)e.viewChange()},n}(g.LayerView2DMixin(f));return d=i.__decorate([h.subclass("esri.views.2d.layers.GeoRSSLayerView2D")],d),d}));
