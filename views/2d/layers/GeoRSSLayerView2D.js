/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/Collection","../../../PopupTemplate","../../../Graphic","../../../core/watchUtils","../../../renderers/SimpleRenderer","../../../renderers/support/jsonUtils","../../../tasks/support/FeatureSet","../../layers/LayerView","./graphics/GraphicsView2D","./graphics/GraphicContainer","./LayerView2D"],(function(e,r,i,s,t,o,p,n,a,l,h,c,y,u,g,m,w,f,d,S,V){"use strict";let b=function(r){function i(){var e;return(e=r.apply(this,arguments)||this)._graphicsViewMap={},e._popupTemplates=new Map,e.graphicsViews=[],e}e._inheritsLoose(i,r);var s=i.prototype;return s.hitTest=function(e,r){if(this.suspended||!this.graphicsViews.length)return Promise.resolve(null);const i=this.graphicsViews.reverse().map((i=>i.hitTest(e,r)));return Promise.all(i).then((e=>e.filter(((e,r)=>(e&&(e.popupTemplate=this._popupTemplates.get(this.graphicsViews[r]),e.layer=this.layer,e.sourceLayer=this.layer),!!e)))[0]||null))},s.update=function(e){if(this.graphicsViews)for(const r of this.graphicsViews)r.processUpdate(e)},s.attach=function(){this.layer.featureCollections.forEach((e=>{const r=w.fromJSON(e.featureSet),i=new(h.ofType(y))(r.features);let s;if(this._graphicsViewMap[r.geometryType])s=this._graphicsViewMap[r.geometryType],s.graphics.addMany(i);else{const t=e.layerDefinition.drawingInfo,o=e.popupInfo?c.fromJSON(e.popupInfo):null,p=m.fromJSON(t.renderer);s=new d({requestUpdateCallback:()=>this.requestUpdate(),view:this.view,graphics:i,renderer:p,container:new S(this.view.featuresTilingScheme)}),this._graphicsViewMap[r.geometryType]=s,this._popupTemplates.set(s,o),"polygon"!==r.geometryType||this.layer.polygonSymbol?"polyline"!==r.geometryType||this.layer.lineSymbol?"point"!==r.geometryType||this.layer.pointSymbol||(this.layer.pointSymbol=p.symbol):this.layer.lineSymbol=p.symbol:this.layer.polygonSymbol=p.symbol,this.graphicsViews.push(s),this.container.addChild(s.container)}})),this.handles.add([u.init(this.layer,"polygonSymbol",(e=>{this._graphicsViewMap.polygon.renderer=new g({symbol:e})})),u.init(this.layer,"lineSymbol",(e=>{this._graphicsViewMap.polyline.renderer=new g({symbol:e})})),u.init(this.layer,"pointSymbol",(e=>{this._graphicsViewMap.point.renderer=new g({symbol:e})}))])},s.detach=function(){this.container.removeAllChildren();for(const e of this.graphicsViews)e.destroy();this.graphicsViews.length=0},s.moveStart=function(){},s.moveEnd=function(){},s.viewChange=function(){for(const e of this.graphicsViews)e.viewChange()},i}(V.LayerView2DMixin(f));return b=r.__decorate([p.subclass("esri.views.2d.layers.GeoRSSLayerView2D")],b),b}));
