/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{bidiText as e}from"../../../../core/BidiText.js";import{unwrap as t}from"../../../../core/maybe.js";import{pt2px as n}from"../../../../core/screenUtils.js";import i from"../../../../geometry/Polygon.js";import{create as r}from"../../../../geometry/support/aaBoundingRect.js";import{getInfo as o}from"../../../../geometry/support/spatialReferenceUtils.js";import{getXAnchorDirection as s,getYAnchorDirection as l}from"../../engine/webgl/alignmentUtils.js";import{GLYPH_SIZE as m,MAGIC_LABEL_LINE_HEIGHT as a}from"../../engine/webgl/definitions.js";import{shapeGlyphs as f}from"../../engine/webgl/mesh/templates/shapingUtils.js";const c=512,g=50;function p(e,t){const n=o(t);if(!n)return null;const[i,s]=n.valid;return e[2]>s?[r([e[0],e[1],s,e[3]]),r([i,e[1],i+e[2]-s,e[3]])]:e[0]<i?[r([i,e[1],e[2],e[3]]),r([s-(i-e[0]),e[1],s,e[3]])]:null}function u(e){return"text"===e||"esriTS"===e}function h(e){return"simple-marker"===e||"picture-marker"===e||"esriSMS"===e||"esriPMS"===e}function y(e){switch(t(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}function x(t,i,r){if(!r||0===r.glyphMosaicItems.length)return t;const o=e(i.text)[1],c=r.glyphMosaicItems,g=f(c,o,{scale:n(i.font.size)/m,angle:i.angle??0,xOffset:i.xoffset??0,yOffset:i.yoffset??0,hAlign:s(i.horizontalAlignment||"center"),vAlign:l(i.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(i.lineWidth||512,512)),lineHeight:a*Math.max(.25,Math.min(i.lineHeight||1,4)),decoration:i.font.decoration||"none",isCIM:!1}).bounds;return t[0]=n(g.x-g.halfWidth),t[1]=n(g.y-g.halfHeight),t[2]=n(g.width),t[3]=n(g.height),t}function d(e){if(!e)return null;const{xmin:t,ymin:n,xmax:r,ymax:o,spatialReference:s}=e;return new i({rings:[[[t,n],[t,o],[r,o],[r,n],[t,n]]],spatialReference:s})}export{g as PIXEL_BUFFER,c as TILE_SIZE,x as getTextSymbolSize,y as graphicGeometryToNumber,p as intersectingInternationalDateline,h as isMarkerSymbol,u as isTextSymbol,d as polygonFromExtent};
