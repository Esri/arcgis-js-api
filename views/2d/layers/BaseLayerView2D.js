/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../../geometry/support/aaBoundingRect","../tiling/PagedTileQueue","../tiling/TileInfoView","../tiling/TileKey","../tiling/TileQueue","../tiling/TileStrategy","./LayerView2D","./support/Display","../../layers/LayerView","../../layers/RefreshableLayerView"],(function(e,t,i,n,o,s,r,l,a,c,u,h,p,d,f,g,y){"use strict";const w=new Set,_=[],T=[];let v=function(e,t,i,n,o,s,r,a=[0,0],c=l.create()){this.id=e,this.level=t,this.row=i,this.col=n,this.world=o,this.resolution=s,this.scale=r,this.coords=a,this.bounds=c},V=function(t){function i(i){var n;return(n=t.call(this,i)||this)._tileMap=new Map,n.container=new f.Display(e._assertThisInitialized(n)),n.layer=null,n.tiles=[],n}e._inheritsLoose(i,t);var n=i.prototype;return n.attach=function(){},n.detach=function(){},n.requestRender=function(){this.container.requestRender()},n.tilesChanged=function(e,t){},n.doRefresh=function(){var t=e._asyncToGenerator((function*(){}));function i(){return t.apply(this,arguments)}return i}(),n.isUpdating=function(){return!1},n.update=function(e){const t=this._tileInfoView,i=this.tiles;if(t){const n=t.getTileCoverage(e.state,0),{spans:o,lodInfo:s}=n,{level:r}=s;if(o.length)for(const{row:e,colFrom:t,colTo:l}of o)for(let n=t;n<=l;n++){const t=s.normalizeCol(n),o=s.getWorldForColumn(n),l=`${r}/${e}/${t}/${o}`;if(!this._tileMap.has(l)){const n=new v(l,r,e,t,o,s.resolution,s.scale);s.getTileCoords(n.coords,n,!1),s.getTileBounds(n.bounds,n,!0),this._tileMap.set(l,n),i.push(n),_.push(n)}w.add(l)}}for(let n=i.length-1;n>=0;n--){const e=i[n];w.has(e.id)||(i.splice(n,1),T.push(e),this._tileMap.delete(e.id))}(_.length||T.length)&&(this.tilesChanged(_,T),_.length=T.length=0),w.clear(),this.requestRender()},n.moveStart=function(){},n.viewChange=function(){this.requestUpdate()},n.moveEnd=function(){},e._createClass(i,[{key:"_tileInfoView",get:function(){const e=this.layer&&this.layer.tileInfo;return e?new c(e):null}}]),i}(y.RefreshableLayerView(d.LayerView2DMixin(g)));return t.__decorate([i.property()],V.prototype,"_tileInfoView",null),t.__decorate([i.property()],V.prototype,"layer",void 0),V=t.__decorate([r.subclass("esri.views.2d.layers.BaseLayerView2D")],V),V}));
