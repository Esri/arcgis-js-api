/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","../../../geometry/support/aaBoundingRect","../../../geometry/support/spatialReferenceUtils","../tiling/PagedTileQueue","../tiling/TileInfoView","../tiling/TileKey","../tiling/TileQueue","../tiling/TileStrategy","./LayerView2D","./support/Display","../../layers/LayerView","../../layers/RefreshableLayerView"],(function(e,t,i,n,r,s,o,l,a,c,u,p,h,f,d,y,g,w){"use strict";const _=new Set,v=[],T=[];let R=function(e,t,i,n,r,s,o,a=[0,0],c=l.create()){this.id=e,this.level=t,this.row=i,this.col=n,this.world=r,this.resolution=s,this.scale=o,this.coords=a,this.bounds=c},V=function(t){function i(i){var n;return(n=t.call(this,i)||this)._tileMap=new Map,n.container=new y.Display(e._assertThisInitialized(n)),n.layer=null,n.tiles=[],n}e._inheritsLoose(i,t);var n=i.prototype;return n.attach=function(){},n.detach=function(){},n.requestRender=function(){this.container.requestRender()},n.tilesChanged=function(e,t){},n.supportsSpatialReference=function(e){var t;const i=null==(t=this.layer)?void 0:t.tileInfo;return!i||a.equals(i.spatialReference,e)},n.doRefresh=function(){var t=e._asyncToGenerator((function*(){}));function i(){return t.apply(this,arguments)}return i}(),n.isUpdating=function(){return!1},n.update=function(e){const t=this._tileInfoView,i=this.tiles;if(t){const n=t.getTileCoverage(e.state,0),{spans:r,lodInfo:s}=n,{level:o}=s;if(r.length)for(const{row:e,colFrom:t,colTo:l}of r)for(let n=t;n<=l;n++){const t=s.normalizeCol(n),r=s.getWorldForColumn(n),l=`${o}/${e}/${t}/${r}`;if(!this._tileMap.has(l)){const n=new R(l,o,e,t,r,s.resolution,s.scale);s.getTileCoords(n.coords,n,!1),s.getTileBounds(n.bounds,n,!0),this._tileMap.set(l,n),i.push(n),v.push(n)}_.add(l)}}for(let n=i.length-1;n>=0;n--){const e=i[n];_.has(e.id)||(i.splice(n,1),T.push(e),this._tileMap.delete(e.id))}(v.length||T.length)&&(this.tilesChanged(v,T),v.length=T.length=0),_.clear(),this.requestRender()},n.moveStart=function(){},n.viewChange=function(){this.requestUpdate()},n.moveEnd=function(){},e._createClass(i,[{key:"_tileInfoView",get:function(){const e=this.layer&&this.layer.tileInfo;return e?new u(e):null}}]),i}(w.RefreshableLayerView(d.LayerView2DMixin(g)));t.__decorate([i.property()],V.prototype,"_tileInfoView",null),t.__decorate([i.property()],V.prototype,"layer",void 0),V=t.__decorate([o.subclass("esri.views.2d.layers.BaseLayerView2D")],V);return V}));
