/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../geometry/support/aaBoundingRect","../../layers/RefreshableLayerView","../tiling/TileKey","../tiling/PagedTileQueue","../tiling/TileInfoView","../tiling/TileQueue","../tiling/TileStrategy","../../layers/LayerView","./LayerView2D","./support/Display"],(function(e,t,i,o,s,r,n,l,a,c,u,h,p,d,f,g,y,w,_,T){"use strict";const v=new Set,V=[],b=[];let C=function(e,t,i,o,s,r,n,l=[0,0],a=u.create()){this.id=e,this.level=t,this.row=i,this.col=o,this.world=s,this.resolution=r,this.scale=n,this.coords=l,this.bounds=a},L=function(t){function i(i){var o;return(o=t.call(this,i)||this)._tileMap=new Map,o.container=new T.Display(e._assertThisInitialized(o)),o.layer=null,o.tiles=[],o}e._inheritsLoose(i,t);var o=i.prototype;return o.attach=function(){},o.detach=function(){},o.requestRender=function(){this.container.requestRender()},o.tilesChanged=function(e,t){},o.doRefresh=async function(){},o.isUpdating=function(){return!1},o.update=function(e){const t=this._tileInfoView,i=this.tiles;if(t){const o=t.getTileCoverage(e.state,0),{spans:s,lodInfo:r}=o,{level:n}=r;if(s.length)for(const{row:e,colFrom:t,colTo:o}of s)for(let s=t;s<=o;s++){const t=r.normalizeCol(s),o=r.getWorldForColumn(s),l=`${n}/${e}/${t}/${o}`;if(!this._tileMap.has(l)){const s=new C(l,n,e,t,o,r.resolution,r.scale);r.getTileCoords(s.coords,s,!1),r.getTileBounds(s.bounds,s,!0),this._tileMap.set(l,s),i.push(s),V.push(s)}v.add(l)}}for(let e=i.length-1;e>=0;e--){const t=i[e];v.has(t.id)||(i.splice(e,1),b.push(t),this._tileMap.delete(t.id))}(V.length||b.length)&&(this.tilesChanged(V,b),V.length=b.length=0),v.clear(),this.requestRender()},o.moveStart=function(){},o.viewChange=function(){this.requestUpdate()},o.moveEnd=function(){},e._createClass(i,[{key:"_tileInfoView",get:function(){const e=this.layer&&this.layer.tileInfo;return e?new f(e):null}}]),i}(h.RefreshableLayerView(_.LayerView2DMixin(w)));return t.__decorate([r.property({dependsOn:["layer.loaded"]})],L.prototype,"_tileInfoView",null),t.__decorate([r.property()],L.prototype,"layer",void 0),L=t.__decorate([n.subclass("esri.views.2d.layers.BaseLayerView2D")],L),L}));
