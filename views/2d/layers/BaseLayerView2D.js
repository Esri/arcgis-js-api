/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/accessorSupport/decorators/subclass","../../../geometry/support/aaBoundingRect","../../../geometry/support/spatialReferenceUtils","../tiling/PagedTileQueue","../tiling/TileInfoView","../tiling/TileKey","../tiling/TileQueue","../tiling/TileStrategy","./LayerView2D","./support/Display","../../layers/LayerView","../../layers/RefreshableLayerView"],(function(e,t,i,s,n,o,r,l,a,c,u,p,h,d,f,y,g){"use strict";const w=new Set,_=[],v=[];let T=function(e,t,i,s,n,o,l,a=[0,0],c=r.create()){this.id=e,this.level=t,this.row=i,this.col=s,this.world=n,this.resolution=o,this.scale=l,this.coords=a,this.bounds=c},C=function(t){function i(e){var i;return(i=t.call(this,e)||this)._tileMap=new Map,i.layer=null,i.tiles=[],i}e._inheritsLoose(i,t);var s=i.prototype;return s.initialize=function(){this.display=new f.Display(this),this.container.addChild(this.display)},s.attach=function(){},s.detach=function(){},s.requestRender=function(){this.display.requestRender()},s.tilesChanged=function(e,t){},s.supportsSpatialReference=function(e){const t=this.layer?.tileInfo;return!t||l.equals(t.spatialReference,e)},s.doRefresh=function(){var t=e._asyncToGenerator((function*(){}));function i(){return t.apply(this,arguments)}return i}(),s.isUpdating=function(){return!1},s.update=function(e){const t=this._tileInfoView,i=this.tiles;if(t){const s=t.getTileCoverage(e.state,0),{spans:n,lodInfo:o}=s??{};if(n&&n.length&&o)for(const{row:e,colFrom:t,colTo:r}of n)for(let s=t;s<=r;s++){const t=o.normalizeCol(s),n=o.getWorldForColumn(s),r=`${o.level}/${e}/${t}/${n}`;if(!this._tileMap.has(r)){const s=new T(r,o.level,e,t,n,o.resolution,o.scale);o.getTileCoords(s.coords,s,!1),o.getTileBounds(s.bounds,s,!0),this._tileMap.set(r,s),i.push(s),_.push(s)}w.add(r)}}for(let s=i.length-1;s>=0;s--){const e=i[s];w.has(e.id)||(i.splice(s,1),v.push(e),this._tileMap.delete(e.id))}(_.length||v.length)&&(this.tilesChanged(_,v),_.length=v.length=0),w.clear(),this.requestRender()},s.moveStart=function(){},s.viewChange=function(){this.requestUpdate()},s.moveEnd=function(){},e._createClass(i,[{key:"_tileInfoView",get:function(){const e=this.layer&&this.layer.tileInfo;return e?new c(e):null}}]),i}(g(d.LayerView2DMixin(y)));t.__decorate([i.property()],C.prototype,"_tileInfoView",null),t.__decorate([i.property()],C.prototype,"layer",void 0),C=t.__decorate([o.subclass("esri.views.2d.layers.BaseLayerView2D")],C);return C}));
