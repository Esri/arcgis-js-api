/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Logger","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Extent","../../engine/imagery/RasterVFDisplayObject"],(function(e,t,r,i,o,a,n,s,l,c,d,p){"use strict";let y=function(t){function r(e){var r;return(r=t.call(this,e)||this)._loading=null,r.update=a.debounce(((e,t)=>r._update(e,t).catch((e=>{a.isAbortError(e)||i.getLogger(r.declaredClass).error(e)})))),r}e._inheritsLoose(r,t);var n=r.prototype;return n.redraw=function(e){if(!this.container.children.length)return;const t=this.container.children[0];t.symbolizerParameters=e,t.invalidateVAO(),this.container.symbolTypes="wind_speed"===e.style?["scalar","triangle"]:"simple_scalar"===e.style?["scalar"]:["triangle"],this.container.requestRender()},n._update=function(){var t=e._asyncToGenerator((function*(e,t,r){if(!e.stationary)return;const{extent:i,spatialReference:o}=e.state,a=new d({xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax,spatialReference:o}),[n,s]=e.state.size;this._loading=this.fetchPixels(a,n,s,r);const l=yield this._loading;this._addToDisplay(l,t,e.state),this._loading=null}));function r(e,r,i){return t.apply(this,arguments)}return r}(),n._addToDisplay=function(e,t,r){if(o.isNone(e.pixelBlock))return this.container.children.forEach((e=>e.destroy())),void this.container.removeAllChildren();const{extent:i,pixelBlock:a}=e,n=new p.RasterVFDisplayObject(a);n.offset=[0,0],n.symbolizerParameters=t,n.rawPixelData=e,n.invalidateVAO(),n.x=i.xmin,n.y=i.ymax,n.pixelRatio=r.pixelRatio,n.rotation=r.rotation,n.resolution=r.resolution,n.width=a.width*t.symbolTileSize,n.height=a.height*t.symbolTileSize,this.container.children.forEach((e=>e.destroy())),this.container.removeAllChildren(),this.container.symbolTypes="wind_speed"===t.style?["scalar","triangle"]:"simple_scalar"===t.style?["scalar"]:["triangle"],this.container.addChild(n)},e._createClass(r,[{key:"updating",get:function(){return!!this._loading}}]),r}(r);t.__decorate([n.property()],y.prototype,"fetchPixels",void 0),t.__decorate([n.property()],y.prototype,"container",void 0),t.__decorate([n.property()],y.prototype,"_loading",void 0),t.__decorate([n.property()],y.prototype,"updating",null),y=t.__decorate([c.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],y);return y}));
