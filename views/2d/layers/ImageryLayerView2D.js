/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/watchUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","./LayerView2D","./imagery/ImageryGraphicsView2D","./imagery/ImageryView2D","../../layers/ImageryLayerView","../../layers/LayerView","../../layers/RefreshableLayerView"],(function(e,t,i,s,r,a,n,o,u,h,l,c,y,d){"use strict";let p=function(t){function s(){var e;return(e=t.apply(this,arguments)||this)._exportImageVersion=-1,e}e._inheritsLoose(s,t);var r=s.prototype;return r.initialize=function(){this.handles.add([i.init(this,["layer.blendMode","layer.effects"],(e=>{this.subview&&(this.subview.container.blendMode=e)}),!0),i.init(this,["layer.effect"],(e=>{this.subview&&(this.subview.container.effect=e)}),!0)])},r.hitTest=function(e,t){return this.suspended||!this.subview?Promise.resolve(null):this.subview.hitTest(e,t)},r.update=function(e){var t;null==(t=this.subview)||t.update(e)},r.attach=function(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([i.init(this,"layer.exportImageServiceParameters.version",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),this.watch("timeExtent",(()=>{this.subview.timeExtent=this.timeExtent,this.requestUpdate()})),this.layer.on("redraw",(()=>this.subview.redraw())),i.watch(this.layer,"renderer",(()=>this._setSubView()))],"imagerylayerview-update")},r.detach=function(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove("imagerylayerview-update"),this._exportImageVersion=-1},r.moveStart=function(){},r.viewChange=function(){},r.moveEnd=function(){this.requestUpdate()},r.doRefresh=function(){var t=e._asyncToGenerator((function*(){this.requestUpdate()}));function i(){return t.apply(this,arguments)}return i}(),r.isUpdating=function(){return!this.subview||!this.suspended&&this.subview.isUpdating()},r._setSubView=function(){var e;let t="Imagery";var i,s;("vector-field"===(null==(e=this.layer.renderer)?void 0:e.type)&&"lerc"===this.layer.format&&(t="Graphics"),this.subview&&this.subview.type===t)||(null==(i=this.subview)||i.uninstall(this.container),null==(s=this.subview)||s.destroy(),this.subview="Imagery"===t?new l({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new h({layer:this.layer,view:this.view,timeExtent:this.timeExtent}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode,this.subview.container.effect=this.layer.effect);this.requestUpdate()},e._createClass(s,[{key:"pixelData",get:function(){return this.updating?null:this.subview.getPixelData()}},{key:"updating",get:function(){return!(this.subview&&!this.subview.updating)}}]),s}(c.ImageryLayerView(d.RefreshableLayerView(u.LayerView2DMixin(y))));return t.__decorate([s.property()],p.prototype,"pixelData",null),t.__decorate([s.property({readOnly:!0})],p.prototype,"updating",null),t.__decorate([s.property()],p.prototype,"subview",void 0),p=t.__decorate([o.subclass("esri.views.2d.layers.ImageryLayerView2D")],p),p}));
