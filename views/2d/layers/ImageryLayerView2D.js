/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/watchUtils","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","../engine/flow/AnimatedFlowView2D","./LayerView2D","./imagery/ImageryGraphicsView2D","./imagery/ImageryView2D","../../layers/ImageryLayerView","../../layers/LayerView","../../layers/RefreshableLayerView"],(function(e,t,i,r,s,a,n,u,h,o,l,c,w,y,d){"use strict";let p=function(t){function r(){var e;return(e=t.apply(this,arguments)||this)._exportImageVersion=-1,e}e._inheritsLoose(r,t);var s=r.prototype;return s.initialize=function(){this.handles.add([i.init(this,["layer.blendMode","layer.effects"],(e=>{this.subview&&(this.subview.container.blendMode=e)}),!0),i.init(this,"layer.effect",(e=>{this.subview&&(this.subview.container.effect=e)}),!0)])},s.hitTest=function(){var t=e._asyncToGenerator((function*(e,t){return this.subview?"hitTest"in this.subview?[this.subview.hitTest(e)]:[]:null}));function i(e,i){return t.apply(this,arguments)}return i}(),s.update=function(e){var t;null==(t=this.subview)||t.update(e)},s.attach=function(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([i.init(this,"layer.exportImageServiceParameters.version",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),this.watch("timeExtent",(()=>{"timeExtent"in this.subview&&(this.subview.timeExtent=this.timeExtent),this.requestUpdate()})),this.layer.on("redraw",(()=>{"redraw"in this.subview?this.subview.redraw():this.subview.redrawOrRefetch()})),i.watch(this.layer,"renderer",(()=>this._setSubView()))],"imagerylayerview-update")},s.detach=function(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove("imagerylayerview-update"),this._exportImageVersion=-1},s.moveStart=function(){},s.viewChange=function(){},s.moveEnd=function(){this.requestUpdate()},s.doRefresh=function(){var t=e._asyncToGenerator((function*(){this.requestUpdate()}));function i(){return t.apply(this,arguments)}return i}(),s.isUpdating=function(){return!this.subview||!this.suspended&&this.subview.updating},s._setSubView=function(){var e,t;let i="Imagery";"vector-field"===(null==(e=this.layer.renderer)?void 0:e.type)&&"lerc"===this.layer.format&&(i="Graphics");var r,s;("animated-flow"===(null==(t=this.layer.renderer)?void 0:t.type)&&(i="Flow"),this.subview&&this.subview.type===i)||(null==(r=this.subview)||r.uninstall(this.container),null==(s=this.subview)||s.destroy(),this.subview="Imagery"===i?new c({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"Graphics"===i?new l({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new h({layer:this.layer,layerView:this}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode,this.subview.container.effect=this.layer.effect);this.requestUpdate()},e._createClass(r,[{key:"pixelData",get:function(){return this.updating?null:"getPixelData"in this.subview?this.subview.getPixelData():null}},{key:"updating",get:function(){return!!(!this.subview||"updating"in this.subview&&this.subview.updating)}}]),r}(w.ImageryLayerView(d.RefreshableLayerView(o.LayerView2DMixin(y))));t.__decorate([r.property()],p.prototype,"pixelData",null),t.__decorate([r.property({readOnly:!0})],p.prototype,"updating",null),t.__decorate([r.property()],p.prototype,"subview",void 0),p=t.__decorate([u.subclass("esri.views.2d.layers.ImageryLayerView2D")],p);return p}));
