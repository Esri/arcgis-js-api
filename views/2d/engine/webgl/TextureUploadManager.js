/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../core/maybe","../../../../core/promiseUtils","./definitions","../../../webgl/context-util"],(function(e,t,o,n,s){"use strict";let u=function(){function e(e,t){this._queue=[],this._context=e,this._refreshable=t}var u=e.prototype;return u.destroy=function(){this._queue=[]},u.enqueueTextureUpdate=function(e,t){const u=o.createResolver(),r=e,i=n.TEXTURE_UPLOAD_MANAGER_CHUNK_SIZE,h=Math.ceil(r.height/i);if(o.throwIfAborted(t),this._context.type===s.ContextType.WEBGL1)this._queue.push({type:"no-chunk",request:e,resolver:u,options:t});else for(let o=0;o<h;o++){const n=o*i,s=o===h-1,c=s?r.height-i*o:i;this._queue.push({type:"chunk",request:e,resolver:u,chunk:o,chunkOffset:n,destHeight:c,chunkIsLast:s,options:t})}return o.onAbortOrThrow(t,(e=>u.reject(e))),u.promise},u.upload=function(){let e=0;for(;this._queue.length;){const o=performance.now(),s=this._queue.shift();if(s){if(t.isSome(s.options.signal)&&s.options.signal.aborted)continue;switch(s.type){case"chunk":this._uploadChunk(s);break;case"no-chunk":this._uploadNoChunk(s)}const u=performance.now()-o;if(e+=u,e+u>=n.TEXTURE_UPLOAD_MANAGER_BUDGET)break}}this._queue.length&&this._refreshable.requestRender()},u._uploadChunk=function(e){const{request:o,resolver:n,chunkOffset:s,chunkIsLast:u,destHeight:r}=e,{data:i,texture:h,width:c}=o;t.isSome(i)&&(h.updateData(0,0,s,c,r,i,s),u&&n.resolve())},u._uploadNoChunk=function(e){const{request:t,resolver:o}=e,{data:n,texture:s}=t;s.setData(n),o.resolve()},e}();e.TextureUploadManager=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
