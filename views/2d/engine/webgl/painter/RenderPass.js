/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../../core/has","../../../../../core/maybe","../../../../../core/arrayUtils","../enums"],(function(e,r,t,s){"use strict";return function(){function a(e,r){var t;this.brushes=e,this.name=r.name,this.drawPhase=r.drawPhase||s.WGLDrawPhase.MAP,this._targetFn=r.target,this.effects=r.effects||[],this.enableDefaultDraw=null!=(t=r.enableDefaultDraw)?t:()=>!0,this.has=r.has}var n=a.prototype;return n.render=function(r){const{context:t,profiler:s}=r,a=this._targetFn(),n=this.drawPhase&r.drawPhase;if(s.recordPassStart(this.name),n&&(!this.has||e(this.has))){this.enableDefaultDraw()&&this._doRender(r,a),s.recordPassEnd();for(const e of this.effects){if(!e.enable())continue;const n=e.apply;s.recordPassStart(this.name+"."+n.name),s.recordBrushStart(n.name);const i=e.args&&e.args(),{x:o,y:h,width:f,height:d}=t.getViewport(),c=t.getBoundFramebufferObject();n.bind(r,i),this._doRender(r,a,n.defines),n.draw(r,i),n.unbind(r,i),t.bindFramebuffer(c),t.setViewport(o,h,f,d),s.recordBrushEnd(),s.recordPassEnd()}}},n._doRender=function(e,s,a){if(!r.isNone(s))if(t.isArrayLike(s)){for(const r of s)if(r.visible)for(const t of this.brushes)e.profiler.recordBrushStart(t.name),t.prepareState(e,r,a),t.draw(e,r,a),e.profiler.recordBrushEnd()}else for(const r of this.brushes)e.profiler.recordBrushStart(r.name),r.prepareState(e,s,a),r.draw(e,s,a),e.profiler.recordBrushEnd()},a}()}));
