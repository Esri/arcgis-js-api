/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/time","../../../../../geometry/support/meshUtils/exporters/gltf/imageutils"],(function(e,r,t,n){"use strict";var i={},a={},o={};Object.defineProperty(o,"__esModule",{value:!0}),o.loop=o.conditional=o.parse=void 0;var s=function e(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(Array.isArray(t))t.forEach((function(t){return e(r,t,n,i)}));else if("function"==typeof t)t(r,n,i,e);else{var a=Object.keys(t)[0];Array.isArray(t[a])?(i[a]={},e(r,t[a],n,i[a])):i[a]=t[a](r,n,i,e)}return n};o.parse=s;var d=function(e,r){return function(t,n,i,a){r(t,n,i)&&a(t,e,n,i)}};o.conditional=d;var c=function(e,r){return function(t,n,i,a){for(var o=[],s=t.pos;r(t,n,i);){var d={};if(a(t,e,n,d),t.pos===s)break;s=t.pos,o.push(d)}return o}};o.loop=c;var u={};Object.defineProperty(u,"__esModule",{value:!0}),u.readBits=u.readArray=u.readUnsigned=u.readString=u.peekBytes=u.readBytes=u.peekByte=u.readByte=u.buildStream=void 0;var l=function(e){return{data:e,pos:0}};u.buildStream=l;var f=function(){return function(e){return e.data[e.pos++]}};u.readByte=f;var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(r){return r.data[r.pos+e]}};u.peekByte=p;var g=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};u.readBytes=g;var y=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};u.peekBytes=y;var v=function(e){return function(r){return Array.from(g(e)(r)).map((function(e){return String.fromCharCode(e)})).join("")}};u.readString=v;var h=function(e){return function(r){var t=g(2)(r);return e?(t[1]<<8)+t[0]:(t[0]<<8)+t[1]}};u.readUnsigned=h;var m=function(e,r){return function(t,n,i){for(var a="function"==typeof r?r(t,n,i):r,o=g(e),s=new Array(a),d=0;d<a;d++)s[d]=o(t);return s}};u.readArray=m;var B=function(e,r,t){for(var n=0,i=0;i<t;i++)n+=e[r+i]&&Math.pow(2,t-i-1);return n},b=function(e){return function(r){for(var t=f()(r),n=new Array(8),i=0;i<8;i++)n[7-i]=!!(t&1<<i);return Object.keys(e).reduce((function(r,t){var i=e[t];return i.length?r[t]=B(n,i.index,i.length):r[t]=n[i.index],r}),{})}};u.readBits=b,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=o,t=u,n={blocks:function(e){for(var r=0,n=[],i=e.data.length,a=0,o=(0,t.readByte)()(e);o!==r&&o;o=(0,t.readByte)()(e)){if(e.pos+o>=i){var s=i-e.pos;n.push((0,t.readBytes)(s)(e)),a+=s;break}n.push((0,t.readBytes)(o)(e)),a+=o}for(var d=new Uint8Array(a),c=0,u=0;u<n.length;u++)d.set(n[u],c),c+=n[u].length;return d}},i=(0,r.conditional)({gce:[{codes:(0,t.readBytes)(2)},{byteSize:(0,t.readByte)()},{extras:(0,t.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,t.readUnsigned)(!0)},{transparentColorIndex:(0,t.readByte)()},{terminator:(0,t.readByte)()}]},(function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&249===r[1]})),a=(0,r.conditional)({image:[{code:(0,t.readByte)()},{descriptor:[{left:(0,t.readUnsigned)(!0)},{top:(0,t.readUnsigned)(!0)},{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{lct:(0,t.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,t.readArray)(3,(function(e,r,t){return Math.pow(2,t.descriptor.lct.size+1)}))},(function(e,r,t){return t.descriptor.lct.exists})),{data:[{minCodeSize:(0,t.readByte)()},n]}]},(function(e){return 44===(0,t.peekByte)()(e)})),s=(0,r.conditional)({text:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{preData:function(e,r,n){return(0,t.readBytes)(n.text.blockSize)(e)}},n]},(function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&1===r[1]})),d=(0,r.conditional)({application:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{id:function(e,r,n){return(0,t.readString)(n.blockSize)(e)}},n]},(function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&255===r[1]})),c=(0,r.conditional)({comment:[{codes:(0,t.readBytes)(2)},n]},(function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&254===r[1]})),l=[{header:[{signature:(0,t.readString)(3)},{version:(0,t.readString)(3)}]},{lsd:[{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{gct:(0,t.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,t.readByte)()},{pixelAspectRatio:(0,t.readByte)()}]},(0,r.conditional)({gct:(0,t.readArray)(3,(function(e,r){return Math.pow(2,r.lsd.gct.size+1)}))},(function(e,r){return r.lsd.gct.exists})),{frames:(0,r.loop)([i,d,c,a,s],(function(e){var r=(0,t.peekByte)()(e);return 33===r||44===r}))}];e.default=l}(a);var x={};Object.defineProperty(x,"__esModule",{value:!0}),x.deinterlace=void 0;var w=function(e,r){for(var t=new Array(e.length),n=e.length/r,i=function(n,i){var a=e.slice(i*r,(i+1)*r);t.splice.apply(t,[n*r,r].concat(a))},a=[0,4,2,1],o=[8,8,4,2],s=0,d=0;d<4;d++)for(var c=a[d];c<n;c+=o[d])i(c,s),s++;return t};x.deinterlace=w;var k={};Object.defineProperty(k,"__esModule",{value:!0}),k.lzw=void 0;var A=function(e,r,t){var n,i,a,o,s,d,c,u,l,f,p,g,y,v,h,m,B=4096,b=-1,x=t,w=new Array(t),k=new Array(B),A=new Array(B),U=new Array(B+1);for(s=(i=1<<(f=e))+1,n=i+2,c=b,a=(1<<(o=f+1))-1,u=0;u<i;u++)k[u]=0,A[u]=u;for(p=g=y=v=h=m=0,l=0;l<x;){if(0===v){if(g<o){p+=r[m]<<g,g+=8,m++;continue}if(u=p&a,p>>=o,g-=o,u>n||u==s)break;if(u==i){a=(1<<(o=f+1))-1,n=i+2,c=b;continue}if(c==b){U[v++]=A[u],c=u,y=u;continue}for(d=u,u==n&&(U[v++]=y,u=c);u>i;)U[v++]=A[u],u=k[u];y=255&A[u],U[v++]=y,n<B&&(k[n]=c,A[n]=y,0==(++n&a)&&n<B&&(o++,a+=n)),c=d}v--,w[h++]=U[v],l++}for(l=h;l<x;l++)w[l]=0;return w};k.lzw=A,Object.defineProperty(i,"__esModule",{value:!0});var U=i.decompressFrames=i.decompressFrame=j=i.parseGIF=void 0,S=C(a),_=o,I=u,z=x,M=k;function C(e){return e&&e.__esModule?e:{default:e}}var T=function(e){var r=new Uint8Array(e);return(0,_.parse)((0,I.buildStream)(r),S.default)},j=i.parseGIF=T,F=function(e){for(var r=e.pixels.length,t=new Uint8ClampedArray(4*r),n=0;n<r;n++){var i=4*n,a=e.pixels[n],o=e.colorTable[a]||[0,0,0];t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=a!==e.transparentIndex?255:0}return t},O=function(e,r,t){if(e.image){var n=e.image,i=n.descriptor.width*n.descriptor.height,a=(0,M.lzw)(n.data.minCodeSize,n.data.blocks,i);n.descriptor.lct.interlaced&&(a=(0,z.deinterlace)(a,n.descriptor.width));var o={pixels:a,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?o.colorTable=n.lct:o.colorTable=r,e.gce&&(o.delay=10*(e.gce.delay||10),o.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(o.transparentIndex=e.gce.transparentColorIndex)),t&&(o.patch=F(o)),o}console.warn("gif frame does not have associated image.")};i.decompressFrame=O;var G=function(e,r){return e.frames.filter((function(e){return e.image})).map((function(t){return O(t,e.gct,r)}))};function P(e,r){return D.apply(this,arguments)}function D(){return D=r._asyncToGenerator((function*(e,r){const i=j(e),a=U(i,!0),{width:o,height:s}=i.lsd,d=document.createElement("canvas");d.width=o,d.height=s;const c=d.getContext("2d"),u=[],l=[];for(const f of a){l.push(t.Milliseconds(f.delay||100));const e=new ImageData(f.patch,f.dims.width,f.dims.height),r=n.imageTypeToCanvas(e),i=3===f.disposalType&&c.getImageData(f.dims.left,f.dims.top,f.dims.width,f.dims.height);c.drawImage(r,f.dims.left,f.dims.top);const a=c.getImageData(0,0,o,s);u.push(a),1===f.disposalType||(2===f.disposalType?c.clearRect(f.dims.left,f.dims.top,f.dims.width,f.dims.height):3===f.disposalType&&c.putImageData(i,f.dims.left,f.dims.top))}return{frameDurations:l,getFrame:e=>u[e],width:o,height:s}})),D.apply(this,arguments)}U=i.decompressFrames=G;const E=[71,73,70];function R(e){const r=new Uint8Array(e);return!E.some(((e,t)=>e!==r[t]))}function H(e){if(!R(e))return!1;const r=new DataView(e),t=r.getUint8(10);let n=13+(128&t?3*2**(1+(7&t)):0),i=0,a=!1;for(;!a;){switch(r.getUint8(n++)){case 33:if(!o())return!1;break;case 44:s();break;case 59:a=!0;break;default:return!1}if(i>1)return!0}function o(){switch(r.getUint8(n++)){case 249:d();break;case 1:c();break;case 254:u();break;case 255:l();break;default:return!1}return!0}function s(){i++,n+=8;const e=r.getUint8(n++);n+=128&e?3*2**(1+(7&e)):0,n++,f()}function d(){n++,n+=4,f()}function c(){i++,n++,n+=12,f()}function u(){f()}function l(){n++,n+=8,n+=3,f()}function f(){let e;for(;e=r.getUint8(n++);)n+=e}return!1}e.isAnimatedGIF=H,e.isGIF=R,e.parseGif=P,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
