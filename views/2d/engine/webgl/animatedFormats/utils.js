/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/time","../../../../../symbols/cim/enums","../grouping"],(function(e,t,i,r){"use strict";function a(e){return t.Milliseconds(e.frameDurations.reduce(((e,t)=>e+t),0))}function n(e){const{width:t,height:i}=e;return{frameDurations:e.frameDurations.reverse(),getFrame:t=>{const i=e.frameDurations.length-1-t;return e.getFrame(i)},width:t,height:i}}function s(e,i){const{width:r,height:n,getFrame:s}=e,o=i/a(e);return{frameDurations:e.frameDurations.map((e=>t.Milliseconds(e*o))),getFrame:s,width:r,height:n}}function o(e,i){const{width:r,height:a,getFrame:n}=e,s=e.frameDurations.slice(),o=s.shift();return s.unshift(t.Milliseconds(o+i)),{frameDurations:s,getFrame:n,width:r,height:a}}function m(e,i){const{width:r,height:a,getFrame:n}=e,s=e.frameDurations.slice(),o=s.pop();return s.push(t.Milliseconds(o+i)),{frameDurations:s,getFrame:n,width:r,height:a}}let l=function(){function e(e,t,i,r){this._animation=e,this._repeatType=i,this._onFrameData=r,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;t>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}return e.prototype.nextFrame=function(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case i.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case i.AnimatedSymbolRepeatType.Loop:this._currentFrame=0;break;case i.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case i.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case i.AnimatedSymbolRepeatType.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case i.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const e=this._animation.getFrame(this._currentFrame);this._onFrameData(e)},e}();function c(e,c,u,h){let d,{repeatType:p}=c;if(null==p&&(p=i.AnimatedSymbolRepeatType.Loop),!0===c.reverseAnimation&&(e=n(e)),null!=c.duration&&(e=s(e,t.Milliseconds(1e3*c.duration))),null!=c.repeatDelay){const r=1e3*c.repeatDelay;p===i.AnimatedSymbolRepeatType.Loop?e=m(e,t.Milliseconds(r)):p===i.AnimatedSymbolRepeatType.Oscillate&&(e=o(m(e,t.Milliseconds(r/2)),t.Milliseconds(r/2)))}if(null!=c.startTimeOffset)d=t.Milliseconds(1e3*c.startTimeOffset);else if(null!=c.randomizeStartTime){const i=r.getMaterialGroup(u),n=82749913,s=null!=c.randomizeStartSeed?c.randomizeStartSeed:n,o=r.getRandomValue(i,s);d=t.Milliseconds(o*a(e))}else d=t.Milliseconds(0);return new l(e,d,p,h)}function u(e,t,i,r){const a=null==t.playAnimation||t.playAnimation,n=c(e,t,i,r);let s,o=n.timeToFrame;function m(){s=a&&setTimeout((()=>{n.nextFrame(),o=n.timeToFrame,m()}),o)}return m(),{remove:()=>{a&&clearTimeout(s)}}}e.Player=l,e.adjustDuration=s,e.appendDelay=m,e.createPlayer=c,e.getDuration=a,e.play=u,e.prependDelay=o,e.reverse=n,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
