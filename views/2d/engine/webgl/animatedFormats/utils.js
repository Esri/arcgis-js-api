/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/time","../../../../../geometry/support/meshUtils/exporters/gltf/imageutils","../../../../../symbols/cim/enums","../grouping"],(function(e,t,i,r,a){"use strict";function n(e){return t.Milliseconds(e.frameDurations.reduce(((e,t)=>e+t),0))}function s(e){const{width:t,height:i}=e;return{frameDurations:e.frameDurations.reverse(),getFrame:t=>{const i=e.frameDurations.length-1-t;return e.getFrame(i)},width:t,height:i}}function o(e,i){const{width:r,height:a,getFrame:s}=e,o=i/n(e);return{frameDurations:e.frameDurations.map((e=>t.Milliseconds(e*o))),getFrame:s,width:r,height:a}}function m(e,i){const{width:r,height:a,getFrame:n}=e,s=e.frameDurations.slice(),o=s.shift();return s.unshift(t.Milliseconds(o+i)),{frameDurations:s,getFrame:n,width:r,height:a}}function c(e,i){const{width:r,height:a,getFrame:n}=e,s=e.frameDurations.slice(),o=s.pop();return s.push(t.Milliseconds(o+i)),{frameDurations:s,getFrame:n,width:r,height:a}}let l=function(){function e(e,t,i,r){this._animation=e,this._repeatType=i,this._onFrameData=r,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let a=0;for(;t>a;)a+=this.timeToFrame,this.nextFrame();const n=this._animation.getFrame(this._currentFrame);this._onFrameData(n)}return e.prototype.nextFrame=function(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case r.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case r.AnimatedSymbolRepeatType.Loop:this._currentFrame=0;break;case r.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case r.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case r.AnimatedSymbolRepeatType.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case r.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const e=this._animation.getFrame(this._currentFrame);this._onFrameData(e)},e}();function u(e,i,u,h){let d,{repeatType:p}=i;if(null==p&&(p=r.AnimatedSymbolRepeatType.Loop),!0===i.reverseAnimation&&(e=s(e)),null!=i.duration&&(e=o(e,t.Milliseconds(1e3*i.duration))),null!=i.repeatDelay){const a=1e3*i.repeatDelay;p===r.AnimatedSymbolRepeatType.Loop?e=c(e,t.Milliseconds(a)):p===r.AnimatedSymbolRepeatType.Oscillate&&(e=m(c(e,t.Milliseconds(a/2)),t.Milliseconds(a/2)))}if(null!=i.startTimeOffset)d=t.Milliseconds(1e3*i.startTimeOffset);else if(null!=i.randomizeStartTime){const r=a.getMaterialGroup(u),s=82749913,o=null!=i.randomizeStartSeed?i.randomizeStartSeed:s,m=a.getRandomValue(r,o);d=t.Milliseconds(m*n(e))}else d=t.Milliseconds(0);return new l(e,d,p,h)}function h(e,t,i,r){const a=null==t.playAnimation||t.playAnimation,n=u(e,t,i,r);let s,o=n.timeToFrame;function m(){s=a?setTimeout((()=>{n.nextFrame(),o=n.timeToFrame,m()}),o):void 0}return m(),{remove:()=>{a&&clearTimeout(s)}}}const d=document.createElement("canvas"),p=d.getContext("2d");function f(e,t,r){d.width=t,d.height=r;const a=[],n=e.frameDurations.length;for(let s=0;s<n;s++){const n=e.getFrame(s);p.clearRect(0,0,t,r),n instanceof ImageData?p.drawImage(i.imageTypeToCanvas(n),0,0,t,r):p.drawImage(n,0,0,t,r),a.push(p.getImageData(0,0,t,r))}return{width:t,height:r,frameDurations:e.frameDurations,getFrame:e=>a[e]}}e.Player=l,e.adjustDuration=o,e.appendDelay=c,e.createPlayer=u,e.getDuration=n,e.play=h,e.prependDelay=m,e.resize=f,e.reverse=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
