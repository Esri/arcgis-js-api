/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/BufferObject","../../../webgl/FramebufferObject","../../../../core/has","../../../webgl/enums","../../../webgl/RenderingContext","../../../../chunks/builtins","../../../webgl/Texture","../../../webgl/VertexArrayObject","./WGLContainer"],(function(e,t,r,i,n,s,o,a,d,l,c){"use strict";let h=function(e){function r(){var t;return(t=e.apply(this,arguments)||this)._lastWidth=0,t._lastHeight=0,t.requiresDedicatedFBO=!1,t}t._inheritsLoose(r,e);var n=r.prototype;return n.dispose=function(){this._renderTarget&&(this._renderTarget.dispose(),this._renderTarget=null)},n.doRender=function(e){const t=this.createRenderParams(e),{context:r,painter:i,profiler:n}=t;this._prevFBO=r.getBoundFramebufferObject(),n.recordContainerStart(this.name);const s=this._getFbo(t),o=i.getRenderTarget();r.bindFramebuffer(s),i.setRenderTarget(s),r.setDepthWriteEnabled(!0),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.setClearDepth(1),r.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.setDepthWriteEnabled(!1);for(const a of this.children)a.beforeRender(e);for(const a of this.children)a.processRender(t);for(const a of this.children)a.afterRender(e);i.setRenderTarget(o),r.bindFramebuffer(this._prevFBO),i.beforeRenderLayer(t,this._clippingInfos?255:0,this.computedOpacity),r.setStencilTestEnabled(!1),r.setStencilWriteMask(0),i.blitTexture(r,s.colorTexture,9728),i.compositeLayer(t,this.computedOpacity),n.recordContainerEnd()},n.createRenderParams=function(t){return{...e.prototype.createRenderParams.call(this,t),blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:1}},n._getFbo=function(e){const{context:t,painter:r}=e,{width:n,height:s}=t.getViewport();if(n!==this._lastWidth||s!==this._lastHeight)if(this._lastWidth=n,this._lastHeight=s,this._renderTarget)this._renderTarget.resize(n,s);else{const e={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:n,height:s},o={colorTarget:0,depthStencilTarget:3};this._renderTarget=new i(t,o,e,r.getSharedStencilBuffer())}return this._renderTarget},r}(c);e.GroupContainer=h,Object.defineProperty(e,"__esModule",{value:!0})}));
