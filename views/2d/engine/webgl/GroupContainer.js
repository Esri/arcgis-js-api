/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../../core/mathUtils","../../../../chunks/builtins","../../../webgl/FramebufferObject","../../../webgl/RenderingContext","./WGLContainer"],(function(e,t,r,i,n,s,o,a){"use strict";let d=function(e){function r(){var t;return(t=e.apply(this,arguments)||this)._lastWidth=0,t._lastHeight=0,t}t._inheritsLoose(r,e);var i=r.prototype;return i.dispose=function(){this._renderTarget&&(this._renderTarget.dispose(),this._renderTarget=null)},i.doRender=function(e){const t=this.createRenderParams(e),{context:r,painter:i,profiler:n}=t;this._prevFBO=r.getBoundFramebufferObject(),n.recordContainerStart(this.name);const s=this._getFbo(t),o=i.getRenderTarget();r.bindFramebuffer(s),i.setRenderTarget(s),r.setDepthWriteEnabled(!0),r.setClearColor(0,0,0,0),r.setClearDepth(1),r.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.setDepthWriteEnabled(!1);for(const t of this.children)t.beforeRender(e);for(const e of this.children)e.processRender(t);for(const t of this.children)t.afterRender(e);i.setRenderTarget(o),r.bindFramebuffer(this._prevFBO),i.beforeRenderLayer(t,this._clippingInfos?255:0,this.computedOpacity),r.setStencilTestEnabled(!1),r.setStencilWriteMask(0),i.blitTexture(r,s.colorTexture,9728),i.compositeLayer(t,this.computedOpacity),n.recordContainerEnd()},i.createRenderParams=function(t){return{...e.prototype.createRenderParams.call(this,t),blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:1}},i._getFbo=function(e){const{context:t,painter:r}=e,{width:i,height:n}=t.getViewport();if(i!==this._lastWidth||n!==this._lastHeight)if(this._lastWidth=i,this._lastHeight=n,this._renderTarget)this._renderTarget.resize(i,n);else{const e={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:i,height:n},o={colorTarget:0,depthStencilTarget:3},a=r.getSharedStencilBuffer();this._renderTarget=new s(t,o,e,a)}return this._renderTarget},r}(a);e.GroupContainer=d,Object.defineProperty(e,"__esModule",{value:!0})}));
