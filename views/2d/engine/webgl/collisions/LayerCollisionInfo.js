/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/Logger","../../../../../core/mathUtils","../../../../../core/screenUtils","./visualVariableSimpleUtils"],(function(e,t,n,o,i){"use strict";const r=(e,t)=>e.order-t.order,l=(e,t)=>e.index-t.index,a=t.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");function s(e,t){const o=!!e.minScale,i=!!e.maxScale,r=o&&t.scaleToZoom(e.minScale)||0,l=i&&t.scaleToZoom(e.maxScale)||255;return{deconflictionStrategy:e.deconflictionStrategy,minZoom:n.clamp(Math.floor(10*r),0,255),maxZoom:n.clamp(Math.floor(10*l),0,255)}}function c(e){return t=>o.pt2px(i.getSizeForValueSimple(t,e))}function u(e){if(!e)return null;for(const t of e)if("size"===t.type)return c(t);return null}let f=function(){function e(e,t,n,o){this._vvHandle=null;const i=e.layer,{geometryType:r,labelingInfo:l,renderer:a}=i;a&&(this.vvEval=u("visualVariables"in a&&a.visualVariables)),this._vvHandle=i.watch("renderer",(e=>{e&&(this.vvEval=u("visualVariables"in e&&e.visualVariables))}));const c=i.featureReduction,f=c&&"cluster"===c.type&&c.labelingInfo,d=(l||[]).map((e=>s(e,o))),v=(f||[]).map((e=>s(e,o)));this.layerView=e,this.geometryType=r,this.index=t,this.order=n,this.zoomRanges=[...d,...v],this.layerView=e}var t=e.prototype;return t.hasVV=function(){return!!this.vvEval},t.allOrNothing=function(){return!("polyline"===this.geometryType)},t.destroy=function(){this._vvHandle.remove()},e.create=function(t,n,o,i){const l=o.sort(r);let a=!1,s=-1;for(const e of l)!a&&e.order>n&&(s=e.index,a=!0),a&&e.index++;return a||(s=l.length),new e(t,s,n,i)},e.delete=function(e,t){const n=t.sort(l);for(let o=e+1;o<n.length;o++)t[o].index--;t[e].destroy(),t.splice(e,1)},e.find=function(e,t){for(const n of t)if(n.index===e)return n;return a.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!"),null},e}();e.createLabelVVEvaluator=u,e.default=f,Object.defineProperty(e,"__esModule",{value:!0})}));
