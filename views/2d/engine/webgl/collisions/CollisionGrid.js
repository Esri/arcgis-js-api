/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],(function(t,s,i){"use strict";const e=2,o=1,n=0,h=1,c=2;let l=function(){function t(t,s,e){this._debugMap=new Map,this._width=t*e,this._height=s*e,this._pixelRatio=e;const n=Math.ceil(this._width/o),h=Math.ceil(this._height/o);this._cols=n,this._rows=h,this._cells=i.StaticBitSet.create(n*h)}var l=t.prototype;return l.insertMetrics=function(t){const s=this._hasCollision(t);return s===n&&this._markMetrics(t),s},l.getCellId=function(t,s){return t+s*this._cols},l.has=function(t){return this._cells.has(t)},l.hasRange=function(t,s){return this._cells.hasRange(t,s)},l.set=function(t){this._cells.set(t)},l.setRange=function(t,s){this._cells.setRange(t,s)},l._collide=function(t,i,e,l){const r=t-e/2,a=i-l/2,u=r+e,_=a+l;if(u<0||_<0||r>this._width||a>this._height)return h;const d=s.clamp(Math.floor(r/o),0,this._cols),f=s.clamp(Math.floor(a/o),0,this._rows),p=s.clamp(Math.ceil(u/o),0,this._cols),m=s.clamp(Math.ceil(_/o),0,this._rows);for(let s=f;s<=m;s++)for(let t=d;t<=p;t++){const i=this.getCellId(t,s);if(this.has(i))return c}return n},l._mark=function(t,i,e,n,h){const c=t-e/2,l=i-n/2,r=c+e,a=l+n,u=s.clamp(Math.floor(c/o),0,this._cols),_=s.clamp(Math.floor(l/o),0,this._rows),d=s.clamp(Math.ceil(r/o),0,this._cols),f=s.clamp(Math.ceil(a/o),0,this._rows);for(let s=_;s<=f;s++)for(let t=u;t<=d;t++){const i=this.getCellId(t,s);this._debugMap.set(i,h),this.set(i)}return!1},l._hasCollision=function(t){const s=t.id;let i=0,o=0;t.save();do{const s=t.boundsCount;i+=s;for(let i=0;i<s;i++){const s=t.boundsComputedAnchorX(i),n=t.boundsComputedAnchorY(i),l=(t.boundsWidth(i)+e)*this._pixelRatio,r=(t.boundsHeight(i)+e)*this._pixelRatio;switch(this._collide(s,n,l,r)){case c:return c;case h:o++}}}while(t.peekId()===s&&t.next());return t.restore(),i===o?h:n},l._markMetrics=function(t){const s=t.id;t.save();do{const s=t.boundsCount;for(let i=0;i<s;i++){const s=t.boundsComputedAnchorX(i),o=t.boundsComputedAnchorY(i),n=(t.boundsWidth(i)+e)*this._pixelRatio,h=(t.boundsHeight(i)+e)*this._pixelRatio;this._mark(s,o,n,h,t.id)}}while(t.peekId()===s&&t.next());t.restore()},t}();t.CollisionBitsetGrid=l,t.HAS_COLLISION=c,t.NONE=n,t.OUTSIDE_EXTENT=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
