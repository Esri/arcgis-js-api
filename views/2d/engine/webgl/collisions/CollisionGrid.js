/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/mathUtils","../../../layers/features/support/StaticBitSet"],(function(t,s,e){"use strict";const i=2,o=1,n=0,h=1,l=2;let c=function(){function t(t,s,i){this._debugMap=new Map,this._width=t*i,this._height=s*i,this._pixelRatio=i;const n=Math.ceil(this._width/o),h=Math.ceil(this._height/o);this._cols=n,this._rows=h,this._cells=e.StaticBitSet.create(n*h)}var c=t.prototype;return c.insertMetrics=function(t){const s=this._hasCollision(t);return s===n&&this._markMetrics(t),s},c.getCellId=function(t,s){return t+s*this._cols},c.has=function(t){return this._cells.has(t)},c.hasRange=function(t,s){return this._cells.hasRange(t,s)},c.set=function(t){this._cells.set(t)},c.setRange=function(t,s){this._cells.setRange(t,s)},c._collide=function(t,e,i,c){const r=t-i/2,a=e-c/2,u=r+i,_=a+c;if(u<0||_<0||r>this._width||a>this._height)return h;const d=s.clamp(Math.floor(r/o),0,this._cols),f=s.clamp(Math.floor(a/o),0,this._rows),p=s.clamp(Math.ceil(u/o),0,this._cols),m=s.clamp(Math.ceil(_/o),0,this._rows);for(let s=f;s<=m;s++)for(let t=d;t<=p;t++){const e=this.getCellId(t,s);if(this.has(e))return l}return n},c._mark=function(t,e,i,n,h){const l=t-i/2,c=e-n/2,r=l+i,a=c+n,u=s.clamp(Math.floor(l/o),0,this._cols),_=s.clamp(Math.floor(c/o),0,this._rows),d=s.clamp(Math.ceil(r/o),0,this._cols),f=s.clamp(Math.ceil(a/o),0,this._rows);for(let s=_;s<=f;s++)for(let t=u;t<=d;t++){const e=this.getCellId(t,s);this._debugMap.set(e,h),this.set(e)}return!1},c._hasCollision=function(t){const s=t.id;let e=0,o=0;t.save();do{const s=t.boundsCount;e+=s;for(let e=0;e<s;e++){const s=t.boundsComputedAnchorX(e),n=t.boundsComputedAnchorY(e),c=(t.boundsWidth(e)+i)*this._pixelRatio,r=(t.boundsHeight(e)+i)*this._pixelRatio;switch(this._collide(s,n,c,r)){case l:return l;case h:o++}}}while(t.peekId()===s&&t.next());return t.restore(),e===o?h:n},c._markMetrics=function(t){const s=t.id;t.save();do{const s=t.boundsCount;for(let e=0;e<s;e++){const s=t.boundsComputedAnchorX(e),o=t.boundsComputedAnchorY(e),n=(t.boundsWidth(e)+i)*this._pixelRatio,h=(t.boundsHeight(e)+i)*this._pixelRatio;this._mark(s,o,n,h,t.id)}}while(t.peekId()===s&&t.next());t.restore()},t}();t.CollisionBitsetGrid=c,t.HAS_COLLISION=l,t.NONE=n,t.OUTSIDE_EXTENT=h,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
