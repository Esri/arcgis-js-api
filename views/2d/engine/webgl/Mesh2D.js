/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Error","../../../../core/Logger","../../../../core/maybe","../../../../chunks/earcut","../../../../chunks/vec2","../../../../chunks/vec2f64","../../../../layers/graphics/featureConversionUtils","../../../../layers/graphics/OptimizedGeometry","./number","../../../webgl/BufferObject","../../../webgl/enums"],(function(e,t,r,n,o,i,c,s,a,f,h,u){"use strict";const y=e=>{switch(e.BYTES_PER_ELEMENT){case 1:return u.DataType.UNSIGNED_BYTE;case 2:return u.DataType.UNSIGNED_SHORT;case 4:return u.DataType.UNSIGNED_INT;default:throw new t("Cannot get DataType of array")}},m=(e,t,r,n)=>{let o=0;for(let i=1;i<r;i++){const r=e[2*(t+i-1)],n=e[2*(t+i-1)+1];o+=(e[2*(t+i)]-r)*(e[2*(t+i)+1]+n)}return n?o>0:o<0},g=({coords:e,lengths:t},r)=>{const n=[];for(let i=0,c=0;i<t.length;c+=t[i],i+=1){const s=c,a=[];for(;i<t.length-1&&m(e,c+t[i],t[i+1],r);i+=1,c+=t[i])a.push(c+t[i]-s);const f=e.slice(2*s,2*(c+t[i])),h=o.earcut(f,a,2);for(const e of h)n.push(e+s)}return n};return function(){function o(e,t,r,n=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=r,this.isMapSpace=n}o.fromRect=function({x:e,y:t,width:r,height:n}){const i=e,c=t,s=i+r,a=c+n;return o.fromScreenExtent({xmin:i,ymin:c,xmax:s,ymax:a})},o.fromPath=function(e){const t=s.convertFromNestedArray(new a,e.path,!1,!1),r=t.coords,n=new Uint32Array(g(t,!0)),i=new Uint32Array(r.length/2);for(let o=0;o<i.length;o++)i[o]=f.i1616to32(Math.floor(r[2*o]),Math.floor(r[2*o+1]));return new o({geometry:i},n,u.PrimitiveType.TRIANGLES)},o.fromGeometry=function(e,n){const i=n.geometry?.type;switch(i){case"polygon":return o.fromPolygon(e,n.geometry);case"extent":return o.fromMapExtent(e,n.geometry);default:return r.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new t("mapview-bad-type",`Unable to create a mesh from type ${i}`,n)),o.fromRect({x:0,y:0,width:1,height:1})}},o.fromPolygon=function(e,t){const r=s.convertFromPolygon(new a,t,!1,!1),n=r.coords,h=new Uint32Array(g(r,!1)),y=new Uint32Array(n.length/2),m=c.create(),l=c.create();for(let o=0;o<y.length;o++)i.set(m,n[2*o],n[2*o+1]),e.toScreen(l,m),y[o]=f.i1616to32(Math.floor(l[0]),Math.floor(l[1]));return new o({geometry:y},h,u.PrimitiveType.TRIANGLES,!0)},o.fromScreenExtent=function({xmin:e,xmax:t,ymin:r,ymax:n}){return new o({geometry:new Uint32Array([f.i1616to32(e,r),f.i1616to32(t,r),f.i1616to32(e,n),f.i1616to32(e,n),f.i1616to32(t,r),f.i1616to32(t,n)])},new Uint32Array([0,1,2,3,4,5]),u.PrimitiveType.TRIANGLES)},o.fromMapExtent=function(e,t){const[r,n]=e.toScreen([0,0],[t.xmin,t.ymin]),[i,c]=e.toScreen([0,0],[t.xmax,t.ymax]);return new o({geometry:new Uint32Array([f.i1616to32(r,n),f.i1616to32(i,n),f.i1616to32(r,c),f.i1616to32(r,c),f.i1616to32(i,n),f.i1616to32(i,c)])},new Uint32Array([0,1,2,3,4,5]),u.PrimitiveType.TRIANGLES)};var m=o.prototype;return m.destroy=function(){n.isSome(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)n.isSome(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()},m.getIndexBuffer=function(e,t=u.Usage.STATIC_DRAW){return this._cache.indexBuffer||(this._cache.indexBuffer=h.BufferObject.createIndex(e,t,this.indices)),this._cache.indexBuffer},m.getVertexBuffers=function(e,t=u.Usage.STATIC_DRAW){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(((r,n)=>({...r,[n]:h.BufferObject.createVertex(e,t,this.vertices[n])})),{})),this._cache.vertexBuffers},e._createClass(o,[{key:"elementType",get:function(){return y(this.indices)}}]),o}()}));
