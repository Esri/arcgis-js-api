/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import e from"../../VertexStream.js";import{BlendFactor as t,TargetType as s,DepthStencilTargetType as i}from"../../../../../webgl/enums.js";import{FramebufferObject as r}from"../../../../../webgl/FramebufferObject.js";class o{constructor(){this._fbo=null,this._size=[0,0],this._programDesc={"edge-enhance":{vsPath:"post-processing/pp",fsPath:"post-processing/edge-enhance",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._fbo&&(this._fbo.dispose(),this._fbo=null),this._quad&&(this._quad.dispose(),this._quad=null)}draw(s,i,r){this._createOrResizeResources(s);const{context:o,state:a,painter:n,pixelRatio:h}=s,{materialManager:u}=n,_=this._programDesc,c=a.size,d=[Math.round(h*c[0]),Math.round(h*c[1])],l=o.gl;this._quad||(this._quad=new e(o,[-1,-1,1,-1,-1,1,1,1]));const p=this._fbo,b=this._quad;b.bind();const f=u.getProgram(_["edge-enhance"]);o.useProgram(f),o.bindFramebuffer(p),o.setClearColor(0,0,0,0),o.clear(l.COLOR_BUFFER_BIT),o.bindTexture(i.colorTexture,4),f.setUniform1i("u_colorTexture",4),f.setUniform2fv("u_texSize",d),b.draw(),o.bindFramebuffer(i),o.setStencilWriteMask(0),o.setStencilTestEnabled(!1),o.setDepthWriteEnabled(!1),o.setDepthTestEnabled(!1),o.setBlendingEnabled(!0);const g=u.getProgram(_.blit);o.useProgram(g),o.bindTexture(p.colorTexture,6),g.setUniform1i("u_texture",6),o.setBlendFunction(t.ONE,t.ONE_MINUS_SRC_ALPHA),b.draw(),b.unbind()}_createOrResizeResources(e){const{context:t,state:o,pixelRatio:a}=e,{size:n}=o,h=Math.round(a*n[0]),u=Math.round(a*n[1]);this._fbo&&this._size[0]===h&&this._size[1]===u||(this._size[0]=h,this._size[1]=u,this._fbo?this._fbo.resize(h,u):this._fbo=new r(t,{colorTarget:s.TEXTURE,depthStencilTarget:i.NONE,width:h,height:u}))}}export{o as EdgeEnhance};
