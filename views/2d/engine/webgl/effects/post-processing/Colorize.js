/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../../core/maybe","../../VertexStream","../../../../../webgl/enums","../../../../../webgl/Texture"],(function(e,t,r,i,s){"use strict";let n=function(){function e(){this._layerFBOTexture=null,this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}var n=e.prototype;return n.dispose=function(){this._layerFBOTexture=t.disposeMaybe(this._layerFBOTexture)},n.draw=function(e,t,r){const{width:s,height:n}=t;this._createOrResizeResources(e,s,n);const{context:o,painter:a}=e,{materialManager:l}=a,u=this._programDesc,c=this._quad,d=r.colorMatrix;c.bind();const _=this._layerFBOTexture;o.bindFramebuffer(t),t.copyToTexture(0,0,s,n,0,0,_),o.setBlendingEnabled(!1),o.setStencilTestEnabled(!1);const p=l.getProgram(u);o.useProgram(p),o.bindTexture(_,2),p.setUniformMatrix4fv("u_coefficients",d),p.setUniform1i("u_colorTexture",2),c.draw(),o.setBlendingEnabled(!0),o.setBlendFunction(i.BlendFactor.ONE,i.BlendFactor.ONE_MINUS_SRC_ALPHA),o.setStencilTestEnabled(!0),c.unbind()},n._createOrResizeResources=function(e,t,n){const{context:o}=e;this._layerFBOTexture&&this._size[0]===t&&this._size[1]===n||(this._size[0]=t,this._size[1]=n,this._layerFBOTexture?this._layerFBOTexture.resize(t,n):this._layerFBOTexture=new s.Texture(o,{target:i.TextureType.TEXTURE_2D,pixelFormat:i.PixelFormat.RGBA,internalFormat:i.PixelFormat.RGBA,dataType:i.PixelType.UNSIGNED_BYTE,wrapMode:i.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:i.TextureSamplingMode.LINEAR,flipped:!1,width:t,height:n}),this._quad||(this._quad=new r(o,[-1,-1,1,-1,-1,1,1,1])))},e}();e.Colorize=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
