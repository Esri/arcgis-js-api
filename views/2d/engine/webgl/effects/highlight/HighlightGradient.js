/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../../../../core/Logger","../../../../../webgl/BufferObject","../../../../../webgl/FramebufferObject","../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/has","../../../../../webgl/enums","../../../../../webgl/RenderingContext","../../../../../../chunks/builtins","../../../../../webgl/Texture","../../../../../webgl/VertexArrayObject","../../definitions","./parameters"],(function(o,i,t,e,l,n,r,h,a,s,u,d){"use strict";const g=o.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function f(o,i){i.fillColor[0]=o.color.r/255,i.fillColor[1]=o.color.g/255,i.fillColor[2]=o.color.b/255,i.fillColor[3]=o.color.a,o.haloColor?(i.outlineColor[0]=o.haloColor.r/255,i.outlineColor[1]=o.haloColor.g/255,i.outlineColor[2]=o.haloColor.b/255,i.outlineColor[3]=o.haloColor.a):(i.outlineColor[0]=i.fillColor[0],i.outlineColor[1]=i.fillColor[1],i.outlineColor[2]=i.fillColor[2],i.outlineColor[3]=i.fillColor[3]),i.fillColor[3]*=o.fillOpacity,i.outlineColor[3]*=o.haloOpacity,i.fillColor[0]*=i.fillColor[3],i.fillColor[1]*=i.fillColor[3],i.fillColor[2]*=i.fillColor[3],i.outlineColor[0]*=i.outlineColor[3],i.outlineColor[1]*=i.outlineColor[3],i.outlineColor[2]*=i.outlineColor[3],i.outlineWidth=d.HIGHLIGHT_SIZING.outlineWidth,i.outerHaloWidth=d.HIGHLIGHT_SIZING.outerHaloWidth,i.innerHaloWidth=d.HIGHLIGHT_SIZING.innerHaloWidth,i.outlinePosition=d.HIGHLIGHT_SIZING.outlinePosition}const H=[0,0,0,0];return function(){function o(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:d.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:d.HIGHLIGHT_SIZING.outlineWidth,innerHaloWidth:d.HIGHLIGHT_SIZING.innerHaloWidth,outerHaloWidth:d.HIGHLIGHT_SIZING.outerHaloWidth},this.shadeTexChanged=!0,this.texelData=new Uint8Array(4*d.SHADE_TEXTURE_SIZE),this.minMaxDistance=[0,0]}var i=o.prototype;return i.setHighlightOptions=function(o){const i=this._convertedHighlightOptions;f(o,i);const t=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,e=i.outlinePosition-i.outlineWidth/2,l=i.outlinePosition+i.outlineWidth/2,n=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,r=Math.sqrt(Math.PI/2)*d.SIGMA,h=Math.abs(t)>r?Math.round(10*(Math.abs(t)-r))/10:0,a=Math.abs(n)>r?Math.round(10*(Math.abs(n)-r))/10:0;let s;h&&!a?g.error("The outer rim of the highlight is "+h+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!h&&a?g.error("The inner rim of the highlight is "+a+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):h&&a&&g.error("The highlight is "+Math.max(h,a)+"px away from the edge of the feature; consider reducing some width values.");const u=[void 0,void 0,void 0,void 0];function C(o,i,t){u[0]=(1-t)*o[0]+t*i[0],u[1]=(1-t)*o[1]+t*i[1],u[2]=(1-t)*o[2]+t*i[2],u[3]=(1-t)*o[3]+t*i[3]}const{texelData:I}=this;for(let g=0;g<d.SHADE_TEXTURE_SIZE;++g)s=t+g/(d.SHADE_TEXTURE_SIZE-1)*(n-t),s<t?(u[4*g+0]=0,u[4*g+1]=0,u[4*g+2]=0,u[4*g+3]=0):s<e?C(H,i.outlineColor,(s-t)/(e-t)):s<l?[u[0],u[1],u[2],u[3]]=i.outlineColor:s<n?C(i.outlineColor,i.fillColor,(s-l)/(n-l)):[u[4*g+0],u[4*g+1],u[4*g+2],u[4*g+3]]=i.fillColor,I[4*g+0]=255*u[0],I[4*g+1]=255*u[1],I[4*g+2]=255*u[2],I[4*g+3]=255*u[3];this.minMaxDistance[0]=t,this.minMaxDistance[1]=n,this.shadeTexChanged=!0},i.applyHighlightOptions=function(o,i){this.shadeTex||(this.shadeTex=new a(o,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:d.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,d.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1),o.bindTexture(this.shadeTex,u.TEXTURE_BINDING_HIGHLIGHT_1),i.setUniform2fv("u_minMaxDistance",this.minMaxDistance)},i.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)},o}()}));
