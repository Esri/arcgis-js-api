/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../../../core/has","../../../../../../core/Logger","../../definitions","../../../../../../chunks/builtins","../../../../../webgl/Texture","../../../../../webgl/FramebufferObject","../../../../../webgl/RenderingContext","./parameters"],(function(o,i,t,e,l,n,r,h){"use strict";const a=i.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");const s=[0,0,0,0];return function(){function o(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:h.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:h.HIGHLIGHT_SIZING.outlineWidth,innerHaloWidth:h.HIGHLIGHT_SIZING.innerHaloWidth,outerHaloWidth:h.HIGHLIGHT_SIZING.outerHaloWidth},this.shadeTexChanged=!0,this.texelData=new Uint8Array(4*h.SHADE_TEXTURE_SIZE),this.minMaxDistance=[0,0]}var i=o.prototype;return i.setHighlightOptions=function(o){const i=this._convertedHighlightOptions;var t,e;t=o,(e=i).fillColor[0]=t.color.r/255,e.fillColor[1]=t.color.g/255,e.fillColor[2]=t.color.b/255,e.fillColor[3]=t.color.a,t.haloColor?(e.outlineColor[0]=t.haloColor.r/255,e.outlineColor[1]=t.haloColor.g/255,e.outlineColor[2]=t.haloColor.b/255,e.outlineColor[3]=t.haloColor.a):(e.outlineColor[0]=e.fillColor[0],e.outlineColor[1]=e.fillColor[1],e.outlineColor[2]=e.fillColor[2],e.outlineColor[3]=e.fillColor[3]),e.fillColor[3]*=t.fillOpacity,e.outlineColor[3]*=t.haloOpacity,e.fillColor[0]*=e.fillColor[3],e.fillColor[1]*=e.fillColor[3],e.fillColor[2]*=e.fillColor[3],e.outlineColor[0]*=e.outlineColor[3],e.outlineColor[1]*=e.outlineColor[3],e.outlineColor[2]*=e.outlineColor[3],e.outlineWidth=h.HIGHLIGHT_SIZING.outlineWidth,e.outerHaloWidth=h.HIGHLIGHT_SIZING.outerHaloWidth,e.innerHaloWidth=h.HIGHLIGHT_SIZING.innerHaloWidth,e.outlinePosition=h.HIGHLIGHT_SIZING.outlinePosition;const l=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,n=i.outlinePosition-i.outlineWidth/2,r=i.outlinePosition+i.outlineWidth/2,u=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,d=Math.sqrt(Math.PI/2)*h.SIGMAS[3],g=Math.abs(l)>d?Math.round(10*(Math.abs(l)-d))/10:0,C=Math.abs(u)>d?Math.round(10*(Math.abs(u)-d))/10:0;let H;g&&!C?a.error("The outer rim of the highlight is "+g+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!g&&C?a.error("The inner rim of the highlight is "+C+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):g&&C&&a.error("The highlight is "+Math.max(g,C)+"px away from the edge of the feature; consider reducing some width values.");const f=[void 0,void 0,void 0,void 0];function I(o,i,t){f[0]=(1-t)*o[0]+t*i[0],f[1]=(1-t)*o[1]+t*i[1],f[2]=(1-t)*o[2]+t*i[2],f[3]=(1-t)*o[3]+t*i[3]}const{texelData:T}=this;for(let o=0;o<h.SHADE_TEXTURE_SIZE;++o)H=l+o/(h.SHADE_TEXTURE_SIZE-1)*(u-l),H<l?(f[4*o+0]=0,f[4*o+1]=0,f[4*o+2]=0,f[4*o+3]=0):H<n?I(s,i.outlineColor,(H-l)/(n-l)):H<r?[f[0],f[1],f[2],f[3]]=i.outlineColor:H<u?I(i.outlineColor,i.fillColor,(H-r)/(u-r)):[f[4*o+0],f[4*o+1],f[4*o+2],f[4*o+3]]=i.fillColor,T[4*o+0]=255*f[0],T[4*o+1]=255*f[1],T[4*o+2]=255*f[2],T[4*o+3]=255*f[3];this.minMaxDistance[0]=l,this.minMaxDistance[1]=u,this.shadeTexChanged=!0},i.applyHighlightOptions=function(o,i){this.shadeTex||(this.shadeTex=new l(o,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:h.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,h.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1),o.bindTexture(this.shadeTex,t.TEXTURE_BINDING_HIGHLIGHT_1),i.setUniform2fv("u_minMaxDistance",this.minMaxDistance)},i.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)},o}()}));
