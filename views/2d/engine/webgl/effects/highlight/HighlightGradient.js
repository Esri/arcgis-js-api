/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../../../../core/has","../../../../../../core/Logger","../../definitions","../../../../../../chunks/builtins","../../../../../webgl/checkWebGLError","../../../../../webgl/Texture","../../../../../webgl/FramebufferObject","./parameters"],(function(o,i,t,e,l,n,r,h){"use strict";const a=i.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function s(o,i){i.fillColor[0]=o.color.r/255,i.fillColor[1]=o.color.g/255,i.fillColor[2]=o.color.b/255,i.fillColor[3]=o.color.a,o.haloColor?(i.outlineColor[0]=o.haloColor.r/255,i.outlineColor[1]=o.haloColor.g/255,i.outlineColor[2]=o.haloColor.b/255,i.outlineColor[3]=o.haloColor.a):(i.outlineColor[0]=i.fillColor[0],i.outlineColor[1]=i.fillColor[1],i.outlineColor[2]=i.fillColor[2],i.outlineColor[3]=i.fillColor[3]),i.fillColor[3]*=o.fillOpacity,i.outlineColor[3]*=o.haloOpacity,i.fillColor[0]*=i.fillColor[3],i.fillColor[1]*=i.fillColor[3],i.fillColor[2]*=i.fillColor[3],i.outlineColor[0]*=i.outlineColor[3],i.outlineColor[1]*=i.outlineColor[3],i.outlineColor[2]*=i.outlineColor[3],i.outlineWidth=h.HIGHLIGHT_SIZING.outlineWidth,i.outerHaloWidth=h.HIGHLIGHT_SIZING.outerHaloWidth,i.innerHaloWidth=h.HIGHLIGHT_SIZING.innerHaloWidth,i.outlinePosition=h.HIGHLIGHT_SIZING.outlinePosition}const u=[0,0,0,0];return function(){function o(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:h.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:h.HIGHLIGHT_SIZING.outlineWidth,innerHaloWidth:h.HIGHLIGHT_SIZING.innerHaloWidth,outerHaloWidth:h.HIGHLIGHT_SIZING.outerHaloWidth},this.shadeTexChanged=!0,this.texelData=new Uint8Array(4*h.SHADE_TEXTURE_SIZE),this.minMaxDistance=[0,0]}var i=o.prototype;return i.setHighlightOptions=function(o){const i=this._convertedHighlightOptions;s(o,i);const t=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,e=i.outlinePosition-i.outlineWidth/2,l=i.outlinePosition+i.outlineWidth/2,n=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,r=Math.sqrt(Math.PI/2)*h.SIGMAS[3],d=Math.abs(t)>r?Math.round(10*(Math.abs(t)-r))/10:0,f=Math.abs(n)>r?Math.round(10*(Math.abs(n)-r))/10:0;let H;d&&!f?a.error("The outer rim of the highlight is "+d+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!d&&f?a.error("The inner rim of the highlight is "+f+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):d&&f&&a.error("The highlight is "+Math.max(d,f)+"px away from the edge of the feature; consider reducing some width values.");const g=[void 0,void 0,void 0,void 0];function C(o,i,t){g[0]=(1-t)*o[0]+t*i[0],g[1]=(1-t)*o[1]+t*i[1],g[2]=(1-t)*o[2]+t*i[2],g[3]=(1-t)*o[3]+t*i[3]}const{texelData:I}=this;for(let a=0;a<h.SHADE_TEXTURE_SIZE;++a)H=t+a/(h.SHADE_TEXTURE_SIZE-1)*(n-t),H<t?(g[4*a+0]=0,g[4*a+1]=0,g[4*a+2]=0,g[4*a+3]=0):H<e?C(u,i.outlineColor,(H-t)/(e-t)):H<l?[g[0],g[1],g[2],g[3]]=i.outlineColor:H<n?C(i.outlineColor,i.fillColor,(H-l)/(n-l)):[g[4*a+0],g[4*a+1],g[4*a+2],g[4*a+3]]=i.fillColor,I[4*a+0]=255*g[0],I[4*a+1]=255*g[1],I[4*a+2]=255*g[2],I[4*a+3]=255*g[3];this.minMaxDistance[0]=t,this.minMaxDistance[1]=n,this.shadeTexChanged=!0},i.applyHighlightOptions=function(o,i){this.shadeTex||(this.shadeTex=new n(o,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:h.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,h.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1),o.bindTexture(this.shadeTex,t.TEXTURE_BINDING_HIGHLIGHT_1),i.setUniform2fv("u_minMaxDistance",this.minMaxDistance)},i.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)},o}()}));
