/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{TEXTURE_BINDING_HIGHLIGHT_0 as r,TEXTURE_BINDING_HIGHLIGHT_1 as e}from"../../definitions.js";import{ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX as s,RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX as i,SIGMA as t}from"./parameters.js";import{highlight as o,blur as u}from"../../shaders/HighlightPrograms.js";import{BufferObject as h}from"../../../../../webgl/BufferObject.js";import{PrimitiveType as a,BlendFactor as m,Usage as n,DataType as _}from"../../../../../webgl/enums.js";import{createProgram as g}from"../../../../../webgl/ProgramTemplate.js";import{VertexArrayObject as d}from"../../../../../webgl/VertexArrayObject.js";import{VertexElementDescriptor as l}from"../../../../../webgl/VertexElementDescriptor.js";class c{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(e,i){e.bindTexture(i,r),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",s),e.bindVAO(this._resources.quadVAO),e.drawArrays(a.TRIANGLE_STRIP,0,4),e.bindVAO()}finalBlur(e,s){e.bindTexture(s,r),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",i),e.bindVAO(this._resources.quadVAO),e.drawArrays(a.TRIANGLE_STRIP,0,4),e.bindVAO()}renderHighlight(e,s,i){e.bindTexture(s,r),e.useProgram(this._resources.highlightProgram),i.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(m.ONE,m.ONE_MINUS_SRC_ALPHA),e.drawArrays(a.TRIANGLE_STRIP,0,4),e.bindVAO()}_initialize(s,i,a){this._width=i,this._height=a;const m=h.createVertex(s,n.STATIC_DRAW,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),c=new d(s,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[new l("a_position",2,_.BYTE,0,4),new l("a_texcoord",2,_.UNSIGNED_BYTE,2,4)]},{geometry:m}),f=g(s,o),b=g(s,u);s.useProgram(f),f.setUniform1i("u_texture",r),f.setUniform1i("u_shade",e),f.setUniform1f("u_sigma",t),s.useProgram(b),b.setUniform1i("u_texture",r),b.setUniform1f("u_sigma",t),this._resources={quadGeometry:m,quadVAO:c,highlightProgram:f,blurProgram:b}}setup(r,e,s){this._resources?(this._width=e,this._height=s):this._initialize(r,e,s)}}export{c as default};
