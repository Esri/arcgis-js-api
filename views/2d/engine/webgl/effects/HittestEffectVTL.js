/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../definitions","./Effect","../../../../webgl/enums"],(function(e,t,n,o,r,i){"use strict";let s=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).name=t.constructor.name,t.defines=["id"],t._lastSize=0,t}t._inheritsLoose(r,e);var s=r.prototype;return s.dispose=function(){n.isSome(this._fbo)&&this._fbo.dispose()},s.bind=function({context:e,painter:t}){const{width:n,height:o}=e.getViewport();this._boundFBO=e.getBoundFramebufferObject();const r=t.getFbos(n,o).effect0;e.bindFramebuffer(r),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)},s.unbind=function({context:e}){e.bindFramebuffer(this._boundFBO),this._boundFBO=null},s.draw=function(e,t,n=2*o.HITTEST_RADIUS){this._resolve(e,t,n)},s._resolve=function(){var e=t._asyncToGenerator((function*({context:e,state:n,pixelRatio:o},r,s){var f=this;const u=e.getBoundFramebufferObject(),a=n.size[1]*o,c=Math.round(s*o),l=c/2,h=c/2;this._ensureBuffer(c),r.forEach(function(){var e=t._asyncToGenerator((function*(e,t){const n=new Map,s=Math.floor(t.x*o-c/2),b=Math.floor(a-t.y*o-c/2);yield u.readPixelsAsync(s,b,c,c,i.PixelFormat.RGBA,i.PixelType.UNSIGNED_BYTE,f._buf);for(let o=0;o<f._buf32.length;o++){const e=f._buf32[o];if(4294967295!==e&&0!==e){const t=o%c,r=c-Math.floor(o/c),i=(l-t)*(l-t)+(h-r)*(h-r),s=n.has(e)?n.get(e):4294967295;n.set(e,Math.min(i,s))}}const _=Array.from(n).sort(((e,t)=>e[1]-t[1])).map((e=>e[0]));e.resolve(_),r.delete(t)}));return function(t,n){return e.apply(this,arguments)}}())}));function n(t,n,o){return e.apply(this,arguments)}return n}(),s._ensureBuffer=function(e){this._lastSize!==e&&(this._lastSize=e,this._buf=new Uint8Array(4*e*e),this._buf32=new Uint32Array(this._buf.buffer))},r}(r.Effect);e.HittestEffectVTL=s,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
