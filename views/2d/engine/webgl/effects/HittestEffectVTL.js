/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../definitions","./Effect","../../../../webgl/enums"],(function(t,e,n,o,r,i){"use strict";let s=function(t){function r(){var e;return(e=t.apply(this,arguments)||this).name=e.constructor.name,e.defines=["id"],e._lastSize=0,e._boundFBO=null,e}e._inheritsLoose(r,t);var s=r.prototype;return s.dispose=function(){n.isSome(this._fbo)&&this._fbo.dispose()},s.bind=function({context:t,painter:e}){const{width:n,height:o}=t.getViewport();this._boundFBO=t.getBoundFramebufferObject();const r=e.getFbos(n,o).effect0;t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)},s.unbind=function({context:t}){t.bindFramebuffer(this._boundFBO),this._boundFBO=null},s.draw=function(t,e,n=2*o.HITTEST_RADIUS){this._resolve(t,e,n)},s._resolve=function(){var t=e._asyncToGenerator((function*({context:t,state:n,pixelRatio:o},r,s){var f=this;const u=t.getBoundFramebufferObject(),a=n.size[1]*o,c=Math.round(s*o),l=c/2,h=c/2;this._ensureBuffer(c),r.forEach(function(){var t=e._asyncToGenerator((function*(t,e){const n=new Map,s=Math.floor(e.x*o-c/2),b=Math.floor(a-e.y*o-c/2);yield u.readPixelsAsync(s,b,c,c,i.PixelFormat.RGBA,i.PixelType.UNSIGNED_BYTE,f._buf);for(let o=0;o<f._buf32.length;o++){const t=f._buf32[o];if(4294967295!==t&&0!==t){const e=o%c,r=c-Math.floor(o/c),i=(l-e)*(l-e)+(h-r)*(h-r),s=n.has(t)?n.get(t):4294967295;n.set(t,Math.min(i,s))}}const _=Array.from(n).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]));t.resolve(_),r.delete(e)}));return function(e,n){return t.apply(this,arguments)}}())}));function n(e,n,o){return t.apply(this,arguments)}return n}(),s._ensureBuffer=function(t){this._lastSize!==t&&(this._lastSize=t,this._buf=new Uint8Array(4*t*t),this._buf32=new Uint32Array(this._buf.buffer))},r}(r.Effect);t.HittestEffectVTL=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
