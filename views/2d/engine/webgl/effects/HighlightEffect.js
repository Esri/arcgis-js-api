/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/has","../BitBlitRenderer","./Effect","./highlight/HighlightRenderer","./highlight/HighlightSurfaces","../../../../webgl/enums"],(function(e,t,r,i,s,h,n){"use strict";const l=4,d=4/l;let u=function(t){function i(){var e;return(e=t.apply(this,arguments)||this).defines=["highlight"],e._hlRenderer=new s,e._width=void 0,e._height=void 0,e._boundFBO=null,e._hlSurfaces=new h,e._adjustedWidth=void 0,e._adjustedHeight=void 0,e._blitRenderer=new r.BitBlitRenderer,e}e._inheritsLoose(i,t);var u=i.prototype;return u.dispose=function(){this._hlSurfaces?.dispose(),this._hlRenderer?.dispose(),this._boundFBO=null},u.bind=function(e){const{context:t,painter:r}=e,{width:i,height:s}=t.getViewport(),h=r.getFbos(i,s).effect0;this.setup(e,i,s),t.bindFramebuffer(h),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)},u.unbind=function(){},u.setup=function({context:e},t,r){this._width=t,this._height=r;const i=t%l,s=r%l;t+=i<l/2?-i:l-i,r+=s<l/2?-s:l-s,this._adjustedWidth=t,this._adjustedHeight=r,this._boundFBO=e.getBoundFramebufferObject();const h=Math.round(t*d),n=Math.round(r*d);this._hlRenderer.setup(e,h,n),this._hlSurfaces.setup(e,h,n)},u.draw=function(e){const{context:t,highlightGradient:r}=e;if(!r)return;const i=t.getBoundFramebufferObject();t.setViewport(0,0,this._adjustedWidth*d,this._adjustedHeight*d),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setStencilTestEnabled(!1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(t,i.colorTexture,n.TextureSamplingMode.NEAREST,1),t.setStencilTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!0),t.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(t,this._hlSurfaces.sharedBlur1Tex),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(t,this._hlSurfaces.sharedBlur2Tex),t.bindFramebuffer(this._boundFBO),t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(t,this._hlSurfaces.sharedBlur1Tex,r),this._boundFBO=null},i}(i.Effect);return u}));
