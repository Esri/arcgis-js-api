/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../enums","../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../techniques/utils","../../../../webgl/enums"],(function(e,t,a,o,r,n,i,s){"use strict";const y={shader:"materials/icon",vertexLayout:{geometry:[{location:0,name:"a_pos",count:2,type:s.DataType.SHORT},{location:1,name:"a_vertexOffset",count:2,type:s.DataType.SHORT},{location:2,name:"a_texCoords",count:2,type:s.DataType.UNSIGNED_SHORT},{location:3,name:"a_bitSetAndDistRatio",count:2,type:s.DataType.UNSIGNED_SHORT},{location:4,name:"a_id",count:4,type:s.DataType.UNSIGNED_BYTE},{location:5,name:"a_color",count:4,type:s.DataType.UNSIGNED_BYTE,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:s.DataType.UNSIGNED_BYTE,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:s.DataType.UNSIGNED_BYTE},{location:8,name:"a_zoomRange",count:2,type:s.DataType.UNSIGNED_SHORT}]},hittestAttributes:["a_vertexOffset","a_texCoords"]};let l=function(r){function l(){return r.apply(this,arguments)||this}e._inheritsLoose(l,r);var u=l.prototype;return u.dispose=function(){},u.getGeometryType=function(){return a.WGLGeometryType.MARKER},u.supportsSymbology=function(e){return e!==a.WGLSymbologyType.HEATMAP&&e!==a.WGLSymbologyType.PIE_CHART},u.drawGeometry=function(e,a,r,l){const{context:u,painter:p,rendererInfo:c,state:m,passOptions:d,requestRender:T,allowDelayedRender:_}=e,S=n.MarkerMaterialKey.load(r.materialKey),f=i.getTechniqueFromMaterialKey(S.data),D=t.isSome(d)&&"hittest"===d.type,{shader:E,vertexLayout:g,hittestAttributes:h}=t.unwrapOr(f.programSpec,y);let N=s.PrimitiveType.TRIANGLES,G=o.createProgramDescriptor(S.data,g);D&&(G=this._getTriangleDesc(r.materialKey,G,h),N=s.PrimitiveType.POINTS);const{attributes:M,bufferLayouts:R}=G,O=p.materialManager.getMaterialProgram(e,S,E,M,l);if(_&&t.isSome(T)&&!O.compiled)return void T();u.useProgram(O),S.textureBinding&&p.textureManager.bindTextures(u,O,S,!0),this._setSharedUniforms(O,e,a);const U=S.vvRotation?m.displayViewMat3:m.displayMat3;O.setUniformMatrix3fv("u_displayMat3",U),this._setSizeVVUniforms(S,O,c,a),this._setColorAndOpacityVVUniforms(S,O,c),this._setRotationVVUniforms(S,O,c);const b=r.target.getVAO(u,R,M,D);let x=r.indexCount,A=r.indexFrom*Uint32Array.BYTES_PER_ELEMENT;D&&(x/=3,A/=3),u.bindVAO(b),this._drawMarkers(e,a,O,N,x,A,D),u.bindVAO(null)},u._drawMarkers=function(e,t,a,o,r,n,i){e.context.drawElements(o,r,s.DataType.UNSIGNED_INT,n)},l}(r);return l}));
