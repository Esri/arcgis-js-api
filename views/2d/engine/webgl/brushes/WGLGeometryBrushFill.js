/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../enums","../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../techniques/utils","../../../../webgl/enums"],(function(e,t,a,o,r,i,n,s){"use strict";function l(e){const t={geometry:[{location:0,name:"a_pos",count:2,type:s.DataType.SHORT},{location:1,name:"a_id",count:3,type:s.DataType.UNSIGNED_BYTE},{location:2,name:"a_bitset",count:1,type:s.DataType.UNSIGNED_BYTE},{location:3,name:"a_color",count:4,type:s.DataType.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_aux1",count:4,type:s.DataType.UNSIGNED_SHORT},{location:5,name:"a_aux2",count:4,type:s.DataType.SHORT},{location:6,name:"a_aux3",count:4,type:s.DataType.UNSIGNED_BYTE},{location:7,name:"a_zoomRange",count:2,type:s.DataType.UNSIGNED_SHORT}]};switch(e.symbologyType){case a.WGLSymbologyType.SIMPLE:case a.WGLSymbologyType.OUTLINE_FILL_SIMPLE:t.geometry.splice(7,1),t.geometry.splice(4,1)}return{shader:"materials/fill",vertexLayout:t}}let y=function(r){function y(){return r.apply(this,arguments)||this}e._inheritsLoose(y,r);var u=y.prototype;return u.dispose=function(){},u.getGeometryType=function(){return a.WGLGeometryType.FILL},u.supportsSymbology=function(e){return e!==a.WGLSymbologyType.DOT_DENSITY},u.drawGeometry=function(e,a,r,y){const{context:u,painter:c,rendererInfo:m,requiredLevel:p,passOptions:T,requestRender:_,allowDelayedRender:f}=e,d=i.FillMaterialKey.load(r.materialKey),g=n.getTechniqueFromMaterialKey(d.data),S=t.isSome(T)&&"hittest"===T.type,E=c.materialManager,{shader:D,vertexLayout:N,hittestAttributes:L}=t.unwrapOr(g.programSpec,l(d));let h=s.PrimitiveType.TRIANGLES,G=o.createProgramDescriptor(d.data,N);S&&(G=this._getTriangleDesc(r.materialKey,G,L),h=s.PrimitiveType.POINTS);const{attributes:I,bufferLayouts:U}=G,b=E.getMaterialProgram(e,d,D,I,y);if(f&&t.isSome(_)&&!b.compiled)return void _();if(u.useProgram(b),this._setSharedUniforms(b,e,a),b.setUniform2f("u_tileOffset",512*a.key.col,512*a.key.row),d.textureBinding){c.textureManager.bindTextures(u,b,d);const e=1/2**(p-a.key.level);b.setUniform1f("u_zoomFactor",e)}const x=1/e.pixelRatio;b.setUniform1f("u_blur",x),b.setUniform1f("u_antialiasing",x),this._setSizeVVUniforms(d,b,m,a),this._setColorAndOpacityVVUniforms(d,b,m);const O=r.target.getVAO(u,U,I,S);let P=r.indexCount,R=r.indexFrom*Uint32Array.BYTES_PER_ELEMENT;S&&(P/=3,R/=3),u.bindVAO(O),this._drawFills(e,a,b,h,P,R)},u._drawFills=function(e,t,a,o,r,i){e.context.drawElements(o,r,s.DataType.UNSIGNED_INT,i)},y}(r);return y}));
