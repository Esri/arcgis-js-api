/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../definitions","../../../../../chunks/vec2f32","../../../../../chunks/vec4f32","../number","../enums","./WGLBrush"],(function(t,e,i,a,n,r,s,o,l){"use strict";const u=Math.PI/180,c=[1,1,1,1];let _=function(t){function l(){var e;return(e=t.apply(this,arguments)||this)._color=r.create(),e._dashArray=n.create(),e._programOptions={id:!1,dd:!1,pattern:!1},e}e._inheritsLoose(l,t);var u=l.prototype;return u.dispose=function(){},u.drawMany=function(t,e){const{context:n,displayLevel:r,state:l,drawPhase:u,styleLayerUID:_}=t,f=t.styleLayer,d=t.painter.getVectorTileProgramCache(),h=f.getPaintValue("line-translate",r),p=f.getPaintValue("line-translate-anchor",r),y=f.getPaintValue("line-pattern",r),m=void 0!==y,g=1/t.pixelRatio,U=f.getPaintValue("line-blur",r),v=f.hasDataDrivenColor?c:f.getPaintValue("line-color",r),P=f.hasDataDrivenOpacity?1:f.getPaintValue("line-opacity",r),T=f.hasDataDrivenWidth?1:f.getPaintValue("line-width",r),V=P*v[3];this._color[0]=V*v[0],this._color[1]=V*v[1],this._color[2]=V*v[2],this._color[3]=V;const D=f.hasDataDrivenLine,I=u===o.WGLDrawPhase.HITTEST;let M;I&&(M=s.u32to4Xu8(_+1));const E=(I?1:0)<<2|(D?1:0)<<1|(m?1:0),b=this._programOptions;b.id=I,b.dd=D,b.pattern=m;const L=d.getProgram(3,E,b);if(n.bindProgram(L),L.setUniformMatrix3fv("u_displayViewMat3",l.displayViewMat3),L.setUniformMatrix3fv("u_displayMat3",1===p?l.displayMat3:l.displayViewMat3),L.setUniform2fv("u_lineTranslation",h),L.setUniform1f("u_depth",f.z),L.setUniform1f("u_blur",U),L.setUniform1f("u_antialiasing",g),L.setUniform4fv("u_color",this._color),L.setUniform1f("u_width",T),I&&L.setUniform4fv("u_id",M),m){const e=t.spriteMosaic,i=e.getMosaicItemPosition(y,!0);i&&(e.bind(n,9729,i.page,a.VTL_TEXTURE_BINDING_UNIT_SPRITES),L.setUniform2f("u_pattern_tl",i.tl[0],i.br[1]),L.setUniform2f("u_pattern_br",i.br[0],i.tl[1]),L.setUniform2f("u_spriteSize",8*i.size[0],i.size[1]),L.setUniform1i("u_texture",a.VTL_TEXTURE_BINDING_UNIT_SPRITES))}else{let t=f.getPaintValue("line-dasharray",r);t.length<2&&(t=[1,-1]);const e=8;this._dashArray[0]=e*t[0],this._dashArray[1]=e*t[1],L.setUniform2fv("u_dasharray",this._dashArray)}for(const t of e){if(!t.layerData.has(_))continue;const e=t.layerData.get(_);e.prepareForRendering(n,d);const a=e.lineVertexArrayObject;i.isNone(a)||(n.bindVAO(a),L.setUniformMatrix3fv("u_dvsMat3",t.transforms.dvs),n.setStencilFunction(514,t.stencilRef,255),n.drawElements(4,e.lineIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*e.lineIndexStart),t.triangleCount+=e.lineIndexCount/3)}},l}(l);t.C_DEG_TO_RAD=u,t.WGLBrushVTLLine=_,Object.defineProperty(t,"__esModule",{value:!0})}));
