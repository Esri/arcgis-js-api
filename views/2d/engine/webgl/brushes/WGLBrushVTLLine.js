/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../definitions","../../../../../chunks/vec2f32","../number","../enums","./WGLBrush"],(function(e,t,i,a,n,r,s,o){"use strict";let l=function(e){function o(){var t;return(t=e.apply(this,arguments)||this)._dashArray=n.create(),t._programOptions={id:!1,pattern:!1},t}t._inheritsLoose(o,e);var l=o.prototype;return l.dispose=function(){},l.drawMany=function(e,t){const{context:n,displayLevel:o,state:l,drawPhase:u,painter:f,styleLayerUID:d}=e,_=e.styleLayer,p=_.lineMaterial,c=f.vectorTilesMaterialManager,y=_.getPaintValue("line-translate",o),h=_.getPaintValue("line-translate-anchor",o),m=_.getPaintValue("line-pattern",o),U=void 0!==m,g=1/e.pixelRatio,M=8,T=u===s.WGLDrawPhase.HITTEST,v=this._programOptions;v.id=T,v.pattern=U;const I=c.getMaterialProgram(n,p,v);if(n.bindProgram(I),I.setUniformMatrix3fv("u_displayViewMat3",l.displayViewMat3),I.setUniformMatrix3fv("u_displayMat3",1===h?l.displayMat3:l.displayViewMat3),I.setUniform2fv("u_lineTranslation",y),I.setUniform1f("u_depth",_.z),I.setUniform1f("u_antialiasing",g),T){const e=r.u32to4Xu8(d+1);I.setUniform4fv("u_id",e)}if(U){const t=e.spriteMosaic,i=t.getMosaicItemPosition(m,!0);i&&(t.bind(n,9729,i.page,a.VTL_TEXTURE_BINDING_UNIT_SPRITES),I.setUniform2f("u_pattern_tl",i.tl[0],i.br[1]),I.setUniform2f("u_pattern_br",i.br[0],i.tl[1]),I.setUniform2f("u_spriteSize",M*i.size[0],i.size[1]),I.setUniform1i("u_texture",a.VTL_TEXTURE_BINDING_UNIT_SPRITES))}else{let e=_.getPaintValue("line-dasharray",o);e.length<2&&(e=[1,-1]);const t=M;this._dashArray[0]=t*e[0],this._dashArray[1]=t*e[1],I.setUniform2fv("u_dasharray",this._dashArray)}let P=-1;for(const a of t){if(!a.layerData.has(d))continue;a.key.level!==P&&(P=a.key.level,p.setDataUniforms(I,o,_,P));const e=a.layerData.get(d);e.prepareForRendering(n);const t=e.lineVertexArrayObject;i.isNone(t)||(n.bindVAO(t),I.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs),n.setStencilFunction(514,a.stencilRef,255),n.drawElements(4,e.lineIndexCount,5125,Uint32Array.BYTES_PER_ELEMENT*e.lineIndexStart),a.triangleCount+=e.lineIndexCount/3)}},o}(o);e.WGLBrushVTLLine=l,Object.defineProperty(e,"__esModule",{value:!0})}));
