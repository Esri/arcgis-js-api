/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../definitions","./WGLBrush","../../../../webgl/enums"],(function(t,e,i,s,o){"use strict";let a=function(s){function a(){var t;return(t=s.apply(this,arguments)||this)._computeDesc=new Map,t}t._inheritsLoose(a,s);var n=a.prototype;return n.prepareState=function({context:t},e,i){const s=i&&-1!==i.indexOf("hittest");t.setBlendingEnabled(!s),t.setBlendFunctionSeparate(o.BlendFactor.ONE,o.BlendFactor.ONE_MINUS_SRC_ALPHA,o.BlendFactor.ONE,o.BlendFactor.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!0),t.setStencilFunction(o.CompareFunction.EQUAL,e.stencilRef,255)},n.draw=function(t,i,s){const o=this.getGeometryType();i.commit(t);const a=i.getGeometry(o);e.isNone(a)||(t.timeline.begin(this.name),t.attributeView.bindTextures(t.context),a.forEachCommand((e=>this.drawGeometry(t,i,e,s))))},n._setSharedUniforms=function(t,s,o){const{displayLevel:a,pixelRatio:n,state:r,passOptions:u}=s;e.isSome(u)&&"hittest"===u.type&&(t.setUniform2fv("u_hittestPos",u.position),t.setUniform1f("u_hittestDist",u.distance)),t.setUniform1f("u_pixelRatio",n),t.setUniformMatrix3fv("u_tileMat3",o.transforms.tileMat3),t.setUniformMatrix3fv("u_viewMat3",r.viewMat3),t.setUniformMatrix3fv("u_dvsMat3",o.transforms.dvs),t.setUniformMatrix3fv("u_displayViewMat3",r.displayViewMat3),t.setUniform1f("u_currentZoom",Math.round(a*i.MIN_MAX_ZOOM_PRECISION_FACTOR)),t.setUniform1i("u_attributeTextureSize",s.attributeView.size),t.setUniform1i("u_attributeData0",i.TEXTURE_BINDING_ATTRIBUTE_DATA_0),t.setUniform1i("u_attributeData1",i.TEXTURE_BINDING_ATTRIBUTE_DATA_1),t.setUniform1i("u_attributeData2",i.TEXTURE_BINDING_ATTRIBUTE_DATA_2),t.setUniform1i("u_attributeData3",i.TEXTURE_BINDING_ATTRIBUTE_DATA_3)},n._setSizeVVUniforms=function(t,e,i,s){if(t.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",i.vvSizeMinMaxValue),t.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",i.vvSizeScaleStopsValue),t.vvSizeFieldStops){const t=i.getSizeVVFieldStops(s.key.level);e.setUniform1fv("u_vvSizeFieldStopsValues",t.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",t.sizes)}t.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",i.vvSizeUnitValueToPixelsRatio)},n._setColorAndOpacityVVUniforms=function(t,e,i){t.vvColor&&(e.setUniform1fv("u_vvColorValues",i.vvColorValues),e.setUniform4fv("u_vvColors",i.vvColors)),t.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",i.vvOpacityValues),e.setUniform1fv("u_vvOpacities",i.vvOpacities))},n._setRotationVVUniforms=function(t,e,i){t.vvRotation&&e.setUniform1f("u_vvRotationType","geographic"===i.vvMaterialParameters.vvRotationType?0:1)},n._getTriangleDesc=function(t,e){let i=this._computeDesc.get(t);if(!i){const s=e.strides,a=e.strides.geometry,n=new Map(e.attributes),r=e.bufferLayouts.geometry.map((t=>({...t}))),u=Math.max(...e.attributes.values()),v={geometry:r};v.geometry.push({count:2,name:"a_pos1",divisor:0,normalized:!1,offset:a,stride:a,type:o.DataType.SHORT}),v.geometry.push({count:2,name:"a_pos2",divisor:0,normalized:!1,offset:2*a,stride:a,type:o.DataType.SHORT}),n.set("a_pos1",u+1),n.set("a_pos2",u+2),i={bufferLayouts:v,attributes:n,strides:s},this._computeDesc.set(t,i)}return i},a}(s);return a}));
