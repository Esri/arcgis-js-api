/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../enums","../Utils","./WGLGeometryBrush","../materialKey/MaterialKey","../../../../webgl/enums"],(function(t,e,a,o,n,i,r){"use strict";const s=t=>o.createProgramDescriptor(t.data,{geometry:[{location:0,name:"a_pos",count:2,type:r.DataType.SHORT},{location:1,name:"a_id",count:4,type:r.DataType.UNSIGNED_BYTE},{location:2,name:"a_color",count:4,type:r.DataType.UNSIGNED_BYTE,normalized:!0},{location:3,name:"a_haloColor",count:4,type:r.DataType.UNSIGNED_BYTE,normalized:!0},{location:4,name:"a_texFontSize",count:4,type:r.DataType.UNSIGNED_BYTE},{location:5,name:"a_aux",count:4,type:r.DataType.BYTE},{location:6,name:"a_zoomRange",count:2,type:r.DataType.UNSIGNED_SHORT},{location:7,name:"a_vertexOffset",count:2,type:r.DataType.SHORT},{location:8,name:"a_texCoords",count:2,type:r.DataType.UNSIGNED_SHORT}]});let y=function(o){function n(){return o.apply(this,arguments)||this}t._inheritsLoose(n,o);var y=n.prototype;return y.dispose=function(){},y.getGeometryType=function(){return a.WGLGeometryType.TEXT},y.drawGeometry=function(t,a,o,n){const{context:y,painter:p,rendererInfo:m,state:l,passOptions:u}=t,T=i.TextMaterialKey.load(o.materialKey),{bufferLayouts:c,attributes:_}=s(T),f=p.materialManager.getMaterialProgram(t,T,"materials/text",_,n);y.useProgram(f);let d=r.PrimitiveType.TRIANGLES;e.isSome(u)&&"hittest"===u.type&&(d=r.PrimitiveType.POINTS),this._setSharedUniforms(f,t,a),p.textureManager.bindTextures(y,f,T),f.setUniformMatrix3fv("u_displayMat3",l.displayMat3),f.setUniformMatrix3fv("u_displayViewMat3",l.displayViewMat3),this._setSizeVVUniforms(T,f,m,a),this._setColorAndOpacityVVUniforms(T,f,m),this._setRotationVVUniforms(T,f,m),f.setUniform1f("u_isHalo",1);const E=o.target.getVAO(y,c,_),N=o.indexFrom*Uint32Array.BYTES_PER_ELEMENT;y.bindVAO(E),y.drawElements(r.PrimitiveType.TRIANGLES,o.indexCount,r.DataType.UNSIGNED_INT,N),f.setUniform1f("u_isHalo",0),y.drawElements(d,o.indexCount,r.DataType.UNSIGNED_INT,N)},n}(n);return y}));
