/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../vectorTiles/style/StyleDefinition","../enums","../number","./WGLBrush","../../../../webgl/enums"],(function(e,t,r,n,i,a,o,s){"use strict";let l=function(e){function o(){var t;return(t=e.apply(this,arguments)||this)._programOptions={id:!1},t}t._inheritsLoose(o,e);var l=o.prototype;return l.dispose=function(){},l.drawMany=function(e,t){const{context:o,displayLevel:l,requiredLevel:c,state:u,drawPhase:d,painter:f,spriteMosaic:p,styleLayerUID:y,requestRender:m,allowDelayedRender:v}=e;if(!t.some((e=>e.layerData.get(y)?.circleIndexCount??!1)))return;const g=e.styleLayer,T=g.circleMaterial,h=f.vectorTilesMaterialManager,M=1.2,E=g.getPaintValue("circle-translate",l),_=g.getPaintValue("circle-translate-anchor",l),L=d===i.WGLDrawPhase.HITTEST,I=this._programOptions;I.id=L;const P=h.getMaterialProgram(o,T,I);if(v&&r.isSome(m)&&!P.compiled)return void m();o.useProgram(P),P.setUniformMatrix3fv("u_displayMat3",_===n.TranslateAnchor.VIEWPORT?u.displayMat3:u.displayViewMat3),P.setUniform2fv("u_circleTranslation",E),P.setUniform1f("u_depth",g.z),P.setUniform1f("u_antialiasingWidth",M);let S=-1;if(L){const e=a.u32to4Xu8(y+1);P.setUniform4fv("u_id",e)}for(const n of t){if(!n.layerData.has(y))continue;n.key.level!==S&&(S=n.key.level,T.setDataUniforms(P,l,g,S,p));const e=n.layerData.get(y);if(!e.circleIndexCount)continue;e.prepareForRendering(o);const t=e.circleVertexArrayObject;r.isNone(t)||(o.bindVAO(t),P.setUniformMatrix3fv("u_dvsMat3",n.transforms.dvs),c!==n.key.level?o.setStencilFunction(s.CompareFunction.EQUAL,n.stencilRef,255):o.setStencilFunction(s.CompareFunction.GREATER,255,255),o.drawElements(s.PrimitiveType.TRIANGLES,e.circleIndexCount,s.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),n.triangleCount+=e.circleIndexCount/3)}},o}(o);e.WGLBrushVTLCircle=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
