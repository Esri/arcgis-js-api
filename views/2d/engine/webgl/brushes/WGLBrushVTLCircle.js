/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../vectorTiles/style/StyleDefinition","../enums","../number","./WGLBrush","../../../../webgl/enums"],(function(e,t,r,n,i,a,o,s){"use strict";let l=function(e){function o(){var t;return(t=e.apply(this,arguments)||this)._programOptions={id:!1},t}t._inheritsLoose(o,e);var l=o.prototype;return l.dispose=function(){},l.drawMany=function(e,t){const{context:o,displayLevel:l,requiredLevel:c,state:u,drawPhase:f,painter:d,spriteMosaic:p,styleLayerUID:y}=e;if(!t.some((e=>{var t,r;return null!=(t=null==(r=e.layerData.get(y))?void 0:r.circleIndexCount)&&t})))return;const m=e.styleLayer,v=m.circleMaterial,g=d.vectorTilesMaterialManager,T=1.2,M=m.getPaintValue("circle-translate",l),_=m.getPaintValue("circle-translate-anchor",l),h=f===i.WGLDrawPhase.HITTEST,E=this._programOptions;E.id=h;const L=g.getMaterialProgram(o,v,E);o.useProgram(L),L.setUniformMatrix3fv("u_displayMat3",_===n.TranslateAnchor.VIEWPORT?u.displayMat3:u.displayViewMat3),L.setUniform2fv("u_circleTranslation",M),L.setUniform1f("u_depth",m.z),L.setUniform1f("u_antialiasingWidth",T);let I=-1;if(h){const e=a.u32to4Xu8(y+1);L.setUniform4fv("u_id",e)}for(const n of t){if(!n.layerData.has(y))continue;n.key.level!==I&&(I=n.key.level,v.setDataUniforms(L,l,m,I,p));const e=n.layerData.get(y);if(!e.circleIndexCount)continue;e.prepareForRendering(o);const t=e.circleVertexArrayObject;r.isNone(t)||(o.bindVAO(t),L.setUniformMatrix3fv("u_dvsMat3",n.transforms.dvs),c!==n.key.level?o.setStencilFunction(s.CompareFunction.EQUAL,n.stencilRef,255):o.setStencilFunction(s.CompareFunction.GREATER,255,255),o.drawElements(s.PrimitiveType.TRIANGLES,e.circleIndexCount,s.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.circleIndexStart),n.triangleCount+=e.circleIndexCount/3)}},o}(o);e.WGLBrushVTLCircle=l,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
