/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../definitions","../VertexStream","./WGLBrush"],(function(e,t,i,n){"use strict";const s={nearest:{defines:[],samplingMode:9728,mips:!1},bilinear:{defines:[],samplingMode:9729,mips:!1},bicubic:{defines:["bicubic"],samplingMode:9729,mips:!1},trilinear:{defines:[],samplingMode:9987,mips:!0}},a=(e,t,i)=>{if("dynamic"===i.samplingMode){const{state:i}=e,n=t.resolution/t.pixelRatio/i.resolution,a=Math.round(e.pixelRatio)!==e.pixelRatio,r=n>1.05||n<.95;return i.rotation||r||a||t.isSourceScaled||t.rotation?s.bilinear:s.nearest}return s[i.samplingMode]};let r=function(n){function s(){var e;return(e=n.apply(this,arguments)||this)._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_position",0],["a_texcoord",1]])},e}e._inheritsLoose(s,n);var r=s.prototype;return r.dispose=function(){this._quad&&this._quad.dispose()},r.prepareState=function({context:e},t){e.setBlendingEnabled(!0),"additive"===t.blendFunction?e.setBlendFunctionSeparate(1,1,1,1):e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilFunction(514,t.stencilRef,255)},r.draw=function(e,n){const{context:s,renderingOptions:r,painter:o}=e;if(!n.source)return;e.timeline.begin(this.name),this._quad||(this._quad=new i(s,[0,0,1,0,0,1,1,1]));const d=a(e,n,r),c=o.materialManager.getProgram(e,this._desc,d.defines),{coordScale:u,computedOpacity:l,transforms:p}=n;n.setSamplingProfile(d),n.bind(e.context,t.TEXTURE_BINDING_BITMAP),s.useProgram(c),c.setUniformMatrix3fv("u_dvsMat3",p.dvs),c.setUniform1i("u_texture",t.TEXTURE_BINDING_BITMAP),c.setUniform2fv("u_coordScale",u),c.setUniform1f("u_opacity",l),this._quad.draw(),e.timeline.end(this.name)},s}(n);return r}));
