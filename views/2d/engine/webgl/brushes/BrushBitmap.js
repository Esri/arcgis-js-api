/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../definitions","../VertexStream","./WGLBrush","../../../../webgl/enums"],(function(e,t,i,n,r,a){"use strict";const s={nearest:{defines:[],samplingMode:a.TextureSamplingMode.NEAREST,mips:!1},bilinear:{defines:[],samplingMode:a.TextureSamplingMode.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:a.TextureSamplingMode.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:a.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,mips:!0}},o=(e,t,i)=>{if("dynamic"===i.samplingMode){const{state:i}=e,n=t.resolution/t.pixelRatio/i.resolution,r=Math.round(e.pixelRatio)!==e.pixelRatio,a=n>1.05||n<.95;return i.rotation||a||r||t.isSourceScaled||t.rotation?s.bilinear:s.nearest}return s[i.samplingMode]};let d=function(r){function s(){var e;return(e=r.apply(this,arguments)||this)._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])},e}e._inheritsLoose(s,r);var d=s.prototype;return d.dispose=function(){this._quad&&this._quad.dispose()},d.prepareState=function({context:e}){e.setBlendingEnabled(!0),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0)},d.draw=function(e,r){const{context:s,renderingOptions:d,painter:l,requestRender:c,allowDelayedRender:u}=e;if(!r.source||!r.isReady)return;const p=o(e,r,d),m=l.materialManager.getProgram(this._desc,p.defines);if(u&&t.isSome(c)&&!m.isCompiled)return void c();e.timeline.begin(this.name),"additive"===r.blendFunction?s.setBlendFunctionSeparate(a.BlendFactor.ONE,a.BlendFactor.ONE,a.BlendFactor.ONE,a.BlendFactor.ONE):s.setBlendFunctionSeparate(a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA,a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA),s.setStencilFunction(a.CompareFunction.EQUAL,r.stencilRef,255),this._quad||(this._quad=new n(s,[0,0,1,0,0,1,1,1]));const{coordScale:f,computedOpacity:_,transforms:M}=r;r.setSamplingProfile(p),r.bind(e.context,i.TEXTURE_BINDING_BITMAP),s.useProgram(m),m.setUniformMatrix3fv("u_dvsMat3",M.dvs),m.setUniform1i("u_texture",i.TEXTURE_BINDING_BITMAP),m.setUniform2fv("u_coordScale",f),m.setUniform1f("u_opacity",_),this._quad.draw(),e.timeline.end(this.name)},s}(r);return d}));
