/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../definitions","../Utils","./WGLBrush","../../../../webgl/enums"],(function(e,t,n,r,i,a){"use strict";const o=()=>r.createProgramDescriptor("overlay",{geometry:[{location:0,name:"a_pos",count:2,type:a.DataType.FLOAT}],tex:[{location:1,name:"a_uv",count:2,type:a.DataType.UNSIGNED_SHORT}]});let s=function(r){function i(){var e;return(e=r.apply(this,arguments)||this)._desc={vsPath:"overlay/overlay",fsPath:"overlay/overlay",attributes:new Map([["a_pos",0],["a_uv",1]])},e}e._inheritsLoose(i,r);var s=i.prototype;return s.dispose=function(){},s.prepareState=function({context:e}){e.setBlendingEnabled(!0),e.setColorMask(!0,!0,!0,!0),e.setBlendFunctionSeparate(a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA,a.BlendFactor.ONE,a.BlendFactor.ONE_MINUS_SRC_ALPHA),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilFunction(a.CompareFunction.GREATER,255,255)},s.draw=function(e,r){const{context:i,painter:s,requestRender:c,allowDelayedRender:u}=e;if(!r.isReady)return;const{computedOpacity:l,dvsMat3:p,isWrapAround:d,perspectiveTransform:_,texture:m}=r;e.timeline.begin(this.name);const f=s.materialManager.getProgram(this._desc);if(u&&t.isSome(c)&&!f.isCompiled)return void c();const y=o(),v=r.getVAO(i,y.bufferLayouts,y.attributes);if(!v)return;i.bindVAO(v),i.useProgram(f),i.bindTexture(m,n.TEXTURE_BINDING_BITMAP),f.setUniformMatrix3fv("u_dvsMat3",p),f.setUniform1i("u_texture",n.TEXTURE_BINDING_BITMAP),f.setUniform1f("u_opacity",l),f.setUniform2fv("u_perspective",_);const T=d?10:4;i.drawArrays(a.PrimitiveType.TRIANGLE_STRIP,0,T),i.bindVAO(),e.timeline.end(this.name)},i}(i);return s}));
