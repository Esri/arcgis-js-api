/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../symbols/cim/enums","./definitions"],(function(t,e,i){"use strict";function n(t,e){return t.x===e.x&&t.y===e.y}function x(t){if(!t)return;const e=t.length;if(e<=1)return;let i=0;for(let x=1;x<e;x++)n(t[x],t[i])||++i===x||(t[i]=t[x]);t.length=i+1}function r(t,e){return t.x=e.y,t.y=-e.x,t}function y(t,e){return t.x=-e.y,t.y=e.x,t}function s(t,e){return t.x=e.x,t.y=e.y,t}function o(t,e){return t.x=-e.x,t.y=-e.y,t}function h(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function l(t,e){return t.x*e.y-t.y*e.x}function a(t,e){return t.x*e.x+t.y*e.y}function c(t,e,i,n){return t.x=e.x*i+e.y*n,t.y=e.x*n-e.y*i,t}let u=function(){function t(t,e,i){this.writeVertex=t,this.writeTriangle=e,this.canUseThinTessellation=i,this.prevNormal={x:void 0,y:void 0},this.nextNormal={x:void 0,y:void 0},this.textureNormalLeft={x:0,y:1},this.textureNormalRight={x:0,y:-1},this.textureNormal={x:void 0,y:void 0},this.joinNormal={x:void 0,y:void 0},this.inner={x:void 0,y:void 0},this.outer={x:void 0,y:void 0},this.roundStart={x:void 0,y:void 0},this.roundEnd={x:void 0,y:void 0},this.startBreak={x:void 0,y:void 0},this.endBreak={x:void 0,y:void 0},this.innerPrev={x:void 0,y:void 0},this.innerNext={x:void 0,y:void 0},this.bevelStart={x:void 0,y:void 0},this.bevelEnd={x:void 0,y:void 0},this.bevelMiddle={x:void 0,y:void 0}}var u=t.prototype;return u.tessellate=function(t,e){x(t),this.canUseThinTessellation&&e.halfWidth<i.THIN_LINE_HALF_WIDTH_THRESHOLD&&!e.offset?this._tessellateThin(t,e):this._tessellate(t,e)},u._tessellateThin=function(t,e){if(t.length<2)return;const i=e.wrapDistance||65535;let n=e.initialDistance||0,x=!1,r=t[0].x,y=t[0].y;const s=t.length;for(let o=1;o<s;++o){x&&(x=!1,n=0);let e=t[o].x,s=t[o].y,h=e-r,l=s-y,a=Math.sqrt(h*h+l*l);if(h/=a,l/=a,n+a>i){x=!0;const t=(i-n)/a;a=i-n,e=(1-t)*r+t*e,s=(1-t)*y+t*s,--o}const c=this.writeVertex(r,y,0,0,h,l,l,-h,0,-1,n),u=this.writeVertex(r,y,0,0,h,l,-l,h,0,1,n);n+=a;const d=this.writeVertex(e,s,0,0,h,l,l,-h,0,-1,n),T=this.writeVertex(e,s,0,0,h,l,-l,h,0,1,n);this.writeTriangle(c,u,d),this.writeTriangle(u,d,T),r=e,y=s}},u._tessellate=function(t,i){const x=t[0],u=t[t.length-1],d=n(x,u),T=d?3:2;if(t.length<T)return;const f=i.pixelCoordRatio,v=null!=i.capType?i.capType:e.CapType.BUTT,w=null!=i.joinType?i.joinType:e.JoinType.MITER,p=null!=i.miterLimit?Math.min(i.miterLimit,4):2,g=null!=i.roundLimit?Math.min(i.roundLimit,1.05):1.05,N=null!=i.halfWidth?i.halfWidth:2,V=!!i.textured;let m,E,b=null,R=null;const M=this.prevNormal,L=this.nextNormal;let U=-1,k=-1;const B=this.joinNormal;let D,_;const S=this.textureNormalLeft,C=this.textureNormalRight,J=this.textureNormal;let I=-1,O=-1;const A=i.wrapDistance||65535;let P=i.initialDistance||0;const j=this.writeVertex,H=this.writeTriangle,W=function(t,e,i,n,x,r){const y=j(m,E,D,_,i,n,t,e,x,r,P);return I>=0&&O>=0&&y>=0&&H(I,O,y),I=O,O=y,y};d&&(b=t[t.length-2],L.x=u.x-b.x,L.y=u.y-b.y,k=h(L),L.x/=k,L.y/=k);let q=!1;for(let n=0;n<t.length;++n){if(q&&(q=!1,P=0),b&&(M.x=-L.x,M.y=-L.y,U=k,P+U>A&&(q=!0)),q){const e=(A-P)/U;U=A-P,b={x:(1-e)*b.x+e*t[n].x,y:(1-e)*b.y+e*t[n].y},--n}else b=t[n];m=b.x,E=b.y;const i=n<=0&&!q,x=n===t.length-1;if(i||(P+=U),R=x?d?t[1]:null:t[n+1],R?(L.x=R.x-m,L.y=R.y-E,k=h(L),L.x/=k,L.y/=k):(L.x=void 0,L.y=void 0),!d){if(i){y(B,L),D=B.x,_=B.y,v===e.CapType.SQUARE&&(W(-L.y-L.x,L.x-L.y,L.x,L.y,0,-1),W(L.y-L.x,-L.x-L.y,L.x,L.y,0,1)),v===e.CapType.ROUND&&(W(-L.y-L.x,L.x-L.y,L.x,L.y,-1,-1),W(L.y-L.x,-L.x-L.y,L.x,L.y,-1,1)),v!==e.CapType.ROUND&&v!==e.CapType.BUTT||(W(-L.y,L.x,L.x,L.y,0,-1),W(L.y,-L.x,L.x,L.y,0,1));continue}if(x){r(B,M),D=B.x,_=B.y,v!==e.CapType.ROUND&&v!==e.CapType.BUTT||(W(M.y,-M.x,-M.x,-M.y,0,-1),W(-M.y,M.x,-M.x,-M.y,0,1)),v===e.CapType.SQUARE&&(W(M.y-M.x,-M.x-M.y,-M.x,-M.y,0,-1),W(-M.y-M.x,M.x-M.y,-M.x,-M.y,0,1)),v===e.CapType.ROUND&&(W(M.y-M.x,-M.x-M.y,-M.x,-M.y,1,-1),W(-M.y-M.x,M.x-M.y,-M.x,-M.y,1,1));continue}}let u,T,j=-l(M,L);if(Math.abs(j)<.01)a(M,L)>0?(B.x=M.x,B.y=M.y,j=1,u=Number.MAX_VALUE,T=!0):(y(B,L),j=1,u=1,T=!1);else{B.x=(M.x+L.x)/j,B.y=(M.y+L.y)/j,u=h(B);const t=(u-1)*N*f;T=u>4||t>U&&t>k}D=B.x,_=B.y;let H=w;switch(w){case e.JoinType.BEVEL:u<1.05&&(H=e.JoinType.MITER);break;case e.JoinType.ROUND:u<g&&(H=e.JoinType.MITER);break;case e.JoinType.MITER:u>p&&(H=e.JoinType.BEVEL)}switch(H){case e.JoinType.MITER:if(W(B.x,B.y,-M.x,-M.y,0,-1),W(-B.x,-B.y,-M.x,-M.y,0,1),x)break;if(V){const t=q?0:P;I=this.writeVertex(m,E,D,_,L.x,L.y,B.x,B.y,0,-1,t),O=this.writeVertex(m,E,D,_,L.x,L.y,-B.x,-B.y,0,1,t)}break;case e.JoinType.BEVEL:{const t=j<0;let e,i,n,h;if(t){const t=I;I=O,O=t,e=S,i=C}else e=C,i=S;if(T)n=t?y(this.innerPrev,M):r(this.innerPrev,M),h=t?r(this.innerNext,L):y(this.innerNext,L);else{const e=t?o(this.inner,B):s(this.inner,B);n=e,h=e}const l=t?r(this.bevelStart,M):y(this.bevelStart,M);W(n.x,n.y,-M.x,-M.y,e.x,e.y);const a=W(l.x,l.y,-M.x,-M.y,i.x,i.y);if(x)break;const u=t?y(this.bevelEnd,L):r(this.bevelEnd,L);if(T){const t=this.writeVertex(m,E,D,_,-M.x,-M.y,0,0,0,0,P);I=this.writeVertex(m,E,D,_,L.x,L.y,h.x,h.y,e.x,e.y,P),O=this.writeVertex(m,E,D,_,L.x,L.y,u.x,u.y,i.x,i.y,P),this.writeTriangle(a,t,O)}else{if(V){const t=this.bevelMiddle;t.x=(l.x+u.x)/2,t.y=(l.y+u.y)/2,c(J,t,-M.x,-M.y),W(t.x,t.y,-M.x,-M.y,J.x,J.y),c(J,t,L.x,L.y),I=this.writeVertex(m,E,D,_,L.x,L.y,t.x,t.y,J.x,J.y,P),O=this.writeVertex(m,E,D,_,L.x,L.y,h.x,h.y,e.x,e.y,P)}else{const t=I;I=O,O=t}W(u.x,u.y,L.x,L.y,i.x,i.y)}if(t){const t=I;I=O,O=t}break}case e.JoinType.ROUND:{const t=j<0;let e,i;if(t){const t=I;I=O,O=t,e=S,i=C}else e=C,i=S;const n=t?o(this.inner,B):s(this.inner,B);let h,l;T?(h=t?y(this.innerPrev,M):r(this.innerPrev,M),l=t?r(this.innerNext,L):y(this.innerNext,L)):(h=n,l=n);const d=t?r(this.roundStart,M):y(this.roundStart,M),f=t?y(this.roundEnd,L):r(this.roundEnd,L),v=W(h.x,h.y,-M.x,-M.y,e.x,e.y),w=W(d.x,d.y,-M.x,-M.y,i.x,i.y);if(x)break;const p=this.writeVertex(m,E,D,_,-M.x,-M.y,0,0,0,0,P);T||this.writeTriangle(I,O,p);const g=o(this.outer,n),N=this.writeVertex(m,E,D,_,L.x,L.y,f.x,f.y,i.x,i.y,P);let b,R;const U=u>2;if(U){let e;u!==Number.MAX_VALUE?(g.x/=u,g.y/=u,e=a(M,g),e=(u*(e*e-1)+1)/e):e=-1,b=t?r(this.startBreak,M):y(this.startBreak,M),b.x+=M.x*e,b.y+=M.y*e,R=t?y(this.endBreak,L):r(this.endBreak,L),R.x+=L.x*e,R.y+=L.y*e}c(J,g,-M.x,-M.y);const k=this.writeVertex(m,E,D,_,-M.x,-M.y,g.x,g.y,J.x,J.y,P);c(J,g,L.x,L.y);const A=V?this.writeVertex(m,E,D,_,L.x,L.y,g.x,g.y,J.x,J.y,P):k,H=p,q=V?this.writeVertex(m,E,D,_,L.x,L.y,0,0,0,0,P):p;let Q=-1,X=-1;if(U&&(c(J,b,-M.x,-M.y),Q=this.writeVertex(m,E,D,_,-M.x,-M.y,b.x,b.y,J.x,J.y,P),c(J,R,L.x,L.y),X=this.writeVertex(m,E,D,_,L.x,L.y,R.x,R.y,J.x,J.y,P)),V?U?(this.writeTriangle(H,w,Q),this.writeTriangle(H,Q,k),this.writeTriangle(q,A,X),this.writeTriangle(q,X,N)):(this.writeTriangle(H,w,k),this.writeTriangle(q,A,N)):U?(this.writeTriangle(p,w,Q),this.writeTriangle(p,Q,X),this.writeTriangle(p,X,N)):(this.writeTriangle(p,w,k),this.writeTriangle(p,A,N)),T?(I=this.writeVertex(m,E,D,_,L.x,L.y,l.x,l.y,e.x,e.y,P),O=N):(I=V?this.writeVertex(m,E,D,_,L.x,L.y,l.x,l.y,e.x,e.y,P):v,this.writeTriangle(I,q,N),O=N),t){const t=I;I=O,O=t}break}}}},t}();t.LineTessellation=u,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
