/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../symbols/cim/enums","./definitions"],(function(t,e,i){"use strict";function n(t,e){return t.x===e.x&&t.y===e.y}function x(t){if(!t)return;const e=t.length;if(e<=1)return;let i=0;for(let x=1;x<e;x++)n(t[x],t[i])||++i===x||(t[i]=t[x]);t.length=i+1}function r(t,e){return t.x=e.y,t.y=-e.x,t}function y(t,e){return t.x=-e.y,t.y=e.x,t}function s(t,e){return t.x=e.x,t.y=e.y,t}function o(t,e){return t.x=-e.x,t.y=-e.y,t}function h(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function l(t,e){return t.x*e.y-t.y*e.x}function _(t,e){return t.x*e.x+t.y*e.y}function a(t,e,i,n){return t.x=e.x*i+e.y*n,t.y=e.x*n-e.y*i,t}let c=function(){function t(t,e,i){this._writeVertex=t,this._writeTriangle=e,this._canUseThinTessellation=i,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}var c=t.prototype;return c.tessellate=function(t,e){x(t),this._canUseThinTessellation&&e.halfWidth<i.THIN_LINE_HALF_WIDTH_THRESHOLD&&!e.offset?this._tessellateThin(t,e):this._tessellate(t,e)},c._tessellateThin=function(t,e){if(t.length<2)return;const i=e.wrapDistance||65535;let n=e.initialDistance||0,x=!1,r=t[0].x,y=t[0].y;const s=t.length;for(let o=1;o<s;++o){x&&(x=!1,n=0);let e=t[o].x,s=t[o].y,h=e-r,l=s-y,_=Math.sqrt(h*h+l*l);if(h/=_,l/=_,n+_>i){x=!0;const t=(i-n)/_;_=i-n,e=(1-t)*r+t*e,s=(1-t)*y+t*s,--o}const a=this._writeVertex(r,y,0,0,h,l,l,-h,0,-1,n),c=this._writeVertex(r,y,0,0,h,l,-l,h,0,1,n);n+=_;const u=this._writeVertex(e,s,0,0,h,l,l,-h,0,-1,n),d=this._writeVertex(e,s,0,0,h,l,-l,h,0,1,n);this._writeTriangle(a,c,u),this._writeTriangle(c,u,d),r=e,y=s}},c._tessellate=function(t,i){const x=t[0],c=t[t.length-1],u=n(x,c),d=u?3:2;if(t.length<d)return;const T=i.pixelCoordRatio,f=null!=i.capType?i.capType:e.CapType.BUTT,v=null!=i.joinType?i.joinType:e.JoinType.MITER,w=null!=i.miterLimit?Math.min(i.miterLimit,4):2,p=null!=i.roundLimit?Math.min(i.roundLimit,1.05):1.05,g=null!=i.halfWidth?i.halfWidth:2,N=!!i.textured;let V,m,E,b=null;const R=this._prevNormal,M=this._nextNormal;let L=-1,U=-1;const k=this._joinNormal;let B,D;const S=this._textureNormalLeft,C=this._textureNormalRight,J=this._textureNormal;let I=-1,O=-1;const A=i.wrapDistance||65535;let P=i.initialDistance||0;const j=this._writeVertex,H=this._writeTriangle,W=(t,e,i,n,x,r)=>{const y=j(m,E,B,D,i,n,t,e,x,r,P);return I>=0&&O>=0&&y>=0&&H(I,O,y),I=O,O=y,y};u&&(V=t[t.length-2],M.x=c.x-V.x,M.y=c.y-V.y,U=h(M),M.x/=U,M.y/=U);let q=!1;for(let n=0;n<t.length;++n){if(q&&(q=!1,P=0),V&&(R.x=-M.x,R.y=-M.y,L=U,P+L>A&&(q=!0)),q){const e=(A-P)/L;L=A-P,V={x:(1-e)*V.x+e*t[n].x,y:(1-e)*V.y+e*t[n].y},--n}else V=t[n];m=V.x,E=V.y;const i=n<=0&&!q,x=n===t.length-1;if(i||(P+=L),b=x?u?t[1]:null:t[n+1],b?(M.x=b.x-m,M.y=b.y-E,U=h(M),M.x/=U,M.y/=U):(M.x=void 0,M.y=void 0),!u){if(i){y(k,M),B=k.x,D=k.y,f===e.CapType.SQUARE&&(W(-M.y-M.x,M.x-M.y,M.x,M.y,0,-1),W(M.y-M.x,-M.x-M.y,M.x,M.y,0,1)),f===e.CapType.ROUND&&(W(-M.y-M.x,M.x-M.y,M.x,M.y,-1,-1),W(M.y-M.x,-M.x-M.y,M.x,M.y,-1,1)),f!==e.CapType.ROUND&&f!==e.CapType.BUTT||(W(-M.y,M.x,M.x,M.y,0,-1),W(M.y,-M.x,M.x,M.y,0,1));continue}if(x){r(k,R),B=k.x,D=k.y,f!==e.CapType.ROUND&&f!==e.CapType.BUTT||(W(R.y,-R.x,-R.x,-R.y,0,-1),W(-R.y,R.x,-R.x,-R.y,0,1)),f===e.CapType.SQUARE&&(W(R.y-R.x,-R.x-R.y,-R.x,-R.y,0,-1),W(-R.y-R.x,R.x-R.y,-R.x,-R.y,0,1)),f===e.CapType.ROUND&&(W(R.y-R.x,-R.x-R.y,-R.x,-R.y,1,-1),W(-R.y-R.x,R.x-R.y,-R.x,-R.y,1,1));continue}}let c,d,j=-l(R,M);if(Math.abs(j)<.01)_(R,M)>0?(k.x=R.x,k.y=R.y,j=1,c=Number.MAX_VALUE,d=!0):(y(k,M),j=1,c=1,d=!1);else{k.x=(R.x+M.x)/j,k.y=(R.y+M.y)/j,c=h(k);const t=(c-1)*g*T;d=c>4||t>L&&t>U}B=k.x,D=k.y;let H=v;switch(v){case e.JoinType.BEVEL:c<1.05&&(H=e.JoinType.MITER);break;case e.JoinType.ROUND:c<p&&(H=e.JoinType.MITER);break;case e.JoinType.MITER:c>w&&(H=e.JoinType.BEVEL)}switch(H){case e.JoinType.MITER:if(W(k.x,k.y,-R.x,-R.y,0,-1),W(-k.x,-k.y,-R.x,-R.y,0,1),x)break;if(N){const t=q?0:P;I=this._writeVertex(m,E,B,D,M.x,M.y,k.x,k.y,0,-1,t),O=this._writeVertex(m,E,B,D,M.x,M.y,-k.x,-k.y,0,1,t)}break;case e.JoinType.BEVEL:{const t=j<0;let e,i,n,h;if(t){const t=I;I=O,O=t,e=S,i=C}else e=C,i=S;if(d)n=t?y(this._innerPrev,R):r(this._innerPrev,R),h=t?r(this._innerNext,M):y(this._innerNext,M);else{const e=t?o(this._inner,k):s(this._inner,k);n=e,h=e}const l=t?r(this._bevelStart,R):y(this._bevelStart,R);W(n.x,n.y,-R.x,-R.y,e.x,e.y);const _=W(l.x,l.y,-R.x,-R.y,i.x,i.y);if(x)break;const c=t?y(this._bevelEnd,M):r(this._bevelEnd,M);if(d){const t=this._writeVertex(m,E,B,D,-R.x,-R.y,0,0,0,0,P);I=this._writeVertex(m,E,B,D,M.x,M.y,h.x,h.y,e.x,e.y,P),O=this._writeVertex(m,E,B,D,M.x,M.y,c.x,c.y,i.x,i.y,P),this._writeTriangle(_,t,O)}else{if(N){const t=this._bevelMiddle;t.x=(l.x+c.x)/2,t.y=(l.y+c.y)/2,a(J,t,-R.x,-R.y),W(t.x,t.y,-R.x,-R.y,J.x,J.y),a(J,t,M.x,M.y),I=this._writeVertex(m,E,B,D,M.x,M.y,t.x,t.y,J.x,J.y,P),O=this._writeVertex(m,E,B,D,M.x,M.y,h.x,h.y,e.x,e.y,P)}else{const t=I;I=O,O=t}W(c.x,c.y,M.x,M.y,i.x,i.y)}if(t){const t=I;I=O,O=t}break}case e.JoinType.ROUND:{const t=j<0;let e,i;if(t){const t=I;I=O,O=t,e=S,i=C}else e=C,i=S;const n=t?o(this._inner,k):s(this._inner,k);let h,l;d?(h=t?y(this._innerPrev,R):r(this._innerPrev,R),l=t?r(this._innerNext,M):y(this._innerNext,M)):(h=n,l=n);const u=t?r(this._roundStart,R):y(this._roundStart,R),T=t?y(this._roundEnd,M):r(this._roundEnd,M),f=W(h.x,h.y,-R.x,-R.y,e.x,e.y),v=W(u.x,u.y,-R.x,-R.y,i.x,i.y);if(x)break;const w=this._writeVertex(m,E,B,D,-R.x,-R.y,0,0,0,0,P);d||this._writeTriangle(I,O,w);const p=o(this._outer,n),g=this._writeVertex(m,E,B,D,M.x,M.y,T.x,T.y,i.x,i.y,P);let V,b;const L=c>2;if(L){let e;c!==Number.MAX_VALUE?(p.x/=c,p.y/=c,e=_(R,p),e=(c*(e*e-1)+1)/e):e=-1,V=t?r(this._startBreak,R):y(this._startBreak,R),V.x+=R.x*e,V.y+=R.y*e,b=t?y(this._endBreak,M):r(this._endBreak,M),b.x+=M.x*e,b.y+=M.y*e}a(J,p,-R.x,-R.y);const U=this._writeVertex(m,E,B,D,-R.x,-R.y,p.x,p.y,J.x,J.y,P);a(J,p,M.x,M.y);const A=N?this._writeVertex(m,E,B,D,M.x,M.y,p.x,p.y,J.x,J.y,P):U,H=w,q=N?this._writeVertex(m,E,B,D,M.x,M.y,0,0,0,0,P):w;let Q=-1,X=-1;if(L&&(a(J,V,-R.x,-R.y),Q=this._writeVertex(m,E,B,D,-R.x,-R.y,V.x,V.y,J.x,J.y,P),a(J,b,M.x,M.y),X=this._writeVertex(m,E,B,D,M.x,M.y,b.x,b.y,J.x,J.y,P)),N?L?(this._writeTriangle(H,v,Q),this._writeTriangle(H,Q,U),this._writeTriangle(q,A,X),this._writeTriangle(q,X,g)):(this._writeTriangle(H,v,U),this._writeTriangle(q,A,g)):L?(this._writeTriangle(w,v,Q),this._writeTriangle(w,Q,X),this._writeTriangle(w,X,g)):(this._writeTriangle(w,v,U),this._writeTriangle(w,A,g)),d?(I=this._writeVertex(m,E,B,D,M.x,M.y,l.x,l.y,e.x,e.y,P),O=g):(I=N?this._writeVertex(m,E,B,D,M.x,M.y,l.x,l.y,e.x,e.y,P):f,this._writeTriangle(I,q,g),O=g),t){const t=I;I=O,O=t}break}}}},t}();t.LineTessellation=c,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
