/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","./enums"],(function(e,t,n){"use strict";const o=t.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");function i(e,t,n,...o){t<e.length?e.splice(t,n,...o):e.push(...o)}const r=new Map;r.set(n.WGLDrawPhase.MAP,[n.WGLGeometryType.FILL,n.WGLGeometryType.LINE,n.WGLGeometryType.MARKER,n.WGLGeometryType.TEXT]),r.set(n.WGLDrawPhase.LABEL,[n.WGLGeometryType.LABEL]),r.set(n.WGLDrawPhase.LABEL_ALPHA,[n.WGLGeometryType.LABEL]);let s=function(){function t(e=!1){this.symbolLevels=[],this.unified=e}var r=t.prototype;return r.replay=function(e,t,n){if(this.unified)for(const o of this.symbolLevels)for(const i of o.zLevels){const o=i.geometryDPInfo.unified;if(o)for(const i of o){const o=e.painter.getGeometryBrush(i.geometryType),r=t.getGeometry(i.geometryType);o.prepareState(e,t),o.drawGeometry(e,t,i,r,n)}}},r.clear=function(){this.symbolLevels.length=0},r.addToList=function(e,t){if(Array.isArray(e))for(const n of e)this._addToList(n,t);else this._addToList(e,t)},r.removeFromList=function(e){Array.isArray(e)||(e=[e]);let t=null;for(const n of e)t=this._removeFromList(n);return t},r.byType=function(e,t){for(const n of this.symbolLevels)for(const o of n.zLevels){const n=o.geometryDPInfo,i=this.getDPInfoType(e);if(n[i])for(const e of n[i])t(e)}},r.clone=function(){const e=new t(this.unified);for(const t of this.symbolLevels)e.symbolLevels.push(t.clone());return e},r.splitAfter=function(e){const t=this._getDisplayList(e.symbolLevel,e.zOrder,e.geometryType),n=t.length,o=e.indexFrom+e.indexCount;for(let i=0;i<n;++i){const n=t[i];if(n.geometryType===e.geometryType&&o>n.indexFrom&&o<=n.indexFrom+n.indexCount){if(o<n.indexFrom+n.indexCount){const e=new l;e.geometryType=n.geometryType,e.materialKey=n.materialKey,e.indexFrom=o,e.indexCount=n.indexFrom+n.indexCount-o,t.splice(i+1,0,e),n.indexCount=o-n.indexFrom}return i}}},r._addToList=function(e,t){const n=e.symbolLevel,o=e.zOrder,r=this._getDisplayList(n,o,e.geometryType),s=null!=t?t:r.length-1,y=s>=0&&s<r.length?r[s]:null;if(null===y||y.materialKey!==e.materialKey||y.indexFrom+y.indexCount!==e.indexFrom||this.unified&&y.geometryType!==e.geometryType){const t=new l;t.indexFrom=e.indexFrom,t.indexCount=e.indexCount,t.materialKey=e.materialKey,t.geometryType=e.geometryType,i(r,s+1,0,t)}else y.indexCount+=e.indexCount},r._removeFromList=function(e){const t=e.symbolLevel,n=e.zOrder,o=this._getDisplayList(t,n,e.geometryType),r=o.length;let s;for(let t=0;t<r;++t){const n=o[t];if(e.indexFrom+e.indexCount>n.indexFrom&&e.indexFrom<n.indexFrom+n.indexCount&&(!this.unified||n.geometryType===e.geometryType)){s=t;break}}if(void 0!==s){const t=o[s];if(e.indexFrom===t.indexFrom)return t.indexCount-=e.indexCount,t.indexFrom+=e.indexCount,0===t.indexCount&&i(o,s,1),s-1;if(e.indexFrom+e.indexCount===t.indexFrom+t.indexCount)return t.indexCount-=e.indexCount,0===t.indexCount?(i(o,s,1),s-1):s;{const n=t.indexFrom,r=e.indexFrom-t.indexFrom,y=e.indexCount,m=t.indexFrom+t.indexCount-(e.indexFrom+e.indexCount);t.indexCount=r;const u=new l;return u.geometryType=t.geometryType,u.materialKey=t.materialKey,u.indexFrom=n+r+y,u.indexCount=m,i(o,s+1,0,u),s}}return null},r._getDisplayList=function(e,t,o){let i;const r=this.symbolLevels.length;for(let t=0;t<r;t++)if(this.symbolLevels[t].symbolLevel===e){i=this.symbolLevels[t];break}let s;i||(i=new u,i.symbolLevel=e,this.symbolLevels.push(i));const l=i.zLevels.length;for(let e=0;e<l;e++)if(i.zLevels[e].zLevel===t){s=i.zLevels[e];break}let f;if(s||(s=new m,s.geometryDPInfo=new y,s.zLevel=t,i.zLevels.push(s)),this.unified)s.geometryDPInfo.unified||(s.geometryDPInfo.unified=[]),f=s.geometryDPInfo.unified;else switch(o){case n.WGLGeometryType.FILL:s.geometryDPInfo.fill||(s.geometryDPInfo.fill=[]),f=s.geometryDPInfo.fill;break;case n.WGLGeometryType.LINE:s.geometryDPInfo.line||(s.geometryDPInfo.line=[]),f=s.geometryDPInfo.line;break;case n.WGLGeometryType.MARKER:s.geometryDPInfo.marker||(s.geometryDPInfo.marker=[]),f=s.geometryDPInfo.marker;break;case n.WGLGeometryType.TEXT:s.geometryDPInfo.text||(s.geometryDPInfo.text=[]),f=s.geometryDPInfo.text;break;case n.WGLGeometryType.LABEL:s.geometryDPInfo.label||(s.geometryDPInfo.label=[]),f=s.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+o+"'.")}return f},r.getDPInfoType=function(e){if(this.unified)return"unified";switch(e){case n.WGLGeometryType.FILL:return"fill";case n.WGLGeometryType.LINE:return"line";case n.WGLGeometryType.MARKER:return"marker";case n.WGLGeometryType.TEXT:return"text";case n.WGLGeometryType.LABEL:return"label";default:return void o.error(`DisplayList: Tried to convert unknown geometryType: ${e}`)}},e._createClass(t,[{key:"empty",get:function(){return!this.symbolLevels||0===this.symbolLevels.length}}]),t}(),l=function(){function e(){this.materialKey=null,this.indexFrom=0,this.indexCount=0}return e.prototype.clone=function(){const t=new e;return t.geometryType=this.geometryType,t.materialKey=this.materialKey,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t},e}(),y=function(){function e(){this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}return e.prototype.clone=function(){const t=new e;return t.fill=this.fill&&this.fill.map((e=>e.clone())),t.line=this.line&&this.line.map((e=>e.clone())),t.marker=this.marker&&this.marker.map((e=>e.clone())),t.text=this.text&&this.text.map((e=>e.clone())),t.label=this.label&&this.label.map((e=>e.clone())),t.unified=this.unified&&this.unified.map((e=>e.clone())),t},e}(),m=function(){function e(){this.geometryDPInfo=new y}return e.prototype.clone=function(){const t=new e;return t.zLevel=this.zLevel,t.geometryDPInfo=this.geometryDPInfo.clone(),t},e}(),u=function(){function e(){this.zLevels=[]}return e.prototype.clone=function(){const t=new e;t.symbolLevel=this.symbolLevel;for(const e of this.zLevels)t.zLevels.push(e.clone());return t},e}();return s}));
