/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../../core/maybe","../../../../chunks/mat3f32","../brushes","../Container","./ClippingInfo","./enums"],(function(e,r,n,t,s,i,a,o){"use strict";let c=function(r){function i(){var e;return(e=r.apply(this,arguments)||this).name=e.constructor.name,e}e._inheritsLoose(i,r);var c=i.prototype;return c.beforeRender=function(e){r.prototype.beforeRender.call(this,e),this.updateTransforms(e.state)},c._createTransforms=function(){return{dvs:t.create()}},c.doRender=function(e){const r=this.createRenderParams(e),{painter:n,globalOpacity:t,profiler:s,drawPhase:i}=r,a=i===o.WGLDrawPhase.LABEL||i===o.WGLDrawPhase.HIGHLIGHT?1:t*this.computedOpacity;s.recordContainerStart(this.name),n.beforeRenderLayer(r,this._clippingInfos?255:0,a),this.renderChildren(r),n.compositeLayer(r,a),s.recordContainerEnd()},c.renderChildren=function(e){n.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(e.painter));for(const n of this._renderPasses)try{n.render(e)}catch(r){}},c.createRenderParams=function(e){return e.requireFBO=this.requiresDedicatedFBO,e},c.prepareRenderPasses=function(e){return[e.registerRenderPass({name:"clip",brushes:[s.brushes.clip],target:()=>this._clippingInfos,drawPhase:o.WGLDrawPhase.MAP|o.WGLDrawPhase.LABEL|o.WGLDrawPhase.LABEL_ALPHA|o.WGLDrawPhase.DEBUG|o.WGLDrawPhase.HIGHLIGHT})]},c.updateTransforms=function(e){for(const r of this.children)r.setTransform(e)},c.onAttach=function(){r.prototype.onAttach.call(this),this._updateClippingInfo()},c.onDetach=function(){r.prototype.onDetach.call(this),this._updateClippingInfo()},c._updateClippingInfo=function(){n.isSome(this._clippingInfos)&&(this._clippingInfos.forEach((e=>e.destroy())),this._clippingInfos=null);const e=this.stage;if(!e)return;const r=this._clips;n.isSome(r)&&r.length&&(this._clippingInfos=r.items.map((r=>a.fromClipArea(e,r)))),this.requestRender()},e._createClass(i,[{key:"clips",set:function(e){this._clips=e,this.children.forEach((r=>r.clips=e)),this._updateClippingInfo()}}]),i}(i.Container);return c}));
