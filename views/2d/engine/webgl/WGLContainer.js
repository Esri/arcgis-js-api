/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../../core/maybe","./enums","../Container","../brushes","./ClippingInfo"],(function(e,n,r,s,t,i,a){"use strict";return function(n){function t(){var e;return(e=n.apply(this,arguments)||this).name=e.constructor.name,e}e._inheritsLoose(t,n);var o=t.prototype;return o.doRender=function(e){const n=this.createRenderParams(e),{painter:r,globalOpacity:t,profiler:i,drawPhase:a}=n,o=a===s.WGLDrawPhase.LABEL?1:t*this.computedOpacity;i.recordContainerStart(this.name),r.beforeRenderLayer(n,this._clippingInfos?255:0,o),this.updateTransforms(e.state),this.renderChildren(n),r.compositeLayer(n,o),i.recordContainerEnd()},o.renderChildren=function(e){r.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(e.painter));for(const n of this.children)n.beforeRender(e);for(const n of this._renderPasses)try{n.render(e)}catch(e){}for(const n of this.children)n.afterRender(e)},o.createRenderParams=function(e){return e},o.prepareRenderPasses=function(e){return[e.registerRenderPass({name:"clip",brushes:[i.brushes.clip],target:()=>this._clippingInfos,drawPhase:s.WGLDrawPhase.MAP|s.WGLDrawPhase.LABEL|s.WGLDrawPhase.LABEL_ALPHA|s.WGLDrawPhase.DEBUG|s.WGLDrawPhase.HIGHLIGHT})]},o.updateTransforms=function(e){for(const n of this.children)n.setTransform(e)},o.onAttach=function(){n.prototype.onAttach.call(this),this._updateClippingInfo()},o.onDetach=function(){n.prototype.onDetach.call(this),this._updateClippingInfo()},o._updateClippingInfo=function(){if(r.isSome(this._clippingInfos)&&(this._clippingInfos.forEach((e=>e.destroy())),this._clippingInfos=null),!this.stage)return;const e=this._clips;r.isSome(e)&&e.length&&(this._clippingInfos=e.items.map((e=>a.fromClipArea(this.stage,e)))),this.requestRender()},e._createClass(t,[{key:"clips",set:function(e){this._clips=e,this.children.forEach((n=>n.clips=e)),this._updateClippingInfo()}}]),t}(t.Container)}));
