/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../../core/has","../../../../core/maybe","../../../../core/mathUtils","../../../../chunks/builtins","../../../webgl/checkWebGLError","../../../webgl/FramebufferObject","../../../webgl/ProgramCache","./enums","./shaders/MaterialPrograms"],(function(r,e,t,a,o,s,i,n,h){"use strict";const g=r=>r===n.WGLDrawPhase.HITTEST||r===n.WGLDrawPhase.LABEL_ALPHA,m=r=>(g(r)?1:0)|(r===n.WGLDrawPhase.HIGHLIGHT?2:0),c=({rendererInfo:r,drawPhase:t},a,o,s)=>`${a.getVariationHash()}-${s.join(".")}-${m(t)}-${r.getVariationHash()}-${e.isSome(o)&&o.join(".")}`,u=(r,t,a,o)=>{const s=o.reduce(((e,t)=>({...e,[t]:r.driverTestResult[t]})),{}),i={...t.getVariation(),...r.rendererInfo.getVariation(),highlight:r.drawPhase===n.WGLDrawPhase.HIGHLIGHT,id:g(r.drawPhase),...s};if(e.isSome(a))for(const e of a)i[e]=!0;return i};return function(){function r(r){this._programByKey=new Map,this._programCache=new i(r)}var e=r.prototype;return e.dispose=function(){this._programCache&&this._programCache.dispose()},e.getProgram=function(r,e,t=[],a=[]){const o=e.vsPath+"."+e.fsPath+JSON.stringify(t)+a.join(".");if(this._programByKey.has(o))return this._programByKey.get(o);const s=a.reduce(((e,t)=>({...e,[t]:r.driverTestResult[t]})),{}),i={...t.map((r=>"string"==typeof r?{name:r,value:!0}:r)).reduce(((r,e)=>({...r,[e.name]:e.value})),{}),...s},{vsPath:n,fsPath:g,attributes:m}=e,c=this._programCache.getProgram(h.createProgramTemplate(n,g,m),i);if(!c)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(o,c),c},e.getMaterialProgram=function(r,e,t,a,o,s=["ignoresSamplerPrecision"]){const i=c(r,e,o,s);if(this._programByKey.has(i))return this._programByKey.get(i);const n=u(r,e,o,s),g=this._programCache.getProgram(h.createProgramTemplate(t,t,a),n);if(!g)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(i,g),g},r}()}));
