/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../core/has","../../../../core/Logger","../../../../core/Error","../../../../core/mathUtils","../../../../core/screenUtils","../../../../chunks/builtins","../../../webgl/checkWebGLError","../../../webgl/Texture","../../../webgl/FramebufferObject","./enums","./color","./SymbolProperties"],(function(e,t,r,n,o,s,a,i,c,u,y,l,f){"use strict";const p=r.getLogger("esri.views.2d.engine.webgl.Utils"),d="geometry",T="per_instance",m="per_instance_vv",E=[{name:d,strideInBytes:32,divisor:0}],_=[{name:d,strideInBytes:32,divisor:0}],L=[{name:d,strideInBytes:12,divisor:0}],g=[{name:d,strideInBytes:36,divisor:0}],h=[{name:d,strideInBytes:32,divisor:0}],w=[{name:d,strideInBytes:36,divisor:0}];function C(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const G=C(E),I=C(_),v=C(L),A=C(g),D=C(h),F=C(w);function P(e,t){switch(e){case y.WGLGeometryType.MARKER:return G;case y.WGLGeometryType.FILL:return t?v:I;case y.WGLGeometryType.LINE:return A;case y.WGLGeometryType.TEXT:return D;case y.WGLGeometryType.LABEL:return F}}const R=[d],b=[d],V=[d],B=[d],x=[d];function S(e){switch(e){case y.WGLGeometryType.MARKER:return R;case y.WGLGeometryType.FILL:return b;case y.WGLGeometryType.LINE:return V;case y.WGLGeometryType.TEXT:return B;case y.WGLGeometryType.LABEL:return x}}function O(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function W(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function M(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function N(e){return f.TextProperties.pool.acquire(e.color?l.copyAndPremultiply(e.color):[255,255,255,255],e.haloColor?l.copyAndPremultiply(e.haloColor):[255,255,255,255],s.pt2px(e.haloSize),s.pt2px(e.font.size),e.angle*Math.PI/180,e.xoffset/e.font.size,e.yoffset/e.font.size,"left"===e.horizontalAlignment?0:"right"===e.horizontalAlignment?1:.5,"top"===e.verticalAlignment?0:"bottom"===e.verticalAlignment?1:.5)}function U(e){return null!=e}function X(e){return"number"==typeof e}function z(e,t){switch(e){case"butt":return 0;case"round":return t?2:1;case"square":return 2;default:return p.error(new n("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),1}}function $(e){switch(e){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return p.error(new n("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),1}}function k(e){switch(e){case"opacity":return y.VVType.OPACITY;case"color":return y.VVType.COLOR;case"rotation":return y.VVType.ROTATION;case"size":return y.VVType.SIZE;default:return p.error(`Cannot interpret unknown vv: ${e}`),null}}function K(e){const{transform:t,hasZ:r,hasM:n}=e;return{transform:t,hasZ:r,hasM:n}}function Z(e,t,r,n,o,s,a){for(const c in s){const t=s[c].stride,n=O(t),a=s[c].data,i=r[c].data,u=t*o.vertexCount/n,y=t*e/n,l=t*o.vertexFrom/n;for(let e=0;e<u;++e)i[e+y]=a[e+l]}const i=o.indexCount;for(let c=0;c<i;++c)n[c+t]=a[c+o.indexFrom]-o.vertexFrom+e}const j={[d]:35044};function q(e,t){const r=[];for(let n=0;n<5;++n){const o=S(n),s={};for(const e of o)s[e]={data:t(n,e)};r.push({data:e(n),buffers:s})}return r}function J(e,t){let r,n;return o.isPowerOfTwo(t.width)&&o.isPowerOfTwo(t.height)?(r=!0,n=9987):(r=!1,n=9729),new c(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:r,samplingMode:n,wrapMode:33071,flipped:!0},t)}function Y(e){return{vertexFrom:void 0,vertexTo:void 0,geometry:e}}function H(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function Q(e){switch(e){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void p.error(new n("webgl-utils",`Unable to handle type ${e}`))}}function ee(e){switch(e){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void p.error(new n("webgl-utils",`Unable to handle type ${e}`))}}function te(e){const t={};for(const r in e){const n=e[r];let o=0;t[r]=n.map((e=>{const t={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:o,stride:0};return o+=e.count*H(e.type),t})),t[r].forEach((e=>e.stride=o))}return t}const re=e=>{const t={};for(const r in e)for(const n of e[r])t[n.name]=n.location;return t},ne=e=>{const t={};for(const r in e){const n=e[r];t[r]=n.length?n[0].stride:0}return t},oe=new Map,se=(e,t)=>{if(!oe.has(e)){const r=te(t),n={strides:ne(r),bufferLayouts:r,attributes:re(t)};oe.set(e,n)}return oe.get(e)};function ae(e){e(y.WGLGeometryType.MARKER),e(y.WGLGeometryType.FILL),e(y.WGLGeometryType.LINE),e(y.WGLGeometryType.TEXT),e(y.WGLGeometryType.LABEL)}e.C_FILL_STRIDE_SPEC=I,e.C_FILL_STRIDE_SPEC_DD=v,e.C_FILL_VERTEX_DEF=_,e.C_FILL_VERTEX_DEF_DD=L,e.C_ICON_STRIDE_SPEC=G,e.C_ICON_VERTEX_DEF=E,e.C_LABEL_STRIDE_SPEC=F,e.C_LABEL_VERTEX_DEF=w,e.C_LINE_STRIDE_SPEC=A,e.C_LINE_VERTEX_DEF=g,e.C_TEXT_STRIDE_SPEC=D,e.C_TEXT_VERTEX_DEF=h,e.C_VBO_GEOMETRY=d,e.C_VBO_INFO=j,e.C_VBO_PERINSTANCE=T,e.C_VBO_PERINSTANCE_VV=m,e.allocateTypedArrayBuffer=W,e.allocateTypedArrayBufferwithData=M,e.copyMeshData=Z,e.createGeometryData=q,e.createProgramDescriptor=se,e.createTextureFromTexelData=J,e.forEachGeometryType=ae,e.geometryToMappedGeometry=Y,e.getBytes=H,e.getCapType=z,e.getJoinType=$,e.getNamedBuffers=S,e.getPixelArrayCtor=ee,e.getPixelBytes=Q,e.getStrides=P,e.getTextProperties=N,e.getTransformParams=K,e.getVVType=k,e.isDefined=U,e.isNumber=X,e.strideToPackingFactor=O,Object.defineProperty(e,"__esModule",{value:!0})}));
