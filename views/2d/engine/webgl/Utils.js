/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../core/has","../../../../core/Logger","../../../../core/Error","../../../../core/mathUtils","../../../../core/screenUtils","../../../../chunks/builtins","../../../webgl/Texture","../../../webgl/FramebufferObject","../../../webgl/RenderingContext","./enums","./color","./SymbolProperties"],(function(e,t,r,n,o,s,a,i,c,u,l,f,y){"use strict";const p=r.getLogger("esri.views.2d.engine.webgl.Utils"),d="geometry",m=[{name:d,strideInBytes:32,divisor:0}],T=[{name:d,strideInBytes:32,divisor:0}],E=[{name:d,strideInBytes:12,divisor:0}],_=[{name:d,strideInBytes:36,divisor:0}],g=[{name:d,strideInBytes:32,divisor:0}],h=[{name:d,strideInBytes:36,divisor:0}];function w(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const L=w(m),C=w(T),v=w(E),I=w(_),A=w(g),D=w(h);const F=[d],G=[d],P=[d],R=[d],V=[d];function b(e){switch(e){case l.WGLGeometryType.MARKER:return F;case l.WGLGeometryType.FILL:return G;case l.WGLGeometryType.LINE:return P;case l.WGLGeometryType.TEXT:return R;case l.WGLGeometryType.LABEL:return V}}function x(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}const B={[d]:35044};function S(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}const O=new Map;e.C_FILL_STRIDE_SPEC=C,e.C_FILL_STRIDE_SPEC_DD=v,e.C_FILL_VERTEX_DEF=T,e.C_FILL_VERTEX_DEF_DD=E,e.C_ICON_STRIDE_SPEC=L,e.C_ICON_VERTEX_DEF=m,e.C_LABEL_STRIDE_SPEC=D,e.C_LABEL_VERTEX_DEF=h,e.C_LINE_STRIDE_SPEC=I,e.C_LINE_VERTEX_DEF=_,e.C_TEXT_STRIDE_SPEC=A,e.C_TEXT_VERTEX_DEF=g,e.C_VBO_GEOMETRY=d,e.C_VBO_INFO=B,e.C_VBO_PERINSTANCE="per_instance",e.C_VBO_PERINSTANCE_VV="per_instance_vv",e.allocateTypedArrayBuffer=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}},e.allocateTypedArrayBufferwithData=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}},e.copyMeshData=function(e,t,r,n,o,s,a){for(const t in s){const n=s[t].stride,a=x(n),i=s[t].data,c=r[t].data,u=n*o.vertexCount/a,l=n*e/a,f=n*o.vertexFrom/a;for(let e=0;e<u;++e)c[e+l]=i[e+f]}const i=o.indexCount;for(let r=0;r<i;++r)n[r+t]=a[r+o.indexFrom]-o.vertexFrom+e},e.createGeometryData=function(e,t){const r=[];for(let n=0;n<5;++n){const o=b(n),s={};for(const e of o)s[e]={data:t(n,e)};r.push({data:e(n),buffers:s})}return r},e.createProgramDescriptor=(e,t)=>{if(!O.has(e)){const r=function(e){const t={};for(const r in e){const n=e[r];let o=0;t[r]=n.map((e=>{const t={...e,normalized:e.normalized||!1,divisor:e.divisor||0,offset:o,stride:0};return o+=e.count*S(e.type),t})),t[r].forEach((e=>e.stride=o))}return t}(t),n={strides:(e=>{const t={};for(const r in e){const n=e[r];t[r]=n.length?n[0].stride:0}return t})(r),bufferLayouts:r,attributes:(e=>{const t={};for(const r in e)for(const n of e[r])t[n.name]=n.location;return t})(t)};O.set(e,n)}return O.get(e)},e.createTextureFromTexelData=function(e,t){let r,n;return o.isPowerOfTwo(t.width)&&o.isPowerOfTwo(t.height)?(r=!0,n=9987):(r=!1,n=9729),new i(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:r,samplingMode:n,wrapMode:33071,flipped:!0},t)},e.geometryToMappedGeometry=function(e){return{vertexFrom:void 0,vertexTo:void 0,geometry:e}},e.getBytes=S,e.getCapType=function(e,t){switch(e){case"butt":return 0;case"round":return t?2:1;case"square":return 2;default:return p.error(new n("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),1}},e.getJoinType=function(e){switch(e){case"miter":return 2;case"bevel":return 0;case"round":return 1;default:return p.error(new n("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),1}},e.getNamedBuffers=b,e.getPixelArrayCtor=function(e){switch(e){case 5121:return Uint8Array;case 32819:return Uint16Array;case 5126:return Float32Array;default:return void p.error(new n("webgl-utils",`Unable to handle type ${e}`))}},e.getPixelBytes=function(e){switch(e){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:return void p.error(new n("webgl-utils",`Unable to handle type ${e}`))}},e.getStrides=function(e,t){switch(e){case l.WGLGeometryType.MARKER:return L;case l.WGLGeometryType.FILL:return t?v:C;case l.WGLGeometryType.LINE:return I;case l.WGLGeometryType.TEXT:return A;case l.WGLGeometryType.LABEL:return D}},e.getTextProperties=function(e){return y.TextProperties.pool.acquire(e.color?f.copyAndPremultiply(e.color):[255,255,255,255],e.haloColor?f.copyAndPremultiply(e.haloColor):[255,255,255,255],s.pt2px(e.haloSize),s.pt2px(e.font.size),e.angle*Math.PI/180,e.xoffset/e.font.size,e.yoffset/e.font.size,"left"===e.horizontalAlignment?0:"right"===e.horizontalAlignment?1:.5,"top"===e.verticalAlignment?0:"bottom"===e.verticalAlignment?1:.5)},e.getTransformParams=function(e){const{transform:t,hasZ:r,hasM:n}=e;return{transform:t,hasZ:r,hasM:n}},e.getVVType=function(e){switch(e){case"opacity":return l.VVType.OPACITY;case"color":return l.VVType.COLOR;case"rotation":return l.VVType.ROTATION;case"size":return l.VVType.SIZE;default:return p.error(`Cannot interpret unknown vv: ${e}`),null}},e.isDefined=function(e){return null!=e},e.isNumber=function(e){return"number"==typeof e},e.strideToPackingFactor=x,Object.defineProperty(e,"__esModule",{value:!0})}));
