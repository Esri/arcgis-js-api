/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Error","../../../../core/Logger","../../../../symbols/cim/enums","./enums","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],(function(e,t,r,n,a,i,s){"use strict";const o=r.getLogger("esri.views.2d.engine.webgl.Utils"),c="geometry",u=[{name:c,strideInBytes:12}],y=[{name:c,strideInBytes:36}],l=[{name:c,strideInBytes:24}],p=[{name:c,strideInBytes:12}],T=[{name:c,strideInBytes:40}],m=[{name:c,strideInBytes:36}],d=[{name:c,strideInBytes:36}];function f(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const g=f([{name:c,strideInBytes:36}]),S=f(u),L=f(y),G=f(l),I=f(p),D=f(T),h=f(m),w=f(d);function E(e,t){switch(e){case a.WGLGeometryType.MARKER:return t===a.WGLSymbologyType.HEATMAP?S:g;case a.WGLGeometryType.FILL:switch(t){case a.WGLSymbologyType.DOT_DENSITY:return I;case a.WGLSymbologyType.SIMPLE:case a.WGLSymbologyType.OUTLINE_FILL_SIMPLE:return G;default:return L}case a.WGLGeometryType.LINE:return D;case a.WGLGeometryType.TEXT:return h;case a.WGLGeometryType.LABEL:return w}}const N=[c],A=[c],M=[c],U=[c],P=[c];function C(e){switch(e){case a.WGLGeometryType.MARKER:return N;case a.WGLGeometryType.FILL:return A;case a.WGLGeometryType.LINE:return M;case a.WGLGeometryType.TEXT:return U;case a.WGLGeometryType.LABEL:return P}}function B(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function b(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function R(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function V(e){return null!=e}function W(e){return"number"==typeof e}function O(e){switch(e){case"butt":return n.CapType.BUTT;case"round":return n.CapType.ROUND;case"square":return n.CapType.SQUARE;default:return o.error(new t("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),n.CapType.ROUND}}function _(e){switch(e){case"miter":return n.JoinType.MITER;case"bevel":return n.JoinType.BEVEL;case"round":return n.JoinType.ROUND;default:return o.error(new t("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),n.JoinType.ROUND}}function v(e){switch(e){case"opacity":return a.VVType.OPACITY;case"color":return a.VVType.COLOR;case"rotation":return a.VVType.ROTATION;case"size":return a.VVType.SIZE;default:return o.error(`Cannot interpret unknown vv: ${e}`),null}}function x(e,t,r,n,a,i,s){for(const o in i){const t=i[o].stride,n=B(t),s=i[o].data,c=r[o].data;if(null==s||null==c)continue;const u=t*a.vertexCount/n,y=t*e/n,l=t*a.vertexFrom/n;for(let e=0;e<u;++e)c[e+y]=s[e+l]}if(null!=s&&null!=n){const r=a.indexCount;for(let i=0;i<r;++i)n[i+t]=s[i+a.indexFrom]-a.vertexFrom+e}}const F={[c]:i.Usage.STATIC_DRAW};function z(e,t){const r=[];for(let n=0;n<5;++n){const a=C(n),i={};for(const e of a)i[e]={data:t(n,e)};r.push({data:e(n),buffers:i})}return r}function k(e){switch(e){case i.DataType.BYTE:case i.DataType.UNSIGNED_BYTE:return 1;case i.DataType.SHORT:case i.DataType.UNSIGNED_SHORT:return 2;case i.DataType.FLOAT:case i.DataType.INT:case i.DataType.UNSIGNED_INT:return 4}}function $(e){switch(e){case i.PixelType.UNSIGNED_BYTE:return 1;case i.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case i.PixelType.FLOAT:return 4;default:return void o.error(new t("webgl-utils",`Unable to handle type ${e}`))}}function J(e){switch(e){case i.PixelType.UNSIGNED_BYTE:return Uint8Array;case i.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case i.PixelType.FLOAT:return Float32Array;default:return void o.error(new t("webgl-utils",`Unable to handle type ${e}`))}}function Y(e){const t={};for(const r in e){const n=e[r];let a=0;t[r]=n.map((e=>{const t=new s.VertexElementDescriptor(e.name,e.count,e.type,a,0,e.normalized||!1);return a+=e.count*k(e.type),t})),t[r]?.forEach((e=>e.stride=a))}return t}const H=e=>{const t=new Map;for(const r in e)for(const n of e[r])t.set(n.name,n.location);return t},q=e=>{const t={};for(const r in e){const n=e[r];t[r]=n?.length?n[0].stride:0}return t},K=new Map,X=(e,t)=>{if(!K.has(e)){const r=Y(t),n={strides:q(r),bufferLayouts:r,attributes:H(t)};K.set(e,n)}return K.get(e)};function j(e){e(a.WGLGeometryType.FILL),e(a.WGLGeometryType.LINE),e(a.WGLGeometryType.MARKER),e(a.WGLGeometryType.TEXT),e(a.WGLGeometryType.LABEL)}const Q=e=>"path"in e&&le(e.path),Z=e=>"url"in e&&e.url||"imageData"in e&&e.imageData,ee=e=>"imageData"in e&&e.imageData&&"contentType"in e&&e.contentType?`data:${e.contentType};base64,${e.imageData}`:"url"in e?e.url:null,te=e=>null!=e&&e.startsWith("data:image/gif"),re=e=>"url"in e&&e.url&&(e.url.includes(".gif")||te(e.url))||"contentType"in e&&"image/gif"===e.contentType||"imageData"in e&&te(e.imageData),ne=e=>null!=e&&e.startsWith("data:image/png"),ae=e=>"url"in e&&e.url&&(e.url.includes(".png")||ne(e.url))||"contentType"in e&&"image/png"===e.contentType||"imageData"in e&&ne(e.imageData),ie=e=>e.type&&e.type.toLowerCase().includes("3d");function se(e){switch(e.type){case"line":{const t=e;return"CIMSolidStroke"===t.cim.type&&!t.dashTemplate}case"fill":return"CIMSolidFill"===e.cim.type;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}const oe=e=>e.includes("data:image/svg+xml");function ce(e){switch("cim"in e?e.cim.type:e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":return!1;case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":return pe(e);default:return!0}}function ue(e){const t="maxVVSize"in e&&e.maxVVSize,r="width"in e&&e.width||"size"in e&&e.size||0;return t||r}function ye(e){const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t}const le=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4)),pe=e=>"fill"===e.type&&"CIMMarkerPlacementInsidePolygon"===e?.cim?.markerPlacement?.type;e.C_VBO_INFO=F,e.allocateTypedArrayBuffer=b,e.allocateTypedArrayBufferwithData=R,e.charCodes=ye,e.copyMeshData=x,e.createGeometryData=z,e.createProgramDescriptor=X,e.forEachGeometryType=j,e.getBytes=k,e.getCapType=O,e.getJoinType=_,e.getNamedBuffers=C,e.getPMSResourceSize=ue,e.getPixelArrayCtor=J,e.getPixelBytes=$,e.getStrides=E,e.getUrl=ee,e.getVVType=v,e.is3D=ie,e.isDefined=V,e.isGIF=re,e.isGIFDataUri=te,e.isImageResource=Z,e.isMarkerPlacementInsidePolygon=pe,e.isNumber=W,e.isPNG=ae,e.isPNGDataUri=ne,e.isSVGImage=oe,e.isSVGResource=Q,e.isSimple=se,e.isValidSVG=le,e.shouldRepeat=ce,e.strideToPackingFactor=B,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
