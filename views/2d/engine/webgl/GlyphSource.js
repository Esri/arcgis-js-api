/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../core/promiseUtils","../../../../request","../../../../core/pbf"],(function(t,e,n){"use strict";let r=function(){function t(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const t=e.getMessage();let n,r,a,s,i,c,o;for(;t.next();)switch(t.tag()){case 1:n=t.getUInt32();break;case 2:r=t.getBytes();break;case 3:a=t.getUInt32();break;case 4:s=t.getUInt32();break;case 5:i=t.getSInt32();break;case 6:c=t.getSInt32();break;case 7:o=t.getUInt32();break;default:t.skip()}t.release(),n&&(this._metrics[n]={width:a,height:s,left:i,top:c,advance:o},this._bitmaps[n]=r);break}default:e.skip()}e.release();break}default:t.skip()}}var e=t.prototype;return e.getMetrics=function(t){return this._metrics[t]},e.getBitmap=function(t){return this._bitmaps[t]},t}(),a=function(){function t(){this._ranges=[]}var e=t.prototype;return e.getRange=function(t){return this._ranges[t]},e.addRange=function(t,e){this._ranges[t]=e},t}();return function(){function s(t){this._glyphInfo={},this._baseURL=t}var i=s.prototype;return i.getRange=function(a,s,i){const c=this._getFontStack(a);if(c.getRange(s))return t.resolve();const o=256*s,g=o+255,f=this._baseURL.replace("{fontstack}",a).replace("{range}",o+"-"+g);return e(f,{responseType:"array-buffer",...i}).then((t=>{c.addRange(s,new r(new n(new Uint8Array(t.data),new DataView(t.data))))}))},i.getGlyph=function(t,e){const n=this._getFontStack(t);if(!n)return;const r=Math.floor(e/256);if(r>256)return;const a=n.getRange(r);return a?{metrics:a.getMetrics(e),bitmap:a.getBitmap(e)}:void 0},i._getFontStack=function(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new a),e},s}()}));
