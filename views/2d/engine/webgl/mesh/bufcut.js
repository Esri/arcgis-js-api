// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports"],(function(e,n){"use strict";function r(e,n,r,t,x,i,u){var y;if(u===function(e,n,r,t,x,i){for(var u=0,v=t,f=x-i;v<x;v+=i)u+=(e[f+n*i]-e[v+n*i])*(e[v+1+n*i]+e[f+1+n*i]),f=v;return u}(e,n,0,t,x,i)>0)for(var o=t;o<x;o+=i)y=v(o+n*i,e[o+n*i],e[o+1+n*i],y);else for(o=x-i;o>=t;o-=i)y=v(o+n*i,e[o+n*i],e[o+1+n*i],y);return y&&h(y,y.next)&&(f(y),y=y.next),y}function t(e,n){if(void 0===n&&(n=e),!e)return e;var r,t=e;do{if(r=!1,t.steiner||!h(t,t.next)&&0!==p(t.prev,t,t.next))t=t.next;else{if(f(t),(t=n=t.prev)===t.next)break;r=!0}}while(r||t!==n);return n}function x(e,n,r,v,y,o,p,a){if(e){!a&&o&&(e=function e(n,r,t,x){for(var i=void 0;i!==n;i=i.next){if(null===(i=i||n).z&&(i.z=d(i.x,i.y,r,t,x)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,e(n,r,t,x);i.prevZ=i.prev,i.nextZ=i.next}return n.prevZ.nextZ=null,n.prevZ=null,function(e){var n,r=1;for(;;){var t=e,x=void 0;e=null,n=null;for(var i=0;t;){i++,x=t;for(var u=0;u<r&&x;u++)x=x.nextZ;for(var v=r;u>0||v>0&&x;){var f=void 0;0===u?(f=x,x=x.nextZ,v--):0!==v&&x?t.z<=x.z?(f=t,t=t.nextZ,u--):(f=x,x=x.nextZ,v--):(f=t,t=t.nextZ,u--),n?n.nextZ=f:e=f,f.prevZ=n,n=f}t=x}if(n.nextZ=null,r*=2,i<2)return e}}(n)}(e,v,y,o));for(var l=e;e.prev!==e.next;){var c=e.prev,h=e.next;if(o?u(e,v,y,o):i(e))n.push(c.index/r+p),n.push(e.index/r+p),n.push(h.index/r+p),f(e),e=h.next,l=h.next;else if((e=h)===l){a?1===a?x(e=s(e,n,r,p),n,r,v,y,o,p,2):2===a&&w(e,n,r,v,y,o,p):x(t(e),n,r,v,y,o,p,1);break}}}}function i(e){var n=e.prev,r=e,t=e.next;if(p(n,r,t)>=0)return!1;for(var x=e.next.next,i=x,u=0;x!==e.prev&&(0===u||x!==i);){if(u++,l(n.x,n.y,r.x,r.y,t.x,t.y,x.x,x.y)&&p(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function u(e,n,r,t){var x=e.prev,i=e,u=e.next;if(p(x,i,u)>=0)return!1;for(var v=x.x<i.x?x.x<u.x?x.x:u.x:i.x<u.x?i.x:u.x,f=x.y<i.y?x.y<u.y?x.y:u.y:i.y<u.y?i.y:u.y,y=x.x>i.x?x.x>u.x?x.x:u.x:i.x>u.x?i.x:u.x,o=x.y>i.y?x.y>u.y?x.y:u.y:i.y>u.y?i.y:u.y,a=d(v,f,n,r,t),c=d(y,o,n,r,t),h=e.prevZ,Z=e.nextZ;h&&h.z>=a&&Z&&Z.z<=c;){if(h!==e.prev&&h!==e.next&&l(x.x,x.y,i.x,i.y,u.x,u.y,h.x,h.y)&&p(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,Z!==e.prev&&Z!==e.next&&l(x.x,x.y,i.x,i.y,u.x,u.y,Z.x,Z.y)&&p(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}for(;h&&h.z>=a;){if(h!==e.prev&&h!==e.next&&l(x.x,x.y,i.x,i.y,u.x,u.y,h.x,h.y)&&p(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;Z&&Z.z<=c;){if(Z!==e.prev&&Z!==e.next&&l(x.x,x.y,i.x,i.y,u.x,u.y,Z.x,Z.y)&&p(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}return!0}function v(e,n,r,t){var x=b.create(e,n,r);return t?(x.next=t.next,x.prev=t,t.next.prev=x,t.next=x):(x.prev=x,x.next=x),x}function f(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function y(e){var n=e,r=e;do{(n.x<r.x||n.x===r.x&&n.y<r.y)&&(r=n),n=n.next}while(n!==e);return r}function o(e,n){if(n=function(e,n){var r,t=n,x=e.x,i=e.y,u=-1/0;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var v=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(v<=x&&v>u){if(u=v,v===x){if(i===t.y)return t;if(i===t.next.y)return t.next}r=t.x<t.next.x?t:t.next}}t=t.next}while(t!==n);if(!r)return null;if(x===u)return r.prev;var f,y=r,o=r.x,p=r.y,a=1/0;t=r.next;for(;t!==y;)x>=t.x&&t.x>=o&&x!==t.x&&l(i<p?x:u,i,o,p,i<p?u:x,i,t.x,t.y)&&((f=Math.abs(i-t.y)/(x-t.x))<a||f===a&&t.x>r.x)&&c(t,e)&&(r=t,a=f),t=t.next;return r}(e,n)){var r=M(n,e);t(r,r.next)}}function p(e,n,r){return(n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y)}function a(e,n,r,t){return!!(h(e,n)&&h(r,t)||h(e,t)&&h(r,n))||p(e,n,r)>0!=p(e,n,t)>0&&p(r,t,e)>0!=p(r,t,n)>0}function l(e,n,r,t,x,i,u,v){return(x-u)*(n-v)-(e-u)*(i-v)>=0&&(e-u)*(t-v)-(r-u)*(n-v)>=0&&(r-u)*(i-v)-(x-u)*(t-v)>=0}function c(e,n){return p(e.prev,e,e.next)<0?p(e,n,e.next)>=0&&p(e,e.prev,n)>=0:p(e,n,e.prev)<0||p(e,e.next,n)<0}function d(e,n,r,t,x){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*x)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-t)*x)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function h(e,n){return e.x===n.x&&e.y===n.y}function Z(e,n){return e.x-n.x}function s(e,n,r,t){var x=e;do{var i=x.prev,u=x.next.next;!h(i,u)&&a(i,x,x.next,u)&&c(i,u)&&c(u,i)&&(n.push(i.index/r+t),n.push(x.index/r+t),n.push(u.index/r+t),f(x),f(x.next),x=e=u),x=x.next}while(x!==e);return x}function w(e,n,r,i,u,v,f){var y=e;do{for(var o=y.next.next;o!==y.prev;){if(y.index!==o.index&&z(y,o)){var p=M(y,o);return y=t(y,y.next),p=t(p,p.next),x(y,n,r,i,u,v,f,0),void x(p,n,r,i,u,v,f,0)}o=o.next}y=y.next}while(y!==e)}function z(e,n){return e.next.index!==n.index&&e.prev.index!==n.index&&!function(e,n){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==n.index&&r.next.index!==n.index&&a(r,r.next,e,n))return!0;r=r.next}while(r!==e);return!1}(e,n)&&c(e,n)&&c(n,e)&&function(e,n){var r=e,t=!1,x=(e.x+n.x)/2,i=(e.y+n.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&x<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(t=!t),r=r.next}while(r!==e);return t}(e,n)}function M(e,n){var r=b.create(e.index,e.x,e.y),t=b.create(n.index,n.x,n.y),x=e.next,i=n.prev;return e.next=n,n.prev=e,r.next=x,x.prev=r,t.next=r,r.prev=t,i.next=t,t.prev=i,t}Object.defineProperty(n,"__esModule",{value:!0}),n.bufcut=void 0,n.bufcut=function(e,n,i,u,v,f,p){g=0;var a=(u-i)*f,l=v&&v.length,c=l?(v[0]-i)*f:a,d=r(n,i,u,0,c,f,!0);if(d&&d.next!==d.prev){var h,s,w,z,M;if(l&&(d=function(e,n,x,i,u,v){for(var f=new Array,p=0,a=i.length;p<a;p++){var l=i[p]*v,c=p<a-1?i[p+1]*v:x*v,d=r(e,n,x,l,c,v,!1);d===d.next&&(d.steiner=!0),f.push(y(d))}f.sort(Z);for(var h=0,s=f;h<s.length;h++){o(s[h],u),u=t(u,u.next)}return u}(n,i,u,v,d,f)),a>80*f){h=w=n[0+i*f],s=z=n[1+i*f];for(var b=f;b<c;b+=f){var m=n[b+i*f],k=n[b+1+i*f];h=Math.min(h,m),s=Math.min(s,k),w=Math.max(w,m),z=Math.max(z,k)}M=0!==(M=Math.max(w-h,z-s))?1/M:0}x(d,e,f,h,s,M,p,0)}};for(var b=function(){function e(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return e.create=function(e,n,r){var t=m[g++];return t.index=e,t.x=n,t.y=r,t.prev=null,t.next=null,t.z=null,t.prevZ=null,t.nextZ=null,t.steiner=!1,t},e}(),m=new Array,g=0,k=0;k<8096;k++)m.push(new b)}));