// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../../../../../core/maybe","./util"],(function(t,e,n,r){function i(t,e){return t[e+1]}function s(t){return t.length-1}function o(t){for(var e=0,n=0;n<s(t);n++)e+=a(t,n);return e}function a(t,e,n){void 0===n&&(n=1);var r=i(t,e),s=r[0],o=r[1];return Math.sqrt(s*s+o*o)*n}Object.defineProperty(e,"__esModule",{value:!0}),e.segmentAt=i,e.segmentCount=s,e.pathLength=o,e.segmentLength=a;var h=function(){function t(t,e,n,r,i){this._segments=t,this._index=e,this._distance=n,this._xStart=r,this._yStart=i,this._done=!1}return t.create=function(e){return new t(e,0,0,e[0][0],e[0][1])},t.prototype.clone=function(){return new t(this._segments,this._index,this._distance,this.xStart,this.yStart)},t.prototype.equals=function(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)},t.prototype.leq=function(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance},t.prototype.geq=function(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance},Object.defineProperty(t.prototype,"_segment",{get:function(){return this._segments[this._index+1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){var t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length),n=Math.acos(e);return t>0&&(n=2*Math.PI-n),n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xStart",{get:function(){return this._xStart},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yStart",{get:function(){return this._yStart},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.xStart+this.distance*this.dx},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.yStart+this.distance*this.dy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._segment[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._segment[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xMidpoint",{get:function(){return this.xStart+.5*this.dx},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yMidpoint",{get:function(){return this.yStart+.5*this.dy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"xEnd",{get:function(){return this.xStart+this.dx},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"yEnd",{get:function(){return this.yStart+this.dy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){var t=this.dx,e=this.dy;return Math.sqrt(t*t+e*e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remainingLength",{get:function(){return this.length*(1-this._distance)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backwardLength",{get:function(){return this.length*this._distance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"done",{get:function(){return this._done},enumerable:!0,configurable:!0}),t.prototype.hasPrev=function(){return this._index-1>=0},t.prototype.hasNext=function(){return this._index+1<s(this._segments)},t.prototype.next=function(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null},t.prototype.prev=function(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)},t.prototype._seekBackwards=function(t,e){var n=this.backwardLength;if(t<=n)return this._distance=(n-t)/this.length,this;for(var r=this.backwardLength;this.prev();){if(r+this.length>t)return this._seekBackwards(t-r);r+=this.length}return this._distance=0,e?this:null},t.prototype.seek=function(t,e){if(void 0===e&&(e=!1),t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;for(var n=this.remainingLength;this.next();){if(n+this.length>t)return this.seek(t-n,e);n+=this.length}return this._distance=1,e?this:null},t}();function u(t,e){if(!(e<=0)){var n=t.length;if(!(n<3)){var i=[],s=0;i.push(0);for(var o=1;o<n;o++)s+=r.dist(t[o],t[o-1]),i.push(s);e=Math.min(e,.2*s);var a=[];a.push(t[0][0]),a.push(t[0][1]);var h=t[n-1][0],u=t[n-1][1],c=r.sub([0,0],t[0],t[1]);r.normalize(c),t[0][0]+=e*c[0],t[0][1]+=e*c[1],r.sub(c,t[n-1],t[n-2]),r.normalize(c),t[n-1][0]+=e*c[0],t[n-1][1]+=e*c[1];for(o=1;o<n;o++)i[o]+=e;i[n-1]+=e;var d=.5*e;for(o=1;o<n-1;o++){for(var f=0,p=0,g=0,l=o-1;l>=0&&!(i[l+1]<i[o]-d);l--){var y=d+i[l+1]-i[o],b=i[l+1]-i[l],_=i[o]-i[l]<d?1:y/b;if(Math.abs(_)<1e-6)break;var x=_*y-.5*(j=_*_)*b,v=_*b/e,m=t[l+1],P=t[l][0]-m[0],S=t[l][1]-m[1];f+=v/x*(m[0]*_*y+.5*j*(y*P-b*m[0])-j*_*b*P/3),p+=v/x*(m[1]*_*y+.5*j*(y*S-b*m[1])-j*_*b*S/3),g+=v}for(l=o+1;l<n&&!(i[l-1]>i[o]+d);l++){y=d-i[l-1]+i[o],b=i[l]-i[l-1],_=i[l]-i[o]<d?1:y/b;if(Math.abs(_)<1e-6)break;var j;x=_*y-.5*(j=_*_)*b,v=_*b/e,m=t[l-1],P=t[l][0]-m[0],S=t[l][1]-m[1];f+=v/x*(m[0]*_*y+.5*j*(y*P-b*m[0])-j*_*b*P/3),p+=v/x*(m[1]*_*y+.5*j*(y*S-b*m[1])-j*_*b*S/3),g+=v}a.push(f/g),a.push(p/g)}a.push(h),a.push(u);for(o=0,l=0;o<n;o++)t[o][0]=a[l++],t[o][1]=a[l++]}}}e.SegmentCursor=h,e.pathDivide=function(t,e,n){var r=o(t),i=h.create(t),s=r/2,a=(r-e)/2,u=Math.floor(a/e),c=s-u*e;i.seek(c);for(var d=-u;d<=u;d++)i.x<512&&i.x>=0&&i.y<512&&i.y>=0&&n(i.clone(),d,s+d*e,r),i.seek(e)},e.pathSubdivide=function(t,e,r){!function t(e,r,i,s,o){if(i<r)return;var a=s.clone().seek(i/2);if(n.isNone(a))return;e(a.clone(),i,o),i=(i-r)/2;var h=n.expect(a.seek(r/2));t(e,r,i,s,o+1),t(e,r,i,h,o+1)}(r,e,o(t),h.create(t),0)},e.smoothPaths=function(t,e){for(var n=e,r=0;r<t.length;r++){var i=t[r],s=[];s.push(i[0]);for(var o=1;o<i.length;o++){var a=s[o-1],h=a[0],c=a[1];h+=i[o][0],c+=i[o][1],s.push([h,c])}u(s,n);var d=[];d.push(s[0]);for(var f=1;f<s.length;f++){var p=s[f-1],g=p[0],l=p[1],y=s[f],b=(h=y[0],c=y[1],Math.round(h-g)),_=Math.round(c-l);d.push([b,_])}t[r]=d,i=d}return t}}));