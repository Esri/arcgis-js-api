/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{pt2px as t}from"../../../../../../core/screenUtils.js";import{premultiplyAlphaRGBAArray as e,premultiplyAlphaRGBA as r}from"../../color.js";import{MIN_MAX_ZOOM_PRECISION_FACTOR as i,BITSET_GENERIC_LOCK_COLOR as o,BITSET_FILL_RANDOM_PATTERN_OFFSET as s,BITSET_GENERIC_CONSIDER_ALPHA_ONLY as l,SPRITE_PADDING as a,PICTURE_FILL_COLOR as n}from"../../definitions.js";import{degToByte as m}from"../../GeometryUtils.js";import{i1616to32 as f,i8888to32 as c}from"../../number.js";import{FillMaterialKey as h}from"../../materialKey/MaterialKey.js";import{getMinMaxZoom as u,DEFAULT_MIN_ZOOM as d,DEFAULT_MAX_ZOOM as p}from"./util.js";import y from"./WGLBaseFillTemplate.js";import x from"./WGLMeshTemplate.js";const M=128;class j extends(y(x)){constructor(t,e,r,o,s,l,a,n,m,u,d,p,y,x,M,j){super(),this._effects=x;const w=h.load(t);e&&(w.sdf=e.sdf,w.pattern=!0,w.textureBinding=e.textureBinding),this.fillColor=r,this.tl=o,this.br=s,this.aux2_1=f(l,a),this.aux2_2=f(n,m),this.aux3=c(u,d,p,0),this._bitset=y,this._minMaxZoom=f(Math.round(M*i),Math.round(j*i)),this._materialKey=w.data}static fromCIMFill(e,i,n){const c=e.color,h=c&&r(c)||0,d=e.materialKey,[p,y]=u(e.scaleInfo,n),x=(e.colorLocked?o:0)|(e.applyRandomOffset?s:0)|(e.sampleAlphaOnly?l:0);if(!i)return new j(d,null,h,0,0,0,0,0,0,0,0,0,x,e.effects,p,y);const{rect:w,width:g,height:_}=i,K=e.scaleX||1,b=w.x+a,F=w.y+a,L=b+g,T=F+_,A=e.height,B=K*A;let G=Math.round(A);G<=0&&(G=T-F);let S=Math.round(B);S<=0&&(S=L-b);const C=t(e.offsetX||0),I=t(-e.offsetY||0),O=f(b,F),U=f(L,T);return new j(d,i,h,O,U,S,G,C,I,M,M,m(e.angle),x,e.effects,p,y)}static fromSimpleFill(t,r,i=!1){const{color:s}=t,l=s&&"esriSFSNull"!==t.style&&e(s)||0,n=i?o:0,m=t.materialKey;let c;if(r){const{rect:t,width:e,height:i}=r,o=t.x+a,s=t.y+a,h=o+e,u=s+i,y=f(o,s),x=f(h,u);c=new j(m,r,l,y,x,e,i,0,0,M,M,0,n,null,d,p)}else c=new j(m,null,l,0,0,0,0,0,0,0,0,0,n,null,d,p);return c._maybeAddLineTemplate(t),c}static fromPictureFill(e,r,i=!1){const s=n,{rect:l,width:m,height:c}=r,h=l.x+a,u=l.y+a,y=h+m,x=u+c,w=f(h,u),g=f(y,x),_=Math.round(t(e.width)),K=Math.round(t(e.height)),b=t(e.xoffset),F=t(-e.yoffset),L=e.materialKey,T=i?o:0,A=new j(L,r,s,w,g,_,K,b,F,M*e.xscale,M*e.yscale,0,T,null,d,p);return A._maybeAddLineTemplate(e),A}}export{j as default};
