/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/mathUtils","../../../../../../core/screenUtils","../../color","../../definitions","../../GeometryUtils","../../number","../../materialKey/MaterialKey","./util","./WGLBaseFillTemplate","./WGLMeshTemplate"],(function(t,e,o,i,l,n,r,s,a,c,f){"use strict";const u=128;return function(c){function f(t,e,o,i,n,a,f,u,_,h,O){var M;(M=c.call(this)||this)._effects=_;const x=s.FillMaterialKey.load(t);return e&&(x.sdf=e.sdf,x.pattern=!0,x.textureBinding=e.textureBinding),M.fillColor=o,M.tl=i,M.br=n,M.aux1=a,M.aux2=f,M.aux3=u,M._minMaxZoom=r.i1616to32(Math.round(h*l.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(O*l.MIN_MAX_ZOOM_PRECISION_FACTOR)),M._materialKey=x.data,M}return t._inheritsLoose(f,c),f.fromCIMFill=function(t,s,c){const _=t.color,h=_&&i.premultiplyAlphaRGBA(_)||0,O=t.materialKey,[M,x]=a.getMinMaxZoom(t.scaleInfo,c);if(!s){return new f(O,null,h,0,0,0,0,r.i8888to32(0,0,0,t.colorLocked?1:0),t.effects,M,x)}const{rect:T,width:w,height:I}=s,P=T.x+l.SPRITE_PADDING,p=T.y+l.SPRITE_PADDING,A=P+w,m=p+I;let g=e.nextHighestPowerOfTwo(I);g>255?g=255:g<=0&&(g=e.nextHighestPowerOfTwo(m-p));let y=e.nextHighestPowerOfTwo(w||0);y>255?y=255:y<=0&&(y=e.nextHighestPowerOfTwo(A-P));let D=o.pt2px(t.offsetX||0)+u;D>255&&(D=255);let d=o.pt2px(-t.offsetY||0)+u;d>255&&(d=255);const E=t.scaleX||1,F=1;return new f(O,s,h,r.i1616to32(P,p),r.i1616to32(A,m),r.i8888to32(y,g,D,d),r.i1616to32(u*E,u*F),r.i8888to32(0,0,n.degToByte(t.angle),t.colorLocked?1:0),t.effects,M,x)},f.fromSimpleFill=function(t,o,n=!1){const{color:s}=t,c=s&&"esriSFSNull"!==t.style&&i.premultiplyAlphaRGBAArray(s)||0,_=r.i8888to32(0,0,0,n?255:0),h=t.materialKey;if(!o)return new f(h,null,c,0,0,0,0,_,null,a.DEFAULT_MIN_ZOOM,a.DEFAULT_MAX_ZOOM);const{rect:O,width:M,height:x}=o,T=O.x+l.SPRITE_PADDING,w=O.y+l.SPRITE_PADDING,I=T+M,P=w+x;return new f(h,o,c,r.i1616to32(T,w),r.i1616to32(I,P),r.i8888to32(e.nextHighestPowerOfTwo(I-T),e.nextHighestPowerOfTwo(P-w),0,0),r.i1616to32(u,u),_,null,a.DEFAULT_MIN_ZOOM,a.DEFAULT_MAX_ZOOM)},f.fromPictureFill=function(t,i,n=!1){const s=l.PICTURE_FILL_COLOR,{rect:c,width:_,height:h}=i,O=c.x+l.SPRITE_PADDING,M=c.y+l.SPRITE_PADDING,x=O+_,T=M+h,w=r.i1616to32(O,M),I=r.i1616to32(x,T);let P=e.nextHighestPowerOfTwo(o.pt2px(t.width));P>255&&(P=255);let p=e.nextHighestPowerOfTwo(o.pt2px(t.height));p>255&&(p=255);let A=o.pt2px(t.xoffset)+u;A>255&&(A=255);let m=o.pt2px(-t.yoffset)+u;m>255&&(m=255);const g=r.i8888to32(P,p,A,m),y=r.i1616to32(u*t.xscale,u*t.yscale),D=r.i8888to32(0,0,0,n?255:0);return new f(t.materialKey,i,s,w,I,g,y,D,null,a.DEFAULT_MIN_ZOOM,a.DEFAULT_MAX_ZOOM)},f}(c(f))}));
