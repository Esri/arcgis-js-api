/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/screenUtils","../../color","../../definitions","../../GeometryUtils","../../number","../../materialKey/MaterialKey","./util","./WGLBaseFillTemplate","./WGLMeshTemplate"],(function(e,t,l,i,n,o,r,_,a,s){"use strict";const O=128;return function(a){function s(e,t,l,n,_,s,O,u,I,c,E,T,p,M,f,A){var h;(h=a.call(this)||this)._effects=M;const L=r.FillMaterialKey.load(e);return t&&(L.sdf=t.sdf,L.pattern=!0,L.textureBinding=t.textureBinding),h.fillColor=l,h.tl=n,h.br=_,h.aux21=o.i1616to32(s,O),h.aux22=o.i1616to32(u,I),h.aux3=o.i8888to32(c,E,T,0),h._bitset=p,h._minMaxZoom=o.i1616to32(Math.round(f*i.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(A*i.MIN_MAX_ZOOM_PRECISION_FACTOR)),h._materialKey=L.data,h}return e._inheritsLoose(s,a),s.fromCIMFill=function(e,r,a){const u=e.color,I=u&&l.premultiplyAlphaRGBA(u)||0,c=e.materialKey,[E,T]=_.getMinMaxZoom(e.scaleInfo,a),p=(e.colorLocked?i.BITSET_GENERIC_LOCK_COLOR:0)|(e.applyRandomOffset?i.BITSET_FILL_RANDOM_PATTERN_OFFSET:0)|(e.sampleAlphaOnly?i.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0)|(e.hasUnresolvedReplacementColor?i.BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR:0);if(!r)return new s(c,null,I,0,0,0,0,0,0,0,0,0,p,e.effects,E,T);const{rect:M,width:f,height:A}=r,h=e.scaleX||1,L=M.x+i.SPRITE_PADDING,R=M.y+i.SPRITE_PADDING,d=L+f,m=R+A,N=t.pt2px(e.height);let y=h*N;"CIMHatchFill"===e.cim.type&&(y*=f/A);let C=Math.round(N);C<=0&&(C=m-R);let D=Math.round(y);D<=0&&(D=d-L);const S=t.pt2px(e.offsetX||0),x=t.pt2px(-e.offsetY||0);return new s(c,r,I,o.i1616to32(L,R),o.i1616to32(d,m),D,C,S,x,O,O,n.degToByte(e.angle),p,e.effects,E,T)},s.fromSimpleFill=function(e,t,n=!1){const{color:r}=e,a=r&&"esriSFSNull"!==e.style&&l.premultiplyAlphaRGBAArray(r)||0,u=n?i.BITSET_GENERIC_LOCK_COLOR:0,I=e.materialKey;let c;if(t){const{rect:e,width:l,height:n,pixelRatio:r}=t,E=e.x+i.SPRITE_PADDING,T=e.y+i.SPRITE_PADDING,p=E+l,M=T+n;c=new s(I,t,a,o.i1616to32(E,T),o.i1616to32(p,M),l/r,n/r,0,0,O,O,0,u,null,_.DEFAULT_MIN_ZOOM,_.DEFAULT_MAX_ZOOM)}else c=new s(I,null,a,0,0,0,0,0,0,0,0,0,u,null,_.DEFAULT_MIN_ZOOM,_.DEFAULT_MAX_ZOOM);return c._maybeAddLineTemplate(e),c},s.fromPictureFill=function(e,l,n=!1){const r=i.PICTURE_FILL_COLOR,{rect:a,width:u,height:I}=l,c=a.x+i.SPRITE_PADDING,E=a.y+i.SPRITE_PADDING,T=c+u,p=E+I,M=o.i1616to32(c,E),f=o.i1616to32(T,p),A=Math.round(t.pt2px(e.width)),h=Math.round(t.pt2px(e.height)),L=t.pt2px(e.xoffset),R=t.pt2px(-e.yoffset),d=e.materialKey,m=n?i.BITSET_GENERIC_LOCK_COLOR:0,N=new s(d,l,r,M,f,A,h,L,R,O*e.xscale,O*e.yscale,0,m,null,_.DEFAULT_MIN_ZOOM,_.DEFAULT_MAX_ZOOM);return N._maybeAddLineTemplate(e),N},s}(a(s))}));
