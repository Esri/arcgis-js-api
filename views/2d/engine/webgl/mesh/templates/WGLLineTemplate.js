/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/Logger","../../../../../../core/screenUtils","../../../../../../symbols/cim/enums","../../color","../../definitions","../../number","../../Utils","../../materialKey/MaterialKey","./util","./WGLBaseLineTemplate","./WGLMeshTemplate"],(function(e,t,i,r,l,n,o,s,a,u,c,_){"use strict";const p=t.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");return function(t){function c(e,i,r,l,s,c,_,p,m,L,d,f,h,y,T,S,O,I,M){var A;A=t.call(this)||this;const P=a.LineMaterialKey.load(e);i&&(P.sdf=i.sdf,P.pattern=!0,P.textureBinding=i.textureBinding),A._capType=l,A._joinType=s,A._miterLimitCosine=u.getLimitCosine(c),A.tessellationProperties._fillColor=_,A.tessellationProperties._tl=p,A.tessellationProperties._br=m,A._hasPattern=L,A._isDashed=d,A._zOrder=S,A._effects=O,A._minMaxZoom=o.i1616to32(Math.round(I*n.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(M*n.MIN_MAX_ZOOM_PRECISION_FACTOR)),A._materialKey=P.data;const E=y?n.BITSET_TYPE_FILL_OUTLINE:0,D=(h?n.BITSET_GENERIC_LOCK_COLOR:0)|E|(f?n.BITSET_LINE_SCALE_DASH:0);return A.tessellationProperties._bitset=D,A.tessellationProperties._halfWidth=.5*r,A.tessellationProperties._halfReferenceWidth=.5*T,A.tessellationProperties.offset=0,A._initializeTessellator(!1),A}return e._inheritsLoose(c,t),c.fromCIMLine=function(e,t,s){const a=e.color,_=e.scaleFactor||1,p=!!e.dashTemplate;let m=e.cap;p&&m===r.CapType.ROUND&&(m=r.CapType.SQUARE);const L=e.join,d=i.pt2px(e.width)*_,f=i.pt2px(e.referenceWidth),h=i.pt2px(e.miterLimit),y=a&&l.premultiplyAlphaRGBA(a)||0,[T,S]=u.getMinMaxZoom(e.scaleInfo,s),O=!1;if(!t)return new c(e.materialKey,t,d,m,L,h,y,0,0,!1,p,e.scaleDash,e.colorLocked,O,f,e.zOrder,e.effects,T,S);const{rect:I,width:M,height:A}=t,P=I.x+n.SPRITE_PADDING,E=I.y+n.SPRITE_PADDING,D=P+M,N=E+A,g=o.i1616to32(P,E),C=o.i1616to32(D,N),R=!1;return new c(e.materialKey,t,d,m,L,h,y,g,C,!0,p,e.scaleDash,e.colorLocked,R,f,e.zOrder,e.effects,T,S)},c.fromFillOutline=function(e){var t;return e.isOutlinedFill&&e.outline&&"esriSLSSolid"===(null==(t=e.outline)?void 0:t.style)?c.fromSimpleLine({hash:"",materialKey:e.materialKey,...e.outline},null,!0):null},c.fromSimpleLine=function(e,t,r=!1){const{color:a}=e,_="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,p=s.getCapType(e.cap||"round"),m=s.getJoinType(e.join||"round");let L=a&&"esriSLSNull"!==e.style&&l.premultiplyAlphaRGBAArray(a)||0;"esriSLSNull"===e.style&&(L=0);const d=i.pt2px(e.width),f=e.miterLimit;if(!t)return new c(e.materialKey,t,d,p,m,f,L,0,0,!1,_,!0,!1,r,d,0,null,u.DEFAULT_MIN_ZOOM,u.DEFAULT_MAX_ZOOM);const{rect:h,width:y,height:T}=t,S=h.x+n.SPRITE_PADDING,O=h.y+n.SPRITE_PADDING,I=S+y,M=O+T,A=o.i1616to32(S,O),P=o.i1616to32(I,M);return new c(e.materialKey,t,d,p,m,f,L,A,P,!0,_,!0,!1,r,d,0,null,u.DEFAULT_MIN_ZOOM,u.DEFAULT_MAX_ZOOM)},c.fromPictureLineSymbol=function(e,t,i,r){return p.error("PictureLineSymbol support does not exist!"),null},c}(c(_))}));
