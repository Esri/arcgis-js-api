/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/Logger","../../../../../../core/screenUtils","../../color","../../definitions","../../number","../../Utils","../../materialKey/MaterialKey","./util","./WGLBaseLineTemplate","./WGLMeshTemplate"],(function(e,t,i,r,o,l,n,s,a,c,_){"use strict";const p=t.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");return function(t){function c(e,i,r,n,c,_,p,u,d,f,m,L,h,y,M,P,A){var O;O=t.call(this)||this;const I=s.LineMaterialKey.load(e);return i&&(I.sdf=i.sdf,I.pattern=!0,I.textureBinding=i.textureBinding),O._capType=n,O._joinType=c,O._miterLimitCosine=a.getLimitCosine(_),O.tessellationProperties._fillColor=p,O.tessellationProperties._tl=u,O.tessellationProperties._br=d,O._hasPattern=f,O._isDashed=m,O._isColorLocked=L,O._zOrder=y,O._effects=M,O._minMaxZoom=l.i1616to32(Math.round(P*o.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(A*o.MIN_MAX_ZOOM_PRECISION_FACTOR)),O._materialKey=I.data,O.tessellationProperties._bitset=L?1:0,O.tessellationProperties._halfWidth=.5*r,O.tessellationProperties._halfReferenceWidth=.5*h,O.tessellationProperties.offset=0,O._initializeTessellator(!1),O}return e._inheritsLoose(c,t),c.fromCIMLine=function(e,t,n){const s=e.color,_=e.scaleFactor||1,p=e.isDashed;let u=e.cap;p&&1===u&&(u=2);const d=e.join,f=i.pt2px(e.width)*_,m=i.pt2px(e.referenceWidth),L=i.pt2px(e.miterLimit),h=s&&r.premultiplyAlphaRGBA(s)||0,[y,M]=a.getMinMaxZoom(e.scaleInfo,n);if(!t)return new c(e.materialKey,t,f,u,d,L,h,0,0,!1,p,e.colorLocked,m,e.zOrder,e.effects,y,M);const{rect:P,width:A,height:O}=t,I=P.x+o.SPRITE_PADDING,S=P.y+o.SPRITE_PADDING,T=I+A,g=S+O,D=l.i1616to32(I,S),N=l.i1616to32(T,g);return new c(e.materialKey,t,f,u,d,L,h,D,N,!0,p,e.colorLocked,m,e.zOrder,e.effects,y,M)},c.fromSimpleLine=function(e,t){const{color:s}=e,_="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,p=n.getCapType(e.cap||"round"),u=n.getJoinType(e.join||"round");let d=s&&"esriSLSNull"!==e.style&&r.premultiplyAlphaRGBAArray(s)||0;"esriSLSNull"===e.style&&(d=0);const f=i.pt2px(e.width),m=e.miterLimit;if(!t)return new c(e.materialKey,t,f,p,u,m,d,0,0,!1,_,!1,f,0,null,a.DEFAULT_MIN_ZOOM,a.DEFAULT_MAX_ZOOM);const{rect:L,width:h,height:y}=t,M=L.x+o.SPRITE_PADDING,P=L.y+o.SPRITE_PADDING,A=M+h,O=P+y,I=l.i1616to32(M,P),S=l.i1616to32(A,O);return new c(e.materialKey,t,f,p,u,m,d,I,S,!0,_,!1,f,0,null,a.DEFAULT_MIN_ZOOM,a.DEFAULT_MAX_ZOOM)},c.fromPictureLineSymbol=function(e,t,i,r){return p.error("PictureLineSymbol support does not exist!"),null},c}(c(_))}));
