/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/Logger","../../../../../../core/screenUtils","../../color","../../definitions","../../number","../../Utils","../../materialKey/MaterialKey","./util","./WGLBaseLineTemplate","./WGLMeshTemplate"],(function(e,t,i,r,l,n,o,s,a,u,_){"use strict";const c=t.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");return function(t){function u(e,i,r,o,u,_,c,p,L,m,d,f,h,S,T,y,I,O,M){var P;P=t.call(this)||this;const A=s.LineMaterialKey.load(e);i&&(A.sdf=i.sdf,A.pattern=!0,A.textureBinding=i.textureBinding),P._capType=o,P._joinType=u,P._miterLimitCosine=a.getLimitCosine(_),P.tessellationProperties._fillColor=c,P.tessellationProperties._tl=p,P.tessellationProperties._br=L,P._hasPattern=m,P._isDashed=d,P._zOrder=y,P._effects=I,P._minMaxZoom=n.i1616to32(Math.round(O*l.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(M*l.MIN_MAX_ZOOM_PRECISION_FACTOR)),P._materialKey=A.data;const E=S?l.BITSET_TYPE_FILL_OUTLINE:0,g=(h?l.BITSET_GENERIC_LOCK_COLOR:0)|E|(f?l.BITSET_LINE_SCALE_DASH:0);return P.tessellationProperties._bitset=g,P.tessellationProperties._halfWidth=.5*r,P.tessellationProperties._halfReferenceWidth=.5*T,P.tessellationProperties.offset=0,P._initializeTessellator(!1),P}return e._inheritsLoose(u,t),u.fromCIMLine=function(e,t,o){const s=e.color,_=e.scaleFactor||1,c=!!e.dashTemplate;let p=e.cap;c&&1===p&&(p=2);const L=e.join,m=i.pt2px(e.width)*_,d=i.pt2px(e.referenceWidth),f=i.pt2px(e.miterLimit),h=s&&r.premultiplyAlphaRGBA(s)||0,[S,T]=a.getMinMaxZoom(e.scaleInfo,o),y=!1;if(!t)return new u(e.materialKey,t,m,p,L,f,h,0,0,!1,c,e.scaleDash,e.colorLocked,y,d,e.zOrder,e.effects,S,T);const{rect:I,width:O,height:M}=t,P=I.x+l.SPRITE_PADDING,A=I.y+l.SPRITE_PADDING,E=P+O,g=A+M,D=n.i1616to32(P,A),N=n.i1616to32(E,g),C=!1;return new u(e.materialKey,t,m,p,L,f,h,D,N,!0,c,e.scaleDash,e.colorLocked,C,d,e.zOrder,e.effects,S,T)},u.fromFillOutline=function(e){var t;return e.isOutlinedFill&&e.outline&&"esriSLSSolid"===(null==(t=e.outline)?void 0:t.style)?u.fromSimpleLine({hash:"",materialKey:e.materialKey,...e.outline},null,!0):null},u.fromSimpleLine=function(e,t,s=!1){const{color:_}=e,c="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,p=o.getCapType(e.cap||"round"),L=o.getJoinType(e.join||"round");let m=_&&"esriSLSNull"!==e.style&&r.premultiplyAlphaRGBAArray(_)||0;"esriSLSNull"===e.style&&(m=0);const d=i.pt2px(e.width),f=e.miterLimit;if(!t)return new u(e.materialKey,t,d,p,L,f,m,0,0,!1,c,!0,!1,s,d,0,null,a.DEFAULT_MIN_ZOOM,a.DEFAULT_MAX_ZOOM);const{rect:h,width:S,height:T}=t,y=h.x+l.SPRITE_PADDING,I=h.y+l.SPRITE_PADDING,O=y+S,M=I+T,P=n.i1616to32(y,I),A=n.i1616to32(O,M);return new u(e.materialKey,t,d,p,L,f,m,P,A,!0,c,!0,!1,s,d,0,null,a.DEFAULT_MIN_ZOOM,a.DEFAULT_MAX_ZOOM)},u.fromPictureLineSymbol=function(e,t,i,r){return c.error("PictureLineSymbol support does not exist!"),null},u}(u(_))}));
