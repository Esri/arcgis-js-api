/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../../core/maybe","../../../../../../chunks/earcut","../../../../../../geometry/libtess","../../../../../../layers/graphics/OptimizedGeometry","../../definitions","../../Geometry","../../TileClipper","../bufcut"],(function(e,t,n,r,o,s,l,i,c){"use strict";const u=1e-5,f=new i.TileClipper(0,0,0,1,0),a=new i.TileClipper(0,0,0,1,0);function h(e,t,n){let r=0;for(let o=1;o<n;o++){const n=e[2*(t+o-1)],s=e[2*(t+o-1)+1];r+=(e[2*(t+o)]-n)*(e[2*(t+o)+1]+s)}return r}function g(e,t,n,r,o){let s=0;const l=2;for(let i=n;i<r;i+=3){const n=(e[i]-o)*l,r=(e[i+1]-o)*l,c=(e[i+2]-o)*l;s+=Math.abs((t[n]-t[c])*(t[r+1]-t[n+1])-(t[n]-t[r])*(t[c+1]-t[n+1]))}return s}function p(e,t){const{coords:n,lengths:r,hasIndeterminateRingOrder:o}=t,s=0,l=e;if(o)return!1;let i=0;for(let f=0;f<r.length;){let e=f,t=r[f],o=h(n,i,t);const a=[];for(;++e<r.length;){const s=r[e],l=h(n,i+t,s);if(!(l>0))break;o+=l,a.push(i+t),t+=s}const p=l.length;c.bufcut(l,n,i,i+t,a,2,s);const d=g(l,n,p,l.length,s),y=Math.abs(o);if(Math.abs((d-y)/Math.max(1e-7,y))>u)return l.length=0,!1;f=e,i+=t}return!0}function d(e,t,r){const{coords:o,lengths:s,hasIndeterminateRingOrder:l}=t;if(l)return!1;let i=0;for(let c=0;c<s.length;){let l=c,u=s[c];const f=[];for(;++l<s.length;){const e=s[l];if(!(h(o,i+u,e)>0))break;f.push(i+u-i),u+=e}const a=i+u,g=t.coords.slice(2*i,2*a),p=n.earcut(g,f,2);for(const t of p)e.push(t+r+i);c=l,i+=u}return!0}function y(e){const{coords:t,lengths:n}=e,{buffer:o}=r.triangulate(t,n);return o}function b(e,t,n){let r=0;for(let o=0;o<e.lengths.length;o++){const s=e.lengths[o];for(let o=0;o<s;o++){const s=e.coords[2*(o+r)],l=e.coords[2*(o+r)+1];if(s<t||s>n||l<t||l>n)return!0}r+=s}return!1}function T(e,n){if(t.isNone(e))return null;if(!b(e,-128,s.TILE_SIZE+128))return e;f.setPixelMargin(n),f.reset(l.GeometryType.Polygon);let r=0;for(let t=0;t<e.lengths.length;t++){const n=e.lengths[t];let o=e.coords[2*(0+r)],s=e.coords[2*(0+r)+1];f.moveTo(o,s);for(let t=1;t<n;t++)o=e.coords[2*(t+r)],s=e.coords[2*(t+r)+1],f.lineTo(o,s);f.close(),r+=n}const i=f.result(!1);if(!i)return null;const c=[],u=[];for(const t of i){let e=0;for(const n of t)u.push(n.x),u.push(n.y),e++;c.push(e)}return new o(c,u)}function m(e,t){a.setPixelMargin(t);const n=a,r=-t,o=s.TILE_SIZE+t;let i=[],c=!1,u=0;for(;u<e.length;){const t=[],s=e[u];if(!s)return null;n.reset(l.GeometryType.LineString);let[f,a]=s[0];if(c)n.moveTo(f,a);else{if(f<r||f>o||a<r||a>o){c=!0;continue}t.push({x:f,y:a})}let h=!1;const g=s.length;for(let e=1;e<g;++e)if(f+=s[e][0],a+=s[e][1],c)n.lineTo(f,a);else{if(f<r||f>o||a<r||a>o){h=!0;break}t.push({x:f,y:a})}if(h)c=!0;else{if(c){const e=n.resultWithStarts();if(e)for(const t of e)i.push(t)}else i.push({line:t,start:0});u++,c=!1}}return i=i.filter((e=>e.line.length>1)),0===i.length?null:i}f.setExtent(s.TILE_SIZE),a.setExtent(s.TILE_SIZE),e.area=h,e.clipLinesMarshall=m,e.clipMarshall=T,e.triangleAreaArray=g,e.triangulate=p,e.triangulateEarcut=d,e.triangulateLibtess=y,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
