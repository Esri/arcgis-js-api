/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../../core/maybe","../../../../../../chunks/earcut","../../../../../../geometry/libtess","../../../../../../geometry/support/TileClipper","../../../../../../layers/graphics/OptimizedGeometry","../../definitions","../bufcut"],(function(e,t,n,r,o,s,l,i){"use strict";const c=1e-5,u=new o.TileClipper(0,0,0,1,0),f=new o.TileClipper(0,0,0,1,0);function a(e,t,n){let r=0;for(let o=1;o<n;o++){const n=e[2*(t+o-1)],s=e[2*(t+o-1)+1];r+=(e[2*(t+o)]-n)*(e[2*(t+o)+1]+s)}return r}function h(e,t,n,r,o){let s=0;const l=2;for(let i=n;i<r;i+=3){const n=(e[i]-o)*l,r=(e[i+1]-o)*l,c=(e[i+2]-o)*l;s+=Math.abs((t[n]-t[c])*(t[r+1]-t[n+1])-(t[n]-t[r])*(t[c+1]-t[n+1]))}return s}function g(e,t){const{coords:n,lengths:r,hasIndeterminateRingOrder:o}=t,s=0,l=e;if(o)return!1;let u=0;for(let f=0;f<r.length;){let e=f,t=r[f],o=a(n,u,t);const g=[];for(;++e<r.length;){const s=r[e],l=a(n,u+t,s);if(!(l>0))break;o+=l,g.push(u+t),t+=s}const p=l.length;i.bufcut(l,n,u,u+t,g,2,s);const d=h(l,n,p,l.length,s),y=Math.abs(o);if(Math.abs((d-y)/Math.max(1e-7,y))>c)return l.length=0,!1;f=e,u+=t}return!0}function p(e,t,r){const{coords:o,lengths:s,hasIndeterminateRingOrder:l}=t;if(l)return!1;let i=0;for(let c=0;c<s.length;){let l=c,u=s[c];const f=[];for(;++l<s.length;){const e=s[l];if(!(a(o,i+u,e)>0))break;f.push(i+u-i),u+=e}const h=i+u,g=t.coords.slice(2*i,2*h),p=n.earcut(g,f,2);for(const t of p)e.push(t+r+i);c=l,i+=u}return!0}function d(e){const{coords:t,lengths:n}=e,{buffer:o}=r.triangulate(t,n);return o}function y(e,t,n){let r=0;for(let o=0;o<e.lengths.length;o++){const s=e.lengths[o];for(let o=0;o<s;o++){const s=e.coords[2*(o+r)],l=e.coords[2*(o+r)+1];if(s<t||s>n||l<t||l>n)return!0}r+=s}return!1}function b(e,n){if(t.isNone(e))return null;if(!y(e,-128,l.TILE_SIZE+128))return e;u.setPixelMargin(n),u.reset(o.GeometryType.Polygon);let r=0;for(let t=0;t<e.lengths.length;t++){const n=e.lengths[t];let o=e.coords[2*(0+r)],s=e.coords[2*(0+r)+1];u.moveTo(o,s);for(let t=1;t<n;t++)o=e.coords[2*(t+r)],s=e.coords[2*(t+r)+1],u.lineTo(o,s);u.close(),r+=n}const i=u.result(!1);if(!i)return null;const c=[],f=[];for(const t of i){let e=0;for(const n of t)f.push(n.x),f.push(n.y),e++;c.push(e)}return new s(c,f)}function T(e,t){f.setPixelMargin(t);const n=f,r=-t,s=l.TILE_SIZE+t;let i=[],c=!1,u=0;for(;u<e.length;){const t=[],l=e[u];if(!l)return null;n.reset(o.GeometryType.LineString);let[f,a]=l[0];if(c)n.moveTo(f,a);else{if(f<r||f>s||a<r||a>s){c=!0;continue}t.push({x:f,y:a})}let h=!1;const g=l.length;for(let e=1;e<g;++e)if(f+=l[e][0],a+=l[e][1],c)n.lineTo(f,a);else{if(f<r||f>s||a<r||a>s){h=!0;break}t.push({x:f,y:a})}if(h)c=!0;else{if(c){const e=n.resultWithStarts();if(e)for(const t of e)i.push(t)}else i.push({line:t,start:0});u++,c=!1}}return i=i.filter((e=>e.line.length>1)),0===i.length?null:i}u.setExtent(l.TILE_SIZE),f.setExtent(l.TILE_SIZE),e.area=a,e.clipLinesMarshall=T,e.clipMarshall=b,e.triangleAreaArray=h,e.triangulate=g,e.triangulateEarcut=p,e.triangulateLibtess=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
