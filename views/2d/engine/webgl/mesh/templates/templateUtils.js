/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../../../layers/graphics/OptimizedGeometry","../../../../../../core/libs/earcut/earcut","../../definitions","../../TileClipper","../bufcut","../Tesselator"],(function(t,e,o,n,r,s,l){"use strict";const c=new l,u=new r.TileClipper(0,0,0,1,128);function i(t,e,o){let n=0;for(let r=1;r<o;r++){const o=t[2*(e+r-1)],s=t[2*(e+r-1)+1];n+=(t[2*(e+r)]-o)*(t[2*(e+r)+1]+s)}return n}function f(t,e,o,n,r){let s=0;for(let l=o;l<n;l+=3){const o=2*(t.getValue(l)-r),n=2*(t.getValue(l+1)-r),c=2*(t.getValue(l+2)-r);s+=Math.abs((e[o]-e[c])*(e[n+1]-e[o+1])-(e[o]-e[n])*(e[c+1]-e[o+1]))}return s}function d(t,e,o,n,r,s,l,c){const u=((t-r)*(s-c)-(e-c)*(r-l))/((t-o)*(s-c)-(e-n)*(r-l));if(u<0||u>1)return null;return{x:Math.round(t+u*(o-t)),y:Math.round(e+u*(n-e))}}u.setExtent(n.TILE_SIZE),t.area=i,t.clip=function(t,e,o=0){const n=-o,r=e+o;let s=0,l=0,c=0;for(let e=0;e<t.lengths.length;e++){const o=t.lengths[e],u=c+o;let i=0,f=null;for(;s!==u;){let e=t.coords[2*s],o=t.coords[2*s+++1],c=e<n||e>=r||o<n||o>=r;const a=c;for(;s!==u&&c===a;)c||(t.coords[2*l]=e,t.coords[2*l+++1]=o,i++),e=t.coords[2*s],o=t.coords[2*s+++1],c=e<n||e>=r||o<n||o>=r;if(s===u){c?f&&(t.coords[2*l]=f.x,t.coords[2*l+++1]=f.y,i++):(t.coords[2*l]=e,t.coords[2*l+++1]=o,i++);continue}const h=t.coords[2*(s-2)],g=t.coords[2*(s-2)+1],p=d(h,g,e,o,n,n,r,n)||d(h,g,e,o,r,n,r,r)||d(h,g,e,o,r,r,n,r)||d(h,g,e,o,n,n,n,r);p&&(t.coords[2*l]=p.x,t.coords[2*l+++1]=p.y,i++,f||(f=p)),c||(t.coords[2*l]=e,t.coords[2*l+++1]=o,i++)}t.lengths[e]=i,c+=o}},t.clipMarshall=function(t){if(!function(t,e,o){let n=0;for(let r=0;r<t.lengths.length;r++){const s=t.lengths[r];for(let r=0;r<s;r++){const s=t.coords[2*(r+n)],l=t.coords[2*(r+n)+1];if(s<e||s>o||l<e||l>o)return!0}n+=s}return!1}(t,-128,n.TILE_SIZE+128))return t;u.reset(3);let o=0;for(let e=0;e<t.lengths.length;e++){const n=t.lengths[e];let r=t.coords[2*(0+o)],s=t.coords[2*(0+o)+1];u.moveTo(r,s);for(let e=1;e<n;e++)r=t.coords[2*(e+o)],s=t.coords[2*(e+o)+1],u.lineTo(r,s);u.close(),o+=n}const r=u.result(!1);if(!r)return null;const s=[],l=[];for(const t of r){let e=0;for(const o of t)l.push(o.x),l.push(o.y),e++;s.push(e)}return new e(s,l)},t.triangleArea=f,t.triangulate=function(t,e,o){const{coords:n,lengths:r,hasIndeterminateRingOrder:l}=e;if(l)return!1;const c=t.length;let u=0;for(let e=0;e<r.length;){let l=e,d=r[e],a=i(n,u,d);const h=[];for(;++l<r.length;){const t=r[l],e=i(n,u+d,t);if(!(e>0))break;a+=e,h.push(u+d),d+=t}const g=t.length;s.bufcut(t,n,u,u+d,h,2,o);const p=f(t,n,g,t.length,o),b=Math.abs(a);if(Math.abs((p-b)/Math.max(1e-7,b))>1e-5)return t.seek(c),!1;e=l,u+=d}return!0},t.triangulateEarcut=function(t,e,n){const{coords:r,lengths:s,hasIndeterminateRingOrder:l}=e;if(l)return!1;let c=0;for(let l=0;l<s.length;){let u=l,f=s[l];const d=[];for(;++u<s.length;){const t=s[u];if(!(i(r,c+f,t)>0))break;d.push(c+f-c),f+=t}const a=c+f,h=e.coords.slice(2*c,2*a),g=o.earcut(h,d,2);for(const e of g)t.push(e+n+c);l=u,c+=f}return!0},t.triangulateLibtess=function(t,e,o,n){const r=[],{coords:s,lengths:l}=o;c.beginPolygon(t,r);let u=0;for(let t=0;t<l.length;t++){const e=o.lengths[t];c.beginContour();for(let t=0;t<e;t++){const e=[s[2*(u+t)],s[2*(u+t)+1],0];c.addVertex(e,e)}c.endContour(),u+=e}c.endPolygon();for(let t=0;t<r.length;t++)e.push(r[t]+n)},Object.defineProperty(t,"__esModule",{value:!0})}));
