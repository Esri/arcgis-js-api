/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/screenUtils","../../alignmentUtils","../../color","../../definitions","../../number","../../materialKey/MaterialKey","./util","./WGLBaseTextTemplate","./WGLMeshTemplate","../../util/BidiText"],(function(e,t,i,n,o,l,a,r,s,c,_){"use strict";const f=5,u=24;return function(s){function c(e,n,r,c,_,h,m,p,x,M,A,d,z,g,y,O,T,I=!1,R,S){var b;(b=s.call(this)||this)._xOffset=t.pt2px(d),b._yOffset=t.pt2px(z),b._decoration=x||"none",b._color=c,b._haloColor=_,b._haloSize=Math.min(Math.floor(f*t.pt2px(t.toPt(r))),127),b._size=Math.min(Math.round(t.pt2px(n)),127);const B=Math.min(Math.round(t.pt2px(n)),127);b._referenceSize=Math.round(Math.sqrt(256*B)),b._scale=b._size/u,b._angle=A,b._justify=i.getJustification(h||"center"),b._xAlignD=i.getXAnchorDirection(h||"center"),b._yAlignD=i.getYAnchorDirection(m||"baseline"),b._baseline="baseline"===(m||"baseline"),b._bitset=(1===p?1:0)|(M?1:0)<<1;const C=a.MaterialKeyBase.load(e);return C.sdf=!0,b._materialKey=C.data,b._lineWidth=t.pt2px(g)||512,b._lineHeight=y||1,b._textPlacement=O,b._effects=T,b._isCIM=I,b._minMaxZoom=l.i1616to32(Math.round(R*o.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(S*o.MIN_MAX_ZOOM_PRECISION_FACTOR)),b}return e._inheritsLoose(c,s),c.fromText=function(e,t){const i=new c(e.materialKey,e.font.size,e.haloSize||0,e.color&&n.premultiplyAlphaRGBAArray(e.color)||0,e.haloColor&&n.premultiplyAlphaRGBAArray(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,0,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1,r.DEFAULT_MIN_ZOOM,r.DEFAULT_MAX_ZOOM),[,o]=_.bidiText(e.text);return i.bindTextInfo(t,o),i._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,i},c.fromCIMText=function(e,t,i){const o=e.scaleFactor||1,l=e.size*e.sizeRatio*o,[a,s]=r.getMinMaxZoom(e.scaleInfo,i),f=new c(e.materialKey,l,e.outlineSize*e.sizeRatio,n.premultiplyAlphaRGBA(e.color),n.premultiplyAlphaRGBA(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*o,e.offsetY*e.sizeRatio*o,512,1,e.markerPlacement,e.effects,!0,a,s),[,u]=_.bidiText(e.text);return f.bindTextInfo(t,u),f._vertexBoundsScale=e.maxVVSize?e.maxVVSize/l:1,f},c}(s(c))}));
