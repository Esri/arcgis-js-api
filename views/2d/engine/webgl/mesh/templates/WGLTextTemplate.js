/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/BidiText","../../../../../../core/screenUtils","../../alignmentUtils","../../color","../../definitions","../../number","../../materialKey/MaterialKey","./util","./WGLBaseTextTemplate","./WGLMeshTemplate"],(function(e,t,i,n,o,l,a,r,s,c,_){"use strict";const f=5;return function(c){function _(e,t,o,s,_,u,h,m,p,x,M,A,d,z,g,y,O,S,T=!1,I,R){var b;(b=c.call(this)||this)._xOffset=i.pt2px(d),b._yOffset=i.pt2px(z),b._decoration=x||"none",b._color=_,b._haloColor=u,b._haloSize=Math.min(Math.floor(f*i.pt2px(i.toPt(o))),127),b._size=Math.min(Math.round(i.pt2px(t)),127);const B=Math.min(Math.round(i.pt2px(s||t)),127);b._referenceSize=Math.round(Math.sqrt(256*B)),b._scale=b._size/l.GLYPH_SIZE,b._angle=A,b._justify=n.getJustification(h||"center"),b._xAlignD=n.getXAnchorDirection(h||"center"),b._yAlignD=n.getYAnchorDirection(m||"baseline"),b._baseline="baseline"===(m||"baseline"),b._bitset=(1===p?1:0)|(M?1:0)<<1;const C=r.MaterialKeyBase.load(e);return C.sdf=!0,b._materialKey=C.data,b._lineWidth=i.pt2px(g)||512,b._lineHeight=y||1,b._textPlacement=O,b._effects=S,b._isCIM=T,b._minMaxZoom=a.i1616to32(Math.round(I*l.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(R*l.MIN_MAX_ZOOM_PRECISION_FACTOR)),b}return e._inheritsLoose(_,c),_.fromText=function(e,i){const n=new _(e.materialKey,e.font.size,e.haloSize||0,e.font.size,e.color&&o.premultiplyAlphaRGBAArray(e.color)||0,e.haloColor&&o.premultiplyAlphaRGBAArray(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,0,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1,s.DEFAULT_MIN_ZOOM,s.DEFAULT_MAX_ZOOM),[,l]=t.bidiText(e.text);return n.bindTextInfo(i,l),n._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,n},_.fromCIMText=function(e,i,n){const l=e.scaleFactor||1,a=e.size*e.sizeRatio*l,[r,c]=s.getMinMaxZoom(e.scaleInfo,n),f=new _(e.materialKey,a,e.outlineSize*e.sizeRatio,e.referenceSize,o.premultiplyAlphaRGBA(e.color),o.premultiplyAlphaRGBA(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*l,e.offsetY*e.sizeRatio*l,512,1,e.markerPlacement,e.effects,!0,r,c),[,u]=t.bidiText(e.text);return f.bindTextInfo(i,u),f._vertexBoundsScale=e.maxVVSize?e.maxVVSize/a:1,f},_}(c(_))}));
