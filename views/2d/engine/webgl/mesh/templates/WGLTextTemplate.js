/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/screenUtils","../../alignmentUtils","../../util/BidiText","../../materialKey/MaterialKey","../../color","./WGLBaseTextTemplate","./WGLMeshTemplate"],(function(e,t,i,n,o,l,a,r){"use strict";const s=5,c=24;return function(a){function r(e,n,l,r,f,h,u,m,p,x,_,d,z,A,g,y,M,b=!1){var B;(B=a.call(this)||this)._xOffset=t.pt2px(d),B._yOffset=t.pt2px(z),B._decoration=p||"none",B._color=r,B._haloColor=f,B._haloSize=Math.min(Math.floor(s*t.pt2px(t.toPt(l))),127),B._size=Math.min(Math.round(t.pt2px(n)),127);const S=Math.min(Math.round(t.pt2px(n)),127);B._referenceSize=Math.round(Math.sqrt(256*S)),B._scale=B._size/c,B._angle=_,B._justify=i.getJustification(h||"center"),B._xAlignD=i.getXAnchorDirection(h||"center"),B._yAlignD=i.getYAnchorDirection(u||"baseline"),B._baseline="baseline"===(u||"baseline"),B._bitset=(1===m?1:0)|(x?1:0)<<1;const T=o.MaterialKeyBase.load(e);return T.sdf=!0,B._materialKey=T.data,B._lineWidth=t.pt2px(A)||512,B._lineHeight=g||1,B._textPlacement=y,B._effects=M,B._isCIM=b,B}return e._inheritsLoose(r,a),r.fromText=function(e,t){const i=new r(e.materialKey,e.font.size,e.haloSize||0,e.color&&l.premultiplyAlphaRGBAArray(e.color)||0,e.haloColor&&l.premultiplyAlphaRGBAArray(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,0,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1),[,o]=n.bidiText(e.text);return i.bindTextInfo(t,o),i._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,i},r.fromCIMText=function(e,t){const i=e.scaleFactor||1,o=e.size*e.sizeRatio*i,a=new r(e.materialKey,o,e.outlineSize*e.sizeRatio,l.premultiplyAlphaRGBA(e.color),l.premultiplyAlphaRGBA(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*i,e.offsetY*e.sizeRatio*i,512,1,e.markerPlacement,e.effects,!0),[,s]=n.bidiText(e.text);return a.bindTextInfo(t,s),a._vertexBoundsScale=e.maxVVSize?e.maxVVSize/o:1,a},r}(a(r))}));
