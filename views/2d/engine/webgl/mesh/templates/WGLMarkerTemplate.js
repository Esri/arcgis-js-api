/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/maybe","../../../../../../core/screenUtils","../../../../../../chunks/mat2df32","../../../../../../chunks/vec2f32","../../color","../../definitions","../../number","../../materialKey/MaterialKey","./util","./WGLBaseMarkerTemplate","./WGLMeshTemplate"],(function(e,t,o,r,i,a,n,l,s,h,c,p){"use strict";return function(c){function p(e,t,o,a,h,p,u,f,m,M,_,d,x,y,A,S,g,O,V,B,L,R,z){var I;(I=c.call(this)||this).angle=a,I.height=u,I.width=p,I.xOffset=t*V,I.yOffset=o*V,I._markerPlacement=B,I._effects=L,I._anchorX=.5-(.5+S)*A.width/A.width,I._anchorY=.5-(.5+g)*A.height/A.height,I._minMaxZoom=l.i1616to32(Math.round(R*n.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(z*n.MIN_MAX_ZOOM_PRECISION_FACTOR));const k=(1===y?1:0)|(_?1:0)<<1|(x?1:0)<<2|(d?1:0)<<3,P=A&&A.sdf,T=s.MarkerMaterialKey.load(e);T.sdf=P,T.pattern=!0,T.textureBinding=A.textureBinding,I._materialKey=T.data,I._fillColor=h,I._outlineColor=m,I._sizeOutlineWidth=l.i8888to32(Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*M),255)),Math.round(Math.min(Math.sqrt(128*f),255)));const w=A.rect.x+n.SPRITE_PADDING,b=A.rect.y+n.SPRITE_PADDING,C=w+A.width,U=b+A.height;I._offsets.xUpperLeft=w,I._offsets.yUpperLeft=b,I._offsets.xUpperRight=C,I._offsets.yUpperRight=b,I._offsets.xBottomLeft=w,I._offsets.yBottomLeft=U,I._offsets.xBottomRight=C,I._offsets.yBottomRight=U,I._texUpperLeft=l.i1616to32(w,b),I._texUpperRight=l.i1616to32(C,b),I._texBottomLeft=l.i1616to32(w,U),I._texBottomRight=l.i1616to32(C,U),p*=O,u*=O,p*=V,u*=V;const E=Math.round(64*O);I._bitestAndDistRatio=l.i1616to32(k,E),I._computedWidth=p,I._computedHeight=u;const X=i.create(),D=r.create();return I._applyTransformation(D,X),I}return e._inheritsLoose(p,c),p.fromCIMMarker=function(e,r,i){const n=r&&r.width||1,l=r&&r.height||1,s=e.size,c=n/l*e.scaleX,u=e.scaleSymbolsProportionally&&e.frameHeight?s/e.frameHeight:1,f=a.premultiplyAlphaRGBA(e.color),m=a.premultiplyAlphaRGBA(e.outlineColor),M=o.pt2px(s),_=M*c,d=o.pt2px(e.offsetX||0),x=o.pt2px(e.offsetY||0),y=o.pt2px(e.outlineWidth||0)*u,A=e.alignment||0,S=o.pt2px(e.referenceSize),[g,O]=h.getMinMaxZoom(e.scaleInfo,i);let V=e.rotation||0;e.rotateClockwise||(V=-V);let B=0,L=0;const R=e.anchorPoint;R&&(e.isAbsoluteAnchorPoint?s&&(B=-R.x/(s*c),L=R.y/s):(B=R.x,L=R.y));const z=new p(e.materialKey,d,x,V,f,_,M,S,m,y,e.colorLocked,e.scaleSymbolsProportionally,!1,A,r,B,L,e.sizeRatio,t.unwrapOr(e.scaleFactor,1),e.markerPlacement,e.effects,g,O);return z._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/_:1,z._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/M:1,z},p.fromPictureMarker=function(e,t){const r=Math.round(o.pt2px(e.width)),i=Math.round(o.pt2px(e.height)),a=n.PICTURE_FILL_COLOR,l=Math.round(o.pt2px(e.xoffset||0)),s=Math.round(o.pt2px(e.yoffset||0)),c=new p(e.materialKey,l,s,e.angle,a,r,i,i,0,0,!1,!1,!1,0,t,0,0,1,1,null,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);return c._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,c._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,c},p.fromSimpleMarker=function(e,t){const r=a.premultiplyAlphaRGBAArray(e.color),i=Math.round(o.pt2px(e.size)),n=i,l=Math.round(o.pt2px(e.xoffset||0)),s=Math.round(o.pt2px(e.yoffset||0)),c=e.style,u=e.outline,f=0|(u&&u.color&&a.premultiplyAlphaRGBAArray(u.color)),m=0|(u&&u.width&&Math.round(o.pt2px(u.width))),M=new p(e.materialKey,l,s,e.angle,r,i,n,n,f,m,!1,!1,"esriSMSCross"===c||"esriSMSX"===c,0,t,0,0,126/64,1,null,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);return M.boundsType="esriSMSCircle"===c?"circle":"square",M._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,M._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,M},p.fromLineSymbolMarker=function(e,t){const r=a.premultiplyAlphaRGBAArray(e.color),i=6,n=Math.round(o.pt2px(i*e.lineWidth)),l=n,s="cross"===e.style||"x"===e.style;let c;switch(e.placement){case"begin-end":c="Both";break;case"begin":c="JustBegin";break;case"end":c="JustEnd";break;default:c="None"}const u={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:c,offsetAlongLine:0},f=new p(e.materialKey,0,0,0,r,n,l,l/i,r,s?Math.round(o.pt2px(e.lineWidth)):0,!1,!1,s,1,t,0,0,126/64,1,u,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);return f.boundsType="circle"===e.style?"circle":"square",f},p}(c(p))}));
