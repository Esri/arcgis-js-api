/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/maybe","../../../../../../core/screenUtils","../../definitions","../../../../../../chunks/mat2df32","../../../../../../chunks/vec2f32","../../number","../../materialKey/MaterialKey","../../color","./WGLMeshTemplate","./WGLBaseMarkerTemplate"],(function(e,t,r,o,i,a,n,l,s,c,h){"use strict";return function(c){function h(e,t,r,s,h,p,u,f,m,d,x,y,M,_,S,g,V,B,A,z,k){var R;(R=c.call(this)||this).angle=s,R.height=u,R.width=p,R.xOffset=t*A,R.yOffset=r*A,R._markerPlacement=z,R._effects=k,R._anchorX=.5-(.5+g)*S.width/S.width,R._anchorY=.5-(.5+V)*S.height/S.height;const w=(1===_?1:0)|(x?1:0)<<1|(M?1:0)<<2|(y?1:0)<<3,L=S&&S.sdf,b=l.MarkerMaterialKey.load(e);b.sdf=L,b.pattern=!0,b.textureBinding=S.textureBinding,R._materialKey=b.data,R._fillColor=h,R._outlineColor=m,R._sizeOutlineWidth=n.i8888to32(Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*d),255)),Math.round(Math.min(Math.sqrt(128*f),255)));const P=S.rect.x+o.SPRITE_PADDING,C=S.rect.y+o.SPRITE_PADDING,G=P+S.width,T=C+S.height;R._offsets.xUpperLeft=P,R._offsets.yUpperLeft=C,R._offsets.xUpperRight=G,R._offsets.yUpperRight=C,R._offsets.xBottomLeft=P,R._offsets.yBottomLeft=T,R._offsets.xBottomRight=G,R._offsets.yBottomRight=T,R._texUpperLeft=n.i1616to32(P,C),R._texUpperRight=n.i1616to32(G,C),R._texBottomLeft=n.i1616to32(P,T),R._texBottomRight=n.i1616to32(G,T),p*=B,u*=B,p*=A,u*=A;const v=Math.round(64*B);R._bitestAndDistRatio=n.i1616to32(w,v),R._computedWidth=p,R._computedHeight=u;const I=a.create(),K=i.create();return R._applyTransformation(K,I),R}return e._inheritsLoose(h,c),h.fromCIMMarker=function(e,o){const i=o&&o.width||1,a=o&&o.height||1,n=e.size,l=i/a*e.scaleX,c=e.scaleSymbolsProportionally&&e.frameHeight?n/e.frameHeight:1,p=s.premultiplyAlphaRGBA(e.color),u=s.premultiplyAlphaRGBA(e.outlineColor),f=r.pt2px(n),m=f*l,d=r.pt2px(e.offsetX||0),x=r.pt2px(e.offsetY||0),y=r.pt2px(e.outlineWidth||0)*c,M=e.alignment||0,_=r.pt2px(e.referenceSize);let S=e.rotation||0;e.rotateClockwise||(S=-S);let g=0,V=0;const B=e.anchorPoint;B&&(e.isAbsoluteAnchorPoint?n&&(g=-B.x/(n*l),V=B.y/n):(g=B.x,V=B.y));const A=new h(e.materialKey,d,x,S,p,m,f,_,u,y,e.colorLocked,e.scaleSymbolsProportionally,!1,M,o,g,V,e.sizeRatio,t.unwrapOr(e.scaleFactor,1),e.markerPlacement,e.effects);return A._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/m:1,A._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/f:1,A},h.fromPictureMarker=function(e,t){const i=Math.round(r.pt2px(e.width)),a=Math.round(r.pt2px(e.height)),n=o.PICTURE_FILL_COLOR,l=Math.round(r.pt2px(e.xoffset||0)),s=Math.round(r.pt2px(e.yoffset||0)),c=new h(e.materialKey,l,s,e.angle,n,i,a,a,0,0,!1,!1,!1,0,t,0,0,1,1,null,null);return c._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,c._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,c},h.fromSimpleMarker=function(e,t){const o=s.premultiplyAlphaRGBAArray(e.color),i=Math.round(r.pt2px(e.size)),a=i,n=Math.round(r.pt2px(e.xoffset||0)),l=Math.round(r.pt2px(e.yoffset||0)),c=e.style,p=e.outline,u=0|(p&&p.color&&s.premultiplyAlphaRGBAArray(p.color)),f=0|(p&&p.width&&Math.round(r.pt2px(p.width))),m=new h(e.materialKey,n,l,e.angle,o,i,a,a,u,f,!1,!1,"esriSMSCross"===c||"esriSMSX"===c,0,t,0,0,126/64,1,null,null);return m.boundsType="esriSMSCircle"===c?"circle":"square",m._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,m._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,m},h.fromLineSymbolMarker=function(e,t){const o=s.premultiplyAlphaRGBAArray(e.color),i=6,a=Math.round(r.pt2px(i*e.lineWidth)),n=a,l="cross"===e.style||"x"===e.style;let c;switch(e.placement){case"begin-end":c="Both";break;case"begin":c="JustBegin";break;case"end":c="JustEnd";break;default:c="None"}const p={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:c,offsetAlongLine:0},u=new h(e.materialKey,0,0,0,o,a,n,n/i,o,l?Math.round(r.pt2px(e.lineWidth)):0,!1,!1,l,1,t,0,0,126/64,1,p,null);return u.boundsType="circle"===e.style?"circle":"square",u},h}(h(c))}));
