/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/maybe","../../../../../../core/screenUtils","../../../../../../chunks/mat2df32","../../../../../../chunks/vec2f32","../../../../../../symbols/cim/enums","../../color","../../definitions","../../number","../../materialKey/MaterialKey","./util","./WGLBaseMarkerTemplate","./WGLMeshTemplate"],(function(e,t,o,r,i,n,a,l,s,c,h,m,u){"use strict";return function(m){function u(e,t,o,a,h,u,_,p,f,M,x,d,A,y,S,E,R,O,g,L,T,B,I){var P;(P=m.call(this)||this).angle=a,P.height=_,P.width=u,P.xOffset=t*g,P.yOffset=o*g,P._markerPlacement=L,P._effects=T,P._anchorX=.5-(.5+E)*S.width/S.width,P._anchorY=.5-(.5+R)*S.height/S.height,P._minMaxZoom=s.i1616to32(Math.round(B*l.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(I*l.MIN_MAX_ZOOM_PRECISION_FACTOR));const V=(y===n.Alignment.MAP?l.BITSET_MARKER_ALIGNMENT_MAP:l.BITSET_MARKER_ALIGNMENT_SCREEN)|(x?l.BITSET_GENERIC_LOCK_COLOR:0)|(A?l.BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE:0)|(d?l.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY:0),C=S&&S.sdf,N=c.MarkerMaterialKey.load(e);N.sdf=C,N.pattern=!0,N.textureBinding=S.textureBinding,P._materialKey=N.data,P._fillColor=h,P._outlineColor=f,P._sizeOutlineWidth=s.i8888to32(Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*_),255)),Math.round(Math.min(Math.sqrt(128*M),255)),Math.round(Math.min(Math.sqrt(128*p),255)));const z=S.rect.x+l.SPRITE_PADDING,k=S.rect.y+l.SPRITE_PADDING,b=z+S.width,w=k+S.height;P._offsets.xUpperLeft=z,P._offsets.yUpperLeft=k,P._offsets.xUpperRight=b,P._offsets.yUpperRight=k,P._offsets.xBottomLeft=z,P._offsets.yBottomLeft=w,P._offsets.xBottomRight=b,P._offsets.yBottomRight=w,P._texUpperLeft=s.i1616to32(z,k),P._texUpperRight=s.i1616to32(b,k),P._texBottomLeft=s.i1616to32(z,w),P._texBottomRight=s.i1616to32(b,w),u*=O,_*=O,u*=g,_*=g;const U=Math.round(64*O);P._bitestAndDistRatio=s.i1616to32(V,U),P._computedWidth=u,P._computedHeight=_;const K=i.create(),D=r.create();return P._applyTransformation(D,K),P}return e._inheritsLoose(u,m),u.fromCIMMarker=function(e,r,i){const l=r&&r.width||1,s=r&&r.height||1,c=e.size,m=l/s*e.scaleX,_=e.scaleSymbolsProportionally&&e.frameHeight?c/e.frameHeight:1;let p=a.premultiplyAlphaRGBA(e.color);const f=a.premultiplyAlphaRGBA(e.outlineColor),M=o.pt2px(c),x=M*m,d=o.pt2px(e.offsetX||0),A=o.pt2px(e.offsetY||0),y=o.pt2px(e.outlineWidth||0)*_,S=e.alignment||n.Alignment.SCREEN,E=o.pt2px(e.referenceSize),[R,O]=h.getMinMaxZoom(e.scaleInfo,i);r.sdf||0!==p||(p=-1);let g=e.rotation||0;e.rotateClockwise||(g=-g);let L=0,T=0;const B=e.anchorPoint;B&&(e.isAbsoluteAnchorPoint?c&&(L=-B.x/(c*m),T=B.y/c):(L=B.x,T=B.y));const I=new u(e.materialKey,d,A,g,p,x,M,E,f,y,e.colorLocked,e.scaleSymbolsProportionally,!1,S,r,L,T,e.sizeRatio,t.unwrapOr(e.scaleFactor,1),e.markerPlacement,e.effects,R,O);return I._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/x:1,I._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/M:1,I},u.fromPictureMarker=function(e,t){const r=Math.round(o.pt2px(e.width)),i=Math.round(o.pt2px(e.height)),a=l.PICTURE_FILL_COLOR,s=Math.round(o.pt2px(e.xoffset||0)),c=Math.round(o.pt2px(e.yoffset||0)),m=new u(e.materialKey,s,c,e.angle,a,r,i,i,0,0,!1,!1,!1,n.Alignment.SCREEN,t,0,0,1,1,null,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);return m._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,m._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,m},u.fromSimpleMarker=function(e,t){const r=a.premultiplyAlphaRGBAArray(e.color),i=Math.round(o.pt2px(e.size)),l=i,s=Math.round(o.pt2px(e.xoffset||0)),c=Math.round(o.pt2px(e.yoffset||0)),m=e.style,_=e.outline,p=0|(_&&_.color&&a.premultiplyAlphaRGBAArray(_.color)),f=0|(_&&_.width&&Math.round(o.pt2px(_.width))),M=new u(e.materialKey,s,c,e.angle,r,i,l,l,p,f,!1,!1,"esriSMSCross"===m||"esriSMSX"===m,n.Alignment.SCREEN,t,0,0,126/64,1,null,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);return M.boundsType="esriSMSCircle"===m?"circle":"square",M._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,M._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,M},u.fromLineSymbolMarker=function(e,t){const r=a.premultiplyAlphaRGBAArray(e.color),i=6,l=Math.round(o.pt2px(i*e.lineWidth)),s=l,c="cross"===e.style||"x"===e.style;let m;switch(e.placement){case"begin-end":m=n.ExtremityPlacement.Both;break;case"begin":m=n.ExtremityPlacement.JustBegin;break;case"end":m=n.ExtremityPlacement.JustEnd;break;default:m=n.ExtremityPlacement.None}const _={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:m,offsetAlongLine:0},p=new u(e.materialKey,0,0,0,r,l,s,s/i,r,c?Math.round(o.pt2px(e.lineWidth)):0,!1,!1,c,n.Alignment.MAP,t,0,0,126/64,1,_,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);return p.boundsType="circle"===e.style?"circle":"square",p},u}(m(u))}));
