/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/maybe","../../../../../../core/screenUtils","../../../../../../chunks/mat2df32","../../../../../../chunks/vec2f32","../../../../../../symbols/cim/enums","../../color","../../definitions","../../enums","../../number","../../materialKey/MaterialKey","./util","./WGLBaseMarkerTemplate","./WGLMeshTemplate"],(function(e,t,o,r,i,n,a,l,s,c,m,p,_,h){"use strict";return function(_){function h(e,t,o,a,p,h,u,f,M,x,d,y,A,S,E,R,O,L,g,T,B,I,P){var V;(V=_.call(this)||this).angle=a,V.height=u,V.width=h,V.xOffset=t*g,V.yOffset=o*g,V._markerPlacement=T,V._effects=B,V._anchorX=R,V._anchorY=O,V._minMaxZoom=c.i1616to32(Math.round(I*l.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(P*l.MIN_MAX_ZOOM_PRECISION_FACTOR));const C=(S===n.Alignment.MAP?l.BITSET_MARKER_ALIGNMENT_MAP:l.BITSET_MARKER_ALIGNMENT_SCREEN)|(d?l.BITSET_GENERIC_LOCK_COLOR:0)|(A?l.BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE:0)|(y?l.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY:0),N=E&&E.sdf,z=m.MarkerMaterialKey.load(e);z.sdf=N,z.pattern=!0,z.textureBinding=E.textureBinding,V._materialKey=z.data,V._fillColor=p,V._outlineColor=M,V._sizeOutlineWidth=c.i8888to32(Math.round(Math.min(Math.sqrt(128*h),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*x),255)),Math.round(Math.min(Math.sqrt(128*f),255)));const b=E.rect.x+l.SPRITE_PADDING,k=E.rect.y+l.SPRITE_PADDING,U=b+E.width,w=k+E.height;V._offsets.xUpperLeft=b,V._offsets.yUpperLeft=k,V._offsets.xUpperRight=U,V._offsets.yUpperRight=k,V._offsets.xBottomLeft=b,V._offsets.yBottomLeft=w,V._offsets.xBottomRight=U,V._offsets.yBottomRight=w,z.symbologyType===s.WGLSymbologyType.PIE_CHART?(V._texUpperLeft=c.i1616to32(0,1),V._texUpperRight=c.i1616to32(1,1),V._texBottomLeft=c.i1616to32(0,0),V._texBottomRight=c.i1616to32(1,0)):(V._texUpperLeft=c.i1616to32(b,k),V._texUpperRight=c.i1616to32(U,k),V._texBottomLeft=c.i1616to32(b,w),V._texBottomRight=c.i1616to32(U,w)),h*=L,u*=L,h*=g,u*=g;const G=Math.round(64*L);V._bitestAndDistRatio=c.i1616to32(C,G),V._computedWidth=h,V._computedHeight=u;const K=i.create(),D=r.create();return V._applyTransformation(D,K),V}return e._inheritsLoose(h,_),h.fromCIMMarker=function(e,r,i){const l=r&&r.width||1,s=r&&r.height||1,c=e.size,m=l/s*e.scaleX,_=e.scaleSymbolsProportionally&&e.frameHeight?c/e.frameHeight:1;let u=a.premultiplyAlphaRGBA(e.color);const f=a.premultiplyAlphaRGBA(e.outlineColor),M=o.pt2px(c),x=M*m,d=o.pt2px(e.offsetX||0),y=o.pt2px(e.offsetY||0),A=o.pt2px(e.outlineWidth||0)*_,S=e.alignment||n.Alignment.SCREEN,E=o.pt2px(e.referenceSize),[R,O]=p.getMinMaxZoom(e.scaleInfo,i);r.sdf||0!==u||(u=-1);let L=e.rotation||0;e.rotateClockwise||(L=-L);let g=0,T=0;const B=e.anchorPoint;B&&(e.isAbsoluteAnchorPoint?c&&(g=B.x/(c*m),T=B.y/c):(g=B.x,T=B.y));const I=new h(e.materialKey,d,y,L,u,x,M,E,f,A,e.colorLocked,e.scaleSymbolsProportionally,!1,S,r,g,T,e.sizeRatio,t.unwrapOr(e.scaleFactor,1),e.markerPlacement,e.effects,R,O);return I._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/x:1,I._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/M:1,I},h.fromPictureMarker=function(e,t){const r=Math.round(o.pt2px(e.width)),i=Math.round(o.pt2px(e.height)),a=l.PICTURE_FILL_COLOR,s=Math.round(o.pt2px(e.xoffset||0)),c=Math.round(o.pt2px(e.yoffset||0)),m=new h(e.materialKey,s,c,e.angle,a,r,i,i,0,0,!1,!1,!1,n.Alignment.SCREEN,t,0,0,1,1,null,null,p.DEFAULT_MIN_ZOOM,p.DEFAULT_MAX_ZOOM);return m._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,m._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,m},h.fromSimpleMarker=function(e,t){const r=a.premultiplyAlphaRGBAArray(e.color),i=Math.round(o.pt2px(e.size)),l=i,s=Math.round(o.pt2px(e.xoffset||0)),c=Math.round(o.pt2px(e.yoffset||0)),m=e.style,_=e.outline,u=0|(_&&_.color&&a.premultiplyAlphaRGBAArray(_.color)),f=0|(_&&_.width&&Math.round(o.pt2px(_.width))),M=new h(e.materialKey,s,c,e.angle,r,i,l,l,u,f,!1,!1,"esriSMSCross"===m||"esriSMSX"===m,n.Alignment.SCREEN,t,0,0,126/64,1,null,null,p.DEFAULT_MIN_ZOOM,p.DEFAULT_MAX_ZOOM);return M.boundsType="esriSMSCircle"===m?"circle":"square",M._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,M._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,M},h.fromLineSymbolMarker=function(e,t){const r=a.premultiplyAlphaRGBAArray(e.color),i=6,l=Math.round(o.pt2px(i*e.lineWidth)),s=l,c="cross"===e.style||"x"===e.style;let m;switch(e.placement){case"begin-end":m=n.ExtremityPlacement.Both;break;case"begin":m=n.ExtremityPlacement.JustBegin;break;case"end":m=n.ExtremityPlacement.JustEnd;break;default:m=n.ExtremityPlacement.None}const _={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:m,offsetAlongLine:0},u=new h(e.materialKey,0,0,0,r,l,s,s/i,r,c?Math.round(o.pt2px(e.lineWidth)):0,!1,!1,c,n.Alignment.MAP,t,0,0,126/64,1,_,null,p.DEFAULT_MIN_ZOOM,p.DEFAULT_MAX_ZOOM);return u.boundsType="circle"===e.style?"circle":"square",u},h}(_(h))}));
