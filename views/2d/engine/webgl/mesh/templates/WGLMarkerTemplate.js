/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/maybe","../../../../../../core/screenUtils","../../definitions","../../../../../../chunks/mat2df32","../../../../../../chunks/vec2f32","../../number","../../materialKey/MaterialKey","../../color","./WGLMeshTemplate","./WGLBaseMarkerTemplate"],(function(t,e,r,o,n,i,a,l,s,h,c){"use strict";return function(h){function c(t,e,r,s,c,p,u,f,d,m,M,y,x,g,_,A,k,b,w,P,B){var R;(R=h.call(this)||this).angle=s,R.height=u,R.width=p,R.xOffset=e*w,R.yOffset=r*w,R._markerPlacement=P,R.effects=B,R._anchorX=.5-(.5+A)*_.width/_.width,R._anchorY=.5-(.5+k)*_.height/_.height;const S=(1===g?1:0)|(M?1:0)<<1|(x?1:0)<<2|(y?1:0)<<3,L=_&&_.sdf,C=l.MarkerMaterialKey.load(t);C.sdf=L,C.pattern=!0,C.textureBinding=_.textureBinding,R._materialKey=C.data,R._fillColor=c,R._outlineColor=d,R._sizeOutlineWidth=a.i8888to32(Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*f),255)));const G=_.rect.x+o.SPRITE_PADDING,T=_.rect.y+o.SPRITE_PADDING,I=G+_.width,K=T+_.height;R._texUpperLeft=a.i1616to32(G,T),R._texUpperRight=a.i1616to32(I,T),R._texBottomLeft=a.i1616to32(G,K),R._texBottomRight=a.i1616to32(I,K),p*=b,u*=b,p*=w,u*=w;const W=Math.round(Math.min(64*b,255));R._bitestAndDistRatio=a.i8888to32(0,0,S,W),R._computedWidth=p,R._computedHeight=u;const q=i.create(),O=n.create();return R._applyTransformation(O,q),R}return t._inheritsLoose(c,h),c.fromCIMMarker=function(t,o){const n=o&&o.width||1,i=o&&o.height||1,a=t.size,l=n/i*t.scaleX,h=t.scaleSymbolsProportionally&&t.frameHeight?a/t.frameHeight:1,p=s.premultiplyAlphaRGBA(t.color),u=s.premultiplyAlphaRGBA(t.outlineColor),f=r.pt2px(a),d=f*l,m=r.pt2px(t.offsetX||0),M=r.pt2px(t.offsetY||0),y=r.pt2px(t.outlineWidth||0)*h,x=t.alignment||0,g=r.pt2px(t.referenceSize);let _=t.rotation||0;t.rotateClockwise||(_=-_);let A=0,k=0;const b=t.anchorPoint;return b&&(t.isAbsoluteAnchorPoint?a&&(A=-b.x/(a*l),k=b.y/a):(A=b.x,k=b.y)),new c(t.materialKey,m,M,_,p,d,f,g,u,y,t.colorLocked,t.scaleSymbolsProportionally,!1,x,o,A,k,t.sizeRatio,e.unwrapOr(t.scaleFactor,1),t.markerPlacement,t.effects)},c.fromPictureMarker=function(t,e){const n=Math.round(r.pt2px(t.width)),i=Math.round(r.pt2px(t.height)),a=o.PICTURE_FILL_COLOR,l=Math.round(r.pt2px(t.xoffset||0)),s=Math.round(r.pt2px(t.yoffset||0));return new c(t.materialKey,l,s,t.angle,a,n,i,i,0,0,!1,!1,!1,0,e,0,0,1,1,null,null)},c.fromSimpleMarker=function(t,e){const o=s.premultiplyAlphaRGBAArray(t.color),n=Math.round(r.pt2px(t.size)),i=n,a=Math.round(r.pt2px(t.xoffset||0)),l=Math.round(r.pt2px(t.yoffset||0)),h=t.style,p=t.outline,u=0|(p&&p.color&&s.premultiplyAlphaRGBAArray(p.color)),f=0|(p&&p.width&&Math.round(r.pt2px(p.width))),d=new c(t.materialKey,a,l,t.angle,o,n,i,i,u,f,!1,!1,"esriSMSCross"===h||"esriSMSX"===h,0,e,0,0,126/64,1,null,null);return d.boundsType="esriSMSCircle"===h?"circle":"square",d},c.fromLineSymbolMarker=function(t,e){const o=s.premultiplyAlphaRGBAArray(t.color),n=Math.round(r.pt2px(6*t.lineWidth)),i=n,a="cross"===t.style||"x"===t.style;let l;switch(t.placement){case"begin-end":l="Both";break;case"begin":l="JustBegin";break;case"end":l="JustEnd";break;default:l="None"}const h={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:l,offsetAlongLine:0},p=new c(t.materialKey,0,0,0,o,n,i,i/6,o,a?Math.round(r.pt2px(t.lineWidth)):0,!1,!1,a,1,e,0,0,126/64,1,h,null);return p.boundsType="circle"===t.style?"circle":"square",p},c}(c(h))}));
