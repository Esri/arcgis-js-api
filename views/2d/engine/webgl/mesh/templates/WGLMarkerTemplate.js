/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/maybe","../../../../../../core/screenUtils","../../../../../../chunks/mat2df32","../../../../../../chunks/vec2f32","../../color","../../definitions","../../number","../../materialKey/MaterialKey","./util","./WGLBaseMarkerTemplate","./WGLMeshTemplate"],(function(e,t,o,r,i,a,n,l,s,c,h,_){"use strict";return function(h){function _(e,t,o,a,c,_,p,u,f,M,m,d,x,A,S,y,O,R,L,E,T,g,B){var I;(I=h.call(this)||this).angle=a,I.height=p,I.width=_,I.xOffset=t*L,I.yOffset=o*L,I._markerPlacement=E,I._effects=T,I._anchorX=.5-(.5+y)*S.width/S.width,I._anchorY=.5-(.5+O)*S.height/S.height,I._minMaxZoom=l.i1616to32(Math.round(g*n.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(B*n.MIN_MAX_ZOOM_PRECISION_FACTOR));const V=(1===A?n.BITSET_MARKER_ALIGNMENT_MAP:n.BITSET_MARKER_ALIGNMENT_SCREEN)|(m?n.BITSET_GENERIC_LOCK_COLOR:0)|(x?n.BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE:0)|(d?n.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY:0),C=S&&S.sdf,P=s.MarkerMaterialKey.load(e);P.sdf=C,P.pattern=!0,P.textureBinding=S.textureBinding,I._materialKey=P.data,I._fillColor=c,I._outlineColor=f,I._sizeOutlineWidth=l.i8888to32(Math.round(Math.min(Math.sqrt(128*_),255)),Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*M),255)),Math.round(Math.min(Math.sqrt(128*u),255)));const z=S.rect.x+n.SPRITE_PADDING,N=S.rect.y+n.SPRITE_PADDING,k=z+S.width,w=N+S.height;I._offsets.xUpperLeft=z,I._offsets.yUpperLeft=N,I._offsets.xUpperRight=k,I._offsets.yUpperRight=N,I._offsets.xBottomLeft=z,I._offsets.yBottomLeft=w,I._offsets.xBottomRight=k,I._offsets.yBottomRight=w,I._texUpperLeft=l.i1616to32(z,N),I._texUpperRight=l.i1616to32(k,N),I._texBottomLeft=l.i1616to32(z,w),I._texBottomRight=l.i1616to32(k,w),_*=R,p*=R,_*=L,p*=L;const b=Math.round(64*R);I._bitestAndDistRatio=l.i1616to32(V,b),I._computedWidth=_,I._computedHeight=p;const U=i.create(),K=r.create();return I._applyTransformation(K,U),I}return e._inheritsLoose(_,h),_.fromCIMMarker=function(e,r,i){const n=r&&r.width||1,l=r&&r.height||1,s=e.size,h=n/l*e.scaleX,p=e.scaleSymbolsProportionally&&e.frameHeight?s/e.frameHeight:1;let u=a.premultiplyAlphaRGBA(e.color);const f=a.premultiplyAlphaRGBA(e.outlineColor),M=o.pt2px(s),m=M*h,d=o.pt2px(e.offsetX||0),x=o.pt2px(e.offsetY||0),A=o.pt2px(e.outlineWidth||0)*p,S=e.alignment||0,y=o.pt2px(e.referenceSize),[O,R]=c.getMinMaxZoom(e.scaleInfo,i);r.sdf||0!==u||(u=-1);let L=e.rotation||0;e.rotateClockwise||(L=-L);let E=0,T=0;const g=e.anchorPoint;g&&(e.isAbsoluteAnchorPoint?s&&(E=-g.x/(s*h),T=g.y/s):(E=g.x,T=g.y));const B=new _(e.materialKey,d,x,L,u,m,M,y,f,A,e.colorLocked,e.scaleSymbolsProportionally,!1,S,r,E,T,e.sizeRatio,t.unwrapOr(e.scaleFactor,1),e.markerPlacement,e.effects,O,R);return B._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/m:1,B._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/M:1,B},_.fromPictureMarker=function(e,t){const r=Math.round(o.pt2px(e.width)),i=Math.round(o.pt2px(e.height)),a=n.PICTURE_FILL_COLOR,l=Math.round(o.pt2px(e.xoffset||0)),s=Math.round(o.pt2px(e.yoffset||0)),h=new _(e.materialKey,l,s,e.angle,a,r,i,i,0,0,!1,!1,!1,0,t,0,0,1,1,null,null,c.DEFAULT_MIN_ZOOM,c.DEFAULT_MAX_ZOOM);return h._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,h._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,h},_.fromSimpleMarker=function(e,t){const r=a.premultiplyAlphaRGBAArray(e.color),i=Math.round(o.pt2px(e.size)),n=i,l=Math.round(o.pt2px(e.xoffset||0)),s=Math.round(o.pt2px(e.yoffset||0)),h=e.style,p=e.outline,u=0|(p&&p.color&&a.premultiplyAlphaRGBAArray(p.color)),f=0|(p&&p.width&&Math.round(o.pt2px(p.width))),M=new _(e.materialKey,l,s,e.angle,r,i,n,n,u,f,!1,!1,"esriSMSCross"===h||"esriSMSX"===h,0,t,0,0,126/64,1,null,null,c.DEFAULT_MIN_ZOOM,c.DEFAULT_MAX_ZOOM);return M.boundsType="esriSMSCircle"===h?"circle":"square",M._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,M._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,M},_.fromLineSymbolMarker=function(e,t){const r=a.premultiplyAlphaRGBAArray(e.color),i=6,n=Math.round(o.pt2px(i*e.lineWidth)),l=n,s="cross"===e.style||"x"===e.style;let h;switch(e.placement){case"begin-end":h="Both";break;case"begin":h="JustBegin";break;case"end":h="JustEnd";break;default:h="None"}const p={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:h,offsetAlongLine:0},u=new _(e.materialKey,0,0,0,r,n,l,l/i,r,s?Math.round(o.pt2px(e.lineWidth)):0,!1,!1,s,1,t,0,0,126/64,1,p,null,c.DEFAULT_MIN_ZOOM,c.DEFAULT_MAX_ZOOM);return u.boundsType="circle"===e.style?"circle":"square",u},_}(h(_))}));
