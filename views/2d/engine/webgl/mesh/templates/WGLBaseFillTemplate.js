/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/maybe","../../../../../../layers/graphics/featureConversionUtils","../../enums","../../number","../../materialKey/MaterialKey","./templateUtils"],(function(e,t,r,i,o,s,n){"use strict";const a=100,l=1;return c=>function(c){function u(...e){var t;return(t=c.call(this,...e)||this).forceLibtess=!1,t.geometryType=i.WGLGeometryType.FILL,t}e._inheritsLoose(u,c);var y=u.prototype;return y._write=function(e,t,r){const i="esriGeometryPoint"===t.geometryType,o=s.FillMaterialKey.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,o.dotDensity,i),this._writeGeometry(e,t,o,r,i),e.recordEnd()},y._writeGeometry=function(e,r,i,o,s){const l=this._getGeometry(r,o,s);if(t.isNone(l))return;const c=e.indexCount();if(!(l.maxLength>a)&&!this.forceLibtess&&n.triangulate(e,l)){return void(!(c===e.indexCount())&&this._writeVertices(e,r,l.coords,l.lengths,i))}const u=n.triangulateLibtess(e,l);!(c===e.indexCount())&&this._writeVertices(e,r,u,[u.length/2],i)},y._writeVertices=function(e,t,r,i,s){const n=t.getDisplayId();let a=0;const c=i.reduce(((e,t)=>e+t)),u=s.dotDensity?4:10;e.vertexEnsureSize(u*c);for(const y of i){const i=y+a;for(let c=a;c<i;c++){const i=r[2*c],a=r[2*c+1],u=o.i1616to32(l*i,l*a);e.vertexBounds(i,a,0,0),e.vertexWrite(u),e.vertexWrite(n),s.dotDensity?e.vertexWriteF32(1/Math.abs(t.readGeometryArea())):(e.vertexWrite(this.fillColor),e.vertexWrite(this.tl),e.vertexWrite(this.br),e.vertexWrite(this.aux1),e.vertexWrite(this.aux2),e.vertexWrite(this.aux3),e.vertexWrite(this._minMaxZoom))}a+=y}},y._getGeometry=function(e,t,i){const o=t?r.deltaDecodeGeometry(r.convertFromGeometry(t),2):e.readGeometryForDisplay();if(!o)return null;const s=i?256:8;return n.clipMarshall(o,s)},u}(c)}));
