/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../core/maybe","../../../../../../layers/graphics/featureConversionUtils","../../enums","../../number","../../materialKey/MaterialKey","./templateUtils"],(function(e,t,r,i,o,n,s){"use strict";const a=1e3,l=1;return c=>function(c){function u(...e){var t;return(t=c.call(this,...e)||this).forceLibtess=!1,t.geometryType=i.WGLGeometryType.FILL,t}e._inheritsLoose(u,c);var y=u.prototype;return y._write=function(e,t,r){const i="esriGeometryPoint"===t.geometryType,o=n.FillMaterialKey.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,o.dotDensity,i),this._writeGeometry(e,t,o,r,i),e.recordEnd()},y._writeGeometry=function(e,r,i,o,n){const l=this._getGeometry(r,o,n);if(t.isNone(l))return;const c=e.indexCount();if(!(l.lengths[0]>a)&&!this.forceLibtess&&s.triangulate(e,l)){return void(!(c===e.indexCount())&&this._writeVertices(e,r,l.coords,l.lengths,i))}const u=s.triangulateLibtess(e,l);!(c===e.indexCount())&&this._writeVertices(e,r,u,[u.length/2],i)},y._writeVertices=function(e,t,r,i,n){const s=t.getDisplayId();let a=0;for(const c of i){const i=c+a;for(let c=a;c<i;c++){const i=r[2*c],a=r[2*c+1],u=o.i1616to32(l*i,l*a);e.vertexBounds(i,a,0,0),e.vertexWrite(u),e.vertexWrite(s),n.dotDensity?e.vertexWriteF32(1/Math.abs(t.readGeometryArea())):(e.vertexWrite(this.fillColor),e.vertexWrite(this.tl),e.vertexWrite(this.br),e.vertexWrite(this.aux1),e.vertexWrite(this.aux2),e.vertexWrite(this.aux3),e.vertexWrite(this._minMaxZoom))}a+=c}},y._getGeometry=function(e,t,i){const o=t?r.deltaDecodeGeometry(r.convertFromGeometry(t),2):e.readUnquantizedGeometry();if(!o)return null;const n=i?256:128;return s.clipMarshall(o,n)},u}(c)}));
