/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/has","../../../core/maybe","../../../chunks/mat3f32","../../../layers/support/rasterFunctions/vectorFieldUtils","../../webgl/BufferObject","../../webgl/FramebufferObject","../../webgl/checkWebGLError","../../webgl/enums","../../../chunks/builtins","../../webgl/Texture","../../webgl/VertexArrayObject","./DisplayObject","./webgl/Utils"],(function(e,t,a,r,s,i,o,n,c,l,u,h,d,m,v){"use strict";let f=function(e){function a(t=null){var a;return(a=e.call(this)||this)._source=null,a._symbolizerParameters=null,a._vaoInvalidated=!0,a.coordScale=[1,1],a.height=null,a.stencilRef=0,a.rawPixelData=null,a.width=null,a.source=t,a}t._inheritsLoose(a,e);var n=a.prototype;return n.destroy=function(){var e,t;r.isSome(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)},n.invalidateVAO=function(){var e,t;!this._vaoInvalidated&&r.isSome(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())},n.updateVectorFieldVAO=function(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,r.isSome(this.source)&&!r.isSome(this.vaoData)){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const t=i.createVFMesh(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:a}}break;case"simple_scalar":{const t=i.createVFMeshScalar(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:a}}break;case"wind_speed":{const t=i.createVFMesh(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(e.context,t),r=i.createVFMeshScalar(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,r);this.vaoData={magdir:a,scalar:s}}}}this.ready(),this.requestRender()}},n._createTransforms=function(){return{dvs:s.create()}},n.onAttach=function(){this.invalidateVAO()},n.onDetach=function(){this.invalidateVAO()},n._createVectorFieldVAO=function(e,t){const{vertexData:a,indexData:r}=t,s=o.createVertex(e,35044,new Float32Array(a)),i=o.createIndex(e,35044,new Uint32Array(r)),n=v.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new d(e,n.attributes,n.bufferLayouts,{geometry:s},i),elementCount:r.length}},t._createClass(a,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this.invalidateVAO()}}]),a}(m.DisplayObject);e.RasterVFDisplayObject=f,Object.defineProperty(e,"__esModule",{value:!0})}));
