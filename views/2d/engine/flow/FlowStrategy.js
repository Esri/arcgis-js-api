/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../geometry","../../../../core/Accessor","../../../../core/Logger","../../../../core/mathUtils","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Point","./FlowDisplayData","./FlowDisplayObject","../../../../geometry/Extent"],(function(e,t,o,i,a,r,n,s,l,c,d,p,u,y,h,_){"use strict";const f=1.15;let g=function(t){function o(e){var o;return(o=t.call(this,e)||this)._flowDisplayObject=new h.FlowDisplayObject,o._loading=null,o}e._inheritsLoose(o,t);var i=o.prototype;return i.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)},i.destroy=function(){this._clear(),this.flowContainer.removeAllChildren()},i.update=function(e){const{flowStyle:t}=this.flowContainer;if(n.isNone(t))return void this._clear();const{extent:o,rotation:i,resolution:r,pixelRatio:l}=e.state,c=m(o,i);c.expand(f);const d=[Math.round((c.xmax-c.xmin)/r),Math.round((c.ymax-c.ymin)/r)],p=new y(t,c,d,l);if(n.isSome(this._loading)){if(this._loading.update(p))return;this._loading.detach(),this._loading=null}!n.isNone(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(p)||(p.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(e=>{s.isAbortError(e)||(a.getLogger(this.declaredClass).error("A resource failed to load.",e),this._loading=null)})),this._loading=p)},i._clear=function(){this._flowDisplayObject.clear(),n.isSome(this._loading)&&(this._loading.detach(),this._loading=null)},e._createClass(o,[{key:"updating",get:function(){return null!=this._loading}}]),o}(i);t.__decorate([l.property()],g.prototype,"_loading",void 0),t.__decorate([l.property()],g.prototype,"flowContainer",void 0),t.__decorate([l.property()],g.prototype,"updating",null),g=t.__decorate([p.subclass("esri.views.2d.engine.flow.FlowStrategy")],g);function m(e,t){const o=new u({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),i=e.xmax-e.xmin,a=e.ymax-e.ymin,n=Math.abs(Math.cos(r.deg2rad(t))),s=Math.abs(Math.sin(r.deg2rad(t))),l=n*i+s*a,c=s*i+n*a,d=new _({xmin:o.x-l/2,ymin:o.y-c/2,xmax:o.x+l/2,ymax:o.y+c/2,spatialReference:e.spatialReference});return d.centerAt(o),d}return g}));
