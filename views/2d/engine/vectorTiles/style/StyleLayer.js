/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../symbols/cim/enums","../enums","../shaders/VTLBackgroundMaterial","../shaders/VTLCircleMaterial","../shaders/VTLFillMaterial","../shaders/VTLLineMaterial","../shaders/VTLSymbolMaterial","./Filter","./StyleDefinition","./StyleProperty","../../webgl/definitions"],(function(t,i,e,a,n,o,r,l,s,u,h,p,y){"use strict";let g=function(){function t(t,i,e,a){switch(this.type=t,this.typeName=i.type,this.id=i.id,this.source=i.source,this.sourceLayer=i["source-layer"],this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,this.filter=i.filter,this.layout=i.layout,this.paint=i.paint,this.z=e,this.uid=a,t){case h.StyleLayerType.BACKGROUND:this._layoutDefinition=h.StyleDefinition.backgroundLayoutDefinition,this._paintDefinition=h.StyleDefinition.backgroundPaintDefinition;break;case h.StyleLayerType.FILL:this._layoutDefinition=h.StyleDefinition.fillLayoutDefinition,this._paintDefinition=h.StyleDefinition.fillPaintDefinition;break;case h.StyleLayerType.LINE:this._layoutDefinition=h.StyleDefinition.lineLayoutDefinition,this._paintDefinition=h.StyleDefinition.linePaintDefinition;break;case h.StyleLayerType.SYMBOL:this._layoutDefinition=h.StyleDefinition.symbolLayoutDefinition,this._paintDefinition=h.StyleDefinition.symbolPaintDefinition;break;case h.StyleLayerType.CIRCLE:this._layoutDefinition=h.StyleDefinition.circleLayoutDefinition,this._paintDefinition=h.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}var i=t.prototype;return i.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=u.createFilter(this.filter)},i.getLayoutProperty=function(t){return this._layoutProperties[t]},i.getPaintProperty=function(t){return this._paintProperties[t]},i.getLayoutValue=function(t,i,e){let a;const n=this._layoutProperties[t];return n&&(a=n.getValue(i,e)),void 0===a&&(a=this._layoutDefinition[t].default),a},i.getPaintValue=function(t,i,e){let a;const n=this._paintProperties[t];return n&&(a=n.getValue(i,e)),void 0===a&&(a=this._paintDefinition[t].default),a},i.isPainterDataDriven=function(){const t=this._paintProperties;if(t)for(const i in t)if(t[i].isDataDriven)return!0;return!1},i._parseLayout=function(t){const i={};for(const e in t){const a=this._layoutDefinition[e];a&&(i[e]=new p(a,t[e]))}return i},i._parsePaint=function(t){const i={};for(const e in t){const a=this._paintDefinition[e];a&&(i[e]=new p(a,t[e]))}return i},i.computeAttributesKey=function(t,i,e,a){let n=0,o=0;for(const r of i){let t=3;if(!r||r!==a){const i=e[r],{isLayout:a,isOptional:n}=i,o=a?this.getLayoutProperty(r):this.getPaintProperty(r);t=null!=o&&o.interpolator?2:null!=o&&o.isDataDriven?1:n&&!o?3:0}o|=t<<n,n+=2}return o<<3|t},t}(),c=function(t){function e(i,e,o,r){var l;return(l=t.call(this,i,e,o,r)||this).backgroundMaterial=new n.VTLBackgroundMaterial(l.computeAttributesKey(a.ShaderProgramType.BACKGROUND,n.VTLBackgroundMaterial.ATTRIBUTES,n.VTLBackgroundMaterial.ATTRIBUTES_INFO)),l}return i._inheritsLoose(e,t),e}(g),D=function(t){function e(i,e,n,o){var l;const s=(l=t.call(this,i,e,n,o)||this).getPaintProperty("fill-color"),u=l.getPaintProperty("fill-opacity"),h=l.getPaintProperty("fill-pattern");l.hasDataDrivenColor=null==s?void 0:s.isDataDriven,l.hasDataDrivenOpacity=null==u?void 0:u.isDataDriven,l.hasDataDrivenFill=l.hasDataDrivenColor||l.hasDataDrivenOpacity||(null==h?void 0:h.isDataDriven);const p=l.getPaintProperty("fill-outline-color");return l.outlineUsesFillColor=!p,l.hasDataDrivenOutlineColor=null==p?void 0:p.isDataDriven,l.hasDataDrivenOutline=p?p.isDataDriven:!!s&&s.isDataDriven,l.hasDataDrivenOutline=(p?l.hasDataDrivenOutlineColor:l.hasDataDrivenColor)||l.hasDataDrivenOpacity,l.fillMaterial=new r.VTLFillMaterial(l.computeAttributesKey(a.ShaderProgramType.FILL,r.VTLFillMaterial.ATTRIBUTES,r.VTLFillMaterial.ATTRIBUTES_INFO)),l.outlineMaterial=new r.VTLOutlineMaterial(l.computeAttributesKey(a.ShaderProgramType.OUTLINE,l.outlineUsesFillColor?r.VTLOutlineMaterial.ATTRIBUTES_FILL:r.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,l.outlineUsesFillColor?r.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:r.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),l.outlineUsesFillColor),l}return i._inheritsLoose(e,t),e}(g),P=function(t){function n(i,e,n,o){var r,s,u,h,p,g,c,D,P,f;const L=(f=t.call(this,i,e,n,o)||this).getPaintProperty("line-pattern");if(f.lineMaterial=new l.VTLLineMaterial(f.computeAttributesKey(a.ShaderProgramType.LINE,l.VTLLineMaterial.ATTRIBUTES,l.VTLLineMaterial.ATTRIBUTES_INFO,L?"line-dasharray":"")),f.hasDataDrivenLine=(null==(r=f.getPaintProperty("line-blur"))?void 0:r.isDataDriven)||(null==(s=f.getPaintProperty("line-color"))?void 0:s.isDataDriven)||(null==(u=f.getPaintProperty("line-gap-width"))?void 0:u.isDataDriven)||(null==(h=f.getPaintProperty("line-offset"))?void 0:h.isDataDriven)||(null==(p=f.getPaintProperty("line-opacity"))?void 0:p.isDataDriven)||(null==(g=f.getPaintProperty("line-pattern"))?void 0:g.isDataDriven)||(null==(c=f.getPaintProperty("line-dasharray"))?void 0:c.isDataDriven)||(null==(D=f.getLayoutProperty("line-cap"))?void 0:D.isDataDriven)||(null==(P=f.getPaintProperty("line-width"))?void 0:P.isDataDriven),f.canUseThinTessellation=!1,!f.hasDataDrivenLine){const t=f.getPaintProperty("line-width");if(!t||"number"==typeof t&&.5*t<y.THIN_LINE_HALF_WIDTH_THRESHOLD){const t=f.getPaintProperty("line-offset");(!t||"number"==typeof t&&0===t)&&(f.canUseThinTessellation=!0)}}return f}return i._inheritsLoose(n,t),n.prototype.getDashKey=function(t,i){let a;switch(i){case e.CapType.BUTT:a="Butt";break;case e.CapType.ROUND:a="Round";break;case e.CapType.SQUARE:a="Square";break;default:a="Butt"}return`dasharray-[${t.toString()}]-${a}`},n}(g),f=function(t){function e(i,e,n,o){var r,l,u,h,p,y,g,c,D,P,f,L,T;return(T=t.call(this,i,e,n,o)||this).iconMaterial=new s.VTLIconMaterial(T.computeAttributesKey(a.ShaderProgramType.ICON,s.VTLIconMaterial.ATTRIBUTES,s.VTLIconMaterial.ATTRIBUTES_INFO)),T.textMaterial=new s.VTLTextMaterial(T.computeAttributesKey(a.ShaderProgramType.TEXT,s.VTLTextMaterial.ATTRIBUTES,s.VTLTextMaterial.ATTRIBUTES_INFO)),T.hasDataDrivenIcon=(null==(r=T.getPaintProperty("icon-color"))?void 0:r.isDataDriven)||(null==(l=T.getPaintProperty("icon-halo-blur"))?void 0:l.isDataDriven)||(null==(u=T.getPaintProperty("icon-halo-color"))?void 0:u.isDataDriven)||(null==(h=T.getPaintProperty("icon-halo-width"))?void 0:h.isDataDriven)||(null==(p=T.getPaintProperty("icon-opacity"))?void 0:p.isDataDriven)||(null==(y=T.getLayoutProperty("icon-size"))?void 0:y.isDataDriven),T.hasDataDrivenText=(null==(g=T.getPaintProperty("text-color"))?void 0:g.isDataDriven)||(null==(c=T.getPaintProperty("text-halo-blur"))?void 0:c.isDataDriven)||(null==(D=T.getPaintProperty("text-halo-color"))?void 0:D.isDataDriven)||(null==(P=T.getPaintProperty("text-halo-width"))?void 0:P.isDataDriven)||(null==(f=T.getPaintProperty("text-opacity"))?void 0:f.isDataDriven)||(null==(L=T.getLayoutProperty("text-size"))?void 0:L.isDataDriven),T}return i._inheritsLoose(e,t),e}(g),L=function(t){function e(i,e,n,r){var l;return(l=t.call(this,i,e,n,r)||this).circleMaterial=new o.VTLCircleMaterial(l.computeAttributesKey(a.ShaderProgramType.CIRCLE,o.VTLCircleMaterial.ATTRIBUTES,o.VTLCircleMaterial.ATTRIBUTES_INFO)),l}return i._inheritsLoose(e,t),e}(g),T=function(){function t(t,i,e){var a,n,o,r,l;let s;this.allowOverlap=t.getLayoutValue("icon-allow-overlap",i),this.ignorePlacement=t.getLayoutValue("icon-ignore-placement",i),this.keepUpright=t.getLayoutValue("icon-keep-upright",i),this.optional=t.getLayoutValue("icon-optional",i),this.rotationAlignment=t.getLayoutValue("icon-rotation-alignment",i),this.rotationAlignment===h.RotationAlignment.AUTO&&(this.rotationAlignment=e?h.RotationAlignment.MAP:h.RotationAlignment.VIEWPORT),s=t.getLayoutProperty("icon-anchor"),null!=(a=s)&&a.isDataDriven?this._anchorProp=s:this.anchor=t.getLayoutValue("icon-anchor",i),s=t.getLayoutProperty("icon-offset"),null!=(n=s)&&n.isDataDriven?this._offsetProp=s:this.offset=t.getLayoutValue("icon-offset",i),s=t.getLayoutProperty("icon-padding"),null!=(o=s)&&o.isDataDriven?this._paddingProp=s:this.padding=t.getLayoutValue("icon-padding",i),s=t.getLayoutProperty("icon-rotate"),null!=(r=s)&&r.isDataDriven?this._rotateProp=s:this.rotate=t.getLayoutValue("icon-rotate",i),s=t.getLayoutProperty("icon-size"),null!=(l=s)&&l.isDataDriven?this._sizeProp=s:this.size=t.getLayoutValue("icon-size",i)}return t.prototype.update=function(t,i){this._anchorProp&&(this.anchor=this._anchorProp.getValue(t,i)),this._offsetProp&&(this.offset=this._offsetProp.getValue(t,i)),this._paddingProp&&(this.padding=this._paddingProp.getValue(t,i)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(t,i)),this._sizeProp&&(this.size=this._sizeProp.getValue(t,i))},t}(),d=function(){function t(t,i,e){var a,n,o,r,l,s,u,p,y,g,c;let D;this.allowOverlap=t.getLayoutValue("text-allow-overlap",i),this.ignorePlacement=t.getLayoutValue("text-ignore-placement",i),this.keepUpright=t.getLayoutValue("text-keep-upright",i),this.optional=t.getLayoutValue("text-optional",i),this.rotationAlignment=t.getLayoutValue("text-rotation-alignment",i),this.rotationAlignment===h.RotationAlignment.AUTO&&(this.rotationAlignment=e?h.RotationAlignment.MAP:h.RotationAlignment.VIEWPORT),D=t.getLayoutProperty("text-anchor"),null!=(a=D)&&a.isDataDriven?this._anchorProp=D:this.anchor=t.getLayoutValue("text-anchor",i),D=t.getLayoutProperty("text-justify"),null!=(n=D)&&n.isDataDriven?this._justifyProp=D:this.justify=t.getLayoutValue("text-justify",i),D=t.getLayoutProperty("text-letter-spacing"),null!=(o=D)&&o.isDataDriven?this._letterSpacingProp=D:this.letterSpacing=t.getLayoutValue("text-letter-spacing",i),D=t.getLayoutProperty("text-line-height"),null!=(r=D)&&r.isDataDriven?this._lineHeightProp=D:this.lineHeight=t.getLayoutValue("text-line-height",i),D=t.getLayoutProperty("text-max-angle"),null!=(l=D)&&l.isDataDriven?this._maxAngleProp=D:this.maxAngle=t.getLayoutValue("text-max-angle",i),D=t.getLayoutProperty("text-max-width"),null!=(s=D)&&s.isDataDriven?this._maxWidthProp=D:this.maxWidth=t.getLayoutValue("text-max-width",i),D=t.getLayoutProperty("text-offset"),null!=(u=D)&&u.isDataDriven?this._offsetProp=D:this.offset=t.getLayoutValue("text-offset",i),D=t.getLayoutProperty("text-padding"),null!=(p=D)&&p.isDataDriven?this._paddingProp=D:this.padding=t.getLayoutValue("text-padding",i),D=t.getLayoutProperty("text-rotate"),null!=(y=D)&&y.isDataDriven?this._rotateProp=D:this.rotate=t.getLayoutValue("text-rotate",i),D=t.getLayoutProperty("text-size"),null!=(g=D)&&g.isDataDriven?this._sizeProp=D:this.size=t.getLayoutValue("text-size",i),D=t.getLayoutProperty("text-writing-mode"),null!=(c=D)&&c.isDataDriven?this._writingModeProp=D:this.writingMode=t.getLayoutValue("text-writing-mode",i)}return t.prototype.update=function(t,i){this._anchorProp&&(this.anchor=this._anchorProp.getValue(t,i)),this._justifyProp&&(this.justify=this._justifyProp.getValue(t,i)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(t,i)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(t,i)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(t,i)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(t,i)),this._offsetProp&&(this.offset=this._offsetProp.getValue(t,i)),this._paddingProp&&(this.padding=this._paddingProp.getValue(t,i)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(t,i)),this._sizeProp&&(this.size=this._sizeProp.getValue(t,i)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(t,i))},t}();t.BackgroundStyleLayer=c,t.CircleStyleLayer=L,t.FillStyleLayer=D,t.IconLayout=T,t.LineStyleLayer=P,t.StyleLayer=g,t.SymbolStyleLayer=f,t.TextLayout=d,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
