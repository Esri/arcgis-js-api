/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../../chunks/expression"],(function(e){"use strict";return function(){function r(e){this._expression=e}return r.prototype.filter=function(e,r){if(!this._expression)return!0;try{return this._expression.evaluate(e,r)}catch(e){return console.log(e.message),!0}},r.createFilter=function(t){if(!t)return null;this.isLegacyFilter(t)&&(t=this.convertLegacyFilter(t));try{return new r(e.createExpression(t))}catch(e){return console.log(e.message),null}},r.isLegacyFilter=function(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":return!0;case"any":case"all":for(let r=1;r<e.length;r++)if(!this.isLegacyFilter(e[1]))return!1;return!0;case"none":return!0;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);case"!has":return!0;default:return!1}},r.convertLegacyFilter=function(e){if(!Array.isArray(e)||0===e.length)return!0;const t=e[0];if(1===e.length)return"any"!==t;switch(t){case"==":return r.convertComparison("==",e[1],e[2]);case"!=":return r.negate(r.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return r.convertComparison(t,e[1],e[2]);case"in":return r.convertIn(e[1],e.slice(2));case"!in":return r.negate(r.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return r.convertCombining(t,e.slice(1));case"has":return r.convertHas(e[1]);case"!has":return r.negate(r.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}},r.convertComparison=function(e,r,t){switch(r){case"$type":return[e,["geometry-type"],t];case"$id":return[e,["id"],t];default:return[e,["get",r],t]}},r.convertIn=function(e,r){switch(e){case"$type":return["in",["geometry-type"],["literal",r]];case"$id":return["in",["id"],["literal",r]];default:return["in",["get",e],["literal",r]]}},r.convertHas=function(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}},r.convertCombining=function(e,r){return[e].concat(r.map(this.convertLegacyFilter))},r.negate=function(e){return["!",e]},r}()}));
