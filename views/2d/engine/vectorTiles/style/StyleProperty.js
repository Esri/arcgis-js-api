/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../../Color","../../../../../chunks/expression","../GeometryUtils"],(function(t,e,r){"use strict";return function(){function i(t,r){let n;switch(this.isDataDriven=!1,t.type){case"number":n=!0;break;case"color":n=!0,r=i._parseColor(r);break;case"array":n="number"===t.value;break;default:n=!1}if(null==r&&(r=t.default),Array.isArray(r)&&r.length>0&&e.ops[r[0]]){try{const i=e.createExpression(r);this.getValue=this._buildExpression(i,t),this.isDataDriven=!0}catch(e){console.log(e.message),this.getValue=this._buildSimple(t.default)}return}n&&"interval"===r.type&&(n=!1);const a=r&&r.stops&&r.stops.length>0;if(a)for(const e of r.stops)e[1]=this._validate(e[1],t);if(this.isDataDriven=!!r&&!!r.property,this.isDataDriven)if(void 0!==r.default&&(r.default=this._validate(r.default,t)),a)switch(r.type){case"identity":this.getValue=this._buildIdentity(r,t);break;case"categorical":this.getValue=this._buildCategorical(r,t);break;default:this.getValue=n?this._buildInterpolate(r,t):this._buildInterval(r,t)}else this.getValue=this._buildIdentity(r,t);else a?this.getValue=n?this._buildZoomInterpolate(r):this._buildZoomInterval(r):(r=this._validate(r,t),this.getValue=this._buildSimple(r))}var n=i.prototype;return n._validate=function(t,e){if("number"===e.type){if(t<e.minimum)return e.minimum;if(t>e.maximum)return e.maximum}return t},n._buildSimple=function(t){return()=>t},n._buildExpression=function(t,e){return(r,n)=>{try{let a=t.evaluate(n,r);return"color"===e.type&&(a=i._parseColor(a)),void 0===a?e.default:this._validate(a,e)}catch(t){return console.log(t.message),e.default}}},n._buildIdentity=function(t,e){return(r,n)=>{let a;return n&&(a=n.values[t.property],"color"===e.type&&(a=i._parseColor(a))),void 0===a&&(a=t.default),void 0!==a?this._validate(a,e):e.default}},n._buildCategorical=function(t,e){return(r,i)=>{let n;return i&&(n=i.values[t.property]),n=this._categorical(n,t.stops),void 0!==n?n:void 0!==t.default?t.default:e.default}},n._buildInterval=function(t,e){return(r,i)=>{let n;return i&&(n=i.values[t.property]),"number"==typeof n?this._interval(n,t.stops):void 0!==t.default?t.default:e.default}},n._buildInterpolate=function(t,e){return(r,i)=>{let n;return i&&(n=i.values[t.property]),"number"==typeof n?this._interpolate(n,t.stops,t.base||1):void 0!==t.default?t.default:e.default}},n._buildZoomInterpolate=function(t){return e=>this._interpolate(e,t.stops,t.base||1)},n._buildZoomInterval=function(t){return e=>this._interval(e,t.stops)},n._categorical=function(t,e){const r=e.length;for(let i=0;i<r;i++)if(e[i][0]===t)return e[i][1]},n._interval=function(t,e){const r=e.length;let i=0;for(let n=0;n<r&&e[n][0]<=t;n++)i=n;return e[i][1]},n._interpolate=function(t,e,i){let n,a;const o=e.length;for(let r=0;r<o;r++){const i=e[r];if(!(i[0]<=t)){a=i;break}n=i}if(n&&a){const e=a[0]-n[0],o=t-n[0],l=1===i?o/e:(Math.pow(i,o)-1)/(Math.pow(i,e)-1);if(Array.isArray(n[1])){const t=n[1],e=a[1],i=[];for(let n=0;n<t.length;n++)i.push(r.interpolate(t[n],e[n],l));return i}return r.interpolate(n[1],a[1],l)}return n?n[1]:a?a[1]:void 0},i._isEmpty=function(t){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0},i._parseColor=function(e){if(Array.isArray(e))return e;if("string"==typeof e){const r=new t(e);return this._isEmpty(r)?void 0:t.toUnitRGBA(r)}return e&&e.default&&(e.default=i._parseColor(e.default)),e&&e.stops&&(e.stops=e.stops.map((t=>[t[0],i._parseColor(t[1])]))),e},i}()}));
