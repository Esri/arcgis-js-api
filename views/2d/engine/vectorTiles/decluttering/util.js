/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../enums","./core"],(function(t,e,o,n,i){"use strict";let l=function(t){this.tile=t,this.parent=null,this.children=new Set},s=function(){function t(){this.nodes=new Map,this.roots=new Set}var e=t.prototype;return e.create=function(t){const e=new l(t);let o;const n=[];if(this.nodes.forEach((t=>{this._canConnectDirectly(e,t)&&n.push(t),!o&&this._canConnectDirectly(t,e)&&(o=t)})),o){for(const t of n)o.children.delete(t),e.children.add(t),t.parent=e;o.children.add(e),e.parent=o}else{this.roots.add(e);for(const t of n)e.children.add(t),t.parent=e,this.roots.delete(t)}return this.nodes.set(t.key.id,e),e},e.destroy=function(t){o.isSome(t.parent)?(t.parent.children.delete(t),t.children.forEach((e=>{o.isSome(t.parent)&&t.parent.children.add(e)}))):this.roots.delete(t),t.children.forEach((e=>{e.parent=t.parent,t.parent||this.roots.add(e)})),this.nodes.delete(t.tile.key.id)},e.clear=function(){this.roots.clear(),this.nodes.clear()},e._canConnectDirectly=function(t,e){let{level:o,row:n,col:i}=e.tile.key;const{world:l}=e.tile.key;for(;o>0;){if(o--,n>>=1,i>>=1,t.tile.key.level===o&&t.tile.key.row===n&&t.tile.key.col===i&&t.tile.key.world===l)return!0;if(this.nodes.has(`${o}/${n}/${i}/${l}`))return!1}return!1},t}();function r(t,e,o,n,i,l){const s=o-i;if(s>=0)return(e>>s)+(n-(l<<s))*(t>>s);const r=-s;return e-(l-(n<<r))*(t>>r)<<r}let c=function(){function t(t,e,o){this._rows=Math.ceil(e/o),this._columns=Math.ceil(t/o),this._cellSize=o,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let t=0;t<this._columns;t++)this.cells[n][t]=[]}}var o=t.prototype;return o.getCell=function(t,e){const o=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[o]&&this.cells[o][n]||null},o.getCellSpan=function(t,e,o,n){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(o/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]},e._createClass(t,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]),t}();function a(t,e,o,n,l,s){const r=e[n++];for(let c=0;c<r;c++){const r=new i.VTLSymbol(s);r.xTile=e[n++],r.yTile=e[n++],r.hash=e[n++],r.priority=e[n++];const c=e[n++];for(let t=0;t<c;t++){const t=e[n++],i=e[n++],l=e[n++],s=e[n++],c=!!e[n++],a=e[n++],h=o[n++],u=o[n++],d=e[n++],f=e[n++];r.colliders.push({xTile:t,yTile:i,dxPixels:l,dyPixels:s,hard:c,partIndex:a,width:d,height:f,minLod:h,maxLod:u})}const a=t[n++];for(let e=0;e<a;e++)r.textVertexRanges.push([t[n++],t[n++]]);const h=t[n++];for(let e=0;e<h;e++)r.iconVertexRanges.push([t[n++],t[n++]]);l.push(r)}return n}function h(t,e,o){for(const[n,i]of t.symbols)u(t,e,o,i,n)}function u(t,e,o,i,l){const s=t.layerData.get(l);if(s.type===n.BucketType.SYMBOL){for(const e of i){const n=e.unique;let i;if(e.selectedForRendering){const e=n.parts[0],l=e.startOpacity,s=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===s;const r=o?Math.floor(127*l)|s<<7:s?255:0;i=r<<24|r<<16|r<<8|r}else i=0;for(const[t,o]of e.iconVertexRanges)for(let e=t;e<t+o;e+=4)s.iconOpacity[e/4]=i;if(e.selectedForRendering){const e=n.parts[1],l=e.startOpacity,s=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===s;const r=o?Math.floor(127*l)|s<<7:s?255:0;i=r<<24|r<<16|r<<8|r}else i=0;for(const[t,o]of e.textVertexRanges)for(let e=t;e<t+o;e+=4)s.textOpacity[e/4]=i}s.lastOpacityUpdate=e,s.opacityChanged=!0}}t.GridIndex=c,t.TileGraph=s,t.TileNode=l,t.deserializeSymbols=a,t.tileCoordChange=r,t.writeOpacityToBuffers=h,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
