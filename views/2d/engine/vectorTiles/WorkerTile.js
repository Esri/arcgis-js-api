/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils","./Placement","./TileParser","../../tiling/enums"],(function(t,e,r,s,n,i){"use strict";let a=function(){function a(t,e,r,n){this.status=i.TileStatus.INITIALIZED,this.placementEngine=new s.PlacementEngine,this.tileKey=t,this.refKeys=e,this._workerTileHandler=r,this._styleRepository=n}var l=a.prototype;return l.release=function(){this.tileKey="",this.refKeys=null,this.status=i.TileStatus.INITIALIZED,this._workerTileHandler=null},l.parse=function(){var s=t._asyncToGenerator((function*(t,s,n){const a=n&&n.signal;if(e.isSome(a)){const t=()=>{a.removeEventListener("abort",t),this.status=i.TileStatus.INVALID};a.addEventListener("abort",t)}let l;try{l=yield this._parse(t,n)}catch(u){if(r.isAbortError(u))throw u;return{result:[],transferList:[]}}this.status=i.TileStatus.READY;const o=[];for(const e of l){const t=e.serialize();o.push(t)}return{result:o,transferList:o.length<=s&&o}}));function n(t,e,r){return s.apply(this,arguments)}return n}(),l.setObsolete=function(){this.status=i.TileStatus.INVALID},l.getLayers=function(){return this._workerTileHandler.getLayers()},l.getWorkerTileHandler=function(){return this._workerTileHandler},l._parse=function(){var e=t._asyncToGenerator((function*(t,e){const r=t.sourceName2DataAndRefKey;if(0===Object.keys(r).length)return[];this.status=i.TileStatus.MODIFIED;return new n(r,this,e.client,this._styleRepository,t.styleLayerUIDs).parse(e)}));function r(t,r){return e.apply(this,arguments)}return r}(),a}();return a}));
