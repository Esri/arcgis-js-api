/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/string","../../../../core/BidiEngine","./GeometryUtils","./style/StyleLayer","../webgl/Geometry","./BaseBucket","./TextShaping","./Placement"],(function(e,t,n,i,o,a,s,r,l){"use strict";function h(e,t){return e.iconMosaicItem&&t.iconMosaicItem?e.iconMosaicItem.page===t.iconMosaicItem.page?0:e.iconMosaicItem.page-t.iconMosaicItem.page:e.iconMosaicItem&&!t.iconMosaicItem?1:!e.iconMosaicItem&&t.iconMosaicItem?-1:0}let c=function(n){function s(e,t,i,o,a,s,r,l){var h;if((h=n.call(this,e,t)||this).type=3,h._markerMap=new Map,h._glyphMap=new Map,h._glyphBufferDataStorage=new Map,h._isIconSDF=!1,e.hasDataDrivenIcon!==i.isDataDriven())throw new Error("incompatible icon buffer");if(e.hasDataDrivenText!==a.isDataDriven())throw new Error("incompatible text buffer");return h._iconVertexBuffer=i,h._iconIndexBuffer=o,h._textVertexBuffer=a,h._textIndexBuffer=s,h._placementEngine=r,h._workerTileHandler=l,h}e._inheritsLoose(s,n);var c=s.prototype;return c.getResources=function(e,n,i){const o=this.layer,a=this.zoom,r=o.hasDataDrivenIcon,l=o.hasDataDrivenText;e&&e.setExtent(this.layerExtent);const h=o.getLayoutProperty("icon-image"),c=o.getLayoutProperty("text-field"),x=[];let f,g,y,d,u,m,p,_,I,P,M=[1,1,1,1],L=1,b=1,V=[1,1,1,1],A=1,D=1;for(const w of this._features){const S=w.getGeometry(e);if(!S||0===S.length)continue;let B,z;h&&(B=o.getLayoutValue("icon-image",a,w),h.isDataDriven||(B=this._replaceKeys(B,w.values)),B&&(n.add(B),f=o.getLayoutValue("icon-rotate",a,w),g=o.getLayoutValue("icon-anchor",a,w),y=o.getLayoutValue("icon-offset",a,w)));let C=!1;if(c&&(z=o.getLayoutValue("text-field",a,w),z&&!c.isDataDriven&&(z=this._replaceKeys(z,w.values)),z)){z=z.replace(/\\n/g,"\n");switch(o.getLayoutValue("text-transform",a,w)){case 2:z=z.toLowerCase();break;case 1:z=z.toUpperCase()}if(s._bidiEngine.hasBidiChar(z)){let e;e="rtl"===s._bidiEngine.checkContextual(z)?"IDNNN":"ICNNN",z=s._bidiEngine.bidiTransform(z,e,"VLYSN"),C=!0}const e=z.length;if(e>0){P=o.getLayoutValue("text-font",a,w);for(const t of P){let n=i[t];n||(n=i[t]=new Set);for(let t=0;t<e;t++){const e=z.charCodeAt(t);n.add(e)}}d=o.getLayoutValue("text-rotate",a,w),u=o.getLayoutValue("text-anchor",a,w),m=o.getLayoutValue("text-offset",a,w),p=o.getLayoutValue("text-justify",a,w),_=o.getLayoutValue("text-letter-spacing",a,w),I=o.getLayoutValue("text-max-width",a,w)}}if(!B&&!z)continue;const E=o.getLayoutValue("icon-size",a,w),T=o.getLayoutValue("text-size",a,w);o.hasDataDrivenIconColor&&(M=o.getPaintValue("icon-color",a,w)),o.hasDataDrivenIconOpacity&&(L=o.getPaintValue("icon-opacity",a,w)),o.hasDataDrivenIconSize&&(b=E),o.hasDataDrivenTextColor&&(V=o.getPaintValue("text-color",a,w)),o.hasDataDrivenTextOpacity&&(A=o.getPaintValue("text-opacity",a,w)),o.hasDataDrivenTextSize&&(D=T);const R=o.getLayoutValue("symbol-sort-key",a,w),k={sprite:B,label:z,rtl:C,type:w.type,geometry:S,hash:(z?t.numericHash(z):0)^(B?t.numericHash(B):0),priority:R,iconSize:E,iconRotate:f,ddIconValues:r?{color:M,opacity:L,size:b}:null,iconAnchor:g,iconOffset:y,textSize:T,textRotate:d,ddTextValues:l?{color:V,opacity:A,size:D}:null,textAnchor:u,textOffset:m,textJustify:p,textLetterSpacing:_,textMaxWidth:I,textFontArray:P};x.push(k)}this._symbolFeatures=x},c.processFeatures=function(e){e&&e.setExtent(this.layerExtent);const t=this.layer,n=this.zoom,a=t.getLayoutValue("symbol-placement",n),c=0!==a,x=t.getLayoutValue("symbol-spacing",n)*l.TILE_PIXEL_RATIO,f=t.getLayoutProperty("icon-image"),g=t.getLayoutProperty("text-field"),y=f?new o.IconLayout(t,n,c):null,d=g?new o.TextLayout(t,n,c):null,u=this._workerTileHandler;let m;f&&(m=u.getSpriteItems()),this._iconIndexStart=3*this._iconIndexBuffer.index,this._textIndexStart=3*this._textIndexBuffer.index,this._iconIndexCount=0,this._textIndexCount=0,this._markerMap.clear(),this._glyphMap.clear();const p=[];let _=1;d&&d.size&&(_=d.size/r.SDF_GLYPH_SIZE);const I=d?d.maxAngle*i.C_DEG_TO_RAD:0,P=d?d.size*l.TILE_PIXEL_RATIO:0;for(const e of this._symbolFeatures){let t;y&&m&&e.sprite&&(t=m[e.sprite],t&&t.sdf&&(this._isIconSDF=!0));let n;!!t&&(y.size=e.iconSize,y.rotate=e.iconRotate,y.offset=e.iconOffset);let i=0;const o=e.label;if(o){d.size=e.textSize,d.rotate=e.textRotate,d.anchor=e.textAnchor,d.fontArray=e.textFontArray,d.justify=e.textJustify,d.letterSpacing=e.textLetterSpacing,d.maxWidth=e.textMaxWidth,d.offset=e.textOffset;const t=c?d.keepUpright:d.writingMode&&d.writingMode.indexOf(1)>=0;let a=.5;switch(d.anchor){case 5:case 1:case 7:a=0;break;case 6:case 2:case 8:a=1}let s=.5;switch(d.anchor){case 5:case 3:case 6:s=0;break;case 7:case 4:case 8:s=1}let h=.5;switch(d.justify){case 0:h=a;break;case 1:h=0;break;case 3:h=1}const x=d.letterSpacing*r.SDF_GLYPH_SIZE,f=c?0:d.maxWidth*r.SDF_GLYPH_SIZE,g=d.lineHeight*r.SDF_GLYPH_SIZE;let y,m;if(y=d.fontArray.map((e=>u.getGlyphItems(e))),m=new r.TextShaping(y,f,g,x,a,s,h),n=m.getShaping(o,e.rtl,t),n&&n.length>0){let e=1e30,t=-1e30;for(const i of n)e=Math.min(e,i.x),t=Math.max(t,i.x);i=(t-e+2*r.SDF_GLYPH_SIZE)*_*l.TILE_PIXEL_RATIO}}for(let o of e.geometry){const r=[];if(1===a){if(n&&n.length>0&&d&&d.size){const e=d.size*l.TILE_PIXEL_RATIO*(2+Math.min(2,4*Math.abs(d.offset[1])));o=s._smoothVertices(o,e)}s._pushAnchors(r,o,x,i)}else 2===a?s._pushCenterAnchor(r,o):3===e.type?s._pushCentroid(r,o):r.push(new l.Anchor(o[0].x,o[0].y));for(const a of r){if(a.x<0||a.x>l.TILE_COORD_SIZE||a.y<0||a.y>l.TILE_COORD_SIZE)continue;if(c&&i>0&&0===d.rotationAlignment&&!s._honorsTextMaxAngle(o,a,i,I,P))continue;const r={shaping:n,line:o,iconMosaicItem:t,anchor:a,symbolFeature:e,textColliders:[],iconColliders:[],textVertexRanges:[],iconVertexRanges:[]};p.push(r),this._processFeature(r,y,d)}}}p.sort(h),this._addPlacedGlyphs(),this._symbolInstances=p},c.serialize=function(){let e=13;e+=this.layerUIDs.length,e+=3*this.markerPageMap.size,e+=3*this.glyphsPageMap.size,e+=s.symbolsSerializationLength(this._symbolInstances),e+=this._iconVertexBuffer.array.length,e+=this._iconIndexBuffer.array.length,e+=this._textVertexBuffer.array.length,e+=this._textIndexBuffer.array.length;let t=0;const n=new Uint32Array(e),i=new Int32Array(n.buffer),o=new Float32Array(n.buffer);n[t++]=this.type,n[t++]=this.layerUIDs.length;for(let e=0;e<this.layerUIDs.length;e++)n[t++]=this.layerUIDs[e];n[t++]=this._isIconSDF?1:0,n[t++]=this._iconVertexBuffer.isDataDriven()?1:0,n[t++]=this._textVertexBuffer.isDataDriven()?1:0,n[t++]=this.markerPageMap.size,this.markerPageMap.forEach((([e,i],o)=>{n[t++]=o,n[t++]=e,n[t++]=i})),n[t++]=this.glyphsPageMap.size,this.glyphsPageMap.forEach((([e,i],o)=>{n[t++]=o,n[t++]=e,n[t++]=i})),n[t++]=this._iconVertexBuffer.index/4,n[t++]=this._textVertexBuffer.index/4,t=s.serializeSymbols(n,i,o,t,this._symbolInstances),n[t++]=this._iconVertexBuffer.array.length;for(let e=0;e<this._iconVertexBuffer.array.length;e++)i[t++]=this._iconVertexBuffer.array[e];n[t++]=this._iconIndexBuffer.array.length;for(let e=0;e<this._iconIndexBuffer.array.length;e++)n[t++]=this._iconIndexBuffer.array[e];n[t++]=this._textVertexBuffer.array.length;for(let e=0;e<this._textVertexBuffer.array.length;e++)i[t++]=this._textVertexBuffer.array[e];n[t++]=this._textIndexBuffer.array.length;for(let e=0;e<this._textIndexBuffer.array.length;e++)n[t++]=this._textIndexBuffer.array[e];return n.buffer},s.symbolsSerializationLength=function(e){let t=0;t+=1;for(const n of e||[]){t+=4,t+=1;for(const e of n.textColliders)t+=10;for(const e of n.iconColliders)t+=10;t+=1,t+=2*n.textVertexRanges.length,t+=1,t+=2*n.iconVertexRanges.length}return t},s.serializeSymbols=function(e,t,n,i,o){o=o||[],t[i++]=o.length;for(const e of o){t[i++]=e.anchor.x,t[i++]=e.anchor.y,t[i++]=e.symbolFeature.hash,t[i++]=e.symbolFeature.priority,t[i++]=e.textColliders.length+e.iconColliders.length;for(const o of e.textColliders)t[i++]=o.xTile,t[i++]=o.yTile,t[i++]=o.dxPixels,t[i++]=o.dyPixels,t[i++]=o.hard?1:0,t[i++]=o.partIndex,n[i++]=o.minLod,n[i++]=o.maxLod,t[i++]=o.width,t[i++]=o.height;for(const o of e.iconColliders)t[i++]=o.xTile,t[i++]=o.yTile,t[i++]=o.dxPixels,t[i++]=o.dyPixels,t[i++]=o.hard?1:0,t[i++]=o.partIndex,n[i++]=o.minLod,n[i++]=o.maxLod,t[i++]=o.width,t[i++]=o.height;t[i++]=e.textVertexRanges.length;for(const[n,o]of e.textVertexRanges)t[i++]=n,t[i++]=o;t[i++]=e.iconVertexRanges.length;for(const[n,o]of e.iconVertexRanges)t[i++]=n,t[i++]=o}return i},c._replaceKeys=function(e,t){return e.replace(/{([^{}]+)}/g,(function(e,n){return n in t?t[n]:""}))},c._processFeature=function(e,t,n){const o=e.line,a=e.iconMosaicItem,s=e.shaping,r=e.anchor,l=!!a;let h=!0;l&&(h=t.optional||!a);const c=s&&s.length>0;let x,f,g=!0;if(c&&(g=n.optional||!s||0===s.length),l&&(x=this._placementEngine.getIconPlacement(r,a,t)),(x||h)&&(c&&(f=this._placementEngine.getTextPlacement(r,s,o,n)),f||g)){if(x&&f||(g||h?g||f?h||x||(f=null):x=null:(x=null,f=null)),f&&(this._storePlacedGlyphs(e,f.shapes,this.zoom,n.rotationAlignment),f.textColliders)){e.textColliders=f.textColliders;for(const e of f.textColliders){e.minLod=Math.max(this.zoom+i.log2(e.minLod),0),e.maxLod=Math.min(this.zoom+i.log2(e.maxLod),25);const t=e.angle;if(t){const n=Math.cos(t),i=Math.sin(t),o=e.dxPixels*n-e.dyPixels*i,a=e.dxPixels*i+e.dyPixels*n,s=(e.dxPixels+e.width)*n-e.dyPixels*i,r=(e.dxPixels+e.width)*i+e.dyPixels*n,l=e.dxPixels*n-(e.dyPixels+e.height)*i,h=e.dxPixels*i+(e.dyPixels+e.height)*n,c=(e.dxPixels+e.width)*n-(e.dyPixels+e.height)*i,x=(e.dxPixels+e.width)*i+(e.dyPixels+e.height)*n,f=Math.min(o,s,l,c),g=Math.max(o,s,l,c),y=Math.min(a,r,h,x),d=Math.max(a,r,h,x);e.dxPixels=f,e.dyPixels=y,e.width=g-f,e.height=d-y}}}if(x&&(this._addPlacedIcons(e,x.shapes,this.zoom,a.page,1===t.rotationAlignment),x.iconColliders)){e.iconColliders=x.iconColliders;for(const e of x.iconColliders){e.minLod=Math.max(this.zoom+i.log2(e.minLod),0),e.maxLod=Math.min(this.zoom+i.log2(e.maxLod),25);const t=e.angle;if(t){const n=Math.cos(t),i=Math.sin(t),o=e.dxPixels*n-e.dyPixels*i,a=e.dxPixels*i+e.dyPixels*n,s=(e.dxPixels+e.width)*n-e.dyPixels*i,r=(e.dxPixels+e.width)*i+e.dyPixels*n,l=e.dxPixels*n-(e.dyPixels+e.height)*i,h=e.dxPixels*i+(e.dyPixels+e.height)*n,c=(e.dxPixels+e.width)*n-(e.dyPixels+e.height)*i,x=(e.dxPixels+e.width)*i+(e.dyPixels+e.height)*n,f=Math.min(o,s,l,c),g=Math.max(o,s,l,c),y=Math.min(a,r,h,x),d=Math.max(a,r,h,x);e.dxPixels=f,e.dyPixels=y,e.width=g-f,e.height=d-y}}}}},c._addPlacedIcons=function(e,t,n,o,a){const s=e.symbolFeature.ddIconValues,r=Math.max(n-1,0),l=this._iconVertexBuffer,h=this._iconIndexBuffer,c=this._markerMap;for(const x of t){const t=a?0:Math.max(n+i.log2(x.minzoom),r),f=a?25:Math.min(n+i.log2(x.maxzoom),25);if(f<=t)continue;const g=x.tl,y=x.tr,d=x.bl,u=x.br,m=x.mosaicRect,p=x.labelAngle,_=x.minAngle,I=x.maxAngle,P=x.anchor,M=l.index,L=m.x,b=m.y,V=L+m.width,A=b+m.height,D=l.index;l.add(P.x,P.y,g.x,g.y,L,b,p,_,I,t,f,s),l.add(P.x,P.y,y.x,y.y,V,b,p,_,I,t,f,s),l.add(P.x,P.y,d.x,d.y,L,A,p,_,I,t,f,s),l.add(P.x,P.y,u.x,u.y,V,A,p,_,I,t,f,s),e.iconVertexRanges.length>0&&e.iconVertexRanges[0][0]+e.iconVertexRanges[0][1]===D?e.iconVertexRanges[0][1]+=4:e.iconVertexRanges.push([D,4]),h.add(M+0,M+1,M+2),h.add(M+1,M+2,M+3),c.has(o)?c.get(o)[1]+=6:c.set(o,[this._iconIndexStart+this._iconIndexCount,6]),this._iconIndexCount+=6}},c._addPlacedGlyphs=function(){const e=this._textVertexBuffer,t=this._textIndexBuffer,n=this._glyphMap;this._glyphBufferDataStorage.forEach(((i,o)=>{for(const a of i){const i=e.index,s=a.symbolInstance,r=s.symbolFeature.ddTextValues,l=e.index;e.add(a.glyphAnchor[0],a.glyphAnchor[1],a.tl[0],a.tl[1],a.xmin,a.ymin,a.labelAngle,a.minAngle,a.maxAngle,a.minLod,a.maxLod,r),e.add(a.glyphAnchor[0],a.glyphAnchor[1],a.tr[0],a.tr[1],a.xmax,a.ymin,a.labelAngle,a.minAngle,a.maxAngle,a.minLod,a.maxLod,r),e.add(a.glyphAnchor[0],a.glyphAnchor[1],a.bl[0],a.bl[1],a.xmin,a.ymax,a.labelAngle,a.minAngle,a.maxAngle,a.minLod,a.maxLod,r),e.add(a.glyphAnchor[0],a.glyphAnchor[1],a.br[0],a.br[1],a.xmax,a.ymax,a.labelAngle,a.minAngle,a.maxAngle,a.minLod,a.maxLod,r),s.textVertexRanges.length>0&&s.textVertexRanges[0][0]+s.textVertexRanges[0][1]===l?s.textVertexRanges[0][1]+=4:s.textVertexRanges.push([l,4]),t.add(i+0,i+1,i+2),t.add(i+1,i+2,i+3),n.has(o)?n.get(o)[1]+=6:n.set(o,[this._textIndexStart+this._textIndexCount,6]),this._textIndexCount+=6}})),this._glyphBufferDataStorage.clear()},c._storePlacedGlyphs=function(e,t,n,o){const a=Math.max(n-1,0),s=1===o;let r,l,h,c,x,f,g,y,d,u,m;for(const o of t){if(r=s?0:Math.max(n+i.log2(o.minzoom),a),l=s?25:Math.min(n+i.log2(o.maxzoom),25),l<=r)continue;h=o.tl,c=o.tr,x=o.bl,f=o.br,g=o.labelAngle,y=o.minAngle,d=o.maxAngle,u=o.anchor,m=o.mosaicRect,this._glyphBufferDataStorage.has(o.page)||this._glyphBufferDataStorage.set(o.page,[]);this._glyphBufferDataStorage.get(o.page).push({glyphAnchor:[u.x,u.y],tl:[h.x,h.y],tr:[c.x,c.y],bl:[x.x,x.y],br:[f.x,f.y],xmin:m.x,ymin:m.y,xmax:m.x+m.width,ymax:m.y+m.height,labelAngle:g,minAngle:y,maxAngle:d,minLod:r,maxLod:l,placementLod:a,symbolInstance:e})}},s._pushAnchors=function(e,t,n,o){n+=o;let s=0;const r=t.length-1;for(let e=0;e<r;e++)s+=a.Point.distance(t[e],t[e+1]);let h=o||n;if(h*=.5,s<=h)return;const c=h/s;let x=0,f=-(n=s/Math.max(Math.round(s/n),1))/2;const g=t.length-1;for(let o=0;o<g;o++){const a=t[o],s=t[o+1],r=s.x-a.x,h=s.y-a.y,g=Math.sqrt(r*r+h*h);let y;for(;f+n<x+g;){f+=n;const t=(f-x)/g,d=i.interpolate(a.x,s.x,t),u=i.interpolate(a.y,s.y,t);void 0===y&&(y=Math.atan2(h,r)),e.push(new l.Anchor(d,u,y,o,c))}x+=g}},s._pushCenterAnchor=function(e,t){let n=0;const o=t.length-1;for(let e=0;e<o;e++)n+=a.Point.distance(t[e],t[e+1]);const s=n/2;let r=0;const h=t.length-1;for(let n=0;n<h;n++){const o=t[n],a=t[n+1],h=a.x-o.x,c=a.y-o.y,x=Math.sqrt(h*h+c*c);if(s<r+x){const t=(s-r)/x,f=i.interpolate(o.x,a.x,t),g=i.interpolate(o.y,a.y,t),y=Math.atan2(c,h);return void e.push(new l.Anchor(f,g,y,n,0))}r+=x}},s._deviation=function(e,t,n){const i=(t.x-e.x)*(n.x-t.x)+(t.y-e.y)*(n.y-t.y),o=(t.x-e.x)*(n.y-t.y)-(t.y-e.y)*(n.x-t.x);return Math.atan2(o,i)},s._honorsTextMaxAngle=function(e,t,n,i,o){let s=0;const r=n/2;let l=new a.Point(t.x,t.y),h=t.segment+1;for(;s>-r;){if(--h,h<0)return!1;s-=a.Point.distance(e[h],l),l=e[h]}s+=a.Point.distance(e[h],e[h+1]);const c=[];let x=0;const f=e.length;for(;s<r;){const t=e[h];let n,r=h;do{if(++r,r===f)return!1;n=e[r]}while(n.isEqual(t));let l,g=r;do{if(++g,g===f)return!1;l=e[g]}while(l.isEqual(n));const y=this._deviation(t,n,l);for(c.push({deviation:y,distToAnchor:s}),x+=y;s-c[0].distToAnchor>o;)x-=c.shift().deviation;if(Math.abs(x)>i)return!1;s+=a.Point.distance(n,l),h=r}return!0},s._smoothVertices=function(e,t){if(t<=0)return e;let n=e.length;if(n<3)return e;const i=[];let o=0,s=0;i.push(0);for(let t=1;t<n;t++){const n=a.Point.distance(e[t],e[t-1]);n>0&&(o+=n,i.push(o),s++,s!==t&&(e[s]=e[t]))}if(n=s+1,n<3)return e;t=Math.min(t,.2*o);const r=e[0].x,l=e[0].y,h=e[n-1].x,c=e[n-1].y,x=a.Point.sub(e[0],e[1]);x.normalize(),e[0].x+=t*x.x,e[0].y+=t*x.y,x.assignSub(e[n-1],e[n-2]),x.normalize(),e[n-1].x+=t*x.x,e[n-1].y+=t*x.y,i[0]-=t,i[n-1]+=t;const f=[];f.push(new a.Point(r,l));const g=1e-6,y=.5*t;for(let o=1;o<n-1;o++){let s=0,r=0,l=0;for(let n=o-1;n>=0;n--){const a=y+i[n+1]-i[o];if(a<0)break;const h=i[n+1]-i[n],c=i[o]-i[n]<y?1:a/h;if(c<g)break;const x=c*c,f=c*a-.5*x*h,d=c*h/t,u=e[n+1],m=e[n].x-u.x,p=e[n].y-u.y;s+=d/f*(u.x*c*a+.5*x*(a*m-h*u.x)-x*c*h*m/3),r+=d/f*(u.y*c*a+.5*x*(a*p-h*u.y)-x*c*h*p/3),l+=d}for(let a=o+1;a<n;a++){const n=y-i[a-1]+i[o];if(n<0)break;const h=i[a]-i[a-1],c=i[a]-i[o]<y?1:n/h;if(c<g)break;const x=c*c,f=c*n-.5*x*h,d=c*h/t,u=e[a-1],m=e[a].x-u.x,p=e[a].y-u.y;s+=d/f*(u.x*c*n+.5*x*(n*m-h*u.x)-x*c*h*m/3),r+=d/f*(u.y*c*n+.5*x*(n*p-h*u.y)-x*c*h*p/3),l+=d}f.push(new a.Point(s/l,r/l))}return f.push(new a.Point(h,c)),e[0].x=r,e[0].y=l,e[n-1].x=h,e[n-1].y=c,f},s._pushCentroid=function(e,t){const n=4096,i=4096,o=t.length-1;let a=0,s=0,r=0,h=t[0].x,c=t[0].y;h>n&&(h=n),h<0&&(h=0),c>i&&(c=i),c<0&&(c=0);for(let e=1;e<o;e++){let o=t[e].x,l=t[e].y,x=t[e+1].x,f=t[e+1].y;o>n&&(o=n),o<0&&(o=0),l>i&&(l=i),l<0&&(l=0),x>n&&(x=n),x<0&&(x=0),f>i&&(f=i),f<0&&(f=0);const g=(o-h)*(f-c)-(x-h)*(l-c);a+=g*(h+o+x),s+=g*(c+l+f),r+=g}a/=3*r,s/=3*r,isNaN(a)||isNaN(s)||e.push(new l.Anchor(a,s))},e._createClass(s,[{key:"markerPageMap",get:function(){return this._markerMap}},{key:"glyphsPageMap",get:function(){return this._glyphMap}},{key:"symbolInstances",get:function(){return this._symbolInstances}}]),s}(s);return c._bidiEngine=new n,c}));
