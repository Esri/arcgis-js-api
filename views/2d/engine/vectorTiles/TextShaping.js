/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../webgl/Rect","./ScriptUtils"],(function(t,i,e){"use strict";let c=function(){function t(t,i,e,c,n,h,s){this._glyphItems=t,this._maxWidth=i,this._lineHeight=e,this._letterSpacing=c,this._hAnchor=n,this._vAnchor=h,this._justify=s}var c=t.prototype;return c.getShaping=function(t,i,c){const n=this._letterSpacing,h=this._lineHeight,s=this._justify,o=this._maxWidth,a=[];let l=0,r=0,f=0,m=0,g=-1,p=0,y=-1;const u=t.length;for(let x=0;x<u;x++){const d=t.charCodeAt(x),M=c&&e.hasVerticalOrientation(d);if(10===d){if(x===u-1)continue;if(g>=m){const t=a[g],i=t.x+t.glyphMosaicItem.metrics.advance;p=Math.max(i,p),s&&this._applyJustification(a,m,g),m=a.length}i?r-=h:r+=h,l=0,++f;continue}let _;for(const t of this._glyphItems)if(_=t[d],_)break;if(_){if(a.push({codePoint:d,x:l,y:r,vertical:M,glyphMosaicItem:_}),l+=_.metrics.advance+n,o>0&&l>o&&y>=0){const t=y+1,e=a[t].x;p=Math.max(e,p);for(let c=t;c<a.length;c++)i?a[c].y-=h:a[c].y+=h,a[c].x-=e;s&&this._applyJustification(a,m,y),i?r-=h:r+=h,l-=e,++f,m=t,y=-1}++g,32===d&&(y=a.length-1)}}if(g>=m){const t=a[g],i=t.x+t.glyphMosaicItem.metrics.advance;p=Math.max(p,i),s&&this._applyJustification(a,m,g)}if(a.length>0){const t=(s-this._hAnchor)*p;let e=(-this._vAnchor*(f+1)+.5)*h;i&&f&&(e+=f*h);for(const i of a)i.x+=t,i.y+=e}return a},t.getTextBox=function(t,i){if(!t.length)return null;let e=1/0,c=1/0,n=0,h=0;for(const s of t){const t=s.glyphMosaicItem.metrics.advance,o=s.x,a=s.y-17,l=o+t,r=a+i;e=Math.min(e,o),n=Math.max(n,l),c=Math.min(c,a),h=Math.max(h,r)}return{x:e,y:c,width:n-e,height:h-c}},t.getBox=function(t){if(!t.length)return null;let i=1/0,e=1/0,c=0,n=0;for(const h of t){const{height:t,left:s,top:o,width:a}=h.glyphMosaicItem.metrics,l=h.x,r=h.y-(t-Math.abs(o)),f=l+a+s,m=r+t;i=Math.min(i,l),c=Math.max(c,f),e=Math.min(e,r),n=Math.max(n,m)}return{x:i,y:e,width:c-i,height:n-e}},t.addDecoration=function(t,e){const c=t.length;if(0===c)return;let n=t[0].x+t[0].glyphMosaicItem.metrics.left,h=t[0].y;for(let s=1;s<c;s++){const c=t[s];if(c.y!==h){const o=t[s-1].x+t[s-1].glyphMosaicItem.metrics.left+t[s-1].glyphMosaicItem.metrics.width;t.push({codePoint:0,x:n,y:h+e-3,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new i(4,0,4,8),metrics:{width:o-n,height:8,left:0,top:0,advance:0},page:0,code:0}}),h=c.y,n=c.x+c.glyphMosaicItem.metrics.left}}const s=t[c-1].x+t[c-1].glyphMosaicItem.metrics.left+t[c-1].glyphMosaicItem.metrics.width;t.push({codePoint:0,x:n,y:h+e-3,vertical:!1,glyphMosaicItem:{sdf:!0,rect:new i(4,0,4,8),metrics:{width:s-n,height:8,left:0,top:0,advance:0},page:0,code:0}})},c._applyJustification=function(t,i,e){const c=t[e],n=c.vertical?24:c.glyphMosaicItem.metrics.advance,h=(c.x+n)*this._justify;for(let c=i;c<=e;c++)t[c].x-=h},t}();t.SDF_GLYPH_BASELINE=17,t.SDF_GLYPH_SIZE=24,t.TextShaping=c,Object.defineProperty(t,"__esModule",{value:!0})}));
