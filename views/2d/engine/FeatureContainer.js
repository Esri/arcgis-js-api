/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/promiseUtils","../../../geometry/support/aaBoundingRect","../../../core/Queue","./webgl/TileData","./webgl/WGLTile","./webgl/AttributeStoreView","./webgl/TileContainer","./webgl/WGLRendererInfo"],(function(e,t,r,i,n,s,a,o,l,u){"use strict";let d=function(e){function l(t){var r;return(r=e.call(this,t)||this)._rendererInfo=new u.WGLRendererInfo,r._materialItemsRequestQueue=new n,r.attributeView=new o.AttributeStoreView,r}t._inheritsLoose(l,e);var d=l.prototype;return d.destroy=function(){this.removeAllChildren(),this.children.forEach((e=>e.destroy())),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()},d.setRendererInfo=function(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()},d.getMaterialItems=async function(e,t){if(!e||0===e.length)return null;const i=r.createResolver();return this._materialItemsRequestQueue.push({items:e,abortOptions:t,resolver:i}),this.requestRender(),i.promise},d.onTileData=function(e,t){if(t.addOrUpdate&&"tileDisplayData"in t.addOrUpdate)e.setData(t);else{const r=t.addOrUpdate&&s.TileData.decode(t.addOrUpdate),i={...t,addOrUpdate:r};e.setData(i)}this.contains(e)||this.addChild(e),this.requestRender()},d.onTileError=function(e){e.clear(),this.contains(e)||this.addChild(e)},d.doRender=function(t){if(t.context.capabilities.textureFloat,t.context.capabilities.vao,this._materialItemsRequestQueue.length>0){let e=this._materialItemsRequestQueue.pop();for(;e;)this._processMaterialItemRequest(t,e),e=this._materialItemsRequestQueue.pop()}e.prototype.doRender.call(this,t)},d.renderChildren=function(t){for(const e of this.children)e.commitChanges(t);this._rendererInfo.update(t.state),e.prototype.renderChildren.call(this,t)},d.createTile=function(e){const t=this._tileInfoView.getTileBounds(i.create(),e);return new a.WGLTile(e,t)},d.destroyTile=function(e){this.removeChild(e),e.destroy()},d.createRenderParams=function(t){return{...e.prototype.createRenderParams.call(this,t),rendererInfo:this._rendererInfo,attributeView:this.attributeView}},d._processMaterialItemRequest=function(e,{items:t,abortOptions:i,resolver:n}){const{painter:s,pixelRatio:a}=e,o=t.map((e=>s.textureManager.rasterizeItem(e.symbol,a,e.glyphIds,i)));r.all(o).then((e=>{if(!this.stage)return void n.reject();const r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));n.resolve(r)}),n.reject)},l}(l.default);e.FeatureContainer=d,Object.defineProperty(e,"__esModule",{value:!0})}));
