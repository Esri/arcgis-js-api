/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/scheduling","../../core/Accessor","../../geometry/Point","../../geometry","../../Viewpoint","./unitBezier","../ViewAnimation","./viewpointUtils"],(function(t,i,e,s,n,o,a,r,h,p,c,u,d,l,m,w,y,_){"use strict";let v=function(){function t(t,i,e,s){const n=t.targetGeometry,o=i.targetGeometry;s?"string"==typeof s&&(s=w.parse(s)||w.easingFunctions.ease):s=w.easingFunctions.ease,this.easing=s,this.duration=e,this.sCenterX=n.x,this.sCenterY=n.y,this.sScale=t.scale,this.sRotation=t.rotation,this.tCenterX=o.x,this.tCenterY=o.y,this.tScale=i.scale,this.tRotation=i.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}return t.prototype.applyRatio=function(t,i){const e=this.easing(i);let s,n,o,a;i>=1?(s=this.tCenterX,n=this.tCenterY,o=this.tRotation,a=this.tScale):(s=this.sCenterX+e*this.dCenterX,n=this.sCenterY+e*this.dCenterY,o=this.sRotation+e*this.dRotation,a=this.sScale+e*this.dScale),t.targetGeometry.x=s,t.targetGeometry.y=n,t.scale=a,t.rotation=o},t}(),g=function(i){function e(e){var s;return(s=i.call(this,e)||this).duration=200,s.transition=null,s.easing=w.easingFunctions.ease,s.view=null,s.viewpoint=null,s.viewpoint=new m({targetGeometry:new d,scale:0,rotation:0}),s._updateTask=c.addFrameTask({postRender:s._postRender.bind(t._assertThisInitialized(s))}),s._updateTask.pause(),s}t._inheritsLoose(e,i);var s=e.prototype;return s.destroy=function(){this._updateTask.remove(),this._updateTask=null},s.animate=function(t,i,e){this.stop();const s=this.viewpoint;_.copy(s,i),this.transition=new v(this.viewpoint,t.target,e&&e.duration||this.duration,e&&e.easing||this.easing);const n=()=>{this.animation===t&&this._updateTask&&("finished"===t.state&&(this.transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return t.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=t,t},s.animateContinous=function(t,i){this.stop(),this.updateFunction=i,this.viewpoint=t;const e=new y({target:t.clone()}),s=()=>{this.animation===e&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return e.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e},s.stop=function(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)},s._postRender=function(t){const i=this.animation;if(i&&i.state!==y.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,t.deltaTime);else{const t=(performance.now()-this._startTime)/this.transition.duration,i=t>=1;this.transition.applyRatio(this.viewpoint,t),i&&this.animation.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()},e}(u);return i.__decorate([o.property()],g.prototype,"animation",void 0),i.__decorate([o.property()],g.prototype,"duration",void 0),i.__decorate([o.property()],g.prototype,"transition",void 0),i.__decorate([o.property()],g.prototype,"easing",void 0),i.__decorate([o.property()],g.prototype,"view",void 0),i.__decorate([o.property()],g.prototype,"viewpoint",void 0),g=i.__decorate([a.subclass("esri.views.2d.AnimationManager")],g),g}));
