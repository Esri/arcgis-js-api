/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../geometry","../../Viewpoint","../../core/Accessor","../../core/maybe","../../core/scheduling","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/accessorSupport/decorators/subclass","../ViewAnimation","./unitBezier","./viewpointUtils","../../geometry/Point"],(function(t,i,e,n,s,o,a,r,h,p,c,u,d,l,m){"use strict";let y=function(){function t(t,i,e,n){const s=t.targetGeometry,o=i.targetGeometry;n?"string"==typeof n&&(n=d.parse(n)||d.easingFunctions.ease):n=d.easingFunctions.ease,this.easing=n,this.duration=e,this.sCenterX=s.x,this.sCenterY=s.y,this.sScale=t.scale,this.sRotation=t.rotation,this.tCenterX=o.x,this.tCenterY=o.y,this.tScale=i.scale,this.tRotation=i.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}return t.prototype.applyRatio=function(t,i){const e=this.easing(i);let n,s,o,a;i>=1?(n=this.tCenterX,s=this.tCenterY,o=this.tRotation,a=this.tScale):(n=this.sCenterX+e*this.dCenterX,s=this.sCenterY+e*this.dCenterY,o=this.sRotation+e*this.dRotation,a=this.sScale+e*this.dScale),t.targetGeometry.x=n,t.targetGeometry.y=s,t.scale=a,t.rotation=o},t}(),w=function(i){function e(e){var s;return(s=i.call(this,e)||this).updateFunction=null,s.animation=null,s.duration=200,s.transition=null,s.easing=d.easingFunctions.ease,s.view=null,s.viewpoint=new n({targetGeometry:new m,scale:0,rotation:0}),s._updateTask=a.addFrameTask({postRender:s._postRender.bind(t._assertThisInitialized(s))}),s._updateTask.pause(),s}t._inheritsLoose(e,i);var s=e.prototype;return s.destroy=function(){this._updateTask=o.removeMaybe(this._updateTask)},s.animate=function(t,i,e){this.stop();const n=this.viewpoint;l.copy(n,i),this.transition=new y(this.viewpoint,t.target,e&&e.duration||this.duration,e&&e.easing||this.easing);const s=()=>{this.animation===t&&this._updateTask&&("finished"===t.state&&(this.transition?.applyRatio(this.viewpoint,1),this.view?.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return t.when(s,s),this._startTime=performance.now(),this._updateTask.resume(),this.animation=t,t},s.animateContinous=function(t,i){this.stop(),this.updateFunction=i,this.viewpoint=t;const e=new u({target:t.clone()}),n=()=>{this.animation===e&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return e.when(n,n),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e},s.stop=function(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)},s._postRender=function(t){const i=this.animation;if(i&&i.state!==u.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,t.deltaTime);else{const t=this.transition,i=(performance.now()-this._startTime)/t.duration,e=i>=1;t.applyRatio(this.viewpoint,i),e&&this.animation?.finish()}this.view?.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()},e}(s);i.__decorate([r.property()],w.prototype,"animation",void 0),i.__decorate([r.property()],w.prototype,"duration",void 0),i.__decorate([r.property()],w.prototype,"transition",void 0),i.__decorate([r.property()],w.prototype,"easing",void 0),i.__decorate([r.property()],w.prototype,"view",void 0),i.__decorate([r.property()],w.prototype,"viewpoint",void 0),w=i.__decorate([c.subclass("esri.views.2d.AnimationManager")],w);return w}));
