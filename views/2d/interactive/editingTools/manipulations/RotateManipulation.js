/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Handles","../../../../../chunks/vec3","../../../../../chunks/vec3f64","./Manipulation","./utils","../../../../draw/support/drawUtils","../../../../interactive/dragEventPipeline","../../../../interactive/GraphicManipulator","../../../../interactive/editGeometry/interfaces","../../../../interactive/editGeometry/operations/UpdateVertices","../../../../interactive/editGeometry/support/editPlaneUtils"],(function(t,e,n,a,i,r,o,l,s,c,u,p,h){"use strict";let _=function(t){function _(e){var a;return(a=t.call(this)||this)._handles=new n,a._originCache=i.create(),a._view=e.view,a._tool=e.tool,a._graphic=e.graphic,a._snapRotation=e.snapRotation,a._manipulator=a._createManipulator(),a._handles.add([a._manipulator.events.on("grab-changed",(t=>o.onGrabChangedHandle(t,a._manipulator)))]),a.forEachManipulator((t=>a._tool.manipulators.add(t))),a}e._inheritsLoose(_,t);var d=_.prototype;return d.destroy=function(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null},d.forEachManipulator=function(t){t(this._manipulator,r.ManipulatorType.ROTATE)},d.createDragPipeline=function(t,e){let n=null,i=null;return s.createManipulatorDragEventPipeline(this._manipulator,((r,o)=>{o.next((e=>{if("start"===e.action){r.cursor="grabbing";const e=t();n=e.plane,i=e.editGeometryOperations}return e})).next(s.screenToMap(this._view)).next((t=>({...t,rotateAngle:l.getRotationAngle(t.mapStart,t.mapEnd,{x:n.origin[0],y:n.origin[1]},!0)}))).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next((t=>{const r=a.copy(this._originCache,n.origin),o=[];for(const e of i.data.components)o.push(...e.vertices);const l="start"===t.action?u.AccumulationBehaviour.NEW_STEP:u.AccumulationBehaviour.ACCUMULATE_STEPS,s=i.rotateVertices(o,r,t.rotateAngle,l,p.AccumulationType.REPLACE);return h.apply(s,n),e(t,s),t})).next((t=>("end"===t.action&&(r.cursor="grab"),t)))}))},d._createManipulator=function(){const t=this._view,e=this._graphic;return new c.GraphicManipulator({view:t,graphic:e,selectable:!0,cursor:"grab"})},_}(r.Manipulation);t.RotateManipulation=_,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
