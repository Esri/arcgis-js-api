/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../../chunks/tslib.es6.js";import t from"../../../../../../core/Accessor.js";import{isSome as r,isNone as i}from"../../../../../../core/maybe.js";import{watch as o,sync as s}from"../../../../../../core/reactiveUtils.js";import{property as l}from"../../../../../../core/accessorSupport/decorators/property.js";import"../../../../../../core/arrayUtils.js";import"../../../../../../core/has.js";import"../../../../../../core/accessorSupport/ensureType.js";import{subclass as n}from"../../../../../../core/accessorSupport/decorators/subclass.js";import{distanceToTile as a}from"../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils.js";import{scaleBoundsPredicate as c}from"../../../../../support/layerViewUtils.js";let p=class extends t{constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,t=r(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort(((e,r)=>a(t,e)-a(t,r))),e}_scaleEnabled(){return c(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||i(this.tileInfo))return[];if(!this._scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:r}=t,o=[];for(const{row:i,colFrom:s,colTo:l}of e)for(let e=s;e<=l;e++){const s={id:null,level:r,row:i,col:t.normalizeCol(e)};this.tileInfo.updateTileInfo(s),o.push(s)}return o}get tileInfo(){return this.view.featuresTilingScheme?.tileInfo??null}get tileSize(){return r(this.tileInfo)?this.tileInfo.size[0]:256}initialize(){this.own(o((()=>this.view?.state?.viewpoint),(()=>this.notifyChange("tilesCoveringView")),s))}};e([l({readOnly:!0})],p.prototype,"tiles",null),e([l({readOnly:!0})],p.prototype,"_scaleEnabled",null),e([l({readOnly:!0})],p.prototype,"tilesCoveringView",null),e([l({readOnly:!0})],p.prototype,"tileInfo",null),e([l({readOnly:!0})],p.prototype,"tileSize",null),e([l({constructOnly:!0})],p.prototype,"view",void 0),e([l({constructOnly:!0})],p.prototype,"layer",void 0),e([l()],p.prototype,"pointOfInterest",void 0),p=e([n("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],p);export{p as FeatureServiceTiles2D};
