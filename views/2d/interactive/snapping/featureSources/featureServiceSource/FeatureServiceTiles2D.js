/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../../chunks/tslib.es6","../../../../../../core/has","../../../../../../core/maybe","../../../../../../core/Logger","../../../../../../core/accessorSupport/ensureType","../../../../../../core/accessorSupport/decorators/property","../../../../../../core/accessorSupport/decorators/subclass","../../../../../../core/urlUtils","../../../../../../core/uuid","../../../../../../portal/support/resourceExtension","../../../../../../core/Accessor","../../../../../../core/HandleOwner","../../../../../support/layerViewUtils","../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils"],(function(e,t,r,i,o,s,n,l,c,a,u,p,v,d,y,f){"use strict";e.FeatureServiceTiles2D=function(e){function r(t){var r;return(r=e.call(this,t)||this).pointOfInterest=null,r}t._inheritsLoose(r,e);var i=r.prototype;return i.scaleEnabled=function(){return y.scaleBoundsPredicate(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)},i.initialize=function(){this.handles.add(this.watch("view.state.viewpoint",(()=>this.notifyChange("tilesCoveringView")),!0))},t._createClass(r,[{key:"tiles",get:function(){const e=this.tilesCoveringView,t=o.isSome(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort(((e,r)=>f.distanceToTile(t,e)-f.distanceToTile(t,r))),e}},{key:"tilesCoveringView",get:function(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||o.isNone(this.tileInfo))return[];if(!this.scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:r}=t,i=[];for(const{row:o,colFrom:s,colTo:n}of e)for(let e=s;e<=n;e++){const s={id:null,level:r,row:o,col:t.normalizeCol(e)};this.tileInfo.updateTileInfo(s),i.push(s)}return i}},{key:"tileInfo",get:function(){var e,t;return null!=(e=null==(t=this.view.featuresTilingScheme)?void 0:t.tileInfo)?e:null}},{key:"tileSize",get:function(){return o.isSome(this.tileInfo)?this.tileInfo.size[0]:256}}]),r}(d.HandleOwnerMixin(v)),r.__decorate([l.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"tiles",null),r.__decorate([l.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"scaleEnabled",null),r.__decorate([l.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"tilesCoveringView",null),r.__decorate([l.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"tileInfo",null),r.__decorate([l.property({readOnly:!0})],e.FeatureServiceTiles2D.prototype,"tileSize",null),r.__decorate([l.property({constructOnly:!0})],e.FeatureServiceTiles2D.prototype,"view",void 0),r.__decorate([l.property({constructOnly:!0})],e.FeatureServiceTiles2D.prototype,"layer",void 0),r.__decorate([l.property()],e.FeatureServiceTiles2D.prototype,"pointOfInterest",void 0),e.FeatureServiceTiles2D=r.__decorate([c.subclass("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],e.FeatureServiceTiles2D),Object.defineProperty(e,"__esModule",{value:!0})}));
