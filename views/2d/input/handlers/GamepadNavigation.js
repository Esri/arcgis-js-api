/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Handles","../../../../core/scheduling","../../../../core/watchUtils","../../viewpointUtils","../../../input/InputHandler","../../../navigation/gamepadAndKeyboardUtils"],(function(t,e,a,n,i,s,r,o){"use strict";let l=function(t){function r(e){var n;return(n=t.call(this,!0)||this).view=e,n.frameTask=null,n.watchHandles=new a,n.currentDevice=null,n.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},n.handle=n.registerIncoming("gamepad",(t=>n.handleEvent(t))),n.handle.pause(),n}e._inheritsLoose(r,t);var l=r.prototype;return l.onInstall=function(e){t.prototype.onInstall.call(this,e),this.watchHandles.add([i.init(this.view.navigation.gamepad,"enabled",(t=>{t?(this.handle.resume(),this.frameTask||(this.frameTask=n.addFrameTask({update:t=>this.frameUpdate(t.deltaTime)}))):(this.handle.pause(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null))}))])},l.onUninstall=function(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),t.prototype.onUninstall.call(this)},l.handleEvent=function(t){const e=this.view.navigation.gamepad.device;e&&t.data.device!==e||this.currentDevice&&this.currentDevice!==t.data.device||("end"===t.data.action?(this.currentDevice=null,o.resetTransformation(this.transformation)):(this.currentDevice=t.data.device,o.extractTransformation(t.data,this.view.navigation.gamepad,this.transformation)))},l.frameUpdate=function(t){const e=this.transformation;if(o.isZeroTransformation(e))return;const a=this.view.viewpoint.clone(),n=this.view.navigation.gamepad.velocityFactor,i=h*n*t;s.translateBy(a,a,[e.translation[0]*i,-e.translation[1]*i]);const r=1+e.translation[2]*d*t,l=this.view.constraints.rotationEnabled?-e.heading*c*t:0,v=this.view.size,u=[v[0]/2,v[1]];s.scaleAndRotateBy(a,a,r,l,u,v);const m=this.view.constraints.constrain(a,this.view.viewpoint);this.view.viewpoint=m},r}(r.InputHandler);const c=.06,h=.7,d=6e-4;t.GamepadNavigation=l,Object.defineProperty(t,"__esModule",{value:!0})}));
