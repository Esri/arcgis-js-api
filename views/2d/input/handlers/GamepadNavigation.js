/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Handles","../../../../core/reactiveUtils","../../../../core/scheduling","../../viewpointUtils","../../../input/InputHandler","../../../navigation/gamepadAndKeyboardUtils"],(function(t,a,e,i,n,s,r,o){"use strict";let l=function(t){function r(a){var i;return(i=t.call(this,!0)||this)._view=a,i._frameTask=null,i._watchHandles=new e,i._currentDevice=null,i._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},i._handle=i.registerIncoming("gamepad",(t=>i._handleGamePadEvent(t))),i._handle.pause(),i}a._inheritsLoose(r,t);var l=r.prototype;return l.onInstall=function(a){t.prototype.onInstall.call(this,a),this._watchHandles.add([i.watch((()=>this._view.navigation.gamepad?.enabled),(t=>{t?(this._handle.resume(),this._frameTask||(this._frameTask=n.addFrameTask({update:t=>this._frameUpdate(t.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))}),i.initial)])},l.onUninstall=function(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),t.prototype.onUninstall.call(this)},l._handleGamePadEvent=function(t){const a=this._view.navigation.gamepad.device;a&&t.data.device!==a||this._currentDevice&&this._currentDevice!==t.data.device||("end"===t.data.action?(this._currentDevice=null,o.resetTransformation(this._transformation)):(this._currentDevice=t.data.device,o.extractTransformation(t.data,this._view.navigation.gamepad,this._transformation)))},l._frameUpdate=function(t){const a=this._transformation;if(o.isZeroTransformation(a))return;const e=this._view.viewpoint.clone(),i=this._view.navigation.gamepad.velocityFactor,n=d*i*t;s.translateBy(e,e,[a.translation[0]*n,-a.translation[1]*n]);const r=1+a.translation[2]*h*t,l=this._view.constraints.rotationEnabled?-a.heading*c*t:0,_=this._view.size,v=[_[0]/2,_[1]];s.scaleAndRotateBy(e,e,r,l,v,_);const m=this._view.constraints.constrain(e,this._view.viewpoint);this._view.viewpoint=m},r}(r.InputHandler);const c=.06,d=.7,h=6e-4;t.GamepadNavigation=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
