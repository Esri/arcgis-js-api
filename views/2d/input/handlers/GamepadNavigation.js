/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/scheduling","../../../../core/Handles","../../../../core/watchUtils","../../../input/InputHandler","../../viewpointUtils","../../../navigation/gamepadAndKeyboardUtils"],(function(t,e,a,n,i,s,r,o){"use strict";let l=function(t){function s(e){var a;return(a=t.call(this,!0)||this).view=e,a.frameTask=null,a.watchHandles=new n,a.currentDevice=null,a.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},a.handle=a.registerIncoming("gamepad",(t=>a.handleEvent(t))),a.handle.pause(),a}e._inheritsLoose(s,t);var l=s.prototype;return l.onInstall=function(e){t.prototype.onInstall.call(this,e),this.watchHandles.add([i.init(this.view.navigation.gamepad,"enabled",(t=>{t?(this.handle.resume(),this.frameTask||(this.frameTask=a.addFrameTask({update:t=>this.frameUpdate(t.deltaTime)}))):(this.handle.pause(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null))}))])},l.onUninstall=function(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),t.prototype.onUninstall.call(this)},l.handleEvent=function(t){const e=this.view.navigation.gamepad.device;e&&t.data.device!==e||this.currentDevice&&this.currentDevice!==t.data.device||("end"===t.data.action?(this.currentDevice=null,o.resetTransformation(this.transformation)):(this.currentDevice=t.data.device,o.extractTransformation(t.data,this.view.navigation.gamepad,this.transformation)))},l.frameUpdate=function(t){const e=this.transformation;if(o.isZeroTransformation(e))return;const a=this.view.viewpoint.clone(),n=this.view.navigation.gamepad.velocityFactor,i=h*n*t;r.translateBy(a,a,[e.translation[0]*i,-e.translation[1]*i]);const s=1+e.translation[2]*d*t,l=this.view.constraints.rotationEnabled?-e.heading*c*t:0,v=this.view.size,u=[v[0]/2,v[1]];r.scaleAndRotateBy(a,a,s,l,u,v);const m=this.view.constraints.constrain(a,this.view.viewpoint);this.view.viewpoint=m},s}(s.InputHandler);const c=.06,h=.7,d=6e-4;t.GamepadNavigation=l,Object.defineProperty(t,"__esModule",{value:!0})}));
