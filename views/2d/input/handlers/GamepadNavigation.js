/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Handles","../../../../core/reactiveUtils","../../../../core/scheduling","../../viewpointUtils","../../../input/InputHandler","../../../navigation/gamepadAndKeyboardUtils"],(function(t,e,a,i,n,s,o,r){"use strict";let l=function(t){function o(e){var i;return(i=t.call(this,!0)||this)._view=e,i._frameTask=null,i._watchHandles=new a,i._currentDevice=null,i._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},i._handle=i.registerIncoming("gamepad",(t=>i._handleGamePadEvent(t))),i._handle.pause(),i}e._inheritsLoose(o,t);var l=o.prototype;return l.onInstall=function(e){t.prototype.onInstall.call(this,e),this._watchHandles.add([i.watch((()=>this._view.navigation.gamepad?.enabled),(t=>{t?(this._handle.resume(),this._frameTask||(this._frameTask=n.addFrameTask({update:t=>this._frameUpdate(t.deltaTime)}))):(this._handle.pause(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null))}),i.initial)])},l.onUninstall=function(){this._watchHandles.removeAll(),this._frameTask&&(this._frameTask.remove(),this._frameTask=null),t.prototype.onUninstall.call(this)},l._handleGamePadEvent=function(t){const e=this._view.navigation.gamepad.device;e&&t.data.device!==e||this._currentDevice&&this._currentDevice!==t.data.device||("end"===t.data.action?(this._currentDevice=null,r.resetTransformation(this._transformation)):(this._currentDevice=t.data.device,r.extractTransformation(t.data,this._view.navigation.gamepad,this._transformation)))},l._frameUpdate=function(t){const e=this._transformation;if(r.isZeroTransformation(e))return;const a=this._view.viewpoint.clone(),i=this._view.navigation.gamepad.velocityFactor,n=d*i*t;s.translateBy(a,a,[e.translation[0]*n,-e.translation[1]*n]);const o=1+e.translation[2]*h*t,l=this._view.constraints.rotationEnabled?-e.heading*c*t:0,_=this._view.size,v=[_[0]/2,_[1]];s.scaleAndRotateBy(a,a,o,l,v,_);const m=this._view.constraints.constrain(a,this._view.viewpoint);this._view.viewpoint=m},o}(o.InputHandler);const c=.06,d=.7,h=6e-4;t.GamepadNavigation=l,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
