/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/Accessor","../../../geometry/Point","../../../Viewpoint","../viewpointUtils","./ZoomBox","./actions/Pan","./actions/Pinch","./actions/Rotate"],(function(t,n,i,o,e,s,a,r,c,u,p,h,l,m,v,_,w,d){"use strict";const g=new l({targetGeometry:new h}),y=[0,0];let f=function(n){function i(t){var i;return(i=n.call(this,t)||this)._endTimer=null,i.animationManager=null,i}t._inheritsLoose(i,n);var o=i.prototype;return o.initialize=function(){this.pan=new _({navigation:this}),this.rotate=new d({navigation:this}),this.pinch=new w({navigation:this}),this.zoomBox=new v({view:this.view,navigation:this})},o.destroy=function(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null},o.begin=function(){this._set("interacting",!0)},o.end=function(){this._lastEventTimestamp=performance.now(),this._startTimer(250)},o.zoom=async function(t,n=this._getDefaultAnchor()){if(this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(n):this.zoomOut(n);this.setViewpoint(n,t,0,[0,0])},o.zoomIn=async function(t){const n=this.view,i=n.constraints.snapToNextScale(n.scale);return this._zoomToScale(i,t)},o.zoomOut=async function(t){const n=this.view,i=n.constraints.snapToPreviousScale(n.scale);return this._zoomToScale(i,t)},o.setViewpoint=function(t,n,i,o){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,n,i,o),this.end()},o.setViewpointImmediate=function(t,n=0,i=[0,0],o=this._getDefaultAnchor()){this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,o,t,n,i)},o.continousRotateClockwise=function(){const t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(t=>{m.rotateBy(t,t,-1)}))},o.continousRotateCounterclockwise=function(){const t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(t=>{m.rotateBy(t,t,1)}))},o.resetRotation=function(){this.view.rotation=0},o.continousPanLeft=function(){this._continuousPan([-10,0])},o.continousPanRight=function(){this._continuousPan([10,0])},o.continousPanUp=function(){this._continuousPan([0,10])},o.continousPanDown=function(){this._continuousPan([0,-10])},o.stop=function(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))},o._continuousPan=function(t){const n=this.get("view.viewpoint");this.animationManager.animateContinous(n,(n=>{m.translateBy(n,n,t),this.view.constraints.constrainByGeometry(n)}))},o._startTimer=function(t){return null!==this._endTimer||(this._endTimer=setTimeout((()=>{this._endTimer=null;const t=performance.now()-this._lastEventTimestamp;t<250?this._endTimer=this._startTimer(t):this._set("interacting",!1)}),t)),this._endTimer},o._getDefaultAnchor=function(){const{size:t,padding:{left:n,right:i,top:o,bottom:e}}=this.view;return y[0]=.5*(t[0]-i+n),y[1]=.5*(t[1]-e+o),y},o._zoomToScale=async function(t,n=this._getDefaultAnchor()){const{view:i}=this,{constraints:o,scale:e,viewpoint:s,size:a,padding:r}=i,c=o.canZoomInTo(t),u=o.canZoomOutTo(t);if(!(t<e&&!c||t>e&&!u))return m.padAndScaleAndRotateBy(g,s,t/e,0,n,a,r),o.constrainByGeometry(g),i.goTo(g,{animate:!0})},o._scaleRotateTranslateViewpoint=function(t,n,i,o,e){const{view:s}=this,{size:a,padding:r,constraints:c,scale:u,viewpoint:p}=s,h=u*i,l=c.canZoomInTo(h),v=c.canZoomOutTo(h);return(i<1&&!l||i>1&&!v)&&(i=1),m.translateBy(p,p,e),m.padAndScaleAndRotateBy(t,p,i,o,n,a,r),c.constrainByGeometry(t)},i}(p);return n.__decorate([s.property()],f.prototype,"animationManager",void 0),n.__decorate([s.property({type:Boolean,readOnly:!0})],f.prototype,"interacting",void 0),n.__decorate([s.property()],f.prototype,"pan",void 0),n.__decorate([s.property()],f.prototype,"pinch",void 0),n.__decorate([s.property()],f.prototype,"rotate",void 0),n.__decorate([s.property()],f.prototype,"view",void 0),n.__decorate([s.property()],f.prototype,"zoomBox",void 0),f=n.__decorate([a.subclass("esri.views.2d.navigation.MapViewNavigation")],f),f}));
