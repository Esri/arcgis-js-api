// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/declareExtendsHelper","../../../core/tsSupport/decorateHelper","../../../core/tsSupport/generatorHelper","../../../core/tsSupport/awaiterHelper","../../../Viewpoint","../../../core/Accessor","../../../core/now","../../../core/accessorSupport/decorators","../../../geometry/Point","../viewpointUtils","./ZoomBox","./actions/Pan","./actions/Pinch","./actions/Rotate"],(function(t,i,o,n,e,a,r,s,p,c,u,h,v,l,m,d){Object.defineProperty(i,"__esModule",{value:!0});var w=new r({targetGeometry:new u}),y=[0,0],f=function(t){function i(i){var o=t.call(this,i)||this;return o._endTimer=null,o.animationManager=null,o}return o(i,t),i.prototype.initialize=function(){this.pan=new l({navigation:this}),this.rotate=new d({navigation:this}),this.pinch=new m({navigation:this}),this.zoomBox=new v({view:this.view,navigation:this})},i.prototype.destroy=function(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null},i.prototype.begin=function(){this._set("interacting",!0)},i.prototype.end=function(){this._lastEventTimestamp=p(),this._startTimer(250)},i.prototype.zoom=function(t,i){return void 0===i&&(i=this._getDefaultAnchor()),a(this,void 0,void 0,(function(){return e(this,(function(o){return this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs?t<1?[2,this.zoomIn(i)]:[2,this.zoomOut(i)]:(this.setViewpoint(i,t,0,[0,0]),[2])}))}))},i.prototype.zoomIn=function(t){return a(this,void 0,void 0,(function(){var i,o;return e(this,(function(n){return i=this.view,o=i.constraints.snapToNextScale(i.scale),[2,this._zoomToScale(o,t)]}))}))},i.prototype.zoomOut=function(t){return a(this,void 0,void 0,(function(){var i,o;return e(this,(function(n){return i=this.view,o=i.constraints.snapToPreviousScale(i.scale),[2,this._zoomToScale(o,t)]}))}))},i.prototype.setViewpoint=function(t,i,o,n){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,i,o,n),this.end()},i.prototype.setViewpointImmediate=function(t,i,o,n){void 0===i&&(i=0),void 0===o&&(o=[0,0]),void 0===n&&(n=this._getDefaultAnchor()),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,t,i,o)},i.prototype.continousRotateClockwise=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){h.rotateBy(t,t,-1)}))},i.prototype.continousRotateCounterclockwise=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){h.rotateBy(t,t,1)}))},i.prototype.resetRotation=function(){this.view.rotation=0},i.prototype.continousPanLeft=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){h.translateBy(t,t,[-10,0])}))},i.prototype.continousPanRight=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){h.translateBy(t,t,[10,0])}))},i.prototype.continousPanUp=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){h.translateBy(t,t,[0,10])}))},i.prototype.continousPanDown=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(function(t){h.translateBy(t,t,[0,-10])}))},i.prototype.stop=function(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))},i.prototype._startTimer=function(t){var i=this;return null!==this._endTimer?this._endTimer:(this._endTimer=setTimeout((function(){i._endTimer=null;var t=p()-i._lastEventTimestamp;t<250?i._endTimer=i._startTimer(t):i._set("interacting",!1)}),t),this._endTimer)},i.prototype._getDefaultAnchor=function(){var t=this.view,i=t.size,o=t.padding,n=o.left,e=o.right,a=o.top,r=o.bottom;return y[0]=.5*(i[0]-e+n),y[1]=.5*(i[1]-r+a),y},i.prototype._zoomToScale=function(t,i){return void 0===i&&(i=this._getDefaultAnchor()),a(this,void 0,void 0,(function(){var o,n,a,r,s,p,c,u;return e(this,(function(e){return o=this.view,n=o.constraints,a=o.scale,r=o.viewpoint,s=o.size,p=o.padding,c=n.canZoomInTo(t),u=n.canZoomOutTo(t),t<a&&!c||t>a&&!u?[2]:[2,o.goTo(h.padAndScaleAndRotateBy(w,r,t/a,0,i,s,p),{animate:!0})]}))}))},i.prototype._scaleRotateTranslateViewpoint=function(t,i,o,n,e){var a=this.view,r=a.size,s=a.padding,p=a.constraints,c=a.scale,u=a.viewpoint,v=c*o,l=p.canZoomInTo(v),m=p.canZoomOutTo(v);return(o<1&&!l||o>1&&!m)&&(o=1),h.translateBy(u,u,e),h.padAndScaleAndRotateBy(t,u,o,n,i,r,s)},n([c.property()],i.prototype,"animationManager",void 0),n([c.property({type:Boolean,readOnly:!0})],i.prototype,"interacting",void 0),n([c.property()],i.prototype,"pan",void 0),n([c.property()],i.prototype,"pinch",void 0),n([c.property()],i.prototype,"rotate",void 0),n([c.property()],i.prototype,"view",void 0),n([c.property()],i.prototype,"zoomBox",void 0),i=n([c.subclass("esri.views.2d.navigation.MapViewNavigation")],i)}(c.declared(s));i.default=f}));