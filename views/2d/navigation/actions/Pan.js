/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/has","../../../../core/Logger","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/decorators/subclass","../../../../core/urlUtils","../../../../core/uuid","../../../../portal/support/resourceExtension","../../../../core/Accessor","../../../../geometry/Point","../../../../geometry","../../../../core/screenUtils","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../Viewpoint","../../viewpointUtils","../../../navigation/PanPlanarMomentumEstimator"],(function(t,e,i,n,o,s,m,a,r,u,c,p,h,l,d,v,g,y,f){"use strict";let w=function(e){function i(t){var i;return(i=e.call(this,t)||this).animationTime=0,i.momentumEstimator=new f.PanPlanarMomentumEstimator(500,6,.92),i.momentum=null,i.tmpMomentum=d.create(),i.momentumFinished=!1,i.viewpoint=new g({targetGeometry:new p,scale:0,rotation:0}),i.watch("momentumFinished",(t=>{t&&i.navigation.stop()})),i}t._inheritsLoose(i,e);var n=i.prototype;return n.begin=function(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this.previousDrag=e},n.update=function(t,e){this.addToEstimator(e);let i=e.center.x,n=e.center.y;const o=this.previousDrag;i=o?o.center.x-i:-i,n=o?n-o.center.y:n,t.viewpoint=y.translateBy(this.viewpoint,t.viewpoint,[i||0,n||0]),this.previousDrag=e},n.end=function(t,e){this.addToEstimator(e);const i=t.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this.previousDrag=null,this.navigation.end()},n.addToEstimator=function(t){const e=t.center.x,i=t.center.y,n=l.createScreenPointArray(-e,i),o=d.fromValues(-e,i,0);this.momentumEstimator.add(n,o,.001*t.timestamp)},n.onAnimationUpdate=function(t){this.navigation.animationManager.animateContinous(t.viewpoint,((e,i)=>{this.momentumFinished=!this.momentum||this.momentum.isFinished(this.animationTime);const n=.001*i;if(!this.momentumFinished){const i=this.momentum.valueDelta(this.animationTime,n);v.scale(this.tmpMomentum,this.momentum.direction,i),y.translateBy(e,e,this.tmpMomentum),t.constraints.constrainByGeometry(e)}this.animationTime+=n}))},n.stopMomentumNavigation=function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())},i}(c);return e.__decorate([s.property()],w.prototype,"momentumFinished",void 0),e.__decorate([s.property()],w.prototype,"viewpoint",void 0),e.__decorate([s.property()],w.prototype,"navigation",void 0),w=e.__decorate([m.subclass("esri.views.2d.navigation.actions.Pan")],w),w}));
