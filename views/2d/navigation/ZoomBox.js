/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/Accessor","../../../core/screenUtils"],(function(t,e,o,i,r,n,s,a,h,c,l,u){"use strict";const _={container:"esri-zoom-box__container",overlay:"esri-zoom-box__overlay",background:"esri-zoom-box__overlay-background",box:"esri-zoom-box__outline"},d={zoom:"Shift",counter:"Ctrl"};let p=function(e){function o(o){var i;return(i=e.call(this,o)||this)._container=null,i._overlay=null,i._backgroundShape=null,i._boxShape=null,i._box={x:0,y:0,width:0,height:0},i._redraw=i._redraw.bind(t._assertThisInitialized(i)),i}t._inheritsLoose(o,e);var i=o.prototype;return i.destroy=function(){this.view=null},i._start=function(){this._createContainer(),this._createOverlay(),this.navigation.begin()},i._update=function(t,e,o,i){this._box.x=t,this._box.y=e,this._box.width=o,this._box.height=i,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))},i._end=function(t,e,o,i,r){const n=this.view,s=n.toMap(u.createScreenPoint(t+.5*o,e+.5*i));let a=Math.max(o/n.width,i/n.height);-1===r&&(a=1/a),this._destroyOverlay(),this.navigation.end(),n.goTo({center:s,scale:n.scale*a})},i._updateBox=function(t,e,o,i){const r=this._boxShape;r.setAttributeNS(null,"x",""+t),r.setAttributeNS(null,"y",""+e),r.setAttributeNS(null,"width",""+o),r.setAttributeNS(null,"height",""+i),r.setAttributeNS(null,"class",_.box)},i._updateBackground=function(t,e,o,i){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,o,i,this.view.width,this.view.height))},i._createContainer=function(){const t=document.createElement("div");t.className=_.container,this.view.root.appendChild(t),this._container=t},i._createOverlay=function(){const t=this.view.width,e=this.view.height,o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),o.setAttributeNS(null,"class",_.background);const i=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttributeNS(null,"class",_.overlay),r.appendChild(o),r.appendChild(i),this._container.appendChild(r),this._backgroundShape=o,this._boxShape=i,this._overlay=r},i._destroyOverlay=function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null},i._toSVGPath=function(t,e,o,i,r,n){const s=t+o,a=e+i;return"M 0 0 L "+r+" 0 L "+r+" "+n+" L 0 "+n+" ZM "+t+" "+e+" L "+t+" "+a+" L "+s+" "+a+" L "+s+" "+e+" Z"},i._handleDrag=function(t,e){const o=t.x,i=t.y,r=t.origin.x,n=t.origin.y;let s,a,h,c;switch(o>r?(s=r,h=o-r):(s=o,h=r-o),i>n?(a=n,c=i-n):(a=i,c=n-i),t.action){case"start":this._start();break;case"update":this._update(s,a,h,c);break;case"end":this._end(s,a,h,c,e)}t.stopPropagation()},i._redraw=function(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:o,height:i}=this._box;this._updateBox(t,e,o,i),this._updateBackground(t,e,o,i),this._rafId=requestAnimationFrame(this._redraw)},t._createClass(o,[{key:"view",set:function(t){this._handles&&this._handles.forEach((t=>{t.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[d.zoom],(t=>this._handleDrag(t,1))),t.on("drag",[d.zoom,d.counter],(t=>this._handleDrag(t,-1))))}}]),o}(l);return e.__decorate([n.property()],p.prototype,"navigation",void 0),e.__decorate([n.property()],p.prototype,"view",null),p=e.__decorate([s.subclass("esri.views.2d.navigation.ZoomBox")],p),p}));
