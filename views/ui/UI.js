// COPYRIGHT Â© 2017 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.5/esri/copyright.txt for details.

define(["require","exports","../../core/tsSupport/declareExtendsHelper","../../core/tsSupport/decorateHelper","../../core/accessorSupport/decorators","./Component","../../core/Accessor","../../core/HandleRegistry","../../core/watchUtils","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/dom-style"],function(t,o,n,e,i,r,a,p,s,c,d,u,h){function l(t){return t&&!t._started&&"function"==typeof t.postMixInProperties&&"function"==typeof t.buildRendering&&"function"==typeof t.postCreate&&"function"==typeof t.startup}function f(t){var o=t;return!!o&&o.isInstanceOf&&o.isInstanceOf(r)}function m(t){var o=t,n="object"==typeof o&&!f(o)&&("component"in o||"index"in o||"position"in o);return n?t:null}var y={left:0,top:0,bottom:0,right:0},_={bottom:30,top:15,right:15,left:15},g="manual",v={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"},C=function(t){function o(){var o=t.call(this)||this;return o._cornerNameToContainerLookup={},o._positionNameToContainerLookup={},o._components=[],o._handles=new p,o.padding=_,o.view=null,o._initContainers(),o}return n(o,t),o.prototype.initialize=function(){this._handles.add([s.init(this,"view.padding, container",this._applyViewPadding.bind(this)),s.init(this,"padding",this._applyUIPadding.bind(this))])},o.prototype.destroy=function(){this.container=null,this._components.forEach(function(t){t.destroy()}),this._components.length=0,this._handles.destroy()},Object.defineProperty(o.prototype,"container",{set:function(t){var o=this._get("container");t!==o&&(t&&(d.add(t,v.ui),this._attachContainers(t)),o&&(d.remove(o,v.ui),h.set(o,{top:"",bottom:"",left:"",right:""}),u.empty(o)),this._set("container",t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"height",{get:function(){var t=this.get("view.height")||0;if(0===t)return t;var o=this._getViewPadding(),n=o.top+o.bottom;return Math.max(t-n,0)},enumerable:!0,configurable:!0}),o.prototype.castPadding=function(t){return"number"==typeof t?{bottom:t,top:t,right:t,left:t}:c.mixin({},_,t)},Object.defineProperty(o.prototype,"width",{get:function(){var t=this.get("view.width")||0;if(0===t)return t;var o=this._getViewPadding(),n=o.left+o.right;return Math.max(t-n,0)},enumerable:!0,configurable:!0}),o.prototype.add=function(t,o){var n,e=this;if(Array.isArray(t))return void t.forEach(function(t){return e.add(t,o)});var i=m(t);i&&(n=i.index,o=i.position,t=i.component),o&&"object"==typeof o&&(n=o.index,o=o.position),!t||o&&!this._isValidPosition(o)||(f(t)||(t=new r({node:t})),this._place({component:t,position:o,index:n}),this._components.push(t))},o.prototype.remove=function(t){if(t){if(Array.isArray(t))return t.map(this.remove,this);var o=this.find(t);if(o){var n=this._components.indexOf(o);return o.node.parentNode&&o.node.parentNode.removeChild(o.node),this._components.splice(n,1)[0]}}},o.prototype.empty=function(t){var o=this;if(Array.isArray(t))return t.map(function(t){return o.empty(t)}).reduce(function(t,o){return t.concat(o)});if(t=t||g,t===g){var n=Array.prototype.slice.call(this._manualContainer.children);return n.filter(function(t){return!d.contains(t,v.corner)}).map(function(t){return o.remove(t)})}return this._isValidPosition(t)?Array.prototype.slice.call(this._cornerNameToContainerLookup[t].children).map(this.remove,this):void 0},o.prototype.move=function(t,o){var n=this;if(Array.isArray(t)&&t.forEach(function(t){return n.move(t,o)}),t){var e,i=m(t)||m(o);if(i&&(e=i.index,o=i.position,t=i.component||t),!o||this._isValidPosition(o)){var r=this.remove(t);r&&this.add(r,{position:o,index:e})}}},o.prototype.find=function(t){return t?f(t)?this._findByComponent(t):"string"==typeof t?this._findById(t):this._findByNode(t.domNode||t):null},o.prototype._getViewPadding=function(){return this.get("view.padding")||y},o.prototype._attachContainers=function(t){u.place(this._manualContainer,t),u.place(this._innerContainer,t)},o.prototype._initContainers=function(){var t=u.create("div",{className:v.innerContainer+" "+v.cornerContainer}),o=u.create("div",{className:v.innerContainer+" "+v.manualContainer}),n=u.create("div",{className:v.topLeft+" "+v.corner},t),e=u.create("div",{className:v.topRight+" "+v.corner},t),i=u.create("div",{className:v.bottomLeft+" "+v.corner},t),r=u.create("div",{className:v.bottomRight+" "+v.corner},t);this._innerContainer=t,this._manualContainer=o,this._cornerNameToContainerLookup={"top-left":n,"top-right":e,"bottom-left":i,"bottom-right":r},this._positionNameToContainerLookup=c.mixin({manual:o},this._cornerNameToContainerLookup)},o.prototype._isValidPosition=function(t){return!!this._positionNameToContainerLookup[t]},o.prototype._place=function(t){var o,n,e,i=t.component,r=t.position||g,a=t.index,p=this._positionNameToContainerLookup[r],s=a>-1;return s?(o=Array.prototype.slice.call(p.children),(n=0===a)?void this._placeComponent(i,p,"first"):(e=a>=o.length)?void this._placeComponent(i,p,"last"):void this._placeComponent(i,o[a],"before")):void this._placeComponent(i,p,"last")},o.prototype._placeComponent=function(t,o,n){l(t.widget)&&t.widget.startup(),u.place(t.node,o,n)},o.prototype._applyViewPadding=function(){var t=this.container;t&&h.set(t,this._toPxPosition(this._getViewPadding()))},o.prototype._applyUIPadding=function(){var t=this._innerContainer;t&&h.set(this._innerContainer,this._toPxPosition(this.padding))},o.prototype._toPxPosition=function(t){return{top:this._toPxUnit(t.top),left:this._toPxUnit(t.left),right:this._toPxUnit(t.right),bottom:this._toPxUnit(t.bottom)}},o.prototype._toPxUnit=function(t){return 0===t?0:t+"px"},o.prototype._findByComponent=function(t){var o,n=null;return this._components.some(function(e){return o=e===t,o&&(n=e),o}),n},o.prototype._findById=function(t){var o,n=null;return this._components.some(function(e){return o=e.id===t,o&&(n=e),o}),n},o.prototype._findByNode=function(t){var o,n=null;return this._components.some(function(e){return o=e.node===t,o&&(n=e),o}),n},e([i.property()],o.prototype,"container",null),e([i.property({dependsOn:["view.height"]})],o.prototype,"height",null),e([i.property()],o.prototype,"padding",void 0),e([i.cast("padding")],o.prototype,"castPadding",null),e([i.property()],o.prototype,"view",void 0),e([i.property({dependsOn:["view.width"]})],o.prototype,"width",null),o=e([i.subclass("esri.views.ui.UI")],o)}(i.declared(a));return C});