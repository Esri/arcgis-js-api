/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Accessor","../../core/Collection","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/accessorSupport/decorators/subclass","../../core/support/WatchUpdatingTracking","../../libs/maquette/projection","../../libs/maquette/projector"],(function(t,e,r,o,n,i,s,c,a,d,h){"use strict";let l=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).items=new o,t._watchUpdatingTracking=new a.WatchUpdatingTracking,t._callbacks=new Map,t._projector=h.createProjector(),t._hiddenProjector=h.createProjector(),t}t._inheritsLoose(r,e);var n=r.prototype;return n.initialize=function(){const t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange((()=>this.items),(t=>{for(const e of t.added){const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)}for(const e of t.removed){const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}}))},n.addItem=function(t){this.items.add(t)},n.removeItem=function(t){this.items.remove(t)},n.destroy=function(){this.items.removeAll(),this._callbacks.forEach((t=>this._projector.detach(t))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()},n.render=function(){this._projector.renderNow()},n.computeBoundingRect=function(t){const e=this._hiddenSurface,r=this._hiddenProjector;let o;const n=()=>(o=t.render(),o);r.append(e,n),r.renderNow();const i={left:0,top:0,right:0,bottom:0};if(o&&o.domNode){const t=o.domNode.getBoundingClientRect();i.left=t.left,i.top=t.top,i.right=t.right,i.bottom=t.bottom}for(r.detach(n);e.firstChild;)e.removeChild(e.firstChild);return i},n.overlaps=function(t,e){const r=this.computeBoundingRect(t),o=this.computeBoundingRect(e);return Math.max(r.left,o.left)<=Math.min(r.right,o.right)&&Math.max(r.top,o.top)<=Math.min(r.bottom,o.bottom)},n.prepare=function(){var e=t._asyncToGenerator((function*(){yield document.fonts.load(this._fontString()).catch((()=>{}))}));function r(){return e.apply(this,arguments)}return r}(),n.renderCanvas=function(t){if(!this.items.some((t=>t.visible)))return;const e=t.getContext("2d");e.save(),e.font=this._fontString(),this.items.forEach((t=>{e.save(),t.renderCanvas(e),e.restore()})),e.restore()},n._fontString=function(){return`10px ${getComputedStyle(this.surface).fontFamily}`},t._createClass(r,[{key:"needsRender",get:function(){return this.items.length>0}},{key:"updating",get:function(){return this._watchUpdatingTracking?.updating??!1}},{key:"hasVisibleItems",get:function(){return this.items.some((t=>t.visible))}}]),r}(r);e.__decorate([n.property({readOnly:!0})],l.prototype,"surface",void 0),e.__decorate([n.property({readOnly:!0})],l.prototype,"items",void 0),e.__decorate([n.property({readOnly:!0})],l.prototype,"needsRender",null),e.__decorate([n.property({readOnly:!0})],l.prototype,"_watchUpdatingTracking",void 0),e.__decorate([n.property({readOnly:!0})],l.prototype,"updating",null),l=e.__decorate([c.subclass("esri.views.overlay.ViewOverlay")],l);return l}));
