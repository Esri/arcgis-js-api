/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/mathUtils"],(function(t,e,i){"use strict";let o=function(){function o(t,e,i=null){this._context=null,this._glName=null,this.id=n++,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._boundToUnits=new Set,t.instanceCounter.increment(0,this),this._context=t,this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...e},this.setData(i)}var a=o.prototype;return a.dispose=function(){if(this._context&&this._context.gl){if(this._glName){const t=this._context.gl;this._boundToUnits.forEach((t=>{this._context.bindTexture(null,t)})),t.deleteTexture(this._glName),this._glName=null}this._context.instanceCounter.decrement(0,this),this._context=null}},a.release=function(){this.dispose()},a.resize=function(t,e){const i=this._descriptor;i.width===t&&i.height===e||(i.width=t,i.height=e,this.setData(null))},a.setData=function(t){if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),void 0===t&&(t=null),null===t&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const n=this._context.getBoundTexture(0);this._context.bindTexture(this,0);const a=this._descriptor;o._validateTexture(a),i.pixelStorei(i.UNPACK_ALIGNMENT,a.unpackAlignment),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,a.flipped?1:0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.preMultiplyAlpha?1:0);const s=a.pixelFormat;let r=a.internalFormat?a.internalFormat:s;if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement){let e=t.width,o=t.height;t instanceof HTMLVideoElement&&(e=t.videoWidth,o=t.videoHeight),a.width&&a.height&&console.assert(e===a.width&&o===a.height),i.texImage2D(i.TEXTURE_2D,0,r,s,a.dataType,t),a.hasMipmap&&this.generateMipmap(),void 0===a.width&&(a.width=e),void 0===a.height&&(a.height=o)}else{null!=a.width&&null!=a.height||console.error("Width and height must be specified!"),i.DEPTH24_STENCIL8&&r===i.DEPTH_STENCIL&&(r=i.DEPTH24_STENCIL8);let o=a.width,n=a.height;if(function(t){return e.isSome(t)&&"type"in t&&"compressed"===t.type}(t)){const e=Math.round(Math.log(Math.max(o,n))/Math.LN2)+1;a.hasMipmap=a.hasMipmap&&e===t.levels.length;for(let e=0;;++e){const s=t.levels[Math.min(e,t.levels.length-1)];if(i.compressedTexImage2D(i.TEXTURE_2D,e,r,o,n,0,s),1===o&&1===n||!a.hasMipmap)break;o=Math.max(1,o>>1),n=Math.max(1,n>>1)}}else if(e.isSome(t))i.texImage2D(i.TEXTURE_2D,0,r,o,n,0,s,a.dataType,t),a.hasMipmap&&this.generateMipmap();else for(let t=0;i.texImage2D(i.TEXTURE_2D,t,r,o,n,0,s,a.dataType,null),(1!==o||1!==n)&&a.hasMipmap;++t)o=Math.max(1,o>>1),n=Math.max(1,n>>1)}o._applySamplingMode(i,this._descriptor),o._applyWrapMode(i,this._descriptor),o._applyAnisotropicFilteringParameters(this._context,this._descriptor),this._context.bindTexture(n,0)},a.updateData=function(t,e,i,o,n,a){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const s=this._context.gl,r=this._descriptor,p=this._context.getBoundTexture(0);this._context.bindTexture(this,0),(e<0||i<0||o>r.width||n>r.height||e+o>r.width||i+n>r.height)&&console.error("An attempt to update out of bounds of the texture!"),s.pixelStorei(s.UNPACK_ALIGNMENT,r.unpackAlignment),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r.flipped?1:0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.preMultiplyAlpha?1:0),a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?s.texSubImage2D(s.TEXTURE_2D,t,e,i,r.pixelFormat,r.dataType,a):s.texSubImage2D(s.TEXTURE_2D,t,e,i,o,n,r.pixelFormat,r.dataType,a),this._context.bindTexture(p,0)},a.generateMipmap=function(){const t=this._descriptor;t.hasMipmap||(t.hasMipmap=!0,this._samplingModeDirty=!0,o._validateTexture(t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);const e=this._context.getBoundTexture(0);this._context.bindTexture(this,0);const i=this._context.gl;i.generateMipmap(i.TEXTURE_2D),this._context.bindTexture(e,0)},a.setSamplingMode=function(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,o._validateTexture(this._descriptor),this._samplingModeDirty=!0)},a.setWrapMode=function(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,o._validateTexture(this._descriptor),this._wrapModeDirty=!0)},a.applyChanges=function(){const t=this._context.gl,e=this._descriptor;this._samplingModeDirty&&(o._applySamplingMode(t,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(o._applyWrapMode(t,e),this._wrapModeDirty=!1)},a.setBoundToUnit=function(t,e){e?this._boundToUnits.add(t):this._boundToUnits.delete(t)},o._validateTexture=function(t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!");i.isPowerOfTwo(t.width)&&i.isPowerOfTwo(t.height)||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))},o._applySamplingMode=function(t,e){let i=e.samplingMode,o=e.samplingMode;9985===i||9987===i?(i=9729,e.hasMipmap||(o=9729)):9984!==i&&9986!==i||(i=9728,e.hasMipmap||(o=9728)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o)},o._applyWrapMode=function(t,e){"number"==typeof e.wrapMode?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e.wrapMode.t))},o._applyAnisotropicFilteringParameters=function(t,e){if(null==e.maxAnisotropy)return;const i=t.capabilities.textureFilterAnisotropic;if(!i)return;const o=t.gl;o.texParameterf(o.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy)},t._createClass(o,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}}]),o}(),n=0;return o}));
