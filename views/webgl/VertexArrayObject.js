/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/Logger","../../core/maybe","./enums","./Util"],(function(t,e,i,n,s){"use strict";const r=e.getLogger("esri.views.webgl.VertexArrayObject");return function(){function e(t,e,i,s,r=null){this._context=t,this._locations=e,this._layout=i,this._buffers=s,this._indexBuffer=r,this._glName=null,this._initialized=!1,t.instanceCounter.increment(n.ResourceType.VAO,this)}var o=e.prototype;return o.dispose=function(t=!0){if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&r.warn("Leaked WebGL VAO"));if(this._glName){var e,s;const t=null==(e=this._context)||null==(s=e.capabilities)?void 0:s.vao;t?(t.deleteVertexArray(this._glName),this._glName=null):r.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const t in this._buffers)this._buffers[t].dispose(),delete this._buffers[t];this._indexBuffer=i.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(n.ResourceType.VAO,this),this._context=null},o.initialize=function(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e}this._initialized=!0},o.bind=function(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())},o._bindLayout=function(){const{_buffers:t,_layout:e,_indexBuffer:n}=this;t||r.error("Vertex buffer dictionary is empty!");const o=this._context.gl;for(const i in t){const n=t[i];n||r.error("Vertex buffer is uninitialized!");const o=e[i];o||r.error("Vertex element descriptor is empty!"),s.bindVertexBufferLayout(this._context,this._locations,n,o)}if(i.isSome(n)){!!this._context.capabilities.vao?o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n.glName):this._context.bindBuffer(n)}},o.unbind=function(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()},o._unbindLayout=function(){const{_buffers:t,_layout:e}=this;t||r.error("Vertex buffer dictionary is empty!");for(const i in t){const n=t[i];n||r.error("Vertex buffer is uninitialized!");const o=e[i];s.unbindVertexBufferLayout(this._context,this._locations,n,o)}i.isSome(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)},t._createClass(e,[{key:"glName",get:function(){return this._glName}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce(((t,e)=>t+this._buffers[e].size),i.isSome(this._indexBuffer)?this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]),e}()}));
