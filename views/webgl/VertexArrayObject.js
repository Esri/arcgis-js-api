/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./Util"],(function(t,e,i){"use strict";return function(){function n(t,e,i,n,s){this._context=t,this._locations=e,this._layout=i,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1,t.instanceCounter.increment(2,this)}var s=n.prototype;return s.dispose=function(t=!0){if(!this._context)return;const i=this._context.capabilities.vao;i&&this._glName&&(i.deleteVertexArray(this._glName),this._glName=null);if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const t in this._buffers)this._buffers[t].dispose(),delete this._buffers[t];this._indexBuffer=e.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(2,this),this._context=null},s.initialize=function(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const e=t.createVertexArray();t.bindVertexArray(e),this._bindLayout(),t.bindVertexArray(null),this._glName=e}this._initialized=!0},s.bind=function(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())},s._bindLayout=function(){const t=this._buffers,e=!!this._context.capabilities.vao,n=this._layout,s=this._indexBuffer;t||console.error("Vertex buffer dictionary is empty!");const r=this._context.gl;for(const o in t){const e=t[o];e||console.error("Vertex buffer is uninitialized!");const s=n[o];s||console.error("Vertex element descriptor is empty!"),i.bindVertexBufferLayout(this._context,this._locations,e,s)}s&&(e?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s.glName):this._context.bindBuffer(s))},s.unbind=function(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()},s._unbindLayout=function(){const t=this._buffers,e=this._layout;t||console.error("Vertex buffer dictionary is empty!");for(const n in t){const s=t[n];s||console.error("Vertex buffer is uninitialized!");const r=e[n];i.unbindVertexBufferLayout(this._context,this._locations,s,r)}this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)},t._createClass(n,[{key:"glName",get:function(){return this._glName}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce(((t,e)=>t+this._buffers[e].size),this._indexBuffer?this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]),n}()}));
