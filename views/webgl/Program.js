/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/maybe","./ShaderTranspiler"],(function(t,i,n,o){"use strict";let r=function(){function i(t,i,n,o,r={}){if(this._context=null,this._glName=null,this._locations={},this.id=s++,this._initialized=!1,this._vShader=null,this._fShader=null,this._defines={},this._nameToUniformLocation={},this._nameToAttribLocation={},this._nameToUniform1={},this._nameToUniform1v={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},t||console.error("RenderingContext isn't initialized!"),0===i.length&&console.error("Shaders source should not be empty!"),t.instanceCounter.increment(3,this),this._context=t,this._vertexShaderSource=i,this._fragmentShaderSource=n,Array.isArray(r))for(const t of r)this._defines[t]="1";else this._defines=r;this._locations=o}var r=i.prototype;return r.getDefine=function(t){return this._defines[t]},r.dispose=function(){if(!this._context)return;const t=this._context.gl;if(this._vShader){const i=this._vShader;t.deleteShader(i),this._vShader=null}if(this._fShader){const i=this._fShader;t.deleteShader(i),this._fShader=null}this._glName&&(t.deleteProgram(this._glName),this._glName=null),this._context.instanceCounter.decrement(3,this),this._context=null},r.initialize=function(){if(this._initialized)return;this._vShader=this._loadShader(35633),this._fShader=this._loadShader(35632),this._vShader&&this._fShader||console.error("Error loading shaders!");const t=this._context.gl,i=t.createProgram();t.attachShader(i,this._vShader),t.attachShader(i,this._fShader);for(const n in this._locations){const o=this._locations[n];t.bindAttribLocation(i,o,n)}t.linkProgram(i),this._glName=i,this._initialized=!0},r.getUniformLocation=function(t){return this.initialize(),void 0===this._nameToUniformLocation[t]&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this._glName,t)),this._nameToUniformLocation[t]},r.hasUniform=function(t){return null!==this.getUniformLocation(t)},r.getAttribLocation=function(t){return this.initialize(),void 0===this._nameToAttribLocation[t]&&(this._nameToAttribLocation[t]=this._context.gl.getAttribLocation(this._glName,t)),this._nameToAttribLocation[t]},r.setUniform1i=function(t,i){const n=this._nameToUniform1[t];if(void 0===n||i!==n){this._context.bindProgram(this);this._context.gl.uniform1i(this.getUniformLocation(t),i),this._nameToUniform1[t]=i}},r.setUniform1iv=function(t,n){const o=this._nameToUniform1v[t];if(e(o,n)){this._context.bindProgram(this);this._context.gl.uniform1iv(this.getUniformLocation(t),n),void 0===o?this._nameToUniform1v[t]=i._arrayCopy(n):i._arrayAssign(n,o)}},r.setUniform2iv=function(t,n){const o=this._nameToUniform2[t];if(e(o,n)){this._context.bindProgram(this);this._context.gl.uniform2iv(this.getUniformLocation(t),n),void 0===o?this._nameToUniform2[t]=i._arrayCopy(n):i._arrayAssign(n,o)}},r.setUniform3iv=function(t,n){const o=this._nameToUniform3[t];if(e(o,n)){this._context.bindProgram(this);this._context.gl.uniform3iv(this.getUniformLocation(t),n),void 0===o?this._nameToUniform3[t]=i._arrayCopy(n):i._arrayAssign(n,o)}},r.setUniform4iv=function(t,n){const o=this._nameToUniform4[t];if(e(o,n)){this._context.bindProgram(this);this._context.gl.uniform4iv(this.getUniformLocation(t),n),void 0===o?this._nameToUniform4[t]=i._arrayCopy(n):i._arrayAssign(n,o)}},r.setUniform1f=function(t,i){const n=this._nameToUniform1[t];if(void 0===n||i!==n){this._context.bindProgram(this);this._context.gl.uniform1f(this.getUniformLocation(t),i),this._nameToUniform1[t]=i}},r.setUniform1fv=function(t,n){const o=this._nameToUniform1v[t];if(e(o,n)){this._context.bindProgram(this);this._context.gl.uniform1fv(this.getUniformLocation(t),n),void 0===o?this._nameToUniform1v[t]=i._arrayCopy(n):i._arrayAssign(n,o)}},r.setUniform2f=function(t,i,n){const o=this._nameToUniform2[t];if(void 0===o||i!==o[0]||n!==o[1]){this._context.bindProgram(this);this._context.gl.uniform2f(this.getUniformLocation(t),i,n),void 0===o?this._nameToUniform2[t]=[i,n]:(o[0]=i,o[1]=n)}},r.setUniform2fv=function(t,n){const o=this._nameToUniform2[t];if(e(o,n)){this._context.bindProgram(this);this._context.gl.uniform2fv(this.getUniformLocation(t),n),void 0===o?this._nameToUniform2[t]=i._arrayCopy(n):i._arrayAssign(n,o)}},r.setUniform3f=function(t,i,n,o){const r=this._nameToUniform3[t];if(void 0===r||i!==r[0]||n!==r[1]||o!==r[2]){this._context.bindProgram(this);this._context.gl.uniform3f(this.getUniformLocation(t),i,n,o),void 0===r?this._nameToUniform3[t]=[i,n,o]:(r[0]=i,r[1]=n,r[2]=o)}},r.setUniform3fv=function(t,n){const o=this._nameToUniform3[t];if(e(o,n)){this._context.bindProgram(this);this._context.gl.uniform3fv(this.getUniformLocation(t),n),void 0===o?this._nameToUniform3[t]=i._arrayCopy(n):i._arrayAssign(n,o)}},r.setUniform4f=function(t,i,n,o,r){const e=this._nameToUniform4[t];if(void 0===e||i!==e[0]||n!==e[1]||o!==e[2]||r!==e[3]){this._context.bindProgram(this);this._context.gl.uniform4f(this.getUniformLocation(t),i,n,o,r),void 0===e?this._nameToUniform4[t]=[i,n,o,r]:(e[0]=i,e[1]=n,e[2]=o,e[3]=r)}},r.setUniform4fv=function(t,n){const o=this._nameToUniform4[t];if(e(o,n)){this._context.bindProgram(this);this._context.gl.uniform4fv(this.getUniformLocation(t),n),void 0===o?this._nameToUniform4[t]=i._arrayCopy(n):i._arrayAssign(n,o)}},r.setUniformMatrix3fv=function(t,o,r=!1){const s=this._nameToUniformMatrix3[t];if(function(t,i){if(n.isNone(t))return!0;if(9!==t.length)return e(t,i);return 9!==t.length||t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||t[4]!==i[4]||t[5]!==i[5]||t[6]!==i[6]||t[7]!==i[7]||t[8]!==i[8]}(s,o)){this._context.bindProgram(this);this._context.gl.uniformMatrix3fv(this.getUniformLocation(t),r,o),void 0===s?this._nameToUniformMatrix3[t]=i._arrayCopy(o):i._arrayAssign(o,s)}},r.setUniformMatrix4fv=function(t,o,r=!1){const s=this._nameToUniformMatrix4[t];if(function(t,i){if(n.isNone(t))return!0;if(16!==t.length)return e(t,i);return 16!==t.length||t[0]!==i[0]||t[1]!==i[1]||t[2]!==i[2]||t[3]!==i[3]||t[4]!==i[4]||t[5]!==i[5]||t[6]!==i[6]||t[7]!==i[7]||t[8]!==i[8]||t[9]!==i[9]||t[10]!==i[10]||t[11]!==i[11]||t[12]!==i[12]||t[13]!==i[13]||t[14]!==i[14]||t[15]!==i[15]}(s,o)){this._context.bindProgram(this);this._context.gl.uniformMatrix4fv(this.getUniformLocation(t),r,o),void 0===s?this._nameToUniformMatrix4[t]=i._arrayCopy(o):i._arrayAssign(o,s)}},r.assertCompatibleVertexAttributeLocations=function(t){const i=t.locations===this.locations;return i||console.error("VertexAttributeLocations are incompatible"),i},i._padToThree=function(t){let i=t.toString();return t<1e3&&(i=("  "+t).slice(-3)),i},r._addLineNumbers=function(t){let n=2;return t.replace(/\n/g,(()=>"\n"+i._padToThree(n++)+":"))},r._loadShader=function(t){const i=35633===t;let n=i?this._vertexShaderSource:this._fragmentShaderSource,r="";for(const t in this._defines)r+=`#define ${t} ${this._defines[t]}\n`;n=r+n,"webgl2"===this._context.contextVersion&&(n=o.transpileShader(n,i?"vertex":"fragment"));const e=this._context.gl,s=e.createShader(t);return e.shaderSource(s,n),e.compileShader(s),s},i._arrayCopy=function(t){const i=[];for(let n=0;n<t.length;++n)i.push(t[n]);return i},i._arrayAssign=function(t,i){for(let n=0;n<t.length;++n)i[n]=t[n]},t._createClass(i,[{key:"glName",get:function(){return this._glName}},{key:"locations",get:function(){return this._locations}}]),i}();function e(t,i){if(n.isNone(t)||t.length!==i.length)return!0;for(let n=0;n<t.length;++n)if(t[n]!==i[n])return!0;return!1}let s=0;return r}));
