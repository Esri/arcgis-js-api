/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/maybe","./enums","./RenderingContext","./ShaderTranspiler"],(function(t,o,i,n,e,r,s){"use strict";let a=function(){function t(t,o,i,n){this._context=t,this._locations=n,this._vShader=null,this._fShader=null,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},t||console.error("RenderingContext isn't initialized!"),0===o.length&&console.error("Shaders source should not be empty!"),this._vShader=m(this._context,35633,o),this._fShader=m(this._context,35632,i),this._vShader&&this._fShader||console.error("Error loading shaders!");const s=this._context.gl,a=s.createProgram();s.attachShader(a,this._vShader),s.attachShader(a,this._fShader),n.forEach(((t,o)=>s.bindAttribLocation(a,t,o))),s.linkProgram(a),r.webglValidateShadersEnabled()&&!s.getProgramParameter(a,s.LINK_STATUS)&&console.error("Could not initialize shader\nVALIDATE_STATUS: "+s.getProgramParameter(a,s.VALIDATE_STATUS)+", gl error ["+s.getError()+"]infoLog: "+s.getProgramInfoLog(a)),this._glName=a,this._context.instanceCounter.increment(e.ResourceType.Program,this)}var i=t.prototype;return i.dispose=function(){const t=this._context.gl;if(this._vShader){const o=this._vShader;t.deleteShader(o),this._vShader=null}if(this._fShader){const o=this._fShader;t.deleteShader(o),this._fShader=null}this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(e.ResourceType.Program,this))},i._getUniformLocation=function(t){return void 0===this._nameToUniformLocation[t]&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this._glName,t)),this._nameToUniformLocation[t]},i.hasUniform=function(t){return null!==this._getUniformLocation(t)},i.setUniform1i=function(t,o){const i=this._nameToUniform1[t];if(void 0===i||o!==i){this._context.useProgram(this);this._context.gl.uniform1i(this._getUniformLocation(t),o),this._nameToUniform1[t]=o}},i.setUniform1iv=function(t,o){const i=this._nameToUniform1v[t];if(f(i,o)){this._context.useProgram(this);this._context.gl.uniform1iv(this._getUniformLocation(t),o),void 0===i?this._nameToUniform1v[t]=Array.from(o):_(o,i)}},i.setUniform2iv=function(t,o){const i=this._nameToUniform2[t];if(f(i,o)){this._context.useProgram(this);this._context.gl.uniform2iv(this._getUniformLocation(t),o),void 0===i?this._nameToUniform2[t]=Array.from(o):_(o,i)}},i.setUniform3iv=function(t,o){const i=this._nameToUniform3[t];if(f(i,o)){this._context.useProgram(this);this._context.gl.uniform3iv(this._getUniformLocation(t),o),void 0===i?this._nameToUniform3[t]=Array.from(o):_(o,i)}},i.setUniform4iv=function(t,o){const i=this._nameToUniform4[t];if(f(i,o)){this._context.useProgram(this);this._context.gl.uniform4iv(this._getUniformLocation(t),o),void 0===i?this._nameToUniform4[t]=Array.from(o):_(o,i)}},i.setUniform1f=function(t,o){const i=this._nameToUniform1[t];if(void 0===i||o!==i){this._context.useProgram(this);this._context.gl.uniform1f(this._getUniformLocation(t),o),this._nameToUniform1[t]=o}},i.setUniform1fv=function(t,o){const i=this._nameToUniform1v[t];if(f(i,o)){this._context.useProgram(this);this._context.gl.uniform1fv(this._getUniformLocation(t),o),void 0===i?this._nameToUniform1v[t]=Array.from(o):_(o,i)}},i.setUniform2f=function(t,o,i){const n=this._nameToUniform2[t];if(void 0===n||o!==n[0]||i!==n[1]){this._context.useProgram(this);this._context.gl.uniform2f(this._getUniformLocation(t),o,i),void 0===n?this._nameToUniform2[t]=[o,i]:(n[0]=o,n[1]=i)}},i.setUniform2fv=function(t,o){const i=this._nameToUniform2[t];if(f(i,o)){this._context.useProgram(this);this._context.gl.uniform2fv(this._getUniformLocation(t),o),void 0===i?this._nameToUniform2[t]=Array.from(o):_(o,i)}},i.setUniform3f=function(t,o,i,n){const e=this._nameToUniform3[t];if(void 0===e||o!==e[0]||i!==e[1]||n!==e[2]){this._context.useProgram(this);this._context.gl.uniform3f(this._getUniformLocation(t),o,i,n),void 0===e?this._nameToUniform3[t]=[o,i,n]:(e[0]=o,e[1]=i,e[2]=n)}},i.setUniform3fv=function(t,o){const i=this._nameToUniform3[t];if(f(i,o)){this._context.useProgram(this);this._context.gl.uniform3fv(this._getUniformLocation(t),o),void 0===i?this._nameToUniform3[t]=Array.from(o):_(o,i)}},i.setUniform4f=function(t,o,i,n,e){const r=this._nameToUniform4[t];if(void 0===r||o!==r[0]||i!==r[1]||n!==r[2]||e!==r[3]){this._context.useProgram(this);this._context.gl.uniform4f(this._getUniformLocation(t),o,i,n,e),void 0===r?this._nameToUniform4[t]=[o,i,n,e]:(r[0]=o,r[1]=i,r[2]=n,r[3]=e)}},i.setUniform4fv=function(t,o){const i=this._nameToUniform4[t];if(f(i,o)){this._context.useProgram(this);this._context.gl.uniform4fv(this._getUniformLocation(t),o),void 0===i?this._nameToUniform4[t]=Array.from(o):_(o,i)}},i.setUniformMatrix3fv=function(t,o,i=!1){const n=this._nameToUniformMatrix3[t];if(g(n,o)){this._context.useProgram(this);this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),i,o),void 0===n?this._nameToUniformMatrix3[t]=Array.from(o):_(o,n)}},i.setUniformMatrix4fv=function(t,o,i=!1){const n=this._nameToUniformMatrix4[t];if(l(n,o)){this._context.useProgram(this);this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),i,o),void 0===n?this._nameToUniformMatrix4[t]=Array.from(o):_(o,n)}},i.assertCompatibleVertexAttributeLocations=function(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")},i.stop=function(){},o._createClass(t,[{key:"glName",get:function(){return this._glName}}]),t}();function f(t,o){if(n.isNone(t)||t.length!==o.length)return!0;for(let i=0;i<t.length;++i)if(t[i]!==o[i])return!0;return!1}function m(t,o,i){const n="webgl2"===t.webglVersion?s.transpileShader(i,o):i,e=t.gl,a=e.createShader(o);return e.shaderSource(a,n),e.compileShader(a),r.webglValidateShadersEnabled()&&!e.getShaderParameter(a,e.COMPILE_STATUS)&&(console.error("Compile error in ".concat(35633===o?"vertex":"fragment"," shader")),console.error(e.getShaderInfoLog(a)),console.error(h(n)),"webgl2"===t.webglVersion&&(console.log("Shader source before transpilation:"),console.log(i))),a}function h(t){let o=2;return t.replace(/\n/g,(()=>"\n"+c(o++)+":"))}function c(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function _(t,o){for(let i=0;i<t.length;++i)o[i]=t[i]}function g(t,o){return!!n.isNone(t)||(9!==t.length?f(t,o):9!==t.length||t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||t[4]!==o[4]||t[5]!==o[5]||t[6]!==o[6]||t[7]!==o[7]||t[8]!==o[8])}function l(t,o){return!!n.isNone(t)||(16!==t.length?f(t,o):16!==t.length||t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||t[4]!==o[4]||t[5]!==o[5]||t[6]!==o[6]||t[7]!==o[7]||t[8]!==o[8]||t[9]!==o[9]||t[10]!==o[10]||t[11]!==o[11]||t[12]!==o[12]||t[13]!==o[13]||t[14]!==o[14]||t[15]!==o[15])}t.Program=a,Object.defineProperty(t,"__esModule",{value:!0})}));
