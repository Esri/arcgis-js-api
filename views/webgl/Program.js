// COPYRIGHT Â© 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.2/esri/copyright.txt for details.

define(["require","exports","dojo/has"],function(t,i,o){var r=o("dojo-debug-messages"),e=function(){function t(i,o,r,e,n){this._context=null,this._glName=null,this._locations={},this._id=void 0,this._initialized=!1,this._vShader=null,this._fShader=null,this._defines=void 0,this._nameToUniformLocation={},this._nameToAttribLocation={},this._nameToUniform1={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},i||console.error("RenderingContext isn't initialized!"),0===o.length&&console.error("Shaders source should not be empty!"),this._context=i,this._vertexShaderSource=o,this._fragmentShaderSource=r,this._defines=n,this._id=t._nextId++,this._locations=e}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this._context.gl;if(this._vShader){var i=this._vShader;t.deleteShader(i),this._vShader=null}if(this._fShader){var o=this._fShader;t.deleteShader(o),this._fShader=null}this._glName&&(t.deleteProgram(this._glName),this._glName=null)},t.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633),this._fShader=this._loadShader(35632),this._vShader&&this._fShader||console.error("Error loading shaders!");var t=this._context.gl,i=t.createProgram();t.attachShader(i,this._vShader),t.attachShader(i,this._fShader);for(var o in this._locations){var r=this._locations[o];t.bindAttribLocation(i,r,o)}t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+t.getProgramParameter(i,t.VALIDATE_STATUS)+", gl error ["+t.getError()+"]infoLog: "+t.getProgramInfoLog(i)),this._glName=i,this._initialized=!0}},t.prototype.getUniformLocation=function(t){return this.initialize(),void 0===this._nameToUniformLocation[t]&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this._glName,t)),this._nameToUniformLocation[t]},t.prototype.hasUniform=function(t){return null!==this.getUniformLocation(t)},t.prototype.getAttribLocation=function(t){return this.initialize(),void 0===this._nameToAttribLocation[t]&&(this._nameToAttribLocation[t]=this._context.gl.getAttribLocation(this._glName,t)),this._nameToAttribLocation[t]},t.prototype.setUniform1i=function(t,i){var o=this._nameToUniform1[t];if(void 0===o||i!==o){this._context.bindProgram(this);var r=this._context.gl;r.uniform1i(this.getUniformLocation(t),i),this._nameToUniform1[t]=i}},t.prototype.setUniform1f=function(t,i){var o=this._nameToUniform1[t];if(void 0===o||i!==o){this._context.bindProgram(this);var r=this._context.gl;r.uniform1f(this.getUniformLocation(t),i),this._nameToUniform1[t]=i}},t.prototype.setUniform1fv=function(i,o){var r=this._nameToUniform2[i];if(void 0===r||!t._arraysEqual(o,r)){this._context.bindProgram(this);var e=this._context.gl;e.uniform1fv(this.getUniformLocation(i),o),void 0===r?this._nameToUniform2[i]=new Float32Array(o):r.set(o)}},t.prototype.setUniform2f=function(t,i,o){var r=this._nameToUniform2[t];if(void 0===r||i!==r[0]||o!==r[1]){this._context.bindProgram(this);var e=this._context.gl;e.uniform2f(this.getUniformLocation(t),i,o),void 0===r?this._nameToUniform2[t]=new Float32Array([i,o]):(r[0]=i,r[1]=o)}},t.prototype.setUniform2fv=function(i,o){r&&o.length%2!==0&&console.error("Value array must have even number of elements!");var e=this._nameToUniform2[i];if(void 0===e||!t._arraysEqual(o,e)){this._context.bindProgram(this);var n=this._context.gl;n.uniform2fv(this.getUniformLocation(i),o),void 0===e?this._nameToUniform2[i]=new Float32Array(o):e.set(o)}},t.prototype.setUniform3f=function(t,i,o,r){var e=this._nameToUniform3[t];if(void 0===e||i!==e[0]||o!==e[1]||r!==e[2]){this._context.bindProgram(this);var n=this._context.gl;n.uniform3f(this.getUniformLocation(t),i,o,r),void 0===e?this._nameToUniform3[t]=new Float32Array([i,o,r]):(e[0]=i,e[1]=o,e[2]=r)}},t.prototype.setUniform3fv=function(i,o){r&&o.length%3!==0&&console.error("Value array must contain sets of three values!");var e=this._nameToUniform3[i];if(void 0===e||!t._arraysEqual(o,e)){this._context.bindProgram(this);var n=this._context.gl;n.uniform3fv(this.getUniformLocation(i),o),void 0===e?this._nameToUniform3[i]=new Float32Array(o):e.set(o)}},t.prototype.setUniform4f=function(t,i,o,r,e){var n=this._nameToUniform4[t];if(void 0===n||i!==n[0]||o!==n[1]||r!==n[2]||e!==n[3]){this._context.bindProgram(this);var a=this._context.gl;a.uniform4f(this.getUniformLocation(t),i,o,r,e),void 0===n?this._nameToUniform4[t]=new Float32Array([i,o,r,e]):(n[0]=i,n[1]=o,n[2]=r,n[3]=e)}},t.prototype.setUniform4fv=function(i,o){r&&o.length%4!==0&&console.error("Value array must contain sets of four values!");var e=this._nameToUniform4[i];if(void 0===e||!t._arraysEqual(o,e)){this._context.bindProgram(this);var n=this._context.gl;n.uniform4fv(this.getUniformLocation(i),o),void 0===e?this._nameToUniform4[i]=new Float32Array(o):e.set(o)}},t.prototype.setUniformMatrix3fv=function(i,o,e){void 0===e&&(e=!1),r&&o.length%9!==0&&console.error("Matrix array must contain sets ot 9 elements!");var n=this._nameToUniformMatrix3[i];if(void 0===n||(9===n.length?!t._matrix3Equal(n,o):!t._arraysEqual(o,n))){this._context.bindProgram(this);var a=this._context.gl;a.uniformMatrix3fv(this.getUniformLocation(i),e,o),void 0===n?this._nameToUniformMatrix3[i]=new Float32Array(o):n.set(o)}},t.prototype.setUniformMatrix4fv=function(i,o,e){void 0===e&&(e=!1),r&&o.length%16!==0&&console.error("Matrix array must contain sets ot 16 elements!");var n=this._nameToUniformMatrix4[i];if(void 0===n||(16===n.length?!t._matrix4Equal(n,o):!t._arraysEqual(o,n))){this._context.bindProgram(this);var a=this._context.gl;a.uniformMatrix4fv(this.getUniformLocation(i),e,o),void 0===n?this._nameToUniformMatrix4[i]=new Float32Array(o):n.set(o)}},t._padToThree=function(t){var i=t.toString();return 1e3>t&&(i=("  "+t).slice(-3)),i},t.prototype._addLineNumbers=function(i){var o=2;return i.replace(/\n/g,function(){return"\n"+t._padToThree(o++)+":"})},t.prototype._loadShader=function(t){var i=35633===t,o=i?this._vertexShaderSource:this._fragmentShaderSource;if(void 0!==this._defines){var r="";if(Array.isArray(this._defines))for(var e=0,n=this._defines;e<n.length;e++){var a=n[e];r+="#define "+a+"\n"}else for(var a in this._defines)r+="#define "+a+"\n";o=r+o}var s=this._context.gl,h=s.createShader(t);return s.shaderSource(h,o),s.compileShader(h),s.getShaderParameter(h,s.COMPILE_STATUS)||(console.error(s.getShaderInfoLog(h)),console.error(this._addLineNumbers(o))),h},t._matrix4Equal=function(t,i){return r&&(16!==t.length||16!==i.length)&&console.error("Matrix object must contain 16 elements!"),t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[7]===i[7]&&t[8]===i[8]&&t[9]===i[9]&&t[10]===i[10]&&t[11]===i[11]&&t[12]===i[12]&&t[13]===i[13]&&t[14]===i[14]&&t[15]===i[15]},t._matrix3Equal=function(t,i){return r&&(9!==t.length||9!==i.length)&&console.error("Matrix object must contain 16 elements!"),t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[7]===i[7]&&t[8]===i[8]},t._arraysEqual=function(t,i){if(t.length!==i.length)return!1;for(var o=0;o<t.length;++o)if(t[o]!==i[o])return!1;return!0},t._nextId=0,t}();return e});