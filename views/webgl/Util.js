/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../core/maybe"],(function(e,t,r){"use strict";function n(e){return e[0].stride}function i(e){switch(e){case 5126:case 5124:case 5125:return 4;case 5122:case 5123:return 2;case 5120:case 5121:return 1;default:throw new Error("Unknown data type")}}function o(e){switch(e){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:case 34041:return 4;case 33325:return 2;case 33326:case 35898:case 33327:return 4;case 33328:case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1}return 0}e.addDescriptor=function(e,t,r,n,o,s){const a=i(n);if(e.length>0){const i=e[0].stride,c=i+a*r;e.forEach((e=>e.stride=c)),e.push({name:t,count:r,type:n,offset:i,stride:c,normalized:o,divisor:s})}else e.push({name:t,count:r,type:n,offset:0,stride:a*r,normalized:o,divisor:s})},e.bindVertexBufferLayout=function(e,t,r,n,i){const o=e.gl,s=e.capabilities.instancing;e.bindBuffer(r);for(const e of n){const r=t[e.name],n=(i||(0+e.baseInstance?e.baseInstance:0))*e.stride;if(void 0===r&&console.error(`There is no location for vertex attribute '${e.name}' defined.`),e.baseInstance&&!e.divisor&&console.error(`Vertex attribute '${e.name}' uses baseInstanceOffset without divisor.`),e.count<=4)o.vertexAttribPointer(r,e.count,e.type,e.normalized,e.stride,e.offset+n),o.enableVertexAttribArray(r),e.divisor&&e.divisor>0&&s&&s.vertexAttribDivisor(r,e.divisor);else if(9===e.count)for(let t=0;t<3;t++)o.vertexAttribPointer(r+t,3,e.type,e.normalized,e.stride,e.offset+12*t+n),o.enableVertexAttribArray(r+t),e.divisor&&e.divisor>0&&s&&s.vertexAttribDivisor(r+t,e.divisor);else if(16===e.count)for(let t=0;t<4;t++)o.vertexAttribPointer(r+t,4,e.type,e.normalized,e.stride,e.offset+16*t+n),o.enableVertexAttribArray(r+t),e.divisor&&e.divisor>0&&s&&s.vertexAttribDivisor(r+t,e.divisor);else console.error("Unsupported vertex attribute element count: "+e.count)}},e.copyFramebufferToTexture=function(e,t,r,n,i=0){const o=e.getBoundFramebufferObject(),s=e.getBoundTexture(0);e.bindFramebuffer(t),e.bindTexture(r,0),e.gl.copyTexImage2D(e.gl.TEXTURE_2D,i,r.descriptor.pixelFormat,n[0],n[1],n[2],n[3],0),e.gl.flush(),e.bindFramebuffer(o),e.bindTexture(s,0)},e.findAttribute=function(e,t){for(let r=0;r<e.length;r++)if(e[r].name===t)return e[r];return null},e.getBytesPerElement=i,e.getBytesPerElementFormat=o,e.getGpuMemoryUsage=function e(t){if(r.isNone(t))return 0;if("colorAttachment"in t)return t.glName?e(t.colorAttachment)+e(t.depthStencilAttachment):0;if("descriptor"in t)return t.glName?e(t.descriptor):0;const n=t.internalFormat||"pixelFormat"in t&&t.pixelFormat;if(!n)return 0;const i="hasMipmap"in t&&t.hasMipmap?1.3:1,s=t.width*t.height;return o(n)*s*i},e.getStride=n,e.getTypedArrayConstructor=function(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array;default:throw new Error("Unknown data type")}},e.hasAttribute=function(e,t){for(let r=0;r<e.length;r++)if(e[r].name===t)return!0;return!1},e.setBaseInstanceOffset=function(e,t){const r={};for(const n in e)r[n]=e[n].map((e=>e.divisor?{...e,baseInstance:t}:e));return r},e.unbindVertexBufferLayout=function(e,t,r,n){const i=e.gl,o=e.capabilities.instancing;e.bindBuffer(r);for(const e of n){const r=t[e.name];if(e.count<=4)i.disableVertexAttribArray(r),e.divisor&&e.divisor>0&&o&&o.vertexAttribDivisor(r,0);else if(9===e.count)for(let t=0;t<3;t++)i.disableVertexAttribArray(r+t),e.divisor&&e.divisor>0&&o&&o.vertexAttribDivisor(r+t,0);else if(16===e.count)for(let t=0;t<4;t++)i.disableVertexAttribArray(r+t),e.divisor&&e.divisor>0&&o&&o.vertexAttribDivisor(r+t,0);else console.error("Unsupported vertex attribute element count: "+e.count)}e.unbindBuffer(34962)},e.vertexCount=function(e,t){return e.vertexBuffers[t].size/n(e.layout[t])},Object.defineProperty(e,"__esModule",{value:!0})}));
