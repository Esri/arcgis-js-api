/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../Program","../BufferObject","../Texture","../VertexArrayObject","../RenderingContext"],(function(t,e,i,s,r){"use strict";return function(){function a(t,e,i,s,a){this._vertexAttributeLocations={pos:0,tex:1},this._context=void 0,this._glslProgram=void 0,this._vertexAttributes=void 0,this._vertexArrayObject=void 0,this._texture=void 0,this._geometryData=void 0,this._initialized=!1,t||console.error("WebGL rendering context is not initialized!"),this._context=new r(t),this._posX=e,this._posY=i,this._dx=.05*Math.random()*s*(Math.random()<.5?-1:1),this._dy=.05*Math.random()*a*(Math.random()<.5?-1:1),this._canvasWidth=s,this._canvasHieght=a}var o=a.prototype;return o.draw=function(){if(!this._initialize())return;this._updatePos();const t=this._context;t.setBlendingEnabled(!0),t.setBlendFunction(770,771),t.setClearColor(1,1,1,1),t.clear(t.gl.COLOR_BUFFER_BIT),t.bindVAO(this._vertexArrayObject),t.bindProgram(this._glslProgram),t.bindTexture(this._texture,0),t.drawArrays(5,0,4)},o._updatePos=function(){this._posX+=this._dx,this._posY+=this._dy,(this._posX<0||this._posX>this._canvasWidth)&&(this._dx=-this._dx),(this._posY<0||this._posY>this._canvasHieght)&&(this._dy=-this._dy);const t=this._vertexArrayObject.vertexBuffers.geometry;t&&(this._populateBuffer(256),t.setData(this._geometryData))},o._initialize=function(){if(this._initialized)return!0;this._glslProgram=new t(this._context,"\n      precision highp float;\n\n      // geometry attributes\n      attribute vec2 pos;\n      attribute vec2 tex;\n\n      varying vec2 v_tex;\n\n      void main(void)\n      {\n        gl_Position = vec4(pos, 0.0, 1.0);\n        v_tex = tex;\n      }","\n      precision highp float;\n      uniform sampler2D u_texture;\n\n      varying vec2 v_tex;\n      void main(void)\n      {\n        vec4 color = texture2D(u_texture, v_tex);\n        gl_FragColor = color;\n      }",this._vertexAttributeLocations),this._vertexAttributes={geometry:[{name:"pos",count:2,type:5126,offset:0,stride:16,normalized:!1,divisor:0},{name:"tex",count:2,type:5126,offset:8,stride:16,normalized:!1,divisor:0}]};const r=document.createElement("canvas");r.width=256,r.height=256;const a=r.getContext("2d");a.clearRect(0,0,0,0);const o=r.width/2,n=r.height/2,h=r.height/2-15;a.beginPath(),a.arc(o,n,h,0,2*Math.PI,!1),a.fillStyle="green",a.fill(),a.lineWidth=5,a.strokeStyle="#003300",a.stroke(),this._populateBuffer(256);const _=e.createVertex(this._context,35048,this._geometryData);return this._vertexArrayObject=new s(this._context,this._vertexAttributeLocations,this._vertexAttributes,{geometry:_}),this._texture=new i(this._context,{target:3553,pixelFormat:6408,dataType:5121,flipped:!0},r),this._initialized=!0,!1},o._populateBuffer=function(t){const e=2*(this._posX/this._canvasWidth-.5),i=2*((this._canvasHieght-this._posY)/this._canvasHieght-.5),s=1*t/this._canvasWidth,r=1*t/this._canvasHieght;this._geometryData||(this._geometryData=new Float32Array(16)),this._geometryData[0]=e+s,this._geometryData[1]=i+r,this._geometryData[2]=1,this._geometryData[3]=1,this._geometryData[4]=e+s,this._geometryData[5]=i-r,this._geometryData[6]=1,this._geometryData[7]=0,this._geometryData[8]=e-s,this._geometryData[9]=i+r,this._geometryData[10]=0,this._geometryData[11]=1,this._geometryData[12]=e-s,this._geometryData[13]=i-r,this._geometryData[14]=0,this._geometryData[15]=0},a}()}));
