/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/Logger","../../core/typedArrayUtil","./checkWebGLError","./enums"],(function(e,t,i,n,r){"use strict";const s=t.getLogger("esri.views.webgl.BufferObject");return function(){function t(e,t,i,s,o){this._context=e,this.bufferType=t,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(r.ResourceType.Buffer,this),this._glName=this._context.gl.createBuffer(),n.checkWebGLError(this._context.gl),s&&this.setData(s,o)}t.createIndex=function(e,i,n,r){return new t(e,34963,i,n,r)},t.createVertex=function(e,i,n){return new t(e,34962,i,n)};var o=t.prototype;return o.dispose=function(){var e;if(null!=(e=this._context)&&e.gl){if(this._glName){this._context.gl.deleteBuffer(this._glName),this._glName=null}this._context.instanceCounter.decrement(r.ResourceType.Buffer,this),this._context=null}else this._glName&&s.warn("Leaked WebGL buffer object")},o.setData=function(e,t){if(!e)return;if("number"==typeof e){if(e<0&&s.error("Buffer size cannot be negative!"),this._size=e,34963===this.bufferType&&t)switch(this._indexType=t,this._size=e,t){case 5123:e*=2;break;case 5125:e*=4}}else{let t=e.byteLength;i.isUint16Array(e)&&(t/=2,this._indexType=5123),i.isUint32Array(e)&&(t/=4,this._indexType=5125),this._size=t}const r=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;o.bufferData(this.bufferType,e,this.usage),n.checkWebGLError(o),this._context.bindVAO(r)},o.setSubData=function(e,t=0,r=0,o=e.byteLength){if(!e)return;(t<0||t>=this._size)&&s.error("offset is out of range!");let h=t,u=r,f=o,c=e.byteLength;i.isUint16Array(e)?(c/=2,h*=2,u*=2,f*=2):i.isUint32Array(e)&&(c/=4,h*=4,u*=4,f*=4),void 0===o&&(o=c-1),r>=o&&s.error("end must be bigger than start!"),t+r-o>this._size&&s.error("An attempt to write beyond the end of the buffer!");const a=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const b=this._context.gl,_=ArrayBuffer.isView(e)?e.buffer:e,l=0===u&&f===e.byteLength?_:_.slice(u,f);b.bufferSubData(this.bufferType,h,l),n.checkWebGLError(b),this._context.bindVAO(a)},o.setSubDataFromView=function(e,t,i,r){if(!e)return;(t<0||t>=this._size)&&s.error("offset is out of range!"),i>=r&&s.error("end must be bigger than start!"),t+i-r>this._size&&s.error("An attempt to write beyond the end of the buffer!");const o=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,u=0===i&&r===e.length?e:e.subarray(i,r);h.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,u),n.checkWebGLError(h),this._context.bindVAO(o)},e._createClass(t,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}}]),t}()}));
