/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/vec2f64","../../chunks/vec3","../../chunks/vec3f64","../3d/state/utils/navigationUtils","./FilteredFiniteDifference","./FilteredValue","./Momentum"],(function(e,t,i,s,n,l,a,r,h){"use strict";const u=1e-5;let c=function(e){function i(t,i,s,n,l,a=0,r){var h;return(h=e.call(this,t,i,s)||this)._angularVelocity1=n,h.axis1=l,h.angularVelocity2=a,h.axis2=r,h}t._inheritsLoose(i,e);var s=i.prototype;return s.value1=function(t){return e.prototype.valueFromInitialVelocity.call(this,this._angularVelocity1,t)},s.value2=function(t){return e.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,t)},i}(h.Momentum),o=function(){function e(e=300,t=12,s=.84){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=s,this.enabled=!0,this._tmpAxis1=n.create(),this._tmpAxis2=n.create(),this._tmpAngles=i.create(),this._time=new a.FilteredFiniteDifference(.3),this._screen=[new a.FilteredFiniteDifference(.4),new a.FilteredFiniteDifference(.4)],this._angle1=new r.FilteredValue(.6),this._angle2=new r.FilteredValue(.6),this._axis1=n.create(),this._axis2=n.create(),this._lastScene=n.create()}var t=e.prototype;return t.addMomentumDirectRotation=function(e,t,i,n,a,r){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let e=l.rotationAngleAndAxisDirectRotation(this._lastScene,t,this._tmpAxis2,n,a,r);this._angle2.update(0),s.squaredLength(this._tmpAxis2)<u?e=0:s.normalize(this._axis1,this._tmpAxis2),this._angle1.update(e),s.copy(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}},t.addMomentumPreserveHeading=function(e,t,i,n,a,r,h){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;l.rotationAnglesAndAxesHeadingPreserving(this._lastScene,t,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,a,r,h,!1),s.squaredLength(this._tmpAxis2)<u?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),s.normalize(this._axis1,this._tmpAxis1),s.normalize(this._axis2,this._tmpAxis2)),s.copy(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}},t.reset=function(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()},t.evaluateMomentum=function(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,i=null==e||null==t?null:Math.sqrt(e*e+t*t),s=this._time.filteredDelta,n=null==i||null==s?0:i/s;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)},t.createMomentum=function(e,t,i){const s=this._time.filteredDelta,n=this._angle1.filteredValue,l=this._angle2.filteredValue,a=null==s||null==l?0:l/s;return new c(e,t,i,null==s||null==n?0:n/s,this._axis1,a,this._axis2)},e}();e.PanSphericalMomentum=c,e.PanSphericalMomentumEstimator=o,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
