/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import e from"../../Color.js";import{isSome as t,isNone as o}from"../../core/maybe.js";import{getVisualVariableValues as r}from"../visualVariables/support/visualVariableUtils.js";function i(e,o){if(!e||e.symbol)return null;const r=o&&o.renderer;return e&&t(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function n(e,o){if(t(e.symbol))return e.symbol;const r=i(e,o);return t(r)&&"dot-density"!==r.type?r.getSymbol(e,o):null}function a(e,t){const a=i(e,t),l=n(e,t);if(o(l))return null;const s={renderer:a,symbol:l};if(o(a)||!("visualVariables"in a)||!a.visualVariables)return s;const u=r(a,e,t),c=["proportional","proportional","proportional"];for(const{variable:o,value:r}of u)switch(o.type){case"color":s.color=r.toRgba();break;case"size":if("outline"===o.target)s.outlineSize=r;else{const e=o.axis,t=o.useSymbolValue?"symbol-value":r;switch(e){case"width":c[0]=t;break;case"depth":c[1]=t;break;case"height":c[2]=t;break;case"width-and-depth":c[0]=c[1]=t;break;default:c[0]=c[1]=c[2]=t}}break;case"opacity":s.opacity=r;break;case"rotation":switch(o.axis){case"tilt":s.tilt=r;break;case"roll":s.roll=r;break;default:s.heading=r}}return"proportional"===c[0]&&"proportional"===c[1]&&"proportional"===c[2]||(s.size=c),s}async function l(e,o){if(t(e.symbol))return e.symbol;const r=i(e,o);return t(r)&&r.getSymbolAsync(e,o)}async function s(t,o){const n=i(t,o),a=await l(t,o);if(!a)return null;const s={renderer:n,symbol:a};if(!n||!("visualVariables"in n)||!n.visualVariables)return s;const u=r(n,t,o),c=["proportional","proportional","proportional"];for(const{variable:r,value:i}of u)if("color"===r.type)s.color=e.toUnitRGBA(i);else if("size"===r.type)if("outline"===r.target)s.outlineSize=i;else{const e=r.axis,t=r.useSymbolValue?"symbol-value":i;"width"===e?c[0]=t:"depth"===e?c[1]=t:"height"===e?c[2]=t:c[0]=c[1]="width-and-depth"===e?t:c[2]=t}else"opacity"===r.type?s.opacity=i:"rotation"===r.type&&"tilt"===r.axis?s.tilt=i:"rotation"===r.type&&"roll"===r.axis?s.roll=i:"rotation"===r.type&&(s.heading=i);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function u(e,t=0){const o=e[t];return"number"==typeof o&&isFinite(o)?o:null}function c(e){for(let t=0;t<3;t++){const o=e[t];if("number"==typeof o)return isFinite(o)?o:0}return 0}export{u as getDriverAxisSizeValue,c as getDriverAxisSizeValueAny,i as getRenderer,a as getRenderingInfo,s as getRenderingInfoAsync,l as getSymbolAsync};
