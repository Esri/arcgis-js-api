/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../core/global","../../core/mathUtils"],(function(t,e,n){"use strict";const a=(()=>{if(!("document"in e))return()=>null;const t=document.createElement("canvas"),n=t.getContext("2d"),a=512;return t.height=a,t.width=1,e=>{n.clearRect(0,0,1,t.height);const a=n.createLinearGradient(0,0,0,t.height);for(const{ratio:t,color:n}of e.colorStops)a.addColorStop(Math.max(t,.001),`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`);return n.fillStyle=a,n.fillRect(0,0,1,t.height),n.getImageData(0,0,1,t.height).data}})();function r(t,e,n,a){const{blurRadius:r,fieldOffset:o,field:c}=e,i=new Float64Array(n*a),l=u(r),s=Math.round(3*r);let h,d=Number.NEGATIVE_INFINITY;const m=f(c,o);for(const{geometry:u,attributes:f}of t){const t=u.x-s,e=u.y-s,r=Math.max(0,t),o=Math.max(0,e),c=Math.min(a,u.y+s),g=Math.min(n,u.x+s),y=+m(f);for(let a=o;a<c;a++){const o=l[a-e];for(let e=r;e<g;e++){const r=l[e-t];h=i[a*n+e]+=o*r*y,h>d&&(d=h)}}}return{matrix:i.buffer,max:d}}function o(t,e,n,a){const{blurRadius:r,fieldOffset:o,field:c}=e,i=new Float64Array(n*a),f=u(r),s=Math.round(3*r);let h,d=Number.NEGATIVE_INFINITY;const m=l(c,o),g=new Set;for(const u of t){const t=u.getCursor();for(;t.next();){const e=t.getObjectId();if(g.has(e))continue;g.add(e);const r=t.readLegacyPointGeometry(),o=128;if(r.x<-o||r.x>=n+o||r.y<-o||r.y>a+o)continue;const c=+m(t),u=Math.round(r.x)-s,l=Math.round(r.y)-s,y=Math.max(0,u),M=Math.max(0,l),x=Math.min(a,Math.round(r.y)+s),b=Math.min(n,Math.round(r.x)+s);for(let t=M;t<x;t++){const e=f[t-l];for(let a=y;a<b;a++){const r=f[a-u];h=i[t*n+a]+=e*r*c,h>d&&(d=h)}}}}return{matrix:i.buffer,max:d}}function c(t,e,n,a,r,o){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const c=t.getImageData(0,0,e,e);n&&a&&c.data.set(new Uint8ClampedArray(i(e,n,a,r,o))),t.putImageData(c,0,0)}function i(t,e,a,r,o){const c=new Uint32Array(t*t),i="buffer"in e?e:new Float64Array(e),u="buffer"in a?new Uint32Array(a.buffer):new Uint32Array(new Uint8Array(a).buffer),f=u.length/(o-r);for(let l=0;l<i.length;l++){const t=i[l],e=Math.floor((t-r)*f);c[l]=u[n.clamp(e,0,u.length-1)]}return c.buffer}function u(t){const e=Math.round(3*t),n=2*t*t,a=new Float64Array(2*e+1);for(let r=0;r<=a.length;r++)a[r]=Math.exp(-((r-e)**2)/n)/Math.sqrt(2*Math.PI)*(t/2);return a}function f(t,e){return"function"==typeof t?t:t?"string"==typeof e?e=>-1*+e[t]:n=>+n[t]+e:()=>1}function l(t,e){return null!=t?"string"==typeof e?e=>-1*+e.readAttribute(t):n=>+n.readAttribute(t)+e:t=>1}t.calculateHeatmapIntensityInfo=r,t.calculateHeatmapIntensityInfoReaders=o,t.createHeatmapImageData=i,t.createKernel=u,t.createValueFunction=f,t.createValueFunctionCursor=l,t.drawHeatmap=c,t.generateGradient=a,Object.defineProperty(t,"__esModule",{value:!0})}));
