/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec4","../../chunks/vec4f64"],(function(t,e,n,r,a){"use strict";const o=2.4;function i(t){return n.px2pt(t*o)}function c(t){return n.pt2px(t)/o}function u(t,n,a,o){let{color:i,ratio:c}=n,{color:u,ratio:s}=a;if(s===c){const t=1e-6;1===s?c-=t:s+=t}const f=e.clamp((o-c)/(s-c),0,1);r.lerp(t,i.toArray(),u.toArray(),f)}function s(t){const e=512,n=new Uint8ClampedArray(4*e);if(t=t.filter((({ratio:t})=>t>=0&&t<=1)).sort(((t,e)=>t.ratio-e.ratio)).map((({color:t,ratio:e})=>({color:t,ratio:Math.max(e,.001)}))),t.length<1)return n;let r=t[0],o=t[0],i=1;const c=a.create();for(let a=0;a<e;a++){const s=(a+.5)/e;for(;s>o.ratio&&i<t.length;)r=o,o=t[i++];u(c,r,o,s),n.set(c,4*a)}return n}function f(t,e,r,a){const{radius:o,fieldOffset:i,field:c}=e,u=Math.round(n.pt2px(o)),s=new Float64Array(r*a);let f,l=Number.NEGATIVE_INFINITY;const d=m(c,i),h=new Set;for(const n of t){const t=n.getCursor();for(;t.next();){const e=t.getObjectId();if(h.has(e))continue;h.add(e);const n=t.readLegacyPointGeometry(),o=128;if(n.x<-o||n.x>=r+o||n.y<-o||n.y>a+o)continue;const i=+d(t),c=Math.max(0,Math.round(n.x)-u),m=Math.max(0,Math.round(n.y)-u),p=Math.min(a,Math.round(n.y)+u),g=Math.min(r,Math.round(n.x)+u);for(let t=m;t<p;t++)for(let e=c;e<g;e++){const a=t*r+e,o=y(n.x-e,n.y-t,u);f=s[a]+=o*i,f>l&&(l=f)}}}return{matrix:s.buffer,max:l}}function l(t,e,n,r,a,o){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const i=t.getImageData(0,0,e,e);n&&r&&i.data.set(new Uint8ClampedArray(d(e,n,r,a,o))),t.putImageData(i,0,0)}function d(t,n,r,a,o){const i=new Uint32Array(t*t),c="buffer"in n?n:new Float64Array(n),u="buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer),s=u.length/(o-a);for(let f=0;f<c.length;f++){const t=c[f],n=Math.floor((t-a)*s);i[f]=u[e.clamp(n,0,u.length-1)]}return i.buffer}function y(t,e,n){const r=Math.sqrt(t**2+e**2)/n;return r>1?0:3/(Math.PI*n**2)*(1-r**2)**2}function h(t,e){return"function"==typeof t?t:t?"string"==typeof e?e=>-1*+e[t]:n=>+n[t]+e:()=>1}function m(t,e){return null!=t?"string"==typeof e?e=>-1*+e.readAttribute(t):n=>+n.readAttribute(t)+e:t=>1}t.MAGIC_KERNEL_DENSITY_RADIUS_INFLATION_FACTOR=o,t.calculateHeatmapIntensityInfoReaders=f,t.createHeatmapImageData=d,t.createValueFunction=h,t.createValueFunctionCursor=m,t.drawHeatmap=l,t.evaluateDensityKernel=y,t.gaussianBlurRadiusPxToKernelDensityRadiusPt=i,t.generateGradient=s,t.kernelDensityRadiusPtToGaussianBlurRadiusPx=c,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
