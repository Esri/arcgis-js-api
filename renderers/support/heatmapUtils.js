/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/global","../../core/mathUtils"],(function(t,e,n){"use strict";const a=(()=>{if(!("document"in e))return()=>null;const t=document.createElement("canvas"),n=t.getContext("2d");return t.height=512,t.width=1,e=>{n.clearRect(0,0,1,t.height);const a=n.createLinearGradient(0,0,0,t.height);for(const{ratio:t,color:n}of e.colorStops)a.addColorStop(Math.max(t,.001),`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`);return n.fillStyle=a,n.fillRect(0,0,1,t.height),n.getImageData(0,0,1,t.height).data}})();function r(t,e,a,r,o){const c=new Uint32Array(t*t),i="buffer"in e?e:new Float64Array(e),f="buffer"in a?new Uint32Array(a.buffer):new Uint32Array(new Uint8Array(a).buffer),u=f.length/(o-r);for(let t=0;t<i.length;t++){const e=i[t],a=Math.floor((e-r)*u);c[t]=f[n.clamp(a,0,f.length-1)]}return c.buffer}function o(t){const e=Math.round(3*t),n=2*t*t,a=new Float64Array(2*e+1);for(let r=0;r<=a.length;r++)a[r]=Math.exp(-Math.pow(r-e,2)/n)/Math.sqrt(2*Math.PI)*(t/2);return a}function c(t,e){return"function"==typeof t?t:t?"string"==typeof e?e=>-1*+e[t]:n=>+n[t]+e:()=>1}function i(t,e){return null!=t?"string"==typeof e?e=>-1*+e.readAttribute(t):n=>+n.readAttribute(t)+e:t=>1}t.calculateHeatmapIntensityInfo=function(t,e,n,a){const{blurRadius:r,fieldOffset:i,field:f}=e,u=new Float64Array(n*a),l=o(r),s=Math.round(3*r);let h,d=Number.NEGATIVE_INFINITY;const m=c(f,i);for(const{geometry:e,attributes:r}of t){const t=e.x-s,o=e.y-s,c=Math.max(0,t),i=Math.max(0,o),f=Math.min(a,e.y+s),g=Math.min(n,e.x+s),y=+m(r);for(let e=i;e<f;e++){const a=l[e-o];for(let r=c;r<g;r++){const o=l[r-t];h=u[e*n+r]+=a*o*y,h>d&&(d=h)}}}return{matrix:u.buffer,max:d}},t.calculateHeatmapIntensityInfoReaders=function(t,e,n,a){const{blurRadius:r,fieldOffset:c,field:f}=e,u=new Float64Array(n*a),l=o(r),s=Math.round(3*r);let h,d=Number.NEGATIVE_INFINITY;const m=i(f,c),g=new Set;for(const e of t){const t=e.getCursor();for(;t.next();){const e=t.getObjectId();if(g.has(e))continue;g.add(e);const r=t.readLegacyPointGeometry(),o=+m(t),c=r.x-s,i=r.y-s,f=Math.max(0,c),y=Math.max(0,i),b=Math.min(a,r.y+s),I=Math.min(n,r.x+s);for(let t=y;t<b;t++){const e=l[t-i];for(let a=f;a<I;a++){const r=l[a-c];h=u[t*n+a]+=e*r*o,h>d&&(d=h)}}}}return{matrix:u.buffer,max:d}},t.createHeatmapImageData=r,t.createKernel=o,t.createValueFunction=c,t.createValueFunctionCursor=i,t.drawHeatmap=function(t,e,n,a,o,c){t.canvas.width=t.canvas.height=e,t.clearRect(0,0,e,e);const i=t.getImageData(0,0,e,e);n&&a&&i.data.set(new Uint8ClampedArray(r(e,n,a,o,c))),t.putImageData(i,0,0)},t.generateGradient=a,Object.defineProperty(t,"__esModule",{value:!0})}));
