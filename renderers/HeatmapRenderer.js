/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../Color","../symbols","../core/deprecate","../core/lang","../core/Logger","../core/scheduling","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/utils","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","./Renderer","./support/AuthoringInfo","./support/HeatmapColorStop","./support/HeatmapLegendOptions","./support/heatmapUtils","../symbols/SimpleMarkerSymbol"],(function(e,t,r,i,n,o,s,p,a,l,u,y,c,d,m,h,_,f,g,x,b){"use strict";var w;const D="esri.renderers.HeatmapRenderer",I=s.getLogger(D);function v(e){if(null!=e){const{maxDensity:t,minDensity:r,radius:i}=e;if(null!=t||null!=r||null!=i){const{blurRadius:t,maxPixelIntensity:r,minPixelIntensity:i,...n}=e;return n}}return e}let S=w=function(t){function i(e){var i;return(i=t.call(this,e)||this).authoringInfo=null,i.colorStops=[new f({ratio:0,color:new r("rgba(255, 140, 0, 0)")}),new f({ratio:.75,color:new r("rgba(255, 140, 0, 1)")}),new f({ratio:.9,color:new r("rgba(255, 0,   0, 1)")})],i.field=null,i.fieldOffset=0,i.legendOptions=null,i.maxDensity=.04,i.minDensity=0,i.radius=18,i.referenceScale=0,i.type="heatmap",i.valueExpression=null,i.valueExpressionTitle=null,i._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1},i}e._inheritsLoose(i,t);var s=i.prototype;return s.normalizeCtorArgs=function(e){return v(e)},s._warnAboutDeprecatedGaussianBlurProp=function(e,t){if(this._warnedProps[e])return;"user"===u.getProperties(this).getDefaultOrigin()&&(this._warnedProps[e]=!0,p.schedule((()=>{n.deprecatedProperty(I,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})})))},s.read=function(e,r){e=v(e),t.prototype.read.call(this,e,r)},s.getSymbol=function(){return new b},s.getSymbolAsync=function(){var t=e._asyncToGenerator((function*(){return this.getSymbol()}));function r(){return t.apply(this,arguments)}return r}(),s.getSymbols=function(){return[this.getSymbol()]},s.collectRequiredFields=function(){var t=e._asyncToGenerator((function*(e,t){const r=this.field,i=this.valueExpression;r&&"string"==typeof r&&(yield m.collectField(e,t,r)),i&&"string"==typeof i&&(yield m.collectArcadeFieldNames(e,t,i))}));function r(e,r){return t.apply(this,arguments)}return r}(),s.getAttributeHash=function(){return null},s.getMeshHash=function(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`},s.clone=function(){return new w({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:o.clone(this.colorStops),field:this.field,legendOptions:o.clone(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})},e._createClass(i,[{key:"blurRadius",get:function(){return x.kernelDensityRadiusPtToGaussianBlurRadiusPx(this.radius)},set:function(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",x.gaussianBlurRadiusPxToKernelDensityRadiusPt(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}},{key:"maxPixelIntensity",get:function(){return this.maxDensity/this._pixelIntensityToDensity},set:function(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}},{key:"minPixelIntensity",get:function(){return this.minDensity/this._pixelIntensityToDensity},set:function(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}},{key:"_pixelIntensityToDensity",get:function(){return 24/(x.MAGIC_KERNEL_DENSITY_RADIUS_INFLATION_FACTOR**2*this.blurRadius**4)}}]),i}(h);t.__decorate([l.property({type:_,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],S.prototype,"authoringInfo",void 0),t.__decorate([l.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],S.prototype,"blurRadius",null),t.__decorate([l.property({type:[f],json:{write:!0}})],S.prototype,"colorStops",void 0),t.__decorate([l.property({type:String,json:{write:!0}})],S.prototype,"field",void 0),t.__decorate([l.property({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:null==r})},origins:{"web-scene":{write:!1}}}})],S.prototype,"fieldOffset",void 0),t.__decorate([l.property({type:g.HeatmapLegendOptions,json:{write:!0}})],S.prototype,"legendOptions",void 0),t.__decorate([l.property({type:Number,json:{write:!0}})],S.prototype,"maxDensity",void 0),t.__decorate([l.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],S.prototype,"maxPixelIntensity",null),t.__decorate([l.property({type:Number,json:{write:!0}})],S.prototype,"minDensity",void 0),t.__decorate([l.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],S.prototype,"minPixelIntensity",null),t.__decorate([l.property({type:Number,cast:a.toPt,json:{write:!0}})],S.prototype,"radius",void 0),t.__decorate([l.property({type:Number,range:{min:0},json:{default:0,write:!0}})],S.prototype,"referenceScale",void 0),t.__decorate([c.enumeration({heatmap:"heatmap"})],S.prototype,"type",void 0),t.__decorate([l.property({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],S.prototype,"valueExpression",void 0),t.__decorate([l.property({type:String})],S.prototype,"valueExpressionTitle",void 0),t.__decorate([l.property({readOnly:!0})],S.prototype,"_pixelIntensityToDensity",null),S=w=t.__decorate([d.subclass(D)],S);return S}));
