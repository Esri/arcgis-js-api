define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/has","../kernel","../request","../deferredUtils","./Task","../geometry/Extent","../geometry/Polyline","../geometry/Polygon","../geometry/Multipoint","../geometry/jsonUtils"],function(e,n,t,r,o,i,s,a,l,c,_,d,u,f,h){var m=e(c,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(){var e=n.hitch;this._projectHandler=e(this,this._projectHandler),this._simplifyHandler=e(this,this._simplifyHandler),this._bufferHandler=e(this,this._bufferHandler),this._areasAndLengthsHandler=e(this,this._areasAndLengthsHandler),this._lengthsHandler=e(this,this._lengthsHandler),this._labelPointsHandler=e(this,this._labelPointsHandler),this._relationHandler=e(this,this._relationHandler),this._convexHullHandler=e(this,this._convexHullHandler),this._unionHandler=e(this,this._unionHandler),this._autoCompleteHandler=e(this,this._autoCompleteHandler),this._reshapeHandler=e(this,this._reshapeHandler),this._cutHandler=e(this,this._cutHandler),this._intersectHandler=e(this,this._intersectHandler),this._differenceHandler=e(this,this._differenceHandler),this._trimExtendHandler=e(this,this._trimExtendHandler),this._densifyHandler=e(this,this._densifyHandler),this._generalizeHandler=e(this,this._densifyHandler),this._offsetHandler=e(this,this._offsetHandler),this._distanceHandler=e(this,this._distanceHandler),this._toGeoCoordinateHandler=e(this,this._toGeoCoordinateHandler),this._fromGeoCoordinateHandler=e(this,this._fromGeoCoordinateHandler),this.registerConnectEvents()},_encodeGeometries:function(e){var n,t=[],r=e.length;for(n=0;r>n;n++)t.push(e[n].toJson());return{geometryType:h.getJsonType(e[0]),geometries:t}},_decodeGeometries:function(e,r,o){var i=h.getGeometryType(r),s=e.geometries,a=[],l={spatialReference:o.toJson()},c=n.mixin;return t.forEach(s,function(e,n){a[n]=new i(c(e,l))}),a},_toProjectGeometry:function(e){var n=e.spatialReference.toJson();return e instanceof _?new u({rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],spatialReference:n}):new d({paths:[[].concat(e.points)],spatialReference:n})},_fromProjectedGeometry:function(e,n,t){if("esriGeometryEnvelope"===n){var r=e.rings[0];return new _(r[0][0],r[0][1],r[2][0],r[2][1],t)}return new f({points:e.paths[0],spatialReference:t.toJson()})},project:function(e,t,i,s){var c,_=n.mixin({},this._url.query,{f:"json"});e.geometries?(s=i,i=t,t=e.outSR,c=e.geometries[0],_=n.mixin(_,e.toJson())):(c=e[0],_=n.mixin(_,{outSR:t.wkid||r.toJson(t.toJson()),inSR:c.spatialReference.wkid||r.toJson(c.spatialReference.toJson()),geometries:r.toJson(this._encodeGeometries(e))}));var d=h.getJsonType(c),u=this._projectHandler,f=this._errorHandler,m=new o(l._dfdCanceller);return m._pendingDfd=a({url:this._url.path+"/project",content:_,callbackParamName:"callback",load:function(e,n){u(e,n,d,t,i,s,m)},error:function(e){f(e,s,m)}}),m},_projectHandler:function(e,n,t,r,o,i,s){try{var a=this._decodeGeometries(e,t,r);this._successHandler([a],"onProjectComplete",o,s)}catch(l){this._errorHandler(l,i,s)}},onProjectComplete:function(){},simplify:function(e,t,i){var s=e[0].spatialReference,c=n.mixin({},this._url.query,{f:"json",sr:s.wkid?s.wkid:r.toJson(s.toJson()),geometries:r.toJson(this._encodeGeometries(e))}),_=h.getJsonType(e[0]),d=this._simplifyHandler,u=this._errorHandler,f=new o(l._dfdCanceller);return f._pendingDfd=a({url:this._url.path+"/simplify",content:c,callbackParamName:"callback",load:function(e,n){d(e,n,_,s,t,i,f)},error:function(e){u(e,i,f)}}),f},_simplifyHandler:function(e,n,t,r,o,i,s){try{var a=this._decodeGeometries(e,t,r);this._successHandler([a],"onSimplifyComplete",o,s)}catch(l){this._errorHandler(l,i,s)}},onSimplifyComplete:function(){},convexHull:function(e,t,i){var s=e[0].spatialReference,c=n.mixin({},this._url.query,{f:"json",sr:r.toJson(s.toJson()),geometries:r.toJson(this._encodeGeometries(e))}),_=this._convexHullHandler,d=this._errorHandler,u=new o(l._dfdCanceller);return u._pendingDfd=a({url:this._url.path+"/convexHull",content:c,callbackParamName:"callback",load:function(e,n){_(e,n,s,t,i,u)},error:function(e){d(e,i,u)}}),u},_convexHullHandler:function(e,n,t,r,o,i){try{var s=h.fromJson(e.geometry).setSpatialReference(t);this._successHandler([s],"onConvexHullComplete",r,i)}catch(a){this._errorHandler(a,o,i)}},onConvexHullComplete:function(){},union:function(e,t,i){var s=e[0].spatialReference,c=n.mixin({},this._url.query,{f:"json",sr:r.toJson(s.toJson()),geometries:r.toJson(this._encodeGeometries(e))}),_=this._unionHandler,d=this._errorHandler,u=new o(l._dfdCanceller);return u._pendingDfd=a({url:this._url.path+"/union",content:c,callbackParamName:"callback",load:function(e,n){_(e,n,s,t,i,u)},error:function(e){d(e,i,u)}}),u},_unionHandler:function(e,n,t,r,o,i){try{var s=h.fromJson(e.geometry).setSpatialReference(t);this._successHandler([s],"onUnionComplete",r,i)}catch(a){this._errorHandler(a,o,i)}},onUnionComplete:function(){},autoComplete:function(e,t,i,s){var c=e[0].spatialReference,_=n.mixin({},this._url.query,{f:"json",sr:r.toJson(c.toJson()),polygons:r.toJson(this._encodeGeometries(e).geometries),polylines:r.toJson(this._encodeGeometries(t).geometries)}),d=this._autoCompleteHandler,u=this._errorHandler,f=new o(l._dfdCanceller);return f._pendingDfd=a({url:this._url.path+"/autoComplete",content:_,callbackParamName:"callback",load:function(e,n){d(e,n,c,i,s,f)},error:function(e){u(e,s,f)}}),f},_autoCompleteHandler:function(e,n,t,r,o,i){try{var s,a=e.geometries,l=[],c=a.length;for(s=0;c>s;s++)l[s]=new u({spatialReference:t,rings:a[s].rings});this._successHandler([l],"onAutoCompleteComplete",r,i)}catch(_){this._errorHandler(_,o,i)}},onAutoCompleteComplete:function(){},reshape:function(e,t,i,s){var c=e.spatialReference,_=n.mixin({},this._url.query,{f:"json",sr:r.toJson(c.toJson()),target:r.toJson({geometryType:h.getJsonType(e),geometry:e.toJson()}),reshaper:r.toJson(t.toJson())}),d=this._reshapeHandler,u=this._errorHandler,f=new o(l._dfdCanceller);return f._pendingDfd=a({url:this._url.path+"/reshape",content:_,callbackParamName:"callback",load:function(e,n){d(e,n,c,i,s,f)},error:function(e){u(e,s,f)}}),f},_reshapeHandler:function(e,n,t,r,o,i){try{var s=h.fromJson(e.geometry).setSpatialReference(t);this._successHandler([s],"onReshapeComplete",r,i)}catch(a){this._errorHandler(a,o,i)}},onReshapeComplete:function(){},cut:function(e,i,s,c){var _=e[0].spatialReference,d=t.map(e,function(e){return e.toJson()}),u=n.mixin({},this._url.query,{f:"json",sr:r.toJson(_.toJson()),target:r.toJson({geometryType:h.getJsonType(e[0]),geometries:d}),cutter:r.toJson(i.toJson())}),f=this._cutHandler,m=this._errorHandler,p=new o(l._dfdCanceller);return p._pendingDfd=a({url:this._url.path+"/cut",content:u,callbackParamName:"callback",load:function(e,n){f(e,n,_,s,c,p)},error:function(e){m(e,c,p)}}),p},_cutHandler:function(e,n,r,o,i,s){try{var a=e.geometries,l={};l.cutIndexes=e.cutIndexes,l.geometries=[],t.forEach(a,function(e){l.geometries.push(h.fromJson(e).setSpatialReference(r))}),this._successHandler([l],"onCutComplete",o,s)}catch(c){this._errorHandler(c,i,s)}},onCutComplete:function(){},intersect:function(e,t,i,s){var c=e[0].spatialReference,_=n.mixin({},this._url.query,{f:"json",sr:r.toJson(c.toJson()),geometries:r.toJson(this._encodeGeometries(e)),geometry:r.toJson({geometryType:h.getJsonType(t),geometry:t.toJson()})}),d=this._intersectHandler,u=this._errorHandler,f=new o(l._dfdCanceller);return f._pendingDfd=a({url:this._url.path+"/intersect",content:_,callbackParamName:"callback",load:function(e,n){d(e,n,c,i,s,f)},error:function(e){u(e,s,f)}}),f},_intersectHandler:function(e,n,r,o,i,s){try{var a=e.geometries,l=[];t.forEach(a,function(e){l.push(h.fromJson(e).setSpatialReference(r))}),this._successHandler([l],"onIntersectComplete",o,s)}catch(c){this._errorHandler(c,i,s)}},onIntersectComplete:function(){},difference:function(e,t,i,s){var c=e[0].spatialReference,_=n.mixin({},this._url.query,{f:"json",sr:r.toJson(c.toJson()),geometries:r.toJson(this._encodeGeometries(e)),geometry:r.toJson({geometryType:h.getJsonType(t),geometry:t.toJson()})}),d=this._differenceHandler,u=this._errorHandler,f=new o(l._dfdCanceller);return f._pendingDfd=a({url:this._url.path+"/difference",content:_,callbackParamName:"callback",load:function(e,n){d(e,n,c,i,s,f)},error:function(e){u(e,s,f)}}),f},_differenceHandler:function(e,n,r,o,i,s){try{var a=e.geometries,l=[];t.forEach(a,function(e){l.push(h.fromJson(e).setSpatialReference(r))}),this._successHandler([l],"onDifferenceComplete",o,s)}catch(c){this._errorHandler(c,i,s)}},onDifferenceComplete:function(){},buffer:function(e,t,r){var i=n.mixin({},this._url.query,{f:"json"},e.toJson()),s=e.outSpatialReference||e.geometries[0].spatialReference,c=this._bufferHandler,_=this._errorHandler,d=new o(l._dfdCanceller);return d._pendingDfd=a({url:this._url.path+"/buffer",content:i,callbackParamName:"callback",load:function(e,n){c(e,n,s,t,r,d)},error:function(e){_(e,r,d)}}),d},_bufferHandler:function(e,n,t,r,o,i){try{var s,a=e.geometries,l=[],c=a.length;for(s=0;c>s;s++)l[s]=new u({spatialReference:t,rings:a[s].rings});this._successHandler([l],"onBufferComplete",r,i)}catch(_){this._errorHandler(_,o,i)}},onBufferComplete:function(){},areasAndLengths:function(e,t,r){var i=n.mixin({},this._url.query,{f:"json"},e.toJson()),s=this._areasAndLengthsHandler,c=this._errorHandler,_=new o(l._dfdCanceller);return _._pendingDfd=a({url:this._url.path+"/areasAndLengths",content:i,callbackParamName:"callback",load:function(e,n){s(e,n,t,r,_)},error:function(e){c(e,r,_)}}),_},_areasAndLengthsHandler:function(e,n,t,r,o){try{this._successHandler([e],"onAreasAndLengthsComplete",t,o)}catch(i){this._errorHandler(i,r,o)}},onAreasAndLengthsComplete:function(){},lengths:function(e,t,r){var i=n.mixin({},this._url.query,{f:"json"},e.toJson()),s=this._lengthsHandler,c=this._errorHandler,_=new o(l._dfdCanceller);return _._pendingDfd=a({url:this._url.path+"/lengths",content:i,callbackParamName:"callback",load:function(e,n){s(e,n,t,r,_)},error:function(e){c(e,r,_)}}),_},_lengthsHandler:function(e,n,t,r,o){try{this._successHandler([e],"onLengthsComplete",t,o)}catch(i){this._errorHandler(i,r,o)}},onLengthsComplete:function(){},labelPoints:function(e,i,s){var c=t.map(e,function(e){return e.toJson()}),_=e[0].spatialReference,d=n.mixin({},this._url.query,{f:"json",sr:_.wkid?_.wkid:r.toJson(_.toJson()),polygons:r.toJson(c)}),u=this._labelPointsHandler,f=this._errorHandler,h=new o(l._dfdCanceller);return h._pendingDfd=a({url:this._url.path+"/labelPoints",content:d,callbackParamName:"callback",load:function(n,t){u(n,t,e,_,i,s,h)},error:function(e){f(e,s,h)}}),h},_labelPointsHandler:function(e,n,r,o,i,s,a){try{var l=e.labelPoints,c=[];t.forEach(l,function(e){c.push(h.fromJson(e).setSpatialReference(o))}),this._successHandler([c],"onLabelPointsComplete",i,a)}catch(_){this._errorHandler(_,s,a)}},onLabelPointsComplete:function(){},relation:function(e,t,r){var i=n.mixin({},this._url.query,{f:"json"},e.toJson()),s=this._relationHandler,c=this._errorHandler,_=new o(l._dfdCanceller);return _._pendingDfd=a({url:this._url.path+"/relation",content:i,callbackParamName:"callback",load:function(e,n){s(e,n,t,r,_)},error:function(e){c(e,r,_)}}),_},_relationHandler:function(e,n,t,r,o){try{var i=e.relations;this._successHandler([i],"onRelationComplete",t,o)}catch(s){this._errorHandler(s,r,o)}},onRelationComplete:function(){},trimExtend:function(e,t,r){var i=n.mixin({},this._url.query,{f:"json"},e.toJson()),s=e.sr,c=this._trimExtendHandler,_=this._errorHandler,d=new o(l._dfdCanceller);return d._pendingDfd=a({url:this._url.path+"/trimExtend",content:i,callbackParamName:"callback",load:function(e,n){c(e,n,s,t,r,d)},error:function(e){_(e,r,d)}}),d},_trimExtendHandler:function(e,n,t,r,o,i){try{var s,a=e.geometries,l=[],c=a.length;for(s=0;c>s;s++)l[s]=new d({spatialReference:t,paths:a[s].paths});this._successHandler([l],"onTrimExtendComplete",r,i)}catch(_){this._errorHandler(_,o,i)}},onTrimExtendComplete:function(){},densify:function(e,t,r){var i=n.mixin({},this._url.query,{f:"json"},e.toJson()),s=e.geometries[0].spatialReference,c=this._densifyHandler,_=this._errorHandler,d=new o(l._dfdCanceller);return d._pendingDfd=a({url:this._url.path+"/densify",content:i,callbackParamName:"callback",load:function(e,n){c(e,n,s,t,r,d)},error:function(e){_(e,r,d)}}),d},_densifyHandler:function(e,n,r,o,i,s){try{var a=e.geometries,l=[];t.forEach(a,function(e){l.push(h.fromJson(e).setSpatialReference(r))}),this._successHandler([l],"onDensifyComplete",o,s)}catch(c){this._errorHandler(c,i,s)}},onDensifyComplete:function(){},generalize:function(e,t,r){var i=n.mixin({},this._url.query,{f:"json"},e.toJson()),s=e.geometries[0].spatialReference,c=this._generalizeHandler,_=this._errorHandler,d=new o(l._dfdCanceller);return d._pendingDfd=a({url:this._url.path+"/generalize",content:i,callbackParamName:"callback",load:function(e,n){c(e,n,s,t,r,d)},error:function(e){_(e,r,d)}}),d},_generalizeHandler:function(e,n,r,o,i,s){try{var a=e.geometries,l=[];t.forEach(a,function(e){l.push(h.fromJson(e).setSpatialReference(r))}),this._successHandler([l],"onGeneralizeComplete",o,s)}catch(c){this._errorHandler(c,i,s)}},onGeneralizeComplete:function(){},offset:function(e,t,r){var i=n.mixin({},this._url.query,{f:"json"},e.toJson()),s=e.geometries[0].spatialReference,c=this._offsetHandler,_=this._errorHandler,d=new o(l._dfdCanceller);return d._pendingDfd=a({url:this._url.path+"/offset",content:i,callbackParamName:"callback",load:function(e,n){c(e,n,s,t,r,d)},error:function(e){_(e,r,d)}}),d},_offsetHandler:function(e,n,r,o,i,s){try{var a=e.geometries,l=[];t.forEach(a,function(e){l.push(h.fromJson(e).setSpatialReference(r))}),this._successHandler([l],"onOffsetComplete",o,s)}catch(c){this._errorHandler(c,i,s)}},onOffsetComplete:function(){},distance:function(e,t,r){var i=n.mixin({},this._url.query,{f:"json"},e.toJson()),s=e.geometry1.spatialReference,c=this._distanceHandler,_=this._errorHandler,d=new o(l._dfdCanceller);return d._pendingDfd=a({url:this._url.path+"/distance",content:i,callbackParamName:"callback",load:function(e,n){c(e,n,s,t,r,d)},error:function(e){_(e,r,d)}}),d},_distanceHandler:function(e,n,t,r,o,i){try{e=e&&e.distance,this._successHandler([e],"onDistanceComplete",r,i)}catch(s){this._errorHandler(s,o,i)}},onDistanceComplete:function(){},toGeoCoordinateString:function(e,t,i){var s={};s.sr=n.isObject(e.sr)?e.sr.wkid||r.toJson(e.sr.toJson()):e.sr,s.coordinates=r.toJson(e.coordinates),s.conversionType=e.conversionType||"MGRS",s.conversionMode=e.conversionMode,s.numOfDigits=e.numOfDigits,s.rounding=e.rounding,s.addSpaces=e.addSpaces;var c=n.mixin({},this._url.query,{f:"json"},s),_=this._toGeoCoordinateHandler,d=this._errorHandler,u=new o(l._dfdCanceller);return u._pendingDfd=a({url:this._url.path+"/toGeoCoordinateString",content:c,callbackParamName:"callback",load:function(e,n){_(e,n,t,i,u)},error:function(e){d(e,i,u)}}),u},_toGeoCoordinateHandler:function(e,n,t,r,o){try{var i=e.strings;this._successHandler([i],"onToGeoCoordinateStringComplete",t,o)}catch(s){this._errorHandler(s,r,o)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(e,t,i){var s={};s.sr=n.isObject(e.sr)?e.sr.wkid||r.toJson(e.sr.toJson()):e.sr,s.strings=r.toJson(e.strings),s.conversionType=e.conversionType||"MGRS",s.conversionMode=e.conversionMode;var c=n.mixin({},this._url.query,{f:"json"},s),_=this._fromGeoCoordinateHandler,d=this._errorHandler,u=new o(l._dfdCanceller);return u._pendingDfd=a({url:this._url.path+"/fromGeoCoordinateString",content:c,callbackParamName:"callback",load:function(e,n){_(e,n,t,i,u)},error:function(e){d(e,i,u)}}),u},_fromGeoCoordinateHandler:function(e,n,t,r,o){try{var i=e.coordinates;this._successHandler([i],"onToGeoCoordinateStringComplete",t,o)}catch(s){this._errorHandler(s,r,o)}},onFromGeoCoordinateStringComplete:function(){}});return n.mixin(m,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"}),i("extend-esri")&&n.setObject("tasks.GeometryService",m,s),m});