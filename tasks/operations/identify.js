/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../core/maybe","../../geometry/support/jsonUtils","../../geometry/support/scaleUtils","../../layers/support/layerUtils"],(function(e,t,i,r,n){"use strict";const s=e=>e.spatialReference.wkid||JSON.stringify(e.spatialReference);function o(e,o){const{dpi:a,dynamicLayers:l,gdbVersion:y,geometry:f,geometryPrecision:c,height:m,layerDefinitions:d,layerIds:p,layerOption:u,layerTimeOptions:g,mapExtent:x,maxAllowableOffset:O,returnFieldName:S,returnGeometry:h,returnUnformattedValues:R,returnZ:N,spatialReference:$,timeExtent:b,tolerance:E,width:J}=e.toJSON(),w=o&&t.isSome(o.geometry)?o.geometry:null,T={geometryPrecision:c,maxAllowableOffset:O,returnFieldName:S,returnGeometry:h,returnUnformattedValues:R,returnZ:N,tolerance:E},L=w&&w.toJSON()||f;if(T.imageDisplay=`${J},${m},${a}`,y&&(T.gdbVersion=y),L&&(delete L.spatialReference,T.geometry=JSON.stringify(L),T.geometryType=i.getJsonType(L)),$?T.sr=$.wkid||JSON.stringify($):L&&L.spatialReference?T.sr=s(L):x&&x.spatialReference&&(T.sr=s(x)),T.time=b?b.join(","):null,x){const{xmin:e,ymin:t,xmax:i,ymax:r}=x;T.mapExtent=`${e},${t},${i},${r}`}if(T.layers=u,p&&(T.layers+=`:${p.join(",")}`),d){const e=[];for(let t=0;t<d.length;t++){const i=d[t];e[i.id]=i.definitionExpression}T.layerDefs=n.serializeLayerDefinitions(e)}if(l&&l.length){const e=[],t={extent:x,width:J,spatialReference:x.spatialReference},i=r.getScale(t),s=n.getLayersForScale(i,l);for(let r=0;r<l.length;r++){const t=l[r],i=t.id;if(!t.subLayerIds&&p&&-1!==p.indexOf(i)&&-1!==s.indexOf(i)){const r={id:i};r.source=t.source;let n,s=null;if(d&&d.length){const e=d.filter((e=>e.id===i))[0];s=e&&e.definitionExpression}s&&(r.definitionExpression=s),g&&g[i]&&(n=g[i]),n&&(r.layerTimeOptions=n),e.push(r)}}let o=JSON.stringify(e);"[]"===o&&(o="[{}]"),T.dynamicLayers=o}return T}e.identifyToIdentifyRESTParameters=o,Object.defineProperty(e,"__esModule",{value:!0})}));
