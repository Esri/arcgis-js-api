/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/maybe","../../geometry/support/jsonUtils","../../geometry/support/scaleUtils","../../layers/support/layerUtils"],(function(e,t,i,r,n){"use strict";const s=e=>e.spatialReference.wkid||JSON.stringify(e.spatialReference);function o(e,o){const{dpi:a,dynamicLayers:l,geometry:y,geometryPrecision:f,height:c,layerDefinitions:m,layerIds:p,layerOption:d,layerTimeOptions:u,mapExtent:g,maxAllowableOffset:x,returnFieldName:O,returnGeometry:S,returnUnformattedValues:h,returnZ:R,spatialReference:N,timeExtent:$,tolerance:E,width:J}=e.toJSON(),w=o&&t.isSome(o.geometry)?o.geometry:null,T={geometryPrecision:f,maxAllowableOffset:x,returnFieldName:O,returnGeometry:S,returnUnformattedValues:h,returnZ:R,tolerance:E},b=w&&w.toJSON()||y;if(T.imageDisplay=`${J},${c},${a}`,b&&(delete b.spatialReference,T.geometry=JSON.stringify(b),T.geometryType=i.getJsonType(b)),N?T.sr=N.wkid||JSON.stringify(N):b&&b.spatialReference?T.sr=s(b):g&&g.spatialReference&&(T.sr=s(g)),T.time=$?$.join(","):null,g){const{xmin:e,ymin:t,xmax:i,ymax:r}=g;T.mapExtent=`${e},${t},${i},${r}`}if(T.layers=d,p&&(T.layers+=`:${p.join(",")}`),m){const e=[];for(let t=0;t<m.length;t++){const i=m[t];e[i.id]=i.definitionExpression}T.layerDefs=n.serializeLayerDefinitions(e)}if(l&&l.length){const e=[],t={extent:g,width:J,spatialReference:g.spatialReference},i=r.getScale(t),s=n.getLayersForScale(i,l);for(let r=0;r<l.length;r++){const t=l[r],i=t.id;if(!t.subLayerIds&&p&&-1!==p.indexOf(i)&&-1!==s.indexOf(i)){const r={id:i};r.source=t.source;let n,s=null;if(m&&m.length){const e=m.filter((e=>e.id===i))[0];s=e&&e.definitionExpression}s&&(r.definitionExpression=s),u&&u[i]&&(n=u[i]),n&&(r.layerTimeOptions=n),e.push(r)}}let o=JSON.stringify(e);"[]"===o&&(o="[{}]"),T.dynamicLayers=o}return T}e.identifyToIdentifyRESTParameters=o,Object.defineProperty(e,"__esModule",{value:!0})}));
