// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports"],(function(e,a){"use strict";function r(e,a){return Number(e.toFixed(a))}function n(e,a,r){return e===a?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+a+"%":e+" - "+a}function u(e){for(var a=[],r=[],n=Number.MIN_VALUE,u=1,l=-1,t=0;t<e.length;t++){var i=e[t];i===n?(u++,r[l]=u):null!==i&&(a.push(i),n=i,u=1,r.push(u),l++)}return{uniqueValues:a,valueFrequency:r}}function l(e,a,r,n){for(var u=[],l=[],i=[],s=0,o=[],f=[],h=0;h<n;h++){var c=t(h,e,a,r);o.push(c.sbMean),f.push(c.sbSdcm),s+=f[h]}for(var v,m=s,b=!0;b||s<m;){b=!1,u=[];for(h=0;h<n;h++)u.push(e[h]);for(h=0;h<n;h++)for(var V=e[h]+1;V<=e[h+1];V++)if(v=a[V],h>0&&V!==e[h+1]&&Math.abs(v-o[h])>Math.abs(v-o[h-1]))e[h]=V;else if(h<n-1&&e[h]!==V-1&&Math.abs(v-o[h])>Math.abs(v-o[h+1])){e[h+1]=V-1;break}m=s,s=0,l=[],i=[];for(h=0;h<n;h++){l.push(o[h]),i.push(f[h]);c=t(h,e,a,r);o[h]=c.sbMean,f[h]=c.sbSdcm,s+=f[h]}}if(s>m){for(h=0;h<n;h++)e[h]=u[h],o[h]=l[h],f[h]=i[h];s=m}return{mean:o,sdcm:f}}function t(e,a,r,n){for(var u=0,l=0,t=a[e]+1;t<=a[e+1];t++){var i=n[t];u+=r[t]*i,l+=i}l<=0&&console.log("Exception in Natural Breaks calculation");var s=u/l,o=0;for(t=a[e]+1;t<=a[e+1];t++)o+=n[t]*Math.pow(r[t]-s,2);return{sbMean:s,sbSdcm:o}}Object.defineProperty(a,"__esModule",{value:!0}),a.createGenerateRendererClassBreaks=a.createGenerateRendererUniqueValues=void 0,a.createGenerateRendererUniqueValues=function(e){for(var a=u(e),r=[],n=a.uniqueValues.length,l=0;l<n;l++){var t=a.uniqueValues[l],i=a.valueFrequency[l],s=t.toString();r.push({value:t,count:i,label:s})}return{uniqueValues:r}},a.createGenerateRendererClassBreaks=function(e){var a=e.normalizationTotal;return{classBreaks:function(e){var a=e.definition,i=a.classificationMethod,s=a.breakCount,o=a.normalizationType,f=[],h=e.values;if(0===h.length)return[];var c=(h=h.sort((function(e,a){return e-a})))[0],v=h[h.length-1];if("equal-interval"===i)if(h.length>=s){for(var m=(v-c)/s,b=c,V=1;V<s;V++){var p=r(c+V*m,6);f.push({minValue:b,maxValue:p,label:n(b,p,o)}),b=p}f.push({minValue:b,maxValue:v,label:n(b,v,o)})}else h.forEach((function(e){f.push({minValue:e,maxValue:e,label:n(e,e,o)})}));else if("natural-breaks"===i){var d=u(h),g=function(e,a,r){var n=e.length,u=[];r>n&&(r=n);for(var i=0;i<r;i++)u.push(Math.round(i*n/r-1));u.push(n-1);var s=l(u,e,a,r);(function(e,a,r,n,u,l){for(var i=0,s=0,o=0,f=0,h=!0,c=0;c<2&&h;c++){0===c&&(h=!1);for(var v=0;v<l-1;v++)for(;r[v+1]+1!==r[v+2];){r[v+1]=r[v+1]+1;var m=t(v,r,n,u);o=m.sbMean,i=m.sbSdcm;var b=t(v+1,r,n,u);if(f=b.sbMean,s=b.sbSdcm,!(i+s<a[v]+a[v+1])){r[v+1]=r[v+1]-1;break}a[v]=i,a[v+1]=s,e[v]=o,e[v+1]=f,h=!0}for(v=l-1;v>0;v--)for(;r[v]!==r[v-1]+1;){r[v]=r[v]-1;m=t(v-1,r,n,u);o=m.sbMean,i=m.sbSdcm;b=t(v,r,n,u);if(f=b.sbMean,s=b.sbSdcm,!(i+s<a[v-1]+a[v])){r[v]=r[v]+1;break}a[v-1]=i,a[v]=s,e[v-1]=o,e[v]=f,h=!0}}return h})(s.mean,s.sdcm,u,e,a,r)&&(s=l(u,e,a,r));return u}(d.uniqueValues,d.valueFrequency,s);for(b=c,V=1;V<s;V++)if(d.uniqueValues.length>V){p=r(d.uniqueValues[g[V]],6);f.push({minValue:b,maxValue:p,label:n(b,p,o)}),b=p}f.push({minValue:b,maxValue:v,label:n(b,v,o)})}else if("quantile"===i)if(h.length>=s&&c!==v){b=c;var M=Math.ceil(h.length/s),q=0;for(V=1;V<s;V++){var x=M+q-1;x>h.length&&(x=h.length-1),x<0&&(x=0),f.push({minValue:b,maxValue:h[x],label:n(b,h[x],o)}),b=h[x],q+=M,M=Math.ceil((h.length-q)/(s-V))}f.push({minValue:b,maxValue:v,label:n(b,v,o)})}else for(b=-1,V=0;V<h.length;V++){(p=h[V])!==b&&(b=p,f.push({minValue:b,maxValue:p,label:n(b,p,o)}),b=p)}else if("standard-deviation"===i){var k=function(e){for(var a=0,r=0;r<e.length;r++)a+=e[r];return a/=e.length}(h),S=function(e,a){for(var r=0,n=0;n<e.length;n++){var u=e[n];r+=(u-a)*(u-a)}return r/=e.length,Math.sqrt(r)}(h,k);if(0===S)f.push({minValue:h[0],maxValue:h[0],label:n(h[0],h[0],o)});else{var y=(m=function(e,a,r,n,u){var l=Math.max(n-e,a-n)/u/r;l=l>=1?1:l>=.5?.5:.25;return l}(c,v,s,k,S))*S,B=0;for(b=c,V=s;V>=1;V--){var F=r(k-(V-.5)*y,6);f.push({minValue:b,maxValue:F,label:n(b,F,o)}),b=F,B++}p=r(k+.5*y,6);f.push({minValue:b,maxValue:p,label:n(b,p,o)}),b=p,B++;for(V=1;V<=s;V++)p=B===2*s?v:r(k+(V+.5)*y,6),f.push({minValue:b,maxValue:p,label:n(b,p,o)}),b=p,B++}}return f}(e),normalizationTotal:a}}}));