/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports"],(function(e){"use strict";function t(e,t){return Number(e.toFixed(t))}function l(e,t,l){let n=null;return n=e===t?l&&"percent-of-total"===l?e+"%":e.toString():l&&"percent-of-total"===l?e+"% - "+t+"%":e+" - "+t,n}function n(e){const t=[],l=[];let n=Number.MIN_VALUE,a=1,u=-1;for(let s=0;s<e.length;s++){const o=e[s];o===n?(a++,l[u]=a):null!==o&&(t.push(o),n=o,a=1,l.push(a),u++)}return{uniqueValues:t,valueFrequency:l}}function a(e,t,l,n){let a=[],s=[],o=[],r=0;const i=[],c=[];for(let a=0;a<n;a++){const n=u(a,e,t,l);i.push(n.sbMean),c.push(n.sbSdcm),r+=c[a]}let f,h=r,m=!0;for(;m||r<h;){m=!1,a=[];for(let t=0;t<n;t++)a.push(e[t]);for(let l=0;l<n;l++)for(let a=e[l]+1;a<=e[l+1];a++)if(f=t[a],l>0&&a!==e[l+1]&&Math.abs(f-i[l])>Math.abs(f-i[l-1]))e[l]=a;else if(l<n-1&&e[l]!==a-1&&Math.abs(f-i[l])>Math.abs(f-i[l+1])){e[l+1]=a-1;break}h=r,r=0,s=[],o=[];for(let a=0;a<n;a++){s.push(i[a]),o.push(c[a]);const n=u(a,e,t,l);i[a]=n.sbMean,c[a]=n.sbSdcm,r+=c[a]}}if(r>h){for(let t=0;t<n;t++)e[t]=a[t],i[t]=s[t],c[t]=o[t];r=h}return{mean:i,sdcm:c}}function u(e,t,l,n){let a=0,u=0;for(let s=t[e]+1;s<=t[e+1];s++){const e=n[s];a+=l[s]*e,u+=e}u<=0&&console.log("Exception in Natural Breaks calculation");const s=a/u;let o=0;for(let a=t[e]+1;a<=t[e+1];a++)o+=n[a]*Math.pow(l[a]-s,2);return{sbMean:s,sbSdcm:o}}e.createGenerateRendererClassBreaks=function(e){const{normalizationTotal:s}=e;return{classBreaks:function(e){const s=e.definition,{classificationMethod:o,breakCount:r,normalizationType:i}=s,c=[];let f=e.values;if(0===f.length)return[];f=f.sort(((e,t)=>e-t));const h=f[0],m=f[f.length-1];if("equal-interval"===o)if(f.length>=r){const e=(m-h)/r;let n=h;for(let a=1;a<r;a++){const u=t(h+a*e,6);c.push({minValue:n,maxValue:u,label:l(n,u,i)}),n=u}c.push({minValue:n,maxValue:m,label:l(n,m,i)})}else f.forEach((e=>{c.push({minValue:e,maxValue:e,label:l(e,e,i)})}));else if("natural-breaks"===o){const e=n(f),s=function(e,t,l){const n=e.length,s=[];l>n&&(l=n);for(let e=0;e<l;e++)s.push(Math.round(e*n/l-1));s.push(n-1);let o=a(s,e,t,l);(function(e,t,l,n,a,s){let o=0,r=0,i=0,c=0,f=!0;for(let h=0;h<2&&f;h++){0===h&&(f=!1);for(let h=0;h<s-1;h++)for(;l[h+1]+1!==l[h+2];){l[h+1]=l[h+1]+1;const s=u(h,l,n,a);i=s.sbMean,o=s.sbSdcm;const m=u(h+1,l,n,a);if(c=m.sbMean,r=m.sbSdcm,!(o+r<t[h]+t[h+1])){l[h+1]=l[h+1]-1;break}t[h]=o,t[h+1]=r,e[h]=i,e[h+1]=c,f=!0}for(let h=s-1;h>0;h--)for(;l[h]!==l[h-1]+1;){l[h]=l[h]-1;const s=u(h-1,l,n,a);i=s.sbMean,o=s.sbSdcm;const m=u(h,l,n,a);if(c=m.sbMean,r=m.sbSdcm,!(o+r<t[h-1]+t[h])){l[h]=l[h]+1;break}t[h-1]=o,t[h]=r,e[h-1]=i,e[h]=c,f=!0}}return f})(o.mean,o.sdcm,s,e,t,l)&&(o=a(s,e,t,l));return s}(e.uniqueValues,e.valueFrequency,r);let o=h;for(let n=1;n<r;n++)if(e.uniqueValues.length>n){const a=t(e.uniqueValues[s[n]],6);c.push({minValue:o,maxValue:a,label:l(o,a,i)}),o=a}c.push({minValue:o,maxValue:m,label:l(o,m,i)})}else if("quantile"===o)if(f.length>=r&&h!==m){let e=h,t=Math.ceil(f.length/r),n=0;for(let a=1;a<r;a++){let u=t+n-1;u>f.length&&(u=f.length-1),u<0&&(u=0),c.push({minValue:e,maxValue:f[u],label:l(e,f[u],i)}),e=f[u],n+=t,t=Math.ceil((f.length-n)/(r-a))}c.push({minValue:e,maxValue:m,label:l(e,m,i)})}else{let e=-1;for(let t=0;t<f.length;t++){const n=f[t];n!==e&&(e=n,c.push({minValue:e,maxValue:n,label:l(e,n,i)}),e=n)}}else if("standard-deviation"===o){const e=function(e){let t=0;for(let l=0;l<e.length;l++)t+=e[l];return t/=e.length,t}(f),n=function(e,t){let l=0;for(let n=0;n<e.length;n++){const a=e[n];l+=(a-t)*(a-t)}l/=e.length;return Math.sqrt(l)}(f,e);if(0===n)c.push({minValue:f[0],maxValue:f[0],label:l(f[0],f[0],i)});else{const a=function(e,t,l,n,a){const u=Math.max(n-e,t-n);let s=u/a/l;s=s>=1?1:s>=.5?.5:.25;return s}(h,m,r,e,n)*n;let u=0,s=h;for(let n=r;n>=1;n--){const o=t(e-(n-.5)*a,6);c.push({minValue:s,maxValue:o,label:l(s,o,i)}),s=o,u++}let o=t(e+.5*a,6);c.push({minValue:s,maxValue:o,label:l(s,o,i)}),s=o,u++;for(let n=1;n<=r;n++)o=u===2*r?m:t(e+(n+.5)*a,6),c.push({minValue:s,maxValue:o,label:l(s,o,i)}),s=o,u++}}return c}(e),normalizationTotal:s}},e.createGenerateRendererUniqueValues=function(e){const t=n(e),l=[],a=t.uniqueValues.length;for(let e=0;e<a;e++){const n=t.uniqueValues[e],a=t.valueFrequency[e],u=n.toString();l.push({value:n,count:a,label:u})}return{uniqueValues:l}},Object.defineProperty(e,"__esModule",{value:!0})}));
