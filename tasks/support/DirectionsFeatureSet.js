/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../geometry/SpatialReference","../../geometry/Point","../../geometry/Extent","../../geometry/Polyline","../../geometry","../../Graphic","./FeatureSet"],(function(e,t,r,o,s,a,n,p,i,c,u,l,y,m,d,g,f,h,_){"use strict";let v=function(t){function r(e){var r;return(r=t.call(this,e)||this).extent=null,r.features=null,r.geometryType="polyline",r.routeId=null,r.routeName=null,r.totalDriveTime=null,r.totalLength=null,r.totalTime=null,r}e._inheritsLoose(r,t);var s=r.prototype;return s.readFeatures=function(e,t){(e||[]).forEach((e=>{this._decompressFeatureGeometry(e,t.summary.envelope.spatialReference)}));const r=y.fromJSON(t.spatialReference);return e.map((e=>{const t=h.fromJSON(e),s=e.geometry&&e.geometry.spatialReference;return t.geometry&&!s&&(o.unwrap(t.geometry).spatialReference=r),t.strings=e.strings,t.events=(e.events||[]).map((t=>{const r=new h({geometry:new m({x:t.point.x,y:t.point.y,z:t.point.z,hasZ:void 0!==t.point.z,spatialReference:e.geometry&&e.geometry.spatialReference}),attributes:{ETA:t.ETA,arriveTimeUTC:t.arriveTimeUTC}});return r.strings=t.strings,r})),t}))},s._decompressFeatureGeometry=function(e,t){e.geometry=this._decompressGeometry(e.compressedGeometry,t)},s._decompressGeometry=function(e,t){let r=0,o=0,s=0,a=0;const n=[];let p,i,c,u,l,y,m,d,g=0,f=0,h=0;if(l=e.match(/((\+|\-)[^\+\-\|]+|\|)/g),l||(l=[]),0===parseInt(l[g],32)){g=2;const e=parseInt(l[g],32);g++,y=parseInt(l[g],32),g++,1&e&&(f=l.indexOf("|")+1,m=parseInt(l[f],32),f++),2&e&&(h=l.indexOf("|",f)+1,d=parseInt(l[h],32),h++)}else y=parseInt(l[g],32),g++;for(;g<l.length&&"|"!==l[g];){p=parseInt(l[g],32)+r,g++,r=p,i=parseInt(l[g],32)+o,g++,o=i;const e=[p/y,i/y];f&&(u=parseInt(l[f],32)+s,f++,s=u,e.push(u/m)),h&&(c=parseInt(l[h],32)+a,h++,a=c,e.push(c/d)),n.push(e)}return{paths:[n],hasZ:f>0,hasM:h>0,spatialReference:t}},s._mergePolylinesToSinglePath=function(e,t){let r=[];(e||[]).forEach((e=>{e.paths.forEach((e=>{r=r.concat(e)}))}));const o=[];let s=[0,0];return r.forEach((e=>{e[0]===s[0]&&e[1]===s[1]||(o.push(e),s=e)})),new g({paths:[o]},t)},e._createClass(r,[{key:"mergedGeometry",get:function(){if(!this.features)return null;const e=this.features.map((({geometry:e})=>o.unwrap(e))),t=this.get("extent.spatialReference");return this._mergePolylinesToSinglePath(e,t)}},{key:"strings",get:function(){return this.features.map((({strings:e})=>e))}}]),r}(_);return t.__decorate([n.property({type:d,json:{read:{source:"summary.envelope"}}})],v.prototype,"extent",void 0),t.__decorate([n.property()],v.prototype,"features",void 0),t.__decorate([p.reader("features")],v.prototype,"readFeatures",null),t.__decorate([n.property()],v.prototype,"geometryType",void 0),t.__decorate([n.property({readOnly:!0})],v.prototype,"mergedGeometry",null),t.__decorate([n.property()],v.prototype,"routeId",void 0),t.__decorate([n.property()],v.prototype,"routeName",void 0),t.__decorate([n.property({value:null,readOnly:!0})],v.prototype,"strings",null),t.__decorate([n.property({json:{read:{source:"summary.totalDriveTime"}}})],v.prototype,"totalDriveTime",void 0),t.__decorate([n.property({json:{read:{source:"summary.totalLength"}}})],v.prototype,"totalLength",void 0),t.__decorate([n.property({json:{read:{source:"summary.totalTime"}}})],v.prototype,"totalTime",void 0),v=t.__decorate([i.subclass("esri.tasks.support.DirectionsFeatureSet")],v),v}));
