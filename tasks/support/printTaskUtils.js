/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/screenUtils","../../renderers/visualVariables/support/visualVariableUtils"],(function(e,r,t){"use strict";const i="simple-marker",n="simple-line";function o(e){return e&&"esri.views.2d.layers.GroupLayerView2D"===e.declaredClass}e.applyVisualVariables=function(e,o){const{graphic:a,renderer:s,symbol:l}=o,u=l.type;if("text"===u||"shield-label-symbol"===u||!("visualVariables"in s)||!s.visualVariables)return;const y=s.getVisualVariablesForType("size"),p=s.getVisualVariablesForType("color"),f=s.getVisualVariablesForType("opacity"),c=s.getVisualVariablesForType("rotation"),g=y&&y[0],m=p&&p[0],d=f&&f[0],L=c&&c[0];if(g){const o=u===i?l.style:null,s=t.getSize(g,a,{shape:o});null!=s&&(u===i?e.size=r.px2pt(s):"picture-marker"===u?(e.width=r.px2pt(s),e.height=r.px2pt(s)):u===n?e.width=r.px2pt(s):e.outline&&(e.outline.width=r.px2pt(s)))}if(m){const r=t.getColor(m,a);(r&&u===i||u===n||"simple-fill"===u)&&(e.color=r?r.toJSON():void 0)}if(d){const r=t.getOpacity(d,a);null!=r&&e.color&&(e.color[3]=Math.round(255*r))}L&&(e.angle=-t.getRotationAngle(s,a))},e.createMultipointLayer=function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},e.createPointLayer=function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},e.createPolygonLayer=function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},e.createPolylineLayer=function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},e.getContextBoundingBox=function(e,r=15){const t=e.canvas.width,i=e.canvas.height,n=e.getImageData(0,0,t,i).data;let o,a,s,l,u,y;e:for(a=i;a--;)for(o=t;o--;)if(n[4*(t*a+o)+3]>r){y=a;break e}if(!y)return null;e:for(o=t;o--;)for(a=y+1;a--;)if(n[4*(t*a+o)+3]>r){u=o;break e}e:for(o=0;o<=u;++o)for(a=y+1;a--;)if(n[4*(t*a+o)+3]>r){s=o;break e}e:for(a=0;a<=y;++a)for(o=s;o<=u;++o)if(n[4*(t*a+o)+3]>r){l=a;break e}return{x:s,y:l,width:u-s,height:y-l}},e.getVisibleLayerViews=function(e,r){const t=e.allLayerViews.items;if(r===e.scale)return t.filter((e=>!e.suspended));const i=new Array;for(const e of t)o(e.parent)&&!i.includes(e.parent)||!e.visible||r&&"isVisibleAtScale"in e&&!e.isVisibleAtScale(r)||i.push(e);return i},e.isBingMapsLayer=function(e){return e&&"bing-maps"===e.type},e.isCSVLayer=function(e){return e&&"csv"===e.type},e.isFeatureLayer=function(e){return e&&"feature"===e.type},e.isGeoJSONLayer=function(e){return e&&"geojson"===e.type},e.isGraphicsLayer=function(e){return e&&"graphics"===e.type},e.isGroupLayer=function(e){return e&&"group"===e.type},e.isImageryLayer=function(e){return e&&"imagery"===e.type},e.isKMLLayer=function(e){return e&&"kml"===e.type},e.isMapImageLayer=function(e){return e&&"map-image"===e.type},e.isMapNotesLayer=function(e){return e&&"map-notes"===e.type},e.isOpenStreetMapLayer=function(e){return e&&"open-street-map"===e.type},e.isStreamLayer=function(e){return e&&"stream"===e.type},e.isTileLayer=function(e){return e&&"tile"===e.type},e.isVectorTileLayer=function(e){return e&&"vector-tile"===e.type},e.isWMSLayer=function(e){return e&&"wms"===e.type},e.isWMTSLayer=function(e){return e&&"wmts"===e.type},e.isWebTileLayer=function(e){return e&&"web-tile"===e.type},Object.defineProperty(e,"__esModule",{value:!0})}));
