// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","@dojo/framework/shim/array","../../core/screenUtils","../../renderers/visualVariables/support/visualVariableUtils"],(function(e,r,i,t,a){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isWMTSLayer=r.isWMSLayer=r.isWebTileLayer=r.isVectorTileLayer=r.isTileLayer=r.isStreamLayer=r.isOpenStreetMapLayer=r.isMapNotesLayer=r.isMapImageLayer=r.isKMLLayer=r.isImageryLayer=r.isGroupLayer=r.isGraphicsLayer=r.isGeoJSONLayer=r.isFeatureLayer=r.isCSVLayer=r.isBingMapsLayer=r.getVisibleLayerViews=r.getContextBoundingBox=r.createPolylineLayer=r.createPointLayer=r.createPolygonLayer=r.createMultipointLayer=r.applyVisualVariables=void 0;function n(e){return e&&"esri.views.layers.GroupLayerView"===e.declaredClass}r.applyVisualVariables=function(e,r){var i=r.graphic,n=r.renderer,o=r.symbol,s=o.type;if("text"!==s&&"shield-label-symbol"!==s&&"visualVariables"in n&&n.visualVariables){var y=n.getVisualVariablesForType("size"),l=n.getVisualVariablesForType("color"),u=n.getVisualVariablesForType("opacity"),p=n.getVisualVariablesForType("rotation"),f=y&&y[0],c=l&&l[0],m=u&&u[0],g=p&&p[0];if(f){var L="simple-marker"===s?o.style:null,d=a.getSize(f,i,{shape:L});null!=d&&("simple-marker"===s?e.size=t.px2pt(d):"picture-marker"===s?(e.width=t.px2pt(d),e.height=t.px2pt(d)):"simple-line"===s?e.width=t.px2pt(d):e.outline&&(e.outline.width=t.px2pt(d)))}if(c){var V=a.getColor(c,i);(V&&"simple-marker"===s||"simple-line"===s||"simple-fill"===s)&&(e.color=V?V.toJSON():void 0)}if(m){var b=a.getOpacity(m,i);null!=b&&e.color&&(e.color[3]=Math.round(255*b))}g&&(e.angle=-a.getRotationAngle(n,i))}},r.createMultipointLayer=function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},r.createPolygonLayer=function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},r.createPointLayer=function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},r.createPolylineLayer=function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},r.getContextBoundingBox=function(e,r){void 0===r&&(r=15);var i,t,a,n,o,s,y=e.canvas.width,l=e.canvas.height,u=e.getImageData(0,0,y,l).data;e:for(t=l;t--;)for(i=y;i--;)if(u[4*(y*t+i)+3]>r){s=t;break e}if(!s)return null;e:for(i=y;i--;)for(t=s+1;t--;)if(u[4*(y*t+i)+3]>r){o=i;break e}e:for(i=0;i<=o;++i)for(t=s+1;t--;)if(u[4*(y*t+i)+3]>r){a=i;break e}e:for(t=0;t<=s;++t)for(i=a;i<=o;++i)if(u[4*(y*t+i)+3]>r){n=t;break e}return{x:a,y:n,width:o-a,height:s-n}},r.getVisibleLayerViews=function(e,r){var t,a=e.allLayerViews.items;if(r===e.scale)t=a.filter((function(e){return!e.suspended}));else{t=[];for(var o=0,s=a;o<s.length;o++){var y=s[o];n(y.parent)&&!i.includes(t,y.parent)||(!y.visible||r&&"isVisibleAtScale"in y&&!y.isVisibleAtScale(r)||t.push(y))}}return t},r.isBingMapsLayer=function(e){return e&&"bing-maps"===e.type},r.isCSVLayer=function(e){return e&&"csv"===e.type},r.isFeatureLayer=function(e){return e&&"feature"===e.type},r.isGeoJSONLayer=function(e){return e&&"geojson"===e.type},r.isGraphicsLayer=function(e){return e&&"graphics"===e.type},r.isGroupLayer=function(e){return e&&"group"===e.type},r.isImageryLayer=function(e){return e&&"imagery"===e.type},r.isKMLLayer=function(e){return e&&"kml"===e.type},r.isMapImageLayer=function(e){return e&&"map-image"===e.type},r.isMapNotesLayer=function(e){return e&&"map-notes"===e.type},r.isOpenStreetMapLayer=function(e){return e&&"open-street-map"===e.type},r.isStreamLayer=function(e){return e&&"stream"===e.type},r.isTileLayer=function(e){return e&&"tile"===e.type},r.isVectorTileLayer=function(e){return e&&"vector-tile"===e.type},r.isWebTileLayer=function(e){return e&&"web-tile"===e.type},r.isWMSLayer=function(e){return e&&"wms"===e.type},r.isWMTSLayer=function(e){return e&&"wmts"===e.type}}));