/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/object","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/Error","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../request","../Task"],(function(e,r,t,s,o,i,a,n,l,c,u,d,p,v,f,h){"use strict";const T=e=>{let s=function(e){function t(){return e.apply(this,arguments)||this}r._inheritsLoose(t,e);var s=t.prototype;return s.getServiceDescription=async function(){return this._serviceDescriptionPromise||(this._serviceDescriptionPromise=this._fetchServiceDescription()),this._serviceDescriptionPromise},s._fetchServiceDescription=async function(){if(!this.url||!this.parsedUrl)throw new u("network-service:missing-url","Url to Network service is missing");const e=this.url,{data:r}=await f(e,{query:{f:"json"}});r.supportedTravelModes||(r.supportedTravelModes=[]);for(let e=0;e<r.supportedTravelModes.length;e++)r.supportedTravelModes[e].id||(r.supportedTravelModes[e].id=r.supportedTravelModes[e].itemId);const t=r.currentVersion>=10.4?async function(e){try{const{data:{supportedTravelModes:r,defaultTravelMode:t}}=await f(e+("/"===e[e.length-1]?"":"/")+"retrieveTravelModes",{query:{f:"json"}});return{supportedTravelModes:r,defaultTravelMode:t}}catch(e){throw new u("network-service:retrieveTravelModes","Could not get to the NAServer's retrieveTravelModes.",{error:e})}}(e):async function(e){const{data:r}=await f(e.substring(0,e.indexOf("/rest/")+6)+"info",{query:{f:"json"}});if(!r||!r.owningSystemUrl)return{supportedTravelModes:[],defaultTravelMode:null};e=r.owningSystemUrl;const{data:t}=await f(e+("/"===e[e.length-1]?"":"/")+"sharing/rest/portals/self",{query:{f:"json"}}),s=o.getDeepValue("helperServices.routingUtilities.url",t);if(!s)return{supportedTravelModes:[],defaultTravelMode:null};const i=d.urlToObject(e),a=/\/solveClosestFacility$/.test(i.path)?"Route":/\/solveClosestFacility$/.test(i.path)?"ClosestFacility":"ServiceAreas",n=await f(s+("/"===s[s.length-1]?"":"/")+"GetTravelModes/execute",{query:{f:"json",serviceName:a}}),l=[];let c=null;if(n&&n.data&&n.data.results&&n.data.results.length){const e=n.data.results;for(const r of e)if("supportedTravelModes"===r.paramName){if(r.value&&r.value.features)for(const{attributes:e}of r.value.features)if(e){const r=JSON.parse(e.TravelMode);l.push(r)}}else"defaultTravelMode"===r.paramName&&(c=r.value)}return{supportedTravelModes:l,defaultTravelMode:c}}(e),{defaultTravelMode:s,supportedTravelModes:i}=await t;return r.defaultTravelMode=s,r.supportedTravelModes=i,r},s._isInputGeometryZAware=function(e,r){for(let t=0;t<r.length;t++){const s=e[r[t]];if(s&&s.length)for(const e of s)if(i.isSome(e)&&e.hasZ)return!0}return!1},s._dropZValuesOffInputGeometry=function(e,r){for(let t=0;t<r.length;t++){const s=e[r[t]];if(s&&s.length)for(const e of s)e.z=void 0}console.log("The remote Network Analysis service is powered by a network dataset which is not Z-aware.\nZ-coordinates of the input geometry are ignored.")},t}(e);return s=t.__decorate([c.subclass("esri.tasks.mixins.NAServiceDescription")],s),s};e.NAServiceDescription=function(e){function t(){return e.apply(this,arguments)||this}return r._inheritsLoose(t,e),t}(T(h)),e.NAServiceDescription=t.__decorate([c.subclass("esri.tasks.mixins.NAServiceDescription")],e.NAServiceDescription),e.NAServiceDescriptionMixin=T,Object.defineProperty(e,"__esModule",{value:!0})}));
