/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/asyncUtils","../../core/Error","../../core/maybe","../../core/promiseUtils","../../core/uuid","../../portal/support/resourceUtils"],(function(e,r,o,t,s,n,c,u){"use strict";function a(e,r,o){return p.apply(this,arguments)}function p(){return(p=r._asyncToGenerator((function*(e,r,o){if(!r||!r.resources)return;const s=r.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=r.portalItem;const a=new Set(r.resources.toKeep.map((e=>e.resource.path))),p=new Set,h=[];a.forEach((r=>{s.delete(r),e.paths.push(r)}));for(const t of r.resources.toUpdate)if(s.delete(t.resource.path),a.has(t.resource.path)||p.has(t.resource.path)){const{resource:r,content:s,finish:n,error:a}=t,p=u.getSiblingOfSameTypeI(r,c.generateUUID());e.paths.push(p.path),h.push(i({resource:p,content:s,compress:t.compress,finish:n,error:a},o))}else e.paths.push(t.resource.path),h.push(l(t,o)),p.add(t.resource.path);for(const t of r.resources.toAdd)h.push(i(t,o)),e.paths.push(t.resource.path);if(s.forEach((e=>{const o=r.portalItem.resourceFromPath(e);h.push(o.portalItem.removeResource(o).catch((()=>{})))})),0===h.length)return;const f=yield n.eachAlways(h);n.throwIfAborted(o);const m=f.filter((e=>"error"in e)).map((e=>e.error));if(m.length>0)throw new t("save:resources","Failed to save one or more resources",{errors:m})}))).apply(this,arguments)}function i(e,r){return h.apply(this,arguments)}function h(){return(h=r._asyncToGenerator((function*(e,r){const t={...s.isSome(r)?r:{},compress:e.compress},n=yield o.result(e.resource.portalItem.addResource(e.resource,e.content,t));if(!0!==n.ok)throw e.error&&e.error(n.error),n.error;e.finish&&e.finish(e.resource)}))).apply(this,arguments)}function l(e,r){return f.apply(this,arguments)}function f(){return(f=r._asyncToGenerator((function*(e,r){const t=yield o.result(e.resource.update(e.content,r));if(!0!==t.ok)throw e.error(t.error),t.error;e.finish(e.resource)}))).apply(this,arguments)}e.saveResources=a,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
