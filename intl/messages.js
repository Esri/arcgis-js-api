/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../core/Error","../core/promiseUtils","./locale"],(function(e,t,n,s){"use strict";const r=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,o=new Set(["ar","bs","ca","cs","da","de","el","en","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-BR","pt-PT","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-HK","zh-TW"]),i=[],a=new Map;function c(e){if(!i.includes(e)){for(const t of a.keys())h(e.pattern,t)&&a.delete(t);i.unshift(e)}}async function d(e){const t=s.getLocale();a.has(e)||a.set(e,l(e,t));const n=a.get(e);return await f.add(n),n}function u(e){if(!r.test(e))return null;const[,t,n]=r.exec(e),s=t+(n?"-"+n.toUpperCase():"");return o.has(s)?s:o.has(t)?t:null}async function l(e,n){const s=[];for(const t of i)if(h(t.pattern,e))try{return await t.fetchMessageBundle(e,n)}catch(r){s.push(r)}if(s.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:s});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function h(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}s.beforeLocaleChange((()=>{a.clear()}));const f=new(function(){function e(){this._numLoading=0}var t=e.prototype;return t.waitForAll=async function(){this._dfd&&await this._dfd.promise},t.add=function(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()},t._increase=function(){this._numLoading++,this._dfd||(this._dfd=n.createDeferred())},t._decrease=function(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)},e}()),_={cache:a,loaders:i};e.fetchMessageBundle=d,e.normalizeMessageBundleLocale=u,e.registerMessageBundleLoader=c,e.test=_,Object.defineProperty(e,"__esModule",{value:!0})}));
