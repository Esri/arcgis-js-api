/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Basemap","../../Ground","../../WebScene","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/extensions/serializableProperty/type","../../layers/GroupLayer","../../layers/KMLLayer","../../layers/mixins/operationalLayerModuleMap","../../layers/mixins/operationalLayers","../../layers/support/Sublayer","../../layers/support/source/DataLayerSource","../../layers/support/source/MapLayerSource","./utils"],(function(e,t,n,r,a,y,p,o,u,s,l,i,c,f,m,d){"use strict";function b(e){return h.apply(this,arguments)}function h(){return(h=t._asyncToGenerator((function*(e){return x(null,{typeName:"json",type:e},new d.ScanContext)}))).apply(this,arguments)}function g(e,t,n){return N.apply(this,arguments)}function N(){return(N=t._asyncToGenerator((function*(e,t,n){switch(t.typeName){case"array":yield S(e,t,n);break;case"union":yield L(e,t,n);break;case"json":yield x(e,t,n);break;case"native":yield T(e,t,n);break;case"enum":yield _(e,t,n)}}))).apply(this,arguments)}function T(e,t,n){return v.apply(this,arguments)}function v(){return(v=t._asyncToGenerator((function*(e,t,n){n.addProperty({name:e,type:W(t),default:t.default})}))).apply(this,arguments)}function w(e){const t=e.slice();return t.sort(),t}function _(e,t,n){return k.apply(this,arguments)}function k(){return(k=t._asyncToGenerator((function*(e,t,n){const r=t.values.slice();t.nullable&&r.push(null),n.currentClass&&n.currentClass.typeValue&&"type"===e?n.addProperty({name:e,type:"string",enum:`"${n.currentClass.typeValue}"`}):n.addProperty({name:e,type:W(t),enum:w(r).map((e=>"string"==typeof e?`"${e}"`:`${e}`)).join("|"),default:t.default})}))).apply(this,arguments)}function S(e,t,n){return j.apply(this,arguments)}function j(){return(j=t._asyncToGenerator((function*(e,t,n){yield g(`${e}[]`,t.elementType,n)}))).apply(this,arguments)}function M(e,t){if("json"===e.typeName){const t=e.type.__accessorMetadata__?.type,n=t&&te(t),r=n&&n.type,a=r||t&&t.type;if(a&&Array.isArray(a)&&1===a.length&&"string"==typeof a[0])return r?a[0]:R(t,a[0])}return t}function L(e,t,n){return P.apply(this,arguments)}function P(){return(P=t._asyncToGenerator((function*(e,t,n){const r=[];for(const a of t.types)if("native"!==a.type.typeName&&t.key){const t=`${e}<${M(a.type,a.value)}>`;yield g(t,a.type,n)}else r.push(a.type);if(r.length){const a=r.map(W);t.nullable&&a.push("null"),a.sort(),n.addProperty({type:a.join("|"),name:e,default:t.default})}}))).apply(this,arguments)}function G(e,t){return C.apply(this,arguments)}function C(){return(C=t._asyncToGenerator((function*(e,t){return e.type===a&&"layers"===t?D("web-scene/operational-layers"):e.type!==n||"baseLayers"!==t&&"baseMapLayers"!==t?e.type===n&&"elevationLayers"===t||e.type===r&&"layers"===t?D("web-scene/ground"):e.type===u&&"layers"===t?D("web-scene/operational-layers",(e=>e!==u)):e.type!==f.JoinTableDataSource||"leftTableSource"!==t&&"rightTableSource"!==t?null:q({key:"type",base:null,typeMap:{"data-layer":f.DataLayerSource,"map-layer":m.MapLayerSource}}):D("web-scene/basemap")}))).apply(this,arguments)}function O(e,t,n){return $.apply(this,arguments)}function $(){return($=t._asyncToGenerator((function*(e,t,n){const r=yield G(e,t);return r||H(n)}))).apply(this,arguments)}function A(e){return e.prototype.declaredClass.replace(/\./g,"/")}function x(e,t,n){return I.apply(this,arguments)}function I(){return(I=t._asyncToGenerator((function*(e,t,n){const r=t.type.__accessorMetadata__,a=A(t.type);if(!r)return e&&n.addProperty({name:e,type:"unknown"}),null;let y=a,p=null;const o=e&&e.match(/<([^>]+)>$/);o&&(y+=`--${o[1]}`,p=o[1]),t.type===c&&(y+=`--${n.currentClass?.name}`,p=n.currentClass?.name);const u=n.seen.get(y);if(u&&e)return n.addProperty({name:e,type:u}),u;const s={type:t.type,name:a,id:y,properties:[]};e&&(n.addProperty({name:e,type:s}),s.typeValue=p),n.push(e,s);for(const l in r){const e=r[l],a=ne(e);if(!a||!a.enabled)continue;if(t.type===c){const e="esri/layers/TileLayer"===n.stack[n.stack.length-2].klass.name;if(e&&c.test.isMapImageLayerOverridePolicy(a.overridePolicy)||!e&&c.test.isTileImageLayerOverridePolicy(a.overridePolicy))continue}const y=a.target;if("string"==typeof y||null==y){const r=yield O(t,l,e);if(!r)continue;yield g("string"==typeof y?y:l,r,n)}else yield B(t,y,n)}return n.pop()}))).apply(this,arguments)}function B(e,t,n){return J.apply(this,arguments)}function J(){return(J=t._asyncToGenerator((function*(e,t,n){for(const r in t){let a=yield G(e,r);if(!a){const e=t[r];a=e.types?q(e.types):X(e.type),a.default=e.default,a=F(a)}yield g(r,a,n)}}))).apply(this,arguments)}function D(e,t){return V.apply(this,arguments)}function V(){return(V=t._asyncToGenerator((function*(e,t){const n={typeName:"union",key:"layerType",types:[]};for(const r in i.supportedTypes[e]){if("web-scene/operational-layers"===e&&"ArcGISTiledElevationServiceLayer"===r)continue;const a=yield l.typeModuleMap[r]();a&&(t&&!t(a)||a!==s&&n.types.push({type:{typeName:"json",type:a},value:r}))}if(0===n.types.length)return null;return{typeName:"array",elementType:1===n.types.length?n.types[0].type:n}}))).apply(this,arguments)}function W(e){switch(e.typeName){case"array":return`${W(e.elementType)}[]`;case"union":{const t=e.types.map((e=>W(e.type)));return e.nullable&&t.push("null"),t.sort(),`${t.join(" | ")}`}case"native":switch(e.type){case Number:return"number";case p.Integer:return"integer";case String:return"string";case Boolean:return"boolean";case Object:return"object";default:return"unknown"}case"json":return e.type.prototype.declaredClass;case"enum":return"string"}}function z(e){const t=e.prototype.itemType&&e.prototype.itemType.Type;if(!t)return{typeName:"array",elementType:{typeName:"native",type:null}};if("function"==typeof t)return{typeName:"array",elementType:X(t)};if(t.typeMap){const e=[];for(const n in t.typeMap){const r=t.typeMap[n];e.push({type:X(r),value:ee(r)?null:n})}return{typeName:"array",elementType:{typeName:"union",key:"string"==typeof t.key?t.key:"type",types:e}}}}function E(e){if("json"!==e.typeName)return null;const t=e.type.__accessorMetadata__?.type,n=t&&te(t),r=n&&n.type,a=r||t&&t.type;return a&&Array.isArray(a)&&"string"==typeof a[0]?r||t.type.map((e=>R(t,e))):null}function F(e){if("array"===e.typeName)return e.elementType=F(e.elementType),e;const t=E(e);return t?{typeName:"union",key:"type",nullable:e.nullable,types:t.map((t=>({value:t,type:e})))}:e}function H(e){const t=te(e);return t?.types?q(t.types):!t?.type&&e.types?q(e.types):K(F(U(e)))}function K(e){return e.nullable&&"native"===e.typeName?{typeName:"union",key:null,types:[{value:null,type:e}],nullable:!0}:e}function q(e){if(Array.isArray(e))return{typeName:"array",elementType:q(e[0])};const t=[];for(const n in e.typeMap){const r=e.typeMap[n];t.push({type:X(r),value:ee(r)?null:n})}return{typeName:"union",key:"string"==typeof e.key?e.key:"type",types:t}}function Q(e){return null!=e&&e.isJSONMapWriter}function R(e,t){const n=ne(e);if(n&&Q(n.writer)){const e={value:""};return n.writer?.(t,e,"value"),e.value}return t}function U(e){const t=te(e),n=ne(e),r=X(t&&t.type||e.type);return t&&void 0!==t.default&&"function"!=typeof t.default&&(r.default=R(e,t.default)),n?.allowNull&&(r.nullable=!0),r}function X(e){return e?p.isLongFormType(e)?Y(e):Array.isArray(e)?"string"==typeof e[0]||"number"==typeof e[0]?{typeName:"enum",values:e}:e.length>1?{typeName:"union",key:null,types:e.map((e=>({type:X(e),value:null})))}:{typeName:"array",elementType:X(e[0])}:o.isCollection(e)?z(e):ee(e)?{typeName:"native",type:e}:Z(e)?{typeName:"json",type:e}:{typeName:"native",type:null}:{typeName:"native",type:null}}function Y(e){switch(e.type){case"native":return{typeName:"native",type:e.value};case"array":return{typeName:"array",elementType:X(e.value)};case"one-of":return{typeName:"union",key:null,types:e.values.map((e=>({type:Y(e),value:null})))}}}function Z(e){let t=e;for(;t;){if(t.prototype&&("esri.core.JSONSupport"===t.prototype.declaredClass||"esri.core.MultiOriginJSONSupport"===t.prototype.declaredClass))return!0;t=Object.getPrototypeOf(t)}return!1}function ee(e){return e===String||e===Boolean||e===Number||e===p.Integer||e===Object}function te(e){if(!e.json)return null;const t=e.json.origins,n=e.json,r=t&&t["web-scene"],a=t&&t["web-document"];return r||a||n||null}function ne(e){if(!e.json)return null;const t=e.json.origins,n=e.json.write,r=t&&t["web-scene"]&&t["web-scene"].write,a=t&&t["web-document"]&&t["web-document"].write;return r||a||n||null}e.scan=b,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
