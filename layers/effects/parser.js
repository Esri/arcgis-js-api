/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../colorUtils","../../core/Error","./effects","../../chunks/_commonjsHelpers"],(function(t,e,r,n,u){"use strict";var a,c,o={exports:{}};function i(t){let e;try{e=t?o.exports.parse(t):[]}catch(u){return{input:t,parsedFunctions:[],effects:[],error:new r("effect:invalid-syntax","Invalid effect syntax",{input:t,error:u})}}const n={input:t,parsedFunctions:e,effects:[],error:null};try{for(const t of e)n.effects.push(s(t))}catch(u){n.effects.length=0,n.error=u}return n}function s(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return f(t);case"opacity":return l(t);case"hue-rotate":return p(t);case"blur":return h(t);case"drop-shadow":return m(t);case"bloom":return g(t)}}catch(e){throw e.details.filter=t,e}throw new r("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function f(t){let e=1;return d(t.parameters,1),1===t.parameters.length&&(e=F(t.parameters[0])),new n.ColorMatrixEffect(t.name,e)}function l(t){let e=1;return d(t.parameters,1),1===t.parameters.length&&(e=F(t.parameters[0])),new n.OpacityEffect(e)}function p(t){let e=0;return d(t.parameters,1),1===t.parameters.length&&(e=j(t.parameters[0])),new n.HueRotateEffect(e)}function h(t){let e=0;return d(t.parameters,1),1===t.parameters.length&&(e=k(t.parameters[0]),y(e,t.parameters[0])),new n.BlurEffect(e)}function m(t){const e=[];let u;for(const n of t.parameters)if("color"===n.type){if(e.length&&Object.freeze(e),u)throw new r("effect:type-error","Accepts only one color",{});u=S(n)}else{const t=k(n);if(Object.isFrozen(e))throw new r("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(t),3===e.length&&y(t,n)}if(e.length<2||e.length>3)throw new r("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new n.DropShadowEffect(e[0],e[1],e[2]||0,u||q("black"))}function g(t){let e=1,r=0,u=0;return d(t.parameters,3),t.parameters[0]&&(e=F(t.parameters[0])),t.parameters[1]&&(r=k(t.parameters[1]),y(r,t.parameters[1])),t.parameters[2]&&(u=F(t.parameters[2])),new n.BloomEffect(e,r,u)}function d(t,e){if(t.length>e)throw new r("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function v(t){return"color"===t.type?"<color>":E[t.unit]?"<length>":x[t.unit]?"<angle>":"%"===t.unit?"<percentage>":"<double>"}function y(t,e){if(t<0)throw new r("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function A(t){if("quantity"!==t.type||null!==t.unit)throw new r("effect:type-error",`Expected <double>, Actual: ${v(t)}`,{term:t})}function w(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new r("effect:type-error",`Expected <double> or <percentage>, Actual: ${v(t)}`,{term:t})}a=o,u.commonjsGlobal,c=function(){function t(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function e(t,r,n,u){this.message=t,this.expected=r,this.found=n,this.location=u,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}function r(t,r){r=void 0!==r?r:{};var n,u={},a={start:Kt},c=Kt,o=Pt("none"),i="none",s=Bt("none",!1),f=function(){return[]},l=")",p=Bt(")",!1),h=function(t,e){return{type:"function",name:t,parameters:e||[]}},m=",",g=Bt(",",!1),d=function(t,e){return e.length>0?ie(t,e,3):[t]},v=function(t){return{type:"quantity",value:t.value,unit:t.unit}},y=function(t){return{type:"color",colorType:t.type,value:t.value}},A=Pt("whitespace"),w=/^[ \t\n\r]/,x=Ht([" ","\t","\n","\r"],!1,!1),b=Pt("function"),E="(",C=Bt("(",!1),F=function(t){return t},$=Pt("identifier"),j=/^[a-z\-]/,k=Ht([["a","z"],"-"],!1,!1),S=function(){return _t()},q=Pt("percentage"),M="%",R=Bt("%",!1),z=function(t){return{value:t,unit:"%"}},O=Pt("length"),T="px",I=Bt("px",!1),_=function(t){return{value:t,unit:"px"}},B="cm",H=Bt("cm",!1),N=function(t){return{value:t,unit:"cm"}},P="mm",U=Bt("mm",!1),D=function(t){return{value:t,unit:"mm"}},G="in",J=Bt("in",!1),K=function(t){return{value:t,unit:"in"}},L="pt",Q=Bt("pt",!1),V=function(t){return{value:t,unit:"pt"}},W="pc",X=Bt("pc",!1),Y=function(t){return{value:t,unit:"pc"}},Z=Pt("angle"),tt="deg",et=Bt("deg",!1),rt=function(t){return{value:t,unit:"deg"}},nt="rad",ut=Bt("rad",!1),at=function(t){return{value:t,unit:"rad"}},ct="grad",ot=Bt("grad",!1),it=function(t){return{value:t,unit:"grad"}},st="turn",ft=Bt("turn",!1),lt=function(t){return{value:t,unit:"turn"}},pt=Pt("number"),ht=function(t){return{value:t,unit:null}},mt=Pt("color"),gt="#",dt=Bt("#",!1),vt=/^[0-9a-fA-F]/,yt=Ht([["0","9"],["a","f"],["A","F"]],!1,!1),At=function(){return{type:"hex",value:_t()}},wt=function(t){return{type:"function",value:t}},xt=function(){return{type:"named",value:_t()}},bt=/^[+\-]/,Et=Ht(["+","-"],!1,!1),Ct=/^[0-9]/,Ft=Ht([["0","9"]],!1,!1),$t=".",jt=Bt(".",!1),kt="e",St=Bt("e",!1),qt=function(){return parseFloat(_t())},Mt=0,Rt=0,zt=[{line:1,column:1}],Ot=0,Tt=[],It=0;if("startRule"in r){if(!(r.startRule in a))throw new Error("Can't start parsing from rule \""+r.startRule+'".');c=a[r.startRule]}function _t(){return t.substring(Rt,Mt)}function Bt(t,e){return{type:"literal",text:t,ignoreCase:e}}function Ht(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Nt(){return{type:"end"}}function Pt(t){return{type:"other",description:t}}function Ut(e){var r,n=zt[e];if(n)return n;for(r=e-1;!zt[r];)r--;for(n={line:(n=zt[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return zt[e]=n,n}function Dt(t,e){var r=Ut(t),n=Ut(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Gt(t){Mt<Ot||(Mt>Ot&&(Ot=Mt,Tt=[]),Tt.push(t))}function Jt(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}function Kt(){var t;return(t=Lt())===u&&(t=Qt()),t}function Lt(){var e,r;return It++,e=Mt,Yt()!==u?(t.substr(Mt,4)===i?(r=i,Mt+=4):(r=u,0===It&&Gt(s)),r!==u&&Yt()!==u?(Rt=e,e=f()):(Mt=e,e=u)):(Mt=e,e=u),It--,e===u&&0===It&&Gt(o),e}function Qt(){var t,e;if(t=[],(e=Vt())!==u)for(;e!==u;)t.push(e),e=Vt();else t=u;return t}function Vt(){var e,r,n,a;return e=Mt,Yt()!==u&&(r=Zt())!==u&&Yt()!==u?((n=Wt())===u&&(n=null),n!==u&&Yt()!==u?(41===t.charCodeAt(Mt)?(a=l,Mt++):(a=u,0===It&&Gt(p)),a!==u&&Yt()!==u?(Rt=e,e=h(r,n)):(Mt=e,e=u)):(Mt=e,e=u)):(Mt=e,e=u),e}function Wt(){var e,r,n,a,c,o,i,s;if(e=Mt,(r=Xt())!==u){for(n=[],a=Mt,(c=Yt())!==u?(44===t.charCodeAt(Mt)?(o=m,Mt++):(o=u,0===It&&Gt(g)),o===u&&(o=null),o!==u&&(i=Yt())!==u&&(s=Xt())!==u?a=c=[c,o,i,s]:(Mt=a,a=u)):(Mt=a,a=u);a!==u;)n.push(a),a=Mt,(c=Yt())!==u?(44===t.charCodeAt(Mt)?(o=m,Mt++):(o=u,0===It&&Gt(g)),o===u&&(o=null),o!==u&&(i=Yt())!==u&&(s=Xt())!==u?a=c=[c,o,i,s]:(Mt=a,a=u)):(Mt=a,a=u);n!==u?(Rt=e,e=r=d(r,n)):(Mt=e,e=u)}else Mt=e,e=u;return e}function Xt(){var t,e;return t=Mt,(e=ee())===u&&(e=re())===u&&(e=ne())===u&&(e=ue()),e!==u&&(Rt=t,e=v(e)),(t=e)===u&&(t=Mt,(e=ae())!==u&&(Rt=t,e=y(e)),t=e),t}function Yt(){var e,r;for(It++,e=[],w.test(t.charAt(Mt))?(r=t.charAt(Mt),Mt++):(r=u,0===It&&Gt(x));r!==u;)e.push(r),w.test(t.charAt(Mt))?(r=t.charAt(Mt),Mt++):(r=u,0===It&&Gt(x));return It--,e===u&&(r=u,0===It&&Gt(A)),e}function Zt(){var e,r,n;return It++,e=Mt,(r=te())!==u?(40===t.charCodeAt(Mt)?(n=E,Mt++):(n=u,0===It&&Gt(C)),n!==u?(Rt=e,e=r=F(r)):(Mt=e,e=u)):(Mt=e,e=u),It--,e===u&&(r=u,0===It&&Gt(b)),e}function te(){var e,r,n;if(It++,e=Mt,r=[],j.test(t.charAt(Mt))?(n=t.charAt(Mt),Mt++):(n=u,0===It&&Gt(k)),n!==u)for(;n!==u;)r.push(n),j.test(t.charAt(Mt))?(n=t.charAt(Mt),Mt++):(n=u,0===It&&Gt(k));else r=u;return r!==u&&(Rt=e,r=S()),It--,(e=r)===u&&(r=u,0===It&&Gt($)),e}function ee(){var e,r,n;return It++,e=Mt,Yt()!==u&&(r=ce())!==u?(37===t.charCodeAt(Mt)?(n=M,Mt++):(n=u,0===It&&Gt(R)),n!==u?(Rt=e,e=z(r)):(Mt=e,e=u)):(Mt=e,e=u),It--,e===u&&0===It&&Gt(q),e}function re(){var e,r,n;return It++,e=Mt,Yt()!==u&&(r=ce())!==u?(t.substr(Mt,2)===T?(n=T,Mt+=2):(n=u,0===It&&Gt(I)),n!==u?(Rt=e,e=_(r)):(Mt=e,e=u)):(Mt=e,e=u),e===u&&(e=Mt,Yt()!==u&&(r=ce())!==u?(t.substr(Mt,2)===B?(n=B,Mt+=2):(n=u,0===It&&Gt(H)),n!==u?(Rt=e,e=N(r)):(Mt=e,e=u)):(Mt=e,e=u),e===u&&(e=Mt,Yt()!==u&&(r=ce())!==u?(t.substr(Mt,2)===P?(n=P,Mt+=2):(n=u,0===It&&Gt(U)),n!==u?(Rt=e,e=D(r)):(Mt=e,e=u)):(Mt=e,e=u),e===u&&(e=Mt,Yt()!==u&&(r=ce())!==u?(t.substr(Mt,2)===G?(n=G,Mt+=2):(n=u,0===It&&Gt(J)),n!==u?(Rt=e,e=K(r)):(Mt=e,e=u)):(Mt=e,e=u),e===u&&(e=Mt,Yt()!==u&&(r=ce())!==u?(t.substr(Mt,2)===L?(n=L,Mt+=2):(n=u,0===It&&Gt(Q)),n!==u?(Rt=e,e=V(r)):(Mt=e,e=u)):(Mt=e,e=u),e===u&&(e=Mt,Yt()!==u&&(r=ce())!==u?(t.substr(Mt,2)===W?(n=W,Mt+=2):(n=u,0===It&&Gt(X)),n!==u?(Rt=e,e=Y(r)):(Mt=e,e=u)):(Mt=e,e=u)))))),It--,e===u&&0===It&&Gt(O),e}function ne(){var e,r,n;return It++,e=Mt,(r=ce())!==u?(t.substr(Mt,3)===tt?(n=tt,Mt+=3):(n=u,0===It&&Gt(et)),n!==u?(Rt=e,e=r=rt(r)):(Mt=e,e=u)):(Mt=e,e=u),e===u&&(e=Mt,(r=ce())!==u?(t.substr(Mt,3)===nt?(n=nt,Mt+=3):(n=u,0===It&&Gt(ut)),n!==u?(Rt=e,e=r=at(r)):(Mt=e,e=u)):(Mt=e,e=u),e===u&&(e=Mt,(r=ce())!==u?(t.substr(Mt,4)===ct?(n=ct,Mt+=4):(n=u,0===It&&Gt(ot)),n!==u?(Rt=e,e=r=it(r)):(Mt=e,e=u)):(Mt=e,e=u),e===u&&(e=Mt,(r=ce())!==u?(t.substr(Mt,4)===st?(n=st,Mt+=4):(n=u,0===It&&Gt(ft)),n!==u?(Rt=e,e=r=lt(r)):(Mt=e,e=u)):(Mt=e,e=u)))),It--,e===u&&(r=u,0===It&&Gt(Z)),e}function ue(){var t,e;return It++,t=Mt,Yt()!==u&&(e=ce())!==u?(Rt=t,t=ht(e)):(Mt=t,t=u),It--,t===u&&0===It&&Gt(pt),t}function ae(){var e,r,n,a;if(It++,e=Mt,35===t.charCodeAt(Mt)?(r=gt,Mt++):(r=u,0===It&&Gt(dt)),r!==u){if(n=[],vt.test(t.charAt(Mt))?(a=t.charAt(Mt),Mt++):(a=u,0===It&&Gt(yt)),a!==u)for(;a!==u;)n.push(a),vt.test(t.charAt(Mt))?(a=t.charAt(Mt),Mt++):(a=u,0===It&&Gt(yt));else n=u;n!==u?(Rt=e,e=r=At()):(Mt=e,e=u)}else Mt=e,e=u;return e===u&&(e=Mt,(r=Vt())!==u&&(Rt=e,r=wt(r)),(e=r)===u&&(e=Mt,(r=te())!==u&&(Rt=e,r=xt()),e=r)),It--,e===u&&(r=u,0===It&&Gt(mt)),e}function ce(){var e,r,n,a,c,o,i,s;if(e=Mt,bt.test(t.charAt(Mt))?(r=t.charAt(Mt),Mt++):(r=u,0===It&&Gt(Et)),r===u&&(r=null),r!==u){for(n=Mt,a=[],Ct.test(t.charAt(Mt))?(c=t.charAt(Mt),Mt++):(c=u,0===It&&Gt(Ft));c!==u;)a.push(c),Ct.test(t.charAt(Mt))?(c=t.charAt(Mt),Mt++):(c=u,0===It&&Gt(Ft));if(a!==u)if(46===t.charCodeAt(Mt)?(c=$t,Mt++):(c=u,0===It&&Gt(jt)),c!==u){if(o=[],Ct.test(t.charAt(Mt))?(i=t.charAt(Mt),Mt++):(i=u,0===It&&Gt(Ft)),i!==u)for(;i!==u;)o.push(i),Ct.test(t.charAt(Mt))?(i=t.charAt(Mt),Mt++):(i=u,0===It&&Gt(Ft));else o=u;o!==u?n=a=[a,c,o]:(Mt=n,n=u)}else Mt=n,n=u;else Mt=n,n=u;if(n===u)if(n=[],Ct.test(t.charAt(Mt))?(a=t.charAt(Mt),Mt++):(a=u,0===It&&Gt(Ft)),a!==u)for(;a!==u;)n.push(a),Ct.test(t.charAt(Mt))?(a=t.charAt(Mt),Mt++):(a=u,0===It&&Gt(Ft));else n=u;if(n!==u){if(a=Mt,101===t.charCodeAt(Mt)?(c=kt,Mt++):(c=u,0===It&&Gt(St)),c!==u)if(bt.test(t.charAt(Mt))?(o=t.charAt(Mt),Mt++):(o=u,0===It&&Gt(Et)),o===u&&(o=null),o!==u){if(i=[],Ct.test(t.charAt(Mt))?(s=t.charAt(Mt),Mt++):(s=u,0===It&&Gt(Ft)),s!==u)for(;s!==u;)i.push(s),Ct.test(t.charAt(Mt))?(s=t.charAt(Mt),Mt++):(s=u,0===It&&Gt(Ft));else i=u;i!==u?a=c=[c,o,i]:(Mt=a,a=u)}else Mt=a,a=u;else Mt=a,a=u;a===u&&(a=null),a!==u?(Rt=e,e=r=qt()):(Mt=e,e=u)}else Mt=e,e=u}else Mt=e,e=u;return e}function oe(t,e){return t.map((function(t){return t[e]}))}function ie(t,e,r){return[t].concat(oe(e,r))}if((n=c())!==u&&Mt===t.length)return n;throw n!==u&&Mt<t.length&&Gt(Nt()),Jt(Tt,Ot<t.length?t.charAt(Ot):null,Ot<t.length?Dt(Ot,Ot+1):Dt(Ot,Ot))}return t(e,Error),e.buildMessage=function(t,e){var r={literal:function(t){return'"'+u(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?a(t.parts[e][0])+"-"+a(t.parts[e][1]):a(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function u(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function c(t){return r[t.type](t)}function o(t){var e,r,n=new Array(t.length);for(e=0;e<t.length;e++)n[e]=c(t[e]);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}function i(t){return t?'"'+u(t)+'"':"end of input"}return"Expected "+o(t)+" but "+i(e)+" found."},{SyntaxError:e,parse:r}},a.exports&&(a.exports=c());const x={deg:1,grad:.9,rad:180/Math.PI,turn:360};function b(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==x[t.unit])throw new r("effect:type-error",`Expected <angle>, Actual: ${v(t)}`,{term:t})}const E={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function C(t){if("quantity"!==t.type||(0!==t.value||null!==t.unit)&&null==E[t.unit])throw new r("effect:type-error",`Expected <length>, Actual: ${v(t)}`,{term:t})}function F(t){w(t);const e=t.value;return y(e,t),"%"===t.unit?.01*e:e}function $(t){return A(t),y(t.value,t),t.value}function j(t){return b(t),t.value*x[t.unit]||0}function k(t){return C(t),t.value*E[t.unit]||0}function S(t){switch(t.colorType){case"hex":return e.hex2rgba(t.value);case"named":return q(t.value);case"function":return z(t.value)}}function q(t){const n=e.getNamedColorCopy(t);if(!n)throw new r("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return n}const M=/^rgba?/i,R=/^hsla?/i;function z(t){if(d(t.parameters,4),M.test(t.name))return[F(t.parameters[0]),F(t.parameters[1]),F(t.parameters[2]),t.parameters[3]?F(t.parameters[3]):1];if(R.test(t.name))return e.hsla2rgba($(t.parameters[0]),F(t.parameters[1]),F(t.parameters[2]),t.parameters[3]?F(t.parameters[3]):1);throw new r("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}t.parse=i,Object.defineProperty(t,"__esModule",{value:!0})}));
