/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../colorUtils","../../core/Error","./effects","../../chunks/_commonjsHelpers","./utils"],(function(e,t,r,n,u,a){"use strict";var c,o,i={exports:{}};function l(e){if(!e||0===e.length)return null;if("string"==typeof e){const t=f(e);return t&&0!==t.length?t:null}const t=e.map((e=>{if(!Number.isFinite(e.scale)||e.scale<=0)throw new r("effect:invalid-scale","scale must be finite and greater than 0",{stop:e});return{scale:e.scale,effects:f(e.value)}}));t.sort(((e,t)=>t.effects.length-e.effects.length));for(let n=0;n<t.length-1;n++){if(!a.canInterpolateEffects(t[n].effects,t[n+1].effects))throw new r("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[n].effects,b:t[n+1].effects});a.normalizeEffects(t[n].effects,t[n+1].effects)}return t.sort(((e,t)=>t.scale-e.scale)),t}function f(e){let t;if(!e)return[];try{t=i.exports.parse(e)}catch(n){throw new r("effect:invalid-syntax","Invalid effect syntax",{value:e,error:n})}return t.map((e=>s(e)))}function s(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return p(e);case"opacity":return h(e);case"hue-rotate":return m(e);case"blur":return g(e);case"drop-shadow":return v(e);case"bloom":return d(e)}}catch(t){throw t.details.filter=e,t}throw new r("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function p(e){let t=1;return y(e.parameters,1),1===e.parameters.length&&(t=j(e.parameters[0])),new n.ColorMatrixEffect(e.name,t)}function h(e){let t=1;return y(e.parameters,1),1===e.parameters.length&&(t=j(e.parameters[0])),new n.OpacityEffect(t)}function m(e){let t=0;return y(e.parameters,1),1===e.parameters.length&&(t=S(e.parameters[0])),new n.HueRotateEffect(t)}function g(e){let t=0;return y(e.parameters,1),1===e.parameters.length&&(t=M(e.parameters[0]),w(t,e.parameters[0])),new n.BlurEffect(t)}function v(e){const t=[];let u=null;for(const n of e.parameters)if("color"===n.type){if(t.length&&Object.freeze(t),u)throw new r("effect:type-error","Accepts only one color",{});u=k(n)}else{const e=M(n);if(Object.isFrozen(t))throw new r("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(e),3===t.length&&w(e,n)}if(t.length<2||t.length>3)throw new r("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new n.DropShadowEffect(t[0],t[1],t[2]||0,u||q("black"))}function d(e){let t=1,r=0,u=0;return y(e.parameters,3),e.parameters[0]&&(t=j(e.parameters[0])),e.parameters[1]&&(r=M(e.parameters[1]),w(r,e.parameters[1])),e.parameters[2]&&(u=j(e.parameters[2])),new n.BloomEffect(t,r,u)}function y(e,t){if(e.length>t)throw new r("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function A(e){if("color"===e.type)return"<color>";if(e.unit){if(F[e.unit])return"<length>";if(E[e.unit])return"<angle>";if("%"===e.unit)return"<percentage>"}return"<double>"}function w(e,t){if(e<0)throw new r("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function x(e){if("quantity"!==e.type||null!==e.unit)throw new r("effect:type-error",`Expected <double>, Actual: ${A(e)}`,{term:e})}function b(e){if("quantity"!==e.type||null!==e.unit&&"%"!==e.unit)throw new r("effect:type-error",`Expected <double> or <percentage>, Actual: ${A(e)}`,{term:e})}c=i,u.commonjsGlobal,o=function(){function e(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function t(e,r,n,u){var a=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(a,t.prototype),a.expected=r,a.found=n,a.location=u,a.name="SyntaxError",a}function r(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function n(e,r){var n,u={},a=(r=void 0!==r?r:{}).grammarSource,c={start:Le},o=Le,i="none",l=")",f=",",s="(",p="%",h="px",m="cm",g="mm",v="in",d="pt",y="pc",A="deg",w="rad",x="grad",b="turn",E="#",C=".",F="e",$=/^[ \t\n\r]/,j=/^[a-z\-]/,O=/^[0-9a-fA-F]/,S=/^[+\-]/,M=/^[0-9]/,k=Ue("none"),q=_e("none",!1),z=_e(")",!1),R=_e(",",!1),I=Ue("whitespace"),N=Be([" ","\t","\n","\r"],!1,!1),P=Ue("function"),T=_e("(",!1),_=Ue("identifier"),B=Be([["a","z"],"-"],!1,!1),H=Ue("percentage"),U=_e("%",!1),D=Ue("length"),G=_e("px",!1),J=_e("cm",!1),K=_e("mm",!1),L=_e("in",!1),Q=_e("pt",!1),V=_e("pc",!1),W=Ue("angle"),X=_e("deg",!1),Y=_e("rad",!1),Z=_e("grad",!1),ee=_e("turn",!1),te=Ue("number"),re=Ue("color"),ne=_e("#",!1),ue=Be([["0","9"],["a","f"],["A","F"]],!1,!1),ae=Be(["+","-"],!1,!1),ce=Be([["0","9"]],!1,!1),oe=_e(".",!1),ie=_e("e",!1),le=function(){return[]},fe=function(e,t){return{type:"function",name:e,parameters:t||[]}},se=function(e,t){return t.length>0?lt(e,t,3):[e]},pe=function(e){return{type:"quantity",value:e.value,unit:e.unit}},he=function(e){return{type:"color",colorType:e.type,value:e.value}},me=function(e){return e},ge=function(){return Te()},ve=function(e){return{value:e,unit:"%"}},de=function(e){return{value:e,unit:"px"}},ye=function(e){return{value:e,unit:"cm"}},Ae=function(e){return{value:e,unit:"mm"}},we=function(e){return{value:e,unit:"in"}},xe=function(e){return{value:e,unit:"pt"}},be=function(e){return{value:e,unit:"pc"}},Ee=function(e){return{value:e,unit:"deg"}},Ce=function(e){return{value:e,unit:"rad"}},Fe=function(e){return{value:e,unit:"grad"}},$e=function(e){return{value:e,unit:"turn"}},je=function(e){return{value:e,unit:null}},Oe=function(){return{type:"hex",value:Te()}},Se=function(e){return{type:"function",value:e}},Me=function(){return{type:"named",value:Te()}},ke=function(){return parseFloat(Te())},qe=0,ze=0,Re=[{line:1,column:1}],Ie=0,Ne=[],Pe=0;if("startRule"in r){if(!(r.startRule in c))throw new Error("Can't start parsing from rule \""+r.startRule+'".');o=c[r.startRule]}function Te(){return e.substring(ze,qe)}function _e(e,t){return{type:"literal",text:e,ignoreCase:t}}function Be(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function He(){return{type:"end"}}function Ue(e){return{type:"other",description:e}}function De(t){var r,n=Re[t];if(n)return n;for(r=t-1;!Re[r];)r--;for(n={line:(n=Re[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Re[t]=n,n}function Ge(e,t){var r=De(e),n=De(t);return{source:a,start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Je(e){qe<Ie||(qe>Ie&&(Ie=qe,Ne=[]),Ne.push(e))}function Ke(e,r,n){return new t(t.buildMessage(e,r),e,r,n)}function Le(){var e;return(e=Qe())===u&&(e=Ve()),e}function Qe(){var t,r;return Pe++,t=qe,Ze(),e.substr(qe,4)===i?(r=i,qe+=4):(r=u,0===Pe&&Je(q)),r!==u?(Ze(),ze=t,t=le()):(qe=t,t=u),Pe--,t===u&&0===Pe&&Je(k),t}function Ve(){var e,t;if(e=[],(t=We())!==u)for(;t!==u;)e.push(t),t=We();else e=u;return e}function We(){var t,r,n,a;return t=qe,Ze(),(r=et())!==u?(Ze(),(n=Xe())===u&&(n=null),Ze(),41===e.charCodeAt(qe)?(a=l,qe++):(a=u,0===Pe&&Je(z)),a!==u?(Ze(),ze=t,t=fe(r,n)):(qe=t,t=u)):(qe=t,t=u),t}function Xe(){var t,r,n,a,c,o,i,l;if(t=qe,(r=Ye())!==u){for(n=[],a=qe,c=Ze(),44===e.charCodeAt(qe)?(o=f,qe++):(o=u,0===Pe&&Je(R)),o===u&&(o=null),i=Ze(),(l=Ye())!==u?a=c=[c,o,i,l]:(qe=a,a=u);a!==u;)n.push(a),a=qe,c=Ze(),44===e.charCodeAt(qe)?(o=f,qe++):(o=u,0===Pe&&Je(R)),o===u&&(o=null),i=Ze(),(l=Ye())!==u?a=c=[c,o,i,l]:(qe=a,a=u);ze=t,t=se(r,n)}else qe=t,t=u;return t}function Ye(){var e,t;return e=qe,(t=rt())===u&&(t=nt())===u&&(t=ut())===u&&(t=at()),t!==u&&(ze=e,t=pe(t)),(e=t)===u&&(e=qe,(t=ct())!==u&&(ze=e,t=he(t)),e=t),e}function Ze(){var t,r;for(Pe++,t=[],$.test(e.charAt(qe))?(r=e.charAt(qe),qe++):(r=u,0===Pe&&Je(N));r!==u;)t.push(r),$.test(e.charAt(qe))?(r=e.charAt(qe),qe++):(r=u,0===Pe&&Je(N));return Pe--,r=u,0===Pe&&Je(I),t}function et(){var t,r,n;return Pe++,t=qe,(r=tt())!==u?(40===e.charCodeAt(qe)?(n=s,qe++):(n=u,0===Pe&&Je(T)),n!==u?(ze=t,t=me(r)):(qe=t,t=u)):(qe=t,t=u),Pe--,t===u&&(r=u,0===Pe&&Je(P)),t}function tt(){var t,r,n;if(Pe++,t=qe,r=[],j.test(e.charAt(qe))?(n=e.charAt(qe),qe++):(n=u,0===Pe&&Je(B)),n!==u)for(;n!==u;)r.push(n),j.test(e.charAt(qe))?(n=e.charAt(qe),qe++):(n=u,0===Pe&&Je(B));else r=u;return r!==u&&(ze=t,r=ge()),Pe--,(t=r)===u&&(r=u,0===Pe&&Je(_)),t}function rt(){var t,r,n;return Pe++,t=qe,Ze(),(r=ot())!==u?(37===e.charCodeAt(qe)?(n=p,qe++):(n=u,0===Pe&&Je(U)),n!==u?(ze=t,t=ve(r)):(qe=t,t=u)):(qe=t,t=u),Pe--,t===u&&0===Pe&&Je(H),t}function nt(){var t,r,n;return Pe++,t=qe,Ze(),(r=ot())!==u?(e.substr(qe,2)===h?(n=h,qe+=2):(n=u,0===Pe&&Je(G)),n!==u?(ze=t,t=de(r)):(qe=t,t=u)):(qe=t,t=u),t===u&&(t=qe,Ze(),(r=ot())!==u?(e.substr(qe,2)===m?(n=m,qe+=2):(n=u,0===Pe&&Je(J)),n!==u?(ze=t,t=ye(r)):(qe=t,t=u)):(qe=t,t=u),t===u&&(t=qe,Ze(),(r=ot())!==u?(e.substr(qe,2)===g?(n=g,qe+=2):(n=u,0===Pe&&Je(K)),n!==u?(ze=t,t=Ae(r)):(qe=t,t=u)):(qe=t,t=u),t===u&&(t=qe,Ze(),(r=ot())!==u?(e.substr(qe,2)===v?(n=v,qe+=2):(n=u,0===Pe&&Je(L)),n!==u?(ze=t,t=we(r)):(qe=t,t=u)):(qe=t,t=u),t===u&&(t=qe,Ze(),(r=ot())!==u?(e.substr(qe,2)===d?(n=d,qe+=2):(n=u,0===Pe&&Je(Q)),n!==u?(ze=t,t=xe(r)):(qe=t,t=u)):(qe=t,t=u),t===u&&(t=qe,Ze(),(r=ot())!==u?(e.substr(qe,2)===y?(n=y,qe+=2):(n=u,0===Pe&&Je(V)),n!==u?(ze=t,t=be(r)):(qe=t,t=u)):(qe=t,t=u)))))),Pe--,t===u&&0===Pe&&Je(D),t}function ut(){var t,r,n;return Pe++,t=qe,(r=ot())!==u?(e.substr(qe,3)===A?(n=A,qe+=3):(n=u,0===Pe&&Je(X)),n!==u?(ze=t,t=Ee(r)):(qe=t,t=u)):(qe=t,t=u),t===u&&(t=qe,(r=ot())!==u?(e.substr(qe,3)===w?(n=w,qe+=3):(n=u,0===Pe&&Je(Y)),n!==u?(ze=t,t=Ce(r)):(qe=t,t=u)):(qe=t,t=u),t===u&&(t=qe,(r=ot())!==u?(e.substr(qe,4)===x?(n=x,qe+=4):(n=u,0===Pe&&Je(Z)),n!==u?(ze=t,t=Fe(r)):(qe=t,t=u)):(qe=t,t=u),t===u&&(t=qe,(r=ot())!==u?(e.substr(qe,4)===b?(n=b,qe+=4):(n=u,0===Pe&&Je(ee)),n!==u?(ze=t,t=$e(r)):(qe=t,t=u)):(qe=t,t=u)))),Pe--,t===u&&(r=u,0===Pe&&Je(W)),t}function at(){var e,t;return Pe++,e=qe,Ze(),(t=ot())!==u?(ze=e,e=je(t)):(qe=e,e=u),Pe--,e===u&&0===Pe&&Je(te),e}function ct(){var t,r,n,a;if(Pe++,t=qe,35===e.charCodeAt(qe)?(r=E,qe++):(r=u,0===Pe&&Je(ne)),r!==u){if(n=[],O.test(e.charAt(qe))?(a=e.charAt(qe),qe++):(a=u,0===Pe&&Je(ue)),a!==u)for(;a!==u;)n.push(a),O.test(e.charAt(qe))?(a=e.charAt(qe),qe++):(a=u,0===Pe&&Je(ue));else n=u;n!==u?(ze=t,t=Oe()):(qe=t,t=u)}else qe=t,t=u;return t===u&&(t=qe,(r=We())!==u&&(ze=t,r=Se(r)),(t=r)===u&&(t=qe,(r=tt())!==u&&(ze=t,r=Me()),t=r)),Pe--,t===u&&(r=u,0===Pe&&Je(re)),t}function ot(){var t,r,n,a,c,o,i;for(t=qe,S.test(e.charAt(qe))?(e.charAt(qe),qe++):0===Pe&&Je(ae),r=qe,n=[],M.test(e.charAt(qe))?(a=e.charAt(qe),qe++):(a=u,0===Pe&&Je(ce));a!==u;)n.push(a),M.test(e.charAt(qe))?(a=e.charAt(qe),qe++):(a=u,0===Pe&&Je(ce));if(46===e.charCodeAt(qe)?(a=C,qe++):(a=u,0===Pe&&Je(oe)),a!==u){if(c=[],M.test(e.charAt(qe))?(o=e.charAt(qe),qe++):(o=u,0===Pe&&Je(ce)),o!==u)for(;o!==u;)c.push(o),M.test(e.charAt(qe))?(o=e.charAt(qe),qe++):(o=u,0===Pe&&Je(ce));else c=u;c!==u?r=n=[n,a,c]:(qe=r,r=u)}else qe=r,r=u;if(r===u)if(r=[],M.test(e.charAt(qe))?(n=e.charAt(qe),qe++):(n=u,0===Pe&&Je(ce)),n!==u)for(;n!==u;)r.push(n),M.test(e.charAt(qe))?(n=e.charAt(qe),qe++):(n=u,0===Pe&&Je(ce));else r=u;if(r!==u){if(n=qe,101===e.charCodeAt(qe)?(a=F,qe++):(a=u,0===Pe&&Je(ie)),a!==u){if(S.test(e.charAt(qe))?(c=e.charAt(qe),qe++):(c=u,0===Pe&&Je(ae)),c===u&&(c=null),o=[],M.test(e.charAt(qe))?(i=e.charAt(qe),qe++):(i=u,0===Pe&&Je(ce)),i!==u)for(;i!==u;)o.push(i),M.test(e.charAt(qe))?(i=e.charAt(qe),qe++):(i=u,0===Pe&&Je(ce));else o=u;o!==u?n=a=[a,c,o]:(qe=n,n=u)}else qe=n,n=u;n===u&&(n=null),ze=t,t=ke()}else qe=t,t=u;return t}function it(e,t){return e.map((function(e){return e[t]}))}function lt(e,t,r){return[e].concat(it(t,r))}if((n=o())!==u&&qe===e.length)return n;throw n!==u&&qe<e.length&&Je(He()),Ke(Ne,Ie<e.length?e.charAt(Ie):null,Ie<e.length?Ge(Ie,Ie+1):Ge(Ie,Ie))}return e(t,Error),t.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var n,u=null;for(n=0;n<e.length;n++)if(e[n].source===this.location.source){u=e[n].text.split(/\r\n|\n|\r/g);break}var a=this.location.start,c=this.location.source+":"+a.line+":"+a.column;if(u){var o=this.location.end,i=r("",a.line.toString().length),l=u[a.line-1],f=a.line===o.line?o.column:l.length+1;t+="\n --\x3e "+c+"\n"+i+" |\n"+a.line+" | "+l+"\n"+i+" | "+r("",a.column-1)+r("",f-a.column,"^")}else t+="\n at "+c}return t},t.buildMessage=function(e,t){var r={literal:function(e){return'"'+u(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?a(e[0])+"-"+a(e[1]):a(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function u(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function c(e){return r[e.type](e)}function o(e){var t,r,n=e.map(c);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}function i(e){return e?'"'+u(e)+'"':"end of input"}return"Expected "+o(e)+" but "+i(t)+" found."},{SyntaxError:t,parse:n}},c.exports&&(c.exports=o());const E={deg:1,grad:.9,rad:180/Math.PI,turn:360};function C(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=E[e.unit]))throw new r("effect:type-error",`Expected <angle>, Actual: ${A(e)}`,{term:e})}const F={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function $(e){if("quantity"!==e.type||!(0===e.value&&null===e.unit||e.unit&&null!=F[e.unit]))throw new r("effect:type-error",`Expected <length>, Actual: ${A(e)}`,{term:e})}function j(e){b(e);const t=e.value;return w(t,e),"%"===e.unit?.01*t:t}function O(e){return x(e),w(e.value,e),e.value}function S(e){return C(e),e.value*E[e.unit]||0}function M(e){return $(e),e.value*F[e.unit]||0}function k(e){switch(e.colorType){case"hex":return t.hex2rgba(e.value);case"named":return q(e.value);case"function":return I(e.value)}}function q(e){if(!t.isNamedColor(e))throw new r("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return t.getNamedColorCopy(e)}const z=/^rgba?/i,R=/^hsla?/i;function I(e){if(y(e.parameters,4),z.test(e.name))return[j(e.parameters[0]),j(e.parameters[1]),j(e.parameters[2]),e.parameters[3]?j(e.parameters[3]):1];if(R.test(e.name))return t.hsla2rgba(O(e.parameters[0]),j(e.parameters[1]),j(e.parameters[2]),e.parameters[3]?j(e.parameters[3]):1);throw new r("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}e.parse=l,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
