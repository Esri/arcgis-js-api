/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../colorUtils","../../core/Error","./effects","../../chunks/_commonjsHelpers","./utils"],(function(t,e,r,n,u,a){"use strict";var c,o,i={};function l(t){if(!t||0===t.length)return null;if("string"==typeof t){const e=f(t);return e&&0!==e.length?e:null}const e=t.map((t=>{if(!Number.isFinite(t.scale)||t.scale<=0)throw new r("effect:invalid-scale","scale must be finite and greater than 0",{stop:t});return{scale:t.scale,effects:f(t.value)}}));e.sort(((t,e)=>e.effects.length-t.effects.length));for(let n=0;n<e.length-1;n++){if(!a.canInterpolateEffects(e[n].effects,e[n+1].effects))throw new r("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[n].effects,b:e[n+1].effects});a.normalizeEffects(e[n].effects,e[n+1].effects)}return e.sort(((t,e)=>e.scale-t.scale)),e}function f(t){let e;if(!t)return[];try{e=i.parse(t)}catch(n){throw new r("effect:invalid-syntax","Invalid effect syntax",{value:t,error:n})}return e.map((t=>s(t)))}function s(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return p(t);case"opacity":return h(t);case"hue-rotate":return m(t);case"blur":return g(t);case"drop-shadow":return v(t);case"bloom":return d(t)}}catch(e){throw e.details.filter=t,e}throw new r("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function p(t){let e=1;return y(t.parameters,1),1===t.parameters.length&&(e=j(t.parameters[0])),new n.ColorMatrixEffect(t.name,e)}function h(t){let e=1;return y(t.parameters,1),1===t.parameters.length&&(e=j(t.parameters[0])),new n.OpacityEffect(e)}function m(t){let e=0;return y(t.parameters,1),1===t.parameters.length&&(e=S(t.parameters[0])),new n.HueRotateEffect(e)}function g(t){let e=0;return y(t.parameters,1),1===t.parameters.length&&(e=k(t.parameters[0]),w(e,t.parameters[0])),new n.BlurEffect(e)}function v(t){const e=[];let u=null;for(const n of t.parameters)if("color"===n.type){if(e.length&&Object.freeze(e),u)throw new r("effect:type-error","Accepts only one color",{});u=q(n)}else{const t=k(n);if(Object.isFrozen(e))throw new r("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(t),3===e.length&&w(t,n)}if(e.length<2||e.length>3)throw new r("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new n.DropShadowEffect(e[0],e[1],e[2]||0,u||z("black"))}function d(t){let e=1,r=0,u=0;return y(t.parameters,3),t.parameters[0]&&(e=j(t.parameters[0])),t.parameters[1]&&(r=k(t.parameters[1]),w(r,t.parameters[1])),t.parameters[2]&&(u=j(t.parameters[2])),new n.BloomEffect(e,r,u)}function y(t,e){if(t.length>e)throw new r("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function A(t){if("color"===t.type)return"<color>";if(t.unit){if(F[t.unit])return"<length>";if(E[t.unit])return"<angle>";if("%"===t.unit)return"<percentage>"}return"<double>"}function w(t,e){if(t<0)throw new r("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function x(t){if("quantity"!==t.type||null!==t.unit)throw new r("effect:type-error",`Expected <double>, Actual: ${A(t)}`,{term:t})}function b(t){if("quantity"!==t.type||null!==t.unit&&"%"!==t.unit)throw new r("effect:type-error",`Expected <double> or <percentage>, Actual: ${A(t)}`,{term:t})}c={get exports(){return i},set exports(t){i=t}},u.commonjsGlobal,o=function(){function t(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function e(t,r,n,u){var a=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(a,e.prototype),a.expected=r,a.found=n,a.location=u,a.name="SyntaxError",a}function r(t,e,r){return r=r||" ",t.length>e?t:(e-=t.length,t+(r+=r.repeat(e)).slice(0,e))}function n(t,r){var n,u={},a=(r=void 0!==r?r:{}).grammarSource,c={start:Lt},o=Lt,i="none",l=")",f=",",s="(",p="%",h="px",m="cm",g="mm",v="in",d="pt",y="pc",A="deg",w="rad",x="grad",b="turn",E="#",C=".",F="e",$=/^[ \t\n\r]/,j=/^[a-z\-]/,O=/^[0-9a-fA-F]/,S=/^[+\-]/,k=/^[0-9]/,q=Dt("none"),z=Bt("none",!1),M=Bt(")",!1),R=Bt(",",!1),I=Dt("whitespace"),N=Ht([" ","\t","\n","\r"],!1,!1),P=Dt("function"),T=Bt("(",!1),B=Dt("identifier"),H=Ht([["a","z"],"-"],!1,!1),U=Dt("percentage"),D=Bt("%",!1),G=Dt("length"),_=Bt("px",!1),J=Bt("cm",!1),K=Bt("mm",!1),L=Bt("in",!1),Q=Bt("pt",!1),V=Bt("pc",!1),W=Dt("angle"),X=Bt("deg",!1),Y=Bt("rad",!1),Z=Bt("grad",!1),tt=Bt("turn",!1),et=Dt("number"),rt=Dt("color"),nt=Bt("#",!1),ut=Ht([["0","9"],["a","f"],["A","F"]],!1,!1),at=Ht(["+","-"],!1,!1),ct=Ht([["0","9"]],!1,!1),ot=Bt(".",!1),it=Bt("e",!1),lt=function(){return[]},ft=function(t,e){return{type:"function",name:t,parameters:e||[]}},st=function(t,e){return e.length>0?le(t,e,3):[t]},pt=function(t){return{type:"quantity",value:t.value,unit:t.unit}},ht=function(t){return{type:"color",colorType:t.type,value:t.value}},mt=function(t){return t},gt=function(){return Tt()},vt=function(t){return{value:t,unit:"%"}},dt=function(t){return{value:t,unit:"px"}},yt=function(t){return{value:t,unit:"cm"}},At=function(t){return{value:t,unit:"mm"}},wt=function(t){return{value:t,unit:"in"}},xt=function(t){return{value:t,unit:"pt"}},bt=function(t){return{value:t,unit:"pc"}},Et=function(t){return{value:t,unit:"deg"}},Ct=function(t){return{value:t,unit:"rad"}},Ft=function(t){return{value:t,unit:"grad"}},$t=function(t){return{value:t,unit:"turn"}},jt=function(t){return{value:t,unit:null}},Ot=function(){return{type:"hex",value:Tt()}},St=function(t){return{type:"function",value:t}},kt=function(){return{type:"named",value:Tt()}},qt=function(){return parseFloat(Tt())},zt=0,Mt=0,Rt=[{line:1,column:1}],It=0,Nt=[],Pt=0;if("startRule"in r){if(!(r.startRule in c))throw new Error("Can't start parsing from rule \""+r.startRule+'".');o=c[r.startRule]}function Tt(){return t.substring(Mt,zt)}function Bt(t,e){return{type:"literal",text:t,ignoreCase:e}}function Ht(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Ut(){return{type:"end"}}function Dt(t){return{type:"other",description:t}}function Gt(e){var r,n=Rt[e];if(n)return n;for(r=e-1;!Rt[r];)r--;for(n={line:(n=Rt[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Rt[e]=n,n}function _t(t,e){var r=Gt(t),n=Gt(e);return{source:a,start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Jt(t){zt<It||(zt>It&&(It=zt,Nt=[]),Nt.push(t))}function Kt(t,r,n){return new e(e.buildMessage(t,r),t,r,n)}function Lt(){var t;return(t=Qt())===u&&(t=Vt()),t}function Qt(){var e,r;return Pt++,e=zt,Zt(),t.substr(zt,4)===i?(r=i,zt+=4):(r=u,0===Pt&&Jt(z)),r!==u?(Zt(),Mt=e,e=lt()):(zt=e,e=u),Pt--,e===u&&0===Pt&&Jt(q),e}function Vt(){var t,e;if(t=[],(e=Wt())!==u)for(;e!==u;)t.push(e),e=Wt();else t=u;return t}function Wt(){var e,r,n,a;return e=zt,Zt(),(r=te())!==u?(Zt(),(n=Xt())===u&&(n=null),Zt(),41===t.charCodeAt(zt)?(a=l,zt++):(a=u,0===Pt&&Jt(M)),a!==u?(Zt(),Mt=e,e=ft(r,n)):(zt=e,e=u)):(zt=e,e=u),e}function Xt(){var e,r,n,a,c,o,i,l;if(e=zt,(r=Yt())!==u){for(n=[],a=zt,c=Zt(),44===t.charCodeAt(zt)?(o=f,zt++):(o=u,0===Pt&&Jt(R)),o===u&&(o=null),i=Zt(),(l=Yt())!==u?a=c=[c,o,i,l]:(zt=a,a=u);a!==u;)n.push(a),a=zt,c=Zt(),44===t.charCodeAt(zt)?(o=f,zt++):(o=u,0===Pt&&Jt(R)),o===u&&(o=null),i=Zt(),(l=Yt())!==u?a=c=[c,o,i,l]:(zt=a,a=u);Mt=e,e=st(r,n)}else zt=e,e=u;return e}function Yt(){var t,e;return t=zt,(e=re())===u&&(e=ne())===u&&(e=ue())===u&&(e=ae()),e!==u&&(Mt=t,e=pt(e)),(t=e)===u&&(t=zt,(e=ce())!==u&&(Mt=t,e=ht(e)),t=e),t}function Zt(){var e,r;for(Pt++,e=[],$.test(t.charAt(zt))?(r=t.charAt(zt),zt++):(r=u,0===Pt&&Jt(N));r!==u;)e.push(r),$.test(t.charAt(zt))?(r=t.charAt(zt),zt++):(r=u,0===Pt&&Jt(N));return Pt--,r=u,0===Pt&&Jt(I),e}function te(){var e,r,n;return Pt++,e=zt,(r=ee())!==u?(40===t.charCodeAt(zt)?(n=s,zt++):(n=u,0===Pt&&Jt(T)),n!==u?(Mt=e,e=mt(r)):(zt=e,e=u)):(zt=e,e=u),Pt--,e===u&&(r=u,0===Pt&&Jt(P)),e}function ee(){var e,r,n;if(Pt++,e=zt,r=[],j.test(t.charAt(zt))?(n=t.charAt(zt),zt++):(n=u,0===Pt&&Jt(H)),n!==u)for(;n!==u;)r.push(n),j.test(t.charAt(zt))?(n=t.charAt(zt),zt++):(n=u,0===Pt&&Jt(H));else r=u;return r!==u&&(Mt=e,r=gt()),Pt--,(e=r)===u&&(r=u,0===Pt&&Jt(B)),e}function re(){var e,r,n;return Pt++,e=zt,Zt(),(r=oe())!==u?(37===t.charCodeAt(zt)?(n=p,zt++):(n=u,0===Pt&&Jt(D)),n!==u?(Mt=e,e=vt(r)):(zt=e,e=u)):(zt=e,e=u),Pt--,e===u&&0===Pt&&Jt(U),e}function ne(){var e,r,n;return Pt++,e=zt,Zt(),(r=oe())!==u?(t.substr(zt,2)===h?(n=h,zt+=2):(n=u,0===Pt&&Jt(_)),n!==u?(Mt=e,e=dt(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Zt(),(r=oe())!==u?(t.substr(zt,2)===m?(n=m,zt+=2):(n=u,0===Pt&&Jt(J)),n!==u?(Mt=e,e=yt(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Zt(),(r=oe())!==u?(t.substr(zt,2)===g?(n=g,zt+=2):(n=u,0===Pt&&Jt(K)),n!==u?(Mt=e,e=At(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Zt(),(r=oe())!==u?(t.substr(zt,2)===v?(n=v,zt+=2):(n=u,0===Pt&&Jt(L)),n!==u?(Mt=e,e=wt(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Zt(),(r=oe())!==u?(t.substr(zt,2)===d?(n=d,zt+=2):(n=u,0===Pt&&Jt(Q)),n!==u?(Mt=e,e=xt(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,Zt(),(r=oe())!==u?(t.substr(zt,2)===y?(n=y,zt+=2):(n=u,0===Pt&&Jt(V)),n!==u?(Mt=e,e=bt(r)):(zt=e,e=u)):(zt=e,e=u)))))),Pt--,e===u&&0===Pt&&Jt(G),e}function ue(){var e,r,n;return Pt++,e=zt,(r=oe())!==u?(t.substr(zt,3)===A?(n=A,zt+=3):(n=u,0===Pt&&Jt(X)),n!==u?(Mt=e,e=Et(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,(r=oe())!==u?(t.substr(zt,3)===w?(n=w,zt+=3):(n=u,0===Pt&&Jt(Y)),n!==u?(Mt=e,e=Ct(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,(r=oe())!==u?(t.substr(zt,4)===x?(n=x,zt+=4):(n=u,0===Pt&&Jt(Z)),n!==u?(Mt=e,e=Ft(r)):(zt=e,e=u)):(zt=e,e=u),e===u&&(e=zt,(r=oe())!==u?(t.substr(zt,4)===b?(n=b,zt+=4):(n=u,0===Pt&&Jt(tt)),n!==u?(Mt=e,e=$t(r)):(zt=e,e=u)):(zt=e,e=u)))),Pt--,e===u&&(r=u,0===Pt&&Jt(W)),e}function ae(){var t,e;return Pt++,t=zt,Zt(),(e=oe())!==u?(Mt=t,t=jt(e)):(zt=t,t=u),Pt--,t===u&&0===Pt&&Jt(et),t}function ce(){var e,r,n,a;if(Pt++,e=zt,35===t.charCodeAt(zt)?(r=E,zt++):(r=u,0===Pt&&Jt(nt)),r!==u){if(n=[],O.test(t.charAt(zt))?(a=t.charAt(zt),zt++):(a=u,0===Pt&&Jt(ut)),a!==u)for(;a!==u;)n.push(a),O.test(t.charAt(zt))?(a=t.charAt(zt),zt++):(a=u,0===Pt&&Jt(ut));else n=u;n!==u?(Mt=e,e=Ot()):(zt=e,e=u)}else zt=e,e=u;return e===u&&(e=zt,(r=Wt())!==u&&(Mt=e,r=St(r)),(e=r)===u&&(e=zt,(r=ee())!==u&&(Mt=e,r=kt()),e=r)),Pt--,e===u&&(r=u,0===Pt&&Jt(rt)),e}function oe(){var e,r,n,a,c,o,i;for(e=zt,S.test(t.charAt(zt))?(t.charAt(zt),zt++):0===Pt&&Jt(at),r=zt,n=[],k.test(t.charAt(zt))?(a=t.charAt(zt),zt++):(a=u,0===Pt&&Jt(ct));a!==u;)n.push(a),k.test(t.charAt(zt))?(a=t.charAt(zt),zt++):(a=u,0===Pt&&Jt(ct));if(46===t.charCodeAt(zt)?(a=C,zt++):(a=u,0===Pt&&Jt(ot)),a!==u){if(c=[],k.test(t.charAt(zt))?(o=t.charAt(zt),zt++):(o=u,0===Pt&&Jt(ct)),o!==u)for(;o!==u;)c.push(o),k.test(t.charAt(zt))?(o=t.charAt(zt),zt++):(o=u,0===Pt&&Jt(ct));else c=u;c!==u?r=n=[n,a,c]:(zt=r,r=u)}else zt=r,r=u;if(r===u)if(r=[],k.test(t.charAt(zt))?(n=t.charAt(zt),zt++):(n=u,0===Pt&&Jt(ct)),n!==u)for(;n!==u;)r.push(n),k.test(t.charAt(zt))?(n=t.charAt(zt),zt++):(n=u,0===Pt&&Jt(ct));else r=u;if(r!==u){if(n=zt,101===t.charCodeAt(zt)?(a=F,zt++):(a=u,0===Pt&&Jt(it)),a!==u){if(S.test(t.charAt(zt))?(c=t.charAt(zt),zt++):(c=u,0===Pt&&Jt(at)),c===u&&(c=null),o=[],k.test(t.charAt(zt))?(i=t.charAt(zt),zt++):(i=u,0===Pt&&Jt(ct)),i!==u)for(;i!==u;)o.push(i),k.test(t.charAt(zt))?(i=t.charAt(zt),zt++):(i=u,0===Pt&&Jt(ct));else o=u;o!==u?n=a=[a,c,o]:(zt=n,n=u)}else zt=n,n=u;n===u&&(n=null),Mt=e,e=qt()}else zt=e,e=u;return e}function ie(t,e){return t.map((function(t){return t[e]}))}function le(t,e,r){return[t].concat(ie(e,r))}if((n=o())!==u&&zt===t.length)return n;throw n!==u&&zt<t.length&&Jt(Ut()),Kt(Nt,It<t.length?t.charAt(It):null,It<t.length?_t(It,It+1):_t(It,It))}return t(e,Error),e.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n,u=null;for(n=0;n<t.length;n++)if(t[n].source===this.location.source){u=t[n].text.split(/\r\n|\n|\r/g);break}var a=this.location.start,c=this.location.source+":"+a.line+":"+a.column;if(u){var o=this.location.end,i=r("",a.line.toString().length," "),l=u[a.line-1],f=(a.line===o.line?o.column:l.length+1)-a.column||1;e+="\n --\x3e "+c+"\n"+i+" |\n"+a.line+" | "+l+"\n"+i+" | "+r("",a.column-1," ")+r("",f,"^")}else e+="\n at "+c}return e},e.buildMessage=function(t,e){var r={literal:function(t){return'"'+u(t.text)+'"'},class:function(t){var e=t.parts.map((function(t){return Array.isArray(t)?a(t[0])+"-"+a(t[1]):a(t)}));return"["+(t.inverted?"^":"")+e.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function u(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function c(t){return r[t.type](t)}function o(t){var e,r,n=t.map(c);if(n.sort(),n.length>0){for(e=1,r=1;e<n.length;e++)n[e-1]!==n[e]&&(n[r]=n[e],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}function i(t){return t?'"'+u(t)+'"':"end of input"}return"Expected "+o(t)+" but "+i(e)+" found."},{SyntaxError:e,parse:n}},c.exports&&(c.exports=o());const E={deg:1,grad:.9,rad:180/Math.PI,turn:360};function C(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=E[t.unit]))throw new r("effect:type-error",`Expected <angle>, Actual: ${A(t)}`,{term:t})}const F={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function $(t){if("quantity"!==t.type||!(0===t.value&&null===t.unit||t.unit&&null!=F[t.unit]))throw new r("effect:type-error",`Expected <length>, Actual: ${A(t)}`,{term:t})}function j(t){b(t);const e=t.value;return w(e,t),"%"===t.unit?.01*e:e}function O(t){return x(t),w(t.value,t),t.value}function S(t){return C(t),t.value*E[t.unit]||0}function k(t){return $(t),t.value*F[t.unit]||0}function q(t){switch(t.colorType){case"hex":return e.hex2rgba(t.value);case"named":return z(t.value);case"function":return I(t.value)}}function z(t){if(!e.isNamedColor(t))throw new r("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return e.getNamedColorCopy(t)}const M=/^rgba?/i,R=/^hsla?/i;function I(t){if(y(t.parameters,4),M.test(t.name))return[j(t.parameters[0]),j(t.parameters[1]),j(t.parameters[2]),t.parameters[3]?j(t.parameters[3]):1];if(R.test(t.name))return e.hsla2rgba(O(t.parameters[0]),j(t.parameters[1]),j(t.parameters[2]),t.parameters[3]?j(t.parameters[3]):1);throw new r("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}t.parse=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
