/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Accessor","../../core/has","../../core/lang","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","./parser","./utils"],(function(t,e,s,r,c,n,i,o,f,l,a,h){"use strict";const u=-1;function _(t){const e=a.parse(t)||[];return d(e)?[{scale:u,effects:e}]:e}function p(t,e,s){if(!t[0]?.effects||!e[0]?.effects)return!0;return!((t[0]?.scale===u||e[0]?.scale===u)&&(t.length>1||e.length>1)&&s<=0)&&h.canInterpolateEffects(t[0].effects,e[0].effects)}function y(t,e,s){const r=t.length>e.length?t:e,c=t.length>e.length?e:t,n=c[c.length-1],i=n?.scale??s,o=n?.effects??[];for(let f=c.length;f<r.length;f++)c.push({scale:i,effects:[...o]});for(let f=0;f<r.length;f++)c[f].scale=c[f].scale===u?s:c[f].scale,r[f].scale=r[f].scale===u?s:r[f].scale,h.normalizeEffects(c[f].effects,r[f].effects)}function g(t,e,s){return t+(e-t)*s}function d(t){const e=t[0];return!!e&&"type"in e}t.EffectView=function(t){function s(e){var s;return(s=t.call(this,e)||this)._from=null,s._to=null,s._final=null,s._current=[],s._time=0,s.duration=c("mapview-transitions-duration"),s.effects=[],s}e._inheritsLoose(s,t);var r=s.prototype;return r.canTransitionTo=function(t){try{return this.scale>0&&p(this._current,_(t),this.scale)}catch{return!1}},r.transitionStep=function(t,e){this._applyTimeTransition(t),this._updateForScale(e)},r.endTransitions=function(){this._applyTimeTransition(this.duration)},r._transitionTo=function(t){this.scale>0&&p(this._current,t,this.scale)?(this._final=t,this._to=n.clone(t),y(this._current,this._to,this.scale),this._from=n.clone(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?n.clone(this._current[0].effects):[])},r._applyTimeTransition=function(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let s=0;s<this._current.length;s++){const t=this._current[s],r=this._from[s],c=this._to[s];t.scale=g(r.scale,c.scale,e);for(let s=0;s<t.effects.length;s++){const n=t.effects[s],i=r.effects[s],o=c.effects[s];n.interpolate(i,o,e)}}1===e&&(this._current=this._final,this._set("effects",this._current[0]?n.clone(this._current[0].effects):[]),this._from=this._to=this._final=null)},r._updateForScale=function(t){if(this._set("scale",t),0===this._current.length)return;const e=this._current,s=this._current.length-1;let r,c,n=1;if(1===e.length||t>=e[0].scale)c=r=e[0].effects;else if(t<=e[s].scale)c=r=e[s].effects;else for(let i=0;i<s;i++){const s=e[i],o=e[i+1];if(s.scale>=t&&o.scale<=t){n=(t-s.scale)/(o.scale-s.scale),r=s.effects,c=o.effects;break}}for(let i=0;i<this.effects.length;i++){this.effects[i].interpolate(r[i],c[i],n)}},e._createClass(s,[{key:"effect",set:function(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(_(t))}catch(e){this._transitionTo([]),i.getLogger(this.declaredClass).warn("Invalid Effect",{effect:t,error:e})}}}},{key:"hasEffects",get:function(){return this.transitioning||!!this.effects.length}},{key:"scale",set:function(t){this._updateForScale(t)}},{key:"transitioning",get:function(){return null!==this._to}}]),s}(r),s.__decorate([o.property()],t.EffectView.prototype,"_to",void 0),s.__decorate([o.property()],t.EffectView.prototype,"duration",void 0),s.__decorate([o.property({value:""})],t.EffectView.prototype,"effect",null),s.__decorate([o.property({readOnly:!0})],t.EffectView.prototype,"effects",void 0),s.__decorate([o.property({readOnly:!0})],t.EffectView.prototype,"hasEffects",null),s.__decorate([o.property({value:0})],t.EffectView.prototype,"scale",null),s.__decorate([o.property({readOnly:!0})],t.EffectView.prototype,"transitioning",null),t.EffectView=s.__decorate([l.subclass("esri.layers.effects.EffectView")],t.EffectView),t.canInterpolateEffectStops=p,t.convertEffectToStops=_,t.normalizeEffectStops=y,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
