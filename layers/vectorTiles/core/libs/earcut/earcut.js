// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.39/esri/copyright.txt for details.

define([],(function(){"use strict";var n,e;function t(t,u,f){f=f||2,n=t.length/f+(u?2*u.length:0),e=!1;var v,o,h,a,s,c,Z,g=u&&u.length,d=g?u[0]*f:t.length,w=r(t,0,d,f,!0),z=[];if(!w)return z;if(g&&(w=function(n,e,t,i){var u,f,v,o,h,a=[];for(u=0,f=e.length;u<f;u++)v=e[u]*i,o=u<f-1?e[u+1]*i:n.length,(h=r(n,v,o,i,!1))===h.next&&(h.steiner=!0),a.push(p(h));for(a.sort(l),u=0;u<a.length;u++){if(!t)return null;y(a[u],t),t=x(t,t.next)}return t}(t,u,w,f)),e)return z;if(t.length>80*f){v=h=t[0],o=a=t[1];for(var b=f;b<d;b+=f)(s=t[b])<v&&(v=s),(c=t[b+1])<o&&(o=c),s>h&&(h=s),c>a&&(a=c);Z=Math.max(h-v,a-o)}return i(w,z,f,v,o,Z),z}function r(n,e,t,r,x){var i,u;if(x===m(n,e,t,r)>0)for(i=e;i<t;i+=r)u=z(i,n[i],n[i+1],u);else for(i=t-r;i>=e;i-=r)u=z(i,n[i],n[i+1],u);return u&&Z(u,u.next)&&(b(u),u=u.next),u}function x(t,r){if(!t)return t;r||(r=t);var x,i=t,u=0,f=n*n/2;do{if(x=!1,i.steiner||!Z(i,i.next)&&0!==c(i.prev,i,i.next))i=i.next;else{if(b(i),(i=r=i.prev)===i.next)return null;x=!0}if(u++>f)return e=!0,null}while(x||i!==r);return r}function i(n,t,r,l,y,p,a){if(n){!a&&p&&function(n,e,t,r){var x=n;do{null===x.z&&(x.z=h(x.x,x.y,e,t,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==n);x.prevZ.nextZ=null,x.prevZ=null,function(n){var e,t,r,x,i,u,f,v,o=1;do{for(t=n,n=null,i=null,u=0;t;){for(u++,r=t,f=0,e=0;e<o&&(f++,r=r.nextZ);e++);for(v=o;f>0||v>0&&r;)0===f?(x=r,r=r.nextZ,v--):0!==v&&r?t.z<=r.z?(x=t,t=t.nextZ,f--):(x=r,r=r.nextZ,v--):(x=t,t=t.nextZ,f--),i?i.nextZ=x:n=x,x.prevZ=i,i=x;t=r}i.nextZ=null,o*=2}while(u>1)}(x)}(n,l,y,p);for(var s,c,Z=n;n.prev!==n.next;)if(s=n.prev,c=n.next,p?f(n,l,y,p):u(n))t.push(s.i/r),t.push(n.i/r),t.push(c.i/r),b(n),n=c.next,Z=c.next;else{if(e)return;if((n=c)===Z){a?1===a?i(n=v(n,t,r),t,r,l,y,p,2):2===a&&o(n,t,r,l,y,p):i(x(n),t,r,l,y,p,1);break}}}}function u(t){var r=t.prev,x=t,i=t.next;if(c(r,x,i)>=0)return!1;for(var u=t.next.next,f=0;u!==t.prev;){if(a(r.x,r.y,x.x,x.y,i.x,i.y,u.x,u.y)&&c(u.prev,u,u.next)>=0)return!1;if(u=u.next,f++>n)return e=!0,!1}return!0}function f(n,e,t,r){var x=n.prev,i=n,u=n.next;if(c(x,i,u)>=0)return!1;for(var f=x.x<i.x?x.x<u.x?x.x:u.x:i.x<u.x?i.x:u.x,v=x.y<i.y?x.y<u.y?x.y:u.y:i.y<u.y?i.y:u.y,o=x.x>i.x?x.x>u.x?x.x:u.x:i.x>u.x?i.x:u.x,l=x.y>i.y?x.y>u.y?x.y:u.y:i.y>u.y?i.y:u.y,y=h(f,v,e,t,r),p=h(o,l,e,t,r),s=n.nextZ;s&&s.z<=p;){if(s!==n.prev&&s!==n.next&&a(x.x,x.y,i.x,i.y,u.x,u.y,s.x,s.y)&&c(s.prev,s,s.next)>=0)return!1;s=s.nextZ}for(s=n.prevZ;s&&s.z>=y;){if(s!==n.prev&&s!==n.next&&a(x.x,x.y,i.x,i.y,u.x,u.y,s.x,s.y)&&c(s.prev,s,s.next)>=0)return!1;s=s.prevZ}return!0}function v(n,e,t){var r=n;do{var x=r.prev,i=r.next.next;!Z(x,i)&&g(x,r,r.next,i)&&d(x,i)&&d(i,x)&&(e.push(x.i/t),e.push(r.i/t),e.push(i.i/t),b(r),b(r.next),r=n=i),r=r.next}while(r!==n);return r}function o(n,e,t,r,u,f){var v=n;do{for(var o=v.next.next;o!==v.prev;){if(v.i!==o.i&&s(v,o)){var l=w(v,o);return v=x(v,v.next),l=x(l,l.next),i(v,e,t,r,u,f),void i(l,e,t,r,u,f)}o=o.next}v=v.next}while(v!==n)}function l(n,e){return n.x-e.x}function y(n,e){if(e=function(n,e){var t,r=e,x=n.x,i=n.y,u=-1/0;do{if(!r)return null;if(i<=r.y&&i>=r.next.y){var f=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(f<=x&&f>u){if(u=f,f===x){if(i===r.y)return r;if(i===r.next.y)return r.next}t=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!t)return null;if(x===u)return t.prev;var v,o=t,l=t.x,y=t.y,h=1/0;r=t.next;for(;r!==o;)x>=r.x&&r.x>=l&&a(i<y?x:u,i,l,y,i<y?u:x,i,r.x,r.y)&&((v=Math.abs(i-r.y)/(x-r.x))<h||v===h&&r.x>t.x)&&d(r,n)&&(t=r,h=v),r=r.next;return t}(n,e)){var t=w(e,n);x(t,t.next)}}function h(n,e,t,r,x){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-t)/x)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/x)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(n){var e=n,t=n;do{e.x<t.x&&(t=e),e=e.next}while(e!==n);return t}function a(n,e,t,r,x,i,u,f){return(x-u)*(e-f)-(n-u)*(i-f)>=0&&(n-u)*(r-f)-(t-u)*(e-f)>=0&&(t-u)*(i-f)-(x-u)*(r-f)>=0}function s(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(n,e){var t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&g(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}(n,e)&&d(n,e)&&d(e,n)&&function(n,e){var t=n,r=!1,x=(n.x+e.x)/2,i=(n.y+e.y)/2;do{t.y>i!=t.next.y>i&&x<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==n);return r}(n,e)}function c(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Z(n,e){return n.x===e.x&&n.y===e.y}function g(n,e,t,r){return!!(Z(n,e)&&Z(t,r)||Z(n,r)&&Z(t,e))||c(n,e,t)>0!=c(n,e,r)>0&&c(t,r,n)>0!=c(t,r,e)>0}function d(n,e){return c(n.prev,n,n.next)<0?c(n,e,n.next)>=0&&c(n,n.prev,e)>=0:c(n,e,n.prev)<0||c(n,n.next,e)<0}function w(n,e){var t=new M(n.i,n.x,n.y),r=new M(e.i,e.x,e.y),x=n.next,i=e.prev;return n.next=e,e.prev=n,t.next=x,x.prev=t,r.next=t,t.prev=r,i.next=r,r.prev=i,r}function z(n,e,t,r){var x=new M(n,e,t);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function b(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function M(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function m(n,e,t,r){for(var x=0,i=e,u=t-r;i<t;i+=r)x+=(n[u]-n[i])*(n[i+1]+n[u+1]),u=i;return x}return t.deviation=function(n,e,t,r){var x=e&&e.length,i=x?e[0]*t:n.length,u=Math.abs(m(n,0,i,t));if(x)for(var f=0,v=e.length;f<v;f++){var o=e[f]*t,l=f<v-1?e[f+1]*t:n.length;u-=Math.abs(m(n,o,l,t))}var y=0;for(f=0;f<r.length;f+=3){var h=r[f]*t,p=r[f+1]*t,a=r[f+2]*t;y+=Math.abs((n[h]-n[a])*(n[p+1]-n[h+1])-(n[h]-n[p])*(n[a+1]-n[h+1]))}return 0===u&&0===y?0:Math.abs((y-u)/u)},t.flatten=function(n){for(var e=n[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,x=0;x<n.length;x++){for(var i=0;i<n[x].length;i++)for(var u=0;u<e;u++)t.vertices.push(n[x][i][u]);x>0&&(r+=n[x-1].length,t.holes.push(r))}return t},t}));