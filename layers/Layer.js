// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../config","../geometry","../request","../core/Error","../core/Evented","../core/Identifiable","../core/Loadable","../core/Logger","../core/urlUtils","../core/accessorSupport/decorators","@dojo/framework/shim/Promise"],(function(e,t,r,o,a,n,i,l,p,s,u,c,d){"use strict";var y=0,b=u.getLogger("esri.layers.Layer");return function(t){function l(){var e=null!==t&&t.apply(this,arguments)||this;return e.attributionDataUrl=null,e.fullExtent=new a.Extent(-180,-90,180,90,a.SpatialReference.WGS84),e.id=Date.now().toString(16)+"-layer-"+y++,e.legendEnabled=!0,e.listMode="show",e.opacity=1,e.parent=null,e.popupEnabled=!0,e.attributionVisible=!0,e.spatialReference=a.SpatialReference.WGS84,e.title=null,e.type=null,e.url=null,e.visible=!0,e}return r.__extends(l,t),l.fromArcGISServerUrl=function(t){return r.__awaiter(this,void 0,void 0,(function(){var o,a,n;return r.__generator(this,(function(r){switch(r.label){case 0:return o="string"==typeof t?{url:t}:t,[4,new Promise((function(t,r){e(["./support/arcgisLayers"],t,r)}))];case 1:a=r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,a.fromUrl(o)];case 3:return[2,r.sent()];case 4:throw n=r.sent(),b.error("#fromArcGISServerUrl({ url: '"+o.url+"'})","Failed to create layer from arcgis server url",n),n;case 5:return[2]}}))}))},l.fromPortalItem=function(t){return r.__awaiter(this,void 0,void 0,(function(){var a,n,i,l,p,s;return r.__generator(this,(function(r){switch(r.label){case 0:return a="portalItem"in t?t:{portalItem:t},[4,new Promise((function(t,r){e(["../portal/support/portalLayers"],t,r)}))];case 1:n=r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,n.fromItem(a)];case 3:return[2,r.sent()];case 4:throw i=r.sent(),l=a&&a.portalItem,p=l&&l.id||"unset",s=l&&l.portal&&l.portal.url||o.portalUrl,b.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+s+"', id: '"+p+"')",i),i;case 5:return[2]}}))}))},l.prototype.initialize=function(){var e=this;this.when().catch((function(t){var r,o;u.getLogger(e.declaredClass).error("#load()","Failed to load layer (title: '"+(null!==(r=e.title)&&void 0!==r?r:"no title")+"', id: '"+(null!==(o=e.id)&&void 0!==o?o:"no id")+"')",{error:t})}))},l.prototype.destroy=function(){if(this.parent){var e=this.parent;"layers"in e&&e.layers.includes(this)?e.layers.remove(this):"tables"in e&&e.tables.includes(this)?e.tables.remove(this):"baseLayers"in e&&e.baseLayers.includes(this)?e.baseLayers.remove(this):"baseLayers"in e&&e.referenceLayers.includes(this)&&e.referenceLayers.remove(this)}},Object.defineProperty(l.prototype,"hasAttributionData",{get:function(){return null!=this.attributionDataUrl},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"parsedUrl",{get:function(){var e=this._get("url");return e?c.urlToObject(e):null},enumerable:!1,configurable:!0}),l.prototype.fetchAttributionData=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return e=this.attributionDataUrl,this.hasAttributionData&&e?[4,n(e,{query:{f:"json"},responseType:"json"})]:[3,2];case 1:return[2,t.sent().data];case 2:throw new i("layer:no-attribution-data","Layer does not have attribution data")}}))}))},r.__decorate([d.property({type:String})],l.prototype,"attributionDataUrl",void 0),r.__decorate([d.property({type:a.Extent})],l.prototype,"fullExtent",void 0),r.__decorate([d.property({readOnly:!0,dependsOn:["attributionDataUrl"]})],l.prototype,"hasAttributionData",null),r.__decorate([d.property({type:String})],l.prototype,"id",void 0),r.__decorate([d.property({type:Boolean,nonNullable:!0})],l.prototype,"legendEnabled",void 0),r.__decorate([d.property({type:["show","hide","hide-children"]})],l.prototype,"listMode",void 0),r.__decorate([d.property({type:Number,range:{min:0,max:1},nonNullable:!0})],l.prototype,"opacity",void 0),r.__decorate([d.property()],l.prototype,"parent",void 0),r.__decorate([d.property({readOnly:!0,dependsOn:["url"]})],l.prototype,"parsedUrl",null),r.__decorate([d.property({type:Boolean})],l.prototype,"popupEnabled",void 0),r.__decorate([d.property({type:Boolean})],l.prototype,"attributionVisible",void 0),r.__decorate([d.property({type:a.SpatialReference})],l.prototype,"spatialReference",void 0),r.__decorate([d.property({type:String})],l.prototype,"title",void 0),r.__decorate([d.property({type:String,readOnly:!0,json:{read:!1}})],l.prototype,"type",void 0),r.__decorate([d.property()],l.prototype,"url",void 0),r.__decorate([d.property({type:Boolean,nonNullable:!0})],l.prototype,"visible",void 0),l=r.__decorate([d.subclass("esri.layers.Layer")],l)}(l.EventedMixin(p.IdentifiableMixin(s)))}));