/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/Collection","../core/Error","../core/Logger","../core/maybe","../core/MultiOriginJSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/arrayUtils","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./Layer","./mixins/BlendLayer","./mixins/OperationalLayer","./mixins/ScaleRangeLayer","./support/ImageElement","./support/LocalMediaElementSource","./support/VideoElement"],(function(e,r,t,o,a,s,c,n,i,l,p,u,d,y,f,h,_,m,g,S){"use strict";function v(e){return"object"==typeof e&&null!=e&&"type"in e}let w=function(r){function c(e){var t;return(t=r.call(this,e)||this).effectiveSource=null,t.copyright=null,t.operationalLayerType="MediaLayer",t.spatialReference=null,t.type="media",t.source=new g,t}e._inheritsLoose(c,r);var n=c.prototype;return n.load=function(e){const r=this.source;if(!r)return this.addResolvingPromise(Promise.reject(new o("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer."))),Promise.resolve(this);const a=v(r)?new g({elements:new t([r])}):r;this._set("effectiveSource",a),this.spatialReference&&(a.spatialReference=this.spatialReference);const s=a.load(e).then((()=>{this.spatialReference=a.spatialReference}));return this.addResolvingPromise(s),Promise.resolve(this)},n.destroy=function(){s.unwrap(this.effectiveSource)?.destroy(),s.unwrap(this.source)?.destroy()},n.castSource=function(e){return e?Array.isArray(e)||e instanceof t?new g({elements:e}):e:null},n.readSource=function(e,r,t){const o="image"===r.mediaType?new m:"video"===r.mediaType?new S:null;return o?.read(r,t),o},n.writeSource=function(e,r,t,a){e&&v(e)&&"image"===e.type?e.write(r,a):a?.messages&&a?.messages?.push(new o("media-layer:unsupported-source","source must be an 'ImageElement'"))},e._createClass(c,[{key:"fullExtent",get:function(){return this.loaded?this.effectiveSource.fullExtent:null}},{key:"source",set:function(e){"not-loaded"===this.loadStatus?this._set("source",e):a.getLogger(this.declaredClass).error("#source","source cannot be changed after the layer is loaded.")}}]),c}(f.BlendLayer(_.ScaleRangeLayer(h.OperationalLayer(c.MultiOriginJSONMixin(y)))));r.__decorate([n.property({readOnly:!0})],w.prototype,"effectiveSource",void 0),r.__decorate([n.property({type:String})],w.prototype,"copyright",void 0),r.__decorate([n.property({readOnly:!0})],w.prototype,"fullExtent",null),r.__decorate([n.property({type:["MediaLayer"]})],w.prototype,"operationalLayerType",void 0),r.__decorate([n.property({type:["show","hide"]})],w.prototype,"listMode",void 0),r.__decorate([n.property({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1}}})],w.prototype,"source",null),r.__decorate([i.cast("source")],w.prototype,"castSource",null),r.__decorate([p.reader("source",["url"])],w.prototype,"readSource",null),r.__decorate([d.writer("source")],w.prototype,"writeSource",null),r.__decorate([n.property()],w.prototype,"spatialReference",void 0),r.__decorate([n.property({readOnly:!0})],w.prototype,"type",void 0),w=r.__decorate([u.subclass("esri.layers.MediaLayer")],w);return w}));
