/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Error","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","./BaseRaster"],(function(r,e,t,s,o,n,a,i,c){"use strict";let p=function(e){function o(){var r;return(r=e.apply(this,arguments)||this).datasetFormat="Function",r.tileType="Raster",r.rasterFunction=null,r._primaryRasters=null,r}r._inheritsLoose(o,e);var n=o.prototype;return n.open=function(){var e=r._asyncToGenerator((function*(r){yield this.init();const{rasterFunction:e}=this,{rasters:s,rasterIds:o}=e.getPrimaryRasters(),n=s.map((e=>e.rasterInfo?void 0:e.open(r)));yield Promise.all(n);const a=s.map((({rasterInfo:r})=>r)),i=e.bind({rasterInfos:a,rasterIds:o});if(!i.success)throw new t("raster-function:open",`cannot bind the function: ${i.error??""}`);yield this.syncJobHandler(),this.set("sourceJSON",s[0].sourceJSON),this.set("rasterInfo",e.rasterInfo)}));function s(r){return e.apply(this,arguments)}return s}(),n.syncJobHandler=function(){var e=r._asyncToGenerator((function*(){const{rasterFunction:r}=this;if(this._primaryRasters=r.getPrimaryRasters(),this.rasterJobHandler)return this.rasterJobHandler.updateRasterFunction(r)}));function t(){return e.apply(this,arguments)}return t}(),n.fetchPixels=function(){var e=r._asyncToGenerator((function*(r,e,t,o={}){const{rasters:n,rasterIds:a}=this._primaryRasters,i=n.map((s=>s.fetchPixels(r,e,t,o))),c=yield Promise.all(i),p=c.map((r=>r.pixelBlock));if(p.every((r=>s.isNone(r))))return c[0];const u=c.find((r=>s.isSome(r.pixelBlock)))?.extent??r,l=this.rasterJobHandler?yield this.rasterJobHandler.process({extent:u,primaryPixelBlocks:p,primaryRasterIds:a}):this.rasterFunction.process({extent:u,primaryPixelBlocks:p,primaryRasterIds:a});return{...c[0],pixelBlock:l}}));function t(r,t,s){return e.apply(this,arguments)}return t}(),o}(c);e.__decorate([o.property({type:String,json:{write:!0}})],p.prototype,"datasetFormat",void 0),e.__decorate([o.property()],p.prototype,"tileType",void 0),e.__decorate([o.property()],p.prototype,"rasterFunction",void 0),p=e.__decorate([i.subclass("esri.layers.support.rasterDatasets.FunctionRaster")],p);return p}));
