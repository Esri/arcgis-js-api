/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports"],(function(t){"use strict";const n=5e4;function e(t){const n=o(t);return n?{isMultipart:!0,data:n.boundary?r(t.data,n,0):null}:{isMultipart:!1,data:null}}function r(t,e,r=0){const o="--"+e.boundary,a=[];for(let n=0;n<o.length;n++)a.push(o.charCodeAt(n));const s=[],c="\n--"+e.boundary+"--";for(let n=0;n<c.length;n++)s.push(c.charCodeAt(n));const l=[10],u=[13,10],f=[],h=a.length,g=new Uint8Array(t,r),d=Math.min(n,g.length-h);let p=0,y=0;for(let n=0;n<d;n++){for(y=0;y<h&&g[n+y]===a[y];y++);y===h&&(p&&f.push(i(g.subarray(p,n),e)),n+=h-1,g[n+1]===l[0]?n+=1:g[n+1]===u[0]&&g[n+2]===u[1]&&(n+=2),p=n+1)}const b=s.length;for(let n=g.length-b-10;n<g.length-b;n++){for(y=0;y<b&&g[n+y]===s[y];y++);if(y===b){f.push(i(g.subarray(p,n),e));break}}return f}function o(t){const n=t.getHeader?.("Content-Type")?.split(";");if(!(n?.[0].trim()??"").startsWith("multipart/"))return null;const e={boundary:"",start:"",type:""};for(let r=1;r<n.length;r++){const t=n[r].indexOf("=");if(t>0){const o=n[r].slice(0,t).trim(),i=n[r].slice(t+1).trim();e[o]=i.startsWith('"')?i.slice(1,i.length-1):i}}return e}function i(t,n){const e=String.fromCharCode.apply(null,t.subarray(0,Math.min(300,t.length))).split("\n"),r=Math.min(e.length,7),o={contentDisposition:"inline"};let i=0;for(let a=0;a<r;a++)if(e[a].length<4)i=i+e[a].length+1;else if("content"===e[a].slice(0,7).toLowerCase()){if(i=i+e[a].length+1,!e[a].includes(":"))continue;const t=e[a].substring(0,e[a].indexOf(":")).trim(),n=e[a].substring(e[a].indexOf(":")+1).trim();switch(t.toLowerCase()){case"content-type":o.contentType=n;break;case"content-description":o.contentDescription=n;break;case"content-transfer-encoding":o.contentTransferEncoding=n;break;case"content-id":o.contentID=n;break;case"content-disposition":o.contentDisposition=n;break;case"content-location":o.contentLocation=n}}else{if(o.contentDisposition.toLowerCase().includes("inline")&&e[a].length>=4&&o.contentType?.toLowerCase().indexOf("image")>-1){let n=!0,e=t.subarray(i,t.length);if(o.contentType.toLowerCase().indexOf("tif")>0){if("base64"===o.contentTransferEncoding){let t="";const n=e;for(let e=0;e<n.length;e+=65535){const r=n.subarray(e,e+65535>n.length-1?n.length-1:e+65535);t+=String.fromCharCode.apply(null,r)}const r=atob(t);e=new Uint8Array(r.length);for(let o=0;o<e.length;o++)e[o]=r.charCodeAt(o)}n=73===e[0]&&73===e[1]||77===e[0]&&77===e[1]}if(n){let n=e.buffer;"base64"!==o.contentTransferEncoding&&(n=new ArrayBuffer(t.length-i),e=new Uint8Array(n),e.set(t.subarray(i,t.length))),o.contentData=n}break}if((""===n.start||o.contentID===n.start)&&o.contentType){if(o.contentType.includes("text")||o.contentType.includes("xml")){o.contentData=String.fromCharCode.apply(null,t.subarray(i,t.length));break}o.contentData=t.subarray(i,t.length)}}return o}t.parse=e,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
