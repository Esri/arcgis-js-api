/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../geometry/SpatialReference","../../../geometry","./xmlUtilities","../rasterTransforms/PolynomialTransform"],(function(e,t,n,a,l){"use strict";function r(e,t){if(!e||!t)return null;const n=[];for(let a=0;a<e.length;a++)n.push(e[a]),n.push(t[a]);return n}function s(e){if(!e)return null;let n=Number(e);if(!isNaN(n)&&0!==n)return new t({wkid:n});const a=e.replace(/\]/g,"[").replace(/\"/g,"").split("[").map((e=>e.trim())).filter((e=>""!==e)),l=a[a.length-1].split(",");return"EPSG"!==l[0]||(n=Number(l[1]),isNaN(n)||0===n)?new t({wkt:e}):new t({wkid:n})}e.parsePAMInfo=function(e){var t;if("pamdataset"!==(null==e||null==(t=e.documentElement.tagName)?void 0:t.toLowerCase()))return{};const n={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};e.documentElement.childNodes.forEach((e=>{if(1===e.nodeType)if(a.isSameTagIgnoreNS(e,"SRS")){if(!n.spatialReference){const t=a.getElementValue(e);n.spatialReference=s(t)}}else if(a.isSameTagIgnoreNS(e,"Metadata"))if("xml:ESRI"===e.getAttribute("domain")){const{spatialReference:t,transform:i}=function(e){var t;const n=a.getElement(e,"GeodataXform"),i=s(a.getElementNumericValue(n,"SpatialReference/WKID")||a.getElementValue(n,"SpatialReference/WKT"));if("typens:PolynomialXform"!==n.getAttribute("xsi:type"))return{spatialReference:i,transform:null};const u=null!=(t=a.getElementNumericValue(n,"PolynomialOrder"))?t:1,o=a.getElementNumericValues(n,"CoeffX/Double"),m=a.getElementNumericValues(n,"CoeffY/Double"),c=a.getElementNumericValues(n,"InverseCoeffX/Double"),f=a.getElementNumericValues(n,"InverseCoeffY/Double"),g=r(o,m),d=r(c,f);return{spatialReference:i,transform:new l({polynomialOrder:u,forwardCoefficients:g,inverseCoefficients:d})}}(e);n.transform=i,n.spatialReference||(n.spatialReference=t)}else{a.getElements(e,"MDI").forEach((e=>n.metadata[e.getAttribute("key")]=a.getElementValue(e)))}else if(a.isSameTagIgnoreNS(e,"PAMRasterBand")){const t=function(e){var t;const n=a.getElementNumericValue(e,"NoDataValue"),l=a.getElement(e,"Histograms/HistItem"),r=a.getElementNumericValue(l,"HistMin"),s=a.getElementNumericValue(l,"HistMax"),i=a.getElementNumericValue(l,"BucketCount"),u=null==(t=a.getElementValue(l,"HistCounts"))?void 0:t.split("|").map((e=>Number(e)));let o,m,c,f;a.getElements(e,"Metadata/MDI").forEach((e=>{var t;const n=Number(null!=(t=e.textContent)?t:e.nodeValue);switch(e.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":o=n;break;case"STATISTICS_MAXIMUM":m=n;break;case"STATISTICS_MEAN":c=n;break;case"STATISTICS_STDDEV":f=n}}));const g=a.getElementNumericValue(e,"Metadata/SourceBandIndex");return{noDataValue:n,histogram:null!=u&&u.length&&null!=o&&null!=m?{min:r,max:s,size:i||u.length,counts:u}:null,sourceBandIndex:g,statistics:null!=o&&null!=m?{min:o,max:m,avg:c,stddev:f}:null}}(e);null!=t.sourceBandIndex&&null==n.rasterBands[t.sourceBandIndex]?n.rasterBands[t.sourceBandIndex]=t:n.rasterBands.push(t)}}));const i=n.rasterBands;if(i){const e=!!i[0].statistics;n.statistics=e?i.map((e=>e.statistics)):null;const t=!!i[0].histogram;n.histograms=t?i.map((e=>e.histogram)):null}return n},Object.defineProperty(e,"__esModule",{value:!0})}));
