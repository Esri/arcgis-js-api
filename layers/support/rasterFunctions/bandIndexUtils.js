/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock","./customBandIndexUtils","./pixelUtils"],(function(e,n,t,r,a,o){"use strict";const i=new n.JSONMap({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});function l(e,n){if(!o.isValidPixelBlock(e))return e;const{equation:i,method:l}=n,s=n.bandIndexes.map((e=>e-1)),{pixels:M,mask:S}=e;let I;switch(l){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":I=c(S,M[s[0]],M[s[1]]);break;case"ndwi":I=c(S,M[s[1]],M[s[0]]);break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":I=u(S,M[s[0]],M[s[1]]);break;case"ci-g":case"ci-re":I=f(S,M[s[0]],M[s[1]]);break;case"savi":I=d(S,M[s[0]],M[s[1]],s[2]+1);break;case"tsavi":I=h(S,M[s[0]],M[s[1]],s[2]+1,s[3]+1,s[4]+1);break;case"msavi":I=w(S,M[s[0]],M[s[1]]);break;case"gemi":I=g(S,M[s[0]],M[s[1]]);break;case"pvi":I=m(S,M[s[0]],M[s[1]],s[2]+1,s[3]+1);break;case"gvitm":I=b(S,[M[s[0]],M[s[1]],M[s[2]],M[s[3]],M[s[4]],M[s[5]]]);break;case"sultan":I=y(S,[M[s[0]],M[s[1]],M[s[2]],M[s[3]],M[s[4]],M[s[5]]]);break;case"vari":I=v(S,[M[s[0]],M[s[1]],M[s[2]]]);break;case"mtvi2":I=k(S,[M[s[0]],M[s[1]],M[s[2]]]);break;case"rtvi-core":I=A(S,[M[s[0]],M[s[1]],M[s[2]]]);break;case"evi":I=p(S,[M[s[0]],M[s[1]],M[s[2]]]);break;case"wndwi":I=F(S,[M[s[0]],M[s[1]],M[s[2]]],s[3]??.5);break;case"bai":I=x(S,M[s[0]],M[s[1]]);break;case"custom":I=a.calculateCustomBandIndex(S,M,i);break;default:return e}const q=t.isSome(S)?new Uint8Array(S.length):null;t.isSome(S)&&t.isSome(q)&&q.set(S);const B=new r({width:e.width,height:e.height,pixelType:"f32",pixels:I,mask:q});return B.updateStatistics(),B}function s(e,n,t,a){const{mask:o,pixels:i,width:l,height:s}=e,c=i[t],u=i[n],f=u.length,d=a?new Uint8Array(f):new Float32Array(f),h=a?100:1,w=a?100:0;for(let r=0;r<f;r++)if(null==o||o[r]){const e=c[r],n=u[r],t=e+n;t&&(d[r]=(e-n)/t*h+w)}const g=new r({width:l,height:s,mask:o,pixelType:a?"u8":"f32",pixels:[d]});return g.updateStatistics(),g}function c(e,n,t){const r=t.length,a=new Float32Array(r);for(let o=0;o<r;o++)if(null==e||e[o]){const e=n[o],r=t[o],i=e+r;i&&(a[o]=(e-r)/i)}return[a]}function u(e,n,t){const r=t.length,a=new Float32Array(r);for(let o=0;o<r;o++)if(null==e||e[o]){const e=n[o],r=t[o];r&&(a[o]=e/r)}return[a]}function f(e,n,t){const r=n.length,a=new Float32Array(r);for(let o=0;o<r;o++)if(null==e||e[o]){const e=n[o],r=t[o];r&&(a[o]=e/r-1)}return[a]}function d(e,n,t,r){const a=t.length,o=new Float32Array(a);for(let i=0;i<a;i++)if(null==e||e[i]){const e=t[i],a=n[i],l=a+e+r;l&&(o[i]=(a-e)/l*(1+r))}return[o]}function h(e,n,t,r,a,o){const i=t.length,l=new Float32Array(i),s=-a*r+o*(1+r*r);for(let c=0;c<i;c++)if(null==e||e[c]){const e=t[c],o=n[c],i=a*o+e+s;i&&(l[c]=r*(o-r*e-a)/i)}return[l]}function w(e,n,t){const r=t.length,a=new Float32Array(r);for(let o=0;o<r;o++)if(null==e||e[o]){const e=t[o],r=n[o];a[o]=.5*(2*(r+1)-Math.sqrt((2*r+1)**2-8*(r-e)))}return[a]}function g(e,n,t){const r=t.length,a=new Float32Array(r);for(let o=0;o<r;o++)if(null==e||e[o]){const e=t[o],r=n[o];if(1!==e){const n=(2*(r*r-e*e)+1.5*r+.5*e)/(r+e+.5);a[o]=n*(1-.25*n)-(e-.125)/(1-e)}}return[a]}function m(e,n,t,r,a){const o=t.length,i=new Float32Array(o),l=Math.sqrt(1+r*r);for(let s=0;s<o;s++)if(null==e||e[s]){const e=t[s],o=n[s];i[s]=(o-r*e-a)/l}return[i]}function b(e,n){const[t,r,a,o,i,l]=n,s=t.length,c=new Float32Array(s);for(let u=0;u<s;u++)(null==e||e[u])&&(c[u]=-.2848*t[u]-.2435*r[u]-.5436*a[u]+.7243*o[u]+.084*i[u]-1.18*l[u]);return[c]}function y(e,n){const[t,,r,a,o,i]=n,l=t.length,s=new Float32Array(l),c=new Float32Array(l),u=new Float32Array(l);for(let f=0;f<l;f++)(null==e||e[f])&&(s[f]=i[f]?o[f]/i[f]*100:0,c[f]=t[f]?o[f]/t[f]*100:0,u[f]=a[f]?r[f]/a[f]*(o[f]/a[f])*100:0);return[s,c,u]}function v(e,n){const[t,r,a]=n,o=t.length,i=new Float32Array(o);for(let l=0;l<o;l++)if(null==e||e[l])for(l=0;l<o;l++){const e=t[l],n=r[l],o=n+e-a[l];o&&(i[l]=(n-e)/o)}return[i]}function k(e,n){const[t,r,a]=n,o=t.length,i=new Float32Array(o);for(let l=0;l<o;l++)if(null==e||e[l])for(l=0;l<o;l++){const e=t[l],n=r[l],o=a[l],s=Math.sqrt((2*e+1)**2-6*e-5*Math.sqrt(n)-.5);i[l]=1.5*(1.2*(e-o)-2.5*(n-o))*s}return[i]}function A(e,n){const[t,r,a]=n,o=t.length,i=new Float32Array(o);for(let l=0;l<o;l++)if(null==e||e[l])for(l=0;l<o;l++){const e=t[l],n=r[l],o=a[l];i[l]=100*(e-n)-10*(e-o)}return[i]}function p(e,n){const[t,r,a]=n,o=t.length,i=new Float32Array(o);for(let l=0;l<o;l++)if(null==e||e[l])for(l=0;l<o;l++){const e=t[l],n=r[l],o=e+6*n-7.5*a[l]+1;o&&(i[l]=2.5*(e-n)/o)}return[i]}function F(e,n,t=.5){const[r,a,o]=n,i=a.length,l=new Float32Array(i);for(let s=0;s<i;s++)if(null==e||e[s])for(s=0;s<i;s++){const e=r[s],n=a[s],i=o[s],c=e+t*n+(1-t)*i;c&&(l[s]=(e-t*n-(1-t)*i)/c)}return[l]}function x(e,n,t){const r=t.length,a=new Float32Array(r);for(let o=0;o<r;o++)if(null==e||e[o])for(o=0;o<r;o++){const e=(.1-n[o])**2+(.06-t[o])**2;e&&(a[o]=1/e)}return[a]}e.bandIndexMethodMap=i,e.calculateBandIndex=l,e.calculateNDVI=s,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
