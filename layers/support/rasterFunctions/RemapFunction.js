/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/mathUtils","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/accessorSupport/decorators/subclass","../rasterFormats/pixelRangeUtils","./BaseRasterFunction","./pixelUtils","./RemapFunctionArguments"],(function(t,e,n,s,o,a,u,r,l,i,p,c){"use strict";let m=function(e){function o(){var t;return(t=e.apply(this,arguments)||this).functionName="Remap",t.functionArguments=null,t.rasterArgumentNames=["raster"],t.lookup=null,t}t._inheritsLoose(o,e);var a=o.prototype;return a._bindSourceRasters=function(){const t=this.sourceRasterInfos[0].clone(),{pixelType:e}=t;this.outputPixelType=this._getOutputPixelType(e),t.pixelType=this.outputPixelType,t.colormap=null,t.histograms=null,t.bandCount=1,t.attributeTable=null;const{statistics:n}=t,{allowUnmatched:o,outputValues:a,inputRanges:u,noDataRanges:r,isLastInputRangeInclusive:l}=this.functionArguments;if(s.isSome(n)&&n.length&&a?.length)if(o){const e=Math.min.apply(null,[...a,n[0].min]),s=Math.max.apply(null,[...a,n[0].max]);t.statistics=[{...n[0],min:e,max:s}]}else{let e=a[0],s=e;for(let t=0;t<a.length;t++)e=e>a[t]?a[t]:e,s=s>a[t]?s:a[t];t.statistics=[{...n[0],min:e,max:s}]}this.rasterInfo=t,this.lookup=o?null:p.createRemapLUT({srcPixelType:e,inputRanges:u,outputValues:a,noDataRanges:r,allowUnmatched:o,isLastInputRangeInclusive:l,outputPixelType:this.outputPixelType});return{success:!0,supportsGPU:(!a||a.length<=p.MAX_MAP_SIZE_GPU)&&(!r||r.length<=p.MAX_MAP_SIZE_GPU)}},a._processPixels=function(t){const e=t.pixelBlocks?.[0];if(s.isNone(e))return null;const{lookup:n,outputPixelType:o}=this;if(n){const t=p.lookupPixels(e,{lut:[n.lut],offset:n.offset,outputPixelType:o});return s.isSome(t)&&n.mask&&(t.mask=p.lookupBandValues(e.pixels[0],e.mask,n.mask,n.offset,"u8")),t}const{inputRanges:a,outputValues:u,noDataRanges:r,allowUnmatched:l,isLastInputRangeInclusive:i}=this.functionArguments;return p.remap(e,{inputRanges:a,outputValues:u,noDataRanges:r,outputPixelType:o,allowUnmatched:l,isLastInputRangeInclusive:i})},a._getWebGLParameters=function(){const{allowUnmatched:t,inputRanges:e,outputValues:s,noDataRanges:o,isLastInputRangeInclusive:a}=this.functionArguments,u=new Float32Array(3*p.MAX_MAP_SIZE_GPU),r=1e-5,i=s.length;if(e?.length){let t=0,o=0;for(let l=0;l<u.length;l+=3)u[l]=e[t++]??n.NUMBER_MAX_FLOAT32-1,u[l+1]=e[t++]??n.NUMBER_MAX_FLOAT32,u[l+2]=s[o++]??0,o<=i&&(l>0&&(u[l]-=r),(o<i||!a)&&(u[l+1]-=r))}const c=new Float32Array(2*p.MAX_MAP_SIZE_GPU);c.fill(n.NUMBER_MAX_FLOAT32),o?.length&&c.set(o);return{allowUnmatched:t,rangeMaps:u,noDataRanges:c,clampRange:l.getPixelValueRange(this.outputPixelType)}},o}(i);e.__decorate([o.property({json:{write:!0,name:"rasterFunction"}})],m.prototype,"functionName",void 0),e.__decorate([o.property({type:c,json:{write:!0,name:"rasterFunctionArguments"}})],m.prototype,"functionArguments",void 0),e.__decorate([o.property()],m.prototype,"rasterArgumentNames",void 0),e.__decorate([o.property({json:{write:!0}})],m.prototype,"lookup",void 0),m=e.__decorate([r.subclass("esri.layers.support.rasterFunctions.RemapFunction")],m);return m}));
