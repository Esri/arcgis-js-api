/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../core/has"],(function(e,t){"use strict";const n=new Set(["+","-","*","/","(",")"]);function l(e,t){(e=e.replace(/ /g,"")).startsWith("-")&&(e="0"+e),e.startsWith("+")&&(e=e.slice(1,e.length));const l=e.split(""),r=[],o=[];let s="";for(let a=0;a<l.length;a++){const e=l[a];if(n.has(e))""!==s&&o.push(parseFloat(s)),r.push(e),s="";else{if("b"===e.toLowerCase()){a++,s=e.concat(l[a]),o.push(t[parseInt(s[1],10)-1]),s="";continue}s=s.concat(e),a===l.length-1&&o.push(parseFloat(s))}}return{ops:r,nums:o}}function r(e,t,n,l){if("number"==typeof n&&"number"==typeof l)return n+l;let r;if("number"==typeof n){r=l.length;const e=n;(n=new Float32Array(r)).fill(e)}else if(r=n.length,l.constructor===Number){const e=l;(l=new Float32Array(r)).fill(e)}const o=new Float32Array(r);switch(t){case"+":for(let t=0;t<r;t++)(null==e||e[t])&&(o[t]=n[t]+l[t]);break;case"-":for(let t=0;t<r;t++)(null==e||e[t])&&(o[t]=n[t]-l[t]);break;case"*":for(let t=0;t<r;t++)(null==e||e[t])&&(o[t]=n[t]*l[t]);break;case"/":for(let t=0;t<r;t++)(null==e||e[t])&&l[t]&&(o[t]=n[t]/l[t]);break;case"(":case")":throw"encountered error with custom band index equation"}return o}function o(e,t){e.splice(t,1);let n=0,l=0;do{n=0,l=0;for(let t=0;t<e.length;t++)if("("===e[t])n=t;else if(")"===e[t]){l=t;break}l===n+1&&e.splice(n,2)}while(l===n+1);return e}function s(e){if(1===e.length)return{opIndex:0,numIndex:0};let t=0,n=0;for(let s=0;s<e.length;s++)if("("===e[s])t=s;else if(")"===e[s]){n=s;break}const l=0===n?e:e.slice(t+1,n);let r=-1;for(let s=0;s<l.length;s++)if("*"===l[s]||"/"===l[s]){r=s;break}if(r>-1)n>0&&(r+=t+1);else{for(let e=0;e<l.length;e++)if("+"===l[e]||"-"===l[e]){r=e;break}n>0&&(r+=t+1)}let o=0;for(let s=0;s<r;s++)"("===e[s]&&o++;return{opIndex:r,numIndex:r-o}}function a(e,t,n){let a,{ops:i,nums:u}=l(n,t);if(0===i.length){const e=1===u.length?u[0]:t[0];if(e instanceof Float32Array)return[e];const n=new Float32Array(t[0].length);return"number"==typeof e?n.fill(e):n.set(e),[n]}for(;i.length>0;){const{numIndex:t,opIndex:n}=s(i);if(a=r(e,i[n],u[t],u[t+1]),1===i.length)break;i=o(i,n),u.splice(t,2,a)}return[a]}e.calculateCustomBandIndex=a,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
