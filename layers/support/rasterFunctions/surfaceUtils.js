/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../PixelBlock"],(function(e,t){"use strict";const i=function(e){return e&&"esri.layers.support.PixelBlock"===e.declaredClass&&e.pixels&&e.pixels.length>0};function s(e){let{altitude:t,azimuth:i}=e;const{hillshadeType:s,pixelSizePower:l,pixelSizeFactor:n,scalingType:a,isGCS:o,resolution:r}=e,c="multi-directional"===s?2*e.zFactor:e.zFactor,{x:h,y:u}=r;let f=c/(8*h),d=c/(8*u);if(o&&c>.001&&(f/=111e3,d/=111e3),"adjusted"===a)if(o){const e=111e3*h,t=111e3*u;f=(c+e**l*n)/(8*e),d=(c+t**l*n)/(8*t)}else f=(c+h**l*n)/(8*h),d=(c+u**l*n)/(8*u);let p=(90-t)*Math.PI/180,x=Math.cos(p),M=(360-i+90)*Math.PI/180,m=Math.sin(p)*Math.cos(M),y=Math.sin(p)*Math.sin(M);const A=[315,270,225,360,180,0],w=[60,60,60,60,60,90],g=new Float32Array([3,5,3,2,1,4]),Z=g.reduce(((e,t)=>e+t)),P=g.map((e=>e/Z)),k="multi-directional"===s?A.length:1,b=new Float32Array(6),C=new Float32Array(6),F=new Float32Array(6);if("multi-directional"===s)for(let z=0;z<k;z++)t=w[z],i=A[z],p=(90-t)*Math.PI/180,x=Math.cos(p),M=(360-i+90)*Math.PI/180,m=Math.sin(p)*Math.cos(M),y=Math.sin(p)*Math.sin(M),b[z]=x,C[z]=m,F[z]=y;else b.fill(x),C.fill(m),F.fill(y);return{resolution:r,factor:[f,d],sinZcosA:m,sinZsinA:y,cosZ:x,sinZcosAs:C,sinZsinAs:F,cosZs:b,weights:P,hillshadeType:["traditional","multi-directional"].indexOf(s)}}function l(e,l){if(!i(e))return e;const{width:n,height:a,mask:o}=e,r=new Uint8Array(n*a);o&&r.set(o);const{factor:c,sinZcosA:h,sinZsinA:u,cosZ:f,sinZcosAs:d,sinZsinAs:p,cosZs:x,weights:M}=s(l),[m,y]=c,{hillshadeType:A}=l,w=e.pixels[0],g=new Uint8Array(n*a);let Z,P,k,b,C,F,z,T;const U=1;for(let t=U;t<a-U;t++){const e=t*n;for(let t=U;t<n-U;t++){if(o&&!o[e+t]){g[e+t]=0;continue}let i=8;if(o&&(i=o[e-n+t-1]+o[e-n+t]+o[e-n+t+1]+o[e+t-1]+o[e+t+1]+o[e+n+t-1]+o[e+n+t]+o[e+n+t+1],i<7)){g[e+t]=0,r[e+t]=0;continue}7===i?(Z=o[e-n+t-1]?w[e-n+t-1]:w[e+t],P=o[e-n+t]?w[e-n+t]:w[e+t],k=o[e-n+t+1]?w[e-n+t+1]:w[e+t],b=o[e+t-1]?w[e+t-1]:w[e+t],C=o[e+t+1]?w[e+t+1]:w[e+t],F=o[e+n+t-1]?w[e+n+t-1]:w[e+t],z=o[e+n+t]?w[e+n+t]:w[e+t],T=o[e+n+t+1]?w[e+n+t+1]:w[e+t]):(Z=w[e-n+t-1],P=w[e-n+t],k=w[e-n+t+1],b=w[e+t-1],C=w[e+t+1],F=w[e+n+t-1],z=w[e+n+t],T=w[e+n+t+1]);const s=(k+C+C+T-(Z+b+b+F))*m,l=(F+z+z+T-(Z+P+P+k))*y,a=Math.sqrt(1+s*s+l*l);let c=0;if("traditional"===A){let e=255*(f+u*l-h*s)/a;e<0&&(e=0),c=e}else{const e=p.length;for(let t=0;t<e;t++){let e=255*(x[t]+p[t]*l-d[t]*s)/a;e<0&&(e=0),c+=e*M[t]}}g[e+t]=255&c}}for(let t=0;t<a;t++)g[t*n]=g[t*n+1],g[(t+1)*n-1]=g[(t+1)*n-2];for(let t=1;t<n-1;t++)g[t]=g[t+n],g[t+(a-1)*n]=g[t+(a-2)*n];return new t({width:n,height:a,pixels:[g],mask:o?r:null,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function n(e,t,s,l){if(!i(e)||!i(t))return;const{min:n,max:a}=l,o=e.pixels[0],{pixels:r,mask:c}=t,h=r[0],u=255.00001/(a-n),f=new Uint8ClampedArray(h.length),d=new Uint8ClampedArray(h.length),p=new Uint8ClampedArray(h.length),x=s.length-1;for(let i=0;i<h.length;i++){if(c&&0===c[i])continue;const e=Math.floor((h[i]-n)*u),[t,l]=s[e<0?0:e>x?x:e],a=o[i],r=a*l,M=r*(1-Math.abs(t%2-1)),m=a-r;switch(Math.floor(t)){case 0:f[i]=r+m,d[i]=M+m,p[i]=m;break;case 1:f[i]=M+m,d[i]=r+m,p[i]=m;break;case 2:f[i]=m,d[i]=r+m,p[i]=M+m;break;case 3:f[i]=m,d[i]=M+m,p[i]=r+m;break;case 4:f[i]=M+m,d[i]=m,p[i]=r+m;break;case 5:case 6:f[i]=r+m,d[i]=m,p[i]=M+m}}e.pixels=[f,d,p],e.updateStatistics()}e.calculateHillshadeParams=s,e.hillshade=l,e.tintHillshade=n,Object.defineProperty(e,"__esModule",{value:!0})}));
