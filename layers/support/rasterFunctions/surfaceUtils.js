/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../PixelBlock"],(function(e,t){"use strict";const i=function(e){return e&&"esri.layers.support.PixelBlock"===e.declaredClass&&e.pixels&&e.pixels.length>0};function s(e){let{altitude:t,azimuth:i}=e;const{hillshadeType:s,pixelSizePower:l,pixelSizeFactor:a,scalingType:n,isGCS:o,resolution:r}=e,c="multi-directional"===s?2*e.zFactor:e.zFactor,{x:h,y:u}=r;let f=c/(8*h),d=c/(8*u);if(o&&c>.001&&(f/=111e3,d/=111e3),"adjusted"===n)if(o){const e=111e3*h,t=111e3*u;f=(c+Math.pow(e,l)*a)/(8*e),d=(c+Math.pow(t,l)*a)/(8*t)}else f=(c+Math.pow(h,l)*a)/(8*h),d=(c+Math.pow(u,l)*a)/(8*u);let p=(90-t)*Math.PI/180,M=Math.cos(p),w=(360-i+90)*Math.PI/180,x=Math.sin(p)*Math.cos(w),m=Math.sin(p)*Math.sin(w);const y=[315,270,225,360,180,0],A=[60,60,60,60,60,90],g=new Float32Array([3,5,3,2,1,4]),Z=g.reduce(((e,t)=>e+t)),P=g.map((e=>e/Z)),k="multi-directional"===s?y.length:1,b=new Float32Array(6),C=new Float32Array(6),F=new Float32Array(6);if("multi-directional"===s)for(let e=0;e<k;e++)t=A[e],i=y[e],p=(90-t)*Math.PI/180,M=Math.cos(p),w=(360-i+90)*Math.PI/180,x=Math.sin(p)*Math.cos(w),m=Math.sin(p)*Math.sin(w),b[e]=M,C[e]=x,F[e]=m;else b.fill(M),C.fill(x),F.fill(m);return{resolution:r,factor:[f,d],sinZcosA:x,sinZsinA:m,cosZ:M,sinZcosAs:C,sinZsinAs:F,cosZs:b,weights:P,hillshadeType:["traditional","multi-directional"].indexOf(s)}}e.calculateHillshadeParams=s,e.hillshade=function(e,l){if(!i(e))return e;const{width:a,height:n,mask:o}=e,r=new Uint8Array(a*n);o&&r.set(o);const{factor:c,sinZcosA:h,sinZsinA:u,cosZ:f,sinZcosAs:d,sinZsinAs:p,cosZs:M,weights:w}=s(l),[x,m]=c,{hillshadeType:y}=l,A=e.pixels[0],g=new Uint8Array(a*n);let Z,P,k,b,C,F,z,T;for(let e=1;e<n-1;e++){const t=e*a;for(let e=1;e<a-1;e++){if(o&&!o[t+e]){g[t+e]=0;continue}let i=8;if(o&&(i=o[t-a+e-1]+o[t-a+e]+o[t-a+e+1]+o[t+e-1]+o[t+e+1]+o[t+a+e-1]+o[t+a+e]+o[t+a+e+1],i<7)){g[t+e]=0,r[t+e]=0;continue}7===i?(Z=o[t-a+e-1]?A[t-a+e-1]:A[t+e],P=o[t-a+e]?A[t-a+e]:A[t+e],k=o[t-a+e+1]?A[t-a+e+1]:A[t+e],b=o[t+e-1]?A[t+e-1]:A[t+e],C=o[t+e+1]?A[t+e+1]:A[t+e],F=o[t+a+e-1]?A[t+a+e-1]:A[t+e],z=o[t+a+e]?A[t+a+e]:A[t+e],T=o[t+a+e+1]?A[t+a+e+1]:A[t+e]):(Z=A[t-a+e-1],P=A[t-a+e],k=A[t-a+e+1],b=A[t+e-1],C=A[t+e+1],F=A[t+a+e-1],z=A[t+a+e],T=A[t+a+e+1]);const s=(k+C+C+T-(Z+b+b+F))*x,l=(F+z+z+T-(Z+P+P+k))*m,n=Math.sqrt(1+s*s+l*l);let c=0;if("traditional"===y){let e=255*(f+u*l-h*s)/n;e<0&&(e=0),c=e}else{const e=p.length;for(let t=0;t<e;t++){let e=255*(M[t]+p[t]*l-d[t]*s)/n;e<0&&(e=0),c+=e*w[t]}}g[t+e]=255&c}}for(let e=0;e<n;e++)g[e*a]=g[e*a+1],g[(e+1)*a-1]=g[(e+1)*a-2];for(let e=1;e<a-1;e++)g[e]=g[e+a],g[e+(n-1)*a]=g[e+(n-2)*a];return new t({width:a,height:n,pixels:[g],mask:o?r:null,pixelType:"u8",validPixelCount:e.validPixelCount,statistics:[{minValue:0,maxValue:255}]})},e.tintHillshade=function(e,t,s,l){if(!i(e)||!i(t))return;const{min:a,max:n}=l,o=e.pixels[0],{pixels:r,mask:c}=t,h=r[0],u=255.00001/(n-a),f=new Uint8ClampedArray(h.length),d=new Uint8ClampedArray(h.length),p=new Uint8ClampedArray(h.length),M=s.length-1;for(let e=0;e<h.length;e++){if(c&&0===c[e])continue;const t=Math.floor((h[e]-a)*u),[i,l]=s[t<0?0:t>M?M:t],n=o[e],r=n*l,w=r*(1-Math.abs(i%2-1)),x=n-r;switch(Math.floor(i)){case 0:f[e]=r+x,d[e]=w+x,p[e]=x;break;case 1:f[e]=w+x,d[e]=r+x,p[e]=x;break;case 2:f[e]=x,d[e]=r+x,p[e]=w+x;break;case 3:f[e]=x,d[e]=w+x,p[e]=r+x;break;case 4:f[e]=w+x,d[e]=x,p[e]=r+x;break;case 5:case 6:f[e]=r+x,d[e]=x,p[e]=w+x}}e.pixels=[f,d,p],e.updateStatistics()},Object.defineProperty(e,"__esModule",{value:!0})}));
