/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/accessorSupport/decorators/subclass","./bandIndexUtils","./BaseRasterFunction","./ExtractBandFunctionArguments","./pixelUtils"],(function(t,e,n,s,r,o,i,a,u,c,p){"use strict";let l=function(e){function s(){var t;return(t=e.apply(this,arguments)||this).functionName="ExtractBand",t.functionArguments=null,t.rasterArgumentNames=["raster"],t}t._inheritsLoose(s,e);var r=s.prototype;return r._bindSourceRasters=function(){const{sourceRasterInfos:t}=this,e=t[0],{bandCount:s}=e,{bandIds:r,missingBandAction:o}=this.functionArguments;if(o===p.MissingBandAction.fail&&r.some((t=>t<0||t>=s)))return{success:!1,supportsGPU:!1,error:"extract-band-function: invalid bandIds"};this.outputPixelType=this._getOutputPixelType("f32");const i=e.clone();i.pixelType=this.outputPixelType,i.bandCount=r.length;const{statistics:a,histograms:u}=i;n.isSome(a)&&a.length&&(i.statistics=r.map((t=>a[t]||a[a.length-1]))),n.isSome(u)&&u.length&&(i.histograms=r.map((t=>u[t]||u[u.length-1]))),this.rasterInfo=i;return{success:!0,supportsGPU:i.bandCount<=3}},r._processPixels=function(t){const e=t.pixelBlocks?.[0];if(n.isNone(e))return null;const s=e.pixels.length,r=this.functionArguments.bandIds.map((t=>t>=s?s-1:t));return e.extractBands(r)},r._getWebGLParameters=function(){let t;if(this.isInputBandIdsSwizzled)t=this.swizzledBandSelection.length?this.swizzledBandSelection:[0,1,2];else{t=[...this.functionArguments.bandIds],0===t.length?t=[0,1,2]:t.length<3&&(t[1]=t[1]??t[0],t[2]=t[2]??t[1]);for(let e=0;e<3;e++)t[e]=Math.min(t[e],2)}return{bandIndexMat3:a.getBandMatrix3(t)}},r._getInputBandIds=function(t){const e=t.length;return this.functionArguments.bandIds.map((t=>t>=e?e-1:t)).map((e=>t[e]))},s}(u);e.__decorate([s.property({json:{write:!0,name:"rasterFunction"}})],l.prototype,"functionName",void 0),e.__decorate([s.property({type:c,json:{write:!0,name:"rasterFunctionArguments"}})],l.prototype,"functionArguments",void 0),e.__decorate([s.property()],l.prototype,"rasterArgumentNames",void 0),l=e.__decorate([i.subclass("esri.layers.support.rasterFunctions.ExtractBandFunction")],l);return l}));
