/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../PixelBlock"],(function(t,e,n){"use strict";function i(t){return e.isSome(t)&&"esri.layers.support.PixelBlock"===t.declaredClass&&t.pixels&&t.pixels.length>0}function o(t,e){if(null==e||!e.length||!i(t))return t;const o=t.pixels.length;return e&&e.some((t=>t>=o))||1===o&&1===e.length&&0===e[0]?t:o!==e.length||e.some(((t,e)=>t!==e))?new n({pixelType:t.pixelType,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:e.map((e=>t.pixels[e])),statistics:t.statistics&&e.map((e=>t.statistics[e]))}):t}function l(t){if(!t)return;const e=t.colormap;if(!e||0===e.length)return;const n=e.sort(((t,e)=>t[0]-e[0]));let i=0;n[0][0]<0&&(i=n[0][0]);const o=Math.max(256,n[n.length-1][0]-i+1),l=new Uint8Array(4*o),r=[];let s,a=0,f=0;const h=5===n[0].length;if(o>65536)return n.forEach((t=>{r[t[0]-i]=h?t.slice(1):t.slice(1).concat([255])})),{indexed2DColormap:r,offset:i,alphaSpecified:h};if(t.fillUnspecified)for(s=n[f],a=s[0]-i;a<o;a++)l[4*a]=s[1],l[4*a+1]=s[2],l[4*a+2]=s[3],l[4*a+3]=h?s[4]:255,a===s[0]-i&&(s=f===n.length-1?s:n[++f]);else for(a=0;a<n.length;a++)s=n[a],f=4*(s[0]-i),l[f]=s[1],l[f+1]=s[2],l[f+2]=s[3],l[f+3]=h?s[4]:255;return{indexedColormap:l,offset:i,alphaSpecified:h}}function r(t,e){if(!i(t))return t;if(!e&&(e.indexedColormap||e.indexed2DColormap))return t;const n=t.clone(),o=n.pixels;let l=n.mask;const r=n.width*n.height;if(1!==o.length)return t;const{indexedColormap:s,indexed2DColormap:a,offset:f,alphaSpecified:h}=e,c=s.length-1;let u=0;const m=o[0],p=new Uint8Array(m.length),x=new Uint8Array(m.length),d=new Uint8Array(m.length);let g,y=0;if(s)if(l)for(u=0;u<r;u++)l[u]&&(y=4*(m[u]-f),y<f||y>c?l[u]=0:(p[u]=s[y],x[u]=s[y+1],d[u]=s[y+2],l[u]=s[y+3]));else{for(l=new Uint8Array(r),u=0;u<r;u++)y=4*(m[u]-f),y<f||y>c?l[u]=0:(p[u]=s[y],x[u]=s[y+1],d[u]=s[y+2],l[u]=s[y+3]);n.mask=l}else if(l)for(u=0;u<r;u++)l[u]&&(g=a[m[u]],p[u]=g[0],x[u]=g[1],d[u]=g[2],l[u]=g[3]);else{for(l=new Uint8Array(r),u=0;u<r;u++)g=a[m[u]],p[u]=g[0],x[u]=g[1],d[u]=g[2],l[u]=g[3];n.mask=l}return n.pixels=[p,x,d],n.statistics=null,n.pixelType="u8",n.maskIsAlpha=h,n}function s(t){if(!i(t))return null;t.statistics||t.updateStatistics();const{pixels:e,mask:n,pixelType:o,statistics:l}=t,r=t.width*t.height,s=e.length;let a,f,h,c,u;const m=[],p=[];let x,d,g,y,w,M,k,A,U,C;const S=256;for(c=0;c<s;c++){if(x=new Uint32Array(S),g=e[c],"u8"===o)if(a=-.5,f=255.5,n)for(u=0;u<r;u++)n[u]&&x[g[u]]++;else for(u=0;u<r;u++)x[g[u]]++;else{if(a=l[c].minValue,f=l[c].maxValue,h=(f-a)/S,d=new Uint32Array(S+1),n)for(u=0;u<r;u++)n[u]&&d[Math.floor((g[u]-a)/h)]++;else for(u=0;u<r;u++)d[Math.floor((g[u]-a)/h)]++;for(u=0;u<255;u++)x[u]=d[u];x[255]=d[255]+d[256]}for(m.push({min:a,max:f,size:S,counts:x}),y=0,w=0,A=0,u=0;u<S;u++)y+=x[u],w+=u*x[u];for(U=w/y,u=0;u<S;u++)A+=x[u]*(u-U)**2;C=Math.sqrt(A/(y-1)),h=(f-a)/S,M=(U+.5)*h+a,k=C*h,p.push({min:a,max:f,avg:M,stddev:k})}return{statistics:p,histograms:m}}function a(t){const e=[];for(let n=0;n<t.length;n++){const{min:i,max:o,size:l,counts:r}=t[n];let s=0,a=0;for(let t=0;t<l;t++)s+=r[t],a+=t*r[t];const f=a/s;let h=0;for(let t=0;t<l;t++)h+=r[t]*(t-f)**2;const c=(o-i)/l,u=(f+.5)*c+i,m=Math.sqrt(h/(s-1))*c;e.push({min:i,max:o,avg:u,stddev:m})}return e}function f(t){const{minCutOff:e,maxCutOff:n,gamma:i,pixelType:o}=t,l=t.outMin||0,r=t.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(o))return null;const s=e.length;let a,f,c=0;"s8"===o?c=-127:"s16"===o&&(c=-32767);let u=256;["u16","s16"].indexOf(o)>-1&&(u=65536);const m=[],p=[],x=r-l;for(a=0;a<s;a++)p[a]=n[a]-e[a],m[a]=x/(n[a]-e[a]);const d=i&&i.length>=s,g=[];if(d)for(a=0;a<s;a++)i[a]>1?i[a]>2?g[a]=6.5+(i[a]-2)**2.5:g[a]=6.5+100*(2-i[a])**4:g[a]=1;let y;const w=[];let M,k,A;if(d)for(a=0;a<s;a++){for(A=[],f=0;f<u;f++)M=f+c,y=(M-e[a])/p[a],k=1,i[a]>1&&(k-=(1/x)**(y*g[a])),M<n[a]&&M>e[a]?A[f]=Math.floor(k*x*y**(1/i[a]))+l:M>=n[a]?A[f]=r:A[f]=l;w[a]=A}else for(a=0;a<s;a++){for(A=[],f=0;f<u;f++)M=f+c,M<=e[a]?A[f]=l:M>=n[a]?A[f]=r:A[f]=Math.floor((M-e[a])/p[a]*x)+l;w[a]=A}if(null!=t.contrastOffset){const e=h(t.contrastOffset,t.brightnessOffset);for(a=0;a<s;a++)for(A=w[a],f=0;f<u;f++)A[f]=e[A[f]]}return{lut:w,offset:c}}function h(t,e){const n=Math.min(Math.max(t,-100),100),i=Math.min(Math.max(e,-100),100),o=255,l=128;let r,s;const a=new Uint8Array(256);for(r=0;r<256;r++)n>0&&n<100?s=(200*r-100*o+2*o*i)/(2*(100-n))+l:n<=0&&n>-100?s=(200*r-100*o+2*o*i)*(100+n)/2e4+l:100===n?(s=200*r-100*o+(o+1)*(100-n)+2*o*i,s=s>0?o:0):-100===n&&(s=l),a[r]=s>o?o:s<0?0:s;return a}function c(t,e=256){e=Math.min(e,256);const{size:n,counts:i}=t,o=new Uint8Array(n),l=i.reduce(((t,n)=>t+n/e),0);let r=0,s=0,a=0,f=l;for(let h=0;h<n;h++)if(a+=i[h],!(h<n-1&&a+i[h+1]<f)){for(;r<e-1&&f<a;)r++,f+=l;for(let t=s;t<=h;t++)o[t]=r;s=h+1}for(let h=s;h<n;h++)o[h]=e-1;return o}function u(t,e){if(!i(t))return null;const n=t.clone(),{pixels:o,mask:l}=n,{minCutOff:r,maxCutOff:s,gamma:a}=e,f=e.outMin||0,h=e.outMax||255,c=n.width*n.height,u=o.length;let m,p,x,d,g;const y=h-f,w=[],M=[];for(m=0;m<u;m++)M[m]=s[m]-r[m],w[m]=y/(s[m]-r[m]);const k=a&&a.length>=u,A=[];if(k)for(m=0;m<u;m++)a[m]>1?a[m]>2?A[m]=6.5+(a[m]-2)**2.5:A[m]=6.5+100*(2-a[m])**4:A[m]=1;if(k)if(null!=l){for(p=0;p<c;p++)if(l[p])for(m=0;m<u;m++)x=o[m][p],g=(x-r[m])/M[m],d=1,a[m]>1&&(d-=(1/y)**(g*A[m])),x<s[m]&&x>r[m]?o[m][p]=Math.floor(d*y*g**(1/a[m]))+f:x>=s[m]?o[m][p]=h:o[m][p]=f}else for(p=0;p<c;p++)for(m=0;m<u;m++)x=o[m][p],g=(x-r[m])/M[m],d=1,a[m]>1&&(d-=(1/y)**(g*A[m])),x<s[m]&&x>r[m]?o[m][p]=Math.floor(d*y*g**(1/a[m]))+f:x>=s[m]?o[m][p]=h:o[m][p]=f;else if(null!=l){for(p=0;p<c;p++)if(l[p])for(m=0;m<u;m++)x=o[m][p],x<s[m]&&x>r[m]?o[m][p]=Math.floor((x-r[m])/M[m]*y)+f:x>=s[m]?o[m][p]=h:o[m][p]=f}else for(p=0;p<c;p++)for(m=0;m<u;m++)x=o[m][p],x<s[m]&&x>r[m]?o[m][p]=Math.floor((x-r[m])/M[m]*y)+f:x>=s[m]?o[m][p]=h:o[m][p]=f;return n.pixelType="u8",n.updateStatistics(),n}function m(t,e){if(!i(t))return null;const{pixels:o,mask:l}=t,r=t.width*t.height,s=o.length;let a=e.lut;const{offset:f}=e;let h,c;a&&1===a[0].length&&(a=o.map((()=>a)));const u=[];let m,p,x;if(f)if(null==l)for(h=0;h<s;h++){for(m=o[h],p=a[h],x=new Uint8Array(r),c=0;c<r;c++)x[c]=p[m[c]-f];u.push(x)}else for(h=0;h<s;h++){for(m=o[h],p=a[h],x=new Uint8Array(r),c=0;c<r;c++)l[c]&&(x[c]=p[m[c]-f]);u.push(x)}else if(null==l)for(h=0;h<s;h++){for(m=o[h],p=a[h],x=new Uint8Array(r),c=0;c<r;c++)x[c]=p[m[c]];u.push(x)}else for(h=0;h<s;h++){for(m=o[h],p=a[h],x=new Uint8Array(r),c=0;c<r;c++)l[c]&&(x[c]=p[m[c]]);u.push(x)}const d=new n({width:t.width,height:t.height,pixels:u,mask:l,pixelType:"u8"});return d.updateStatistics(),d}function p(t,e){if(!i(t))return null;const n=t.clone(),{pixels:o}=n,l=n.width*n.height,r=e.length,s=Math.floor(r/2),a=e[Math.floor(s)],f=o[0];let h,c,u,m,p,x,d=!1;const g=new Uint8Array(l),y=new Uint8Array(l),w=new Uint8Array(l);let M=n.mask;const k=4===e[0].mappedColor.length;for(M||(M=new Uint8Array(l),M.fill(k?255:1),n.mask=M),p=0;p<l;p++)if(M[p]){for(h=f[p],d=!1,x=s,c=a,u=0,m=r-1;m-u>1;){if(h===c.value){d=!0;break}h>c.value?u=x:m=x,x=Math.floor((u+m)/2),c=e[Math.floor(x)]}d||(h===e[u].value?(c=e[u],d=!0):h===e[m].value?(c=e[m],d=!0):h<e[u].value?(d=!1,c=null):h>e[u].value&&(h<e[m].value?(c=e[u],d=!0):m===r-1?(d=!1,c=null):(c=e[m],d=!0))),d?(g[p]=c.mappedColor[0],y[p]=c.mappedColor[1],w[p]=c.mappedColor[2],M[p]=c.mappedColor[3]):g[p]=y[p]=w[p]=M[p]=0}return n.pixels=[g,y,w],n.mask=M,n.pixelType="u8",n.maskIsAlpha=k,n}function x(t,e,n,i,o,l,r,s){return{xmin:o<=n*t?0:o<n*t+t?o-n*t:t,ymin:l<=i*e?0:l<i*e+e?l-i*e:e,xmax:o+r<=n*t?0:o+r<n*t+t?o+r-n*t:t,ymax:l+s<=i*e?0:l+s<i*e+e?l+s-i*e:e}}function d(t,n){if(!t||0===t.length)return null;const i=t.find((t=>t.pixelBlock));if(!i||e.isNone(i.pixelBlock))return null;const o=(i.extent.xmax-i.extent.xmin)/i.pixelBlock.width,l=(i.extent.ymax-i.extent.ymin)/i.pixelBlock.height,r=.01*Math.min(o,l),s=t.sort(((t,e)=>Math.abs(t.extent.ymax-e.extent.ymax)>r?e.extent.ymax-t.extent.ymax:Math.abs(t.extent.xmin-e.extent.xmin)>r?t.extent.xmin-e.extent.xmin:0)),a=Math.min.apply(null,s.map((t=>t.extent.xmin))),f=Math.min.apply(null,s.map((t=>t.extent.ymin))),h=Math.max.apply(null,s.map((t=>t.extent.xmax))),c=Math.max.apply(null,s.map((t=>t.extent.ymax))),u={x:Math.round((n.xmin-a)/o),y:Math.round((c-n.ymax)/l)},m={width:Math.round((h-a)/o),height:Math.round((c-f)/l)},p={width:Math.round((n.xmax-n.xmin)/o),height:Math.round((n.ymax-n.ymin)/l)};if(Math.round(m.width/i.pixelBlock.width)*Math.round(m.height/i.pixelBlock.height)!==s.length||u.x<0||u.y<0||m.width<p.width||m.height<p.height)return null;return{extent:n,pixelBlock:y(s.map((t=>t.pixelBlock)),m,{clipOffset:u,clipSize:p})}}function g(t,e,n,i,o,l){const{width:r,height:s}=n.block,{x:a,y:f}=n.offset,{width:h,height:c}=n.mosaic,u=x(r,s,i,o,a,f,h,c);let m=0,p=0;if(l){const t=l.hasGCSSShiftTransform?360:l.halfWorldWidth,e=r*l.resolutionX,n=l.startX+i*e,o=n+e;n<t&&o>t?p=l.rightPadding:n>=t&&(m=l.leftMargin-l.rightPadding,p=0)}if(u.xmax-=p,"number"!=typeof e)for(let x=u.ymin;x<u.ymax;x++){const n=(o*s+x-f)*h+(i*r-a)+m,l=x*r;for(let i=u.xmin;i<u.xmax;i++)t[n+i]=e[l+i]}else for(let x=u.ymin;x<u.ymax;x++){const n=(o*s+x-f)*h+(i*r-a)+m;for(let i=u.xmin;i<u.xmax;i++)t[n+i]=e}}function y(t,o,l={}){const{clipOffset:r,clipSize:s,alignmentInfo:a,blockWidths:f}=l;if(f)return w(t,o,{blockWidths:f});const h=t.find((t=>i(t)));if(e.isNone(h))return null;const c=s?s.width:o.width,u=s?s.height:o.height,m=h.width,p=h.height,x=o.width/m,d=o.height/p,y={offset:r||{x:0,y:0},mosaic:s||o,block:{width:m,height:p}},M=h.pixelType,k=n.getPixelArrayConstructor(M),A=h.pixels.length,U=[];let C,S;for(let e=0;e<A;e++){S=new k(c*u);for(let n=0;n<d;n++)for(let o=0;o<x;o++){const l=t[n*x+o];i(l)&&(C=l.pixels[e],g(S,C,y,o,n,a))}U.push(S)}let T;if(t.some((t=>e.isNone(t)||t.mask&&t.mask.length>0))){T=new Uint8Array(c*u);for(let n=0;n<d;n++)for(let i=0;i<x;i++){const o=t[n*x+i],l=e.isSome(o)?o.mask:null;g(T,l||(o?1:0),y,i,n,a)}}const B=new n({width:c,height:u,pixels:U,pixelType:M,mask:T});return B.updateStatistics(),B}function w(t,o,l){const r=t.find((t=>e.isSome(t)));if(!e.isSome(r))return null;const s=t.some((t=>!e.isSome(t)||!!t.mask)),{width:a,height:f}=o,h=s?new Uint8Array(a*f):null,{blockWidths:c}=l,u=[],m=r.getPlaneCount(),p=n.getPixelArrayConstructor(r.pixelType);if(s)for(let e=0,n=0;e<t.length;n+=c[e],e++){const o=t[e];if(!i(o))continue;const l=o.mask;for(let t=0;t<f;t++)for(let i=0;i<c[e];i++)h[t*a+i+n]=null==l?255:l[t*o.width+i]}for(let e=0;e<m;e++){const n=new p(a*f);for(let o=0,l=0;o<t.length;l+=c[o],o++){const r=t[o];if(!i(r))continue;const s=r.pixels[e];if(null!=s)for(let t=0;t<f;t++)for(let e=0;e<c[o];e++)n[t*a+e+l]=s[t*r.width+e]}u.push(n)}const x=new n({width:a,height:f,mask:h,pixels:u,pixelType:r.pixelType});return x.updateStatistics(),x}function M(t,e,n){if(!i(t))return null;const{width:o,height:l}=t,r=e.x,s=e.y,a=n.width+r,f=n.height+s;if(r<0||s<0||a>o||f>l)return t;if(0===r&&0===s&&a===o&&f===l)return t;t.mask||(t.mask=new Uint8Array(o*l));const h=t.mask;for(let i=0;i<l;i++){const t=i*o;for(let e=0;e<o;e++)h[t+e]=i<s||i>=f||e<r||e>=a?0:1}return t.updateStatistics(),t}function k(t){if(!i(t))return null;const e=t.clone(),{width:n,height:o,pixels:l,mask:r}=t,s=l[0],a=e.pixels[0];for(let i=2;i<o-1;i++){const t=new Map;for(let o=i-2;o<i+2;o++)for(let e=0;e<4;e++){const i=o*n+e;C(t,s[i],r?r[i]:1)}a[i*n]=A(t),a[i*n+1]=a[i*n+2]=a[i*n];let e=3;for(;e<n-1;e++){let o=(i-2)*n+e+1;C(t,s[o],r?r[o]:1),o=(i-1)*n+e+1,C(t,s[o],r?r[o]:1),o=i*n+e+1,C(t,s[o],r?r[o]:1),o=(i+1)*n+e+1,C(t,s[o],r?r[o]:1),o=(i-2)*n+e-3,U(t,s[o],r?r[o]:1),o=(i-1)*n+e-3,U(t,s[o],r?r[o]:1),o=i*n+e-3,U(t,s[o],r?r[o]:1),o=(i+1)*n+e-3,U(t,s[o],r?r[o]:1),a[i*n+e]=A(t)}a[i*n+e+1]=a[i*n+e]}for(let i=0;i<n;i++)a[i]=a[n+i]=a[2*n+i],a[(o-1)*n+i]=a[(o-2)*n+i];return e.updateStatistics(),e}function A(t){if(0===t.size)return 0;let e=0,n=-1,i=0;const o=t.keys();let l=o.next();for(;!l.done;)i=t.get(l.value),i>e&&(n=l.value,e=i),l=o.next();return n}function U(t,e,n){if(0===n)return;const i=t.get(e);1===i?t.delete(e):t.set(e,i-1)}function C(t,e,n){0!==n&&t.set(e,t.has(e)?t.get(e)+1:1)}function S(t,e,o){let{x:l,y:r}=e;const{width:s,height:a}=o;if(0===l&&0===r&&a===t.height&&s===t.width)return t;const{width:f,height:h}=t,c=Math.max(0,r),u=Math.max(0,l),m=Math.min(l+s,f),p=Math.min(r+a,h);if(m<0||p<0||!i(t))return null;l=Math.max(0,-l),r=Math.max(0,-r);const{pixels:x,mask:d}=t,g=s*a,y=x.length,w=[];for(let i=0;i<y;i++){const e=x[i],o=n.createEmptyBand(t.pixelType,g);for(let t=c;t<p;t++){const n=t*f;let i=(t+r-c)*s+l;for(let t=u;t<m;t++)o[i++]=e[n+t]}w.push(o)}const M=new Uint8Array(g);for(let n=c;n<p;n++){const t=n*f;let e=(n+r-c)*s+l;for(let n=u;n<m;n++)M[e++]=d?d[t+n]:1}const k=new n({width:o.width,height:o.height,pixelType:t.pixelType,pixels:w,mask:M});return k.updateStatistics(),k}function T(t,e=!0){if(!i(t))return null;const{pixels:o,width:l,height:r,mask:s,pixelType:a}=t,f=[],h=Math.round(l/2),c=Math.round(r/2),u=r-1,m=l-1;for(let i=0;i<o.length;i++){const t=o[i],s=n.createEmptyBand(a,h*c);let p=0;for(let n=0;n<r;n+=2)for(let i=0;i<l;i+=2){const o=t[n*l+i];if(e){const e=i===m?o:t[n*l+i+1],r=n===u?o:t[n*l+i+l],a=i===m?r:n===u?e:t[n*l+i+l+1];s[p++]=(o+e+r+a)/4}else s[p++]=o}f.push(s)}let p=null;if(s){p=new Uint8Array(h*c);let t=0;for(let n=0;n<r;n+=2)for(let i=0;i<l;i+=2){const o=s[n*l+i];if(e){const e=i===m?o:s[n*l+i+1],r=n===u?o:s[n*l+i+l],a=i===m?r:n===u?e:s[n*l+i+l+1];p[t++]=o*e*r*a?1:0}else p[t++]=o}}return new n({width:h,height:c,pixelType:a,pixels:f,mask:p})}function B(t,e,n){if(!i(t))return null;const{width:o,height:l}=e;let{width:r,height:s}=t;const a=new Map,f={x:0,y:0},h=null==n?1:1+n;let c=t;for(let i=0;i<h;i++){const t=Math.ceil(r/o),n=Math.ceil(s/l);for(let r=0;r<n;r++){f.y=r*l;for(let n=0;n<t;n++){f.x=n*o;const t=S(c,f,e);a.set(`${i}/${r}/${n}`,t)}}i<h-1&&(c=T(c)),r=Math.round(r/2),s=Math.round(s/2)}return a}function v(t,e,n,i,o=.5){const{width:l,height:r}=t,{width:s,height:a}=e,f=i.cols,h=i.rows,c=Math.ceil(s/f-.1/f),u=Math.ceil(a/h-.1/h);let m,p,x,d,g,y,w;const M=c*f,k=M*u*h,A=new Float32Array(k),U=new Float32Array(k),C=new Uint32Array(k),S=new Uint32Array(k);let T,B,v=0;for(let P=0;P<u;P++)for(let t=0;t<c;t++){m=12*(P*c+t),p=n[m],x=n[m+1],d=n[m+2],g=n[m+3],y=n[m+4],w=n[m+5];for(let e=0;e<h;e++){v=(P*h+e)*M+t*f,B=(e+.5)/h;for(let t=0;t<e;t++)T=(t+.5)/f,A[v+t]=(p*T+x*B+d)*l-o,U[v+t]=(g*T+y*B+w)*r-o,C[v+t]=Math.round(A[v+t]),S[v+t]=Math.round(U[v+t])}m+=6,p=n[m],x=n[m+1],d=n[m+2],g=n[m+3],y=n[m+4],w=n[m+5];for(let e=0;e<h;e++){v=(P*h+e)*M+t*f,B=(e+.5)/h;for(let t=e;t<f;t++)T=(t+.5)/f,A[v+t]=(p*T+x*B+d)*l-o,U[v+t]=(g*T+y*B+w)*r-o,C[v+t]=Math.round(A[v+t]),S[v+t]=Math.round(U[v+t])}}return{offsets_x:A,offsets_y:U,offsets_xi:C,offsets_yi:S,gridWidth:M}}function P(t,e){const{coefficients:n,spacing:i}=e,{offsets_x:o,offsets_y:l,gridWidth:r}=v(t,t,n,{rows:i[0],cols:i[1]},.5),{width:s,height:a}=t,f=new Float32Array(s*a),h=180/Math.PI;for(let c=0;c<a;c++)for(let t=0;t<s;t++){const e=c*r+t,n=0===c?e:e-r,i=c===a-1?e:e+r,u=o[n]-o[i],m=l[i]-l[n];if(isNaN(u)||isNaN(m))f[c*s+t]=90;else{let e=Math.atan2(m,u)*h;e=(360+e)%360,f[c*s+t]=e}}return f}function b(t,e,o,l,r="nearest"){if(!i(t))return null;"majority"===r&&(t=k(t));const{pixels:s,mask:a,pixelType:f}=t,h=t.width,c=t.height,u=n.getPixelArrayConstructor(f),m=s.length,{width:p,height:x}=e;let d=!1;for(let n=0;n<o.length;n+=3)-1===o[n]&&-1===o[n+1]&&-1===o[n+2]&&(d=!0);const{offsets_x:g,offsets_y:y,offsets_xi:w,offsets_yi:M,gridWidth:A}=v({width:h,height:c},e,o,l,"majority"===r?0:.5);let U;const C=(t,e,n)=>{const i=t instanceof Float32Array||t instanceof Float64Array?0:.5;for(let o=0;o<x;o++){U=o*A;for(let l=0;l<p;l++){if(g[U]<0||y[U]<0)t[o*p+l]=0;else if(n)t[o*p+l]=e[w[U]+M[U]*h];else{const n=Math.floor(g[U]),r=Math.floor(y[U]),s=Math.ceil(g[U]),f=Math.ceil(y[U]),c=g[U]-n,u=y[U]-r;if(!a||a[n+r*h]&&a[n+r*h]&&a[n+f*h]&&a[s+f*h]){const a=(1-c)*e[n+r*h]+c*e[s+r*h],m=(1-c)*e[n+f*h]+c*e[s+f*h];t[o*p+l]=(1-u)*a+u*m+i}else t[o*p+l]=e[w[U]+M[U]*h]}U++}}},S=[];let T;for(let n=0;n<m;n++)T=new u(p*x),C(T,s[n],"nearest"===r||"majority"===r),S.push(T);const B=new n({width:p,height:x,pixelType:f,pixels:S});if(a)B.mask=new Uint8Array(p*x),C(B.mask,a,!0);else if(d){B.mask=new Uint8Array(p*x);for(let t=0;t<p*x;t++)B.mask[t]=g[t]<0||y[t]<0?0:1}return B.updateStatistics(),B}t.approximateTransform=b,t.clip=S,t.colorize=r,t.createColormapLUT=l,t.createContrastBrightnessLUT=h,t.createHistogramEqualizationLUT=c,t.createStretchLUT=f,t.estimateStatisticsFromHistograms=a,t.estimateStatisticsHistograms=s,t.extractBands=o,t.getClipBounds=x,t.getLocalArithmeticNorthRotations=P,t.isValidPixelBlock=i,t.lookupPixels=m,t.mosaic=y,t.mosaicPixelData=d,t.remapColor=p,t.resampleByMajority=k,t.setValidBoundary=M,t.split=B,t.stretch=u,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
