/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../PixelBlock","../rasterFunctionConstants","../rasterFormats/pixelRangeUtils"],(function(t,e,n,r,o){"use strict";const a=new Map;function l(t){return a.get(t)}a.set(r.localTrigonometricOperation.acos,[0,Math.PI]),a.set(r.localTrigonometricOperation.asin,[-Math.PI/2,Math.PI/2]),a.set(r.localTrigonometricOperation.atan,[-Math.PI/2,Math.PI/2]),a.set(r.localTrigonometricOperation.cos,[-1,1]),a.set(r.localTrigonometricOperation.sin,[-1,1]),a.set(r.localLogicalOperation.booleanAnd,[0,1]),a.set(r.localLogicalOperation.booleanNot,[0,1]),a.set(r.localLogicalOperation.booleanOr,[0,1]),a.set(r.localLogicalOperation.booleanXOr,[0,1]),a.set(r.localLogicalOperation.equalTo,[0,1]),a.set(r.localLogicalOperation.notEqual,[0,1]),a.set(r.localLogicalOperation.greaterThan,[0,1]),a.set(r.localLogicalOperation.greaterThanEqual,[0,1]),a.set(r.localLogicalOperation.lessThan,[0,1]),a.set(r.localLogicalOperation.lessThanEqual,[0,1]),a.set(r.localLogicalOperation.isNull,[0,1]);const s=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];function c(t,n=!1){const r=t.map((t=>t.mask)),o=r.filter((t=>e.isSome(t))),a=t[0].pixels[0].length;if(0===o.length)return new Uint8Array(a).fill(255);const l=o[0],s=new Uint8Array(l);if(1===o.length)return s;if(!n){for(let t=1;t<o.length;t++){const e=o[t];for(let t=0;t<s.length;t++)s[t]&&(s[t]=e[t]?255:0)}return s}if(o.length!==r.length)return new Uint8Array(a).fill(255);for(let e=1;e<o.length;e++){const t=o[e];for(let e=0;e<s.length;e++)0===s[e]&&(s[e]=t[e]?255:0)}return s}function i(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]+a[n]);return s}function f(t,e,r){const[o]=t,a=o.length,l=n.createEmptyBand("f32",a);return l.set(o),l}function u(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]-a[n]);return s}function h(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]*a[n]);return s}function g(t,e,r){const[o]=t,a=o.length,l=n.createEmptyBand(r,a);for(let n=0;n<a;n++)e&&!e[n]||(l[n]=Math.sign(o[n])*Math.floor(Math.abs(o[n])));return l}function p(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]/a[n]);return s}function m(t,e,n){return p(t,e,"f32")}function d(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=Math.floor(o[n]/a[n]));return s}function y(t,e,o,a){const l=t[0],s=l.length,c=n.createEmptyBand(o,s);if(a===r.localTrigonometricOperation.atanh){for(let t=0;t<s;t++)if(e[t]){const n=l[t];Math.abs(n)>=1?e[t]=0:c[t]=Math.atanh(n)}return c}const i=a===r.localTrigonometricOperation.asin?Math.asin:Math.acos;for(let n=0;n<s;n++)if(e[n]){const t=l[n];Math.abs(t)>1?e[n]=0:c[n]=i(t)}return c}function M(t,e,r,o){const[a]=t,l=a.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o(a[n]));return s}function E(t,e,r,o){const[a,l]=t,s=a.length,c=n.createEmptyBand(r,s);for(let n=0;n<s;n++)e&&!e[n]||(c[n]=o(a[n],l[n]));return c}function B(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]&a[n]);return s}function O(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]<<a[n]);return s}function w(t,e,r){const[o]=t,a=o.length,l=n.createEmptyBand(r,a);for(let n=0;n<a;n++)e&&!e[n]||(l[n]=~o[n]);return l}function T(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]|a[n]);return s}function b(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]>>a[n]);return s}function L(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]^a[n]);return s}function x(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]&&a[n]?1:0);return s}function A(t,e,r){const[o]=t,a=o.length,l=n.createEmptyBand(r,a);for(let n=0;n<a;n++)e&&!e[n]||(l[n]=o[n]?0:1);return l}function P(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]||a[n]?1:0);return s}function k(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=(o[n]?1:0)^(a[n]?1:0));return s}function N(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]===a[n]?1:0);return s}function q(t,e,r,o){const[a]=t,l=a.length,s=n.createEmptyBand(r,l),c=o===Math.E;for(let n=0;n<l;n++)e&&!e[n]||(s[n]=c?Math.exp(a[n]):o**a[n]);return s}function U(t,e,n){return q(t,e,n,10)}function I(t,e,n){return q(t,e,n,2)}function F(t,e,n){return q(t,e,n,Math.E)}function S(t,e,r,o){const[a]=t,l=a.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(a[n]<=0?e[n]=0:s[n]=o(a[n]));return s}function C(t,e,n){return S(t,e,n,Math.log10)}function z(t,e,n){return S(t,e,n,Math.log2)}function R(t,e,n){return S(t,e,n,Math.log)}function W(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]>a[n]?1:0);return s}function j(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]>=a[n]?1:0);return s}function v(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]<a[n]?1:0);return s}function D(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]<=a[n]?1:0);return s}function V(t,e,r){const[o]=t,a=o.length,l=n.createEmptyBand(r,a);if(!e)return l;for(let n=0;n<a;n++)l[n]=e[n]?0:1;return l}function X(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]%a[n]);return s}function G(t,e,r){const[o]=t,a=o.length,l=n.createEmptyBand(r,a);for(let n=0;n<a;n++)e&&!e[n]||(l[n]=-o[n]);return l}function H(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e&&!e[n]||(s[n]=o[n]===a[n]?0:1);return s}function J(t,e,r){const[o,a]=t,l=o.length,s=n.createEmptyBand(r,l),c=new Uint8Array(l);for(let n=0;n<l;n++)null!=e&&!e[n]||0!==o[n]||(s[n]=a[n],c[n]=255);return{band:s,mask:c}}function K(t,e,r){const[o,a,l]=t,s=o.length,c=n.createEmptyBand(r,s);for(let n=0;n<s;n++)e&&!e[n]||(c[n]=o[n]?a[n]:l[n]);return c}function Q(t,e,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)if(!e||e[n]){let e=a[n];for(let r=1;r<o;r++){const o=t[r][n];e<o&&(e=o)}s[n]=e}return s}function Y(t,e,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)if(!e||e[n]){let e=a[n];for(let r=1;r<o;r++){const o=t[r][n];e>o&&(e=o)}s[n]=e}return s}function Z(t,e,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)if(!e||e[n]){let e=a[n],r=e;for(let a=1;a<o;a++){const o=t[a][n];r<o?r=o:e>o&&(e=o)}s[n]=r-e}return s}function $(t,e,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)if(!e||e[n]){let e=0;for(let r=0;r<o;r++)e+=t[r][n];s[n]=e/o}return s}function _(t,e,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)if(!e||e[n])for(let e=0;e<o;e++){const r=t[e];s[n]+=r[n]}return s}function tt(t,e,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)if(!e||e[n]){const e=new Float32Array(o);let r=0;for(let l=0;l<o;l++){const o=t[l];r+=o[n],e[l]=o[n]}r/=o;let a=0;for(let t=0;t<o;t++)a+=(e[t]-r)**2;s[n]=Math.sqrt(a/o)}return s}function et(t,e,r){const o=t.length;if(o<2)return t[0];const a=Math.floor(o/2),[l]=t,s=l.length,c=n.createEmptyBand(r,s),i=new Float32Array(o),f=o%2==1;for(let n=0;n<s;n++)if(!e||e[n]){for(let e=0;e<o;e++)i[e]=t[e][n];i.sort(),c[n]=f?i[a]:(i[a]+i[a-1])/2}return c}function nt(t,e,r){const[o,a]=t;if(null==a)return o;const l=o.length,s=n.createEmptyBand(r,l);for(let n=0;n<l;n++)e[n]&&(o[n]===a[n]?s[n]=o[n]:e[n]=0);return s}function rt(t,e,r){const o=t.length;if(o<=2)return nt(t,e,r);const a=t[0].length,l=n.createEmptyBand(r,a),s=new Map;for(let n=0;n<a;n++)if(!e||e[n]){let e;s.clear();for(let l=0;l<o;l++)e=t[l][n],s.set(e,s.has(e)?s.get(e)+1:1);let r=0,a=0;for(const t of s.keys())r=s.get(t),r>a&&(a=r,e=t);l[n]=e}return l}function ot(t,e,r){const o=t.length;if(o<=2)return nt(t,e,r);const a=t[0].length,l=n.createEmptyBand(r,a),s=new Map;for(let n=0;n<a;n++)if(!e||e[n]){let e;s.clear();for(let l=0;l<o;l++)e=t[l][n],s.set(e,s.has(e)?s.get(e)+1:1);let r=0,a=t.length;for(const t of s.keys())r=s.get(t),r<a&&(a=r,e=t);l[n]=e}return l}function at(t,e,r){const o=t.length;if(o<2)return t[0];const[a]=t,l=a.length,s=n.createEmptyBand(r,l),c=new Set;for(let n=0;n<l;n++)if(!e||e[n]){let e;c.clear();for(let r=0;r<o;r++)e=t[r][n],c.add(e);s[n]=c.size}return s}const lt=new Map,st=new Map,ct=new Map,it=new Map;function ft(){lt.size||(lt.set(4,Math.sqrt),lt.set(6,Math.acos),lt.set(7,Math.asin),lt.set(8,Math.atan),lt.set(9,Math.atanh),lt.set(10,Math.abs),lt.set(21,Math.cos),lt.set(22,Math.cosh),lt.set(48,Math.floor),lt.set(49,Math.ceil),lt.set(51,Math.sin),lt.set(52,Math.sinh),lt.set(56,Math.tan),lt.set(57,Math.tanh),lt.set(59,Math.acosh),lt.set(60,Math.asinh),lt.set(65,Math.floor),st.set(5,Math.pow),st.set(61,Math.atan2),ct.set(1,i),ct.set(2,u),ct.set(3,h),ct.set(11,B),ct.set(12,O),ct.set(12,O),ct.set(13,w),ct.set(14,T),ct.set(15,b),ct.set(16,L),ct.set(17,x),ct.set(18,A),ct.set(19,P),ct.set(20,k),ct.set(23,p),ct.set(24,N),ct.set(25,F),ct.set(26,U),ct.set(27,I),ct.set(28,W),ct.set(29,j),ct.set(30,g),ct.set(31,V),ct.set(32,f),ct.set(33,v),ct.set(34,D),ct.set(35,R),ct.set(36,C),ct.set(37,z),ct.set(44,X),ct.set(45,G),ct.set(46,H),ct.set(64,m),ct.set(65,d),ct.set(76,K),ct.set(78,K),it.set(38,rt),it.set(39,Q),it.set(40,$),it.set(41,et),it.set(42,Y),it.set(43,ot),it.set(47,Z),it.set(54,tt),it.set(55,_),it.set(58,at),it.set(66,rt),it.set(67,Q),it.set(68,$),it.set(69,et),it.set(70,Y),it.set(71,ot),it.set(72,Z),it.set(73,tt),it.set(74,_),it.set(75,at))}function ut(t,e,n,r){let[a,l]=o.getPixelValueRange(n);const s=n.startsWith("u")||n.startsWith("s");s&&(a-=1e-5,l+=1e-5);for(let o=0;o<e.length;o++)if(e[o]){const n=t[o];isNaN(n)||n<a||n>l?e[o]=0:r[o]=s?Math.round(n):n}}function ht(t,e,o={}){ft();let l=c(t,e>=66&&e<=75);const{outputPixelType:s="f32"}=o,i=!it.has(e)||o.processAsMultiband,f=i?t[0].pixels.length:1,u=[];for(let c=0;c<f;c++){const o=it.has(e)&&!i?t.flatMap((t=>t.pixels)):t.map((t=>t.pixels[c]));let f,h=!0;if(e===r.localConditionalOperation.setNull){const t=J(o,l,s);f=t.band,l=t.mask,h=!1}else if(ct.has(e)){f=ct.get(e)(o,l,"f64")}else if(lt.has(e))f=e===r.localTrigonometricOperation.asin||e===r.localTrigonometricOperation.acos||e===r.localTrigonometricOperation.atanh?y(o,l,"f64",e):M(o,l,"f64",lt.get(e));else if(st.has(e))f=E(o,l,"f64",st.get(e));else if(it.has(e)){f=it.get(e)(o,l,"f64")}else f=o[0],h=!1;if(h&&e!==r.localLogicalOperation.isNull&&!a.has(e)){const t=n.createEmptyBand(s,f.length);l||(l=new Uint8Array(f.length).fill(255)),ut(f,l,s,t),f=t}u.push(f)}const h=t[0];return new n({width:h.width,height:h.height,pixelType:s,mask:e===r.localLogicalOperation.isNull?null:l,pixels:u})}t.getOutputDomain=l,t.local=ht,t.operandsCount=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
