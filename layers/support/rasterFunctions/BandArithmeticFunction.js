/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/accessorSupport/decorators/subclass","./BandArithmeticFunctionArguments","./bandIndexUtils","./BaseRasterFunction"],(function(e,t,n,s,a,r,i,c,o,u){"use strict";const d=new Set(["vari","mtvi2","rtvi-core","evi"]);let p=function(t){function s(){var e;return(e=t.apply(this,arguments)||this).functionName="BandArithmetic",e.functionArguments=null,e.rasterArgumentNames=["raster"],e}e._inheritsLoose(s,t);var a=s.prototype;return a._bindSourceRasters=function(){this.outputPixelType=this._getOutputPixelType("f32");const e=this.sourceRasterInfos[0],t=e.clone();t.pixelType=this.outputPixelType,t.statistics=null,t.histograms=null,t.bandCount="sultan"===this.functionArguments.method?e.bandCount:1,this.rasterInfo=t;return{success:!0,supportsGPU:!["custom","gvitm","sultan"].includes(this.functionArguments.method)}},a._processPixels=function(e){const t=e.pixelBlocks?.[0];if(n.isNone(t))return t;const{method:s,bandIndexes:a}=this.functionArguments,r=a.split(" ").map((e=>parseFloat(e)));return o.calculateBandIndex(t,{method:s,bandIndexes:r,equation:a})},a._getWebGLParameters=function(){const e=this.functionArguments.bandIndexes.split(" ").map((e=>parseFloat(e)-1));2===e.length&&e.push(0);const t=this.isInputBandIdsSwizzled?[0,1,2]:e;let n,s;const a=new Float32Array(3),{method:r}=this.functionArguments;switch(r){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":n=o.getBandMatrix3([t[0],t[1],0]),s="ndxi";break;case"ndwi":n=o.getBandMatrix3([t[1],t[0],0]),s="ndxi";break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":n=o.getBandMatrix3([t[0],t[1],0]),s="sr";break;case"ci-g":case"ci-re":n=o.getBandMatrix3([t[0],t[1],0]),s="ci";break;case"savi":n=o.getBandMatrix3([t[0],t[1],0]),s="savi",a[0]=e[2]+1;break;case"tsavi":n=o.getBandMatrix3([t[0],t[1],0]),s="tsavi",a[0]=e[2]+1,a[1]=e[3]+1,a[2]=e[4]+1;break;case"msavi":n=o.getBandMatrix3([t[0],t[1],0]),s="msavi";break;case"gemi":n=o.getBandMatrix3([t[0],t[1],0]),s="gemi";break;case"pvi":n=o.getBandMatrix3([t[0],t[1],0]),s="tsavi",a[0]=e[2]+1,a[1]=e[3]+1;break;case"vari":n=o.getBandMatrix3([t[0],t[1],t[2]]),s="vari";break;case"mtvi2":n=o.getBandMatrix3([t[0],t[1],t[2]]),s="mtvi2";break;case"rtvi-core":n=o.getBandMatrix3([t[0],t[1],t[2]]),s="rtvicore";break;case"evi":n=o.getBandMatrix3([t[0],t[1],t[2]]),s="evi";break;case"wndwi":n=o.getBandMatrix3([t[0],t[1],0]),s="wndwi",a[0]=e[3]?e[3]+1:.5;break;case"bai":n=o.getBandMatrix3([t[1],t[0],0]),s="bai";break;default:n=o.getBandMatrix3([0,1,2]),s="custom"}return{bandIndexMat3:n,indexType:s,adjustments:a}},a._getInputBandIds=function(e){if("custom"===this.functionArguments.method)return e;const t=this.functionArguments.bandIndexes.split(" ").map((e=>parseFloat(e)-1)),n=e.length,s=t.map((e=>e>=n?n-1:e)),a=d.has(this.functionArguments.method)?3:2,r=s.slice(0,a).map((t=>e[t]));return 2===r.length&&r.push(0),r},s}(u);t.__decorate([s.property({json:{write:!0,name:"rasterFunction"}})],p.prototype,"functionName",void 0),t.__decorate([s.property({type:c,json:{write:!0,name:"rasterFunctionArguments"}})],p.prototype,"functionArguments",void 0),t.__decorate([s.property()],p.prototype,"rasterArgumentNames",void 0),p=t.__decorate([i.subclass("esri.layers.support.rasterFunctions.BandArithmeticFunction")],p);return p}));
