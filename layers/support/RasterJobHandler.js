/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/Error","../../core/maybe","../../core/workers/workers","./PixelBlock"],(function(e,r,n,t,o){"use strict";let i=function(){function i(){this._workerThread=null,this._destroyed=!1}var a=i.prototype;return a.initialize=function(){var r=e._asyncToGenerator((function*(){const e=yield t.open("RasterWorker");this._destroyed?e.close():this._workerThread=e}));function n(){return r.apply(this,arguments)}return n}(),a.destroy=function(){this._destroyed=!0,this._workerThread&&(this._workerThread.close(),this._workerThread=null)},a.convertVectorFieldData=function(){var n=e._asyncToGenerator((function*(e,n){if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");const t=yield this._workerThread.invoke("convertVectorFieldData",{pixelBlock:e.pixelBlock.toJSON(),type:e.dataType},n);return t?new o(t):null}));function t(e,r){return n.apply(this,arguments)}return t}(),a.decode=function(){var n=e._asyncToGenerator((function*(e,n){if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");const t=yield this._workerThread.invoke("decode",e,n);return t?new o(t):null}));function t(e,r){return n.apply(this,arguments)}return t}(),a.symbolize=function(){var t=e._asyncToGenerator((function*(e,t){if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");const i={extent:e.extent&&e.extent.toJSON(),pixelBlock:n.isSome(e.pixelBlock)&&e.pixelBlock.toJSON(),simpleStretchParams:e.simpleStretchParams,bandIds:e.bandIds},a=yield this._workerThread.invoke("symbolize",i,t);return a?new o(a):null}));function i(e,r){return t.apply(this,arguments)}return i}(),a.updateSymbolizer=function(){var n=e._asyncToGenerator((function*(e,n){var t;if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");const o=null==e||null==(t=e.rendererJSON)?void 0:t.histograms;yield Promise.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:e.toJSON(),histograms:o},n))}));function t(e,r){return n.apply(this,arguments)}return t}(),a.stretch=function(){var n=e._asyncToGenerator((function*(e,n){if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");if(null==e||!e.pixelBlock)return null;const t={srcPixelBlock:e.pixelBlock.toJSON(),stretchParams:e.stretchParams},i=yield this._workerThread.invoke("stretch",t,n);return i?new o(i):null}));function t(e,r){return n.apply(this,arguments)}return t}(),a.split=function(){var n=e._asyncToGenerator((function*(e,n){if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");if(null==e||!e.pixelBlock)return null;const t={srcPixelBlock:e.pixelBlock.toJSON(),tileSize:e.tileSize,maximumPyramidLevel:e.maximumPyramidLevel},i=yield this._workerThread.invoke("split",t,n);return i&&i.forEach(((e,r)=>{i.set(r,e?o.fromJSON(e):null)})),Promise.resolve(i)}));function t(e,r){return n.apply(this,arguments)}return t}(),a.estimateStatisticsHistograms=function(){var n=e._asyncToGenerator((function*(e,n){if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");if(null==e||!e.pixelBlock)return null;const t={srcPixelBlock:e.pixelBlock.toJSON()},o=yield this._workerThread.invoke("estimateStatisticsHistograms",t,n);return Promise.resolve(o)}));function t(e,r){return n.apply(this,arguments)}return t}(),a.mosaicAndTransform=function(){var t=e._asyncToGenerator((function*(e,t){var i;if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");if(null==e||null==(i=e.srcPixelBlocks)||!i.length)return null;const a={...e,srcPixelBlocks:e.srcPixelBlocks.map((e=>n.isSome(e)?e.toJSON():null))},s=yield this._workerThread.invoke("mosaicAndTransform",a,t);return s?new o(s):null}));function i(e,r){return t.apply(this,arguments)}return i}(),a.createStreamlinesMesh=function(){var n=e._asyncToGenerator((function*(e,n){if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");const t={buffer:e.flowData.data.buffer,width:e.flowData.width,height:e.flowData.height},o=e.rendererSettings,i=yield this._workerThread.invoke("createStreamlinesMesh",{flowData:t,rendererSettings:o},{...n,transferList:[t.buffer]});return{vertexData:new Float32Array(i.vertexBuffer),indexData:new Uint32Array(i.indexBuffer)}}));function t(e,r){return n.apply(this,arguments)}return t}(),a.getProjectionOffsetGrid=function(e,t){if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");const o=n.isSome(e.datumTransformation)?e.datumTransformation.steps.map((e=>({wkid:e.wkid,wkt:e.wkt,isInverse:e.isInverse}))):null,i=n.isSome(e.rasterTransform)?e.rasterTransform.toJSON():null,a={projectedExtent:e.projectedExtent.toJSON(),srcBufferExtent:e.srcBufferExtent.toJSON(),pixelSize:e.pixelSize,hasWrapAround:e.hasWrapAround,spacing:e.spacing,datumTransformationSteps:o,rasterTransform:i,isAdaptive:e.isAdaptive};return this._workerThread.invoke("getProjectionOffsetGrid",a,t)},i}();return i}));
