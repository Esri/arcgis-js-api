/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../geometry","../../core/maybe","../../geometry/support/GeographicTransformation","./PixelBlock","./rasterFormats/RasterCodec","./rasterFunctions/pixelUtils","./rasterFunctions/rasterFunctionHelper","./rasterFunctions/rasterProjectionHelper","./rasterFunctions/stretchUtils","./rasterFunctions/vectorFieldUtils","./rasterTransforms/utils","../../renderers/support/RasterSymbolizer","../../views/2d/engine/flow/dataUtils","../../geometry/Extent"],(function(e,t,r,n,o,s,i,a,c,l,u,f,m,p,d){"use strict";let y=function(){function t(){}var y=t.prototype;return y.convertVectorFieldData=function(e){const t=o.fromJSON(e.pixelBlock),n=u.convertVectorFieldData(t,e.type);return Promise.resolve(r.isSome(n)?n.toJSON():null)},y.decode=function(){var t=e._asyncToGenerator((function*(e){const t=yield s.decode(e.data,e.options);return t&&t.toJSON()}));function r(e){return t.apply(this,arguments)}return r}(),y.symbolize=function(e){e.pixelBlock=o.fromJSON(e.pixelBlock),e.extent=e.extent?d.fromJSON(e.extent):null;const t=this.symbolizer.symbolize(e);return Promise.resolve(r.isSome(t)?t.toJSON():null)},y.updateSymbolizer=function(){var t=e._asyncToGenerator((function*(e){this.symbolizer=m.fromJSON(e.symbolizerJSON),e.histograms&&"rasterStretch"===this.symbolizer?.rendererJSON.type&&(this.symbolizer.rendererJSON.histograms=e.histograms)}));function r(e){return t.apply(this,arguments)}return r}(),y.updateRasterFunction=function(){var t=e._asyncToGenerator((function*(e){this.rasterFunction=a.create(e.rasterFunctionJSON)}));function r(e){return t.apply(this,arguments)}return r}(),y.process=function(){var t=e._asyncToGenerator((function*(e){const t=this.rasterFunction.process({extent:d.fromJSON(e.extent),primaryPixelBlocks:e.primaryPixelBlocks.map((e=>r.isSome(e)?o.fromJSON(e):null)),primaryRasterIds:e.primaryRasterIds});return r.isSome(t)?t.toJSON():null}));function n(e){return t.apply(this,arguments)}return n}(),y.stretch=function(e){const t=this.symbolizer.simpleStretch(o.fromJSON(e.srcPixelBlock),e.stretchParams);return Promise.resolve(r.isSome(t)&&t.toJSON())},y.estimateStatisticsHistograms=function(e){const t=l.estimateStatisticsHistograms(o.fromJSON(e.srcPixelBlock));return Promise.resolve(t)},y.split=function(e){const t=i.split(o.fromJSON(e.srcPixelBlock),e.tileSize,e.maximumPyramidLevel);return t&&t.forEach(((e,r)=>{t.set(r,e?.toJSON())})),Promise.resolve(t)},y.mosaicAndTransform=function(){var t=e._asyncToGenerator((function*(e){const t=e.srcPixelBlocks.map((e=>e?new o(e):null)),n=i.mosaic(t,e.srcMosaicSize,{blockWidths:e.blockWidths,alignmentInfo:e.alignmentInfo,clipOffset:e.clipOffset,clipSize:e.clipSize});let s,a=n;return e.coefs&&(a=i.approximateTransform(n,e.destDimension,e.coefs,e.sampleSpacing,e.interpolation)),e.projectDirections&&e.gcsGrid&&(s=i.getLocalArithmeticNorthRotations(e.destDimension,e.gcsGrid),a=r.unwrap(u.convertToLocalDirections(a,e.isUV?"vector-uv":"vector-magdir",s))),{pixelBlock:a?.toJSON(),localNorthDirections:s}}));function n(e){return t.apply(this,arguments)}return n}(),y.createFlowMesh=function(){var t=e._asyncToGenerator((function*(e,t){const r={data:new Float32Array(e.flowData.buffer),mask:new Uint8Array(e.flowData.maskBuffer),width:e.flowData.width,height:e.flowData.height},{vertexData:n,indexData:o}=yield p.createFlowMesh(e.meshType,e.simulationSettings,r,t.signal);return{result:{vertexBuffer:n.buffer,indexBuffer:o.buffer},transferList:[n.buffer,o.buffer]}}));function r(e,r){return t.apply(this,arguments)}return r}(),y.getProjectionOffsetGrid=function(){var t=e._asyncToGenerator((function*(e){const t=d.fromJSON(e.projectedExtent),r=d.fromJSON(e.srcBufferExtent);let o=null;e.datumTransformationSteps&&(o=new n({steps:e.datumTransformationSteps})),(e.includeGCSGrid||c.requirePE(t.spatialReference,r.spatialReference,o))&&(yield c.load());const s=e.rasterTransform?f.readTransform(e.rasterTransform):null;return c.getProjectionOffsetGrid({...e,projectedExtent:t,srcBufferExtent:r,datumTransformation:o,rasterTransform:s})}));function r(e){return t.apply(this,arguments)}return r}(),t}();return y}));
