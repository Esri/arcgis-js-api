/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../core/maybe","../../core/urlUtils","../../chunks/persistableUrlUtils"],(function(e,r,t,s){"use strict";const n={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},i=Object.values(n),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${i.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),o=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${i.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),a=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function u(e){return!!l.test(e)}function c(e){const r=t.urlToObject(e),s=r.path.match(l)||r.path.match(o);if(!s)return null;const[,i,a,u,c]=s,f=a.indexOf("/");return{title:v(-1!==f?a.slice(f+1):a),serverType:n[u.toLowerCase()],sublayer:null!=c&&""!==c?parseInt(c,10):null,url:{path:i}}}function f(e){const r=t.urlToObject(e).path.match(a);return r?{serviceUrl:r[1],sublayerId:Number(r[2])}:null}function v(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function d(e,t){const s=[];if(e){const t=c(e);r.isSome(t)&&t.title&&s.push(t.title)}if(t){const e=v(t);s.push(e)}if(2===s.length){if(-1!==s[0].toLowerCase().indexOf(s[1].toLowerCase()))return s[0];if(-1!==s[1].toLowerCase().indexOf(s[0].toLowerCase()))return s[1]}return s.join(" - ")}function m(e){if(!e)return!1;const r=".arcgis.com/",t="//services",s="//tiles",n="//features",i=-1!==(e=e.toLowerCase()).indexOf(r),l=-1!==e.indexOf(t)||-1!==e.indexOf(s)||-1!==e.indexOf(n);return i&&l}function S(e,r){return r&&e&&-1!==e.toLowerCase().indexOf(r.toLowerCase())}function p(e,r){return e?t.removeTrailingSlash(t.removeQueryParameters(e,r)):e}function y(e){let{url:s}=e;if(!s)return{url:s};s=t.removeQueryParameters(s,e.logger);const n=t.urlToObject(s),i=c(n.path);let l;if(r.isSome(i))null!=i.sublayer&&null==e.layer.layerId&&(l=i.sublayer),s=i.url.path;else if(e.nonStandardUrlAllowed){const e=f(n.path);r.isSome(e)&&(s=e.serviceUrl,l=e.sublayerId)}return{url:t.removeTrailingSlash(s),layerId:l}}function h(e,r,n,i,l){s.write(r,i,"url",l),i.url&&null!=e.layerId&&(i.url=t.join(i.url,n,e.layerId.toString()))}function w(e){if(!e)return!1;const r=e.toLowerCase(),t=-1!==r.indexOf("/services/"),s=-1!==r.indexOf("/mapserver/wmsserver"),n=-1!==r.indexOf("/imageserver/wmsserver"),i=-1!==r.indexOf("/wmsserver");return t&&(s||n||i)}function O(e){if(!e)return!1;const r=new t.Url(t.makeAbsolute(e)).authority.toLowerCase();return"server.arcgisonline.com"===r||"services.arcgisonline.com"===r}function g(e){if(!e)return!1;return new t.Url(t.makeAbsolute(e)).authority.toLowerCase().includes("arcgis.com")}e.cleanTitle=v,e.isAGOLUrl=g,e.isArcGISUrl=u,e.isHostedAgolService=m,e.isHostedSecuredProxyService=S,e.isServerOrServicesAGOLUrl=O,e.isWmsServer=w,e.parse=c,e.parseNonStandardSublayerUrl=f,e.sanitizeUrl=p,e.sanitizeUrlWithLayerId=y,e.serverTypes=i,e.titleFromUrlAndName=d,e.writeUrlWithLayerId=h,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
