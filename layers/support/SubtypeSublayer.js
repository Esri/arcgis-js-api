/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../PopupTemplate","../../renderers/ClassBreaksRenderer","../../renderers/DictionaryRenderer","../../renderers/DotDensityRenderer","../../renderers/HeatmapRenderer","../../renderers/Renderer","../../renderers/SimpleRenderer","../../renderers/UniqueValueRenderer","../../renderers/support/jsonUtils","../../renderers/support/types","../../symbols","../../core/HandleOwner","../../core/Identifiable","../../core/Loadable","../../core/Logger","../../core/MultiOriginJSONSupport","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/extensions/serializableProperty/reader","./commonProperties","./FeatureTemplate","./LabelClass","./labelingInfo","../../support/popupUtils"],(function(e,r,t,o,i,n,a,l,p,d,s,y,c,u,f,b,g,m,_,v,S,w,I,D,h,T,R,x,O,P){"use strict";const V=g.getLogger("esri.layers.FeatureLayer"),k=h.createTypeReader({types:c.symbolTypesRenderer}),C={key:"type",base:l,typeMap:{simple:p,"unique-value":d,"class-breaks":o},errorContext:"renderer"};let L=function(r){function t(e){var t;return(t=r.call(this,e)||this).type="subtype-sublayer",t.labelsVisible=!0,t.labelingInfo=null,t.legendEnabled=!0,t.minScale=0,t.maxScale=0,t.popupEnabled=!0,t.popupTemplate=null,t.subtypeCode=null,t.templates=null,t.title=null,t.visible=!0,t}e._inheritsLoose(t,r);var o=t.prototype;return o.readRenderer=function(e,r,t){const o=(r=r.layerDefinition||r).drawingInfo&&r.drawingInfo.renderer||void 0;if(o){const e=s.read(o,r,t)||void 0;return e||V.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:t}),e}if(r.defaultSymbol)return r.types&&r.types.length?new d({defaultSymbol:k(r.defaultSymbol,r,t),field:r.typeIdField,uniqueValueInfos:r.types.map((e=>({id:e.id,symbol:k(e.symbol,e,t)})))}):new p({symbol:k(r.defaultSymbol,r,t)})},o.readTemplates=function(e,r){return e=e&&e.map((e=>R.fromJSON(e)))},o.readVisible=function(e,r){return r.layerDefinition&&null!=r.layerDefinition.defaultVisibility?!!r.layerDefinition.defaultVisibility:null!=r.visibility?!!r.visibility:void 0},o.createPopupTemplate=function(e){const r=this.parent.fields;return P.createPopupTemplate({...this,fields:r},e)},e._createClass(t,[{key:"effectiveScaleRange",get:function(){const{minScale:e,maxScale:r}=this;return{minScale:e,maxScale:r}}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(e){this._set("renderer",e)}}]),t}(u.HandleOwnerMixin(m.MultiOriginJSONMixin(f.IdentifiableMixin(b))));r.__decorate([_.property({json:{read:!1}})],L.prototype,"type",void 0),r.__decorate([_.property(T.labelsVisible)],L.prototype,"labelsVisible",void 0),r.__decorate([_.property({type:[x],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:O.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:O.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],L.prototype,"labelingInfo",void 0),r.__decorate([_.property(T.legendEnabled)],L.prototype,"legendEnabled",void 0),r.__decorate([_.property(T.minScale)],L.prototype,"minScale",void 0),r.__decorate([_.property(T.maxScale)],L.prototype,"maxScale",void 0),r.__decorate([_.property({readOnly:!0})],L.prototype,"effectiveScaleRange",null),r.__decorate([_.property(T.opacityDrawingInfo)],L.prototype,"opacity",void 0),r.__decorate([_.property()],L.prototype,"parent",void 0),r.__decorate([_.property(T.popupEnabled)],L.prototype,"popupEnabled",void 0),r.__decorate([_.property({type:t,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],L.prototype,"popupTemplate",void 0),r.__decorate([_.property({readOnly:!0})],L.prototype,"defaultPopupTemplate",null),r.__decorate([_.property({types:C,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{name:"layerDefinition.drawingInfo.renderer",types:y.webSceneRendererTypes,write:{overridePolicy:(e,r,t)=>({ignoreOrigin:null==t?void 0:t.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,r,t)=>({ignoreOrigin:null==t?void 0:t.writeLayerSchema})}}})],L.prototype,"renderer",null),r.__decorate([I.reader("service","renderer",["drawingInfo.renderer","defaultSymbol"]),I.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],L.prototype,"readRenderer",null),r.__decorate([_.property({type:Number,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.subtypeCode"},write:{target:"layerDefinition.subtypeCode"}}})],L.prototype,"subtypeCode",void 0),r.__decorate([_.property({type:[R]})],L.prototype,"templates",void 0),r.__decorate([I.reader("templates",["editFieldsInfo","creatorField","editorField","templates"])],L.prototype,"readTemplates",null),r.__decorate([_.property()],L.prototype,"title",void 0),r.__decorate([_.property({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],L.prototype,"visible",void 0),r.__decorate([I.reader("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],L.prototype,"readVisible",null),L=r.__decorate([D.subclass("esri.layers.support.SubtypeSublayer")],L);return L}));
