/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../PopupTemplate","../../renderers/ClassBreaksRenderer","../../renderers/DictionaryRenderer","../../renderers/DotDensityRenderer","../../renderers/HeatmapRenderer","../../renderers/Renderer","../../renderers/SimpleRenderer","../../renderers/UniqueValueRenderer","../../renderers/support/jsonUtils","../../symbols","../../core/HandleOwner","../../core/Identifiable","../../core/Loadable","../../core/Logger","../../core/MultiOriginJSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/extensions/serializableProperty/reader","./commonProperties","./FeatureTemplate","./LabelClass","./labelingInfo","../../support/popupUtils"],(function(e,r,t,o,i,n,a,p,l,d,s,y,u,c,f,b,g,m,_,v,w,I,S,D,T,h,R,V){"use strict";const P=b.getLogger("esri.layers.FeatureLayer"),x=S.createTypeReader({types:y.symbolTypesRenderer}),O={key:"type",base:p,typeMap:{simple:l,"unique-value":d,"class-breaks":o},errorContext:"renderer"};let C=function(r){function t(e){var t;return(t=r.call(this,e)||this).type="subtype-sublayer",t.labelsVisible=!0,t.labelingInfo=null,t.legendEnabled=!0,t.minScale=0,t.maxScale=0,t.popupEnabled=!0,t.popupTemplate=null,t.subtypeCode=null,t.templates=null,t.title=null,t.visible=!0,t}e._inheritsLoose(t,r);var o=t.prototype;return o.readRenderer=function(e,r,t){const o=(r=r.layerDefinition||r).drawingInfo&&r.drawingInfo.renderer||void 0;if(o){const e=s.read(o,r,t)||void 0;return e||P.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:t}),e}if(r.defaultSymbol)return r.types&&r.types.length?new d({defaultSymbol:x(r.defaultSymbol,r,t),field:r.typeIdField,uniqueValueInfos:r.types.map((e=>({id:e.id,symbol:x(e.symbol,e,t)})))}):new l({symbol:x(r.defaultSymbol,r,t)})},o.readTemplates=function(e,r){return e=e&&e.map((e=>T.fromJSON(e)))},o.readVisible=function(e,r){return r.layerDefinition&&null!=r.layerDefinition.defaultVisibility?!!r.layerDefinition.defaultVisibility:null!=r.visibility?!!r.visibility:void 0},o.createPopupTemplate=function(e){const r=this.parent.fields;return V.createPopupTemplate({...this,fields:r},e)},e._createClass(t,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(e){this._set("renderer",e)}}]),t}(u.HandleOwnerMixin(g.MultiOriginJSONMixin(c.IdentifiableMixin(f))));return r.__decorate([m.property({json:{read:!1}})],C.prototype,"type",void 0),r.__decorate([m.property(D.labelsVisible)],C.prototype,"labelsVisible",void 0),r.__decorate([m.property({type:[h],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:R.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:R.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],C.prototype,"labelingInfo",void 0),r.__decorate([m.property(D.legendEnabled)],C.prototype,"legendEnabled",void 0),r.__decorate([m.property(D.minScale)],C.prototype,"minScale",void 0),r.__decorate([m.property(D.maxScale)],C.prototype,"maxScale",void 0),r.__decorate([m.property(D.opacityDrawingInfo)],C.prototype,"opacity",void 0),r.__decorate([m.property()],C.prototype,"parent",void 0),r.__decorate([m.property(D.popupEnabled)],C.prototype,"popupEnabled",void 0),r.__decorate([m.property({type:t,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],C.prototype,"popupTemplate",void 0),r.__decorate([m.property({readOnly:!0})],C.prototype,"defaultPopupTemplate",null),r.__decorate([m.property({types:O,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,r,t)=>({ignoreOrigin:null==t?void 0:t.writeLayerSchema}),writer:s.write}}})],C.prototype,"renderer",null),r.__decorate([w.reader("service","renderer",["drawingInfo.renderer","defaultSymbol"]),w.reader("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],C.prototype,"readRenderer",null),r.__decorate([m.property({type:Number,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.subtypeCode"},write:{target:"layerDefinition.subtypeCode"}}})],C.prototype,"subtypeCode",void 0),r.__decorate([m.property({type:[T]})],C.prototype,"templates",void 0),r.__decorate([w.reader("templates",["editFieldsInfo","creatorField","editorField","templates"])],C.prototype,"readTemplates",null),r.__decorate([m.property()],C.prototype,"title",void 0),r.__decorate([m.property({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],C.prototype,"visible",void 0),r.__decorate([w.reader("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],C.prototype,"readVisible",null),C=r.__decorate([I.subclass("esri.layers.support.SubtypeSublayer")],C),C}));
