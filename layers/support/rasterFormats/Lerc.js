/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","exports","../../../assets"],(function(e,t,n){"use strict";const r=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let a=null,o=!1;function l(){return a||(a=new Promise(((t,n)=>e(["../../../chunks/lerc-wasm"],t,n))).then((e=>e.lercWasm)).then((({default:e})=>e({locateFile:e=>n.getAssetUrl(`esri/layers/support/rasterFormats/${e}`)}))).then((e=>{c(e),o=!0})),a)}function s(){return o}const i={getBlobInfo:null,decode:null};function u(e){return 16+(e>>3<<3)}function f(e,t,n){n.set(e.slice(t,t+n.length))}function c(e){const{_malloc:t,_free:n,_lerc_getBlobInfo:a,_lerc_getDataRanges:o,_lerc_decode_4D:l,asm:s}=e;let c;const y=Object.values(s).find((t=>t&&"buffer"in t&&t.buffer===e.HEAPU8.buffer)),h=e=>{const n=e.map((e=>u(e))),r=n.reduce(((e,t)=>e+t)),a=t(r);c=new Uint8Array(y.buffer);let o=n[0];n[0]=a;for(let t=1;t<n.length;t++){const e=n[t];n[t]=n[t-1]+o,o=e}return n};i.getBlobInfo=e=>{const t=12,r=3,l=new Uint8Array(4*t),s=new Uint8Array(8*r),[i,u,p]=h([e.length,l.length,s.length]);c.set(e,i),c.set(l,u),c.set(s,p);let d=a(i,e.length,u,p,t,r);if(d)throw n(i),new Error(`lerc-getBlobInfo: error code is ${d}`);c=new Uint8Array(y.buffer),f(c,u,l),f(c,p,s);const g=new Uint32Array(l.buffer),b=new Float64Array(s.buffer),[w,A,,m,U,x,T,C,V,I,D]=g,z={version:w,depthCount:I,width:m,height:U,validPixelCount:T,bandCount:x,blobSize:C,maskCount:V,dataType:A,minValue:b[0],maxValue:b[1],maxZerror:b[2],statistics:[],bandCountWithNoData:D};if(D)return z;if(1===I&&1===x)return n(i),z.statistics.push({minValue:b[0],maxValue:b[1]}),z;const F=I*x*8,_=new Uint8Array(F),k=new Uint8Array(F);let B=i,S=0,v=0,M=!1;if(c.byteLength<i+2*F?(n(i),M=!0,[B,S,v]=h([e.length,F,F]),c.set(e,B)):[S,v]=h([F,F]),c.set(_,S),c.set(k,v),d=o(B,e.length,I,x,S,v),d)throw n(B),M||n(S),new Error(`lerc-getDataRanges: error code is ${d}`);c=new Uint8Array(y.buffer),f(c,S,_),f(c,v,k);const O=new Float64Array(_.buffer),E=new Float64Array(k.buffer),P=z.statistics;for(let n=0;n<x;n++)if(I>1){const e=O.slice(n*I,(n+1)*I),t=E.slice(n*I,(n+1)*I),r=Math.min.apply(null,e),a=Math.max.apply(null,t);P.push({minValue:r,maxValue:a,depthStats:{minValues:e,maxValues:t}})}else P.push({minValue:O[n],maxValue:E[n]});return n(B),M||n(S),z},i.decode=(e,t)=>{const{maskCount:a,depthCount:o,bandCount:s,width:i,height:u,dataType:p,bandCountWithNoData:d}=t,g=r[p],b=i*u,w=new Uint8Array(b*s),A=b*o*s*g.size,m=new Uint8Array(A),U=new Uint8Array(s),x=new Uint8Array(8*s),[T,C,V,I,D]=h([e.length,w.length,m.length,U.length,x.length]);c.set(e,T),c.set(w,C),c.set(m,V),c.set(U,I),c.set(x,D);const z=l(T,e.length,a,C,o,i,u,s,p,V,I,D);if(z)throw n(T),new Error(`lerc-decode: error code is ${z}`);c=new Uint8Array(y.buffer),f(c,V,m),f(c,C,w);let F=null;if(d){f(c,I,U),f(c,D,x),F=[];const e=new Float64Array(x.buffer);for(let t=0;t<U.length;t++)F.push(U[t]?e[t]:null)}return n(T),{data:m,maskData:w,noDataValues:F}}}function y(e,t,n,r,a){if(n<2)return e;const o=new r(t*n);if(a)for(let l=0,s=0;l<t;l++)for(let r=0,a=l;r<n;r++,a+=t)o[a]=e[s++];else for(let l=0,s=0;l<t;l++)for(let r=0,a=l;r<n;r++,a+=t)o[s++]=e[a];return o}function h(e,t={}){const n=t.inputOffset??0,a=e instanceof Uint8Array?e.subarray(n):new Uint8Array(e,n),o=i.getBlobInfo(a),{data:l,maskData:s,noDataValues:u}=i.decode(a,o),{width:f,height:c,bandCount:h,depthCount:p,dataType:d,maskCount:g,statistics:b}=o,w=r[d],A=new w.ctor(l.buffer),m=[],U=[],x=f*c,T=x*p;for(let r=0;r<h;r++){const e=A.subarray(r*T,(r+1)*T);if(t.returnInterleaved)m.push(e);else{const t=y(e,x,p,w.ctor,!0);m.push(t)}U.push(s.subarray(r*T,(r+1)*T))}const C=0===g?null:1===g?U[0]:new Uint8Array(x);if(g>1){C.set(U[0]);for(let e=1;e<U.length;e++){const t=U[e];for(let e=0;e<x;e++)C[e]=C[e]&t[e]}}const{noDataValue:V}=t,I=null!=V&&w.range[0]<=V&&w.range[1]>=V;if(g>0&&I)for(let r=0;r<h;r++){const e=m[r],t=U[r]||C;for(let n=0;n<x;n++)0===t[n]&&(e[n]=V)}const D=g===h&&h>1?U:null,{pixelType:z}=w;return{width:f,height:c,bandCount:h,pixelType:z,depthCount:p,statistics:b,pixels:m,mask:C,bandMasks:D,noDataValues:u}}function p(e,t={}){const n=e instanceof Uint8Array?e.subarray(t.inputOffset??0):new Uint8Array(e,t.inputOffset??0);return i.getBlobInfo(n)}t.decode=h,t.getBlobInfo=p,t.isLoaded=s,t.load=l,t.pixelTypeInfoMap=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
