/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["require","exports","../../../assets"],(function(e,t,n){"use strict";const r=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let a=null,l=!1;function s(){return a||(a=new Promise(((t,n)=>e(["../../../chunks/lerc-wasm"],t,n))).then((e=>e.lercWasm)).then((({default:e})=>e({locateFile:e=>n.getAssetUrl(`esri/layers/support/rasterFormats/${e}`)}))).then((e=>{c(e),l=!0})),a)}function i(){return l}const o={getBlobInfo:null,decode:null};function u(e){return 16+(e>>3<<3)}function c(e){const{_malloc:t,_free:n,_lerc_getBlobInfo:a,_lerc_getDataRanges:l,_lerc_decode_4D:s,asm:i}=e;let c;const f=Object.values(i).find((t=>t&&"buffer"in t&&t.buffer===e.HEAPU8.buffer)),y=e=>{const n=e.map((e=>u(e))),r=n.reduce(((e,t)=>e+t)),a=t(r);c=new Uint8Array(f.buffer);let l=n[0];n[0]=a;for(let t=1;t<n.length;t++){const e=n[t];n[t]=n[t-1]+l,l=e}return n};o.getBlobInfo=e=>{const t=12,r=3,s=new Uint8Array(4*t),i=new Uint8Array(8*r),[o,u,d]=y([e.length,s.length,i.length]);c.set(e,o),c.set(s,u),c.set(i,d);let h=a(o,e.length,u,d,t,r);if(h)throw n(o),`lerc-getBlobInfo: error code is ${h}`;c=new Uint8Array(f.buffer),s.set(c.slice(u,u+s.length)),i.set(c.slice(d,d+i.length));const p=new Uint32Array(s.buffer),g=new Float64Array(i.buffer),[b,m,A,w,U,x,T,C,V,,D]=p,I={version:b,dimCount:A,width:w,height:U,validPixelCount:T,bandCount:x,blobSize:C,maskCount:V,dataType:m,minValue:g[0],maxValue:g[1],maxZerror:g[2],statistics:[],bandCountWithNoData:D};if(D)return I;if(1===A&&1===x)return n(o),I.statistics.push({minValue:g[0],maxValue:g[1]}),I;const _=A*x*8,z=new Uint8Array(_),v=new Uint8Array(_);let F,k=o,B=0,S=!1;if(c.byteLength<o+2*_?(n(o),S=!0,[k,B,F]=y([e.length,_,_]),c.set(e,k)):[B,F]=y([_,_]),c.set(z,B),c.set(v,F),h=l(o,e.length,A,x,B,F),h)throw n(k),S||n(B),`lerc-getDataRanges: error code is ${h}`;c=new Uint8Array(f.buffer),z.set(c.slice(B,B+_)),v.set(c.slice(F,F+_));const M=new Float64Array(z.buffer),O=new Float64Array(v.buffer),P=I.statistics;for(let n=0;n<x;n++)if(A>1){const e=M.slice(n*A,(n+1)*A),t=O.slice(n*A,(n+1)*A),r=Math.min.apply(null,e),a=Math.max.apply(null,t);P.push({minValue:r,maxValue:a,dimStats:{minValues:e,maxValues:t}})}else P.push({minValue:M[n],maxValue:O[n]});return n(k),S||n(B),I},o.decode=(e,t)=>{const{maskCount:a,dimCount:l,bandCount:i,width:o,height:u,dataType:d,bandCountWithNoData:h}=t,p=r[d],g=o*u,b=new Uint8Array(g*i),m=g*l*i*p.size,A=new Uint8Array(m),w=new Uint8Array(i),U=8*i,x=new Uint8Array(U),[T,C,V,D,I]=y([e.length,b.length,A.length,w.length,x.length]);c.set(e,T),c.set(b,C),c.set(A,V),c.set(w,D),c.set(x,I);const _=s(T,e.length,a,C,l,o,u,i,d,V,D,I);if(_)throw n(T),`lerc-decode: error code is ${_}`;c=new Uint8Array(f.buffer),A.set(c.slice(V,V+m)),b.set(c.slice(C,C+g));let z=null;if(h){w.set(c.slice(D,D+i)),x.set(c.slice(I,I+U)),z=[];for(let e=0;e<w.length;e++)z.push(w[e]?x[e]:null)}return n(T),{data:A,maskData:b,noDataValues:z}}}function f(e,t,n,r,a){if(n<2)return e;const l=new r(t*n);if(a)for(let s=0,i=0;s<t;s++)for(let r=0,a=s;r<n;r++,a+=t)l[a]=e[i++];else for(let s=0,i=0;s<t;s++)for(let r=0,a=s;r<n;r++,a+=t)l[i++]=e[a];return l}function y(e,t={}){var n;const a=null!=(n=t.inputOffset)?n:0,l=e instanceof Uint8Array?e.subarray(a):new Uint8Array(e,a),s=o.getBlobInfo(l),{data:i,maskData:u}=o.decode(l,s),{width:c,height:y,bandCount:d,dimCount:h,dataType:p,maskCount:g,statistics:b}=s,m=r[p],A=new m.ctor(i.buffer),w=[],U=[],x=c*y,T=x*h;for(let r=0;r<d;r++){const e=A.subarray(r*T,(r+1)*T);if(t.returnPixelInterleavedDims)w.push(e);else{const t=f(e,x,h,m.ctor,!0);w.push(t)}U.push(u.subarray(r*T,(r+1)*T))}const C=0===g?null:1===g?U[0]:new Uint8Array(x);if(g>1){C.set(U[0]);for(let e=1;e<U.length;e++){const t=U[e];for(let e=0;e<x;e++)C[e]=C[e]&t[e]}}const{noDataValue:V}=t,D=null!=V&&m.range[0]<=V&&m.range[1]>=V;if(g>0&&D){const{noDataValue:e}=t;for(let t=0;t<d;t++){const n=w[t],r=U[t]||C;for(let t=0;t<x;t++)0===r[t]&&(n[t]=e)}}const I=g===d&&d>1?U:null;return{width:c,height:y,bandCount:d,pixelType:t.pixelType&&0===s.version?t.pixelType:m.pixelType,dimCount:h,statistics:b,pixels:w,mask:C,bandMasks:I}}function d(e,t={}){var n,r;const a=e instanceof Uint8Array?e.subarray(null!=(n=t.inputOffset)?n:0):new Uint8Array(e,null!=(r=t.inputOffset)?r:0);return o.getBlobInfo(a)}t.decode=y,t.getBlobInfo=d,t.isLoaded=i,t.load=s,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
