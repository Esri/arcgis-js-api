/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","exports","../../../assets"],(function(e,t,n){"use strict";const r=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let a=null,o=!1;function l(){return a||(a=new Promise(((t,n)=>e(["../../../chunks/lerc-wasm"],t,n))).then((e=>e.lercWasm)).then((({default:e})=>e({locateFile:e=>n.getAssetUrl(`esri/layers/support/rasterFormats/${e}`)}))).then((e=>{c(e),o=!0})),a)}function s(){return o}const i={getBlobInfo:null,decode:null};function u(e){return 16+(e>>3<<3)}function f(e,t,n){n.set(e.slice(t,t+n.length))}function c(e){const{_malloc:t,_free:n,_lerc_getBlobInfo:a,_lerc_getDataRanges:o,_lerc_decode_4D:l,asm:s}=e;let c;const h=Object.values(s).find((t=>t&&"buffer"in t&&t.buffer===e.HEAPU8.buffer)),y=e=>{const n=e.map((e=>u(e))),r=n.reduce(((e,t)=>e+t)),a=t(r);c=new Uint8Array(h.buffer);let o=n[0];n[0]=a;for(let t=1;t<n.length;t++){const e=n[t];n[t]=n[t-1]+o,o=e}return n};i.getBlobInfo=e=>{const t=12,r=3,l=new Uint8Array(4*t),s=new Uint8Array(8*r),[i,u,d]=y([e.length,l.length,s.length]);c.set(e,i),c.set(l,u),c.set(s,d);let p=a(i,e.length,u,d,t,r);if(p)throw n(i),`lerc-getBlobInfo: error code is ${p}`;c=new Uint8Array(h.buffer),f(c,u,l),f(c,d,s);const g=new Uint32Array(l.buffer),b=new Float64Array(s.buffer),[A,w,,m,U,x,C,T,V,I,_]=g,z={version:A,depthCount:I,width:m,height:U,validPixelCount:C,bandCount:x,blobSize:T,maskCount:V,dataType:w,minValue:b[0],maxValue:b[1],maxZerror:b[2],statistics:[],bandCountWithNoData:_};if(_)return z;if(1===I&&1===x)return n(i),z.statistics.push({minValue:b[0],maxValue:b[1]}),z;const F=I*x*8,D=new Uint8Array(F),k=new Uint8Array(F);let B=i,S=0,v=0,M=!1;if(c.byteLength<i+2*F?(n(i),M=!0,[B,S,v]=y([e.length,F,F]),c.set(e,B)):[S,v]=y([F,F]),c.set(D,S),c.set(k,v),p=o(B,e.length,I,x,S,v),p)throw n(B),M||n(S),`lerc-getDataRanges: error code is ${p}`;c=new Uint8Array(h.buffer),f(c,S,D),f(c,v,k);const O=new Float64Array(D.buffer),P=new Float64Array(k.buffer),$=z.statistics;for(let n=0;n<x;n++)if(I>1){const e=O.slice(n*I,(n+1)*I),t=P.slice(n*I,(n+1)*I),r=Math.min.apply(null,e),a=Math.max.apply(null,t);$.push({minValue:r,maxValue:a,depthStats:{minValues:e,maxValues:t}})}else $.push({minValue:O[n],maxValue:P[n]});return n(B),M||n(S),z},i.decode=(e,t)=>{const{maskCount:a,depthCount:o,bandCount:s,width:i,height:u,dataType:d,bandCountWithNoData:p}=t,g=r[d],b=i*u,A=new Uint8Array(b*s),w=b*o*s*g.size,m=new Uint8Array(w),U=new Uint8Array(s),x=new Uint8Array(8*s),[C,T,V,I,_]=y([e.length,A.length,m.length,U.length,x.length]);c.set(e,C),c.set(A,T),c.set(m,V),c.set(U,I),c.set(x,_);const z=l(C,e.length,a,T,o,i,u,s,d,V,I,_);if(z)throw n(C),`lerc-decode: error code is ${z}`;c=new Uint8Array(h.buffer),f(c,V,m),f(c,T,A);let F=null;if(p){f(c,I,U),f(c,_,x),F=[];const e=new Float64Array(x.buffer);for(let t=0;t<U.length;t++)F.push(U[t]?e[t]:null)}return n(C),{data:m,maskData:A,noDataValues:F}}}function h(e,t,n,r,a){if(n<2)return e;const o=new r(t*n);if(a)for(let l=0,s=0;l<t;l++)for(let r=0,a=l;r<n;r++,a+=t)o[a]=e[s++];else for(let l=0,s=0;l<t;l++)for(let r=0,a=l;r<n;r++,a+=t)o[s++]=e[a];return o}function y(e,t={}){const n=t.inputOffset??0,a=e instanceof Uint8Array?e.subarray(n):new Uint8Array(e,n),o=i.getBlobInfo(a),{data:l,maskData:s}=i.decode(a,o),{width:u,height:f,bandCount:c,depthCount:y,dataType:d,maskCount:p,statistics:g}=o,b=r[d],A=new b.ctor(l.buffer),w=[],m=[],U=u*f,x=U*y;for(let r=0;r<c;r++){const e=A.subarray(r*x,(r+1)*x);if(t.returnInterleaved)w.push(e);else{const t=h(e,U,y,b.ctor,!0);w.push(t)}m.push(s.subarray(r*x,(r+1)*x))}const C=0===p?null:1===p?m[0]:new Uint8Array(U);if(p>1){C.set(m[0]);for(let e=1;e<m.length;e++){const t=m[e];for(let e=0;e<U;e++)C[e]=C[e]&t[e]}}const{noDataValue:T}=t,V=null!=T&&b.range[0]<=T&&b.range[1]>=T;if(p>0&&V)for(let r=0;r<c;r++){const e=w[r],t=m[r]||C;for(let n=0;n<U;n++)0===t[n]&&(e[n]=T)}const I=p===c&&c>1?m:null,{pixelType:_}=b;return{width:u,height:f,bandCount:c,pixelType:_,depthCount:y,statistics:g,pixels:w,mask:C,bandMasks:I}}function d(e,t={}){const n=e instanceof Uint8Array?e.subarray(t.inputOffset??0):new Uint8Array(e,t.inputOffset??0);return i.getBlobInfo(n)}t.decode=y,t.getBlobInfo=d,t.isLoaded=s,t.load=l,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
