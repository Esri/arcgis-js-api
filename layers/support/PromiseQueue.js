/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as s}from"../../chunks/tslib.es6.js";import r from"../../core/Accessor.js";import{isAborted as t,createAbortError as e,isPromiseLike as o}from"../../core/promiseUtils.js";import{property as c}from"../../core/accessorSupport/decorators/property.js";import"../../core/arrayUtils.js";import"../../core/has.js";import"../../core/accessorSupport/ensureType.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";let i=class extends r{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(s){for(;!s.done&&this._process(s);)s.madeProgress()}push(s,r,t){return this.running=!0,new Promise(((e,o)=>this._tasks.push(new a(e,o,s,r,t))))}unshift(s,r,t){return this.running=!0,new Promise(((e,o)=>this._tasks.unshift(new a(e,o,s,r,t))))}_process(s){if(0===this._tasks.length)return!1;const r=this._tasks.shift();try{const c=t(r.signal);if(c&&!r.abortCallback)r.reject(e());else{const t=c?r.abortCallback(e()):r.callback(s);o(t)?t.then(r.resolve,r.reject):r.resolve(t)}}catch(c){r.reject(c)}return this.running=this._tasks.length>0,!0}cancelAll(){const s=e();for(const r of this._tasks)if(r.abortCallback){const t=r.abortCallback(s);r.resolve(t)}else r.reject(s);this._tasks.length=0,this.running=!1}};s([c()],i.prototype,"running",void 0),i=s([n("esri.layers.support.PromiseQueue")],i);class a{constructor(s,r,t,e,o){this.resolve=s,this.reject=r,this.callback=t,this.signal=e,this.abortCallback=o}}export{i as PromiseQueue};
