/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/Error","../core/maybe","../core/MultiOriginJSONSupport","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Layer","./mixins/BlendLayer","./mixins/CustomParametersMixin","./mixins/ImageryTileMixin","./mixins/OperationalLayer","./mixins/PortalLayer","./mixins/RefreshableLayer","./mixins/ScaleRangeLayer","./mixins/TemporalLayer","./support/commonProperties","./support/Field","./support/rasterDatasets/WCSRaster","../support/popupUtils"],(function(e,r,t,o,s,i,a,n,l,p,u,c,d,y,m,f,v,h,g,_,P,x,S,L){"use strict";const I=new Set(["milliseconds","seconds","minutes","hours","days","weeks","months","years","decades","centuries"]);let T=function(r){function s(...e){var t;return(t=r.call(this,...e)||this).coverageId=null,t.coverageInfo=null,t.version=null,t.isReference=null,t.type="wcs",t.popupEnabled=!0,t.popupTemplate=null,t.fields=null,t}e._inheritsLoose(s,r);var i=s.prototype;return i.normalizeCtorArgs=function(e,r){return"string"==typeof e?{url:e,...r}:e},i.load=function(e){const r=o.isSome(e)?e.signal:null;return this.addResolvingPromise(this._openRaster(r)),Promise.resolve(this)},i.createPopupTemplate=function(e){return L.createPopupTemplate({fields:this.rasterFields,title:this.title},e)},i._openRaster=function(){var r=e._asyncToGenerator((function*(e){const r=new S({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters}});if(yield r.open({signal:e}),!r.rasterInfo)throw r.destroy(),new t("wcs-layer:load","cannot load resources on "+this.url);null==this.title&&this.setAtOrigin("title",r.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",r.coverageInfo.id,"service");const{multidimensionalInfo:s}=r.rasterInfo;if(o.isSome(s)){const e=s.variables[0].dimensions.find((({name:e})=>"StdTime"===e));if(e){var i,a,n,l,p;let r=null!=(i=null==(a=e.extent)?void 0:a[0])?i:e.values[0];Array.isArray(r)&&(r=r[0]);let t=null!=(n=null==(l=e.extent)?void 0:l[1])?n:e.values[e.values.length-1];Array.isArray(t)&&(t=t[1]);const o=I.has(null==(p=e.intervalUnit)?void 0:p.toLowerCase())?e.intervalUnit.toLowerCase():null;this.set("timeInfo",{startField:"StdTime",fullTimeExtent:{start:r,end:t},timeReference:null,interval:o?{value:e.interval,unit:o}:null})}}this.raster=r,this._configDefaultSettings(),this.watch("customParameters",(e=>this.raster.ioConfig.customFetchParameters=e))}));function s(e){return r.apply(this,arguments)}return s}(),e._createClass(s,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"rasterFields",get:function(){return[new x({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]}}]),s}(d.BlendLayer(g.ScaleRangeLayer(f.OperationalLayer(v.PortalLayer(y.CustomParametersMixin(m.ImageryTileMixin(_.TemporalLayer(h.RefreshableLayer(s.MultiOriginJSONMixin(c))))))))));r.__decorate([p.property({json:{write:!0}})],T.prototype,"coverageId",void 0),r.__decorate([p.property({readOnly:!0}),i.aliasOf("raster.coverageInfo")],T.prototype,"coverageInfo",void 0),r.__decorate([p.property()],T.prototype,"version",void 0),r.__decorate([p.property()],T.prototype,"isReference",void 0),r.__decorate([p.property({readOnly:!0})],T.prototype,"type",void 0),r.__decorate([p.property(P.popupEnabled)],T.prototype,"popupEnabled",void 0),r.__decorate([p.property()],T.prototype,"popupTemplate",void 0),r.__decorate([p.property({readOnly:!0})],T.prototype,"defaultPopupTemplate",null),r.__decorate([p.property({readOnly:!0,type:[x]})],T.prototype,"fields",void 0),r.__decorate([p.property({readOnly:!0,type:[x]})],T.prototype,"rasterFields",null),T=r.__decorate([u.subclass("esri.layers.WCSLayer")],T);return T}));
