/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/Error","../core/maybe","../core/MultiOriginJSONSupport","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/accessorSupport/decorators/subclass","./Layer","./mixins/BlendLayer","./mixins/CustomParametersMixin","./mixins/ImageryTileMixin","./mixins/OperationalLayer","./mixins/PortalLayer","./mixins/RefreshableLayer","./mixins/ScaleRangeLayer","./mixins/TemporalLayer","./support/commonProperties","./support/Field","./support/rasterDatasets/WCSRaster","../support/popupUtils"],(function(e,t,r,o,s,i,a,n,l,p,c,u,d,y,m,f,h,v,g,_,P,x,S){"use strict";const I=new Set(["milliseconds","seconds","minutes","hours","days","weeks","months","years","decades","centuries"]);let L=function(t){function s(...e){var r;return(r=t.call(this,...e)||this).coverageId=null,r.version=null,r.isReference=null,r.type="wcs",r.popupEnabled=!0,r.popupTemplate=null,r.fields=null,r}e._inheritsLoose(s,t);var a=s.prototype;return a.normalizeCtorArgs=function(e,t){return"string"==typeof e?{url:e,...t}:e},a.load=function(e){const t=o.isSome(e)?e.signal:null;return this.addResolvingPromise(this._openRaster(t)),Promise.resolve(this)},a.createPopupTemplate=function(e){return S.createPopupTemplate({fields:this.rasterFields,title:this.title},e)},a._openRaster=function(){var t=e._asyncToGenerator((function*(e){const t=new x({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters}});if(yield t.open({signal:e}),!t.rasterInfo)throw t.destroy(),new r("wcs-layer:load","cannot load resources on "+this.url);const{rasterInfo:s}=t;this._set("rasterInfo",s),this._set("spatialReference",s.spatialReference),null==this.title&&this.setAtOrigin("title",t.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",t.coverageInfo.id,"service");const{multidimensionalInfo:a}=s;if(o.isSome(a)){const e=a.variables[0].dimensions.find((({name:e})=>"StdTime"===e));if(e){let t=e.extent?.[0]??e.values[0];Array.isArray(t)&&(t=t[0]);let r=e.extent?.[1]??e.values[e.values.length-1];Array.isArray(r)&&(r=r[1]);const o=I.has(e.intervalUnit?.toLowerCase())?e.intervalUnit?.toLowerCase():null;this.set("timeInfo",{startField:"StdTime",fullTimeExtent:{start:t,end:r},timeReference:null,interval:o?{value:e.interval,unit:o}:null})}}this.raster=t,this._configDefaultSettings(),this.addHandles(i.watch((()=>this.customParameters),(e=>this.raster.ioConfig.customFetchParameters=e)))}));function s(e){return t.apply(this,arguments)}return s}(),e._createClass(s,[{key:"coverageInfo",get:function(){return this.raster.coverageInfo}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"rasterFields",get:function(){return[new P({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]}}]),s}(u.BlendLayer(v.ScaleRangeLayer(m.OperationalLayer(f.PortalLayer(d.CustomParametersMixin(y.ImageryTileMixin(g.TemporalLayer(h.RefreshableLayer(s.MultiOriginJSONMixin(c))))))))));t.__decorate([a.property({type:String,nonNullable:!0,json:{write:!0}})],L.prototype,"coverageId",void 0),t.__decorate([a.property()],L.prototype,"coverageInfo",null),t.__decorate([a.property()],L.prototype,"version",void 0),t.__decorate([a.property()],L.prototype,"isReference",void 0),t.__decorate([a.property()],L.prototype,"raster",void 0),t.__decorate([a.property({readOnly:!0})],L.prototype,"type",void 0),t.__decorate([a.property(_.popupEnabled)],L.prototype,"popupEnabled",void 0),t.__decorate([a.property()],L.prototype,"popupTemplate",void 0),t.__decorate([a.property({readOnly:!0})],L.prototype,"defaultPopupTemplate",null),t.__decorate([a.property({readOnly:!0,type:[P]})],L.prototype,"fields",void 0),t.__decorate([a.property({readOnly:!0,type:[P]})],L.prototype,"rasterFields",null),L=t.__decorate([p.subclass("esri.layers.WCSLayer")],L);return L}));
