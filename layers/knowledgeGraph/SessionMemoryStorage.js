/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../graphics/featureConversionUtils","../graphics/OptimizedFeature"],(function(e,t){"use strict";const r="ESRI__DESTINATION_ID",i="ESRI__ORIGIN_ID";return function(){function n(){this._featureLookup=new Map}n.getInstance=function(){return n.instance||(n.instance=new n),n.instance};var o=n.prototype;return o.deleteFromStore=function(e){e.forEach((e=>{this._featureLookup.delete(e)}))},o.readFromStoreByList=function(e){const t=[];return e.forEach((e=>{const r=this.readFromStoreById(e);r&&t.push(r)})),t},o.readFromStoreById=function(e){const t=this._featureLookup.get(e);return t||null},o.writeToStore=function(n,o,s){const p=[];return n.forEach((n=>{if(!n||!n.id)return;n.properties||(n.properties=[]);let u,a=null;if(s&&(a=n.properties[s]?e.convertFromGeometry(n.properties[s]):null),"originId"in n&&"destinationId"in n&&(n.properties[i]=n.originId,n.properties[r]=n.destinationId),n.properties[o]=n.id,n.id&&this._featureLookup.has(n.id)){const e=this._featureLookup.get(n.id);u=new t.OptimizedFeature(a?JSON.parse(JSON.stringify(a)):e?.geometry?JSON.parse(JSON.stringify(e.geometry)):null,JSON.parse(JSON.stringify(Object.assign(n.properties,e?.attributes))),null,n.properties[o])}else u=new t.OptimizedFeature(a?JSON.parse(JSON.stringify(a)):null,n.properties,null,n.properties[o]);this._featureLookup.set(n.id,u),p.push(u)})),p},n}()}));
