// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","../../core/compilerUtils","../../core/has","../../core/maybe","../../core/typedArrayUtil","../../core/uid","../../geometry/SpatialReference","../../geometry/support/aaBoundingBox","../../geometry/support/aaBoundingRect","../../geometry/support/quantizationUtils","../../geometry/support/typeUtils","../support/Field","./dehydratedFeatureComparison"],(function(e,t,r,a,n,i,s,o,u,l,h,p,c,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getObjectId=t.expandAABR=t.computeAABR=t.expandAABB=t.computeAABB=t.hasVertices=t.numVertices=t.estimateSize=t.estimateGeometryObjectSize=t.estimateAttributesObjectSize=t.makeDehydratedPoint=t.fromJSONGeometry=t.fromFeatureSetJSON=t.isDehydratedPoint=t.DehydratedFeatureSetClass=t.isFeatureGeometry=t.hasGeometry=t.DehydratedFeatureClass=void 0,Object.defineProperty(t,"equals",{enumerable:!0,get:function(){return m.equals}});var y=function(e,t,r){this.uid=e,this.geometry=t,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null};t.DehydratedFeatureClass=y,t.hasGeometry=function(e){return n.isSome(e.geometry)},t.isFeatureGeometry=function(e){return p.isFeatureGeometryType(e.type)};var d=function(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null};function f(e,t,r){if(!e)return null;switch(t){case"point":var a=e;return{x:a.x,y:a.y,z:a.z,m:a.m,hasZ:null!=a.z,hasM:null!=a.m,type:"point",spatialReference:r};case"polyline":var n=e;return{paths:n.paths,hasZ:!!n.hasZ,hasM:!!n.hasM,type:"polyline",spatialReference:r};case"polygon":var i=e;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r};case"multipoint":var s=e;return{points:s.points,hasZ:!!s.hasZ,hasM:!!s.hasM,type:"multipoint",spatialReference:r}}}t.DehydratedFeatureSetClass=d,t.isDehydratedPoint=function(e){return"point"===e.type},t.fromFeatureSetJSON=function(e){var t=p.featureGeometryTypeKebabDictionary.fromJSON(e.geometryType),a=o.fromJSON(e.spatialReference),n=e.transform,i=e.features.map((function(i){var o=function(e,t,r,a){return{uid:s.generateUID(),objectId:a&&e.attributes?e.attributes[a]:null,attributes:e.attributes,geometry:f(e.geometry,t,r),visible:!0}}(i,t,a,e.objectIdFieldName),u=o.geometry;if(u&&n)switch(u.type){case"point":o.geometry=h.unquantizePoint(n,u,u,u.hasZ,u.hasM);break;case"multipoint":o.geometry=h.unquantizeMultipoint(n,u,u,u.hasZ,u.hasM);break;case"polygon":o.geometry=h.unquantizePolygon(n,u,u,u.hasZ,u.hasM);break;case"polyline":o.geometry=h.unquantizePolyline(n,u,u,u.hasZ,u.hasM);break;default:r.neverReached(u)}return o}));return{geometryType:t,features:i,spatialReference:a,fields:e.fields?e.fields.map((function(e){return c.fromJSON(e)})):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}},t.fromJSONGeometry=f,t.makeDehydratedPoint=function(e,t,r,a){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:a,type:"point"}};var g=a("esri-text-decoder")?function(e){return 32+e.length}:function(e){return 32*e.length};function b(e){if(!e)return 0;var t=32;for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];switch(typeof a){case"string":t+=g(a);break;default:case"number":t+=16}}return t}function x(e){if(n.isNone(e))return 0;var t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":for(var a=0,s=2+(e.hasZ?1:0)+(e.hasM?1:0),o="polyline"===e.type?e.paths:e.rings,u=0,l=o;u<l.length;u++){a+=l[u].length}t+=8*a*s+64,t+=128*a,t+=34,t+=32*(o.length+1);break;case"multipoint":s=2+(e.hasZ?1:0)+(e.hasM?1:0);var h=e.points.length;t+=8*h*s+64,t+=128*h,t+=34,t+=32;break;case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=i.estimateSize(e.vertexAttributes.position),t+=i.estimateSize(e.vertexAttributes.normal),t+=i.estimateSize(e.vertexAttributes.uv),t+=i.estimateSize(e.vertexAttributes.tangent);break;default:r.neverReached(e)}return t}function v(e,t){switch(u.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var a=0;a<e.paths.length;a++)u.expandWithNestedArray(t,e.paths[a],e.hasZ);break;case"polygon":for(a=0;a<e.rings.length;a++)u.expandWithNestedArray(t,e.rings[a],e.hasZ);break;case"multipoint":u.expandWithNestedArray(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax);break;default:r.neverReached(e)}}function A(e,t){switch(l.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var a=0;a<e.paths.length;a++)l.expandWithNestedArray(t,e.paths[a]);break;case"polygon":for(a=0;a<e.rings.length;a++)l.expandWithNestedArray(t,e.rings[a]);break;case"multipoint":l.expandWithNestedArray(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax;break;default:r.neverReached(e)}}t.estimateAttributesObjectSize=b,t.estimateGeometryObjectSize=x,t.estimateSize=function(e){var t=32;return t+=b(e.attributes),t+=3,t+=8+x(e.geometry)},t.numVertices=function(e){if(n.isNone(e))return 0;switch(e.type){case"point":return 1;case"polyline":for(var t=0,a=0,i=e.paths;a<i.length;a++){t+=i[a].length}return t;case"polygon":t=0;for(var s=0,o=e.rings;s<o.length;s++){t+=o[s].length}return t;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var u=e.vertexAttributes&&e.vertexAttributes.position;return u?u.length/3:0;default:return void r.neverReached(e)}},t.hasVertices=function(e){if(!e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(var t=0,a=e.paths;t<a.length;t++){if(a[t].length>0)return!0}return!1;case"polygon":for(var n=0,i=e.rings;n<i.length;n++){if(i[n].length>0)return!0}return!1;case"multipoint":return e.points.length>0;case"mesh":return e.vertexAttributes&&e.vertexAttributes.position&&e.vertexAttributes.position.length>0;default:return void r.neverReached(e)}},t.computeAABB=v,t.expandAABB=function(e,t){v(e,N),u.expand(t,N)},t.computeAABR=A,t.expandAABR=function(e,t){A(e,z),l.expand(t,z)},t.getObjectId=function(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null};var N=u.create(),z=l.create()}));