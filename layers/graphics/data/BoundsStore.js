/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/has","../../../chunks/rbush"],(function(i,n,s){"use strict";const t={minX:0,minY:0,maxX:0,maxY:0};let d=function(){function i(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=s.rbush(9,n("csp-restrictions")?i=>({minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const i=new Array(this._idByBounds.size);let n=0;this._idByBounds.forEach(((s,t)=>{i[n++]=t})),this._indexInvalid=!1,this._index.clear(),this._index.load(i)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter((i=>this._idByBounds.has(i)))),this._boundsToLoad.length=0)}}var d=i.prototype;return d.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},d.delete=function(i){const n=this._boundsById.get(i);this._boundsById.delete(i),n&&(this._idByBounds.delete(n),this._indexInvalid||this._index.remove(n))},d.forEachInBounds=function(i,n){this._loadIndex();for(const s of function(i,n){return t.minX=n[0],t.minY=n[1],t.maxX=n[2],t.maxY=n[3],i.search(t)}(this._index,i))n(this._idByBounds.get(s))},d.get=function(i){return this._boundsById.get(i)},d.has=function(i){return this._boundsById.has(i)},d.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},d.set=function(i,n){if(!this._indexInvalid){const n=this._boundsById.get(i);n&&(this._index.remove(n),this._idByBounds.delete(n))}this._boundsById.set(i,n),n&&(this._idByBounds.set(n,i),this._indexInvalid||(this._boundsToLoad.push(n),this._boundsToLoad.length>5e4&&this._loadIndex()))},i}();i.BoundsStore=d,Object.defineProperty(i,"__esModule",{value:!0})}));
