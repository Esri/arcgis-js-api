/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush"],(function(i,n,s){"use strict";const d=5e4,t={minX:0,minY:0,maxX:0,maxY:0};function e(i,n,s){t.minX=n[0],t.minY=n[1],t.maxX=n[2],t.maxY=n[3],i.search(t,s)}let o=function(){function i(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new s.PooledRBush(9,n("csp-restrictions")?i=>({minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const i=new Array(this._idByBounds.size);let n=0;this._idByBounds.forEach(((s,d)=>{i[n++]=d})),this._indexInvalid=!1,this._index.clear(),this._index.load(i)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter((i=>this._idByBounds.has(i)))),this._boundsToLoad.length=0)}}var t=i.prototype;return t.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},t.delete=function(i){const n=this._boundsById.get(i);this._boundsById.delete(i),n&&(this._idByBounds.delete(n),this._indexInvalid||this._index.remove(n))},t.forEachInBounds=function(i,n){this._loadIndex(),e(this._index,i,(i=>n(this._idByBounds.get(i))))},t.get=function(i){return this._boundsById.get(i)},t.has=function(i){return this._boundsById.has(i)},t.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},t.set=function(i,n){if(!this._indexInvalid){const n=this._boundsById.get(i);n&&(this._index.remove(n),this._idByBounds.delete(n))}this._boundsById.set(i,n),n&&(this._idByBounds.set(n,i),this._indexInvalid||(this._boundsToLoad.push(n),this._boundsToLoad.length>d&&this._loadIndex()))},i}();i.BoundsStore=o,Object.defineProperty(i,"__esModule",{value:!0})}));
