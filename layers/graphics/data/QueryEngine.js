/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/arrayUtils","../../../core/Error","../../../core/lang","../../../core/maybe","../../../core/MemCache","../../../core/promiseUtils","../../../core/unitUtils","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../../../geometry/support/boundsUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","../featureConversionUtils","./attributeSupport","./projectionSupport","./QueryEngineCapabilities","./QueryEngineResult","./spatialQuerySupport","./timeSupport","./utils","../../support/FieldsIndex","../../../support/arcadeOnDemand","../../../views/support/Scheduler"],(function(e,t,r,i,n,s,a,u,o,l,c,h,y,f,d,p,m,g,_,S,x,R,Q,F,E,T){"use strict";function v(e){return null!=e&&e.every((e=>"exceedslimit"!==e.statisticType))}const I="feature-store:unsupported-query";let G=function(e,t=null,r,i,n){this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=n,this.groupId=-1,this.displayId=t};const w=new a.MemCacheStorage(2e6);let b=0,A=function(){function e(e){this._geometryQueryCache=null,this._changeHandle=null,this.capabilities={query:_.queryCapabilities},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new a.MemCache(b+++"$$",w)),this.fieldsIndex=new F(e.fields),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}var G=e.prototype;return G.destroy=function(){this._frameTask=s.removeMaybe(this._frameTask),this.clearCache(),s.destroyMaybe(this._geometryQueryCache),this._changeHandle=s.removeMaybe(this._changeHandle),s.destroyMaybe(this.fieldsIndex)},G.clearCache=function(){this._geometryQueryCache?.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null},G.executeQuery=function(){var e=t._asyncToGenerator((function*(e,t){try{return(yield this._executeQuery(e,{},t)).createQueryResponse()}catch(r){if(r!==Q.QUERY_ENGINE_EMPTY_RESULT)throw r;return new S.QueryEngineResult([],e,this).createQueryResponse()}}));function r(t,r){return e.apply(this,arguments)}return r}(),G.executeQueryForCount=function(){var e=t._asyncToGenerator((function*(e={},t){try{return(yield this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},t)).createQueryResponseForCount()}catch(r){if(r!==Q.QUERY_ENGINE_EMPTY_RESULT)throw r;return 0}}));function r(){return e.apply(this,arguments)}return r}(),G.executeQueryForExtent=function(){var e=t._asyncToGenerator((function*(e,t){const r=e.outSR;try{const i=yield this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},t),n=i.size;if(!n)return{count:0,extent:null};return{count:n,extent:yield this._getBounds(i.items,i.spatialReference,r||this.spatialReference)}}catch(i){if(i===Q.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw i}}));function r(t,r){return e.apply(this,arguments)}return r}(),G.executeQueryForIds=function(){var e=t._asyncToGenerator((function*(e,t){return this.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}));function r(t,r){return e.apply(this,arguments)}return r}(),G.executeQueryForIdSet=function(){var e=t._asyncToGenerator((function*(e,t){try{const r=yield this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},t),i=r.items,n=new Set;return yield this._reschedule((()=>{for(const e of i)n.add(r.featureAdapter.getObjectId(e))}),t),n}catch(r){if(r===Q.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw r}}));function r(t,r){return e.apply(this,arguments)}return r}(),G.executeQueryForSnapping=function(){var e=t._asyncToGenerator((function*(e,t){const{point:r,distance:i,types:n}=e;if(n===S.SnappingTypes.NONE)return{candidates:[]};const a=yield this._reschedule((()=>this._checkQuerySupport(e.query)),t),u=!d.equals(r.spatialReference,this.spatialReference);u&&(yield g.checkProjectionSupport(r.spatialReference,this.spatialReference));const o="number"==typeof i?i:i.x,l="number"==typeof i?i:i.y,c={xmin:r.x-o,xmax:r.x+o,ymin:r.y-l,ymax:r.y+l,spatialReference:r.spatialReference},h=u?g.project(c,this.spatialReference):c;if(!h)return{candidates:[]};const p=(yield f.normalizeCentralMeridian(y.fromJSON(r),null,{signal:t}))[0],m=(yield f.normalizeCentralMeridian(y.fromJSON(h),null,{signal:t}))[0];if(s.isNone(p)||s.isNone(m))return{candidates:[]};const _=new S.QueryEngineResult(yield this._reschedule((()=>this._searchFeatures(this._getQueryBBoxes(m.toJSON()))),t),a,this);yield this._reschedule((()=>this._executeObjectIdsQuery(_)),t),yield this._reschedule((()=>this._executeTimeQuery(_)),t),yield this._reschedule((()=>this._executeAttributesQuery(_)),t);const x=p.toJSON(),R=u?g.project(x,this.spatialReference):x,Q=u?Math.max(h.xmax-h.xmin,h.ymax-h.ymin)/2:i;return _.createSnappingResponse({...e,point:R,distance:Q},r.spatialReference)}));function r(t,r){return e.apply(this,arguments)}return r}(),G.executeQueryForLatestObservations=function(){var e=t._asyncToGenerator((function*(e,t){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new i(I,"Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const r=yield this._executeQuery(e,{},t);return yield this._reschedule((()=>this._filterLatest(r)),t),r.createQueryResponse()}catch(r){if(r!==Q.QUERY_ENGINE_EMPTY_RESULT)throw r;return new S.QueryEngineResult([],e,this).createQueryResponse()}}));function r(t,r){return e.apply(this,arguments)}return r}(),G.executeQueryForSummaryStatistics=function(){var e=t._asyncToGenerator((function*(e={},t,r){const{field:i,normalizationField:n,valueExpression:s}=t;return(yield this._getQueryEngineResultForStats(e,{field:i,normalizationField:n,valueExpression:s},r)).createSummaryStatisticsResponse(t)}));function r(){return e.apply(this,arguments)}return r}(),G.executeQueryForUniqueValues=function(){var e=t._asyncToGenerator((function*(e={},t,r){const{field:i,field2:n,field3:s,valueExpression:a}=t;return(yield this._getQueryEngineResultForStats(e,{field:i,field2:n,field3:s,valueExpression:a},r)).createUniqueValuesResponse(t)}));function r(){return e.apply(this,arguments)}return r}(),G.executeQueryForClassBreaks=function(){var e=t._asyncToGenerator((function*(e={},t,r){const{field:i,normalizationField:n,valueExpression:s}=t;return(yield this._getQueryEngineResultForStats(e,{field:i,normalizationField:n,valueExpression:s},r)).createClassBreaksResponse(t)}));function r(){return e.apply(this,arguments)}return r}(),G.executeQueryForHistogram=function(){var e=t._asyncToGenerator((function*(e={},t,r){const{field:i,normalizationField:n,valueExpression:s}=t;return(yield this._getQueryEngineResultForStats(e,{field:i,normalizationField:n,valueExpression:s},r)).createHistogramResponse(t)}));function r(){return e.apply(this,arguments)}return r}(),G.fetchRecomputedExtents=function(){var e=t._asyncToGenerator((function*(e){const[t,r]=yield Promise.all(["getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getBounds(yield this._getAllFeatures(),this.spatialReference,this.spatialReference),s.isSome(this._timeExtentPromise)?this._timeExtentPromise:this._timeExtentPromise=R.getTimeExtent(this.timeInfo,this.featureStore)]);return u.throwIfAborted(e),{fullExtent:t,timeExtent:r}}));function r(t){return e.apply(this,arguments)}return r}(),G._getBounds=function(){var e=t._asyncToGenerator((function*(e,t,r){const i=l.set(l.create(),l.NEGATIVE_INFINITY);yield this.featureStore.forEachBounds(e,(e=>l.expandWithAABB(i,e)));const n={xmin:i[0],ymin:i[1],xmax:i[3],ymax:i[4],spatialReference:Q.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(i[2])&&isFinite(i[5])&&(n.zmin=i[2],n.zmax=i[5]);const s=g.project(n,t,r);if(s.spatialReference=Q.cleanFromGeometryEngine(r),s.xmax-s.xmin==0){const e=o.getMetersPerUnitForSR(s.spatialReference);s.xmin-=e,s.xmax+=e}if(s.ymax-s.ymin==0){const e=o.getMetersPerUnitForSR(s.spatialReference);s.ymin-=e,s.ymax+=e}if(this.hasZ&&null!=s.zmin&&null!=s.zmax&&s.zmax-s.zmin==0){const e=o.getMetersPerUnitForSR(s.spatialReference);s.zmin-=e,s.zmax+=e}return s}));function r(t,r,i){return e.apply(this,arguments)}return r}(),G._schedule=function(){var e=t._asyncToGenerator((function*(e,t){return s.isSome(this._frameTask)?this._frameTask.schedule(e,t):e(T.noBudget)}));function r(t,r){return e.apply(this,arguments)}return r}(),G._reschedule=function(){var e=t._asyncToGenerator((function*(e,t){return s.isSome(this._frameTask)?this._frameTask.reschedule(e,t):e(T.noBudget)}));function r(t,r){return e.apply(this,arguments)}return r}(),G._getAllFeaturesQueryEngineResult=function(){var e=t._asyncToGenerator((function*(e){return new S.QueryEngineResult(yield this._getAllFeatures(),e,this)}));function r(t){return e.apply(this,arguments)}return r}(),G._getAllFeatures=function(){var e=t._asyncToGenerator((function*(){var e=this;if(s.isNone(this._allFeaturesPromise)){const r=[];this._allFeaturesPromise=t._asyncToGenerator((function*(){yield e.featureStore.forEach((e=>r.push(e)))}))().then((()=>r))}const r=this._allFeaturesPromise,i=yield r;return r===this._allFeaturesPromise?i.slice():this._getAllFeatures()}));function r(){return e.apply(this,arguments)}return r}(),G._executeQuery=function(){var e=t._asyncToGenerator((function*(e,t,r){e=n.clone(e),e=yield this._schedule((()=>Q.normalizeQuery(e,this.definitionExpression,this.spatialReference)),r),e=yield this._reschedule((()=>this._checkQuerySupport(e)),r),e={...e,...t};const i=yield this._reschedule((()=>this._executeSceneFilterQuery(e,r)),r),s=yield this._reschedule((()=>this._executeGeometryQuery(e,i,r)),r);return yield this._reschedule((()=>this._executeAggregateIdsQuery(s)),r),yield this._reschedule((()=>this._executeObjectIdsQuery(s)),r),yield this._reschedule((()=>this._executeTimeQuery(s)),r),yield this._reschedule((()=>this._executeAttributesQuery(s)),r),s}));function r(t,r,i){return e.apply(this,arguments)}return r}(),G._executeSceneFilterQuery=function(){var e=t._asyncToGenerator((function*(e,r){var i=this;if(s.isNone(e.sceneFilter))return null;const{outSR:n,returnGeometry:a,returnCentroid:u}=e,o=this.featureStore.featureSpatialReference,l=e.sceneFilter.geometry,c=s.isNone(o)||d.equals(o,l.spatialReference)?l:g.project(l,o);if(!c)return null;const h=a||u,y=d.isValid(n)&&!d.equals(this.spatialReference,n)&&h?function(){var e=t._asyncToGenerator((function*(e){return i._project(e,n)}));return function(t){return e.apply(this,arguments)}}():e=>e,f=this.featureAdapter,p=yield this._reschedule((()=>this._searchFeatures(this._getQueryBBoxes(c))),r);if("disjoint"===e.sceneFilter.spatialRelationship){if(!p.length)return null;const n=new Set;for(const e of p)n.add(f.getObjectId(e));const s=yield this._reschedule((()=>this._getAllFeatures()),r),a=yield this._reschedule(t._asyncToGenerator((function*(){const t=yield x.getSpatialQueryOperator("esriSpatialRelDisjoint",c,i.geometryType,i.hasZ,i.hasM),a=e=>!n.has(f.getObjectId(e))||t(f.getGeometry(e)),u=yield i._runSpatialFilter(s,a,r);return new S.QueryEngineResult(u,e,i)})),r);return y(a)}if(!p.length)return new S.QueryEngineResult([],e,this);if(this._canExecuteSinglePass(c,e))return y(new S.QueryEngineResult(p,e,this));const m=yield x.getSpatialQueryOperator("esriSpatialRelContains",c,this.geometryType,this.hasZ,this.hasM),_=yield this._runSpatialFilter(p,(e=>m(f.getGeometry(e))),r);return y(new S.QueryEngineResult(_,e,this))}));function r(t,r){return e.apply(this,arguments)}return r}(),G._executeGeometryQuery=function(){var e=t._asyncToGenerator((function*(e,i,n){var a=this;if(s.isSome(i)&&0===i.items.length)return i;e=s.isSome(i)?i.query:e;const{geometry:u,outSR:o,spatialRel:l,returnGeometry:c,returnCentroid:h}=e,y=this.featureStore.featureSpatialReference,f=!u||s.isNone(y)||d.equals(y,u.spatialReference)?u:g.project(u,y),p=c||h,m=d.isValid(o)&&!d.equals(this.spatialReference,o),_=this._geometryQueryCache&&s.isNone(i)?m&&p?JSON.stringify({originalFilterGeometry:u,spatialRelationship:l,outSpatialReference:o}):JSON.stringify({originalFilterGeometry:u,spatialRelationship:l}):null,R=_?this._geometryQueryCache.get(_):null;if(s.isSome(R))return new S.QueryEngineResult(R,e,this);const Q=function(){var e=t._asyncToGenerator((function*(e){return m&&p&&(yield a._project(e,o)),_&&a._geometryQueryCache.put(_,e.items,e.items.length+1),e}));return function(t){return e.apply(this,arguments)}}();if(!f)return Q(s.isSome(i)?i:yield this._getAllFeaturesQueryEngineResult(e));const F=this.featureAdapter;let E=yield this._reschedule((()=>this._searchFeatures(this._getQueryBBoxes(u))),n);if("esriSpatialRelDisjoint"===l){if(!E.length)return Q(s.isSome(i)?i:yield this._getAllFeaturesQueryEngineResult(e));const r=new Set;for(const e of E)r.add(F.getObjectId(e));const u=s.isSome(i)?i.items:yield this._reschedule((()=>this._getAllFeatures()),n),o=yield this._reschedule(t._asyncToGenerator((function*(){const t=yield x.getSpatialQueryOperator(l,f,a.geometryType,a.hasZ,a.hasM),i=e=>!r.has(F.getObjectId(e))||t(F.getGeometry(e)),s=yield a._runSpatialFilter(u,i,n);return new S.QueryEngineResult(s,e,a)})),n);return Q(o)}if(s.isSome(i)){const e=new r.PositionHint;E=E.filter((t=>r.indexOf(i.items,t,i.items.length,e)>=0))}if(!E.length){const t=new S.QueryEngineResult([],e,this);return _&&this._geometryQueryCache.put(_,t.items,1),t}if(this._canExecuteSinglePass(f,e))return Q(new S.QueryEngineResult(E,e,this));const T=yield x.getSpatialQueryOperator(l,f,this.geometryType,this.hasZ,this.hasM),v=yield this._runSpatialFilter(E,(e=>T(F.getGeometry(e))),n);return Q(new S.QueryEngineResult(v,e,this))}));function i(t,r,i){return e.apply(this,arguments)}return i}(),G._executeAggregateIdsQuery=function(e){if(0===e.items.length||!e.query.aggregateIds||!e.query.aggregateIds.length||s.isNone(this.aggregateAdapter))return;const t=new Set;for(const i of e.query.aggregateIds){this.aggregateAdapter.getFeatureObjectIds(i).forEach((e=>t.add(e)))}const r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))},G._executeObjectIdsQuery=function(e){if(0===e.items.length||!e.query.objectIds||!e.query.objectIds.length)return;const t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(r(e))))},G._executeTimeQuery=function(e){if(0===e.items.length)return;const t=R.getTimeOperator(this.timeInfo,e.query.timeExtent,this.featureAdapter);s.isNone(t)||(e.items=e.items.filter(t))},G._executeAttributesQuery=function(e){if(0===e.items.length)return;const t=m.getWhereClause(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((e=>t.testFeature(e,this.featureAdapter)))}},G._runSpatialFilter=function(){var e=t._asyncToGenerator((function*(e,r,i){var n=this;if(!r)return e;if(s.isNone(this._frameTask))return e.filter((e=>r(e)));let a=0;const u=new Array,o=function(){var s=t._asyncToGenerator((function*(t){for(;a<e.length;){const s=e[a++];r(s)&&(u.push(s),t.madeProgress()),t.done&&(yield n._reschedule((e=>o(e)),i))}}));return function(e){return s.apply(this,arguments)}}();return this._reschedule((e=>o(e)),i).then((()=>u))}));function r(t,r,i){return e.apply(this,arguments)}return r}(),G._filterLatest=function(e){const{trackIdField:t,startTimeField:r,endTimeField:i}=this.timeInfo,n=i||r,s=new Map,a=this.featureAdapter.getAttribute;for(const u of e.items){const e=a(u,t),r=a(u,n),i=s.get(e);(!i||r>a(i,n))&&s.set(e,u)}e.items=Array.from(s.values())},G._canExecuteSinglePass=function(e,t){const{spatialRel:r}=t;return x.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r||"esriSpatialRelWithin"===r))},G._project=function(){var e=t._asyncToGenerator((function*(e,t){if(!t||d.equals(this.spatialReference,t))return e;const r=this.featureAdapter,i=yield g.projectMany(e.items.map((e=>Q.getGeometry(this.geometryType,this.hasZ,this.hasM,r.getGeometry(e)))),this.spatialReference,t);return e.items=i.map(((t,i)=>r.cloneWithGeometry(e.items[i],p.convertFromGeometry(t,this.hasZ,this.hasM)))),e}));function r(t,r){return e.apply(this,arguments)}return r}(),G._getQueryBBoxes=function(e){if(x.canQueryWithRBush(e)){if(y.isExtent(e))return[c.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(y.isPolygon(e))return e.rings.map((e=>c.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[h.getBoundsXY(c.create(),e)]},G._searchFeatures=function(){var e=t._asyncToGenerator((function*(e){const t=new Set;yield Promise.all(e.map((e=>this.featureStore.forEachInBounds(e,(e=>t.add(e))))));const r=Array.from(t.values());return t.clear(),r}));function r(t){return e.apply(this,arguments)}return r}(),G._checkStatisticsSupport=function(){var e=t._asyncToGenerator((function*(e,t){if((e.distance??0)<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new i(I,"Unsupported query options",{query:e});return this._checkAttributesQuerySupport(e),Promise.all([this._checkStatisticsParamsSupport(t),x.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),g.checkProjectionSupport(this.spatialReference,e.outSR)]).then((()=>e))}));function r(t,r){return e.apply(this,arguments)}return r}(),G._checkStatisticsParamsSupport=function(){var e=t._asyncToGenerator((function*(e){let t=[];if(e.valueExpression){const{arcadeUtils:r}=yield E.loadArcade();t=r.extractFieldNames(e.valueExpression)}if(e.field&&t.push(e.field),e.field2&&t.push(e.field2),e.field3&&t.push(e.field3),e.normalizationField&&t.push(e.normalizationField),!t.length)throw new i(I,"params should have at least a field or valueExpression",{params:e});m.validateFields(this.fieldsIndex,t,"params contains missing fields")}));function r(t){return e.apply(this,arguments)}return r}(),G._checkQuerySupport=function(){var e=t._asyncToGenerator((function*(e){if((e.distance??0)<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new i(I,"Unsupported query options",{query:e});return this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),Promise.all([x.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),g.checkProjectionSupport(this.spatialReference,e.outSR)]).then((()=>e))}));function r(t){return e.apply(this,arguments)}return r}(),G._checkAttributesQuerySupport=function(e){const{outFields:t,orderByFields:r,returnDistinctValues:n,outStatistics:s}=e,a=s?s.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())).filter(Boolean):[];if(r&&r.length>0){const e=" asc",t=" desc",i=r.map((r=>{const i=r.toLowerCase();return i.includes(e)?i.split(e)[0]:i.includes(t)?i.split(t)[0]:r})).filter((e=>!a.includes(e)));m.validateFields(this.fieldsIndex,i,"orderByFields contains missing fields")}if(t&&t.length>0)m.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new i(I,"outFields should be specified for returnDistinctValues",{query:e});m.validateWhere(this.fieldsIndex,e.where)},G._checkStatisticsQuerySupport=function(e){const{outStatistics:t,groupByFieldsForStatistics:r,having:n}=e,s=r&&r.length,a=t&&t.length;if(n){if(!s||!a)throw new i(I,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});m.validateHaving(this.fieldsIndex,n,t)}if(a){if(!v(t))return;const n=t.map((e=>e.onStatisticField)).filter(Boolean);m.validateFields(this.fieldsIndex,n,"onStatisticFields contains missing fields"),s&&m.validateFields(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields");for(const r of t){const{onStatisticField:t,statisticType:n}=r;if(("percentile_disc"===n||"percentile_cont"===n)&&"statisticParameters"in r){const{statisticParameters:t}=r;if(!t)throw new i(I,"statisticParamters should be set for percentile type",{definition:r,query:e})}else if("count"!==n&&t&&m.hasInvalidFieldType(t,this.fieldsIndex))throw new i(I,"outStatistics contains non-numeric fields",{definition:r,query:e})}}},G._getQueryEngineResultForStats=function(){var e=t._asyncToGenerator((function*(e,t,r){e=n.clone(e);try{e=yield this._schedule((()=>Q.normalizeQuery(e,this.definitionExpression,this.spatialReference)),r),e=yield this._reschedule((()=>this._checkStatisticsSupport(e,t)),r);const i=yield this._reschedule((()=>this._executeSceneFilterQuery(e,r)),r),n=yield this._reschedule((()=>this._executeGeometryQuery(e,i,r)),r);return yield this._reschedule((()=>this._executeAggregateIdsQuery(n)),r),yield this._reschedule((()=>this._executeObjectIdsQuery(n)),r),yield this._reschedule((()=>this._executeTimeQuery(n)),r),yield this._reschedule((()=>this._executeAttributesQuery(n)),r),n}catch(i){if(i!==Q.QUERY_ENGINE_EMPTY_RESULT)throw i;return new S.QueryEngineResult([],e,this)}}));function r(t,r,i){return e.apply(this,arguments)}return r}(),t._createClass(e,[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}}]),e}();e.Feature=G,e.QueryEngine=A,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
