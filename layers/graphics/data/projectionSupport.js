/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../geometry/projection","../../../geometry/geometryAdapters/json","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils"],(function(e,n,t,r,s,i,o){"use strict";const a=[0,0];function u(e,n){if(!n)return null;if("x"in n){const t={x:0,y:0};return[t.x,t.y]=e(n.x,n.y,a),null!=n.z&&(t.z=n.z),null!=n.m&&(t.m=n.m),t}if("xmin"in n){const t={xmin:0,ymin:0,xmax:0,ymax:0};return[t.xmin,t.ymin]=e(n.xmin,n.ymin,a),[t.xmax,t.ymax]=e(n.xmax,n.ymax,a),n.hasZ&&(t.zmin=n.zmin,t.zmax=n.zmax,t.hasZ=!0),n.hasM&&(t.mmin=n.mmin,t.mmax=n.mmax,t.hasM=!0),t}return"rings"in n?{rings:c(n.rings,e),hasM:n.hasM,hasZ:n.hasZ}:"paths"in n?{paths:c(n.paths,e),hasM:n.hasM,hasZ:n.hasZ}:"points"in n?{points:l(n.points,e),hasM:n.hasM,hasZ:n.hasZ}:null}function c(e,n){const t=[];for(const r of e)t.push(l(r,n));return t}function l(e,n){const t=[];for(const r of e){const e=n(r[0],r[1],[0,0]);t.push(e),r.length>2&&e.push(r[2]),r.length>3&&e.push(r[3])}return t}function p(e,n){return m.apply(this,arguments)}function m(){return(m=n._asyncToGenerator((function*(e,n){if(!e||!n)return;const s=Array.isArray(e)?e.map((e=>t.isSome(e.geometry)?e.geometry.spatialReference:null)).filter(t.isSome):[e];yield r.initializeProjection(s.map((e=>({source:e,dest:n}))))}))).apply(this,arguments)}const h=u.bind(null,o.lngLatToXY),f=u.bind(null,o.xyToLngLat);function y(e,n,t,a){if(!e)return e;if(t||(t=n,n=e.spatialReference),!i.isValid(n)||!i.isValid(t)||i.equals(n,t))return e;if(o.canProject(n,t)){const n=i.isWebMercator(t)?h(e):f(e);return n.spatialReference=t,n}return r.projectMany(s.jsonAdapter,[e],n,t,null,a)[0]}let x=function(){function e(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}var t=e.prototype;return t.push=function(){var e=n._asyncToGenerator((function*(e,n,t){if(!e||!e.length||!n||!t||i.equals(n,t))return e;const r={geometries:e,inSpatialReference:n,outSpatialReference:t,resolve:null};return this._jobs.push(r),new Promise((e=>{r.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}));function t(n,t,r){return e.apply(this,arguments)}return t}(),t._process=function(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:n,inSpatialReference:t,outSpatialReference:a,resolve:u}=e;o.canProject(t,a)?i.isWebMercator(a)?u(n.map(h)):u(n.map(f)):u(r.projectMany(s.jsonAdapter,n,t,a,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))},e}();const g=new x;function j(e,n,t){return g.push(e,n,t)}e.checkProjectionSupport=p,e.project=y,e.projectMany=j,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
