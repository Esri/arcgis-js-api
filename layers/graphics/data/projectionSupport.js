/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils","../../../geometry/projection","../../../geometry/geometryAdapters/json"],(function(e,t,n,s,i){"use strict";const r=[0,0];function o(e,t){if(!t)return null;if("x"in t){const n={x:0,y:0};return[n.x,n.y]=e(t.x,t.y,r),null!=t.z&&(n.z=t.z),null!=t.m&&(n.m=t.m),n}if("xmin"in t){const n={xmin:0,ymin:0,xmax:0,ymax:0};return[n.xmin,n.ymin]=e(t.xmin,t.ymin,r),[n.xmax,n.ymax]=e(t.xmax,t.ymax,r),t.hasZ&&(n.zmin=t.zmin,n.zmax=t.zmax,n.hasZ=!0),t.hasM&&(n.mmin=t.mmin,n.mmax=t.mmax,n.hasM=!0),n}return"rings"in t?{rings:a(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:a(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:c(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function a(e,t){const n=[];for(const s of e)n.push(c(s,t));return n}function c(e,t){const n=[];for(const s of e){const e=t(s[0],s[1],[0,0]);n.push(e),s.length>2&&e.push(s[2]),s.length>3&&e.push(s[3])}return n}async function u(e,t){if(!t)return;const n=Array.isArray(e)?e.map((e=>{var t;return null==(t=e.geometry)?void 0:t.spatialReference})):[e];await s.initializeProjection(n.map((e=>({source:e,dest:t}))))}const l=o.bind(null,n.lngLatToXY),m=o.bind(null,n.xyToLngLat);function p(e,r,o){return e?(o||(o=r,r=e.spatialReference),t.isValid(r)&&t.isValid(o)&&!t.equals(r,o)?n.canProject(r,o)?t.isWebMercator(o)?l(e):m(e):s.projectMany(i.jsonAdapter,[e],r,o,null)[0]:e):e}const h=new(function(){function e(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}var r=e.prototype;return r.push=async function(e,n,s){!e||!e.length||!n||!s||t.equals(n,s);const i={geometries:e,inSpatialReference:n,outSpatialReference:s,resolve:null};return this._jobs.push(i),new Promise((e=>{i.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))},r._process=function(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:r,inSpatialReference:o,outSpatialReference:a,resolve:c}=e;n.canProject(o,a)?t.isWebMercator(a)?c(r.map(l)):c(r.map(m)):c(s.projectMany(i.jsonAdapter,r,o,a,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))},e}());async function f(e,t,n){return h.push(e,t,n)}e.checkProjectionSupport=u,e.project=p,e.projectMany=f,Object.defineProperty(e,"__esModule",{value:!0})}));
