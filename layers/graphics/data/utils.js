/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/jsonMap","../../../core/maybe","../../../core/unitUtils","../../../geometry/projection","../../../geometry/support/extentUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","../featureConversionUtils","../OptimizedGeometry","./projectionSupport"],(function(e,t,n,i,r,o,s,l,a,u,c,m,f,p){"use strict";const y=new i.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),g=Object.freeze({}),S=new f,d=new f,h=new f,R={esriGeometryPoint:m.convertToPoint,esriGeometryPolyline:m.convertToPolyline,esriGeometryPolygon:m.convertToPolygon,esriGeometryMultipoint:m.convertToMultipoint};function G(e,t,n,i=e.hasZ,o=e.hasM){if(r.isNone(t))return null;const s=e.hasZ&&i,l=e.hasM&&o;if(n){const r=m.quantizeOptimizedGeometry(h,t,e.hasZ,e.hasM,"esriGeometryPoint",n,i,o);return m.convertToPoint(r,s,l)}return m.convertToPoint(t,s,l)}function P(e,t,n,i,o,s,l=t,a=n){const u=t&&l,c=n&&a,f=r.isSome(i)?"coords"in i?i:i.geometry:null;if(r.isNone(f))return null;if(o){let i=m.generalizeOptimizedGeometry(d,f,t,n,e,o,l,a);return s&&(i=m.quantizeOptimizedGeometry(h,i,u,c,e,s)),R[e]?.(i,u,c)??null}if(s){const i=m.quantizeOptimizedGeometry(h,f,t,n,e,s,l,a);return R[e]?.(i,u,c)??null}return m.removeZMValues(S,f,t,n,l,a),R[e]?.(S,u,c)??null}function x(e,t,n){return z.apply(this,arguments)}function z(){return(z=n._asyncToGenerator((function*(e,t,n){const{outFields:i,orderByFields:r,groupByFieldsForStatistics:o,outStatistics:s}=e;if(i)for(let l=0;l<i.length;l++)i[l]=i[l].trim();if(r)for(let l=0;l<r.length;l++)r[l]=r[l].trim();if(o)for(let l=0;l<o.length;l++)o[l]=o[l].trim();if(s)for(let l=0;l<s.length;l++)s[l].onStatisticField&&(s[l].onStatisticField=s[l].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),M(e,t,n)}))).apply(this,arguments)}function M(e,t,n){return O.apply(this,arguments)}function O(){return(O=n._asyncToGenerator((function*(e,t,n){if(!e)return null;let{where:i}=e;if(e.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||t&&t===i)&&(e.where=null),!e.geometry)return e;let o=yield N(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;o=l.getGeometryExtent(o),o.spatialReference=t}if(o){yield p.checkProjectionSupport(o.spatialReference,n),o=_(o,n);const t=(yield u.normalizeCentralMeridian(a.fromJSON(o)))[0];if(r.isNone(t))throw g;const i="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,s=i&&U(o,n)?{densificationStep:8*i}:void 0,l=t.toJSON(),c=yield p.project(l,l.spatialReference,n,s);if(!c)throw g;c.spatialReference=n,e.geometry=c}return e}))).apply(this,arguments)}function U(e,t){if(!e)return!1;const n=e.spatialReference;return(a.isExtent(e)||a.isPolygon(e)||a.isPolyline(e))&&!c.equals(n,t)&&!s.canProjectWithoutEngine(n,t)}function _(e,t){const n=e.spatialReference;return U(e,t)&&a.isExtent(e)?{spatialReference:n,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}function N(e){return v.apply(this,arguments)}function v(){return(v=n._asyncToGenerator((function*(e){const{distance:t,units:n}=e,i=e.geometry;if(null==t||"vertexAttributes"in i)return i;const r=i.spatialReference,s=n?y.fromJSON(n):o.getUnitString(r),l=r&&(c.isGeographic(r)||c.isWebMercator(r))?i:yield p.checkProjectionSupport(r,c.WGS84).then((()=>p.project(i,c.WGS84)));return(yield T())(l.spatialReference,l,t,s)}))).apply(this,arguments)}function T(){return w.apply(this,arguments)}function w(){return(w=n._asyncToGenerator((function*(){return(yield new Promise(((t,n)=>e(["../../../geometry/geometryEngineJSON"],t,n)))).geodesicBuffer}))).apply(this,arguments)}function E(e){return e&&j in e?JSON.parse(JSON.stringify(e,b)):e}const j="_geVersion",b=(e,t)=>e!==j?t:void 0;t.QUERY_ENGINE_EMPTY_RESULT=g,t.cleanFromGeometryEngine=E,t.getGeometry=P,t.normalizeQuery=x,t.normalizeQueryLike=M,t.transformCentroid=G,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
