/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/jsonMap","../../../core/maybe","../../../core/unitUtils","../../../geometry/projection","../../../geometry/support/extentUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","../featureConversionUtils","../OptimizedGeometry","./projectionSupport"],(function(e,t,i,n,r,o,s,l,a,u,c,m,f,p){"use strict";const y=new n.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),g=Object.freeze({}),S=new f,d=new f,h=new f,R={esriGeometryPoint:m.convertToPoint,esriGeometryPolyline:m.convertToPolyline,esriGeometryPolygon:m.convertToPolygon,esriGeometryMultipoint:m.convertToMultipoint};function G(e,t,i,n=e.hasZ,o=e.hasM){if(r.isNone(t))return null;const s=e.hasZ&&n,l=e.hasM&&o;if(i){const r=m.quantizeOptimizedGeometry(h,t,e.hasZ,e.hasM,"esriGeometryPoint",i,n,o);return m.convertToPoint(r,s,l)}return m.convertToPoint(t,s,l)}function P(e,t,i,n,o,s,l=t,a=i){const u=t&&l,c=i&&a,f=r.isSome(n)?"coords"in n?n:n.geometry:null;if(r.isNone(f))return null;if(o){let n=m.generalizeOptimizedGeometry(d,f,t,i,e,o,l,a);return s&&(n=m.quantizeOptimizedGeometry(h,n,u,c,e,s)),R[e]?.(n,u,c)??null}if(s){const n=m.quantizeOptimizedGeometry(h,f,t,i,e,s,l,a);return R[e]?.(n,u,c)??null}return m.removeZMValues(S,f,t,i,l,a),R[e]?.(S,u,c)??null}function x(e,t,i){return M.apply(this,arguments)}function M(){return(M=i._asyncToGenerator((function*(e,t,i){const{outFields:n,orderByFields:r,groupByFieldsForStatistics:o,outStatistics:s}=e;if(n)for(let l=0;l<n.length;l++)n[l]=n[l].trim();if(r)for(let l=0;l<r.length;l++)r[l]=r[l].trim();if(o)for(let l=0;l<o.length;l++)o[l]=o[l].trim();if(s)for(let l=0;l<s.length;l++)s[l].onStatisticField&&(s[l].onStatisticField=s[l].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),_(e,t,i)}))).apply(this,arguments)}function _(e,t,i){return z.apply(this,arguments)}function z(){return(z=i._asyncToGenerator((function*(e,t,i){if(!e)return null;let{where:n}=e;if(e.where=n=n&&n.trim(),(!n||/^1 *= *1$/.test(n)||t&&t===n)&&(e.where=null),!e.geometry)return e;let o=yield v(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;o=l.getGeometryExtent(o),o.spatialReference=t}if(o){yield p.checkProjectionSupport(o.spatialReference,i),o=U(o,i);const t=(yield u.normalizeCentralMeridian(a.fromJSON(o)))[0];if(r.isNone(t))throw g;const n="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,s=n&&O(o,i)?{densificationStep:8*n}:void 0,l=t.toJSON(),c=yield p.project(l,l.spatialReference,i,s);if(!c)throw g;c.spatialReference=i,e.geometry=c}return e}))).apply(this,arguments)}function O(e,t){if(!e)return!1;const i=e.spatialReference;return(a.isExtent(e)||a.isPolygon(e)||a.isPolyline(e))&&!c.equals(i,t)&&!s.canProjectWithoutEngine(i,t)}function U(e,t){const i=e.spatialReference;return O(e,t)&&a.isExtent(e)?{spatialReference:i,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}function v(e){return N.apply(this,arguments)}function N(){return(N=i._asyncToGenerator((function*(e){const{distance:t,units:i}=e,n=e.geometry;if(null==t||"vertexAttributes"in n)return n;const r=n.spatialReference,s=i?y.fromJSON(i):o.getUnitString(r),l=r&&(c.isGeographic(r)||c.isWebMercator(r))?n:yield p.checkProjectionSupport(r,c.WGS84).then((()=>p.project(n,c.WGS84)));return(yield T())(l.spatialReference,l,t,s)}))).apply(this,arguments)}function T(){return w.apply(this,arguments)}function w(){return(w=i._asyncToGenerator((function*(){return(yield new Promise(((t,i)=>e(["../../../geometry/geometryEngineJSON"],t,i)))).geodesicBuffer}))).apply(this,arguments)}function E(e){return e&&j in e?JSON.parse(JSON.stringify(e,b)):e}const j="_geVersion",b=(e,t)=>e!==j?t:void 0;t.QUERY_ENGINE_EMPTY_RESULT=g,t.cleanFromGeometryEngine=E,t.getGeometry=P,t.normalizeQuery=x,t.normalizeQueryLike=_,t.transformCentroid=G,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
