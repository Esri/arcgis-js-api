/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Error","../../OptimizedFeature","../../OptimizedGeometry"],(function(e,t,n,o){"use strict";function r(e){const t=[];return e.forEach((e=>t.push(e))),t}const i={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*s(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*u(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function c(e){for(;;){const{value:t,done:n}=e.next();if(n)return!1;if(t.length>2)return!0}}function l(e){let t=0;for(let n=0;n<e.length;n++){const o=e[n],r=e[(n+1)%e.length];t+=o[0]*r[1]-r[0]*o[1]}return t<=0}function f(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function a(e,t,n){switch(t.type){case"LineString":return function(e,t,n){return p(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function(e,t,n){for(const o of t.coordinates)p(e,o,n);return e}(e,t,n);case"MultiPoint":return function(e,t,n){return p(e,t.coordinates,n),e}(e,t,n);case"MultiPolygon":return function(e,t,n){for(const o of t.coordinates){y(e,o[0],n);for(let t=1;t<o.length;t++)d(e,o[t],n)}return e}(e,t,n);case"Point":return function(e,t,n){return h(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function(e,t,n){const o=t.coordinates;y(e,o[0],n);for(let t=1;t<o.length;t++)d(e,o[t],n);return e}(e,t,n)}}function y(e,t,n){const o=f(t);l(o)?p(e,o,n):g(e,o,n)}function d(e,t,n){const o=f(t);l(o)?g(e,o,n):p(e,o,n)}function p(e,t,n){for(const o of t)h(e,o,n);e.lengths.push(t.length)}function g(e,t,n){for(let o=t.length-1;o>=0;o--)h(e,t[o],n);e.lengths.push(t.length)}function h(e,t,n){const[o,r,i]=t;e.coords.push(o,r),n.hasZ&&e.coords.push(i||0)}function m(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}e.createOptimizedFeatures=function(e,t){return function(e){const t=[];for(;;){const{value:n,done:o}=e.next();if(o)return t;t.push(n)}}(function*(e,t={}){const{geometryType:r,objectIdFieldName:s}=t;for(;;){const{value:u,done:c}=e.next();if(c)return;const{geometry:l,properties:f,id:y}=u;if(l&&i[l.type]!==r)continue;const d=f||{};s&&null!=y&&!d[s]&&(d[s]=y);const p=new n(l?a(new o,l,t):null,d);yield p}}(s(e),t))},e.inferLayerProperties=function(e,t={}){const n=s(e),o=[],l=new Set,f=new Set;let a,y=!1,d=Number.NEGATIVE_INFINITY,p=null,g=!1,{geometryType:h=null}=t,P=!1;for(;;){const{value:e,done:t}=n.next();if(t){const e=p&&1===p.length&&p[0]||null;if(e)for(const t of o)t.name===e&&(t.type="esriFieldTypeOID");return{fields:o,geometryType:h,hasZ:y,maxObjectId:Math.max(0,d),objectIdFieldName:e,objectIdFieldType:a,unknownFields:r(f)}}const{geometry:s,properties:b,id:w}=e;if(!s||(h||(h=i[s.type]),i[s.type]===h)){if(!y){y=c(u(s))}if(g||(g=null!=w,g&&(a=typeof w,"number"===a&&(p=Object.keys(b).filter((e=>b[e]===w))))),g&&"number"===a&&null!=w&&(d=Math.max(d,w),p.length>1?p=p.filter((e=>b[e]===w)):1===p.length&&(p=b[p[0]]===w?p:[])),!P&&b){let e=!0;for(const t in b){if(l.has(t))continue;const n=b[t];if(null==n){e=!1,f.add(t);continue}const r=m(n);"unknown"!==r?(f.delete(t),l.add(t),o.push({name:t,alias:t,type:r})):f.add(t)}P=e}}}},e.validateGeoJSON=function(e){if(!e)throw new t("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new t("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:n}=e;if(!n)return;const o="string"==typeof n?n:"name"===n.type?n.properties.name:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!r.test(o))throw new t("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})},Object.defineProperty(e,"__esModule",{value:!0})}));
