/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Error","../../OptimizedFeature","../../OptimizedGeometry"],(function(e,t,n,o){"use strict";function r(e){const t=[];for(;;){const{value:n,done:o}=e.next();if(o)return t;t.push(n)}}function i(e){const t=[];return e.forEach((e=>t.push(e))),t}const s={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*u(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*c(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function*l(e,t={}){const{geometryType:r,objectIdFieldName:i}=t;for(;;){const{value:u,done:c}=e.next();if(c)return;const{geometry:l,properties:f,id:a}=u;if(l&&s[l.type]!==r)continue;const y=f||{};i&&null!=a&&!y[i]&&(y[i]=a);const d=new n(l?g(new o,l,t):null,y);yield d}}function f(e){for(;;){const{value:t,done:n}=e.next();if(n)return!1;if(t.length>2)return!0}}function a(e){return!d(e)}function y(e){return d(e)}function d(e){let t=0;for(let n=0;n<e.length;n++){const o=e[n],r=e[(n+1)%e.length];t+=o[0]*r[1]-r[0]*o[1]}return t<=0}function p(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function g(e,t,n){switch(t.type){case"LineString":return h(e,t,n);case"MultiLineString":return m(e,t,n);case"MultiPoint":return P(e,t,n);case"MultiPolygon":return b(e,t,n);case"Point":return w(e,t,n);case"Polygon":return F(e,t,n)}}function h(e,t,n){return j(e,t.coordinates,n),e}function m(e,t,n){for(const o of t.coordinates)j(e,o,n);return e}function P(e,t,n){return j(e,t.coordinates,n),e}function b(e,t,n){for(const o of t.coordinates){S(e,o[0],n);for(let t=1;t<o.length;t++)M(e,o[t],n)}return e}function w(e,t,n){return O(e,t.coordinates,n),e}function F(e,t,n){const o=t.coordinates;S(e,o[0],n);for(let r=1;r<o.length;r++)M(e,o[r],n);return e}function S(e,t,n){const o=p(t);a(o)?G(e,o,n):j(e,o,n)}function M(e,t,n){const o=p(t);y(o)?G(e,o,n):j(e,o,n)}function j(e,t,n){for(const o of t)O(e,o,n);e.lengths.push(t.length)}function G(e,t,n){for(let o=t.length-1;o>=0;o--)O(e,t[o],n);e.lengths.push(t.length)}function O(e,t,n){const[o,r,i]=t;e.coords.push(o,r),n.hasZ&&e.coords.push(i||0)}function N(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function x(e){if(!e)throw new t("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new t("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:n}=e;if(!n)return;const o="string"==typeof n?n:"name"===n.type?n.properties.name:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!r.test(o))throw new t("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function I(e,t={}){const n=u(e),o=[],r=new Set,l=new Set;let a,y=!1,d=Number.NEGATIVE_INFINITY,p=null,g=!1,{geometryType:h=null}=t,m=!1;for(;;){const{value:e,done:t}=n.next();if(t){const e=p&&1===p.length&&p[0]||null;if(e)for(const t of o)t.name===e&&(t.type="esriFieldTypeOID");return{fields:o,geometryType:h,hasZ:y,maxObjectId:Math.max(0,d),objectIdFieldName:e,objectIdFieldType:a,unknownFields:i(l)}}const{geometry:u,properties:P,id:b}=e;if(!u||(h||(h=s[u.type]),s[u.type]===h)){if(!y){y=f(c(u))}if(g||(g=null!=b,g&&(a=typeof b,"number"===a&&(p=Object.keys(P).filter((e=>P[e]===b))))),g&&"number"===a&&null!=b&&(d=Math.max(d,b),p.length>1?p=p.filter((e=>P[e]===b)):1===p.length&&(p=P[p[0]]===b?p:[])),!m&&P){let e=!0;for(const t in P){if(r.has(t))continue;const n=P[t];if(null==n){e=!1,l.add(t);continue}const i=N(n);"unknown"!==i?(l.delete(t),r.add(t),o.push({name:t,alias:t,type:i})):l.add(t)}m=e}}}}function T(e,t){return r(l(u(e),t))}e.createOptimizedFeatures=T,e.inferLayerProperties=I,e.validateGeoJSON=x,Object.defineProperty(e,"__esModule",{value:!0})}));
