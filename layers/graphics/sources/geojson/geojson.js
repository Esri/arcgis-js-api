/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../core/Error","../../OptimizedFeature","../../OptimizedGeometry"],(function(e,t,n,o){"use strict";const r={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function i(e){return r[e]}function*s(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*u(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function*c(e,t={}){const{geometryType:r,objectIdField:s}=t;for(const c of e){var u;const{geometry:e,properties:l,id:f}=c;if(e&&i(e.type)!==r)continue;const a=l||{};let y=null!=(u=a[s])?u:null;s&&null!=f&&!a[s]&&(a[s]=y=f);const d=new n.default(e?p(new o,e,t):null,a,null,y);yield d}}function l(e){for(const t of e)if(t.length>2)return!0;return!1}function f(e){return!y(e)}function a(e){return y(e)}function y(e){let t=0;for(let n=0;n<e.length;n++){const o=e[n],r=e[(n+1)%e.length];t+=o[0]*r[1]-r[0]*o[1]}return t<=0}function d(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function p(e,t,n){switch(t.type){case"LineString":return g(e,t,n);case"MultiLineString":return m(e,t,n);case"MultiPoint":return h(e,t,n);case"MultiPolygon":return P(e,t,n);case"Point":return b(e,t,n);case"Polygon":return w(e,t,n)}}function g(e,t,n){return G(e,t.coordinates,n),e}function m(e,t,n){for(const o of t.coordinates)G(e,o,n);return e}function h(e,t,n){return G(e,t.coordinates,n),e}function P(e,t,n){for(const o of t.coordinates){S(e,o[0],n);for(let t=1;t<o.length;t++)F(e,o[t],n)}return e}function b(e,t,n){return j(e,t.coordinates,n),e}function w(e,t,n){const o=t.coordinates;S(e,o[0],n);for(let r=1;r<o.length;r++)F(e,o[r],n);return e}function S(e,t,n){const o=d(t);f(o)?M(e,o,n):G(e,o,n)}function F(e,t,n){const o=d(t);a(o)?M(e,o,n):G(e,o,n)}function G(e,t,n){for(const o of t)j(e,o,n);e.lengths.push(t.length)}function M(e,t,n){for(let o=t.length-1;o>=0;o--)j(e,t[o],n);e.lengths.push(t.length)}function j(e,t,n){const[o,r,i]=t;e.coords.push(o,r),n.hasZ&&e.coords.push(i||0)}function O(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function T(e){if(!e)throw new t("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new t("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:n}=e;if(!n)return;const o="string"==typeof n?n:"name"===n.type?n.properties.name:"EPSG"===n.type?n.properties.code:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!r.test(o))throw new t("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function I(e,t={}){const n=[],o=new Set,r=new Set;let c,f=!1,a=Number.NEGATIVE_INFINITY,y=null,d=!1,{geometryType:p=null}=t,g=!1;for(const h of s(e)){const{geometry:e,properties:t,id:s}=h;if(!e||(p||(p=i(e.type)),i(e.type)===p)){if(!f){f=l(u(e))}if(d||(d=null!=s,d&&(c=typeof s,"number"===c&&(y=Object.keys(t).filter((e=>t[e]===s))))),d&&"number"===c&&null!=s&&(a=Math.max(a,s),y.length>1?y=y.filter((e=>t[e]===s)):1===y.length&&(y=t[y[0]]===s?y:[])),!g&&t){let e=!0;for(const i in t){if(o.has(i))continue;const s=t[i];if(null==s){e=!1,r.add(i);continue}const u=O(s);"unknown"!==u?(r.delete(i),o.add(i),n.push({name:i,alias:i,type:u})):r.add(i)}g=e}}}const m=y&&1===y.length&&y[0]||null;if(m)for(const i of n)i.name===m&&(i.type="esriFieldTypeOID");return{fields:n,geometryType:p,hasZ:f,maxObjectId:Math.max(0,a),objectIdFieldName:m,objectIdFieldType:c,unknownFields:Array.from(r)}}function N(e,t){return Array.from(c(s(e),t))}e.createOptimizedFeatures=N,e.getGeometryType=i,e.inferLayerProperties=I,e.validateGeoJSON=T,Object.defineProperty(e,"__esModule",{value:!0})}));
