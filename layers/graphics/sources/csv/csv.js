/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../../core/number"],(function(e,t){"use strict";const n=/^\s*"([\S\s]*)"\s*$/,i=/""/g,r="\n",l=[","," ",";","|","\t"];function*o(e,t,n){let i=0;for(;i<=e.length;){const r=e.indexOf(t,i),l=e.substring(i,r>-1?r:void 0);i+=l.length+t.length,n&&!l.trim()||(yield l)}}function s(e){const t=e.includes("\r\n")?"\r\n":r;return o(e,t,!0)}function a(e,t){return o(e,t,!1)}function u(e,t,n){e=e.trim(),t=t?.trim();const i=[],r=Array.from(new Set([n?.delimiter,...l])).filter((e=>null!=e));for(const l of r){const n=d(e,l).length,r=d(t,l).length??n;n>1&&i.push({weight:Math.min(n,r),delimiter:l})}const o=i.sort((({weight:e},{weight:t})=>t-e)).map((({delimiter:e})=>e));for(const l of o){const t=m(f(e,l).names,n?.longitudeField,n?.latitudeField);if(t.longitudeFieldName&&t.latitudeFieldName)return{delimiter:l,locationInfo:t}}return{delimiter:o[0],locationInfo:null}}function*c(e,t,l,o=(()=>Object.create(null))){const u=s(e);u.next();let c="",f="",d=0,m=o(),p=0;e:for(const s of u){const e=a(s,l);for(const r of e)if(c+=f+r,f="",d+=g(r),d%2==0){if(d>0){const e=n.exec(c);if(!e){m=o(),p=0,c="",d=0;continue e}m[t[p]]=e[1].replace(i,'"'),p++}else m[t[p]]=c,p++;c="",d=0}else f=l;0===d?(yield m,m=o(),p=0):f=r}}function f(e,t){const n=d(e,t).filter((e=>null!=e)),i=n.map((e=>v(e)));for(let r=i.length-1;r>=0;r--)i[r]||(i.splice(r,1),n.splice(r,1));return{names:i,aliases:n}}function d(e,t){if(!e?.length)return[];const r=[];let l="",o="",s=0;const u=a(e,t);for(const a of u)if(l+=o+a,o="",s+=g(a),s%2==0){if(s>0){const e=n.exec(l);e&&r.push(e[1].replace(i,'"'))}else r.push(l);l="",s=0}else o=t;return r}function g(e){let t=0,n=0;for(n=e.indexOf('"',n);n>=0;)t++,n=e.indexOf('"',n+1);return t}function m(e,t,n){t=v(t)?.toLowerCase(),n=v(n)?.toLowerCase();const i=e.map((e=>e.toLowerCase())),r=t?e[i.indexOf(t)]:null,l=n?e[i.indexOf(n)]:null;return{longitudeFieldName:r||e[i.indexOf(w.find((e=>i.includes(e))))],latitudeFieldName:l||e[i.indexOf(F.find((e=>i.includes(e))))]}}function p(e,t,n,i,r){const l=[],o=c(e,n,t),s=[];for(const a of o){if(10===s.length)break;s.push(a)}for(let a=0;a<n.length;a++){const e=n[a],t=i[a];if(e===r.longitudeFieldName||e===r.latitudeFieldName)l.push({name:e,type:"esriFieldTypeDouble",alias:t});else{let n,i;switch(b(s.map((t=>t[e])))){case"integer":n="esriFieldTypeInteger";break;case"double":n="esriFieldTypeDouble";break;case"date":n="esriFieldTypeDate",i=36;break;default:n="esriFieldTypeString",i=255}l.push({name:e,type:n,alias:t,length:i})}}return l}function b(e){if(!e.length)return"string";const t=/[^+-.,0-9]/;return e.map((e=>{let n=!1;if(""!==e){if(t.test(e))n=!0;else{let t=h(e);if(!isNaN(t))return/[.,]/.test(e)||!Number.isInteger(t)||t>214783647||t<-214783648?"double":"integer";if(e.includes("E")){if(t=Number(e),!isNaN(t))return"double";if(e.includes(",")){if(e=e.replace(",","."),t=Number(e),!isNaN(t))return"double";n=!0}else n=!0}else n=!0}if(n){if(!/^[-]?\d*[.,]?\d*$/.test(e)){return N(new Date(e),e)?"date":"string"}return"string"}return"string"}})).reduce(((e,t)=>void 0===e?t:void 0===t?e:e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0))}function N(e,t){if(!e||"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime()))return!1;let n=!0;if(!x&&/\d+\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,i=0;for(;!t&&i<=e.length;)t=!y.test(e[i]),i++;n=!t}}return n}const h=function(){const e=t._parseInfo(),n=new RegExp("^"+e.regexp+"$"),i=new RegExp("["+e.group+"\\s\\xa0]","g"),r=e.factor;return t=>{const l=n.exec(t);if(e.factor=r,!l)return NaN;let o=l[1];if(!l[1]){if(!l[2])return NaN;o=l[2],e.factor*=-1}return o=o.replace(i,"").replace(e.decimal,"."),+o*e.factor}}(),y=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,x=Number.isNaN(new Date("technology 10").getTime()),F=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],w=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"],_=/^([0-9])/,O=/[^A-Za-z0-9_\u0080-\uffff]/g,T=/_{2,}/g,D=/^_/,j=/_$/;function v(e){return e?e.trim().replace(O,"_").replace(T,"_").replace(D,"").replace(j,"").replace(_,"F$1"):null}e.extractFieldNamesAndAliasesFromRow=f,e.inferDelimiterAndLocationInfo=u,e.inferFieldType=b,e.inferFields=p,e.isValidDate=N,e.normalizeFieldName=v,e.parseNumber=h,e.parseRows=c,e.readRowParts=a,e.readRows=s,e.splitSingleRow=d,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
