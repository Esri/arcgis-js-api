/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/maybe","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/Error","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../geometry/support/spatialReferenceUtils","../../../geometry/SpatialReference","../../../geometry/Extent","../../../geometry/support/typeUtils","../../../geometry","../../../core/Loadable","../../ogc/ogcFeatureUtils"],(function(e,t,r,o,n,i,l,c,u,a,s,p,y,d,f,g,S,h,m,v){"use strict";const F="http://www.opengis.net/def/crs/OGC/1.3/CRS84";e.OGCFeatureSource=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).collection=null,t.conformance=null,t.landingPage=null,t.layerDefinition=null,t.type="ogc-feature",t}t._inheritsLoose(r,e);var o=r.prototype;return o.load=function(e){const t=n.isSome(e)?e.signal:null,{collectionId:r,fields:o,geometryType:i,hasZ:l,objectIdField:c,timeInfo:u,url:s}=this.layer,p={fields:null==o?void 0:o.map((e=>e.toJSON())),geometryType:S.typeKebabDictionary.toJSON(i),hasZ:l,objectIdField:c,timeInfo:null==u?void 0:u.toJSON()};return this.addResolvingPromise(Promise.all([v.getServerLandingPage(s,t),v.getServerConformance(s,t),v.getServerCollection(s,r,t),v.getCollectionDefinition(s,r,p,t)]).then((e=>{const[t,r,o,n]=e;this.set({landingPage:t,conformance:r,collection:o,layerDefinition:n});const i=new RegExp(`^https?:${"//www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"}$`,"i");if(!(null==r?void 0:r.conformsTo.some((e=>i.test(e)))))throw new a("ogc-feature-layer:no-geojson-support","Server does not support geojson")}))),this.when()},o.getFeatureDefinition=function(){var e;const{collection:t,layer:{capabilities:r,collectionId:o,spatialReference:n,url:i},layerDefinition:l}=this,c=null!=(e=null==t?void 0:t.crs)?e:[F];return{capabilities:r,collectionId:o,layerDefinition:l,spatialReference:n.toJSON(),supportedCrs:c,url:i}},o.queryExtent=function(e,t={}){return null},o.queryFeatureCount=function(e,t={}){return null},o.queryFeatures=function(e,t={}){const r=this.getFeatureDefinition();return this.load(t).then((()=>v.queryFeatureSet(r,e,t)))},o.queryFeaturesJSON=function(e,t={}){const r=this.getFeatureDefinition();return this.load(t).then((()=>v.queryFeatureSetJSON(r,e,t)))},o.queryObjectIds=function(e,t={}){return null},o.supportsSpatialReference=function(e){var t,r;if(e.isWGS84||e.isWebMercator)return!0;return(null!=(t=null==(r=this.collection)?void 0:r.crs)?t:[F]).some((t=>{const r=v.getSpatialReference(t);return!!r&&d.equals(r,e)}))},t._createClass(r,[{key:"fullExtent",get:function(){var e,t;const r=null==(e=this.collection)||null==(t=e.extent)?void 0:t.spatial;if(!r)return null;const o=r.bbox[0],n=4===o.length,i=o[0],l=o[1],c=n?void 0:o[2],u=n?o[2]:o[3],a=n?o[3]:o[4],s=n?void 0:o[5],p=f.WGS84;return new g({xmin:i,ymin:l,xmax:u,ymax:a,zmin:c,zmax:s,spatialReference:p})}},{key:"spatialReference",get:function(){var e;const t=null!=(e=this.collection.storageCrs)?e:F,r=v.getSpatialReference(t);return r||f.WGS84}}]),r}(m),r.__decorate([c.property()],e.OGCFeatureSource.prototype,"collection",void 0),r.__decorate([c.property()],e.OGCFeatureSource.prototype,"conformance",void 0),r.__decorate([c.property({readOnly:!0,type:g})],e.OGCFeatureSource.prototype,"fullExtent",null),r.__decorate([c.property()],e.OGCFeatureSource.prototype,"landingPage",void 0),r.__decorate([c.property({constructOnly:!0})],e.OGCFeatureSource.prototype,"layer",void 0),r.__decorate([c.property()],e.OGCFeatureSource.prototype,"layerDefinition",void 0),r.__decorate([c.property()],e.OGCFeatureSource.prototype,"spatialReference",null),r.__decorate([c.property()],e.OGCFeatureSource.prototype,"type",void 0),e.OGCFeatureSource=r.__decorate([u.subclass("esri.layers.graphics.sources.OGCFeatureSource")],e.OGCFeatureSource);var O=e.OGCFeatureSource;e.default=O,Object.defineProperty(e,"__esModule",{value:!0})}));
