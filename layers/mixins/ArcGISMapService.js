/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../request","../../core/promiseUtils","../../core/urlUtils","../../core/Version","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/Logger","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../geometry/Extent","../../geometry/SpatialReference","../support/commonProperties"],(function(e,r,t,o,s,p,i,a,n,l,u,c,y,d,b,h){"use strict";const f=e=>{let n=function(e){function t(){var r;return(r=e.apply(this,arguments)||this).capabilities=void 0,r.copyright=null,r.fullExtent=null,r.legendEnabled=!0,r.spatialReference=null,r.version=null,r}r._inheritsLoose(t,e);var a=t.prototype;return a.readCapabilities=function(e,r){const t=r.capabilities&&r.capabilities.split(",").map((e=>e.toLowerCase().trim()));if(!t)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const o=this.type,s=-1!==t.indexOf("query"),p=-1!==t.indexOf("map"),a=!!r.exportTilesAllowed,n=-1!==t.indexOf("tilemap"),l="tile"!==o&&!!r.supportsDynamicLayers,u="tile"!==o&&(!r.tileInfo||l),c="tile"!==o&&(!r.tileInfo||l),y="tile"!==o,d=!!r.cimVersion&&i.Version.parse(r.cimVersion).since(1,4);return{operations:{supportsQuery:s,supportsExportMap:p,supportsExportTiles:a,supportsTileMap:n},exportMap:p?{supportsArcadeExpressionForLabeling:d,supportsSublayersChanges:y,supportsDynamicLayers:l,supportsSublayerVisibility:u,supportsSublayerDefinitionExpression:c}:null,exportTiles:a?{maxExportTilesCount:+r.maxExportTilesCount}:null}},a.readVersion=function(e,r){let t=r.currentVersion;return t||(t=r.hasOwnProperty("capabilities")||r.hasOwnProperty("tables")?10:r.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),t},a.fetchSublayerInfo=function(){var e=r._asyncToGenerator((function*(e,r){return yield this.fetchAllLayersAndTables(r),this._allLayersAndTablesMap.get(e)}));function t(r,t){return e.apply(this,arguments)}return t}(),a.fetchAllLayersAndTables=function(){var e=r._asyncToGenerator((function*(e){yield this.load(e),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=o(p.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then((e=>{this._allLayersAndTablesMap=new Map;for(const r of e.data.layers)this._allLayersAndTablesMap.set(r.id,r);return{result:e.data}}),(e=>({error:e}))));const r=yield this._allLayersAndTablesPromise;if(s.throwIfAborted(e),"result"in r)return r.result;throw r.error}));function t(r){return e.apply(this,arguments)}return t}(),t}(e);return t.__decorate([a.property({readOnly:!0})],n.prototype,"capabilities",void 0),t.__decorate([c.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],n.prototype,"readCapabilities",null),t.__decorate([a.property({json:{read:{source:"copyrightText"}}})],n.prototype,"copyright",void 0),t.__decorate([a.property({type:d})],n.prototype,"fullExtent",void 0),t.__decorate([a.property(h.id)],n.prototype,"id",void 0),t.__decorate([a.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],n.prototype,"legendEnabled",void 0),t.__decorate([a.property(h.popupEnabled)],n.prototype,"popupEnabled",void 0),t.__decorate([a.property({type:b})],n.prototype,"spatialReference",void 0),t.__decorate([a.property()],n.prototype,"version",void 0),t.__decorate([c.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],n.prototype,"readVersion",null),n=t.__decorate([y.subclass("esri.layers.mixins.ArcGISMapService")],n),n};e.ArcGISMapService=f,Object.defineProperty(e,"__esModule",{value:!0})}));
