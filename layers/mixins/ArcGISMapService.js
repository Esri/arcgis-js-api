/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/promiseUtils","../../geometry/SpatialReference","../../geometry/Extent","../../request","../support/commonProperties"],(function(e,r,t,o,s,p,a,i,l,n,u,c,d,y,b,h,_){"use strict";e.ArcGISMapService=e=>{let o=function(e){function t(){var r;return(r=e.apply(this,arguments)||this).capabilities=void 0,r.copyright=null,r.fullExtent=null,r.legendEnabled=!0,r.spatialReference=null,r.version=null,r}r._inheritsLoose(t,e);var o=t.prototype;return o.readCapabilities=function(e,r){const t=r.capabilities&&r.capabilities.split(",").map((e=>e.toLowerCase().trim()));if(!t)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const o=this.type,s=-1!==t.indexOf("query"),p=-1!==t.indexOf("map"),a=!!r.exportTilesAllowed,i=-1!==t.indexOf("tilemap"),l="tile"!==o&&!!r.supportsDynamicLayers,n="tile"!==o&&(!r.tileInfo||l),u="tile"!==o&&(!r.tileInfo||l);return{operations:{supportsQuery:s,supportsExportMap:p,supportsExportTiles:a,supportsTileMap:i},exportMap:p?{supportsSublayersChanges:"tile"!==o,supportsDynamicLayers:l,supportsSublayerVisibility:n,supportsSublayerDefinitionExpression:u}:null,exportTiles:a?{maxExportTilesCount:+r.maxExportTilesCount}:null}},o.readVersion=function(e,r){let t=r.currentVersion;return t||(t=r.hasOwnProperty("capabilities")||r.hasOwnProperty("tables")?10:r.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),t},o.fetchSublayerInfo=async function(e,r){return await this.fetchAllLayersAndTables(r),this._allLayersAndTablesMap.get(e)},o.fetchAllLayersAndTables=async function(e){await this.load(e),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=h(n.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then((e=>{this._allLayersAndTablesMap=new Map;for(const r of e.data.layers)this._allLayersAndTablesMap.set(r.id,r);return{result:e.data}}),(e=>({error:e}))));const r=await this._allLayersAndTablesPromise;if(d.throwIfAborted(e),"result"in r)return r.result;throw r.error},t}(e);return t.__decorate([a.property({readOnly:!0})],o.prototype,"capabilities",void 0),t.__decorate([i.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],o.prototype,"readCapabilities",null),t.__decorate([a.property({json:{read:{source:"copyrightText"}}})],o.prototype,"copyright",void 0),t.__decorate([a.property({type:b})],o.prototype,"fullExtent",void 0),t.__decorate([a.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],o.prototype,"id",void 0),t.__decorate([a.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],o.prototype,"legendEnabled",void 0),t.__decorate([a.property(_.popupEnabled)],o.prototype,"popupEnabled",void 0),t.__decorate([a.property({type:y})],o.prototype,"spatialReference",void 0),t.__decorate([a.property()],o.prototype,"version",void 0),t.__decorate([i.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],o.prototype,"readVersion",null),o=t.__decorate([l.subclass("esri.layers.mixins.ArcGISMapService")],o),o},Object.defineProperty(e,"__esModule",{value:!0})}));
