/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../request","../../core/promiseUtils","../../core/urlUtils","../../core/Version","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../geometry/Extent","../../geometry/SpatialReference","../support/commonProperties"],(function(e,r,t,o,s,p,a,i,l,n,u,c,y,d,b){"use strict";const h=e=>{let l=function(e){function t(){var r;return(r=e.apply(this,arguments)||this).capabilities=void 0,r.copyright=null,r.fullExtent=null,r.legendEnabled=!0,r.spatialReference=null,r.version=void 0,r._allLayersAndTablesPromise=null,r._allLayersAndTablesMap=null,r}r._inheritsLoose(t,e);var i=t.prototype;return i.readCapabilities=function(e,r){const t=r.capabilities&&r.capabilities.split(",").map((e=>e.toLowerCase().trim()));if(!t)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};const o=this.type,s="tile"!==o&&!!r.supportsDynamicLayers,p=t.includes("query"),i=t.includes("map"),l=!!r.exportTilesAllowed,n=t.includes("tilemap"),u=t.includes("data"),c="tile"!==o&&(!r.tileInfo||s),y="tile"!==o&&(!r.tileInfo||s),d="tile"!==o,b=r.cimVersion&&a.Version.parse(r.cimVersion),h=b?.since(1,4)??!1,f=b?.since(2,0)??!1;return{operations:{supportsExportMap:i,supportsExportTiles:l,supportsIdentify:p,supportsQuery:u,supportsTileMap:n},exportMap:i?{supportsArcadeExpressionForLabeling:h,supportsSublayersChanges:d,supportsDynamicLayers:s,supportsSublayerVisibility:c,supportsSublayerDefinitionExpression:y,supportsCIMSymbols:f}:null,exportTiles:l?{maxExportTilesCount:+r.maxExportTilesCount}:null}},i.readVersion=function(e,r){let t=r.currentVersion;return t||(t=r.hasOwnProperty("capabilities")||r.hasOwnProperty("tables")?10:r.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3),t},i.fetchSublayerInfo=function(){var e=r._asyncToGenerator((function*(e,r){try{return yield this.fetchAllLayersAndTables(r),this._allLayersAndTablesMap?.get(e)}catch{return}}));function t(r,t){return e.apply(this,arguments)}return t}(),i.fetchAllLayersAndTables=function(){var e=r._asyncToGenerator((function*(e){yield this.load(e),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=o(p.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then((e=>{this._allLayersAndTablesMap=new Map;for(const r of e.data.layers)this._allLayersAndTablesMap.set(r.id,r);return{result:e.data}}),(e=>({error:e}))));const r=yield this._allLayersAndTablesPromise;if(s.throwIfAborted(e),"result"in r)return r.result;throw r.error}));function t(r){return e.apply(this,arguments)}return t}(),t}(e);return t.__decorate([i.property({readOnly:!0})],l.prototype,"capabilities",void 0),t.__decorate([u.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],l.prototype,"readCapabilities",null),t.__decorate([i.property({json:{read:{source:"copyrightText"}}})],l.prototype,"copyright",void 0),t.__decorate([i.property({type:y})],l.prototype,"fullExtent",void 0),t.__decorate([i.property(b.id)],l.prototype,"id",void 0),t.__decorate([i.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],l.prototype,"legendEnabled",void 0),t.__decorate([i.property(b.popupEnabled)],l.prototype,"popupEnabled",void 0),t.__decorate([i.property({type:d})],l.prototype,"spatialReference",void 0),t.__decorate([i.property({readOnly:!0})],l.prototype,"version",void 0),t.__decorate([u.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],l.prototype,"readVersion",null),l=t.__decorate([c.subclass("esri.layers.mixins.ArcGISMapService")],l),l};e.ArcGISMapService=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
