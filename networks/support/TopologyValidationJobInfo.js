/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../request","../../core/has","../../core/jsonMap","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../layers/mixins/EditBusLayer","../../rest/networks/support/ValidateNetworkTopologyResult"],(function(e,t,r,s,i,o,a,n,c,u,l,d,p){"use strict";const m=i.strict()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let h=function(t){function s(e){var r;return(r=t.call(this,e)||this).featureServiceUrl=null,r.statusUrl=null,r.status=null,r.submissionTime=null,r.lastUpdatedTime=null,r._timer=void 0,r}e._inheritsLoose(s,t);var i=s.prototype;return i.destroy=function(){clearInterval(this._timer)},i.checkJobStatus=function(){var t=e._asyncToGenerator((function*(e){const t={...e,query:{f:"json"}},{data:s}=yield r(this.statusUrl,t);if(this.read(s),(this.serviceEdits||this.exceededTransferLimit)&&this.featureServiceUrl){const e={edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0};d.editEventBus.emit("edits",{serviceUrl:this.featureServiceUrl??"",layerId:null,event:e})}return this}));function s(e){return t.apply(this,arguments)}return s}(),i.waitForJobCompletion=function(){var t=e._asyncToGenerator((function*(e={}){const{interval:t=1e3,statusCallback:r}=e;return new Promise(((e,s)=>{this._clearTimer();const i=setInterval((()=>{this._timer||s(o.createAbortError()),this.checkJobStatus().then((t=>{const{status:s}=t;switch(this.status=s,s){case"job-succeeded":this._clearTimer(),e(this);break;case"job-waiting":case"job-executing":r&&r(this)}}),(e=>{this._clearTimer(),s(e)}))}),t);this._timer=i}))}));function r(){return t.apply(this,arguments)}return r}(),i._clearTimer=function(){clearInterval(this._timer),this._timer=void 0},s}(p);t.__decorate([a.property()],h.prototype,"featureServiceUrl",void 0),t.__decorate([a.property({type:String,json:{write:!0}})],h.prototype,"statusUrl",void 0),t.__decorate([u.enumeration(m)],h.prototype,"status",void 0),t.__decorate([a.property({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],h.prototype,"submissionTime",void 0),t.__decorate([a.property({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],h.prototype,"lastUpdatedTime",void 0),h=t.__decorate([l.subclass("esri.networks.support.TopologyValidationJobInfo")],h);return h}));
