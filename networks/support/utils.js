/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{queryAllJSON as e}from"../../layers/support/featureQueryAll.js";import r from"../../rest/support/FeatureSet.js";function t(e,r){const t=[],o=new Map;for(const s of r){const r=e.getLayerIdBySourceId(s.networkSourceId);let t=o.get(r);void 0===t&&(t=[]),t.push(s.objectId),o.set(r,t)}const a=e.featureServiceUrl;return o.forEach(((e,r)=>t.push({layerUrl:`${a}/${r}`,objectIds:e}))),t}async function o(t){const o=t.layers,a=t.layerInfos,s=t.returnGeometry||!1,n=t.outSpatialReference;await Promise.all(o.map((e=>e.load())));return(await Promise.all(o.map((async t=>{const o=a.find((e=>e.layerUrl===t.parsedUrl?.path));if(!o||!o.objectIds?.length)return{layer:t,featureSet:void 0};const u=t.createQuery();u.returnGeometry=s,u.outFields=o.outFields||["*"],u.outSpatialReference=n,u.gdbVersion=t.gdbVersion,u.objectIds=o.objectIds;const l=r.fromJSON(await e(t,u));return{layer:t,featureSet:l}})))).filter((e=>void 0!==e.featureSet))}export{o as getFeaturesFromLayers,t as getObjectIdsFromElements};
