/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","../geometry","../request","../core/maybe","../geometry/support/normalizeUtils","./utils","./support/ImageAngleResult","./support/ImageIdentifyResult","./support/ImageSampleResult","./support/ImagePixelLocationResult","../geometry/SpatialReference"],(function(e,t,n,a,r,i,o,s,l,u,c,p){"use strict";function m(e){const t=null==e?void 0:e.time;if(t&&(null!=t.start||null!=t.end)){const n=[];null!=t.start&&n.push(t.start),null!=t.end&&-1===n.indexOf(t.end)&&n.push(t.end),e.time=n.join(",")}}function f(e,t,n){return d.apply(this,arguments)}function d(){return(d=t._asyncToGenerator((function*(e,t,n){const a=o.parseUrl(e),s=t.geometry?[t.geometry]:[],l=yield i.normalizeCentralMeridian(s),u=t.toJSON();m(u);const c=l&&l[0];r.isSome(c)&&(u.geometry=c.toJSON());const p=o.encode({...a.query,f:"json",...u});return o.asValidOptions(p,n)}))).apply(this,arguments)}function y(e,t,n){return g.apply(this,arguments)}function g(){return(g=t._asyncToGenerator((function*(e,t,n){var i;const l=t.toJSON();r.isSome(l.angleName)&&(l.angleName=l.angleName.join(",")),r.isSome(t.point)&&null!=(i=t.point.spatialReference)&&i.imageCoordinateSystem&&(l.point.spatialReference=U(t.point.spatialReference)),r.isSome(t.spatialReference)&&t.spatialReference.imageCoordinateSystem&&(l.spatialReference=G(t.spatialReference));const u=o.parseUrl(e),c=o.encode({...u.query,f:"json",...l}),m=o.asValidOptions(c,n),{data:f}=yield a(`${u.path}/computeAngles`,m);return f.spatialReference=f.spatialReference?null!=f.spatialReference.geodataXform?new p({wkid:0,imageCoordinateSystem:f.spatialReference}):p.fromJSON(f.spatialReference):null,"NaN"===f.north&&(f.north=null),"NaN"===f.up&&(f.up=null),new s(f)}))).apply(this,arguments)}function S(e,t,n){return h.apply(this,arguments)}function h(){return(h=t._asyncToGenerator((function*(e,t,n){const r=t.toJSON(),{geometries:i}=t;for(let a=0;a<i.length;a++){var s;null!=(s=i[a].spatialReference)&&s.imageCoordinateSystem&&(r.geometries.geometries[a].spatialReference=U(i[a].spatialReference))}const l=o.parseUrl(e),u=o.encode({...l.query,f:"json",...r}),p=o.asValidOptions(u,n),{data:m}=yield a(`${l.path}/computePixelLocation`,p);return c.fromJSON(m)}))).apply(this,arguments)}function N(e,t,n){return O.apply(this,arguments)}function O(){return(O=t._asyncToGenerator((function*(e,t,n){const r=yield f(e,t,n),i=o.parseUrl(e),{data:s}=yield a(`${i.path}/computeStatisticsHistograms`,r),{statistics:l}=s;return null!=l&&l.length&&l.forEach((e=>{e.avg=e.mean,e.stddev=e.standardDeviation})),{statistics:l,histograms:s.histograms}}))).apply(this,arguments)}function R(e,t,n){return J.apply(this,arguments)}function J(){return(J=t._asyncToGenerator((function*(e,t,n){const r=yield f(e,t,n),i=o.parseUrl(e),{data:s}=yield a(`${i.path}/computeHistograms`,r);return{histograms:s.histograms}}))).apply(this,arguments)}function v(e,t,n){return C.apply(this,arguments)}function C(){return(C=t._asyncToGenerator((function*(e,t,n){var s,l;const c=t.toJSON();m(c),null!=(s=c.outFields)&&s.length&&(c.outFields=c.outFields.join(","));const p=yield i.normalizeCentralMeridian(t.geometry),f=null==p?void 0:p[0];r.isSome(f)&&(c.geometry=f.toJSON());const d=o.parseUrl(e),y=o.encode({...d.query,f:"json",...c}),g=o.asValidOptions(y,n),{data:S}=yield a(`${d.path}/getSamples`,g),h=null==S||null==(l=S.samples)?void 0:l.map((e=>{const t="NaN"===e.value||""===e.value?null:e.value.split(" ").map((e=>Number(e)));return{...e,pixelValue:t}}));return u.fromJSON({samples:h})}))).apply(this,arguments)}function _(e,t,n){return j.apply(this,arguments)}function j(){return(j=t._asyncToGenerator((function*(e,t,n){const s=o.parseUrl(e),u=t.geometry?[t.geometry]:[];return i.normalizeCentralMeridian(u).then((e=>{const i=t.toJSON(),l=e&&e[0];r.isSome(l)&&(i.geometry=JSON.stringify(l.toJSON()));const u=o.encode({...s.query,f:"json",...i}),c=o.asValidOptions(u,n);return a(s.path+"/identify",c)})).then((e=>l.fromJSON(e.data)))}))).apply(this,arguments)}function U(e){const{imageCoordinateSystem:t}=e;if(t){const{id:e,referenceServiceName:n}=t;return null!=e?n?{icsid:e,icsns:n}:{icsid:e}:{ics:t}}return e.toJSON()}function G(e,t){const n=U(e),{icsid:a,icsns:r,wkid:i}=n;return null!=a?null==r||null!=t&&t.toLowerCase().includes("/"+r.toLowerCase()+"/")?`0:${a}`:JSON.stringify(n):i?i.toString():JSON.stringify(n)}e.computeAngles=y,e.computeHistograms=R,e.computePixelSpaceLocations=S,e.computeStatisticsHistograms=N,e.getImageSpatialReferenceJSON=U,e.getImageSpatialReferenceQueryParameter=G,e.getSamples=v,e.identify=_,Object.defineProperty(e,"__esModule",{value:!0})}));
