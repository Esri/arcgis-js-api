/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","../geometry","../request","../core/maybe","../geometry/support/normalizeUtils","./utils","./support/ImageAngleResult","./support/ImageAreaResult","./support/ImageDistanceResult","./support/ImageHeightResult","./support/ImageIdentifyResult","./support/ImagePixelLocationResult","./support/ImagePointResult","./support/ImageSampleResult","../geometry/SpatialReference"],(function(e,t,n,r,o,i,a,s,l,u,c,p,m,f,y,d){"use strict";function g(e){const t=e?.time;if(t&&(null!=t.start||null!=t.end)){const n=[];null!=t.start&&n.push(t.start),null==t.end||n.includes(t.end)||n.push(t.end),e.time=n.join(",")}}function S(e,t,n){return h.apply(this,arguments)}function h(){return(h=t._asyncToGenerator((function*(e,t,n){const r=a.parseUrl(e),s=t.geometry?[t.geometry]:[],l=yield i.normalizeCentralMeridian(s),u=t.toJSON();g(u);const c=l&&l[0];o.isSome(c)&&(u.geometry=c.toJSON());const p=a.encode({...r.query,f:"json",...u});return a.asValidOptions(p,n)}))).apply(this,arguments)}function N(e,t,n){return O.apply(this,arguments)}function O(){return(O=t._asyncToGenerator((function*(e,t,n){const i=t.toJSON();o.isSome(i.angleName)&&(i.angleName=i.angleName.join(",")),o.isSome(t.point)&&t.point.spatialReference?.imageCoordinateSystem&&(i.point.spatialReference=M(t.point.spatialReference)),o.isSome(t.spatialReference)&&t.spatialReference.imageCoordinateSystem&&(i.spatialReference=k(t.spatialReference));const l=a.parseUrl(e),u=a.encode({...l.query,f:"json",...i}),c=a.asValidOptions(u,n),{data:p}=yield r(`${l.path}/computeAngles`,c);return p.spatialReference=p.spatialReference?null!=p.spatialReference.geodataXform?new d({wkid:0,imageCoordinateSystem:p.spatialReference}):d.fromJSON(p.spatialReference):null,"NaN"===p.north&&(p.north=null),"NaN"===p.up&&(p.up=null),new s(p)}))).apply(this,arguments)}function R(e,t,n){return J.apply(this,arguments)}function J(){return(J=t._asyncToGenerator((function*(e,t,n){const o=t.toJSON(),{geometries:i}=t;if(i)for(let r=0;r<i.length;r++)i[r].spatialReference?.imageCoordinateSystem&&(o.geometries.geometries[r].spatialReference=M(i[r].spatialReference));const s=a.parseUrl(e),l=a.encode({...s.query,f:"json",...o}),u=a.asValidOptions(l,n),{data:c}=yield r(`${s.path}/computePixelLocation`,u);return m.fromJSON(c)}))).apply(this,arguments)}function G(e,t,n){return C.apply(this,arguments)}function C(){return(C=t._asyncToGenerator((function*(e,t,n){const o=yield S(e,t,n),i=a.parseUrl(e),{data:s}=yield r(`${i.path}/computeStatisticsHistograms`,o),{statistics:l}=s;return l?.length&&l.forEach((e=>{e.avg=e.mean,e.stddev=e.standardDeviation})),{statistics:l,histograms:s.histograms}}))).apply(this,arguments)}function T(e,t,n){return _.apply(this,arguments)}function _(){return(_=t._asyncToGenerator((function*(e,t,n){const o=yield S(e,t,n),i=a.parseUrl(e),{data:s}=yield r(`${i.path}/computeHistograms`,o);return{histograms:s.histograms}}))).apply(this,arguments)}function I(e,t,n){return j.apply(this,arguments)}function j(){return(j=t._asyncToGenerator((function*(e,t,n){const s=t.toJSON();g(s),s.outFields?.length&&(s.outFields=s.outFields.join(","));const l=(yield i.normalizeCentralMeridian(t.geometry))?.[0];o.isSome(l)&&(s.geometry=l.toJSON());const u=a.parseUrl(e),c=a.encode({...u.query,f:"json",...s}),p=a.asValidOptions(c,n),{data:m}=yield r(`${u.path}/getSamples`,p),f=m?.samples?.map((e=>{const t="NaN"===e.value||""===e.value?null:e.value.split(" ").map((e=>Number(e)));return{...e,pixelValue:t}}));return y.fromJSON({samples:f})}))).apply(this,arguments)}function P(e,t,n){return U.apply(this,arguments)}function U(){return(U=t._asyncToGenerator((function*(e,t,n){const s=a.parseUrl(e),l=t.geometry?[t.geometry]:[];return i.normalizeCentralMeridian(l).then((e=>{const i=t.toJSON(),l=e&&e[0];o.isSome(l)&&(i.geometry=JSON.stringify(l.toJSON()));const u=a.encode({...s.query,f:"json",...i}),c=a.asValidOptions(u,n);return r(s.path+"/identify",c)})).then((e=>p.fromJSON(e.data)))}))).apply(this,arguments)}function v(e,t,n){return A.apply(this,arguments)}function A(){return(A=t._asyncToGenerator((function*(e,t,n){const r=yield x(e,t,[t.fromGeometry,t.toGeometry],n);return c.fromJSON(r)}))).apply(this,arguments)}function q(e,t,n){return H.apply(this,arguments)}function H(){return(H=t._asyncToGenerator((function*(e,t,n){const r=yield x(e,t,[t.geometry],n);return l.fromJSON(r)}))).apply(this,arguments)}function V(e,t,n){return w.apply(this,arguments)}function w(){return(w=t._asyncToGenerator((function*(e,t,n){const r=yield x(e,t,[t.geometry],n);return f.fromJSON(r)}))).apply(this,arguments)}function $(e,t,n){return b.apply(this,arguments)}function b(){return(b=t._asyncToGenerator((function*(e,t,n){const r=yield x(e,t,[t.fromGeometry,t.toGeometry],n);return u.fromJSON(r)}))).apply(this,arguments)}function x(e,t,n,r){return z.apply(this,arguments)}function z(){return(z=t._asyncToGenerator((function*(e,t,n,s){const l=a.parseUrl(e),u=yield i.normalizeCentralMeridian(n),c=t.toJSON();o.isSome(u[0])&&(c.fromGeometry=JSON.stringify(L(u[0]))),o.isSome(u[1])&&(c.toGeometry=JSON.stringify(L(u[1])));const p=a.encode({...l.query,f:"json",...c}),m=a.asValidOptions(p,s),{data:f}=yield r(l.path+"/measure",m);return f}))).apply(this,arguments)}function L(e){const t=e.toJSON();return e.spatialReference?.imageCoordinateSystem&&(t.spatialReference=M(e.spatialReference)),t}function M(e){const{imageCoordinateSystem:t}=e;if(t){const{id:e,referenceServiceName:n}=t;return null!=e?n?{icsid:e,icsns:n}:{icsid:e}:{ics:t}}return e.toJSON()}function k(e,t){const n=M(e),{icsid:r,icsns:o,wkid:i}=n;return null!=r?null==o||t?.toLowerCase().includes("/"+o.toLowerCase()+"/")?`0:${r}`:JSON.stringify(n):i?i.toString():JSON.stringify(n)}e.computeAngles=N,e.computeHistograms=T,e.computePixelSpaceLocations=R,e.computeStatisticsHistograms=G,e.getImageSpatialReferenceJSON=M,e.getImageSpatialReferenceQueryParameter=k,e.getSamples=I,e.identify=P,e.measureAreaAndPerimeter=q,e.measureDistanceAndAngle=$,e.measureHeight=v,e.measurePointOrCentroid=V,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
