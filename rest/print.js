/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","../config","../kernel","../request","../core/Error","../core/jsonMap","../core/maybe","../core/screenUtils","../core/urlUtils","../geometry/Polygon","../renderers/visualVariables/support/visualVariableUtils","./geoprocessor/execute","./geoprocessor/submitJob","./support/fileFormat","./support/layoutTemplate","./support/printTaskUtils","./support/PrintTemplate","./support/Query","../support/apiKeyUtils"],(function(e,t,i,r,n,a,l,o,s,u,y,c,p,f,d,m,g,h,b,S){"use strict";const x={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},w=new l.JSONMap({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),v=new l.JSONMap({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),L=new b({returnGeometry:!0}),I=new Map;function T(e,t,i){return D.apply(this,arguments)}function D(){return(D=t._asyncToGenerator((function*(e,t,i){const r=N(e);let a=I.get(r);return Promise.resolve().then((()=>a?{data:a.gpMetadata}:(a={gpServerUrl:r,is11xService:!1,legendLayerNameMap:[],legendLayers:[]},n(r,{query:{f:"json"}})))).then((e=>(a.gpMetadata=e.data,a.cimVersion=a.gpMetadata.cimVersion,a.is11xService=!!a.cimVersion,I.set(r,a),O(t,a)))).then((r=>{const n=he(a);let l;const o=e=>"sync"===n?e.results&&e.results[0]&&e.results[0].value:l.fetchResultData("Output_File",null,i).then((e=>e.value));return"async"===n?f.submitJob(e,r,null,i).then((e=>(l=e,e.waitForJobCompletion({interval:t.updateDelay}).then(o)))):p.execute(e,r,null,i).then(o)}))}))).apply(this,arguments)}function M(e){return V.apply(this,arguments)}function V(){return(V=t._asyncToGenerator((function*(e){const t=N(e);return he(I.get(t))}))).apply(this,arguments)}function O(e,t){return E.apply(this,arguments)}function E(){return(E=t._asyncToGenerator((function*(e,t){t=t||{is11xService:!1,legendLayerNameMap:[],legendLayers:[]};const i=e.template||new h;null==i.showLabels&&(i.showLabels=!0);const r=i.exportOptions;let n;const l=m.toJSON(i.layout);if(r){if(n={dpi:r.dpi},"map_only"===l.toLowerCase()||""===l){const e=r.width,t=r.height;n.outputSize=[e,t]}}const o=i.layoutOptions;let s;if(o){let e,t;"Miles"===o.scalebarUnit||"Kilometers"===o.scalebarUnit?(e="Kilometers",t="Miles"):"Meters"!==o.scalebarUnit&&"Feet"!==o.scalebarUnit||(e="Meters",t="Feet"),s={titleText:o.titleText,authorText:o.authorText,copyrightText:o.copyrightText,customTextElements:o.customTextElements,scaleBarOptions:{metricUnit:w.toJSON(e),metricLabel:x[e],nonMetricUnit:w.toJSON(t),nonMetricLabel:x[t]}}}let u=null;o&&o.legendLayers&&(u=o.legendLayers.map((e=>{t.legendLayerNameMap[e.layerId]=e.title;const i={id:e.layerId};return e.subLayerIds&&(i.subLayerIds=e.subLayerIds),i})));const y=yield P(e,i,t);if(y.operationalLayers){const e=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),i=/[\u0600-\u06FF]/,r=t=>{const r=t.text,n=t.font,a=n&&n.family&&n.family.toLowerCase();r&&n&&("arial"===a||"arial unicode ms"===a)&&(n.family=e.test(r)?"Arial Unicode MS":"Arial","normal"!==n.style&&i.test(r)&&(n.family="Arial Unicode MS"))},n=()=>{throw new a("print-task:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")};y.operationalLayers.forEach((e=>{var i,a,l;null!=(i=e.featureCollection)&&i.layers?e.featureCollection.layers.forEach((e=>{var i,a,l,o;if(null!=(i=e.layerDefinition)&&null!=(a=i.drawingInfo)&&null!=(l=a.renderer)&&l.symbol){const i=e.layerDefinition.drawingInfo.renderer;"esriTS"===i.symbol.type?r(i.symbol):"CIMSymbolReference"!==i.symbol.type||t.is11xService||n()}null!=(o=e.featureSet)&&o.features&&e.featureSet.features.forEach((e=>{e.symbol&&("esriTS"===e.symbol.type?r(e.symbol):"CIMSymbolReference"!==e.symbol.type||t.is11xService||n())}))})):!t.is11xService&&null!=(a=e.layerDefinition)&&null!=(l=a.drawingInfo)&&l.renderer&&JSON.stringify(e.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&n()}))}e.outSpatialReference&&(y.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(y,{exportOptions:n,layoutOptions:s||{}}),Object.assign(y.layoutOptions,{legendOptions:{operationalLayers:null!=u?u:t.legendLayers.slice()}}),t.legendLayers.length=0,I.set(t.gpServerUrl,t);const c={Web_Map_as_JSON:JSON.stringify(y),Format:d.toJSON(i.format),Layout_Template:l};return e.extraParameters&&Object.assign(c,e.extraParameters),c}))).apply(this,arguments)}function P(e,t,i){return F.apply(this,arguments)}function F(){return(F=t._asyncToGenerator((function*(e,t,i){const r=e.view;let n=r.spatialReference;const a={operationalLayers:yield J(r,t,i)};let l=i.ssExtent||e.extent||r.extent;if(n&&n.isWrappable&&(l=l.clone()._normalize(!0),n=l.spatialReference),a.mapOptions={extent:l&&l.toJSON(),spatialReference:n&&n.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,r.background&&(a.background=r.background.toJSON()),r.rotation&&(a.mapOptions.rotation=-r.rotation),t.scalePreserved&&(a.mapOptions.scale=t.outScale||r.scale),r.timeExtent){const e=o.isSome(r.timeExtent.start)?r.timeExtent.start.getTime():null,t=o.isSome(r.timeExtent.end)?r.timeExtent.end.getTime():null;a.mapOptions.time=[e,t]}return a}))).apply(this,arguments)}function N(e){let t=e;const i=t.lastIndexOf("/GPServer/");return i>0&&(t=t.slice(0,i+9)),t}function J(e,t,i){return R.apply(this,arguments)}function R(){return(R=t._asyncToGenerator((function*(e,t,i){const r=[],n={layerView:null,printTemplate:t,view:e};let a=0;t.scalePreserved&&(a=t.outScale||e.scale);const l=g.getVisibleLayerViews(e,a);for(const o of l){const e=o.layer;if(!e.loaded||g.isGroupLayer(e))continue;let t;n.layerView=o,t=g.isBingMapsLayer(e)?_(e):g.isCSVLayer(e)?yield k(e,n,i):g.isFeatureLayer(e)?yield A(e,n,i):g.isGeoJSONLayer(e)?yield K(e,n,i):g.isGraphicsLayer(e)?yield $(e,n,i):g.isImageryLayer(e)?q(e,i):g.isKMLLayer(e)?yield j(e,n,i):g.isMapImageLayer(e)?H(e,n,i):g.isMapNotesLayer(e)?yield X(n,i):g.isOpenStreetMapLayer(e)?Z():g.isStreamLayer(e)?yield ie(e,n,i):g.isTileLayer(e)?ne(e):g.isVectorTileLayer(e)?yield ae(e,n,i):g.isWebTileLayer(e)?oe(e):g.isWMSLayer(e)?se(e):g.isWMTSLayer(e)?ue(e):yield ee(e,n,i),t&&(Array.isArray(t)?r.push(...t):(t.id=e.id,t.title=i.legendLayerNameMap[e.id]||e.title,t.opacity=e.opacity,t.minScale=e.minScale||0,t.maxScale=e.maxScale||0,r.push(t)))}if(a&&r.forEach((e=>{e.minScale=0,e.maxScale=0})),e.graphics&&e.graphics.length){const n=yield G(null,e.graphics,t,i);n&&r.push(n)}return r}))).apply(this,arguments)}function _(e){return{culture:e.culture,key:e.key,type:"BingMaps"+("aerial"===e.style?"Aerial":"hybrid"===e.style?"Hybrid":"Road")}}function k(e,t,i){return C.apply(this,arguments)}function C(){return(C=t._asyncToGenerator((function*(e,{layerView:t,printTemplate:i},r){let n;if(r.legendLayers&&r.legendLayers.push({id:e.id}),!r.is11xService){return G(e,yield me(t),i,r)}return n={type:"CSV"},e.write(n,{origin:"web-map"}),delete n.popupInfo,delete n.layerType,n.showLabels=i.showLabels&&e.labelsVisible,n}))).apply(this,arguments)}function G(e,t,i,r){return U.apply(this,arguments)}function U(){return(U=t._asyncToGenerator((function*(e,t,i,r){let n;const a=g.createPolygonLayer(),l=g.createPolylineLayer(),o=g.createPointLayer(),s=g.createMultipointLayer(),u=g.createPointLayer();if(u.layerDefinition.name="textLayer",delete u.layerDefinition.drawingInfo,e){if("esri.layers.FeatureLayer"===e.declaredClass||"esri.layers.StreamLayer"===e.declaredClass?a.layerDefinition.name=l.layerDefinition.name=o.layerDefinition.name=s.layerDefinition.name=r.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:"esri.layers.GraphicsLayer"===e.declaredClass&&(t=e.graphics.items),e.renderer){const t=e.renderer.toJSON();a.layerDefinition.drawingInfo.renderer=t,l.layerDefinition.drawingInfo.renderer=t,o.layerDefinition.drawingInfo.renderer=t,s.layerDefinition.drawingInfo.renderer=t}if(i.showLabels&&e.labelsVisible&&"function"==typeof e.write){var c,p;const t=null==(c=e.write({},{origin:"web-map"}).layerDefinition)||null==(p=c.drawingInfo)?void 0:p.labelingInfo;t&&(n=!0,a.layerDefinition.drawingInfo.labelingInfo=t,l.layerDefinition.drawingInfo.labelingInfo=t,o.layerDefinition.drawingInfo.labelingInfo=t,s.layerDefinition.drawingInfo.labelingInfo=t)}}let f;null!=e&&e.renderer||n||(delete a.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo,delete o.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo);const d=null==e?void 0:e.fieldsIndex,m=null==e?void 0:e.renderer;if(d){if(m&&"function"==typeof m.collectRequiredFields){const e=new Set;yield m.collectRequiredFields(e,d),f=Array.from(e)}const e=d.fields.map((e=>e.toJSON()));a.layerDefinition.fields=e,l.layerDefinition.fields=e,o.layerDefinition.fields=e,s.layerDefinition.fields=e}const h=t&&t.length;let b;for(let x=0;x<h;x++){const n=t[x]||t.getItemAt(x);if(!1===n.visible||!n.geometry)continue;if(b=n.toJSON(),b.hasOwnProperty("popupTemplate")&&delete b.popupTemplate,b.geometry&&b.geometry.z&&delete b.geometry.z,b.symbol&&b.symbol.outline&&"esriCLS"===b.symbol.outline.type&&!r.is11xService)continue;!r.is11xService&&b.symbol&&b.symbol.outline&&b.symbol.outline.color&&b.symbol.outline.color[3]&&(b.symbol.outline.color[3]=255);const c=e&&e.renderer&&("valueExpression"in e.renderer&&e.renderer.valueExpression||"hasVisualVariables"in e.renderer&&e.renderer.hasVisualVariables());if(!b.symbol&&e&&e.renderer&&c&&!r.is11xService){const t=e.renderer,i=yield t.getSymbolAsync(n);if(!i)continue;b.symbol=i.toJSON(),"hasVisualVariables"in t&&t.hasVisualVariables()&&g.applyVisualVariables(b.symbol,{renderer:t,graphic:n,symbol:i})}if(b.symbol&&(b.symbol.angle||delete b.symbol.angle,be(b.symbol)?b.symbol=yield ce(b.symbol,r):b.symbol.text&&delete b.attributes),(!i||!i.forceFeatureAttributes)&&f&&f.length){const e={};f.forEach((t=>{b.attributes&&b.attributes.hasOwnProperty(t)&&(e[t]=b.attributes[t])})),b.attributes=e}"polygon"===n.geometry.type?a.featureSet.features.push(b):"polyline"===n.geometry.type?l.featureSet.features.push(b):"point"===n.geometry.type?b.symbol&&b.symbol.text?u.featureSet.features.push(b):o.featureSet.features.push(b):"multipoint"===n.geometry.type?s.featureSet.features.push(b):"extent"===n.geometry.type&&(b.geometry=y.fromExtent(n.geometry).toJSON(),a.featureSet.features.push(b))}const S=[a,l,s,o,u].filter((e=>e.featureSet.features.length>0));for(const y of S){const e=y.featureSet.features.every((e=>e.symbol));!e||i&&i.forceFeatureAttributes||y.featureSet.features.forEach((e=>{delete e.attributes})),e&&delete y.layerDefinition.drawingInfo,y.layerDefinition.drawingInfo&&y.layerDefinition.drawingInfo.renderer&&(yield fe(y.layerDefinition.drawingInfo.renderer,r))}return S.length?{featureCollection:{layers:S},showLabels:n}:null}))).apply(this,arguments)}function A(e,t,i){return z.apply(this,arguments)}function z(){return(z=t._asyncToGenerator((function*(e,t,i){var r,n;let a;i.legendLayers&&i.legendLayers.push({id:e.id});const l=e.renderer;if(e.featureReduction||l&&"dot-density"===l.type&&(!i.is11xService||parseFloat(i.cimVersion)<2.6))return ee(e,t,i);const{layerView:o,printTemplate:s,view:u}=t,y=l&&("valueExpression"in l&&l.valueExpression||"hasVisualVariables"in l&&l.hasVisualVariables()),p="feature-layer"!==(null==(r=e.source)?void 0:r.type)&&"ogc-feature"!==(null==(n=e.source)?void 0:n.type);if(!i.is11xService&&y||e.featureReduction||p||!l||"field"in l&&null!=l.field&&("string"!=typeof l.field||!e.getField(l.field))){const t=yield me(o);a=yield G(e,t,s,i)}else{var f,d;if(a={id:(m=e.write()).id,title:m.title,opacity:m.opacity,minScale:m.minScale,maxScale:m.maxScale,url:m.url,layerDefinition:m.layerDefinition},a.showLabels=s.showLabels&&e.labelsVisible,ye(a,e),null!=(f=a.layerDefinition)&&null!=(d=f.drawingInfo)&&d.renderer&&(delete a.layerDefinition.minScale,delete a.layerDefinition.maxScale,yield fe(a.layerDefinition.drawingInfo.renderer,i),"visualVariables"in l&&l.visualVariables&&l.visualVariables[0])){const e=l.visualVariables[0];if("size"===e.type&&e.maxSize&&"number"!=typeof e.maxSize&&e.minSize&&"number"!=typeof e.minSize){const t=c.getSizeRangeAtScale(e,u.scale);a.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=t.minSize,a.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=t.maxSize}}}var m;return a}))).apply(this,arguments)}function K(e,t,i){return W.apply(this,arguments)}function W(){return(W=t._asyncToGenerator((function*(e,{layerView:t,printTemplate:i},r){r.legendLayers&&r.legendLayers.push({id:e.id});return G(e,yield me(t),i,r)}))).apply(this,arguments)}function $(e,t,i){return B.apply(this,arguments)}function B(){return(B=t._asyncToGenerator((function*(e,{printTemplate:t},i){return G(e,null,t,i)}))).apply(this,arguments)}function q(e,t){t.legendLayers&&t.legendLayers.push({id:e.id});const i={bandIds:e.bandIds,compressionQuality:e.compressionQuality,format:e.format,interpolation:e.interpolation};if((e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(t.is11xService)e.renderingRule&&(i.renderingRule=e.renderingRule.toJSON()),e.renderer&&(i.layerDefinition=i.layerDefinition||{},i.layerDefinition.drawingInfo=i.layerDefinition.drawingInfo||{},i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const t=e.exportImageServiceParameters.combineRendererWithRenderingRule();t&&(i.renderingRule=t.toJSON())}return ye(i,e),i}function j(e,t,i){return Q.apply(this,arguments)}function Q(){return(Q=t._asyncToGenerator((function*(e,t,i){const r=t.printTemplate;if(i.is11xService){const t={type:"kml"};return e.write(t,{origin:"web-map"}),delete t.layerType,t.url=u.normalize(e.url),t}{const n=[],a=t.layerView;a.allVisibleMapImages.forEach(((t,i)=>{const r={id:`${e.id}_image${i}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity,extent:t.extent};"data:image/png;base64,"===t.href.substr(0,22)?r.imageData=t.href.substr(22):r.url=t.href,n.push(r)}));const l=[...a.allVisiblePoints.items,...a.allVisiblePolylines.items,...a.allVisiblePolygons.items],o={id:e.id,...yield G(null,l,r,i)};return n.push(o),n}}))).apply(this,arguments)}function H(e,{view:t},i){let r;const n={id:e.id,subLayerIds:[]};let a=[];const l=t.scale,o=e=>{const t=0===l,i=0===e.minScale||l<=e.minScale,r=0===e.maxScale||l>=e.maxScale;if(e.visible&&(t||i&&r))if(e.sublayers)e.sublayers.forEach(o);else{const t=e.toExportImageJSON(),i={id:e.id,name:e.title,layerDefinition:{drawingInfo:t.drawingInfo,definitionExpression:t.definitionExpression,source:t.source}};a.unshift(i),n.subLayerIds.push(e.id)}};return e.sublayers&&e.sublayers.forEach(o),a.length&&(a=a.map((({id:e,name:t,layerDefinition:i})=>({id:e,name:t,layerDefinition:i}))),r={layers:a,visibleLayers:e.capabilities.exportMap.supportsDynamicLayers?void 0:n.subLayerIds},ye(r,e),i.legendLayers.push(n)),r}function X(e,t){return Y.apply(this,arguments)}function Y(){return(Y=t._asyncToGenerator((function*({layerView:e,printTemplate:t},i){const r=[],n=e.layer;if(o.isSome(n.featureCollections))for(const a of n.featureCollections){const e=yield G(a,a.source,t,i);e&&r.push(...e.featureCollection.layers)}else if(o.isSome(n.sublayers))for(const a of n.sublayers){const e=yield G(null,a.graphics,t,i);e&&r.push(...e.featureCollection.layers)}return{featureCollection:{layers:r}}}))).apply(this,arguments)}function Z(){return{type:"OpenStreetMap"}}function ee(e,t,i){return te.apply(this,arguments)}function te(){return(te=t._asyncToGenerator((function*(e,{printTemplate:t,view:i},r){const n={type:"image"},a={format:"png",ignoreBackground:!0,layers:[e],rotation:0},l=r.ssExtent||i.extent.clone();let o=96,y=!0,c=!0;if(t.exportOptions){const e=t.exportOptions;e.dpi>0&&(o=e.dpi),e.width>0&&(y=e.width%2==i.width%2),e.height>0&&(c=e.height%2==i.height%2)}if("map-only"===t.layout&&t.scalePreserved&&(!t.outScale||t.outScale===i.scale)&&96===o&&(!y||!c)&&(a.area={x:0,y:0,width:i.width,height:i.height},y||(a.area.width-=1),c||(a.area.height-=1),!r.ssExtent)){const e=i.toMap(s.createScreenPoint(a.area.width,a.area.height));l.ymin=e.y,l.xmax=e.x,r.ssExtent=l}n.extent=l.clone()._normalize(!0).toJSON();const p=yield i.takeScreenshot(a),{data:f}=u.dataComponents(p.dataUrl);return n.imageData=f,n}))).apply(this,arguments)}function ie(e,t,i){return re.apply(this,arguments)}function re(){return(re=t._asyncToGenerator((function*(e,{layerView:t,printTemplate:i},r){r.legendLayers&&r.legendLayers.push({id:e.id});return G(e,yield me(t),i,r)}))).apply(this,arguments)}function ne(e){const t={customParameters:e.customParameters};return ye(t,e),t}function ae(e,t,i){return le.apply(this,arguments)}function le(){return(le=t._asyncToGenerator((function*(e,t,i){if(i.is11xService&&e.serviceUrl&&e.styleUrl){const t=r.id&&r.id.findCredential(e.styleUrl),n=r.id&&r.id.findCredential(e.serviceUrl);if(!t&&!n||"2.1.0"!==i.cimVersion){const i={type:"VectorTileLayer"};return i.styleUrl=u.normalize(e.styleUrl),t&&(i.token=t.token),n&&n.token!==i.token&&(i.additionalTokens=[{url:e.serviceUrl,token:n.token}]),i}}return ee(e,t,i)}))).apply(this,arguments)}function oe(e){const t={type:"WebTiledLayer",urlTemplate:e.urlTemplate.replace(/\${/g,"{"),credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}function se(e){let t;const i=[],r=e=>{e.visible&&(e.sublayers?e.sublayers.forEach(r):e.name&&i.unshift(e.name))};return e.sublayers&&e.sublayers.forEach(r),i.length&&(t={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:i,url:u.normalize(e.url),version:e.version}),t}function ue(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:u.normalize(e.url)}}function ye(e,t){if(t.url)if(e.url=u.normalize(e.url||t.url),"apiKey"in t&&t.apiKey)e.token=t.apiKey;else if(i.apiKey&&S.supportsApiKey(t.url))e.token=i.apiKey;else{var n,a;e.token=null==(n=r.id)||null==(a=n.findCredential(t.url))?void 0:a.token}}function ce(e,t){return pe.apply(this,arguments)}function pe(){return(pe=t._asyncToGenerator((function*(e,t){t.canvas||(t.canvas=document.createElement("canvas"));const i=1024;t.canvas.width=i,t.canvas.height=i;const r=t.canvas.getContext("2d");let a,l;if(e.path){var o;const t=new Path2D(e.path);t.closePath(),r.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",r.fill(t);const n=g.getContextBoundingBox(r);if(!n)return null;r.clearRect(0,0,i,i);const u=s.pt2px(e.size)/Math.max(n.width,n.height);r.scale(u,u);const y=i/u,c=y/2-n.width/2-n.x,p=y/2-n.height/2-n.y;if(r.translate(c,p),Array.isArray(e.color)&&r.fill(t),null!=(o=e.outline)&&o.width&&Array.isArray(e.outline.color)){const i=e.outline;r.lineWidth=s.pt2px(i.width)/u,r.lineJoin="round",r.strokeStyle=`rgba(${i.color[0]},${i.color[1]},${i.color[2]},${i.color[3]/255})`,r.stroke(t),n.width+=r.lineWidth,n.height+=r.lineWidth}n.width*=u,n.height*=u;const f=r.getImageData(i/2-n.width/2,i/2-n.height/2,Math.ceil(n.width),Math.ceil(n.height));a=f.width,l=f.height,r.canvas.width=a,r.canvas.height=l,r.putImageData(f,0,0)}else{const t="image/svg+xml"===e.contentType?"data:image/svg+xml;base64,"+e.imageData:e.url,i=(yield n(t,{responseType:"image"})).data;a=s.pt2px(e.width),l=s.pt2px(e.height),r.canvas.width=a,r.canvas.height=l,r.drawImage(i,0,0,r.canvas.width,r.canvas.height)}return{type:"esriPMS",imageData:r.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:s.px2pt(l),width:s.px2pt(a),xoffset:e.xoffset,yoffset:e.yoffset}}))).apply(this,arguments)}function fe(e,t){return de.apply(this,arguments)}function de(){return(de=t._asyncToGenerator((function*(e,t){const i=e.type;if("simple"===i&&be(e.symbol))e.symbol=yield ce(e.symbol,t);else if("uniqueValue"===i||"classBreaks"===i){be(e.defaultSymbol)&&(e.defaultSymbol=yield ce(e.defaultSymbol,t));const r=e["uniqueValue"===i?"uniqueValueInfos":"classBreakInfos"];if(r)for(const e of r)be(e.symbol)&&(e.symbol=yield ce(e.symbol,t))}}))).apply(this,arguments)}function me(e){return ge.apply(this,arguments)}function ge(){return(ge=t._asyncToGenerator((function*(e){return e.queryFeatures(L).then((e=>e.features))}))).apply(this,arguments)}function he(e){return e.gpMetadata&&e.gpMetadata.executionType?v.fromJSON(e.gpMetadata.executionType):"sync"}function be(e){return e&&(e.path||"image/svg+xml"===e.contentType||e.url&&e.url.endsWith(".svg"))}e.execute=T,e.getGpPrintParams=O,e.getGpServerUrl=N,e.getMode=M,e.printCacheMap=I,Object.defineProperty(e,"__esModule",{value:!0})}));
