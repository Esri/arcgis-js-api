/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","../request","../renderers/support/jsonUtils","./query/executeQuery","./utils","../kernel","../core/urlUtils","./query/support/AttachmentInfo","./support/AttachmentQuery","../geometry/Extent","../geometry/Geometry","../geometry/Multipoint","../geometry/Point","../geometry/Polygon","../geometry/Polyline","../geometry/support/normalizeUtils","../core/Error","../core/pbf","../core/unitUtils","../geometry/support/spatialReferenceUtils","./support/Query","../geometry","./support/FeatureSet","../layers/graphics/featureConversionUtils","./support/RelationshipQuery","./support/TopFeaturesQuery","./support/StatisticDefinition"],(function(e,t,n,r,i,l,o,s,a,u,c,p,f,y,m,g,h,d,S,b,V,k,x,v,O,R,T,U){"use strict";function q(e,t,n,r){return F.apply(this,arguments)}function F(){return(F=t._asyncToGenerator((function*(e,t,r,i){const o=l.parseUrl(e),{source:s,checkValueRange:a}=t,{classificationDefinition:u}=r,c={...r.toJSON(),f:"json"};let p=null;if(p="class-breaks-definition"===u?.type?u.classificationField:u?.attributeField,s){const e={source:s?.toJSON()};c.layer=JSON.stringify(e)}c.classificationDef&&(c.classificationDef=JSON.stringify(c.classificationDef));let f={query:c};i&&(f={...i,...f});const y={url:o.path,field:p,checkValueRange:a},m=o.path+"/generateRenderer";return n(m,f).then((e=>P(y,e)))}))).apply(this,arguments)}function P(e,t){const{field:n,checkValueRange:r,url:l}=e,o=t&&t.data;if(!o)return;if(!r){const e=Q(o);return Promise.resolve(e)}const s=new U({statisticType:"min",onStatisticField:n}),a=new U({statisticType:"max",onStatisticField:n}),u=new k({outStatistics:[s,a]});return i.executeQuery(l,u).then((e=>{const t=e.features[0].attributes;let n=null,r=null;for(const i in t)0===i.toLowerCase().indexOf("min")?n=t[i]:r=t[i];return Q(o,n,r)}))}function Q(e,t,n){if("classBreaks"===e.type){const i=r.fromJSON(e);return{classBreaks:i.classBreakInfos.map(((e,r)=>(0===r&&null!=t&&(e.minValue=t),r===i.classBreakInfos.length-1&&null!=n&&(e.maxValue=n),{minValue:e.minValue,maxValue:e.maxValue,label:e.label}))),normalizationTotal:i.normalizationTotal}}const{uniqueValueInfos:i}=e;return{uniqueValues:i?.map(((e,r)=>(0===r&&null!=t&&(e.value=t),r===i.length-1&&null!=n&&(e.value=n),{count:e.count,value:e.value,label:e.label})))??[]}}e.generateRenderer=q,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
