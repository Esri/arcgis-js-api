/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import t from"../Entity.js";import n from"../GraphObject.js";import r from"../ObjectValue.js";import o from"../Path.js";import u from"../Relationship.js";import{WasmGeometryTypeCodes as s}from"./KnowledgeWasmInterface.js";import{WasmGraphQueryResponseTypeCodes as a}from"./WasmQueryWrapperInterfaces.js";import{wasmToPolygonGeometry as c,wasmToPolylineGeometry as i,wasmToMultipointGeometry as l,wasmToPointGeometry as p}from"./wasmToGeometryFactories.js";const _=e.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors");function E(e){const t=[],n=e.count();for(let r=0;r<n;r++){const n=e.get_value_at(r);t.push(f(n))}return t}function f(e){if(!e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case s.ESRI_GEOMETRY_POINT:return p(e);case s.ESRI_GEOMETRY_MULTIPOINT:return l(e);case s.ESRI_GEOMETRY_POLYLINE:return i(e);case s.ESRI_GEOMETRY_POLYGON:return c(e);case s.ESRI_GEOMETRY_ENVELOPE:case s.ESRI_GEOMETRY_MULTI_PATCH:return _.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected.  Result interpreted as null"),null;case s.ESRI_GEOMETRY_NULL:case s.ESRI_GEOMETRY_ANY:default:return _.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return _.warnOnce("A decoded value came back of a type that is not supported.  Result interpreted as null"),null;switch(e.object_value_type.value){case a.OBJECT:return R(e);case a.ENTITY:return m(e);case a.RELATIONSHIP:return d(e);case a.PATH:return g(e);case a.ARRAY:return E(e);default:return _.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}function m(e){const n=e.type_name;return new t(Object.assign({typeName:n},O(e)))}function y(e){return new n(O(e))}function O(e){const t={},n=e.key_count();for(let r=0;r<n;r++)t[e.get_key_at(r)]=f(e.get_value_at(r));return{properties:t}}function R(e){return new r(O(e))}function g(e){const t=e.entity_count(),n=e.relationship_count(),r=[];for(let o=0;o<t;o++)r.push(m(e.get_entity_at(o))),o<n&&r.push(d(e.get_relationship_at(o)));return new o({path:r})}function d(e){const t=e.type_name;return new u(Object.assign({typeName:t},O(e)))}export{f as decodedWasmObjToQueryResponseObj,E as wasmArrayToArray,m as wasmToEntity,y as wasmToGraphObject,R as wasmToObjectValue,g as wasmToPath,d as wasmToRelationship};
