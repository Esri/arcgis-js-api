/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../core/maybe","../core/urlUtils","../geometry/support/scaleUtils","../views/support/floorFilterUtils"],(function(e,n,t,i,r){"use strict";function s(e,n){return n?{...n,query:{...e,...n.query}}:{query:e}}function l(e){return"string"==typeof e?t.urlToObject(e):e}function o(e,n,t){const i={};for(const r in e){if("declaredClass"===r)continue;const s=e[r];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){i[r]=[];for(let e=0;e<s.length;e++)i[r][e]=o(s[e])}else if("object"==typeof s)if(s.toJSON){const e=s.toJSON(t&&t[r]);i[r]=n?e:JSON.stringify(e)}else i[r]=n?s:JSON.stringify(s);else i[r]=s}return i}function a({mapExtent:e,floors:n,width:t,sublayers:s,layerIds:l}){const o={},a={extent:e,width:t,spatialReference:null==e?void 0:e.spatialReference};let f=s;null!=l&&l.length&&s&&(f=s.filter((e=>l.includes(e.id))));const c=i.getScale(a),y=[],d=e=>{const n=0===c,t=0===e.minScale||c<=e.minScale,i=0===e.maxScale||c>=e.maxScale;e.visible&&(n||t&&i)&&(e.sublayers?e.sublayers.forEach(d):y.unshift(e))};if(f&&f.forEach(d),f&&f.length){const e=y.map((e=>{const t=r.getLayerFloorFilterClause(n,e);return e.toExportImageJSON(t)})),t=e.some((e=>"mapLayer"===e.source.type?e.source.mapLayerId!==e.id:"dataLayer"===e.source.type));if(t){let n=JSON.stringify(e);"[]"===n&&(n="[{}]"),o.dynamicLayers=n}else if(!t){if(null!=l&&l.length)o.layerIds=l;else{const e=f.map((({id:e})=>e));e.length&&(o.layerIds=e)}const e=u({floors:n,visibleSublayers:y});if(e&&e.length){const n=e.reduce(((e,n)=>(n.definitionExpression&&(e[n.id]=n.definitionExpression),e)),{});Object.keys(n).length&&(o.layerDefs=JSON.stringify(n))}}}else null!=l&&l.length&&(o.layerIds=l);return o}function u({floors:e,visibleSublayers:t}){const i=!(null==e||!e.length),s=t.filter((e=>null!=e.definitionExpression||i&&null!=e.floorInfo));if(!s.length)return null;return s.map((t=>{const i=r.getLayerFloorFilterClause(e,t),s=n.isSome(i)?r.combineFloorsDefinitionExpression(i,t):t.definitionExpression,l={id:t.id,definitionExpression:null};return s&&(l.definitionExpression=s),l}))}e.asValidOptions=s,e.encode=o,e.parseUrl=l,e.toDynamicLayersJSON=a,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
