/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../request","../../../tasks/operations/urlUtils"],(function(e,t,o){"use strict";function r(e,t){const o=e.toJSON();return o.objectIds&&(o.objectIds=o.objectIds.join(",")),o.orderByFields&&(o.orderByFields=o.orderByFields.join(",")),!o.outFields||null!=t&&t.returnCountOnly?delete o.outFields:-1!==o.outFields.indexOf("*")?o.outFields="*":o.outFields=o.outFields.join(","),o.outSpatialReference&&(o.outSR=o.outSR.wkid||JSON.stringify(o.outSR.toJSON()),delete o.outSpatialReference),o.dynamicDataSource&&(o.layer=JSON.stringify({source:o.dynamicDataSource}),delete o.dynamicDataSource),o}async function n(e,t,o){const r=await s(e,t,o),n=r.data,a=n.geometryType,u=n.spatialReference,d={};for(const s of n.relatedRecordGroups){const e={fields:void 0,objectIdFieldName:void 0,geometryType:a,spatialReference:u,hasZ:!!n.hasZ,hasM:!!n.hasM,features:s.relatedRecords};if(null!=s.objectId)d[s.objectId]=e;else for(const t in s)s.hasOwnProperty(t)&&"relatedRecords"!==t&&(d[s[t]]=e)}return{...r,data:d}}async function a(e,t,o){const r=await s(e,t,o,{returnCountOnly:!0}),n=r.data,a={};for(const s of n.relatedRecordGroups)null!=s.objectId&&(a[s.objectId]=s.count);return{...r,data:a}}async function s(e,n,a={},s){const u=o.mapParameters({...e.query,f:"json",...s,...r(n,s)});return t(e.path+"/queryRelatedRecords",{...a,query:{...a.query,...u}})}e.executeRelationshipQuery=n,e.executeRelationshipQueryForCount=a,e.toQueryStringParameters=r,Object.defineProperty(e,"__esModule",{value:!0})}));
