/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../core/Error","../../../core/maybe","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],(function(e,t,s,r,a,n){"use strict";const o=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],i=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],c=["upperLeft","lowerLeft"];function l(e){return e>=o.length?null:o[e]}function g(e){return e>=i.length?null:i[e]}function u(e){return e>=c.length?null:c[e]}function p(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function f(e,t,s){const r=3,a=e.asUnsafe(),n=t.createPointGeometry(s);for(;a.next();)switch(a.tag()){case r:{const e=a.getUInt32(),s=a.pos()+e;let r=0;for(;a.pos()<s;)t.addCoordinatePoint(n,a.getSInt64(),r++);break}default:a.skip()}return n}function y(e,t,s){const r=2,a=3,n=e.asUnsafe(),o=t.createGeometry(s),i=2+(s.hasZ?1:0)+(s.hasM?1:0);for(;n.next();)switch(n.tag()){case r:{const e=n.getUInt32(),s=n.pos()+e;let r=0;for(;n.pos()<s;)t.addLength(o,n.getUInt32(),r++);break}case a:{const e=n.getUInt32(),s=n.pos()+e;let r=0;for(t.allocateCoordinates(o);n.pos()<s;)t.addCoordinate(o,n.getSInt64(),r),r++,r===i&&(r=0);break}default:n.skip()}return o}function b(e){const t=1,s=2,r=3,o=e.asUnsafe(),i=new a;let c="esriGeometryPoint";for(;o.next();)switch(o.tag()){case s:{const e=o.getUInt32(),t=o.pos()+e;for(;o.pos()<t;)i.lengths.push(o.getUInt32());break}case r:{const e=o.getUInt32(),t=o.pos()+e;for(;o.pos()<t;)i.coords.push(o.getSInt64());break}case t:c=n.OPTIMIZED_GEOMETRY_TYPES[o.getEnum()];break;default:o.skip()}return{queryGeometry:i,queryGeometryType:c}}function k(e){const t=1,s=2,r=3,a=4,n=5,o=6,i=7,c=8,l=9,g=e.asUnsafe();for(;g.next();)switch(g.tag()){case t:return g.getString();case s:return g.getFloat();case r:return g.getDouble();case a:return g.getSInt32();case n:return g.getUInt32();case o:return g.getInt64();case i:return g.getUInt64();case c:return g.getSInt64();case l:return g.getBool();default:return g.skip(),null}return null}function d(e){const t=1,s=2,r=3,a=4,n=5,o=6,i=e.asUnsafe(),c={type:l(0)};for(;i.next();)switch(i.tag()){case t:c.name=i.getString();break;case s:c.type=l(i.getEnum());break;case r:c.alias=i.getString();break;case a:c.sqlType=g(i.getEnum());break;case n:i.skip();break;case o:c.defaultValue=i.getString();break;default:i.skip()}return c}function T(e){const t=1,s=2,r={},a=e.asUnsafe();for(;a.next();)switch(a.tag()){case t:r.name=a.getString();break;case s:r.isSystemMaintained=a.getBool();break;default:a.skip()}return r}function h(e,t,s,r){const a=1,n=2,o=4,i=t.createFeature(s);let c=0;for(;e.next();)switch(e.tag()){case a:{const t=r[c++].name;i.attributes[t]=e.processMessage(k);break}case n:i.geometry=e.processMessageWithArgs(y,t,s);break;case o:i.centroid=e.processMessageWithArgs(f,t,s);break;default:e.skip()}return i}function m(e){const t=1,s=2,r=3,a=4,n=[1,1,1,1],o=e.asUnsafe();for(;o.next();)switch(o.tag()){case t:n[0]=o.getDouble();break;case s:n[1]=o.getDouble();break;case a:n[2]=o.getDouble();break;case r:n[3]=o.getDouble();break;default:o.skip()}return n}function I(e){const t=1,s=2,r=3,a=4,n=[0,0,0,0],o=e.asUnsafe();for(;o.next();)switch(o.tag()){case t:n[0]=o.getDouble();break;case s:n[1]=o.getDouble();break;case a:n[2]=o.getDouble();break;case r:n[3]=o.getDouble();break;default:o.skip()}return n}function q(e){const t=1,s=2,r=3,a={originPosition:u(0)},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case t:a.originPosition=u(n.getEnum());break;case s:a.scale=n.processMessage(m);break;case r:a.translate=n.processMessage(I);break;default:n.skip()}return a}function F(e){const t=1,s=2,r=3,a={},n=e.asUnsafe();for(;n.next();)switch(n.tag()){case t:a.shapeAreaFieldName=n.getString();break;case s:a.shapeLengthFieldName=n.getString();break;case r:a.units=n.getString();break;default:n.skip()}return a}function S(e,t){const s=1,r=2,a=3,n=4,o=5,i=t.createSpatialReference();for(;e.next();)switch(e.tag()){case s:i.wkid=e.getUInt32();break;case o:i.wkt=e.getString();break;case r:i.latestWkid=e.getUInt32();break;case a:i.vcsWkid=e.getUInt32();break;case n:i.latestVcsWkid=e.getUInt32();break;default:e.skip()}return i}function U(e,t){const s=1,r=2,a=3,n=4,o=5,i=7,c=8,l=9,g=10,u=11,f=12,y=13,b=15,k=t.createFeatureResult(),m=e.asUnsafe();k.geometryType=p(t,0);let I=!1;for(;m.next();)switch(m.tag()){case s:k.objectIdFieldName=m.getString();break;case a:k.globalIdFieldName=m.getString();break;case n:k.geohashFieldName=m.getString();break;case o:k.geometryProperties=m.processMessage(F);break;case i:k.geometryType=p(t,m.getEnum());break;case c:k.spatialReference=m.processMessageWithArgs(S,t);break;case g:k.hasZ=m.getBool();break;case u:k.hasM=m.getBool();break;case f:k.transform=m.processMessage(q);break;case l:{const e=m.getBool();k.exceededTransferLimit=e;break}case y:t.addField(k,m.processMessage(d));break;case b:I||(t.prepareFeatures(k),I=!0),t.addFeature(k,m.processMessageWithArgs(h,t,k,k.fields));break;case r:k.uniqueIdField=m.processMessage(T);break;default:m.skip()}return t.finishFeatureResult(k),k}function w(e,t){const r=1,a=4,n={};let o=null;for(;e.next();)switch(e.tag()){case a:o=e.processMessageWithArgs(b);break;case r:n.featureResult=e.processMessageWithArgs(U,t);break;default:e.skip()}return s.isSome(o)&&n.featureResult&&t.addQueryGeometry(n,o),n}function M(e,s){try{const t=2,a=new r(new Uint8Array(e),new DataView(e)),n={};for(;a.next();)if(a.tag()===t)n.queryResult=a.processMessageWithArgs(w,s);else a.skip();return n}catch(a){throw new t("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:a})}}e.parseFeatureQuery=M,e.parseFieldType=l,e.parseTransform=q,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
