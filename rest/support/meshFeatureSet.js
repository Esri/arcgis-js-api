/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../Graphic","../../core/maybe","../../geometry/Extent","../../geometry/Mesh","../../geometry/Point","../../geometry/support/axisAngleDegrees","../../geometry/support/MeshTransform","./FeatureSet"],(function(e,t,r,n,s,o,a,i,u){"use strict";function l(e,n,s){const o=s.features;s.features=[],delete s.geometryType;const a=u.fromJSON(s);if(a.geometryType="mesh",!s.assetMaps)return a;const i=E(n,s.assetMaps),l=a.spatialReference,m=s.globalIdFieldName,g=r.isNone(e.outFields)||!e.outFields.length?()=>({}):c(e.outFields.includes("*")?null:new Set(e.outFields));for(const u of o){const e=f(u,m,l,n,i);r.isSome(e)&&a.features.push(new t({geometry:e,attributes:g(u)}))}return a}function c(e){return({attributes:t})=>{if(!t)return{};if(!e)return t;for(const r in t)e.has(r)||delete t[r];return t}}function f(e,t,r,o,a){const i=e.attributes[t],u=a.get(i);if(null==u||u.status===p.FAILED||null==u.url)return null;const l=m(e,r,o),c=n.fromJSON(e.geometry);c.spatialReference=r;const f=g(e.attributes,o,u.geographic);return u.status===p.PENDING?s.createIncomplete(l,{extent:c,transform:f}):s.createWithExternalSource(l,[{name:u.name,source:u.url}],{extent:c,transform:f})}function m({attributes:e},t,{transformFieldRoles:r}){return new o({x:e[r.originX],y:e[r.originY],z:e[r.originZ],spatialReference:t})}function g(e,{transformFieldRoles:t},r){return new i({translation:[e[t.translationX],e[t.translationY],e[t.translationZ]],rotation:a.fromAxisAndAngle([e[t.rotationX],e[t.rotationY],e[t.rotationZ]],e[t.rotationDeg]),scale:[e[t.scaleX],e[t.scaleY],e[t.scaleZ]],geographic:r})}var p;function E(e,t){const r=new Map;for(const n of t){const e=n.parentGlobalId;if(null==e)continue;const t=n.assetName,s=n.assetURL,o=n.conversionStatus;let a=r.get(e);if(null!=a)throw new Error("multiple asset parts not expected.");switch(a={name:t,status:p.FAILED,url:s,geographic:d(n.flags).projectVertices},r.set(e,a),o){case"COMPLETED":case"SUBMITTED":a.status=p.COMPLETED;break;case"INPROGRESS":a.status=p.PENDING;break;default:a.status=p.FAILED}}return r}function d(e){return{projectVertices:e.includes("PROJECT_VERTICES")}}!function(e){e[e.FAILED=0]="FAILED",e[e.PENDING=1]="PENDING",e[e.COMPLETED=2]="COMPLETED"}(p||(p={})),e.meshFeatureSetFromJSON=l,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
