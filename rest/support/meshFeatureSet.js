/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../Graphic","../../core/maybe","../../geometry/Extent","../../geometry/Mesh","../../geometry/Point","../../geometry/SpatialReference","../../geometry/support/axisAngleDegrees","../../geometry/support/MeshTransform","./FeatureSet"],(function(e,t,r,n,s,o,a,i,u,c){"use strict";function l(e,n,s){const o=s.features;s.features=[],delete s.geometryType;const i=c.fromJSON(s);if(i.geometryType="mesh",!s.assetMaps)return i;const u=d(n,s.assetMaps),l=i.spatialReference??a.WGS84,g=s.globalIdFieldName,{outFields:p}=e,E=r.isSome(p)&&p.length>0?f(p.includes("*")?null:new Set(p)):()=>({});for(const a of o){const e=m(a,g,l,n,u);r.isSome(e)&&i.features.push(new t({geometry:e,attributes:E(a)}))}return i}function f(e){return({attributes:t})=>{if(!t)return{};if(!e)return t;for(const r in t)e.has(r)||delete t[r];return t}}function m(e,t,r,o,a){const i=e.attributes[t],u=a.get(i);if(null==u||u.status===E.FAILED||null==u.url)return null;const c=g(e,r,o),l=n.fromJSON(e.geometry);l.spatialReference=r;const f=p(e.attributes,o,u.projectVertices);return u.status===E.PENDING?s.createIncomplete(c,{extent:l,transform:f}):s.createWithExternalSource(c,[{name:u.name,source:u.url}],{extent:l,transform:f})}function g({attributes:e},t,{transformFieldRoles:r}){return new o({x:e[r.originX],y:e[r.originY],z:e[r.originZ],spatialReference:t})}function p(e,{transformFieldRoles:t},r){return new u({translation:[e[t.translationX],-e[t.translationZ],e[t.translationY]],rotation:i.fromAxisAndAngle([e[t.rotationX],e[t.rotationZ],e[t.rotationY]],e[t.rotationDeg]),scale:[e[t.scaleX],e[t.scaleY],e[t.scaleZ]],geographic:r})}var E;function d(e,t){const r=new Map;for(const n of t){const e=n.parentGlobalId;if(null==e)continue;const t=n.assetName,s=n.assetURL,o=n.conversionStatus;let a=r.get(e);if(null==a)switch(a={name:t,status:E.FAILED,url:s,projectVertices:S(n.flags).projectVertices},r.set(e,a),o){case"COMPLETED":case"SUBMITTED":a.status=E.COMPLETED;break;case"INPROGRESS":a.status=E.PENDING;break;default:a.status=E.FAILED}else console.warn(`Multiple asset parts not expected. Ignoring additional parts. conflicting assetname: ${n.assetName}`)}return r}function S(e){return{projectVertices:e.includes("PROJECT_VERTICES")}}!function(e){e[e.FAILED=0]="FAILED",e[e.PENDING=1]="PENDING",e[e.COMPLETED=2]="COMPLETED"}(E||(E={})),e.meshFeatureSetFromJSON=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
