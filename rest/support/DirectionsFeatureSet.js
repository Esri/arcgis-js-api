/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../geometry","../../Graphic","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/Logger","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","./FeatureSet","../../geometry/SpatialReference","../../geometry/Point","../../geometry/Polyline","../../geometry/Extent"],(function(e,t,r,o,s,a,n,p,i,c,u,l,y,m,d,g){"use strict";let f=function(t){function r(e){var r;return(r=t.call(this,e)||this).extent=null,r.features=null,r.geometryType="polyline",r.routeId=null,r.routeName=null,r.totalDriveTime=null,r.totalLength=null,r.totalTime=null,r}e._inheritsLoose(r,t);var a=r.prototype;return a.readFeatures=function(e,t){(e||[]).forEach((e=>{this._decompressFeatureGeometry(e,t.summary.envelope.spatialReference)}));const r=y.fromJSON(t.spatialReference);return e.map((e=>{const t=o.fromJSON(e),a=e.geometry&&e.geometry.spatialReference;return t.geometry&&!a&&(s.unwrap(t.geometry).spatialReference=r),t.strings=e.strings,t.events=(e.events||[]).map((t=>{const r=new o({geometry:new m({x:t.point.x,y:t.point.y,z:t.point.z,hasZ:void 0!==t.point.z,spatialReference:e.geometry&&e.geometry.spatialReference}),attributes:{ETA:t.ETA,arriveTimeUTC:t.arriveTimeUTC}});return r.strings=t.strings,r})),t}))},a._decompressFeatureGeometry=function(e,t){e.geometry=this._decompressGeometry(e.compressedGeometry,t)},a._decompressGeometry=function(e,t){let r=0,o=0,s=0,a=0;const n=[];let p,i,c,u,l,y,m,d,g=0,f=0,h=0;if(l=e.match(/((\+|\-)[^\+\-\|]+|\|)/g),l||(l=[]),0===parseInt(l[g],32)){g=2;const e=parseInt(l[g],32);g++,y=parseInt(l[g],32),g++,1&e&&(f=l.indexOf("|")+1,m=parseInt(l[f],32),f++),2&e&&(h=l.indexOf("|",f)+1,d=parseInt(l[h],32),h++)}else y=parseInt(l[g],32),g++;for(;g<l.length&&"|"!==l[g];){p=parseInt(l[g],32)+r,g++,r=p,i=parseInt(l[g],32)+o,g++,o=i;const e=[p/y,i/y];f&&(u=parseInt(l[f],32)+s,f++,s=u,e.push(u/m)),h&&(c=parseInt(l[h],32)+a,h++,a=c,e.push(c/d)),n.push(e)}return{paths:[n],hasZ:f>0,hasM:h>0,spatialReference:t}},a._mergePolylinesToSinglePath=function(e,t){let r=[];(e||[]).forEach((e=>{e.paths.forEach((e=>{r=r.concat(e)}))}));const o=[];let s=[0,0];return r.forEach((e=>{e[0]===s[0]&&e[1]===s[1]||(o.push(e),s=e)})),new d({paths:[o]},t)},e._createClass(r,[{key:"mergedGeometry",get:function(){if(!this.features)return null;const e=this.features.map((({geometry:e})=>s.unwrap(e))),t=this.get("extent.spatialReference");return this._mergePolylinesToSinglePath(e,t)}},{key:"strings",get:function(){return this.features.map((({strings:e})=>e))}}]),r}(l);return t.__decorate([a.property({type:g,json:{read:{source:"summary.envelope"}}})],f.prototype,"extent",void 0),t.__decorate([a.property()],f.prototype,"features",void 0),t.__decorate([c.reader("features")],f.prototype,"readFeatures",null),t.__decorate([a.property()],f.prototype,"geometryType",void 0),t.__decorate([a.property({readOnly:!0})],f.prototype,"mergedGeometry",null),t.__decorate([a.property()],f.prototype,"routeId",void 0),t.__decorate([a.property()],f.prototype,"routeName",void 0),t.__decorate([a.property({value:null,readOnly:!0})],f.prototype,"strings",null),t.__decorate([a.property({json:{read:{source:"summary.totalDriveTime"}}})],f.prototype,"totalDriveTime",void 0),t.__decorate([a.property({json:{read:{source:"summary.totalLength"}}})],f.prototype,"totalLength",void 0),t.__decorate([a.property({json:{read:{source:"summary.totalTime"}}})],f.prototype,"totalTime",void 0),f=t.__decorate([u.subclass("esri.rest.support.DirectionsFeatureSet")],f),f}));
