/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../geometry/Extent","../../geometry/Point","../../geometry/SpatialReference","../../layers/support/RasterInfo","../utils","../support/FeatureSet"],(function(e,t,a,l,n,i,s,r,u){"use strict";function o(e,t,a){return f.apply(this,arguments)}function f(){return(f=t._asyncToGenerator((function*(e,t,o){const f=r.parseUrl(e),{renderingRule:c,sourceJSON:p}=t||{},d=c?JSON.stringify(c.rasterFunctionDefinition||c):null,m=r.encode({...f.query,renderingRule:d,f:"json"}),h=r.asValidOptions(m,o);e=f.path;const g=p||(yield a(e,h).then((e=>e.data))),y=g.hasRasterAttributeTable?a(`${e}/rasterAttributeTable`,h):null,S=g.hasColormap?a(`${e}/colormap`,h):null,v=g.hasHistograms?a(`${e}/histograms`,h):null,V=g.currentVersion>=10.3?a(`${e}/keyProperties`,h):null,b=g.hasMultidimensions?a(`${e}/multidimensionalInfo`,h):null,x=yield Promise.allSettled([y,S,v,V,b]);let D=null;if(g.minValues&&g.minValues.length===g.bandCount){D=[];for(let e=0;e<g.minValues.length;e++)D.push({min:g.minValues[e],max:g.maxValues[e],avg:g.meanValues[e],stddev:g.stdvValues[e]})}const R=l.fromJSON(g.extent),T=Math.ceil(R.width/g.pixelSizeX-.1),O=Math.ceil(R.height/g.pixelSizeY-.1),I=i.fromJSON(g.spatialReference||g.extent.spatialReference),J="fulfilled"===x[0].status&&x[0].value?u.fromJSON(x[0].value.data):null,N="fulfilled"===x[1].status?x[1].value?.data.colormap:null,P="fulfilled"===x[2].status?x[2].value?.data.histograms:null,w="fulfilled"===x[3].status?x[3].value?.data??{}:{},z="fulfilled"===x[4].status?x[4].value?.data.multidimensionalInfo:null;z?.variables?.length&&z.variables.forEach((e=>{e.statistics?.length&&e.statistics.forEach((e=>{e.avg=e.mean,e.stddev=e.standardDeviation}))}));const{defaultVariable:C,serviceDataType:$}=g;C&&C!==w.DefaultVariable&&(w.DefaultVariable=C),$&&$.includes("esriImageServiceDataTypeVector")&&!$.includes(w.DataType)&&(w.DataType=$.replace("esriImageServiceDataType",""));let M=g.noDataValue;return g.noDataValues?.length&&g.noDataValues.some((e=>e!==M))&&(M=g.noDataValues),new s({width:T,height:O,bandCount:g.bandCount,extent:l.fromJSON(g.extent),spatialReference:I,pixelSize:new n({x:g.pixelSizeX,y:g.pixelSizeY,spatialReference:I}),pixelType:g.pixelType.toLowerCase(),statistics:D,attributeTable:J,colormap:N,histograms:P,keyProperties:w,noDataValue:M,multidimensionalInfo:z})}))).apply(this,arguments)}function c(e,t,a){return o(e,{sourceJSON:t},a)}function p(e,t,a){return o(e,{renderingRule:t},a)}e.fetchServiceRasterInfo=c,e.generateRasterInfo=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
