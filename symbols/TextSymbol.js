define(["dojo/_base/declare","dojo/_base/lang","dojo/has","dojox/gfx/_base","../kernel","../lang","../Color","./Symbol","./Font"],function(t,e,i,n,o,s,r,l,h){var a={ALIGN_START:"start",ALIGN_MIDDLE:"middle",ALIGN_END:"end",DECORATION_NONE:"none",DECORATION_UNDERLINE:"underline",DECORATION_OVERLINE:"overline",DECORATION_LINETHROUGH:"line-through"},f={type:"textsymbol",x:0,y:0,text:"",rotated:!1,kerning:!0,color:[0,0,0,1],font:n.defaultFont,angle:0,xoffset:0,yoffset:0,horizontalAlignment:"center"},g={start:"left",middle:"center",end:"right"},c={left:"start",center:"middle",right:"end",justify:"start"},d={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},u=document.createElement("canvas"),m=t(l,{declaredClass:"esri.symbol.TextSymbol",angle:0,xoffset:0,yoffset:0,constructor:function(t,i,o){e.mixin(this,f),this.font=new h(this.font),this.color=new r(this.color),t&&(e.isObject(t)?(e.mixin(this,t),this.color&&s.isDefined(this.color[0])&&(this.color=r.toDojoColor(this.color)),this.type="textsymbol",this.font=new h(this.font),this.xoffset=n.pt2px(this.xoffset),this.yoffset=n.pt2px(this.yoffset),this.angle&&(this.angle=-1*this.angle)):(this.text=t,i&&(this.font=i),o&&(this.color=o))),this.setAlign(this.align||this.getSVGAlign())},setFont:function(t){return this.font=t,this},setSize:function(t){return this.font.size=t,this},setAngle:function(t){return this.angle=t,this},setOffset:function(t,e){return this.xoffset=t,this.yoffset=e,this},setAlign:function(t){return this.align=t,this.setHorizontalAlignment(t&&g[t.toLowerCase()]||"center"),this},setHorizontalAlignment:function(t){return this.horizontalAlignment=t,this},getSVGAlign:function(){var t=this.horizontalAlignment;return t=t&&c[t.toLowerCase()]||"middle"},setVerticalAlignment:function(t){return this.verticalAlignment=t,this},getSVGBaseline:function(){var t=this.verticalAlignment;return t&&d[t.toLowerCase()]||"alphabetic"},getSVGBaselineShift:function(){return"bottom"===this.verticalAlignment?"super":null},setDecoration:function(t){return this.decoration=t,this.font||this.setFont(new h),this.font.setDecoration(t),this},setRotated:function(t){return this.rotated=t,this},setKerning:function(t){return this.kerning=t,this},setText:function(t){return this.text=t,this},getStroke:function(){return null},getFill:function(){return this.color},getWidth:function(){var t=u&&u.getContext&&u.getContext("2d");if(t){var e=this.font,i=e.style?e.style:n.defaultFont.style,o=e.weight?e.weight:n.defaultFont.weight,s=e.size?e.size:n.defaultFont.size,r=e.family?e.family:n.defaultFont.family;return t.font=i+" "+o+" "+s+"px "+r,t.measureText(this.text).width}var l,h,a=this.getHeight(),f=0;for(l=0;l<this.text.length;l++)h=this.text.charAt(l),f+=h==h.toUpperCase()?.7*a:.5*a;return f},getHeight:function(){return n.normalizedLength(this.font.size)},getShapeDescriptors:function(){var t,e=this.font;return e&&(t={},e.size&&(t.size=e.size),e.style&&(t.style=e.style),e.variant&&(t.variant=e.variant),e.decoration&&(t.decoration=e.decoration),e.weight&&(t.weight=e.weight),e.family&&(t.family=e.family)),{defaultShape:{type:"text",text:this.text,x:0,y:this.getHeight()/4,align:"middle",decoration:this.decoration||e&&e.decoration,rotated:this.rotated,kerning:this.kerning},font:t,fill:this.getFill(),stroke:this.getStroke()}},toJson:function(){var t=n.px2pt(this.xoffset),i=n.px2pt(this.yoffset);return t=isNaN(t)?void 0:t,i=isNaN(i)?void 0:i,s.fixJson(e.mixin(this.inherited("toJson",arguments),{type:"esriTS",backgroundColor:this.backgroundColor,borderLineColor:this.borderLineColor,borderLineSize:this.borderLineSize,haloSize:this.haloSize,haloColor:this.haloColor,verticalAlignment:this.verticalAlignment,horizontalAlignment:this.horizontalAlignment,rightToLeft:this.rightToLeft,width:this.width,angle:this.angle&&-1*this.angle,xoffset:t,yoffset:i,text:this.text,rotated:this.rotated,kerning:this.kerning,font:this.font.toJson()}))}});return e.mixin(m,a),m.defaultProps=f,i("extend-esri")&&(e.setObject("symbol.TextSymbol",m,o),o.symbol.defaultTextSymbol=f),m});