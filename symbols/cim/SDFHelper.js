/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../geometry/support/jsonUtils","./Rect","./packingUtils"],(function(t,n,o,e){"use strict";function r(t){let n=1/0,o=-1/0,e=1/0,r=-1/0;for(const l of t)for(const t of l)t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<e&&(e=t[1]),t[1]>r&&(r=t[1]);return[n,e,o,r]}function l(t,n){const o=2*n,r=t.length,l=new Uint8Array(4*r);for(let n=0;n<r;++n){const r=.5-t[n]/o;e.packFloatRGBA(r,l,4*n)}return l}t.buildSDF=function(t){const n=(e=t.geom)?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null;var e;const r=function(t){let n=1/0,e=-1/0,r=1/0,l=-1/0;for(const o of t)for(const t of o)t[0]<n&&(n=t[0]),t[0]>e&&(e=t[0]),t[1]<r&&(r=t[1]),t[1]>l&&(l=t[1]);return new o(n,r,e-n,l-r)}(n),i=Math.floor(31.5),s=(128-2*(i+1))/Math.max(r.width,r.height),f=Math.round(r.width*s)+2*i,a=Math.round(r.height*s)+2*i,c=[];for(const o of n)if(o&&o.length>1){const n=[];for(const t of o){let[o,e]=t;o-=r.x,e-=r.y,o*=s,e*=s,o+=i-.5,e+=i-.5,n.push([o,e])}if(t.asFill){const t=n.length-1;n[0][0]===n[t][0]&&n[0][1]===n[t][1]||n.push(n[0])}c.push(n)}const u=function(t,n,o,e){const r=n*o,l=new Array(r),i=e*e+1;for(let t=0;t<r;++t)l[t]=i;for(const r of t){const t=r.length;for(let i=1;i<t;++i){const t=r[i-1],s=r[i];let f,a,c,u;t[0]<s[0]?(f=t[0],a=s[0]):(f=s[0],a=t[0]),t[1]<s[1]?(c=t[1],u=s[1]):(c=s[1],u=t[1]);let m=Math.floor(f)-e,y=Math.floor(a)+e,h=Math.floor(c)-e,x=Math.floor(u)+e;m<0&&(m=0),y>n&&(y=n),h<0&&(h=0),x>o&&(x=o);const g=s[0]-t[0],M=s[1]-t[1],p=g*g+M*M;for(let e=m;e<y;e++)for(let r=h;r<x;r++){let i,f,a=(e-t[0])*g+(r-t[1])*M;a<0?(i=t[0],f=t[1]):a>p?(i=s[0],f=s[1]):(a/=p,i=t[0]+a*g,f=t[1]+a*M);const c=(e-i)*(e-i)+(r-f)*(r-f),u=(o-r-1)*n+e;c<l[u]&&(l[u]=c)}}}for(let t=0;t<r;++t)l[t]=Math.sqrt(l[t]);return l}(c,f,a,i);return t.asFill&&function(t,n,o,e,r){for(const l of t){const t=l.length;for(let i=1;i<t;++i){const t=l[i-1],s=l[i];let f,a,c,u;t[0]<s[0]?(f=t[0],a=s[0]):(f=s[0],a=t[0]),t[1]<s[1]?(c=t[1],u=s[1]):(c=s[1],u=t[1]);let m=Math.floor(f),y=Math.floor(a)+1,h=Math.floor(c),x=Math.floor(u)+1;m<e&&(m=e),y>n-e&&(y=n-e),h<e&&(h=e),x>o-e&&(x=o-e);for(let l=h;l<x;++l){if(t[1]>l==s[1]>l)continue;const i=(o-l-1)*n;for(let n=m;n<y;++n)n<(s[0]-t[0])*(l-t[1])/(s[1]-t[1])+t[0]&&(r[i+n]=-r[i+n]);for(let t=e;t<m;++t)r[i+t]=-r[i+t]}}}}(c,f,a,i,u),[l(u,i),f,a]},t.getExtent=function(t){return t?t.rings?r(t.rings):t.paths?r(t.paths):n.isExtent(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null},t.getSDFInfo=function t(n){if(!n)return null;switch(n.type){case"CIMPointSymbol":{const o=n.symbolLayers;return o&&1===o.length?t(o[0]):null}case"CIMVectorMarker":{const t=n.markerGraphics;if(!t||1!==t.length)return null;const o=t[0];if(!o)return null;const e=o.geometry;if(!e)return null;const r=o.symbol;return!r||"CIMPolygonSymbol"!==r.type&&"CIMLineSymbol"!==r.type?null:{geom:e,asFill:"CIMPolygonSymbol"===r.type}}case"sdf":return{geom:n.geom,asFill:n.asFill}}return null},t.getSDFMetrics=function(t,n,o,e,r){const[l,i,s,f]=t;if(s<l||f<i)return[0,0,0];const a=s-l,c=f-i,u=Math.floor(31.5),m=(128-2*(u+1))/Math.max(a,c),y=Math.round(a*m)+2*u,h=Math.round(c*m)+2*u;let x=1;if(n){x=h/m/(n.ymax-n.ymin)}let g=0,M=0;if(e)if(r){if(n&&o&&n.ymax-n.ymin>0){const t=(n.xmax-n.xmin)/(n.ymax-n.ymin);g=e.x/(o*t),M=e.y/o}}else g=e.x,M=e.y;return g=.5*(n.xmax+n.xmin)+g*(n.xmax-n.xmin),M=.5*(n.ymax+n.ymin)+M*(n.ymax-n.ymin),g-=l,M-=i,g*=m,M*=m,g+=u,M+=u,[x,g/y-.5,-(M/h-.5)]},t.getSDFSymbol=function(t){const n=t.markerGraphics;if(!n||1!==n.length)return null;const o=n[0];if(!o)return null;const e=o.symbol;return!e||"CIMPolygonSymbol"!==e.type&&"CIMLineSymbol"!==e.type?null:e},Object.defineProperty(t,"__esModule",{value:!0})}));
