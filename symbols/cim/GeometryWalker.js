/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","./CIMCursor","./CurveHelper"],(function(t,e,s,n){"use strict";let i=function(){function t(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}var e=t.prototype;return e.isEmpty=function(){return 0===this._values.length},e.size=function(){return this._values.length},e.init=function(t,e,s=!0){if(this._setEmpty(),!t||0===t.length)return!1;for(let e=0;e<t.length;e++){let n=Math.abs(t[e]);s&&n<1e-7&&(n=1e-7),this._values.push(n),this._length+=n}return e&&1&t.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)},e.scale=function(t){const e=this._values?this._values.length:0;for(let s=0;s<e;++s)this._values[s]*=t;this._length*=t,this.extPtGap*=t,this.ctrlPtGap*=t},e.addValue=function(t){this._length+=t,this._values.push(t)},e.firstValue=function(){return this._values[0]},e.lastValue=function(){return this._values[this._values.length-1]},e.nextValue=function(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]},e.reset=function(){this._currentValue=-1},e.length=function(){return this._length},e._setEmpty=function(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0},t}(),h=function(){function t(){this.reset()}var e=t.prototype;return e.reset=function(){this.segment=-1,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1},e.isValid=function(){return-1!==this.segment},e.copyTo=function(t){t.segment=this.segment,t.segmentLength=this.segmentLength,t.abscissa=this.abscissa,t.isPathEnd=this.isPathEnd,t.isPartEnd=this.isPartEnd},t}(),r=function(t){function i(e=0,s=!1){var i;return(i=t.call(this,e,s)||this)._tolerance=n.PIXEL_TOLERANCE,i._currentPosition=new h,i}e._inheritsLoose(i,t);var r=i.prototype;return r.updateTolerance=function(t){this._tolerance=n.PIXEL_TOLERANCE*t},r.init=function(t,e,s=!0){return s?(this._patternLength=e.length(),this._partExtPtGap=e.extPtGap,this._partCtrlPtGap=e.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._path=t,this._seg=-1,this.setPosAtNextPart()},r.curPositionIsValid=function(){return this._currentPosition.isValid()},r.nextPosition=function(t,e=0){const s=new h;return!!this._nextPosition(t,s,null,e)&&(s.copyTo(this._currentPosition),!0)},r.curPointAndAngle=function(t){t.pt=this._getPoint(this._currentPosition);const[e,s]=this._getAngle(this._currentPosition);t.ca=e,t.sa=s},r.nextPointAndAngle=function(t,e,s=0){const n=new h;if(!this._nextPosition(t,n,null,s))return!1;n.copyTo(this._currentPosition),e.pt=this._getPoint(n);const[i,r]=this._getAngle(n);return e.ca=i,e.sa=r,!0},r.nextCurve=function(t){if(0===t)return null;const e=[],s=new h;return this._nextPosition(t,s,e,1)?(s.copyTo(this._currentPosition),e):null},r.isPathEnd=function(){return this._currentPosition.isPathEnd},r.getPathEnd=function(){if(-1===this._currentPosition.segment)throw new Error("missing segment");return this._path[this._currentPosition.segment+1]},r._nextPosition=function(t,e,s,n){if(this._currentPosition.isPathEnd)return!1;let i=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(i/=this._currentPosition.segmentLength),this._currentPosition.copyTo(e);e.abscissa+t*this._partLengthRatio>e.segmentLength+this._tolerance;){if(s){if(0===s.length)if(0===i){const t=this._path[e.segment];s.push([t[0],t[1]])}else s.push(this.getSegCoord2D(this._path,e.segment,i));const t=this._path[e.segment+1];s.push([t[0],t[1]])}if(i=0,t-=(e.segmentLength-e.abscissa)/this._partLengthRatio,this._partSegCount)e.segment=this.nextSegment(),e.segmentLength=this.calculateSegLength(this._path,e.segment),e.abscissa=0,this._partSegCount--;else{if(!this.setPosAtNextPart())return 0!==n&&(e.segmentLength=this.calculateSegLength(this._path,e.segment),e.isPartEnd=!0,1===n?(e.abscissa=e.segmentLength,e.isPathEnd=!0):e.abscissa=e.segmentLength+t,!0);this._currentPosition.copyTo(e)}}if(e.abscissa+=t*this._partLengthRatio,s){if(0===s.length)if(0===i){const t=this._path[e.segment];s.push([t[0],t[1]])}else s.push(this.getSegCoord2D(this._path,e.segment,i));const t=e.abscissa/e.segmentLength;if(1===t){const t=this._path[e.segment+1];s.push([t[0],t[1]])}else s.push(this.getSegCoord2D(this._path,e.segment,t))}return this._partSegCount||Math.abs(e.abscissa-e.segmentLength)<this._tolerance&&(e.isPathEnd=this._partIsLast,e.isPartEnd=!0),!0},r._getPoint=function(t){if(-1===t.segment)throw new Error("missing segment");const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegCoord2D(this._path,t.segment,e)},r._getAngle=function(t){if(-1===t.segment)throw new Error("missing segment");const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(this._path,t.segment,e)},r.setPosAtNextPart=function(){for(;this._partSegCount;)this.hasNextSegment()&&this.nextSegment(),this._partSegCount--;if(!this.hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this.hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this.nextSegment()),this._partSegCount++,1===s.getId(this._path[this.getEndPointIndex()])){this._partIsLast=!this.hasNextSegment();break}let t=this._partSegCount;for(;t;)this.previousSegment(),--t;this._currentPosition.segment=this.nextSegment(),this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const e=this.getStartPointIndex();this._ctrlPtBegin=1===s.getId(this._path[e]);let n=e+this._partSegCount+1;if(n>=this._path.length&&(n=0),this._ctrlPtEnd=1===s.getId(this._path[n]),this._patternLength>0){const t=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,e=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let s=Math.round((this._partLength-(t+e))/this._patternLength);s<=0&&(s=t+e>0?0:1),this._partLengthRatio=this._partLength/(t+e+s*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0},r.hasNextSegment=function(){return this._seg<this._path.length-2},r.previousSegment=function(){return--this._seg},r.nextSegment=function(){return++this._seg},r.getStartPointIndex=function(){return this._seg},r.getEndPointIndex=function(){return this._seg+1},i}(n.CurveHelper);t.DashPattern=i,t.GeometryWalker=r,Object.defineProperty(t,"__esModule",{value:!0})}));
