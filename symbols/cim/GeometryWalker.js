/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","./CIMCursor","./CurveHelper"],(function(t,e,n,s){"use strict";const i=1e-7;let h=function(){function t(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}var e=t.prototype;return e.isEmpty=function(){return 0===this._values.length},e.size=function(){return this._values.length},e.init=function(t,e,n=!0){if(this._setEmpty(),!t||0===t.length)return!1;for(let s=0;s<t.length;s++){let e=Math.abs(t[s]);n&&e<i&&(e=i),this._values.push(e),this._length+=e}return e&&1&t.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)},e.scale=function(t){const e=this._values?this._values.length:0;for(let n=0;n<e;++n)this._values[n]*=t;this._length*=t,this.extPtGap*=t,this.ctrlPtGap*=t},e.addValue=function(t){this._length+=t,this._values.push(t)},e.firstValue=function(){return this._values[0]},e.lastValue=function(){return this._values[this._values.length-1]},e.nextValue=function(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]},e.reset=function(){this._currentValue=-1},e.length=function(){return this._length},e._setEmpty=function(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0},t}();var r;t.EndType=void 0,(r=t.EndType||(t.EndType={}))[r.FAIL=0]="FAIL",r[r.END=1]="END",r[r.CONTINUE=2]="CONTINUE";let a=function(){function t(){this.reset()}var e=t.prototype;return e.reset=function(){this.segment=-1,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1},e.isValid=function(){return-1!==this.segment},e.copyTo=function(t){t.segment=this.segment,t.segmentLength=this.segmentLength,t.abscissa=this.abscissa,t.isPathEnd=this.isPathEnd,t.isPartEnd=this.isPartEnd},t}(),o=function(i){function h(t=0,e=!1){var n;return(n=i.call(this,t,e)||this)._tolerance=s.PIXEL_TOLERANCE,n._currentPosition=new a,n}e._inheritsLoose(h,i);var r=h.prototype;return r.updateTolerance=function(t){this._tolerance=s.PIXEL_TOLERANCE*t},r.init=function(t,e,n=!0){return n?(this._patternLength=e.length(),this._partExtPtGap=e.extPtGap,this._partCtrlPtGap=e.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._path=t,this._seg=-1,this._setPosAtNextPart()},r.curPositionIsValid=function(){return this._currentPosition.isValid()},r.nextPosition=function(e,n=t.EndType.FAIL){const s=new a;return!!this._nextPosition(e,s,null,n)&&(s.copyTo(this._currentPosition),!0)},r.curPointAndAngle=function(t){t.pt=this._getPoint(this._currentPosition);const[e,n]=this._getAngle(this._currentPosition);t.ca=e,t.sa=n},r.nextPointAndAngle=function(e,n,s=t.EndType.FAIL){const i=new a;if(!this._nextPosition(e,i,null,s))return!1;i.copyTo(this._currentPosition),n.pt=this._getPoint(i);const[h,r]=this._getAngle(i);return n.ca=h,n.sa=r,!0},r.nextCurve=function(e){if(0===e)return null;const n=[],s=new a;return this._nextPosition(e,s,n,t.EndType.END)?(s.copyTo(this._currentPosition),n):null},r.isPathEnd=function(){return this._currentPosition.isPathEnd},r.getPathEnd=function(){if(-1===this._currentPosition.segment)throw new Error("missing segment");return this._path[this._currentPosition.segment+1]},r._nextPosition=function(e,n,s,i){if(this._currentPosition.isPathEnd)return!1;let h=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(h/=this._currentPosition.segmentLength),this._currentPosition.copyTo(n);n.abscissa+e*this._partLengthRatio>n.segmentLength+this._tolerance;){if(s){if(0===s.length)if(0===h){const t=this._path[n.segment];s.push([t[0],t[1]])}else s.push(this.getSegCoord2D(this._path,n.segment,h));const t=this._path[n.segment+1];s.push([t[0],t[1]])}if(h=0,e-=(n.segmentLength-n.abscissa)/this._partLengthRatio,this._partSegCount)n.segment=this._nextSegment(),n.segmentLength=this.calculateSegLength(this._path,n.segment),n.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return i!==t.EndType.FAIL&&(n.segmentLength=this.calculateSegLength(this._path,n.segment),n.isPartEnd=!0,i===t.EndType.END?(n.abscissa=n.segmentLength,n.isPathEnd=!0):n.abscissa=n.segmentLength+e,!0);this._currentPosition.copyTo(n)}}if(n.abscissa+=e*this._partLengthRatio,s){if(0===s.length)if(0===h){const t=this._path[n.segment];s.push([t[0],t[1]])}else s.push(this.getSegCoord2D(this._path,n.segment,h));const t=n.abscissa/n.segmentLength;if(1===t){const t=this._path[n.segment+1];s.push([t[0],t[1]])}else s.push(this.getSegCoord2D(this._path,n.segment,t))}return this._partSegCount||Math.abs(n.abscissa-n.segmentLength)<this._tolerance&&(n.isPathEnd=this._partIsLast,n.isPartEnd=!0),!0},r._getPoint=function(t){if(-1===t.segment)throw new Error("missing segment");const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegCoord2D(this._path,t.segment,e)},r._getAngle=function(t){if(-1===t.segment)throw new Error("missing segment");const e=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(this._path,t.segment,e)},r._setPosAtNextPart=function(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this._nextSegment()),this._partSegCount++,1===n.getId(this._path[this._getEndPointIndex()])){this._partIsLast=!this._hasNextSegment();break}let t=this._partSegCount;for(;t;)this._previousSegment(),--t;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const e=this._getStartPointIndex();this._ctrlPtBegin=1===n.getId(this._path[e]);let s=e+this._partSegCount+1;if(s>=this._path.length&&(s=0),this._ctrlPtEnd=1===n.getId(this._path[s]),this._patternLength>0){const t=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,e=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let n=Math.round((this._partLength-(t+e))/this._patternLength);n<=0&&(n=t+e>0?0:1),this._partLengthRatio=this._partLength/(t+e+n*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0},r._hasNextSegment=function(){return this._seg<this._path.length-2},r._previousSegment=function(){return--this._seg},r._nextSegment=function(){return++this._seg},r._getStartPointIndex=function(){return this._seg},r._getEndPointIndex=function(){return this._seg+1},h}(s.CurveHelper);t.DashPattern=h,t.GeometryWalker=o,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
