/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../geometry/support/jsonUtils","../CurveHelper","../GeometryWalker"],(function(t,e,i,n){"use strict";let s=function(){function t(){}return t.local=function(){return null===t.instance&&(t.instance=new t),t.instance},t.prototype.execute=function(t,e,i){return new h(t,e,i)},t}();s.instance=null;let h=function(){function t(t,e,i){this._inputGeometries=t,this._height=(void 0!==e.amplitude?e.amplitude:2)*i,this._period=(void 0!==e.period?e.period:3)*i,this._style=e.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new n.DashPattern,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new n.GeometryWalker,this._walker.updateTolerance(i)}var s=t.prototype;return s.next=function(){let t=this._inputGeometries.next();for(;t;){if(0===this._height||0===this._period)return t;if(e.isPolyline(t)){const e=this._processGeom(t.paths);if(e.length)return{paths:e}}if(e.isPolygon(t)){const e=this._processGeom(t.rings);if(e.length)return{rings:e}}t=this._inputGeometries.next()}return null},s._processGeom=function(t){const e=[];for(const i of t)if(this._walker.init(i,this._pattern))switch(this._style){case"Sinus":default:e.push(this._constructCurve(i,!1));break;case"Square":e.push(this._constructSquare(i));break;case"Triangle":e.push(this._constructTriangle(i));break;case"Random":e.push(this._constructCurve(i,!0))}else e.push(i);return e},s._constructCurve=function(t,e){const n=new i.PathHelper,s=this._walker.calculatePathLength(t);let h=Math.round(s/this._period);0===h&&(h=1);const r=16*h+1,a=s/h,o=this._period/16,l=1/r,c=2*Math.PI*s/a,_=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),u=2*Math.PI*Math.random(),d=.75-Math.random()/2,g=.75-Math.random()/2,f={};this._walker.curPointAndAngle(f),n.startPath(f.pt);let P=0;for(;;){if(!this._walker.nextPointAndAngle(o,f)){n.lineTo(t[t.length-1]);break}{const t=P;let i;if(P+=l,e){const e=this._height/2*(1+.3*Math.sin(d*c*t+_));i=e*Math.sin(c*t+p),i+=e*Math.sin(g*c*t+u),i/=2}else i=.5*this._height*Math.sin(.5*c*t);n.lineTo([f.pt[0]-i*f.sa,f.pt[1]+i*f.ca])}}return n.path()},s._constructSquare=function(t){const e=new i.PathHelper,n=this._walker.calculatePathLength(t);let s=Math.round(n/this._period);0===s&&(s=1);let h=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i={};this._walker.curPointAndAngle(i);const n={};if(this._walker.nextPointAndAngle(this._period,n)){const s={};this._walker.nextPointAndAngle(this._period,s)&&(h?(e.startPath(i.pt),h=!1):e.lineTo(i.pt),e.lineTo([i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca]),e.lineTo([n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca]),e.lineTo([n.pt[0]+this._height/2*n.sa,n.pt[1]-this._height/2*n.ca]),e.lineTo([s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca]),t=!0)}}if(!t){e.lineTo(this._walker.getPathEnd());break}}return e.path()},s._constructTriangle=function(t){const e=new i.PathHelper,n=this._walker.calculatePathLength(t);let s=Math.round(n/this._period);0===s&&(s=1);let h=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i={};this._walker.curPointAndAngle(i);const n={};if(this._walker.nextPointAndAngle(this._period/2,n)){const s={};this._walker.nextPointAndAngle(this._period,s)&&(this._walker.nextPosition(this._period/2)&&(h?(e.startPath(i.pt),h=!1):e.lineTo(i.pt),e.lineTo([n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca]),e.lineTo([s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca])),t=!0)}}if(!t){e.lineTo(this._walker.getPathEnd());break}}return e.path()},t}();t.EffectWave=s,Object.defineProperty(t,"__esModule",{value:!0})}));
