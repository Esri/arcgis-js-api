/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{isExtent as e,isPolygon as t,isPolyline as s,isPoint as i}from"../../../geometry/support/jsonUtils.js";import{CurveHelper as n,PIXEL_TOLERANCE as r}from"../CurveHelper.js";import{GeometricEffectOffsetMethod as o}from"../enums.js";class f{static local(){return null===f.instance&&(f.instance=new f),f.instance}execute(e,t,s,i){return new h(e,t,s,i)}}f.instance=null;class h{constructor(e,t,s,i){this._inputGeometries=e,this._curveHelper=new n,this._size=(void 0!==t.size?t.size:1)*s,this._offsetFlattenError=r*s}next(){let n=this._inputGeometries.next();for(;n;){if(e(n))if(this._size>0){const e=[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]],t=this._curveHelper.offset(e,this._size,o.Rounded,4,this._offsetFlattenError);if(t)return{rings:[t]}}else{if(!(this._size<0))return n;if(Math.min(n.xmax-n.xmin,n.ymax-n.ymin)+2*this._size>0)return{xmin:n.xmin-this._size,xmax:n.xmax+this._size,ymin:n.ymin-this._size,ymax:n.ymax+this._size}}if(t(n)){if(0===this._size)return n;const e=[];for(const t of n.rings){const s=this._curveHelper.offset(t,this._size,o.Rounded,4,this._offsetFlattenError);s&&e.push(s)}if(e.length)return{rings:e}}if(s(n)&&this._size>0){const e=[];for(const t of n.paths)if(t&&t.length>1){const s=this._curveHelper.offset(t,this._size,o.Rounded,4,this._offsetFlattenError),i=this._curveHelper.offset(t,-this._size,o.Rounded,4,this._offsetFlattenError);if(s&&i){for(let e=i.length-1;e>=0;e--)s.push(i[e]);s.push([s[0][0],s[0][1]]),e.push(s)}}if(e.length)return{rings:e}}i(n)&&this._size,n=this._inputGeometries.next()}return null}}export{f as EffectBuffer};
