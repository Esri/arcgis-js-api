/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../../geometry","../../../core/maybe","../../../geometry/support/jsonUtils","../CIMEffects","../CurveHelper","../enums","../../../geometry/SpatialReference"],(function(t,e,i,n,s,o,f,r){"use strict";let l=function(){function t(){}return t.local=function(){return null===t.instance&&(t.instance=new t),t.instance},t.prototype.execute=function(t,e,i,n,s){return new h(t,e,i,n,s)},t}();l.instance=null;let h=function(){function t(t,e,i,n,s){this._inputGeometries=t,this._tileKey=n,this._geometryEngine=s,this._curveHelper=new o.CurveHelper,this._offset=(e.offset??1)*i,this._method=e.method,this._option=e.option,this._offsetFlattenError=o.PIXEL_TOLERANCE*i}return t.prototype.next=function(){let t;for(;t=this._inputGeometries.next();){if(0===this._offset)return t;if(n.isExtent(t)){if(this._method===f.GeometricEffectOffsetMethod.Rounded&&this._offset>0){const e=[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]],i=this._curveHelper.offset(e,-this._offset,this._method,4,this._offsetFlattenError);return i?{rings:[i]}:null}if(Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._offset>0)return{xmin:t.xmin-this._offset,xmax:t.xmax+this._offset,ymin:t.ymin-this._offset,ymax:t.ymax+this._offset}}const e=this._geometryEngine;if(i.isNone(e))return null;let o=t;if(n.isPolygon(t)){if(this._tileKey&&(o=s.clipPolygonToTileExtent(t,Math.abs(this._offset)+1),!o||!o.rings||0===o.rings.length))continue}else if(n.isPolyline(t)&&this._tileKey&&(o=s.clipPolylineToTileExtent(t,Math.abs(this._offset)+1),!o||!o.paths||0===o.paths.length))continue;return e.offset(r.WebMercator,o,-this._offset,1,this._method,4,this._offsetFlattenError)}return null},t}();t.EffectOffset=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
