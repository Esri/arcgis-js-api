// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.16/esri/copyright.txt for details.

define(["require","exports"],(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.PIXEL_TOLERANCE=.03;var r=function(){function t(){this._path=[]}return t.prototype.path=function(){return this._path},t.prototype.addPath=function(t,e){e||t.reverse(),Array.prototype.push.apply(this._path,t),e||t.reverse()},t.mergePath=function(t,e){e&&Array.prototype.push.apply(t,e)},t.prototype.startPath=function(t){this._path.push(t)},t.prototype.lineTo=function(t){this._path.push(t)},t.prototype.close=function(){var t=this._path;t.length>1&&(t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]]))},t}();e.PathHelper=r;var n=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=!1)}return t.prototype.normalize=function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);t[0]/=e,t[1]/=e},t.prototype.calculateLength=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)},t.prototype.calculateSegLength=function(t,e){return this.calculateLength(t[e],t[e+1])},t.prototype.calculatePathLength=function(t){for(var e=0,r=t?t.length:0,n=0;n<r-1;++n)e+=this.calculateSegLength(t,n);return e},t.prototype.calculatePathArea=function(t){for(var e=0,r=t?t.length:0,n=0;n<r-1;++n)e+=(t[n+1][0]-t[n][0])*(t[n+1][1]+t[n][1]);return e/2},t.prototype.getCoord2D=function(t,e,r){return[t[0]+(e[0]-t[0])*r,t[1]+(e[1]-t[1])*r]},t.prototype.getSegCoord2D=function(t,e,r){return this.getCoord2D(t[e],t[e+1],r)},t.prototype.getAngle=function(t,e,r){var n=e[0]-t[0],o=e[1]-t[1];return Math.atan2(o,n)},t.prototype.getSegAngle=function(t,e,r){return this.getAngle(t[e],t[e+1],r)},t.prototype.getAngleCS=function(t,e,r){var n=e[0]-t[0],o=e[1]-t[1],a=Math.sqrt(n*n+o*o);return a>0?[n/a,o/a]:[1,0]},t.prototype.getSegAngleCS=function(t,e,r){return this.getAngleCS(t[e],t[e+1],r)},t.prototype.cut=function(t,e,r,n){return[r<=0?t[e]:this.getSegCoord2D(t,e,r),n>=1?t[e+1]:this.getSegCoord2D(t,e,n)]},t.prototype.addSegment=function(t,e,r){r&&t.push(e[0]),t.push(e[1])},t.prototype.getSubCurve=function(t,e,r){var n=[];return this.appendSubCurve(n,t,e,r)?n:null},t.prototype.appendSubCurve=function(t,e,r,n){for(var o=e?e.length-1:0,a=0,u=!0,i=0;i<o;){var h=this.calculateSegLength(e,i);if(0!==h){if(u){if(a+h>r){var p=(r-a)/h,s=1,l=!1;if(a+h>=n&&(s=(n-a)/h,l=!0),(f=this.cut(e,i,p,s))&&this.addSegment(t,f,u),l)break;u=!1}}else{if(a+h>n){var f;(f=this.cut(e,i,0,(n-a)/h))&&this.addSegment(t,f,u);break}this.addSegment(t,[e[i],e[i+1]],u)}a+=h,++i}else++i}return!0},t.prototype.getCIMPointAlong=function(t,e){for(var r=t?t.length-1:0,n=0,o=-1;o<r;){++o;var a=this.calculateSegLength(t,o);if(0!==a){if(n+a>e){var u=(e-n)/a;return this.getCoord2D(t[o],t[o+1],u)}n+=a}}return null},t.prototype.isEmpty=function(t,e){if(!t||t.length<=1)return!0;for(var r=t?t.length-1:0,n=-1;n<r;){if(t[++n+1][0]!==t[n][0]||t[n+1][1]!==t[n][1])return!1;if(e&&t[n+1][2]!==t[n][2])return!1}return!0},t.prototype.offset=function(t,e,r,n,o){if(!t||t.length<2)return null;var a=t.length,u=t[0][0]===t[a-1][0]&&t[0][1]===t[a-1][1];if(u){if(t.length<3)return null;--a}for(var i=[],h=u?t[a-1]:null,p=t[0],s=0;s<a;s++){var l=s===a-1?u?t[0]:null:t[s+1];if(h)if(l){var f=[l[0]-p[0],l[1]-p[1]];this.normalize(f);var c=[p[0]-h[0],p[1]-h[1]];this.normalize(c);var g=c[0]*f[1]-c[1]*f[0],v=c[0]*f[0]+c[1]*f[1];if(g>=0==e<=0){M=[f[0]-c[0],f[1]-c[1]];this.normalize(M);var y=Math.sqrt((1+v)/2),d=-Math.abs(e)/y;i.push([p[0]-M[0]*d,p[1]-M[1]*d])}else switch(r){case"Mitered":if((y=Math.sqrt((1+v)/2))>0&&1/y<n){M=[f[0]-c[0],f[1]-c[1]];this.normalize(M);d=Math.abs(e)/y;i.push([p[0]-M[0]*d,p[1]-M[1]*d]);break}case"Bevelled":i.push([p[0]+c[1]*e,p[1]-c[0]*e]),i.push([p[0]+f[1]*e,p[1]-f[0]*e]);break;case"Rounded":i.push([p[0]+c[1]*e,p[1]-c[0]*e]);for(var S=.2,m=1;m<5;m++,S+=.2){M=[c[1]*(1-S)+f[1]*S,-c[0]*(1-S)-f[0]*S];this.normalize(M),i.push([p[0]+M[0]*e,p[1]+M[1]*e])}i.push([p[0]+f[1]*e,p[1]-f[0]*e]);break;case"Square":default:if(g<0)i.push([p[0]+(c[1]+c[0])*e,p[1]+(c[1]-c[0])*e]),i.push([p[0]+(f[1]-f[0])*e,p[1]-(f[0]+f[1])*e]);else{var C=Math.sqrt((1+Math.abs(v))/2);M=[f[0]-c[0],f[1]-c[1]];this.normalize(M);d=e/C;i.push([p[0]-M[0]*d,p[1]-M[1]*d])}}}else{var M=[p[0]-h[0],p[1]-h[1]];this.normalize(M),i.push([p[0]+M[1]*e,p[1]-M[0]*e])}else{var M=[l[0]-p[0],l[1]-p[1]];this.normalize(M),i.push([p[0]+M[1]*e,p[1]-M[0]*e])}h=p,p=l}return u&&i.push([i[0][0],i[0][1]]),i},t}();e.CurveHelper=n}));