/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../core/fontUtils","../../core/lang","../../core/Logger","../../core/maybe","../../core/screenUtils","../../core/string","../../support/arcadeOnDemand","./CIMSymbolHelper","./enums","./quantizeTime","./SDFHelper","./utils","./effects/CIMEffectHelper","../../views/2d/arcade/callExpressionWithFeature","../../views/2d/engine/webgl/definitions","../../views/2d/engine/webgl/grouping"],(function(e,t,i,o,r,n,l,a,s,c,f,m,p,u,y,g,h,d,S){"use strict";const v=n.getLogger("esri.symbols.cim.cimAnalyzer");function C(e){switch(e){case"Butt":return m.CapType.BUTT;case"Square":return m.CapType.SQUARE;default:return m.CapType.ROUND}}function N(e){switch(e){case"Bevel":return m.JoinType.BEVEL;case"Miter":return m.JoinType.MITER;default:return m.JoinType.ROUND}}function O(e,t,i,o){let r;e[t]?r=e[t]:(r={},e[t]=r),r[i]=o}function b(e){const t=e.markerPlacement;return t&&t.angleToLine?m.Alignment.MAP:m.Alignment.SCREEN}function k(e,t,i,o,r){return M.apply(this,arguments)}function M(){return(M=t._asyncToGenerator((function*(e,t,i,o,r){const n=o??[];if(!e)return n;let a,s;const m={};if("CIMSymbolReference"!==e.type)return v.error("Expect cim type to be 'CIMSymbolReference'"),n;if(a=e.symbol,s=e.primitiveOverrides,s){const e=[];for(const i of s){const o=i.valueExpressionInfo;if(o&&t){const r=o.expression,n=c.createRendererExpression(r,t.spatialReference,t.fields).then((e=>{l.isNone(e)||O(m,i.primitiveName,i.propertyName,e)}));e.push(n)}else null!=i.value&&O(m,i.primitiveName,i.propertyName,i.value)}e.length>0&&(yield Promise.all(e))}const p=[];switch(f.CIMSymbolHelper.fetchResources(a,i,p),p.length>0&&(yield Promise.all(p)),a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":P(a,s,m,t,n,i,r)}return n}))).apply(this,arguments)}function P(e,t,i,o,r,n,l){if(!e)return;const a=e.symbolLayers;if(!a)return;const s=e.effects;let c;const p=f.CIMSymbolHelper.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(c=m.Alignment.MAP);let u=a.length;for(;u--;){const m=a[u];if(!m||!1===m.enable)continue;let y;s&&s.length&&(y=[...s]);const g=m.effects;g&&g.length&&(s?y.push(...g):y=[...g]);const h=[];let d;f.OverrideHelper.findEffectOverrides(y,t,h),d=h.length>0?G(y,h,i,o):y;const S=[];switch(f.OverrideHelper.findApplicableOverrides(m,t,S),m.type){case"CIMSolidFill":I(m,d,i,S,o,r);break;case"CIMPictureFill":H(m,d,i,S,o,n,r);break;case"CIMHatchFill":L(m,d,i,S,o,r);break;case"CIMGradientFill":A(m,d,i,S,o,r);break;case"CIMSolidStroke":x(m,d,i,S,o,r,"CIMPolygonSymbol"===e.type,p);break;case"CIMPictureStroke":w(m,d,i,S,o,r,"CIMPolygonSymbol"===e.type,p);break;case"CIMGradientStroke":z(m,d,i,S,o,r,"CIMPolygonSymbol"===e.type,p);break;case"CIMCharacterMarker":if(X(m,d,i,S,o,r))break;break;case"CIMPictureMarker":if(X(m,d,i,S,o,r))break;"CIMLineSymbol"===e.type&&(c=b(m)),R(m,d,i,S,o,n,r,c,p);break;case"CIMVectorMarker":if(X(m,d,i,S,o,r))break;"CIMLineSymbol"===e.type&&(c=b(m)),J(m,d,i,S,o,r,n,c,p,l);break;default:v.error("Cannot analyze CIM layer",m.type)}}}function I(e,t,i,o,r,n){const l=e.primitiveName,a=y.fromCIMColor(e.color),[c,f]=K(o,l,t,null,null),m=s.numericHash(JSON.stringify(e)+f).toString();n.push({type:"fill",templateHash:m,materialHash:c?()=>m:m,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:W(l,i,"Color",r,a,D),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t,applyRandomOffset:!1,sampleAlphaOnly:!0})}function H(e,t,i,o,r,n,a){const c=e.primitiveName,f=e.tintColor?y.fromCIMColor(e.tintColor):{r:255,g:255,b:255,a:1},[m,p]=K(o,c,t,null,null),u=s.numericHash(JSON.stringify(e)+p).toString(),g=s.numericHash(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();let h=y.getValue(e.scaleX);if("width"in e){const t=e.width;let i=1;const o=n.getResource(e.url);l.isSome(o)&&(i=o.width/o.height),h/=i*(e.height/t)}a.push({type:"fill",templateHash:u,materialHash:m?()=>g:g,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:W(c,i,"TintColor",r,f,D),height:W(c,i,"Height",r,e.height),scaleX:W(c,i,"ScaleX",r,h),angle:W(c,i,"Rotation",r,y.getValue(e.rotation)),offsetX:W(c,i,"OffsetX",r,y.getValue(e.offsetX)),offsetY:W(c,i,"OffsetY",r,y.getValue(e.offsetY)),url:e.url,applyRandomOffset:!1,sampleAlphaOnly:!1})}function L(e,t,i,o,r,n){const l=["Rotation","OffsetX","OffsetY"],a=o.filter((t=>t.primitiveName!==e.primitiveName||!l.includes(t.propertyName))),c=e.primitiveName,[f,m]=K(o,c,t,null,null),p=s.numericHash(JSON.stringify(e)+m).toString(),u=s.numericHash(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();let g={r:255,g:255,b:255,a:1};if(e.lineSymbol){const t=e.lineSymbol?.symbolLayers.find((e=>"CIMSolidStroke"===e.type));t&&(g=y.fromCIMColor(t.color))}n.push({type:"fill",templateHash:p,materialHash:f?B(u,i,a,r):u,cim:e,materialOverrides:a,colorLocked:e.colorLocked,effects:t,color:g,height:W(c,i,"Separation",r,e.separation),scaleX:1,angle:W(c,i,"Rotation",r,y.getValue(e.rotation)),offsetX:W(c,i,"OffsetX",r,y.getValue(e.offsetX)),offsetY:W(c,i,"OffsetY",r,y.getValue(e.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0})}function A(e,t,i,o,r,n){const l=e.primitiveName,[a,c]=K(o,l,t,null,null),f=s.numericHash(JSON.stringify(e)+c).toString();n.push({type:"fill",templateHash:f,materialHash:a?B(f,i,o,r):f,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1})}function x(e,t,i,o,r,n,l,a){const c=e.primitiveName,f=y.fromCIMColor(e.color),m=void 0!==e.width?e.width:4,p=C(e.capStyle),u=N(e.joinStyle),g=e.miterLimit,[h,d]=K(o,c,t,null,null),S=s.numericHash(JSON.stringify(e)+d).toString();let v,O;if(t&&t instanceof Array&&t.length>0){const e=t[t.length-1];if("CIMGeometricEffectDashes"===e.type&&"NoConstraint"===e.lineDashEnding&&null===e.offsetAlongLine){const e=(t=[...t]).pop();v=e.dashTemplate,O=e.scaleDash}}n.push({type:"line",templateHash:S,materialHash:h?()=>S:S,cim:e,materialOverrides:null,isOutline:l,colorLocked:e.colorLocked,effects:t,color:W(c,i,"Color",r,f,D),width:W(c,i,"Width",r,m),cap:W(c,i,"CapStyle",r,p),join:W(c,i,"JoinStyle",r,u),miterLimit:W(c,i,"MiterLimit",r,g),referenceWidth:a,zOrder:F(e.name),dashTemplate:v,scaleDash:O,sampleAlphaOnly:!0})}function w(e,t,i,o,r,n,l,a){const c=s.numericHash(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),f=e.primitiveName,m=y.fromCIMColor(e.tintColor),p=void 0!==e.width?e.width:4,u=C(e.capStyle),g=N(e.joinStyle),h=e.miterLimit,[d,S]=K(o,f,t,null,null),v=s.numericHash(JSON.stringify(e)+S).toString();n.push({type:"line",templateHash:v,materialHash:d?()=>c:c,cim:e,materialOverrides:null,isOutline:l,colorLocked:e.colorLocked,effects:t,color:W(f,i,"TintColor",r,m,D),width:W(f,i,"Width",r,p),cap:W(f,i,"CapStyle",r,u),join:W(f,i,"JoinStyle",r,g),miterLimit:W(f,i,"MiterLimit",r,h),referenceWidth:a,zOrder:F(e.name),dashTemplate:null,scaleDash:!1,url:e.url,sampleAlphaOnly:!1})}function z(e,t,i,o,r,n,l,a){const c=e.primitiveName,f=void 0!==e.width?e.width:4,m=C(e.capStyle),p=N(e.joinStyle),u=e.miterLimit,[y,g]=K(o,c,t,null,null),h=s.numericHash(JSON.stringify(e)+g).toString();n.push({type:"line",templateHash:h,materialHash:y?B(h,i,o,r):h,cim:e,materialOverrides:null,isOutline:l,colorLocked:e.colorLocked,effects:t,color:{r:128,g:128,b:128,a:1},width:W(c,i,"Width",r,f),cap:W(c,i,"CapStyle",r,m),join:W(c,i,"JoinStyle",r,p),miterLimit:W(c,i,"MiterLimit",r,u),referenceWidth:a,zOrder:F(e.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}function X(e,t,i,o,r,n){const l=e.markerPlacement;if(!l||"CIMMarkerPlacementInsidePolygon"!==l.type)return!1;const c=l,f=Math.abs(c.stepX),m=Math.abs(c.stepY);if(0===f||0===m)return!0;const p=["Rotation","OffsetX","OffsetY"],u=o.filter((t=>t.primitiveName!==e.primitiveName||!p.includes(t.propertyName))),g="url"in e?e.url:null,[h,S]=K(o,c.primitiveName,t,null,null),v=s.numericHash(JSON.stringify(e)+S).toString();let C,N,O=null;if("Random"===l.gridType){const e=a.px2pt(d.RANDOM_INSIDE_POLYGON_TEXTURE_SIZE),t=Math.max(Math.floor(e/f),1),i=Math.max(Math.floor(e/m),1);C=m*i,O=e=>e?e*i:0;N=t*f/C}else l.shiftOddRows?(C=2*m,O=e=>e?2*e:0,N=f/m*.5):(C=m,O=null,N=f/m);let b={r:255,g:255,b:255,a:1};return"tintColor"in e&&(b=y.fromCIMColor(e.tintColor)),n.push({type:"fill",templateHash:v,materialHash:h?B(v,i,u,r):v,cim:e,materialOverrides:u,colorLocked:e.colorLocked,effects:t,color:W(c.primitiveName,i,"TintColor",r,b,D),height:W(c.primitiveName,i,"StepY",r,C,O),scaleX:N,angle:W(c.primitiveName,i,"GridAngle",r,c.gridAngle),offsetX:W(c.primitiveName,i,"OffsetX",r,y.getValue(c.offsetX)),offsetY:W(c.primitiveName,i,"OffsetY",r,y.getValue(c.offsetY)),url:g,applyRandomOffset:"Random"===l.gridType,sampleAlphaOnly:!g}),!0}function R(e,t,i,o,r,n,a,c,f){const m=e.primitiveName,p=y.getValue(e.size);let u=y.getValue(e.scaleX,1);const g=y.getValue(e.rotation),h=y.getValue(e.offsetX),d=y.getValue(e.offsetY),v=e.tintColor?y.fromCIMColor(e.tintColor):{r:255,g:255,b:255,a:1},C=s.numericHash(`${e.url}${JSON.stringify(e.colorSubstitutions)}${JSON.stringify(e.animatedSymbolProperties)}`).toString(),N=_(e.markerPlacement,o,i,r),O=j(e.animatedSymbolProperties,o,i,r),[b,k]=K(o,m,t,N,O),M=s.numericHash(JSON.stringify(e)+k).toString(),P=e.anchorPoint??{x:0,y:0};if("width"in e){const t=e.width;let i=1;const o=n.getResource(e.url);l.isSome(o)&&(i=o.width/o.height),u/=i*(p/t)}function I(e,t){return y.evaluateValueOrFunction(O,e,t)}const H=e.animatedSymbolProperties&&!0===e.animatedSymbolProperties.randomizeStartTime?(e,t,i,o)=>{const r=S.getMaterialGroup(o),n=I(e,t);return C+`-MATERIALGROUP(${r})`+`-ASP(${JSON.stringify(n)})`}:b?(e,t)=>{const i=I(e,t);return C+`-ASP(${JSON.stringify(i)})`}:C;a.push({type:"marker",templateHash:M,materialHash:H,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:!1,alignment:c,size:W(m,i,"Size",r,p),scaleX:W(m,i,"ScaleX",r,u),rotation:W(m,i,"Rotation",r,g),offsetX:W(m,i,"OffsetX",r,h),offsetY:W(m,i,"OffsetY",r,d),color:W(m,i,"TintColor",r,v,D),anchorPoint:{x:P.x,y:-P.y},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:f,sizeRatio:1,markerPlacement:N,url:e.url,animatedSymbolProperties:O})}function J(e,t,i,o,r,n,l,a,s,c){const f=e.markerGraphics;if(!f)return;let m=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(m=t.ymax-t.ymin)}const p=_(e.markerPlacement,o,i,r);for(const u of f)if(u){const f=u.symbol;if(!f)continue;switch(f.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":T(e,t,p,null,u,o,i,r,n,l,a,s,m,c);break;case"CIMTextSymbol":E(e,t,p,u,i,o,r,n,a,s,m)}}}function E(e,t,i,r,n,l,a,c,m,p,u){const g=[];f.OverrideHelper.findApplicableOverrides(r,l,g);const h=r.geometry;if(!("x"in h)||!("y"in h))return;const d=r.symbol,S=y.fromCIMFontDecoration(d),v=y.fromCIMFontStyle(d.fontStyleName),C=o.getFontFamily(d.fontFamilyName);d.font={family:C,decoration:S,...v};const N=e.frame,O=h.x-.5*(N.xmin+N.xmax),b=h.y-.5*(N.ymin+N.ymax),k=e.size/u,M=e.primitiveName,P=y.getValue(d.height)*k,I=y.getValue(d.angle),H=y.getValue(e.offsetX)+(y.getValue(d.offsetX)+O)*k,L=y.getValue(e.offsetY)+(y.getValue(d.offsetY)+b)*k,A=y.fromCIMColor(y.getFillColor(d));let x=y.fromCIMColor(y.getStrokeColor(d)),w=y.getStrokeWidth(d);w||(x=y.fromCIMColor(y.getFillColor(d.haloSymbol)),w=d.haloSize*k);const[z,X]=K(l,M,t,i,null),R=JSON.stringify(e.effects)+Number(e.colorLocked).toString()+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement)+e.size.toString(),J=s.numericHash(JSON.stringify(r)+R+X).toString();let E=W(r.primitiveName,n,"TextString",a,r.textString,y.adjustTextCase,d.textCase);if(null==E)return;const{fontStyleName:T}=d,V=C+(T?"-"+T.toLowerCase():"-regular"),Y=V;"string"==typeof E&&E.includes("[")&&d.fieldMap&&(E=y.createLabelOverrideFunction(d.fieldMap,E,d.textCase)),c.push({type:"text",templateHash:J,materialHash:z||"function"==typeof E||E.match(/\[(.*?)\]/)?(e,t,i)=>Y+"-"+y.evaluateValueOrFunction(E,e,t,i):Y+"-"+s.numericHash(E),cim:d,materialOverrides:null,colorLocked:e.colorLocked,effects:t,alignment:m,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:V,decoration:S,weight:W(M,n,"Weight",a,v.weight),style:W(M,n,"Size",a,v.style),size:W(M,n,"Size",a,P),angle:W(M,n,"Rotation",a,I),offsetX:W(M,n,"OffsetX",a,H),offsetY:W(M,n,"OffsetY",a,L),horizontalAlignment:y.fromCIMHorizontalAlignment(d.horizontalAlignment),verticalAlignment:y.fromCIMVerticalAlignment(d.verticalAlignment),text:E,color:A,outlineColor:x,outlineSize:w,referenceSize:p,sizeRatio:1,markerPlacement:i})}function T(e,t,i,o,r,n,a,c,f,m,p,h,d,S){const v=r.symbol,C=v.symbolLayers;if(!C)return;if(S)return void Y(e,t,i,o,r,a,n,c,f,m,p,h,d);let N=C.length;if(Q(C))return void V(e,t,i,o,r,C,n,a,c,f,p,h,d);const O=g.CIMEffectHelper.applyEffects(v.effects,r.geometry,m.geometryEngine);if(O)for(;N--;){const S=C[N];if(S&&!1!==S.enable)switch(S.type){case"CIMSolidFill":case"CIMSolidStroke":{const v=g.CIMEffectHelper.applyEffects(S.effects,O,m.geometryEngine),C=u.getExtent(v);if(!C)continue;const N="Relative"!==e.anchorPointUnits,[b,k,M]=u.getSDFMetrics(C,e.frame,e.size,e.anchorPoint,N),P="CIMSolidFill"===S.type,I={type:"sdf",geom:v,asFill:P},H=e.primitiveName,L=y.getValue(e.size)??10,A=y.getValue(e.rotation),x=y.getValue(e.offsetX),w=y.getValue(e.offsetY),z=S.path,X=S.primitiveName,R=P?y.fromCIMColor(y.getFillColor(S)):y.fromCIMColor(y.getStrokeColor(S)),J=P?{r:0,g:0,b:0,a:0}:y.fromCIMColor(y.getStrokeColor(S)),E=y.getStrokeWidth(S);if(!P&&!E)break;let T=!1,V="";for(const e of n)e.primitiveName!==X&&e.primitiveName!==H||(void 0!==e.value?V+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(T=!0));l.isSome(t)&&"function"==typeof t&&(T=!0);const Y=JSON.stringify({...e,markerGraphics:null}),$=s.numericHash(JSON.stringify(I)+z).toString(),F={type:"marker",templateHash:s.numericHash(JSON.stringify(r)+JSON.stringify(S)+Y+V).toString(),materialHash:T?()=>$:$,cim:I,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:p,anchorPoint:{x:k,y:M},isAbsoluteAnchorPoint:N,size:W(e.primitiveName,a,"Size",c,L),rotation:W(e.primitiveName,a,"Rotation",c,A),offsetX:W(e.primitiveName,a,"OffsetX",c,x),offsetY:W(e.primitiveName,a,"OffsetY",c,w),scaleX:1,frameHeight:d,rotateClockwise:e.rotateClockwise,referenceSize:h,sizeRatio:b,color:W(X,a,"Color",c,R,D),outlineColor:W(X,a,"Color",c,J,D),outlineWidth:W(X,a,"Width",c,E),markerPlacement:i,animatedSymbolProperties:o,path:z};f.push(F);break}default:Y(e,t,i,o,r,a,n,c,f,m,p,h,d)}}}function V(e,t,i,o,r,n,l,a,c,f,m,p,g){const h=r.geometry,d=n[0],S=n[1],v=u.getExtent(h);if(!v)return;const C="Relative"!==e.anchorPointUnits,[N,O,b]=u.getSDFMetrics(v,e.frame,e.size,e.anchorPoint,C),k={type:"sdf",geom:h,asFill:!0},M=e.primitiveName,P=y.getValue(e.size),I=y.getValue(e.rotation),H=y.getValue(e.offsetX),L=y.getValue(e.offsetY),A=S.path,x=S.primitiveName,w=d.primitiveName,z=y.fromCIMColor(y.getFillColor(S)),X=y.fromCIMColor(y.getStrokeColor(d)),R=y.getStrokeWidth(d);let J=!1,E="";for(const s of l)s.primitiveName!==x&&s.primitiveName!==w&&s.primitiveName!==M||(void 0!==s.value?E+=`-${s.primitiveName}-${s.propertyName}-${JSON.stringify(s.value)}`:s.valueExpressionInfo&&(J=!0));const T=JSON.stringify({...e,markerGraphics:null}),V=s.numericHash(JSON.stringify(k)+A).toString(),Y={type:"marker",templateHash:s.numericHash(JSON.stringify(r)+JSON.stringify(S)+JSON.stringify(d)+T+E).toString(),materialHash:J?()=>V:V,cim:k,materialOverrides:null,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:m,anchorPoint:{x:O,y:b},isAbsoluteAnchorPoint:C,size:W(e.primitiveName,a,"Size",c,P),rotation:W(e.primitiveName,a,"Rotation",c,I),offsetX:W(e.primitiveName,a,"OffsetX",c,H),offsetY:W(e.primitiveName,a,"OffsetY",c,L),scaleX:1,frameHeight:g,rotateClockwise:e.rotateClockwise,referenceSize:p,sizeRatio:N,color:W(x,a,"Color",c,z,D),outlineColor:W(w,a,"Color",c,X,D),outlineWidth:W(w,a,"Width",c,R),markerPlacement:i,path:A,animatedSymbolProperties:o};f.push(Y)}function Y(e,t,i,o,r,n,c,m,p,u,g,h,d){const S=$(e,r),v=["Rotation","OffsetX","OffsetY"],C=c.filter((t=>t.primitiveName!==e.primitiveName||!v.includes(t.propertyName)));let N="";for(const l of c)void 0!==l.value&&(N+=`-${l.primitiveName}-${l.propertyName}-${JSON.stringify(l.value)}`);const[O,b,k]=f.CIMSymbolHelper.getTextureAnchor(S,u),M=e.primitiveName,P=y.getValue(e.rotation),I=y.getValue(e.offsetX),H=y.getValue(e.offsetY),L=s.numericHash(JSON.stringify(S)+N).toString(),A={type:"marker",templateHash:L,materialHash:C.length>0||l.isSome(t)&&"function"==typeof t?B(L,n,C,m):L,cim:S,materialOverrides:C,colorLocked:e.colorLocked,effects:t,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:g,anchorPoint:{x:O,y:b},isAbsoluteAnchorPoint:!1,size:e.size,rotation:W(M,n,"Rotation",m,P),offsetX:W(M,n,"OffsetX",m,I),offsetY:W(M,n,"OffsetY",m,H),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:d,rotateClockwise:e.rotateClockwise,referenceSize:h,sizeRatio:k/a.pt2px(e.size),markerPlacement:i,animatedSymbolProperties:o};p.push(A)}function $(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath}}function F(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(!isNaN(t))return t}return 0}function D(e){if(!e||0===e.length)return null;const t=new i(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function W(e,t,i,o,r,n,l){const a=t[e];if(a){const e=a[i];if("string"==typeof e||"number"==typeof e||e instanceof Array)return n?n.call(null,e,l):e;if(null!=e&&e instanceof c.ArcadeExpression)return(t,i,a)=>{let s=h(e,t,{$view:a},o.geometryType,i);return null!==s&&n&&(s=n.call(null,s,l)),null!==s?s:r}}return r}function U(e){return e?e.charAt(0).toLowerCase()+e.substr(1):e}function G(e,t,i,o){for(const r of t){if(r.valueExpressionInfo){const e=i[r.primitiveName]&&i[r.primitiveName][r.propertyName];e instanceof c.ArcadeExpression&&(r.fn=(t,i,r)=>h(e,t,{$view:r},o.geometryType,i))}}return(i,o,n)=>{for(const e of t)e.fn&&(e.value=e.fn(i,o,n));const l=[];for(let a of e){const e=a?.primitiveName;if(e){let i=!1;for(const o of t)if(o.primitiveName===e){const e=U(o.propertyName);null!=o.value&&o.value!==a[e]&&(i||(a=r.clone(a),i=!0),a[e]=o.value)}}l.push(a)}return l}}function _(e,t,i,o){const n=[];if(f.OverrideHelper.findApplicableOverrides(e,t,n),0===n.length)return e;for(const r of n){if(r.valueExpressionInfo){const e=i[r.primitiveName]&&i[r.primitiveName][r.propertyName];e instanceof c.ArcadeExpression&&(r.fn=(t,i,r)=>h(e,t,{$view:r},o.geometryType,i))}}return(t,i,o)=>{for(const e of n)e.fn&&(e.value=e.fn(t,i,o));const l=r.clone(e),a=e.primitiveName;for(const e of n)if(e.primitiveName===a){const t=U(e.propertyName);null!=e.value&&e.value!==l[t]&&(l[t]=e.value)}return l}}function j(e,t,i,o){const n=[];if(f.OverrideHelper.findApplicableOverrides(e,t,n),0===n.length)return e;for(const r of n){if(r.valueExpressionInfo){const e=i[r.primitiveName]&&i[r.primitiveName][r.propertyName];e instanceof c.ArcadeExpression&&(r.fn=(t,i,r)=>h(e,t,{$view:r},o.geometryType,i))}}return(t,i,o)=>{for(const e of n)e.fn&&(e.value=e.fn(t,i,o));const l=r.clone(e),a=e.primitiveName;for(const e of n)if(e.primitiveName===a){const t=U(e.propertyName);if(null!=e.value){const i=p.quantizeIfNeeded(e.value,e.propertyName);i!==l[t]&&(l[t]=i)}}return l}}function B(e,t,i,o){for(const r of i){if(r.valueExpressionInfo){const e=t[r.primitiveName]&&t[r.primitiveName][r.propertyName];e instanceof c.ArcadeExpression&&(r.fn=(t,i,r)=>h(e,t,{$view:r},o.geometryType,i))}}return(t,o,r)=>{for(const e of i)e.fn&&(e.value=e.fn(t,o,r));return s.numericHash(e+f.OverrideHelper.buildOverrideKey(i)).toString()}}function q(e,t){if(!t||0===t.length)return e;const i=r.clone(e);return f.OverrideHelper.applyOverrides(i,t),i}function K(e,t,i,o,r){let n=!1,a="";for(const l of e)l.primitiveName===t&&(void 0!==l.value?a+=`-${l.primitiveName}-${l.propertyName}-${JSON.stringify(l.value)}`:l.valueExpressionInfo&&(n=!0));return l.isSome(i)&&"function"==typeof i&&(n=!0),l.isSome(o)&&"function"==typeof o&&(n=!0),l.isSome(r)&&"function"==typeof r&&(n=!0),[n,a]}const Q=e=>e&&2===e.length&&e[0].enable&&e[1].enable&&"CIMSolidStroke"===e[0].type&&"CIMSolidFill"===e[1].type&&!e[0].effects&&!e[1].effects;e.analyzeCIMResource=q,e.analyzeCIMSymbol=k,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
