/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../core/Error","../../core/fontUtils","../../core/screenUtils","./gfxUtils","./previewUtils","./renderUtils","../../views/support/colorUtils"],(function(e,t,n,a,l,o,i,s,r,c){"use strict";const u="picture-fill",p="picture-marker",h="simple-fill",m="simple-line",d="simple-marker",f="text",y="Aa",g=s.SymbolSizeDefaults.size,v=s.SymbolSizeDefaults.maxSize,w=s.SymbolSizeDefaults.maxOutlineSize,b=s.SymbolSizeDefaults.lineWidth,x=225,k=document.createElement("canvas");function z(e,t){const n=k.getContext("2d"),a=[];return t&&(t.weight&&a.push(t.weight),t.size&&a.push(t.size+"px"),t.family&&a.push(t.family)),n.font=a.join(" "),n.measureText(e).width}const M=7.2/2.54,S=72/2.54;function L(e){if(0===e.length)return 0;if(e.length>2){const t=o.px2pt(1),n=parseFloat(e);switch(e.slice(-2)){case"px":return n;case"pt":return n*t;case"in":return 72*n*t;case"pc":return 12*n*t;case"mm":return n*M*t;case"cm":return n*S*t}}return parseFloat(e)}function C(e){const t=e?.size;return{width:null!=t&&"object"==typeof t&&"width"in t?o.pt2px(t.width):null,height:null!=t&&"object"==typeof t&&"height"in t?o.pt2px(t.height):null}}function F(e,t){return j.apply(this,arguments)}function j(){return(j=t._asyncToGenerator((function*(e,t){const n=t.fill,a=e.color;if("pattern"===n?.type&&a&&e.type!==u){const e=yield i.getPatternUrlWithColor(n.src,a.toCss(!0));n.src=e,t.fill=n}}))).apply(this,arguments)}function D(e,t,n,a){return T.apply(this,arguments)}function T(){return(T=t._asyncToGenerator((function*(e,t,n,a){if(!("font"in e)||!e.font||"text"!==t.shape.type)return;try{yield l.loadFont(e.font)}catch{}const{width:o}=C(a),i=/[\uE600-\uE6FF]/.test(t.shape.text);null!=o||i||(n[0]=z(t.shape.text,{weight:t.font.weight,size:t.font.size,family:t.font.family}))}))).apply(this,arguments)}function U(e,t){return e>t?"dark":"light"}function E(e,t){const n="number"==typeof t?.size?t?.size:null,a=null!=n?o.pt2px(n):null,l=null!=t?.maxSize?o.pt2px(t.maxSize):null,r=null!=t?.rotation?t.rotation:"angle"in e?e.angle:null,c=i.getFill(e);let x=i.getStroke(e);"dark"!==B(e,245)||t?.ignoreWhiteSymbols||(x={width:.75,...x,color:"#bdc3c7"});const k={shape:null,fill:c,stroke:x,offset:[0,0]};x?.width&&(x.width=Math.min(x.width,w));const M=x?.width||0;let S=null!=t?.size&&(null==t?.scale||t?.scale),F=0,j=0,D=!1;switch(e.type){case d:{const n=e.style,{width:i,height:s}=C(t),c=i===s&&null!=i?i:null!=a?a:Math.min(o.pt2px(e.size),l||v);switch(F=c,j=c,n){case"circle":k.shape={type:"circle",cx:0,cy:0,r:.5*c},S||(F+=M,j+=M);break;case"cross":k.shape={type:"path",path:[{command:"M",values:[0,.5*j]},{command:"L",values:[F,.5*j]},{command:"M",values:[.5*F,0]},{command:"L",values:[.5*F,j]}]};break;case"diamond":k.shape={type:"path",path:[{command:"M",values:[0,.5*j]},{command:"L",values:[.5*F,0]},{command:"L",values:[F,.5*j]},{command:"L",values:[.5*F,j]},{command:"Z",values:[]}]},S||(F+=M,j+=M);break;case"square":k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[F,0]},{command:"L",values:[F,j]},{command:"L",values:[0,j]},{command:"Z",values:[]}]},S||(F+=M,j+=M),r&&(D=!0);break;case"triangle":k.shape={type:"path",path:[{command:"M",values:[.5*F,0]},{command:"L",values:[F,j]},{command:"L",values:[0,j]},{command:"Z",values:[]}]},S||(F+=M,j+=M),r&&(D=!0);break;case"x":k.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[F,j]},{command:"M",values:[F,0]},{command:"L",values:[0,j]}]},r&&(D=!0);break;case"path":k.shape={type:"path",path:e.path||""},S||(F+=M,j+=M),r&&(D=!0),S=!0}break}case m:{const{width:e,height:n}=C(t),l=null!=n?n:null!=a?a:M,o=null!=e?e:b;x&&(x.width=l),F=o,j=l;const i=k?.stroke?.cap||"butt",s="round"===i;S=!0,k.stroke&&(k.stroke.cap="butt"===i?"square":i),k.shape={type:"path",path:[{command:"M",values:[s?l/2:0,j/2]},{command:"L",values:[s?F-l/2:F,j/2]}]};break}case u:case h:{const e="object"==typeof t?.symbolConfig&&t?.symbolConfig.isSquareFill,{width:n,height:l}=C(t);F=!e&&n!==l||null==n?null!=a?a:g:n,j=!e&&n!==l||null==l?F:l,S||(F+=M,j+=M),S=!0,k.shape=e?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[F,0]},{command:"L",values:[F,j]},{command:"L",values:[0,j]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:s.shapes.fill[0];break}case p:{const n=Math.min(o.pt2px(e.width),l||v),i=Math.min(o.pt2px(e.height),l||v),{width:s,height:c}=C(t),u=s===c&&null!=s?s:null!=a?a:Math.max(n,i),p=n/i;F=p<=1?Math.ceil(u*p):u,j=p<=1?u:Math.ceil(u/p),k.shape={type:"image",x:-Math.round(F/2),y:-Math.round(j/2),width:F,height:j,src:e.url||""},r&&(D=!0);break}case f:{const n=e,i=t?.overrideText||n.text||y,s=n.font,{width:r,height:c}=C(t),u=null!=c?c:null!=a?a:Math.min(o.pt2px(s.size),l||v),p=z(i,{weight:s.weight,size:u,family:s.family}),h=/[\uE600-\uE6FF]/.test(i);F=r??(h?u:p),j=u;let m=.25*L((s?u:0).toString());h&&(m+=5),k.shape={type:"text",text:i,x:n.xoffset||0,y:n.yoffset||m,align:"middle",alignBaseline:n.verticalAlignment,decoration:s&&s.decoration,rotated:n.rotated,kerning:n.kerning},k.font=s&&{size:u,style:s.style,decoration:s.decoration,weight:s.weight,family:s.family};break}}return{shapeDescriptor:k,size:[F,j],renderOptions:{node:t?.node,scale:S,opacity:t?.opacity,rotation:r,useRotationSize:D,effectView:t?.effectView}}}function P(e,t){return _.apply(this,arguments)}function _(){return(_=t._asyncToGenerator((function*(e,t){const{shapeDescriptor:n,size:l,renderOptions:o}=E(e,t);if(!n.shape)throw new a("symbolPreview: renderPreviewHTML2D","symbol not supported.");yield F(e,n),yield D(e,n,l,t);const i=[[n]];if("object"==typeof t?.symbolConfig&&t?.symbolConfig.applyColorModulation){const e=.6*l[0];i.unshift([{...n,offset:[-e,0],fill:s.adjustColorBrightness(n.fill,-.3)}]),i.push([{...n,offset:[e,0],fill:s.adjustColorBrightness(n.fill,.3)}]),l[0]+=2*e,o.scale=!1}return r.renderSymbol(i,l,o)}))).apply(this,arguments)}function B(e,t=x){const a=i.getFill(e),l=i.getStroke(e),o=!a||"type"in a?null:new n(a),s=l?.color?new n(l?.color):null,r=o?U(c.getColorLuminance(o),t):null,u=s?U(c.getColorLuminance(s),t):null;return u?r?r===u?r:t>=x?"light":"dark":u:r}e.getContrastingBackgroundTheme=B,e.getRenderSymbolParameters=E,e.previewSymbol2D=P,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
