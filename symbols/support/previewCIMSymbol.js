/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/screenUtils","./cimSymbolUtils","../cim/CIMSymbolRasterizer"],(function(e,t,l,a){"use strict";const i=new a.CIMSymbolRasterizer(null,!0),n=120;async function o(e,a={}){const{size:o,maxSize:s,node:c,opacity:m}=a,r=a.cimOptions||a,{feature:y,fieldMap:d,geometryType:u,style:p}=r,h=l.getCIMSymbolSize(e),M=Math.min(null!=o?o:h,null!=s?s:t.px2pt(n));M!==h&&(e=e.clone(),l.scaleCIMSymbolTo(e,M,{preserveOutlineWidth:!0}));let b=3;e&&e.data&&e.data.symbol&&"CIMPointSymbol"!==e.data.symbol.type&&(b=1);const g=await i.rasterizeCIMSymbolAsync(e,y,d,u,{scaleFactor:b,style:p}),S=document.createElement("canvas");S.width=g.imageData.width,S.height=g.imageData.height;S.getContext("2d").putImageData(g.imageData,0,0);let C=S.width/b,I=S.height/b;if(null!=o&&(null==(null==a?void 0:a.scale)||(null==a?void 0:a.scale))){const e=C/I;C=e<=1?Math.ceil(M*e):M,I=e<=1?M:Math.ceil(M/e)}const f=new Image(C,I);return f.src=S.toDataURL(),null!=m&&(f.style.opacity=`${m}`),c&&c.appendChild(f),f}e.previewCIMSymbol=o,Object.defineProperty(e,"__esModule",{value:!0})}));
