/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/screenUtils","../cim/CIMSymbolRasterizer","./cimSymbolUtils","./renderUtils"],(function(e,t,l,i,n,a){"use strict";const o=new i.CIMSymbolRasterizer(null,!0),s=120;function c(e){return r.apply(this,arguments)}function r(){return(r=t._asyncToGenerator((function*(e,t={}){const{size:i,maxSize:c,node:r,opacity:u}=t,y=t.cimOptions||t,{feature:m,fieldMap:p,geometryType:d,style:h}=y,f=n.getCIMSymbolSize(e),g=Math.min(null!=i?i:f,null!=c?c:l.px2pt(s));g!==f&&(e=e.clone(),n.scaleCIMSymbolTo(e,g,{preserveOutlineWidth:!0}));let b=3;e&&e.data&&e.data.symbol&&"CIMPointSymbol"!==e.data.symbol.type&&(b=1);const M=yield o.rasterizeCIMSymbolAsync(e,m,p,d,{scaleFactor:b,style:h}),S=document.createElement("canvas");S.width=M.imageData.width,S.height=M.imageData.height;S.getContext("2d").putImageData(M.imageData,0,0);let w=S.width/b,C=S.height/b;if(null!=i&&(null==(null==t?void 0:t.scale)||(null==t?void 0:t.scale))){const e=w/C;w=e<=1?Math.ceil(g*e):g,C=e<=1?g:Math.ceil(g/e)}const I=new Image(w,C);I.src=S.toDataURL(),null!=u&&(I.style.opacity=`${u}`);let v=I;if(null!=t.effectView){const e={shape:{type:"image",x:0,y:0,width:w,height:C,src:I.src},fill:null,stroke:null,offset:[0,0]};v=a.renderSymbol([[e]],[w,C],{effectView:t.effectView})}return r&&r.appendChild(v),v}))).apply(this,arguments)}e.previewCIMSymbol=c,Object.defineProperty(e,"__esModule",{value:!0})}));
