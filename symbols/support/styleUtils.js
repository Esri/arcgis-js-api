/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../core/Error","../../core/maybe","../../core/promiseUtils","../../core/urlUtils","../../portal/Portal","../../portal/PortalQueryParams","../../support/featureFlags"],(function(e,t,r,o,s,l,n,a,c,y){"use strict";function u(e,t){return i.apply(this,arguments)}function i(){return(i=t._asyncToGenerator((function*(e,t){try{return{data:(yield b(e,t)).data,baseUrl:n.removeFile(e),styleUrl:e}}catch(r){return l.throwIfAbortError(r),null}}))).apply(this,arguments)}function f(t,r,o){const l=s.isSome(r.portal)?r.portal:a.getDefault();let n;const c=`${l.url} - ${l.user&&l.user.username} - ${t}`;return e.cachedStyles[c]||(e.cachedStyles[c]=d(t,l,o).then((e=>(n=e,e.fetchData()))).then((e=>({data:e,baseUrl:n.itemUrl??"",styleName:t})))),e.cachedStyles[c]}function m(){e.cachedStyles&&(e.cachedStyles={})}function d(e,t,r){return t.load(r).then((()=>{const o=new c({disableExtraQuery:!0,query:`owner:${w} AND type:${U} AND typekeywords:"${e}"`});return t.queryItems(o,r)})).then((({results:t})=>{let s=null;const l=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const t=e.typeKeywords?.some((e=>e.toLowerCase()===l));if(t&&e.type===U&&e.owner===w){s=e;break}}if(!s)throw new o("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(r)}))}function p(e,t,r){return e&&s.isSome(e.styleUrl)?u(e.styleUrl,r):e&&s.isSome(e.styleName)?f(e.styleName,t,r):Promise.reject(new o("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function h(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function S(e,t){if("cimRef"===t)return e.cimRef;if(e.formatInfos&&!y.enableWebStyleForceWOSR())for(const r of e.formatInfos)if("gltf"===r.type)return r.href;return e.webRef}function b(e,t){const o={responseType:"json",query:{f:"json"},...t};return r(n.normalize(e),o)}e.cachedStyles={};const w="esri_en",U="Style",g="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";e.Style2DUrlTemplate=g,e.cleanupStyleUtilsCache=m,e.fetchStyle=p,e.makeCIMSymbolRef=h,e.requestJSON=b,e.symbolUrlFromStyleItem=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
