/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../Color","../../core/has","../../chunks/mat2df32","../../chunks/mat2d","../../widgets/support/widgetUtils","../../core/Logger","../../widgets/support/jsxFactory"],(function(t,e,i,n,r,o,s,l){"use strict";const a="http://www.w3.org/2000/svg";let h=0,c=0;const f=i("android"),d=i("chrome")||f&&f>=4?"auto":"optimizeLegibility",u={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},y=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let x={},p={};const g={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},m=Math.PI;let w=1;function k(t,e){const i=t*(m/180);return Math.abs(e*Math.sin(i))+Math.abs(e*Math.cos(i))}function b(t){return t.map((t=>`${t.command} ${t.values.join(" ")}`)).join(" ").trim()}function v(t,e,i,n){if(t){if("circle"===t.type)return l.tsx("circle",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,r:t.r});if("ellipse"===t.type)return l.tsx("ellipse",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,rx:t.rx,ry:t.ry});if("rect"===t.type)return l.tsx("rect",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:t.x,y:t.y,width:t.width,height:t.height});if("image"===t.type)return l.tsx("image",{href:t.src,x:t.x,y:t.y,width:t.width,height:t.height,preserveAspectRatio:"none"});if("path"===t.type){const n="string"!=typeof t.path?b(t.path):t.path;return l.tsx("path",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:n})}if("text"===t.type)return l.tsx("text",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":n.align,"text-decoration":n.decoration,kerning:n.kerning,rotate:n.rotate,"text-rendering":d,"font-style":n.font.style,"font-variant":n.font.variant,"font-weight":n.font.weight,"font-size":n.font.size,"font-family":n.font.family,x:t.x,y:t.y},t.text)}return null}function M(t){const i={fill:"none",pattern:null,linearGradient:null};if(t)if("type"in t&&"pattern"===t.type){const e="patternId-"+ ++h;i.fill=`url(#${e})`,i.pattern={id:e,x:t.x,y:t.y,width:t.width,height:t.height,image:{x:0,y:0,width:t.width,height:t.height,href:t.src}}}else if("type"in t&&"linear"===t.type){const n="linearGradientId-"+ ++c;i.fill=`url(#${n})`,i.linearGradient={id:n,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stops:t.colors.map((t=>({offset:t.offset,color:t.color&&new e(t.color).toString()})))}}else if(t){const n=new e(t);i.fill=n.toString()}return i}function j(t){const i={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(t&&(null!=t.width&&(i.width=t.width),t.cap&&(i.cap=t.cap),t.join&&(i.join=t.join.toString()),t.color&&(i.color=new e(t.color).toString()),t.style)){let e=null;if(t.style in g&&(e=g[t.style]),Array.isArray(e)){e=e.slice(0);for(let i=0;i<e.length;++i)e[i]*=t.width;if("butt"!==t.cap){for(let i=0;i<e.length;i+=2)e[i]-=t.width,e[i]<1&&(e[i]=1);for(let i=1;i<e.length;i+=2)e[i]+=t.width}e=e.join(",")}i.dashArray=e}return i}function S(t,e){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return t&&(i.align=t.align,i.decoration=t.decoration,i.kerning=t.kerning?"auto":"0",i.rotate=t.rotated?"90":"0",i.font.style=e.style||"normal",i.font.variant=e.variant||"normal",i.font.weight=e.weight||"normal",i.font.size=e.size&&e.size.toString()||"10pt",i.font.family=e.family||"serif"),i}function A(t){const{pattern:e,linearGradient:i}=t;if(e)return l.tsx("pattern",{id:e.id,patternUnits:"userSpaceOnUse",x:e.x,y:e.y,width:e.width,height:e.height},l.tsx("image",{x:e.image.x,y:e.image.y,width:e.image.width,height:e.image.height,href:e.image.href}));if(i){const t=i.stops.map(((t,e)=>l.tsx("stop",{key:`${e}-stop`,offset:t.offset,"stop-color":t.color})));return l.tsx("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},t)}return null}function G(t,e,i){return r.translate(t,r.identity(t),[e,i])}function N(t,e,i,n,o){return r.scale(t,r.identity(t),[e,i]),t[4]=t[4]*e-n*e+n,t[5]=t[5]*i-o*i+o,t}function $(t,e,i,n){const o=e%360*Math.PI/180;r.rotate(t,r.identity(t),o);const s=Math.cos(o),l=Math.sin(o),a=t[4],h=t[5];return t[4]=a*s-h*l+n*l-i*s+i,t[5]=h*s+a*l-i*l-n*s+n,t}function B(t,e){x&&"left"in x?(x.left>t&&(x.left=t),x.right<t&&(x.right=t),x.top>e&&(x.top=e),x.bottom<e&&(x.bottom=e)):x={left:t,bottom:e,right:t,top:e}}function I(t){const e=t.args,i=e.length;let n;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(n=0;n<i;n+=2)B(e[n],e[n+1]);p.x=e[i-2],p.y=e[i-1];break;case"H":for(n=0;n<i;++n)B(e[n],p.y);p.x=e[i-1];break;case"V":for(n=0;n<i;++n)B(p.x,e[n]);p.y=e[i-1];break;case"m":{let t=0;"x"in p||(B(p.x=e[0],p.y=e[1]),t=2);for(n=t;n<i;n+=2)B(p.x+=e[n],p.y+=e[n+1]);break}case"l":case"t":for(n=0;n<i;n+=2)B(p.x+=e[n],p.y+=e[n+1]);break;case"h":for(n=0;n<i;++n)B(p.x+=e[n],p.y);break;case"v":for(n=0;n<i;++n)B(p.x,p.y+=e[n]);break;case"c":for(n=0;n<i;n+=6)B(p.x+e[n],p.y+e[n+1]),B(p.x+e[n+2],p.y+e[n+3]),B(p.x+=e[n+4],p.y+=e[n+5]);break;case"s":case"q":for(n=0;n<i;n+=4)B(p.x+e[n],p.y+e[n+1]),B(p.x+=e[n+2],p.y+=e[n+3]);break;case"A":for(n=0;n<i;n+=7)B(e[n+5],e[n+6]);p.x=e[i-2],p.y=e[i-1];break;case"a":for(n=0;n<i;n+=7)B(p.x+=e[n+5],p.y+=e[n+6])}}function z(t,e,i){const n=u[t.toLowerCase()];let r;"number"==typeof n&&(n?e.length>=n&&(r={action:t,args:e.slice(0,e.length-e.length%n)},i.push(r),I(r)):(r={action:t,args:[]},i.push(r),I(r)))}function F(t){const e=("string"!=typeof t.path?b(t.path):t.path).match(y),i=[];if(x={},p={},!e)return null;let n="",r=[];const o=e.length;for(let l=0;l<o;++l){const t=e[l],o=parseFloat(t);isNaN(o)?(n&&z(n,r,i),r=[],n=t):r.push(o)}z(n,r,i);const s={x:0,y:0,width:0,height:0};return x&&"left"in x&&(s.x=x.left,s.y=x.top,s.width=x.right-x.left,s.height=x.bottom-x.top),s}function T(t){const e={x:0,y:0,width:0,height:0};if("circle"===t.type)e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if("ellipse"===t.type)e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if("image"===t.type||"rect"===t.type)e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if("path"===t.type){const i=F(t);e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height}return e}function U(t){const e={x:0,y:0,width:0,height:0};let i=null,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const o of t)i?(i.x=Math.min(i.x,o.x),i.y=Math.min(i.y,o.y),n=Math.max(n,o.x+o.width),r=Math.max(r,o.y+o.height)):(i=e,i.x=o.x,i.y=o.y,n=o.x+o.width,r=o.y+o.height);return i&&(i.width=n-i.x,i.height=r-i.y),i}function V(t,e,i,o,s,l,a,h,c){let f=(a&&l?k(l,e):e)/2,d=(a&&l?k(l,i):i)/2;if(c){const t=c[0],e=c[1];f=(a&&l?k(l,t):t)/2,d=(a&&l?k(l,e):e)/2}const u=t.width+o,y=t.height+o,x=n.create(),p=n.create();let g=!1;if(s&&0!==u&&0!==y){const t=e!==i?e/i:u/y,n=e>i?e:i;let o=1,s=1;isNaN(n)||(t>1?(o=n/u,s=n/t/y):(s=n/y,o=n*t/u)),r.multiply(p,p,N(x,o,s,f,d)),g=!0}const m=t.x+(u-o)/2,w=t.y+(y-o)/2,b=f-m,v=d-w;if(r.multiply(p,p,G(x,b,v)),!g&&(u>e||y>i)){const t=u/e>y/i,n=(t?e:i)/(t?u:y);r.multiply(p,p,N(x,n,n,m,w))}return l&&r.multiply(p,p,$(x,l,m,w)),h&&r.multiply(p,p,G(x,h[0],h[1])),`matrix(${p[0]},${p[1]},${p[2]},${p[3]},${p[4]},${p[5]})`}function D(t,e,i){const n=null==t?void 0:t.effects.find((t=>"bloom"===t.type));if(!n)return null;const{strength:r,radius:o}=n,s=r>0?o:0,a=(r+.5*s)*(5**(e/100)*(.4+e/100)),h=(r+s)*e,c=4*r+1;return l.tsx("filter",{id:`bloom${i}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},l.tsx("feMorphology",{operator:"dilate",radius:a,in:"SourceGraphic",result:"dilate"}),l.tsx("feGaussianBlur",{in:"dilate",stdDeviation:h/25,result:"blur"}),l.tsx("feGaussianBlur",{in:"blur",stdDeviation:h/50,result:"intensityBlur"}),l.tsx("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},l.tsx("feFuncR",{type:"linear",slope:c}),l.tsx("feFuncG",{type:"linear",slope:c}),l.tsx("feFuncB",{type:"linear",slope:c})),l.tsx("feMerge",null,l.tsx("feMergeNode",{in:"intensityBlur"}),l.tsx("feMergeNode",{in:"intensityBrightness"}),l.tsx("feGaussianBlur",{stdDeviation:r/10})))}function E(t,e,i,n){const r=[],o=[],s=++w,h=D(null==n?void 0:n.effectView,e,s);let c=null;if(h){var f;const t=null==n||null==(f=n.effectView)?void 0:f.effects.find((t=>"bloom"===t.type)),r=(t.strength?t.strength+t.radius/2:0)/3,o=e+e*r,s=i+i*r;c=[Math.max(o,10),Math.max(s,10)]}for(const a of t){const t=[],s=[];let h=0,f=0,d=0;for(const e of a){const{shape:i,fill:n,stroke:o,font:l,offset:a}=e;h+=o&&o.width||0;const c=M(n),u=j(o),y="text"===i.type?S(i,l):null;r.push(A(c)),t.push(v(i,c.fill,u,y)),s.push(T(i)),a&&(f+=a[0],d+=a[1])}const u=V(U(s),e,i,h,null==n?void 0:n.scale,null==n?void 0:n.rotation,null==n?void 0:n.useRotationSize,[f,d],c);o.push(l.tsx("g",{transform:u},t))}null!=n&&n.useRotationSize&&null!=n&&n.rotation&&(e=k(null==n?void 0:n.rotation,e),i=k(null==n?void 0:n.rotation,i)),h&&(e=c[0],i=c[1]);const d="display: block;";return l.tsx("svg",{xmlns:a,width:e,height:i,style:d},h,l.tsx("defs",null,r),h?l.tsx("g",{filter:`url(#bloom${s})`},o):o)}t.computeBBox=U,t.generateFillAttributes=M,t.generateStrokeAttributes=j,t.generateTextAttributes=S,t.getBoundingBox=T,t.getTransformMatrix=V,t.renderDef=A,t.renderSVG=E,t.renderShape=v,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
