/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../core/Logger","../../Color","../../widgets/support/widgetUtils","../../chunks/index","../../chunks/mat2d","../../chunks/mat2df32"],(function(t,e,i,r,n,o,s,l){"use strict";const a="http://www.w3.org/2000/svg";let h=0,c=0;const d=e("android"),f=e("chrome")||d&&d>=4?"auto":"optimizeLegibility",y={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},u=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let x={},g={};const p={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},m=Math.PI;function w(t,e){const i=t*(m/180);return Math.abs(e*Math.sin(i))+Math.abs(e*Math.cos(i))}function k(t){return t.map((t=>`${t.command} ${t.values.join(" ")}`)).join(" ").trim()}function j(t,e,i,r){if(t){if("circle"===t.type)return o.jsx("circle",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,r:t.r});if("ellipse"===t.type)return o.jsx("ellipse",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,rx:t.rx,ry:t.ry});if("rect"===t.type)return o.jsx("rect",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:t.x,y:t.y,width:t.width,height:t.height});if("image"===t.type)return o.jsx("image",{href:t.src,x:t.x,y:t.y,width:t.width,height:t.height,preserveAspectRatio:"none"});if("path"===t.type){const r="string"!=typeof t.path?k(t.path):t.path;return o.jsx("path",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:r})}if("text"===t.type)return o.jsx("text",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":r.align,"text-decoration":r.decoration,kerning:r.kerning,rotate:r.rotate,"text-rendering":f,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,"font-size":r.font.size,"font-family":r.font.family,x:t.x,y:t.y},t.text)}return null}function b(t){const e={fill:"none",pattern:null,linearGradient:null};if(t)if("type"in t&&"pattern"===t.type){const i="patternId-"+ ++h;e.fill=`url(#${i})`,e.pattern={id:i,x:t.x,y:t.y,width:t.width,height:t.height,image:{x:0,y:0,width:t.width,height:t.height,href:t.src}}}else if("type"in t&&"linear"===t.type){const i="linearGradientId-"+ ++c;e.fill=`url(#${i})`,e.linearGradient={id:i,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stops:t.colors.map((t=>({offset:t.offset,color:t.color&&new r(t.color).toString()})))}}else if(t){const i=new r(t);e.fill=i.toString()}return e}function v(t){const e={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(t&&(null!=t.width&&(e.width=t.width),t.cap&&(e.cap=t.cap),t.join&&(e.join=t.join.toString()),t.color&&(e.color=new r(t.color).toString()),t.style)){let i=null;if(t.style in p&&(i=p[t.style]),Array.isArray(i)){i=i.slice(0);for(let e=0;e<i.length;++e)i[e]*=t.width;if("butt"!==t.cap){for(let e=0;e<i.length;e+=2)i[e]-=t.width,i[e]<1&&(i[e]=1);for(let e=1;e<i.length;e+=2)i[e]+=t.width}i=i.join(",")}e.dashArray=i}return e}function A(t,e){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return t&&(i.align=t.align,i.decoration=t.decoration,i.kerning=t.kerning?"auto":"0",i.rotate=t.rotated?"90":"0",i.font.style=e.style||"normal",i.font.variant=e.variant||"normal",i.font.weight=e.weight||"normal",i.font.size=e.size&&e.size.toString()||"10pt",i.font.family=e.family||"serif"),i}function M(t){const{pattern:e,linearGradient:i}=t;if(e)return o.jsx("pattern",{id:e.id,patternUnits:"userSpaceOnUse",x:e.x,y:e.y,width:e.width,height:e.height},o.jsx("image",{x:e.image.x,y:e.image.y,width:e.image.width,height:e.image.height,href:e.image.href}));if(i){const t=i.stops.map(((t,e)=>o.jsx("stop",{key:`${e}-stop`,offset:t.offset,"stop-color":t.color})));return o.jsx("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},t)}return null}function S(t,e,i){return s.translate(t,s.identity(t),[e,i])}function I(t,e,i,r,n){return s.scale(t,s.identity(t),[e,i]),t[4]=t[4]*e-r*e+r,t[5]=t[5]*i-n*i+n,t}function N(t,e,i,r){const n=e%360*Math.PI/180;s.rotate(t,s.identity(t),n);const o=Math.cos(n),l=Math.sin(n),a=t[4],h=t[5];return t[4]=a*o-h*l+r*l-i*o+i,t[5]=h*o+a*l-i*l-r*o+r,t}function z(t,e){x&&"left"in x?(x.left>t&&(x.left=t),x.right<t&&(x.right=t),x.top>e&&(x.top=e),x.bottom<e&&(x.bottom=e)):x={left:t,bottom:e,right:t,top:e}}function $(t){const e=t.args,i=e.length;let r;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)z(e[r],e[r+1]);g.x=e[i-2],g.y=e[i-1];break;case"H":for(r=0;r<i;++r)z(e[r],g.y);g.x=e[i-1];break;case"V":for(r=0;r<i;++r)z(g.x,e[r]);g.y=e[i-1];break;case"m":{let t=0;"x"in g||(z(g.x=e[0],g.y=e[1]),t=2);for(r=t;r<i;r+=2)z(g.x+=e[r],g.y+=e[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)z(g.x+=e[r],g.y+=e[r+1]);break;case"h":for(r=0;r<i;++r)z(g.x+=e[r],g.y);break;case"v":for(r=0;r<i;++r)z(g.x,g.y+=e[r]);break;case"c":for(r=0;r<i;r+=6)z(g.x+e[r],g.y+e[r+1]),z(g.x+e[r+2],g.y+e[r+3]),z(g.x+=e[r+4],g.y+=e[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)z(g.x+e[r],g.y+e[r+1]),z(g.x+=e[r+2],g.y+=e[r+3]);break;case"A":for(r=0;r<i;r+=7)z(e[r+5],e[r+6]);g.x=e[i-2],g.y=e[i-1];break;case"a":for(r=0;r<i;r+=7)z(g.x+=e[r+5],g.y+=e[r+6])}}function G(t,e,i){const r=y[t.toLowerCase()];let n;"number"==typeof r&&(r?e.length>=r&&(n={action:t,args:e.slice(0,e.length-e.length%r)},i.push(n),$(n)):(n={action:t,args:[]},i.push(n),$(n)))}function T(t){const e=("string"!=typeof t.path?k(t.path):t.path).match(u),i=[];if(x={},g={},!e)return null;let r="",n=[];const o=e.length;for(let l=0;l<o;++l){const t=e[l],o=parseFloat(t);isNaN(o)?(r&&G(r,n,i),n=[],r=t):n.push(o)}G(r,n,i);const s={x:0,y:0,width:0,height:0};return x&&"left"in x&&(s.x=x.left,s.y=x.top,s.width=x.right-x.left,s.height=x.bottom-x.top),s}function E(t){const e={x:0,y:0,width:0,height:0};if("circle"===t.type)e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if("ellipse"===t.type)e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if("image"===t.type||"rect"===t.type)e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if("path"===t.type){const i=T(t);e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height}return e}function F(t){const e={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(const o of t)i?(i.x=Math.min(i.x,o.x),i.y=Math.min(i.y,o.y),r=Math.max(r,o.x+o.width),n=Math.max(n,o.y+o.height)):(i=e,i.x=o.x,i.y=o.y,r=o.x+o.width,n=o.y+o.height);return i&&(i.width=r-i.x,i.height=n-i.y),i}function U(t,e,i,r,n,o,a,h){const c=(a&&o?w(o,e):e)/2,d=(a&&o?w(o,i):i)/2,f=t.width+r,y=t.height+r,u=l.create(),x=l.create();let g=!1;if(n&&0!==f&&0!==y){const t=f/y,r=e>i?e:i;let n=1,o=1;isNaN(r)||(t>1?(n=r/f,o=r/t/y):(o=r/y,n=r*t/f)),s.multiply(x,x,I(u,n,o,c,d)),g=!0}const p=t.x+(f-r)/2,m=t.y+(y-r)/2,k=c-p,j=d-m;if(s.multiply(x,x,S(u,k,j)),!g&&(f>e||y>i)){const t=f/e>y/i,r=(t?e:i)/(t?f:y);s.multiply(x,x,I(u,r,r,p,m))}return o&&s.multiply(x,x,N(u,o,p,m)),h&&s.multiply(x,x,S(u,h[0],h[1])),`matrix(${x[0]},${x[1]},${x[2]},${x[3]},${x[4]},${x[5]})`}function B(t,e,i,r){const n=[],s=[];for(const l of t){const t=[],a=[];let h=0,c=0,d=0;for(const e of l){const{shape:i,fill:r,stroke:o,font:s,offset:l}=e;h+=o&&o.width||0;const f=b(r),y=v(o),u="text"===i.type?A(i,s):null;n.push(M(f)),t.push(j(i,f.fill,y,u)),a.push(E(i)),l&&(c+=l[0],d+=l[1])}const f=U(F(a),e,i,h,null==r?void 0:r.scale,null==r?void 0:r.rotation,null==r?void 0:r.useRotationSize,[c,d]);s.push(o.jsx("g",{transform:f},t))}return null!=r&&r.useRotationSize&&null!=r&&r.rotation&&(e=w(null==r?void 0:r.rotation,e),i=w(null==r?void 0:r.rotation,i)),o.jsx("svg",{xmlns:a,width:e,height:i},o.jsx("defs",null,n),s)}t.computeBBox=F,t.generateFillAttributes=b,t.generateStrokeAttributes=v,t.generateTextAttributes=A,t.getBoundingBox=E,t.getTransformMatrix=U,t.renderDef=M,t.renderSVG=B,t.renderShape=j,Object.defineProperty(t,"__esModule",{value:!0})}));
