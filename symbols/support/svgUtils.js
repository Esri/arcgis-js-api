/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../Color","../../widgets/support/widgetUtils","../../chunks/index","../../chunks/mat2d","../../chunks/mat2df32"],(function(t,e,i,r,n,o,s){"use strict";let a=0,l=0;const h=e("android"),c=e("chrome")||h&&h>=4?"auto":"optimizeLegibility",f={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},d=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let y={},u={};const x={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};function p(t){return t.map((t=>`${t.command} ${t.values.join(" ")}`)).join(" ").trim()}function g(t,e,i,r){if(t){if("circle"===t.type)return n.jsx("circle",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,r:t.r});if("ellipse"===t.type)return n.jsx("ellipse",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:t.cx,cy:t.cy,rx:t.rx,ry:t.ry});if("rect"===t.type)return n.jsx("rect",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:t.x,y:t.y,width:t.width,height:t.height});if("image"===t.type)return n.jsx("image",{href:t.src,x:t.x,y:t.y,width:t.width,height:t.height,preserveAspectRatio:"none"});if("path"===t.type){const r="string"!=typeof t.path?p(t.path):t.path;return n.jsx("path",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:r})}if("text"===t.type)return n.jsx("text",{fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":r.align,"text-decoration":r.decoration,kerning:r.kerning,rotate:r.rotate,"text-rendering":c,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,"font-size":r.font.size,"font-family":r.font.family,x:t.x,y:t.y},t.text)}return null}function m(t){const e={fill:"none",pattern:null,linearGradient:null};if(t)if("type"in t&&"pattern"===t.type){const i="patternId-"+ ++a;e.fill=`url(#${i})`,e.pattern={id:i,x:t.x,y:t.y,width:t.width,height:t.height,image:{x:0,y:0,width:t.width,height:t.height,href:t.src}}}else if("type"in t&&"linear"===t.type){const r="linearGradientId-"+ ++l;e.fill=`url(#${r})`,e.linearGradient={id:r,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stops:t.colors.map((t=>({offset:t.offset,color:t.color&&new i(t.color).toString()})))}}else if(t){const r=new i(t);e.fill=r.toString()}return e}function w(t){const e={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(t&&(null!=t.width&&(e.width=t.width),t.cap&&(e.cap=t.cap),t.join&&(e.join=t.join.toString()),t.color&&(e.color=new i(t.color).toString()),t.style)){let i=null;if(t.style in x&&(i=x[t.style]),Array.isArray(i)){i=i.slice(0);for(let e=0;e<i.length;++e)i[e]*=t.width;if("butt"!==t.cap){for(let e=0;e<i.length;e+=2)i[e]-=t.width,i[e]<1&&(i[e]=1);for(let e=1;e<i.length;e+=2)i[e]+=t.width}i=i.join(",")}e.dashArray=i}return e}function k(t,e){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return t&&(i.align=t.align,i.decoration=t.decoration,i.kerning=t.kerning?"auto":"0",i.rotate=t.rotated?"90":"0",i.font.style=e.style||"normal",i.font.variant=e.variant||"normal",i.font.weight=e.weight||"normal",i.font.size=e.size&&e.size.toString()||"10pt",i.font.family=e.family||"serif"),i}function j(t){const{pattern:e,linearGradient:i}=t;if(e)return n.jsx("pattern",{id:e.id,patternUnits:"userSpaceOnUse",x:e.x,y:e.y,width:e.width,height:e.height},n.jsx("image",{x:e.image.x,y:e.image.y,width:e.image.width,height:e.image.height,href:e.image.href}));if(i){const t=i.stops.map(((t,e)=>n.jsx("stop",{key:`${e}-stop`,offset:t.offset,"stop-color":t.color})));return n.jsx("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},t)}return null}function b(t,e,i){return o.translate(t,o.identity(t),[e,i])}function v(t,e,i,r,n){return o.scale(t,o.identity(t),[e,i]),t[4]=t[4]*e-r*e+r,t[5]=t[5]*i-n*i+n,t}function A(t,e){y&&"left"in y?(y.left>t&&(y.left=t),y.right<t&&(y.right=t),y.top>e&&(y.top=e),y.bottom<e&&(y.bottom=e)):y={left:t,bottom:e,right:t,top:e}}function N(t){const e=t.args,i=e.length;let r;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)A(e[r],e[r+1]);u.x=e[i-2],u.y=e[i-1];break;case"H":for(r=0;r<i;++r)A(e[r],u.y);u.x=e[i-1];break;case"V":for(r=0;r<i;++r)A(u.x,e[r]);u.y=e[i-1];break;case"m":{let t=0;"x"in u||(A(u.x=e[0],u.y=e[1]),t=2);for(r=t;r<i;r+=2)A(u.x+=e[r],u.y+=e[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)A(u.x+=e[r],u.y+=e[r+1]);break;case"h":for(r=0;r<i;++r)A(u.x+=e[r],u.y);break;case"v":for(r=0;r<i;++r)A(u.x,u.y+=e[r]);break;case"c":for(r=0;r<i;r+=6)A(u.x+e[r],u.y+e[r+1]),A(u.x+e[r+2],u.y+e[r+3]),A(u.x+=e[r+4],u.y+=e[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)A(u.x+e[r],u.y+e[r+1]),A(u.x+=e[r+2],u.y+=e[r+3]);break;case"A":for(r=0;r<i;r+=7)A(e[r+5],e[r+6]);u.x=e[i-2],u.y=e[i-1];break;case"a":for(r=0;r<i;r+=7)A(u.x+=e[r+5],u.y+=e[r+6])}}function I(t,e,i){const r=f[t.toLowerCase()];let n;"number"==typeof r&&(r?e.length>=r&&(n={action:t,args:e.slice(0,e.length-e.length%r)},i.push(n),N(n)):(n={action:t,args:[]},i.push(n),N(n)))}function S(t){const e={x:0,y:0,width:0,height:0};if("circle"===t.type)e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if("ellipse"===t.type)e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if("image"===t.type||"rect"===t.type)e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if("path"===t.type){const i=function(t){const e=("string"!=typeof t.path?p(t.path):t.path).match(d),i=[];if(y={},u={},!e)return null;let r="",n=[];const o=e.length;for(let t=0;t<o;++t){const o=e[t],s=parseFloat(o);isNaN(s)?(r&&I(r,n,i),n=[],r=o):n.push(s)}I(r,n,i);const s={x:0,y:0,width:0,height:0};return y&&"left"in y&&(s.x=y.left,s.y=y.top,s.width=y.right-y.left,s.height=y.bottom-y.top),s}(t);e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height}return e}function $(t){const e={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(const o of t)i?(i.x=Math.min(i.x,o.x),i.y=Math.min(i.y,o.y),r=Math.max(r,o.x+o.width),n=Math.max(n,o.y+o.height)):(i=e,i.x=o.x,i.y=o.y,r=o.x+o.width,n=o.y+o.height);return i&&(i.width=r-i.x,i.height=n-i.y),i}function M(t,e,i,r,n,a,l){const h=e/2,c=i/2,f=t.width+r,d=t.height+r,y=s.create(),u=s.create();let x=!1;if(n&&0!==f&&0!==d){const t=f/d,r=e>i?e:i;let n=1,s=1;isNaN(r)||(t>1?(n=r/f,s=r/t/d):(s=r/d,n=r*t/f)),o.multiply(u,u,v(y,n,s,h,c)),x=!0}const p=t.x+(f-r)/2,g=t.y+(d-r)/2,m=h-p,w=c-g;if(o.multiply(u,u,b(y,m,w)),!x&&(f>e||d>i)){const t=f/e>d/i,r=(t?e:i)/(t?f:d);o.multiply(u,u,v(y,r,r,p,g))}return a&&o.multiply(u,u,function(t,e,i,r){const n=e%360*Math.PI/180;o.rotate(t,o.identity(t),n);const s=Math.cos(n),a=Math.sin(n),l=t[4],h=t[5];return t[4]=l*s-h*a+r*a-i*s+i,t[5]=h*s+l*a-i*a-r*s+r,t}(y,a,p,g)),l&&o.multiply(u,u,b(y,l[0],l[1])),`matrix(${u[0]},${u[1]},${u[2]},${u[3]},${u[4]},${u[5]})`}t.computeBBox=$,t.generateFillAttributes=m,t.generateStrokeAttributes=w,t.generateTextAttributes=k,t.getBoundingBox=S,t.getTransformMatrix=M,t.renderDef=j,t.renderSVG=function(t,e,i,r){const o=[],s=[];for(const a of t){const t=[],l=[];let h=0,c=0,f=0;for(const e of a){const{shape:i,fill:r,stroke:n,font:s,offset:a}=e;h+=n&&n.width||0;const d=m(r),y=w(n),u="text"===i.type?k(i,s):null;o.push(j(d)),t.push(g(i,d.fill,y,u)),l.push(S(i)),a&&(c+=a[0],f+=a[1])}const d=M($(l),e,i,h,r&&r.scale,r&&r.rotation,[c,f]);s.push(n.jsx("g",{transform:d},t))}return n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:e,height:i},n.jsx("defs",null,o),s)},t.renderShape=g,Object.defineProperty(t,"__esModule",{value:!0})}));
