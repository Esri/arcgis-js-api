/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../assets","../../Color","../../request","../../core/ItemCache","../../core/screenUtils","./cimSymbolUtils"],(function(e,t,l,o,r,n,s){"use strict";const i="picture-fill",c="simple-fill",a="simple-line",p="simple-marker",u="text",h="cim",d=new r(1e3);function m(e){const l=e.style;let o=null;if(e)switch(e.type){case p:"cross"!==l&&"x"!==l&&(o=e.color);break;case c:"solid"===l?o=e.color:"none"!==l&&(o={type:"pattern",x:0,y:0,src:t.getAssetUrl(`esri/symbols/patterns/${l}.png`),width:5,height:5});break;case i:o={type:"pattern",src:e.url,width:n.pt2px(e.width)*e.xscale,height:n.pt2px(e.height)*e.yscale,x:n.pt2px(e.xoffset),y:n.pt2px(e.yoffset)};break;case u:o=e.color;break;case h:o=s.getCIMSymbolColor(e)}return o}function y(e,t){const l=e+"-"+t;return void 0!==d.get(l)?Promise.resolve(d.get(l)):o(e,{responseType:"image"}).then((e=>{const o=e.data,r=o.naturalWidth,n=o.naturalHeight,s=document.createElement("canvas");s.width=r,s.height=n;const i=s.getContext("2d");i.fillStyle=t,i.fillRect(0,0,r,n),i.globalCompositeOperation="destination-in",i.drawImage(o,0,0);const c=s.toDataURL();return d.put(l,c),c}))}function f(e){if(!e)return null;let t=null;switch(e.type){case c:case i:case p:t=f(e.outline);break;case a:{const l=n.pt2px(e.width);null!=e.style&&"none"!==e.style&&0!==l&&(t={color:e.color,style:g(e.style),width:l,cap:e.cap,join:"miter"===e.join?n.pt2px(e.miterLimit):e.join});break}default:t=null}return t}const g=(()=>{const e={};return t=>{if(e[t])return e[t];const l=t.replace(/-/g,"");return e[t]=l,l}})(),b=new l([128,128,128]);e.defaultThematicColor=b,e.dekebabifyLineStyle=g,e.getFill=m,e.getPatternUrlWithColor=y,e.getStroke=f,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
