/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../Color","../cim/utils"],(function(e,t,o){"use strict";function r(e){const t=o.toCIMSymbolJSON(e);if("CIMTextSymbol"===t.type)return t.height;let r=0;if(t.symbolLayers)for(const e of t.symbolLayers)o.isCIMMarker(e)&&e.size>r?r=e.size:o.isCIMStroke(e)&&e.width>r?r=e.width:o.isCIMFill(e);return r}function a(e,t,o,r){if("CIMTextSymbol"!==e.type){if(o&&e.effects)for(const o of e.effects)s(o,t);if(e.symbolLayers)for(const o of e.symbolLayers)switch(o.type){case"CIMPictureMarker":case"CIMVectorMarker":c(o,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":null!=r&&r.preserveOutlineWidth||(o.width*=t);break;case"CIMPictureFill":o.height*=t,o.offsetX*=t,o.offsetY*=t;break;case"CIMHatchFill":a(o.lineSymbol,t,!0,{...r,preserveOutlineWidth:!1}),o.offsetX*=t,o.offsetY*=t,o.separation*=t}}else e.height*=t}function c(e,t,r){if(e.markerPlacement&&function(e,t){o.isCIMMarkerStrokePlacement(e)&&(e.offset*=t);switch(e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map((e=>e*t));e.placementTemplate=o}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset*=t,e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map((e=>e*t));e.placementTemplate=o}break;case"CIMMarkerPlacementOnLine":e.startPointOffset*=t;break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine*=t;break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition*=t,e.endPosition*=t;break;case"CIMMarkerPlacementPolygonCenter":e.offsetX*=t,e.offsetY*=t;break;case"CIMMarkerPlacementInsidePolygon":e.offsetX*=t,e.offsetY*=t,e.stepX*=t,e.stepY*=t}}(e.markerPlacement,t),e.offsetX*=t,e.offsetY*=t,e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,"CIMVectorMarker"===e.type&&e.markerGraphics)for(const o of e.markerGraphics)e.scaleSymbolsProportionally||a(o.symbol,t,!0,r)}function s(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width*=t;break;case"CIMGeometricEffectBuffer":e.size*=t;break;case"CIMGeometricEffectCut":e.beginCut*=t,e.endCut*=t,e.middleCut*=t;break;case"CIMGeometricEffectDashes":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.dashTemplate&&e.dashTemplate.length){const o=e.dashTemplate.map((e=>e*t));e.dashTemplate=o}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length*=t;break;case"CIMGeometricEffectMove":e.offsetX*=t,e.offsetY*=t;break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset*=t;break;case"CIMGeometricEffectRegularPolygon":e.radius*=t;break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth*=t,e.length*=t,e.toWidth*=t;break;case"CIMGeometricEffectWave":e.amplitude*=t,e.period*=t}}function i(e,t){let r;r="CIMTextSymbol"===e.type?e.symbol:e;const a="CIMPolygonSymbol"===e.type;if(r.symbolLayers)for(const e of r.symbolLayers)if(!(e.colorLocked||a&&(o.isCIMStroke(e)||o.isCIMMarker(e)&&e.markerPlacement&&o.isCIMMarkerStrokePlacement(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":break;case"CIMVectorMarker":e.markerGraphics.forEach((e=>{i(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":n(t,e.color);break;case"CIMHatchFill":i(e.lineSymbol,t)}}function n(e,t){for(const o of e)if(o.join(".")===t.join("."))return;e.push(t)}function l(e,t){let r;r="CIMTextSymbol"===e.type?e.symbol:e;const a="CIMPolygonSymbol"===e.type;if(r.symbolLayers)for(const e of r.symbolLayers){if(e.colorLocked)continue;if(a&&(o.isCIMStroke(e)||o.isCIMMarker(e)&&e.markerPlacement&&o.isCIMMarkerStrokePlacement(e.markerPlacement)))continue;const r=t.toArray(0);switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":break;case"CIMVectorMarker":e.markerGraphics.forEach((e=>{l(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":e.color=r;break;case"CIMHatchFill":l(e.lineSymbol,t)}}}e.applyCIMSymbolColor=function(e,r){r instanceof t||(r=new t(r)),l(o.toCIMSymbolJSON(e),r)},e.applyCIMSymbolRotation=function(e,t){const r=o.toCIMSymbolJSON(e);if("CIMTextSymbol"!==r.type){if("CIMPointSymbol"===r.type&&r.symbolLayers){const e=t-(r.angle||0);for(const a of r.symbolLayers){if(o.isCIMMarker(a)){let t=a.rotation||0;a.rotateClockwise?t-=e:t+=e,a.rotation=t}r.angle=t}}}else r.angle=t},e.getCIMSymbolColor=function(e){const r=[];return i(o.toCIMSymbolJSON(e),r),r.length?new t(o.fromCIMColor(r[0])):null},e.getCIMSymbolRotation=function(e){const t=o.toCIMSymbolJSON(e);return("CIMTextSymbol"===t.type||"CIMPointSymbol"===t.type)&&t.angle||0},e.getCIMSymbolSize=r,e.scaleCIMMarker=c,e.scaleCIMSymbolTo=function(e,t,c){const s=o.toCIMSymbolJSON(e),i=r(e);if(0===i)return void function(e,t){if("CIMTextSymbol"===e.type)return void(e.height=t);if(e.symbolLayers)for(const o of e.symbolLayers)switch(o.type){case"CIMPictureMarker":case"CIMVectorMarker":o.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":o.width=t}}(s,t);a(s,t/i,!1,c)},Object.defineProperty(e,"__esModule",{value:!0})}));
