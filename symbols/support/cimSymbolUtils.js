/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../Color","../cim/utils"],(function(e,t,o){"use strict";function r(e){const t=o.toCIMSymbolJSON(e);if("CIMTextSymbol"===t.type)return t.height;let r=0;if(t.symbolLayers)for(const a of t.symbolLayers)o.isCIMMarker(a)&&a.size>r?r=a.size:o.isCIMStroke(a)&&a.width>r?r=a.width:o.isCIMFill(a);return r}function a(e,t,a){const n=o.toCIMSymbolJSON(e),c=r(e);if(0===c)return void s(n,t);i(n,t/c,!1,a)}function s(e,t){if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const o of e.symbolLayers)switch(o.type){case"CIMPictureMarker":case"CIMVectorMarker":o.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":o.width=t}}else e.height=t}function i(e,t,o,r){if("CIMTextSymbol"!==e.type){if(o&&e.effects)for(const o of e.effects)l(o,t);if(e.symbolLayers)for(const o of e.symbolLayers)switch(o.type){case"CIMPictureMarker":case"CIMVectorMarker":n(o,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":null!=r&&r.preserveOutlineWidth||!o.width||(o.width*=t);break;case"CIMPictureFill":o.height&&(o.height*=t),o.offsetX&&(o.offsetX*=t),o.offsetY&&(o.offsetY*=t);break;case"CIMHatchFill":i(o.lineSymbol,t,!0,{...r,preserveOutlineWidth:!1}),o.offsetX&&(o.offsetX*=t),o.offsetY&&(o.offsetY*=t),o.separation&&(o.separation*=t)}}else e.height*=t}function n(e,t,o){if(e.markerPlacement&&c(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,"CIMVectorMarker"===e.type&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||i(r.symbol,t,!0,o)}function c(e,t){switch(o.isCIMMarkerStrokePlacement(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map((e=>e*t));e.placementTemplate=o}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map((e=>e*t));e.placementTemplate=o}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function l(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const o=e.dashTemplate.map((e=>e*t));e.dashTemplate=o}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function f(e){const r=[];return m(o.toCIMSymbolJSON(e),r),r.length?new t(o.fromCIMColor(r[0])):null}function m(e,t){let r;r="CIMTextSymbol"===e.type?e.symbol:e;const a="CIMPolygonSymbol"===e.type;if(r.symbolLayers)for(const s of r.symbolLayers)if(!(s.colorLocked||a&&(o.isCIMStroke(s)||o.isCIMMarker(s)&&s.markerPlacement&&o.isCIMMarkerStrokePlacement(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&M(t,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics.forEach((e=>{m(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":M(t,s.color);break;case"CIMHatchFill":m(s.lineSymbol,t)}}function M(e,t){for(const o of e)if(o.join(".")===t.join("."))return;e.push(t)}function C(e,r,a){r instanceof t||(r=new t(r));const s=o.toCIMSymbolJSON(e);s&&I(s,r,a)}function I(e,t,r){let a;a="CIMTextSymbol"===e.type?e.symbol:e;const s="CIMPolygonSymbol"===a.type;if(a.symbolLayers)for(const i of a.symbolLayers){if(i.colorLocked)continue;if(s)if(r){const{layersToColor:e}=r;if((o.isCIMStroke(i)||o.isCIMMarker(i)&&i.markerPlacement&&o.isCIMMarkerStrokePlacement(i.markerPlacement))&&"fill"===e||o.isCIMFill(i)&&"outline"===e)continue}else if(o.isCIMStroke(i)||o.isCIMMarker(i)&&i.markerPlacement&&o.isCIMMarkerStrokePlacement(i.markerPlacement))continue;const e=t.toArray();switch(i.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":i.tintColor=e;break;case"CIMVectorMarker":i.markerGraphics.forEach((e=>{I(e.symbol,t,r)}));break;case"CIMSolidStroke":case"CIMSolidFill":i.color=e;break;case"CIMHatchFill":I(i.lineSymbol,t,r)}}}function y(e,t=!1){const r=o.toCIMSymbolJSON(e);return"CIMTextSymbol"===r.type||"CIMPointSymbol"===r.type?t&&0!==r.angle?360-r.angle:r.angle||0:0}function k(e,t,r=!1){const a=o.toCIMSymbolJSON(e);if(r&&0!==t&&(t=360-t),"CIMTextSymbol"!==a.type){if("CIMPointSymbol"===a.type&&a.symbolLayers){const e=t-(a.angle||0);for(const t of a.symbolLayers)if(o.isCIMMarker(t)){let o=t.rotation||0;t.rotateClockwise?o-=e:o+=e,t.rotation=o}a.angle=t}}else a.angle=t}e.applyCIMSymbolColor=C,e.applyCIMSymbolRotation=k,e.getCIMSymbolColor=f,e.getCIMSymbolRotation=y,e.getCIMSymbolSize=r,e.scaleCIMMarker=n,e.scaleCIMSymbolTo=a,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
