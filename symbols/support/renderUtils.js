/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../kernel","../../request","../../core/colorUtils","../../core/Error","../../core/has","../../libs/maquette/projection","../../libs/maquette/projector","./svgUtils"],(function(t,e,n,i,r,o,a,c,h){"use strict";const l=c.createProjector();function s(t,e,n){const i=Math.ceil(e[0]),r=Math.ceil(e[1]);if(!t.some((t=>!!t.length)))return null;const o=n&&n.node||document.createElement("div");return null!=n.opacity&&(o.style.opacity=n.opacity.toString()),l.append(o,h.renderSVG.bind(null,t,i,r,n)),o}function d(t,e){t=Math.ceil(t),e=Math.ceil(e);const n=document.createElement("canvas");n.width=t,n.height=e,n.style.width=t+"px",n.style.height=e+"px";const i=n.getContext("2d");return i.clearRect(0,0,t,e),i}function g(t,e,i){return t?n(t,{responseType:"image"}).then((t=>{const n=t.data,r=n.width,o=n.height,a=r/o;let c=e;if(i){const t=Math.max(r,o);c=Math.min(c,t)}return{image:n,width:a<=1?Math.ceil(c*a):c,height:a<=1?c:Math.ceil(c/a)}})):Promise.reject(new r("renderUtils: imageDataSize","href not provided."))}function u(t,e){return!(!t||"ignore"===e)&&("multiply"!==e||255!==t.r||255!==t.g||255!==t.b||1!==t.a)}function m(t,e,n,r,o){switch(o){case"multiply":t[e+0]*=n[0],t[e+1]*=n[1],t[e+2]*=n[2],t[e+3]*=n[3];break;default:{const o=i.toHSV({r:t[e+0],g:t[e+1],b:t[e+2]});o.h=r.h,o.s=r.s,o.v=o.v/100*r.v;const a=i.toRGB(o);t[e+0]=a.r,t[e+1]=a.g,t[e+2]=a.b,t[e+3]*=n[3];break}}}function f(t,n,r,a,c){return g(t,n,c).then((c=>{const h=c.width?c.width:n,l=c.height?c.height:n;if(c.image&&u(r,a)){let e=c.image.width,n=c.image.height;o("edge")&&/\.svg$/i.test(t)&&(e-=1,n-=1);const s=d(h,l);s.drawImage(c.image,0,0,e,n,0,0,h,l);const g=s.getImageData(0,0,h,l),u=[r.r/255,r.g/255,r.b/255,r.a],f=i.toHSV(r);for(let t=0;t<g.data.length;t+=4)m(g.data,t,u,f,a);s.putImageData(g,0,0),t=s.canvas.toDataURL("image/png")}else{const n=e.id&&e.id.findCredential(t);if(n&&n.token){const e=-1===t.indexOf("?")?"?":"&";t=`${t}${e}token=${n.token}`}}return{url:t,width:h,height:l}})).catch((function(){return{url:t,width:n,height:n}}))}t.renderSymbol=s,t.tintImageWithColor=f,Object.defineProperty(t,"__esModule",{value:!0})}));
