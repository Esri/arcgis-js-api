/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../core/Error","../../core/promiseUtils","../../kernel","../../request","../../core/colorUtils","../../libs/maquette/projection","../../libs/maquette/projector","./svgUtils"],(function(t,e,i,n,r,o,a,c,h,l){"use strict";const s=h.createProjector();function d(t,e,i,n,r){switch(r){case"multiply":t[e+0]*=i[0],t[e+1]*=i[1],t[e+2]*=i[2],t[e+3]*=i[3];break;default:{const r=a.toHSV({r:t[e+0],g:t[e+1],b:t[e+2]});r.h=n.h,r.s=n.s,r.v=r.v/100*n.v;const o=a.toRGB(r);t[e+0]=o.r,t[e+1]=o.g,t[e+2]=o.b,t[e+3]*=i[3];break}}}t.renderSymbol=function(t,e,i){const n=Math.ceil(e[0]),r=Math.ceil(e[1]);if(!t.some((t=>!!t.length)))return null;const o=i&&i.node||document.createElement("div");return null!=i.opacity&&(o.style.opacity=i.opacity.toString()),s.append(o,l.renderSVG.bind(null,t,n,r,i)),o},t.tintImageWithColor=function(t,c,h,l,s){return function(t,e,r){return t?o(t,{responseType:"image"}).then((t=>{const i=t.data,n=i.width,o=i.height,a=n/o;let c=e;if(r){const t=Math.max(n,o);c=Math.min(c,t)}return{image:i,width:a<=1?Math.ceil(c*a):c,height:a<=1?c:Math.ceil(c/a)}})):n.reject(new i("renderUtils: imageDataSize","href not provided."))}(t,c,s).then((i=>{const n=i.width?i.width:c,o=i.height?i.height:c;if(i.image&&function(t,e){return!(!t||"ignore"===e||"multiply"===e&&255===t.r&&255===t.g&&255===t.b&&1===t.a)}(h,l)){let r=i.image.width,c=i.image.height;(e("edge")||e("ie"))&&/\.svg$/i.test(t)&&(r-=1,c-=1);const s=function(t,e){t=Math.ceil(t),e=Math.ceil(e);const i=document.createElement("canvas");i.width=t,i.height=e,i.style.width=t+"px",i.style.height=e+"px";const n=i.getContext("2d");return n.clearRect(0,0,t,e),n}(n,o);s.drawImage(i.image,0,0,r,c,0,0,n,o);const g=s.getImageData(0,0,n,o),u=[h.r/255,h.g/255,h.b/255,h.a],m=a.toHSV(h);for(let t=0;t<g.data.length;t+=4)d(g.data,t,u,m,l);s.putImageData(g,0,0),t=s.canvas.toDataURL("image/png")}else{const e=r.id&&r.id.findCredential(t);if(e&&e.token){const i=-1===t.indexOf("?")?"?":"&";t=`${t}${i}token=${e.token}`}}return{url:t,width:n,height:o}})).catch((function(){return{url:t,width:c,height:c}}))},Object.defineProperty(t,"__esModule",{value:!0})}));
