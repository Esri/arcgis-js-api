/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../symbols","../../core/asyncUtils","../../core/has","../../core/maybe","../../core/screenUtils","../../chunks/vec3f64","../../layers/effects/jsonUtils","./gfxUtils","./Symbol3DMaterial"],(function(e,t,o,n,r,i,l,s,u,c,a,y,f){"use strict";const p=/\/resource\/(.*?)\.svg$/,m=new n("white");function h(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const o=e.symbolLayers.getItemAt(t-1);return"outline"in o?s.get(o,"outline","size"):void 0}function b(e){if(!e)return 0;if(r.isSymbol3D(e)){const t=h(e);return s.isSome(t)?t:0}const t=y.getStroke(e);return t&&u.px2pt(t.width)||0}function S(e){if(s.isNone(e)||!("symbolLayers"in e)||s.isNone(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function d(e,t){const o=t.resource.href;return!l("esri-canvas-svg-support")&&e.styleOrigin&&p.test(o)?o.replace(p,"/resource/png/$1.png"):o}function w(e,t){if(!e)return null;let o=null;return r.isSymbol3D(e)?o=g(e):r.isSymbol2D(e)&&(o=e.color?new n(e.color):null),o?k(o,t):null}function g(e){const t=e.symbolLayers;if(!t)return null;let o=null;return t.forEach((e=>{"object"===e.type&&null!=e.resource.href||(o="water"===e.type?s.unwrap(e.color):s.isSome(e.material)?s.unwrap(e.material.color):null)})),o?new n(o):null}function k(e,t){if(null==t)return e;const o=e.toRgba();return o[3]=o[3]*t,new n(o)}function L(e,t,o){const n=e.symbolLayers;if(!n)return;const r=e=>{const n=s.isSome(e)?e:null;return k(t=t||n||null!=o&&m,o)};n.forEach((e=>{if("object"!==e.type||null==e.resource.href||t)if("water"===e.type)e.color=r(e.color);else{const t=s.isSome(e.material)?e.material.color:null,n=r(t);s.isNone(e.material)?e.material=new f.default({color:n}):e.material.color=n,null!=o&&"outline"in e&&s.isSome(e.outline)&&s.isSome(e.outline.color)&&(e.outline.color=k(e.outline.color,o))}}))}function z(e,t,o){(t=t||e.color)&&(e.color=k(t,o)),null!=o&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=k(e.outline.color,o))}function v(e,t,o){e&&(t||null!=o)&&(t&&(t=new n(t)),r.isSymbol3D(e)?L(e,t,o):r.isSymbol2D(e)&&z(e,t,o))}function D(e,t){return T.apply(this,arguments)}function T(){return T=o._asyncToGenerator((function*(e,t){const n=e.symbolLayers;n&&(yield i.forEach(n,function(){var e=o._asyncToGenerator((function*(e){return j(e,t)}));return function(t){return e.apply(this,arguments)}}()))})),T.apply(this,arguments)}function j(e,t){return _.apply(this,arguments)}function _(){return(_=o._asyncToGenerator((function*(e,t){switch(e.type){case"extrude":N(e,t);break;case"icon":case"line":case"text":x(e,t);break;case"path":C(e,t);break;case"object":yield E(e,t)}}))).apply(this,arguments)}function x(e,t){const o=O(t);s.isSome(o)&&(e.size=o)}function O(e){for(const t of e)if("number"==typeof t)return t;return null}function N(e,t){e.size="number"==typeof t[2]?t[2]:0}function E(e,t){return G.apply(this,arguments)}function G(){return(G=o._asyncToGenerator((function*(e,t){const{resourceSize:o,symbolSize:n}=yield U(e),r=F(t,o,n);e.width=R(t[0],n[0],o[0],r),e.depth=R(t[1],n[1],o[1],r),e.height=R(t[2],n[2],o[2],r)}))).apply(this,arguments)}function C(e,t){const o=F(t,c.ONES,[e.width,void 0,e.height]);e.width=R(t[0],e.width,1,o),e.height=R(t[2],e.height,1,o)}function F(e,t,o){for(let n=0;n<3;n++){const r=e[n];switch(r){case"symbol-value":return null!=o[n]?o[n]/t[n]:1;case"proportional":break;default:if(r&&t[n])return r/t[n]}}return 1}function U(e){return P.apply(this,arguments)}function P(){return(P=o._asyncToGenerator((function*(t){const o=yield new Promise(((t,o)=>e(["./symbolLayerUtils"],t,o))),n=yield o.computeObjectLayerResourceSize(t,10),{width:r,height:i,depth:l}=t,s=[r,l,i];let u=1;for(let e=0;e<3;e++)if(null!=s[e]){u=s[e]/n[e];break}for(let e=0;e<3;e++)null==s[e]&&(s[e]=n[e]*u);return{resourceSize:n,symbolSize:s}}))).apply(this,arguments)}function R(e,t,o,n){switch(e){case"proportional":return o*n;case"symbol-value":return null!=t?t:o;default:return e}}function H(e,t){const o=O(t);if(!s.isNone(o))switch(e.type){case"simple-marker":e.size=o;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=o,e.height=o*t):(e.width=o*t,e.height=o);break}case"simple-line":e.width=o;break;case"text":e.font.size=o}}function I(e,t){return J.apply(this,arguments)}function J(){return(J=o._asyncToGenerator((function*(e,t){if(e&&t)return r.isSymbol3D(e)?D(e,t):void(r.isSymbol2D(e)&&H(e,t))}))).apply(this,arguments)}function M(e,t,o){if(e&&null!=t)if(r.isSymbol3D(e)){const n=e.symbolLayers;n&&n.forEach((e=>{if(e&&"object"===e.type)switch(o){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else r.isSymbol2D(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}function $(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return a.effectFunctionsFromJSON(t)}t.applyColorToSymbol=v,t.applyOpacityToColor=k,t.applyRotationToSymbol=M,t.applySizesToSymbol=I,t.getCSSFilterFromEffectList=$,t.getColorFromSymbol=w,t.getIconHref=d,t.getSymbolOutlineSize=b,t.isVolumetricSymbol=S,Object.defineProperty(t,"__esModule",{value:!0})}));
