/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../symbols","../../core/asyncUtils","../../core/has","../../core/maybe","../../core/screenUtils","../../chunks/vec3f64","../../layers/effects/jsonUtils","./gfxUtils","./Symbol3DMaterial"],(function(e,t,o,n,r,l,i,s,u,c,a,y,f){"use strict";const p=new n("white");function m(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const o=e.symbolLayers.getItemAt(t-1);return"outline"in o?s.get(o,"outline","size"):void 0}function b(e){if(!e)return 0;if(r.isSymbol3D(e)){const t=m(e);return s.isSome(t)?t:0}return u.px2pt(y.getStroke(e)?.width)}function h(e){if(s.isNone(e)||!("symbolLayers"in e)||s.isNone(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function S(e){return s.unwrapOrThrow(e.resource).href}function d(e,t){if(!e)return null;let o=null;return r.isSymbol3D(e)?o=w(e):r.isSymbol2D(e)&&(o=e.color?new n(e.color):null),o?g(o,t):null}function w(e){const t=e.symbolLayers;if(!t)return null;let o=null;return t.forEach((e=>{"object"===e.type&&null!=e.resource?.href||(o="water"===e.type?s.unwrap(e.color):s.isSome(e.material)?s.unwrap(e.material.color):null)})),o?new n(o):null}function g(e,t){if(null==t||null==e)return e;const o=e.toRgba();return o[3]=o[3]*t,new n(o)}function k(e,t,o){const n=e.symbolLayers;if(!n)return;const r=e=>{const n=s.isSome(e)?e:null;return g(t=t??n??(null!=o?p:null),o)};n.forEach((e=>{if("object"!==e.type||null==e.resource?.href||t)if("water"===e.type)e.color=r(e.color);else{const t=s.isSome(e.material)?e.material.color:null,n=r(t);s.isNone(e.material)?e.material=new f.Symbol3DMaterial({color:n}):e.material.color=n,null!=o&&"outline"in e&&s.isSome(e.outline)&&s.isSome(e.outline.color)&&(e.outline.color=g(e.outline.color,o))}}))}function L(e,t,o){(t=t??e.color)&&(e.color=g(t,o)),null!=o&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=g(e.outline.color,o))}function T(e,t,o){e&&(t||null!=o)&&(t&&(t=new n(t)),r.isSymbol3D(e)?k(e,t,o):r.isSymbol2D(e)&&L(e,t,o))}function z(e,t){return D.apply(this,arguments)}function D(){return D=o._asyncToGenerator((function*(e,t){const n=e.symbolLayers;n&&(yield l.forEach(n,function(){var e=o._asyncToGenerator((function*(e){return x(e,t)}));return function(t){return e.apply(this,arguments)}}()))})),D.apply(this,arguments)}function x(e,t){return j.apply(this,arguments)}function j(){return(j=o._asyncToGenerator((function*(e,t){switch(e.type){case"extrude":_(e,t);break;case"icon":case"line":case"text":v(e,t);break;case"path":N(e,t);break;case"object":yield E(e,t)}}))).apply(this,arguments)}function v(e,t){const o=O(t);s.isSome(o)&&(e.size=o)}function O(e){for(const t of e)if("number"==typeof t)return t;return null}function _(e,t){e.size="number"==typeof t[2]?t[2]:0}function E(e,t){return G.apply(this,arguments)}function G(){return(G=o._asyncToGenerator((function*(e,t){const{resourceSize:o,symbolSize:n}=yield F(e),r=C(t,o,n);e.width=M(t[0],n[0],o[0],r),e.depth=M(t[1],n[1],o[1],r),e.height=M(t[2],n[2],o[2],r)}))).apply(this,arguments)}function N(e,t){const o=C(t,c.ONES,[e.width,void 0,e.height]);e.width=M(t[0],e.width,1,o),e.height=M(t[2],e.height,1,o)}function C(e,t,o){for(let n=0;n<3;n++){const r=e[n];switch(r){case"symbol-value":{const e=o[n];return null!=e?e/t[n]:1}case"proportional":break;default:if(r&&t[n])return r/t[n]}}return 1}function F(e){return U.apply(this,arguments)}function U(){return(U=o._asyncToGenerator((function*(t){const o=yield new Promise(((t,o)=>e(["./symbolLayerUtils"],t,o))),n=yield o.computeObjectLayerResourceSize(t,10),{width:r,height:l,depth:i}=t,s=[r,i,l];let u=1;for(let e=0;e<3;e++){const t=s[e];if(null!=t){u=t/n[e];break}}for(let e=0;e<3;e++)null==s[e]&&(s[e]=n[e]*u);return{resourceSize:n,symbolSize:s}}))).apply(this,arguments)}function M(e,t,o,n){switch(e){case"proportional":return o*n;case"symbol-value":return null!=t?t:o;default:return e}}function H(e,t){const o=O(t);if(!s.isNone(o))switch(e.type){case"simple-marker":e.size=o;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=o,e.height=o*t):(e.width=o*t,e.height=o);break}case"simple-line":e.width=o;break;case"text":e.font.size=o}}function I(e,t){return P.apply(this,arguments)}function P(){return(P=o._asyncToGenerator((function*(e,t){if(e&&t)return r.isSymbol3D(e)?z(e,t):void(r.isSymbol2D(e)&&H(e,t))}))).apply(this,arguments)}function R(e,t,o){if(e&&null!=t)if(r.isSymbol3D(e)){const n=e.symbolLayers;n&&n.forEach((e=>{if(e&&"object"===e.type)switch(o){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else r.isSymbol2D(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}function J(e){if(!e)return null;const t=e.effects.filter((e=>"bloom"!==e.type)).map((e=>e.toJSON()));return a.effectFunctionsFromJSON(t)}function q(e){return s.isSome(e)&&"polygon-3d"===e.type&&e.symbolLayers.some((e=>"extrude"===e.type))}function A(e,t){return B.apply(this,arguments)}function B(){return(B=o._asyncToGenerator((function*(e,t){const o=yield e.fetchSymbol(t);return o||e.fetchCIMSymbol(t)}))).apply(this,arguments)}t.applyColorToSymbol=T,t.applyOpacityToColor=g,t.applyRotationToSymbol=R,t.applySizesToSymbol=I,t.fetchWebStyleSymbol=A,t.getCSSFilterFromEffectList=J,t.getColorFromSymbol=d,t.getIconHref=S,t.getSymbolOutlineSize=b,t.isVolumetricSymbol=h,t.symbolHasExtrudeSymbolLayer=q,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
