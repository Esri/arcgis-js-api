/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../symbols","../../core/asyncUtils","../../core/has","../../core/maybe","../../core/screenUtils","../../chunks/vec3f64","./gfxUtils","./Symbol3DMaterial"],(function(e,t,o,n,r,i,l,s,u,c,a,y){"use strict";const f=/\/resource\/(.*?)\.svg$/,p=new n("white");function m(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const o=e.symbolLayers.getItemAt(t-1);return"outline"in o?s.get(o,"outline","size"):void 0}function h(e){if(!e)return 0;if(r.isSymbol3D(e)){const t=m(e);return s.isSome(t)?t:0}const t=a.getStroke(e);return t&&u.px2pt(t.width)||0}function b(e){if(s.isNone(e)||!("symbolLayers"in e)||s.isNone(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function d(e,t){const o=t.resource.href;return!l("esri-canvas-svg-support")&&e.styleOrigin&&f.test(o)?o.replace(f,"/resource/png/$1.png"):o}function S(e,t){if(!e)return null;let o=null;return r.isSymbol3D(e)?o=w(e):r.isSymbol2D(e)&&(o=e.color?new n(e.color):null),o?g(o,t):null}function w(e){const t=e.symbolLayers;if(!t)return null;let o=null;return t.forEach((e=>{"object"===e.type&&null!=e.resource.href||(o="water"===e.type?s.unwrap(e.color):s.isSome(e.material)?s.unwrap(e.material.color):null)})),o?new n(o):null}function g(e,t){if(null==t)return e;const o=e.toRgba();return o[3]=o[3]*t,new n(o)}function k(e,t,o){const n=e.symbolLayers;if(!n)return;const r=e=>{const n=s.isSome(e)?e:null;return g(t=t||n||null!=o&&p,o)};n.forEach((e=>{if("object"!==e.type||null==e.resource.href||t)if("water"===e.type)e.color=r(e.color);else{const t=s.isSome(e.material)?e.material.color:null,n=r(t);s.isNone(e.material)?e.material=new y.default({color:n}):e.material.color=n,null!=o&&"outline"in e&&s.isSome(e.outline)&&s.isSome(e.outline.color)&&(e.outline.color=g(e.outline.color,o))}}))}function L(e,t,o){(t=t||e.color)&&(e.color=g(t,o)),null!=o&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=g(e.outline.color,o))}function z(e,t,o){e&&(t||null!=o)&&(t&&(t=new n(t)),r.isSymbol3D(e)?k(e,t,o):r.isSymbol2D(e)&&L(e,t,o))}function v(e,t){return D.apply(this,arguments)}function D(){return(D=o._asyncToGenerator((function*(e,t){const n=e.symbolLayers;n&&(yield i.forEach(n,function(){var e=o._asyncToGenerator((function*(e){return T(e,t)}));return function(t){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function T(e,t){return _.apply(this,arguments)}function _(){return(_=o._asyncToGenerator((function*(e,t){switch(e.type){case"extrude":G(e,t);break;case"icon":case"line":case"text":j(e,t);break;case"path":N(e,t);break;case"object":yield O(e,t)}}))).apply(this,arguments)}function j(e,t){const o=x(t);s.isSome(o)&&(e.size=o)}function x(e){for(const t of e)if("number"==typeof t)return t;return null}function G(e,t){e.size="number"==typeof t[2]?t[2]:0}function O(e,t){return E.apply(this,arguments)}function E(){return(E=o._asyncToGenerator((function*(e,t){const{resourceSize:o,symbolSize:n}=yield U(e),r=C(t,o,n);e.width=R(t[0],n[0],o[0],r),e.depth=R(t[1],n[1],o[1],r),e.height=R(t[2],n[2],o[2],r)}))).apply(this,arguments)}function N(e,t){const o=C(t,c.ONES,[e.width,void 0,e.height]);e.width=R(t[0],e.width,1,o),e.height=R(t[2],e.height,1,o)}function C(e,t,o){for(let n=0;n<3;n++){const r=e[n];switch(r){case"symbol-value":return null!=o[n]?o[n]/t[n]:1;case"proportional":break;default:if(r&&t[n])return r/t[n]}}return 1}function U(e){return P.apply(this,arguments)}function P(){return(P=o._asyncToGenerator((function*(t){const o=yield new Promise((function(t,o){e(["./symbolLayerUtils"],t,o)})),n=yield o.computeObjectLayerResourceSize(t,10),{width:r,height:i,depth:l}=t,s=[r,l,i];let u=1;for(let e=0;e<3;e++)if(null!=s[e]){u=s[e]/n[e];break}for(let e=0;e<3;e++)null==s[e]&&(s[e]=n[e]*u);return{resourceSize:n,symbolSize:s}}))).apply(this,arguments)}function R(e,t,o,n){switch(e){case"proportional":return o*n;case"symbol-value":return null!=t?t:o;default:return e}}function H(e,t){const o=x(t);if(!s.isNone(o))switch(e.type){case"simple-marker":e.size=o;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=o,e.height=o*t):(e.width=o*t,e.height=o);break}case"simple-line":e.width=o;break;case"text":e.font.size=o}}function I(e,t){return M.apply(this,arguments)}function M(){return(M=o._asyncToGenerator((function*(e,t){if(e&&t)return r.isSymbol3D(e)?v(e,t):void(r.isSymbol2D(e)&&H(e,t))}))).apply(this,arguments)}function $(e,t,o){if(e&&null!=t)if(r.isSymbol3D(e)){const n=e.symbolLayers;n&&n.forEach((e=>{if(e&&"object"===e.type)switch(o){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else r.isSymbol2D(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}t.applyColorToSymbol=z,t.applyOpacityToColor=g,t.applyRotationToSymbol=$,t.applySizesToSymbol=I,t.getColorFromSymbol=S,t.getIconHref=d,t.getSymbolOutlineSize=h,t.isVolumetricSymbol=b,Object.defineProperty(t,"__esModule",{value:!0})}));
