/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["require","exports","../../core/has","../../core/maybe","../../Color","../../core/screenUtils","./Symbol3DMaterial","../../chunks/symbols","../../core/asyncUtils","../../chunks/vec3f64","./gfxUtils"],(function(e,t,o,n,r,i,s,l,c,a,u){"use strict";const y=/\/resource\/(.*?)\.svg$/,f=new r("white");function m(e,t){if(null==t)return e;const o=e.toRgba();return o[3]=o[3]*t,new r(o)}async function b(t,o){const r=t.symbolLayers;r&&await c.forEach(r,(async t=>async function(t,o){switch(t.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(t,o);break;case"icon":case"line":case"text":!function(e,t){const o=p(t);n.isSome(o)&&(e.size=o)}(t,o);break;case"path":!function(e,t){const o=h(t,a.ONES,[e.width,void 0,e.height]);e.width=d(t[0],e.width,1,o),e.height=d(t[2],e.height,1,o)}(t,o);break;case"object":await async function(t,o){const{resourceSize:n,symbolSize:r}=await async function(t){const o=await new Promise((function(t,o){e(["./symbolLayerUtils"],t,o)})),n=await o.computeObjectLayerResourceSize(t,10),{width:r,height:i,depth:s}=t,l=[r,s,i];let c=1;for(let e=0;e<3;e++)if(null!=l[e]){c=l[e]/n[e];break}for(let e=0;e<3;e++)null==l[e]&&(l[e]=n[e]*c);return{resourceSize:n,symbolSize:l}}(t),i=h(o,n,r);t.width=d(o[0],r[0],n[0],i),t.depth=d(o[1],r[1],n[1],i),t.height=d(o[2],r[2],n[2],i)}(t,o)}}(t,o)))}function p(e){for(const t of e)if("number"==typeof t)return t;return null}function h(e,t,o){for(let n=0;n<3;n++){const r=e[n];switch(r){case"symbol-value":return null!=o[n]?o[n]/t[n]:1;case"proportional":break;default:if(r&&t[n])return r/t[n]}}return 1}function d(e,t,o,n){switch(e){case"proportional":return o*n;case"symbol-value":return null!=t?t:o;default:return e}}t.applyColorToSymbol=function(e,t,o){e&&(t||null!=o)&&(t&&(t=new r(t)),l.isSymbol3D(e)?function(e,t,o){const r=e.symbolLayers;if(!r)return;const i=e=>{const r=n.isSome(e)?e:null;return m(t=t||r||null!=o&&f,o)};r.forEach((e=>{if("object"!==e.type||null==e.resource.href||t)if("water"===e.type)e.color=i(e.color);else{const t=n.isSome(e.material)?e.material.color:null,r=i(t);n.isNone(e.material)?e.material=new s.default({color:r}):e.material.color=r,null!=o&&"outline"in e&&n.isSome(e.outline)&&n.isSome(e.outline.color)&&(e.outline.color=m(e.outline.color,o))}}))}(e,t,o):l.isSymbol2D(e)&&function(e,t,o){(t=t||e.color)&&(e.color=m(t,o)),null!=o&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=m(e.outline.color,o))}(e,t,o))},t.applyOpacityToColor=m,t.applyRotationToSymbol=function(e,t,o){if(e&&null!=t)if(l.isSymbol3D(e)){const n=e.symbolLayers;n&&n.forEach((e=>{if(e&&"object"===e.type)switch(o){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else l.isSymbol2D(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))},t.applySizesToSymbol=async function(e,t){if(e&&t)return l.isSymbol3D(e)?b(e,t):void(l.isSymbol2D(e)&&function(e,t){const o=p(t);if(!n.isNone(o))switch(e.type){case"simple-marker":e.size=o;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=o,e.height=o*t):(e.width=o*t,e.height=o);break}case"simple-line":e.width=o;break;case"text":e.font.size=o}}(e,t))},t.getIconHref=function(e,t){const n=t.resource.href;return!o("esri-canvas-svg-support")&&e.styleOrigin&&y.test(n)?n.replace(y,"/resource/png/$1.png"):n},t.getSymbolOutlineSize=function(e){if(!e)return 0;if(l.isSymbol3D(e)){const t=function(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const o=e.symbolLayers.getItemAt(t-1);return"outline"in o?n.get(o,"outline","size"):void 0}(e);return n.isSome(t)?t:0}const t=u.getStroke(e);return t&&i.px2pt(t.width)||0},t.isVolumetricSymbol=function(e){if(!e||!e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}},Object.defineProperty(t,"__esModule",{value:!0})}));
