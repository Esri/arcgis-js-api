/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/maybe","../../support/arcadeOnDemand","./utils"],(function(e,l,t,o,i,r,n){"use strict";let s=null;function a(e,l){return Math.floor(Math.random()*(l-e+1)+e)}function c(e,l,t){const{backgroundColor:o,outline:i,dotSize:r}=e,n=t&&t.swatchSize||22,c=.8,u=Math.round(n*n/r**2*c),y=window.devicePixelRatio,p=document.createElement("canvas"),d=n*y;p.width=d,p.height=d,p.style.width=p.width/y+"px",p.style.height=p.height/y+"px";const b=p.getContext("2d");if(o&&(b.fillStyle=o.toCss(!0),b.fillRect(0,0,d,d),b.fill()),b.fillStyle=l.toCss(!0),s&&s.length/2===u)for(let a=0;a<2*u;a+=2){const e=s[a],l=s[a+1];b.fillRect(e,l,r*y,r*y),b.fill()}else{s=[];for(let e=0;e<2*u;e+=2){const e=a(0,d),l=a(0,d);s.push(e,l),b.fillRect(e,l,r*y,r*y),b.fill()}}i&&(i.color&&(b.strokeStyle=i.color.toCss(!0)),b.lineWidth=i.width,b.strokeRect(0,0,d,d));const h=new Image(n,n);return h.src=p.toDataURL(),h}function u(e,l={}){const t=24,o=75,i="horizontal"===l.align,r=i?o:t,n=i?t:o,{width:s=r,height:a=n,gradient:c=!0}=l,u=window.devicePixelRatio,y=s*u,p=a*u,d=document.createElement("canvas");d.width=y,d.height=p,d.style.width=`${s}px`,d.style.height=`${a}px`;const b=d.getContext("2d"),h=i?y:0,m=i?0:p;if(c){const l=b.createLinearGradient(0,0,h,m),t=e.length,o=1===t?0:1/(t-1);e.forEach(((e,t)=>l.addColorStop(t*o,e.toString()))),b.fillStyle=l,b.fillRect(0,0,y,p)}else{const l=i?y/e.length:y,t=i?p:p/e.length;let o=0,r=0;for(const n of e)b.fillStyle=n.toString(),b.fillRect(o,r,l,t),o=i?o+l:0,r=i?0:r+t}const f=document.createElement("div");return f.style.width=`${s}px`,f.style.height=`${a}px`,f.appendChild(d),f}function y(e,l){return p.apply(this,arguments)}function p(){return(p=t._asyncToGenerator((function*(l,t){switch(l.type){case"web-style":{const{previewWebStyleSymbol:o}=yield new Promise((function(l,t){e(["./previewWebStyleSymbol"],l,t)}));return o(l,y,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:o}=yield new Promise((function(l,t){e(["./previewSymbol3D"],l,t)}));return o(l,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:o}=yield new Promise((function(l,t){e(["./previewSymbol2D"],l,t)}));return o(l,t)}case"cim":{const{previewCIMSymbol:o}=yield new Promise((function(l,t){e(["./previewCIMSymbol"],l,t)}));return o(l,t)}default:return}}))).apply(this,arguments)}function d(e){return e&&"opacity"in e?e.opacity*d(e.parent):1}function b(e,l){return h.apply(this,arguments)}function h(){return(h=t._asyncToGenerator((function*(l,t){var o,s;if(!l)return;const a=l.sourceLayer,c=null!=(o=i.isSome(t)&&null!=(s=t.useSourceLayer)&&s?a:l.layer)?o:a,u=d(c);if(i.isSome(l.symbol)&&(!i.isSome(t)||!0!==t.ignoreGraphicSymbol)){const e="web-style"===l.symbol.type?yield l.symbol.fetchSymbol(i.isSome(t)?t.abortOptions:null):l.symbol.clone();return n.applyColorToSymbol(e,null,u),e}const y=i.isSome(t)&&t.renderer||c&&"renderer"in c&&c.renderer;let p=y&&"getSymbolAsync"in y?yield y.getSymbolAsync(l,t):null;if(!p)return;if(p="web-style"===p.type?yield p.fetchSymbol(i.isSome(t)?t.abortOptions:null):p.clone(),!("visualVariables"in y)||!y.visualVariables||!y.visualVariables.length)return n.applyColorToSymbol(p,null,u),p;if("arcadeRequiredForVisualVariables"in y&&y.arcadeRequiredForVisualVariables&&(i.isNone(t)||i.isNone(t.arcade))){const e={...i.unwrap(t)};e.arcade=yield r.loadArcade(),t=e}const b=yield new Promise((function(l,t){e(["../../renderers/visualVariables/support/visualVariableUtils"],l,t)})),h=[],m=[],f=[],g=[];for(const e of y.visualVariables)switch(e.type){case"color":h.push(e);break;case"opacity":m.push(e);break;case"rotation":g.push(e);break;case"size":e.target||f.push(e)}const S=!!h.length&&h[h.length-1],w=S?b.getColor(S,l,t):null,v=!!m.length&&m[m.length-1];let C=v?b.getOpacity(v,l,t):null;if(null!=u&&(C=null!=C?C*u:u),n.applyColorToSymbol(p,w,C),f.length){const e=b.getAllSizes(f,l,t);yield n.applySizesToSymbol(p,e)}for(const e of g)n.applyRotationToSymbol(p,b.getRotationAngle(e,l,t),e.axis);return p}))).apply(this,arguments)}function m(e,l){return f.apply(this,arguments)}function f(){return(f=t._asyncToGenerator((function*(l,t){var o;if(!l)return;const s=d(l.layer||l.sourceLayer);if(i.isSome(l.symbol)&&(!i.isSome(t)||!0!==t.ignoreGraphicSymbol)){const e="web-style"===l.symbol.type?yield l.symbol.fetchSymbol(i.isSome(t)?t.abortOptions:null):l.symbol.clone();return n.getColorFromSymbol(e,s)}const a=i.isSome(t)&&t.renderer||l.get("layer.renderer")||l.get("sourceLayer.renderer");let c=yield a.getSymbolAsync(l,t);if(!c)return;c="web-style"===c.type?yield c.fetchSymbol(i.isSome(t)?t.abortOptions:null):c.clone();const u=n.getColorFromSymbol(c,s);if(!("visualVariables"in a)||"visualVariables"in a&&!a.visualVariables||"visualVariables"in a&&(null==(o=a.visualVariables)||!o.length))return u;if(a.arcadeRequiredForVisualVariables&&(i.isNone(t)||i.isNone(t.arcade))){const e={...i.unwrap(t)};e.arcade=yield r.loadArcade(),t=e}const y=yield new Promise((function(l,t){e(["../../renderers/visualVariables/support/visualVariableUtils"],l,t)})),p=[],b=[];for(const e of a.visualVariables)switch(e.type){case"color":p.push(e);break;case"opacity":b.push(e)}const h=p.length>0?p[p.length-1]:null,m=h?y.getColor(h,l,t):u,f=b.length>0?b[b.length-1]:null;let g=f?y.getOpacity(f,l,t):null;return null!=s&&(g=null!=g?g*s:s),m?n.applyOpacityToColor(m,g):null}))).apply(this,arguments)}l.getDisplayedColor=m,l.getDisplayedSymbol=b,l.renderColorRampPreviewHTML=u,l.renderDotDensityPreviewHTML=c,l.renderPreviewHTML=y,Object.defineProperty(l,"__esModule",{value:!0})}));
