/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/maybe","../../support/arcadeOnDemand","./previewUtils","./utils"],(function(e,l,t,o,i,r,n,s){"use strict";let a=null;function c(e,l){return Math.floor(Math.random()*(l-e+1)+e)}function u(e,l,t){const{backgroundColor:o,outline:i,dotSize:r}=e,s=t&&t.swatchSize||n.SymbolSizeDefaults.size,u=.8,y=Math.round(s*s/r**2*u),p=window.devicePixelRatio,d=document.createElement("canvas"),f=s*p;d.width=f,d.height=f,d.style.width=d.width/p+"px",d.style.height=d.height/p+"px";const m=d.getContext("2d");if(o&&(m.fillStyle=o.toCss(!0),m.fillRect(0,0,f,f),m.fill()),m.fillStyle=l.toCss(!0),a&&a.length/2===y)for(let n=0;n<2*y;n+=2){const e=a[n],l=a[n+1];m.fillRect(e,l,r*p,r*p),m.fill()}else{a=[];for(let e=0;e<2*y;e+=2){const e=c(0,f),l=c(0,f);a.push(e,l),m.fillRect(e,l,r*p,r*p),m.fill()}}i&&(i.color&&(m.strokeStyle=i.color.toCss(!0)),m.lineWidth=i.width,m.strokeRect(0,0,f,f));const b=new Image(s,s);return b.src=d.toDataURL(),b}function y(e,l={}){const t=24,o=75,i="horizontal"===l.align,r=i?o:t,n=i?t:o,{width:s=r,height:a=n,gradient:c=!0}=l,u=window.devicePixelRatio,y=s*u,d=a*u,f=document.createElement("canvas");f.width=y,f.height=d,f.style.width=`${s}px`,f.style.height=`${a}px`;const m=f.getContext("2d"),b=i?y:0,h=i?0:d;if(c){const l=m.createLinearGradient(0,0,b,h),t=e.length,o=1===t?0:1/(t-1);e.forEach(((e,t)=>l.addColorStop(t*o,e.toString()))),m.fillStyle=l,m.fillRect(0,0,y,d)}else{const l=i?y/e.length:y,t=i?d:d/e.length;let o=0,r=0;for(const n of e)m.fillStyle=n.toString(),m.fillRect(o,r,l,t),o=i?o+l:0,r=i?0:r+t}const g=document.createElement("div");return g.style.width=`${s}px`,g.style.height=`${a}px`,p(g,null==l?void 0:l.effectList),g.appendChild(f),g}function p(e,l){if(!l)return;e.style.filter=s.getCSSFilterFromEffectList(l);const t=l.effects;if(t)for(const o of t)if("drop-shadow"===(null==o?void 0:o.type)){o.offsetX<0?e.style.marginLeft=`${Math.abs(o.offsetX)}px`:e.style.marginRight=`${o.offsetX}px`;break}}function d(e,l){return f.apply(this,arguments)}function f(){return(f=t._asyncToGenerator((function*(l,t){switch(l.type){case"web-style":{const{previewWebStyleSymbol:o}=yield new Promise(((l,t)=>e(["./previewWebStyleSymbol"],l,t)));return o(l,d,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:o}=yield new Promise(((l,t)=>e(["./previewSymbol3D"],l,t)));return o(l,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:o}=yield new Promise(((l,t)=>e(["./previewSymbol2D"],l,t)));return o(l,t)}case"cim":{const{previewCIMSymbol:o}=yield new Promise(((l,t)=>e(["./previewCIMSymbol"],l,t)));return o(l,t)}default:return}}))).apply(this,arguments)}function m(e){return e&&"opacity"in e?e.opacity*m(e.parent):1}function b(e,l){return h.apply(this,arguments)}function h(){return(h=t._asyncToGenerator((function*(l,t){var o,n;if(!l)return;const a=l.sourceLayer,c=null!=(o=i.isSome(t)&&null!=(n=t.useSourceLayer)&&n?a:l.layer)?o:a,u=m(c);if(i.isSome(l.symbol)&&(!i.isSome(t)||!0!==t.ignoreGraphicSymbol)){const e="web-style"===l.symbol.type?yield l.symbol.fetchSymbol(i.isSome(t)?t.abortOptions:null):l.symbol.clone();return s.applyColorToSymbol(e,null,u),e}const y=i.isSome(t)&&t.renderer||c&&"renderer"in c&&c.renderer;let p=y&&"getSymbolAsync"in y?yield y.getSymbolAsync(l,t):null;if(!p)return;if(p="web-style"===p.type?yield p.fetchSymbol(i.isSome(t)?t.abortOptions:null):p.clone(),!("visualVariables"in y)||!y.visualVariables||!y.visualVariables.length)return s.applyColorToSymbol(p,null,u),p;if("arcadeRequiredForVisualVariables"in y&&y.arcadeRequiredForVisualVariables&&(i.isNone(t)||i.isNone(t.arcade))){const e={...i.unwrap(t)};e.arcade=yield r.loadArcade(),t=e}const d=yield new Promise(((l,t)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],l,t))),f=[],b=[],h=[],g=[];for(const e of y.visualVariables)switch(e.type){case"color":f.push(e);break;case"opacity":b.push(e);break;case"rotation":g.push(e);break;case"size":e.target||h.push(e)}const S=!!f.length&&f[f.length-1],w=S?d.getColor(S,l,t):null,v=!!b.length&&b[b.length-1];let C=v?d.getOpacity(v,l,t):null;if(null!=u&&(C=null!=C?C*u:u),s.applyColorToSymbol(p,w,C),h.length){const e=d.getAllSizes(h,l,t);yield s.applySizesToSymbol(p,e)}for(const e of g)s.applyRotationToSymbol(p,d.getRotationAngle(e,l,t),e.axis);return p}))).apply(this,arguments)}function g(e,l){return S.apply(this,arguments)}function S(){return(S=t._asyncToGenerator((function*(l,t){var o;if(!l)return;const n=m(l.layer||l.sourceLayer);if(i.isSome(l.symbol)&&(!i.isSome(t)||!0!==t.ignoreGraphicSymbol)){const e="web-style"===l.symbol.type?yield l.symbol.fetchSymbol(i.isSome(t)?t.abortOptions:null):l.symbol.clone();return s.getColorFromSymbol(e,n)}const a=i.isSome(t)&&t.renderer||l.get("layer.renderer")||l.get("sourceLayer.renderer");let c=yield a.getSymbolAsync(l,t);if(!c)return;c="web-style"===c.type?yield c.fetchSymbol(i.isSome(t)?t.abortOptions:null):c.clone();const u=s.getColorFromSymbol(c,n);if(!("visualVariables"in a)||"visualVariables"in a&&!a.visualVariables||"visualVariables"in a&&(null==(o=a.visualVariables)||!o.length))return u;if(a.arcadeRequiredForVisualVariables&&(i.isNone(t)||i.isNone(t.arcade))){const e={...i.unwrap(t)};e.arcade=yield r.loadArcade(),t=e}const y=yield new Promise(((l,t)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],l,t))),p=[],d=[];for(const e of a.visualVariables)switch(e.type){case"color":p.push(e);break;case"opacity":d.push(e)}const f=p.length>0?p[p.length-1]:null,b=f?y.getColor(f,l,t):u,h=d.length>0?d[d.length-1]:null;let g=h?y.getOpacity(h,l,t):null;return null!=n&&(g=null!=g?g*n:n),b?s.applyOpacityToColor(b,g):null}))).apply(this,arguments)}l.getDisplayedColor=g,l.getDisplayedSymbol=b,l.renderColorRampPreviewHTML=y,l.renderDotDensityPreviewHTML=u,l.renderPreviewHTML=d,Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
