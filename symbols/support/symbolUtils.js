/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/maybe","../../support/arcadeOnDemand","./gfxUtils","./previewUtils","./renderUtils","./utils","../../widgets/Legend/styles/support/relationshipUtils","../../widgets/Legend/support/relationshipRampUtils"],(function(e,t,l,r,o,i,n,s,a,c,u,y){"use strict";let p=null;const f=[255,255,255];function d(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function h(e,t,l){const{backgroundColor:r,outline:o,dotSize:i}=e,n=l&&l.swatchSize||s.SymbolSizeDefaults.size,a=.8,c=Math.round(n*n/i**2*a),u=window.devicePixelRatio,y=document.createElement("canvas"),f=n*u;y.width=f,y.height=f,y.style.width=y.width/u+"px",y.style.height=y.height/u+"px";const h=y.getContext("2d");if(r&&(h.fillStyle=r.toCss(!0),h.fillRect(0,0,f,f),h.fill()),h.fillStyle=t.toCss(!0),p&&p.length/2===c)for(let s=0;s<2*c;s+=2){const e=p[s],t=p[s+1];h.fillRect(e,t,i*u,i*u),h.fill()}else{p=[];for(let e=0;e<2*c;e+=2){const e=d(0,f),t=d(0,f);p.push(e,t),h.fillRect(e,t,i*u,i*u),h.fill()}}o&&(o.color&&(h.strokeStyle=o.color.toCss(!0)),h.lineWidth=o.width,h.strokeRect(0,0,f,f));const m=new Image(n,n);return m.src=y.toDataURL(),m}function m(e,t={}){const l=t.radius||40,r=2*Math.PI*l,o=e.length,i=r/o,s=[],c=n.getStroke(t.outline);null!=c?.width&&(c.width*=2),(c||t.backgroundColor)&&s.push({shape:{type:"circle",cx:l,cy:l,r:l},fill:t.backgroundColor,stroke:c,offset:[0,0]});const u=t.values,y=u&&u.length===o&&100===u.reduce(((e,t)=>e+t),0),p=[0];for(let n=0;n<o;n++){let t=null;y&&(t=u[n]*r/100,p.push(t+p[n])),s.push({shape:{type:"circle",cx:l,cy:l,r:l/2},fill:[0,0,0,0],stroke:{width:l,dashArray:`${(t??i)/2} ${r}`,dashoffset:"-"+(y?p[n]/2:n*(i/2)),color:e[n]},offset:[0,0]})}let d=null;const h=2*l+(c?.width||0),m=t.holePercentage;if(m){c&&s.push({shape:{type:"circle",cx:l,cy:l,r:l*m},fill:null,stroke:c,offset:[0,0]});const e=h/2;d=[[{shape:{type:"circle",cx:e,cy:e,r:e},fill:f,stroke:c?{...c,color:f}:null,offset:[0,0]},{shape:{type:"circle",cx:e,cy:e,r:l*m},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return a.renderSymbol([s],[h,h],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:d,rotation:-90})}function b(e,t={}){const l=e?.authoringInfo;if(!("relationship"===l?.type)||!l?.numClasses||!e.uniqueValueInfos)return null;const{focus:r,numClasses:o}=l,i=y.getRelationshipRampElement({focus:r,numClasses:o,infos:e.uniqueValueInfos}),n=t&&t.node||document.createElement("div"),s=()=>u.renderRelationshipRamp(i,t.id||"relationship",t.opacity||1,t.effectList);return a.renderOnce(n,s),n}function g(e,t={}){const l=24,r=75,o="horizontal"===t.align,i=o?r:l,n=o?l:r,{width:s=i,height:a=n,gradient:c=!0}=t,u=window.devicePixelRatio,y=s*u,p=a*u,f=document.createElement("canvas");f.width=y,f.height=p,f.style.width=`${s}px`,f.style.height=`${a}px`;const d=f.getContext("2d"),h=o?y:0,m=o?0:p;if(c){const t=d.createLinearGradient(0,0,h,m),l=e.length,r=1===l?0:1/(l-1);e.forEach(((e,l)=>t.addColorStop(l*r,e.toString()))),d.fillStyle=t,d.fillRect(0,0,y,p)}else{const t=o?y/e.length:y,l=o?p:p/e.length;let r=0,i=0;for(const n of e)d.fillStyle=n.toString(),d.fillRect(r,i,t,l),r=o?r+t:0,i=o?0:i+l}const b=document.createElement("div");return b.style.width=`${s}px`,b.style.height=`${a}px`,S(b,t?.effectList),b.appendChild(f),b}function S(e,t){if(!t)return;e.style.filter=c.getCSSFilterFromEffectList(t);const l=t.effects;if(l)for(const r of l)if("drop-shadow"===r?.type){r.offsetX<0?e.style.marginLeft=`${Math.abs(r.offsetX)}px`:e.style.marginRight=`${r.offsetX}px`;break}}function w(e,t){return v.apply(this,arguments)}function v(){return(v=l._asyncToGenerator((function*(t,l){switch(t.type){case"web-style":{const{previewWebStyleSymbol:r}=yield new Promise(((t,l)=>e(["./previewWebStyleSymbol"],t,l)));return r(t,w,l)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:r}=yield new Promise(((t,l)=>e(["./previewSymbol3D"],t,l)));return r(t,l)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:r}=yield new Promise(((t,l)=>e(["./previewSymbol2D"],t,l)));return r(t,l)}case"cim":{const{previewCIMSymbol:r}=yield new Promise(((t,l)=>e(["./previewCIMSymbol"],t,l)));return r(t,l)}default:return}}))).apply(this,arguments)}function C(e){return e&&"opacity"in e?e.opacity*C(e.parent):1}function R(e,t){return V.apply(this,arguments)}function V(){return(V=l._asyncToGenerator((function*(t,l){if(!t)return;const r=t.sourceLayer,n=(o.isSome(l)&&l.useSourceLayer?r:t.layer)??r,s=C(n);if(o.isSome(t.symbol)&&(!o.isSome(l)||!0!==l.ignoreGraphicSymbol)){const e="web-style"===t.symbol.type?yield c.fetchWebStyleSymbol(t.symbol,{...l,cache:o.isSome(l)?l.webStyleCache:null}):t.symbol.clone();return c.applyColorToSymbol(e,null,s),e}const a=(o.isSome(l)?l.renderer:null)??(n&&"renderer"in n?n.renderer:null);let u=a&&"getSymbolAsync"in a?yield a.getSymbolAsync(t,l):null;if(!u)return;if(u="web-style"===u.type?yield u.fetchSymbol({...l,cache:o.isSome(l)?l.webStyleCache:null}):u.clone(),!(a&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.length))return c.applyColorToSymbol(u,null,s),u;if("arcadeRequiredForVisualVariables"in a&&a.arcadeRequiredForVisualVariables&&(o.isNone(l)||o.isNone(l.arcade))){const e={...o.unwrap(l)};e.arcade=yield i.loadArcade(),l=e}const y=yield new Promise(((t,l)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],t,l))),p=[],f=[],d=[],h=[];for(const e of a.visualVariables)switch(e.type){case"color":p.push(e);break;case"opacity":f.push(e);break;case"rotation":h.push(e);break;case"size":e.target||d.push(e)}const m=!!p.length&&p[p.length-1],b=m?y.getColor(m,t,l):null,g=!!f.length&&f[f.length-1];let S=g?y.getOpacity(g,t,l):null;if(null!=s&&(S=null!=S?S*s:s),c.applyColorToSymbol(u,b,S),d.length){const e=y.getAllSizes(d,t,l);yield c.applySizesToSymbol(u,e)}for(const e of h)c.applyRotationToSymbol(u,y.getRotationAngle(e,t,l),e.axis);return u}))).apply(this,arguments)}function k(e,t){return x.apply(this,arguments)}function x(){return(x=l._asyncToGenerator((function*(t,l){if(!t)return;const r=C(t.layer||t.sourceLayer);if(o.isSome(t.symbol)&&(!o.isSome(l)||!0!==l.ignoreGraphicSymbol)){const e="web-style"===t.symbol.type?yield c.fetchWebStyleSymbol(t.symbol,l):t.symbol.clone();return c.getColorFromSymbol(e,r)}const n=o.isSome(l)&&l.renderer||t.get("layer.renderer")||t.get("sourceLayer.renderer");let s=yield n.getSymbolAsync(t,l);if(!s)return;s="web-style"===s.type?yield c.fetchWebStyleSymbol(s,l):s.clone();const a=c.getColorFromSymbol(s,r);if(!("visualVariables"in n)||"visualVariables"in n&&!n.visualVariables||"visualVariables"in n&&!n.visualVariables?.length)return a;if(n.arcadeRequiredForVisualVariables&&(o.isNone(l)||o.isNone(l.arcade))){const e={...o.unwrap(l)};e.arcade=yield i.loadArcade(),l=e}const u=yield new Promise(((t,l)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],t,l))),y=[],p=[];for(const e of n.visualVariables)switch(e.type){case"color":y.push(e);break;case"opacity":p.push(e)}const f=y.length>0?y[y.length-1]:null,d=f?u.getColor(f,t,l):a,h=p.length>0?p[p.length-1]:null;let m=h?u.getOpacity(h,t,l):null;return null!=r&&(m=null!=m?m*r:r),d?c.applyOpacityToColor(d,m):null}))).apply(this,arguments)}t.getDisplayedColor=k,t.getDisplayedSymbol=R,t.renderColorRampPreviewHTML=g,t.renderDotDensityPreviewHTML=h,t.renderPieChartPreviewHTML=m,t.renderPreviewHTML=w,t.renderRelationshipRampPreviewHTML=b,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
