/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/maybe","../../support/arcadeOnDemand","./utils"],(function(e,l,t,o,r,i,n){"use strict";let s=null;function a(e,l){return Math.floor(Math.random()*(l-e+1)+e)}function c(e,l,t){const{backgroundColor:o,outline:r,dotSize:i}=e,n=t&&t.swatchSize||22,c=.8,u=Math.round(n*n/i**2*c),y=window.devicePixelRatio,p=document.createElement("canvas"),d=n*y;p.width=d,p.height=d,p.style.width=p.width/y+"px",p.style.height=p.height/y+"px";const m=p.getContext("2d");if(o&&(m.fillStyle=o.toCss(!0),m.fillRect(0,0,d,d),m.fill()),m.fillStyle=l.toCss(!0),s&&s.length/2===u)for(let a=0;a<2*u;a+=2){const e=s[a],l=s[a+1];m.fillRect(e,l,i*y,i*y),m.fill()}else{s=[];for(let e=0;e<2*u;e+=2){const e=a(0,d),l=a(0,d);s.push(e,l),m.fillRect(e,l,i*y,i*y),m.fill()}}r&&(r.color&&(m.strokeStyle=r.color.toCss(!0)),m.lineWidth=r.width,m.strokeRect(0,0,d,d));const b=new Image(n,n);return b.src=p.toDataURL(),b}function u(e,l={}){const t=24,o=75,r="horizontal"===l.align,i=r?o:t,s=r?t:o,{width:a=i,height:c=s,gradient:u=!0}=l,y=window.devicePixelRatio,p=a*y,d=c*y,m=document.createElement("canvas");m.width=p,m.height=d,m.style.width=`${a}px`,m.style.height=`${c}px`;const b=m.getContext("2d"),h=r?p:0,f=r?0:d;if(u){const l=b.createLinearGradient(0,0,h,f),t=e.length,o=1===t?0:1/(t-1);e.forEach(((e,t)=>l.addColorStop(t*o,e.toString()))),b.fillStyle=l,b.fillRect(0,0,p,d)}else{const l=r?p/e.length:p,t=r?d:d/e.length;let o=0,i=0;for(const n of e)b.fillStyle=n.toString(),b.fillRect(o,i,l,t),o=r?o+l:0,i=r?0:i+t}const S=document.createElement("div");return S.style.width=`${a}px`,S.style.height=`${c}px`,S.style.filter=n.getCSSFilterFromEffectList(null==l?void 0:l.effectList),S.appendChild(m),S}function y(e,l){return p.apply(this,arguments)}function p(){return(p=t._asyncToGenerator((function*(l,t){switch(l.type){case"web-style":{const{previewWebStyleSymbol:o}=yield new Promise(((l,t)=>e(["./previewWebStyleSymbol"],l,t)));return o(l,y,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:o}=yield new Promise(((l,t)=>e(["./previewSymbol3D"],l,t)));return o(l,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:o}=yield new Promise(((l,t)=>e(["./previewSymbol2D"],l,t)));return o(l,t)}case"cim":{const{previewCIMSymbol:o}=yield new Promise(((l,t)=>e(["./previewCIMSymbol"],l,t)));return o(l,t)}default:return}}))).apply(this,arguments)}function d(e){return e&&"opacity"in e?e.opacity*d(e.parent):1}function m(e,l){return b.apply(this,arguments)}function b(){return(b=t._asyncToGenerator((function*(l,t){var o,s;if(!l)return;const a=l.sourceLayer,c=null!=(o=r.isSome(t)&&null!=(s=t.useSourceLayer)&&s?a:l.layer)?o:a,u=d(c);if(r.isSome(l.symbol)&&(!r.isSome(t)||!0!==t.ignoreGraphicSymbol)){const e="web-style"===l.symbol.type?yield l.symbol.fetchSymbol(r.isSome(t)?t.abortOptions:null):l.symbol.clone();return n.applyColorToSymbol(e,null,u),e}const y=r.isSome(t)&&t.renderer||c&&"renderer"in c&&c.renderer;let p=y&&"getSymbolAsync"in y?yield y.getSymbolAsync(l,t):null;if(!p)return;if(p="web-style"===p.type?yield p.fetchSymbol(r.isSome(t)?t.abortOptions:null):p.clone(),!("visualVariables"in y)||!y.visualVariables||!y.visualVariables.length)return n.applyColorToSymbol(p,null,u),p;if("arcadeRequiredForVisualVariables"in y&&y.arcadeRequiredForVisualVariables&&(r.isNone(t)||r.isNone(t.arcade))){const e={...r.unwrap(t)};e.arcade=yield i.loadArcade(),t=e}const m=yield new Promise(((l,t)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],l,t))),b=[],h=[],f=[],S=[];for(const e of y.visualVariables)switch(e.type){case"color":b.push(e);break;case"opacity":h.push(e);break;case"rotation":S.push(e);break;case"size":e.target||f.push(e)}const g=!!b.length&&b[b.length-1],w=g?m.getColor(g,l,t):null,v=!!h.length&&h[h.length-1];let C=v?m.getOpacity(v,l,t):null;if(null!=u&&(C=null!=C?C*u:u),n.applyColorToSymbol(p,w,C),f.length){const e=m.getAllSizes(f,l,t);yield n.applySizesToSymbol(p,e)}for(const e of S)n.applyRotationToSymbol(p,m.getRotationAngle(e,l,t),e.axis);return p}))).apply(this,arguments)}function h(e,l){return f.apply(this,arguments)}function f(){return(f=t._asyncToGenerator((function*(l,t){var o;if(!l)return;const s=d(l.layer||l.sourceLayer);if(r.isSome(l.symbol)&&(!r.isSome(t)||!0!==t.ignoreGraphicSymbol)){const e="web-style"===l.symbol.type?yield l.symbol.fetchSymbol(r.isSome(t)?t.abortOptions:null):l.symbol.clone();return n.getColorFromSymbol(e,s)}const a=r.isSome(t)&&t.renderer||l.get("layer.renderer")||l.get("sourceLayer.renderer");let c=yield a.getSymbolAsync(l,t);if(!c)return;c="web-style"===c.type?yield c.fetchSymbol(r.isSome(t)?t.abortOptions:null):c.clone();const u=n.getColorFromSymbol(c,s);if(!("visualVariables"in a)||"visualVariables"in a&&!a.visualVariables||"visualVariables"in a&&(null==(o=a.visualVariables)||!o.length))return u;if(a.arcadeRequiredForVisualVariables&&(r.isNone(t)||r.isNone(t.arcade))){const e={...r.unwrap(t)};e.arcade=yield i.loadArcade(),t=e}const y=yield new Promise(((l,t)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],l,t))),p=[],m=[];for(const e of a.visualVariables)switch(e.type){case"color":p.push(e);break;case"opacity":m.push(e)}const b=p.length>0?p[p.length-1]:null,h=b?y.getColor(b,l,t):u,f=m.length>0?m[m.length-1]:null;let S=f?y.getOpacity(f,l,t):null;return null!=s&&(S=null!=S?S*s:s),h?n.applyOpacityToColor(h,S):null}))).apply(this,arguments)}l.getDisplayedColor=h,l.getDisplayedSymbol=m,l.renderColorRampPreviewHTML=u,l.renderDotDensityPreviewHTML=c,l.renderPreviewHTML=y,Object.defineProperty(l,"__esModule",{value:!0})}));
