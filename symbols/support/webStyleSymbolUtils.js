/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../symbols","../../core/devEnvironmentUtils","../../core/Error","../../core/urlUtils","../../portal/Portal","../../chunks/persistableUrlUtils","./jsonUtils","./StyleOrigin","./styleUtils","./Thumbnail"],(function(e,t,l,r,n,o,a,s,m,i,u){"use strict";function y(e,t,l,n){return e.name?e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?c(e,t,n):i.fetchStyle(e,t,n).then((r=>b(r,e.name,t,l,n))):Promise.reject(new r("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function b(e,y,b,c,f){const S=e.data,p={portal:b&&b.portal||o.getDefault(),url:n.urlToObject(e.baseUrl),origin:"portal-item"},d=S.items.find((e=>e.name===y));if(!d){const e=`The symbol name '${y}' could not be found`;return Promise.reject(new r("symbolstyleutils:symbol-name-not-found",e,{symbolName:y}))}let h=a.fromJSON(i.symbolUrlFromStyleItem(d,c),p),O=d.thumbnail&&d.thumbnail.href;const U=d.thumbnail&&d.thumbnail.imageData;l.isDevEnvironment()&&(h=l.adjustStaticAGOUrl(h),O=l.adjustStaticAGOUrl(O));const g={portal:b.portal,url:n.urlToObject(n.removeFile(h)),origin:"portal-item"};return i.requestJSON(h,f).then((l=>{const r="cimRef"===c?i.makeCIMSymbolRef(l.data):l.data,n=s.fromJSON(r,g);if(n&&t.isSymbol3D(n)){if(O){const e=a.fromJSON(O,p);n.thumbnail=new u.default({url:e})}else U&&(n.thumbnail=new u.default({url:`data:image/png;base64,${U}`}));e.styleUrl?n.styleOrigin=new m({portal:b.portal,styleUrl:e.styleUrl,name:y}):e.styleName&&(n.styleOrigin=new m({portal:b.portal,styleName:e.styleName,name:y}))}return n}))}function c(e,t,l){const r=i.Style2DUrlTemplate.replace(/\{SymbolName\}/gi,e.name);return i.requestJSON(r,l).then((e=>{const l=i.makeCIMSymbolRef(e.data);return s.fromJSON(l,{portal:t.portal,url:n.urlToObject(n.removeFile(r)),origin:"portal-item"})}))}e.fetchSymbolFromStyle=b,e.resolveWebStyleSymbol=y,Object.defineProperty(e,"__esModule",{value:!0})}));
