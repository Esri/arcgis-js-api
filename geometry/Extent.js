/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/maybe","../core/string","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","./support/spatialReferenceUtils","./SpatialReference","./Geometry","./support/webMercatorUtils","./Point","./support/contains","./support/intersects"],(function(t,e,i,n,s,r,a,m,o,h,c,x,p,l,u,y,f,d,z){"use strict";var M;function _(t,e,i){return null==e?i:null==i?e:t(e,i)}let g=M=function(e){function i(...t){var i;return(i=e.call(this,...t)||this).type="extent",i.xmin=0,i.ymin=0,i.mmin=void 0,i.zmin=void 0,i.xmax=0,i.ymax=0,i.mmax=void 0,i.zmax=void 0,i}t._inheritsLoose(i,e);var r=i.prototype;return r.normalizeCtorArgs=function(t,e,i,n,s){return!(r=t)||"esri.geometry.SpatialReference"!==r.declaredClass&&null==r.wkid?"object"==typeof t?(t.spatialReference=null==t.spatialReference?l.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:n,spatialReference:null==s?l.WGS84:s}:{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0};var r},i.fromBounds=function(t,e){return new M({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})},r.centerAt=function(t){const e=this.center;return null!=t.z&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)},r.clone=function(){const t=new M;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,null!=this.zmin&&(t.zmin=this.zmin,t.zmax=this.zmax),null!=this.mmin&&(t.mmin=this.mmin,t.mmax=this.mmax),t},r.contains=function(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&y.canProject(e,i)&&(t=e.isWebMercator?y.geographicToWebMercator(t):y.webMercatorToGeographic(t,!0)),"point"===t.type?d.extentContainsPoint(this,t):"extent"===t.type&&d.extentContainsExtent(this,t)},r.equals=function(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&y.canProject(e,i)&&(t=e.isWebMercator?y.geographicToWebMercator(t):y.webMercatorToGeographic(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax},r.expand=function(t){const e=.5*(1-t),i=this.width*e,n=this.height*e;if(this.xmin+=i,this.ymin+=n,this.xmax-=i,this.ymax-=n,this.hasZ){const t=(this.zmax-this.zmin)*e;this.zmin+=t,this.zmax-=t}if(this.hasM){const t=(this.mmax-this.mmin)*e;this.mmin+=t,this.mmax-=t}return this},r.intersects=function(t){if(n.isNone(t))return!1;"mesh"===t.type&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;e&&i&&!e.equals(i)&&y.canProject(e,i)&&(t=e.isWebMercator?y.geographicToWebMercator(t):y.webMercatorToGeographic(t,!0));return z.getExtentIntersector(t.type)(this,t)},r.normalize=function(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]},r.offset=function(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,null!=i&&(this.zmin+=i,this.zmax+=i),this},r.shiftCentralMeridian=function(){return this._normalize(!0)},r.union=function(t){return this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=_(Math.min,this.zmin,t.zmin),this.zmax=_(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=_(Math.min,this.mmin,t.mmin),this.mmax=_(Math.max,this.mmax,t.mmax)),this},r.intersection=function(t){return this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=_(Math.max,this.zmin,t.zmin),this.zmax=_(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=_(Math.max,this.mmin,t.mmin),this.mmax=_(Math.min,this.mmax,t.mmax)),this):null},r.toJSON=function(t){return this.write(null,t)},r._shiftCM=function(t=p.getInfo(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const n=e.isWebMercator?y.webMercatorToGeographic(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(n.x=this._normalizeX(n.x,t).x),this.spatialReference=new l(s.replace(e.isWGS84?t.altTemplate:t.wkTemplate,{Central_Meridian:n.x}))}return this},r._getCM=function(t){let e=null;const[i,n]=t.valid,s=this.xmin,r=this.xmax;return s>=i&&s<=n&&(r>=i&&r<=n)||(e=this.center),e},r._normalize=function(t,e,i){const n=this.spatialReference;if(!n)return this;if(!(i=i||p.getInfo(n)))return this;const s=this._getParts(i).map((t=>t.extent));if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(t)return this._shiftCM(i);if(e)return s;let r=!0,a=!0;return s.forEach((t=>{t.hasZ||(r=!1),t.hasM||(a=!1)})),{rings:s.map((t=>{const e=[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]];if(r){const i=(t.zmax-t.zmin)/2;for(let t=0;t<e.length;t++)e[t].push(i)}if(a){const i=(t.mmax-t.mmin)/2;for(let t=0;t<e.length;t++)e[t].push(i)}return e})),hasZ:r,hasM:a,spatialReference:n}},r._getParts=function(t){let e=this.cache._parts;if(!e){e=[];const{ymin:i,ymax:n,spatialReference:s}=this,r=this.width,a=this.xmin,m=this.xmax;let o;t=t||p.getInfo(s);const[h,c]=t.valid;o=this._normalizeX(this.xmin,t);const x=o.x,l=o.frameId;o=this._normalizeX(this.xmax,t);const u=o.x,y=o.frameId,f=x===u&&r>0;if(r>2*c){const t=new M(a<m?x:u,i,c,n,s),r=new M(h,i,a<m?u:x,n,s),o=new M(0,i,c,n,s),p=new M(h,i,0,n,s),f=[],d=[];t.contains(o)&&f.push(l),t.contains(p)&&d.push(l),r.contains(o)&&f.push(y),r.contains(p)&&d.push(y);for(let t=l+1;t<y;t++)f.push(t),d.push(t);e.push({extent:t,frameIds:[l]},{extent:r,frameIds:[y]},{extent:o,frameIds:f},{extent:p,frameIds:d})}else x>u||f?e.push({extent:new M(x,i,c,n,s),frameIds:[l]},{extent:new M(h,i,u,n,s),frameIds:[y]}):e.push({extent:new M(x,i,u,n,s),frameIds:[l]});this.cache._parts=e}const i=this.hasZ,n=this.hasM;if(i||n){const t={};i&&(t.zmin=this.zmin,t.zmax=this.zmax),n&&(t.mmin=this.mmin,t.mmax=this.mmax);for(let i=0;i<e.length;i++)e[i].extent.set(t)}return e},r._normalizeX=function(t,e){const[i,n]=e.valid,s=2*n;let r,a=0;return t>n?(r=Math.ceil(Math.abs(t-n)/s),t-=r*s,a=r):t<i&&(r=Math.ceil(Math.abs(t-i)/s),t+=r*s,a=-r),{x:t,frameId:a}},t._createClass(i,[{key:"center",get:function(){const t=new f({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}},{key:"extent",get:function(){return this.clone()}},{key:"hasM",get:function(){return null!=this.mmin&&null!=this.mmax}},{key:"hasZ",get:function(){return null!=this.zmin&&null!=this.zmax}},{key:"height",get:function(){return Math.abs(this.ymax-this.ymin)}},{key:"width",get:function(){return Math.abs(this.xmax-this.xmin)}}]),i}(u);return e.__decorate([m.property({dependsOn:["xmin","ymin","zmin","mmin","xmax","ymax","zmax","mmax","spatialReference"],autoTracked:!1})],g.prototype,"cache",void 0),e.__decorate([m.property({readOnly:!0,dependsOn:["cache"],autoTracked:!1})],g.prototype,"center",null),e.__decorate([m.property({readOnly:!0,dependsOn:["cache"],autoTracked:!1})],g.prototype,"extent",null),e.__decorate([m.property({readOnly:!0,dependsOn:["mmin","mmax"],json:{write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasM",null),e.__decorate([m.property({readOnly:!0,dependsOn:["zmin","zmax"],json:{write:{enabled:!1,overridePolicy:null}}})],g.prototype,"hasZ",null),e.__decorate([m.property({readOnly:!0,dependsOn:["ymin","ymax"]})],g.prototype,"height",null),e.__decorate([m.property({readOnly:!0,dependsOn:["xmin","xmax"]})],g.prototype,"width",null),e.__decorate([m.property({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],g.prototype,"xmin",void 0),e.__decorate([m.property({type:Number,json:{write:!0}})],g.prototype,"ymin",void 0),e.__decorate([m.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],g.prototype,"mmin",void 0),e.__decorate([m.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],g.prototype,"zmin",void 0),e.__decorate([m.property({type:Number,json:{write:!0}})],g.prototype,"xmax",void 0),e.__decorate([m.property({type:Number,json:{write:!0}})],g.prototype,"ymax",void 0),e.__decorate([m.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],g.prototype,"mmax",void 0),e.__decorate([m.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],g.prototype,"zmax",void 0),g=M=e.__decorate([o.subclass("esri.geometry.Extent")],g),g.prototype.toJSON.isDefaultToJSON=!0,g}));
