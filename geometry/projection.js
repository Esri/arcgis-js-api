/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["require","exports","../chunks/_rollupPluginBabelHelpers","../core/Error","../core/mathUtils","../core/maybe","../core/promiseUtils","../core/unitUtils","../chunks/mat4","../chunks/vec3","../chunks/vec3f64","./Extent","./Multipoint","../chunks/pe","./Point","./Polygon","./Polyline","./projectionEllipsoid","./support/aaBoundingRect","./support/Ellipsoid","./support/geodesicConstants","./support/GeographicTransformation","./support/spatialReferenceUtils","./support/zscale"],(function(n,e,t,r,o,l,i,a,u,s,c,f,p,h,d,m,M,R,P,y,g,E,S,w){"use strict";let j=null,N=null,T=null,C={};function x(){return!!j&&h.isLoaded()}function I(e){return l.isNone(T)&&(T=Promise.all([h.load(),new Promise(((e,t)=>n(["../chunks/geometryEngineBase"],e,t))).then((n=>n.geometryEngineBase)),new Promise(((e,t)=>n(["./geometryAdapters/hydrated"],e,t)))])),T.then((([,n,{hydratedAdapter:t}])=>{i.throwIfAborted(e),N=t,j=n.default,j._enableProjection(h.pe)}))}function F(n,e,t=null){return Array.isArray(n)?0===n.length?[]:b(N,n,n[0].spatialReference,e,t):b(N,[n],n.spatialReference,e,t)[0]}function b(n,e,t,r,o=null){if(l.isNone(t)||l.isNone(r))return e;if(k(t,r,o))return e.map((n=>l.unwrap(Z(n,t,r))));if(l.isNone(o)){const n=E.cacheKey(t,r);void 0!==C[n]?o=C[n]:(o=W(t,r,null),l.isNone(o)&&(o=new E),C[n]=o)}if(l.isNone(j))throw new q;return j._project(n,e,t,r,o)}function W(n,e,t=null){if(l.isNone(j))throw new q;if(l.isNone(n)||l.isNone(e))return null;const r=j._getTransformation(N,n,e,t,null==t?void 0:t.spatialReference);return null!==r?E.fromGE(r):null}function z(n,e,t=null){if(l.isNone(j))throw new q;const r=j._getTransformationBySuitability(N,n,e,t,null==t?void 0:t.spatialReference);if(null!==r){const n=[];for(const e of r)n.push(E.fromGE(e));return n}return[]}let q=function(n){function e(){return n.call(this,"projection:not-loaded","projection engine not fully loaded yet, please call load()")||this}return t._inheritsLoose(e,n),e}(r);function L(){j=null,N=null,T=null,C={}}function G(n,e){try{const t=F(n,e);if(null==t)return null;"xmin"in n&&"xmin"in t&&(t.zmin=n.zmin,t.zmax=n.zmax);const r=w.getGeometryZScaler(t.type,n.spatialReference,e);return l.isSome(r)&&r(t),t}catch(t){if(!(t instanceof q))throw t;return null}}function k(n,e,t){return!t&&(!!S.equals(n,e)||S.isValid(n)&&S.isValid(e)&&!!$n(n,e,oe))}function v(n,e,t,r){return U.apply(this,arguments)}function U(){return(U=t._asyncToGenerator((function*(n,e,t,r){if(!x())if(Array.isArray(n)){for(const{source:o,dest:l,geographicTransformation:i}of n)if(!k(o,l,i))return I(r)}else if(!k(n,e,t))return I(r)}))).apply(this,arguments)}function A(n,e){switch($n(n,e,oe)){case yn:return"copy3";case An:return"wgs84ToSphericalECEF";case jn:return"wgs84ToWebMercator";case Cn:return"wgs84ToPlateCarree";case Hn:return"wgs84ToWGS84ECEF";case gn:return"webMercatorToWGS84";case En:return"webMercatorToSphericalECEF";case Sn:return"webMercatorToWGS84ECEF";case In:return"webMercatorToPlateCarree";case Kn:return"wgs84ECEFToWGS84";case Yn:return"wgs84ECEFToSphericalECEF";case Jn:return"wgs84ECEFToWebMercator";case Bn:return"sphericalECEFToWGS84";case Dn:return"sphericalECEFToWebMercator";case _n:return"sphericalMarsPCPFToMars2000";case Vn:return"sphericalMoonPCPFToMoon2000";case On:return"sphericalECEFToWGS84ECEF";case Un:return"mars2000ToSphericalPCPF";case vn:return"moon2000ToSphericalPCPF";default:return null}}function Z(n,e,t){return n?"x"in n?_(n,e,new d,t,0):"xmin"in n?J(n,e,new f,t,0):"rings"in n?K(n,e,new m,t,0):"paths"in n?X(n,e,new M,t,0):"points"in n?D(n,e,new p,t,0):null:null}function V(n,e,t=e.spatialReference,r=0){return!l.isNone(t)&&l.isSome(_(n,n.spatialReference,e,t,r))}function _(n,e,t,r,o){fe[0]=n.x,fe[1]=n.y;const l=n.z;return fe[2]=void 0!==l?l:o,an(fe,e,0,fe,r,0,1)?(t.x=fe[0],t.y=fe[1],t.spatialReference=r,void 0===l?(t.z=void 0,t.hasZ=!1):(t.z=fe[2],t.hasZ=!0),void 0===n.m?(t.m=void 0,t.hasM=!1):(t.m=n.m,t.hasM=!0),t):null}function B(n,e,t=e.spatialReference,r=0){return!l.isNone(t)&&l.isSome(D(n,n.spatialReference,e,t,r))}function D(n,e,t,r,o){const{points:l,hasZ:i,hasM:a}=n,u=[],s=l.length,c=[];for(const f of l)c.push(f[0],f[1],i?f[2]:o);if(!an(c,e,0,c,r,0,s))return null;for(let f=0;f<s;++f){const n=3*f,e=c[n],t=c[n+1];i&&a?u.push([e,t,c[n+2],l[f][3]]):i?u.push([e,t,c[n+2]]):a?u.push([e,t,l[f][2]]):u.push([e,t])}return t.points=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,t}function O(n,e,t=e.spatialReference,r=0){return l.isSome(t)&&l.isSome(X(n,n.spatialReference,e,t,r))}function X(n,e,t,r,o){const{paths:l,hasZ:i,hasM:a}=n,u=[];return sn(l,i,a,e,u,r,o)?(t.paths=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,t):null}function H(n,e,t=e.spatialReference,r=0){return l.isSome(t)&&l.isSome(K(n,n.spatialReference,e,t,r))}function K(n,e,t,r,o){const{rings:l,hasZ:i,hasM:a}=n,u=[];return sn(l,i,a,e,u,r,o)?(t.rings=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,t):null}function Y(n,e,t=e.spatialReference,r=0){return l.isSome(t)&&l.isSome(J(n,n.spatialReference,e,t,r))}function J(n,e,t,r,o){const{xmin:l,ymin:i,xmax:a,ymax:u,hasZ:s,hasM:c}=n;if(!en(l,i,s?n.zmin:o,e,fe,r))return null;t.xmin=fe[0],t.ymin=fe[1],s&&(t.zmin=fe[2]);return en(a,u,s?n.zmax:o,e,fe,r)?(t.xmax=fe[0],t.ymax=fe[1],s&&(t.zmax=fe[2]),c&&(t.mmin=n.mmin,t.mmax=n.mmax),t.spatialReference=r,t):null}function Q(n,e,t){if(l.isNone(e)||l.isNone(t))return null;const r=new d({spatialReference:t});return an(n,e,0,fe,t,0,1)?(r.x=fe[0],r.y=fe[1],r.z=fe[2],r):null}function $(n,e,t){return an(n,e,0,fe,t.spatialReference,0,1)?(t.x=fe[0],t.y=fe[1],t.z=fe[2],t):null}function nn(n,e,t,r=0){fe[0]=n.x,fe[1]=n.y;const o=n.z;return fe[2]=void 0!==o?o:r,an(fe,n.spatialReference,0,e,t,0,1)}function en(n,e,t,r,o,l){return ue[0]=n,ue[1]=e,ue[2]=t,an(ue,r,0,o,l,0,1)}function tn(n,e,t,r){return!(l.isNone(e)||l.isNone(r)||n.length<2)&&(2===n.length&&(ue[0]=n[0],ue[1]=n[1],ue[2]=0,n=ue),an(n,e,0,t,r,0,1))}function rn(n,e){fe[0]=n.x,fe[1]=n.y;const t=n.z;return fe[2]=void 0!==t?t:0,on(fe,n.spatialReference,e)}function on(n,e,t){return ln(n,e,t)}function ln(n,e,t){if(l.isNone(e))return!1;const r=Pn(e,te),o=Qn[r][6];return!l.isNone(o)&&(o(n,0,ue,0),t!==ue&&(t[0]=ue[0],t[1]=ue[1],t.length>2&&(t[2]=ue[2])),!0)}function an(n,e,t,r,o,i,a=1){const u=$n(e,o,oe);if(l.isNone(u))return!1;if(u===yn){if(n===r&&t===i)return!0;const e=t+3*a;for(let o=t,l=i;o<e;o++,l++)r[l]=n[o];return!0}const s=t+3*a;for(let l=t,c=i;l<s;l+=3,c+=3)u(n,l,r,c);return!0}function un(n,e,t,r,o){s.copy(fe,n),s.add(pe,n,e),tn(fe,t,fe,o),tn(pe,t,pe,o),s.subtract(r,pe,fe),s.normalize(r,r)}function sn(n,e,t,r,o,l,i=0){const a=new Array;for(const s of n)for(const n of s)a.push(n[0],n[1],e?n[2]:i);if(!an(a,r,0,a,l,0,a.length/3))return!1;let u=0;o.length=0;for(const s of n){const n=new Array;for(const r of s)e&&t?n.push([a[u++],a[u++],a[u++],r[3]]):e?n.push([a[u++],a[u++],a[u++]]):t?(n.push([a[u++],a[u++],r[2]]),u++):(n.push([a[u++],a[u++]]),u++);o.push(n)}return!0}function cn(n,e,t,r){if(l.isNone(e)||l.isNone(r))return!1;const o=ne(e,r,le);if(o.projector===yn)return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],!0;if(l.isNone(o.projector))return!1;const{source:i,dest:a}=o;if(3===a.spatialReferenceId){const e=Qn[i.spatialReferenceId][2];return!l.isNone(e)&&(e(n,0,se,0),jn(se,0,t,0),t[3]=fn(se[1],n[2],n[3],y.earth.radius),!0)}if(2!==i.spatialReferenceId&&5!==i.spatialReferenceId||12!==a.spatialReferenceId)o.projector(n,0,t,0),t[3]=n[3]*i.metersPerUnit/a.metersPerUnit;else{const e=Qn[i.spatialReferenceId][1],r=Qn[1][12];let a=n[3];l.isSome(e)&&l.isSome(r)&&(a=fn(n[1],n[2],n[3],y.earth.radius)),o.projector(n,0,t,0),t[3]=a}return!0}function fn(n,e,t,r){const o=Math.abs(ie*n)+Math.asin(t/(r+e));return o>=Math.PI/2?Number.MAX_VALUE:t/Math.cos(o)}function pn(n,e,t,r){return null!=n&&(S.equals(e,r)?(P.copy(t,n),!0):(ue[0]=n[0],ue[1]=n[1],ue[2]=0,!!an(ue,e,0,ue,r,0,1)&&(t[0]=ue[0],t[1]=ue[1],ue[0]=n[2],ue[1]=n[3],ue[2]=0,!!an(ue,e,0,ue,r,0,1)&&(t[2]=ue[0],t[3]=ue[1],!0))))}function hn(n,e,t,r){if(l.isNone(e)||l.isNone(r))return!1;const o=Pn(e,te),i=Pn(r,re);if(o===i&&0!==o||S.equals(e,r))return t[0]=1,t[1]=1,t[2]=1,!0;if(1===o){const e=s.length(n),r=e/Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=e/y.earth.radius;if(3===i)return t[0]=r*o,t[1]=r*o,t[2]=1,!0;if(2===i||5===i){const n=180/(y.earth.radius*Math.PI);return t[0]=n*r*o,t[1]=n*o,t[2]=1,!0}}else if(12===o&&(2===i||5===i))return t[0]=Tn,t[1]=Tn,t[2]=1,!0;return!1}function dn(n,e,t,r){if(l.isNone(n)||l.isNone(r))return!1;const o=Pn(n,te),i=Pn(r,re);if(o===i&&!mn(i)&&(0!==o||S.equals(n,r)))return u.identity(t),u.translate(t,t,e),!0;if(mn(i)){const n=Qn[o][11],r=Qn[11][i];return!l.isNone(n)&&!l.isNone(r)&&(n(e,0,se,0),r(se,0,ce,0),Mn(ie*se[0],ie*se[1],t),t[12]=ce[0],t[13]=ce[1],t[14]=ce[2],!0)}if(!(3!==i&&12!==i||2!==o&&1!==o&&3!==o)){const n=Qn[o][11],r=Qn[11][i];return!l.isNone(n)&&!l.isNone(r)&&(n(e,0,se,0),r(se,0,ce,0),1===o?Rn(ie*se[0],ie*se[1],t):u.identity(t),t[12]=ce[0],t[13]=ce[1],t[14]=ce[2],!0)}return!1}function mn(n){return 1===n||7===n||9===n}function Mn(n,e,t){const r=Math.sin(n),o=Math.cos(n),l=Math.sin(e),i=Math.cos(e),a=t;return a[0]=-r,a[4]=-l*o,a[8]=i*o,a[12]=0,a[1]=o,a[5]=-l*r,a[9]=i*r,a[13]=0,a[2]=0,a[6]=i,a[10]=l,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Rn(n,e,t){return Mn(n,e,t),u.transpose(t,t),t}function Pn(n,e){return e.spatialReference===n?e.spatialReferenceId:(e.spatialReference=n,"metersPerUnit"in e&&(e.metersPerUnit=a.getMetersPerUnitForSR(n,1)),n.wkt===R.SphericalECEFSpatialReference.wkt?e.spatialReferenceId=1:S.isWGS84(n)?e.spatialReferenceId=2:S.isWebMercator(n)?e.spatialReferenceId=3:S.isPlateCarree(n)?e.spatialReferenceId=12:n.wkt===R.WGS84ECEFSpatialReference.wkt?e.spatialReferenceId=4:4490===n.wkid?e.spatialReferenceId=5:n.wkt===R.SphericalPCPFMars.wkt?e.spatialReferenceId=7:n.wkt===R.SphericalPCPFMoon.wkt?e.spatialReferenceId=9:S.isMars(n)?e.spatialReferenceId=8:S.isMoon(n)?e.spatialReferenceId=10:e.spatialReferenceId=0)}function yn(n,e,t,r){n!==t&&(t[r++]=n[e++],t[r++]=n[e++],t[r]=n[e])}function gn(n,e,t,r){t[r++]=ae*(n[e++]/y.earth.radius),t[r++]=ae*(Math.PI/2-2*Math.atan(Math.exp(-n[e++]/y.earth.radius))),t[r]=n[e]}function En(n,e,t,r){gn(n,e,t,r),An(t,r,t,r)}function Sn(n,e,t,r){gn(n,e,t,r),Hn(t,r,t,r)}function wn(n,e,t,r,l){const i=.4999999*Math.PI,a=o.clamp(ie*n[e+1],-i,i),u=Math.sin(a);t[r++]=ie*n[e]*l.radius,t[r++]=l.halfSemiMajorAxis*Math.log((1+u)/(1-u)),t[r]=n[e+2]}function jn(n,e,t,r){wn(n,e,t,r,y.earth)}const Nn=y.earth.radius*Math.PI/180,Tn=180/(y.earth.radius*Math.PI);function Cn(n,e,t,r){t[r]=n[e]*Nn,t[r+1]=n[e+1]*Nn,t[r+2]=n[e+2]}function xn(n,e,t,r){t[r]=n[e]*Tn,t[r+1]=n[e+1]*Tn,t[r+2]=n[e+2]}function In(n,e,t,r){gn(n,e,t,r),Cn(t,r,t,r)}function Fn(n,e,t,r){Kn(n,e,t,r),Cn(t,r,t,r)}function bn(n,e,t,r){Bn(n,e,t,r),Cn(t,r,t,r)}function Wn(n,e,t,r){xn(n,e,t,r),An(t,r,t,r)}function zn(n,e,t,r){xn(n,e,t,r),jn(t,r,t,r)}function qn(n,e,t,r){xn(n,e,t,r),Hn(t,r,t,r)}function Ln(n){if(l.isNone(n))return!1;const e=Pn(n,te);return!!Qn[e][6]}function Gn(n,e,t,r,o=0){const l=r+o,i=Math.cos(t);n[0]=Math.cos(e)*i*l,n[1]=Math.sin(e)*i*l,n[2]=Math.sin(t)*l}function kn(n,e,t,r,o){const l=o+n[e+2],i=ie*n[e+1],a=ie*n[e],u=Math.cos(i);t[r++]=Math.cos(a)*u*l,t[r++]=Math.sin(a)*u*l,t[r]=Math.sin(i)*l}function vn(n,e,t,r){kn(n,e,t,r,y.moon.radius)}function Un(n,e,t,r){kn(n,e,t,r,y.mars.radius)}function An(n,e,t,r){kn(n,e,t,r,y.earth.radius)}function Zn(n,e,t,r,l){const i=n[e],a=n[e+1],u=n[e+2],s=Math.sqrt(i*i+a*a+u*u),c=o.asinClamped(u/(0===s?1:s)),f=Math.atan2(a,i);t[r++]=ae*f,t[r++]=ae*c,t[r]=s-l}function Vn(n,e,t,r){Zn(n,e,t,r,y.moon.radius)}function _n(n,e,t,r){Zn(n,e,t,r,y.mars.radius)}function Bn(n,e,t,r){Zn(n,e,t,r,y.earth.radius)}function Dn(n,e,t,r){Bn(n,e,t,r),jn(t,r,t,r)}function On(n,e,t,r){Bn(n,e,t,r),Hn(t,r,t,r)}function Xn(n,e,t,r,o){const l=ie*n[e],i=ie*n[e+1],a=n[e+2],u=Math.sin(i),s=Math.cos(i),c=o.radius/Math.sqrt(1-o.eccentricitySquared*u*u);t[r++]=(c+a)*s*Math.cos(l),t[r++]=(c+a)*s*Math.sin(l),t[r++]=(c*(1-o.eccentricitySquared)+a)*u}function Hn(n,e,t,r){Xn(n,e,t,r,y.earth)}function Kn(n,e,t,r){const o=g.earthEllipsoidConstants,l=n[e],i=n[e+1],a=n[e+2];let u,s,c,f,p,h,d,m,M,R,P,E,S,w,j,N,T,C,x,I,F;u=Math.abs(a),s=l*l+i*i,c=Math.sqrt(s),f=s+a*a,p=Math.sqrt(f),I=Math.atan2(i,l),h=a*a/f,d=s/f,w=o.a2/p,j=o.a3-o.a4/p,d>.3?(m=u/p*(1+d*(o.a1+w+h*j)/p),x=Math.asin(m),R=m*m,M=Math.sqrt(1-R)):(M=c/p*(1-h*(o.a5-w-d*j)/p),x=Math.acos(M),R=1-M*M,m=Math.sqrt(R)),P=1-y.earth.eccentricitySquared*R,E=y.earth.radius/Math.sqrt(P),S=o.a6*E,w=c-E*M,j=u-S*m,T=M*w+m*j,N=M*j-m*w,C=N/(S/P+T),x+=C,F=T+N*C/2,a<0&&(x=-x),t[r++]=ae*I,t[r++]=ae*x,t[r]=F}function Yn(n,e,t,r){Kn(n,e,t,r),An(t,r,t,r)}function Jn(n,e,t,r){Kn(n,e,t,r),jn(t,r,t,r)}const Qn={2:{5:null,8:null,10:null,11:yn,6:yn,1:An,7:null,9:null,0:null,3:jn,12:Cn,2:yn,4:Hn},5:{5:yn,8:null,10:null,11:yn,6:yn,1:An,7:null,9:null,0:null,3:null,12:Cn,2:null,4:Hn},8:{5:null,8:yn,10:null,11:yn,6:null,1:null,7:Un,9:null,0:null,3:null,12:null,2:null,4:null},10:{5:null,8:null,10:yn,11:yn,6:null,1:null,7:null,9:vn,0:null,3:null,12:null,2:null,4:null},3:{5:null,8:null,10:null,11:gn,6:gn,1:En,7:null,9:null,0:null,3:yn,12:In,2:gn,4:Sn},4:{5:Kn,8:null,10:null,11:Kn,6:Kn,1:Yn,7:null,9:null,0:null,3:Jn,12:Fn,2:Kn,4:yn},1:{5:Bn,8:null,10:null,11:Bn,6:Bn,1:yn,7:null,9:null,0:null,3:Dn,12:bn,2:Bn,4:On},7:{5:null,8:_n,10:null,11:_n,6:null,1:null,7:yn,9:null,0:null,3:null,12:null,2:null,4:null},9:{5:null,8:null,10:Vn,11:Vn,6:null,1:null,7:null,9:yn,0:null,3:null,12:null,2:null,4:null},0:{5:null,8:null,10:null,11:null,6:null,1:null,7:null,9:null,0:yn,3:null,12:null,2:null,4:null},11:{5:yn,8:yn,10:yn,11:yn,6:yn,1:An,7:Un,9:vn,0:null,3:jn,12:Cn,2:yn,4:Hn},6:{5:null,8:null,10:null,11:yn,6:yn,1:An,7:null,9:null,0:null,3:null,12:Cn,2:yn,4:Hn},12:{5:xn,8:null,10:null,11:xn,6:xn,1:Wn,7:null,9:null,0:null,3:zn,12:yn,2:xn,4:qn}};function $n(n,e,t=ee()){return l.isNone(n)||l.isNone(e)?null:ne(n,e,t).projector}function ne(n,e,t){if(l.isNone(n)||l.isNone(e)||t.source.spatialReference===n&&t.dest.spatialReference===e)return t;const r=Pn(n,t.source),o=Pn(e,t.dest);return 0===r&&0===o?S.equals(n,e)?t.projector=yn:t.projector=null:t.projector=Qn[r][o],t}function ee(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:yn}}const te={spatialReference:null,spatialReferenceId:0},re={spatialReference:null,spatialReferenceId:0},oe=ee(),le=ee(),ie=o.deg2rad(1),ae=o.rad2deg(1),ue=c.create(),se=c.create(),ce=c.create(),fe=c.create(),pe=c.create();e.canProjectToWGS84ComparableLonLat=Ln,e.canProjectWithoutEngine=k,e.computeENUToSphericalPCPFLocalRotation=Mn,e.computeSphericalPCPFToENULocalRotation=Rn,e.computeTranslationToOriginAndRotation=dn,e.getProjectorName=A,e.getTransformation=W,e.getTransformations=z,e.initializeProjection=v,e.isLoaded=x,e.load=I,e.localLinearScaleFactors=hn,e.lonLatToSphericalPCPF=Gn,e.lonLatToWebMercatorComparable=wn,e.project=F,e.projectBoundingRect=pn,e.projectBoundingSphere=cn,e.projectBuffer=an,e.projectDirection=un,e.projectExtent=Y,e.projectMany=b,e.projectMultipoint=B,e.projectPoint=V,e.projectPointToVector=nn,e.projectPointToWGS84ComparableLonLat=rn,e.projectPolygon=H,e.projectPolyline=O,e.projectVectorToDehydratedPoint=$,e.projectVectorToPoint=Q,e.projectVectorToVector=tn,e.projectVectorToWGS84ComparableLonLat=on,e.projectWithoutEngine=Z,e.projectXYZToVector=en,e.sphericalPCPFtoLonLatElevation=Zn,e.tryProjectWithZConversion=G,e.unload=L,Object.defineProperty(e,"__esModule",{value:!0})}));
