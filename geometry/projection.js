/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["require","exports","../chunks/_rollupPluginBabelHelpers","../core/Error","../core/mathUtils","../core/maybe","../core/promiseUtils","../core/unitUtils","../chunks/mat4","../chunks/vec3","../chunks/vec3f64","./Extent","./Multipoint","../chunks/pe","./Point","./Polygon","./Polyline","./projectionEllipsoid","./support/aaBoundingRect","./support/Ellipsoid","./support/geodesicConstants","./support/GeographicTransformation","./support/spatialReferenceUtils"],(function(n,e,t,r,o,l,i,a,u,s,c,f,p,h,d,m,M,R,P,g,y,E,S){"use strict";let N=null,j=null,w=null,T={};function C(){return!!N&&h.isLoaded()}function I(){return!0}function F(e){return l.isNone(w)&&(w=Promise.all([h.load(),new Promise((function(e,t){n(["../chunks/geometryEngineBase"],e,t)})).then((function(n){return n.geometryEngineBase})),new Promise((function(e,t){n(["./geometryAdapters/hydrated"],e,t)}))])),w.then((([,n,{hydratedAdapter:t}])=>{i.throwIfAborted(e),j=t,N=n.default,N._enableProjection(h.pe)}))}function x(n,e,t=null){return Array.isArray(n)?0===n.length?[]:b(j,n,n[0].spatialReference,e,t):b(j,[n],n.spatialReference,e,t)[0]}function b(n,e,t,r,o=null){if(l.isNone(t)||l.isNone(r))return e;if(G(t,r,o))return e.map((n=>l.unwrap(A(n,t,r))));if(l.isNone(o)){const n=E.cacheKey(t,r);void 0!==T[n]?o=T[n]:(o=W(t,r,null),l.isNone(o)&&(o=new E),T[n]=o)}if(l.isNone(N))throw new L;return N._project(n,e,t,r,o)}function W(n,e,t=null){if(l.isNone(N))throw new L;if(l.isNone(n)||l.isNone(e))return null;const r=N._getTransformation(j,n,e,t,null==t?void 0:t.spatialReference);return null!==r?E.fromGE(r):null}function q(n,e,t=null){if(l.isNone(N))throw new L;const r=N._getTransformationBySuitability(j,n,e,t,null==t?void 0:t.spatialReference);if(null!==r){const n=[];for(const e of r)n.push(E.fromGE(e));return n}return[]}let L=function(n){function e(){return n.call(this,"projection:not-loaded","projection engine not fully loaded yet, please call load()")||this}return t._inheritsLoose(e,n),e}(r);function k(){N=null,j=null,w=null,T={}}function G(n,e,t){return!t&&(!!S.equals(n,e)||S.isValid(n)&&S.isValid(e)&&!!Qn(n,e,re))}function v(n,e,t,r){return U.apply(this,arguments)}function U(){return(U=t._asyncToGenerator((function*(n,e,t,r){if(!C())if(Array.isArray(n)){for(const{source:o,dest:l,geographicTransformation:i}of n)if(!G(o,l,i))return F(r)}else if(!G(n,e,t))return F(r)}))).apply(this,arguments)}function z(n,e){switch(Qn(n,e,re)){case Pn:return"copy3";case zn:return"wgs84ToSphericalECEF";case Nn:return"wgs84ToWebMercator";case Tn:return"wgs84ToPlateCarree";case Xn:return"wgs84ToWGS84ECEF";case gn:return"webMercatorToWGS84";case yn:return"webMercatorToSphericalECEF";case En:return"webMercatorToWGS84ECEF";case Hn:return"wgs84ECEFToWGS84";case Kn:return"wgs84ECEFToSphericalECEF";case Yn:return"wgs84ECEFToWebMercator";case _n:return"sphericalECEFToWGS84";case Bn:return"sphericalECEFToWebMercator";case Zn:return"sphericalMarsPCPFToMars2000";case Vn:return"sphericalMoonPCPFToMoon2000";case Dn:return"sphericalECEFToWGS84ECEF";case Un:return"mars2000ToSphericalPCPF";case vn:return"moon2000ToSphericalPCPF";default:return null}}function A(n,e,t){return n?"x"in n?Z(n,e,new d,t,0):"xmin"in n?Y(n,e,new f,t,0):"rings"in n?H(n,e,new m,t,0):"paths"in n?O(n,e,new M,t,0):"points"in n?B(n,e,new p,t,0):null:null}function V(n,e,t=e.spatialReference,r=0){return!l.isNone(t)&&l.isSome(Z(n,n.spatialReference,e,t,r))}function Z(n,e,t,r,o){ce[0]=n.x,ce[1]=n.y;const l=n.z;return ce[2]=void 0!==l?l:o,ln(ce,e,0,ce,r,0,1)?(t.x=ce[0],t.y=ce[1],t.spatialReference=r,void 0===l?(t.z=void 0,t.hasZ=!1):(t.z=ce[2],t.hasZ=!0),void 0===n.m?(t.m=void 0,t.hasM=!1):(t.m=n.m,t.hasM=!0),t):null}function _(n,e,t=e.spatialReference,r=0){return!l.isNone(t)&&l.isSome(B(n,n.spatialReference,e,t,r))}function B(n,e,t,r,o){const{points:l,hasZ:i,hasM:a}=n,u=[],s=l.length,c=[];for(const f of l)c.push(f[0],f[1],i?f[2]:o);if(!ln(c,e,0,c,r,0,s))return null;for(let f=0;f<s;++f){const n=3*f,e=c[n],t=c[n+1];i&&a?u.push([e,t,c[n+2],l[f][3]]):i?u.push([e,t,c[n+2]]):a?u.push([e,t,l[f][2]]):u.push([e,t])}return t.points=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,t}function D(n,e,t=e.spatialReference,r=0){return l.isSome(t)&&l.isSome(O(n,n.spatialReference,e,t,r))}function O(n,e,t,r,o){const{paths:l,hasZ:i,hasM:a}=n,u=[];return un(l,i,a,e,u,r,o)?(t.paths=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,t):null}function X(n,e,t=e.spatialReference,r=0){return l.isSome(t)&&l.isSome(H(n,n.spatialReference,e,t,r))}function H(n,e,t,r,o){const{rings:l,hasZ:i,hasM:a}=n,u=[];return un(l,i,a,e,u,r,o)?(t.rings=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,t):null}function K(n,e,t=e.spatialReference,r=0){return l.isSome(t)&&l.isSome(Y(n,n.spatialReference,e,t,r))}function Y(n,e,t,r,o){const{xmin:l,ymin:i,xmax:a,ymax:u,hasZ:s,hasM:c}=n;if(!nn(l,i,s?n.zmin:o,e,ce,r))return null;t.xmin=ce[0],t.ymin=ce[1],s&&(t.zmin=ce[2]);return nn(a,u,s?n.zmax:o,e,ce,r)?(t.xmax=ce[0],t.ymax=ce[1],s&&(t.zmax=ce[2]),c&&(t.mmin=n.mmin,t.mmax=n.mmax),t.spatialReference=r,t):null}function J(n,e,t){if(l.isNone(e)||l.isNone(t))return null;const r=new d({spatialReference:t});return ln(n,e,0,ce,t,0,1)?(r.x=ce[0],r.y=ce[1],r.z=ce[2],r):null}function Q(n,e,t){return ln(n,e,0,ce,t.spatialReference,0,1)?(t.x=ce[0],t.y=ce[1],t.z=ce[2],t):null}function $(n,e,t,r=0){ce[0]=n.x,ce[1]=n.y;const o=n.z;return ce[2]=void 0!==o?o:r,ln(ce,n.spatialReference,0,e,t,0,1)}function nn(n,e,t,r,o,l){return ae[0]=n,ae[1]=e,ae[2]=t,ln(ae,r,0,o,l,0,1)}function en(n,e,t,r){return!(l.isNone(e)||l.isNone(r)||n.length<2)&&(2===n.length&&(ae[0]=n[0],ae[1]=n[1],ae[2]=0,n=ae),ln(n,e,0,t,r,0,1))}function tn(n,e){ce[0]=n.x,ce[1]=n.y;const t=n.z;return ce[2]=void 0!==t?t:0,rn(ce,n.spatialReference,e)}function rn(n,e,t){return on(n,e,t)}function on(n,e,t){if(l.isNone(e))return!1;const r=Rn(e,ee),o=Jn[r][6];return!l.isNone(o)&&(o(n,0,ae,0),t!==ae&&(t[0]=ae[0],t[1]=ae[1],t.length>2&&(t[2]=ae[2])),!0)}function ln(n,e,t,r,o,i,a=1){const u=Qn(e,o,re);if(l.isNone(u))return!1;if(u===Pn){if(n===r&&t===i)return!0;const e=t+3*a;for(let o=t,l=i;o<e;o++,l++)r[l]=n[o];return!0}const s=t+3*a;for(let l=t,c=i;l<s;l+=3,c+=3)u(n,l,r,c);return!0}function an(n,e,t,r,o){s.copy(ce,n),s.add(fe,n,e),en(ce,t,ce,o),en(fe,t,fe,o),s.subtract(r,fe,ce),s.normalize(r,r)}function un(n,e,t,r,o,l,i=0){const a=new Array;for(const s of n)for(const n of s)a.push(n[0],n[1],e?n[2]:i);if(!ln(a,r,0,a,l,0,a.length/3))return!1;let u=0;o.length=0;for(const s of n){const n=new Array;for(const r of s)e&&t?n.push([a[u++],a[u++],a[u++],r[3]]):e?n.push([a[u++],a[u++],a[u++]]):t?(n.push([a[u++],a[u++],r[2]]),u++):(n.push([a[u++],a[u++]]),u++);o.push(n)}return!0}function sn(n,e,t,r){if(l.isNone(e)||l.isNone(r))return!1;const o=$n(e,r,oe);if(o.projector===Pn)return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],!0;if(l.isNone(o.projector))return!1;const{source:i,dest:a}=o;if(3===a.spatialReferenceId){const e=Jn[i.spatialReferenceId][2];return!l.isNone(e)&&(e(n,0,ue,0),Nn(ue,0,t,0),t[3]=cn(ue[1],n[2],n[3],g.earth.radius),!0)}if(2!==i.spatialReferenceId&&5!==i.spatialReferenceId||12!==a.spatialReferenceId)o.projector(n,0,t,0),t[3]=n[3]*i.metersPerUnit/a.metersPerUnit;else{const e=Jn[i.spatialReferenceId][1],r=Jn[1][12];let a=n[3];l.isSome(e)&&l.isSome(r)&&(a=cn(n[1],n[2],n[3],g.earth.radius)),o.projector(n,0,t,0),t[3]=a}return!0}function cn(n,e,t,r){const o=Math.abs(le*n)+Math.asin(t/(r+e));return o>=Math.PI/2?Number.MAX_VALUE:t/Math.cos(o)}function fn(n,e,t,r){return null!=n&&(S.equals(e,r)?(P.copy(t,n),!0):(ae[0]=n[0],ae[1]=n[1],ae[2]=0,!!ln(ae,e,0,ae,r,0,1)&&(t[0]=ae[0],t[1]=ae[1],ae[0]=n[2],ae[1]=n[3],ae[2]=0,!!ln(ae,e,0,ae,r,0,1)&&(t[2]=ae[0],t[3]=ae[1],!0))))}function pn(n,e,t,r){if(l.isNone(e)||l.isNone(r))return!1;const o=Rn(e,ee),i=Rn(r,te);if(o===i&&0!==o||S.equals(e,r))return t[0]=1,t[1]=1,t[2]=1,!0;if(1===o){const e=s.length(n),r=e/Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=e/g.earth.radius;if(3===i)return t[0]=r*o,t[1]=r*o,t[2]=1,!0;if(2===i||5===i){const n=180/(g.earth.radius*Math.PI);return t[0]=n*r*o,t[1]=n*o,t[2]=1,!0}}else if(12===o&&(2===i||5===i))return t[0]=wn,t[1]=wn,t[2]=1,!0;return!1}function hn(n,e,t,r){if(l.isNone(n)||l.isNone(r))return!1;const o=Rn(n,ee),i=Rn(r,te);if(o===i&&!dn(i)&&(0!==o||S.equals(n,r)))return u.identity(t),u.translate(t,t,e),!0;if(dn(i)){const n=Jn[o][11],r=Jn[11][i];return!l.isNone(n)&&!l.isNone(r)&&(n(e,0,ue,0),r(ue,0,se,0),mn(le*ue[0],le*ue[1],t),t[12]=se[0],t[13]=se[1],t[14]=se[2],!0)}if(!(3!==i&&12!==i||2!==o&&1!==o)){const n=Jn[o][11],r=Jn[11][i];return!l.isNone(n)&&!l.isNone(r)&&(n(e,0,ue,0),r(ue,0,se,0),2===o?u.identity(t):Mn(le*ue[0],le*ue[1],t),t[12]=se[0],t[13]=se[1],t[14]=se[2],!0)}return!1}function dn(n){return 1===n||7===n||9===n}function mn(n,e,t){const r=Math.sin(n),o=Math.cos(n),l=Math.sin(e),i=Math.cos(e),a=t;return a[0]=-r,a[4]=-l*o,a[8]=i*o,a[12]=0,a[1]=o,a[5]=-l*r,a[9]=i*r,a[13]=0,a[2]=0,a[6]=i,a[10]=l,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Mn(n,e,t){return mn(n,e,t),u.transpose(t,t),t}function Rn(n,e){return e.spatialReference===n?e.spatialReferenceId:(e.spatialReference=n,"metersPerUnit"in e&&(e.metersPerUnit=a.getMetersPerUnitForSR(n,1)),n.wkt===R.SphericalECEFSpatialReference.wkt?e.spatialReferenceId=1:S.isWGS84(n)?e.spatialReferenceId=2:S.isWebMercator(n)?e.spatialReferenceId=3:S.isPlateCarree(n)?e.spatialReferenceId=12:n.wkt===R.WGS84ECEFSpatialReference.wkt?e.spatialReferenceId=4:4490===n.wkid?e.spatialReferenceId=5:n.wkt===R.SphericalPCPFMars.wkt?e.spatialReferenceId=7:n.wkt===R.SphericalPCPFMoon.wkt?e.spatialReferenceId=9:S.isMars(n)?e.spatialReferenceId=8:S.isMoon(n)?e.spatialReferenceId=10:e.spatialReferenceId=0)}function Pn(n,e,t,r){n!==t&&(t[r++]=n[e++],t[r++]=n[e++],t[r]=n[e])}function gn(n,e,t,r){t[r++]=ie*(n[e++]/g.earth.radius),t[r++]=ie*(Math.PI/2-2*Math.atan(Math.exp(-n[e++]/g.earth.radius))),t[r]=n[e]}function yn(n,e,t,r){gn(n,e,t,r),zn(t,r,t,r)}function En(n,e,t,r){gn(n,e,t,r),Xn(t,r,t,r)}function Sn(n,e,t,r,l){const i=.4999999*Math.PI,a=o.clamp(le*n[e+1],-i,i),u=Math.sin(a);t[r++]=le*n[e]*l.radius,t[r++]=l.halfSemiMajorAxis*Math.log((1+u)/(1-u)),t[r]=n[e+2]}function Nn(n,e,t,r){Sn(n,e,t,r,g.earth)}const jn=g.earth.radius*Math.PI/180,wn=180/(g.earth.radius*Math.PI);function Tn(n,e,t,r){t[r]=n[e]*jn,t[r+1]=n[e+1]*jn,t[r+2]=n[e+2]}function Cn(n,e,t,r){t[r]=n[e]*wn,t[r+1]=n[e+1]*wn,t[r+2]=n[e+2]}function In(n,e,t,r){gn(n,e,t,r),Tn(t,r,t,r)}function Fn(n,e,t,r){Hn(n,e,t,r),Tn(t,r,t,r)}function xn(n,e,t,r){_n(n,e,t,r),Tn(t,r,t,r)}function bn(n,e,t,r){Cn(n,e,t,r),zn(t,r,t,r)}function Wn(n,e,t,r){Cn(n,e,t,r),Nn(t,r,t,r)}function qn(n,e,t,r){Cn(n,e,t,r),Xn(t,r,t,r)}function Ln(n){if(l.isNone(n))return!1;const e=Rn(n,ee);return!!Jn[e][6]}function kn(n,e,t,r,o=0){const l=r+o,i=Math.cos(t);n[0]=Math.cos(e)*i*l,n[1]=Math.sin(e)*i*l,n[2]=Math.sin(t)*l}function Gn(n,e,t,r,o){const l=o+n[e+2],i=le*n[e+1],a=le*n[e],u=Math.cos(i);t[r++]=Math.cos(a)*u*l,t[r++]=Math.sin(a)*u*l,t[r]=Math.sin(i)*l}function vn(n,e,t,r){Gn(n,e,t,r,g.moon.radius)}function Un(n,e,t,r){Gn(n,e,t,r,g.mars.radius)}function zn(n,e,t,r){Gn(n,e,t,r,g.earth.radius)}function An(n,e,t,r,l){const i=n[e],a=n[e+1],u=n[e+2],s=Math.sqrt(i*i+a*a+u*u),c=o.asinClamped(u/(0===s?1:s)),f=Math.atan2(a,i);t[r++]=ie*f,t[r++]=ie*c,t[r]=s-l}function Vn(n,e,t,r){An(n,e,t,r,g.moon.radius)}function Zn(n,e,t,r){An(n,e,t,r,g.mars.radius)}function _n(n,e,t,r){An(n,e,t,r,g.earth.radius)}function Bn(n,e,t,r){_n(n,e,t,r),Nn(t,r,t,r)}function Dn(n,e,t,r){_n(n,e,t,r),Xn(t,r,t,r)}function On(n,e,t,r,o){const l=le*n[e],i=le*n[e+1],a=n[e+2],u=Math.sin(i),s=Math.cos(i),c=o.radius/Math.sqrt(1-o.eccentricitySquared*u*u);t[r++]=(c+a)*s*Math.cos(l),t[r++]=(c+a)*s*Math.sin(l),t[r++]=(c*(1-o.eccentricitySquared)+a)*u}function Xn(n,e,t,r){On(n,e,t,r,g.earth)}function Hn(n,e,t,r){const o=y.earthEllipsoidConstants,l=n[e],i=n[e+1],a=n[e+2];let u,s,c,f,p,h,d,m,M,R,P,E,S,N,j,w,T,C,I,F,x;u=Math.abs(a),s=l*l+i*i,c=Math.sqrt(s),f=s+a*a,p=Math.sqrt(f),F=Math.atan2(i,l),h=a*a/f,d=s/f,N=o.a2/p,j=o.a3-o.a4/p,d>.3?(m=u/p*(1+d*(o.a1+N+h*j)/p),I=Math.asin(m),R=m*m,M=Math.sqrt(1-R)):(M=c/p*(1-h*(o.a5-N-d*j)/p),I=Math.acos(M),R=1-M*M,m=Math.sqrt(R)),P=1-g.earth.eccentricitySquared*R,E=g.earth.radius/Math.sqrt(P),S=o.a6*E,N=c-E*M,j=u-S*m,T=M*N+m*j,w=M*j-m*N,C=w/(S/P+T),I+=C,x=T+w*C/2,a<0&&(I=-I),t[r++]=ie*F,t[r++]=ie*I,t[r]=x}function Kn(n,e,t,r){Hn(n,e,t,r),zn(t,r,t,r)}function Yn(n,e,t,r){Hn(n,e,t,r),Nn(t,r,t,r)}const Jn={2:{5:null,8:null,10:null,11:Pn,6:Pn,1:zn,7:null,9:null,0:null,3:Nn,12:Tn,2:Pn,4:Xn},5:{5:Pn,8:null,10:null,11:Pn,6:Pn,1:zn,7:null,9:null,0:null,3:null,12:Tn,2:null,4:Xn},8:{5:null,8:Pn,10:null,11:Pn,6:null,1:null,7:Un,9:null,0:null,3:null,12:null,2:null,4:null},10:{5:null,8:null,10:Pn,11:Pn,6:null,1:null,7:null,9:vn,0:null,3:null,12:null,2:null,4:null},3:{5:null,8:null,10:null,11:gn,6:gn,1:yn,7:null,9:null,0:null,3:Pn,12:In,2:gn,4:En},4:{5:Hn,8:null,10:null,11:Hn,6:Hn,1:Kn,7:null,9:null,0:null,3:Yn,12:Fn,2:Hn,4:Pn},1:{5:_n,8:null,10:null,11:_n,6:_n,1:Pn,7:null,9:null,0:null,3:Bn,12:xn,2:_n,4:Dn},7:{5:null,8:Zn,10:null,11:Zn,6:null,1:null,7:Pn,9:null,0:null,3:null,12:null,2:null,4:null},9:{5:null,8:null,10:Vn,11:Vn,6:null,1:null,7:null,9:Pn,0:null,3:null,12:null,2:null,4:null},0:{5:null,8:null,10:null,11:null,6:null,1:null,7:null,9:null,0:Pn,3:null,12:null,2:null,4:null},11:{5:Pn,8:Pn,10:Pn,11:Pn,6:Pn,1:zn,7:Un,9:vn,0:null,3:Nn,12:Tn,2:Pn,4:Xn},6:{5:null,8:null,10:null,11:Pn,6:Pn,1:zn,7:null,9:null,0:null,3:null,12:Tn,2:Pn,4:Xn},12:{5:Cn,8:null,10:null,11:Cn,6:Cn,1:bn,7:null,9:null,0:null,3:Wn,12:Pn,2:Cn,4:qn}};function Qn(n,e,t=ne()){return l.isNone(n)||l.isNone(e)?null:$n(n,e,t).projector}function $n(n,e,t){if(l.isNone(n)||l.isNone(e)||t.source.spatialReference===n&&t.dest.spatialReference===e)return t;const r=Rn(n,t.source),o=Rn(e,t.dest);return 0===r&&0===o?S.equals(n,e)?t.projector=Pn:t.projector=null:t.projector=Jn[r][o],t}function ne(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:Pn}}const ee={spatialReference:null,spatialReferenceId:0},te={spatialReference:null,spatialReferenceId:0},re=ne(),oe=ne(),le=o.deg2rad(1),ie=o.rad2deg(1),ae=c.create(),ue=c.create(),se=c.create(),ce=c.create(),fe=c.create();e.canProjectToWGS84ComparableLonLat=Ln,e.canProjectWithoutEngine=G,e.computeENUToSphericalPCPFLocalRotation=mn,e.computeSphericalPCPFToENULocalRotation=Mn,e.computeTranslationToOriginAndRotation=hn,e.getProjectorName=z,e.getTransformation=W,e.getTransformations=q,e.initializeProjection=v,e.isLoaded=C,e.isSupported=I,e.load=F,e.localLinearScaleFactors=pn,e.lonLatToSphericalPCPF=kn,e.lonLatToWebMercatorComparable=Sn,e.project=x,e.projectBoundingRect=fn,e.projectBoundingSphere=sn,e.projectBuffer=ln,e.projectDirection=an,e.projectExtent=K,e.projectMany=b,e.projectMultipoint=_,e.projectPoint=V,e.projectPointToVector=$,e.projectPointToWGS84ComparableLonLat=tn,e.projectPolygon=X,e.projectPolyline=D,e.projectVectorToDehydratedPoint=Q,e.projectVectorToPoint=J,e.projectVectorToVector=en,e.projectVectorToWGS84ComparableLonLat=rn,e.projectWithoutEngine=A,e.projectXYZToVector=nn,e.sphericalPCPFtoLonLatElevation=An,e.unload=k,Object.defineProperty(e,"__esModule",{value:!0})}));
