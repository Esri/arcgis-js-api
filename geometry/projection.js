/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["require","exports","../chunks/_rollupPluginBabelHelpers","../core/Error","../core/mathUtils","../core/maybe","../core/promiseUtils","../core/unitUtils","../chunks/mat4","../chunks/vec3","../chunks/vec3f64","./Extent","./Multipoint","../chunks/pe","./Point","./Polygon","./Polyline","./projectionEllipsoid","./support/aaBoundingRect","./support/Ellipsoid","./support/geodesicConstants","./support/GeographicTransformation","./support/spatialReferenceUtils"],(function(n,e,t,r,o,l,i,a,u,s,c,f,p,h,d,M,m,R,P,y,g,E,N){"use strict";let j=null,w=null,T=null,S={};function C(){return!!j&&h.isLoaded()}function x(){return!0}function F(e){return l.isNone(T)&&(T=Promise.all([h.load(),new Promise((function(e,t){n(["../chunks/geometryEngineBase"],e,t)})).then((function(n){return n.geometryEngineBase})),new Promise((function(e,t){n(["./geometryAdapters/hydrated"],e,t)}))])),T.then((([,n,{hydratedAdapter:t}])=>{i.throwIfAborted(e),w=t,j=n.default,j._enableProjection(h.pe)}))}function b(n,e,t=null){return Array.isArray(n)?0===n.length?[]:I(w,n,n[0].spatialReference,e,t):I(w,[n],n.spatialReference,e,t)[0]}function I(n,e,t,r,o=null){if(l.isNone(t)||l.isNone(r))return e;if(G(t,r,o))return e.map((n=>A(n,t,r)));if(l.isNone(o)){const n=E.cacheKey(t,r);void 0!==S[n]?o=S[n]:(o=L(t,r,null),l.isNone(o)&&(o=new E),S[n]=o)}if(l.isNone(j))throw new W;return j._project(n,e,t,r,o)}function L(n,e,t=null){if(l.isNone(j))throw new W;if(l.isNone(n)||l.isNone(e))return null;const r=j._getTransformation(w,n,e,t,null==t?void 0:t.spatialReference);return null!==r?E.fromGE(r):null}function q(n,e,t=null){if(l.isNone(j))throw new W;const r=j._getTransformationBySuitability(w,n,e,t,null==t?void 0:t.spatialReference);if(null!==r){const n=[];for(const e of r)n.push(E.fromGE(e));return n}return[]}let W=function(n){function e(){return n.call(this,"projection:not-loaded","projection engine not fully loaded yet, please call load()")||this}return t._inheritsLoose(e,n),e}(r);function k(){j=null,w=null,T=null,S={}}function G(n,e,t){return!t&&(!!N.equals(n,e)||N.isValid(n)&&N.isValid(e)&&!!An(n,e,Dn))}function v(n,e,t,r){return z.apply(this,arguments)}function z(){return(z=t._asyncToGenerator((function*(n,e,t,r){if(!C())if(Array.isArray(n)){for(const{source:o,dest:l,geographicTransformation:i}of n)if(!G(o,l,i))return F(r)}else if(!G(n,e,t))return F(r)}))).apply(this,arguments)}function U(n,e){switch(An(n,e,Dn)){case mn:return"copy3";case Cn:return"wgs84ToSphericalECEF";case En:return"wgs84ToWebMercator";case kn:return"wgs84ToWGS84ECEF";case Rn:return"webMercatorToWGS84";case Pn:return"webMercatorToSphericalECEF";case yn:return"webMercatorToWGS84ECEF";case Gn:return"wgs84ECEFToWGS84";case vn:return"wgs84ECEFToSphericalECEF";case zn:return"wgs84ECEFToWebMercator";case In:return"sphericalECEFToWGS84";case Ln:return"sphericalECEFToWebMercator";case bn:return"sphericalMarsPCPFToMars2000";case Fn:return"sphericalMoonPCPFToMoon2000";case qn:return"sphericalECEFToWGS84ECEF";case Sn:return"mars2000ToSphericalPCPF";case Tn:return"moon2000ToSphericalPCPF";default:return null}}function A(n,e,t){if(!n)return n;if("x"in n){const r=new d;return Z(n,e,r,t)?r:null}if("xmin"in n){const r=new f;return Y(n,e,r,t)?r:null}if("rings"in n){const r=new M;return K(n,e,r,t)?r:null}if("paths"in n){const r=new m;return X(n,e,r,t)?r:null}if("points"in n){const r=new p;return B(n,e,r,t)?r:null}return null}function V(n,e,t=e.spatialReference,r=0){return!l.isNone(t)&&Z(n,n.spatialReference,e,t,r)}function Z(n,e,t,r,o=0){Qn[0]=n.x,Qn[1]=n.y;const l=n.z;return Qn[2]=void 0!==l?l:o,!!ln(Qn,e,0,Qn,r,0,1)&&(t.x=Qn[0],t.y=Qn[1],t.spatialReference=r,void 0===l?(t.z=void 0,t.hasZ=!1):(t.z=Qn[2],t.hasZ=!0),void 0===n.m?(t.m=void 0,t.hasM=!1):(t.m=n.m,t.hasM=!0),!0)}function _(n,e,t=e.spatialReference,r=0){return!l.isNone(t)&&B(n,n.spatialReference,e,t,r)}function B(n,e,t,r,o=0){const{points:l,hasZ:i,hasM:a}=n,u=[],s=l.length,c=[];for(const f of l)c.push(f[0],f[1],i?f[2]:o);if(!ln(c,e,0,c,r,0,s))return!1;for(let f=0;f<s;++f){const n=3*f,e=c[n],t=c[n+1];i&&a?u.push([e,t,c[n+2],l[f][3]]):i?u.push([e,t,c[n+2]]):a?u.push([e,t,l[f][2]]):u.push([e,t])}return t.points=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,!0}function D(n,e,t=e.spatialReference,r=0){return!l.isNone(t)&&X(n,n.spatialReference,e,t,r)}function X(n,e,t,r,o=0){const{paths:l,hasZ:i,hasM:a}=n,u=[];return!!un(l,i,a,e,u,r,o)&&(t.paths=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,!0)}function H(n,e,t=e.spatialReference,r=0){return!l.isNone(t)&&K(n,n.spatialReference,e,t,r)}function K(n,e,t,r,o=0){const{rings:l,hasZ:i,hasM:a}=n,u=[];return!!un(l,i,a,e,u,r,o)&&(t.rings=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,!0)}function O(n,e,t=e.spatialReference,r=0){return!l.isNone(t)&&Y(n,n.spatialReference,e,t,r)}function Y(n,e,t,r,o=0){const{xmin:l,ymin:i,xmax:a,ymax:u,hasZ:s,hasM:c}=n;if(!nn(l,i,s?n.zmin:o,e,Qn,r))return!1;t.xmin=Qn[0],t.ymin=Qn[1],s&&(t.zmin=Qn[2]);return!!nn(a,u,s?n.zmax:o,e,Qn,r)&&(t.xmax=Qn[0],t.ymax=Qn[1],s&&(t.zmax=Qn[2]),c&&(t.mmin=n.mmin,t.mmax=n.mmax),t.spatialReference=r,!0)}function J(n,e,t){if(l.isNone(e)||l.isNone(t))return null;const r=new d({spatialReference:t});return ln(n,e,0,Qn,t,0,1)?(r.x=Qn[0],r.y=Qn[1],r.z=Qn[2],r):null}function Q(n,e,t){return ln(n,e,0,Qn,t.spatialReference,0,1)?(t.x=Qn[0],t.y=Qn[1],t.z=Qn[2],t):null}function $(n,e,t,r=0){Qn[0]=n.x,Qn[1]=n.y;const o=n.z;return Qn[2]=void 0!==o?o:r,ln(Qn,n.spatialReference,0,e,t,0,1)}function nn(n,e,t,r,o,l){return On[0]=n,On[1]=e,On[2]=t,ln(On,r,0,o,l,0,1)}function en(n,e,t,r){return!(l.isNone(e)||l.isNone(r)||n.length<2)&&(2===n.length&&(On[0]=n[0],On[1]=n[1],On[2]=0,n=On),ln(n,e,0,t,r,0,1))}function tn(n,e){Qn[0]=n.x,Qn[1]=n.y;const t=n.z;return Qn[2]=void 0!==t?t:0,rn(Qn,n.spatialReference,e)}function rn(n,e,t){return on(n,e,t)}function on(n,e,t){if(l.isNone(e))return!1;const r=Mn(e,_n),o=Un[r][6];return!l.isNone(o)&&(o(n,0,On,0),t!==On&&(t[0]=On[0],t[1]=On[1],t.length>2&&(t[2]=On[2])),!0)}function ln(n,e,t,r,o,i,a=1){const u=An(e,o,Dn);if(l.isNone(u))return!1;if(u===mn){if(n===r&&t===i)return!0;const e=t+3*a;for(let o=t,l=i;o<e;o++,l++)r[l]=n[o];return!0}const s=t+3*a;for(let l=t,c=i;l<s;l+=3,c+=3)u(n,l,r,c);return!0}function an(n,e,t,r,o){s.copy(Qn,n),s.add($n,n,e),en(Qn,t,Qn,o),en($n,t,$n,o),s.subtract(r,$n,Qn),s.normalize(r,r)}function un(n,e,t,r,o,l,i=0){const a=new Array;for(const s of n)for(const n of s)a.push(n[0],n[1],e?n[2]:i);if(!ln(a,r,0,a,l,0,a.length/3))return!1;let u=0;o.length=0;for(const s of n){const n=new Array;for(const r of s)e&&t?n.push([a[u++],a[u++],a[u++],r[3]]):e?n.push([a[u++],a[u++],a[u++]]):t?(n.push([a[u++],a[u++],r[2]]),u++):(n.push([a[u++],a[u++]]),u++);o.push(n)}return!0}function sn(n,e,t,r){if(l.isNone(e)||l.isNone(r))return!1;const o=Vn(e,r,Xn);if(o.projector===mn)return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],!0;if(l.isNone(o.projector))return!1;const{source:i,dest:a}=o;if(3===a.spatialReferenceId){const e=Un[i.spatialReferenceId][2];if(l.isNone(e))return!1;e(n,0,Yn,0);const r=Math.abs(Hn*Yn[1])+Math.asin(n[3]/(y.earth.radius+n[2]));if(En(Yn,0,t,0),r>.9999*Math.PI)t[3]=Number.MAX_VALUE;else{const e=1/Math.cos(r);t[3]=e*n[3]}return!0}return o.projector(n,0,t,0),t[3]=n[3]*i.metersPerUnit/a.metersPerUnit,!0}function cn(n,e,t,r){return null!=n&&(N.equals(e,r)?(P.set(t,n),!0):(On[0]=n[0],On[1]=n[1],On[2]=0,!!ln(On,e,0,On,r,0,1)&&(t[0]=On[0],t[1]=On[1],On[0]=n[2],On[1]=n[3],On[2]=0,!!ln(On,e,0,On,r,0,1)&&(t[2]=On[0],t[3]=On[1],!0))))}function fn(n,e,t,r){if(l.isNone(e)||l.isNone(r))return!1;const o=Mn(e,_n),i=Mn(r,Bn);if(o===i&&0!==o||N.equals(e,r))return t[0]=1,t[1]=1,t[2]=1,!0;if(1===o){const e=s.length(n),r=e/Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=e/y.earth.radius;if(3===i)return t[0]=r*o,t[1]=r*o,t[2]=1,!0;if(2===i||5===i){const n=180/(y.earth.radius*Math.PI);return t[0]=n*r*o,t[1]=n*o,t[2]=1,!0}}return!1}function pn(n,e,t,r){if(l.isNone(n)||l.isNone(r))return!1;const o=Mn(n,_n),i=Mn(r,Bn);if(o===i&&!hn(i)&&(0!==o||N.equals(n,r)))return u.identity(t),u.translate(t,t,e),!0;if(hn(i)){let n=0,r=0;const a=Un[o][11],u=Un[11][i];return!l.isNone(a)&&!l.isNone(u)&&(a(e,0,Yn,0),u(Yn,0,Jn,0),n=Hn*Yn[0],r=Hn*Yn[1],dn(r,n,t),t[12]=Jn[0],t[13]=Jn[1],t[14]=Jn[2],!0)}if(3===i&&(2===o||1===o)){const n=Un[o][11];if(l.isNone(n))return!1;n(e,0,Yn,0);const r=Hn*Yn[1];En(Yn,0,Jn,0),u.identity(t),u.translate(t,t,Jn);const i=1/Math.cos(r);return u.scale(t,t,[i,i,1]),!0}return!1}function hn(n){return 1===n||7===n||9===n}function dn(n,e,t){const r=Math.sin(e),o=Math.cos(e),l=Math.sin(n),i=Math.cos(n),a=t;return a[0]=-r,a[4]=-l*o,a[8]=i*o,a[12]=0,a[1]=o,a[5]=-l*r,a[9]=i*r,a[13]=0,a[2]=0,a[6]=i,a[10]=l,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function Mn(n,e){return e.spatialReference===n?e.spatialReferenceId:(e.spatialReference=n,"metersPerUnit"in e&&(e.metersPerUnit=a.getMetersPerUnitForSR(n,1)),n.wkt===R.SphericalECEFSpatialReference.wkt?e.spatialReferenceId=1:N.isWGS84(n)?e.spatialReferenceId=2:N.isWebMercator(n)?e.spatialReferenceId=3:n.wkt===R.WGS84ECEFSpatialReference.wkt?e.spatialReferenceId=4:4490===n.wkid?e.spatialReferenceId=5:n.wkt===R.SphericalPCPFMars.wkt?e.spatialReferenceId=7:n.wkt===R.SphericalPCPFMoon.wkt?e.spatialReferenceId=9:N.isMars(n)?e.spatialReferenceId=8:N.isMoon(n)?e.spatialReferenceId=10:e.spatialReferenceId=0)}function mn(n,e,t,r){n!==t&&(t[r++]=n[e++],t[r++]=n[e++],t[r]=n[e])}function Rn(n,e,t,r){t[r++]=Kn*(n[e++]/y.earth.radius),t[r++]=Kn*(Math.PI/2-2*Math.atan(Math.exp(-1*n[e++]/y.earth.radius))),t[r]=n[e]}function Pn(n,e,t,r){Rn(n,e,t,r),Cn(t,r,t,r)}function yn(n,e,t,r){Rn(n,e,t,r),kn(t,r,t,r)}function gn(n,e,t,r,l){const i=.4999999*Math.PI,a=o.clamp(Hn*n[e+1],-i,i),u=Math.sin(a);t[r++]=Hn*n[e]*l.radius,t[r++]=l.halfSemiMajorAxis*Math.log((1+u)/(1-u)),t[r]=n[e+2]}function En(n,e,t,r){gn(n,e,t,r,y.earth)}function Nn(n){if(l.isNone(n))return!1;const e=Mn(n,_n);return!!Un[e][6]}function jn(n,e,t,r,o=0){const l=r+o,i=Math.cos(t);n[0]=Math.cos(e)*i*l,n[1]=Math.sin(e)*i*l,n[2]=Math.sin(t)*l}function wn(n,e,t,r,o){const l=o+n[e+2],i=Hn*n[e+1],a=Hn*n[e],u=Math.cos(i);t[r++]=Math.cos(a)*u*l,t[r++]=Math.sin(a)*u*l,t[r]=Math.sin(i)*l}function Tn(n,e,t,r){wn(n,e,t,r,y.moon.radius)}function Sn(n,e,t,r){wn(n,e,t,r,y.mars.radius)}function Cn(n,e,t,r){wn(n,e,t,r,y.earth.radius)}function xn(n,e,t,r,l){const i=n[e],a=n[e+1],u=n[e+2],s=Math.sqrt(i*i+a*a+u*u),c=o.asinClamped(u/(0===s?1:s)),f=Math.atan2(a,i);t[r++]=Kn*f,t[r++]=Kn*c,t[r]=s-l}function Fn(n,e,t,r){xn(n,e,t,r,y.moon.radius)}function bn(n,e,t,r){xn(n,e,t,r,y.mars.radius)}function In(n,e,t,r){xn(n,e,t,r,y.earth.radius)}function Ln(n,e,t,r){In(n,e,t,r),En(t,r,t,r)}function qn(n,e,t,r){In(n,e,t,r),kn(t,r,t,r)}function Wn(n,e,t,r,o){const l=Hn*n[e],i=Hn*n[e+1],a=n[e+2],u=Math.sin(i),s=Math.cos(i),c=o.radius/Math.sqrt(1-o.eccentricitySquared*u*u);t[r++]=(c+a)*s*Math.cos(l),t[r++]=(c+a)*s*Math.sin(l),t[r++]=(c*(1-o.eccentricitySquared)+a)*u}function kn(n,e,t,r){Wn(n,e,t,r,y.earth)}function Gn(n,e,t,r){const o=g.earthEllipsoidConstants,l=n[e],i=n[e+1],a=n[e+2];let u,s,c,f,p,h,d,M,m,R,P,E,N,j,w,T,S,C,x,F,b;u=Math.abs(a),s=l*l+i*i,c=Math.sqrt(s),f=s+a*a,p=Math.sqrt(f),F=Math.atan2(i,l),h=a*a/f,d=s/f,j=o.a2/p,w=o.a3-o.a4/p,d>.3?(M=u/p*(1+d*(o.a1+j+h*w)/p),x=Math.asin(M),R=M*M,m=Math.sqrt(1-R)):(m=c/p*(1-h*(o.a5-j-d*w)/p),x=Math.acos(m),R=1-m*m,M=Math.sqrt(R)),P=1-y.earth.eccentricitySquared*R,E=y.earth.radius/Math.sqrt(P),N=o.a6*E,j=c-E*m,w=u-N*M,S=m*j+M*w,T=m*w-M*j,C=T/(N/P+S),x+=C,b=S+T*C/2,a<0&&(x=-x),t[r++]=Kn*F,t[r++]=Kn*x,t[r]=b}function vn(n,e,t,r){Gn(n,e,t,r),Cn(t,r,t,r)}function zn(n,e,t,r){Gn(n,e,t,r),En(t,r,t,r)}const Un={2:{5:null,8:null,10:null,11:mn,6:mn,1:Cn,7:null,9:null,0:null,3:En,2:mn,4:kn},5:{5:mn,8:null,10:null,11:mn,6:mn,1:Cn,7:null,9:null,0:null,3:null,2:null,4:kn},8:{5:null,8:mn,10:null,11:mn,6:null,1:null,7:Sn,9:null,0:null,3:null,2:null,4:null},10:{5:null,8:null,10:mn,11:mn,6:null,1:null,7:null,9:Tn,0:null,3:null,2:null,4:null},3:{5:null,8:null,10:null,11:Rn,6:Rn,1:Pn,7:null,9:null,0:null,3:mn,2:Rn,4:yn},4:{5:Gn,8:null,10:null,11:Gn,6:Gn,1:vn,7:null,9:null,0:null,3:zn,2:Gn,4:mn},1:{5:In,8:null,10:null,11:In,6:In,1:mn,7:null,9:null,0:null,3:Ln,2:In,4:qn},7:{5:null,8:bn,10:null,11:bn,6:null,1:null,7:mn,9:null,0:null,3:null,2:null,4:null},9:{5:null,8:null,10:Fn,11:Fn,6:null,1:null,7:null,9:mn,0:null,3:null,2:null,4:null},0:{5:null,8:null,10:null,11:null,6:null,1:null,7:null,9:null,0:mn,3:null,2:null,4:null},11:{5:mn,8:mn,10:mn,11:mn,6:mn,1:Cn,7:Sn,9:Tn,0:null,3:En,2:mn,4:kn},6:{5:null,8:null,10:null,11:mn,6:mn,1:Cn,7:null,9:null,0:null,3:null,2:mn,4:kn}};function An(n,e,t=Zn()){return l.isNone(n)||l.isNone(e)?null:Vn(n,e,t).projector}function Vn(n,e,t){if(l.isNone(n)||l.isNone(e)||t.source.spatialReference===n&&t.dest.spatialReference===e)return t;const r=Mn(n,t.source),o=Mn(e,t.dest);return 0===r&&0===o?N.equals(n,e)?t.projector=mn:t.projector=null:t.projector=Un[r][o],t}function Zn(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:mn}}const _n={spatialReference:null,spatialReferenceId:0},Bn={spatialReference:null,spatialReferenceId:0},Dn=Zn(),Xn=Zn(),Hn=o.deg2rad(1),Kn=o.rad2deg(1),On=c.create(),Yn=c.create(),Jn=c.create(),Qn=c.create(),$n=c.create();e.canProjectToWGS84ComparableLonLat=Nn,e.canProjectWithoutEngine=G,e.computeLatLonToENURotation=dn,e.computeLinearTransformation=pn,e.getProjectorName=U,e.getTransformation=L,e.getTransformations=q,e.initializeProjection=v,e.isLoaded=C,e.isSupported=x,e.load=F,e.localLinearScaleFactors=fn,e.lonLatToSphericalPCPF=jn,e.lonLatToWebMercatorComparable=gn,e.project=b,e.projectBoundingRect=cn,e.projectBoundingSphere=sn,e.projectBuffer=ln,e.projectDirection=an,e.projectExtent=O,e.projectMany=I,e.projectMultipoint=_,e.projectPoint=V,e.projectPointToVector=$,e.projectPointToWGS84ComparableLonLat=tn,e.projectPolygon=H,e.projectPolyline=D,e.projectVectorToDehydratedPoint=Q,e.projectVectorToPoint=J,e.projectVectorToVector=en,e.projectVectorToWGS84ComparableLonLat=rn,e.projectXYZToVector=nn,e.sphericalPCPFtoLonLatElevation=xn,e.unload=k,Object.defineProperty(e,"__esModule",{value:!0})}));
