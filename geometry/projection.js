/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["require","exports","../chunks/_rollupPluginBabelHelpers","../core/maybe","../core/Error","../core/promiseUtils","./support/spatialReferenceUtils","./support/Ellipsoid","./Point","./Extent","./Multipoint","./Polygon","./Polyline","../core/mathUtils","../chunks/vec3f64","../chunks/vec3","./projectionEllipsoid","../core/unitUtils","../chunks/mat4","../chunks/pe","./support/aaBoundingRect","./support/geodesicConstants","./support/GeographicTransformation"],(function(n,e,t,r,o,l,i,a,u,s,c,f,p,h,d,M,m,R,P,g,E,N,y){"use strict";let j=null,w=null,T=null,S={};function C(){return!!j&&g.isLoaded()}function x(){return!0}function F(e){return r.isNone(T)&&(T=Promise.all([g.load(),new Promise((function(e,t){n(["../chunks/geometryEngineBase"],e,t)})).then((function(n){return n.geometryEngineBase})),new Promise((function(e,t){n(["./geometryAdapters/hydrated"],e,t)}))])),T.then((([,n,{hydratedAdapter:t}])=>{l.throwIfAborted(e),w=t,j=n.default,j._enableProjection(g.pe)}))}function b(n,e,t=null){return Array.isArray(n)?0===n.length?[]:I(w,n,n[0].spatialReference,e,t):I(w,[n],n.spatialReference,e,t)[0]}function I(n,e,t,o,l=null){if(r.isNone(t)||r.isNone(o))return e;if(v(t,o,l))return e.map((n=>U(n,t,o)));if(r.isNone(l)){const n=y.cacheKey(t,o);void 0!==S[n]?l=S[n]:(l=L(t,o,null),r.isNone(l)&&(l=new y),S[n]=l)}if(r.isNone(j))throw new W;return j._project(n,e,t,o,l)}function L(n,e,t=null){if(r.isNone(j))throw new W;if(r.isNone(n)||r.isNone(e))return null;const o=j._getTransformation(w,n,e,t,null==t?void 0:t.spatialReference);return null!==o?y.fromGE(o):null}function q(n,e,t=null){if(r.isNone(j))throw new W;const o=j._getTransformationBySuitability(w,n,e,t,null==t?void 0:t.spatialReference);if(null!==o){const n=[];for(const e of o)n.push(y.fromGE(e));return n}return[]}let W=function(n){function e(){return n.call(this,"projection:not-loaded","projection engine not fully loaded yet, please call load()")||this}return t._inheritsLoose(e,n),e}(o);function k(){j=null,w=null,T=null,S={}}function v(n,e,t){return!t&&(!!i.equals(n,e)||i.isValid(n)&&i.isValid(e)&&!!zn(n,e,_n))}async function G(n,e){if(!C())for(const{source:t,dest:r,geographicTransformation:o}of n)if(!v(t,r,o))return F(e)}function z(n,e){switch(zn(n,e,_n)){case dn:return"copy3";case Tn:return"wgs84ToSphericalECEF";case gn:return"wgs84ToWebMercator";case qn:return"wgs84ToWGS84ECEF";case Mn:return"webMercatorToWGS84";case mn:return"webMercatorToSphericalECEF";case Rn:return"webMercatorToWGS84ECEF";case Wn:return"wgs84ECEFToWGS84";case kn:return"wgs84ECEFToSphericalECEF";case vn:return"wgs84ECEFToWebMercator";case Fn:return"sphericalECEFToWGS84";case bn:return"sphericalECEFToWebMercator";case xn:return"sphericalMarsPCPFToMars2000";case Cn:return"sphericalMoonPCPFToMoon2000";case In:return"sphericalECEFToWGS84ECEF";case wn:return"mars2000ToSphericalPCPF";case jn:return"moon2000ToSphericalPCPF";default:return null}}function U(n,e,t){if(!n)return n;if("x"in n){const r=new u;return V(n,e,r,t)?r:null}if("xmin"in n){const r=new s;return O(n,e,r,t)?r:null}if("rings"in n){const r=new f;return H(n,e,r,t)?r:null}if("paths"in n){const r=new p;return D(n,e,r,t)?r:null}if("points"in n){const r=new c;return _(n,e,r,t)?r:null}return null}function A(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&V(n,n.spatialReference,e,t,o)}function V(n,e,t,r,o=0){Yn[0]=n.x,Yn[1]=n.y;const l=n.z;return Yn[2]=void 0!==l?l:o,!!on(Yn,e,0,Yn,r,0,1)&&(t.x=Yn[0],t.y=Yn[1],t.spatialReference=r,void 0===l?(t.z=void 0,t.hasZ=!1):(t.z=Yn[2],t.hasZ=!0),void 0===n.m?(t.m=void 0,t.hasM=!1):(t.m=n.m,t.hasM=!0),!0)}function Z(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&_(n,n.spatialReference,e,t,o)}function _(n,e,t,r,o=0){const{points:l,hasZ:i,hasM:a}=n,u=[],s=l.length,c=[];for(const f of l)c.push(f[0],f[1],i?f[2]:o);if(!on(c,e,0,c,r,0,s))return!1;for(let f=0;f<s;++f){const n=3*f,e=c[n],t=c[n+1];i&&a?u.push([e,t,c[n+2],l[f][3]]):i?u.push([e,t,c[n+2]]):a?u.push([e,t,l[f][2]]):u.push([e,t])}return t.points=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,!0}function B(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&D(n,n.spatialReference,e,t,o)}function D(n,e,t,r,o=0){const{paths:l,hasZ:i,hasM:a}=n,u=[];return!!an(l,i,a,e,u,r,o)&&(t.paths=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,!0)}function X(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&H(n,n.spatialReference,e,t,o)}function H(n,e,t,r,o=0){const{rings:l,hasZ:i,hasM:a}=n,u=[];return!!an(l,i,a,e,u,r,o)&&(t.rings=u,t.spatialReference=r,t.hasZ=i,t.hasM=a,!0)}function K(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&O(n,n.spatialReference,e,t,o)}function O(n,e,t,r,o=0){const{xmin:l,ymin:i,xmax:a,ymax:u,hasZ:s,hasM:c}=n;if(!$(l,i,s?n.zmin:o,e,Yn,r))return!1;t.xmin=Yn[0],t.ymin=Yn[1],s&&(t.zmin=Yn[2]);return!!$(a,u,s?n.zmax:o,e,Yn,r)&&(t.xmax=Yn[0],t.ymax=Yn[1],s&&(t.zmax=Yn[2]),c&&(t.mmin=n.mmin,t.mmax=n.mmax),t.spatialReference=r,!0)}function Y(n,e,t){if(r.isNone(e)||r.isNone(t))return null;const o=new u({spatialReference:t});return on(n,e,0,Yn,t,0,1)?(o.x=Yn[0],o.y=Yn[1],o.z=Yn[2],o):null}function J(n,e,t){return on(n,e,0,Yn,t.spatialReference,0,1)?(t.x=Yn[0],t.y=Yn[1],t.z=Yn[2],t):null}function Q(n,e,t,r=0){Yn[0]=n.x,Yn[1]=n.y;const o=n.z;return Yn[2]=void 0!==o?o:r,on(Yn,n.spatialReference,0,e,t,0,1)}function $(n,e,t,r,o,l){return Hn[0]=n,Hn[1]=e,Hn[2]=t,on(Hn,r,0,o,l,0,1)}function nn(n,e,t,o){return!(r.isNone(e)||r.isNone(o)||n.length<2)&&(2===n.length&&(Hn[0]=n[0],Hn[1]=n[1],Hn[2]=0,n=Hn),on(n,e,0,t,o,0,1))}function en(n,e){Yn[0]=n.x,Yn[1]=n.y;const t=n.z;return Yn[2]=void 0!==t?t:0,tn(Yn,n.spatialReference,e)}function tn(n,e,t){return rn(n,e,t,6)}function rn(n,e,t,o){if(r.isNone(e))return!1;const l=hn(e,Vn),i=Gn[l][o];return!r.isNone(i)&&(i(n,0,Hn,0),t!==Hn&&(t[0]=Hn[0],t[1]=Hn[1],t.length>2&&(t[2]=Hn[2])),!0)}function on(n,e,t,o,l,i,a=1){const u=zn(e,l,_n);if(r.isNone(u))return!1;if(u===dn){if(n===o&&t===i)return!0;const e=t+3*a;for(let r=t,l=i;r<e;r++,l++)o[l]=n[r];return!0}const s=t+3*a;for(let r=t,c=i;r<s;r+=3,c+=3)u(n,r,o,c);return!0}function ln(n,e,t,r,o){M.copy(Yn,n),M.add(Jn,n,e),nn(Yn,t,Yn,o),nn(Jn,t,Jn,o),M.subtract(r,Jn,Yn),M.normalize(r,r)}function an(n,e,t,r,o,l,i=0){const a=new Array;for(const s of n)for(const n of s)a.push(n[0],n[1],e?n[2]:i);if(!on(a,r,0,a,l,0,a.length/3))return!1;let u=0;o.length=0;for(const s of n){const n=new Array;for(const r of s)e&&t?n.push([a[u++],a[u++],a[u++],r[3]]):e?n.push([a[u++],a[u++],a[u++]]):t?(n.push([a[u++],a[u++],r[2]]),u++):(n.push([a[u++],a[u++]]),u++);o.push(n)}return!0}function un(n,e,t,o){if(r.isNone(e)||r.isNone(o))return!1;const l=Un(e,o,Bn);if(l.projector===dn)return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],!0;if(r.isNone(l.projector))return!1;const{source:i,dest:u}=l;if(3===u.spatialReferenceId){const e=Gn[i.spatialReferenceId][2];if(r.isNone(e))return!1;e(n,0,Kn,0);const o=Math.abs(Dn*Kn[1])+Math.asin(n[3]/(a.earth.radius+n[2]));if(gn(Kn,0,t,0),o>.9999*Math.PI)t[3]=Number.MAX_VALUE;else{const e=1/Math.cos(o);t[3]=e*n[3]}return!0}return l.projector(n,0,t,0),t[3]=n[3]*i.metersPerUnit/u.metersPerUnit,!0}function sn(n,e,t,r){return null!=n&&(i.equals(e,r)?(E.set(t,n),!0):(Hn[0]=n[0],Hn[1]=n[1],Hn[2]=0,!!on(Hn,e,0,Hn,r,0,1)&&(t[0]=Hn[0],t[1]=Hn[1],Hn[0]=n[2],Hn[1]=n[3],Hn[2]=0,!!on(Hn,e,0,Hn,r,0,1)&&(t[2]=Hn[0],t[3]=Hn[1],!0))))}function cn(n,e,t,o){if(r.isNone(e)||r.isNone(o))return!1;const l=hn(e,Vn),u=hn(o,Zn);if(l===u&&0!==l||i.equals(e,o))return t[0]=1,t[1]=1,t[2]=1,!0;if(1===l){const e=M.length(n),r=e/Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=e/a.earth.radius;if(3===u)return t[0]=r*o,t[1]=r*o,t[2]=1,!0;if(2===u||5===u){const n=180/(a.earth.radius*Math.PI);return t[0]=n*r*o,t[1]=n*o,t[2]=1,!0}}return!1}function fn(n,e,t,o){if(r.isNone(n)||r.isNone(o))return!1;const l=hn(n,Vn),a=hn(o,Zn);if(l===a&&1!==a&&(0!==l||i.equals(n,o)))return P.identity(t),P.translate(t,t,e),!0;if(1===a||7===a||9===a){let n=0,o=0;if(1===a){const t=Gn[l][6],i=Gn[6][a];if(r.isNone(t)||r.isNone(i))return!1;t(e,0,Kn,0),i(Kn,0,On,0),n=Dn*Kn[0],o=Dn*Kn[1]}else if(7===a||9===a){const t=Gn[l][a];if(r.isNone(t))return!1;t(e,0,On,0),n=Dn*e[0],o=Dn*e[1]}return pn(o,n,t),t[12]=On[0],t[13]=On[1],t[14]=On[2],!0}if(3===a&&(2===l||1===l)){const n=Gn[l][6];if(r.isNone(n))return!1;n(e,0,Kn,0);const o=Dn*Kn[1];gn(Kn,0,On,0),P.identity(t),P.translate(t,t,On);const i=1/Math.cos(o);return P.scale(t,t,[i,i,1]),!0}return!1}function pn(n,e,t){const r=Math.sin(e),o=Math.cos(e),l=Math.sin(n),i=Math.cos(n),a=t;return a[0]=-r,a[4]=-l*o,a[8]=i*o,a[12]=0,a[1]=o,a[5]=-l*r,a[9]=i*r,a[13]=0,a[2]=0,a[6]=i,a[10]=l,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function hn(n,e){return e.spatialReference===n?e.spatialReferenceId:(e.spatialReference=n,"metersPerUnit"in e&&(e.metersPerUnit=R.getMetersPerUnitForSR(n,1)),n.wkt===m.SphericalECEFSpatialReference.wkt?e.spatialReferenceId=1:i.isWGS84(n)?e.spatialReferenceId=2:i.isWebMercator(n)?e.spatialReferenceId=3:n.wkt===m.WGS84ECEFSpatialReference.wkt?e.spatialReferenceId=4:4490===n.wkid?e.spatialReferenceId=5:n.wkt===m.SphericalPCPFMars.wkt?e.spatialReferenceId=7:n.wkt===m.SphericalPCPFMoon.wkt?e.spatialReferenceId=9:i.isMars(n)?e.spatialReferenceId=8:i.isMoon(n)?e.spatialReferenceId=10:e.spatialReferenceId=0)}function dn(n,e,t,r){n!==t&&(t[r++]=n[e++],t[r++]=n[e++],t[r]=n[e])}function Mn(n,e,t,r){t[r++]=Xn*(n[e++]/a.earth.radius),t[r++]=Xn*(Math.PI/2-2*Math.atan(Math.exp(-1*n[e++]/a.earth.radius))),t[r]=n[e]}function mn(n,e,t,r){Mn(n,e,t,r),Tn(t,r,t,r)}function Rn(n,e,t,r){Mn(n,e,t,r),qn(t,r,t,r)}function Pn(n,e,t,r,o){const l=.4999999*Math.PI,i=h.clamp(Dn*n[e+1],-l,l),a=Math.sin(i);t[r++]=Dn*n[e]*o.radius,t[r++]=o.halfSemiMajorAxis*Math.log((1+a)/(1-a)),t[r]=n[e+2]}function gn(n,e,t,r){Pn(n,e,t,r,a.earth)}function En(n){if(r.isNone(n))return!1;const e=hn(n,Vn);return!!Gn[e][6]}function Nn(n,e,t,r,o=0){const l=r+o,i=Math.cos(t);n[0]=Math.cos(e)*i*l,n[1]=Math.sin(e)*i*l,n[2]=Math.sin(t)*l}function yn(n,e,t,r,o){const l=o+n[e+2],i=Dn*n[e+1],a=Dn*n[e],u=Math.cos(i);t[r++]=Math.cos(a)*u*l,t[r++]=Math.sin(a)*u*l,t[r]=Math.sin(i)*l}function jn(n,e,t,r){yn(n,e,t,r,a.moon.radius)}function wn(n,e,t,r){yn(n,e,t,r,a.mars.radius)}function Tn(n,e,t,r){yn(n,e,t,r,a.earth.radius)}function Sn(n,e,t,r,o){const l=n[e],i=n[e+1],a=n[e+2],u=Math.sqrt(l*l+i*i+a*a),s=h.asinClamped(a/(0===u?1:u)),c=Math.atan2(i,l);t[r++]=Xn*c,t[r++]=Xn*s,t[r]=u-o}function Cn(n,e,t,r){Sn(n,e,t,r,a.moon.radius)}function xn(n,e,t,r){Sn(n,e,t,r,a.mars.radius)}function Fn(n,e,t,r){Sn(n,e,t,r,a.earth.radius)}function bn(n,e,t,r){Fn(n,e,t,r),gn(t,r,t,r)}function In(n,e,t,r){Fn(n,e,t,r),qn(t,r,t,r)}function Ln(n,e,t,r,o){const l=Dn*n[e],i=Dn*n[e+1],a=n[e+2],u=Math.sin(i),s=Math.cos(i),c=o.radius/Math.sqrt(1-o.eccentricitySquared*u*u);t[r++]=(c+a)*s*Math.cos(l),t[r++]=(c+a)*s*Math.sin(l),t[r++]=(c*(1-o.eccentricitySquared)+a)*u}function qn(n,e,t,r){Ln(n,e,t,r,a.earth)}function Wn(n,e,t,r){const o=N.earthEllipsoidConstants,l=n[e],i=n[e+1],u=n[e+2];let s,c,f,p,h,d,M,m,R,P,g,E,y,j,w,T,S,C,x,F,b;s=Math.abs(u),c=l*l+i*i,f=Math.sqrt(c),p=c+u*u,h=Math.sqrt(p),F=Math.atan2(i,l),d=u*u/p,M=c/p,j=o.a2/h,w=o.a3-o.a4/h,M>.3?(m=s/h*(1+M*(o.a1+j+d*w)/h),x=Math.asin(m),P=m*m,R=Math.sqrt(1-P)):(R=f/h*(1-d*(o.a5-j-M*w)/h),x=Math.acos(R),P=1-R*R,m=Math.sqrt(P)),g=1-a.earth.eccentricitySquared*P,E=a.earth.radius/Math.sqrt(g),y=o.a6*E,j=f-E*R,w=s-y*m,S=R*j+m*w,T=R*w-m*j,C=T/(y/g+S),x+=C,b=S+T*C/2,u<0&&(x=-x),t[r++]=Xn*F,t[r++]=Xn*x,t[r]=b}function kn(n,e,t,r){Wn(n,e,t,r),Tn(t,r,t,r)}function vn(n,e,t,r){Wn(n,e,t,r),gn(t,r,t,r)}const Gn={2:{5:null,8:null,10:null,6:dn,1:Tn,7:null,9:null,0:null,3:gn,2:dn,4:qn},5:{5:dn,8:null,10:null,6:dn,1:Tn,7:null,9:null,0:null,3:null,2:null,4:qn},8:{5:null,8:dn,10:null,6:null,1:null,7:wn,9:null,0:null,3:null,2:null,4:null},10:{5:null,8:null,10:dn,6:null,1:null,7:null,9:jn,0:null,3:null,2:null,4:null},3:{5:null,8:null,10:null,6:Mn,1:mn,7:null,9:null,0:null,3:dn,2:Mn,4:Rn},4:{5:Wn,8:null,10:null,6:Wn,1:kn,7:null,9:null,0:null,3:vn,2:Wn,4:dn},1:{5:Fn,8:null,10:null,6:Fn,1:dn,7:null,9:null,0:null,3:bn,2:Fn,4:In},7:{5:null,8:xn,10:null,6:null,1:null,7:dn,9:null,0:null,3:null,2:null,4:null},9:{5:null,8:null,10:Cn,6:null,1:null,7:null,9:dn,0:null,3:null,2:null,4:null},0:{5:null,8:null,10:null,6:null,1:null,7:null,9:null,0:dn,3:null,2:null,4:null},6:{5:null,8:null,10:null,6:dn,1:Tn,7:null,9:null,0:null,3:null,2:dn,4:qn}};function zn(n,e,t=An()){return r.isNone(n)||r.isNone(e)?null:Un(n,e,t).projector}function Un(n,e,t){if(r.isNone(n)||r.isNone(e)||t.source.spatialReference===n&&t.dest.spatialReference===e)return t;const o=hn(n,t.source),l=hn(e,t.dest);return 0===o&&0===l?i.equals(n,e)?t.projector=dn:t.projector=null:t.projector=Gn[o][l],t}function An(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:dn}}const Vn={spatialReference:null,spatialReferenceId:0},Zn={spatialReference:null,spatialReferenceId:0},_n=An(),Bn=An(),Dn=h.deg2rad(1),Xn=h.rad2deg(1),Hn=d.create(),Kn=d.create(),On=d.create(),Yn=d.create(),Jn=d.create();e.canProjectToWGS84ComparableLonLat=En,e.canProjectWithoutEngine=v,e.computeLatLonToENURotation=pn,e.computeLinearTransformation=fn,e.getProjectorName=z,e.getTransformation=L,e.getTransformations=q,e.initializeProjection=G,e.isLoaded=C,e.isSupported=x,e.load=F,e.localLinearScaleFactors=cn,e.lonLatToSphericalPCPF=Nn,e.lonLatToWebMercatorComparable=Pn,e.project=b,e.projectBoundingRect=sn,e.projectBoundingSphere=un,e.projectBuffer=on,e.projectDirection=ln,e.projectExtent=K,e.projectMany=I,e.projectMultipoint=Z,e.projectPoint=A,e.projectPointToVector=Q,e.projectPointToWGS84ComparableLonLat=en,e.projectPolygon=X,e.projectPolyline=B,e.projectVectorToDehydratedPoint=J,e.projectVectorToPoint=Y,e.projectVectorToVector=nn,e.projectVectorToWGS84ComparableLonLat=tn,e.projectXYZToVector=$,e.sphericalPCPFtoLonLatElevation=Sn,e.unload=k,Object.defineProperty(e,"__esModule",{value:!0})}));
