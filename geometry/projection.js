/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["require","exports","../chunks/_rollupPluginBabelHelpers","../core/maybe","../core/Error","../core/promiseUtils","./support/spatialReferenceUtils","./support/Ellipsoid","./Point","./Extent","./Multipoint","./Polygon","./Polyline","../core/mathUtils","../chunks/vec3f64","../chunks/vec3","./projectionEllipsoid","../core/unitUtils","../chunks/mat4","../chunks/pe","./support/aaBoundingRect","./support/geodesicConstants","./support/GeographicTransformation"],(function(n,e,t,r,o,i,a,l,u,s,c,f,p,h,d,M,m,R,E,g,N,P,y){"use strict";let w=null,j=null,T=null,S={};function C(){return!!w&&g.isLoaded()}function x(e){return r.isNone(T)&&(T=i.all([g.load(),new Promise((function(e,t){n(["../chunks/geometryEngineBase"],e,t)})).then((function(n){return n.geometryEngineBase})),new Promise((function(e,t){n(["./geometryAdapters/hydrated"],e,t)}))])),T.then((([,n,{hydratedAdapter:t}])=>{i.throwIfAborted(e),j=t,w=n.default,w._enableProjection(g.pe)}))}function F(n,e,t,o,i=null){if(r.isNone(t)||r.isNone(o))return e;if(q(t,o,i))return e.map((n=>function(n,e,t){if(!n)return n;if("x"in n){const r=new u;return W(n,e,r,t)?r:null}if("xmin"in n){const r=new s;return G(n,e,r,t)?r:null}if("rings"in n){const r=new f;return v(n,e,r,t)?r:null}if("paths"in n){const r=new p;return L(n,e,r,t)?r:null}if("points"in n){const r=new c;return k(n,e,r,t)?r:null}return null}(n,t,o)));if(r.isNone(i)){const n=y.cacheKey(t,o);void 0!==S[n]?i=S[n]:(i=I(t,o,null),r.isNone(i)&&(i=new y),S[n]=i)}if(r.isNone(w))throw new b;return w._project(n,e,t,o,i)}function I(n,e,t=null){if(r.isNone(w))throw new b;if(r.isNone(n)||r.isNone(e))return null;const o=w._getTransformation(j,n,e,t,null==t?void 0:t.spatialReference);return null!==o?y.fromGE(o):null}let b=function(n){function e(){return n.call(this,"projection:not-loaded","projection engine not fully loaded yet, please call load()")||this}return t._inheritsLoose(e,n),e}(o);function q(n,e,t){return!t&&(!!a.equals(n,e)||a.isValid(n)&&a.isValid(e)&&!!hn(n,e,En))}function W(n,e,t,r,o=0){Tn[0]=n.x,Tn[1]=n.y;const i=n.z;return Tn[2]=void 0!==i?i:o,!!V(Tn,e,0,Tn,r,0,1)&&(t.x=Tn[0],t.y=Tn[1],t.spatialReference=r,void 0===i?(t.z=void 0,t.hasZ=!1):(t.z=Tn[2],t.hasZ=!0),void 0===n.m?(t.m=void 0,t.hasM=!1):(t.m=n.m,t.hasM=!0),!0)}function k(n,e,t,r,o=0){const{points:i,hasZ:a,hasM:l}=n,u=[],s=i.length,c=[];for(const n of i)c.push(n[0],n[1],a?n[2]:o);if(!V(c,e,0,c,r,0,s))return!1;for(let n=0;n<s;++n){const e=3*n,t=c[e],r=c[e+1];a&&l?u.push([t,r,c[e+2],i[n][3]]):a?u.push([t,r,c[e+2]]):l?u.push([t,r,i[n][2]]):u.push([t,r])}return t.points=u,t.spatialReference=r,t.hasZ=a,t.hasM=l,!0}function L(n,e,t,r,o=0){const{paths:i,hasZ:a,hasM:l}=n,u=[];return!!Z(i,a,l,e,u,r,o)&&(t.paths=u,t.spatialReference=r,t.hasZ=a,t.hasM=l,!0)}function v(n,e,t,r,o=0){const{rings:i,hasZ:a,hasM:l}=n,u=[];return!!Z(i,a,l,e,u,r,o)&&(t.rings=u,t.spatialReference=r,t.hasZ=a,t.hasM=l,!0)}function G(n,e,t,r,o=0){const{xmin:i,ymin:a,xmax:l,ymax:u,hasZ:s,hasM:c}=n;if(!z(i,a,s?n.zmin:o,e,Tn,r))return!1;t.xmin=Tn[0],t.ymin=Tn[1],s&&(t.zmin=Tn[2]);return!!z(l,u,s?n.zmax:o,e,Tn,r)&&(t.xmax=Tn[0],t.ymax=Tn[1],s&&(t.zmax=Tn[2]),c&&(t.mmin=n.mmin,t.mmax=n.mmax),t.spatialReference=r,!0)}function z(n,e,t,r,o,i){return yn[0]=n,yn[1]=e,yn[2]=t,V(yn,r,0,o,i,0,1)}function U(n,e,t,o){return!(r.isNone(e)||r.isNone(o)||n.length<2)&&(2===n.length&&(yn[0]=n[0],yn[1]=n[1],yn[2]=0,n=yn),V(n,e,0,t,o,0,1))}function A(n,e,t){return function(n,e,t,o){if(r.isNone(e))return!1;const i=D(e,mn),a=pn[i][o];if(r.isNone(a))return!1;a(n,0,yn,0),t!==yn&&(t[0]=yn[0],t[1]=yn[1],t.length>2&&(t[2]=yn[2]));return!0}(n,e,t,6)}function V(n,e,t,o,i,a,l=1){const u=hn(e,i,En);if(r.isNone(u))return!1;if(u===X){if(n===o&&t===a)return!0;const e=t+3*l;for(let r=t,i=a;r<e;r++,i++)o[i]=n[r];return!0}const s=t+3*l;for(let e=t,r=a;e<s;e+=3,r+=3)u(n,e,o,r);return!0}function Z(n,e,t,r,o,i,a=0){const l=new Array;for(const t of n)for(const n of t)l.push(n[0],n[1],e?n[2]:a);if(!V(l,r,0,l,i,0,l.length/3))return!1;let u=0;o.length=0;for(const r of n){const n=new Array;for(const o of r)e&&t?n.push([l[u++],l[u++],l[u++],o[3]]):e?n.push([l[u++],l[u++],l[u++]]):t?(n.push([l[u++],l[u++],o[2]]),u++):(n.push([l[u++],l[u++]]),u++);o.push(n)}return!0}function _(n,e,t){const r=Math.sin(e),o=Math.cos(e),i=Math.sin(n),a=Math.cos(n),l=t;return l[0]=-r,l[4]=-i*o,l[8]=a*o,l[12]=0,l[1]=o,l[5]=-i*r,l[9]=a*r,l[13]=0,l[2]=0,l[6]=a,l[10]=i,l[14]=0,l[3]=0,l[7]=0,l[11]=0,l[15]=1,l}var B;function D(n,e){return e.spatialReference===n?e.spatialReferenceId:(e.spatialReference=n,"metersPerUnit"in e&&(e.metersPerUnit=R.getMetersPerUnitForSR(n,1)),n.wkt===m.SphericalECEFSpatialReference.wkt?e.spatialReferenceId=1:a.isWGS84(n)?e.spatialReferenceId=2:a.isWebMercator(n)?e.spatialReferenceId=3:n.wkt===m.WGS84ECEFSpatialReference.wkt?e.spatialReferenceId=4:4490===n.wkid?e.spatialReferenceId=5:n.wkt===m.SphericalPCPFMars.wkt?e.spatialReferenceId=7:n.wkt===m.SphericalPCPFMoon.wkt?e.spatialReferenceId=9:a.isMars(n)?e.spatialReferenceId=8:a.isMoon(n)?e.spatialReferenceId=10:e.spatialReferenceId=0)}function X(n,e,t,r){n!==t&&(t[r++]=n[e++],t[r++]=n[e++],t[r]=n[e])}function H(n,e,t,r){t[r++]=Pn*(n[e++]/l.earth.radius),t[r++]=Pn*(Math.PI/2-2*Math.atan(Math.exp(-1*n[e++]/l.earth.radius))),t[r]=n[e]}function K(n,e,t,r){H(n,e,t,r),nn(t,r,t,r)}function O(n,e,t,r){H(n,e,t,r),un(t,r,t,r)}function Y(n,e,t,r){const o=.4999999*Math.PI,i=h.clamp(Nn*n[e+1],-o,o),a=Math.sin(i);t[r++]=Nn*n[e]*l.earth.radius,t[r++]=l.earth.halfSemiMajorAxis*Math.log((1+a)/(1-a)),t[r]=n[e+2]}function J(n,e,t,r,o){const i=o+n[e+2],a=Nn*n[e+1],l=Nn*n[e],u=Math.cos(a);t[r++]=Math.cos(l)*u*i,t[r++]=Math.sin(l)*u*i,t[r]=Math.sin(a)*i}function Q(n,e,t,r){J(n,e,t,r,l.moon.radius)}function $(n,e,t,r){J(n,e,t,r,l.mars.radius)}function nn(n,e,t,r){J(n,e,t,r,l.earth.radius)}function en(n,e,t,r,o){const i=n[e],a=n[e+1],l=n[e+2],u=Math.sqrt(i*i+a*a+l*l),s=h.asinClamped(l/(0===u?1:u)),c=Math.atan2(a,i);t[r++]=Pn*c,t[r++]=Pn*s,t[r]=u-o}function tn(n,e,t,r){en(n,e,t,r,l.moon.radius)}function rn(n,e,t,r){en(n,e,t,r,l.mars.radius)}function on(n,e,t,r){en(n,e,t,r,l.earth.radius)}function an(n,e,t,r){on(n,e,t,r),Y(t,r,t,r)}function ln(n,e,t,r){on(n,e,t,r),un(t,r,t,r)}function un(n,e,t,r){!function(n,e,t,r,o){const i=Nn*n[e],a=Nn*n[e+1],l=n[e+2],u=Math.sin(a),s=Math.cos(a),c=o.radius/Math.sqrt(1-o.eccentricitySquared*u*u);t[r++]=(c+l)*s*Math.cos(i),t[r++]=(c+l)*s*Math.sin(i),t[r++]=(c*(1-o.eccentricitySquared)+l)*u}(n,e,t,r,l.earth)}function sn(n,e,t,r){const o=P.earthEllipsoidConstants,i=n[e],a=n[e+1],u=n[e+2];let s,c,f,p,h,d,M,m,R,E,g,N,y,w,j,T,S,C,x,F,I;s=Math.abs(u),c=i*i+a*a,f=Math.sqrt(c),p=c+u*u,h=Math.sqrt(p),F=Math.atan2(a,i),d=u*u/p,M=c/p,w=o.a2/h,j=o.a3-o.a4/h,M>.3?(m=s/h*(1+M*(o.a1+w+d*j)/h),x=Math.asin(m),E=m*m,R=Math.sqrt(1-E)):(R=f/h*(1-d*(o.a5-w-M*j)/h),x=Math.acos(R),E=1-R*R,m=Math.sqrt(E)),g=1-l.earth.eccentricitySquared*E,N=l.earth.radius/Math.sqrt(g),y=o.a6*N,w=f-N*R,j=s-y*m,S=R*w+m*j,T=R*j-m*w,C=T/(y/g+S),x+=C,I=S+T*C/2,u<0&&(x=-x),t[r++]=Pn*F,t[r++]=Pn*x,t[r]=I}function cn(n,e,t,r){sn(n,e,t,r),nn(t,r,t,r)}function fn(n,e,t,r){sn(n,e,t,r),Y(t,r,t,r)}(B=e.webMercator||(e.webMercator={})).x2lon=function(n){return n/l.earth.radius},B.y2lat=function(n){return Math.PI/2-2*Math.atan(Math.exp(-1*n/l.earth.radius))},B.lon2x=function(n){return n*l.earth.radius},B.lat2y=function(n){const e=Math.sin(n);return l.earth.radius/2*Math.log((1+e)/(1-e))};const pn={2:{5:null,8:null,10:null,6:X,1:nn,7:null,9:null,0:null,3:Y,2:X,4:un},5:{5:X,8:null,10:null,6:X,1:nn,7:null,9:null,0:null,3:null,2:null,4:un},8:{5:null,8:X,10:null,6:null,1:null,7:$,9:null,0:null,3:null,2:null,4:null},10:{5:null,8:null,10:X,6:null,1:null,7:null,9:Q,0:null,3:null,2:null,4:null},3:{5:null,8:null,10:null,6:H,1:K,7:null,9:null,0:null,3:X,2:H,4:O},4:{5:sn,8:null,10:null,6:sn,1:cn,7:null,9:null,0:null,3:fn,2:sn,4:X},1:{5:on,8:null,10:null,6:on,1:X,7:null,9:null,0:null,3:an,2:on,4:ln},7:{5:null,8:rn,10:null,6:null,1:null,7:X,9:null,0:null,3:null,2:null,4:null},9:{5:null,8:null,10:tn,6:null,1:null,7:null,9:X,0:null,3:null,2:null,4:null},0:{5:null,8:null,10:null,6:null,1:null,7:null,9:null,0:X,3:null,2:null,4:null},6:{5:null,8:null,10:null,6:X,1:nn,7:null,9:null,0:null,3:null,2:X,4:un}};function hn(n,e,t=Mn()){return r.isNone(n)||r.isNone(e)?null:dn(n,e,t).projector}function dn(n,e,t){if(r.isNone(n)||r.isNone(e)||t.source.spatialReference===n&&t.dest.spatialReference===e)return t;const o=D(n,t.source),i=D(e,t.dest);return 0===o&&0===i?a.equals(n,e)?t.projector=X:t.projector=null:t.projector=pn[o][i],t}function Mn(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:X}}const mn={spatialReference:null,spatialReferenceId:0},Rn={spatialReference:null,spatialReferenceId:0},En=Mn(),gn=Mn(),Nn=h.deg2rad(1),Pn=h.rad2deg(1),yn=d.create(),wn=d.create(),jn=d.create(),Tn=d.create(),Sn=d.create();e.canProjectToWGS84ComparableLonLat=function(n){if(r.isNone(n))return!1;const e=D(n,mn);return!!pn[e][6]},e.canProjectWithoutEngine=q,e.computeLatLonToENURotation=_,e.computeLinearTransformation=function(n,e,t,o){if(r.isNone(n)||r.isNone(o))return!1;const i=D(n,mn),l=D(o,Rn);if(i===l&&1!==l&&(0!==i||a.equals(n,o)))return E.identity(t),E.translate(t,t,e),!0;if(1===l||7===l||9===l){let n=0,o=0;if(1===l){const t=pn[i][6],a=pn[6][l];if(r.isNone(t)||r.isNone(a))return!1;t(e,0,wn,0),a(wn,0,jn,0),n=Nn*wn[0],o=Nn*wn[1]}else if(7===l||9===l){const t=pn[i][l];if(r.isNone(t))return!1;t(e,0,jn,0),n=Nn*e[0],o=Nn*e[1]}return _(o,n,t),t[12]=jn[0],t[13]=jn[1],t[14]=jn[2],!0}if(3===l&&(2===i||1===i)){const n=pn[i][6];if(r.isNone(n))return!1;n(e,0,wn,0);const o=Nn*wn[1];Y(wn,0,jn,0),E.identity(t),E.translate(t,t,jn);const a=1/Math.cos(o);return E.scale(t,t,[a,a,1]),!0}return!1},e.getProjectorName=function(n,e){switch(hn(n,e,En)){case X:return"copy3";case nn:return"wgs84ToSphericalECEF";case Y:return"wgs84ToWebMercator";case un:return"wgs84ToWGS84ECEF";case H:return"webMercatorToWGS84";case K:return"webMercatorToSphericalECEF";case O:return"webMercatorToWGS84ECEF";case sn:return"wgs84ECEFToWGS84";case cn:return"wgs84ECEFToSphericalECEF";case fn:return"wgs84ECEFToWebMercator";case on:return"sphericalECEFToWGS84";case an:return"sphericalECEFToWebMercator";case rn:return"sphericalECEFToMars2000";case tn:return"sphericalECEFToMoon2000";case ln:return"sphericalECEFToWGS84ECEF";case $:return"mars2000ToSphericalPCPF";case Q:return"moon2000ToSphericalPCPF";default:return null}},e.getTransformation=I,e.getTransformations=function(n,e,t=null){if(r.isNone(w))throw new b;const o=w._getTransformationBySuitability(j,n,e,t,null==t?void 0:t.spatialReference);if(null!==o){const n=[];for(const e of o)n.push(y.fromGE(e));return n}return[]},e.initializeProjection=async function(n,e){if(!C())for(const{source:t,dest:r,geographicTransformation:o}of n)if(!q(t,r,o))return x(e)},e.isLoaded=C,e.isSupported=function(){return!0},e.load=x,e.localLinearScaleFactors=function(n,e,t,o){if(r.isNone(e)||r.isNone(o))return!1;const i=D(e,mn),u=D(o,Rn);if(i===u&&0!==i||a.equals(e,o))return t[0]=1,t[1]=1,t[2]=1,!0;if(1===i){const e=M.length(n),r=e/Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=e/l.earth.radius;if(3===u)return t[0]=r*o,t[1]=r*o,t[2]=1,!0;if(2===u||5===u){const n=180/(l.earth.radius*Math.PI);return t[0]=n*r*o,t[1]=n*o,t[2]=1,!0}}return!1},e.lonLatToSphericalPCPF=function(n,e,t,r,o=0){const i=r+o,a=Math.cos(t);n[0]=Math.cos(e)*a*i,n[1]=Math.sin(e)*a*i,n[2]=Math.sin(t)*i},e.project=function(n,e,t=null){return Array.isArray(n)?0===n.length?[]:F(j,n,n[0].spatialReference,e,t):F(j,[n],n.spatialReference,e,t)[0]},e.projectBoundingRect=function(n,e,t,r){return null!=n&&(a.equals(e,r)?(N.set(t,n),!0):(yn[0]=n[0],yn[1]=n[1],yn[2]=0,!!V(yn,e,0,yn,r,0,1)&&(t[0]=yn[0],t[1]=yn[1],yn[0]=n[2],yn[1]=n[3],yn[2]=0,!!V(yn,e,0,yn,r,0,1)&&(t[2]=yn[0],t[3]=yn[1],!0))))},e.projectBoundingSphere=function(n,e,t,o){if(r.isNone(e)||r.isNone(o))return!1;const i=dn(e,o,gn);if(i.projector===X)return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],!0;if(r.isNone(i.projector))return!1;const{source:a,dest:u}=i;if(3===u.spatialReferenceId){const e=pn[a.spatialReferenceId][2];if(r.isNone(e))return!1;e(n,0,wn,0);const o=Math.abs(Nn*wn[1])+Math.asin(n[3]/(l.earth.radius+n[2]));if(Y(wn,0,t,0),o>.9999*Math.PI)t[3]=Number.MAX_VALUE;else{const e=1/Math.cos(o);t[3]=e*n[3]}return!0}return i.projector(n,0,t,0),t[3]=n[3]*a.metersPerUnit/u.metersPerUnit,!0},e.projectBuffer=V,e.projectDirection=function(n,e,t,r,o){M.copy(Tn,n),M.add(Sn,n,e),U(Tn,t,Tn,o),U(Sn,t,Sn,o),M.subtract(r,Sn,Tn),M.normalize(r,r)},e.projectExtent=function(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&G(n,n.spatialReference,e,t,o)},e.projectMany=F,e.projectMultipoint=function(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&k(n,n.spatialReference,e,t,o)},e.projectPoint=function(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&W(n,n.spatialReference,e,t,o)},e.projectPointToVector=function(n,e,t,r=0){Tn[0]=n.x,Tn[1]=n.y;const o=n.z;return Tn[2]=void 0!==o?o:r,V(Tn,n.spatialReference,0,e,t,0,1)},e.projectPointToWGS84ComparableLonLat=function(n,e){Tn[0]=n.x,Tn[1]=n.y;const t=n.z;return Tn[2]=void 0!==t?t:0,A(Tn,n.spatialReference,e)},e.projectPolygon=function(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&v(n,n.spatialReference,e,t,o)},e.projectPolyline=function(n,e,t=e.spatialReference,o=0){return!r.isNone(t)&&L(n,n.spatialReference,e,t,o)},e.projectVectorToDehydratedPoint=function(n,e,t,o){return r.isNone(o)&&(o=t.spatialReference),V(n,e,0,Tn,o,0,1)?(t.x=Tn[0],t.y=Tn[1],t.z=Tn[2],t.spatialReference=o,t):null},e.projectVectorToPoint=function(n,e,t,o){return r.isNone(e)||r.isNone(t)?null:(o=r.isSome(o)?o:new u({spatialReference:t}),V(n,e,0,Tn,t,0,1)?(o.x=Tn[0],o.y=Tn[1],o.z=Tn[2],o.spatialReference=t,o):null)},e.projectVectorToVector=U,e.projectVectorToWGS84ComparableLonLat=A,e.projectXYZToVector=z,e.sphericalECEFToSphericalPCPF=en,e.unload=function(){w=null,j=null,T=null,S={}},Object.defineProperty(e,"__esModule",{value:!0})}));
