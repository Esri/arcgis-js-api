/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../core/maybe","../../core/Error","../../layers/support/arcgisLayerUrl","../HeightModelInfo"],(function(e,t,n,i,a,r){"use strict";function o(e,t){if(!e)return null;if(!l(e))return new i("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});const n=e.heightUnit,a=r.deriveUnitFromSR(e,t).heightUnit;return n!==a?new i("webscene:incompatible-height-unit",`The vertical units of the scene (${n}) must match the horizontal units of the scene (${a})`,{verticalUnit:n,horizontalUnit:a}):null}function s(e,t,n){const a=u(e),o=t,s=c(a,o,n);{let t=null;if(a){const o=r.deriveUnitFromSR(a,e.spatialReference).heightUnit;n||o===a.heightUnit||(t=new i("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o}))}if(!h(e)||4===s||t)return new i("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:a,error:t})}{let e=null;switch(s){case 1:{const t=a.heightUnit||"unknown",n=o.heightUnit||"unknown";e=new i("layerview:incompatible-height-unit",`The vertical units of the layer (${t}) must match the vertical units of the scene (${n})`,{layerUnit:t,sceneUnit:n});break}case 2:{const t=a.heightModel||"unknown",n=o.heightModel||"unknown";e=new i("layerview:incompatible-height-model",`The height model of the layer (${t}) must match the height model of the scene (${n})`,{layerHeightModel:t,sceneHeightModel:n});break}case 3:{const t=a.vertCRS||"unknown",n=o.vertCRS||"unknown";e=new i("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${t}) must match the vertical datum of the scene (${n})`,{layerDatum:t,sceneDatum:n});break}}if(e)return new i("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:o,error:e})}return null}function c(e,t,n){if(!l(e)||!l(t))return 4;if(null==e||null==t)return 0;if(!n&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===t.vertCRS?0:3;default:return 4}}function l(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function h(e){return"heightModelInfo"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!d(e)}function u(e){const t=e.url&&a.parse(e.url);return!(null==(e.spatialReference&&e.spatialReference.vcsWkid)&&n.isSome(t)&&"ImageServer"===t.serverType)&&f(e)&&e.heightModelInfo?e.heightModelInfo:d(e)?r.deriveUnitFromSR(v,e.spatialReference):null}function f(e){return"heightModelInfo"in e}function g(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"ogc-feature":return!0;case"imagery":case"map-image":case"map-notes":case"tile":case"vector-tile":case"scene":case null:default:return!1}}function d(e){return g(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):p(e)}function m(e){return null!=e.layers||p(e)||g(e)||f(e)}function p(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":case null:return!1}return!1}const v=new r({heightModel:"gravity-related-height"});e.deriveHeightModelInfoFromLayer=u,e.mayHaveHeightModelInfo=m,e.rejectLayerError=s,e.validateWebSceneError=o,Object.defineProperty(e,"__esModule",{value:!0})}));
