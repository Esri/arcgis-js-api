/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers"],(function(t,i){"use strict";const s=512;var n;t.GeometryType=void 0,(n=t.GeometryType||(t.GeometryType={}))[n.Unknown=0]="Unknown",n[n.Point=1]="Point",n[n.LineString=2]="LineString",n[n.Polygon=3]="Polygon";let h=function(){function t(t,i){this.x=t,this.y=i}var i=t.prototype;return i.clone=function(){return new t(this.x,this.y)},i.equals=function(t,i){return t===this.x&&i===this.y},i.isEqual=function(t){return t.x===this.x&&t.y===this.y},i.setCoords=function(t,i){this.x=t,this.y=i},i.normalize=function(){const t=this.x,i=this.y,s=Math.sqrt(t*t+i*i);this.x/=s,this.y/=s},i.rightPerpendicular=function(){const t=this.x;this.x=this.y,this.y=-t},i.move=function(t,i){this.x+=t,this.y+=i},i.assign=function(t){this.x=t.x,this.y=t.y},i.assignAdd=function(t,i){this.x=t.x+i.x,this.y=t.y+i.y},i.assignSub=function(t,i){this.x=t.x-i.x,this.y=t.y-i.y},i.rotate=function(t,i){const s=this.x,n=this.y;this.x=s*t-n*i,this.y=s*i+n*t},i.scale=function(t){this.x*=t,this.y*=t},i.length=function(){const t=this.x,i=this.y;return Math.sqrt(t*t+i*i)},t.distance=function(t,i){const s=i.x-t.x,n=i.y-t.y;return Math.sqrt(s*s+n*n)},t.add=function(i,s){return new t(i.x+s.x,i.y+s.y)},t.sub=function(i,s){return new t(i.x-s.x,i.y-s.y)},t}(),e=function(t,i,s){this.ratio=t,this.x=i,this.y=s},_=function(){function i(t,i,n,h=8,e=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=h,this._pixelMargin=e,this._tileSize=s*h,this._dz=t,this._yPos=i,this._xPos=n}var n=i.prototype;return n.setPixelMargin=function(t){t!==this._pixelMargin&&(this._pixelMargin=t,this.setExtent(this._extent))},n.setExtent=function(t){this._extent=t,this._finalRatio=this._tileSize/t*(1<<this._dz);let i=this._pixelRatio*this._pixelMargin;i/=this._finalRatio;const s=t>>this._dz;i>s&&(i=s),this._margin=i,this._xmin=s*this._xPos-i,this._ymin=s*this._yPos-i,this._xmax=this._xmin+s+2*i,this._ymax=this._ymin+s+2*i},n.reset=function(t){this._type=t,this._lines=[],this._starts=[],this._line=null,this._start=0},n.moveTo=function(t,i){this._pushLine(),this._prevIsIn=this._isIn(t,i),this._moveTo(t,i,this._prevIsIn),this._prevPt=new h(t,i),this._firstPt=new h(t,i),this._dist=0},n.lineTo=function(t,i){const s=this._isIn(t,i),n=new h(t,i),_=h.distance(this._prevPt,n);let l,o,x,y,a,r,u,m;if(s)this._prevIsIn?this._lineTo(t,i,!0):(l=this._prevPt,o=n,x=this._intersect(o,l),this._start=this._dist+_*(1-this._r),this._lineTo(x.x,x.y,!0),this._lineTo(o.x,o.y,!0));else if(this._prevIsIn)o=this._prevPt,l=n,x=this._intersect(o,l),this._lineTo(x.x,x.y,!0),this._lineTo(l.x,l.y,!1);else{const t=this._prevPt,i=n;if(t.x<=this._xmin&&i.x<=this._xmin||t.x>=this._xmax&&i.x>=this._xmax||t.y<=this._ymin&&i.y<=this._ymin||t.y>=this._ymax&&i.y>=this._ymax)this._lineTo(i.x,i.y,!1);else{const s=[];if((t.x<this._xmin&&i.x>this._xmin||t.x>this._xmin&&i.x<this._xmin)&&(y=(this._xmin-t.x)/(i.x-t.x),m=t.y+y*(i.y-t.y),m<=this._ymin?r=!1:m>=this._ymax?r=!0:s.push(new e(y,this._xmin,m))),(t.x<this._xmax&&i.x>this._xmax||t.x>this._xmax&&i.x<this._xmax)&&(y=(this._xmax-t.x)/(i.x-t.x),m=t.y+y*(i.y-t.y),m<=this._ymin?r=!1:m>=this._ymax?r=!0:s.push(new e(y,this._xmax,m))),(t.y<this._ymin&&i.y>this._ymin||t.y>this._ymin&&i.y<this._ymin)&&(y=(this._ymin-t.y)/(i.y-t.y),u=t.x+y*(i.x-t.x),u<=this._xmin?a=!1:u>=this._xmax?a=!0:s.push(new e(y,u,this._ymin))),(t.y<this._ymax&&i.y>this._ymax||t.y>this._ymax&&i.y<this._ymax)&&(y=(this._ymax-t.y)/(i.y-t.y),u=t.x+y*(i.x-t.x),u<=this._xmin?a=!1:u>=this._xmax?a=!0:s.push(new e(y,u,this._ymax))),0===s.length)a?r?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):r?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(s.length>1&&s[0].ratio>s[1].ratio)this._start=this._dist+_*s[1].ratio,this._lineTo(s[1].x,s[1].y,!0),this._lineTo(s[0].x,s[0].y,!0);else{this._start=this._dist+_*s[0].ratio;for(let t=0;t<s.length;t++)this._lineTo(s[t].x,s[t].y,!0)}this._lineTo(i.x,i.y,!1)}}this._dist+=_,this._prevIsIn=s,this._prevPt=n},n.close=function(){if(this._line.length>2){const t=this._firstPt,i=this._prevPt;t.x===i.x&&t.y===i.y||this.lineTo(t.x,t.y);const s=this._line;let n=s.length;for(;n>=4&&(s[0].x===s[1].x&&s[0].x===s[n-2].x||s[0].y===s[1].y&&s[0].y===s[n-2].y);)s.pop(),s[0].x=s[n-2].x,s[0].y=s[n-2].y,--n}},n.result=function(i=!0){return this._pushLine(),0===this._lines.length?null:(this._type===t.GeometryType.Polygon&&i&&x.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)},n.resultWithStarts=function(){if(this._type!==t.GeometryType.LineString)throw new Error("Only valid for lines");this._pushLine();const i=this._lines,s=i.length;if(0===s)return null;const n=[];for(let t=0;t<s;t++)n.push({line:i[t],start:this._starts[t]||0});return n},n._isIn=function(t,i){return t>=this._xmin&&t<=this._xmax&&i>=this._ymin&&i<=this._ymax},n._intersect=function(t,i){let s,n,e;if(i.x>=this._xmin&&i.x<=this._xmax)n=i.y<=this._ymin?this._ymin:this._ymax,e=(n-t.y)/(i.y-t.y),s=t.x+e*(i.x-t.x);else if(i.y>=this._ymin&&i.y<=this._ymax)s=i.x<=this._xmin?this._xmin:this._xmax,e=(s-t.x)/(i.x-t.x),n=t.y+e*(i.y-t.y);else{n=i.y<=this._ymin?this._ymin:this._ymax,s=i.x<=this._xmin?this._xmin:this._xmax;const h=(s-t.x)/(i.x-t.x),_=(n-t.y)/(i.y-t.y);h<_?(e=h,n=t.y+h*(i.y-t.y)):(e=_,s=t.x+_*(i.x-t.x))}return this._r=e,new h(s,n)},n._pushLine=function(){this._line&&(this._type===t.GeometryType.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===t.GeometryType.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===t.GeometryType.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0},n._moveTo=function(i,s,n){this._type!==t.GeometryType.Polygon?n&&(i=Math.round((i-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new h(i,s))):(n||(i<this._xmin&&(i=this._xmin),i>this._xmax&&(i=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),i=Math.round((i-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new h(i,s)),this._isH=!1,this._isV=!1)},n._lineTo=function(i,s,n){let e,_;if(this._type!==t.GeometryType.Polygon)if(n){if(i=Math.round((i-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(e=this._line[this._line.length-1],e.equals(i,s)))return;this._line.push(new h(i,s))}else this._line&&this._line.length>0&&this._pushLine();else if(n||(i<this._xmin&&(i=this._xmin),i>this._xmax&&(i=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),i=Math.round((i-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){e=this._line[this._line.length-1];const t=e.x===i,n=e.y===s;if(t&&n)return;this._isH&&t||this._isV&&n?(e.x=i,e.y=s,_=this._line[this._line.length-2],_.x===i&&_.y===s?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(_=this._line[this._line.length-2],this._isH=_.x===i,this._isV=_.y===s)):(this._isH=_.x===i,this._isV=_.y===s)):(this._line.push(new h(i,s)),this._isH=t,this._isV=n)}else this._line.push(new h(i,s))},i}(),l=function(){function t(){}var s=t.prototype;return s.setExtent=function(t){this._ratio=4096===t?1:4096/t},s.reset=function(t){this._lines=[],this._line=null},s.moveTo=function(t,i){this._line&&this._lines.push(this._line),this._line=[];const s=this._ratio;this._line.push(new h(t*s,i*s))},s.lineTo=function(t,i){const s=this._ratio;this._line.push(new h(t*s,i*s))},s.close=function(){const t=this._line;t&&!t[0].isEqual(t[t.length-1])&&t.push(t[0])},s.result=function(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines},i._createClass(t,[{key:"validateTessellation",get:function(){return this._ratio<1}}]),t}();var o;!function(t){t[t.sideLeft=0]="sideLeft",t[t.sideRight=1]="sideRight",t[t.sideTop=2]="sideTop",t[t.sideBottom=3]="sideBottom"}(o||(o={}));let x=function(){function t(){}return t.simplify=function(i,s,n){if(!n)return;const h=-s,e=i+s,_=-s,l=i+s,x=[],y=[],a=n.length;for(let t=0;t<a;++t){const i=n[t];if(!i||i.length<2)continue;let s,a=i[0];const r=i.length;for(let n=1;n<r;++n)s=i[n],a.x===s.x&&(a.x<=h&&(a.y>s.y?(x.push(t),x.push(n),x.push(o.sideLeft),x.push(-1)):(y.push(t),y.push(n),y.push(o.sideLeft),y.push(-1))),a.x>=e&&(a.y<s.y?(x.push(t),x.push(n),x.push(o.sideRight),x.push(-1)):(y.push(t),y.push(n),y.push(o.sideRight),y.push(-1)))),a.y===s.y&&(a.y<=_&&(a.x<s.x?(x.push(t),x.push(n),x.push(o.sideTop),x.push(-1)):(y.push(t),y.push(n),y.push(o.sideTop),y.push(-1))),a.y>=l&&(a.x>s.x?(x.push(t),x.push(n),x.push(o.sideBottom),x.push(-1)):(y.push(t),y.push(n),y.push(o.sideBottom),y.push(-1)))),a=s}if(0===x.length||0===y.length)return;t.fillParent(n,y,x),t.fillParent(n,x,y);const r=[];t.calcDeltas(r,y,x),t.calcDeltas(r,x,y),t.addDeltas(r,n)},t.fillParent=function(t,i,s){const n=s.length,h=i.length;for(let e=0;e<h;e+=4){const h=i[e],_=i[e+1],l=i[e+2],x=t[h][_-1],a=t[h][_];let r=8092,u=-1;for(let i=0;i<n;i+=4){if(s[i+2]!==l)continue;const n=s[i],h=s[i+1],e=t[n][h-1],_=t[n][h];switch(l){case o.sideLeft:case o.sideRight:if(y(x.y,e.y,_.y)&&y(a.y,e.y,_.y)){const t=Math.abs(_.y-e.y);t<r&&(r=t,u=i)}break;case o.sideTop:case o.sideBottom:if(y(x.x,e.x,_.x)&&y(a.x,e.x,_.x)){const t=Math.abs(_.x-e.x);t<r&&(r=t,u=i)}}}i[e+3]=u}},t.calcDeltas=function(i,s,n){const h=s.length;for(let e=0;e<h;e+=4){const h=[],_=t.calcDelta(e,s,n,h);i.push(s[e]),i.push(s[e+1]),i.push(s[e+2]),i.push(_)}},t.calcDelta=function(i,s,n,h){const e=s[i+3];if(-1===e)return 0;const _=h.length;return _>1&&h[_-2]===e?0:(h.push(e),t.calcDelta(e,n,s,h)+1)},t.addDeltas=function(t,i){const s=t.length;let n=0;for(let h=0;h<s;h+=4){const i=t[h+3];i>n&&(n=i)}for(let h=0;h<s;h+=4){const s=i[t[h]],e=t[h+1],_=n-t[h+3];switch(t[h+2]){case o.sideLeft:s[e-1].x-=_,s[e].x-=_,1===e&&(s[s.length-1].x-=_),e===s.length-1&&(s[0].x-=_);break;case o.sideRight:s[e-1].x+=_,s[e].x+=_,1===e&&(s[s.length-1].x+=_),e===s.length-1&&(s[0].x+=_);break;case o.sideTop:s[e-1].y-=_,s[e].y-=_,1===e&&(s[s.length-1].y-=_),e===s.length-1&&(s[0].y-=_);break;case o.sideBottom:s[e-1].y+=_,s[e].y+=_,1===e&&(s[s.length-1].y+=_),e===s.length-1&&(s[0].y+=_)}}},t}();const y=(t,i,s)=>t>=i&&t<=s||t>=s&&t<=i;t.Point=h,t.SimpleBuilder=l,t.TileClipper=_,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
