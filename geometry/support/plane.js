/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../core/mathUtils","../../core/maybe","../../chunks/vec3","../../chunks/vec3f64","../../chunks/sphere","./vector","./vectorStacks","../../views/3d/support/mathUtils"],(function(t,n,e,r,o,c,i,u,s){"use strict";function a(t=B){return[t[0],t[1],t[2],t[3]]}function f(t=B[0],n=B[1],e=B[2],r=B[3]){return I(t,n,e,r,u.sv4d.get())}function d(t,n){return I(n[0],n[1],n[2],n[3],t)}function I(t,n,e,r,o=a()){return o[0]=t,o[1]=n,o[2]=e,o[3]=r,o}function g(t,n,e){return r.copy(e,t),e[3]=n,e}function l(t,n,e){const r=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],o=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return e[0]=n[0]*o,e[1]=n[1]*o,e[2]=n[2]*o,e[3]=-(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]),e}function N(t,n,e,r=a()){const o=e[0]-n[0],c=e[1]-n[1],i=e[2]-n[2],u=t[0]-n[0],s=t[1]-n[1],f=t[2]-n[2],d=c*f-i*s,I=i*u-o*f,g=o*s-c*u,l=d*d+I*I+g*g,N=Math.abs(l-1)>1e-5&&l>1e-12?1/Math.sqrt(l):1;return r[0]=d*N,r[1]=I*N,r[2]=g*N,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function m(t,n){return M(t,n,0,1,2)}function M(t,n,e,o,c){const i=t.length/3;if(i<3)return!1;r.set(h,t[3*e],t[3*e+1],t[3*e+2]);let u=o,s=!1;for(;u<i-1&&!s;){const n=3*u;r.set(P,t[n],t[n+1],t[n+2]),u++,s=!r.exactEquals(h,P)}if(!s)return!1;for(u=Math.max(u,c),s=!1;u<i&&!s;){const n=3*u;r.set(v,t[n],t[n+1],t[n+2]),u++,r.subtract(E,h,P),r.normalize(E,E),r.subtract(y,P,v),r.normalize(y,y),s=!r.exactEquals(h,v)&&!r.exactEquals(P,v)&&Math.abs(r.dot(E,y))<p}return s?(N(h,P,v,n),!0):(0!==e||1!==o||2!==c)&&M(t,n,0,1,2)}const p=.99619469809,h=o.create(),P=o.create(),v=o.create(),E=o.create(),y=o.create();function b(t,n,e){return n!==t&&d(t,n),t[3]=-r.dot(R(t),e),t}function A(t,n){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n}function F(t,n,e,o){return r.cross(v,n,t),l(e,v,o)}function S(t,n,e,o){return D(t,n,r.subtract(u.sv3d.get(),e,n),H,o)}function L(t,n,r){return!!e.isSome(n)&&D(t,n.origin,n.direction,J,r)}function T(t,n,e){return D(t,n.origin,n.vector,G.NONE,e)}function _(t,n,e){return D(t,n.origin,n.vector,G.CLAMP,e)}function O(t,n){return z(t,c.getCenter(n))-n[3]>=0}function j(t,n){return z(t,c.getCenter(n))+n[3]<0}function C(t,n){return z(t,n)>=0}function q(t,n){return z(t,n)<0}function x(t,n){const e=r.dot(R(t),n.ray.direction),o=-z(t,n.ray.origin);if(o<0&&e>=0)return!1;if(e>-1e-6&&e<1e-6)return o>0;if((o<0||e<0)&&!(o<0&&e<0))return!0;const c=o/e;return e>0?c<n.c1&&(n.c1=c):c>n.c0&&(n.c0=c),n.c0<=n.c1}function X(t,n){const e=r.dot(R(t),n.ray.direction),o=-z(t,n.ray.origin);if(e>-1e-6&&e<1e-6)return o>0;const c=o/e;return e>0?c<n.c1&&(n.c1=c):c>n.c0&&(n.c0=c),n.c0<=n.c1}function k(t,n,e){const o=r.scale(u.sv3d.get(),R(t),-t[3]),c=V(t,r.subtract(u.sv3d.get(),n,o),u.sv3d.get());return r.add(e,c,o),e}function U(t,n,e,o){const c=R(t),a=u.sv3d.get(),f=u.sv3d.get();s.tangentFrame(c,a,f);const d=r.subtract(u.sv3d.get(),e,n),I=i.projectPointSignedLength(a,d),g=i.projectPointSignedLength(f,d),l=i.projectPointSignedLength(c,d);return r.set(o,I,g,l)}function V(t,n,e){const o=r.scale(u.sv3d.get(),R(t),r.dot(R(t),n));return r.subtract(e,n,o),e}function w(t,n){return Math.abs(z(t,n))}function z(t,n){return r.dot(R(t),n)+t[3]}function D(t,e,o,c,i){const u=r.dot(R(t),o);if(0===u)return!1;let s=-(r.dot(R(t),e)+t[3])/u;return c&G.CLAMP&&(s=n.clamp(s,0,1)),!(!(c&G.INFINITE_MIN)&&s<0||!(c&G.INFINITE_MAX)&&s>1)&&(r.add(i,e,r.scale(i,o,s)),!0)}function R(t){return t}const B=[0,0,1,0];var G;!function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"}(G||(G={}));const H=G.INFINITE_MIN|G.INFINITE_MAX,J=G.INFINITE_MAX;t.UP=B,t.clip=x,t.clipInfinite=X,t.copy=d,t.create=a,t.distance=w,t.fromManyPoints=m,t.fromManyPointsSampleAt=M,t.fromNormalAndOffset=g,t.fromPoints=N,t.fromPositionAndNormal=l,t.fromValues=I,t.fromVectorsAndPoint=F,t.intersectLine=S,t.intersectLineSegment=T,t.intersectLineSegmentClamp=_,t.intersectRay=L,t.isPointInside=C,t.isPointOutside=q,t.isSphereFullyInside=O,t.isSphereFullyOutside=j,t.negate=A,t.normal=R,t.projectPoint=k,t.projectPointLocal=U,t.projectVector=V,t.setOffsetFromPoint=b,t.signedDistance=z,t.wrap=f,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
