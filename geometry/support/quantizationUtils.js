// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","./jsonUtils"],(function(n,t,u){"use strict";function e(n){return n&&"upperLeft"===n.originPosition}Object.defineProperty(t,"__esModule",{value:!0}),t.unquantizePolyline=t.unquantizePolygon=t.unquantizePoint=t.unquantizeMultipoint=t.unquantizeExtent=t.quantizeGeometry=t.quantizePolyline=t.quantizePolygon=t.quantizePoint=t.quantizeMultipoint=t.quantizeExtent=t.getQuantizedBoundsRings=t.getQuantizedBoundsPaths=t.getQuantizedBoundsPoints=t.getQuantizedBoundsCoordsArrayArray=t.getQuantizedBoundsCoordsArray=t.unquantizeRings=t.unquantizePaths=t.unquantizePoints=t.unquantizeBounds=t.unquantizeCoordsArrayArray=t.unquantizeCoordsArray=t.unquantizeY=t.unquantizeX=t.quantizePaths=t.quantizeRings=t.quantizePoints=t.quantizeBounds=t.quantizeY=t.quantizeX=t.equals=t.toQuantizationTransform=void 0;var i=function(n,t,u){return[t,u]},r=function(n,t,u){return[t,u,n[2]]},a=function(n,t,u){return[t,u,n[2],n[3]]};function o(n,t){var u=n.scale,e=n.translate;return Math.round((t-e[0])/u[0])}function s(n,t){var u=n.scale,e=n.translate;return Math.round((e[1]-t)/u[1])}function l(n,t,u){for(var e,i,r,a,l=[],z=0;z<u.length;z++){var m=u[z];z>0?(r=o(n,m[0]),a=s(n,m[1]),r===e&&a===i||(l.push(t(m,r-e,a-i)),e=r,i=a)):(e=o(n,m[0]),i=s(n,m[1]),l.push(t(m,e,i)))}return l.length>0?l:null}function z(n,t,u,e){return l(n,u?e?a:r:e?r:i,t)}function m(n,t,u,e){for(var o=[],s=u?e?a:r:e?r:i,z=0;z<t.length;z++){var m=l(n,s,t[z]);m&&m.length>=3&&o.push(m)}return o.length?o:null}function f(n,t,u,e){for(var o=[],s=u?e?a:r:e?r:i,z=0;z<t.length;z++){var m=l(n,s,t[z]);m&&m.length>=2&&o.push(m)}return o.length?o:null}function q(n,t){var u=n.scale,e=n.translate;return t*u[0]+e[0]}function c(n,t){var u=n.scale;return n.translate[1]-t*u[1]}function x(n,t,u){var e=new Array(u.length);if(!u.length)return e;var i=n.scale,r=i[0],a=i[1],o=q(n,u[0][0]),s=c(n,u[0][1]);e[0]=t(u[0],o,s);for(var l=1;l<u.length;l++){var z=u[l];o+=z[0]*r,s-=z[1]*a,e[l]=t(z,o,s)}return e}function g(n,t,u){for(var e=new Array(u.length),i=0;i<u.length;i++)e[i]=x(n,t,u[i]);return e}function y(n,t,u,e){return x(n,u?e?a:r:e?r:i,t)}function h(n,t,u,e){return g(n,u?e?a:r:e?r:i,t)}function d(n,t,u,e){return g(n,u?e?a:r:e?r:i,t)}function P(n,t,u){for(var e=u[0],i=e[0],r=e[1],a=Math.min(i,t[0]),o=Math.min(r,t[1]),s=Math.max(i,t[2]),l=Math.max(r,t[3]),z=1;z<u.length;z++){var m=u[z],f=m[0],q=m[1];i+=f,r+=q,f<0&&(a=Math.min(a,i)),f>0&&(s=Math.max(s,i)),q<0?o=Math.min(o,r):q>0&&(l=Math.max(l,r))}return n[0]=a,n[1]=o,n[2]=s,n[3]=l,n}function I(n,t){if(!t.length)return null;n[0]=n[1]=Number.POSITIVE_INFINITY,n[2]=n[3]=Number.NEGATIVE_INFINITY;for(var u=0;u<t.length;u++)P(n,n,t[u]);return n}function p(n,t,u,e,i){return t.xmin=o(n,u.xmin),t.ymin=s(n,u.ymin),t.xmax=o(n,u.xmax),t.ymax=s(n,u.ymax),t!==u&&(e&&(t.zmin=u.zmin,t.zmax=u.zmax),i&&(t.mmin=u.mmin,t.mmax=u.mmax)),t}function v(n,t,u,e,i){return t.points=z(n,u.points,e,i),t}function N(n,t,u,e,i){return t.x=o(n,u.x),t.y=s(n,u.y),t!==u&&(e&&(t.z=u.z),i&&(t.m=u.m)),t}function A(n,t,u,e,i){var r=m(n,u.rings,e,i);return r?(t.rings=r,t):null}function M(n,t,u,e,i){var r=f(n,u.paths,e,i);return r?(t.paths=r,t):null}t.toQuantizationTransform=function(n){return n?{originPosition:"upper-left"===n.originPosition?"upperLeft":"lower-left"===n.originPosition?"lowerLeft":n.originPosition,scale:[n.tolerance,n.tolerance],translate:[n.extent.xmin,n.extent.ymax]}:null},t.equals=function(n,t){return n===t||null==n&&null==t||null!=n&&null!=t&&(e(n)?(u=n.translate[0],i=n.translate[1],r=n.scale[0]):(u=n.extent.xmin,i=n.extent.ymax,r=n.tolerance),e(t)?(a=t.translate[0],o=t.translate[1],s=t.scale[0]):(a=t.extent.xmin,o=t.extent.ymax,s=t.tolerance),u===a&&i===o&&r===s);var u,i,r,a,o,s},t.quantizeX=o,t.quantizeY=s,t.quantizeBounds=function(n,t,u){return t[0]=o(n,u[0]),t[3]=s(n,u[1]),t[2]=o(n,u[2]),t[1]=s(n,u[3]),t},t.quantizePoints=z,t.quantizeRings=m,t.quantizePaths=f,t.unquantizeX=q,t.unquantizeY=c,t.unquantizeCoordsArray=x,t.unquantizeCoordsArrayArray=g,t.unquantizeBounds=function(n,t,u){return u?(t[0]=q(n,u[0]),t[1]=c(n,u[3]),t[2]=q(n,u[2]),t[3]=c(n,u[1]),t):[q(n,t[0]),c(n,t[3]),q(n,t[2]),c(n,t[1])]},t.unquantizePoints=y,t.unquantizePaths=h,t.unquantizeRings=d,t.getQuantizedBoundsCoordsArray=P,t.getQuantizedBoundsCoordsArrayArray=I,t.getQuantizedBoundsPoints=function(n){var t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return P(t,t,n)},t.getQuantizedBoundsPaths=function(n){return I([0,0,0,0],n)},t.getQuantizedBoundsRings=function(n){return I([0,0,0,0],n)},t.quantizeExtent=p,t.quantizeMultipoint=v,t.quantizePoint=N,t.quantizePolygon=A,t.quantizePolyline=M,t.quantizeGeometry=function(n,t){return n&&t?u.isPoint(t)?N(n,{},t,!1,!1):u.isPolyline(t)?M(n,{},t,!1,!1):u.isPolygon(t)?A(n,{},t,!1,!1):u.isMultipoint(t)?v(n,{},t,!1,!1):u.isExtent(t)?p(n,{},t,!1,!1):null:null},t.unquantizeExtent=function(n,t,u,e,i){return t.xmin=q(n,u.xmin),t.ymin=c(n,u.ymin),t.xmax=q(n,u.xmax),t.ymax=c(n,u.ymax),t!==u&&(e&&(t.zmin=u.zmin,t.zmax=u.zmax),i&&(t.mmin=u.mmin,t.mmax=u.mmax)),t},t.unquantizeMultipoint=function(n,t,u,e,i){return t.points=y(n,u.points,e,i),t},t.unquantizePoint=function(n,t,u,e,i){return t.x=q(n,u.x),t.y=c(n,u.y),t!==u&&(e&&(t.z=u.z),i&&(t.m=u.m)),t},t.unquantizePolygon=function(n,t,u,e,i){return t.rings=d(n,u.rings,e,i),t},t.unquantizePolyline=function(n,t,u,e,i){return t.paths=h(n,u.paths,e,i),t}}));