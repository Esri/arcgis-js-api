/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","./spatialReferenceUtils","./boundsUtils","./jsonUtils","./aaBoundingRect"],(function(e,t,s,n,o){"use strict";function f(e){if(!e)return null;if(!e.spatialReference)return e;const s=t.getInfo(e.spatialReference);if(!s)return e;const o=s.valid[1];return n.isPolygon(e)?i(e,o):n.isPolyline(e)?r(e,o):e}function r(e,t){let n={paths:[],spatialReference:e.spatialReference};const[f,,r]=s.getBoundsXY(o.create(),e);let i=Math.ceil((f-t)/(2*t))*(2*t)+t;if(i>r)n=e;else{let s,o;for(;i<r;){const f=u(e,i);if(s=f[0],o=f[1],s)for(const e of s.paths)n.paths.push(e);if(null==o)break;e=o,i+=2*t}if(o)for(const e of o.paths)n.paths.push(e)}for(const o of n.paths){const e=g(s.getPointsBoundsCenterX(o),t);for(const s of o)s[0]-=2*e*t}return n}function i(e,t){let n={rings:[],spatialReference:e.spatialReference};const[f,,r]=s.getBoundsXY(o.create(),e);let i=Math.ceil((f-t)/(2*t))*(2*t)+t;if(i>r)n=e;else{let s,o;for(;i<r;){if([s,o]=h(e,i),s)for(const e of s.rings)n.rings.push(e);if(null==o)break;e=o,i+=2*t}if(o)for(const e of o.rings)n.rings.push(e)}for(const o of n.rings){const e=g(s.getPointsBoundsCenterX(o),t);for(const s of o)s[0]-=2*e*t}return n}const l=o.create();function u(e,t){const[n,,o]=s.getBoundsXY(l,e);let f,r;if(o<=t)f=e;else if(n>=t)r=e;else{f={paths:[]},r={paths:[]};const n=f.paths,o=r.paths;for(const f of e.paths){const[e,,r]=s.getPointsBounds(l,f);if(r<=t)n.push(f);else if(e>=t)o.push(f);else{let e=f[0],s=p(e,t),r=[];r.push(e);for(let i=1;i<f.length;i++){const l=f[i],u=p(l,t);if(u===s)r.push(l);else{const f=a(e,l,t);r.push(f),s?n.push(r):o.push(r),r=[f,l],s=u}e=l}s?n.push(r):o.push(r)}}}return[f,r]}function h(e,t){let n,f;const[r,,i]=s.getBoundsXY(o.create(),e);if(i<=t)n=e;else if(r>=t)f=e;else{const r=[],i=[],l=[];for(const n of e.rings){const[e,,f]=s.getPointsBounds(o.create(),n);if(f<=t)r.push(n);else if(e>=t)i.push(n);else{let e=n[n.length-1],s=p(e,t),o=[];for(const f of n){const n=p(f,t);if(n===s)o.push(f);else{const u=a(e,f,t);o.push(u),s?r.push(o):i.push(o),l.push(u[1]),o=[],o.push([u[0],u[1]]),o.push(f),s=n}e=f}s?r.push(o):i.push(o)}}l.sort();for(let e=0;e<l.length-1;e+=2){const s=[];s.push([t,l[e]]),s.push([t,l[e+1]]),r.length>0&&r.push(s),i.length>0&&i.push(s)}r.length>0&&(n=c(r)),i.length>0&&(f=c(i))}return[n,f]}function c(e){let t;const n={rings:[]};for(;e.length>0;){const o=e[0];let f=!1;const[r,i]=o[0],[l,u]=o[o.length-1];if(r!==l||i!==u)for(let h=1;h<e.length;h++){const c=e[h],[p,a]=c[0],[g,B]=c[c.length-1];if(u===a&&l===p){for(t=1;t<c.length;t++)o.push([c[t][0],c[t][1]]);f=!0}else if(u===B&&l===g){for(t=c.length-2;t>=0;t--)o.push([c[t][0],c[t][1]]);f=!0}else if(i===B&&r===g){for(t=0;t<c.length-1;t++)o.splice(t,0,[c[t][0],c[t][1]]);f=!0}else if(i===a&&r===p){for(t=1;t<c.length;t++)o.unshift([c[t][0],c[t][1]]);f=!0}if(f){e.splice(h,1),d(o[0],o[o.length-1])&&(e.shift(),s.getPointsBoundsWidth(o)>0&&n.rings.push(o));break}}f||(e.shift(),o.length,n.rings.push(o))}return n}function p([e],t){return e<t}function a([e,t],[s,n],o){return[o,t+(n-t)/(s-e)*(o-e)]}function g(e,t){let s=(e+t)/(2*t);return s%2==1&&s--,Math.floor(s)}function d([e,t],[s,n]){return e===s&&t===n}e.normalize=f,Object.defineProperty(e,"__esModule",{value:!0})}));
