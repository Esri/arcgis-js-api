/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","./spatialReferenceUtils","./boundsUtils","./jsonUtils","./aaBoundingRect"],(function(e,t,s,n,o){"use strict";const f=o.create();function r(e,t){const[n,,o]=s.getBoundsXY(f,e);let r,i;if(o<=t)r=e;else if(n>=t)i=e;else{r={paths:[]},i={paths:[]};const n=r.paths,o=i.paths;for(const r of e.paths){const[e,,i]=s.getPointsBounds(f,r);if(i<=t)n.push(r);else if(e>=t)o.push(r);else{let e=r[0],s=u(e,t),f=[];f.push(e);for(let i=1;i<r.length;i++){const l=r[i],c=u(l,t);if(c===s)f.push(l);else{const r=h(e,l,t);f.push(r),s?n.push(f):o.push(f),f=[r,l],s=c}e=l}s?n.push(f):o.push(f)}}}return[r,i]}function i(e,t){let n,f;const[r,,i]=s.getBoundsXY(o.create(),e);if(i<=t)n=e;else if(r>=t)f=e;else{const r=[],i=[],c=[];for(const n of e.rings){const[e,,f]=s.getPointsBounds(o.create(),n);if(f<=t)r.push(n);else if(e>=t)i.push(n);else{let e=n[n.length-1],s=u(e,t),o=[];for(const f of n){const n=u(f,t);if(n===s)o.push(f);else{const l=h(e,f,t);o.push(l),s?r.push(o):i.push(o),c.push(l[1]),o=[],o.push([l[0],l[1]]),o.push(f),s=n}e=f}s?r.push(o):i.push(o)}}c.sort();for(let e=0;e<c.length-1;e+=2){const s=[];s.push([t,c[e]]),s.push([t,c[e+1]]),r.length>0&&r.push(s),i.length>0&&i.push(s)}r.length>0&&(n=l(r)),i.length>0&&(f=l(i))}return[n,f]}function l(e){let t;const n={rings:[]};for(;e.length>0;){const o=e[0];let f=!1;const[r,i]=o[0],[l,u]=o[o.length-1];if(r!==l||i!==u)for(let h=1;h<e.length;h++){const c=e[h],[a,g]=c[0],[d,B]=c[c.length-1];if(u===g&&l===a){for(t=1;t<c.length;t++)o.push([c[t][0],c[t][1]]);f=!0}else if(u===B&&l===d){for(t=c.length-2;t>=0;t--)o.push([c[t][0],c[t][1]]);f=!0}else if(i===B&&r===d){for(t=0;t<c.length-1;t++)o.splice(t,0,[c[t][0],c[t][1]]);f=!0}else if(i===g&&r===a){for(t=1;t<c.length;t++)o.unshift([c[t][0],c[t][1]]);f=!0}if(f){e.splice(h,1),p(o[0],o[o.length-1])&&(e.shift(),s.getPointsBoundsWidth(o)>0&&n.rings.push(o));break}}f||(e.shift(),o.length,n.rings.push(o))}return n}function u([e],t){return e<t}function h([e,t],[s,n],o){return[o,t+(n-t)/(s-e)*(o-e)]}function c(e,t){let s=(e+t)/(2*t);return s%2==1&&s--,Math.floor(s)}function p([e,t],[s,n]){return e===s&&t===n}e.normalize=function(e){if(!e)return null;if(!e.spatialReference)return e;const f=t.getInfo(e.spatialReference);if(!f)return e;const l=f.valid[1];return n.isPolygon(e)?function(e,t){let n={rings:[],spatialReference:e.spatialReference};const[f,,r]=s.getBoundsXY(o.create(),e);let l=Math.ceil((f-t)/(2*t))*(2*t)+t;if(l>r)n=e;else{let s,o;for(;l<r;){if([s,o]=i(e,l),s)for(const e of s.rings)n.rings.push(e);if(null==o)break;e=o,l+=2*t}if(o)for(const e of o.rings)n.rings.push(e)}for(const e of n.rings){const n=c(s.getPointsBoundsCenterX(e),t);for(const s of e)s[0]-=2*n*t}return n}(e,l):n.isPolyline(e)?function(e,t){let n={paths:[],spatialReference:e.spatialReference};const[f,,i]=s.getBoundsXY(o.create(),e);let l=Math.ceil((f-t)/(2*t))*(2*t)+t;if(l>i)n=e;else{let s,o;for(;l<i;){const f=r(e,l);if(s=f[0],o=f[1],s)for(const e of s.paths)n.paths.push(e);if(null==o)break;e=o,l+=2*t}if(o)for(const e of o.paths)n.paths.push(e)}for(const e of n.paths){const n=c(s.getPointsBoundsCenterX(e),t);for(const s of e)s[0]-=2*n*t}return n}(e,l):e},Object.defineProperty(e,"__esModule",{value:!0})}));
