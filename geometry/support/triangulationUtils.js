/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","./coordsUtils","../../core/libs/earcut/earcut","./meshUtils/deduplicate"],(function(n,t,e,o){"use strict";function l(n,e,o){const l=n.length,i=new Array(l),s=new Array(l),c=new Array(l);let a=0,h=0,f=0,g=0;for(let t=0;t<l;++t)g+=n[t].length;const u=new Float64Array(3*g);let p=0;for(let g=l-1;g>=0;g--){const y=n[g],w=1===o&&(d=y,!t.isClockwise(d,!1,!1));if(w&&1!==l)i[a++]=y;else{let n=y.length;for(let t=0;t<a;++t)n+=i[t].length;const t={index:p,pathLengths:new Array(a+1),count:n,holeIndices:new Array(a)};t.pathLengths[0]=y.length,y.length>0&&(c[f++]={index:p,count:y.length}),p=w?r(y,y.length-1,-1,u,p,y.length,e):r(y,0,1,u,p,y.length,e);for(let n=0;n<a;++n){const o=i[n];t.holeIndices[n]=p,t.pathLengths[n+1]=o.length,o.length>0&&(c[f++]={index:p,count:o.length}),p=r(o,0,1,u,p,o.length,e)}a=0,t.count>0&&(s[h++]=t)}}var d;for(let n=0;n<a;++n){const t=i[n];t.length>0&&(c[f++]={index:p,count:t.length}),p=r(t,0,1,u,p,t.length,e)}return h<l&&(s.length=h),f<l&&(c.length=f),{position:u,polygons:s,outlines:c}}function r(n,t,e,o,l,r,i){l*=3;for(let s=0;s<r;++s){const r=n[t];o[l++]=r[0],o[l++]=r[1],o[l++]=i?r[2]:0,t+=e}return l/3}n.pathsToTriangulationInfo=l,n.triangulate=function(n){const t=l(n.rings,n.hasZ,1),r=[];let i=0,s=0;for(const n of t.polygons){const o=n.count,l=n.index,c=new Float64Array(t.position.buffer,3*l*t.position.BYTES_PER_ELEMENT,3*o),a=n.holeIndices.map((n=>n-l)),h=new Uint32Array(e.earcut(c,a,3));r.push({position:c,faces:h}),i+=c.length,s+=h.length}const c=function(n,t,e){if(1===n.length)return n[0];const o=new Float64Array(t),l=new Uint32Array(e);let r=0,i=0,s=0;for(const t of n){for(let n=0;n<t.position.length;n++)o[r++]=t.position[n];for(let n=0;n<t.faces.length;n++)l[i++]=t.faces[n]+s;s=r/3}return{position:o,faces:l}}(r,i,s),a=o.deduplicate(c.position.buffer,6,{originalIndices:c.faces});return c.position=new Float64Array(a.buffer),c.faces=a.indices,c},Object.defineProperty(n,"__esModule",{value:!0})}));
