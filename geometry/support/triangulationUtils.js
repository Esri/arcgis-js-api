/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../chunks/earcut","./coordsUtils","./meshUtils/deduplicate"],(function(n,t,e,o){"use strict";function l(n){const e=i(n.rings,n.hasZ,1),l=[];let s=0,c=0;for(const o of e.polygons){const n=o.count,r=o.index,i=new Float64Array(e.position.buffer,3*r*e.position.BYTES_PER_ELEMENT,3*n),h=o.holeIndices.map((n=>n-r)),a=new Uint32Array(t.earcut(i,h,3));l.push({position:i,faces:a}),s+=i.length,c+=a.length}const h=r(l,s,c),a=o.deduplicate(h.position.buffer,6,{originalIndices:h.faces});return h.position=new Float64Array(a.buffer),h.faces=a.indices,h}function r(n,t,e){if(1===n.length)return n[0];const o=new Float64Array(t),l=new Uint32Array(e);let r=0,i=0,s=0;for(const c of n){for(let n=0;n<c.position.length;n++)o[r++]=c.position[n];for(let n=0;n<c.faces.length;n++)l[i++]=c.faces[n]+s;s=r/3}return{position:o,faces:l}}function i(n,t,e){const o=n.length,l=new Array(o),r=new Array(o),i=new Array(o);let h=0,a=0,f=0,g=0;for(let s=0;s<o;++s)g+=n[s].length;const u=new Float64Array(3*g);let p=0;for(let d=o-1;d>=0;d--){const g=n[d],y=1===e&&c(g);if(y&&1!==o)l[h++]=g;else{let n=g.length;for(let t=0;t<h;++t)n+=l[t].length;const e={index:p,pathLengths:new Array(h+1),count:n,holeIndices:new Array(h)};e.pathLengths[0]=g.length,g.length>0&&(i[f++]={index:p,count:g.length}),p=y?s(g,g.length-1,-1,u,p,g.length,t):s(g,0,1,u,p,g.length,t);for(let o=0;o<h;++o){const n=l[o];e.holeIndices[o]=p,e.pathLengths[o+1]=n.length,n.length>0&&(i[f++]={index:p,count:n.length}),p=s(n,0,1,u,p,n.length,t)}h=0,e.count>0&&(r[a++]=e)}}for(let c=0;c<h;++c){const n=l[c];n.length>0&&(i[f++]={index:p,count:n.length}),p=s(n,0,1,u,p,n.length,t)}return a<o&&(r.length=a),f<o&&(i.length=f),{position:u,polygons:r,outlines:i}}function s(n,t,e,o,l,r,i){l*=3;for(let s=0;s<r;++s){const r=n[t];o[l++]=r[0],o[l++]=r[1],o[l++]=i?r[2]:0,t+=e}return l/3}function c(n){return!e.isClockwise(n,!1,!1)}n.pathsToTriangulationInfo=i,n.triangulate=l,Object.defineProperty(n,"__esModule",{value:!0})}));
