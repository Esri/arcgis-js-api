/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/earcut","./coordsUtils","./meshUtils/deduplicate","../../views/3d/webgl-engine/lib/DoubleArray"],(function(e,n,t,o,r){"use strict";function i(t){const i=s(t.rings,t.hasZ,e.CounterClockwiseMode.CCW_IS_HOLE),c=new Array;let a=0,u=0;for(const e of i.polygons){const t=e.count,o=e.index,l=r.doubleSubArray(i.position,3*o,3*t),s=e.holeIndices.map((e=>e-o)),g=new Uint32Array(n.earcut(l,s,3));c.push({position:l,faces:g}),a+=l.length,u+=g.length}const g=l(c,a,u),h=Array.isArray(g.position)?o.deduplicate(g.position,3,{originalIndices:g.faces}):o.deduplicate(g.position.buffer,6,{originalIndices:g.faces});return g.position=new Float64Array(h.buffer),g.faces=h.indices,g}function l(e,n,t){if(1===e.length)return e[0];const o=r.newDoubleArray(n),i=new Uint32Array(t);let l=0,s=0,c=0;for(const r of e){for(let e=0;e<r.position.length;e++)o[l++]=r.position[e];for(let e=0;e<r.faces.length;e++)i[s++]=r.faces[e]+c;c=l/3}return{position:o,faces:i}}function s(n,t,o){const i=n.length,l=new Array(i),s=new Array(i),u=new Array(i);let g=0,h=0,f=0,d=0;for(let e=0;e<i;++e)d+=n[e].length;const p=r.newDoubleArray(3*d);let w=0;for(let r=i-1;r>=0;r--){const d=n[r],y=o===e.CounterClockwiseMode.CCW_IS_HOLE&&a(d);if(y&&1!==i)l[g++]=d;else{let e=d.length;for(let t=0;t<g;++t)e+=l[t].length;const n={index:w,pathLengths:new Array(g+1),count:e,holeIndices:new Array(g)};n.pathLengths[0]=d.length,d.length>0&&(u[f++]={index:w,count:d.length}),w=y?c(d,d.length-1,-1,p,w,d.length,t):c(d,0,1,p,w,d.length,t);for(let o=0;o<g;++o){const e=l[o];n.holeIndices[o]=w,n.pathLengths[o+1]=e.length,e.length>0&&(u[f++]={index:w,count:e.length}),w=c(e,0,1,p,w,e.length,t)}g=0,n.count>0&&(s[h++]=n)}}for(let e=0;e<g;++e){const n=l[e];n.length>0&&(u[f++]={index:w,count:n.length}),w=c(n,0,1,p,w,n.length,t)}return s.length=h,u.length=f,{position:p,polygons:s,outlines:u}}function c(e,n,t,o,r,i,l){r*=3;for(let s=0;s<i;++s){const i=e[n];o[r++]=i[0],o[r++]=i[1],o[r++]=l?i[2]:0,n+=t}return r/3}function a(e){return!t.isClockwise(e,!1,!1)}var u;e.CounterClockwiseMode=void 0,(u=e.CounterClockwiseMode||(e.CounterClockwiseMode={}))[u.NONE=0]="NONE",u[u.CCW_IS_HOLE=1]="CCW_IS_HOLE",e.pathsToTriangulationInfo=s,e.triangulate=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
