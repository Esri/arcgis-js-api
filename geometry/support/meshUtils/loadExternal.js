/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["require","exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Error","../../../core/maybe","../../../core/promiseUtils","../../../core/urlUtils","../../Point"],(function(e,n,r,t,o,s,i,l){"use strict";const u=e=>Object.freeze({__proto__:null,default:e});function a(e,n,r){return c.apply(this,arguments)}function c(){return(c=r._asyncToGenerator((function*(n,r,t){const{loadGLTFMesh:i}=yield s.whenOrAbort(new Promise(((n,r)=>e(["./loadGLTFMesh"],n,r))),t),u=yield p(r,t),a=i(new l({x:0,y:0,z:0,spatialReference:n.spatialReference}),u.url,{resolveFile:f(u),useTransform:!0,signal:o.isSome(t)?t.signal:null});a.then((()=>u.dispose()),(()=>u.dispose()));const{vertexAttributes:c,components:y}=yield a;n.vertexAttributes=c,n.components=y}))).apply(this,arguments)}function f(e){const n=i.removeFile(e.url);return r=>{var t;const o=i.makeRelative(r,n,n),s=o?o.replace(/^ *\.\//,""):null;return null!=(t=e.files.get(s))?t:r}}function p(e,n){return y.apply(this,arguments)}function y(){return(y=r._asyncToGenerator((function*(e,n){return e instanceof Blob?w.fromBlob(e):"string"==typeof e?new w(e):Array.isArray(e)?h(e,n):m(e,n)}))).apply(this,arguments)}function h(e,n){return d.apply(this,arguments)}function d(){return d=r._asyncToGenerator((function*(e,n){const i=new Map;let l=null;const u=yield s.eachAlwaysValues(e.map(function(){var e=r._asyncToGenerator((function*(e){return{name:e.name,source:yield p(e instanceof Blob?e:e.source,n)}}));return function(n){return e.apply(this,arguments)}}())),a=[];for(const r of u)r&&(s.isAborted(n)?r.source.dispose():a.push(r));s.throwIfAborted(n);for(const{name:r,source:t}of a)(o.isNone(l)||/\.(gltf|glb)/i.test(r))&&(l=t.url),i.set(r,t.url),t.files&&t.files.forEach(((e,n)=>i.set(n,e)));if(o.isNone(l))throw new t("mesh-load-external:missing-files","Missing files to load external mesh source");return new w(l,(()=>a.forEach((({source:e})=>e.dispose()))),i)})),d.apply(this,arguments)}function m(e,n){return b.apply(this,arguments)}function b(){return b=r._asyncToGenerator((function*(n,t){const{default:o}=yield s.whenOrAbort(new Promise(((n,r)=>e(["../../../request"],(e=>n(u(e))),r))),t),i="string"==typeof n.multipart[0]?yield Promise.all(n.multipart.map(function(){var e=r._asyncToGenerator((function*(e){return(yield o(e,{responseType:"array-buffer"})).data}));return function(n){return e.apply(this,arguments)}}())):n.multipart;return w.fromBlob(new Blob(i))})),b.apply(this,arguments)}let w=function(){function e(e,n=(()=>{}),r=new Map){this.url=e,this.dispose=n,this.files=r}return e.fromBlob=function(n){const r=URL.createObjectURL(n);return new e(r,(()=>URL.revokeObjectURL(r)))},e}();n.loadExternal=a,Object.defineProperty(n,"__esModule",{value:!0})}));
