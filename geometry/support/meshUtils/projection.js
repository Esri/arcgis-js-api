/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../spatialReferenceUtils","../webMercatorUtils","../../../chunks/vec3f64","../../../chunks/vec3","../../projectionEllipsoid","../../projection","../../../chunks/mat3f64","../../../chunks/mat4f64","../../../chunks/mat3","../../../views/3d/support/buffer/BufferView"],(function(e,r,f,t,o,n,c,a,i,u,s,p){"use strict";const l=r.getLogger("esri.geometry.support.meshUtils.normalProjection");function m(e,r,f,t,o){return t.isWebMercator||t.isWGS84?(d(0,p.BufferViewVec3f.fromTypedArray(e),p.BufferViewVec3f64.fromTypedArray(r),p.BufferViewVec3f64.fromTypedArray(f),t,p.BufferViewVec3f.fromTypedArray(o)),o):(l.error("Cannot convert PCS spatial reference buffer to ECEF"),o)}function V(e,r,f,t,o){return t.isWebMercator||t.isWGS84?(d(1,p.BufferViewVec3f.fromTypedArray(e),p.BufferViewVec3f64.fromTypedArray(r),p.BufferViewVec3f64.fromTypedArray(f),t,p.BufferViewVec3f.fromTypedArray(o)),o):(l.error("Cannot convert to PCS spatial reference buffer from ECEF"),o)}function y(e,r,f){return a.projectBuffer(e,r,0,f,c.getSphericalPCPF(r),0,e.length/3),f}function E(e,r,f){return a.projectBuffer(e,c.getSphericalPCPF(f),0,r,f,0,e.length/3),r}function T(e,r,f=!1){if(e)for(let t=0;t<e.length;t+=3){for(let r=0;r<3;r++)g[r]=e[t+r];n.transformMat4(g,g,r),f&&n.normalize(g,g);for(let r=0;r<3;r++)e[t+r]=g[r]}}function C(e,r,f,t,o){if(!t.isWebMercator&&!t.isWGS84)return l.error("Cannot convert PCS spatial reference buffer to ECEF"),o;d(0,p.BufferViewVec3f.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),p.BufferViewVec3f64.fromTypedArray(r),p.BufferViewVec3f64.fromTypedArray(f),t,p.BufferViewVec3f.fromTypedArray(o,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)o[n]=e[n];return o}function B(e,r,f,t,o){if(!t.isWebMercator&&!t.isWGS84)return l.error("Cannot convert to PCS spatial reference buffer from ECEF"),o;d(1,p.BufferViewVec3f.fromTypedArray(e,16),p.BufferViewVec3f64.fromTypedArray(r),p.BufferViewVec3f64.fromTypedArray(f),t,p.BufferViewVec3f.fromTypedArray(o,16));for(let n=3;n<e.length;n+=4)o[n]=e[n];return o}function d(e,r,o,i,u,p){if(!r)return;const l=u.isWGS84||f.isCGCS2000(u)||f.isMars(u)||f.isMoon(u),m=o.count;if(l)for(let f=0;f<m;f++){i.getVec(f,g),r.getVec(f,F);const t=c.getSphericalPCPF(u);a.computeLinearTransformation(t,g,w,t),s.fromMat4(S,w),1===e&&s.transpose(S,S),n.transformMat3(F,F,S),p.setVec(f,F)}else for(let f=0;f<m;f++){i.getVec(f,g),r.getVec(f,F),a.computeLinearTransformation(c.SphericalECEFSpatialReference,g,w,c.SphericalECEFSpatialReference),s.fromMat4(S,w);const u=t.y2lat(o.get(f,1));let l=Math.cos(u);0===e&&(l=1/l),S[0]*=l,S[1]*=l,S[2]*=l,S[3]*=l,S[4]*=l,S[5]*=l,1===e&&s.transpose(S,S),n.transformMat3(F,F,S),n.normalize(F,F),p.setVec(f,F)}return p}const g=o.create(),F=o.create(),w=u.create(),S=i.create();e.projectFromECEF=E,e.projectNormalFromECEF=V,e.projectNormalToECEF=m,e.projectTangentFromECEF=B,e.projectTangentToECEF=C,e.projectToECEF=y,e.transformBufferInPlace=T,Object.defineProperty(e,"__esModule",{value:!0})}));
