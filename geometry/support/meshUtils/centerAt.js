/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/vec3f64","../../projectionEllipsoid","../../../chunks/mat4","../../projection","../../../chunks/mat4f64","./projection"],(function(e,t,r,o,n,i,c,a){"use strict";const s=t.getLogger("esri.geometry.support.meshUtils.centerAt");function p(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const o=e.spatialReference,n=o.isWGS84||o.isWebMercator&&(!r||!1!==r.geographic),i=r&&r.origin||e.extent.center;n?l(e,t,i):f(e,t,i)}function l(e,t,r){const c=e.spatialReference,p=o.getSphericalPCPF(c),l=m,f=d;if(!i.projectPointToVector(t,f,p))return void s.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to ECEF`);i.projectPointToVector(r,l,p)||i.projectPointToVector(e.extent.center,l,p);const u=e.vertexAttributes.position,h=e.vertexAttributes.normal,k=new Float64Array(u.length),x=new Float32Array(h?h.length:0);a.projectToECEF(u,c,k),h&&a.projectNormalToECEF(h,u,k,c,x),i.computeLinearTransformation(p,l,g,p),i.computeLinearTransformation(p,f,j,p),n.invert(g,g),n.multiply(j,j,g),a.transformBufferInPlace(k,j),n.invert(j,j),n.transpose(j,j),h&&a.transformBufferInPlace(x,j,!0),a.projectFromECEF(k,u,c),h&&a.projectNormalFromECEF(x,u,k,c,h),e.vertexAttributesChanged()}function f(e,t,r){const o=m,n=d;if(i.projectPointToVector(t,n,e.spatialReference)){if(!i.projectPointToVector(r,o,e.spatialReference)){const t=e.extent.center;o[0]=t.x,o[1]=t.y,o[2]=t.z,s.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Using mesh extent.center instead`)}u(e.vertexAttributes.position,n,o),e.vertexAttributesChanged()}else s.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid})`)}function u(e,t,r){if(e)for(let o=0;o<e.length;o+=3)for(let n=0;n<3;n++)e[o+n]+=t[n]-r[n]}const d=r.create(),m=r.create(),g=c.create(),j=c.create();e.centerAt=p,Object.defineProperty(e,"__esModule",{value:!0})}));
