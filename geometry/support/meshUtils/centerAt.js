/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/vec3f64","../../projectionEllipsoid","../../../chunks/mat4","../../projection","../../../chunks/mat4f64","./projection"],(function(e,t,r,o,n,i,c,a){"use strict";const s=t.getLogger("esri.geometry.support.meshUtils.centerAt");const p=r.create(),l=r.create(),f=c.create(),u=c.create();e.centerAt=function(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const c=e.spatialReference,d=c.isWGS84||c.isWebMercator&&(!r||!1!==r.geographic),m=r&&r.origin||e.extent.center;d?function(e,t,r){const c=e.spatialReference,d=o.getSphericalPCPF(c),m=l,j=p;if(!i.projectPointToVector(t,j,d))return void s.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to ECEF`);i.projectPointToVector(r,m,d)||i.projectPointToVector(e.extent.center,m,d);const g=e.vertexAttributes.position,h=e.vertexAttributes.normal,k=new Float64Array(g.length),F=new Float32Array(h?h.length:0);a.projectToECEF(g,c,k),h&&a.projectNormalToECEF(h,g,k,c,F);i.computeLinearTransformation(d,m,f,d),i.computeLinearTransformation(d,j,u,d),n.invert(f,f),n.multiply(u,u,f),a.transformBufferInPlace(k,u),n.invert(u,u),n.transpose(u,u),h&&a.transformBufferInPlace(F,u,!0);a.projectFromECEF(k,g,c),h&&a.projectNormalFromECEF(F,g,k,c,h);e.clearCache()}(e,t,m):function(e,t,r){const o=l,n=p;if(!i.projectPointToVector(t,n,e.spatialReference))return void s.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid})`);if(!i.projectPointToVector(r,o,e.spatialReference)){const t=e.extent.center;o[0]=t.x,o[1]=t.y,o[2]=t.z,s.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Using mesh extent.center instead`)}(function(e,t,r){if(!e)return;for(let o=0;o<e.length;o+=3)for(let n=0;n<3;n++)e[o+n]+=t[n]-r[n]})(e.vertexAttributes.position,n,o),e.clearCache()}(e,t,m)},Object.defineProperty(e,"__esModule",{value:!0})}));
