/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../core/maybe","../../../chunks/vec3","../../../chunks/vec3f64","../../projection","../../projectionEllipsoid","./geographicUtils","./projection"],(function(e,t,o,r,i,n,s,c,a){"use strict";const l=t.getLogger("esri.geometry.support.meshUtils.scale");function p(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const i=e.spatialReference;if(o.isSome(e.transform)){null!=r?.geographic&&r.geographic!==e.transform.geographic&&l.warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const o=r?.origin??e.transform.getOriginPoint(i);g(e.transform,t,o)}else{const o=c.isGeographicMesh(e.spatialReference,r),i=r&&r.origin||e.origin;o?f(e,t,i):m(e,t,i)}}function g(e,t,o){const n=r.set(h,o.x,o.y,o.z),s=r.subtract(h,n,e.origin);e.applyLocalInverse(s,P);const c=r.scale(i.create(),e.scale,t);e.scale=c,e.applyLocalInverse(s,s),r.subtract(s,s,P),e.translation=r.add(i.create(),e.translation,s)}function f(e,t,r){const i=e.spatialReference,c=s.getSphericalPCPF(i),l=d;n.projectPointToVector(r,l,c)||n.projectPointToVector(e.origin,l,c);const p=e.vertexAttributes.position,g=e.vertexAttributes.normal,f=e.vertexAttributes.tangent,m=new Float64Array(p.length),h=o.isSome(g)?new Float32Array(g.length):null,P=o.isSome(f)?new Float32Array(f.length):null;a.projectToPCPF(p,i,m),o.isSome(g)&&o.isSome(h)&&a.projectNormalToPCPF(g,p,m,i,h),o.isSome(f)&&o.isSome(P)&&a.projectTangentToPCPF(f,p,m,i,P),u(m,t,l),a.projectFromPCPF(m,p,i),o.isSome(g)&&o.isSome(h)&&a.projectNormalFromPCPF(h,p,m,i,g),o.isSome(f)&&o.isSome(P)&&a.projectTangentFromPCPF(P,p,m,i,f),e.vertexAttributesChanged()}function m(e,t,o){const r=d;if(!n.projectPointToVector(o,r,e.spatialReference)){const t=e.origin;r[0]=t.x,r[1]=t.y,r[2]=t.z,l.error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}u(e.vertexAttributes.position,t,r),e.vertexAttributesChanged()}function u(e,t,o=i.ZEROS){if(e)for(let i=0;i<e.length;i+=3){for(let t=0;t<3;t++)h[t]=e[i+t]-o[t];r.scale(h,h,t);for(let t=0;t<3;t++)e[i+t]=h[t]+o[t]}}const h=i.create(),P=i.create(),d=i.create();e.scale=p,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
