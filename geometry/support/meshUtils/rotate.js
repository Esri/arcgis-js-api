/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../core/maybe","../../../chunks/mat3","../../../chunks/mat3f64","../../../chunks/mat4","../../../chunks/mat4f64","../../../chunks/vec3","../../../chunks/vec3f64","../../projection","../../projectionEllipsoid","../axisAngleDegrees","./geographicUtils","./projection"],(function(e,t,o,r,i,n,a,s,c,g,l,p,m,f){"use strict";const u=t.getLogger("esri.geometry.support.meshUtils.rotate");function h(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position||0===t[3])return;const i=e.spatialReference;if(o.isSome(e.transform)){null!=r?.geographic&&r.geographic!==e.transform.geographic&&u.warn(`Specifying the 'geographic' parameter (${r.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const o=r?.origin??e.transform.getOriginPoint(i);d(e.transform,t,o)}else{const o=r?.origin??e.origin;m.isGeographicMesh(e.spatialReference,r)?P(e,t,o):x(e,t,o)}}function d(e,t,o){const r=s.set(S,o.x,o.y,o.z),i=s.subtract(S,r,e.origin);e.applyLocalInverse(i,b),e.rotation=p.compose(e.rotation,t,p.create()),e.applyLocalInverse(i,i),s.subtract(i,i,b),e.translation=s.add(c.create(),e.translation,i)}function P(e,t,i){const n=e.spatialReference,a=l.getSphericalPCPF(n),c=y;g.projectPointToVector(i,c,a)||g.projectPointToVector(e.origin,c,a);const m=e.vertexAttributes.position,u=e.vertexAttributes.normal,h=e.vertexAttributes.tangent,d=new Float64Array(m.length),P=o.isSome(u)?new Float32Array(u.length):null,x=o.isSome(h)?new Float32Array(h.length):null;g.computeTranslationToOriginAndRotation(a,c,j,a),r.fromMat4(F,j);const S=A;s.transformMat3(p.axis(A),p.axis(t),F),S[3]=t[3],f.projectToPCPF(m,n,d),o.isSome(u)&&o.isSome(P)&&f.projectNormalToPCPF(u,m,d,n,P),o.isSome(h)&&o.isSome(x)&&f.projectTangentToPCPF(h,m,d,n,x),v(d,S,3,c),f.projectFromPCPF(d,m,n),o.isSome(u)&&o.isSome(P)&&(v(P,S,3),f.projectNormalFromPCPF(P,m,d,n,u)),o.isSome(h)&&o.isSome(x)&&(v(x,S,4),f.projectTangentFromPCPF(x,m,d,n,h)),e.vertexAttributesChanged()}function x(e,t,o){const r=y;if(!g.projectPointToVector(o,r,e.spatialReference)){const t=e.origin;r[0]=t.x,r[1]=t.y,r[2]=t.z,u.error(`Failed to project specified origin (wkid:${o.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}v(e.vertexAttributes.position,t,3,r),v(e.vertexAttributes.normal,t,3),v(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function v(e,t,r,i=c.ZEROS){if(!o.isNone(e)){n.fromRotation(j,p.angleRad(t),p.axis(t));for(let t=0;t<e.length;t+=r){for(let o=0;o<3;o++)S[o]=e[t+o]-i[o];s.transformMat4(S,S,j);for(let o=0;o<3;o++)e[t+o]=S[o]+i[o]}}}const S=c.create(),b=c.create(),A=p.create(),j=a.create(),F=i.create(),y=c.create();e.rotate=h,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
