/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/vec3f64","../../../chunks/vec3","../../projectionEllipsoid","../../../chunks/mat4","../../projection","../../../chunks/mat3f64","../../../chunks/mat4f64","../../../chunks/quatf64","../../../chunks/vec4f64","../../../chunks/mat3","./projection","../../../chunks/quat"],(function(e,t,r,n,o,i,c,s,a,u,l,p,f,g){"use strict";const m=t.getLogger("esri.geometry.support.meshUtils.rotate");function x(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position||0===t[3])return;const n=e.spatialReference,o=n.isWGS84||n.isWebMercator&&(!r||!1!==r.geographic),i=r&&r.origin||e.extent.center;o?F(e,t,i):d(e,t,i)}function A(e,t,r){return n.copy(r,e),r[3]=t,r}function h(e,t,r){return g.setAxisAngle(k,e,e[3]),g.setAxisAngle(b,t,t[3]),g.multiply(k,b,k),r[3]=g.getAxisAngle(r,k),r}function F(e,t,r){const i=e.spatialReference,s=o.getSphericalPCPF(i),a=T;c.projectPointToVector(r,a,s)||c.projectPointToVector(e.extent.center,a,s);const u=e.vertexAttributes.position,l=e.vertexAttributes.normal,g=e.vertexAttributes.tangent,m=new Float64Array(u.length),x=new Float32Array(l?l.length:0),A=new Float32Array(g?g.length:0);c.computeLinearTransformation(s,a,y,s),p.fromMat4(C,y);const h=E;n.transformMat3(E,t,C),h[3]=t[3],f.projectToECEF(u,i,m),l&&f.projectNormalToECEF(l,u,m,i,x),g&&f.projectTangentToECEF(g,u,m,i,A),j(m,h,3,a),f.projectFromECEF(m,u,i),l&&(j(x,h,3),f.projectNormalFromECEF(x,u,m,i,l)),g&&(j(A,h,4),f.projectTangentFromECEF(A,u,m,i,g)),e.vertexAttributesChanged()}function d(e,t,r){const n=T;if(!c.projectPointToVector(r,n,e.spatialReference)){const t=e.extent.center;n[0]=t.x,n[1]=t.y,n[2]=t.z,m.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Using mesh extent.center instead`)}j(e.vertexAttributes.position,t,3,n),j(e.vertexAttributes.normal,t,3),j(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function j(e,t,o,c=r.ZEROS){if(e){i.identity(y),i.rotate(y,y,t[3],t);for(let t=0;t<e.length;t+=o){for(let r=0;r<3;r++)v[r]=e[t+r]-c[r];n.transformMat4(v,v,y);for(let r=0;r<3;r++)e[t+r]=v[r]+c[r]}}}const v=r.create(),E=l.create(),k=u.create(),b=u.create(),y=a.create(),C=s.create(),T=r.create();e.axisAngleFrom=A,e.axisAngleMultiply=h,e.rotate=x,Object.defineProperty(e,"__esModule",{value:!0})}));
