/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/Logger","../../../chunks/vec3f64","../../../chunks/vec3","../../projectionEllipsoid","../../../chunks/mat4","../../projection","../../../chunks/mat3f64","../../../chunks/mat4f64","../../../chunks/quatf64","../../../chunks/vec4f64","../../../chunks/mat3","./projection","../../../chunks/quat"],(function(e,t,r,n,o,c,i,a,s,l,u,p,f,g){"use strict";const m=t.getLogger("esri.geometry.support.meshUtils.rotate");function h(e,t,o,i=r.ZEROS){if(e){c.identity(E),c.rotate(E,E,t[3],t);for(let t=0;t<e.length;t+=o){for(let r=0;r<3;r++)x[r]=e[t+r]-i[r];n.transformMat4(x,x,E);for(let r=0;r<3;r++)e[t+r]=x[r]+i[r]}}}const x=r.create(),A=u.create(),F=l.create(),j=l.create(),E=s.create(),k=a.create(),d=r.create();e.axisAngleFrom=function(e,t,r){return n.copy(r,e),r[3]=t,r},e.axisAngleMultiply=function(e,t,r){return g.setAxisAngle(F,e,e[3]),g.setAxisAngle(j,t,t[3]),g.multiply(F,j,F),r[3]=g.getAxisAngle(r,F),r},e.rotate=function(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position||0===t[3])return;const c=e.spatialReference,a=c.isWGS84||c.isWebMercator&&(!r||!1!==r.geographic),s=r&&r.origin||e.extent.center;a?function(e,t,r){const c=e.spatialReference,a=o.getSphericalPCPF(c),s=d;i.projectPointToVector(r,s,a)||i.projectPointToVector(e.extent.center,s,a);const l=e.vertexAttributes.position,u=e.vertexAttributes.normal,g=e.vertexAttributes.tangent,m=new Float64Array(l.length),x=new Float32Array(u?u.length:0),F=new Float32Array(g?g.length:0);i.computeLinearTransformation(a,s,E,a),p.fromMat4(k,E);const j=A;n.transformMat3(A,t,k),j[3]=t[3],f.projectToECEF(l,c,m),u&&f.projectNormalToECEF(u,l,m,c,x);g&&f.projectTangentToECEF(g,l,m,c,F);h(m,j,3,s),f.projectFromECEF(m,l,c),u&&(h(x,j,3),f.projectNormalFromECEF(x,l,m,c,u));g&&(h(F,j,4),f.projectTangentFromECEF(F,l,m,c,g));e.clearCache()}(e,t,s):function(e,t,r){const n=d;if(!i.projectPointToVector(r,n,e.spatialReference)){const t=e.extent.center;n[0]=t.x,n[1]=t.y,n[2]=t.z,m.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Using mesh extent.center instead`)}h(e.vertexAttributes.position,t,3,n),h(e.vertexAttributes.normal,t,3),h(e.vertexAttributes.tangent,t,4),e.clearCache()}(e,t,s)},Object.defineProperty(e,"__esModule",{value:!0})}));
