/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../../../core/promiseUtils","../../Point","../../../geometry","../../../Ground","../../../core/unitUtils","../../Mesh"],(function(e,t,n,a,o,i,r,s){"use strict";async function l(e,t,n){let a;if(f(e)||e instanceof i){const o=await u(e);a=await o.createElevationSampler(t,{demResolution:n&&n.demResolution||"finest-contiguous"})}else a=e;return c(a,t,n)}function c(e,n,a){const o=r.getMetersPerUnitForSR(n.spatialReference),i=e.demResolution.min/o,l=Math.round(n.width/i),c=Math.round(n.height/i),u=l+1,f=c+1,d=new Float64Array(u*f*3),m=new Float32Array(u*f*2);let y=0,w=0;const h=new Uint32Array(l*c*2*3);let R=0,v=0;p.spatialReference=n.spatialReference;for(let r=0;r<f;r++){const a=n.ymin+n.height*(r/c);for(let o=0;o<u;o++){const i=n.xmin+n.width*(o/l);p.x=i,p.y=a,d[y++]=i,d[y++]=a,d[y++]=t.unwrapOr(e.elevationAt(p),0);const s=o/l,f=r/c;m[w++]=s,m[w++]=f,r!==c&&o!==l&&(h[v++]=R+1,h[v++]=R+u+1,h[v++]=R+u,h[v++]=R,h[v++]=R+1,h[v++]=R+u),R++}}return new s({vertexAttributes:{position:d,uv:m},components:[{faces:h,shading:"smooth",material:a&&a.material||null}],spatialReference:n.spatialReference})}async function u(e){return f(e)?e.load():(await e.load(),await n.eachAlways(e.layers.map((e=>e.load()))),e)}function f(e){return"type"in e&&("elevation"===e.type||"base-elevation"===e.type)}const p=new a;e.create=l,Object.defineProperty(e,"__esModule",{value:!0})}));
