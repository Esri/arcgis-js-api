/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/promiseUtils","../../../../Point","./glb","./gltf","./types","./imageutils","./asset","./scene","./node"],(function(e,t,r,u,n,o,p,a,f,i){"use strict";const s="model.gltf",c="model.glb";function y(e,a,f){a=a||{};const i=new n.GLTF(e,a,f);let y=i.params;y?y.origin||(y.origin=new r({x:-1,y:-1,z:-1})):y={origin:new r({x:-1,y:-1,z:-1})};const l=y.origin,g=i.gltf,O=g.extras.promises;let d=1,b=1,m=null;return t.eachAlways(O).then((()=>{const e={origin:l};delete g.extras;const t="number"==typeof a.jsonSpacing?a.jsonSpacing:4,r=JSON.stringify(g,((t,r)=>{if("extras"!==t){if(r instanceof ArrayBuffer){if(p.isArrayBufferPNG(r))switch(a.imageOutputType){case o.ImageOutputType.DataURI:case o.ImageOutputType.GLB:break;case o.ImageOutputType.External:default:{const t=`img${b}.png`;return b++,e[t]=r,t}}switch(a.bufferOutputType){case o.BufferOutputType.DataURI:return p.encodeBase64DataUri(r);case o.BufferOutputType.GLB:if(m)throw new Error("Already encountered an ArrayBuffer, there should only be one in the GLB format.");return void(m=r);case o.BufferOutputType.External:default:{const t=`data${d}.bin`;return d++,e[t]=r,t}}}return r}}),t);return a.bufferOutputType===o.BufferOutputType.GLB||a.imageOutputType===o.ImageOutputType.GLB?e[c]=new u.GLB(r,m).buffer:e[s]=r,e}))}function l(e,t){return y(e,{bufferOutputType:o.BufferOutputType.GLB,imageOutputType:o.ImageOutputType.GLB,jsonSpacing:0},t)}Object.defineProperty(e,"AlphaMode",{enumerable:!0,get:function(){return o.AlphaMode}}),Object.defineProperty(e,"AttributeType",{enumerable:!0,get:function(){return o.AttributeType}}),Object.defineProperty(e,"BufferOutputType",{enumerable:!0,get:function(){return o.BufferOutputType}}),Object.defineProperty(e,"ColorMode",{enumerable:!0,get:function(){return o.ColorMode}}),Object.defineProperty(e,"ImageOutputType",{enumerable:!0,get:function(){return o.ImageOutputType}}),Object.defineProperty(e,"MeshMode",{enumerable:!0,get:function(){return o.MeshMode}}),e.Asset=a.Asset,e.Scene=f.Scene,e.Node=i.Node,e.MODEL_NAME_GLB=c,e.MODEL_NAME_GLTF=s,e.exportGLB=l,e.exportGLTF=y,Object.defineProperty(e,"__esModule",{value:!0})}));
