/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../../../core/promiseUtils","../../../../Point","./asset","./types","./glb","./imageutils","./gltf","./scene","./node"],(function(e,t,r,n,u,o,p,a,f,i){"use strict";const c="model.gltf",s="model.glb";function y(e,n,f){n=n||{};const i=new a.GLTF(e,n,f);let y=i.params;y?y.origin||(y.origin=new r({x:-1,y:-1,z:-1})):y={origin:new r({x:-1,y:-1,z:-1})};const l=y.origin,g=i.gltf,d=g.extras.promises;let O=1,m=1,b=null;return t.eachAlways(d).then((()=>{const e={origin:l};delete g.extras;const t="number"==typeof n.jsonSpacing?n.jsonSpacing:4,r=JSON.stringify(g,((t,r)=>{if("extras"!==t){if(r instanceof ArrayBuffer){if(p.isArrayBufferPNG(r))switch(n.imageOutputType){case u.ImageOutputType.DataURI:case u.ImageOutputType.GLB:break;case u.ImageOutputType.External:default:{const t=`img${m}.png`;return m++,e[t]=r,t}}switch(n.bufferOutputType){case u.BufferOutputType.DataURI:return p.encodeBase64DataUri(r);case u.BufferOutputType.GLB:if(b)throw new Error("Already encountered an ArrayBuffer, there should only be one in the GLB format.");return void(b=r);case u.BufferOutputType.External:default:{const t=`data${O}.bin`;return O++,e[t]=r,t}}}return r}}),t);return n.bufferOutputType===u.BufferOutputType.GLB||n.imageOutputType===u.ImageOutputType.GLB?e[s]=new o.GLB(r,b).buffer:e[c]=r,e}))}function l(e,t){return y(e,{bufferOutputType:u.BufferOutputType.GLB,imageOutputType:u.ImageOutputType.GLB,jsonSpacing:0},t)}e.Asset=n.Asset,Object.defineProperty(e,"AlphaMode",{enumerable:!0,get:function(){return u.AlphaMode}}),Object.defineProperty(e,"BufferOutputType",{enumerable:!0,get:function(){return u.BufferOutputType}}),Object.defineProperty(e,"ColorMode",{enumerable:!0,get:function(){return u.ColorMode}}),Object.defineProperty(e,"ComponentType",{enumerable:!0,get:function(){return u.ComponentType}}),Object.defineProperty(e,"DataType",{enumerable:!0,get:function(){return u.DataType}}),Object.defineProperty(e,"FilterMode",{enumerable:!0,get:function(){return u.FilterMode}}),Object.defineProperty(e,"ImageOutputType",{enumerable:!0,get:function(){return u.ImageOutputType}}),Object.defineProperty(e,"MeshMode",{enumerable:!0,get:function(){return u.MeshMode}}),e.Scene=f.Scene,e.Node=i.Node,e.MODEL_NAME_GLB=s,e.MODEL_NAME_GLTF=c,e.exportGLB=l,e.exportGLTF=y,Object.defineProperty(e,"__esModule",{value:!0})}));
