/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../core/maybe.js";import{open as t}from"../../../core/workers/workers.js";import{c as r}from"../../../chunks/vec3f64.js";import{fromValues as o}from"../ray.js";import{intersectRay as n}from"../triangle.js";import a from"./ElevationSamplerWorker.js";import{ElevationSamplerBase as i}from"../../../layers/support/ElevationSampler.js";async function s(e,t){const r=await l(),o=await p.createIndex(e,r);return c(r),new m(e,o,t)}class m extends i{constructor(t,r,o){super(),this.rindex=r,this.demResolution={min:0,max:0},this.spatialReference=t.spatialReference.clone(),this.extent=t.extent.clone(),this.noDataValue=e(o)&&o.noDataValue||0}elevationAt(e,t){let r=Number.NEGATIVE_INFINITY;return o([e,t,0],[0,0,-1],N),this.rindex.search({minX:e,maxX:e,minY:t,maxY:t},(e=>{n(e,N,j)&&j[2]>r&&(r=j[2])})),r===Number.NEGATIVE_INFINITY?this.noDataValue:r}}function l(){return++f,u(),h||(h=t("ElevationSamplerWorker").catch((()=>null)),h)}function c(t){--f,e(t)&&0===f&&(x=setTimeout((()=>{t.close(),h=null,x=0}),I))}function u(){x&&(clearTimeout(x),x=0)}const p=new a;let f=0,h=null,x=0;const I=1e4,N=o([0,0,0],[0,0,-1]),j=r();export{s as create};
