/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","./aaBoundingRect","./boundsUtils","./intersectsBase","./jsonUtils","./normalizeUtilsCommon","./spatialReferenceUtils"],(function(n,t,e,i,s,m,a){"use strict";function x(n){if(!n)return null;let t=null;const x=n.spatialReference,f=a.getInfo(x);if(!f)return"toJSON"in n?n.toJSON():n;const c=a.isWebMercator(x)?102100:4326,l=m.cutParams[c].maxX,y=m.cutParams[c].minX,p=m.cutParams[c].plus180Line,g=m.cutParams[c].minus180Line;let M;const P="toJSON"in n?n.toJSON():n;if(s.isPoint(P))M=u(P,l,y);else if(s.isMultipoint(P))P.points=P.points.map((n=>u(n,l,y))),M=P;else if(s.isExtent(P))M=r(P,f);else if(s.isPolygon(P)||s.isPolyline(P)){const n=h;e.getBoundsXY(n,P);const s={xmin:n[0],ymin:n[1],xmax:n[2],ymax:n[3]},a=m.offsetMagnitude(s.xmin,y)*(2*l),x=0===a?P:o(P,a);s.xmin+=a,s.xmax+=a,i.extentIntersectsPolyline(s,p)&&s.xmax!==l||i.extentIntersectsPolyline(s,g)&&s.xmin!==y?t=x:M=x}else M=P;if(null!==t){return(new d).cut(t,l)}return M}function o(n,t){const e=m.getGeometryParts(n);for(const i of e)for(const n of i)n[0]+=t;return n}function r(n,t){if(!t)return n;const e=f(n,t).map((n=>n.extent));return e.length<2?e[0]||n:e.length>2?(n.xmin=t.valid[0],n.xmax=t.valid[1],n):{rings:e.map((n=>[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]))}}function u(n,t,e){if(Array.isArray(n)){const i=n[0];if(i>t){const e=m.offsetMagnitude(i,t);n[0]=i+e*(-2*t)}else if(i<e){const t=m.offsetMagnitude(i,e);n[0]=i+t*(-2*e)}}else{const i=n.x;if(i>t){const e=m.offsetMagnitude(i,t);n.x+=e*(-2*t)}else if(i<e){const t=m.offsetMagnitude(i,e);n.x+=t*(-2*e)}}return n}function f(n,t){const e=[],{ymin:i,ymax:s}=n,m=n.xmax-n.xmin,a=n.xmin,x=n.xmax;let o;const[r,u]=t.valid;o=c(n.xmin,t);const f=o.x,y=o.frameId;o=c(n.xmax,t);const d=o.x,h=o.frameId,p=f===d&&m>0;if(m>2*u){const n={xmin:a<x?f:d,ymin:i,xmax:u,ymax:s},t={xmin:r,ymin:i,xmax:a<x?d:f,ymax:s},m={xmin:0,ymin:i,xmax:u,ymax:s},o={xmin:r,ymin:i,xmax:0,ymax:s},c=[],p=[];l(n,m)&&c.push(y),l(n,o)&&p.push(y),l(t,m)&&c.push(h),l(t,o)&&p.push(h);for(let e=y+1;e<h;e++)c.push(e),p.push(e);e.push({extent:n,frameIds:[y]},{extent:t,frameIds:[h]},{extent:m,frameIds:c},{extent:o,frameIds:p})}else f>d||p?e.push({extent:{xmin:f,ymin:i,xmax:u,ymax:s},frameIds:[y]},{extent:{xmin:r,ymin:i,xmax:d,ymax:s},frameIds:[h]}):e.push({extent:{xmin:f,ymin:i,xmax:d,ymax:s},frameIds:[y]});return e}function c(n,t){const[e,i]=t.valid,s=2*i;let m,a=0;return n>i?(m=Math.ceil(Math.abs(n-i)/s),n-=m*s,a=m):n<e&&(m=Math.ceil(Math.abs(n-e)/s),n+=m*s,a=-m),{x:n,frameId:a}}function l(n,t){const{xmin:e,ymin:i,xmax:s,ymax:m}=t;return y(n,e,i)&&y(n,e,m)&&y(n,s,m)&&y(n,s,i)}function y(n,t,e){return t>=n.xmin&&t<=n.xmax&&e>=n.ymin&&e<=n.ymax}let d=function(){function n(){}return n.prototype.cut=function(n,t){let e;if(n.rings)this.closed=!0,e=n.rings,this.minPts=4;else{if(!n.paths)return null;this.closed=!1,e=n.paths,this.minPts=2}const i=e.length,s=-2*t;for(let m=0;m<i;m++){const n=e[m];if(n&&n.length>=this.minPts){const t=[];for(const e of n)t.push([e[0]+s,e[1]]);e.push(t)}}return this.closed?n.rings=e:n.paths=e,n},n}();const h=t.create();n.normalizeCentralMeridianSync=x,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
