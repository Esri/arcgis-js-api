/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/Error","../core/Loadable","../core/Logger","../core/maybe","../core/Promise","../core/promiseUtils","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","../chunks/vec3f64","./Extent","./Geometry","./Point","./Polygon","./support/axisAngleDegrees","./support/MeshComponent","./support/MeshTransform","./support/MeshVertexAttributes","./support/triangulationUtils","./support/meshUtils/centerAt","./support/meshUtils/loadExternal","./support/meshUtils/offset","./support/meshUtils/primitives","./support/meshUtils/rotate","./support/meshUtils/scale"],(function(e,t,n,o,r,i,s,a,c,l,p,u,h,m,f,d,x,y,g,b,v,w,A,_,M,P,S,R,U){"use strict";var z;const F=i.getLogger("esri.geometry.Mesh");let C=z=function(n){function r(e){var t;return(t=n.call(this,e)||this).components=null,t.transform=null,t.external=null,t.hasZ=!0,t.hasM=!1,t.vertexAttributes=new w.MeshVertexAttributes,t.type="mesh",t}t._inheritsLoose(r,n);var i=r.prototype;return i.initialize=function(){(s.isNone(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded")},i.addComponent=function(e){this.loaded?(this.components||(this.components=[]),this.components.push(b.from(e)),this.notifyChange("components")):F.error("addComponent()","Mesh must be loaded before applying operations")},i.removeComponent=function(e){if(this.loaded){if(this.components){const t=this.components.indexOf(e);if(-1!==t)return this.components.splice(t,1),void this.notifyChange("components")}F.error("removeComponent()","Provided component is not part of the list of components")}else F.error("removeComponent()","Mesh must be loaded before applying operations")},i.rotate=function(e,t,n,o){return g.fromAxisAndAngle(G.x,e,O),g.fromAxisAndAngle(G.y,t,L),g.fromAxisAndAngle(G.z,n,T),g.compose(O,L,O),g.compose(O,T,O),R.rotate(this,O,o),this},i.offset=function(e,t,n,o){return this.loaded?(E[0]=e,E[1]=t,E[2]=n,P.offset(this,E,o),this):(F.error("offset()","Mesh must be loaded before applying operations"),this)},i.scale=function(e,t){return this.loaded?(U.scale(this,e,t),this):(F.error("scale()","Mesh must be loaded before applying operations"),this)},i.centerAt=function(e,t){return this.loaded?(_.centerAt(this,e,t),this):(F.error("centerAt()","Mesh must be loaded before applying operations"),this)},i.load=function(e){return s.isSome(this.external)&&this.addResolvingPromise(M.loadExternal(this,this.external.source,e)),Promise.resolve(this)},i.clone=function(){const e=this.components?new Map:null,t=this.components?new Map:null,n={components:this.components?this.components.map((n=>n.cloneWithDeduplication(e,t))):null,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:s.isSome(this.transform)?this.transform.clone():null,external:s.isSome(this.external)?{source:this.external.source,extent:s.isSome(this.external.extent)?this.external.extent.clone():null}:null};return new z(n)},i.vertexAttributesChanged=function(){this.notifyChange("vertexAttributes")},i.toBinaryGLTF=function(){var n=t._asyncToGenerator((function*(t){const{toBinaryGLTF:n}=yield new Promise((function(t,n){e(["./support/meshUtils/exporters/gltf/gltfexport"],t,n)}));return n(this,t)}));function o(e){return n.apply(this,arguments)}return o}(),r.createBox=function(e,t){if(!(e instanceof x))return F.error(".createBox()","expected location to be a Point instance"),null;const n=new z(S.convertUnitGeometry(S.createUnitSizeBox(),e,t));return t&&t.imageFace&&"all"!==t.imageFace?S.extractSingleFaceOfBox(n,t.imageFace):n},r.createSphere=function(e,t){return e instanceof x?new z(S.convertUnitGeometry(S.createUnitSizeSphere(t&&t.densificationFactor||0),e,t)):(F.error(".createSphere()","expected location to be a Point instance"),null)},r.createCylinder=function(e,t){return e instanceof x?new z(S.convertUnitGeometry(S.createUnitSizeCylinder(t&&t.densificationFactor||0),e,t)):(F.error(".createCylinder()","expected location to be a Point instance"),null)},r.createPlane=function(e,t){return e instanceof x?new z(S.convertUnitGeometry(S.createUnitSizePlane(t&&t.facing||"up"),e,t)):(F.error(".createPlane()","expected location to be a Point instance"),null)},r.createFromPolygon=function(e,t){if(!(e instanceof y))return F.error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const n=A.triangulate(e);return new z({vertexAttributes:new w.MeshVertexAttributes({position:n.position}),components:[new b({faces:n.faces,shading:"flat",material:t&&t.material||null})],spatialReference:e.spatialReference})},r.createFromGLTF=function(){var n=t._asyncToGenerator((function*(t,n,r){if(!(t instanceof x))throw F.error(".createfromGLTF()","expected location to be a Point instance"),new o("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:i}=yield c.whenOrAbort(new Promise((function(t,n){e(["./support/meshUtils/loadGLTFMesh"],t,n)})),r);return new z(yield i(t,n,r))}));function r(e,t,o){return n.apply(this,arguments)}return r}(),r.createWithExternalSource=function(e,t,n){var o,r,i;const s=null!=(o=null==n?void 0:n.extent)?o:null,a=null!=(r=null==n?void 0:n.transform.clone())?r:new v;a.origin=[e.x,e.y,null!=(i=e.z)?i:0];const c=e.spatialReference;return new z({external:{source:t,extent:s},transform:a,spatialReference:c})},r.createIncomplete=function(e,t){var n,r;const i=null!=(n=null==t?void 0:t.transform.clone())?n:new v;i.origin=[e.x,e.y,null!=(r=e.z)?r:0];const s=e.spatialReference,a=new z({transform:i,spatialReference:s});return a.addResolvingPromise(Promise.reject(new o("mesh-incomplete","Mesh resources are not complete"))),a},t._createClass(r,[{key:"hasExtent",get:function(){return!this.loaded&&s.isSome(this.external)&&s.isSome(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}},{key:"boundingInfo",get:function(){const e=this.vertexAttributes.position,t=this.spatialReference;if(0===e.length||this.components&&0===this.components.length)return{extent:new f({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:t}),center:new x({x:0,y:0,z:0,spatialReference:t})};const n=s.isSome(this.transform)?this.transform.project(e,t):e;let o=1/0,r=1/0,i=1/0,a=-1/0,c=-1/0,l=-1/0,p=0,u=0,h=0;const m=n.length,d=1/(m/3);let y=0;for(;y<m;){const e=n[y++],t=n[y++],s=n[y++];o=Math.min(o,e),r=Math.min(r,t),i=Math.min(i,s),a=Math.max(a,e),c=Math.max(c,t),l=Math.max(l,s),p+=d*e,u+=d*t,h+=d*s}return{extent:new f({xmin:o,ymin:r,zmin:i,xmax:a,ymax:c,zmax:l,spatialReference:t}),center:new x({x:p,y:u,z:h,spatialReference:t})}}},{key:"anchor",get:function(){if(s.isSome(this.transform))return this.transform.getOriginPoint(this.spatialReference);const e=this.boundingInfo;return new x({x:e.center.x,y:e.center.y,z:e.extent.zmin,spatialReference:this.spatialReference})}},{key:"origin",get:function(){return s.isSome(this.transform)?this.transform.getOriginPoint(this.spatialReference):this.boundingInfo.center}},{key:"extent",get:function(){return!this.loaded&&s.isSome(this.external)&&s.isSome(this.external.extent)?this.external.extent.clone():this.boundingInfo.extent}}]),r}(r.LoadableMixin(a.EsriPromiseMixin(d)));n.__decorate([l.property({type:[b],json:{write:!0}})],C.prototype,"components",void 0),n.__decorate([l.property({type:v,json:{write:!0}})],C.prototype,"transform",void 0),n.__decorate([l.property({constructOnly:!0})],C.prototype,"external",void 0),n.__decorate([l.property({readOnly:!0})],C.prototype,"hasExtent",null),n.__decorate([l.property({readOnly:!0})],C.prototype,"boundingInfo",null),n.__decorate([l.property({readOnly:!0})],C.prototype,"anchor",null),n.__decorate([l.property({readOnly:!0})],C.prototype,"origin",null),n.__decorate([l.property({readOnly:!0,json:{read:!1}})],C.prototype,"extent",null),n.__decorate([l.property({readOnly:!0,json:{read:!1,write:!0,default:!0}})],C.prototype,"hasZ",void 0),n.__decorate([l.property({readOnly:!0,json:{read:!1,write:!0,default:!1}})],C.prototype,"hasM",void 0),n.__decorate([l.property({type:w.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],C.prototype,"vertexAttributes",void 0),C=z=n.__decorate([h.subclass("esri.geometry.Mesh")],C);const G={x:m.fromValues(1,0,0),y:m.fromValues(0,1,0),z:m.fromValues(0,0,1)},O=g.create(),L=g.create(),T=g.create(),E=m.create();return C}));
