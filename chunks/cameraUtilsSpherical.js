/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../core/mathUtils","./mat4","./mat4f64","./vec3","./vec3f64","../geometry/Extent","../geometry/projectionEllipsoid","../geometry/SpatialReference","../geometry/support/webMercatorUtils","../views/3d/support/cameraUtilsInternal","../views/3d/support/earthUtils","../views/3d/support/mathUtils"],(function(e,t,a,n,i,o,r,s,c,l,d,h,u){"use strict";const y=o.fromValues(0,0,1),p=i.normalize(o.create(),o.fromValues(1,1,1)),f=new u.Cyclical(-180,180),g=n.create(),M=o.create(),m=o.create();function T(e,n,o,r=d.createDirectionUp()){i.cross(M,e,y),0===i.dot(M,M)&&i.cross(M,e,p),a.fromRotation(g,-t.deg2rad(n),e),a.rotate(g,g,-t.deg2rad(o),M);const{up:s,direction:c}=r;return i.cross(s,M,e),i.normalize(s,s),i.transformMat4(s,s,g),i.normalize(c,e),i.negate(c,c),i.transformMat4(c,c,g),r}function R(e,t,a,n){const o=M,r=m;return i.normalize(o,e),i.cross(m,o,y),0===i.dot(m,m)&&i.cross(m,o,p),i.cross(r,m,o),d.directionToHeadingTilt(t,a,n,o,r)}function b(e,a,n,r){const s={eye:o.create(),up:null,tilt:r,heading:n},c=M;c[0]=e[0],c[1]=e[2],c[2]=-e[1];const l=a,d=t.deg2rad(n),h=t.deg2rad(r),u=Math.sin(d),y=Math.cos(d),p=Math.sin(h),f=Math.cos(h),g=i.length(c);let m;if(Math.abs(h)<1e-8)m=l+g;else{const e=g/p,a=t.asinClamped(l/e),n=Math.PI-h-a;m=e*Math.sin(n)}const T=f*l,R=l*l*(p*p),b=y*y*R,E=m-T,I=E*E,P=b*(b+I-c[1]*c[1]);if(P<0)return i.scale(s.eye,c,m/g),s.tilt=0,s;const v=Math.sqrt(P),w=c[1]*E,z=b+I;let C;if(C=y>0?-v+w:v+w,Math.abs(z)<1e-8)return g<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=l):i.scale(s.eye,c,m/g),s.tilt=0,x(s.eye),U(s,e);s.eye[1]=C/z;const D=u*u*R,H=p*l,S=y*H*s.eye[1],W=s.eye[1]*s.eye[1],k=1-W,q=Math.sqrt(k),A=b*W+D-2*S*q*E+k*I;return Math.abs(A)<1e-8?(i.scale(s.eye,c,m/g),s.tilt=0,x(s.eye),U(s,e)):(s.eye[0]=(k*(m*c[0]-T*c[0])-H*q*(c[0]*s.eye[1]*y+c[2]*u))/A,s.eye[2]=(k*(m*c[2]-T*c[2])-H*q*(c[2]*s.eye[1]*y-c[0]*u))/A,i.scale(s.eye,s.eye,m),x(s.eye),U(s,e))}function x(e){const t=e[1];e[1]=-e[2],e[2]=t}function U(e,t){const a=T(t,e.heading,e.tilt);return e.up=a.up,e}function E(e,a,n){const o=i.length(a),r=Math.sqrt(n*n+o*o-2*n*o*Math.cos(Math.PI-e)),s=t.asinClamped(n/(r/Math.sin(e)));return t.rad2deg(e-s)}function I(e,a,n){const o=t.deg2rad(e),r=i.length(a);return t.asinClamped(n/(r/Math.sin(o)))+o}function P(e,a,n,i,o){let d,y,p,g;const M=a.latitude,m=s.getReferenceEllipsoid(e.spatialReference).radius,T=a.longitude,R=h.getLonDeltaForDistance(M,n,m)/2;d=T-R,y=T+R;const b=t.deg2rad(M),x=(1+Math.sin(b))/(1-Math.sin(b)),U=(x+1)*Math.tan(i/m/2),E=U*U;function I(e){const t=Math.PI/2;return(e=u.cyclical2PI.normalize(e,-t))>t&&(e=Math.PI-e),e}if(p=1.5*Math.PI-2*Math.atan(.5*(U+Math.sqrt(4*x+E))),g=p+i/m,p=I(p),g=I(g),g<p){const e=g;g=p,p=e}if(p=Math.max(t.rad2deg(p),-90),g=Math.min(t.rad2deg(g),90),y=f.monotonic(d,y),y-d>180){const e=(y-d-180)/2;d+=e,y-=e}const P=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:c.WGS84;return o?(o.xmin=d,o.ymin=p,o.xmax=y,o.ymax=g,o.spatialReference=P):o=new r(d,p,y,g,P),e.spatialReference&&e.spatialReference.isWebMercator&&l.geographicToWebMercator(o,!1,o),o}const v=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:T,directionToHeadingTilt:R,eyeForCenterWithHeadingTilt:b,lookAtTiltToEyeTilt:E,eyeTiltToLookAtTilt:I,toExtent:P},Symbol.toStringTag,{value:"Module"}));e.cameraUtilsSpherical=v,e.directionToHeadingTilt=R,e.eyeForCenterWithHeadingTilt=b,e.eyeTiltToLookAtTilt=I,e.headingTiltToDirectionUp=T,e.lookAtTiltToEyeTilt=E,e.toExtent=P}));
