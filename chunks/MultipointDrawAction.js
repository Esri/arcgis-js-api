/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","./_rollupPluginBabelHelpers","./tslib.es6","../core/has","../core/maybe","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/Handles","../views/input/InputManager","../views/support/screenUtils","../views/draw/DrawAction","../views/draw/input/DrawEvents","../views/draw/input/Keys"],(function(e,t,i,r,s,o,n,d,c,v,h,u,a,p,l,w,_,x){"use strict";e.MultipointDrawAction=function(e){function i(t){var i;return(i=e.call(this,t)||this)._cursorMoved=!1,i._cursorScreenPoint=null,i._dragEnabled=!0,i._pointerDownEvent=null,i._viewHandles=new a,i.vertices=[],i}t._inheritsLoose(i,e);var r=i.prototype;return r.initialize=function(){this._addViewHandles()},r.destroy=function(){this._removeViewHandles(),this._viewHandles.destroy(),this.emit("destroy")},r.addVertex=function(e,t){isNaN(t)?(t=this.vertices.length,this.vertices.push(e)):this.vertices.splice(t,0,e);const i={vertex:e,vertexIndex:t,undo:()=>this._undoVertexAdd(null,t),redo:()=>this._redoVertexAdd(null,e,t)};this.history.push(i),this._set("redoHistory",[]);const r=new _.VertexAddEvent(this.view,null,t,this.vertices);this.emit("vertex-add",r),r.defaultPrevented&&(this._cursorMoved=!0,this.history.pop())},r.removeVertex=function(e){const t=this.vertices.splice(e,1)[0],i={vertex:t,vertexIndex:e,undo:()=>this._undoVertexRemove(null,t,e),redo:()=>this._redoVertexRemove(null,e)};this.history.push(i),this._set("redoHistory",[]),this.emit("vertex-remove",new _.VertexRemoveEvent(this.view,null,e,this.vertices))},r.updateVertex=function(e,t){const i=this.vertices[t];this.vertices[t]=e;const r={vertex:e,vertexIndex:t,undo:()=>this._undoVertexUpdate(null,i,t),redo:()=>this._redoVertexUpdate(null,e,t)};this.history.push(r),this._set("redoHistory",[]),this.emit("vertex-update",new _.VertexUpdateEvent(this.view,null,t,this.vertices))},r.complete=function(){this._completeDrawing()},r._addViewHandles=function(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(e=>{e.stopPropagation()}),p.ViewEventPriorities.TOOL),this.view.on("pointer-down",(e=>{this._cursorMoved&&this.vertices.pop(),this._pointerDownEvent=e,this._cursorMoved=!1,this._cursorScreenPoint=l.createScreenPointFromEvent(e)}),p.ViewEventPriorities.TOOL),this.view.on("pointer-move",(e=>{this._cursorMoved&&this.vertices.pop(),this._cursorMoved=!0,this._cursorScreenPoint=l.createScreenPointFromEvent(e),this._cursorUpdateHandler(e)}),p.ViewEventPriorities.TOOL),this.view.on("pointer-up",(e=>{if(this._pointerDownEvent){if(this._cursorMoved)return this.vertices.pop(),void(this._cursorMoved=!1);this._pointerDownEvent=null,this._vertexAddHandler(e)}}),p.ViewEventPriorities.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&this._pointerDownEvent&&e.stopPropagation()}),p.ViewEventPriorities.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),p.ViewEventPriorities.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),p.ViewEventPriorities.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),p.ViewEventPriorities.TOOL),this.view.on("key-down",(e=>{e.key===x.KEYS.vertexAddKey&&!e.repeat&&this._cursorScreenPoint?(this._cursorMoved&&(this.vertices.pop(),this._cursorMoved=!1),this._vertexAddHandler(e)):e.key===x.KEYS.drawCompleteKey&&!e.repeat&&this._cursorScreenPoint?(this._cursorMoved&&(this.vertices.pop(),this._cursorMoved=!1),this._vertexAddHandler(e),this._drawCompleteHandler(e)):e.key!==x.KEYS.undoKey||this.interactiveUndoDisabled||e.repeat?e.key!==x.KEYS.redoKey||this.interactiveUndoDisabled||e.repeat||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo())}),p.ViewEventPriorities.TOOL)])},r._removeViewHandles=function(){this._viewHandles.removeAll()},r._addVertex=function(e,t){this.vertices.push(e);const i=this.vertices.indexOf(e),r={vertex:e,vertexIndex:i,undo:()=>this._undoVertexAdd(t,i),redo:()=>this._redoVertexAdd(t,e,i)};this.history.push(r),this._set("redoHistory",[]);const s=new _.VertexAddEvent(this.view,t,i,this.vertices);this.emit("vertex-add",s),s.defaultPrevented&&(this._cursorMoved=!0,this.history.pop())},r._updateCursor=function(e,t){this.vertices.push(e);const i=this.vertices.indexOf(e),r=new _.CursorUpdateEvent(this.view,t,i,this.vertices);this.emit("cursor-update",r)},r._completeDrawing=function(e){if(this._cursorMoved=!1,this._pointerDownEvent=null,this.vertices.length<1)return;const t=new _.DrawCompleteEvent(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented?this._cursorMoved=!0:this._removeViewHandles()},r._undoVertexAdd=function(e,t){this.vertices.splice(t,1),this.emit("undo",new _.VertexRemoveEvent(this.view,e,t,this.vertices))},r._redoVertexAdd=function(e,t,i){this.vertices.splice(i,0,t),this.emit("redo",new _.VertexAddEvent(this.view,e,i,this.vertices))},r._undoVertexRemove=function(e,t,i){this.vertices.splice(i,0,t),this.emit("undo",new _.VertexAddEvent(this.view,e,i,this.vertices))},r._redoVertexRemove=function(e,t){this.vertices.splice(t,1),this.emit("redo",new _.VertexRemoveEvent(this.view,e,t,this.vertices))},r._undoVertexUpdate=function(e,t,i){this.vertices[i]=t,this.emit("undo",new _.VertexUpdateEvent(this.view,e,i,this.vertices))},r._redoVertexUpdate=function(e,t,i){this.vertices[i]=t,this.emit("redo",new _.VertexUpdateEvent(this.view,e,i,this.vertices))},r._vertexAddHandler=function(e){const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);s.isSome(t)&&this._addVertex(t,e.native)},r._cursorUpdateHandler=function(e){const t=this.getCoordsFromScreenPoint(this._cursorScreenPoint);s.isSome(t)&&this._updateCursor(t,e.native)},r._drawCompleteHandler=function(e){this._completeDrawing(e.native)},i}(w),i.__decorate([d.property({readOnly:!0})],e.MultipointDrawAction.prototype,"vertices",void 0),e.MultipointDrawAction=i.__decorate([c.subclass("esri.views.draw.MultipointDrawAction")],e.MultipointDrawAction);var m=Object.freeze({__proto__:null,get MultipointDrawAction(){return e.MultipointDrawAction}});e.MultipointDrawAction$1=m}));
