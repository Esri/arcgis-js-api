/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../core/maybe","../core/promiseUtils","../geometry/Geometry","../geometry/Point","../geometry/Extent","../geometry/Multipoint","../geometry/support/coordsUtils","../geometry/Polygon","../geometry/Polyline","../arcade/ImmutableArray","../arcade/FunctionWrapper","../arcade/ImmutablePointArray","../arcade/ImmutablePathArray","../core/number"],(function(e,t,n,r,i,o,u,a,l,f,s,c,m,g,y){"use strict";let d=function(e){this.value=e},h=function(e){this.value=e},p=function(e){this.fn=e},x=function(e){this.fn=e};const S=p,T=h,N=d,R=x,b={type:"VOID"},C={type:"BREAK"},M={type:"CONTINUE"};function F(e,t,n){return""===t||null==t||t===n||t===n?e:e=e.split(t).join(n)}function _(e){return e instanceof p||e instanceof c||e instanceof x}function O(e){return!!A(e)||(!!D(e)||(!!z(e)||(!!I(e)||(null===e||(e===b||"number"==typeof e)))))}function v(e,t){return void 0===e?t:e}function A(e){return"string"==typeof e||e instanceof String}function I(e){return"boolean"==typeof e}function D(e){return"number"==typeof e}function w(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}function P(e){return e instanceof Array}function k(e){return!0===(e&&e.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===e.declaredRootClass)}function E(e){return!0===(e&&e.declaredRootClass&&"esri.arcade.featureSetCollection"===e.declaredRootClass)}function j(e){return e instanceof s}function z(e){return e instanceof Date}function Z(e,t,n){if(e.length<t||e.length>n)throw new Error("Function called with wrong number of Parameters")}function J(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}function G(e,t){return!1===isNaN(e)?null==t||""===t?e.toString():(t=F(t,"‰",""),t=F(t,"¤",""),y.format(e,{pattern:t})):e.toString()}function L(e,t){const n=he.Moment(e);return null==t||""===t?n.format():n.format(U(t))}function U(e){return e.replace(/(LTS)|L|l/g,(function(e){return"["+e+"]"}))}function V(e,t,n){switch(n){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function B(e,t,n){if(null===e){if(null===t||t===b)return V(null,null,n);if(D(t))return V(0,t,n);if(A(t))return V(0,X(t),n);if(I(t))return V(0,X(t),n);if(z(t))return V(0,t.getTime(),n)}if(e===b){if(null===t||t===b)return V(null,null,n);if(D(t))return V(0,t,n);if(A(t))return V(0,X(t),n);if(I(t))return V(0,X(t),n);if(z(t))return V(0,t.getTime(),n)}else if(D(e)){if(D(t))return V(e,t,n);if(I(t))return V(e,X(t),n);if(null===t||t===b)return V(e,0,n);if(A(t))return V(e,X(t),n);if(z(t))return V(e,t.getTime(),n)}else if(A(e)){if(A(t))return V(K(e),K(t),n);if(z(t))return V(X(e),t.getTime(),n);if(D(t))return V(X(e),t,n);if(null===t||t===b)return V(X(e),0,n);if(I(t))return V(X(e),X(t),n)}else if(z(e)){if(z(t))return V(e,t,n);if(null===t||t===b)return V(e.getTime(),0,n);if(D(t))return V(e.getTime(),t,n);if(I(t))return V(e.getTime(),X(t),n);if(A(t))return V(e.getTime(),X(t),n)}else if(I(e)){if(I(t))return V(e,t,n);if(D(t))return V(X(e),X(t),n);if(z(t))return V(X(e),t.getTime(),n);if(null===t||t===b)return V(X(e),0,n);if(A(t))return V(X(e),X(t),n)}return!!q(e,t)&&("<="===n||">="===n)}function q(e,t){if(e===t)return!0;if(null===e&&t===b||null===t&&e===b)return!0;if(z(e)&&z(t))return e.getTime()===t.getTime();if(e instanceof g)return e.equalityTest(t);if(e instanceof m)return e.equalityTest(t);if(e instanceof i&&t instanceof i){let n,r;if(n=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId,null!=n)return n===r}if(void 0!==e&&void 0!==t&&null!==e&&null!==t&&"object"==typeof e&&"object"==typeof t){if(e._arcadeCacheId===t._arcadeCacheId&&void 0!==e._arcadeCacheId&&null!==e._arcadeCacheId)return!0;if(e._underlyingGraphic===t._underlyingGraphic&&void 0!==e._underlyingGraphic&&null!==e._underlyingGraphic)return!0}return!1}function K(e,t){if(A(e))return e;if(null===e)return"";if(D(e))return G(e,t);if(I(e))return e.toString();if(z(e))return L(e,t);if(e instanceof r)return JSON.stringify(e.toJSON());if(P(e)){const t=[];for(let n=0;n<e.length;n++)t[n]=Q(e[n]);return"["+t.join(",")+"]"}if(e instanceof s){const t=[];for(let n=0;n<e.length();n++)t[n]=Q(e.get(n));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():_(e)?"object, Function":""}function W(e){const t=[];if(!1===P(e))return null;if(e instanceof s){for(let n=0;n<e.length();n++)t[n]=X(e.get(n));return t}for(let n=0;n<e.length;n++)t[n]=X(e[n]);return t}function H(e,t){if(A(e))return e;if(null===e)return"";if(D(e))return G(e,t);if(I(e))return e.toString();if(z(e))return L(e,t);if(e instanceof r)return e instanceof o?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+ae(e.spatialReference)+"}":ae(e.toJSON(),((e,t)=>e.key===t.key?0:"spatialReference"===e.key?1:"spatialReference"===t.key||e.key<t.key?-1:e.key>t.key?1:0));if(P(e)){const t=[];for(let n=0;n<e.length;n++)t[n]=Q(e[n]);return"["+t.join(",")+"]"}if(e instanceof s){const t=[];for(let n=0;n<e.length();n++)t[n]=Q(e.get(n));return"["+t.join(",")+"]"}return null!==e&&"object"==typeof e&&void 0!==e.castToText?e.castToText():_(e)?"object, Function":""}function Q(e){if(null===e)return"null";if(I(e)||D(e)||A(e))return JSON.stringify(e);if(e instanceof r)return H(e);if(e instanceof s)return H(e);if(e instanceof Array)return H(e);if(e instanceof Date)return JSON.stringify(L(e,""));if(null!==e&&"object"==typeof e){if(void 0!==e.castToText)return e.castToText()}else if(e===b)return"null";return"null"}function X(e,t){return D(e)?e:null===e||""===e?0:z(e)?NaN:I(e)?e?1:0:P(e)||""===e||void 0===e?NaN:void 0!==t&&A(e)?(t=F(t,"‰",""),t=F(t,"¤",""),y.parse(e,{pattern:t})):e===b?0:Number(e)}function Y(e,t){if(z(e))return e;if(A(e)){const n=he.Moment(e,[null==t||""===t?he.Moment.ISO_8601:t]);if(n.isValid())return n.toDate()}return null}function $(e,t){if(z(e))return he.Moment(e);if(A(e)){const n=he.Moment(e,[null==t||""===t?he.Moment.ISO_8601:t]);if(n.isValid())return n}return null}function ee(e){return I(e)?e:A(e)?"true"===(e=e.toLowerCase()):!!D(e)&&(0!==e&&!isNaN(e))}function te(e,n){return t.isNone(e)?null:(null!==e.spatialReference&&void 0!==e.spatialReference||(e.spatialReference=n),e)}function ne(e){if(null===e)return null;if(e instanceof i)return"NaN"===e.x||null===e.x||isNaN(e.x)?null:e;if(e instanceof l){if(0===e.rings.length)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof f){if(0===e.paths.length)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof u?0===e.points.length?null:e:e instanceof o?"NaN"===e.xmin||null===e.xmin||isNaN(e.xmin)?null:e:null}function re(e,t){if(!e)return t;if(!e.domain)return t;let n=null;if("string"===e.field.type||"esriFieldTypeString"===e.field.type)t=K(t);else{if(null==t)return null;if(""===t)return t;t=X(t)}for(let r=0;r<e.domain.codedValues.length;r++){const i=e.domain.codedValues[r];i.code===t&&(n=i)}return null===n?t:n.name}function ie(e,t){if(!e)return t;if(!e.domain)return t;let n=null;t=K(t);for(let r=0;r<e.domain.codedValues.length;r++){const i=e.domain.codedValues[r];i.name===t&&(n=i)}return null===n?t:n.code}function oe(e,t,n=null,r){if(!t)return null;if(!t.fields)return null;let i,o,u=null;for(let n=0;n<t.fields.length;n++){const r=t.fields[n];r.name.toLowerCase()===e.toString().toLowerCase()&&(u=r)}if(null===u)throw new Error("Field not found");return r||(r=n&&t.typeIdField&&n._field(t.typeIdField)),null!=r&&t.types.some((function(e){return e.id===r&&(i=e.domains&&e.domains[u.name],i&&"inherited"===i.type&&(i=ue(u.name,t),o=!0),!0)})),o||i||(i=ue(e,t)),{field:u,domain:i}}function ue(e,t){let n;return t.fields.some((function(t){return t.name===e&&(n=t.domain),!!n})),n}function ae(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});const n="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&(i=t.cmp,function(e){return function(t,n){const r={key:t,value:e[t]},o={key:n,value:e[n]};return i(r,o)}});var i;const o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===t)return;if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);let i,u;if(Array.isArray(t)){for(u="[",i=0;i<t.length;i++)i&&(u+=","),u+=e(t[i])||"null";return u+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const a=o.push(t)-1,l=Object.keys(t).sort(r&&r(t));for(u="",i=0;i<l.length;i++){const n=l[i],r=e(t[n]);r&&(u&&(u+=","),u+=JSON.stringify(n)+":"+r)}return o.splice(a,1),"{"+u+"}"}(e)}function le(e){if(null===e)return null;const t=[];for(const n of e)n&&(n.declaredClass&&"esri.arcade.Feature"===n.declaredClass||"FeatureSetReader"===n.type)?t.push(n.geometry()):t.push(n);return t}function fe(e,t){if(!(t instanceof i))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function se(e,t){if(P(e)||j(e)){let n=!1,r=!1,i=[],o=t;if(P(e)){for(const t of e)fe(i,t);i.length>0&&(o=e[0].spatialReference,n=e[0].hasZ,r=e[0].hasM)}else if(e instanceof m)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,o=e.get(0).spatialReference);else{if(!j(e))throw new Error("Invalid Argument");for(const t of e.toArray())fe(i,t);i.length>0&&(o=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}if(0===i.length)return null;return!1===a.isClockwise(i,r,n)&&(i=i.slice(0).reverse()),new l({rings:[i],spatialReference:o,hasZ:n,hasM:r})}return e}function ce(e,t){if(P(e)||j(e)){let n=!1,r=!1,i=[],o=t;if(P(e)){for(const t of e)fe(i,t);i.length>0&&(o=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof m)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,o=e.get(0).spatialReference);else if(j(e)){for(const t of e.toArray())fe(i,t);i.length>0&&(o=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:new f({paths:[i],spatialReference:o,hasZ:n,hasM:r})}return e}function me(e,t){if(P(e)||j(e)){let n=!1,r=!1,i=[],o=t;if(P(e)){for(const t of e)fe(i,t);i.length>0&&(o=e[0].spatialReference,n=!0===e[0].hasZ,r=!0===e[0].hasM)}else if(e instanceof m)i=e._elements,i.length>0&&(n=e._hasZ,r=e._hasM,o=e.get(0).spatialReference);else if(j(e)){for(const t of e.toArray())fe(i,t);i.length>0&&(o=e.get(0).spatialReference,n=!0===e.get(0).hasZ,r=!0===e.get(0).hasM)}return 0===i.length?null:new u({points:i,spatialReference:o,hasZ:n,hasM:r})}return e}function ge(e,t=!1){const n=[];if(null===e)return n;if(!0===P(e)){for(let r=0;r<e.length;r++){const i=K(e[r]);""===i&&!0!==t||n.push(i)}return n}if(e instanceof s){for(let r=0;r<e.length();r++){const i=K(e.get(r));""===i&&!0!==t||n.push(i)}return n}if(O(e)){const r=K(e);return""===r&&!0!==t||n.push(r),n}return[]}let ye=0;function de(e){return ye++,ye%100==0?(ye=0,n.create((t=>{setTimeout((()=>{t(e)}),0)}))):e}const he={Moment:null};function pe(e,t,n){switch(n){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}var xe=Object.freeze({__proto__:null,ReturnResultE:d,ImplicitResultE:h,NativeFunctionE:p,SizzleFunctionE:x,NativeFunction:S,ImplicitResult:T,ReturnResult:N,SizzleFunction:R,voidOperation:b,breakResult:C,continueResult:M,multiReplace:F,isFunctionParameter:_,isSimpleType:O,defaultUndefined:v,isString:A,isBoolean:I,isNumber:D,isInteger:w,isArray:P,isFeatureSet:k,isFeatureSetCollection:E,isImmutableArray:j,isDate:z,pcCheck:Z,generateUUID:J,formatNumber:G,formatDate:L,standardiseDateFormat:U,greaterThanLessThan:B,equalityTest:q,toString:K,toNumberArray:W,toStringExplicit:H,toNumber:X,toDate:Y,toDateM:$,toBoolean:ee,fixSpatialReference:te,fixNullGeometry:ne,getDomainValue:re,getDomainCode:ie,getDomain:oe,stableStringify:ae,autoCastFeatureToGeometry:le,autoCastArrayOfPointsToPolygon:se,autoCastArrayOfPointsToPolyline:ce,autoCastArrayOfPointsToMultiPoint:me,toStringArray:ge,tick:de,MomentLibrary:he,binaryOperator:pe});e.ImplicitResult=T,e.ImplicitResultE=h,e.MomentLibrary=he,e.NativeFunction=S,e.NativeFunctionE=p,e.ReturnResult=N,e.ReturnResultE=d,e.SizzleFunction=R,e.SizzleFunctionE=x,e.autoCastArrayOfPointsToMultiPoint=me,e.autoCastArrayOfPointsToPolygon=se,e.autoCastArrayOfPointsToPolyline=ce,e.autoCastFeatureToGeometry=le,e.binaryOperator=pe,e.breakResult=C,e.continueResult=M,e.defaultUndefined=v,e.equalityTest=q,e.fixNullGeometry=ne,e.fixSpatialReference=te,e.formatDate=L,e.formatNumber=G,e.generateUUID=J,e.getDomain=oe,e.getDomainCode=ie,e.getDomainValue=re,e.greaterThanLessThan=B,e.isArray=P,e.isBoolean=I,e.isDate=z,e.isFeatureSet=k,e.isFeatureSetCollection=E,e.isFunctionParameter=_,e.isImmutableArray=j,e.isInteger=w,e.isNumber=D,e.isSimpleType=O,e.isString=A,e.lc=xe,e.multiReplace=F,e.pcCheck=Z,e.stableStringify=ae,e.standardiseDateFormat=U,e.tick=de,e.toBoolean=ee,e.toDate=Y,e.toDateM=$,e.toNumber=X,e.toNumberArray=W,e.toString=K,e.toStringArray=ge,e.toStringExplicit=H,e.voidOperation=b}));
