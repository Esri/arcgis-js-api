/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports"],(function(e){"use strict";var r={},t={},n={};Object.defineProperty(n,"__esModule",{value:!0}),n.loop=n.conditional=n.parse=void 0;var a=function e(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(Array.isArray(t))t.forEach((function(t){return e(r,t,n,a)}));else if("function"==typeof t)t(r,n,a,e);else{var i=Object.keys(t)[0];Array.isArray(t[i])?(a[i]={},e(r,t[i],n,a[i])):a[i]=t[i](r,n,a,e)}return n};n.parse=a;var i=function(e,r){return function(t,n,a,i){r(t,n,a)&&i(t,e,n,a)}};n.conditional=i;var o=function(e,r){return function(t,n,a,i){for(var o=[],d=t.pos;r(t,n,a);){var s={};if(i(t,e,n,s),t.pos===d)break;d=t.pos,o.push(s)}return o}};n.loop=o;var d={};Object.defineProperty(d,"__esModule",{value:!0}),d.readBits=d.readArray=d.readUnsigned=d.readString=d.peekBytes=d.readBytes=d.peekByte=d.readByte=d.buildStream=void 0;var s=function(e){return{data:e,pos:0}};d.buildStream=s;var c=function(){return function(e){return e.data[e.pos++]}};d.readByte=c;var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(r){return r.data[r.pos+e]}};d.peekByte=u;var l=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};d.readBytes=l;var f=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};d.peekBytes=f;var p=function(e){return function(r){return Array.from(l(e)(r)).map((function(e){return String.fromCharCode(e)})).join("")}};d.readString=p;var v=function(e){return function(r){var t=l(2)(r);return e?(t[1]<<8)+t[0]:(t[0]<<8)+t[1]}};d.readUnsigned=v;var y=function(e,r){return function(t,n,a){for(var i="function"==typeof r?r(t,n,a):r,o=l(e),d=new Array(i),s=0;s<i;s++)d[s]=o(t);return d}};d.readArray=y;var g=function(e,r,t){for(var n=0,a=0;a<t;a++)n+=e[r+a]&&Math.pow(2,t-a-1);return n},h=function(e){return function(r){for(var t=c()(r),n=new Array(8),a=0;a<8;a++)n[7-a]=!!(t&1<<a);return Object.keys(e).reduce((function(r,t){var a=e[t];return a.length?r[t]=g(n,a.index,a.length):r[t]=n[a.index],r}),{})}};d.readBits=h,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n,t=d,a={blocks:function(e){for(var r=0,n=[],a=e.data.length,i=0,o=(0,t.readByte)()(e);o!==r&&o;o=(0,t.readByte)()(e)){if(e.pos+o>=a){var d=a-e.pos;n.push((0,t.readBytes)(d)(e)),i+=d;break}n.push((0,t.readBytes)(o)(e)),i+=o}for(var s=new Uint8Array(i),c=0,u=0;u<n.length;u++)s.set(n[u],c),c+=n[u].length;return s}},i=(0,r.conditional)({gce:[{codes:(0,t.readBytes)(2)},{byteSize:(0,t.readByte)()},{extras:(0,t.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,t.readUnsigned)(!0)},{transparentColorIndex:(0,t.readByte)()},{terminator:(0,t.readByte)()}]},(function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&249===r[1]})),o=(0,r.conditional)({image:[{code:(0,t.readByte)()},{descriptor:[{left:(0,t.readUnsigned)(!0)},{top:(0,t.readUnsigned)(!0)},{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{lct:(0,t.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,t.readArray)(3,(function(e,r,t){return Math.pow(2,t.descriptor.lct.size+1)}))},(function(e,r,t){return t.descriptor.lct.exists})),{data:[{minCodeSize:(0,t.readByte)()},a]}]},(function(e){return 44===(0,t.peekByte)()(e)})),s=(0,r.conditional)({text:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{preData:function(e,r,n){return(0,t.readBytes)(n.text.blockSize)(e)}},a]},(function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&1===r[1]})),c=(0,r.conditional)({application:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{id:function(e,r,n){return(0,t.readString)(n.blockSize)(e)}},a]},(function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&255===r[1]})),u=(0,r.conditional)({comment:[{codes:(0,t.readBytes)(2)},a]},(function(e){var r=(0,t.peekBytes)(2)(e);return 33===r[0]&&254===r[1]})),l=[{header:[{signature:(0,t.readString)(3)},{version:(0,t.readString)(3)}]},{lsd:[{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{gct:(0,t.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,t.readByte)()},{pixelAspectRatio:(0,t.readByte)()}]},(0,r.conditional)({gct:(0,t.readArray)(3,(function(e,r){return Math.pow(2,r.lsd.gct.size+1)}))},(function(e,r){return r.lsd.gct.exists})),{frames:(0,r.loop)([i,c,u,o,s],(function(e){var r=(0,t.peekByte)()(e);return 33===r||44===r}))}];e.default=l}(t);var m={};Object.defineProperty(m,"__esModule",{value:!0}),m.deinterlace=void 0;var B=function(e,r){for(var t=new Array(e.length),n=e.length/r,a=function(n,a){var i=e.slice(a*r,(a+1)*r);t.splice.apply(t,[n*r,r].concat(i))},i=[0,4,2,1],o=[8,8,4,2],d=0,s=0;s<4;s++)for(var c=i[s];c<n;c+=o[s])a(c,d),d++;return t};m.deinterlace=B;var x={};Object.defineProperty(x,"__esModule",{value:!0}),x.lzw=void 0;var b=function(e,r,t){var n,a,i,o,d,s,c,u,l,f,p,v,y,g,h,m,B=4096,x=-1,b=t,w=new Array(t),k=new Array(B),A=new Array(B),_=new Array(B+1);for(d=(a=1<<(f=e))+1,n=a+2,c=x,i=(1<<(o=f+1))-1,u=0;u<a;u++)k[u]=0,A[u]=u;for(p=v=y=g=h=m=0,l=0;l<b;){if(0===g){if(v<o){p+=r[m]<<v,v+=8,m++;continue}if(u=p&i,p>>=o,v-=o,u>n||u==d)break;if(u==a){i=(1<<(o=f+1))-1,n=a+2,c=x;continue}if(c==x){_[g++]=A[u],c=u,y=u;continue}for(s=u,u==n&&(_[g++]=y,u=c);u>a;)_[g++]=A[u],u=k[u];y=255&A[u],_[g++]=y,n<B&&(k[n]=c,A[n]=y,0==(++n&i)&&n<B&&(o++,i+=n)),c=s}g--,w[h++]=_[g],l++}for(l=h;l<b;l++)w[l]=0;return w};x.lzw=b,Object.defineProperty(r,"__esModule",{value:!0}),e.decompressFrames_1=r.decompressFrames=r.decompressFrame=e.parseGIF_1=r.parseGIF=void 0;var w=z(t),k=n,A=d,_=m,S=x;function z(e){return e&&e.__esModule?e:{default:e}}var U=function(e){var r=new Uint8Array(e);return(0,k.parse)((0,A.buildStream)(r),w.default)};e.parseGIF_1=r.parseGIF=U;var C=function(e){for(var r=e.pixels.length,t=new Uint8ClampedArray(4*r),n=0;n<r;n++){var a=4*n,i=e.pixels[n],o=e.colorTable[i]||[0,0,0];t[a]=o[0],t[a+1]=o[1],t[a+2]=o[2],t[a+3]=i!==e.transparentIndex?255:0}return t},F=function(e,r,t){if(e.image){var n=e.image,a=n.descriptor.width*n.descriptor.height,i=(0,S.lzw)(n.data.minCodeSize,n.data.blocks,a);n.descriptor.lct.interlaced&&(i=(0,_.deinterlace)(i,n.descriptor.width));var o={pixels:i,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?o.colorTable=n.lct:o.colorTable=r,e.gce&&(o.delay=10*(e.gce.delay||10),o.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(o.transparentIndex=e.gce.transparentColorIndex)),t&&(o.patch=C(o)),o}console.warn("gif frame does not have associated image.")};r.decompressFrame=F;var I=function(e,r){return e.frames.filter((function(e){return e.image})).map((function(t){return F(t,e.gct,r)}))};e.decompressFrames_1=r.decompressFrames=I}));
