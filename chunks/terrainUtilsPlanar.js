/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../core/Error","./vec3f64","./vec3","../geometry/support/aaBoundingRect","../views/3d/terrain/TilingScheme","../views/3d/terrain/TerrainConst"],(function(e,t,n,o,i,r,c){"use strict";const a=n.create(),s=n.create(),l=n.create(),u=n.create();function h(e,t,n=0){const o=e.extent;if(0===n)return i.containsPoint(o,t);const r=Math.min(o[2]-o[0],o[3]-o[1]);return i.containsPointWithMargin(o,t,n*r)}function f(e,t,n,i){o.copy(a,n),a[i]=t[i];const r=o.subtract(a,a,t),c=o.subtract(s,e,t),l=o.dot(c,r),u=o.dot(r,r);let h;h=l<=0?t:u<=l?n:o.add(a,t,o.scale(r,r,l/u));const f=o.subtract(a,e,h);return Math.PI/2-Math.atan(f[2]/Math.sqrt(f[0]*f[0]+f[1]*f[1]))}function d(e,t){const n=e.elevationBounds,o=e.extent,i=.5*(n.min+n.max);l[0]=o[0],l[1]=o[1],l[2]=i,u[0]=o[2],u[1]=o[3],u[2]=i;let r=1/0,c=1/0;return t[0]<l[0]?r=f(t,l,u,0):t[0]>u[0]&&(r=f(t,u,l,0)),t[1]<l[1]?c=f(t,l,u,1):t[1]>u[1]&&(c=f(t,u,l,1)),Math.min(r,c)}function g(e,n,o){if(e.spatialReference.isGeographic)return new t("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");const a=r.checkUnsupported(e);if(a)return a;const s=function(e,n){const o=e.lods,a=o[0].resolution*Math.pow(2,o[0].level),s=[a*e.size[0],a*e.size[1]],l=[e.origin.x,e.origin.y],u=i.fromExtent(n),h=i.create();r.computeRowColExtent(u,s,l,h);const f=(h[2]-h[0])*(h[3]-h[1]);if(f>c.MAX_ROOT_TILES){const n=o[0].scale*Math.pow(2,o[0].level);let i=Math.max((u[3]-u[1])/e.size[1],(u[2]-u[0])/e.size[0])*n/a;const r=Math.floor(Math.log(i)/Math.log(10));return i=Math.ceil(i/Math.pow(10,r))*Math.pow(10,r),new t("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(n).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+i.toLocaleString()+".",{level0Scale:n,suggestedLevel0Scale:i,requiredNumRootTiles:f,allowedNumRootTiles:c.MAX_ROOT_TILES})}return null}(e,o);return s||(n&&!e.spatialReference.equals(n)?new t("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null)}var p=Object.freeze({__proto__:null,isInsideExtent:h,tiltOnEdge:f,tiltToExtentEdge:d,checkIfTileInfoSupportedForViewSR:g});e.checkIfTileInfoSupportedForViewSR=g,e.isInsideExtent=h,e.terrainUtilsPlanar=p,e.tiltOnEdge=f,e.tiltToExtentEdge=d}));
