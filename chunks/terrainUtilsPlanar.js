/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../core/Error","./vec3","./vec3f64","../geometry/support/aaBoundingRect","../views/3d/terrain/TerrainConst","../views/3d/terrain/TilingScheme"],(function(e,t,n,o,r,i,c){"use strict";const s=o.create(),a=o.create(),l=o.create(),u=o.create();function h(e,t,n=0){const o=e.extent;if(0===n)return r.containsPoint(o,t);const i=Math.min(o[2]-o[0],o[3]-o[1]);return r.containsPointWithMargin(o,t,n*i)}function f(e,t,o,r){n.copy(s,o),s[r]=t[r];const i=n.subtract(s,s,t),c=n.subtract(a,e,t),l=n.dot(c,i),u=n.dot(i,i);let h;h=l<=0?t:u<=l?o:n.add(s,t,n.scale(i,i,l/u));const f=n.subtract(s,e,h);return Math.PI/2-Math.atan(f[2]/Math.sqrt(f[0]*f[0]+f[1]*f[1]))}function g(e,t,n){const o=e.extent;l[0]=o[0],l[1]=o[1],l[2]=n,u[0]=o[2],u[1]=o[3],u[2]=n;let r=1/0,i=1/0;return t[0]<l[0]?r=f(t,l,u,0):t[0]>u[0]&&(r=f(t,u,l,0)),t[1]<l[1]?i=f(t,l,u,1):t[1]>u[1]&&(i=f(t,u,l,1)),Math.min(r,i)}function d(e,n,o){if(e.spatialReference.isGeographic)return new t("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");const r=c.checkUnsupported(e);if(r)return r;const i=p(e,o);return i||(n&&!e.spatialReference.equals(n)?new t("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null)}function p(e,n){const o=e.lods,s=o[0].resolution*2**o[0].level,a=[s*e.size[0],s*e.size[1]],l=[e.origin.x,e.origin.y],u=r.fromExtent(n),h=r.create();c.computeRowColExtent(u,a,l,h);const f=(h[2]-h[0])*(h[3]-h[1]);if(f>i.MAX_ROOT_TILES){const n=o[0].scale*2**o[0].level;let r=Math.max((u[3]-u[1])/e.size[1],(u[2]-u[0])/e.size[0])*n/s;const c=Math.floor(Math.log(r)/Math.log(10));return r=Math.ceil(r/10**c)*10**c,new t("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(n).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+r.toLocaleString()+".",{level0Scale:n,suggestedLevel0Scale:r,requiredNumRootTiles:f,allowedNumRootTiles:i.MAX_ROOT_TILES})}return null}var m=Object.freeze({__proto__:null,isInsideExtent:h,tiltToExtentEdge:g,checkIfTileInfoSupportedForViewSR:d});e.checkIfTileInfoSupportedForViewSR=d,e.isInsideExtent=h,e.terrainUtilsPlanar=m,e.tiltToExtentEdge=g}));
