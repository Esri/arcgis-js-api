/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","exports","./_rollupPluginBabelHelpers","../arcade/arcadeCompiler","../arcade/ArcadeModuleResolver","../arcade/arcadeRuntime","../arcade/executionError","../arcade/parser","../arcade/treeAnalysis","../core/has","../core/maybe"],(function(e,r,n,t,i,c,u,s,o,l,a){"use strict";const p=["feature","angle","bearing","centroid","envelopeintersects","extent","geometry","isselfintersecting","ringisclockwise"];function d(){return!0}const f=d();let y=!1,S=!1,m=null,x=[];function b(e,r){if(!0===r.useAsync||!0===e.isAsync)return h(e,r);if(l("esri-csp-restrictions")){return function(r){return c.executeScript(e,r)}}try{return t.compileScript(e,r)}catch(n){if("esri.arcade.arcadeuncompilableerror"===n.declaredRootClass)return function(r){return c.executeScript(e,r)};throw n}}function h(e,r){if(null===m)throw new u.ArcadeExecutionError(null,u.ExecutionErrorCodes.AsyncNotEnabled,null);if(l("esri-csp-restrictions")||!1===f){return function(r){return m.executeScript(e,r)}}try{return t.compileScript(e,r,!0)}catch(n){if("esri.arcade.arcadeuncompilableerror"===n.declaredRootClass)return function(r){return m.executeScript(e,r)};throw n}}function E(e){c.extend(e),t.extend(e,"sync"),null===m?x.push(e):(t.extend(e,"async"),m.extend(e))}function A(e,r=[]){return s.parseScript(e,r)}function g(e,r,n=[]){return F(s.parseScript(e,n),r)}function F(e,r){if(!0===r.useAsync||!0===e.isAsync){if(null===m)throw new u.ArcadeExecutionError(null,u.ExecutionErrorCodes.AsyncNotEnabled,null);return m.executeScript(e,r)}return c.executeScript(e,r)}function G(e,r){return o.referencesMember(e,r)}function w(e,r){return o.referencesFunction(e,r)}function M(e,r=!1){return void 0===r&&(r=!1),o.findFieldLiterals(e)}function P(e){return o.findExpectedFieldLiterals(e)}function _(e,r=[]){return void 0===e.usesGeometry&&o.findScriptDependencies(e,r),!0===e.usesGeometry}let I=null;function D(){return I||(I=U(),I)}function U(){return v.apply(this,arguments)}function v(){return(v=n._asyncToGenerator((function*(){const[r,n]=yield Promise.all([new Promise(((r,n)=>e(["../geometry/geometryEngine"],r,n))),new Promise(((r,n)=>e(["../arcade/functions/geomsync"],r,n)))]);return S=!0,n.setGeometryEngine(r),!0}))).apply(this,arguments)}let T=null;function C(){return null!==T||(T=L()),T}function L(){return R.apply(this,arguments)}function R(){return(R=n._asyncToGenerator((function*(){yield t.enableAsyncSupport(),m=yield new Promise(((r,n)=>e(["../arcade/arcadeAsyncRuntime"],r,n)));for(const e of x)m.extend(e),t.extend(e,"async");return x=null,!0}))).apply(this,arguments)}function j(){return y}function k(){return!!m}function z(){return S}let N=null;function O(){return N||(N=q(),N)}function q(){return B.apply(this,arguments)}function B(){return(B=n._asyncToGenerator((function*(){yield C();const[r,n,i,c,u]=yield Promise.all([new Promise(((r,n)=>e(["../arcade/featureSetUtils"],r,n))),new Promise(((r,n)=>e(["../arcade/functions/featuresetbase"],r,n))),new Promise(((r,n)=>e(["../arcade/functions/featuresetgeom"],r,n))),new Promise(((r,n)=>e(["../arcade/functions/featuresetstats"],r,n))),new Promise(((r,n)=>e(["../arcade/functions/featuresetstring"],r,n)))]);return re=r,m.extend([n,i,c,u]),t.extend([n,i,c,u],"async"),y=!0,!0}))).apply(this,arguments)}function H(e,r=[]){return void 0===e.usesFeatureSet&&o.findScriptDependencies(e,r),!0===e.usesFeatureSet}function J(e,r=[]){return void 0===e.isAsync&&o.findScriptDependencies(e,r),!0===e.isAsync}function K(e,r){if(r){for(const n of r)if(G(e,n))return!0;return!1}return!1}function Q(e,r){return V.apply(this,arguments)}function V(){return(V=n._asyncToGenerator((function*(e,r,n=[],t=!1,i=null){return W(new Set,e,r,n,t,i)}))).apply(this,arguments)}function W(e,r,n){return X.apply(this,arguments)}function X(){return(X=n._asyncToGenerator((function*(e,r,n,t=[],i=!1,c=null){const u="string"==typeof r?A(r):r,s=[];return u&&(!1===z()&&(_(u)||i)&&s.push(D()),!1===k()&&(!0===u.isAsync||n)&&s.push(C()),!1===j()&&(H(u)||K(u,t))&&s.push(O())),s.length&&(yield Promise.all(s)),yield Z(e,u,c,n,i),!0}))).apply(this,arguments)}function Y(e,r=[]){return void 0===e.usesModules&&o.findScriptDependencies(e,r),!0===e.usesModules}function Z(e,r){return $.apply(this,arguments)}function $(){return($=n._asyncToGenerator((function*(e,r,n=null,t=!1,c=!1){const s=o.findModuleImports(r);null===n&&s.length>0&&(n=i.ArcadeModuleResolver.getDefault()),r.loadedModules={};for(const i of s){a.assertIsSome(n);const s=n.normalizeModuleUri(i.source);if(e.has(s.uri))throw new u.ArcadeExecutionError(null,u.ExecutionErrorCodes.CircularModules,null);e.add(s.uri);const o=yield n.fetchModule(s);yield W(e,o,t,[],c,n),e.delete(s.uri),o.isAsync&&(r.isAsync=!0),o.usesFeatureSet&&(r.usesFeatureSet=!0),o.usesGeometry&&(r.usesGeometry=!0),r.loadedModules[i.libname]={uri:s.uri,script:o}}}))).apply(this,arguments)}function ee(e){if(_(e))return!0;const r=o.findFunctionCalls(e);let n=!1;for(let t=0;t<r.length;t++)if(p.includes(r[t])){n=!0;break}return n}let re=null;function ne(){return re}const te=Object.freeze(Object.defineProperty({__proto__:null,compileScript:b,extend:E,parseScript:A,parseAndExecuteScript:g,executeScript:F,referencesMember:G,referencesFunction:w,extractFieldLiterals:M,extractExpectedFieldLiterals:P,scriptUsesGeometryEngine:_,enableGeometrySupport:D,enableGeometrySupportImpl:U,enableAsyncSupport:C,enableAsyncSupportImpl:L,isFeatureSetSupportEnabled:j,isAsyncEnabled:k,isGeometryEnabled:z,enableFeatureSetSupport:O,enableFeatureSetSupportImpl:q,scriptUsesFeatureSet:H,scriptIsAsync:J,loadScriptDependencies:Q,_loadScriptDependenciesImpl:W,scriptUsesModules:Y,loadDependentModules:Z,scriptTouchesGeometry:ee,featureSetUtils:ne},Symbol.toStringTag,{value:"Module"}));r._loadScriptDependenciesImpl=W,r.arcade=te,r.compileScript=b,r.enableAsyncSupport=C,r.enableAsyncSupportImpl=L,r.enableFeatureSetSupport=O,r.enableFeatureSetSupportImpl=q,r.enableGeometrySupport=D,r.enableGeometrySupportImpl=U,r.executeScript=F,r.extend=E,r.extractExpectedFieldLiterals=P,r.extractFieldLiterals=M,r.featureSetUtils=ne,r.isAsyncEnabled=k,r.isFeatureSetSupportEnabled=j,r.isGeometryEnabled=z,r.loadDependentModules=Z,r.loadScriptDependencies=Q,r.parseAndExecuteScript=g,r.parseScript=A,r.referencesFunction=w,r.referencesMember=G,r.scriptIsAsync=J,r.scriptTouchesGeometry=ee,r.scriptUsesFeatureSet=H,r.scriptUsesGeometryEngine=_,r.scriptUsesModules=Y}));
