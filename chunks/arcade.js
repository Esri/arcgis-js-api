/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["require","exports","../arcade/arcadeCompiler","../arcade/arcadeRuntime","../arcade/parser","../arcade/treeAnalysis","../core/has","../core/promiseUtils"],(function(e,t,r,n,c,i,s,u){"use strict";const o=["feature","angle","bearing","centroid","envelopeintersects","extent","geometry","isselfintersecting","ringisclockwise"];function a(){return!0}const l=a();let p=!1,f=!1,d=null,S=[];function y(e,t){if(!0===t.useAsync||!0===e.isAsync)return m(e,t);if(s("esri-csp-restrictions")){return function(t){return n.executeScript(e,t)}}return r.compileScript(e,t)}function m(e,t){if(null===d)throw new Error("Async Arcade must be enabled for this script");if(s("esri-csp-restrictions")||!1===l){return function(t){return d.executeScript(e,t)}}return r.compileScript(e,t,!0)}function x(e){n.extend(e),r.extend(e,"sync"),null===d?S.push(e):(r.extend(e,"async"),d.extend(e))}function b(e,t=[]){return c.parseScript(e,t)}function h(e,t,r=""){return c.validateScript(e,t,r)}function A(e,t,r,n=""){return c.scriptCheck(e,t,r,n)}function g(e,t,r=[]){return F(c.parseScript(e,r),t)}function F(e,t){if(!0===t.useAsync||!0===e.isAsync){if(null===d)throw new Error("Async Arcade must be enabled for this script");return d.executeScript(e,t)}return n.executeScript(e,t)}function E(e,t){return n.referencesMember(e,t)}function w(e,t){return n.referencesFunction(e,t)}function G(e,t=!1){return c.extractFieldLiterals(e)}function P(e){return c.extractExpectedFieldLiterals(e)}function v(e,t=[]){return void 0===e.usesGeometry&&i.findScriptDependencies(e,t),!0===e.usesGeometry}let U=null;function L(){return U||(U=u.all([new Promise(((t,r)=>e(["../geometry/geometryEngine"],t,r))),new Promise(((t,r)=>e(["../arcade/functions/geomsync"],t,r)))]).then((([e,t])=>(f=!0,t.setGeometryEngine(e),!0))),U)}let k=null;function C(){return null!==k||(k=r.enableAsyncSupport().then((()=>new Promise(((t,r)=>e(["../arcade/arcadeAsyncRuntime"],t,r))))).then((e=>{d=e;for(const t of S)d.extend(t),r.extend(t,"async");return S=null,!0}))),k}function D(){return p}function M(){return!!d}function _(){return f}let O=null;function T(){return O||(O=C().then((()=>u.all([new Promise(((t,r)=>e(["../arcade/featureSetUtils"],t,r))),new Promise(((t,r)=>e(["../arcade/functions/featuresetbase"],t,r))),new Promise(((t,r)=>e(["../arcade/functions/featuresetgeom"],t,r))),new Promise(((t,r)=>e(["../arcade/functions/featuresetstats"],t,r))),new Promise(((t,r)=>e(["../arcade/functions/featuresetstring"],t,r)))]).then((([e,t,n,c,i])=>(B=e,d.extend([t,n,c,i]),r.extend([t,n,c,i],"async"),p=!0,!0))))),O)}function j(e,t=[]){return void 0===e.usesFeatureSet&&i.findScriptDependencies(e,t),!0===e.usesFeatureSet}function I(e,t=[]){return void 0===e.isAsync&&i.findScriptDependencies(e,t),!0===e.isAsync}function R(e,t){if(t){for(const r of t)if(E(e,r))return!0;return!1}return!1}function q(e,t,r=[],n=!1){return u.create(((c,i)=>{const s="string"==typeof e?b(e):e,o=[];s&&(!1===_()&&(v(s)||n)&&o.push(L()),!1===M()&&(!0===s.isAsync||t)&&o.push(C()),!1===D()&&(j(s)||R(s,r))&&o.push(T())),o.length?u.all(o).then((()=>{c(!0)}),i):c(!0)}))}function z(e){if(v(e))return!0;const t=i.findFunctionCalls(e);let r=!1;for(let n=0;n<t.length;n++)if(o.indexOf(t[n])>-1){r=!0;break}return r}let B=null;function H(){return B}const J=Object.freeze(Object.defineProperty({__proto__:null,compileScript:y,extend:x,parseScript:b,validateScript:h,scriptCheck:A,parseAndExecuteScript:g,executeScript:F,referencesMember:E,referencesFunction:w,extractFieldLiterals:G,extractExpectedFieldLiterals:P,scriptUsesGeometryEngine:v,enableGeometrySupport:L,enableAsyncSupport:C,isFeatureSetSupportEnabled:D,isAsyncEnabled:M,isGeometryEnabled:_,enableFeatureSetSupport:T,scriptUsesFeatureSet:j,scriptIsAsync:I,loadScriptDependencies:q,scriptTouchesGeometry:z,featureSetUtils:H},Symbol.toStringTag,{value:"Module"}));t.arcade=J,t.compileScript=y,t.enableAsyncSupport=C,t.enableFeatureSetSupport=T,t.enableGeometrySupport=L,t.executeScript=F,t.extend=x,t.extractExpectedFieldLiterals=P,t.extractFieldLiterals=G,t.featureSetUtils=H,t.isAsyncEnabled=M,t.isFeatureSetSupportEnabled=D,t.isGeometryEnabled=_,t.loadScriptDependencies=q,t.parseAndExecuteScript=g,t.parseScript=b,t.referencesFunction=w,t.referencesMember=E,t.scriptCheck=A,t.scriptIsAsync=I,t.scriptTouchesGeometry=z,t.scriptUsesFeatureSet=j,t.scriptUsesGeometryEngine=v,t.validateScript=h}));
