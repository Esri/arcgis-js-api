/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","./vec3f64","./vec3","../core/ObjectStack","./vec2","../views/3d/support/stack","./lineSegment"],(function(t,e,c,n,r,s,a){"use strict";function o(t){return t?{p0:e.clone(t.p0),p1:e.clone(t.p1),p2:e.clone(t.p2)}:{p0:e.create(),p1:e.create(),p2:e.create()}}function u(t,e,c){const n=m.get();return n.p0=t,n.p1=e,n.p2=c,n}function p(t,e=o()){return i(t.p0,t.p1,t.p2,e)}function i(t,e,n,r=o()){return c.copy(r.p0,t),c.copy(r.p1,e),c.copy(r.p2,n),r}function d(t,e){const n=t.p0,r=t.p1,o=t.p2,u=c.subtract(s.sv3d.get(),r,n),p=c.subtract(s.sv3d.get(),o,r),i=c.subtract(s.sv3d.get(),n,o),d=c.subtract(s.sv3d.get(),e,n),f=c.subtract(s.sv3d.get(),e,r),l=c.subtract(s.sv3d.get(),e,o),g=c.cross(u,u,i),v=c.dot(c.cross(s.sv3d.get(),u,g),d),m=c.dot(c.cross(s.sv3d.get(),p,g),f),y=c.dot(c.cross(s.sv3d.get(),i,g),l);if(v>0&&m>0&&y>0){const t=c.dot(g,d);return t*t/c.dot(g,g)}const w=a.distance2(a.fromValues(n,u,b.get()),e),V=a.distance2(a.fromValues(r,p,b.get()),e),j=a.distance2(a.fromValues(o,i,b.get()),e);return Math.min(w,V,j)}function f(t,e,n){const r=1e-5,{direction:s,origin:a}=e,{p0:o,p1:u,p2:p}=t,i=u[0]-o[0],d=u[1]-o[1],f=u[2]-o[2],l=p[0]-o[0],g=p[1]-o[1],v=p[2]-o[2],b=s[1]*v-g*s[2],m=s[2]*l-v*s[0],y=s[0]*g-l*s[1],w=i*b+d*m+f*y;if(w>-r&&w<r)return!1;const V=1/w,j=a[0]-o[0],k=a[1]-o[1],O=a[2]-o[2],P=V*(j*b+k*m+O*y);if(P<0||P>1)return!1;const S=k*f-d*O,_=O*i-f*j,h=j*d-i*k,M=V*(s[0]*S+s[1]*_+s[2]*h);if(M<0||P+M>1)return!1;if(n){const t=V*(l*S+g*_+v*h);c.scale(n,s,t),c.add(n,a,n)}return!0}function l(t,e,c){const n=r.distance(t,e),s=r.distance(e,c),a=r.distance(c,t),o=(n+s+a)/2,u=o*(o-n)*(o-s)*(o-a);return u<=0?0:Math.sqrt(u)}function g(t){return l(t.p0,t.p1,t.p2)}function v(t,e,n){return c.subtract(y,e,t),c.subtract(w,n,t),c.length(c.cross(y,y,w))/2}const b=new n.ObjectStack(a.create),m=new n.ObjectStack((()=>({p0:null,p1:null,p2:null}))),y=e.create(),w=e.create();var V=Object.freeze({__proto__:null,create:o,wrap:u,copy:p,fromValues:i,distance2:d,intersectRay:f,areaPoints2d:l,area2d:g,areaPoints3d:v});t.area2d=g,t.areaPoints2d=l,t.areaPoints3d=v,t.copy=p,t.create=o,t.distance2=d,t.fromValues=i,t.intersectRay=f,t.triangleModule=V,t.wrap=u}));
