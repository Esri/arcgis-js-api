/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../core/has","../core/maybe","../core/Logger","../core/mathUtils","./vec3f64","./vec3","../views/3d/support/mathUtils","./mat4","./vec4f64","./vec4","../views/3d/support/stack","./vector","./ray"],(function(t,e,n,r,o,s,c,i,a,u,l,d,f,g){"use strict";const h=r.getLogger("esri.views.3d.support.geometryUtils.sphere");function p(){return u.create()}function v(t,e=p()){return l.copy(e,t)}function y(t,e){return u.fromValues(t[0],t[1],t[2],e)}function m(t){return t}function A(t){t[0]=t[1]=t[2]=t[3]=0}function S(t){return t}function M(t){return Array.isArray(t)?t[3]:t}function R(t){return Array.isArray(t)?t:B}function b(t,e,n,r){return u.fromValues(t,e,n,r)}function C(t,e,n){return t!==n&&c.copy(n,t),n[3]=t[3]+e,n}function P(t,e,n){return h.error("sphere.setExtent is not yet supported"),t===n?n:v(t,n)}function w(t,e,r){if(n.isNone(e))return!1;const o=c.subtract(d.sv3d.get(),e.origin,R(t)),s=c.dot(e.direction,e.direction),i=2*c.dot(e.direction,o),a=i*i-4*s*(c.dot(o,o)-t[3]*t[3]);if(a<0)return!1;const u=Math.sqrt(a);let l=(-i-u)/(2*s);const f=(-i+u)/(2*s);return(l<0||f<l&&f>0)&&(l=f),!(l<0)&&(r&&c.add(r,e.origin,c.scale(d.sv3d.get(),e.direction,l)),!0)}function x(t,e,n,r){return w(t,g.fromScreenAtEye(e,n,N),r)}function T(t,e){return w(t,e,null)}function j(t,e,n){if(w(t,e,n))return n;const r=E(t,e,d.sv3d.get());return c.add(n,e.origin,c.scale(d.sv3d.get(),e.direction,c.distance(e.origin,r)/c.length(e.direction))),n}function E(t,e,n){const r=d.sv3d.get(),o=d.sm4d.get();c.cross(r,e.origin,e.direction);const s=M(t);c.cross(n,r,e.origin),c.scale(n,n,1/c.length(n)*s);const i=q(t,e.origin),u=f.angle(e.origin,n);return a.identity(o),a.rotate(o,o,u+i,r),c.transformMat4(n,n,o),n}function O(t,e,n){return w(t,e,n)?n:(g.closestPoint(e,R(t),n),V(t,n,n))}function V(t,e,n){const r=c.subtract(d.sv3d.get(),e,R(t)),o=c.scale(d.sv3d.get(),r,t[3]/c.length(r));return c.add(n,o,R(t))}function _(t,e){const n=c.subtract(d.sv3d.get(),e,R(t)),r=c.squaredLength(n),o=t[3]*t[3];return Math.sqrt(Math.abs(r-o))}function q(t,e){const n=c.subtract(d.sv3d.get(),e,R(t)),r=c.length(n),s=M(t),i=s+Math.abs(s-r);return o.acosClamped(s/i)}const z=s.create();function L(t,e,n,r){const o=c.subtract(z,e,R(t));switch(n){case 0:{const t=i.cartesianToSpherical(o,z)[2];return c.set(r,-Math.sin(t),Math.cos(t),0)}case 1:{const t=i.cartesianToSpherical(o,z),e=t[1],n=t[2],s=Math.sin(e);return c.set(r,-s*Math.cos(n),-s*Math.sin(n),Math.cos(e))}case 2:return c.normalize(r,o);default:return}}function U(t,e){const n=c.subtract(D,e,R(t));return c.length(n)-t[3]}function k(t,e,n,r){const o=U(t,e),s=L(t,e,2,D),i=c.scale(D,s,n-o);return c.add(r,e,i),r}const N=g.create(),B=s.create(),D=s.create();Object.freeze(B);var F=Object.freeze({__proto__:null,create:p,copy:v,fromCenterAndRadius:y,wrap:m,clear:A,fromRadius:S,getRadius:M,getCenter:R,fromValues:b,elevate:C,setExtent:P,intersectRay:w,intersectScreen:x,intersectsRay:T,intersectRayClosestSilhouette:j,closestPointOnSilhouette:E,closestPoint:O,projectPoint:V,distanceToSilhouette:_,angleToSilhouette:q,axisAt:L,altitudeAt:U,setAltitudeAt:k});t.altitudeAt=U,t.angleToSilhouette=q,t.axisAt=L,t.clear=A,t.closestPoint=O,t.closestPointOnSilhouette=E,t.copy=v,t.create=p,t.distanceToSilhouette=_,t.elevate=C,t.fromCenterAndRadius=y,t.fromRadius=S,t.fromValues=b,t.getCenter=R,t.getRadius=M,t.intersectRay=w,t.intersectRayClosestSilhouette=j,t.intersectScreen=x,t.intersectsRay=T,t.projectPoint=V,t.setAltitudeAt=k,t.setExtent=P,t.sphereModule=F,t.wrap=m}));
