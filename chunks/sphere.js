/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../core/has","../core/Logger","../core/mathUtils","../core/maybe","./mat4","./vec3","./vec3f64","./vec4","./vec4f64","../geometry/support/Axis","../geometry/support/ray","../geometry/support/vector","../geometry/support/vectorStacks"],(function(t,e,r,n,o,s,c,i,a,u,l,f,d,g){"use strict";const h=r.getLogger("esri.geometry.support.sphere");function p(){return u.create()}function y(t,e=p()){return a.copy(e,t)}function m(t,e){return u.fromValues(t[0],t[1],t[2],e)}function A(t){return t}function v(t){t[0]=t[1]=t[2]=t[3]=0}function R(t){return t}function S(t){return Array.isArray(t)?t[3]:t}function M(t){return Array.isArray(t)?t:N}function b(t,e,r,n){return u.fromValues(t,e,r,n)}function x(t,e,r){return t!==r&&c.copy(r,t),r[3]=t[3]+e,r}function P(t,e,r){return h.error("sphere.setExtent is not yet supported"),t===r?r:y(t,r)}function C(t,e,r){if(o.isNone(e))return!1;const{origin:n,direction:s}=e,c=T;c[0]=n[0]-t[0],c[1]=n[1]-t[1],c[2]=n[2]-t[2];const i=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],a=2*(s[0]*c[0]+s[1]*c[1]+s[2]*c[2]),u=a*a-4*i*(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]-t[3]*t[3]);if(u<0)return!1;const l=Math.sqrt(u);let f=(-a-l)/(2*i);const d=(-a+l)/(2*i);return(f<0||d<f&&d>0)&&(f=d),!(f<0)&&(r&&(r[0]=n[0]+s[0]*f,r[1]=n[1]+s[1]*f,r[2]=n[2]+s[2]*f),!0)}const T=i.create();function j(t,e){return C(t,e,null)}function O(t,e,r){if(C(t,e,r))return r;const n=V(t,e,g.sv3d.get());return c.add(r,e.origin,c.scale(g.sv3d.get(),e.direction,c.distance(e.origin,n)/c.length(e.direction))),r}function V(t,e,r){const n=g.sv3d.get(),o=g.sm4d.get();c.cross(n,e.origin,e.direction);const i=S(t);c.cross(r,n,e.origin),c.scale(r,r,1/c.length(r)*i);const a=E(t,e.origin),u=d.angle(e.origin,r);return s.fromRotation(o,u+a,n),c.transformMat4(r,r,o),r}function _(t,e,r){return C(t,e,r)?r:(f.closestPoint(e,M(t),r),q(t,r,r))}function q(t,e,r){const n=c.subtract(g.sv3d.get(),e,M(t)),o=c.scale(g.sv3d.get(),n,t[3]/c.length(n));return c.add(r,o,M(t))}function w(t,e){const r=c.subtract(g.sv3d.get(),e,M(t)),n=c.squaredLength(r),o=t[3]*t[3];return Math.sqrt(Math.abs(n-o))}function E(t,e){const r=c.subtract(g.sv3d.get(),e,M(t)),o=c.length(r),s=S(t),i=s+Math.abs(s-o);return n.acosClamped(s/i)}const L=i.create();function z(t,e,r,o){const s=c.subtract(L,e,M(t));switch(r){case l.Axis.X:{const t=n.cartesianToSpherical(s,L)[2];return c.set(o,-Math.sin(t),Math.cos(t),0)}case l.Axis.Y:{const t=n.cartesianToSpherical(s,L),e=t[1],r=t[2],i=Math.sin(e);return c.set(o,-i*Math.cos(r),-i*Math.sin(r),Math.cos(e))}case l.Axis.Z:return c.normalize(o,s);default:return}}function Z(t,e){const r=c.subtract(U,e,M(t));return c.length(r)-t[3]}function k(t,e,r,n){const o=Z(t,e),s=z(t,e,l.Axis.Z,U),i=c.scale(U,s,r-o);return c.add(n,e,i)}const N=i.create(),U=i.create(),X=Object.freeze(Object.defineProperty({__proto__:null,create:p,copy:y,fromCenterAndRadius:m,wrap:A,clear:v,fromRadius:R,getRadius:S,getCenter:M,fromValues:b,elevate:x,setExtent:P,intersectRay:C,intersectsRay:j,intersectRayClosestSilhouette:O,closestPointOnSilhouette:V,closestPoint:_,projectPoint:q,distanceToSilhouette:w,angleToSilhouette:E,axisAt:z,altitudeAt:Z,setAltitudeAt:k},Symbol.toStringTag,{value:"Module"}));t.altitudeAt=Z,t.angleToSilhouette=E,t.axisAt=z,t.clear=v,t.closestPoint=_,t.closestPointOnSilhouette=V,t.copy=y,t.create=p,t.distanceToSilhouette=w,t.elevate=x,t.fromCenterAndRadius=m,t.fromRadius=R,t.fromValues=b,t.getCenter=M,t.getRadius=S,t.intersectRay=C,t.intersectRayClosestSilhouette=O,t.intersectsRay=j,t.projectPoint=q,t.setAltitudeAt=k,t.setExtent=P,t.sphere=X,t.wrap=A}));
