/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../core/has","../core/maybe","../core/Logger","../core/mathUtils","./vec3f64","./vec3","../views/3d/support/mathUtils","./mat4","../core/ObjectStack","../views/3d/support/stack","./vector","./ray"],(function(t,e,r,n,s,c,i,o,a,u,d,l,g){"use strict";const h=n.getLogger("esri.views.3d.support.geometryUtils.sphere");function f(t){return t?{radius:t.radius,center:c.clone(t.center)}:{radius:1,center:c.create()}}function p(t,e){const r=q.get();return r.radius=t,r.center=e||C,r}function v(t,e=f()){return y(t.radius,t.center,e)}function y(t,e,r=f()){return i.copy(r.center,e),r.radius=t,r}function S(t,e,r){return t!==r&&i.copy(r.center,t.center),r.radius=t.radius+e,r}function b(t,e,r){return h.error("sphere.setExtent is not yet supported"),t===r?r:v(t,r)}function m(t,e,n){if(r.isNone(e))return!1;const s=i.subtract(d.sv3d.get(),e.origin,t.center),c=i.dot(e.direction,e.direction),o=2*i.dot(e.direction,s),a=o*o-4*c*(i.dot(s,s)-t.radius*t.radius);if(a<0)return!1;const u=Math.sqrt(a);let l=(-o-u)/(2*c);const g=(-o+u)/(2*c);return(l<0||g<l&&g>0)&&(l=g),!(l<0)&&(n&&i.add(n,e.origin,i.scale(d.sv3d.get(),e.direction,l)),!0)}function M(t,e,r,n){return m(t,g.fromScreenAtEye(e,r,z),n)}function A(t,e){return m(t,e,null)}function w(t,e,r){if(m(t,e,r))return r;const n=P(t,e,d.sv3d.get());return i.add(r,e.origin,i.scale(d.sv3d.get(),e.direction,i.distance(e.origin,n)/i.length(e.direction))),r}function P(t,e,r){const n=d.sv3d.get(),s=d.sm4d.get();i.cross(n,e.origin,e.direction),i.cross(r,n,e.origin),i.scale(r,r,1/i.length(r)*t.radius);const c=R(t,e.origin),o=l.angle(e.origin,r);return a.identity(s),a.rotate(s,s,o+c,n),i.transformMat4(r,r,s),r}function j(t,e,r){return m(t,e,r)?r:(g.closestPoint(e,t.center,r),x(t,r,r))}function x(t,e,r){const n=i.subtract(d.sv3d.get(),e,t.center),s=i.scale(d.sv3d.get(),n,t.radius/i.length(n));return i.add(r,s,t.center)}function O(t,e){const r=i.subtract(d.sv3d.get(),e,t.center),n=i.squaredLength(r),s=t.radius*t.radius;return Math.sqrt(Math.abs(n-s))}function R(t,e){const r=i.subtract(d.sv3d.get(),e,t.center),n=i.length(r),c=t.radius+Math.abs(t.radius-n);return s.acosClamped(t.radius/c)}const T=c.create();function E(t,e,r,n){const s=i.subtract(T,e,t.center);switch(r){case 0:{const t=o.cartesianToSpherical(s,T)[2];return i.set(n,-Math.sin(t),Math.cos(t),0)}case 1:{const t=o.cartesianToSpherical(s,T),e=t[1],r=t[2],c=Math.sin(e);return i.set(n,-c*Math.cos(r),-c*Math.sin(r),Math.cos(e))}case 2:return i.normalize(n,s);default:return}}function _(t,e){const r=i.subtract(L,e,t.center);return i.length(r)-t.radius}function k(t,e,r,n){const s=_(t,e),c=E(t,e,2,L),o=i.scale(L,c,r-s);return i.add(n,e,o),n}const q=new u.ObjectStack((()=>({center:null,radius:0}))),z=g.create(),C=c.create(),L=c.create();Object.freeze(C);var U=Object.freeze({__proto__:null,create:f,wrap:p,copy:v,fromValues:y,elevate:S,setExtent:b,intersectRay:m,intersectScreen:M,intersectsRay:A,intersectRayClosestSilhouette:w,closestPointOnSilhouette:P,closestPoint:j,projectPoint:x,distanceToSilhouette:O,angleToSilhouette:R,axisAt:E,altitudeAt:_,setAltitudeAt:k});t.altitudeAt=_,t.angleToSilhouette=R,t.axisAt=E,t.closestPoint=j,t.closestPointOnSilhouette=P,t.copy=v,t.create=f,t.distanceToSilhouette=O,t.elevate=S,t.fromValues=y,t.intersectRay=m,t.intersectRayClosestSilhouette=w,t.intersectScreen=M,t.intersectsRay=A,t.projectPoint=x,t.setAltitudeAt=k,t.setExtent=b,t.sphereModule=U,t.wrap=p}));
