/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../core/maybe","../core/urlUtils"],(function(e,r,t){"use strict";function o(e,r){const o=r&&r.url&&r.url.path;if(e&&o&&(e=t.makeAbsolute(e,o,{preserveProtocolRelative:!0}),r.portalItem&&r.readResourcePaths)){const o=t.makeRelative(e,r.portalItem.itemUrl);n.test(o)&&r.readResourcePaths.push(r.portalItem.resourceFromPath(o).path)}return c(e,r&&r.portal)}function l(e,r){if(!e)return e;!t.isAbsolute(e)&&r&&r.blockedRelativeUrls&&r.blockedRelativeUrls.push(e);let o=t.makeAbsolute(e);if(r){const l=r.verifyItemRelativeUrls&&r.verifyItemRelativeUrls.rootPath||r.url&&r.url.path;if(l){const s=c(l,r.portal);o=t.makeRelative(c(o,r.portal),s,s),o!==e&&r.verifyItemRelativeUrls&&r.verifyItemRelativeUrls.writtenUrls.push(o)}}return o=function(e,r){if(r&&!r.isPortal&&r.urlKey&&r.customBaseUrl)return t.changeDomain(e,`${r.urlKey}.${r.customBaseUrl}`,r.portalHostname);return e}(o,r&&r.portal),t.isAbsolute(o)&&(o=t.normalize(o)),o}function s(e,r,t){return o(e,t)}function a(e,r,t,o){const s=l(e,o);void 0!==s&&(r[t]=s)}const i=/\/items\/([^\/]+)\/resources\//,n=/^\.\/resources\//;function u(e){const t=r.isSome(e)?e.match(i):null;return r.isSome(t)?t[1]:null}function c(e,r){if(!r||r.isPortal||!r.urlKey||!r.customBaseUrl)return e;const o=`${r.urlKey}.${r.customBaseUrl}`;return t.hasSameOrigin(t.appUrl,`${t.appUrl.scheme}://${o}`)?t.changeDomain(e,r.portalHostname,o):t.changeDomain(e,o,r.portalHostname)}var m=Object.freeze({__proto__:null,fromJSON:o,toJSON:l,read:s,write:a,itemIdFromResourceUrl:u});e.fromJSON=o,e.itemIdFromResourceUrl=u,e.persistableUrlUtils=m,e.read=s,e.toJSON=l,e.write=a}));
