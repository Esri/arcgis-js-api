/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../core/maybe","../core/urlUtils"],(function(e,r,t){"use strict";function o(e,r){const o=r&&r.url&&r.url.path;if(e&&o&&(e=t.makeAbsolute(e,o,{preserveProtocolRelative:!0}),r.portalItem&&r.readResourcePaths)){const o=t.makeRelative(e,r.portalItem.itemUrl);null!=o&&i.test(o)&&r.readResourcePaths.push(r.portalItem.resourceFromPath(o).path)}return p(e,r&&r.portal)}function l(r,o,l=e.MarkKeep.YES){if(null==r)return r;!t.isAbsolute(r)&&o&&o.blockedRelativeUrls&&o.blockedRelativeUrls.push(r);let n=t.makeAbsolute(r);if(o){const e=o.verifyItemRelativeUrls&&o.verifyItemRelativeUrls.rootPath||o.url&&o.url.path;if(e){const l=p(e,o.portal);n=t.makeRelative(p(n,o.portal),l,l),null!=n&&n!==r&&o.verifyItemRelativeUrls&&o.verifyItemRelativeUrls.writtenUrls.push(n)}}return n=m(n,o?.portal),t.isAbsolute(n)&&(n=t.normalize(n)),o?.resources&&o?.portalItem&&!t.isAbsolute(n)&&!t.isDataProtocol(n)&&l===e.MarkKeep.YES&&o.resources.toKeep.push({resource:o.portalItem.resourceFromPath(n),compress:!1}),n}function n(e,r,t){return o(e,t)}function s(e,r,t,o){const n=l(e,o);void 0!==n&&(r[t]=n)}const a=/\/items\/([^\/]+)\/resources\/(.*)/,i=/^\.\/resources\//;function u(e){return(e?.match(a)??null)?.[1]??null}function c(e){const o=e?.match(a)??null;if(null==o)return null;const l=o[2],n=l.lastIndexOf("/");if(-1===n){const{path:e,extension:o}=t.splitPathExtension(l);return{prefix:null,filename:e,extension:r.unwrap(o)}}const{path:s,extension:i}=t.splitPathExtension(l.slice(n+1));return{prefix:l.slice(0,n),filename:s,extension:r.unwrap(i)}}function m(e,r){return r&&!r.isPortal&&r.urlKey&&r.customBaseUrl?t.changeDomain(e,`${r.urlKey}.${r.customBaseUrl}`,r.portalHostname):e}function p(e,r){if(!r||r.isPortal||!r.urlKey||!r.customBaseUrl)return e;const o=`${r.urlKey}.${r.customBaseUrl}`,l=t.getAppUrl();return t.hasSameOrigin(l,`${l.scheme}://${o}`)?t.changeDomain(e,r.portalHostname,o):t.changeDomain(e,o,r.portalHostname)}var f;e.MarkKeep=void 0,(f=e.MarkKeep||(e.MarkKeep={}))[f.YES=0]="YES",f[f.NO=1]="NO";const h=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:o,toJSON:l,read:n,write:s,itemIdFromResourceUrl:u,prefixAndFilenameFromResourceUrl:c,ensureMainOnlineDomain:m,get MarkKeep(){return e.MarkKeep}},Symbol.toStringTag,{value:"Module"}));e.ensureMainOnlineDomain=m,e.fromJSON=o,e.itemIdFromResourceUrl=u,e.persistableUrlUtils=h,e.prefixAndFilenameFromResourceUrl=c,e.read=n,e.toJSON=l,e.write=s}));
