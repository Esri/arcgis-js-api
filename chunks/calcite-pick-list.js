/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","./componentsUtils","./resources3","./dom","./array2","./debounce","./observers","./calcite-icon2","./calcite-input2","./calcite-loader2","./calcite-scrim2","./forIn"],(function(e,t,i,a,n,s,l,r,o,c,m,d){"use strict";
/*!
   * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
   * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
   */function u(){this.setUpItems(),this.setUpFilter()}const h=["ArrowUp","ArrowDown"];function f(){this.setUpItems(),this.setUpFilter(),this.emitCalciteListChange=s.debounce(v.bind(this),0)}function p(){var e;null===(e=this.mutationObserver)||void 0===e||e.observe(this.el,{childList:!0,subtree:!0})}function b(){var e;null===(e=this.mutationObserver)||void 0===e||e.disconnect()}function g(e){const{selectedValues:t}=this,{item:i,value:n,selected:s,shiftPressed:l}=e.detail;s?(this.multiple&&l&&this.selectSiblings(i),this.multiple||this.deselectSiblingItems(i),t.set(n,i)):(t.delete(n),this.multiple&&l&&this.selectSiblings(i,!0)),this.multiple||(D(i,s),s&&a.focusElement(i)),this.lastSelectedItem=i,this.emitCalciteListChange()}function y(e){e.stopPropagation();const t=e.detail.oldValue,i=this.selectedValues;if(i.has(t)){const a=i.get(t);i.delete(t),i.set(e.detail.newValue,a)}}function w(e){return!!h.find((t=>t===e))}function k(e){const{el:t,items:i,multiple:a,selectedValues:n}=this;if(a)return;!t.contains(e.relatedTarget)?i.forEach((t=>D(t,0===n.size?e.target===t:t.selected))):D(e.target,!1)}function x(e){const{key:t,target:i}=e;if(!w(t))return;const{items:s,multiple:l,selectionFollowsFocus:r}=this,{length:o}=s,c=s.indexOf(i);if(!o||-1===c)return;e.preventDefault();const m=s[n.getRoundRobinIndex(c+("ArrowUp"===t?-1:1),o)];s.forEach((e=>D(e,e===m))),!l&&r&&(m.selected=!0),a.focusElement(m)}function v(){this.calciteListChange.emit(this.selectedValues)}function E(e){if(e.defaultPrevented)return;const t=e.target,i=this.selectedValues;"CALCITE-PICK-LIST-GROUP"===t.parentElement.tagName?(t.parentElement.remove(),Array.from(t.parentElement.children).forEach((e=>i.delete(e.value)))):(t.remove(),i.delete(t.value)),this.emitCalciteListChange()}function D(e,t){t?e.removeAttribute("tabindex"):e.setAttribute("tabindex","-1")}async function I(e){if(this.filterEnabled&&"filter"===e)return void await a.focusElement(this.filterEl);const{items:t,multiple:i,selectionFollowsFocus:n}=this;if(0===t.length)return;if(i)return t[0].setFocus();const s=t.find((e=>e.selected))||t[0];return n&&(s.selected=!0),s.setFocus()}function C(e){this.items=Array.from(this.el.querySelectorAll(e));let t=!1;const{items:i}=this;i.forEach((e=>{e.icon=this.getIconType(),this.multiple||(e.disableDeselect=!0,D(e,!1)),e.selected&&(t=!0,D(e,!0),this.selectedValues.set(e.value,e))}));const[a]=i;!t&&a&&D(a,!0)}function F(e){this.items.forEach((t=>{t.value!==e.value&&(t.toggleSelected(!1),this.selectedValues.has(t.value)&&this.selectedValues.delete(t.value))}))}function L(e,t=!1){if(!this.lastSelectedItem)return;const{items:i}=this,a=i.findIndex((e=>e.value===this.lastSelectedItem.value)),n=i.findIndex((t=>t.value===e.value));i.slice(Math.min(a,n),Math.max(a,n)).forEach((e=>{e.toggleSelected(!t),t?this.selectedValues.delete(e.value):this.selectedValues.set(e.value,e)}))}let S;function _(e){const t=e.detail.map((e=>e.value));let i=!1;S||(S=new Set);const n=this.items.filter((e=>{const a=e.parentElement;a.matches("calcite-pick-list-group")&&S.add(a);const n=t.includes(e.value);return e.hidden=!n,i||(i=n&&e.selected),n}));S.forEach((e=>{const t=n.some((t=>e.contains(t)));if(e.hidden=!t,!t)return;const i=a.getSlotted(e,"parent-item");i&&(i.hidden=!1,n.includes(i)&&Array.from(e.children).forEach((e=>e.hidden=!1)))})),S.clear(),n.length>0&&!i&&!this.multiple&&D(n[0],!0)}function H(){return this.items.map((e=>({label:e.label,description:e.description,metadata:e.metadata,value:e.value})))}var O=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(i[a[n]]=e[a[n]])}return i};const V=e=>{var{props:{disabled:n,loading:s,filterEnabled:l,dataForFilter:r,handleFilter:o,filterPlaceholder:c,el:m,setFilterEl:d}}=e,u=O(e,["props"]);const h=t.h("slot",null);return t.h(t.Host,Object.assign({"aria-busy":s.toString(),"aria-disabled":n.toString(),role:"menu"},u),t.h("section",null,t.h("header",{class:{[i.CSS.sticky]:!0}},l?t.h("calcite-filter",{"aria-label":c,data:r,dir:a.getElementDir(m),disabled:s||n,onCalciteFilterChange:o,placeholder:c,ref:d}):null,t.h("slot",{name:i.SLOTS.menuActions})),s||n?t.h("calcite-scrim",{loading:s}):null,h))},P={container:"container",searchIcon:"search-icon",clearButton:"clear-button"},z={filterLabel:"Filter",clear:"Clear filter"},T={search:"search",close:"x"},A="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:300ms}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:host{-webkit-box-sizing:border-box;box-sizing:border-box;background-color:var(--calcite-ui-foreground-1);color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1)}:host *{-webkit-box-sizing:border-box;box-sizing:border-box}:root{--calcite-popper-transition:150ms ease-in-out}:host([hidden]){display:none}:host{display:-ms-flexbox;display:flex;width:100%}.container{display:-ms-flexbox;display:flex;width:100%;padding:0.5rem}label{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;overflow:hidden;position:relative;width:100%;margin-left:0.25rem;margin-right:0.25rem;margin-top:0;margin-bottom:0}input[type=text]{background-color:transparent;border-style:none;font-family:inherit;color:var(--calcite-ui-text-1);font-size:var(--calcite-font-size--2);line-height:1rem;margin-bottom:0.25rem;width:100%;padding-top:0.25rem;padding-bottom:0.25rem;padding-right:0.25rem;padding-left:1.5rem;-webkit-transition:padding 150ms ease-in-out, -webkit-box-shadow 150ms ease-in-out;transition:padding 150ms ease-in-out, -webkit-box-shadow 150ms ease-in-out;transition:padding 150ms ease-in-out, box-shadow 150ms ease-in-out;transition:padding 150ms ease-in-out, box-shadow 150ms ease-in-out, -webkit-box-shadow 150ms ease-in-out}input[type=text]::-ms-clear{display:none}calcite-input{width:100%}.search-icon{display:-ms-flexbox;display:flex;left:0;position:absolute;color:var(--calcite-ui-text-2);-webkit-transition:left 150ms ease-in-out, right 150ms ease-in-out, opacity 150ms ease-in-out;transition:left 150ms ease-in-out, right 150ms ease-in-out, opacity 150ms ease-in-out}.calcite--rtl .search-icon{right:0}input[type=text]:focus{border-color:var(--calcite-ui-brand);outline:2px solid transparent;outline-offset:2px;padding-left:0.25rem;padding-right:0.25rem}input[type=text]:focus~.search-icon{left:calc(1rem * -1);opacity:0}.calcite--rtl input[type=text]{padding-left:0.25rem;padding-right:1.5rem}.calcite--rtl input[type=text]:focus{padding-right:1.25rem}.calcite--rtl input[type=text]:focus~.search-icon{right:calc(1rem * -1)}.clear-button{color:var(--calcite-ui-text-2);background-color:transparent;border-width:0;cursor:pointer;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.clear-button:hover,.clear-button:focus{color:var(--calcite-ui-text-1)}",U=250;
/*!
   * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
   * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
   */let j=class extends HTMLElement{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteFilterChange=t.createEvent(this,"calciteFilterChange",7),this.disabled=!1,this.filteredItems=[],this.filter=s.debounce((e=>{const t=new RegExp(e,"i");if(0===this.items.length)return void this.updateFiltered([]);const i=(e,t)=>{let a=!1;return d.forIn(e,(e=>{"function"!=typeof e&&(Array.isArray(e)||"object"==typeof e&&null!==e?i(e,t)&&(a=!0):t.test(e)&&(a=!0))})),a},a=this.items.filter((e=>i(e,t)));this.updateFiltered(a)}),U),this.inputHandler=e=>{const t=e.target;this.value=t.value},this.keyDownHandler=({key:e})=>{"Escape"===e&&this.clear()},this.clear=()=>{this.value="",this.setFocus()}}watchDataHandler(e){this.items=e}watchItemsHandler(){this.filter(this.value)}valueHandler(e){this.filter(e)}connectedCallback(){this.data&&!this.items&&(this.items=this.data)}async setFocus(){a.focusElement(this.textInput)}updateFiltered(e){this.filteredItems.length=0,this.filteredItems=this.filteredItems.concat(e),this.calciteFilterChange.emit(e)}render(){const e="rtl"===a.getElementDir(this.el),{disabled:i}=this;return t.h(t.Fragment,null,i?t.h("calcite-scrim",null):null,t.h("div",{class:P.container},t.h("label",{class:e?a.CSS_UTILITY.rtl:null},t.h("calcite-input",{"aria-label":this.intlLabel||z.filterLabel,class:e?a.CSS_UTILITY.rtl:null,disabled:this.disabled,icon:T.search,onCalciteInputInput:this.inputHandler,onKeyDown:this.keyDownHandler,placeholder:this.placeholder,ref:e=>{this.textInput=e},type:"text",value:this.value})),this.value?t.h("button",{"aria-label":this.intlClear||z.clear,class:P.clearButton,onClick:this.clear},t.h("calcite-icon",{icon:T.close})):null))}get el(){return this}static get watchers(){return{data:["watchDataHandler"],items:["watchItemsHandler"],value:["valueHandler"]}}static get style(){return A}};function R(){["calcite-filter","calcite-icon","calcite-input","calcite-loader","calcite-progress","calcite-scrim"].forEach((e=>{switch(e){case"calcite-filter":customElements.get(e)||customElements.define(e,j);break;case"calcite-icon":customElements.get(e)||r.defineCustomElement();break;case"calcite-input":customElements.get(e)||o.defineCustomElement$1();break;case"calcite-loader":customElements.get(e)||c.defineCustomElement();break;case"calcite-progress":customElements.get(e)||o.defineCustomElement();break;case"calcite-scrim":customElements.get(e)||m.defineCustomElement()}}))}j=t.proxyCustomElement(j,[1,"calcite-filter",{data:[16],items:[1040],disabled:[516],filteredItems:[1040],intlClear:[1,"intl-clear"],intlLabel:[1,"intl-label"],placeholder:[1],value:[1025],setFocus:[64]}]),R();
/*!
   * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
   * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
   */
const M="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:300ms}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:150ms ease-in-out}:host([hidden]){display:none}:host{-ms-flex-align:stretch;align-items:stretch;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;position:relative;-ms-flex-positive:1;flex-grow:1;-ms-flex-negative:0;flex-shrink:0;color:var(--calcite-ui-text-2);font-size:var(--calcite-font-size--1);line-height:1rem}:host *{-webkit-box-sizing:border-box;box-sizing:border-box}:host([filter-enabled]) header{background-color:var(--calcite-ui-foreground-1);display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;-ms-flex-align:stretch;align-items:stretch;margin-bottom:0.25rem;-webkit-box-shadow:0 1px 0 var(--calcite-ui-border-3);box-shadow:0 1px 0 var(--calcite-ui-border-3)}:host([filter-enabled]) header.sticky{position:-webkit-sticky;position:sticky;top:0;z-index:1}calcite-filter{margin-bottom:0}:host([loading][disabled]){min-height:2rem}";let Y=class extends HTMLElement{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.calciteListChange=t.createEvent(this,"calciteListChange",7),this.disabled=!1,this.filterEnabled=!1,this.loading=!1,this.multiple=!1,this.selectionFollowsFocus=!1,this.selectedValues=new Map,this.dataForFilter=[],this.lastSelectedItem=null,this.mutationObserver=l.createObserver("mutation",u.bind(this)),this.setFilterEl=e=>{this.filterEl=e},this.deselectSiblingItems=F.bind(this),this.selectSiblings=L.bind(this),this.handleFilter=_.bind(this),this.getItemData=H.bind(this),this.keyDownHandler=x.bind(this)}connectedCallback(){f.call(this),p.call(this)}disconnectedCallback(){b.call(this)}calciteListItemRemoveHandler(e){E.call(this,e)}calciteListItemChangeHandler(e){g.call(this,e)}calciteListItemPropsChangeHandler(e){e.stopPropagation(),this.setUpFilter()}calciteListItemValueChangeHandler(e){y.call(this,e)}calciteListFocusOutHandler(e){k.call(this,e)}setUpItems(){C.call(this,"calcite-pick-list-item")}setUpFilter(){this.filterEnabled&&(this.dataForFilter=this.getItemData())}async getSelectedItems(){return this.selectedValues}async setFocus(e){return I.call(this,e)}getIconType(){return this.multiple?i.ICON_TYPES.square:i.ICON_TYPES.circle}render(){return t.h(V,{onKeyDown:this.keyDownHandler,props:this})}get el(){return this}static get style(){return M}};function K(){["calcite-pick-list","calcite-filter","calcite-icon","calcite-input","calcite-loader","calcite-progress","calcite-scrim"].forEach((e=>{switch(e){case"calcite-pick-list":customElements.get(e)||customElements.define(e,Y);break;case"calcite-filter":customElements.get(e)||R();break;case"calcite-icon":customElements.get(e)||r.defineCustomElement();break;case"calcite-input":customElements.get(e)||o.defineCustomElement$1();break;case"calcite-loader":customElements.get(e)||c.defineCustomElement();break;case"calcite-progress":customElements.get(e)||o.defineCustomElement();break;case"calcite-scrim":customElements.get(e)||m.defineCustomElement()}}))}Y=t.proxyCustomElement(Y,[1,"calcite-pick-list",{disabled:[516],filterEnabled:[516,"filter-enabled"],filterPlaceholder:[513,"filter-placeholder"],headingLevel:[2,"heading-level"],loading:[516],multiple:[516],selectionFollowsFocus:[4,"selection-follows-focus"],selectedValues:[32],dataForFilter:[32],getSelectedItems:[64],setFocus:[64]},[[0,"calciteListItemRemove","calciteListItemRemoveHandler"],[0,"calciteListItemChange","calciteListItemChangeHandler"],[0,"calciteListItemPropsChange","calciteListItemPropsChangeHandler"],[0,"calciteListItemValueChange","calciteListItemValueChangeHandler"],[0,"focusout","calciteListFocusOutHandler"]]]),K();const N=Y,q=K;e.CalcitePickList=N,e.defineCustomElement=q}));
