/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../core/maybe","../core/mathUtils","./vec3f64","./vec3","../views/3d/support/stack"],(function(t,n,e,r,o,i){"use strict";function c(t=D){return[t[0],t[1],t[2],t[3]]}function s(t,n,e,r){return a(t,n,e,r,i.sv4d.get())}function u(t,n=c()){return a(t[0],t[1],t[2],t[3],n)}function a(t,n,e,r,o=c()){return o[0]=t,o[1]=n,o[2]=e,o[3]=r,o}function f(t,n,e=c()){return o.copy(e,t),e[3]=n,e}function d(t,n,e=c()){o.copy(e,n);const r=o.dot(n,n);return Math.abs(r-1)>1e-5&&r>1e-12&&o.scale(e,e,1/Math.sqrt(r)),h(e,t,e),e}function l(t,n,e,r=c()){return S(o.subtract(i.sv3d.get(),t,n),o.subtract(i.sv3d.get(),e,n),t,r)}function m(t,n){return p(t,n,0,1,2)}function p(t,n,e,r,i){if(t.count<3)return!1;t.getVec(e,y);let c=r,s=!1;for(;c<t.count-1&&!s;)t.getVec(c,P),c++,s=!o.exactEquals(y,P);if(!s)return!1;for(c=Math.max(c,i),s=!1;c<t.count&&!s;)t.getVec(c,v),c++,o.subtract(A,y,P),o.normalize(A,A),o.subtract(b,P,v),o.normalize(b,b),s=!o.exactEquals(y,v)&&!o.exactEquals(P,v)&&Math.abs(o.dot(A,b))<g;return s?(l(y,P,v,n),!0):(0!==e||1!==r||2!==i)&&p(t,n,0,1,2)}const g=.99619469809,y=r.create(),P=r.create(),v=r.create(),A=r.create(),b=r.create();function h(t,n,e){return t!==e&&u(t,e),e[3]=-o.dot(e,n),e}function M(t,n){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n}function S(t,n,e,r=c()){return d(e,o.cross(i.sv3d.get(),n,t),r)}function O(t,e,r){return!!n.isSome(e)&&U(t,e.origin,e.direction,!0,!1,r)}function V(t,n,e){return U(t,n.origin,n.vector,!1,!1,e)}function F(t,n,e){return U(t,n.origin,n.vector,!1,!0,e)}function I(t,n){const{center:e,radius:r}=n;return E(t,e)-r>=0}function x(t,n){const{center:e,radius:r}=n;return E(t,e)+r<0}function j(t,n){return E(t,n)>=0}function q(t,n){return E(t,n)<0}function B(t,n){const e=n[0],r=n[1],o=n[2],i=n[3],c=n[4],s=n[5];return t[0]*(t[0]>0?e:i)+t[1]*(t[1]>0?r:c)+t[2]*(t[2]>0?o:s)+t[3]>=0}function L(t,n){const e=o.dot(t,n.ray.direction),r=-E(t,n.ray.origin);if(r<0&&e>=0)return!1;if(e>-1e-6&&e<1e-6)return r>0;if((r<0||e<0)&&!(r<0&&e<0))return!0;const i=r/e;return e>0?i<n.c1&&(n.c1=i):i>n.c0&&(n.c0=i),n.c0<=n.c1}function N(t,n){const e=o.dot(t,n.ray.direction),r=-E(t,n.ray.origin);if(e>-1e-6&&e<1e-6)return r>0;const i=r/e;return e>0?i<n.c1&&(n.c1=i):i>n.c0&&(n.c0=i),n.c0<=n.c1}function _(t,n,e){const r=o.scale(i.sv3d.get(),t,-t[3]),c=w(t,o.subtract(i.sv3d.get(),n,r),i.sv3d.get());return o.add(e,c,r),e}function w(t,n,e){const r=o.scale(i.sv3d.get(),t,o.dot(t,n));return o.subtract(e,n,r),e}function z(t,n){return Math.abs(E(t,n))}function E(t,n){return o.dot(t,n)+t[3]}function U(t,n,r,i,c,s){const u=o.dot(t,r);if(0===u)return!1;let a=-(o.dot(t,n)+t[3])/u;return c&&(a=i?Math.max(0,a):e.clamp(a,0,1)),!(a<0||!i&&a>1)&&(o.add(s,n,o.scale(s,r,a)),!0)}function C(t){return t}const D=[0,0,1,0];var R=Object.freeze({__proto__:null,create:c,wrap:s,copy:u,fromValues:a,fromNormalAndOffset:f,fromPositionAndNormal:d,fromPoints:l,fromManyPoints:m,fromManyPointsSampleAt:p,setOffsetFromPoint:h,negate:M,fromVectorsAndPoint:S,intersectRay:O,intersectLineSegment:V,intersectLineSegmentClamp:F,isSphereFullyInside:I,isSphereFullyOutside:x,isPointInside:j,isPointOutside:q,isAABBFullyInside:B,clip:L,clipInfinite:N,projectPoint:_,projectVector:w,distance:z,signedDistance:E,normal:C,UP:D});t.UP=D,t.clip=L,t.clipInfinite=N,t.copy=u,t.create=c,t.distance=z,t.fromManyPoints=m,t.fromManyPointsSampleAt=p,t.fromNormalAndOffset=f,t.fromPoints=l,t.fromPositionAndNormal=d,t.fromValues=a,t.fromVectorsAndPoint=S,t.intersectLineSegment=V,t.intersectLineSegmentClamp=F,t.intersectRay=O,t.isAABBFullyInside=B,t.isPointInside=j,t.isPointOutside=q,t.isSphereFullyInside=I,t.isSphereFullyOutside=x,t.negate=M,t.normal=C,t.planeModule=R,t.projectPoint=_,t.projectVector=w,t.setOffsetFromPoint=h,t.signedDistance=E,t.wrap=s}));
