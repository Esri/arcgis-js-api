/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../core/maybe","../core/mathUtils","./vec3f64","./vec3","../views/3d/support/stack","./sphere"],(function(t,n,e,r,o,i,c){"use strict";function s(t=R){return[t[0],t[1],t[2],t[3]]}function u(t,n,e,r){return f(t,n,e,r,i.sv4d.get())}function a(t,n=s()){return f(t[0],t[1],t[2],t[3],n)}function f(t,n,e,r,o=s()){return o[0]=t,o[1]=n,o[2]=e,o[3]=r,o}function d(t,n,e=s()){return o.copy(e,t),e[3]=n,e}function l(t,n,e=s()){o.copy(e,n);const r=o.dot(n,n);return Math.abs(r-1)>1e-5&&r>1e-12&&o.scale(e,e,1/Math.sqrt(r)),M(e,t,e),e}function m(t,n,e,r=s()){return O(o.subtract(i.sv3d.get(),t,n),o.subtract(i.sv3d.get(),e,n),t,r)}function p(t,n){return g(t,n,0,1,2)}function g(t,n,e,r,i){if(t.count<3)return!1;t.getVec(e,P);let c=r,s=!1;for(;c<t.count-1&&!s;)t.getVec(c,v),c++,s=!o.exactEquals(P,v);if(!s)return!1;for(c=Math.max(c,i),s=!1;c<t.count&&!s;)t.getVec(c,h),c++,o.subtract(A,P,v),o.normalize(A,A),o.subtract(b,v,h),o.normalize(b,b),s=!o.exactEquals(P,h)&&!o.exactEquals(v,h)&&Math.abs(o.dot(A,b))<y;return s?(m(P,v,h,n),!0):(0!==e||1!==r||2!==i)&&g(t,n,0,1,2)}const y=.99619469809,P=r.create(),v=r.create(),h=r.create(),A=r.create(),b=r.create();function M(t,n,e){return t!==e&&a(t,e),e[3]=-o.dot(D(e),n),e}function S(t,n){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n}function O(t,n,e,r=s()){return l(e,o.cross(i.sv3d.get(),n,t),r)}function V(t,e,r){return!!n.isSome(e)&&U(t,e.origin,e.direction,!0,!1,r)}function F(t,n,e){return U(t,n.origin,n.vector,!1,!1,e)}function I(t,n,e){return U(t,n.origin,n.vector,!1,!0,e)}function x(t,n){return E(t,c.getCenter(n))-n[3]>=0}function j(t,n){return E(t,c.getCenter(n))+n[3]<0}function q(t,n){return E(t,n)>=0}function B(t,n){return E(t,n)<0}function C(t,n){const e=n[0],r=n[1],o=n[2],i=n[3],c=n[4],s=n[5];return t[0]*(t[0]>0?e:i)+t[1]*(t[1]>0?r:c)+t[2]*(t[2]>0?o:s)+t[3]>=0}function L(t,n){const e=o.dot(D(t),n.ray.direction),r=-E(t,n.ray.origin);if(r<0&&e>=0)return!1;if(e>-1e-6&&e<1e-6)return r>0;if((r<0||e<0)&&!(r<0&&e<0))return!0;const i=r/e;return e>0?i<n.c1&&(n.c1=i):i>n.c0&&(n.c0=i),n.c0<=n.c1}function N(t,n){const e=o.dot(D(t),n.ray.direction),r=-E(t,n.ray.origin);if(e>-1e-6&&e<1e-6)return r>0;const i=r/e;return e>0?i<n.c1&&(n.c1=i):i>n.c0&&(n.c0=i),n.c0<=n.c1}function _(t,n,e){const r=o.scale(i.sv3d.get(),D(t),-t[3]),c=w(t,o.subtract(i.sv3d.get(),n,r),i.sv3d.get());return o.add(e,c,r),e}function w(t,n,e){const r=o.scale(i.sv3d.get(),D(t),o.dot(D(t),n));return o.subtract(e,n,r),e}function z(t,n){return Math.abs(E(t,n))}function E(t,n){return o.dot(D(t),n)+t[3]}function U(t,n,r,i,c,s){const u=o.dot(D(t),r);if(0===u)return!1;let a=-(o.dot(D(t),n)+t[3])/u;return c&&(a=i?Math.max(0,a):e.clamp(a,0,1)),!(a<0||!i&&a>1)&&(o.add(s,n,o.scale(s,r,a)),!0)}function D(t){return t}const R=[0,0,1,0];var k=Object.freeze({__proto__:null,create:s,wrap:u,copy:a,fromValues:f,fromNormalAndOffset:d,fromPositionAndNormal:l,fromPoints:m,fromManyPoints:p,fromManyPointsSampleAt:g,setOffsetFromPoint:M,negate:S,fromVectorsAndPoint:O,intersectRay:V,intersectLineSegment:F,intersectLineSegmentClamp:I,isSphereFullyInside:x,isSphereFullyOutside:j,isPointInside:q,isPointOutside:B,isAABBFullyInside:C,clip:L,clipInfinite:N,projectPoint:_,projectVector:w,distance:z,signedDistance:E,normal:D,UP:R});t.UP=R,t.clip=L,t.clipInfinite=N,t.copy=a,t.create=s,t.distance=z,t.fromManyPoints=p,t.fromManyPointsSampleAt=g,t.fromNormalAndOffset=d,t.fromPoints=m,t.fromPositionAndNormal=l,t.fromValues=f,t.fromVectorsAndPoint=O,t.intersectLineSegment=F,t.intersectLineSegmentClamp=I,t.intersectRay=V,t.isAABBFullyInside=C,t.isPointInside=q,t.isPointOutside=B,t.isSphereFullyInside=x,t.isSphereFullyOutside=j,t.negate=S,t.normal=D,t.planeModule=k,t.projectPoint=_,t.projectVector=w,t.setOffsetFromPoint=M,t.signedDistance=E,t.wrap=u}));
