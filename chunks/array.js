/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../arcade/FunctionWrapper","../arcade/ImmutableArray","./languageUtils","../core/promiseUtils"],(function(n,r,e,t,o){"use strict";function i(n){function i(e,o){if(o instanceof r)return n.arcadeCustomFunctionHandler(o);if(o instanceof t.NativeFunction)return(...n)=>o.fn(e,{preparsed:!0,arguments:n});if(o instanceof t.SizzleFunction)return(...n)=>{if(n.length!==o.paramCount)throw new Error("Invalid parameters");return o.fn(...n)};throw new Error("Invalid Parameter")}function u(n){if(n instanceof e)return n.toArray();if(t.isArray(n))return n;throw new Error("Invalid Parameter")}n.functions.array=function(r,e){return n.standardFunction(r,e,(function(n,r,e){t.pcCheck(e,1,2);const o=t.toNumber(e[0]);if(isNaN(o)||!1===t.isInteger(o))throw new Error("Invalid Parameter");const i=t.defaultUndefined(e[1],null),u=new Array(o);return u.fill(i),u}))},n.functions.front=function(r,e){return n.standardFunction(r,e,(function(n,r,e){if(t.pcCheck(e,1,1),t.isImmutableArray(e[0])){if(e[0].length()<=0)throw new Error("Array is empty");return e[0].get(0)}if(t.isArray(e[0])){if(e[0].length<=0)throw new Error("Array is empty");return e[0][0]}throw new Error("Invalid Parameter")}))},n.functions.back=function(r,e){return n.standardFunction(r,e,(function(n,r,e){if(t.pcCheck(e,1,1),t.isImmutableArray(e[0])){if(e[0].length()<=0)throw new Error("Array is empty");return e[0].get(e[0].length()-1)}if(t.isArray(e[0])){if(e[0].length<=0)throw new Error("Array is empty");return e[0][e[0].length-1]}throw new Error("Invalid Parameter")}))},n.functions.push=function(r,e){return n.standardFunction(r,e,(function(n,r,e){if(t.pcCheck(e,1,2),t.isArray(e[0]))return e[0][e[0].length]=e[1],e[0].length;throw new Error("Invalid Parameter")}))},n.functions.pop=function(r,e){return n.standardFunction(r,e,(function(n,r,e){if(t.pcCheck(e,1,1),t.isArray(e[0])){if(e[0].length<=0)throw new Error("Array is empty");const n=e[0][e[0].length-1];return e[0].length=e[0].length-1,n}throw new Error("Invalid Parameter")}))},n.functions.erase=function(r,e){return n.standardFunction(r,e,(function(n,r,e){if(t.pcCheck(e,2,2),t.isArray(e[0])){let n=t.toNumber(e[1]);if(isNaN(n)||!1===t.isInteger(n))throw new Error("Invalid Parameter");const r=e[0];if(r.length<=0)throw new Error("Array is empty");if(n<0&&(n=r.length+n),n<0)throw new Error("Element not found");if(n>=r.length)throw new Error("Index is greater than array");return r.splice(n,1),t.voidOperation}throw new Error("Invalid Parameter")}))},n.functions.insert=function(r,e){return n.standardFunction(r,e,(function(n,r,e){if(t.pcCheck(e,3,3),t.isArray(e[0])){const n=t.toNumber(e[1]);if(isNaN(n)||!1===t.isInteger(n))throw new Error("Invalid Parameter");const r=e[2],o=e[0];if(n>o.length)throw new Error("Index is greater than array");if(n<0&&n<-1*o.length)throw new Error("Index is greater than array");return n===o.length?(o[n]=r,t.voidOperation):(o.splice(n,0,r),t.voidOperation)}throw new Error("Invalid Parameter")}))},n.functions.resize=function(r,e){return n.standardFunction(r,e,(function(n,r,e){if(t.pcCheck(e,2,3),t.isArray(e[0])){const n=t.toNumber(e[1]);if(isNaN(n)||!1===t.isInteger(n))throw new Error("Invalid Parameter");if(n<0)throw new Error("Size cannot be negative");const r=t.defaultUndefined(e[2],null),o=e[0];if(o.length>=n)return o.length=n,t.voidOperation;const i=o.length;o.length=n;for(let e=i;e<o.length;e++)o[e]=r;return t.voidOperation}throw new Error("Invalid Parameter")}))},n.functions.includes=function(r,e){return n.standardFunction(r,e,(function(n,r,e){if(t.pcCheck(e,2,2),t.isArray(e[0])){const n=e[1];return e[0].findIndex((r=>t.equalityTest(r,n)))>-1}if(t.isImmutableArray(e[0])){const n=e[1];return e[0].toArray().findIndex((r=>t.equalityTest(r,n)))>-1}throw new Error("Invalid Parameter")}))},n.functions.slice=function(r,e){return n.standardFunction(r,e,(function(n,r,e){if(t.pcCheck(e,1,3),t.isArray(e[0])){const n=t.toNumber(t.defaultUndefined(e[1],0)),r=t.toNumber(t.defaultUndefined(e[2],e[0].length));if(isNaN(n)||!1===t.isInteger(n))throw new Error("Invalid Parameter");if(isNaN(r)||!1===t.isInteger(r))throw new Error("Invalid Parameter");return e[0].slice(n,r)}if(t.isImmutableArray(e[0])){const n=e[0],r=t.toNumber(t.defaultUndefined(e[1],0)),o=t.toNumber(t.defaultUndefined(e[2],n.length()));if(isNaN(r)||!1===t.isInteger(r))throw new Error("Invalid Parameter");if(isNaN(o)||!1===t.isInteger(o))throw new Error("Invalid Parameter");return n.toArray().slice(r,o)}throw new Error("Invalid Parameter")}))},n.functions.splice=function(r,e){return n.standardFunction(r,e,(function(n,r,e){const o=[];for(let i=0;i<e.length;i++)t.isArray(e[i])?o.push(...e[i]):t.isImmutableArray(e[i])?o.push(...e[i].toArray()):o.push(e[i]);return o}))},"sync"===n.mode&&(n.functions.any=function(r,e){return n.standardFunction(r,e,(function(n,e,o){t.pcCheck(o,2,2);const s=i(r,o[1]),c=u(o[0]);for(const r of c){const n=s(r);if(t.isBoolean(n)&&!0===n)return!0}return!1}))},n.functions.all=function(r,e){return n.standardFunction(r,e,(function(n,e,o){t.pcCheck(o,2,2);const s=i(r,o[1]),c=u(o[0]);for(const r of c){if(!0!==s(r))return!1}return!0}))},n.functions.none=function(r,e){return n.standardFunction(r,e,(function(n,e,o){t.pcCheck(o,2,2);const s=i(r,o[1]),c=u(o[0]);for(const r of c){if(!0===s(r))return!1}return!0}))},n.functions.reduce=function(r,e){return n.standardFunction(r,e,(function(n,e,o){t.pcCheck(o,2,3);const s=i(r,o[1]),c=u(o[0]);return 2===o.length?0===c.length?null:c.reduce(((n,r)=>{const e=s(n,r);return n=void 0!==e&&e!==t.voidOperation?e:null})):c.reduce(((n,r)=>{const e=s(n,r);return n=void 0!==e&&e!==t.voidOperation?e:null}),o[2])}))},n.functions.map=function(r,e){return n.standardFunction(r,e,(function(n,e,o){t.pcCheck(o,2,2);const s=i(r,o[1]),c=u(o[0]),a=[];for(const r of c){const n=s(r);void 0!==n&&n!==t.voidOperation?a.push(n):a.push(null)}return a}))},n.functions.filter=function(r,e){return n.standardFunction(r,e,(function(n,e,o){t.pcCheck(o,2,2);const s=i(r,o[1]),c=u(o[0]),a=[];for(const r of c){!0===s(r)&&a.push(r)}return a}))}),"async"===n.mode&&(n.functions.any=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,s){t.pcCheck(s,2,2);const c=i(r,s[1]),a=u(s[0]),l={result:!1};return a.reduce(((n,r,e)=>n.then((n=>{if(e>0&&!0===n&&(l.result=!0),!0===l.result)return o.resolve(!0);const t=c(r);return o.isPromiseLike(t)?t:o.resolve(t)}))),Promise.resolve(!1)).then((n=>(!0===n&&(l.result=!0),l.result)))}))},n.functions.all=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,s){t.pcCheck(s,2,2);const c=i(r,s[1]),a=u(s[0]),l={result:!0};return a.reduce(((n,r,e)=>n.then((n=>{if(e>0&&!0!==n&&(l.result=!1),!1===l.result)return o.resolve(!1);const t=c(r);return o.isPromiseLike(t)?t:o.resolve(t)}))),Promise.resolve(!0)).then((n=>(!0!==n&&(l.result=!1),l.result)))}))},n.functions.none=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,s){t.pcCheck(s,2,2);const c=i(r,s[1]),a=u(s[0]),l={result:!0};return a.reduce(((n,r,e)=>n.then((n=>{if(e>0&&!0===n&&(l.result=!1),!1===l.result)return o.resolve(!0);const t=c(r);return o.isPromiseLike(t)?t:o.resolve(t)}))),Promise.resolve(!1)).then((n=>(!0===n&&(l.result=!1),l.result)))}))},n.functions.filter=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,s){t.pcCheck(s,2,2);const c=i(r,s[1]),a=u(s[0]),l=[];return a.reduce(((n,r,e)=>n.then((n=>{e>0&&!0===n&&l.push(a[e-1]);const t=c(r);return o.isPromiseLike(t)?t:o.resolve(t)}))),Promise.resolve(!1)).then((n=>(!0===n&&a.length>0&&l.push(a[a.length-1]),l)))}))},n.functions.reduce=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,s){t.pcCheck(s,2,3);const c=i(r,s[1]),a=u(s[0]);let l=null;if(s.length>2){const n=t.defaultUndefined(s[2],null);l=a.reduce(((n,r)=>n.then((n=>{void 0!==n&&n!==t.voidOperation||(n=null);const e=c(n,r);return o.isPromiseLike(e)?e:o.resolve(e)}))),Promise.resolve(n))}else{if(0===a.length)return null;l=a.reduce(((n,r,e)=>{if(e<=1){const e=c(n,r);return o.isPromiseLike(e)?e:o.resolve(e)}return n.then((n=>{void 0!==n&&n!==t.voidOperation||(n=null);const e=c(n,r);return o.isPromiseLike(e)?e:o.resolve(e)}))}))}return l.then((n=>void 0!==n&&n!==t.voidOperation?n:null))}))},n.functions.map=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,s){t.pcCheck(s,2,2);const c=i(r,s[1]),a=u(s[0]),l={result:[]};return a.reduce(((n,r,e)=>n.then((n=>{e>0&&(void 0!==n&&n!==t.voidOperation?l.result.push(n):l.result.push(null));const i=c(r);return o.isPromiseLike(i)?i:o.resolve(i)}))),Promise.resolve()).then((n=>(a.length>0&&(void 0!==n&&n!==t.voidOperation?l.result.push(n):l.result.push(null)),l.result)))}))})}const u=Object.freeze(Object.defineProperty({__proto__:null,registerFunctions:i},Symbol.toStringTag,{value:"Module"}));n.ArrayFunctions=u,n.registerFunctions=i}));
