/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","./_rollupPluginBabelHelpers","../arcade/executionError","../arcade/ImmutableArray","./languageUtils","../core/promiseUtils"],(function(n,r,t,e,o,i){"use strict";function u(n){function u(n,r,i){if(n instanceof e)return n.toArray();if(o.isArray(n))return n;throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,i)}function c(n,r){const t=n.length,e=Math.floor(t/2);return 0===t?[]:1===t?[n[0]]:a(c(n.slice(0,e),r),c(n.slice(e,t),r),r)}function a(n,r,t){const e=[];for(;n.length>0||r.length>0;)if(n.length>0&&r.length>0){let o=t(n[0],r[0]);isNaN(o)&&(o=0),o<=0?(e.push(n[0]),n=n.slice(1)):(e.push(r[0]),r=r.slice(1))}else n.length>0?(e.push(n[0]),n=n.slice(1)):r.length>0&&(e.push(r[0]),r=r.slice(1));return e}function s(n,r){return l.apply(this,arguments)}function l(){return(l=r._asyncToGenerator((function*(n,r){const t=n.length,e=Math.floor(t/2);if(0===t)return[];if(1===t)return[n[0]];const o=[yield s(n.slice(0,e),r),yield s(n.slice(e,t),r)];return d(o[0],o[1],r,[])}))).apply(this,arguments)}function d(n,r,t,e){return f.apply(this,arguments)}function f(){return(f=r._asyncToGenerator((function*(n,r,t,e){const o=e;if(!(n.length>0||r.length>0))return e;if(n.length>0&&r.length>0){let i=yield t(n[0],r[0]);return isNaN(i)&&(i=1),i<=0?(o.push(n[0]),n=n.slice(1)):(o.push(r[0]),r=r.slice(1)),d(n,r,t,e)}return n.length>0?(o.push(n[0]),d(n=n.slice(1),r,t,e)):r.length>0?(o.push(r[0]),d(n,r=r.slice(1),t,e)):void 0}))).apply(this,arguments)}function h(n,r,e,i){o.pcCheck(e,1,2,n,r);let u=e[0];if(o.isImmutableArray(u)&&(u=u.toArray()),!1===o.isArray(u))throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,r);if(e.length>1){if(!1===o.isFunctionParameter(e[1]))throw new t.ArcadeExecutionError(n,t.ExecutionErrorCodes.InvalidParameter,r);let a=u;const l=e[1].createFunction(n);return i?s(a,l):(a=c(a,((n,r)=>l(n,r))),a)}let a=u;if(0===a.length)return[];const l={};for(let t=0;t<a.length;t++){const n=o.getType(a[t]);""!==n&&(l[n]=!0)}if(!0===l.Array||!0===l.Dictionary||!0===l.Feature||!0===l.Point||!0===l.Polygon||!0===l.Polyline||!0===l.Multipoint||!0===l.Extent||!0===l.Function)return a.slice(0);let d=0,f="";for(const t in l)d++,f=t;return a=d>1||"String"===f?c(a,((n,r)=>{if(null==n||n===o.voidOperation)return null==r||r===o.voidOperation?0:1;if(null==r||r===o.voidOperation)return-1;const t=o.toString(n),e=o.toString(r);return t<e?-1:t===e?0:1})):"Number"===f?c(a,((n,r)=>n-r)):"Boolean"===f?c(a,((n,r)=>n===r?0:r?-1:1)):"Date"===f?c(a,((n,r)=>r-n)):a.slice(0),a}n.functions.array=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{o.pcCheck(u,1,2,r,e);const c=o.toNumber(u[0]);if(isNaN(c)||!1===o.isInteger(c))throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e);const a=o.defaultUndefined(u[1],null),s=new Array(c);return s.fill(a),s}))},n.functions.front=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,1,1,r,e),o.isImmutableArray(u[0])){if(u[0].length()<=0)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);return u[0].get(0)}if(o.isArray(u[0])){if(u[0].length<=0)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);return u[0][0]}throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.back=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,1,1,r,e),o.isImmutableArray(u[0])){if(u[0].length()<=0)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);return u[0].get(u[0].length()-1)}if(o.isArray(u[0])){if(u[0].length<=0)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);return u[0][u[0].length-1]}throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.push=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,1,2,r,e),o.isArray(u[0]))return u[0][u[0].length]=u[1],u[0].length;throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.pop=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,1,1,r,e),o.isArray(u[0])){if(u[0].length<=0)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);const n=u[0][u[0].length-1];return u[0].length=u[0].length-1,n}throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.erase=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,2,2,r,e),o.isArray(u[0])){let n=o.toNumber(u[1]);if(isNaN(n)||!1===o.isInteger(n))throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e);const i=u[0];if(i.length<=0)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);if(n<0&&(n=i.length+n),n<0)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);if(n>=i.length)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);return i.splice(n,1),o.voidOperation}throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.insert=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,3,3,r,e),o.isArray(u[0])){const n=o.toNumber(u[1]);if(isNaN(n)||!1===o.isInteger(n))throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e);const i=u[2],c=u[0];if(n>c.length)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);if(n<0&&n<-1*c.length)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.OutOfBounds,e);return n===c.length?(c[n]=i,o.voidOperation):(c.splice(n,0,i),o.voidOperation)}throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.resize=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,2,3,r,e),o.isArray(u[0])){const n=o.toNumber(u[1]);if(isNaN(n)||!1===o.isInteger(n))throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e);if(n<0)throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e);const i=o.defaultUndefined(u[2],null),c=u[0];if(c.length>=n)return c.length=n,o.voidOperation;const a=c.length;c.length=n;for(let r=a;r<c.length;r++)c[r]=i;return o.voidOperation}throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.includes=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,2,2,r,e),o.isArray(u[0])){const n=u[1];return u[0].findIndex((r=>o.equalityTest(r,n)))>-1}if(o.isImmutableArray(u[0])){const n=u[1];return u[0].toArray().findIndex((r=>o.equalityTest(r,n)))>-1}throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.slice=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,1,3,r,e),o.isArray(u[0])){const n=o.toNumber(o.defaultUndefined(u[1],0)),i=o.toNumber(o.defaultUndefined(u[2],u[0].length));if(isNaN(n)||!1===o.isInteger(n))throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e);if(isNaN(i)||!1===o.isInteger(i))throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e);return u[0].slice(n,i)}if(o.isImmutableArray(u[0])){const n=u[0],i=o.toNumber(o.defaultUndefined(u[1],0)),c=o.toNumber(o.defaultUndefined(u[2],n.length()));if(isNaN(i)||!1===o.isInteger(i))throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e);if(isNaN(c)||!1===o.isInteger(c))throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e);return n.toArray().slice(i,c)}throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.splice=function(r,t){return n.standardFunction(r,t,((n,r,t)=>{const e=[];for(let i=0;i<t.length;i++)o.isArray(t[i])?e.push(...t[i]):o.isImmutableArray(t[i])?e.push(...t[i].toArray()):e.push(t[i]);return e}))},n.functions.top=function(r,e){return n.standardFunction(r,e,((n,i,u)=>{if(o.pcCheck(u,2,2,r,e),o.isArray(u[0]))return o.toNumber(u[1])>=u[0].length?u[0].slice(0):u[0].slice(0,o.toNumber(u[1]));if(o.isImmutableArray(u[0]))return o.toNumber(u[1])>=u[0].length()?u[0].slice(0):u[0].slice(0,o.toNumber(u[1]));throw new t.ArcadeExecutionError(r,t.ExecutionErrorCodes.InvalidParameter,e)}))},n.functions.first=function(r,t){return n.standardFunction(r,t,((n,e,i)=>(o.pcCheck(i,1,1,r,t),o.isArray(i[0])?0===i[0].length?null:i[0][0]:o.isImmutableArray(i[0])?0===i[0].length()?null:i[0].get(0):null)))},"sync"===n.mode&&(n.functions.sort=function(r,t){return n.standardFunction(r,t,((n,e,o)=>h(r,t,o,!1)))},n.functions.any=function(r,t){return n.standardFunction(r,t,((n,e,i)=>{o.pcCheck(i,2,2,r,t);const c=i[1].createFunction(r),a=u(i[0],r,t);for(const r of a){const n=c(r);if(o.isBoolean(n)&&!0===n)return!0}return!1}))},n.functions.all=function(r,t){return n.standardFunction(r,t,((n,e,i)=>{o.pcCheck(i,2,2,r,t);const c=i[1].createFunction(r),a=u(i[0],r,t);for(const r of a){if(!0!==c(r))return!1}return!0}))},n.functions.none=function(r,t){return n.standardFunction(r,t,((n,e,i)=>{o.pcCheck(i,2,2,r,t);const c=i[1].createFunction(r),a=u(i[0],r,t);for(const r of a){if(!0===c(r))return!1}return!0}))},n.functions.reduce=function(r,t){return n.standardFunction(r,t,((n,e,i)=>{o.pcCheck(i,2,3,r,t);const c=i[1].createFunction(r),a=u(i[0],r,t);return 2===i.length?0===a.length?null:a.reduce(((n,r)=>{const t=c(n,r);return n=void 0!==t&&t!==o.voidOperation?t:null})):a.reduce(((n,r)=>{const t=c(n,r);return n=void 0!==t&&t!==o.voidOperation?t:null}),i[2])}))},n.functions.map=function(r,t){return n.standardFunction(r,t,((n,e,i)=>{o.pcCheck(i,2,2,r,t);const c=i[1].createFunction(r),a=u(i[0],r,t),s=[];for(const r of a){const n=c(r);void 0!==n&&n!==o.voidOperation?s.push(n):s.push(null)}return s}))},n.functions.filter=function(r,t){return n.standardFunction(r,t,((n,e,i)=>{o.pcCheck(i,2,2,r,t);const c=i[1].createFunction(r),a=u(i[0],r,t),s=[];for(const r of a){!0===c(r)&&s.push(r)}return s}))}),"async"===n.mode&&(n.functions.sort=function(r,t){return n.standardFunctionAsync(r,t,((n,e,o)=>h(r,t,o,!0)))},n.functions.any=function(t,e){return n.standardFunctionAsync(t,e,function(){var n=r._asyncToGenerator((function*(n,r,c){o.pcCheck(c,2,2,t,e);const a=c[1].createFunction(t),s=u(c[0],t,e);for(const t of s){const n=yield a(t);let r=null;if(r=i.isPromiseLike(r)?yield n:n,o.isBoolean(r)&&!0===r)return!0}return!1}));return function(r,t,e){return n.apply(this,arguments)}}())},n.functions.all=function(t,e){return n.standardFunctionAsync(t,e,function(){var n=r._asyncToGenerator((function*(n,r,c){o.pcCheck(c,2,2,t,e);const a=c[1].createFunction(t),s=u(c[0],t,e);for(const t of s){const n=yield a(t);let r=null;if(r=i.isPromiseLike(r)?yield n:n,!0!==r)return!1}return!0}));return function(r,t,e){return n.apply(this,arguments)}}())},n.functions.none=function(t,e){return n.standardFunctionAsync(t,e,function(){var n=r._asyncToGenerator((function*(n,r,c){o.pcCheck(c,2,2,t,e);const a=c[1].createFunction(t),s=u(c[0],t,e);for(const t of s){const n=yield a(t);let r=null;if(r=i.isPromiseLike(r)?yield n:n,!0===r)return!1}return!0}));return function(r,t,e){return n.apply(this,arguments)}}())},n.functions.filter=function(t,e){return n.standardFunctionAsync(t,e,function(){var n=r._asyncToGenerator((function*(n,r,c){o.pcCheck(c,2,2,t,e);const a=c[1].createFunction(t),s=u(c[0],t,e),l=[];for(const t of s){const n=yield a(t);let r=null;r=i.isPromiseLike(r)?yield n:n,!0===r&&l.push(t)}return l}));return function(r,t,e){return n.apply(this,arguments)}}())},n.functions.reduce=function(t,e){return n.standardFunctionAsync(t,e,((n,i,c)=>{o.pcCheck(c,2,3,t,e);const a=c[1].createFunction(t),s=u(c[0],t,e);let l=null;if(c.length>2){const n=o.defaultUndefined(c[2],null);l=s.reduce(function(){var n=r._asyncToGenerator((function*(n,r){let t=yield n;return void 0!==t&&t!==o.voidOperation||(t=null),a(t,r)}));return function(r,t){return n.apply(this,arguments)}}(),Promise.resolve(n))}else{if(0===s.length)return null;l=s.reduce(function(){var n=r._asyncToGenerator((function*(n,r,t){if(t<=1)return a(n,r);let e=yield n;return void 0!==e&&e!==o.voidOperation||(e=null),a(e,r)}));return function(r,t,e){return n.apply(this,arguments)}}())}return l.then((n=>void 0!==n&&n!==o.voidOperation?n:null))}))},n.functions.map=function(t,e){return n.standardFunctionAsync(t,e,function(){var n=r._asyncToGenerator((function*(n,r,c){o.pcCheck(c,2,2,t,e);const a=c[1].createFunction(t),s=u(c[0],t,e),l=[];for(const t of s){const n=yield a(t);let r=null;r=i.isPromiseLike(r)?yield n:n,void 0!==r&&r!==o.voidOperation?l.push(r):l.push(null)}return l}));return function(r,t,e){return n.apply(this,arguments)}}())})}const c=Object.freeze(Object.defineProperty({__proto__:null,registerFunctions:u},Symbol.toStringTag,{value:"Module"}));n.ArrayFunctions=c,n.registerFunctions=u}));
