// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.39/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/array","dojo/_base/kernel","dojo/has","dojo/query","dojo/dom","dojo/dom-construct","dojo/dom-class","dojo/dom-geometry","../kernel","./_TouchBase","../Evented"],(function(t,e,i,s,n,h,o,l,d,c,a,r,_,u){var f=t(u,{declaredClass:"esri.dijit.Gallery",container:null,_items:[],_currentIndex:0,_left:0,_offset:10,_slideDiv:null,_thumbnailStyle:"default",_focusedIndex:null,_selectedIndex:-1,_slideStep:1,_showTitle:!0,_eventMap:{select:["item"],focus:["item"]},constructor:function(t,s){var n,h,o;for(this.container=l.byId(s),this._touchBase=_(this.container,null),this._slideDiv=d.create("div",{class:"slideContainer"},this.container,"first"),this.events=[i.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler),i.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler),i.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler),i.connect(this._touchBase,"onclick",this,this._onClickHandler)],this._resizeHandle=i.connect(window,"onorientationchange",e.hitch(this,this._onResizeHandler)),this._items=t.items,t.thumbnailStyle&&"small"==t.thumbnailStyle?(this._thumbnailStyle="small",this._offset=4,this._slideStep=3,this._thumbnailWidth=100):(this._thumbnailStyle="default",this._offset=10,this._slideStep=1,this._thumbnailWidth=200),0==t.showTitle&&(this._showTitle=!1),this.container.setAttribute(document.all?"className":"class","esriMobileGallery"),n=0;n<this._items.length;n++){var r,u,f,m;r=d.create("div",{class:"thumbnailcontainer"},this._slideDiv),(m=d.create("img",{class:"thumbnail",src:this._items[n].thumbnailUrl},r))._index=n,m._item=this._items[n],u=d.create("div",{class:"title",innerHTML:this._items[n].title},r),f=d.create("div",{class:"title"},r),"small"==this._thumbnailStyle&&(c.add(r,"small"),c.add(m,"small"),c.add(u,"small"),c.add(f,"small"),c.add(this._slideDiv,"small")),this._showTitle||(u.style.display="none"),o=a.getContentBox(r).h,h||(h=o),o>h&&(h=o)}for(n=0;n<this._slideDiv.childNodes.length;n++)a.getContentBox(this._slideDiv.childNodes[n],{h:h});this._thumbnailWidth=a.getContentBox(this._slideDiv.childNodes[0]).w,this._slideDiv.style.width=this._items.length*(this._thumbnailWidth+this._offset)+"px",window.orientation&&(90!=window.orientation&&-90!=window.orientation||c.add(this.container,"galleryLandscape")),this._calculateSlideStep()},startup:function(){this._focusedIndex=0,this.onFocus(this._items[this._focusedIndex])},destroy:function(){s.forEach(this.events,i.disconnect),i.disconnect(this._resizeHandle),this._touchBase=null,n.query("img",this.container).forEach((function(t){t._index=null,t._item=null,d.destroy(t),t=null})),this._items=null,d.destroy(this._slideDiv),d.destroy(this.container),this.container=this._slideDiv=null},setFocus:function(t){var e,i;if(t)for(e=0,i=this._items.length;e<i;e++)this._items[e]==t&&(this._setFocus(e),this.onFocus(this._items[this._focusedIndex]))},select:function(t){var e,i;if(t)for(e=0,i=this._items.length;e<i;e++)if(this._items[e]==t){-1!=this._selectedIndex&&this.onUnSelect(this._items[this._selectedIndex]),this._select(e),this.onSelect(this._items[this._selectedIndex]);break}},getFocusedItem:function(){return this._items[this._focusedIndex]},getSelectedItem:function(){return this._items[this._selectedIndex]},next:function(){this._next(),this._startTransition(),this.onFocus(this._items[this._currentIndex])},previous:function(){this._previous(),this._startTransition(),this.onFocus(this._items[this._currentIndex])},getTitleNode:function(t){var e,i;if(t)for(e=0,i=this._items.length;e<i;e++)if(this._items[e]==t)return this._slideDiv.childNodes[e].childNodes[1]},getInfoNode:function(t){var e,i;if(t)for(e=0,i=this._items.length;e<i;e++)if(this._items[e]==t)return this._slideDiv.childNodes[e].childNodes[2]},showTitle:function(t){var e,i;if(t)for(e=0,i=this._items.length;e<i;e++)if(this._items[e]==t){this._slideDiv.childNodes[e].childNodes[1].style.display="block";break}},hideTitle:function(t){var e,i;if(t)for(e=0,i=this._items.length;e<i;e++)if(this._items[e]==t){this._slideDiv.childNodes[e].childNodes[1].style.display="none";break}},onFocus:function(t){},onSelect:function(t){},onUnSelect:function(t){},_onClickHandler:function(t){if(t.target instanceof HTMLImageElement){var e=t.target._index;-1!=this._selectedIndex&&this.onUnSelect(this._items[this._selectedIndex]),this._select(e),this.onSelect(this._items[this._selectedIndex])}},_onTouchStartHandler:function(t){this._moveDirection=null,this._left=this._currentIndex*(-this._thumbnailWidth-this._offset),this._slideDiv.style.WebkitTransitionDuration="0s"},_onTouchMoveHandler:function(t){if(this._moveDirection||(Math.abs(t.curY)>Math.abs(t.curX)?this._moveDirection="vertical":this._moveDirection="horizontal"),"vertical"!=this._moveDirection){if("horizontal"==this._moveDirection){this._touchBase._preventDefault||(this._touchBase._preventDefault=!0);var e=this._left+t.curX;this._slideDiv.style.webkitTransform="translate3d("+e+"px, 0, 0)"}}else 0==!this._touchBase._preventDefault&&(this._touchBase._preventDefault=!1)},_onTouchEndHandler:function(t){var e=this._currentIndex;this._slideDiv.style.WebkitTransitionDuration="0.5s","left"==t.swipeDirection?this._next():"right"==t.swipeDirection&&this._previous(),this._left=this._currentIndex*(-this._thumbnailWidth-this._offset),this._slideDiv.style.webkitTransform="translate3d("+this._left+"px, 0, 0)",e!=this._currentIndex&&this.onFocus(this._items[this._currentIndex])},_onResizeHandler:function(t){switch(window.orientation){case 0:c.remove(this.container,"galleryLandscape");break;case 90:case-90:c.add(this.container,"galleryLandscape")}this._calculateSlideStep()},_startTransition:function(){this._slideDiv.style.WebkitTransitionDuration="0.5s",this._left=this._currentIndex*(-this._thumbnailWidth-this._offset),this._slideDiv.style.webkitTransform="translate3d("+this._left+"px, 0, 0)"},_markUnSelected:function(t){c.remove(t,"selected"),c.remove(t.parentNode,"selected"),c.remove(t.parentNode.childNodes[1],"selected"),c.remove(t.parentNode.childNodes[2],"selected")},_markSelected:function(t){c.add(t,"selected"),c.add(t.parentNode,"selected"),c.add(t.parentNode.childNodes[1],"selected"),c.add(t.parentNode.childNodes[2],"selected")},_next:function(){this._currentIndex+this._slideStep<this._items.length&&(this._currentIndex+=this._slideStep,this._focusedIndex=this._currentIndex)},_previous:function(){this._currentIndex-this._slideStep>=0&&(this._currentIndex-=this._slideStep),this._focusedIndex=this._currentIndex},_setFocus:function(t){this._focusedIndex=t,this._currentIndex=Math.floor(t/this._slideStep)*this._slideStep,this._startTransition()},_select:function(t){-1!=this._selectedIndex&&this._markUnSelected(this._slideDiv.childNodes[this._selectedIndex].childNodes[0]),this._selectedIndex=t,this._markSelected(this._slideDiv.childNodes[this._selectedIndex].childNodes[0])},_calculateSlideStep:function(){var t=a.getContentBox(this.container),e=Math.floor((t.w+this._offset)/(this._thumbnailWidth+this._offset));if(e>=1){var i=t.w-(this._thumbnailWidth+this._offset)*e;this._slideDiv.style.marginLeft=i>0?Math.floor(i/2)+"px":"0px",this._slideStep=e}else this._slideStep=1;-1!=this._selectedIndex?this._setFocus(this._selectedIndex):this._setFocus(this._focusedIndex)}});return h("extend-esri")&&e.setObject("dijit.Gallery",f,r),f}));