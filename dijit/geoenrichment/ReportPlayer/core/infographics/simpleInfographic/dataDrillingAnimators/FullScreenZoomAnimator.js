// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.29/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/keys","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dijit/Destroyable","esri/dijit/geoenrichment/utils/DelayUtil","esri/dijit/geoenrichment/utils/DeviceUtil","esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/MouseUtil","esri/dijit/geoenrichment/utils/animation/AnimationUtil","esri/dijit/geoenrichment/utils/mobile/GesturesUtil","../../../../ReportPlayerState"],function(e,i,t,n,o,d,l,r,a,s,c,u,m,h,D,g){return e(a,{ddZoomScreen:null,currentTriggerButtonBox:null,ddZoomScreenClass:null,closeZoomedDDWhenClickedOutside:!0,closeZoomedDDOnEsc:!0,zIndex:null,dataDrillingViewDiv:null,domNode:null,constructor:function(e){i.mixin(this,e),c.isMobileDevice()&&D.preventDefaultOverflow(this.dataDrillingViewDiv)},play:function(e,i,t){function n(e){e?(u.show(a.dataDrillingViewDiv),a.dataDrillingViewDiv.parentNode!==document.body&&document.body.appendChild(a.dataDrillingViewDiv),a.zIndex&&r.set(a.dataDrillingViewDiv,"zIndex",a.zIndex)):(a.dataDrillingViewDiv.parentNode===document.body&&document.body.removeChild(a.dataDrillingViewDiv),u.hide(a.dataDrillingViewDiv))}function d(){n(e),a._setZoomScreen(e,!1),a._setCloseHandlers(e),g.isViewingDataDrillingZoom=e,o[e?"add":"remove"](a.domNode,"isDrillingData"),o.remove(a.domNode,"isShowingAnimation")}var a=this;if(this.currentTriggerButtonBox=t?l.position(t):this.currentTriggerButtonBox,o.add(this.domNode,"isShowingAnimation"),o.add(this.dataDrillingViewDiv,"isZoomAnimation"),!i)return void d();n(!0);var c=this.getDataDrillingPanelDimensions();r.set(this.dataDrillingViewDiv,{width:c.w+"px",height:c.h+"px"}),this._setZoomScreen(e,!0);var m;if(e){var D=c.scale||1;m=h.animateResize({duration:200,domNode:this.dataDrillingViewDiv,fromBox:c.animateFromCenter?{x:0,y:0,w:document.body.clientWidth,h:document.body.clientHeight}:this.currentTriggerButtonBox,startScaleX:.7*D,startScaleY:.7*D,fromOffset:{x:"c",y:"c"},toBox:{x:(document.body.clientWidth-c.w*D)/2,y:(document.body.clientHeight-c.h*D)/2+(c.yOffset||0),w:c.w,h:c.h},endScaleX:c.scale,endScaleY:c.scale,onEnd:d}),h.animateFadeIn({domNode:a.dataDrillingViewDiv,duration:100})}else m=h.animateResize({duration:200,domNode:this.dataDrillingViewDiv,toBox:this.currentTriggerButtonBox,startScaleX:c.scale,startScaleY:c.scale,endScaleX:.7*(c.scale||1),endScaleY:.7*(c.scale||1),toOffset:{x:"c",y:"c"},onEnd:d}),h.animateFadeOut({domNode:this.dataDrillingViewDiv,duration:100});return m&&m.then(function(){return s.delay(100)})},_setZoomScreen:function(e,i){function t(){n.ddZoomScreen&&d.destroy(n.ddZoomScreen),n.ddZoomScreen=null}var n=this;e!==!!this.ddZoomScreen&&(e?(this.ddZoomScreen=d.create("div",{class:"esriGEAbsoluteStretched simpleInfographic_dataDrillingViewDivScreen"+(c.isMobileDevice()?" mobile":"")},this.dataDrillingViewDiv,"before"),c.isMobileDevice()&&D.preventDefaultOverflow(this.ddZoomScreen),this.zIndex&&r.set(this.ddZoomScreen,"zIndex",this.zIndex),this.ddZoomScreenClass&&o.add(this.ddZoomScreen,this.ddZoomScreenClass),i&&h.animateFadeIn({domNode:this.ddZoomScreen,duration:100})):i?h.animateFadeOut({domNode:this.ddZoomScreen,duration:100,onEnd:t}):t())},_clickOutsideHandler:null,_keyboardHandler:null,_setCloseHandlers:function(e){var i=this;this._clickOutsideHandler&&this._clickOutsideHandler.remove(),this._clickOutsideHandler=null,this._keyboardHandler&&this._keyboardHandler.remove(),this._keyboardHandler=null,e&&(this.closeZoomedDDWhenClickedOutside&&(this._clickOutsideHandler=t(document.body,c.press,function(){g.isViewingDynamicSettings||m.isMouseOver(i.dataDrillingViewDiv,{checkAllChildren:!0})||i.isMouseOver()||i.onExitDataDrilling()}),this.own(this._clickOutsideHandler)),this.closeZoomedDDOnEsc&&(this._keyboardHandler=t(document.body,"keyup",function(e){e.keyCode===n.ESCAPE&&i.onExitDataDrilling()}),this.own(this._keyboardHandler)))},isMouseOver:function(){return!1},getDataDrillingPanelDimensions:function(){return null},onExitDataDrilling:function(){}})});