// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.38/esri/copyright.txt for details.

define(["dojo/_base/lang","./ThemeCalculator","./cleanUp/_ChartJsonCleaner","./ChartTypes","./ChartDataLabelsTypes","../legends/ChartLegendPlacements","../legends/ChartLegendTypes","./plots/supportClasses/GaugeLabelPlacements","./plots/supportClasses/WaffleLabelPlacements","./plots/supportClasses/WaffleDirections","../../../dataProvider/supportClasses/data/AreaDataUtil","esri/dijit/geoenrichment/utils/ObjectUtil","dojo/i18n!esri/nls/jsapi"],(function(e,l,i,t,o,a,r,n,s,d,u,g,c){c=c.geoenrichment.dijit.ReportPlayer.ChartContainer;var p={getDefaultChartSettings:function(i){i=i||{};var u=e.mixin({},i.font),g=e.mixin({},i.font);return delete g.fontSize,{isChart:!0,type:i.chartType||t.COLUMN,isMultiFeatureChart:!!i.isMultiFeatureChart,seriesItems:i.seriesItems||[],visualProperties:{width:i.width||400,height:i.height||300,marginTop:void 0,marginRight:void 0,marginBottom:void 0,marginLeft:void 0,backgroundColor:void 0,backgroundColorOpacity:1,plotAreaOutlineColor:void 0,plotAreaOutlineOpacity:1,plotAreaOutlineThickness:0,plotAreaOutlineStyle:void 0,backgroundImageData:void 0,panelBackgroundColor:void 0,title:{text:"",align:"center",style:e.mixin({},u),verticalShift:0},xAxis:{show:!0,hideLine:!1,showTicks:!0,ticksInside:!1,hideLabels:!1,title:"",titleStyle:e.mixin({},u),style:e.mixin({},u),labelsAngle:0,lineColor:void 0,gridLines:!1,gridLinesCentered:!1,gridLinesColor:void 0,gridLinesOpacity:1,gridLinesThickness:.5,gridLinesStyle:void 0,gridStripes:!1,gridStripesColor:void 0,gridStripesColorAlt:void 0,placement:void 0},yAxis:{show:!0,hideLine:!1,showTicks:!0,ticksInside:!1,hideLabels:!1,title:"",titleStyle:e.mixin({},u),style:e.mixin({},u),labelsAngle:0,lineColor:void 0,gridLines:!1,gridLinesCentered:!1,gridLinesColor:void 0,gridLinesOpacity:1,gridLinesThickness:.5,gridLinesStyle:void 0,gridStripes:!1,gridStripesColor:void 0,gridStripesColorAlt:void 0,hideBaseLine:!1,baseLineColor:void 0,baseLineOpacity:1,baseLineThickness:.5,baseLineStyle:void 0,baseLineValue:0,showPercentSymbol:!1,showCurrencySymbol:!1,showSymbolForAllLabels:!1,showValuesAsWeightsInSeries:!1,placement:void 0,nonZeroInclusive:!1},legend:{type:r.SERIES,series:{placement:a.NONE,placementOffset:10,hasBorder:!0,labelParts:"Label",style:e.mixin({},u),symbol:void 0,hideOthers:!1,showComparison:!1},minMax:{placement:a.NONE,placementOffset:3,titleStyle:e.mixin({},g),minVariableLabelStyle:e.mixin({},g),maxVariableLabelStyle:e.mixin({},g)}},isStacked:!1,showValuesAsWeightInStack:!1,columnThickness:l.DEFAULT_COLUMN_THICKNESS,columnBarGap:void 0,columnBarOpacity:1,renderColumnBarsInOppositeDirections:!1,showColumnBarBackground:!1,columnBarBackgroundColor:void 0,columnBarBackgroundOpacity:1,fillOpacity:1,outlineColor:void 0,outlineOpacity:1,outlineThickness:0,outlineStyle:void 0,lineThickness:l.DEFAULT_LINE_THICKNESS,lineOpacity:1,fillLineMarkers:!1,lineMarkersFillOpacity:1,fillLineArea:!1,lineAreaOpacity:1,donutHolePercent:l.DEFAULT_DONUT_HOLE_PERCENT,donutGap:l.DEFAULT_DONUT_GAP,donutArcPercent:l.DEFAULT_DONUT_ARC_PERCENT,gaugeHolePercent:l.DEFAULT_GAUGE_HOLE_PERCENT,gaugeRangeMin:void 0,gaugeRangeMax:void 0,gaugeGap:l.DEFAULT_GAUGE_GAP,gaugeStartAngle:l.DEFAULT_GAUGE_ANGLE,gaugeArcPercent:l.DEFAULT_GAUGE_ARC_PERCENT,gaugeLabelPlacement:n.INSIDE,gaugeLabelStyle:e.mixin({},g),gaugeShowArrow:!1,gaugeArrowLineColor:void 0,gaugeArrowFillColor:void 0,gaugeConditionalStylingOthers:!1,gaugeConditionalStylingLabel:!1,gaugeShowFromToLabels:!1,gaugeFromLabelStyle:e.mixin({},g),gaugeToLabelStyle:e.mixin({},g),waffleDirection:d.DOWN_RIGHT,waffleFlowStyle:void 0,waffleShowWholePictures:!1,waffleStretchIconsToFill:!1,waffleRangeMin:void 0,waffleRangeMax:void 0,waffleLabelPlacement:s.BOTTOM,waffleLabelOffset:10,waffleHideValue:!1,waffleHideLabel:!1,waffleShowLabelAbove:!1,waffleValueStyle:e.mixin({},g),waffleLabelStyle:e.mixin({},g),waffleColumnSpace:5,waffleRowSpace:5,waffleConditionalStylingOthers:!1,waffleConditionalStylingValue:!1,waffleConditionalStylingLabel:!1,waffleNumIcons:void 0,waffleNumRows:void 0,waffleNumColumns:void 0,ringBackgroundColor:void 0,ringBackgroundOpacity:1,columnBarShowWholePictures:!1,dataLabels:o.NONE,dataLabelsShowLabelUnder:!1,dataLabelsDecimals:0,dataLabelsStyle:e.mixin({},u),dataLabelsLabelStyle:null,dataLabelsAltColor:null,dataLabelsEnableAltColor:!1,dataLabelsInside:!1,dataLabelsStackedInColumns:!1,dataLabelsHorizontalAlign:"center",dataLabelsVerticalAlign:"middle",dataLabelsShowValuePercentSymbol:!1,dataLabelsShowValueCurrencySymbol:!1,dataLabelsAngle:0,dataLabelsMaxWidth:void 0,chartIcons:void 0,floatingIcons:void 0,showAxisIcons:!1,showChartIcons:!1,floatingTexts:void 0,sorting:void 0,filter:void 0,tooltip:p.getChartDefaultTooltip(),conditionalStyling:void 0,noTableView:!1},comparisonInfo:void 0,dataDrillingPanelInfo:void 0}},getChartDefaultTooltip:function(){return{title:!0,value:!0,style:{},linkStyle:{}}},getChartEmptyTooltip:function(){return{style:{},linkStyle:{}}},provideDefaultValueForMissing:function(e,l){l=l||{};var i=p.getDefaultChartSettings(l);return e.visualProperties.tooltip=e.visualProperties.tooltip||p.getChartDefaultTooltip(),g.populateObject(e,i),e},cleanUpJson:function(e,l,t){return i.cleanUpJson(e,l,t)},supportsVisualProperty:function(e,l,t){return i.supportsProperty(l,"visualProperties."+e,t)},supportsProperty:function(e,l,t){return i.supportsProperty(l,e,t)},enrichVisualPropertiesWithThemeSettings:function(l,i){var t=e.clone(l);return t.backgroundColor=t.backgroundColor||i.backgroundColor,t.outlineColor=t.outlineColor||i.outlineColor,t.outlineStyle=t.outlineStyle||i.outlineStyle,g.populateObject(t.title.style,i.titleStyle),t.xAxis&&(g.populateObject(t.xAxis.style,i.xAxis.axisStyle),g.populateObject(t.xAxis.titleStyle,i.xAxis.titleStyle),t.xAxis.lineColor=t.xAxis.lineColor||i.xAxis.lineColor,t.xAxis.gridLinesColor=t.xAxis.gridLinesColor||i.xAxis.gridLinesColor,t.xAxis.gridLinesStyle=t.xAxis.gridLinesStyle||i.xAxis.gridLinesStyle,t.xAxis.gridStripesColor=t.xAxis.gridStripesColor||i.xAxis.gridStripesColor,t.xAxis.gridStripesColorAlt=t.xAxis.gridStripesColorAlt||i.xAxis.gridStripesColorAlt,g.populateObject(t.yAxis.style,i.yAxis.axisStyle),g.populateObject(t.yAxis.titleStyle,i.yAxis.titleStyle),t.yAxis.lineColor=t.yAxis.lineColor||i.yAxis.lineColor,t.yAxis.gridLinesColor=t.yAxis.gridLinesColor||i.yAxis.gridLinesColor,t.yAxis.gridLinesStyle=t.yAxis.gridLinesStyle||i.yAxis.gridLinesStyle,t.yAxis.gridStripesColor=t.yAxis.gridStripesColor||i.yAxis.gridStripesColor,t.yAxis.gridStripesColorAlt=t.yAxis.gridStripesColorAlt||i.yAxis.gridStripesColorAlt,t.yAxis.baseLineColor=t.yAxis.baseLineColor||i.yAxis.baseLineColor,t.yAxis.baseLineStyle=t.yAxis.baseLineStyle||i.yAxis.baseLineStyle),t.legend&&(g.populateObject(t.legend.series.style,i.legendStyle),t.legend.minMax&&(g.populateObject(t.legend.minMax.titleStyle,i.minMaxLegend.titleStyle),g.populateObject(t.legend.minMax.minVariableLabelStyle,i.minMaxLegend.minVariableLabelStyle),g.populateObject(t.legend.minMax.maxVariableLabelStyle,i.minMaxLegend.maxVariableLabelStyle))),g.populateObject(t.dataLabelsStyle,i.dataLabelsStyle),g.populateObject(t.dataLabelsLabelStyle,t.dataLabelsStyle),t.dataLabelsAltColor=t.dataLabelsAltColor||i.dataLabelsAltColor,g.populateObject(t.gaugeLabelStyle,i.gauge&&i.gauge.dataLabelStyle),t.gaugeArrowLineColor=t.gaugeArrowLineColor||i.gauge&&i.gauge.arrowIndicator.lineColor,t.gaugeArrowFillColor=t.gaugeArrowFillColor||i.gauge&&i.gauge.arrowIndicator.backgroundColor,g.populateObject(t.waffleValueStyle,i.waffle&&i.waffle.dataValueStyle),g.populateObject(t.waffleLabelStyle,i.waffle&&i.waffle.dataLabelStyle),t.ringBackgroundColor=t.ringBackgroundColor||i.ring&&i.ring.ringBackground&&i.ring.ringBackground.backgroundColor,t.columnBarBackgroundColor=t.columnBarBackgroundColor||i.columnBarBackground&&i.columnBarBackground.backgroundColor,t.tooltip=t.tooltip||p.getChartDefaultTooltip(),t.tooltip.style=t.tooltip.style||{},t.tooltip.linkStyle=t.tooltip.linkStyle||{},g.populateObject(t.tooltip.style,i.tooltip&&i.tooltip),g.populateObject(t.tooltip.linkStyle,i.tooltip&&i.tooltipLink),t},createChartPoint:function(e,i,t,o,a){var r={color:t||"",label:void 0!==i?i||"":e&&e.alias,fieldInfo:e,iconFieldInfo:o,captionFieldInfo:a};return t&&l.setPointColor(r,t),r},getGaugeOthersPoint:function(e){return{label:e&&e.label||c.gaugeOthers,color:e&&e.color}},getWaffleOthersPoint:function(e){return{label:e&&e.label||c.waffleOthers,color:e&&e.color,iconFieldInfo:e&&e.iconFieldInfo}}},y=[{headers:{data:{AREA_DESC:c.oneMile}}},{headers:{data:{AREA_DESC:c.threeMiles}}},{headers:{data:{AREA_DESC:c.fiveMiles}}}];return p.getSeriesItemsForMultiFeatureChart=function(l,i,o){if(!i)return i;o=o||y;var a=i[0];return t.isLineLike(l)?o.map((function(l,i){var t=e.clone(a);t.points.forEach((function(e){delete e.color}));var o=a.multiFeatureLineStyles&&a.multiFeatureLineStyles[i];o&&(t.color=o.color,t.lineThickness=o.lineThickness,t.lineStyle=o.lineStyle,t.lineMarker=o.lineMarker,t.lineMarkerColor=o.lineMarkerColor,t.lineMarkerSize=o.lineMarkerSize,t.lineMarkerFillColor=o.lineMarkerFillColor,t.fillColor=o.fillColor);var r=u.getAreaDataValue({areaDataObject:l,fieldName:"headers.AREA_DESC"})||"";return t.points.forEach((function(e){e.areaName=r,e.originalSeriesName=a.label})),t.label=r,t})):a.points.map((function(e){return{label:e.label,points:o.map((function(l){var i=u.getAreaDataValue({areaDataObject:l,fieldName:"headers.AREA_DESC"})||"",t=p.createChartPoint(e.fieldInfo,i,e.color||a.color);return t.areaName=i,t.originalSeriesName=a.label,t}))}}))},p.getOriginalPointByMultiFeatureIndexes=function(e,l,i){return e[0].points[l]},p.transposeSeriesItems=function(l){return l.length?l[0].points.map((function(i,t){return{label:i.label,points:l.map((function(l){var i=e.clone(l.points[t]);return i.label=l.label,i}))}})):[]},p}));