// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.42/esri/copyright.txt for details.

define(["dojo/on","dojo/dom-style","esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/KeyboardUtil","esri/dijit/geoenrichment/utils/MathUtil","esri/dijit/geoenrichment/utils/MouseUtil"],(function(e,t,o,n,r,a){var c={ALL_DIRECTIONS:["e","se","s","sw","w","nw","n","ne"],trackSizer:function(t){var o,i=c._getSizerInfo(t),s={x:a.getCursorPosition().clientX,y:a.getCursorPosition().clientY,w:t.w,h:t.h},h={x:0,y:0},l=e(document.body,"mousemove",(function(e){e.preventDefault(),e.stopPropagation(),t.applyShift(-h.x,-h.y),h={x:0,y:0};var l,u,d=a.getCursorPosition().clientX,p=a.getCursorPosition().clientY,g=[0,0,d-s.x,p-s.y],f=0,V=0,y=t.supportsCtrlShift&&e.shiftKey,x=t.supportsCtrlShift&&n.isCtrl(e);if(i.changeWVector&&i.changeHVector&&y){var v=r.normalizeVector(i.vector),P=r.calcDotProduct(g,v);g=[0,0,v[2]*P,v[3]*P]}if(t.onSnapped(null),i.changeWVector){var w=r.calcAngleBetweenVectors(i.changeWVector,g);f=r.calcVectorLength(g)*Math.cos(w)||0}if(i.changeHVector){var b=r.calcAngleBetweenVectors(i.changeHVector,g);V=r.calcVectorLength(g)*Math.cos(b)||0}f=f&&c._restricVectorDelta(f,i.changeWVector,t),V=V&&c._restricVectorDelta(V,i.changeHVector,t),l=f&&c._snapVectorDelta(f,i.calcBoundaryWVectors(s.w,s.h,V),t),u=V&&c._snapVectorDelta(V,i.calcBoundaryHVectors(s.w,s.h,f),t),l&&l.canSnap&&u&&u.canSnap&&(l.canSnap=Math.abs(l.minDelta)<=Math.abs(u.minDelta),u.canSnap=Math.abs(u.minDelta)<Math.abs(l.minDelta)),l&&l.canSnap&&(t.onSnapped(l.snapInfo),f=l.snappedDelta),u&&u.canSnap&&(t.onSnapped(u.snapInfo),V=u.snappedDelta),x&&(f*=2,V*=2),o||!f&&!V||(t.onPreChange(),o=!0);var D=f||V,m=s.w+f,L=s.h+V;if(D){if(x)h={x:s.w/2-m/2,y:s.h/2-L/2};else{var S=i.calcOppositePoint(m,L);h={x:i.oppositePoint[0]-S[0],y:i.oppositePoint[1]-S[1]}}t.applyShift(h.x,h.y),t.setWidth(m),t.setHeight(L)}D&&t.onSizeChanged(e),f&&t.onWidthChanged(e),V&&t.onHeightChanged(e)})),u=e.once(document.body,"mouseup, click",(function(e){e.preventDefault(),e.stopPropagation(),u.remove(),l.remove(),t.onEnd()}))},_getSizerInfo:function(e){var t=e.dir,o=e.angle;function n(e,n){var a,c,i,s,h,l;switch(t){case"e":a=[e,n/2],c=i=[0,n/2],h=[[0,0,e,0],[0,n,e,n]];break;case"se":a=[e,n],c=[0,0],i=[0,n],s=[e,0],h=[[0,n,e,n],[0,0,e,0]],l=[[e,0,e,n],[0,0,0,n]];break;case"s":a=[e/2,n],c=s=[e/2,0],l=[[0,0,0,n],[e,0,e,n]];break;case"sw":a=[0,n],c=[e,0],i=[e,n],s=[0,0],h=[[e,n,0,n],[e,0,0,0]],l=[[0,0,0,n],[e,0,e,n]];break;case"w":a=[0,n/2],c=i=[e,n/2],h=[[e,0,0,0],[e,n,0,n]];break;case"nw":a=[0,0],c=[e,n],i=[e,0],s=[0,n],h=[[e,0,0,0],[e,n,0,n]],l=[[0,n,0,0],[e,n,e,0]];break;case"n":a=[e/2,0],c=s=[e/2,n],l=[[0,n,0,0],[e,n,e,0]];break;case"ne":a=[e,0],c=[0,n],i=[0,0],s=[e,n],h=[[0,0,e,0],[0,n,e,n]],l=[[e,n,e,0],[0,n,0,0]]}var u=[e/2,n/2];return a=r.rotatePointAroundPoint(u,a,o),c=r.rotatePointAroundPoint(u,c,o),i=i&&r.rotatePointAroundPoint(u,i,o),s=s&&r.rotatePointAroundPoint(u,s,o),{sizerPoint:a,oppositePoint:c,vector:[c[0],c[1],a[0],a[1]],changeWVector:i&&[i[0],i[1],a[0],a[1]],changeHVector:s&&[s[0],s[1],a[0],a[1]],boundaryWVectors:h=h&&h.map((function(e){return r.rotateVectorAroundPoint(e,u,o)})),boundaryHVectors:l=l&&l.map((function(e){return r.rotateVectorAroundPoint(e,u,o)}))}}var a=n(e.w,e.h);return{oppositePoint:a.oppositePoint,vector:a.vector,changeWVector:a.changeWVector,changeHVector:a.changeHVector,calcOppositePoint:function(e,t){return n(e,t).oppositePoint},calcBoundaryWVectors:function(e,t,o){var c=n(e,t).boundaryWVectors;if(o){var i=r.addLengthToVector(r.normalizeVector(a.changeHVector),o);c[0]=r.addPointToVector(c[0],[i[2],i[3]])}return c},calcBoundaryHVectors:function(e,t,o){var c=n(e,t).boundaryHVectors;if(o){var i=r.addLengthToVector(r.normalizeVector(a.changeWVector),o);c[0]=r.addPointToVector(c[0],[i[2],i[3]])}return c}}},_restricVectorDelta:function(e,t,o){var n=o.getRestrictNodeBox();if(!n||e<=0||!e)return e;var a=o.getThisBox(),c=r.calcVectorLength(t);t=r.addLengthToVector(t,e),t=r.addPointToVector(t,[a.x,a.y]);var i=[n.x,n.y,n.x,n.y+n.h],s=[n.x+n.w,n.y,n.x+n.w,n.y+n.h],h=[n.x,n.y,n.x+n.w,n.y],l=[n.x,n.y+n.h,n.x+n.w,n.y+n.h],u=r.intersect2Lines(t,i),d=r.intersect2Lines(t,s),p=r.intersect2Lines(t,h),g=r.intersect2Lines(t,l),f=r.calcVectorLength(t),V=t;return[u,d,p,g].forEach((function(e){if(e){var o=[t[0],t[1],e[0],e[1]];if(r.calcDotProduct(t,o)>0){var n=r.calcVectorLength(o);n<f&&(f=n,V=o)}}})),V=r.subtractPointFromVector(V,[a.x,a.y]),r.calcVectorLength(V)-c},_snapVectorDelta:function(e,t,o){var n=o.getSnapNodeBoxes()||[];if(!n.length||!e)return e;var a,c,i,s=o.getThisBox(),h=1/0;return t.forEach((function(t){t=r.addLengthToVector(t,e),t=r.addPointToVector(t,[s.x,s.y]);var o=r.calcVectorLength(t);n.forEach((function(e){var n=e.box,s=e.tolerance;[[n.x,n.y,n.x,n.y+n.h],[n.x+n.w,n.y,n.x+n.w,n.y+n.h],[n.x+n.w/2,n.y,n.x+n.w/2,n.y+n.h],[n.x,n.y,n.x+n.w,n.y],[n.x,n.y+n.h,n.x+n.w,n.y+n.h],[n.x,n.y+n.h/2,n.x+n.w,n.y+n.h/2]].forEach((function(e,l){var u=r.intersect2Lines(t,e);if(u){var d=[t[0],t[1],u[0],u[1]];if(r.calcDotProduct(t,d)>0){var p=r.calcVectorLength(d)-o;Math.abs(p)<=Math.abs(h)&&Math.abs(p)<=s&&(h=p,a=e,i=n,c=l>2)}}}))}))})),{canSnap:!!a,snapInfo:a&&{elementBox:o.getThisFullBox(),snapBox:i,to:c?a[1]:a[0],isHorizontal:c},minDelta:a?h:NaN,snappedDelta:a?e+h:NaN}},positionSizer:function(e){var n,a,i=e.sizer;i.style.display="block";var s=e.dir,h=e.w,l=e.h,u=e.angle,d=i.offsetWidth||12,p=i.offsetHeight||12;switch(s){case"e":n=h,a=l/2;break;case"se":n=h,a=l;break;case"s":n=h/2,a=l;break;case"sw":n=0,a=l;break;case"w":n=0,a=l/2;break;case"nw":n=0,a=0;break;case"n":n=h/2,a=0;break;case"ne":n=h,a=0}if(u){var g=r.rotatePointAroundPoint({x:h/2,y:l/2},{x:n,y:a},u);n=g.x,a=g.y}n-=d/2,a-=p/2,t.set(i,{left:n+"px",top:a+"px",cursor:c._getCursorDirection(s,u)+"-resize"}),"w"!==s&&"e"!==s||o[l<30?"hide":"show"](i),"s"!==s&&"n"!==s||o[h<30?"hide":"show"](i),i.style.display=""},_getCursorDirection:function(e,t){if(!t)return e;t=r.angleTo0_360Range(t);var o=Math.round(t/45),n=c.ALL_DIRECTIONS.indexOf(e)+o;return c.ALL_DIRECTIONS[n%c.ALL_DIRECTIONS.length]}};return c}));