// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.33/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/store/Memory","esri/dijit/geoenrichment/promise/all","esri/dijit/geoenrichment/when","dojo/dom-class","dojo/dom-construct","dijit/_WidgetBase","dijit/_TemplatedMixin","./_GridChartViewSupport","./_GridHighlightSupport","./_GridFilterSupport","./_GridSortSupport","./_ResizableColumnsSupport","./_DataDrillingSupport","esri/dijit/geoenrichment/ReportPlayer/config","./valueField/ValueField","./valueField/_ResizableField","./coreUtils/GridBackgroundForegroundUtil","./coreUtils/GridFloatingTablesUtil","./coreUtils/GridBorderUtil","./coreUtils/GridDataUtil","./coreUtils/GridQueryUtil","./coreUtils/GridLayoutCalculator","./coreUtils/GridCellRenderer","./coreUtils/GridStyleUtil","./coreUtils/GridLayoutSizer","./coreUtils/_GridDebugUtil","../sections/SectionTypes","esri/dijit/geoenrichment/utils/ArrayUtil","esri/dijit/geoenrichment/utils/DeviceUtil","esri/dijit/geoenrichment/utils/async/AsyncQueue","esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/ViewModes","esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/tableJson/TableJsonUtil","dojo/text!../templates/AdjustableGrid.html"],(function(e,t,i,n,o,s,l,r,a,d,h,u,c,g,f,_,b,C,m,S,F,p,y,w,T,R,v,M,x,k,A,V,D,P,N){var W={defaultRowHeight:15.33,rowMinHeight:3,columnMinWidth:3,defaultChartRowHeight:150},G={rowMinHeight:3,columnMinWidth:3},B=e([b,C]);return e([r,a,d,h,u,c,g,f],{isGrid:!0,templateString:N,viewModel:null,theme:null,columns:null,store:null,backgroundSectionJson:null,foregroundSectionJson:null,enableBackgroundForeground:!1,forceCreateFloatingTables:!1,backgroundFloatingTablesSectionJson:null,foregroundFloatingTablesSectionJson:null,isFloatingTable:!1,isBackgroundFloatingTable:!1,layoutDefaults:null,stickToRight:!1,looseResize:!1,keepGridWidthWhenResized:!1,keepGridHeightWhenResized:!1,hasResizableColumns:!1,disableResizableColumnsAutoDetection:!1,fitParentWhenResized:!1,parentWidget:null,parentElementInPageInfo:null,viewPortContainer:null,parentGrid:null,reportContainerPageNode:null,isReportContainerPageGrid:!1,getPreviewValueFunction:null,currentFeatureIndex:null,currentFeatureAttributes:null,fixedViewMode:null,fixedSpecificViewMode:null,fieldCellClass:null,enableAsyncRendering:!1,asyncBatchSize:1,enableNumberAnimation:!1,applyThemeStyle:!0,inheritThemeBackground:!0,previewModeBorderLineStyle:null,editModeBorderLineStyle:null,renderBordersFromTheme:!1,noThemeBorderLineStyle:null,hasRealBorders:!1,trimTextIfOverflows:!1,autoDetectUrl:!1,shouldStayWithinParent:!0,infographicBenchmarkController:null,backgroundSection:null,foregroundSection:null,backgroundFloatingTablesSection:null,foregroundFloatingTablesSection:null,_cellRenderer:null,_fieldCells:null,_dynamicBindings:null,_isBeingResizedFlag:!1,_renderCellsQueue:null,_renderCellsContentQueue:null,postCreate:function(){this.inherited(arguments),this.layoutDefaults=t.mixin({},W,this.layoutDefaults),_.isPlayerOnServer&&(this.enableAsyncRendering=!1,this.hasResizableColumns=!1,this.disableResizableColumnsAutoDetection=!0)},refresh:function(e){if(this.domNode)return!this.isReportContainerPageGrid&&!this.hasResizableColumns&&this.viewModel.dynamicReportInfo&&this.columns.length>1&&this.store.data.length>2&&!this.disableResizableColumnsAutoDetection&&(this.keepGridWidthWhenResized=!0,this.hasResizableColumns=!0,this.fitParentWhenResized=!0,this.layoutDefaults.columnMinWidth=30),A.isMobileDevice()&&(this.hasResizableColumns=!1),s[this.hasResizableColumns?"add":"remove"](this.domNode,"hasResizableColumns"),w.markAsDirty(this),this._doRefresh(e),this.getRenderPromise()},_doRefresh:function(e){if(this.mainNode){this.store&&(this._destroyTableContent(),l.empty(this.mainNode),M.refreshStart(this),this._recoverOriginalData(),this._applyFilterToStoreData(),this._applySortingToStoreData(),this.isEmptyTable()?l.create("div",{class:"adjustableGrid_emptyRow"},this.mainNode):(s.remove(this.domNode,"esriGEAdjustableGridSingleCell esriGEAdjustableGridMultiCell"),s.add(this.domNode,this.isSingleCelledTable()?"esriGEAdjustableGridSingleCell "+(P.getTableSubtype(this)||""):"esriGEAdjustableGridMultiCell"),w.recalcRows(this),void 0===(e=e||{}).stickToRight&&(e.stickToRight=this.stickToRight),w.recalcColumns(this,e),w.autoSnapLayout(this),this._createCellsFromStoreData(),this._renderCells(),w.positionCells(this)),this.refreshBackground(),this._renderBackgroundFloatingTables(),this._renderForegroundFloatingTables(),this.refreshForeground(),this._buildSortControls(),M.refreshEnd(this))}},_originalData:null,_getOriginalData:function(){return this._originalData||this.store.data},_getSavedOriginalData:function(){return this._originalData},_saveOriginalData:function(){this._originalData||(this.store.data=t.clone(this.store.data),this._originalData=t.clone(this.store.data))},_recoverOriginalData:function(){this._originalData&&(this.store.data=t.clone(this._originalData))},_createCellsFromStoreData:function(){var e=this;this.enableAsyncRendering&&(this._renderCellsQueue=new V({onFinished:function(){e.onRendered()}})),this.store.data.forEach((function(t){e.columns.forEach((function(i,n){if(!(t.excludedIndexHorizontal&&t.excludedIndexHorizontal[n]||t.excludedIndexVertical&&t.excludedIndexVertical[n])){var o=i.index+(p.getDataColumnSpan(t,i.field)||1)===e.columns.length,s=t.index+(p.getDataRowSpan(t,i.field)||1)===e.store.data.length;e._createField(t,i,o,s)}}))}))},_getFieldClass:function(e){return this.hasResizableColumns&&0===e.gridData.index?B:b},_createField:function(e,t,i,n){var o="adjustableGridField field-"+t.field+(i?" lastInRow":"")+(n?" lastRow":""),s={viewModel:this.viewModel,fieldStyle:R.combineCellStyle(this,e,t),defaultBorderStyle:this._getDefaultBorderStyle(e,t,i,n),class:o,fieldCellClass:this.fieldCellClass,trimTextIfOverflows:this.trimTextIfOverflows,autoDetectUrl:this.autoDetectUrl,rowId:e.id,columnId:t.id,parentGrid:this,parentWidget:this,uniqueId:e.id+t.id,gridData:e,column:t,isLastInRow:i,isLastInColumn:n};this.hasResizableColumns&&(s.allowVerticalResizing=!1,s.showColumnRowSizeTooltip=!0);var l=this._doCreateFieldFromParams(s,e,t);return this.hasResizableColumns&&this._populateFieldForResizableColumns(l,e,t),l.domNode.style.position="absolute",this._fieldCells.push(l),l},_getDefaultBorderStyle:function(e,t,i,n){return F.getBorderStyle(this,e,t,i,n)},getRenderPromise:function(){var e=[];return e.push(this._renderCellsQueue&&this._renderCellsQueue.getPromise()),e.push(this._renderCellsContentQueue&&this._renderCellsContentQueue.getPromise()),this.getFieldCells().forEach((function(t){t.content&&t.content.getRenderPromise&&e.push(t.content.getRenderPromise())})),["backgroundSection","backgroundFloatingTablesSection","foregroundFloatingTablesSection","foregroundSection"].forEach((function(t){this[t]&&e.push(this[t].getRenderPromise())}),this),n(e)},isBeingRendered:function(){return this._renderCellsQueue&&!this._renderCellsQueue.isFinished()||this._renderCellsContentQueue&&!this._renderCellsContentQueue.isFinished()},_doCreateFieldFromParams:function(e,t,i){return new(this._getFieldClass(e))(e).placeAt(this.mainNode)},_renderCells:function(){var e=this;function t(t){e._renderFieldContent(t),e._postCreateFieldCell(t),e._updateCellViewMode(t)}this._renderCellsQueue?k.splitArrayToBunches(this._fieldCells,this.asyncBatchSize).forEach((function(i){e._renderCellsQueue.add((function(){i.forEach(t)}),{delayAfter:0})})):(this._fieldCells.forEach(t),this.onRendered())},_renderFieldContent:function(e){this._trySetupDataDrilling(e),this._preRenderFieldCell(e);var t=this._getCellRenderer().renderCellContent(e);t&&t.then&&(this._renderCellsContentQueue=this._renderCellsContentQueue||new V({onFinished:function(){}}),this._renderCellsContentQueue.add(t)),this._configureRenderedCellContentSpecificStyles(e),this._postRenderFieldCell(e)},_preRenderFieldCell:function(e){},_postRenderFieldCell:function(e){},_getCellRenderer:function(){return this._cellRenderer||(this._cellRenderer=new T),this._cellRenderer},_configureRenderedCellContentSpecificStyles:function(e){s[p.isNumericVariableFieldCell(e)?"add":"remove"](e.domNode,"hasNumericVariableFieldInfo"),s[p.isStringVariableFieldCell(e)?"add":"remove"](e.domNode,"hasStringVariableFieldInfo"),s[p.getConditionalFormatting(e)?"add":"remove"](e.domNode,"hasConditionalFormatting")},_postCreateFieldCell:function(e){},refreshBackground:function(){this.enableBackgroundForeground&&(this.backgroundSection&&this.backgroundSection.destroy(),this.backgroundSection=m.renderBackground(this,this.backgroundSectionJson,this._getBackgroundSectionCreationParams()))},_getBackgroundSectionCreationParams:function(){return this._getContentLoadingParams()},refreshForeground:function(){this.enableBackgroundForeground&&(this.foregroundSection&&this.foregroundSection.destroy(),this.foregroundSection=m.renderForeground(this,this.foregroundSectionJson,this._getForegroundSectionCreationParams()))},_getForegroundSectionCreationParams:function(){return this._getContentLoadingParams()},_renderBackgroundFloatingTables:function(){this.backgroundFloatingTablesSection&&this.backgroundFloatingTablesSection.destroy(),this.forceCreateFloatingTables&&(this.backgroundFloatingTablesSectionJson=this.backgroundFloatingTablesSectionJson||{type:x.TABLE_BACKGROUND_FLOATING_PANELS,stack:[]}),this.backgroundFloatingTablesSection=S.renderFloatingTables(this,this.backgroundFloatingTablesSectionJson,this._getFloatingTablesSectionParams(!0),!0),this._postProcessFloatingTablesSection(this.backgroundFloatingTablesSection,!0)},_renderForegroundFloatingTables:function(){this.foregroundFloatingTablesSection&&this.foregroundFloatingTablesSection.destroy(),this.forceCreateFloatingTables&&(this.foregroundFloatingTablesSectionJson=this.foregroundFloatingTablesSectionJson||{type:x.TABLE_FOREGROUND_FLOATING_PANELS,stack:[]}),this.foregroundFloatingTablesSection=S.renderFloatingTables(this,this.foregroundFloatingTablesSectionJson,this._getFloatingTablesSectionParams(!1),!1),this._postProcessFloatingTablesSection(this.foregroundFloatingTablesSection,!1)},_getFloatingTablesSectionParams:function(e){var i=this,n={tableClass:function(e){var t=P.getTableSubtype(e);return t?"outerFloatingAdjustableGrid floatingTableSimpleElement "+t:"outerFloatingAdjustableGrid floatingTableComplexElement"},tableParams:t.mixin({isFloatingTable:!0,isBackgroundFloatingTable:e,parentGrid:this,inheritThemeBackground:this.inheritThemeBackground,applyThemeStyle:this.applyThemeStyle,layoutDefaults:t.mixin({},this.layoutDefaults,G),_preRenderFieldCell:function(e){i._preRenderFieldCell(e)},_postCreateFieldCell:function(e){i._postCreateFieldCell(e)}},this._getContentLoadingParams())};return this._addFloatingTablesSectionCreationParams(n,e),n},_addFloatingTablesSectionCreationParams:function(e,t){return e},_postProcessFloatingTablesSection:function(e,t){},getVisualState:function(){var e={type:"table",cells:this.getFieldCells().map((function(e){return e.content&&e.content.getVisualState&&e.content.getVisualState()}))},i=this.getSorting(this);i&&(e.sorting=i);var n=this._filterRanges?t.clone(this._filterRanges):null;return n&&(e.filterRanges=n),this.presetFilter&&(e.hasPresetFilter=!0),this.backgroundSection&&(e.backgroundSection=this.backgroundSection.getVisualState()),this.backgroundFloatingTablesSection&&(e.backgroundFloatingTablesSection=this.backgroundFloatingTablesSection.getVisualState()),this.foregroundFloatingTablesSection&&(e.foregroundFloatingTablesSection=this.foregroundFloatingTablesSection.getVisualState()),this.foregroundSection&&(e.foregroundSection=this.foregroundSection.getVisualState()),this._chartViewInfo&&(e.isChartView=!0,e.chartViewInfo=t.clone(this._chartViewInfo)),e},setVisualState:function(e){var t=this;if(e)return o(this.getRenderPromise(),(function(){var i=[];return e.cells&&t.getFieldCells().forEach((function(t,n){t.content&&t.content.setVisualState&&i.push(t.content.setVisualState(e.cells[n]))})),["backgroundSection","backgroundFloatingTablesSection","foregroundFloatingTablesSection","foregroundSection"].forEach((function(n){e[n]&&t[n]&&i.push(t[n].setVisualState(e[n]))})),n(i).then((function(){return o(e.filterRanges&&t.setFilterRanges(e.filterRanges),(function(){return o(e.sorting&&t.setSorting(e.sorting),(function(){return e.isChartView&&t.tableToChart(e.chartViewInfo)}))}))}))}))},_setCellWidth:function(e,t){w.adjustColumnWidth(this,e.gridData,e.column,t),w.positionCells(this)},_setCellHeight:function(e,t){w.adjustRowHeight(this,e.gridData,e.column.field,t),w.positionCells(this)},setCellWidth:function(e,t){this._setCellWidth(e,t)},setCellHeight:function(e,t){this._setCellHeight(e,t)},_maxWidth:500,_width:500,_height:0,_spaceAfter:0,_maxHeight:0,_left:0,_top:0,_alternatingStyle:null,_opacity:1,_fixedCellsOpacity:1,getMaxHeight:function(e){return this._maxHeight},setMaxHeight:function(e){this._maxHeight=e},getHeight:function(e,t){return this._height+(!1!==t?this._top:0)+(e&&this._spaceAfter||0)},getMaxWidth:function(){return this._maxWidth},setMaxWidth:function(e,t){var i=0;if(t&&t.preserveRightOffset){w.recalcGridWidth(this);var n=this.getAllowedWidth();i=(n-this._width)/n}this._maxWidth=e,t&&t.resizeToFitAllowedWidth&&this.resizeToFitAllowedWidth({rightOffsetWeight:t.preserveRightOffset?i:0})},getLeft:function(){return this._left},getTop:function(){return this._top},setSpaceAfter:function(e){this._spaceAfter=e},getAllowedWidth:function(){return this._maxWidth-this._left},getAllowedWidthFromParent:function(){return this.shouldStayWithinParent?this.domNode.parentNode.clientWidth-this._left:1e6},getTableBox:function(){var e=this.getSettings().style;return{l:e.left,t:e.top,w:e.width,h:this.getHeight(!1,!1)}},resizeToFitAllowedWidth:function(e){this.isEmptyTable()||v.resizeToFitAllowedWidth(this,e)},resizeToFitWidth:function(e){this.isEmptyTable()||v.resizeToFitWidth(this,e)},resizeToFitHeight:function(e,t){if(!this.isEmptyTable()){if(!1!==t)e-=this._top;v.resizeToFitHeight(this,e)}},scaleProportionallyWithinParent:function(e){v.scaleProportionallyWithinParent(this,e)},collapseContent:function(){this.getFieldCells({floatingCells:!0}).forEach((function(e){e.content&&e.content.collapseContent&&e.content.collapseContent()}))},hasHiddenContent:function(){return this._checkNeedResizeRowHeightToShowCellsContent(!1)},resizeRowHeightToShowCellsContent:function(){return this._checkNeedResizeRowHeightToShowCellsContent(!0),this.getRenderPromise()},_checkNeedResizeRowHeightToShowCellsContent:function(e){var t,i=this;return this.getFieldCells({floatingCells:!0}).forEach((function(n){if(n.content&&n.content.getPreferredHeight){var o=n.content.getPreferredHeight();o>n.getHeight()&&(e&&i._setCellHeight(n,o+10),t=!0)}})),t},_tableAttributes:null,_scaleToFitWidth:void 0,_scaleToFitHeight:void 0,setSettings:function(e){var t,i=this._left,n=this.isMultiFeatureTable();if(this.columns.forEach((function(e){e.style&&"number"==typeof e.style.width&&(e._wasBeforeRecalc=!0)})),e.style){void 0!==e.style.left&&this.setPosition(e.style.left),void 0!==e.style.top&&this.setPosition(void 0,e.style.top),void 0!==e.style.spaceAfter&&(this._spaceAfter=e.style.spaceAfter),e.style.width&&(this._width=e.style.width),e.style.alternatingStyle&&(this._alternatingStyle=e.style.alternatingStyle),this.setOpacity(e.style);var o=this._width;this._width=Math.min(this._width,this.getAllowedWidth()),this._width===o&&i===this._left||(t=!0)}e.attributes&&(this._adjustColumnsForSettings(e)&&(t=!0),this._tableAttributes=e.attributes,this._tableAttributes.rowCount&&this._tableAttributes.rowCount!==this.store.data.length&&this._adjustRowsForSettings(e),delete this._tableAttributes.rowCount,delete this._tableAttributes.columnCount),void 0!==e.scaleToFitWidth&&(this._scaleToFitWidth=e.scaleToFitWidth),void 0!==e.scaleToFitHeight&&(this._scaleToFitHeight=e.scaleToFitHeight),this._tableAttributes=this._tableAttributes||{};var s=[];if(this.columns.forEach((function(e){e._wasBeforeRecalc&&s.push(e),delete e._wasBeforeRecalc})),!n&&this.isMultiFeatureTable())for(var l=this.columns.length-1;l>=this.getNumFixedColumns();l--){var r=this.columns[l],a=s.indexOf(r);-1!==a&&s.splice(a,1)}(e.viewMode||e.specificViewMode)&&this._tryApplyNewViewMode(e.viewMode,e.specificViewMode),void 0!==e.noChartView&&(this.noChartView=e.noChartView),void 0!==e.maxWidth&&this.setMaxWidth(e.maxWidth),void 0!==e.maxHeight&&this.setMaxHeight(e.maxHeight),this.viewModel.dynamicReportInfo&&this.getNumDynamicColumns()?(w.trimColumnsForNumberOfFeatures(this),this.refresh({resetWidth:!0})):this.viewModel.dynamicReportInfo&&this.getNumDynamicRows()?(w.adjustRowsForNumberOfFeatures(this),this.refresh()):t?this.refresh({resetWidth:!0,columnsToPreserve:s}):this.refresh()},setPosition:function(e,t){void 0!==e&&(this._left=e||0,this.domNode.style.left=this._left+"px"),void 0!==t&&(this._top=t||0,this.domNode.style.top=this._top+"px")},setOpacity:function(e){"number"==typeof e.opacity&&(this._opacity=Math.max(0,Math.min(1,e.opacity)),this.domNode.style.opacity=this._opacity,s[0===this._opacity?"add":"remove"](this.domNode,"esriGENonInteractable")),"number"==typeof e.fixedCellsOpacity&&(this._fixedCellsOpacity=Math.max(0,Math.min(1,e.fixedCellsOpacity)),this.mainNode.style.opacity=this._fixedCellsOpacity,s[0===this._fixedCellsOpacity?"add":"remove"](this.mainNode,"esriGENonInteractable"))},_adjustColumnsForSettings:function(e){return!1},_adjustRowsForSettings:function(e){},getSettings:function(){return w.recalcGridWidth(this),{style:{width:this._width,left:this._left,top:this._top,spaceAfter:this._spaceAfter,alternatingStyle:this._alternatingStyle,opacity:this._opacity,fixedCellsOpacity:this._fixedCellsOpacity},attributes:t.mixin(t.clone(this._tableAttributes),{columnCount:this.columns.length,rowCount:this.store.data.length}),presetFilter:this.presetFilter,presetSorting:this.presetSorting,scaleToFitWidth:this._scaleToFitWidth,scaleToFitHeight:this._scaleToFitHeight,noChartView:this.noChartView}},getOpacity:function(){return{opacity:this._opacity,fixedCellsOpacity:this._fixedCellsOpacity}},needScaleToFitWidth:function(){return this._scaleToFitWidth},needScaleToFitHeight:function(){return this._scaleToFitHeight},isEmptyTable:function(){return P.isEmptyTable(this)},isSingleCelledTable:function(){return P.isSingleCelledTable(this)},isMultiDataTable:function(){return P.isMultiDataTable(this)},isMultiFeatureTable:function(){return!!this.getNumDynamicColumns()||!!this.getNumDynamicRows()},getNumFixedColumns:function(){return this._tableAttributes&&this._tableAttributes.fixedColumns||0},setNumFixedColumns:function(e){this._tableAttributes.fixedColumns=e},getNumDynamicColumns:function(){return this._tableAttributes&&this._tableAttributes.dynamicColumns||0},setNumDynamicColumns:function(e){this._tableAttributes.dynamicColumns=e},getNumFixedRows:function(){return this._tableAttributes&&this._tableAttributes.fixedRows||0},setNumFixedRows:function(e){this._tableAttributes.fixedRows=e},getNumDynamicRows:function(){return this._tableAttributes&&this._tableAttributes.dynamicRows||0},setNumDynamicRows:function(e){this._tableAttributes.dynamicRows=e},_viewMode:null,_specificViewMode:null,_viewModeKey:null,getViewMode:function(){return this._viewMode},getSpecificViewMode:function(){return this._specificViewMode},setViewMode:function(e,t,i){this._tryApplyNewViewMode(e,t)&&(i&&i.noUpdate||(this._fieldCells&&this._fieldCells.forEach((function(e){this._updateCellViewMode(e)}),this),this.backgroundSection&&this.backgroundSection.setViewMode(this._viewMode,this._specificViewMode),this.backgroundFloatingTablesSection&&this.backgroundFloatingTablesSection.setViewMode(this._viewMode,this._specificViewMode),this.foregroundFloatingTablesSection&&this.foregroundFloatingTablesSection.setViewMode(this._viewMode,this._specificViewMode),this.foregroundSection&&this.foregroundSection.setViewMode(this._viewMode,this._specificViewMode)))},_tryApplyNewViewMode:function(e,t){var i="function"==typeof this.fixedViewMode?this.fixedViewMode(this):this.fixedViewMode,n="function"==typeof this.fixedSpecificViewMode?this.fixedSpecificViewMode(this):this.fixedSpecificViewMode,o=(e=i||e||this._viewMode)+((t=n||t||this._specificViewMode)?JSON.stringify(t):"");return this._viewModeKey!==o&&(this._viewModeKey=o,this._viewMode=e,this._specificViewMode=t,s.remove(this.domNode,"adjustableGridPreviewMode adjustableGridEditMode "),s.add(this.domNode,this._viewMode===D.EDIT?"adjustableGridEditMode":"adjustableGridPreviewMode"),!0)},_updateCellViewMode:function(e){e.setDefaultBorderStyle(this._getDefaultBorderStyle(e.gridData,e.column,e.isLastInRow,e.isLastInColumn)),e.content&&e.content.setViewMode&&e.content.setViewMode(this._viewMode,this._specificViewMode),this._getCellRenderer().updateViewMode(e)},_getContentLoadingParams:function(){return{onContentLoadingStart:this.onContentLoadingStart.bind(this),onContentLoadingEnd:this.onContentLoadingEnd.bind(this)}},getFieldCells:function(e){var t=[];return t=e&&e.floatingCells?this.getBackgroundFloatingCells().concat(this._fieldCells).concat(this.getForegroundFloatingCells()):this._fieldCells,e&&e.topFirst&&(t=t.slice().reverse()),t},queryCells:function(e){return y.queryCells(this,e)},getFirstCell:function(){return this.getFieldCells()[0]},getCellText:function(e){return p.getFieldCellValue(e)},renderCell:function(e){this._renderFieldContent(e)},refreshCellStyle:function(e){e.setStyle(R.combineCellStyle(this,e.gridData,e.column))},getInfographicJson:function(){var e=this.getFirstCell();return p.isInfographicCell(e)?p.getFieldInfo(e).infographicJson:null},getFeatureIndexForCell:function(e){return this.isMultiFeatureTable()?w.calcRingIndexForCell(e):"number"==typeof this.currentFeatureIndex?this.currentFeatureIndex:"number"==typeof e.gridData.currentFeatureIndex?e.gridData.currentFeatureIndex:"number"==typeof e.column.currentFeatureIndex?e.column.currentFeatureIndex:void 0},isMouseOver:function(){return this.domNode&&y.isMouseOver(this)},getOverFieldCell:function(e){return y.getOverFieldCell(this,e)},getBBox:function(e){return y.getBBox(this,e)},getBackgroundFloatingCells:function(e){return this._getFloatingCells(this.backgroundFloatingTablesSection,e)},getForegroundFloatingCells:function(e){return this._getFloatingCells(this.foregroundFloatingTablesSection,e)},_getFloatingCells:function(e,t){var i=[];return e?(e.getTables().forEach((function(e){i=i.concat(e.getFieldCells())})),t&&t.topFirst&&i.reverse(),i):i},getChartJson:function(){var e=this.getFirstCell();return p.isChartCell(e)?p.getFieldInfo(e).chartJson:null},toJson:function(){var e=this.getSettings();return e.id="table",e.data={data:this._getOriginalData(),columns:this.columns},["backgroundSection","foregroundSection","backgroundFloatingTablesSection","foregroundFloatingTablesSection"].forEach((function(t){var i=this[t];if(i){var n=i.toJson();n.stack.length&&(e[t+"Json"]=n)}}),this),t.clone(e)},fromJson:function(e){e&&e.data&&(this.columns=e.data.columns||[],this.store=new i({data:e.data.data||[],idProperty:"id"}),this.backgroundSectionJson=e.backgroundSectionJson,this.foregroundSectionJson=e.foregroundSectionJson,this.backgroundFloatingTablesSectionJson=e.backgroundFloatingTablesSectionJson,this.foregroundFloatingTablesSectionJson=e.foregroundFloatingTablesSectionJson,this.setSettings(e))},notifyShown:function(){this.getFieldCells().forEach((function(e){e.notifyShown(),e.content&&e.content.notifyShown&&e.content.notifyShown()})),this.backgroundSection&&this.backgroundSection.notifyShown(),this.backgroundFloatingTablesSection&&this.backgroundFloatingTablesSection.notifyShown(),this.foregroundFloatingTablesSection&&this.foregroundFloatingTablesSection.notifyShown(),this.foregroundSection&&this.foregroundSection.notifyShown()},onRendered:function(){},onContentLoadingStart:function(){},onContentLoadingEnd:function(){},onRequestScaleToFitHeight:function(){},_destroyTableContent:function(){this._renderInfo=null,this._fieldCells=this._fieldCells||[],this._fieldCells.forEach((function(e){e.parentWidget=null,e.parentGrid=null,e.gridData=null,e.column=null,e.destroy()})),this._fieldCells.length=0,this.backgroundSection&&this.backgroundSection.destroy(),this.backgroundSection=null,this.backgroundFloatingTablesSection&&this.backgroundFloatingTablesSection.destroy(),this.backgroundFloatingTablesSection=null,this.foregroundFloatingTablesSection&&this.foregroundFloatingTablesSection.destroy(),this.foregroundFloatingTablesSection=null,this.foregroundSection&&this.foregroundSection.destroy(),this.foregroundSection=null,this._renderCellsQueue&&this._renderCellsQueue.destroy(),this._renderCellsQueue=null,this._renderCellsContentQueue&&this._renderCellsContentQueue.destroy(),this._renderCellsContentQueue=null},destroy:function(){this._destroyTableContent(),this.viewModel=null,this.theme=null,this.store=null,this.columns=null,this._originalData=null,this.parentWidget=null,this.parentElementInPageInfo=null,this.viewPortContainer=null,this.parentGrid=null,this.reportContainerPageNode=null,this._removeChart(),this.inherited(arguments)}})}));