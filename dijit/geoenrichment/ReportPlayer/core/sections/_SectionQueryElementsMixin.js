// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.33/esri/copyright.txt for details.

define(["dojo/_base/declare","../grid/coreUtils/GridDataUtil","../infographics/InfographicTypes","../supportClasses/templateJsonUtils/fieldInfo/FieldInfoNameUtil","../supportClasses/ElementUsageTypes"],(function(e,t,n,i,r){return e(null,{_queryElementsById:function(e,t){return this._getStackElements(t).filter((function(t){return t.stackId===e}))},getStackElements:function(e){return this._getStackElements(e)},containsElement:function(e){return-1!==this._stackElements.indexOf(e)},_getStackElements:function(e){return e?this._stackElements.slice().reverse():this._stackElements},getTables:function(e){return this._queryElementsById("table",e)},getFirstTable:function(){return this.getTables()[0]},getTopMostTable:function(){return this.getTables(!0)[0]},getLastTable:function(){var e=this.getTables();return e[e.length-1]},getDataTables:function(){return this.isDataSection()?this.getTables():[]},hasNonEmptyTables:function(){return this.getTables().some((function(e){return e.columns.length>0&&e.store.data.length>0}))},hasTablesThatFitHeight:function(){return this.getTables().some((function(e){return e.needScaleToFitHeight()}))},hasMultiFeatureTables:function(){return this.getTables().some((function(e){return e.isMultiFeatureTable()}))},hasLocatorTables:function(){return this.getTables().some((function(e){return e.isLocatorTable&&e.isLocatorTable()}))},hasLocatorHeaderTables:function(){return this.getTables().some((function(e){return e.isLocatorHeaderTable&&e.isLocatorHeaderTable()}))},hasLocatorFooterTables:function(){return this.getTables().some((function(e){return e.isLocatorFooterTable&&e.isLocatorFooterTable()}))},hasSummarizeTables:function(){return this.getTables().some((function(e){return e.isSummarizeTable&&e.isSummarizeTable()}))},hasImages:function(){return!!this.getImages().length},getImages:function(e){return this.viewModel.isGraphicStyle?this.getTables(e).filter((function(e){return this.isImageTable(e)}),this).map((function(e){return e.getFirstCell().content})):this._queryElementsById("img",e)},hasOnlyImage:function(){return 1===this._stackElements.length&&this.getImages().length},hasMapImages:function(){return!!this.getMapImages().length},getMapImages:function(e){return this.viewModel.isGraphicStyle?this.getTables(e).filter((function(e){return this.isMapTable(e)}),this).map((function(e){return e.getFirstCell().content})):this._queryElementsById("map",e)},hasChart:function(){var e=0;return this.getTables().forEach((function(n){n.getFieldCells().forEach((function(n){t.isChartCell(n)&&e++}))})),e},getChart:function(){var e;return this.getTables().some((function(n){n.getFieldCells().some((function(n){if(t.isChartCell(n))return e=n.content,!0}))})),e},getChartJson:function(){var e;return this.getTables().some((function(t){if(e=t.getChartJson())return!0})),e},hasSingleInfographic:function(e){return 1===this.getTables().length&&this.getTables()[0].isSingleCelledTable()&&this.hasInfographic(e)},getInfographicType:function(){var e=this.getInfographicWithTable();return e&&e.type},hasInfographic:function(e){var n=0;return this.getTables().forEach((function(i){return i.getFieldCells().forEach((function(i){!t.isInfographicCell(i)||e&&t.getFieldInfo(i).infographicJson.type!==e||n++}))})),n},getInfographic:function(){var e=this.getInfographicWithTable();return e&&e.infographic},getInfographicWithTable:function(){var e,n;return this.getTables().some((function(i){return i.getFieldCells().some((function(r){if(t.isInfographicCell(r))return e=r.content,n=i,!0}))})),e?{infographic:e,table:n,type:e.getType()}:null},getInfographicJson:function(){var e;return this.getTables().some((function(t){if(e=t.getInfographicJson())return!0})),e},getMovableElements:function(){return this._stackElements.filter((function(e){return"table"===e.stackId||"img"===e.stackId||"map"===e.stackId}))},hasPageBreak:function(){return!!this._queryElementsById("pageBreak").length},canSwitchFeatures:function(){return this.elementUsageType===r.PAGE_PANEL_SECTION&&(this.getTables().some((function(t){if(t.isSingleCelledTable()){if(this._checkSingleCelledTable(t))return e=!0,!0}else if(!t.isMultiFeatureTable()&&this._checkMultiCelledTable(t))return e=!0,!0}),this),e);var e},_checkSingleCelledTable:function(e){var i=e.getFirstCell();if(t.isChartCell(i)&&!i.content.isMultiFeatureChart())return!0;if(!t.isInfographicCell(i))return!1;var r=i.content.getType();return!n.supportsMultiFeature(r)||(!(r!==n.AREA_DETAILS&&r!==n.ATTACHMENTS||!e.viewModel.dynamicReportInfo||!e.viewModel.dynamicReportInfo.attachmentsStore||!e.viewModel.dynamicReportInfo.attachmentsStore.supportsMultipleAreas)||void 0)},_checkMultiCelledTable:function(e){if(e.getFieldCells().some((function(e){var n=t.getFieldInfo(e);if(n&&!i.isAreaAttributesFieldInfo(n))return t.isVariableLikeFieldCell(e)})))return!0}})}));