// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.42/esri/copyright.txt for details.

var t;(t=this).BAIV3&&!t.BAIVLENS&&function(t,e){"use strict";var n={three:"^0.105.2"},i="0.11.0".split(".")[1],o=n.three.split(".")[1],s=n.three.replace(/[^0-9.]/g,""),a={UNKNOWN:0,NORMAL:1,CARDBOARD:2,STEREO:3},r={},c={load:function(t,n,i,o){var s=1<arguments.length&&void 0!==n?n:function(){},a=2<arguments.length&&void 0!==i?i:function(){},c=3<arguments.length&&void 0!==o?o:function(){};e.Cache.enabled=!0;var h,u=void 0,d=void 0,l=void 0,p=void 0,m=void 0,v=void 0;for(var f in r)r.hasOwnProperty(f)&&t===r[f]&&(v=f);if(void 0!==(h=e.Cache.get(v||t)))return s&&setTimeout((function(){a({loaded:1,total:1}),s(h)}),0),h;function E(){p.revokeObjectURL(m.src),s(m)}if(p=window.URL||window.webkitURL,m=document.createElementNS("http://www.w3.org/1999/xhtml","img"),e.Cache.add(v||t,m),0===t.indexOf("data:"))return m.addEventListener("load",E,!1),m.src=t,m;m.crossOrigin=void 0!==this.crossOrigin?this.crossOrigin:"",(u=new window.XMLHttpRequest).open("GET",t,!0),u.responseType="arraybuffer",u.addEventListener("error",c),u.addEventListener("progress",(function(t){if(t){var e=t.loaded,n=t.total;t.lengthComputable&&a({loaded:e,total:n})}})),u.addEventListener("loadend",(function(t){if(t){var e=t.currentTarget.response;d=new Uint8Array(e),l=new window.Blob([d]),m.addEventListener("load",E,!1),m.src=p.createObjectURL(l)}})),u.send(null)}},h={load:function(t,n,i,o){var s,a=1<arguments.length&&void 0!==n?n:function(){},r=i,h=o;return c.load(t,(function(n){(s=new e.Texture).image=n;var i=0<t.search(/\.(jpg|jpeg)$/)||0===t.search(/^data\:image\/jpeg/);s.format=i?e.RGBFormat:e.RGBAFormat,s.needsUpdate=!0,a(s)}),r,h),s}};function u(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:16777215,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1500;this.dpr=window.devicePixelRatio;var o=this.createCanvas(),s=o.canvas,a=o.context,r=new e.SpriteMaterial({color:t,map:this.createCanvasTexture(s)});e.Sprite.call(this,r),this.canvasWidth=s.width,this.canvasHeight=s.height,this.context=a,this.color=t instanceof e.Color?t:new e.Color(t),this.autoSelect=n,this.dwellTime=i,this.rippleDuration=500,this.position.z=-10,this.center.set(.5,.5),this.scale.set(.5,.5,1),this.startTimestamp=null,this.timerId=null,this.callback=null,this.frustumCulled=!1,this.updateCanvasArcByProgress(0)}u.prototype=Object.assign(Object.create(e.Sprite.prototype),{constructor:u,setColor:function(){},createCanvasTexture:function(t){var n=new e.CanvasTexture(t);return n.minFilter=e.LinearFilter,n.magFilter=e.LinearFilter,n.generateMipmaps=!1,n},createCanvas:function(){var t=document.createElement("canvas"),e=t.getContext("2d"),n=this.dpr;return t.width=32*n,t.height=32*n,e.scale(n,n),e.shadowBlur=5,e.shadowColor="rgba(200,200,200,0.9)",{canvas:t,context:e}},updateCanvasArcByProgress:function(t){var e=this.context,n=this.canvasWidth,i=this.canvasHeight,o=this.material,s=this.dpr,a=t*Math.PI*2,r=this.color.getStyle(),c=.5*n/s,h=.5*i/s;e.clearRect(0,0,n,i),e.beginPath(),0===t?(e.arc(c,h,n/16,0,2*Math.PI),e.fillStyle=r,e.fill()):(e.arc(c,h,n/4-3,-Math.PI/2,-Math.PI/2+a),e.strokeStyle=r,e.lineWidth=3,e.stroke()),e.closePath(),o.map.needsUpdate=!0},ripple:function(){},show:function(){},hide:function(){this.visible=!1},start:function(){},end:function(){},update:function(){}});var d,l=(function(t,e){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}n.prototype={getAll:function(){},removeAll:function(){},add:function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},remove:function(){},update:function(t,e){var n=Object.keys(this._tweens);if(0===n.length)return!1;for(t=void 0!==t?t:i.now();0<n.length;){this._tweensAddedDuringUpdate={};for(var o=0;o<n.length;o++){var s=this._tweens[n[o]];s&&!1===s.update(t)&&(s._isPlaying=!1,e||delete this._tweens[n[o]])}n=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var i=new n;i.Group=n,i._nextId=0,i.nextId=function(){return i._nextId++},"undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?i.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?i.now=self.performance.now.bind(self.performance):void 0!==Date.now?i.now=Date.now:i.now=function(){return(new Date).getTime()},i.Tween=function(t,e){this._object=t,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._repeatDelayTime=void 0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=i.Easing.Linear.None,this._interpolationFunction=i.Interpolation.Linear,this._chainedTweens=[],this._onStartCallback=null,this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onRepeatCallback=null,this._onCompleteCallback=null,this._onStopCallback=null,this._group=e||i,this._id=i.nextId()},i.Tween.prototype={getId:function(){return this._id},isPlaying:function(){},to:function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},duration:function(){},start:function(t){for(var e in this._group.add(this),this._isPlaying=!0,this._onStartCallbackFired=!1,this._startTime=void 0!==t?"string"==typeof t?i.now()+parseFloat(t):t:i.now(),this._startTime+=this._delayTime,this._valuesEnd){if(this._valuesEnd[e]instanceof Array){if(0===this._valuesEnd[e].length)continue;this._valuesEnd[e]=[this._object[e]].concat(this._valuesEnd[e])}void 0!==this._object[e]&&(this._valuesStart[e]=this._object[e],this._valuesStart[e]instanceof Array==0&&(this._valuesStart[e]*=1),this._valuesStartRepeat[e]=this._valuesStart[e]||0)}return this},stop:function(){return this._isPlaying&&(this._group.remove(this),this._isPlaying=!1,null!==this._onStopCallback&&this._onStopCallback(this._object),this.stopChainedTweens()),this},end:function(){},stopChainedTweens:function(){},group:function(){},delay:function(t){return this._delayTime=t,this},repeat:function(){},repeatDelay:function(){},yoyo:function(){},easing:function(t){return this._easingFunction=t,this},interpolation:function(){},chain:function(){},onStart:function(t){return this._onStartCallback=t,this},onUpdate:function(t){return this._onUpdateCallback=t,this},onRepeat:function(){},onComplete:function(t){return this._onCompleteCallback=t,this},onStop:function(t){return this._onStopCallback=t,this},update:function(t){var e,n,i;if(t<this._startTime)return!0;for(e in!1===this._onStartCallbackFired&&(null!==this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(t-this._startTime)/this._duration,n=0===this._duration||1<n?1:n,i=this._easingFunction(n),this._valuesEnd)if(void 0!==this._valuesStart[e]){var o=this._valuesStart[e]||0,s=this._valuesEnd[e];s instanceof Array?this._object[e]=this._interpolationFunction(s,i):("string"==typeof s&&(s="+"===s.charAt(0)||"-"===s.charAt(0)?o+parseFloat(s):parseFloat(s)),"number"==typeof s&&(this._object[e]=o+(s-o)*i))}if(null!==this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1!==n||0<this._repeat)return!0;null!==this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,r=this._chainedTweens.length;a<r;a++)this._chainedTweens[a].start(this._startTime+this._duration);return!1}},i.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(){},Out:function(t){return 1- --t*t*t*t},InOut:function(){}},Quintic:{In:function(){},Out:function(){},InOut:function(){}},Sinusoidal:{In:function(){},Out:function(){},InOut:function(){}},Exponential:{In:function(){},Out:function(){},InOut:function(){}},Circular:{In:function(){},Out:function(){},InOut:function(){}},Elastic:{In:function(){},Out:function(){},InOut:function(){}},Back:{In:function(){},Out:function(){},InOut:function(){}},Bounce:{In:function(){},Out:function(){},InOut:function(){}}},i.Interpolation={Linear:function(){},Bezier:function(){},CatmullRom:function(){},Utils:{Linear:function(){},Bernstein:function(){},Factorial:function(t){},CatmullRom:function(){}}},t.exports=i}(d={exports:{}}),d.exports);function p(t){t||console.warn("BAIVLENS.Widget: No container specified"),e.EventDispatcher.call(this),this.DEFAULT_TRANSITION="all 0.27s ease",this.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),this.PREVENT_EVENT_HANDLER=function(t){t.preventDefault(),t.stopPropagation()},this.container=t,this.barElement=null,this.fullscreenElement=null,this.videoElement=null,this.settingElement=null,this.mainMenu=null,this.activeMainItem=null,this.activeSubMenu=null,this.mask=null}function m(t,n){e.Mesh.call(this,t,n),this.type="panorama",this.ImageQualityLow=1,this.ImageQualityFair=2,this.ImageQualityMedium=3,this.ImageQualityHigh=4,this.ImageQualitySuperHigh=5,this.animationDuration=1e3,this.defaultInfospotSize=350,this.container=void 0,this.loaded=!1,this.linkedSpots=[],this.isInfospotVisible=!1,this.linkingImageURL=void 0,this.linkingImageScale=void 0,this.material.side=e.BackSide,this.material.opacity=0,this.scale.x*=-1,this.renderOrder=-1,this.active=!1,this.infospotAnimation=new l.Tween(this).to({},this.animationDuration/2),this.addEventListener("load",this.fadeIn.bind(this)),this.addEventListener("panolens-container",this.setContainer.bind(this)),this.addEventListener("click",this.onClick.bind(this)),this.setupTransitions()}function v(t,n,i){var o=this.__geometry=n||new e.SphereBufferGeometry(5e3,60,40),s=this.__material=i||new e.MeshBasicMaterial({opacity:0,transparent:!0});m.call(this,o,s),this.src=t,this.radius=5e3}function f(t,n){this.object=t,this.domElement=void 0!==n?n:document,this.frameId=null,this.enabled=!0,this.target=new e.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.noRotate=!1,this.rotateSpeed=-.15,this.noPan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.momentumDampingFactor=.9,this.momentumScalingFactor=-.005,this.momentumKeydownFactor=20,this.minFov=30,this.maxFov=120,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:e.MOUSE.LEFT,ZOOM:e.MOUSE.MIDDLE,PAN:e.MOUSE.RIGHT};var i,o,s,a,r,c=this,h=new e.Vector2,u=new e.Vector2,d=new e.Vector2,l=new e.Vector2,p=new e.Vector2,m=new e.Vector2,v=new e.Vector3,f=new e.Vector3,E=new e.Vector2,g=new e.Vector2,w=new e.Vector2,b=0,y=0,O=0,_=0,T=1,C=new e.Vector3,R=new e.Vector3,L=new e.Quaternion,M=0,I=0,A=!1,S=-1,D=0,j=1,k=2,P=3,x=4,N=5,U=S;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var F=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),H=F.clone().inverse(),V={type:"change"},B={type:"start"},W={type:"end"};function z(t){if(M=I=0,(A=!1)!==c.enabled){if(t.preventDefault(),t.button===c.mouseButtons.ORBIT){if(!0===c.noRotate)return;U=D,h.set(t.clientX,t.clientY)}else if(t.button===c.mouseButtons.ZOOM){if(!0===c.noZoom)return;U=j,E.set(t.clientX,t.clientY)}else if(t.button===c.mouseButtons.PAN){if(!0===c.noPan)return;U=k,l.set(t.clientX,t.clientY)}U!==S&&(document.addEventListener("mousemove",Y,!1),document.addEventListener("mouseup",X,!1),c.dispatchEvent(B)),c.update()}}function Y(t){if(!1!==c.enabled){t.preventDefault();var e=c.domElement===document?c.domElement.body:c.domElement;if(U===D){if(!0===c.noRotate)return;u.set(t.clientX,t.clientY),d.subVectors(u,h),c.rotateLeft(2*Math.PI*d.x/e.clientWidth*c.rotateSpeed),c.rotateUp(2*Math.PI*d.y/e.clientHeight*c.rotateSpeed),h.copy(u),i&&(M=t.clientX-i.clientX,I=t.clientY-i.clientY),i=t}U!==S&&c.update()}}function X(){!(A=!(i=void 0))!==c.enabled&&(document.removeEventListener("mousemove",Y,!1),document.removeEventListener("mouseup",X,!1),c.dispatchEvent(W),U=S)}function q(t){if(!1!==c.enabled&&!0!==c.noZoom&&U===S){t.preventDefault(),t.stopPropagation();var e=0;void 0!==t.wheelDelta?e=t.wheelDelta:void 0!==t.detail&&(e=-t.detail),e<0?(c.object.fov=c.object.fov<c.maxFov?c.object.fov+1:c.maxFov,c.object.updateProjectionMatrix()):0<e&&(c.object.fov=c.object.fov>c.minFov?c.object.fov-1:c.minFov,c.object.updateProjectionMatrix()),c.update(),c.dispatchEvent(V),c.dispatchEvent(B),c.dispatchEvent(W)}}function Q(t){}function K(t){if(!1!==c.enabled&&!0!==c.noKeys&&!0!==c.noRotate){switch(t.keyCode){case c.keys.UP:o=!0;break;case c.keys.BOTTOM:s=!0;break;case c.keys.LEFT:a=!0;break;case c.keys.RIGHT:r=!0}(o||s||a||r)&&(A=!0,o&&(I=-c.rotateSpeed*c.momentumKeydownFactor),s&&(I=c.rotateSpeed*c.momentumKeydownFactor),a&&(M=-c.rotateSpeed*c.momentumKeydownFactor),r&&(M=c.rotateSpeed*c.momentumKeydownFactor))}}function Z(t){if(M=I=0,(A=!1)!==c.enabled){switch(t.touches.length){case 1:if(!0===c.noRotate)return;U=P,h.set(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!0===c.noZoom)return;U=x;var e=t.touches[0].pageX-t.touches[1].pageX,n=t.touches[0].pageY-t.touches[1].pageY,i=Math.sqrt(e*e+n*n);E.set(0,i);break;case 3:if(!0===c.noPan)return;U=N,l.set(t.touches[0].pageX,t.touches[0].pageY);break;default:U=S}U!==S&&c.dispatchEvent(B)}}function G(t){if(!1!==c.enabled){t.preventDefault(),t.stopPropagation();var e=c.domElement===document?c.domElement.body:c.domElement;switch(t.touches.length){case 1:if(!0===c.noRotate)return;if(U!==P)return;u.set(t.touches[0].pageX,t.touches[0].pageY),d.subVectors(u,h),c.rotateLeft(2*Math.PI*d.x/e.clientWidth*c.rotateSpeed),c.rotateUp(2*Math.PI*d.y/e.clientHeight*c.rotateSpeed),h.copy(u),i&&(M=t.touches[0].pageX-i.pageX,I=t.touches[0].pageY-i.pageY),i={pageX:t.touches[0].pageX,pageY:t.touches[0].pageY},c.update();break;case 2:if(!0===c.noZoom)return;if(U!==x)return;var n=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY,s=Math.sqrt(n*n+o*o);g.set(0,s),w.subVectors(g,E),w.y<0?(c.object.fov=c.object.fov<c.maxFov?c.object.fov+1:c.maxFov,c.object.updateProjectionMatrix()):0<w.y&&(c.object.fov=c.object.fov>c.minFov?c.object.fov-1:c.minFov,c.object.updateProjectionMatrix()),E.copy(g),c.update(),c.dispatchEvent(V);break;case 3:if(!0===c.noPan)return;if(U!==N)return;p.set(t.touches[0].pageX,t.touches[0].pageY),m.subVectors(p,l),c.pan(m.x,m.y),l.copy(p),c.update();break;default:U=S}}}function $(){!(A=!(i=void 0))!==c.enabled&&(c.dispatchEvent(W),U=S)}this.setLastQuaternion=function(t){L.copy(t),c.object.quaternion.copy(t)},this.getLastPosition=function(){return R},this.rotateLeft=function(t){void 0===t&&(t=void 0),_-=t},this.rotateUp=function(t){void 0===t&&(t=void 0),O-=t},this.panLeft=function(t){var e=this.object.matrix.elements;v.set(e[0],e[1],e[2]),v.multiplyScalar(-t),C.add(v)},this.panUp=function(t){var e=this.object.matrix.elements;v.set(e[4],e[5],e[6]),v.multiplyScalar(t),C.add(v)},this.pan=function(t,e){},this.momentum=function(){A&&(Math.abs(M)<1e-4&&Math.abs(I)<1e-4?A=!1:(I*=this.momentumDampingFactor,M*=this.momentumDampingFactor,_-=this.momentumScalingFactor*M,O-=this.momentumScalingFactor*I))},this.dollyIn=function(t){},this.dollyOut=function(t){},this.update=function(t){var e=this.object.position;f.copy(e).sub(this.target),f.applyQuaternion(F),b=Math.atan2(f.x,f.z),y=Math.atan2(Math.sqrt(f.x*f.x+f.z*f.z),f.y),this.autoRotate&&U===S&&this.rotateLeft(void 0),this.momentum(),b+=_,y+=O,b=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,b)),y=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,y)),y=Math.max(1e-7,Math.min(Math.PI-1e-7,y));var n=f.length()*T;n=Math.max(this.minDistance,Math.min(this.maxDistance,n)),this.target.add(C),f.x=n*Math.sin(y)*Math.sin(b),f.y=n*Math.cos(y),f.z=n*Math.sin(y)*Math.cos(b),f.applyQuaternion(H),e.copy(this.target).add(f),this.object.lookAt(this.target),O=_=0,T=1,C.set(0,0,0),(1e-7<R.distanceToSquared(this.object.position)||1e-7<8*(1-L.dot(this.object.quaternion)))&&(!0!==t&&this.dispatchEvent(V),R.copy(this.object.position),L.copy(this.object.quaternion))},this.reset=function(){},this.getPolarAngle=function(){},this.getAzimuthalAngle=function(){},this.dispose=function(){this.domElement.removeEventListener("mousedown",z),this.domElement.removeEventListener("mousewheel",q),this.domElement.removeEventListener("DOMMouseScroll",q),this.domElement.removeEventListener("touchstart",Z),this.domElement.removeEventListener("touchend",$),this.domElement.removeEventListener("touchmove",G),window.removeEventListener("keyup",Q),window.removeEventListener("keydown",K)},this.domElement.addEventListener("mousedown",z,{passive:!1}),this.domElement.addEventListener("mousewheel",q,{passive:!1}),this.domElement.addEventListener("DOMMouseScroll",q,{passive:!1}),this.domElement.addEventListener("touchstart",Z,{passive:!1}),this.domElement.addEventListener("touchend",$,{passive:!1}),this.domElement.addEventListener("touchmove",G,{passive:!1}),window.addEventListener("keyup",Q,{passive:!1}),window.addEventListener("keydown",K,{passive:!1}),this.update()}function E(t,n){var i=this,o={type:"change"},s=0,a=0,r=0,c=0;function h(t){i.deviceOrientation=t}function u(){i.screenOrientation=window.orientation||0}function d(t){t.preventDefault(),t.stopPropagation(),r=t.touches[0].pageX,c=t.touches[0].pageY}function l(t){t.preventDefault(),t.stopPropagation(),s+=e.Math.degToRad((t.touches[0].pageX-r)/4),a+=e.Math.degToRad((c-t.touches[0].pageY)/4),i.updateAlphaOffsetAngle(s),r=t.touches[0].pageX,c=t.touches[0].pageY}this.camera=t,this.camera.rotation.reorder("YXZ"),this.domElement=void 0!==n?n:document,this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alpha=0,this.alphaOffsetAngle=0,this.connect=function(){u(),window.addEventListener("orientationchange",u,{passive:!0}),window.addEventListener("deviceorientation",h,{passive:!0}),window.addEventListener("deviceorientation",this.update.bind(this),{passive:!0}),i.domElement.addEventListener("touchstart",d,{passive:!1}),i.domElement.addEventListener("touchmove",l,{passive:!1}),i.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",u,!1),window.removeEventListener("deviceorientation",h,!1),window.removeEventListener("deviceorientation",this.update.bind(this),!1),i.domElement.removeEventListener("touchstart",d,!1),i.domElement.removeEventListener("touchmove",l,!1),i.enabled=!1},this.update=function(t){if(!1!==i.enabled){var n,s,r,c,h,u,d,l,p,m,v,f,E=i.deviceOrientation.alpha?e.Math.degToRad(i.deviceOrientation.alpha)+i.alphaOffsetAngle:0,g=i.deviceOrientation.beta?e.Math.degToRad(i.deviceOrientation.beta):0,w=i.deviceOrientation.gamma?e.Math.degToRad(i.deviceOrientation.gamma):0,b=i.screenOrientation?e.Math.degToRad(i.screenOrientation):0;n=i.camera.quaternion,s=E,r=g,c=w,h=b,d=new e.Vector3(0,0,1),l=new e.Euler,p=new e.Quaternion,m=new e.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),v=new e.Quaternion,f=new e.Quaternion,0==i.screenOrientation?(u=new e.Vector3(1,0,0),v.setFromAxisAngle(u,-a)):180==i.screenOrientation?(u=new e.Vector3(1,0,0),v.setFromAxisAngle(u,a)):90==i.screenOrientation?(u=new e.Vector3(0,1,0),v.setFromAxisAngle(u,a)):-90==i.screenOrientation&&(u=new e.Vector3(0,1,0),v.setFromAxisAngle(u,-a)),m.multiply(v),m.multiply(f),l.set(r,s,-c,"YXZ"),n.setFromEuler(l),n.multiply(m),n.multiply(p.setFromAxisAngle(d,-h)),i.alpha=E,!0!==t&&i.dispatchEvent(o)}},this.updateAlphaOffsetAngle=function(t){this.alphaOffsetAngle=t,this.update()},this.dispose=function(){this.disconnect()},this.connect()}function g(t){var n=new e.OrthographicCamera(-1,1,1,-1,0,1),i=new e.Scene,o=new e.StereoCamera;o.aspect=.5;var s={minFilter:e.LinearFilter,magFilter:e.NearestFilter,format:e.RGBAFormat},a=new e.WebGLRenderTarget(512,512,s);a.scissorTest=!0,a.texture.generateMipmaps=!1;var r=new e.Vector2(.441,.156),c=new e.PlaneBufferGeometry(1,1,10,20).removeAttribute("normal").toNonIndexed(),h=c.attributes.position.array,u=c.attributes.uv.array;c.attributes.position.count*=2,c.attributes.uv.count*=2;var d=new Float32Array(2*h.length);d.set(h),d.set(h,h.length);var l=new Float32Array(2*u.length);l.set(u),l.set(u,u.length);for(var p=new e.Vector2,m=h.length/3,v=0,f=d.length/3;v<f;v++){p.x=d[3*v+0],p.y=d[3*v+1];var E=p.dot(p),g=1.5+(r.x+r.y*E)*E,w=v<m?0:1;d[3*v+0]=p.x/g*1.5-.5+w,d[3*v+1]=p.y/g*3,l[2*v]=.5*(l[2*v]+w)}c.attributes.position.array=d,c.attributes.uv.array=l;var b=new e.MeshBasicMaterial({map:a.texture}),y=new e.Mesh(c,b);i.add(y),this.setSize=function(e,n){t.setSize(e,n);var i=t.getPixelRatio();a.setSize(e*i,n*i)},this.render=function(e,s){e.updateMatrixWorld(),null===s.parent&&s.updateMatrixWorld(),o.update(s);var r=a.width/2,c=a.height;t.autoClear&&t.clear(),a.scissor.set(0,0,r,c),a.viewport.set(0,0,r,c),t.setRenderTarget(a),t.render(e,o.cameraL),t.clearDepth(),a.scissor.set(r,0,r,c),a.viewport.set(r,0,r,c),t.setRenderTarget(a),t.render(e,o.cameraR),t.clearDepth(),t.setRenderTarget(null),t.render(i,n)}}function w(t){var n=new e.StereoCamera;n.aspect=.5;var i=new e.Vector2;this.setEyeSeparation=function(t){n.eyeSep=t},this.setSize=function(e,n){t.setSize(e,n)},this.render=function(e,o){e.updateMatrixWorld(),null===o.parent&&o.updateMatrixWorld(),n.update(o),t.getSize(i),t.autoClear&&t.clear(),t.setScissorTest(!0),t.setScissor(0,0,i.width/2,i.height),t.setViewport(0,0,i.width/2,i.height),t.render(e,n.cameraL),t.setScissor(i.width/2,0,i.width/2,i.height),t.setViewport(i.width/2,0,i.width/2,i.height),t.render(e,n.cameraR),t.setScissorTest(!1)}}function b(t){var n=void 0;(t=t||{}).controlBar=void 0===t.controlBar||t.controlBar,t.autoHideControlBar=void 0!==t.autoHideControlBar&&t.autoHideControlBar,t.autoHideInfospot=void 0===t.autoHideInfospot||t.autoHideInfospot,t.horizontalView=void 0!==t.horizontalView&&t.horizontalView,t.clickTolerance=t.clickTolerance||10,t.cameraFov=t.cameraFov||60,t.reverseDragging=t.reverseDragging||!1,t.enableReticle=t.enableReticle||!1,t.dwellTime=t.dwellTime||1500,t.autoReticleSelect=void 0===t.autoReticleSelect||t.autoReticleSelect,t.viewIndicator=void 0!==t.viewIndicator&&t.viewIndicator,t.indicatorSize=t.indicatorSize||30,t.output=t.output?t.output:"none",t.autoRotate=t.autoRotate||!1,t.autoRotateSpeed=t.autoRotateSpeed||2,t.autoRotateActivationDuration=t.autoRotateActivationDuration||5e3,(this.options=t).container?((n=t.container)._width=n.clientWidth,n._height=n.clientHeight):((n=document.createElement("div")).classList.add("panolens-container"),n.style.width="100%",n.style.height="100%",n._width=window.innerWidth,n._height=window.innerHeight,document.body.appendChild(n)),this.container=n,this.camera=t.camera||new e.PerspectiveCamera(this.options.cameraFov,this.container.clientWidth/this.container.clientHeight,1,1e4),this.scene=t.scene||new e.Scene,this.renderer=t.renderer||new e.WebGLRenderer({alpha:!0,antialias:!1}),this.sceneReticle=new e.Scene,this.viewIndicatorSize=this.options.indicatorSize,this.reticle={},this.tempEnableReticle=this.options.enableReticle,this.mode=a.NORMAL,this.panorama=null,this.widget=null,this.hoverObject=null,this.infospot=null,this.pressEntityObject=null,this.pressObject=null,this.raycaster=new e.Raycaster,this.raycasterPoint=new e.Vector2,this.userMouse=new e.Vector2,this.updateCallbacks=[],this.requestAnimationId=null,this.cameraFrustum=new e.Frustum,this.cameraViewProjectionMatrix=new e.Matrix4,this.autoRotateRequestId=null,this.outputDivElement=null,this.touchSupported="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,this.HANDLER_MOUSE_DOWN=this.onMouseDown.bind(this),this.HANDLER_MOUSE_UP=this.onMouseUp.bind(this),this.HANDLER_MOUSE_MOVE=this.onMouseMove.bind(this),this.HANDLER_WINDOW_RESIZE=this.onWindowResize.bind(this),this.HANDLER_KEY_DOWN=this.onKeyDown.bind(this),this.HANDLER_KEY_UP=this.onKeyUp.bind(this),this.HANDLER_TAP=this.onTap.bind(this,{clientX:this.container.clientWidth/2,clientY:this.container.clientHeight/2}),this.OUTPUT_INFOSPOT=!1,this.tweenLeftAnimation=new l.Tween,this.tweenUpAnimation=new l.Tween,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setClearColor(0,0),this.renderer.autoClear=!1,this.renderer.domElement.classList.add("panolens-canvas"),this.renderer.domElement.style.display="block",this.container.style.backgroundColor="#000",this.container.appendChild(this.renderer.domElement),this.OrbitControls=new f(this.camera,this.container),this.OrbitControls.id="orbit",this.OrbitControls.minDistance=1,this.OrbitControls.noPan=!0,this.OrbitControls.autoRotate=this.options.autoRotate,this.OrbitControls.autoRotateSpeed=this.options.autoRotateSpeed,this.DeviceOrientationControls=new E(this.camera,this.container),this.DeviceOrientationControls.id="device-orientation",this.DeviceOrientationControls.enabled=!1,this.camera.position.z=1,this.options.passiveRendering&&console.warn("passiveRendering is now deprecated"),this.controls=[this.OrbitControls,this.DeviceOrientationControls],this.control=this.OrbitControls,this.CardboardEffect=new g(this.renderer),this.CardboardEffect.setSize(this.container.clientWidth,this.container.clientHeight),this.StereoEffect=new w(this.renderer),this.StereoEffect.setSize(this.container.clientWidth,this.container.clientHeight),this.effect=this.CardboardEffect,this.addReticle(),this.options.horizontalView&&(this.OrbitControls.minPolarAngle=Math.PI/2,this.OrbitControls.maxPolarAngle=Math.PI/2),!1!==this.options.controlBar&&this.addDefaultControlBar(this.options.controlButtons),this.options.viewIndicator&&this.addViewIndicator(),this.options.reverseDragging&&this.reverseDraggingDirection(),this.options.enableReticle?this.enableReticleControl():this.registerMouseAndTouchEvents(),"overlay"===this.options.output&&this.addOutputElement(),this.registerEventListeners(),this.animate.call(this)}p.prototype=Object.assign(Object.create(e.EventDispatcher.prototype),{constructor:p,addControlBar:function(){if(this.container){var t,e,n;(t=document.createElement("div")).id="panolens_toolbar",t.style.width="48px",t.style.height="44px",t.style.float="left",t.style.position="absolute",t.style.top="49px",t.style.right="39px",t.style.zIndex="99999999",t.style.paddingRight="8px",t.style.transform=t.style.webkitTransform=t.style.msTransform="translateY(-100%)",t.style.transition=this.DEFAULT_TRANSITION,t.style.pointerEvents="none",t.isHidden=!1,t.toggle=function(){t.isHidden=!t.isHidden,e=t.isHidden?"translateY(0)":"translateY(-100%)",n=t.isHidden?0:1,t.style.transform=t.style.webkitTransform=t.style.msTransform=e,t.style.opacity=n};var i=this.createDefaultMenu();this.mainMenu=this.createMainMenu(i),t.appendChild(this.mainMenu);var o=this.createMask();this.mask=o,this.container.appendChild(o),t.dispose=function(){},this.container.appendChild(t),this.mask.addEventListener("mousemove",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mouseup",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener("mousedown",this.PREVENT_EVENT_HANDLER,!0),this.mask.addEventListener(this.TOUCH_ENABLED?"touchend":"click",(function(t){}),!1),this.addEventListener("control-bar-toggle",t.toggle),this.barElement=t}else console.warn("Widget container not set")},createDefaultMenu:function(){return function(){return function(){}},[{title:"Control",subMenu:[{title:this.TOUCH_ENABLED?"Touch":"Mouse",handler:function(){}},{title:"Sensor",handler:function(){}}]},{title:"Mode",subMenu:[{title:"Normal",handler:function(){}},{title:"Cardboard",handler:function(){}},{title:"Stereoscopic",handler:function(){}}]}]},addControlButton:function(){},createMask:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.width="100%",t.style.height="100%",t.style.background="transparent",t.style.display="none",t.show=function(){},t.hide=function(){},t},createSettingButton:function(){var t=void 0;return(t=this.createCustomItem({style:{backgroundImage:'url("'+r.Setting+'")',webkitTransition:this.DEFAULT_TRANSITION,transition:this.DEFAULT_TRANSITION},onTap:function(t){}})).activate=function(){},t.deactivate=function(){},t.activated=!1,t},createFullscreenButton:function(){return item},createVideoControl:function(){},createVideoControlButton:function(){return item.update=function(t){},item},createVideoControlSeekbar:function(){return progressElement.appendChild(progressElementControl),item=this.createCustomItem({style:{float:"left",width:"30%",height:"4px",marginTop:"20px",backgroundColor:"rgba(188,188,188,0.8)"},onTap:function(t){},onDispose:function(){}}),item.appendChild(progressElement),item.setProgress=function(t){},this.addEventListener("video-update",(function(t){})),item.progressElement=progressElement,item.progressElementControl=progressElementControl,item},createMenuItem:function(){},createMenuItemHeader:function(){},createMainMenu:function(){},createSubMenu:function(){},createMenu:function(){},createCustomItem:function(){},mergeStyleOptions:function(){},dispose:function(){}}),m.prototype=Object.assign(Object.create(e.Mesh.prototype),{constructor:m,add:function(){},load:function(){},onClick:function(){},setContainer:function(t){var e=void 0;t instanceof HTMLElement?e=t:t&&t.container&&(e=t.container),e&&(this.children.forEach((function(t){})),this.container=e)},onLoad:function(){this.loaded=!0,this.dispatchEvent({type:"load"})},onProgress:function(){},onError:function(){},getZoomLevel:function(){},updateTexture:function(t){this.material.map=t,this.material.needsUpdate=!0},toggleInfospotVisibility:function(t,e){e=void 0!==e?e:0;var n=void 0!==t?t:!this.isInfospotVisible;this.traverse((function(t){})),this.isInfospotVisible=n,this.infospotAnimation.onComplete(function(){this.dispatchEvent({type:"infospot-animation-complete",visible:n})}.bind(this)).delay(e).start()},setLinkingImage:function(t,e){this.linkingImageURL=t,this.linkingImageScale=e},link:function(){},reset:function(){this.children.length=0},setupTransitions:function(){this.fadeInAnimation=new l.Tween(this.material).easing(l.Easing.Quartic.Out).onStart(function(){this.visible=!0,this.dispatchEvent({type:"enter-fade-start"})}.bind(this)),this.fadeOutAnimation=new l.Tween(this.material).easing(l.Easing.Quartic.Out).onComplete(function(){this.visible=!1,this.dispatchEvent({type:"leave-complete"})}.bind(this)),this.enterTransition=new l.Tween(this).easing(l.Easing.Quartic.Out).onComplete(function(){this.dispatchEvent({type:"enter-complete"})}.bind(this)).start(),this.leaveTransition=new l.Tween(this).easing(l.Easing.Quartic.Out)},onFadeAnimationUpdate:function(){var t=this.material?this.material.opacity:1,e=this.material.uniforms;e&&e.opacity&&(e.opacity.value=t)},fadeIn:function(t){t=0<=t?t:this.animationDuration,this.fadeOutAnimation.stop(),this.fadeInAnimation.to({opacity:1},t).onUpdate(this.onFadeAnimationUpdate.bind(this)).onComplete(function(){this.toggleInfospotVisibility(!0,t/2),this.dispatchEvent({type:"enter-fade-complete"})}.bind(this)).start()},fadeOut:function(){},onEnter:function(){var t=this.animationDuration;this.leaveTransition.stop(),this.enterTransition.to({},t).onStart(function(){this.dispatchEvent({type:"enter-start"}),this.loaded?this.fadeIn(t):this.load()}.bind(this)).start(),this.dispatchEvent({type:"enter"}),this.children.forEach((function(t){t.dispatchEvent({type:"panorama-enter"})})),this.active=!0},onLeave:function(){},dispose:function(){this.infospotAnimation.stop(),this.fadeInAnimation.stop(),this.fadeOutAnimation.stop(),this.enterTransition.stop(),this.leaveTransition.stop(),this.dispatchEvent({type:"panolens-viewer-handler",method:"onPanoramaDispose",data:this}),function t(e){for(var n=e.geometry,i=e.material,o=e.children.length-1;0<=o;o--)t(e.children[o]),e.remove(e.children[o]);n&&(n.dispose(),e.geometry=null),i&&(i.dispose(),e.material=null)}(this),this.parent&&this.parent.remove(this)}}),v.prototype=Object.assign(Object.create(m.prototype),{constructor:v,load:function(t){(t=t||this.src)?"string"==typeof t?h.load(t,this.onLoad.bind(this),this.onProgress.bind(this),this.onError.bind(this)):t instanceof HTMLImageElement&&this.onLoad(new e.Texture(t)):console.warn("Image source undefined")},onLoad:function(t){t.minFilter=t.magFilter=e.LinearFilter,t.needsUpdate=!0,this.updateTexture(t),window.requestAnimationFrame(m.prototype.onLoad.bind(this))},reset:function(){m.prototype.reset.call(this)},dispose:function(){var t;this.material&&(t=this.material.map),e.Cache.remove(this.src),t&&t.dispose(),m.prototype.dispose.call(this)}}),new e.Texture,new e.Matrix4,["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = vec4( position, 1.0 );","}"].join("\n"),["uniform sampler2D tDiffuse;","uniform float resolution;","uniform mat4 transform;","uniform float zoom;","uniform float opacity;","varying vec2 vUv;","const float PI = 3.141592653589793;","void main(){","vec2 position = -1.0 +  2.0 * vUv;","position *= vec2( zoom * resolution, zoom * 0.5 );","float x2y2 = position.x * position.x + position.y * position.y;","vec3 sphere_pnt = vec3( 2. * position, x2y2 - 1. ) / ( x2y2 + 1. );","sphere_pnt = vec3( transform * vec4( sphere_pnt, 1.0 ) );","vec2 sampleUV = vec2(","(atan(sphere_pnt.y, sphere_pnt.x) / PI + 1.0) * 0.5,","(asin(sphere_pnt.z) / PI + 0.5)",");","gl_FragColor = texture2D( tDiffuse, sampleUV );","gl_FragColor.a *= opacity;","}"].join("\n"),f.prototype=Object.assign(Object.create(e.EventDispatcher.prototype),{constructor:f}),E.prototype=Object.assign(Object.create(e.EventDispatcher.prototype),{constructor:E}),b.prototype=Object.assign(Object.create(e.EventDispatcher.prototype),{constructor:b,add:function(t){if(1<arguments.length){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}this.scene.add(t),t.addEventListener&&t.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),t instanceof m&&t.dispatchEvent&&t.dispatchEvent({type:"panolens-container",container:this.container}),"panorama"===t.type&&(this.addPanoramaEventListener(t),this.panorama||this.setPanorama(t))},remove:function(t){t.removeEventListener&&t.removeEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),this.scene.remove(t)},addDefaultControlBar:function(t){if(t)if(this.widget)console.warn("Default control bar exists");else{var e=new p(this.container);e.addEventListener("panolens-viewer-handler",this.eventHandler.bind(this)),e.addControlBar(),t.forEach((function(t){e.addControlButton(t)})),this.widget=e}},setPanorama:function(t){var e=this.panorama;"panorama"===t.type&&e!==t&&(t.addEventListener("enter-fade-start",(function n(){e&&e.onLeave(),t.removeEventListener("enter-fade-start",n)})),(this.panorama=t).onEnter())},eventHandler:function(t){t.method&&this[t.method]&&this[t.method](t.data)},dispatchEventToChildren:function(t){this.scene.traverse((function(e){e.dispatchEvent&&e.dispatchEvent(t)}))},activateWidgetItem:function(){},enableEffect:function(){},disableEffect:function(){},enableReticleControl:function(){},disableReticleControl:function(){},enableAutoRate:function(){},disableAutoRate:function(){clearTimeout(this.autoRotateRequestId),this.options.autoRotate=!1,this.OrbitControls.autoRotate=!1},toggleVideoPlay:function(){},setVideoCurrentTime:function(){},onVideoUpdate:function(){},addUpdateCallback:function(){},removeUpdateCallback:function(){},showVideoWidget:function(){},hideVideoWidget:function(){},updateVideoPlayButton:function(){},addPanoramaEventListener:function(t){t.addEventListener("enter-fade-start",this.setCameraControl.bind(this))},setCameraControl:function(){this.OrbitControls.target.copy(this.panorama.position)},getControl:function(){},getScene:function(){},getCamera:function(){},getRenderer:function(){},getContainer:function(){return this.container},getControlId:function(){},getNextControlId:function(){},getNextControlIndex:function(){},setCameraFov:function(){},enableControl:function(){},disableControl:function(){},toggleNextControl:function(){},getScreenVector:function(){},checkSpriteInViewport:function(){},reverseDraggingDirection:function(){},addReticle:function(){this.reticle=new u(16777215,!0,this.options.dwellTime),this.reticle.hide(),this.camera.add(this.reticle),this.sceneReticle.add(this.camera)},tweenControlCenter:function(){},tweenControlCenterByObject:function(){},onWindowResize:function(t,e){var n=void 0,i=void 0,o=this.container.classList.contains("panolens-container");if(void 0!==t&&void 0!==e)n=t,i=e,this.container._width=t,this.container._height=e;else{var s=/(android)/i.test(window.navigator.userAgent),a=s?Math.min(document.documentElement.clientWidth,window.innerWidth||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=s?Math.min(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientHeight,window.innerHeight||0);n=o?a:this.container.clientWidth,i=o?r:this.container.clientHeight,this.container._width=n,this.container._height=i}this.camera.aspect=n/i,this.camera.updateProjectionMatrix(),this.renderer.setSize(n,i),(this.options.enableReticle||this.tempEnableReticle)&&this.updateReticleEvent(),this.dispatchEvent({type:"window-resize",width:n,height:i}),this.scene.traverse((function(t){t.dispatchEvent&&t.dispatchEvent({type:"window-resize",width:n,height:i})}))},addOutputElement:function(){},outputPosition:function(){},onMouseDown:function(t){t.preventDefault(),this.userMouse.x=0<=t.clientX?t.clientX:t.touches[0].clientX,this.userMouse.y=0<=t.clientY?t.clientY:t.touches[0].clientY,this.userMouse.type="mousedown",this.onTap(t)},onMouseMove:function(t){t.preventDefault(),this.userMouse.type="mousemove",this.onTap(t)},onMouseUp:function(t){var e=!1;this.userMouse.type="mouseup";var n=this.userMouse.x>=t.clientX-this.options.clickTolerance&&this.userMouse.x<=t.clientX+this.options.clickTolerance&&this.userMouse.y>=t.clientY-this.options.clickTolerance&&this.userMouse.y<=t.clientY+this.options.clickTolerance||t.changedTouches&&this.userMouse.x>=t.changedTouches[0].clientX-this.options.clickTolerance&&this.userMouse.x<=t.changedTouches[0].clientX+this.options.clickTolerance&&this.userMouse.y>=t.changedTouches[0].clientY-this.options.clickTolerance&&this.userMouse.y<=t.changedTouches[0].clientY+this.options.clickTolerance?"click":void 0;if((!t||!t.target||t.target.classList.contains("panolens-canvas"))&&(t.preventDefault(),e=t.changedTouches&&1===t.changedTouches.length?this.onTap({clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY},n):this.onTap(t,n),this.userMouse.type="none",!e&&"click"===n)){var i=this.options,o=i.autoHideInfospot,s=i.autoHideControlBar,a=this.panorama,r=this.toggleControlBar;o&&a&&a.toggleInfospotVisibility(),s&&r()}},onTap:function(t,e){var n=this.container.getBoundingClientRect(),i=n.left,o=n.top,s=this.container,a=s.clientWidth,r=s.clientHeight;if(this.raycasterPoint.x=(t.clientX-i)/a*2-1,this.raycasterPoint.y=-(t.clientY-o)/r*2+1,this.raycaster.setFromCamera(this.raycasterPoint,this.camera),this.panorama){("mousedown"!==t.type&&this.touchSupported||this.OUTPUT_INFOSPOT)&&this.outputPosition();var c=this.raycaster.intersectObjects(this.panorama.children,!0),h=this.getConvertedIntersect(c),u=0<c.length?c[0].object:void 0;if("mouseup"===this.userMouse.type&&(h&&this.pressEntityObject===h&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:t}),this.pressEntityObject=void 0),"mouseup"===this.userMouse.type&&(u&&this.pressObject===u&&this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:t}),this.pressObject=void 0),"click"===e?(this.panorama.dispatchEvent({type:"click",intersects:c,mouseEvent:t}),h&&h.dispatchEvent&&h.dispatchEvent({type:"click-entity",mouseEvent:t}),u&&u.dispatchEvent&&u.dispatchEvent({type:"click",mouseEvent:t})):(this.panorama.dispatchEvent({type:"hover",intersects:c,mouseEvent:t}),(this.hoverObject&&0<c.length&&this.hoverObject!==h||this.hoverObject&&0===c.length)&&(this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverleave",mouseEvent:t}),this.reticle.end()),this.hoverObject=void 0),h&&0<c.length&&(this.hoverObject!==h&&(this.hoverObject=h,this.hoverObject.dispatchEvent&&(this.hoverObject.dispatchEvent({type:"hoverenter",mouseEvent:t}),(this.options.autoReticleSelect&&this.options.enableReticle||this.tempEnableReticle)&&this.reticle.start(this.onTap.bind(this,t,"click")))),"mousedown"===this.userMouse.type&&this.pressEntityObject!=h&&(this.pressEntityObject=h,this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressstart-entity",mouseEvent:t})),"mousedown"===this.userMouse.type&&this.pressObject!=u&&(this.pressObject=u,this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressstart",mouseEvent:t})),"mousemove"!==this.userMouse.type&&!this.options.enableReticle||(u&&u.dispatchEvent&&u.dispatchEvent({type:"hover",mouseEvent:t}),this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&this.pressEntityObject.dispatchEvent({type:"pressmove-entity",mouseEvent:t}),this.pressObject&&this.pressObject.dispatchEvent&&this.pressObject.dispatchEvent({type:"pressmove",mouseEvent:t}))),!h&&this.pressEntityObject&&this.pressEntityObject.dispatchEvent&&(this.pressEntityObject.dispatchEvent({type:"pressstop-entity",mouseEvent:t}),this.pressEntityObject=void 0),!u&&this.pressObject&&this.pressObject.dispatchEvent&&(this.pressObject.dispatchEvent({type:"pressstop",mouseEvent:t}),this.pressObject=void 0)),u&&u instanceof Infospot&&(this.infospot=u,"click"===e))return!0;this.options.autoRotate&&"mousemove"!==this.userMouse.type&&(clearTimeout(this.autoRotateRequestId),this.control===this.OrbitControls&&(this.OrbitControls.autoRotate=!1,this.autoRotateRequestId=window.setTimeout(this.enableAutoRate.bind(this),this.options.autoRotateActivationDuration)))}},getConvertedIntersect:function(t){for(var e=void 0,n=0;n<t.length;n++)if(0<=t[n].distance&&t[n].object&&!t[n].object.passThrough){if(t[n].object.entity&&t[n].object.entity.passThrough)continue;if(t[n].object.entity&&!t[n].object.entity.passThrough){e=t[n].object.entity;break}e=t[n].object;break}return e},toggleControlBar:function(){},onKeyDown:function(t){this.options.output&&"none"!==this.options.output&&"Control"===t.key&&(this.OUTPUT_INFOSPOT=!0)},onKeyUp:function(){this.OUTPUT_INFOSPOT=!1},update:function(){l.update(),this.updateCallbacks.forEach((function(t){t()})),this.control.update(),this.scene.traverse(function(t){}.bind(this))},render:function(){this.mode===a.CARDBOARD||this.mode===a.STEREO?(this.renderer.clear(),this.effect.render(this.scene,this.camera),this.effect.render(this.sceneReticle,this.camera)):(this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.renderer.clearDepth(),this.renderer.render(this.sceneReticle,this.camera))},animate:function(){this.requestAnimationId=window.requestAnimationFrame(this.animate.bind(this)),this.onChange()},onChange:function(){this.update(),this.render()},registerMouseAndTouchEvents:function(){var t={passive:!1};this.container.addEventListener("mousedown",this.HANDLER_MOUSE_DOWN,t),this.container.addEventListener("mousemove",this.HANDLER_MOUSE_MOVE,t),this.container.addEventListener("mouseup",this.HANDLER_MOUSE_UP,t),this.container.addEventListener("touchstart",this.HANDLER_MOUSE_DOWN,t),this.container.addEventListener("touchend",this.HANDLER_MOUSE_UP,t)},unregisterMouseAndTouchEvents:function(){this.container.removeEventListener("mousedown",this.HANDLER_MOUSE_DOWN,!1),this.container.removeEventListener("mousemove",this.HANDLER_MOUSE_MOVE,!1),this.container.removeEventListener("mouseup",this.HANDLER_MOUSE_UP,!1),this.container.removeEventListener("touchstart",this.HANDLER_MOUSE_DOWN,!1),this.container.removeEventListener("touchend",this.HANDLER_MOUSE_UP,!1)},registerReticleEvent:function(){this.addUpdateCallback(this.HANDLER_TAP)},unregisterReticleEvent:function(){this.removeUpdateCallback(this.HANDLER_TAP)},updateReticleEvent:function(){var t=this.container.clientWidth/2+this.container.offsetLeft,e=this.container.clientHeight/2;this.removeUpdateCallback(this.HANDLER_TAP),this.HANDLER_TAP=this.onTap.bind(this,{clientX:t,clientY:e}),this.addUpdateCallback(this.HANDLER_TAP)},registerEventListeners:function(){window.addEventListener("resize",this.HANDLER_WINDOW_RESIZE,!0),window.addEventListener("keydown",this.HANDLER_KEY_DOWN,!0),window.addEventListener("keyup",this.HANDLER_KEY_UP,!0)},unregisterEventListeners:function(){window.removeEventListener("resize",this.HANDLER_WINDOW_RESIZE,!0),window.removeEventListener("keydown",this.HANDLER_KEY_DOWN,!0),window.removeEventListener("keyup",this.HANDLER_KEY_UP,!0)},dispose:function(){this.tweenLeftAnimation.stop(),this.tweenUpAnimation.stop(),this.unregisterEventListeners(),function t(e){for(var n=e.children.length-1;0<=n;n--)t(e.children[n]),e.remove(e.children[n]);e instanceof m?(e.dispose(),e=null):e.dispatchEvent&&e.dispatchEvent("dispose")}(this.scene),this.widget&&(this.widget.dispose(),this.widget=null),e.Cache&&e.Cache.enabled&&e.Cache.clear()},destroy:function(){this.dispose(),this.render(),window.cancelAnimationFrame(this.requestAnimationId)},onPanoramaDispose:function(t){t===this.panorama&&(this.panorama=null)},loadAsyncRequest:function(t,e){var n=1<arguments.length&&void 0!==e?e:function(){},i=new window.XMLHttpRequest;i.onloadend=function(t){n(t)},i.open("GET",t,!0),i.send(null)},addViewIndicator:function(){},appendControlItem:function(){},clearAllCache:function(){e.Cache.clear()}}),e.REVISION!=o&&console.warn("three.js version is not matched. Please consider use the target revision "+o),window.TWEEN=l,t.CONTROLS={ORBIT:0,DEVICEORIENTATION:1},t.DataImage=r,t.ImageLoader=c,t.ImagePanorama=v,t.MODES=a,t.Panorama=m,t.REVISION=i,t.Reticle=u,t.THREE_REVISION=o,t.THREE_VERSION=s,t.TextureLoader=h,t.VERSION="0.11.0",t.Viewer=b,t.Widget=p,Object.defineProperty(t,"__esModule",{value:!0})}(t.BAIVLENS={},t.BAIV3);