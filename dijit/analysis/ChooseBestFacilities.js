// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.29/esri/copyright.txt for details.

define(["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","dojo/_base/connect","dojo/_base/json","dojo/_base/fx","dojo/has","dojo/json","dojo/string","dojo/dom-style","dojo/dom-attr","dojo/dom-construct","dojo/query","dojo/dom-class","dojo/fx/easing","dojo/number","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_OnDijitClickMixin","dijit/_FocusMixin","dijit/registry","dijit/form/Button","dijit/form/CheckBox","dijit/form/Form","dijit/form/Select","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/layout/ContentPane","dijit/form/FilteringSelect","dijit/form/NumberSpinner","dijit/form/NumberTextBox","dijit/form/TimeTextBox","dijit/form/DateTextBox","dijit/layout/StackContainer","dojox/mvc/at","../../kernel","../../lang","../../graphic","./AnalysisBase","./_AnalysisOptions","./AnalysisRegistry","./AnalysisToolItem","./CreditEstimator","./utils","./TrafficTime","../../toolbars/draw","../PopupTemplate","../../layers/FeatureLayer","../../symbols/PictureMarkerSymbol","./components/AddBarrierLayers/AddBarrierLayers","dojo/i18n!../../nls/jsapi","dojo/text!./templates/ChooseBestFacilities.html"],function(e,t,i,a,s,n,r,l,o,d,h,c,u,y,m,_,L,p,g,F,f,C,v,b,T,x,S,w,q,D,R,B,O,A,N,M,k,I,E,j,P,U,H,G,V,z,W,J,Z,K,Y,Q,X,$,ee){var te=t([g,F,f,C,v,H,U],{declaredClass:"esri.dijit.analysis.ChooseBestFacilities",templateString:ee,esriDijitPath:e.toUrl(".."),widgetsInTemplate:!0,outputLayerName:null,pointBarriers:null,pointBarrierLayer:null,lineBarriers:null,lineBarrierLayer:null,polygonBarriers:null,polygonBarrierLayer:null,forbiddenLayers:[],distanceDefaultUnits:"Miles",i18n:null,toolName:"ChooseBestFacilities",helpFileName:"ChooseBestFacilities",resultParameter:["allocatedDemandLocationsLayer","allocationLinesLayer","assignedFacilitiesLayer"],getResultLyrInfos:!0,featureCount:{},featureCountByExtent:{},featureLayers:[],demandLocationLayers:[],selectTypes:{dLocation:"demandLocation",rFacility:"requiredFacility",cFacility:"candidateFacility"},constructor:function(e,t){this._pbConnects=[],e.containerNode&&(this.container=e.containerNode),e.demandLocationsLayer&&this.set("demandLocationLayer",e.demandLocationsLayer)},destroy:function(){this.inherited(arguments),a.forEach(this._pbConnects,n.disconnect),delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments),i.mixin(this.i18n,$.common),i.mixin(this.i18n,$.bufferTool),i.mixin(this.i18n,$.driveTimes),i.mixin(this.i18n,$.planRoutesTool),i.mixin(this.i18n,$.toolbars),i.mixin(this.i18n,$.chooseBestFacilitiesTool)},postCreate:function(){this.inherited(arguments);var e={};e.root="toolContainer esriCBLfirstGoal",this._goalNode1.set("cssClass",e),_.add(this._form.domNode,"esriSimpleForm"),this._outputLayerInput.set("validator",i.hitch(this,this.validateServiceName)),this._stackContainer=new k({doLayout:!1},this._stackDiv),this._stackContainer.addChild(this._firstPane),this._stackContainer.addChild(this._mainPane),this._buildUI()},startup:function(){this._stackContainer.startup()},_handleModeCrumbClick:function(e){e.preventDefault(),this._onClose(!0)},_onClose:function(e){if(this._stackContainer.get("selectedChildWidget")===this._mainPane&&!1!==e){this._toolTitle.innerHTML=this.i18n.chooseBestFacilities,c.set(this._toolTd,"display","table-cell"),this._stackContainer.selectChild(this._firstPane),u.set(this._closeBtn,"title",this.i18n.close),u.set(this._toolDescNode,"esriHelpTopic","toolDescription");var t=["allocateIcon","minimizeIcon","maximizeIcon","maximizelimIcon","percentageIcon"];a.forEach(t,function(e){_.contains(this._toolIcon,e)&&_.remove(this._toolIcon,e)},this),_.add(this._toolIcon,"chooseBestFacilitiesIcon")}else this.emit("close",{save:!e})},clear:function(){},_buildJobParams:function(){var e,t,i={};return i.goal=this.get("goal"),this.demandLocationLayer&&(i.demandLocationsLayer=r.toJson(this.constructAnalysisInputLyrObj(this.demandLocationLayer))),this.get("demandField")&&"attribute"===this.get("demandType")?i.demandField=this.get("demandField"):i.demand=this.get("demand"),this.get("maxTravelRangeField")&&"attribute"===this.get("maxTravelRangeType")?(i.maxTravelRangeField=this.get("maxTravelRangeField"),i.maxTravelRangeUnits=this.get("maxTravelRangeUnits")):this.get("maxTravelRange")&&(i.maxTravelRange=parseFloat(this.get("maxTravelRange"),10),i.maxTravelRangeUnits=this.get("maxTravelRangeUnits")),i.travelDirection=this.get("travelDirection"),t=this._travelModeSelect.getOptions(this._travelModeSelect.get("value")),i.travelMode=t&&r.toJson(t.travelMode),this._trafficTimeWidget.get("checked")&&(i.timeOfDay=this._trafficTimeWidget.get("timeOfDay"),"UTC"===this._trafficTimeWidget.get("timeZoneForTimeOfDay")&&(i.timeZoneForTimeOfDay=this._trafficTimeWidget.get("timeZoneForTimeOfDay"))),"NONE"!==this._requiredFacilitiesLayerSelect.get("value")&&this.requiredFacilitiesLayer&&(i.requiredFacilitiesLayer=r.toJson(this.constructAnalysisInputLyrObj(this.requiredFacilitiesLayer)),"Allocate"!==i.goal&&"MaximizeCapacitatedCoverage"!==i.goal||(this.get("requiredFacilitiesCapacityField")&&"attribute"===this.get("requiredCapacityType")?i.requiredFacilitiesCapacityField=this.get("requiredFacilitiesCapacityField"):this.get("requiredFacilitiesCapacity")&&"constant"===this.get("requiredCapacityType")&&(i.requiredFacilitiesCapacity=parseFloat(this.get("requiredFacilitiesCapacity"),10)))),"Allocate"!==i.goal&&this.candidateFacilitiesLayer&&(i.candidateFacilitiesLayer=r.toJson(this.constructAnalysisInputLyrObj(this.candidateFacilitiesLayer)),"PercentCoverage"!==i.goal&&(i.candidateCount=this._candidatesInput.get("value")),"MaximizeCapacitatedCoverage"===i.goal&&(this.get("candidateFacilitiesCapacityField")&&"attribute"===this.get("candidateCapacityType")?i.candidateFacilitiesCapacityField=this.get("candidateFacilitiesCapacityField"):this.get("candidateFacilitiesCapacity")&&"constant"===this.get("candidateCapacityType")&&(i.candidateFacilitiesCapacity=parseFloat(this.get("candidateFacilitiesCapacity"),10)))),"PercentCoverage"===this.get("goal")&&(i.percentDemandCoverage=this._percentDemandCoverageValue.get("value")),this.returnFeatureCollection||(i.OutputName=r.toJson({serviceProperties:{name:this.get("outputLayerName")}})),this.showChooseExtent&&this._useExtentCheck.get("checked")&&(i.context=r.toJson({extent:this.map.extent._normalize(!0)})),this.returnFeatureCollection&&(e={outSR:this.map.spatialReference},this.showChooseExtent&&this._useExtentCheck.get("checked")&&(e.extent=this.map.extent._normalize(!0)),i.context=r.toJson(e)),i=this._addBarrierstoJobParams(i,this._addBarrierLayersComponent.get("barrierLayers"))},_handleShowCreditsClick:function(e){e.preventDefault(),this._candidateFacilityLyrSelect.get("disabled")&&this._candidateFacilityLyrSelect.get("required")&&this._candidateFacilityLyrSelect.set("disabled",!1);var t=this._buildJobParams();this.isValidServLimits=this.validateServiceLimits(t),this._form.validate()&&this.isValidServLimits&&this.getCreditsEstimate(this.toolName,t).then(i.hitch(this,function(e){this._usageForm.set("content",e),this._usageDialog.show()}))},_handleSaveBtnClick:function(e){var t={};this._candidateFacilityLyrSelect.get("disabled")&&this._candidateFacilityLyrSelect.get("required")&&this._candidateFacilityLyrSelect.set("disabled",!1),t.jobParams=this._buildJobParams(),this.isValidServLimits=this.validateServiceLimits(t.jobParams),this._form.validate()&&this.isValidServLimits&&(this._saveBtn.set("disabled",!1),t.itemParams={},this.showSelectFolder&&(t.itemParams.folder=this.get("folderId")),this.execute(t))},_handleResultLyrInputChange:function(e){this.set("outputLayerName",e)},_handleModeChange:function(e){var t,i,a;a=this._travelModeSelect.getOptions(this._travelModeSelect.get("value")),j.isDefined(a)?(t="Time"===a.units,i="Time"===a.units&&("driving"===a.modei18nKey||"trucking"===a.modei18nKey)):(t=-1!==e.indexOf("Time"),i="DrivingTime"===e),c.set(this._useTrafficLabelRow,"display",i?"":"none"),t?(this._maxTravelRangeUnitsSelect.removeOption(this._maxTravelRangeUnitsSelect.getOptions()),this._maxTravelRangeUnitsSelect.addOption([{value:"Seconds",label:this.i18n.seconds},{value:"Minutes",label:this.i18n.minutes,selected:"selected"},{value:"Hours",label:this.i18n.hours}]),this.maxTravelRangeUnits&&this._maxTravelRangeUnitsSelect.set("value",this.maxTravelRangeUnits),this.set("maxTravelRangeUnits",this._maxTravelRangeUnitsSelect.get("value"))):(this.get("distanceDefaultUnits")&&this.set("maxTravelRangeUnits",this.get("distanceDefaultUnits")),this._maxTravelRangeUnitsSelect.removeOption(this._maxTravelRangeUnitsSelect.getOptions()),this._maxTravelRangeUnitsSelect.addOption([{value:"Miles",label:this.i18n.miles},{value:"Yards",label:this.i18n.yards},{value:"Feet",label:this.i18n.feet},{type:"separator"},{value:"Kilometers",label:this.i18n.kilometers},{value:"Meters",label:this.i18n.meters}]),this._maxTravelRangeUnitsSelect.set("value",this.maxTravelRangeUnits))},_handleDistUnitsChange:function(){},_handleDistValueChange:function(){},_handleTravelAttrChange:function(){},_save:function(){},_buildUI:function(){var e=!0;this._loadConnections(),this.signInPromise.then(i.hitch(this,W.initHelpLinks,this.domNode,this.showHelp,{analysisGpServer:this.analysisGpServer})),W.getNetworkAnalysisLimits(this).then(i.hitch(this,function(e){this._updateServLimitsUI(e)})),this.featureLayers&&this.requiredFacilitiesLayer&&!W.isLayerInLayers(this.requiredFacilitiesLayer,this.featureLayers)&&this.featureLayers.push(this.requiredFacilitiesLayer),this.featureLayers&&this.candidateFacilitiesLayer&&!W.isLayerInLayers(this.candidateFacilitiesLayer,this.featureLayers)&&this.featureLayers.push(this.candidateFacilitiesLayer),this.demandLocationLayers&&this.demandLocationLayer&&!W.isLayerInLayers(this.demandLocationLayer,this.demandLocationLayers)&&this.demandLocationLayers.push(this.demandLocationLayer),c.set(this._chooseFolderRow,"display",!0===this.showSelectFolder?"block":"none"),c.set(this._showCreditsLink,"display",!0===this.showCredits?"block":"none"),this.showSelectFolder&&this.getFolderStore().then(i.hitch(this,function(e){this.folderStore=e,W.setupFoldersUI({folderStore:this.folderStore,folderId:this.folderId,folderName:this.folderName,folderSelect:this._webMapFolderSelect,username:this.portalUser?this.portalUser.username:""})})),c.set(this._chooseExtentDiv,"display",!0===this.showChooseExtent?"inline-block":"none"),this.get("showSelectAnalysisLayer")&&(this.get("demandLocationLayer")||!this.get("demandLocationLayers")||this.rerun||this.set("demandLocationLayer",this.demandLocationLayers[0]),W.populateAnalysisLayers(this,"demandLocationLayer","demandLocationLayers")),W.addReadyToUseLayerOption(this,[this._analysisSelect,this._requiredFacilitiesLayerSelect,this._candidateFacilityLyrSelect]);var t=this.on("travelmodes-added",i.hitch(this,function(){this._handleModeChange(this._travelModeSelect.get("value")),t.remove(),t=null}));W.populateTravelModes({selectWidget:this._travelModeSelect,widget:this,enableTravelModes:this.get("enableTravelModes"),selectDefaultMode:!0,value:this.travelMode}),this.timeOfDay&&(this._trafficTimeWidget.set("checked",!0),this._trafficTimeWidget.set("timeZoneForTimeOfDay","GeoLocal"),this._trafficTimeWidget.set("timeOfDay",this.timeOfDay)),this.outputLayerName&&(this._outputLayerInput.set("value",this.outputLayerName),e=!1),this.i18n.allocate,this.i18n.minimizeImpedance,this.i18n.maximizeCoverage,this.i18n.maximizeCapacitatedCoverage,this.i18n.percentCoverage,this._constant1Value.set("value",I(this,"demand")),this._attributeSelect1.set("value",I(this,"demandField")),this._attributeSelect3.set("value",I(this,"requiredFacilitiesCapacityField")),this._attributeSelect4.set("value",I(this,"candidateFacilitiesCapacityField")),this._maxTravelRangeField.set("value",I(this,"maxTravelRange")),this._maxTravelRangeFieldSelect.set("value",I(this,"maxTravelRangeField")),this._maxTravelRangeUnitsSelect.set("value",I(this,"maxTravelRangeUnits")),this._constant3Value.set("value",I(this,"requiredFacilitiesCapacity")),this._constant4Value.set("value",I(this,"candidateFacilitiesCapacity")),this._candidatesInput.set("value",I(this,"candidateCount")),this._percentDemandCoverageValue.set("value",I(this,"percentDemandCoverage")),this.demandLocationLayer&&this._handleAnalysisLayerChange(this._analysisSelect.get("value"),!e),this._addBarrierLayersComponent.buildUI({pointBarrierLayer:this.pointBarrierLayer,pointBarriers:this.pointBarriers,lineBarrierLayer:this.lineBarrierLayer,lineBarriers:this.lineBarriers,polygonBarrierLayer:this.polygonBarrierLayer,polygonBarriers:this.polygonBarriers,forbiddenLayers:this.forbiddenLayers,showBrowseLayers:this.showBrowseLayers,map:this.get("map"),portalSelf:this.get("portalSelf"),portalUrl:this.get("portalUrl"),useArcGISComponents:this.useArcGISComponents,isSingleTenant:this.isSingleTenant})},_updateServLimitsUI:function(e){if(e&&(this.serviceLimits=e),e||this.serviceLimits){var t=this._candidatesInput.get("constraints"),i=this.showChooseExtent&&this._useExtentCheck.get("checked")?this.featureCountByExtent:this.featureCount;t.max=this.serviceLimits.maximumFacilitiesToFind||t.max,this.goal&&"NONE"!==this._requiredFacilitiesLayerSelect.get("value")&&this.requiredFacilitiesLayer&&this.serviceLimits.maximumFacilitiesToFind&&i.requiredFacilitiesLayer&&(t.max=this.serviceLimits.maximumFacilitiesToFind-i.requiredFacilitiesLayer),this._candidatesInput.set("constraints",t),this._candidatesInput.set("value",this.candidateCount||t.min)}},_updateAnalysisLayerUI:function(e){if(e||("Allocate"===this.goal?this._handleGoalSelect(this._goalNode1,!e):"MinimizeImpedance"===this.goal?this._handleGoalSelect(this._goalNode2,!e):"MaximizeCoverage"===this.goal?this._handleGoalSelect(this._goalNode3,!e):"MaximizeCapacitatedCoverage"===this.goal?this._handleGoalSelect(this._goalNode4,!e):"PercentCoverage"===this.goal&&this._handleGoalSelect(this._goalNode5,!e)),j.isDefined(this.demandLocationLayer)&&j.isDefined(this.demandLocationLayer.queryCount)&&(W.getLayerFeatureCount(this.demandLocationLayer,{}).then(i.hitch(this,function(e){this.set("featureCount",{demandLocationLayer:e}),u.set(this._numDemandLabel,"innerHTML",h.substitute(this.i18n.demandLabel,{numberOf:e}))}),function(e){console.log(e)}),e&&(this.outputLayerName=h.substitute(this.i18n.outputLayerName,{demandLayer:this.demandLocationLayer.name}))),this.outputLayerName&&e&&this._outputLayerInput.set("value",this.outputLayerName),this.featureLayers){var t=a.some(this._requiredFacilitiesLayerSelect.getOptions(),function(e){return"NONE"===e.value},this);W.addOptionsFromLayers({select:this._requiredFacilitiesLayerSelect,widget:this,customOptions:t||!e?[{value:"NONE",label:this.i18n.noneReqOption},{type:"separator",value:""}]:[],selectedOption:this.requiredFacilitiesLayer,layers:this.featureLayers,forbiddenLayers:[this.demandLocationLayer,this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer]}),W.addOptionsFromLayers({select:this._candidateFacilityLyrSelect,widget:this,selectedOption:this.candidateFacilitiesLayer,layers:this.featureLayers,forbiddenLayers:[this.demandLocationLayer,this.requiredFacilitiesLayer,this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer]}),this._handleFacilityLayerChange(this._requiredFacilitiesLayerSelect.get("value")),this._handleCandFacilityLayerChange(this._candidateFacilityLyrSelect.get("value"))}this._updateExtentLabels(),this._handleExtentCheckChange(this.showChooseExtent);var s=j.isDefined(this.demandLocationLayer),n=j.isDefined(this.requiredFacilitiesLayer),r=j.isDefined(this.candidateFacilitiesLayer),l=this.get("goal"),o="MaximizeCapacitatedCoverage"===l;n&&j.isDefined(this.requiredFacilitiesLayer.queryCount)&&W.getLayerFeatureCount(this.requiredFacilitiesLayer,{}).then(i.hitch(this,function(e){this.set("featureCount",{requiredFacilitiesLayer:e}),u.set(this._numFacilitiesLabel,"innerHTML",h.substitute(this.i18n.facilitiesNumLabel,{numberOf:e}))}),function(e){console.log(e)}),r&&j.isDefined(this.candidateFacilitiesLayer.queryCount)&&W.getLayerFeatureCount(this.candidateFacilitiesLayer,{}).then(i.hitch(this,function(e){this.set("featureCount",{candidateFacilitiesLayer:e}),u.set(this._candFacilitiesLabel,"innerHTML",h.substitute(this.i18n.candidateNumLabel,{numberOf:e}))}),function(e){console.log(e)}),s&&(this._maxTravelRangeFieldSelect.removeOption(this._maxTravelRangeFieldSelect.getOptions()),this._populateAttributeSelect(this._maxTravelRangeFieldSelect,this.demandLocationLayer.fields,!1,this._attribute2,this._handleCapacityTypeChange),this.maxTravelRangeField&&this._maxTravelRangeFieldSelect.getOptions().length>0&&this._maxTravelRangeFieldSelect.set("value",this.maxTravelRangeField),this._populateAttributeSelect(this._attributeSelect1,this.demandLocationLayer.fields,!0,this._attribute1,this._handleDemandCapacityTypeChange)),n&&this._populateAttributeSelect(this._attributeSelect3,this.requiredFacilitiesLayer.fields,!1,this._attribute3,this._handleRequiredCapacityTypeChange),r&&this._populateAttributeSelect(this._attributeSelect4,this.candidateFacilitiesLayer.fields,!1,this._attribute4,this._handleCandidateCapacityTypeChange),e?(this._handleDemandCapacityTypeChange("constant"),this._handleCapacityTypeChange(o?"constant":"unlimited"),this._handleRequiredCapacityTypeChange(o?"constant":"unlimited"),this._handleCandidateCapacityTypeChange(o?"constant":"unlimited")):(this.demand&&(this._constant1Value.set("value",this.demand),this._handleDemandCapacityTypeChange("constant")),this.demandField&&(this._attributeSelect1.set("value",this.demandField),this._handleDemandCapacityTypeChange("attribute")),this.requiredFacilitiesCapacityField&&(this._attributeSelect3.set("value",this.requiredFacilitiesCapacityField),this._handleRequiredCapacityTypeChange("attribute")),this.requiredFacilitiesCapacity&&(this._constant3Value.set("value",this.requiredFacilitiesCapacity),this._handleRequiredCapacityTypeChange("constant")),this.candidateFacilitiesCapacityField&&(this._attributeSelect4.set("value",this.candidateFacilitiesCapacityField),this._handleCandidateCapacityTypeChange("attribute")),this.candidateFacilitiesCapacity&&(this._constant4Value.set("value",this.candidateFacilitiesCapacity),this._handleCandidateCapacityTypeChange("constant")),this.maxTravelRange&&(this._maxTravelRangeField.set("value",this.maxTravelRange),this._handleCapacityTypeChange("constant")),this.maxTravelRangeField&&(this._maxTravelRangeFieldSelect.set("value",this.maxTravelRangeField),this._handleCapacityTypeChange("attribute")),this.maxTravelRangeUnits&&this._maxTravelRangeUnitsSelect.set("value",this.maxTravelRangeUnits),this.candidateCount&&this._candidatesInput.set("value",this.candidateCount),this.percentDemandCoverage&&this._percentDemandCoverageValue.set("value",this.percentDemandCoverage),"FacilityToDemand"===this.travelDirection?this._handleDemandTypeChange("facility"):"DemandToFacility"===this.travelDirection?this._handleDemandTypeChange("demand"):this._handleDemandTypeChange("facility"))},_updateDmndLocateOpts:function(){W.addOptionsFromLayers({select:this._analysisSelect,widget:this,selectedOption:this.demandLocationLayer,layers:this.demandLocationLayers,forbiddenLayers:[this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer]}),this._handleAnalysisLayerChange(this._analysisSelect.get("value"))},_handleGoalChange:function(e,t){var i="Allocate"===e,s="PercentCoverage"===e,n="MaximizeCoverage"===e,r="MaximizeCapacitatedCoverage"===e,l={value:"NONE",label:this.i18n.noneReqOption};if(c.set(this._candidateLabelRow,"display",i?"none":"table-row"),c.set(this._candidateCountLabelRow,"display",i||s?"none":"table-row"),c.set(this._candidateCountRow,"display",i||s?"none":"table-row"),this._candidatesInput.set("required",!(i||s)),c.set(this._candidatePercentLabelRow,"display",s?"table-row":"none"),c.set(this._candidatePercentRow,"display",s?"table-row":"none"),c.set(this._candidateCapacityLabelRow,"display",r?"table-row":"none"),c.set(this._candidateCapacityRow,"display",r?"table-row":"none"),c.set(this._candidateCapacityRow,"display",r?"table-row":"none"),c.set(this._candidateLyrSelectRow,"display",i?"none":"table-row"),c.set(this._candidateLyrLabelRow,"display",i?"none":"table-row"),c.set(this._candFacilityNumRow,"display",i?"none":"table-row"),c.set(this._candFacilityNumExtentRow,"display",i?"none":"table-row"),c.set(this._unlimited2,"display",n?"none":"block"),_.toggle(this._unlimited2,"selected",!n),_.toggle(this._constant2,"selected",n),c.set(this._unlimited3,"display",r?"none":"block"),_.toggle(this._unlimited3,"selected",!r),_.toggle(this._constant3,"selected",r),c.set(this._unlimited4,"display",r?"none":"block"),_.toggle(this._unlimited4,"selected",!r),_.toggle(this._constant4,"selected",r),c.set(this._reqdCapLabelRow,"display",i||r?"table-row":"none"),c.set(this._reqdCapAttrRow,"display",i||r?"table-row":"none"),!t)if(this._handleCapacityTypeChange(n?"constant":"unlimited"),this._handleRequiredCapacityTypeChange(r?"constant":"unlimited"),this._handleCandidateCapacityTypeChange(r?"constant":"unlimited"),i)W.addOptionsFromLayers({select:this._requiredFacilitiesLayerSelect,widget:this,selectedOption:this.requiredFacilitiesLayer,layers:this.featureLayers,forbiddenLayers:[this.demandLocationLayer,this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer]}),this._requiredFacilitiesLayerSelect.set("required",!0),this._candidateFacilityLyrSelect.set("required",!1);else{var o=a.some(this._requiredFacilitiesLayerSelect.getOptions(),function(e){return e.value===l.value},this);o||W.addOptionsFromLayers({select:this._requiredFacilitiesLayerSelect,widget:this,customOptions:[l,{type:"separator",value:""}],selectedOption:this.requiredFacilitiesLayer,layers:this.featureLayers,forbiddenLayers:[this.demandLocationLayer,this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer]}),this._requiredFacilitiesLayerSelect.set("value",l.value),this._requiredFacilitiesLayerSelect.set("required",!1),this._candidateFacilityLyrSelect.set("required",!0)}u.set(this._labelFive,"innerHTML",i?this.i18n.fourLabel:this.i18n.fiveLabel),this.set("doValidate",!this.doValidate)},_handleAnalysisLayerChange:function(e,t){this._analaysisSelectType=this.selectTypes.dLocation,"browse"===e||"browselayers"===e?(this._browseSelect=this._analysisSelect,this._browseLayers=this.demandLocationLayers,this._createBrowseItems({browseValue:e,disabledSubResources:[this.get("demandLocationLayer"),this.pointBarrierLayer]},{tags:["point"],geometryTypes:[G.GeometryTypes.Point]},this._analysisSelect)):(this.set("demandLocationLayer",this.demandLocationLayers[e]||this._analysisSelect.get("value")),this._updateAnalysisLayerUI(!t))},_handlePrevBtnClick:function(){this._stackContainer.selectChild(this._firstPane)},_handleNextBtnClick:function(){this._stackContainer.selectChild(this._mainPane)},_handleGoalSelect:function(e,t){var a;this._prevTool&&_.remove(this._prevTool._toolCtr,"toolSelected"),"allocateToExistingFacilities"===e.helpTopic?a="Allocate":"minimizeTravel"===e.helpTopic?a="MinimizeImpedance":"maximizeCoverage"===e.helpTopic?a="MaximizeCoverage":"maximizeCoverageWithCapacity"===e.helpTopic?a="MaximizeCapacitatedCoverage":"coverAPercentageOfDemand"===e.helpTopic&&(a="PercentCoverage"),this.set("goal",a),_.add(e._toolCtr,"toolSelected"),this._prevTool=e,this._toolTitle.innerHTML=e.name,_.remove(this._toolIcon,"chooseBestFacilitiesIcon"),_.add(this._toolIcon,e._toolIconClass),t?setTimeout(i.hitch(this,function(){this._stackContainer.selectChild(this._mainPane)}),100):this._stackContainer.selectChild(this._mainPane),u.set(this._closeBtn,"title",this.i18n.back),u.set(this._toolDescNode,"esriHelpTopic",e.helpTopic),this._handleGoalChange(a,t)},_loadConnections:function(){this.on("start",i.hitch(this,"_onClose",!1)),this._connect(this._closeBtn,"onclick",i.hitch(this,"_onClose",!0)),n.connect(this._facilitytodemand,"onclick",i.hitch(this,this._handleDemandTypeChange,"facility")),n.connect(this._demandtofacility,"onclick",i.hitch(this,this._handleDemandTypeChange,"demand")),n.connect(this._constant1,"onclick",i.hitch(this,this._handleDemandCapacityTypeChange,"constant")),this._attribute1._clickHandle=n.connect(this._attribute1,"onclick",i.hitch(this,this._handleDemandCapacityTypeChange,"attribute")),n.connect(this._constant2,"onclick",i.hitch(this,this._handleCapacityTypeChange,"constant")),n.connect(this._unlimited2,"onclick",i.hitch(this,this._handleCapacityTypeChange,"unlimited")),this._attribute2._clickHandle=n.connect(this._attribute2,"onclick",i.hitch(this,this._handleCapacityTypeChange,"attribute")),n.connect(this._constant3,"onclick",i.hitch(this,this._handleRequiredCapacityTypeChange,"constant")),n.connect(this._unlimited3,"onclick",i.hitch(this,this._handleRequiredCapacityTypeChange,"unlimited")),this._attribute3._clickHandle=n.connect(this._attribute3,"onclick",i.hitch(this,this._handleRequiredCapacityTypeChange,"attribute")),this._attribute4._clickHandle=n.connect(this._attribute4,"onclick",i.hitch(this,this._handleCandidateCapacityTypeChange,"attribute")),n.connect(this._constant4,"onclick",i.hitch(this,this._handleCandidateCapacityTypeChange,"constant")),n.connect(this._unlimited4,"onclick",i.hitch(this,this._handleCandidateCapacityTypeChange,"unlimited")),this.own(this._goalNode1.on("tool-select",i.hitch(this,this._handleGoalSelect)),this._goalNode2.on("tool-select",i.hitch(this,this._handleGoalSelect)),this._goalNode3.on("tool-select",i.hitch(this,this._handleGoalSelect)),this._goalNode4.on("tool-select",i.hitch(this,this._handleGoalSelect)),this._goalNode5.on("tool-select",i.hitch(this,this._handleGoalSelect)),this.watch("doValidate",i.hitch(this,function(e,t,i){this._updateServLimitsUI(),this.get("goal")&&(this.isValidServLimits=this.validateServiceLimits(this._buildJobParams()))}))),this.own(this._addBarrierLayersComponent.on("add-ready-to-use-layer",i.hitch(this,function(e){this.emit("add-ready-to-use-layer",e)})),this._addBarrierLayersComponent.on("update-layer-options",i.hitch(this,function(e){e.pointBarrierLayer?this.set("pointBarrierLayer",e.pointBarrierLayer):e.lineBarrierLayer?this.set("lineBarrierLayer",e.lineBarrierLayer):e.polygonBarrierLayer&&this.set("polygonBarrierLayer",e.polygonBarrierLayer)})))},_candidateLyrWatchHandle:function(e,t,a){var s=j.isDefined(this.candidateFacilitiesLayer),n=!s&&0===this._candidateFacilityLyrSelect.getOptions().length;s&&(this._populateAttributeSelect(this._attributeSelect4,this.candidateFacilitiesLayer.fields,!1,this._attribute4,this._handleCandidateCapacityTypeChange),this._updateExtentLabels()),s&&j.isDefined(this.candidateFacilitiesLayer.queryCount)&&W.getLayerFeatureCount(this.candidateFacilitiesLayer,{}).then(i.hitch(this,function(e){u.set(this._candFacilitiesLabel,"innerHTML",h.substitute(this.i18n.candidateNumLabel,{numberOf:e}))}),function(e){console.log(e)});var r=this.get("goal"),l="Allocate"===r,o="PercentCoverage"===r,d="MaximizeCapacitatedCoverage"===r;c.set(this._candFacilityNumRow,"display",l||n?"none":"table-row"),c.set(this._candFacilityNumExtentRow,"display",l||n?"none":"table-row"),c.set(this._candidateCapacityLabelRow,"display",!n&&d?"table-row":"none"),c.set(this._candidateCapacityRow,"display",!n&&d?"table-row":"none"),c.set(this._candidateCountLabelRow,"display",n||l||o?"none":"table-row"),c.set(this._candidateCountRow,"display",n||l||o?"none":"table-row"),this._candidatesInput.set("required",!(l||o)),this._handleCandidateCapacityTypeChange(d?"constant":"unlimited")},_requiredLyrWatchHandle:function(e,t,a){var s=j.isDefined(this.requiredFacilitiesLayer);W.addOptionsFromLayers({select:this._candidateFacilityLyrSelect,widget:this,selectedOption:this.candidateFacilitiesLayer,layers:this.featureLayers,forbiddenLayers:[this.demandLocationLayer,this.requiredFacilitiesLayer,this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer]}),this._handleCandFacilityLayerChange(this._candidateFacilityLyrSelect.get("value")),s&&(this._populateAttributeSelect(this._attributeSelect3,this.requiredFacilitiesLayer.fields,!1,this._attribute3,this._handleRequiredCapacityTypeChange),this._handleRequiredCapacityTypeChange("MaximizeCapacitatedCoverage"===this.goal?"constant":"unlimited"),this._updateExtentLabels()),s&&j.isDefined(this.requiredFacilitiesLayer.queryCount)&&W.getLayerFeatureCount(this.requiredFacilitiesLayer,{}).then(i.hitch(this,function(e){u.set(this._numFacilitiesLabel,"innerHTML",h.substitute(this.i18n.facilitiesNumLabel,{numberOf:e}))}),function(e){console.log(e)})},_removeSelHandle:function(e){e._clickHandle&&(n.disconnect(e._clickHandle),e._clickHandle=null)},_addSelHandle:function(e,t){e._clickHandle||(e._clickHandle=n.connect(e,"onclick",i.hitch(this,t,"attribute")))},_handleBrowseItemsSelect:function(e,t){e&&e.selection&&W.addAnalysisReadyLayer({item:e.selection,layers:this._browseLayers,layersSelect:this._browseSelect,browseDialog:e.dialog||this._browsedlg,widget:this},t).then(i.hitch(this,function(e){e&&(this._analaysisSelectType===this.selectTypes.dLocation?W.isLayerInLayers(e,[this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer])&&(this.demandLocationLayers.pop(),W.addOptionsFromLayers({select:this._analysisSelect,widget:this,selectedOption:this.demandLocationLayer,layers:this.demandLocationLayers,forbiddenLayers:[this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer]})):this._analaysisSelectType===this.selectTypes.rFacility?W.isLayerInLayers(e,[this.demandLocationLayer,this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer])&&(this.featureLayers.pop(),W.addOptionsFromLayers({select:this._requiredFacilitiesLayerSelect,widget:this,selectedOption:this.requiredFacilitiesLayer,layers:this.featureLayers,forbiddenLayers:[this.demandLocationLayer,this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer]})):this._analaysisSelectType===this.selectTypes.cFacility&&W.isLayerInLayers(e,[this.demandLocationLayer,this.requiredFacilitiesLayer,this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer])&&(this.featureLayers.pop(),W.addOptionsFromLayers({select:this._candidateFacilityLyrSelect,widget:this,selectedOption:this.candidateFacilitiesLayer,layers:this.featureLayers,forbiddenLayers:[this.demandLocationLayer,this.requiredFacilitiesLayer,this.pointBarrierLayer,this.lineBarrierLayer,this.polygonBarrierLayer]})))}))},_handleFacilityLayerChange:function(e){this._analaysisSelectType=this.selectTypes.rFacility;var t=this.get("goal"),a="Allocate"===t,s="MaximizeCapacitatedCoverage"===t;"browse"===e||"browselayers"===e?(this._browseSelect=this._requiredFacilitiesLayerSelect,this._browseLayers=this.featureLayers,this._createBrowseItems({browseValue:e,disableLAAL:!0,disableBoundary:!0,disabledSubResources:[this.get("demandLocationLayer"),this.requiredFacilitiesLayer,this.pointBarrierLayer]},{geometryTypes:[G.GeometryTypes.Point]},this._requiredFacilitiesLayerSelect)):(this.set("requiredFacilitiesLayer","NONE"!==e?this.featureLayers[e]||this.featureLayers[this._requiredFacilitiesLayerSelect.get("value")]:null),this._requiredLyrWatchHandle(),c.set(this._reqdFacilityNumRow,"display","NONE"!==e?"table-row":"none"),c.set(this._reqdFacilityNumExtentRow,"display","NONE"!==e?"table-row":"none"),c.set(this._reqdCapLabelRow,"display",a||s&&"NONE"!==e?"table-row":"none"),c.set(this._reqdCapAttrRow,"display",a||s&&"NONE"!==e?"table-row":"none")),j.isDefined(this.requiredFacilitiesLayer)&&j.isDefined(this.requiredFacilitiesLayer.queryCount)&&W.getLayerFeatureCount(this.requiredFacilitiesLayer,{}).then(i.hitch(this,function(e){this.set("featureCount",{requiredFacilitiesLayer:e}),u.set(this._numFacilitiesLabel,"innerHTML",h.substitute(this.i18n.facilitiesNumLabel,{numberOf:e}))}),function(e){console.log(e)})},_handleCandFacilityLayerChange:function(e){this._analaysisSelectType=this.selectTypes.cFacility,
"browse"===e||"browselayers"===e?(this._browseSelect=this._candidateFacilityLyrSelect,this._browseLayers=this.featureLayers,this._createBrowseItems({browseValue:e,disableLAAL:!0,disableBoundary:!0,disabledSubResources:[this.get("demandLocationLayer"),this.requiredFacilitiesLayer,this.get("candidateFacilitiesLayer"),this.pointBarrierLayer]},{geometryTypes:[G.GeometryTypes.Point]},this._candidateFacilityLyrSelect)):(this.set("candidateFacilitiesLayer",e?this.featureLayers[e]||this.featureLayers[this._candidateFacilityLyrSelect.get("value")]:null),this._candidateLyrWatchHandle()),j.isDefined(this.candidateFacilitiesLayer)&&j.isDefined(this.candidateFacilitiesLayer.queryCount)&&W.getLayerFeatureCount(this.candidateFacilitiesLayer,{}).then(i.hitch(this,function(e){this.set("featureCount",{candidateFacilitiesLayer:e}),u.set(this._candFacilitiesLabel,"innerHTML",h.substitute(this.i18n.candidateNumLabel,{numberOf:e}))}),function(e){console.log(e)})},_setAnalysisGpServerAttr:function(e){e&&(this.analysisGpServer=e,this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName))},_setDemandLocationLayerAttr:function(e){j.isDefined(e)&&e.geometryType===G.GeometryTypes.Point&&(this.demandLocationLayer=e)},_getDemandLocationLayerAttr:function(){return this.demandLocationLayer},_setDemandLocationLayersAttr:function(e){this.demandLocationLayers=a.filter(e,function(e){if(j.isDefined(e)&&e.geometryType===G.GeometryTypes.Point)return!0},this)},_setFeatureLayersAttr:function(e){this.featureLayers=a.filter(e,function(e){if(j.isDefined(e)&&e.geometryType===G.GeometryTypes.Point)return!0},this)},_getFeatureLayersAttr:function(e){return this.featureLayers},_setDisableRunAnalysisAttr:function(e){this._saveBtn.set("disabled",e)},_setPointBarrierLayerAttr:function(e){this.pointBarrierLayer=e,this._updateDmndLocateOpts()},_setLineBarrierLayerAttr:function(e){this.lineBarrierLayer=e,this._updateDmndLocateOpts()},_setPolygonBarrierLayerAttr:function(e){this.polygonBarrierLayer=e,this._updateDmndLocateOpts()},validateServiceName:function(e){return W.validateServiceName(e,{textInput:this._outputLayerInput,isItem:!this.returnFeatureCollection})},validateServiceLimits:function(e){var t=!0,i=this.showChooseExtent&&this._useExtentCheck.get("checked")?this.featureCountByExtent:this.featureCount,a=[];if(!this.serviceLimits)return t;if(this._handleCloseMsg(),i&&i.demandLocationLayer&&e.demandLocationsLayer&&j.isDefined(this.serviceLimits.maximumDemandPoints)&&!(t=i.demandLocationLayer<=this.serviceLimits.maximumDemandPoints))return a.push(h.substitute(this.i18n.AO_100069,{startLayer:this.demandLocationLayer.name,max:this.serviceLimits.maximumDemandPoints})),this._showMessages(a),t;if(e.requiredFacilitiesLayer&&i&&i.requiredFacilitiesLayer&&j.isDefined(this.serviceLimits.maximumFacilitiesToFind)&&!(t=i.requiredFacilitiesLayer<=this.serviceLimits.maximumFacilitiesToFind))return a.push(h.substitute(this.i18n.AO_100069,{startLayer:this.requiredFacilitiesLayer.name,max:this.serviceLimits.maximumFacilitiesToFind})),this._showMessages(a),t;if(e.candidateFacilitiesLayer&&i&&i.candidateFacilitiesLayer&&j.isDefined(this.serviceLimits.maximumFacilities))if(e.requiredFacilitiesLayer){if(e.requiredFacilitiesLayer&&i&&i.requiredFacilitiesLayer&&j.isDefined(this.serviceLimits.maximumFacilities)&&!(t=i.candidateFacilitiesLayer<=this.serviceLimits.maximumFacilities-i.requiredFacilitiesLayer))return a.push(h.substitute(this.i18n.AO_100069,{startLayer:this.candidateFacilitiesLayer.name,max:this.serviceLimits.maximumFacilities-i.requiredFacilitiesLayer})),this._showMessages(a),t}else if(!(t=i.candidateFacilitiesLayer<=this.serviceLimits.maximumFacilities))return a.push(h.substitute(this.i18n.AO_100069,{startLayer:this.candidateFacilitiesLayer.name,max:this.serviceLimits.maximumFacilities})),this._showMessages(a),t;if(e.candidateCount)if(!e.requiredFacilitiesLayer&&j.isDefined(this.serviceLimits.maximumFacilitiesToFind)){if(!(t=e.candidateCount<=this.serviceLimits.maximumFacilitiesToFind))return a.push(h.substitute(this.i18n.AO_100158,{max:this.serviceLimits.maximumFacilitiesToFind})),this._showMessages(a),t}else if(e.requiredFacilitiesLayer&&i&&i.requiredFacilitiesLayer&&j.isDefined(this.serviceLimits.maximumFacilitiesToFind)&&!(t=e.candidateCount<=this.serviceLimits.maximumFacilitiesToFind-i.requiredFacilitiesLayer))return a.push(this.i18n.AO_100157),this._showMessages(a),t;return t},_setMapAttr:function(e){this.map=e,this._startToolbar=new Z(this.map),this._endToolbar=new Z(this.map),n.connect(this._startToolbar,"onDrawEnd",i.hitch(this,this._addStartFeatures)),n.connect(this._endToolbar,"onDrawEnd",i.hitch(this,this._addEndFeatures)),this.map.on("extent-change",i.hitch(this,this._updateExtentLabels))},_getMapAttr:function(){return this.map},_setDistanceDefaultUnitsAttr:function(e){this.distanceDefaultUnits=e},_getDistanceDefaultUnitsAttr:function(){return this.distanceDefaultUnits},_getOutputLayerNameAttr:function(){return this._outputLayerInput&&(this.outputLayerName=this._outputLayerInput.get("value")),this.outputLayerName},_setOutputLayerNameAttr:function(e){this.outputLayerName=e},_setGoalsAttr:function(e){this._set("goals",e)},_setGoalAttr:function(e){this._set("goal",e)},_setDemandAttr:function(e){this._set("demand",e)},_setDemandFieldAttr:function(e){this._set("demandField",e)},_setMaxTravelRangeAttr:function(e){this._set("maxTravelRange",e)},_setMaxTravelRangeFieldAttr:function(e){this._set("maxTravelRangeField",e)},_setMaxTravelRangeUnitsAttr:function(e){this._set("maxTravelRangeUnits",e)},_setTravelModeAttr:function(e){this._set("travelMode",e)},_setTravelDirectionAttr:function(e){this._set("travelDirection",e)},_setRequiredFacilitiesLayerAttr:function(e){this.requiredFacilitiesLayer=e},_setRequiredFacilitiesCapacityAttr:function(e){this._set("requiredFacilitiesCapacity",e)},_setRequiredFacilitiesCapacityFieldAttr:function(e){this._set("requiredFacilitiesCapacityField",e)},_setCandidateFacilitiesLayerAttr:function(e){this.candidateFacilitiesLayer=e},_setCandidateCountAttr:function(e){this._set("candidateCount",e)},_setCandidateFacilitiesCapacityAttr:function(e){this._set("candidateFacilitiesCapacity",e)},_setCandidateFacilitiesCapacityFieldAttr:function(e){this._set("candidateFacilitiesCapacityField",e)},_setPercentDemandCoverageAttr:function(e){this._set("percentDemandCoverage",e)},_setShowRequiredFacilitiesAttr:function(e){this._set("showRequiredFacilities",e)},_setFeatureCountByExtentAttr:function(e){i.mixin(this.featureCountByExtent,e||{}),console.log(this.featureCountByExtent),this.set("doValidate",!this.doValidate)},_setFeatureCountAttr:function(e){i.mixin(this.featureCount,e||{}),console.log(this.featureCount),this.set("doValidate",!this.doValidate)},_setDoValidateAttr:function(e){this._set("doValidate",e)},_connect:function(e,t,i){this._pbConnects.push(n.connect(e,t,i))},_handleExtentCheckChange:function(e){_.toggle(this._numDemandExtentLabel,"disabled",!e),_.toggle(this._numFacilitiesExtentLabel,"disabled",!e),_.toggle(this._candFacilitiesExtentLabel,"disabled",!e)},_updateExtentLabels:function(){var e={};e={geometry:this.map.extent.getExtent()},j.isDefined(this.demandLocationLayer)&&j.isDefined(this.demandLocationLayer.queryCount)&&W.getLayerFeatureCount(this.demandLocationLayer,e).then(i.hitch(this,function(e){this.set("featureCountByExtent",{demandLocationLayer:e}),u.set(this._numDemandExtentLabel,"innerHTML",h.substitute(this.i18n.demandExtentLabel,{numberOf:e}))}),function(e){console.log(e)}),j.isDefined(this.requiredFacilitiesLayer)&&j.isDefined(this.requiredFacilitiesLayer.queryCount)&&W.getLayerFeatureCount(this.requiredFacilitiesLayer,e).then(i.hitch(this,function(e){this.set("featureCountByExtent",{requiredFacilitiesLayer:e}),u.set(this._numFacilitiesExtentLabel,"innerHTML",h.substitute(this.i18n.facilitiesExtentLabel,{numberOf:e}))}),function(e){console.log(e)}),j.isDefined(this.candidateFacilitiesLayer)&&j.isDefined(this.candidateFacilitiesLayer.queryCount)&&W.getLayerFeatureCount(this.candidateFacilitiesLayer,e).then(i.hitch(this,function(e){this.set("featureCountByExtent",{candidateFacilitiesLayer:e}),u.set(this._candFacilitiesExtentLabel,"innerHTML",h.substitute(this.i18n.candidateExtentLabel,{numberOf:e}))}),function(e){console.log(e)})},_handleDemandCapacityTypeChange:function(e){this.set("demandType",e),_.contains(this._constant1,"selected")&&_.remove(this._constant1,"selected"),_.contains(this._attribute1,"selected")&&_.remove(this._attribute1,"selected"),"attribute"===e?(_.add(this._attribute1,"selected"),c.set(this._attribute1row,"display","table-row"),c.set(this._constant1row,"display","none"),this.get("demandField")||this.set("demandField",this._attributeSelect1.get("value"))):"constant"===e&&(_.add(this._constant1,"selected"),c.set(this._attribute1row,"display","none"),c.set(this._constant1row,"display","table-row"),this.get("demand")||this.set("demand",1),this.set("demandField",null))},_handleCapacityTypeChange:function(e){this.set("maxTravelRangeType",e),_.contains(this._constant2,"selected")&&_.remove(this._constant2,"selected"),_.contains(this._attribute2,"selected")&&_.remove(this._attribute2,"selected"),_.contains(this._unlimited2,"selected")&&_.remove(this._unlimited2,"selected"),"attribute"===e?(_.add(this._attribute2,"selected"),c.set(this._atrconstrow,"display","table-row"),c.set(this._maxTravelRangeFieldSelect.domNode,"display","block"),c.set(this._maxTravelRangeField.domNode,"display","none"),this.get("maxTravelRangeField")||this.set("maxTravelRangeField",this._maxTravelRangeFieldSelect.get("value"))):"constant"===e?(_.add(this._constant2,"selected"),c.set(this._atrconstrow,"display","table-row"),c.set(this._maxTravelRangeFieldSelect.domNode,"display","none"),c.set(this._maxTravelRangeField.domNode,"display","block"),this.get("maxTravelRange")||this.set("maxTravelRange",1),this.set("maxTravelRangeField",null)):"unlimited"===e&&(_.add(this._unlimited2,"selected"),c.set(this._atrconstrow,"display","none"),c.set(this._maxTravelRangeFieldSelect.domNode,"display","none"),c.set(this._maxTravelRangeField.domNode,"display","none"),this.set("maxTravelRange",null),this.set("maxTravelRangeField",null))},_handleRequiredCapacityTypeChange:function(e){this.set("requiredCapacityType",e),_.contains(this._constant3,"selected")&&_.remove(this._constant3,"selected"),_.contains(this._attribute3,"selected")&&_.remove(this._attribute3,"selected"),_.contains(this._unlimited3,"selected")&&_.remove(this._unlimited3,"selected"),"attribute"===e?(_.add(this._attribute3,"selected"),c.set(this._attribute3row,"display","table-row"),c.set(this._constant3row,"display","none"),this.get("requiredFacilitiesCapacityField")||this.set("requiredFacilitiesCapacityField",this._attributeSelect3.get("value"))):"constant"===e?(_.add(this._constant3,"selected"),c.set(this._attribute3row,"display","none"),c.set(this._constant3row,"display","table-row"),this.get("requiredFacilitiesCapacity")||this.set("requiredFacilitiesCapacity",1),this.set("requiredFacilitiesCapacityField",null)):"unlimited"===e&&(_.add(this._unlimited3,"selected"),c.set(this._attribute3row,"display","none"),c.set(this._constant3row,"display","none"),this.set("requiredFacilitiesCapacity",null),this.set("requiredFacilitiesCapacityField",null))},_handleCandidateCapacityTypeChange:function(e){this.set("candidateCapacityType",e),_.contains(this._constant4,"selected")&&_.remove(this._constant4,"selected"),_.contains(this._attribute4,"selected")&&_.remove(this._attribute4,"selected"),_.contains(this._unlimited4,"selected")&&_.remove(this._unlimited4,"selected"),"attribute"===e?(_.add(this._attribute4,"selected"),c.set(this._attribute4row,"display","table-row"),c.set(this._constant4row,"display","none"),this.get("candidateFacilitiesCapacityField")||this.set("candidateFacilitiesCapacityField",this._attributeSelect4.get("value"))):"constant"===e?(_.add(this._constant4,"selected"),c.set(this._attribute4row,"display","none"),c.set(this._constant4row,"display","table-row"),this.get("candidateFacilitiesCapacity")||this.set("candidateFacilitiesCapacity",1),this.set("candidateFacilitiesCapacityField",null)):"unlimited"===e&&(_.add(this._unlimited4,"selected"),c.set(this._attribute4row,"display","none"),c.set(this._constant4row,"display","none"),this.set("candidateFacilitiesCapacity",null),this.set("candidateFacilitiesCapacityField",null))},_handleDemandTypeChange:function(e){_.remove(this._facilitytodemand,"selected"),_.remove(this._demandtofacility,"selected"),"facility"===e?(_.add(this._facilitytodemand,"selected"),this.set("travelDirection","FacilityToDemand")):"demand"===e&&(_.add(this._demandtofacility,"selected"),this.set("travelDirection","DemandToFacility"))},_handleRequiredFacilityCheckChange:function(e){},_showMessages:function(e){if(e){if("string"==typeof e)u.set(this._bodyNode,"innerHTML",e);else if("object"==typeof e&&e.length){var t="";a.forEach(e,function(e){t+="<p class='margin0'>"+e+"</p>"},this),u.set(this._bodyNode,"innerHTML",t)}l.fadeIn({node:this._errorMessagePane,easing:L.quadIn,onEnd:i.hitch(this,function(){c.set(this._errorMessagePane,{display:""})})}).play()}},_handleCloseMsg:function(e){e&&e.preventDefault(),l.fadeOut({node:this._errorMessagePane,easing:L.quadOut,onEnd:i.hitch(this,function(){c.set(this._errorMessagePane,{display:"none"})})}).play()},_populateAttributeSelect:function(e,t,s,n,r){var l=[];e.removeOption(e.getOptions()),a.forEach(t,function(e){var t=-1!==a.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],e.type);if(s&&(t=t||-1!==a.indexOf(["Deliveries","Demand","Pickups","Weight"],e.name)),t){var i=j.isDefined(e.alias)&&""!==e.alias?e.alias:e.name;i=this.i18n[i]||i,l.push({value:e.name,label:i})}},this),0===l.length?(e.set("value",null),e.set("disabled",!0),_.add(n,"disabled"),this._removeSelHandle(n),m(".dijitSelectLabel",e.id).forEach(function(e){e.innerHTML=""}),_.contains(n,"selected")&&(_.remove(n,"selected"),i.hitch(this,r,s?"constant":"unlimited")())):(_.remove(n,"disabled"),this._addSelHandle(n,r),e.set("disabled",!1),e.addOption(l))},_fixEmptySelect:function(e){0===e.getOptions().length&&m(".dijitSelectLabel",e.id).forEach(function(e){e.innerHTML=""})}});return o("extend-esri")&&i.setObject("dijit.analysis.ChooseBestFacilities",te,E),te});