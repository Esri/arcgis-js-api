// COPYRIGHT © 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.26/esri/copyright.txt for details.

///////////////////////////////////////////////////////////////////////////
// Copyright © 2014 - 2016 Esri. All Rights Reserved.
//
// Licensed under the Apache License Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//    http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
///////////////////////////////////////////////////////////////////////////

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/_base/html","dojo/on","dojo/Deferred","dojo/promise/all","dojo/json","dijit/form/NumberTextBox","dijit/form/Select","dijit/form/Textarea","dijit/form/DateTextBox","dijit/form/TimeTextBox","dijit/form/CheckBox","../common/dijit/URLInput","../utils","esri/tasks/LinearUnit","../BaseEditor"],function(e,t,i,a,s,r,o,n,l,u,d,h,c,p,m,g,f,N,j){var V={};return V.UnsupportEditor=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-unsupport",editorName:"UnsupportEditor",postCreate:function(){this.inherited(arguments),s.setAttr(this.domNode,"innerHTML",f.sanitizeHTML(this.message))},getValue:function(){return null}}),V.ShowMessage=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-message",editorName:"ShowMessage",postCreate:function(){this.inherited(arguments),s.setAttr(this.domNode,"innerHTML",f.sanitizeHTML(this.message))},getValue:function(){return null}}),V.GeneralEditorWrapperEditor=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-wrapper",editorName:"GeneralEditorWrapperEditor",postCreate:function(){this.inherited(arguments),s.setStyle(this.gEditor.domNode,"width","100%"),"Select"===this.editorName&&s.addClass(this.gEditor.domNode,"restrict-select-width"),this.gEditor.placeAt(this.domNode)},getValue:function(){return this.gEditor.getValue()}}),V.BooleanEditor=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-boolean",editorName:"BooleanEditor",postCreate:function(){this.inherited(arguments),this.value=void 0!==this.param.defaultValue&&this.param.defaultValue,this.editor=new m({checked:this.value}),this.editor.placeAt(this.domNode)},getValue:function(){return this.editor.get("checked")}}),V.LongNumberEditor=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-long",editorName:"LongNumberEditor",postCreate:function(){this.inherited(arguments),this.value=isNaN(this.param.defaultValue)?NaN:this.param.defaultValue,this.editor=new u({value:this.value,constraints:{places:0}}),this.editor.placeAt(this.domNode)},getValue:function(){var e=this.editor.getValue();return isNaN(e)?null:e}}),V.DoubleNumberEditor=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-double",editorName:"DoubleNumberEditor",postCreate:function(){this.inherited(arguments),this.value=isNaN(this.param.defaultValue)?NaN:this.param.defaultValue,this.editor=new u({value:this.value}),this.editor.placeAt(this.domNode)},getValue:function(){var e=this.editor.getValue();return isNaN(e)?null:e}}),V.MultiValueChooser=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-multivalue-chooser",editorName:"MultiValueChooser",postCreate:function(){this.inherited(arguments),this.checkBoxs=[],i.forEach(this.param.choiceList,function(e){var t=new m({label:e,checked:!!(this.param.defaultValue&&this.param.defaultValue.indexOf(e)>-1)}),i=a.create("label",{for:t.id,innerHTML:e,class:"esriLeadingMargin05",style:"display:inline-block;clear:both;"});t.placeAt(this.domNode),a.place(i,this.domNode,"last"),a.create("br",null,this.domNode,"last"),this.checkBoxs.push(t)},this)},getValue:function(){var e=[];return i.forEach(this.checkBoxs,function(t){t.get("checked")&&e.push(t.label)},this),e}}),V.MultiValueEditor=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-multivalue",editorName:"MultiValueEditor",postCreate:function(){this.inherited(arguments),this.editors=[];var e=s.create("div",{class:"input-list"},this.domNode),i=t.clone(this.param,e);i.dataType=this.param.dataType.substr("GPMultiValue".length+1,this.param.dataType.length),i.originParam=this.param,setTimeout(t.hitch(this,this._initChildEditors,i,e),100),this._createAddInputNode(i,e)},_initChildEditors:function(e,t){this.param.defaultValue&&this.param.defaultValue.length>0?i.forEach(this.param.defaultValue,function(i){e.defaultValue=i,this._createSingleInputContainerNode(e,t)},this):(delete e.defaultValue,this._createSingleInputContainerNode(e,t))},getValue:function(){var e=[];return i.forEach(this.editors,function(t){e.push(t.getValue())},this),e},getGPValue:function(){var e=new o,t=[];return i.forEach(this.editors,function(e){t.push(e.getGPValue())},this),n(t).then(function(t){e.resolve(t)},function(t){e.reject(t)}),e},destroy:function(){i.forEach(this.editors,function(e){e.destroy()}),this.editors=[],this.inherited(arguments)},_createSingleInputContainerNode:function(e,t){var i=s.create("div",{class:"single-input"},t),a=this.editorManager.createEditor(e,"input",this.context,{widgetUID:this.widgetUID,config:this.config}),r=s.getContentBox(this.domNode).w-30-3;return s.setStyle(a.domNode,{display:"inline-block",width:r+"px"}),a.placeAt(i),this._createRemoveInputNode(i),i.inputEditor=a,this.editors.push(a),i},_createRemoveInputNode:function(e){var i=s.create("div",{class:"remove",innerHTML:"-"},e);return this.own(r(i,"click",t.hitch(this,function(){this.editors.splice(this.editors.indexOf(e.inputEditor),1),e.inputEditor.destroy(),s.destroy(e)}))),i},_createAddInputNode:function(e,i){var a=s.create("div",{class:"add-input"},this.domNode),o=s.create("div",{class:"add-btn",innerHTML:"+"},a);return this.own(r(o,"click",t.hitch(this,function(){this._createSingleInputContainerNode(e,i)}))),a}}),V.LinerUnitEditor=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-liner-unit",editorName:"LinerUnitEditor",postCreate:function(){this.inherited(arguments),this.distance=this.param.defaultValue?this.param.defaultValue.distance:0,this.units=this.param.defaultValue?this.param.defaultValue.units:"esriMeters",this.inputDijit=new u({value:this.distance}),this.selectDijit=new d({value:this.units,options:[{label:this.nls.meters,value:"esriMeters"},{label:this.nls.kilometers,value:"esriKilometers"},{label:this.nls.feet,value:"esriFeet"},{label:this.nls.miles,value:"esriMiles"},{label:this.nls.nauticalMiles,value:"esriNauticalMiles"},{label:this.nls.yards,value:"esriYards"}]}),s.addClass(this.selectDijit.domNode,"restrict-select-width"),this.inputDijit.placeAt(this.domNode),this.selectDijit.placeAt(this.domNode)},getValue:function(){var e=new N;return e.distance=this.inputDijit.getValue(),e.units=this.selectDijit.getValue(),e}}),V.DateTimeEditor=e(j,{baseClass:"jimu-gp-editor-base jimu-gp-editor-datatime",editorName:"DateTimeEditor",postCreate:function(){var e=new Date(this.param.defaultValue);this.value=this.param.defaultValue?new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()):null,this.inherited(arguments),this.dateDijit=new c({value:this.value,style:{width:"60%"}}),this.timeDijit=new p({value:this.value,style:{width:"40%"},constraints:{timePattern:"HH:mm:ss",clickableIncrement:"T00:15:00",visibleIncrement:"T00:15:00"}}),this.dateDijit.placeAt(this.domNode),this.timeDijit.placeAt(this.domNode)},startup:function(){this.dateDijit.startup(),this.timeDijit.startup()},getValue:function(){var e=new Date,t=this.dateDijit.getValue(),i=this.timeDijit.getValue();return null!==t&&null!==i?(e.setFullYear(t.getFullYear()),e.setMonth(t.getMonth()),e.setDate(t.getDate()),e.setHours(i.getHours()),e.setMinutes(i.getMinutes()),e.setSeconds(i.getSeconds()),e.getTime()):null}}),V.GetUrlObjectFromLayer=e([j,d],{editorName:"GetUrlObjectFromLayer",postCreate:function(){this.options=[],i.forEach(this.map.graphicsLayerIds,function(e){var t=this.map.getLayer(e);"esri.layers.FeatureLayer"!==t.declaredClass||this.geometryType&&t.geometryType!==this.geometryType||this.options.push({label:t.label||t.title||t.name||t.id,value:t.id})},this),this.inherited(arguments),this.setValue(this.value),s.addClass(this.domNode,"jimu-gp-editor-sffl"),s.addClass(this.domNode,"jimu-gp-editor-base")},getValue:function(){return this.value},getGPValue:function(){var e,t;return i.forEach(this.map.graphicsLayerIds,function(t){var i=this.map.getLayer(t);t===this.getValue()&&(e=i.url)},this),t={url:e},t=this.wrapGPValue(t),this.wrapValueToDeferred(t)}}),V.ObjectUrlEditor=e([j,g],{editorName:"ObjectUrlEditor",postCreate:function(){this.rest=!1,this.inherited(arguments),s.addClass(this.domNode,"jimu-gp-editor-ourl"),s.addClass(this.domNode,"jimu-gp-editor-base")},getValue:function(){return this.value},getGPValue:function(){var e;return e=this.getValue()?{url:this.getValue()}:null,e=this.wrapGPValue(e),this.wrapValueToDeferred(e)}}),V.SimpleJsonEditor=e([j,h],{editorName:"SimpleJsonEditor",postMixInProperties:function(){this.inherited(arguments),"object"==typeof this.value&&(this.value=l.stringify(this.value))},postCreate:function(){this.inherited(arguments),s.addClass(this.domNode,"jimu-gp-editor-json"),s.addClass(this.domNode,"jimu-gp-editor-base")},getValue:function(){return this.value},getGPValue:function(){var e;return e=this.getValue()?l.parse(this.getValue()):null,e=this.wrapGPValue(e),this.wrapValueToDeferred(e)}}),V});