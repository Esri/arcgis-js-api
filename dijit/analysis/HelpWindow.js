// COPYRIGHT Â© 2015 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
define(["require","dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/event","dojo/_base/kernel","dojo/aspect","dojo/has","dojo/dom-construct","dojo/dom-class","dojo/dom-attr","dojo/dom-style","dojo/query","dojo/window","dojo/dom-geometry","dijit/_Widget","dijit/TooltipDialog","dijit/popup","../../kernel","../../lang","../../request","../_EventedWidget","dojo/i18n!../../nls/jsapi"],function(e,i,t,o,s,l,n,a,h,r,p,d,c,f,g,m,u,v,w,j,_,H,y,x){var z=t([u],{declaredClass:"esri.dijit.analysis.HelpWindow",i18n:null,onlineHelpMap:null,showLearnMore:!1,"class":"esriAnalyisHelpWindow",postMixInProperties:function(){this.inherited(arguments),this.i18n={},o.mixin(this.i18n,x.common),o.mixin(this.i18n,x.analysisHelp)},postCreate:function(){this.inherited(arguments);var i,t,s,l=["ar","he"];for(this.onlineHelpMap={},i=0;i<l.length;i+=1)t=l[i],n.locale&&-1!==n.locale.indexOf(t)&&(-1!==n.locale.indexOf("-")?-1!==n.locale.indexOf(t+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);s=e.toUrl("./help/helpmap.json"),H({url:s}).then(o.hitch(this,function(e){this.onlineHelpMap=e.map}))},_getAbsoluteUrl:function(e){return/^https?\:/i.test(e)?e:/^\/\//i.test(e)?window.location.protocol+e:/^\//i.test(e)?window.location.protocol+"//"+window.location.host+e:void 0},_computeSize:function(e){var i={w:400,h:200};return h("esri-mobile")?i={w:"90%",h:"90%"}:-1!==e.indexOf("Category")?(i.w=400,i.h=320):-1!==e.indexOf("Tool")?(i.w=400,i.h=320):-1!==e.indexOf("toolDescription")&&(i.w=400,i.h=520),i},_setHelpTopicAttr:function(t){this.tooltipHelpDlg&&(w.close(this.tooltipHelpDlg),this.tooltipHelpDlg.destroy(),this.tooltipHelpDlg=null);var s,l,a,h,r,p,d,c,f,g,m="";this.showLearnMore=!1,f=this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("dev")?"dev":this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("qa")?"uat":"",m=this.isPortal?"-PortalOnly":"-OnlineOnly",s=o.clone(n.locale),"nb"===s&&(s="no"),l=["ar","cs","da","de","es","el","et","fi","fr","it","ja","ko","lt","lv","ru","nl","no","pl","pt-br","pt-pt","ro","sv","th","tr","vi","zh-cn","zh-hk","zh-tw"],g=["ar","de","es","fr","it","ja","ko","ru","nl","pl","pt-br","pt-pt","ro","zh-cn","zh-hk","zh-tw"],a="esri/dijit/analysis/help/",p=e.toUrl(a+this.helpFileName+".html"),_.isDefined(this.onlineHelpMap[this.helpFileName])&&_.isDefined(this.onlineHelpMap[this.helpFileName][t])&&(this.showLearnMore=!0,c="http://doc"+f+".arcgis.com/en/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][t]),-1!==i.indexOf(l,s)&&(-1!==s.indexOf("-")&&(d=s.split("-"),s=d[0]+"-"+d[1].toUpperCase()),p=e.toUrl(a+s+"/"+this.helpFileName+".html")),-1!==i.indexOf(g,s)&&this.showLearnMore&&(c="http://doc"+f+".arcgis.com/"+s+"/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][t]),h=this._computeSize(t),this._size=h,r="<div class='' style='position:relative'<div class='sizer content'><div class='contentPane'><div class='esriFloatTrailing' style='padding:0;'><a href='#' class='esriAnalysisCloseIcon' title='"+this.i18n.close+"'></a></div><iframe frameborder='0'  id='"+t+"' src='"+p+"#"+t+m+"' width='"+h.w+"' height='"+h.h+"' marginheight='0' marginwidth='0'></iframe></div></div><div class='sizer'><div class='actionsPane'><div class='actionList"+(this.showLearnMore?"'>":" hidden'>")+"<a class='action zoomTo' href='"+(this.showLearnMore?c:"#")+"' target='_help'>"+this.i18n.learnMore+"</a></div></div></div></div></div>",this.tooltipHelpDlg=new v({preload:!0,content:r,"class":"esriHelpPopup esriHelpPopupWrapper esriAnalyisHelpWindow"}),this.tooltipHelpDlg.startup()},show:function(e,i){this.helpFileName=i.helpFileName,this._analysisGpServer=i.analysisGpServer,this.isPortal=i.isPortal,this.set("helpTopic",i.helpId);var t,s,l,n=a.after(w,"open",o.hitch(this,function(){f(".esriAnalysisCloseIcon",this.tooltipHelpDlg.domNode).on("click",o.hitch(this,this.close)),n.remove()})),h=e.pageX,r=g.getBox();l=!1,i.helpParentNode&&(t=i.helpParentNode),t&&(s=m.position(t)),s&&r.w-e.pageX<s.w?(l=!0,h=s.x-this._size.w-10,this._isRightToLeft&&(h-=10)):this._isRightToLeft&&h-40<this._size.w&&(h=s.w+this._size.w+80),w.open({popup:this.tooltipHelpDlg,x:this._isRightToLeft===!0||l?h-40:h+40,y:e.screenY-e.pageY+10,onCancel:o.hitch(this,function(){this.close()}),onExecute:function(){this.close()}}),this.tooltipHelpDlg.domNode.parentNode&&c.set(this.tooltipHelpDlg.domNode.parentNode,"overflowY","hidden")},close:function(){w.close(this.tooltipHelpDlg)}});return h("extend-esri")&&o.setObject("dijit.analysis.HelpWindow",z,j),z});