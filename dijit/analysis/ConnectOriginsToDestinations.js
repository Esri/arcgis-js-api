// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.42/esri/copyright.txt for details.

define(["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/json","dojo/_base/fx","dojo/has","dojo/on","dojo/json","dojo/string","dojo/dom-style","dojo/dom-attr","dojo/dom-construct","dojo/query","dojo/dom-class","dojo/fx/easing","dojo/number","dojox/lang/functional/object","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_OnDijitClickMixin","dijit/_FocusMixin","dijit/registry","dijit/form/Button","dijit/form/CheckBox","dijit/form/Form","dijit/form/Select","dijit/form/TextBox","dijit/form/ValidationTextBox","dijit/layout/ContentPane","dijit/form/FilteringSelect","dijit/Tooltip","../../kernel","../../lang","./AnalysisBase","./_AnalysisOptions","./AnalysisRegistry","./CreditEstimator","./utils","./TrafficTime","./components/AddBarrierLayers/AddBarrierLayers","dojo/i18n!../../nls/jsapi","dojo/text!./templates/ConnectOriginsToDestinations.html"],(function(e,t,i,s,n,a,r,o,h,l,d,u,y,c,g,L,_,f,p,m,S,C,v,b,T,I,D,R,w,F,O,A,B,M,x,W,j,k,P,N,U,E,Z,H,J){var G=t([m,S,C,v,b,k,j],{declaredClass:"esri.dijit.analysis.ConnectOriginsToDestinations",templateString:J,widgetsInTemplate:!0,originsLayer:null,destinationsLayer:null,pointBarriers:null,pointBarrierLayer:null,lineBarriers:null,lineBarrierLayer:null,polygonBarriers:null,polygonBarrierLayer:null,forbiddenLayers:[],outputLayerName:null,distanceDefaultUnits:"Miles",enableTravelModes:!0,measurementType:"StraightLine",originsLayerCount:0,destinationsLayerCount:0,zeroCountWarningMsg:"",i18n:null,toolName:"ConnectOriginsToDestinations",helpFileName:"ConnectOriginsToDestinations",resultParameter:["routesLayer","unassignedOriginsLayer","unassignedDestinationsLayer"],constructor:function(e,t){this._pbConnects=[],e.containerNode&&(this.container=e.containerNode)},destroy:function(){this.inherited(arguments),s.forEach(this._pbConnects,n.disconnect),delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments),i.mixin(this.i18n,H.common),i.mixin(this.i18n,H.bufferTool),i.mixin(this.i18n,H.driveTimes),i.mixin(this.i18n,H.routeOriginDestinationPairsTool),i.mixin(this.i18n,H.analysisMsgCodes)},postCreate:function(){this.inherited(arguments),L.add(this._form.domNode,"esriSimpleForm"),this._outputLayerInput.set("validator",i.hitch(this,this.validateServiceName)),this._buildUI()},startup:function(){},_onClose:function(e){e&&(this._save(),this.emit("save",{save:!0})),this.emit("close",{save:e})},_handleShowCreditsClick:function(e){e.preventDefault();var t,s={};if(this._form.validate()){s.originsLayer=a.toJson(this.constructAnalysisInputLyrObj(this.originsLayer)),s.destinationsLayer=a.toJson(this.constructAnalysisInputLyrObj(this.get("destinationsLayer"))),t=this._measureMethodSelect.getOptions(this._measureMethodSelect.get("value")),s.measurementType=t.travelMode?a.toJson(t.travelMode):this._measureMethodSelect.get("value"),"none"!==u.get(this._routeIdRow,"display")&&(s.originsLayerRouteIDField=this.get("originsLayerRouteIDField"),s.destinationsLayerRouteIDField=this.get("destinationsLayerRouteIDField")),this._trafficTimeWidget.get("checked")&&(s.timeOfDay=this._trafficTimeWidget.get("timeOfDay"),"UTC"===this._trafficTimeWidget.get("timeZoneForTimeOfDay")&&(s.timeZoneForTimeOfDay=this._trafficTimeWidget.get("timeZoneForTimeOfDay")));var n=this._trafficTimeWidget.get("startDateAndTime");n&&(s.timeOfDay=n),this.returnFeatureCollection||(s.OutputName=a.toJson({serviceProperties:{name:this._outputLayerInput.get("value")}})),this.showChooseExtent&&this._useExtentCheck.get("checked")&&(s.context=a.toJson({extent:this.map.extent._normalize(!0)})),s.routeShape=this.get("routeShape"),s=this._addBarrierstoJobParams(s,this._addBarrierLayersComponent.get("barrierLayers")),this.getCreditsEstimate(this.toolName,s).then(i.hitch(this,(function(e){this._usageForm.set("content",e),this._usageDialog.show()})))}},_handleSaveBtnClick:function(e){var t,i,s,n={},r={};if(this._validateWarningMessages()&&this._form.validate()){this._saveBtn.set("disabled",!0),n.originsLayer=a.toJson(this.constructAnalysisInputLyrObj(this.originsLayer)),n.destinationsLayer=a.toJson(this.constructAnalysisInputLyrObj(this.get("destinationsLayer"))),i=this._measureMethodSelect.getOptions(this._measureMethodSelect.get("value")),n.measurementType=i.travelMode?a.toJson(i.travelMode):this._measureMethodSelect.get("value"),"none"!==u.get(this._routeIdRow,"display")&&(n.originsLayerRouteIDField=this.get("originsLayerRouteIDField"),n.destinationsLayerRouteIDField=this.get("destinationsLayerRouteIDField")),this._trafficTimeWidget.get("checked")&&(n.timeOfDay=this._trafficTimeWidget.get("timeOfDay"),"UTC"===this._trafficTimeWidget.get("timeZoneForTimeOfDay")&&(n.timeZoneForTimeOfDay=this._trafficTimeWidget.get("timeZoneForTimeOfDay"),n.liveOffset=this._trafficTimeWidget.get("liveOffset")));var o=this._trafficTimeWidget.get("startDateAndTime");o&&(n.timeOfDay=o),this.returnFeatureCollection||(n.OutputName=a.toJson({serviceProperties:{name:this._outputLayerInput.get("value")}})),this.showChooseExtent&&this._useExtentCheck.get("checked")&&(n.context=a.toJson({extent:this.map.extent._normalize(!0)})),this.returnFeatureCollection&&(t={outSR:this.map.spatialReference},this.showChooseExtent&&this._useExtentCheck.get("checked")&&(t.extent=this.map.extent._normalize(!0)),n.context=a.toJson(t)),s={description:d.substitute(this.i18n.itemDescription,{layername:this.originsLayer.name,distance_field:n.Distances||n.Field,units:n.Units}),tags:d.substitute(this.i18n.itemTags,{layername:this.originsLayer.name,destnlayername:this.destinationsLayer.name}),snippet:this.i18n.itemSnippet},this.showSelectFolder&&(s.folder=this.get("folderId")),"StraightLine"!==n.measurementType&&this.showOutputType&&(n.includeRouteLayers=this._incldRouteLayersChk.get("checked")),n.routeShape=this.get("routeShape"),n=this._addBarrierstoJobParams(n,this._addBarrierLayersComponent.get("barrierLayers")),r.itemParams=s,r.jobParams=n,this.execute(r)}},_save:function(){},_buildUI:function(){var e=!0;u.set(this._showCreditsLink,"display",!0===this.showCredits?"block":"none"),U.initHelpLinks(this.domNode,this.showHelp),u.set(this._chooseFolderRow,"display",!0===this.showSelectFolder?"block":"none"),this.showSelectFolder&&this.getFolderStore().then(i.hitch(this,(function(e){this.folderStore=e,U.setupFoldersUI({folderStore:this.folderStore,folderId:this.folderId,folderName:this.folderName,folderSelect:this._webMapFolderSelect,username:this.portalUser?this.portalUser.username:""})}))),u.set(this._chooseExtentDiv,"display",!0===this.showChooseExtent?"inline-block":"none"),this._loadConnections();var t=this.on("travelmodes-added",i.hitch(this,(function(){this._handleMeasurementTypeChange(this._measureMethodSelect.get("value")),t.remove(),t=null})));if(U.populateTravelModes({selectWidget:this._measureMethodSelect,addStraightLine:!0,widget:this,enableTravelModes:this.get("enableTravelModes"),value:this.measurementType}),this.timeOfDay){var s=this.travelMode&&U.isTrafficBasedTravelMode(this.travelMode);this._trafficTimeWidget.set("checked",s),s?(this._trafficTimeWidget.set("timeZoneForTimeOfDay",this.timeZoneForTimeOfDay),this._trafficTimeWidget.set("timeOfDay",this.timeOfDay),this.liveOffset&&this._trafficTimeWidget.set("liveOffset",this.liveOffset)):this._trafficTimeWidget.set("startDateAndTime",this.timeOfDay)}this.destinationsLayer&&this.featureLayers&&!U.isLayerInLayers(this.destinationsLayer,this.featureLayers)&&this.featureLayers.push(this.destinationsLayer),this.get("showSelectAnalysisLayer")&&(this.originsLayers&&this.originsLayer&&!U.isLayerInLayers(this.originsLayer,this.originsLayers)&&this.originsLayers.push(this.originsLayer),this.get("originsLayer")||!this.get("originsLayers")||this.rerun||this.set("originsLayer",this.originsLayers[0]),U.populateAnalysisLayers(this,"originsLayer","originsLayers")),this.outputLayerName&&(this._outputLayerInput.set("value",this.outputLayerName),e=!1),this.destinationsLayer&&(e=!1),this.originsLayer&&this._updateAnalysisLayerUI(e),U.addReadyToUseLayerOption(this,[this._analysisSelect,this._destPointLyrSelect]),U.updateDisplay([this._outputTypeRow],this.get("showOutputType"),"table-row"),this.set("zeroCountWarningMsg",d.substitute(this.i18n.AO_641,{numFeatures:1})),this.routeShape?this._handleRouteShapeChange(this.routeShape):this._handleRouteShapeChange("StraightLine"),this._addBarrierLayersComponent.buildUI({pointBarrierLayer:this.pointBarrierLayer,pointBarriers:this.pointBarriers,lineBarrierLayer:this.lineBarrierLayer,lineBarriers:this.lineBarriers,polygonBarrierLayer:this.polygonBarrierLayer,polygonBarriers:this.polygonBarriers,forbiddenLayers:this.forbiddenLayers,showBrowseLayers:this.showBrowseLayers,map:this.get("map"),portalSelf:this.get("portalSelf"),portalUrl:this.get("portalUrl"),useArcGISComponents:this.useArcGISComponents,isSingleTenant:this.isSingleTenant})},_updateAnalysisLayerUI:function(e){var t,i;if(this.originsLayer&&y.set(this._tripCalToolDescription,"innerHTML",d.substitute(this.i18n.toolDefine,{layername:this.originsLayer.name})),this.featureLayers){this.set("featureLayers",this.featureLayers),t=s.some(this._destPointLyrSelect.getOptions(),(function(e){return"browse"===e.value}),this),i=s.some(this._destPointLyrSelect.getOptions(),(function(e){return"browselayers"===e.value}),this),this._destPointLyrSelect.removeOption(this._destPointLyrSelect.getOptions());var n=[],a=0;this.rerun&&!this.destinationsLayer&&U.addBlankOption(this._destPointLyrSelect,n),s.forEach(this.featureLayers,(function(e,t){var i=this.destinationsLayer&&(this.destinationsLayer.name===e.name||this.destinationsLayer.url&&e.url&&this.destinationsLayer.url===e.url);n.push({value:t+1,label:e.name,selected:i}),i&&(a=t)}),this),(this.get("showReadyToUseLayers")||this.get("showBrowseLayers")||t||i)&&n.push({type:"separator",value:""}),this._destPointLyrSelect.addOption(n),U.addBrowseOptionForTool({select:this._destPointLyrSelect,disableLAAL:!1},this),this.destinationsLayer||(this._destPointLyrSelect.set("value",1),this.set("destinationsLayer",this.featureLayers[0]))}(e||!this.originsLayerRouteIDField&&!this.destinationsLayerRouteIDField)&&(this.originsLayer&&this.originsLayer.graphics&&this.originsLayer.graphics.length<=1||this.destinationsLayer&&this.destinationsLayer.graphics&&this.destinationsLayer.graphics.length<=1)?u.set(this._routeIdRow,"display","none"):u.set(this._routeIdRow,"display","table"),this._fetchFeatureCount(this.originsLayer,!0),e&&this._destPointLyrSelect.get("value")&&"browse"!==this._destPointLyrSelect.get("value")&&this.set("outputLayerName",d.substitute(this.i18n.outputLayerName,{layername:this.originsLayer.name,destnlayername:this.featureLayers[this._destPointLyrSelect.get("value")-1].name})),!e&&this.destinationsLayer&&this._handleDestinationLayerChange(a,!e)},_handleAnalysisLayerChange:function(e){var t,i;this._isAnalysisSelect=!0,"browse"===e||"browselayers"===e?this._createBrowseItems({browseValue:e,disabledSubResources:[this.originsLayer]},{tags:["point"],geometryTypes:[P.GeometryTypes.Point]},this._analysisSelect):(t=this.originsLayers[e],i=this.featureLayers.slice(),s.some(i,(function(e){return e===this.originsLayer}),this)||i.push(this.originsLayer),this.set("originsLayer",t),this.set("featureLayers",i),this.originsLayerRouteIDField=null,this.outputLayerName=null,this._updateAnalysisLayerUI(!0),this.get("destinationsLayer")&&this._handleDestinationLayerChange(this._destPointLyrSelect.get("value")))},_setAnalysisGpServerAttr:function(e){e&&(this.analysisGpServer=e,this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName))},_setOriginsLayerAttr:function(e){W.isDefined(e)&&e.geometryType===P.GeometryTypes.Point&&(this.originsLayer=e,this.forbiddenLayers=[this.originsLayer,this.destinationsLayer],this._addBarrierLayersComponent&&this._addBarrierLayersComponent.updateOptions(this.forbiddenLayers))},_getOriginsLayerAttr:function(){return this.originsLayer},_setOriginsLayersAttr:function(e){this.originsLayers=e||[]},_setFeatureLayersAttr:function(e){this.featureLayers=s.filter(e,(function(e){if(!(!!W.isDefined(this.originsLayer)&&e===this.originsLayer)&&e&&e.geometryType&&e.geometryType===P.GeometryTypes.Point)return!0}),this)},_getFeatureLayersAttr:function(e){return this.featureLayers},_setDisableRunAnalysisAttr:function(e){this._saveBtn.set("disabled",e)},validateServiceName:function(e){return U.validateServiceName(e,{textInput:this._outputLayerInput,isItem:!this.returnFeatureCollection})},_setMeasurementTypeAttr:function(e){this.measurementType=e},_getMeasurementTypeAttr:function(){return this.measurementType},_setDistanceDefaultUnitsAttr:function(e){this.distanceDefaultUnits=e},_getDistanceDefaultUnitsAttr:function(){return this.distanceDefaultUnits},_setDestinationsLayerAttr:function(e){this.destinationsLayer=e,this.forbiddenLayers=[this.originsLayer,this.destinationsLayer],this._addBarrierLayersComponent&&this._addBarrierLayersComponent.updateOptions(this.forbiddenLayers)},_getDestinationsLayerAttr:function(){return this.destinationsLayer},_setOriginsLayerRouteIDFieldAttr:function(e){this.originsLayerRouteIDField=e},_getOriginsLayerRouteIDFieldAttr:function(){return this._originRouteIdSelect&&this._isRouteIdAvailable()&&(this.originsLayerRouteIDField=this._originRouteIdSelect.get("value")),this.originsLayerRouteIDField},_setDestinationsLayerRouteIDFieldAttr:function(e){this.destinationsLayerRouteIDField=e},_getDestinationsLayerRouteIDFieldAttr:function(){return this._destnRouteIdSelect&&this._isRouteIdAvailable&&(this.destinationsLayerRouteIDField=this._destnRouteIdSelect.get("value")),this.destinationsLayerRouteIDField},_setOutputLayerNameAttr:function(e){this.outputLayerName=e,this._outputLayerInput&&this._outputLayerInput.set("value",this.outputLayerName)},_setEnableTravelModesAttr:function(e){this._set("enableTravelModes",e)},_setRouteShapeAttr:function(e){this._set("routeShape",e)},_loadConnections:function(){this.own(this.on("start",i.hitch(this,"_onClose",!0))),this._connect(this._closeBtn,"onclick",i.hitch(this,"_onClose",!1)),this._connect(this._measureMethodSelect,"onChange",i.hitch(this,this._handleMeasurementTypeChange)),this._followStreetsHandle=h.pausable(this._followStreets,"click",i.hitch(this,this._handleRouteShapeChange,"FollowStreets")),this._straightLineHandle=h.pausable(this._straightLine,"click",i.hitch(this,this._handleRouteShapeChange,"StraightLine")),this.own(this._followStreetsHandle,this._straightLineHandle),this.watch("enableTravelModes",i.hitch(this,(function(e,t,i){this._updateTravelModes(i)}))),this.own(this._addBarrierLayersComponent.on("add-ready-to-use-layer",i.hitch(this,(function(e){this.emit("add-ready-to-use-layer",e)})))),this._connect(this.map,"onExtentChange",i.hitch(this,(function(){this._useExtentCheck.get("value")&&(this._fetchFeatureByExtentCount(this.originsLayer,!0),this._fetchFeatureByExtentCount(this.destinationsLayer,!1))}))),this.own(h(this._originsZeroCountWarning,"click",i.hitch(this,(function(e){this._displayWarningMessage({display:!0,message:this.zeroCountWarningMsg,label:this._originsZeroCountWarning})}))),h(this._originsZeroCountWarning,"blur",i.hitch(this,(function(e){this._displayWarningMessage({display:!1,label:this._originsZeroCountWarning})}))),h(this._destinationsZeroCountWarning,"click",i.hitch(this,(function(e){this._displayWarningMessage({display:!0,message:this.zeroCountWarningMsg,label:this._destinationsZeroCountWarning})}))),h(this._destinationsZeroCountWarning,"blur",i.hitch(this,(function(e){this._displayWarningMessage({display:!1,label:this._destinationsZeroCountWarning})}))))},_connect:function(e,t,i){this._pbConnects.push(n.connect(e,t,i))},_handleBrowseItemsSelect:function(e,t){var s=this._isAnalysisSelect;e&&e.selection&&U.addAnalysisReadyLayer({item:e.selection,layers:this._isAnalysisSelect?this.originsLayers:this.featureLayers,layersSelect:this._isAnalysisSelect?this._analysisSelect:this._destPointLyrSelect,posIncrement:this._isAnalysisSelect?0:1,browseDialog:e.dialog||this._browsedlg,widget:this},t).then(i.hitch(this,(function(e){e&&this._addBarrierLayersComponent.addNewBarrier(s?this.originsLayers[this.originsLayers.length-1]:this.featureLayers[this.featureLayers.length-1])})))},_handleDestnRouteIdChange:function(e){this._autoSelRtId||W.isDefined(this._originRouteIdSelect.getOptions(e))&&(this._autoSelRtId=!0,this._originRouteIdSelect.set("value",e)),this.set("destinationsLayerRouteIDField",e)},_handleOriginRouteIdChange:function(e){this._autoSelRtId||W.isDefined(this._destnRouteIdSelect.getOptions(e))&&(this._autoSelRtId=!0,this._destnRouteIdSelect.set("value",e)),this.set("originsLayerRouteIDField",e)},_handleMeasurementTypeChange:function(e){var t,s,n;s=this._measureMethodSelect.getOptions(this._measureMethodSelect.get("value")),W.isDefined(s)?(t="Time"===s.units&&("driving"===s.modei18nKey||"trucking"===s.modei18nKey),n=s.units&&"Time"===s.units):(t="DrivingTime"===e,n=-1!==e.indexOf("Time")),n&&U.getRoutingUtilities(this).then(i.hitch(this,(function(e){this._trafficTimeWidget.set("trafficSupport",t&&e.networkDataset&&e.networkDataset.trafficSupport)}))),this.set("measurementType",e),u.set(this._useTrafficLabelRow,"display",n?"":"none"),this._trafficTimeWidget.set("disabled",!n),this._trafficTimeWidget.set("reset",!n),this.showOutputType&&("StraightLine"===e&&this._incldRouteLayersChk.set("checked",!1),this._incldRouteLayersChk.set("disabled","StraightLine"===e)),"StraightLine"===e?this._addBarrierLayersComponent.disable():this._addBarrierLayersComponent.enable(),"StraightLine"===e&&this._handleRouteShapeChange("StraightLine"),this._disableRouteShape("FollowStreets","StraightLine"===e)},_handleDestinationLayerChange:function(e,t){var i;this._isAnalysisSelect=!1,"browse"===e||"browselayers"===e?this._createBrowseItems({browseValue:e,disabledSubResources:[this.originsLayer,this.destinationsLayer]},{tags:["point"],geometryTypes:[P.GeometryTypes.Point]},this._destPointLyrSelect):(this._autoSelRtId&&(this._autoSelRtId=!1),i=t&&this.destinationsLayer?this.destinationsLayer:this.featureLayers[e-1],this._fetchFeatureCount(i,!1),this.originsLayer&&i&&this._outputLayerInput.set("value",d.substitute(this.i18n.outputLayerName,{layername:this.originsLayer.name,destnlayername:i.name})),this.set("destinationsLayer",i))},_isRouteIdAvailable:function(){var e=!1;return this.originsLayer.graphics&&this.originsLayer.graphics.length>1&&this.featureLayers[this._destPointLyrSelect.get("value")-1].graphics.length>1?e=!0:(this.originsLayer.analysisReady||this.featureLayers[this._destPointLyrSelect.get("value")-1])&&(e=!0),e},_updateTravelModes:function(e){var t=this._measureMethodSelect.getOptions();s.forEach(t,(function(t){"StraightLine"!==t.value&&(t.disabled=!e)})),this._measureMethodSelect.updateOption(t)},_handleExtentCheckChange:function(e){this._fetchFeatureByExtentCount(this.originsLayer,!0),this._fetchFeatureByExtentCount(this.destinationsLayer,!1)},_fetchFeatureByExtentCount:function(e,t){var i=this._useExtentCheck.get("value")?{geometry:this.map.extent}:{};this._fetchFeatureCount(e,t,i)},_fetchFeatureCount:function(e,t,s){var n=!1;s||(s={}),s.geometry&&(n=!0),W.isDefined(e)&&W.isDefined(e.queryCount)?(this.set("disableRunAnalysis",!0),U.getLayerFeatureCount(e,s).then(i.hitch(this,(function(i){t?this.set("originsLayerCount",i):this.set("destinationsLayerCount",i),this.set("disableRunAnalysis",!1),this._updateUIBasedOnFCount(e,t,n)})),(function(e){console.log(e),this.set("disableRunAnalysis",!1)}))):t?this.set("originsLayerCount",0):this.set("destinationsLayerCount",0)},_hideAllWarnings:function(){L.add(this._originsZeroCountWarning,"hide"),L.add(this._destinationsZeroCountWarning,"hide")},_updateUIBasedOnFCount:function(e,t,i){i||this._updateFields(e,t),this._hideAllWarnings(),0===this.originsLayerCount||0===this.destinationsLayerCount?(this.set("disableRunAnalysis",!0),i||u.set(this._routeIdRow,"display","none"),0===this.originsLayerCount?L.remove(this._originsZeroCountWarning,"hide"):t||0!==this.destinationsLayerCount||L.remove(this._destinationsZeroCountWarning,"hide")):i||1!==this.originsLayerCount&&1!==this.destinationsLayerCount?!i&&this.originsLayerCount>1&&this.destinationsLayerCount>1&&u.set(this._routeIdRow,"display","table"):(this.set("disableRunAnalysis",!1),u.set(this._routeIdRow,"display","none"))},_updateFields:function(e,t){var i,s=[];e&&(i=p.values(e.fields)),i.forEach((function(e){-1!==[P.FieldTypes.Short,P.FieldTypes.Integer,P.FieldTypes.Float,P.FieldTypes.String,P.FieldTypes.Date].indexOf(e.type)&&s.push({value:e.name,label:W.isDefined(e.alias)&&""!==e.alias?e.alias:e.name,selected:(t?this.originsLayerRouteIDField:this.destinationsLayerRouteIDField)===e.name})}),this),U.updateOptions(t?this._originRouteIdSelect:this._destnRouteIdSelect,s)},_handleRouteShapeChange:function(e){L.remove(this._followStreets,"selected"),L.remove(this._straightLine,"selected"),this.set("routeShape",e),"FollowStreets"===e?L.add(this._followStreets,"selected"):(L.add(this._straightLine,"selected"),this.set("routeShape","StraightLine"))},_disableRouteShape:function(e,t){"FollowStreets"===e?(L.toggle(this._followStreets,"disabled",t),L.toggle(this._followStreetsLabel,"esriAnalysisTextDisabled",t),t?L.replace(this._followStreetsIcon,"followStreetsDisabledIcon","followStreetsIcon"):L.replace(this._followStreetsIcon,"followStreetsIcon","followStreetsDisabledIcon"),this._followStreetsHandle&&(t?this._followStreetsHandle.pause():this._followStreetsHandle.resume())):(L.toggle(this._straightLine,"disabled",t),L.toggle(this._straightLineLabel,"esriAnalysisTextDisabled",t),this._straightLineHandle&&(t?this._straightLineHandle.pause():this._straightLineHandle.resume()))},_displayWarningMessage:function(e){e.display?M.show(e.message,e.label):M.hide(e.label)},_validateWarningMessages:function(){return L.contains(this._originsZeroCountWarning,"hide")&&L.contains(this._destinationsZeroCountWarning,"hide")}});return o("extend-esri")&&i.setObject("dijit.analysis.ConnectOriginsToDestinations",G,x),G}));