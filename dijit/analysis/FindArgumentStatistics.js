// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.36/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/connect","dojo/has","dojo/dom-class","dojo/dom-style","dojo/string","dojo/dom-construct","dojo/query","dojo/dom-attr","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_OnDijitClickMixin","dijit/_FocusMixin","dijit/registry","dijit/form/CheckBox","dijit/form/Select","../../kernel","../../lang","./RasterAnalysisMixin","./utils","./AnalysisRegistry","./ItemTypes","dojo/i18n!../../nls/jsapi","dojo/i18n!./nls/FindArgumentStatistics","dojo/text!./templates/FindArgumentStatistics.html"],(function(e,i,t,n,s,a,l,o,r,u,h,c,d,m,_,v,p,g,y,L,f,A,D,b,R,T,N,M,V){var E=e([d,m,_,v,p,D],{declaredClass:"esri.dijit.analysis.FindArgumentStatistics",templateString:V,widgetsInTemplate:!0,inputLayers:null,inputLayer:null,dimension:null,dimensions:null,variables:null,variableList:null,statisticsType:"ARGUMENT_MIN",multipleOccurrenceValue:null,minValue:null,maxValue:null,intervalRanges:null,ignoreNoData:!0,intervalKeyword:null,dimensionDefinition:"ALL",_inputType:"MB",toolName:"FindArgumentStatistics",helpFileName:"FindArgumentStatistics",toolNlsName:N.findArgumentStatisticsTool,rasterGPToolName:"FindArgumentStatistics",resultParameter:"outputRaster",browseType:[T.IS],hasCustomCheck:!0,customCheckFailureMessage:N.customCheckFailureMessage.integerService,constructor:function(e,i){this._pbConnects=[],e.containerNode&&(this.container=e.containerNode)},postMixInProperties:function(){this.inherited(arguments),i.mixin(this.i18n,M)},_getJobParameters:function(){var e=n.toJson(b.constructAnalysisInputLyrObj(this.get("inputLayer"))),t=this.get("dimension"),s=this.get("variables"),a=this.get("statisticsType"),l=this.get("statisticsValue"),o=this.get("dimensionDefinition"),r=this.get("ignoreNoData");return i.mixin({inputRaster:e,dimension:t,variables:s,statisticsType:a,ignoreNoData:r},i.mixin(o,l))},_setDefaultInputs:function(){this.dimension&&this.dimensions&&this._dimensionSelect.set("value",this.dimension),this.statisticsType&&this._loadStatisticsType(!0),this.multipleOccurrenceValue&&this._multipleOccurenceValue.set("value",this.multipleOccurrenceValue),this.minValue&&this._minValue.set("value",this.minValue),this.maxValue&&this._maxValue.set("value",this.maxValue),this.dimensionDefinition&&this._loadDimensionDefinition(this.dimensionDefinition),this.intervalKeyword&&this._loadIntervalKeyword(this.intervalKeyword),this._ignoreNoDataCheck.set("checked",this.ignoreNoData)},_resetUI:function(){var e;this.inputLayer&&(this._getLayerType(this.inputLayer),e="MD"===this._inputType,h(".multidim:not(.intervalKeyword)",this.domNode).forEach(i.hitch(this,(function(i){this._showDiv(i,e)}))),e&&this.inputLayer.getMultidimensionalInfo().then(i.hitch(this,(function(e){this.variableList=e.variables,this.set("variableList",this.variableList)}))),c.set(this._statsNumberLabel,"innerHTML",e?this.i18n.fourLabel:this.i18n.twoLabel),c.set(this._dimensionDefinitionNumberLabel,"innerHTML",e?this.i18n.fiveLabel:this.i18n.threeLabel),c.set(this._ignoreNumberLabel,"innerHTML",e?this.i18n.sixLabel:this.i18n.fourLabel),c.set(this._outputNumberLabel,"innerHTML",e?this.i18n.sevenLabel:this.i18n.fiveLabel))},_loadStatisticsType:function(e){this._statisticsTypeSelect.removeOption(this._statisticsTypeSelect.getOptions());var i=e&&this.statisticsType;this._statisticsTypeSelect.addOption([{value:"ARGUMENT_MIN",label:this.i18n.argumentMinLabel,selected:"ARGUMENT_MIN"===i},{value:"ARGUMENT_MAX",label:this.i18n.argumentMaxLabel,selected:"ARGUMENT_MAX"===i},{value:"ARGUMENT_MEDIAN",label:this.i18n.argumentMedianLabel,selected:"ARGUMENT_MEDIAN"===i},{value:"DURATION",label:this.i18n.durationLabel,selected:"DURATION"===i}])},_loadIntervalKeyword:function(e){this._intervalKeywordSelect.removeOption(this._intervalKeywordSelect.getOptions());var i=e&&this.intervalKeyword;this._intervalKeywordSelect.addOption([{value:"HOURLY",label:this.i18n.hourly,selected:"HOURLY"===i},{value:"DAILY",label:this.i18n.daily,selected:"DAILY"===i},{value:"WEEKLY",label:this.i18n.weekly,selected:"WEEKLY"===i},{value:"MONTHLY",label:this.i18n.monthly,selected:"MONTHLY"===i},{value:"QUARTERLY",label:this.i18n.quarterly,selected:"QUARTERLY"===i},{value:"YEARLY",label:this.i18n.yearly,selected:"YEARLY"===i},{value:"RECURRING_DAILY",label:this.i18n.recurringDaily,selected:"RECURRING_DAILY"===i},{value:"RECURRING_WEEKLY",label:this.i18n.recurringWeekly,selected:"RECURRING_WEEKLY"===i},{value:"RECURRING_MONTHLY",label:this.i18n.recurringMonthly,selected:"RECURRING_MONTHLY"===i},{value:"RECURRING_QUARTERLY",label:this.i18n.recurringQuarterly,selected:"RECURRING_QUARTERLY"===i}])},_loadDimensionDefinition:function(e){this._dimensionDefinitionSelect.removeOption(this._dimensionDefinitionSelect.getOptions()),"StdTime"===this.dimension?this._dimensionDefinitionSelect.addOption([{value:"ALL",label:this.i18n.all,selected:"ALL"===this.dimensionDefinition},{value:"INTERVAL_KEYWORD",label:this.i18n.intervalKeyword,selected:"INTERVAL_KEYWORD"===this.dimensionDefinition}]):this._dimensionDefinitionSelect.addOption([{value:"ALL",label:this.i18n.all,selected:!0}]),h(".intervalKeyword",this.domNode).forEach(i.hitch(this,(function(e){this._showDiv(e,"INTERVAL_KEYWORD"===this.dimensionDefinition)}))),this._loadIntervalKeyword()},_handleDimensionChange:function(e){if(this.dimension!==e){if(this.dimension=e,this.variableList){var i=this.variableList.filter((function(i){return i.dimensions.some((function(i){return i.name===e}))}));this.set("variableList",i)}this._loadDimensionDefinition()}},_handleStatisticsTypeChange:function(e){this._showDiv(this._multipleOccurrenceValueRow,"ARGUMENT_MAX"==e||"ARGUMENT_MIN"==e),this._showDiv(this._multipleOccurrenceValueLabelRow,"ARGUMENT_MAX"==e||"ARGUMENT_MIN"==e),this._showDiv(this._minValueLabelRow,"DURATION"==e),this._showDiv(this._minValueRow,"DURATION"==e),this._showDiv(this._maxValueLabelRow,"DURATION"==e),this._showDiv(this._maxValueRow,"DURATION"==e),this._minValue.set("required","DURATION"==e),this._maxValue.set("required","DURATION"==e)},_handleDimensionDefinitionChange:function(e){h(".intervalKeyword",this.domNode).forEach(i.hitch(this,(function(i){this._showDiv(i,"INTERVAL_KEYWORD"===e)})))},_getLayerType:function(e){this._inputType=e.hasMultidimensions||this.rerun&&this.variables&&this.variables.length>0?"MD":"MB"},_showDiv:function(e,i){o.set(e,"display",i?"block":"none")},_setInputLayersAttr:function(e){this.inputLayers=t.filter(e,i.hitch(this,(function(e){return this.isValidInputLayer(e)})))},isValidInputLayer:function(e){return e&&(e.bandCount>1||e.hasMultidimensions)},_getInputLayersAttr:function(){return this.inputLayers},_setDimensionAttr:function(e){this.dimension=e},_getDimensionAttr:function(){return this._dimensionSelect&&this._dimensionSelect.get("value")&&(this.dimension=this._dimensionSelect.get("value")),this.dimension},_setDimensionsAttr:function(e){this.dimensions!==e&&this.inputLayer&&(this._dimensionSelect.removeOption(this._dimensionSelect.getOptions()),t.forEach(e,(function(e){this._dimensionSelect.addOption({value:e.name,label:e.name})}),this),this.dimension?this._dimensionSelect.set("value",this.dimension):this._handleDimensionChange(this._dimensionSelect.get("value")))},_getDimensionsAttr:function(){return"MD"===this._inputType?this.dimensions:""},_setVariableListAttr:function(e){var i=!1,n=" checked";this._variablesList.innerHTML="",t.forEach(e,(function(e){var s,a,l,o="",r=e.dimensions;r&&r.length>0&&(s=null,t.forEach(r,(function(e){s=e.name+"="+e.values.length+",",o+=s})),o=o.slice(0,-1),a=e.name+" ["+o+"] ("+e.description+")",l=u.toDom("<tr><td colspan='3'><label class='esriLeadingMargin1 esriSelectLabel'><input type='checkbox' data-dojo-type='dijit/form/CheckBox' value='"+e.name+"'"+n+">"+a+"</label></td></tr>"),u.place(l,this._variablesList),n="",i||this.dimensions===r||(this.set("dimensions",r),i=!0))}),this),this._showDiv(this._variablesListLabel,this.variableList.length>0)},_getVariablesAttr:function(){if("MB"===this._inputType)return"";var e=this._variablesList.querySelectorAll("input:checked");if(e&&e.length>0){var i=[];return e.forEach((function(e){i.push(e.value)})),i.join(",")}return""},_setStatisticsTypeAttr:function(e){this.statisticsType=e,this._handleStatisticsTypeChange(e)},_getStatisticsTypeAttr:function(){return this._statisticsTypeSelect&&this._statisticsTypeSelect.get("value")&&(this.statisticsType=this._statisticsTypeSelect.get("value")),this.statisticsType},_setMultipleOccurrenceValueAttr:function(e){this.multipleOccurrenceValue=e},_getMultipleOccurrenceValueAttr:function(){return this._multipleOccurrenceValueSelect&&this._multipleOccurrenceValueSelect.get("value")&&(this.multipleOccurrenceValue=this._multipleOccurrenceValueSelect.get("value")),this.multipleOccurrenceValue},_setMinValueAttr:function(e){this.minValue=e},_getMinValueAttr:function(){return this._minValue&&this._minValue.get("value")&&(this.minValue=this._minValue.get("value")),this.minValue},_setMaxValueAttr:function(e){this.maxValue=e},_getMaxValueAttr:function(){return this._maxValue&&this._maxValue.get("value")&&(this.maxValue=this._maxValue.get("value")),this.maxValue},_setIgnoreNoDataAttr:function(e){this.ignoreNoData=e},_getIgnoreNoDataAttr:function(){return this._ignoreNoDataCheck&&(this.ignoreNoData=this._ignoreNoDataCheck.get("checked")),this.ignoreNoData},_setIntervalKeywordAttr:function(e){this.intervalKeyword=e},_getIntervalKeywordAttr:function(){return this.intervalKeyword=this._intervalKeywordSelect.get("value"),this.intervalKeyword},_getStatisticsValueAttr:function(){var e=this._statisticsTypeSelect.get("value");return"ARGUMENT_MEDIAN"===e?"":"DURATION"===e?{minValue:this.get("minValue"),maxValue:this.get("maxValue")}:{multipleOccurrenceValue:this.get("multipleOccurrenceValue")}},_getDimensionDefinitionAttr:function(){return"ALL"===this._dimensionDefinitionSelect.get("value")?{dimensionDefinition:"ALL"}:{dimensionDefinition:"INTERVAL_KEYWORD",intervalKeyword:this.get("intervalKeyword")}}});return a("extend-esri")&&i.setObject("dijit.analysis.FindArgumentStatistics",E,f),E}));