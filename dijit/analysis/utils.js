// COPYRIGHT Â© 2015 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/event","dojo/_base/json","dojo/dom-attr","dojo/has","dojo/i18n","dojo/io-query","dojo/i18n!../../nls/jsapi","dojo/json","dojo/string","dojo/query","dojo/dom-style","dojo/dom-class","dojo/dom-construct","dojo/Deferred","dojo/number","dojo/_base/window","dojo/when","dojo/data/ItemFileWriteStore","dijit/registry","dijit/Dialog","dijit/form/CheckBox","../../kernel","../../lang","../../request","./HelpWindow","../../tasks/query","../../dijit/BrowseItems","../../layers/FeatureLayer","./PluginAnalysisLayers","../../tasks/Geoprocessor"],function(e,t,i,s,a,n,r,l,o,d,c,u,y,m,g,p,h,f,b,v,T,w,I,D,L,S,M,_,F,x,P,j,O,N){var C={};return t.mixin(C,{_helpDialog:null,i18n:null,initHelpLinks:function(e,i,n){if(this._helpDialog||(this._helpDialog=new F),e){var l=I.byNode(e),o=l?l.get("helpFileName"):n&&n.helpFileName?n.helpFileName:null;m("[esriHelpTopic]",e).forEach(function(l){l&&(g.set(l,"display",M.isDefined(i)&&i!==!0?"none":""),s.connect(l,"onclick",t.hitch(this,function(t){a.stop(t),this._helpDialog.show(t,{helpId:r.get(l,"esriHelpTopic"),helpFileName:o,analysisGpServer:n&&n.analysisGpServer?n.analysisGpServer:null,helpParentNode:e})})))},this)}},constructAnalysisFeatColl:function(e){var i,s={};s.featureCollection=e.layerDefinition;for(i in s.featureCollection)s.featureCollection.hasOwnProperty(i)&&"objectIdField"===i&&(s.featureCollection.objectIdFieldName=t.clone(s.featureCollection.objectIdField),delete s.featureCollection.objectIdField);return s.featureCollection.features=e.featureSet.features,s},constructAnalysisInputLyrObj:function(e){var i,s,a={};if(e.url&&!e._collection)a={url:e.url},e.getDefinitionExpression&&e.getDefinitionExpression()?a.filter=e.getDefinitionExpression():M.isDefined(e.definitionExpression)&&""!==e.definitionExpression&&(a.filter=e.definitionExpression),e.credential&&(a.serviceToken=e.credential.token),-1!==a.url.indexOf("?")&&(i=a.url.substring(a.url.indexOf("?")+1,a.url.length),s=d.queryToObject(i),t.mixin(a,s),a.url=a.url.substring(0,a.url.indexOf("?")));else if(!e.url||e._collection)try{a=e.toJson()}catch(n){e._json=u.parse(e._json),a=e.toJson()}return a},buildReport:function(e,s){var a="";return s||(s={},t.mixin(s,c.analysisMsgCodes)),i.forEach(e,function(e){var n,r,l;"string"==typeof e.message?(n=M.isDefined(s[e.messageCode])?s[e.messageCode]:e.message,a+=e.style.substring(0,e.style.indexOf("</"))+(this._isEmptyObject(e.params)?n:y.substitute(n,e.params))+e.style.substring(e.style.indexOf("</"))):t.isArray(e.message)&&(l=[],r=t.clone(e.style),i.forEach(e.message,function(t,i){r=r.replace(/<\//,"${"+i+"}"),n=M.isDefined(s[e.messageCode+"_"+i])?s[e.messageCode+"_"+i]:t,n=this._isEmptyObject(e.params)?n:y.substitute(n,e.params),l.push(n+"</")},this),r=y.substitute(r,l),a+=r)},this),a},getLayerFeatureCount:function(e,t){var i=new x;return i.geometry=t.geometry||"",i.where=t.where||"1=1",i.geometryType=t.geometryType||"esriGeometryEnvelope",e.queryCount(i)},createPolygonFeatureCollection:function(e){var t;return t={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPolygon"}},t.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:e,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]},t},createPointFeatureCollection:function(e){var t;return t={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}},t.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:e,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:"esriGeometryPoint",fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]},t},createFolderStore:function(e,t){var s=new w({data:{identifier:"id",label:"name",items:[]}});return s.newItem({name:t,id:""}),i.forEach(e,function(e){s.newItem({name:e.title,id:e.id})}),s},setupFoldersUI:function(e){e.folderSelect.set("store",e.folderStore),e.folderSelect.set("required",!0),e.folderSelect.set("searchAttr","name"),M.isDefined(e.folderId)?e.folderStore.get(e.folderId).then(t.hitch(this,function(t){M.isDefined(t)?e.folderSelect.set("item",t):e.folderStore.get("").then(function(t){e.folderSelect.set("item",t)},this)})):e.folderName?e.folderStore.fetch({query:{name:e.folderName},onComplete:t.hitch(this,function(t){M.isDefined(t)&&t.length>0?e.folderSelect.set("item",t[0]):e.folderStore.get("").then(function(t){e.folderSelect.set("item",t)},this)})}):e.username?e.folderSelect.set("displayedValue",e.username):e.folderStore.get("").then(function(t){e.folderSelect.set("item",t)},this)},_isEmptyObject:function(e){var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},validateServiceName:function(e,t){var i,s,a=/(:|&|<|>|%|#|\?|\\|\"|\/|\+)/.test(e),n=!0;return M.isDefined(t)&&t.textInput&&(s=t.textInput),this.initI18n(),0===e.length||0===y.trim(e).length?(i=this.i18n.requiredValue,n=!1):a?(i=this.i18n.invalidServiceName,n=!1):e.length>98?(i=this.i18n.invalidServiceNameLength,n=!1):encodeURIComponent(e).length>170&&(i=this.i18n.invalidEncodedServiceNameLength,n=!1),s&&!n&&s.set("invalidMessage",i),n},getStepNumber:function(e){m(".esriAnalysisNumberLabel",e).forEach(function(e,t){var i=this._getNumberLabel(t);r.set(e,"innerHTML",i)},this)},_getNumberLabel:function(e){var t="";switch(this.initI18n(),e){case 0:t=this.i18n.oneLabel;break;case 1:t=this.i18n.twoLabel;break;case 2:t=this.i18n.threeLabel;break;case 3:t=this.i18n.fourLabel;break;case 4:t=this.i18n.fiveLabel;break;case 5:t=this.i18n.sixLabel;break;case 6:t=this.i18n.sevenLabel;break;case 7:t=this.i18n.eightLabel;break;case 8:t=this.i18n.nineLabel}return t},populateAnalysisLayers:function(e,t,s,a){if(e){var n=[],r=e.get(t);e._titleRow&&g.set(e._titleRow,"display","none"),e._analysisLabelRow&&g.set(e._analysisLabelRow,"display","table-row"),e._selectAnalysisRow&&(g.set(e._selectAnalysisRow,"display","table-row"),p.add(e._analysisSelect.domNode,"esriTrailingMargin3"),g.set(e._analysisSelect.domNode.parentNode,"padding-bottom","1em")),e.domNode&&this.getStepNumber(e.domNode),M.isDefined(a)&&a.chooseLabel&&n.push({value:-1,label:this.i18n.chooseLabel}),i.forEach(e.get(s),function(e,t){var i={value:M.isDefined(a)&&a.chooseLabel?t+1:t,label:e.name};r&&e.name===r.name&&(i.selected=!0),n.push(i)},this),e._analysisSelect.addOption(n),e._analysisSelect.set("required",!0)}},isValidAnalysisLayer:function(e){var t,s,a,n,r,l,o,d,c,u,m,g="",p=!0,h={isValid:p,validationMessage:g},f=0,b=0,v=0;return M.isDefined(e)&&M.isDefined(e.toolName)?(this.initI18n(),t=e.toolName,s=e.featureLayers,a=e.analysisLayer,n=t.charAt(0).toLowerCase()+t.substring(1),o=this.i18n,m=e.showReadyToUseLayers||!1,i.forEach(s,function(e){"esriGeometryPoint"===e.geometryType&&(l=!0,f++),("esriGeometryPoint"===e.geometryType||"esriGeometryMultipoint"===e.geometryType)&&(d=!0),"esriGeometryPolyline"===e.geometryType&&(c=!0,v++),"esriGeometryPolygon"===e.geometryType&&(r=!0,b++)},this),-1!==i.indexOf(["CreateDriveTimeAreas","PlanRoutes","ConnectOriginsToDestinations"],t)&&(!l||a&&"esriGeometryPoint"!==a.geometryType)?(g=y.substitute(this.i18n.selectPointLayer,{toolName:o[n]}),p=!1):"AggregatePoints"!==t&&"InterpolatePoints"!==t||(!a||"esriGeometryPoint"===a.geometryType||"esriGeometryMultipoint"===a.geometryType)&&d?"CalculateDensity"===t&&(!d&&!c||a&&"esriGeometryPoint"!==a.geometryType&&"esriGeometryMultipoint"!==a.geometryType&&"esriGeometryPolyline"!==a.geometryType)?(g=y.substitute(this.i18n.areaFeatureInvalidMsg,{toolName:o[n]}),p=!1):"FindHotSpots"===t&&(!d&&!r||a&&"esriGeometryPoint"!==a.geometryType&&"esriGeometryMultipoint"!==a.geometryType&&"esriGeometryPolygon"!==a.geometryType)?(g=y.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:o[n]}),p=!1):"OverlayLayers"!==t&&"AggregatePoints"!==t&&"SummarizeWithin"!==t&&"SummarizeNearby"!==t&&"FindNearest"!==t&&"MergeLayers"!==t||m||0!==s.length&&(1!==s.length||s[0]!==a&&M.isDefined(a))?"ConnectOriginsToDestinations"===t&&!m&&(0===s.length||2>f)?(g=y.substitute(this.i18n.odPointMsg,{toolName:o[n]}),p=!1):"AggregatePoints"===t&&!m&&s.length>1?(r=i.some(s,function(e){return"esriGeometryPolygon"===e.geometryType}),r||(g=y.substitute(this.i18n.aggregatePolyMsg,{toolName:o[n]}),p=!1)):"MergeLayers"===t&&!m&&s.length>1?(u=f>1||v>1||b>1,u||(g=this.i18n.mergeValidationMsg,p=!1)):"SummarizeWithin"!==t&&"DissolveBoundaries"!==t||(!a||"esriGeometryPolygon"===a.geometryType)&&r?"ExtractData"===t?(p=i.some(s,function(e){return-1!==e.capabilities.indexOf("Extract")}),p||(g=y.substitute(this.i18n.extractValidationMsg))):"ConnectOriginsToDestinations"===t&&s.length>1&&(l=i.some(s,function(e){var t=M.isDefined(a)&&a.id===e.id;return"esriGeometryPoint"===e.geometryType&&!t}),l||(g=y.substitute(this.i18n.odPointMsg,{toolName:o[n]}),p=!1)):(g=y.substitute(this.i18n.selectPolyLayer,{toolName:o[n]}),p=!1):(g=y.substitute(this.i18n.overlayValidationMsg,{toolName:o[n]}),p=!1):(g=y.substitute(this.i18n.selectPointLayer,{toolName:o[n]}),p=!1),h={isValid:p,validationMessage:g}):h},initI18n:function(){this.i18n||(this.i18n={},t.mixin(this.i18n,c.common),t.mixin(this.i18n,c.analysisTools),t.mixin(this.i18n,c.analysisMsgCodes),t.mixin(this.i18n,c.browseLayersDlg),t.mixin(this.i18n,c.driveTimes))},addBrowseAnalysisDialog:function(e){var t=[];if(e&&e.widget){this.i18n||this.initI18n(),t.push({label:this.i18n.categoryAll,value:"analysis ready"}),t.push({label:this.i18n.categoryBoundaries,value:"boundaries OR places"}),t.push({label:"&nbsp;&nbsp;&nbsp;&nbsp;"+this.i18n.subCategoryBoundaries,value:"boundaries"}),t.push({label:"&nbsp;&nbsp;&nbsp;&nbsp;"+this.i18n.subCategoryPlaces,value:"places"}),t.push({label:this.i18n.categoryHexBins,value:"hex"}),t.push({label:this.i18n.categoryTransportation,value:"transportation"});var i,s,a=v.doc.createDocumentFragment(),n=h.create("div",{style:"width:100%;height:100%;"},a),r=h.create("div",{style:"width:100%;height:10%;"},n),l=h.create("div",{style:"width:100%"},n),o=new P({portalUrl:e.widget.get("portalUrl"),message:"",plugin:"esri/dijit/analysis/PluginAnalysisLayers",sortDescending:!0,sort:"title",self:e.widget.get("portalSelf"),categories:t,categoryType:"tags",selectedCategory:"boundaries OR places",pagingLinks:3,itemsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",closePopupPerRow:!1,galleryTemplate:"<div style='opacity:1;' class='grid-item gallery-view galleryNode'>${item:_formatItemTitle}${item:_formatThumbnail}"+'<div class="linksDiv" style=\'display:none;\'><div class="esriItemLinks"><div class="esriFloatLeading"><a style="text-decoration: none;"><span>Add layer to analysis</span><div class="dijitReset dijitInline esriArrows"></div></a></div></div></div>',formatThumbnail:function(e){var t=e.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png";return"<img class='grid-item galleryThumbnail' width='120px' height='80px' alt='' src='"+t+"'>"},formatItemTitle:function(e){return'<div class="galleryLabelContainer"><span alt=\''+(e.title||e.name||"<No Title>")+"'>"+(e.title.replace(/_/g," ")||e.name.replace(/_/g," ")||"<No Title>")+"</span></div>"},style:"width:600px;height:90%;clear:both;"},l);return h.create("label",{"for":e.widget.id+"_addlayercheck","class":"esriFloatTrailing",style:"padding-bottom:0.5em;",innerHTML:this.i18n.addLayer},r),i=new L({name:"addlayer",id:e.widget.id+"_addlayercheck","class":"esriFloatTrailing",value:!1,checked:!1},h.create("input",{},r,"last")),s=new D({title:this.i18n.browseAnalysisTitle,content:n,doLayout:!0,browseItems:o,addlayerCheckBox:i,style:"padding:.75em 0;background-color: #fff;"})}},addAnalysisReadyLayer:function(e){if(M.isDefined(e)&&M.isDefined(e.item)&&M.isDefined(e.layersSelect)&&M.isDefined(e.layers)&&M.isDefined(e.browseDialog)){e.browseDialog.browseItems._closePopup(),e.browseDialog.hide();var s,a,n,r,l,o={url:e.item.url+"/0",itemId:e.item.id,title:e.item.title,analysisReady:!0},d=i.some(e.layers,function(e,t){var i=e.analysisReady&&o.analysisReady&&e.itemId===o.itemId;return i&&(s=t),i}),c=new f;return d?(e.posIncrement&&(s+=e.posIncrement),e.browseDialog.addlayerCheckBox.get("checked")&&(e.posIncrement||(e.posIncrement=0),l=e.layers[s-e.posIncrement],e.widget.map.getLayer(l.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=e.widget.map.on("layer-add",t.hitch(this,function(t){this._addLayerHandle.remove(),e.widget.emit("add-ready-to-use-layer",{layer:t.layer,layerInfo:l.linfo,item:l})})),e.widget.map.addLayer(l.lyr))),e.layersSelect.set("value",s),e.browseDialog.browseItems.clear(),c.resolve()):(c=_({url:o.url,content:{f:"json"}}),c.then(t.hitch(this,function(i){var s=new j(o.url,{outFields:["*"]});t.mixin(o,s),t.mixin(o,i),o.id=o.title+"_"+i.id,o.title=o.title.replace(/_/g," "),o.name=o.title,o.version=o.currentVersion,r=e.layersSelect.getOptions(),a=r.splice(r.length-2,2),e.layersSelect.removeOption(a),n=e.layers.length,e.posIncrement&&(n+=e.posIncrement),a.unshift({value:n,label:o.title,selected:!0}),e.layersSelect.addOption(a),e.layersSelect.set("value",n),o.lyr=s,o.linfo=i,e.layers.push(o),s.name=o.name,e.browseDialog.addlayerCheckBox.get("checked")&&(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=e.widget.map.on("layer-add",t.hitch(this,function(t){this._addLayerHandle.remove(),e.widget.emit("add-ready-to-use-layer",{layer:t.layer,layerInfo:i,item:o})})),e.widget.map.addLayer(s)),e.browseDialog.browseItems.clear()}))),c.promise}},addReadyToUseLayerOption:function(e,s){e&&e.showReadyToUseLayers&&(s||(s=[]),e.signInPromise.then(t.hitch(this,function(){i.forEach(s,function(t){t.addOption({type:"separator",value:""}),t.addOption({value:"browse",label:e.i18n.browseAnalysisTitle})},this),M.isDefined(e._browsedlg)||(e._browsedlg=this.addBrowseAnalysisDialog({widget:e}),e.own(e._browsedlg.browseItems.on("select-change",t.hitch(e,e._handleBrowseItemsSelect)),e._browsedlg.on("hide",t.hitch(e,function(){e._browsedlg.browseItems._closePopup(),i.forEach(s,function(e){"browse"===e.get("value")&&e.reset()})}))))})))},getMaxInputByMode:function(e){var t,i=300,s=300,a=1e3,n=1.60934,r=5280,l=1760;if(e&&e.units&&e.type)return"StraightLine"===e.type?"Miles"===e.units?t=a:"Yards"===e.units?t=a*l:"Kilometers"===e.units?t=b.format(a*n,{places:2}):"Meters"===e.units?t=b.format(a*n*1e3,{places:2}):"Feet"===e.units&&(t=a*r):"DrivingDistance"===e.type||"TruckingDistance"===e.type||"WalkingDistance"===e.type?"Miles"===e.units?t=i:"Yards"===e.units?t=i*l:"Kilometers"===e.units?t=b.format(i*n,{places:2}):"Meters"===e.units?t=b.format(i*n*1e3,{places:2}):"Feet"===e.units&&(t=i*r):("DrivingTime"===e.type||"TruckingTime"===e.type||"WalkingTime"===e.type)&&("Minutes"===e.units?t=s:"Seconds"===e.units?t=60*s:"Hours"===e.units&&(t=s/60)),t},updateModeConstraints:function(e){var t;e&&e.validateWidget&&e.units&&e.type&&(t=e.validateWidget.get("constraints"),t.max=this.getMaxInputByMode(e),e.validateWidget.set(t))},getTravelModes:function(e){var s,a,r,l,o=new f;return M.isDefined(this.travelModes)&&this.travelModes.length>0?o.resolve(this.travelModes):e&&e.widget?e.widget.signInPromise.then(t.hitch(this,function(){l=e.widget.get("helperServices"),l&&l.routingUtilities?(r=l.routingUtilities.url,s="sync"):s=e.widget._getSelf(e.widget.portalUrl),T(s,t.hitch(this,function(e){var s={};return e&&e.helperServices&&e.helperServices.routingUtilities&&(r=e.helperServices.routingUtilities.url),M.isDefined(r)?(a=new N(r+"/GetTravelModes"),void a.execute(s).then(t.hitch(this,function(e){var t=e[0].value&&e[0].value.features;this.travelModes=i.map(t,function(e){return n.fromJson(e.attributes.TravelMode)}),e[1]&&e[1].paramName&&"defaultTravelMode"===e[1].paramName&&(this.defaultTravelModeId=e[1].value),o.resolve(this.travelModes)}),t.hitch(this,function(e){o.reject(e)}))):void o.reject(new Error("Missing Routing Utility Service to get Travel Modes"))}),function(e){o.reject(e)})})):o.reject(new Error("Missing parameter: params.widget required parameter")),o.promise},populateTravelModes:function(e){if(e&&e.selectWidget&&e.widget){var s=[],a=e.allowmode||"all";this.initI18n(),e.addStraightLine&&s.push({value:"StraightLine",label:'<div class="esriFloatLeading bufferIcon esriStraightLineDistanceIcon"></div><div class="esriLeadingMargin4" style="height:20px;margin-top:10px;">'+this.i18n.straightLineDistance+"</div>"}),this.getTravelModes({widget:e.widget}).then(t.hitch(this,function(t){i.forEach(t,function(t){var i,n,r=t.name,l=e.separator||"",o=r.replace(/\s/g,l),d="AUTOMOBILE"===t.type?"Driving":"TRUCK"===t.type?"Trucking":"WALK"===t.type?"Walking":"Other",c=d.toLowerCase(),u=t.units||r.split(/\s/)[1],y=r,m=M.isDefined(e.enableTravelModes)&&!e.enableTravelModes;u=t.impedanceAttributeName===t.timeAttributeName?"Time":t.impedanceAttributeName===t.distanceAttributeName?"Distance":"Other",i='<div class="esriFloatLeading bufferIcon esri'+d+u+'Icon"></div><div class="esriLeadingMargin4" style="height:20px;margin-top:10px;">'+y+"</div>",n={label:i,value:o,travelMode:t,disabled:m,modei18nKey:c,units:u},("all"===a||a===u.toLowerCase())&&("all"!==a&&(n.value=n.value.replace(u,"")),e.selectDefaultMode&&this.defaultTravelModeId&&this.defaultTravelModeId===t.id&&(n.selected=!0),s.push(n))},this),e.selectWidget.removeOption(),e.selectWidget.addOption(s),e.selectWidget.set("value",e.value),e.widget.emit("travelmodes-added",{travelOptions:s})}),t.hitch(this,function(){s&&s.length>0&&(e.selectWidget.removeOption(),e.selectWidget.addOption(s),e.selectWidget.set("value",e.value),e.widget.emit("travelmodes-added",{travelOptions:s}))}))}}}),l("extend-esri")&&t.setObject("dijit.analysis.utils",C,S),C});