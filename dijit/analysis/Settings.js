// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.42/esri/copyright.txt for details.

define(["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Color","dojo/_base/json","dojo/has","dojo/json","dojo/string","dojo/dom-style","dojo/dom-attr","dojo/dom-construct","dojo/query","dojo/dom-class","dojo/NodeList","dojo/NodeList-dom","dojo/_base/fx","dojo/fx/easing","dojo/promise/all","dojo/Evented","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_OnDijitClickMixin","dijit/_FocusMixin","dijit/registry","dijit/form/Button","dijit/form/CheckBox","dijit/form/Form","dijit/form/Select","dijit/form/TextBox","dijit/form/NumberTextBox","dijit/form/ToggleButton","dijit/form/ValidationTextBox","dijit/layout/ContentPane","dijit/form/FilteringSelect","dijit/Dialog","dijit/ConfirmDialog","dojox/mvc/at","dgrid1/OnDemandGrid","dgrid1/Tree","dgrid1/Editor","dgrid1/Keyboard","dgrid1/Selection","dgrid1/Selector","dgrid1/extensions/ColumnResizer","dgrid1/extensions/DijitRegistry","../../kernel","../../lang","../../geometry/Extent","../../SpatialReference","../../layers/ArcGISImageServiceLayer","./_Widget","./utils","./SettingsViewModel","./JobsList","./components/DataStoreSelect","dojo/i18n!../../nls/jsapi","dojo/text!./templates/Settings.html"],(function(e,t,s,i,l,a,o,h,n,r,c,u,d,p,w,_,S,v,g,R,M,y,C,m,b,f,I,x,E,k,P,O,L,D,F,j,N,T,A,V,z,U,W,H,X,B,Y,J,G,q,K,Q,Z,$,ee,te,se,ie,le){var ae=t([V,W,H,X,U,z,B,Y]),oe=Z.createSubclass([y,C,m,b],{declaredClass:"esri.dijit.analysis.Settings",templateString:le,widgetsInTemplate:!0,i18n:null,toolName:"Settings",helpFileName:"AnalysisEnvironments",viewModelType:ee,cssClass:{primaryButton:"btn calcite blue",button:"btn calcite"},constructor:function(e,t){this._pbConnects=[],e.containerNode&&(this.container=e.containerNode),this.cssClass=s.mixin({},this.cssClass)},destroy:function(){this.inherited(arguments),i.forEach(this._pbConnects,l.disconnect),delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments),this.i18n={},s.mixin(this.i18n,ie.common),s.mixin(this.i18n,ie.analysisSettings),this._initModelWatchers()},postCreate:function(){this.inherited(arguments),this.viewModel.showOkCancel&&(this._state={}),this.initUI()},startup:function(){this._spatialRefGrid.startup()},initUI:function(){this._rasterUX=[this._snapLblRow,this._snapSelRow,this._rasterLblRow,this._cellLblRow,this._cellSelectRow,this._cellSelectNumRow,this._maskLblRow,this._maskSelRow],this._extentUX=[this._processExtLblRow,this._extentLblRow,this._extentRow],this._coordSysUX=[this._processSRRow,this._processSRLblRow,this._outSRLblRow,this._outSRRow,this._coordinateLblRow],this._geoanalyticsUX=[this._geoanalyticsLblRow,this._datastoreLabelRow,this._selectDataStore],this._rasterPPFUX=[this._parallelProcessingLblRow,this._parallelProcessingFactorLblRow,this._parallelProcessingFactorNumRow,this._recycleProcessingWorkersLblRow,this._recycleProcessingWorkersNumRow,this._retryOnFailuresLblRow,this._retryOnFailuresNumRow],this._rasterPTUX=[this._processorLblRow,this._processorTypeLblRow,this._processorTypeSelRow],this._rasterStorageUX=[this._storageLblRow,this._resamplingMethodLblRow,this._resamplingMethodSelRow],$.initHelpLinks(this.domNode,this.viewModel.showHelp),$.updateDisplay(this._rasterUX,this.viewModel.showRasterSettings,"table-row"),$.updateDisplay([this._overwriteRow],this.viewModel.showOverwriteResultOption,"table-row"),$.updateDisplay([this._closeAnalysisRow],this.viewModel.showCloseAnalysisOption,"table-row"),$.updateDisplay([this._storeAnalysisRow],this.viewModel.showStoreAnalysisOption,"table-row"),$.updateDisplay(this._coordSysUX,this.viewModel.showCoordinateSystems,"table-row"),$.updateDisplay([this._processSRRow,this._processSRLblRow],this.viewModel.showProcessSR,"table-row"),$.updateDisplay([this._outSRLblRow,this._outSRRow],this.viewModel.showOutSR,"table-row"),$.updateDisplay([this._coordinateLblRow],this.viewModel.showProcessSR||this.viewModel.showProcessSR,"table-row"),$.updateDisplay(this._extentUX,this.viewModel.showExtent,"table-row"),$.updateDisplay([this._closeDiv],this.viewModel.showCloseIcon,"block"),$.updateDisplay([this._settingsHeader],this.viewModel.showHeader,"block"),$.updateDisplay([this._actionbuttonCtr],this.viewModel.showOkCancel,"block"),$.updateDisplay(this._geoanalyticsUX,this.viewModel.showGeoAnalyticsSettings,"table-row"),$.updateDisplay(this._rasterPPFUX,this.viewModel.showRasterPPFSettings,"table-row"),$.updateDisplay(this._rasterPTUX,this.viewModel.showRasterPTSettings,"table-row"),$.updateDisplay([this._maskLblRow,this._maskSelRow],this.viewModel.showRasterMaskSettings,"table-row"),$.updateDisplay([this._snapLblRow,this._snapSelRow],this.viewModel.showRasterSnapSettings,"table-row"),$.updateDisplay([this._cellLblRow,this._cellSelectRow,this._cellSelectNumRow],this.viewModel.showCellsizeSettings,"table-row"),$.updateDisplay(this._rasterStorageUX,this.viewModel.showResamplingSettings,"table-row"),$.updateDisplay([this._creditWarningRow],this.viewModel.showCreditWarningSettings,"table-row"),this._spatialRefGrid||(this._spatialRefGrid=new ae({collection:this.viewModel.spatialRefStore,id:this.id+"_settingsgrid",showHeader:!1,columns:[{renderExpando:!0,label:"Name",field:"name",sortable:!1,resizable:!0}],class:"esriAnalysisSpatialRefTree"},this._spatialRefGridNode),p(".dijitButton",this._coordDialog.domNode).forEach((function(e,t){0===t?w.add(e,this.cssClass.primaryButton):w.add(e,this.cssClass.button)}),this)),this.viewModel.outSR&&this._outSRInput.set("value",this.viewModel.outSR.wkid),this.viewModel.processSR&&this._processSRInput.set("value",this.viewModel.processSR.wkid),this.viewModel.layers&&this._updateLayerOptions(this.viewModel.layers),this._updateProcessSRSelectValue(),this._handleProcessSRSelectChange(this._processSRSelect.get("value")),this._updateOutSRSelectValue(),this._handleSRSelectChange(this._outSRSelect.get("value")),this._updateExtentSelectValue(),this._handleExtentOptionChange(this._extentSelect.get("value")),this._updateCellSizeSelectValue(),this._handleCellSizeSelectChange(this._cellSizeSelect.get("value")),this._updateSnapRasterSelectValue(),this._handleSnapRasterSelectChange(this._snapRasterSelect.get("value")),this._updateMaskSelectValue(),this._handleMaskSelectChange(this._maskSelect.get("value")),this._updateProcessorTypeSelectValue(),this._handleProcessorTypeSelectChange(this._processorTypeSelect.get("value")),this._updateparallelProcessingFactorInputValue(),this._handleparallelProcessingFactorInputChange(this._parallelProcessingFactorInput.get("value")),this._updaterecycleProcessingWorkersInputValue(),this._handlerecycleProcessingWorkersInputChange(this._recycleProcessingWorkersInput.get("value")),this._updateretryOnFailuresInputValue(),this._handleretryOnFailuresInputChange(this._retryOnFailuresInput.get("value")),this._updateResamplingMethodSelectValue(),this._handleResamplingMethodSelectChange(this._resamplingMethodSelect.get("value")),this._closeAnalysisCheck.set("checked",this.viewModel.closeAnalysisWidget),this._storeAnalysisCheck.set("checked",!this.viewModel.returnFeatureCollection),this._creditWarningCheck.set("checked",this.viewModel.creditWarning),this.viewModel.showJobsHistory&&this.buildJobsUI(),this.viewModel.showGeoAnalyticsSettings&&this.buildDataStoreUI(),this._handleCloseMsg()},_initModelWatchers:function(){this.own(this.viewModel.watch("showCloseIcon",s.hitch(this,(function(e,t,s){$.updateDisplay([this._closeDiv],s,"block")}))),this.viewModel.watch("showHelp",s.hitch(this,(function(e,t,s){$.initHelpLinks(this.domNode,s)}))),this.viewModel.watch("showOverwriteResultOption",s.hitch(this,(function(e,t,s){$.updateDisplay([this._overwriteRow],s,"table-row")}))),this.viewModel.watch("showCloseAnalysisOption",s.hitch(this,(function(e,t,s){$.updateDisplay([this._closeAnalysisRow],s,"table-row")}))),this.viewModel.watch("showStoreAnalysisOption",s.hitch(this,(function(e,t,s){$.updateDisplay([this._storeAnalysisRow],s,"table-row")}))),this.viewModel.watch("showCoordinateSystems",s.hitch(this,(function(e,t,s){$.updateDisplay(this._coordSysUX,s,"table-row")}))),this.viewModel.watch("showProcessSR",s.hitch(this,(function(e,t,s){$.updateDisplay([this._processSRRow,this._processSRLblRow],s,"table-row"),$.updateDisplay([this._coordinateLblRow],s||this.viewModel.showOutSR,"table-row"),this._updateProcessSRSelectValue(),this._handleProcessSRSelectChange(this._processSRSelect.get("value"))}))),this.viewModel.watch("showOutSR",s.hitch(this,(function(e,t,s){$.updateDisplay([this._outSRLblRow,this._outSRRow],s,"table-row"),$.updateDisplay([this._coordinateLblRow],s||this.viewModel.showProcessSR,"table-row"),this._updateOutSRSelectValue(),this._handleSRSelectChange(this._outSRSelect.get("value"))}))),this.viewModel.watch("showExtent",s.hitch(this,(function(e,t,s){$.updateDisplay(this._extentUX,s,"table-row"),this._updateExtentSelectValue(),s&&this._handleExtentOptionChange(this._extentSelect.get("value"))}))),this.viewModel.watch("showRasterSettings",s.hitch(this,(function(e,t,s){$.updateDisplay(this._rasterUX,s,"table-row"),this._updateCellSizeSelectValue(),this._handleCellSizeSelectChange(this._cellSizeSelect.get("value")),this._updateSnapRasterSelectValue(),this._handleSnapRasterSelectChange(this._snapRasterSelect.get("value")),this._updateMaskSelectValue(),this._handleMaskSelectChange(this._maskSelect.get("value")),this._updateResamplingMethodSelectValue(),this._handleResamplingMethodSelectChange(this._resamplingMethodSelect.get("value"))}))),this.viewModel.watch("showRasterPPFSettings",s.hitch(this,(function(e,t,s){$.updateDisplay(this._rasterPPFUX,s,"table-row"),this._updateparallelProcessingFactorInputValue(),this._handleparallelProcessingFactorInputChange(this._parallelProcessingFactorInput.get("value")),this._updaterecycleProcessingWorkersInputValue(),this._handlerecycleProcessingWorkersInputChange(this._recycleProcessingWorkersInput.get("value")),this._updateretryOnFailuresInputValue(),this._handleretryOnFailuresInputChange(this._retryOnFailuresInput.get("value"))}))),this.viewModel.watch("showRasterPTSettings",s.hitch(this,(function(e,t,s){$.updateDisplay(this._rasterPTUX,s,"table-row"),$.updateDisplay([this._maskLblRow,this._maskSelRow],!s&&this.viewModel.showRasterSettings,"table-row"),this._updateProcessorTypeSelectValue(),this._handleProcessorTypeSelectChange(this._processorTypeSelect.get("value"))}))),this.viewModel.watch("showRasterSnapSettings",s.hitch(this,(function(e,t,s){$.updateDisplay([this._snapLblRow,this._snapSelRow],s,"table-row"),this._updateparallelProcessingFactorInputValue(),this._handleSnapRasterSelectChange(this._snapRasterSelect.get("value"))}))),this.viewModel.watch("showRasterMaskSettings",s.hitch(this,(function(e,t,s){$.updateDisplay([this._maskLblRow,this._maskSelRow],s,"table-row"),this._handleMaskSelectChange(this._maskSelect.get("value"))}))),this.viewModel.watch("showCellsizeSettings",s.hitch(this,(function(e,t,s){$.updateDisplay([this._cellLblRow,this._cellSelectRow,this._cellSelectNumRow],s,"table-row"),this._updateCellSizeSelectValue(),this._handleCellSizeSelectChange(this._cellSizeSelect.get("value"))}))),this.viewModel.watch("layers",s.hitch(this,(function(e,t,s){this._updateLayerOptions(this.viewModel.layers)}))),this.viewModel.watch("showHeader",s.hitch(this,(function(e,t,s){$.updateDisplay([this._settingsHeader],s,"block")}))),this.viewModel.watch("showOkCancel",s.hitch(this,(function(e,t,s){$.updateDisplay([this._actionbuttonCtr],s,"block")}))),this.viewModel.watch("showGeoAnalyticsSettings",s.hitch(this,(function(e,t,s){$.updateDisplay(this._geoanalyticsUX,s,"table-row"),s&&this.buildDataStoreUI()}))),this.viewModel.watch("isCustomProcessSR",s.hitch(this,(function(){this._updateProcessSRSelectValue(),this._handleProcessSRSelectChange(this._processSRSelect.get("value"))}))),this.viewModel.watch("isCustomExtent",s.hitch(this,(function(){this._updateExtentSelectValue(),this._handleExtentOptionChange(this._extentSelect.get("value"))}))),this.viewModel.watch("isCustomOutSR",s.hitch(this,(function(){this._updateOutSRSelectValue(),this._handleSRSelectChange(this._outSRSelect.get("value"))}))),this.viewModel.watch("closeAnalysisWidget",s.hitch(this,(function(e,t,s){this._handleCloseAnalysisCheck(s)}))),this.viewModel.watch("returnFeatureCollection",s.hitch(this,(function(e,t,s){this._handleReturnFeatureCollectionCheck(s)}))),this.viewModel.watch("showJobsHistory",s.hitch(this,this.buildJobsUI)),this.viewModel.watch("jobsViewModel",s.hitch(this,this.buildJobsUI)),this.viewModel.watch("showResamplingSettings",s.hitch(this,(function(e,t,s){$.updateDisplay(this._rasterStorageUX,s,"table-row")}))),this.viewModel.watch("showCreditWarningSettings",s.hitch(this,(function(e,t,s){$.updateDisplay([this._creditWarningRow],s,"table-row")}))))},buildJobsUI:function(){$.updateDisplay([this._settingsNavCtrl],this.viewModel.showJobsHistory,"block"),w.toggle(this._form.domNode,"tab-contents tab-section is-active",this.viewModel.showJobsHistory),w.toggle(this._jobHistoryCtr,"tab-contents tab-section",this.viewModel.showJobsHistory),w.toggle(this.domNode,"esri-analysis-category",this.viewModel.showJobsHistory),this.viewModel.showJobsHistory&&(this._addTabHandlers||(p(".tab-nav a",this.domNode).on("click",s.hitch(this,(function(e){e.stopPropagation(),p(".tab-title",this.domNode).removeClass("is-active"),w.add(e.target,"is-active");var t=w.contains(e.target,"general-tab");$.updateDisplay([this._form.domNode],t,"block"),$.updateDisplay([this._jobHistoryCtr],!t,"block")}))),this._addTabHandlers=!0),this.buildJobsList())},buildJobsList:function(){this.viewModel.jobsViewModel&&(this._jobsListWidget||(this._jobsListWidget=new te({viewModel:this.viewModel.jobsViewModel},this._jobsListDiv)))},buildDataStoreUI:function(){this._dataStoreSelect||(this._dataStoreSelect=new se({geoAnalyticsServer:this.viewModel.geoAnalyticsServer,value:this.viewModel.get("datastore")},d.create("div",null,this._dataStoreTd)),this._dataStoreSelect.startup(),this._dataStoreSelect.on("change",s.hitch(this,this._handleDSSelectChange)))},_updateExtentSelectValue:function(){var e;this.viewModel.get("isCustomExtent")?this._extentSelect.set("value","SPECIFIED"):this.viewModel.viewProps&&this.viewModel.viewProps.extentLayer&&this._layerNames?(e=i.indexOf(this._layerNames,this.viewModel.viewProps.extentLayer.name),this._extentSelect.set("value","LAYER_"+e)):this._extentSelect.set("value","DEFAULT"),this.viewModel.get("isCustomExtent")&&this.viewModel.extent&&(this._xMinInput.set("value",this.viewModel.extent.xmin),this._xMaxInput.set("value",this.viewModel.extent.xmax),this._yMinInput.set("value",this.viewModel.extent.ymin),this._yMaxInput.set("value",this.viewModel.extent.ymax))},_updateProcessSRSelectValue:function(){var e;this.viewModel.processSR&&this.viewModel.get("isCustomProcessSR")&&this._processSRInput.set("value",this.viewModel.processSR.wkid),this.viewModel.get("isCustomProcessSR")?this._processSRSelect.set("value","SPECIFIED"):this.viewModel.viewProps&&this.viewModel.viewProps.pSRLayer&&this._layerNames?(e=i.indexOf(this._layerNames,this.viewModel.viewProps.pSRLayer.name),this._processSRSelect.set("value","LAYER_"+e)):this._processSRSelect.set("value","DEFAULT")},_updateOutSRSelectValue:function(){var e;this.viewModel.outSR&&this.viewModel.get("isCustomOutSR")&&this._outSRInput.set("value",this.viewModel.outSR.wkid),this.viewModel.get("isCustomOutSR")?this._outSRSelect.set("value","SPECIFIED"):this.viewModel.viewProps&&this.viewModel.viewProps.outSRLayer&&this._layerNames?(e=i.indexOf(this._layerNames,this.viewModel.viewProps.outSRLayer.name),this._outSRSelect.set("value","LAYER_"+e)):this._outSRSelect.set("value","DEFAULT")},_updateCellSizeSelectValue:function(){var e;this.viewModel.get("isCustomCellSize")?this._cellSizeSelect.set("value","SPECIFIED"):this.viewModel.viewProps&&this.viewModel.viewProps.cellSizeLayer&&this._layerNames?(e=i.indexOf(this._layerNames,this.viewModel.viewProps.cellSizeLayer.name),this._cellSizeSelect.set("value","LAYER_"+e)):this.viewModel.cellSize?this._cellSizeSelect.set("value",this.viewModel.cellSize):this._cellSizeSelect.set("value",this._cellSizeSelect.get("value")),this.viewModel.get("isCustomCellSize")&&this.viewModel.cellSize&&this._cellSizeInput.set("value",this.viewModel.cellSize)},_updateSnapRasterSelectValue:function(){var e;this.viewModel.viewProps&&this.viewModel.viewProps.snapRasterLayer&&this._layerNames?(e=i.indexOf(this._layerNames,this.viewModel.viewProps.snapRasterLayer.name),this._snapRasterSelect.set("value","LAYER_"+this._layerNames[e])):this._snapRasterSelect.set("value",this._snapRasterSelect.get("value"))},_updateMaskSelectValue:function(){var e;this.viewModel.viewProps&&this.viewModel.viewProps.maskLayer&&this._layerNames?(e=i.indexOf(this._layerNames,this.viewModel.viewProps.maskLayer.name),this._maskSelect.set("value","LAYER_"+e)):this._maskSelect.set("value",this._maskSelect.get("value"))},_updateProcessorTypeSelectValue:function(){this.viewModel.processorType?this._processorTypeSelect.set("value",this.viewModel.processorType):this._processorTypeSelect.set("value",this._processorTypeSelect.get("value"))},_updateparallelProcessingFactorInputValue:function(){this.viewModel.parallelProcessingFactor?this._parallelProcessingFactorInput.set("value",this.viewModel.parallelProcessingFactor):this._parallelProcessingFactorInput.set("value",this._parallelProcessingFactorInput.get("value"))},_updaterecycleProcessingWorkersInputValue:function(){this.viewModel.recycleProcessingWorkers?this._recycleProcessingWorkersInput.set("value",this.viewModel.recycleProcessingWorkers):this._recycleProcessingWorkersInput.set("value",this._recycleProcessingWorkersInput.get("value"))},_updateretryOnFailuresInputValue:function(){this.viewModel.retryOnFailures?this._retryOnFailuresInput.set("value",this.viewModel.retryOnFailures):this._retryOnFailuresInput.set("value",this._retryOnFailuresInput.get("value"))},_updateResamplingMethodSelectValue:function(){this.viewModel.resamplingMethod?this._resamplingMethodSelect.set("value",this.viewModel.resamplingMethod):this._resamplingMethodSelect.set("value",this._resamplingMethodSelect.get("value"))},_handleSRSelectChange:function(e){var t,s;this._coordDialog.hide(),this._outSRBtn.set("disabled","SPECIFIED"!==e),$.updateDisplay(this._outSRCustomRow,"SPECIFIED"===e&&this.viewModel.showOutSR,"table-row"),$.updateDisplay(this._outSRCustomInputRow,"SPECIFIED"===e&&this.viewModel.showOutSR,"table-row"),this._outSRInput.set("required","SPECIFIED"===e),-1!==e.indexOf("LAYER_")&&(t=e.split("_")[1],s=this.viewModel.layers[t],this.viewModel.showOkCancel?(this._outSR={wkid:parseInt(s.fullExtent.spatialReference.wkid,10)},this._state.outSRLayer={name:s.name,url:s.url,fullExtent:s.fullExtent}):this.viewModel.set("outSR",{wkid:parseInt(s.fullExtent.spatialReference.wkid,10)}))},_handleProcessSRSelectChange:function(e){var t,s;this._coordDialog.hide(),this._processSRBtn.set("disabled","SPECIFIED"!==e),$.updateDisplay(this._processSRCustomRow,"SPECIFIED"===e&&this.viewModel.showProcessSR,"table-row"),$.updateDisplay(this._processSRCustomInputRow,"SPECIFIED"===e&&this.viewModel.showProcessSR,"table-row"),this._processSRInput.set("required","SPECIFIED"===e),-1!==e.indexOf("LAYER_")&&(t=e.split("_")[1],s=this.viewModel.layers[t],this.viewModel.showOkCancel?(this._processSR={wkid:parseInt(s.fullExtent.spatialReference.wkid,10)},this._state.pSRLayer={name:s.name,url:s.url,fullExtent:s.fullExtent}):this.viewModel.set("processSR",{wkid:parseInt(s.fullExtent.spatialReference.wkid,10)}))},_handleOutSRBtnClick:function(){this._outSRClick=!0,this._coordDialog.show()},_handleProcessSRBtnClick:function(){this._outSRClick=!1,this._coordDialog.show()},_handleExtentOptionChange:function(e){var t,s,i,l="SPECIFIED"===e;$.updateDisplay([this._extentLbl,this._customExtentRow],this.viewModel.showExtent&&l,"table-row"),this._xMinInput.set("required",l),this._xMaxInput.set("required",l),this._yMinInput.set("required",l),this._yMaxInput.set("required",l),-1!==e.indexOf("LAYER_")?(t=e.split("_")[1],s=this.viewModel.layers[t],i=new q(s.fullExtent),this.viewModel.showOkCancel?(this._extent=i.shiftCentralMeridian(),this._state.extentLayer={name:s.name,url:s.url,fullExtent:s.fullExtent}):this.viewModel.set("extent",i.shiftCentralMeridian())):"SPECIFIED"===e?(i=new q(this._xMinInput.get("value"),this._yMinInput.get("value"),this._xMaxInput.get("value"),this._yMaxInput.get("value"),new K({wkid:102100})),this.viewModel.showOkCancel?(this._extent=i,this._state.extentLayer=null):this.viewModel.set("extent",i)):"DEFAULT"===e&&(this._extent=null,this._state.extentLayer=null)},_validateExtent:function(){var e=!0,t="";return this._handleCloseMsg(),this._xMinInput.get("value")>this._xMaxInput.get("value")&&(e=!1,t+=this.i18n.xMinMaxExtent),this._yMinInput.get("value")>this._yMaxInput.get("value")&&(e=!1,t+="<br/>"+this.i18n.yMinMaxExtent),e||this._showMessages(t),e},_handleSRDlgOk:function(){var e,t,s;for(var i in this._spatialRefGrid.get("selection"))this._spatialRefGrid.get("selection").hasOwnProperty(i)&&(e=i);s=(t=this._spatialRefGrid.collection.getSync(e)).sRef.wkid,this.viewModel.showOkCancel?this._outSRClick?this._outSR={wkid:parseInt(s,10)}:this._processSR={wkid:parseInt(s,10)}:this.viewModel.set(this._outSRClick?"outSR":"processSR",{wkid:parseInt(s,10)}),this._outSRClick?this._outSRInput.textbox.value=s:this._processSRInput.textbox.value=s,this._outSRClick?u.set(this._outSRLabel,"innerHTML",t.name):u.set(this._processSRLabel,"innerHTML",t.name)},_handleSRDlgCancel:function(){},_handleOutSRInputChange:function(e){e&&(u.set(this._outSRLabel,"innerHTML",""),$.updateDisplay([this._outSRLabel],!1,"inline"),this.viewModel.showOkCancel?(this._outSR={wkid:parseInt(e,10)},this._state.outSRLayer=null):this.viewModel.set("outSR",{wkid:parseInt(e,10)}))},_handleProcessSRInputChange:function(e){e&&(u.set(this._processSRLabel,"innerHTML",""),$.updateDisplay([this._processSRLabel],!1,"inline"),this.viewModel.showOkCancel?(this._processSR={wkid:parseInt(e,10)},this._state.pSRLayer=null):this.viewModel.set("processSR",{wkid:parseInt(e,10)}))},_handleCellSizeSelectChange:function(e){var t;$.updateDisplay([this._cellSelectNumRow],"SPECIFIED"===e&&this.viewModel.showRasterSettings,"table-row"),-1!==e.indexOf("LAYER_")?(t=this._cellSizeSelect.getOptions(e),this.viewModel.showOkCancel?(this._cellSize={url:t.url},this._state.cellSizeLayer={name:t.label.substring("Layer ".length),url:t.url,fullExtent:t.fullExtent}):this.viewModel.set("cellSize",{url:t.url})):"SPECIFIED"===e?this.viewModel.showOkCancel?(this._cellSize=this._cellSizeInput.get("value"),this._state.cellSizeLayer=null):this.viewModel.set("cellSize",this._cellSizeInput.get("value")):this.viewModel.showOkCancel?(this._cellSize=e,this._state.cellSizeLayer=null):this.viewModel.set("cellSize",e)},_handleSnapRasterSelectChange:function(e){var t;-1!==e.indexOf("LAYER_")?(t=this._snapRasterSelect.getOptions(e),this.viewModel.showOkCancel?(this._snapRaster={url:t.url},this._state.snapRasterLayer={name:t.label.substring("Layer ".length),url:t.url,fullExtent:t.fullExtent}):this.viewModel.set("snapRaster",{url:t.url})):this.viewModel.showOkCancel?(this._snapRaster="NONE"===e?void 0:e,this._state.snapRasterLayer=null):this.viewModel.set("snapRaster","NONE"===e?void 0:e)},_handleMaskSelectChange:function(e){var t;-1!==e.indexOf("LAYER_")?(t=this._maskSelect.getOptions(e),this.viewModel.showOkCancel?(this._mask={url:t.url},this._state.maskLayer={name:t.label.substring("Layer ".length),url:t.url,fullExtent:t.fullExtent}):this.viewModel.set("mask",{url:t.url})):this.viewModel.showOkCancel?(this._mask="NONE"===e?void 0:e,this._state.maskLayer=null):this.viewModel.set("mask","NONE"===e?void 0:e)},_handleCellSizeInputChange:function(e){e&&"SPECIFIED"===this._cellSizeSelect.get("value")&&(this.viewModel.showOkCancel?this._cellSize=e:this.viewModel.set("cellSize",e))},_handleDSSelectChange:function(e){this.viewModel.showOkCancel||this.viewModel.set("datastore",e.value)},_handleProcessorTypeSelectChange:function(e){this.viewModel.showOkCancel?this._processorType="NONE"===e?void 0:e:this.viewModel.set("processorType",e),this.viewModel.set("showRasterPPFSettings",this.viewModel.showRasterPTSettings)},_handleparallelProcessingFactorInputChange:function(e){this.viewModel.showOkCancel?this._parallelProcessingFactor=e:this.viewModel.set("parallelProcessingFactor",e)},_handlerecycleProcessingWorkersInputChange:function(e){this.viewModel.showOkCancel?this._recycleProcessingWorkers=e:this.viewModel.set("recycleProcessingWorkers",e)},_handleretryOnFailuresInputChange:function(e){this.viewModel.showOkCancel?this._retryOnFailures=e:this.viewModel.set("retryOnFailures",e)},_handleResamplingMethodSelectChange:function(e){this.viewModel.showOkCancel?this._resamplingMethod=e:this.viewModel.set("resamplingMethod",e)},_updateLayerOptions:function(e){var t,s,l,a,o,h=i.map(e,(function(e,t){return{value:"LAYER_"+t,label:"Layer "+e.name,url:e.url,fullExtent:e.fullExtent}})),n=[{value:"minof",label:this.i18n.minInputs},{value:"maxof",label:this.i18n.maxInputs,selected:!0},{value:"SPECIFIED",label:this.i18n.extentSpecfiedBelow}],r=[{value:"DEFAULT",label:this.i18n.defaultLabel},{value:"SPECIFIED",label:this.i18n.extentSpecfiedBelow}],c=[{value:"DEFAULT",label:this.i18n.defaultExtentLabel},{value:"SPECIFIED",label:this.i18n.extentSpecfiedBelow}],u=[{value:"GPU",label:this.i18n.gpu},{value:"CPU",label:this.i18n.cpu}],d=[{value:"NEAREST",label:this.i18n.nearest},{value:"BILINEAR",label:this.i18n.bilinear},{value:"CUBIC",label:this.i18n.cubic}];l=[].concat(c).concat(h),a=[].concat(r).concat(h),t=i.filter(e,(function(e){return e instanceof Q||"esri.layers.RasterXLayer"===e.declaredClass||e.url&&"imageserver"===e.url.split("/").pop().toLowerCase()})),s=[].concat(i.map(t,(function(e,t){return{value:"LAYER_"+e.name,label:"Layer "+e.name,url:e.url,fullExtent:e.fullExtent}}),this)),o=i.map(e,(function(e,s){return t.indexOf(e)>-1?{value:"LAYER_"+e.name,label:"Layer "+e.name,url:$.constructAnalysisInputLyrObj(e).url,fullExtent:e.fullExtent}:{value:"LAYER_"+s,label:"Layer "+e.name,url:e.url,fullExtent:e.fullExtent}})),this._layerNames=i.map(e,(function(e,t){return e.name})),this._outSRSelect.removeOption(this._outSRSelect.getOptions()),this._processSRSelect.removeOption(this._processSRSelect.getOptions()),this._extentSelect.removeOption(this._extentSelect.getOptions()),this._maskSelect.removeOption(this._maskSelect.getOptions()),this._cellSizeSelect.removeOption(this._cellSizeSelect.getOptions()),this._snapRasterSelect.removeOption(this._snapRasterSelect.getOptions()),this._processorTypeSelect.removeOption(this._processorTypeSelect.getOptions()),this._resamplingMethodSelect.removeOption(this._resamplingMethodSelect.getOptions()),this._outSRSelect.addOption(l),this._processSRSelect.addOption(l),this._extentSelect.addOption(a),this._maskSelect.addOption([{value:"NONE",label:""}].concat(o)),this._cellSizeSelect.addOption([].concat(n).concat(s)),this._snapRasterSelect.addOption([{value:"NONE",label:""}].concat(s)),this._processorTypeSelect.addOption([{value:"NONE",label:""}].concat(u)),this._resamplingMethodSelect.addOption(d),this._updateExtentSelectValue(),this._updateOutSRSelectValue(),this._updateProcessSRSelectValue(),this._updateCellSizeSelectValue(),this._updateSnapRasterSelectValue(),this._updateMaskSelectValue(),this._updateProcessorTypeSelectValue(),this._updateparallelProcessingFactorInputValue(),this._updaterecycleProcessingWorkersInputValue(),this._updateretryOnFailuresInputValue(),this._updateResamplingMethodSelectValue()},_handleCloseAnalysisCheck:function(e){this.viewModel.showOkCancel||this.viewModel.set("closeAnalysisWidget",e)},_handleReturnFeatureCollectionCheck:function(e){this.viewModel.showOkCancel||this.viewModel.set("returnFeatureCollection",!e)},_handleOkButtonClick:function(e){e&&e.preventDefault(),this._form.validate()&&("SPECIFIED"!==this._extentSelect.get("value")||this._validateExtent())&&(this.viewModel.set("viewProps",this._state),"DEFAULT"!==this._outSRSelect.get("value")?this.viewModel.set("outSR",this._outSR):"DEFAULT"===this._outSRSelect.get("value")&&this.viewModel.set("outSR",null),"DEFAULT"!==this._processSRSelect.get("value")?this.viewModel.set("processSR",this._processSR):"DEFAULT"===this._processSRSelect.get("value")&&this.viewModel.set("processSR",null),"SPECIFIED"===this._extentSelect.get("value")&&this._validateExtent()&&(this._extent=new q(this._xMinInput.get("value"),this._yMinInput.get("value"),this._xMaxInput.get("value"),this._yMaxInput.get("value"),new K({wkid:102100}))),this.viewModel.set("extent",this._extent),this.viewModel.set("mask",this._mask),this.viewModel.set("snapRaster",this._snapRaster),this.viewModel.set("cellSize",this._cellSize),this.viewModel.set("resamplingMethod",this._resamplingMethod),this.viewModel.set("creditWarningChecked",this._creditWarning),this._dataStoreSelect&&this.viewModel.set("datastore",this._dataStoreSelect.get("value")),this.viewModel.set("closeAnalysisWidget",this._closeAnalysisCheck.get("checked")),this.viewModel.set("returnFeatureCollection",!this._storeAnalysisCheck.get("checked")),this.viewModel.set("isCustomExtent","SPECIFIED"===this._extentSelect.get("value")),this.viewModel.set("isCustomOutSR","SPECIFIED"===this._outSRSelect.get("value")),this.viewModel.set("isCustomProcessSR","SPECIFIED"===this._processSRSelect.get("value")),this.viewModel.set("isCustomCellSize","SPECIFIED"===this._cellSizeSelect.get("value")),this.viewModel.set("processorType",this._processorType),this.viewModel.set("parallelProcessingFactor",this._parallelProcessingFactor),this.viewModel.set("recycleProcessingWorkers",this._recycleProcessingWorkers),this.viewModel.set("retryOnFailures",this._retryOnFailures),this.viewModel.save(),this.emit("ok-settings",{viewMode:this.viewModel}))},_handleCancelButtonClick:function(){this.viewModel.reset(),this.reset(),this.emit("cancel-settings",{viewMode:this.viewModel})},_handleCreditWarningCheck:function(e){this.viewModel.set("creditWarning",e)},reset:function(){"SPECIFIED"!==this._extentSelect.get("value")||this._validateExtent()||this.viewModel.get("isCustomExtent")||(this._xMinInput.reset(),this._xMaxInput.reset(),this._yMinInput.reset(),this._yMaxInput.reset()),this.initUI()},_showMessages:function(e){u.set(this._bodyNode,"innerHTML",e),v.fadeIn({node:this._errorMessagePane,easing:g.quadIn,onEnd:s.hitch(this,(function(){c.set(this._errorMessagePane,{display:""})}))}).play()},_handleCloseMsg:function(e){e&&e.preventDefault(),v.fadeOut({node:this._errorMessagePane,easing:g.quadOut,onEnd:s.hitch(this,(function(){c.set(this._errorMessagePane,{display:"none"})}))}).play()}});return h("extend-esri")&&s.setObject("dijit.analysis.Settings",oe,J),oe}));