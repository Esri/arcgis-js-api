// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.40/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/has","dojo/_base/array","dojo/_base/json","dojo/dom-class","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/_OnDijitClickMixin","dijit/_FocusMixin","../../kernel","../../lang","./RasterAnalysisMixin","./ItemTypes","./utils","dojo/i18n!../../nls/jsapi","dojo/text!./templates/ConvertRasterToFeature.html"],(function(e,t,i,s,a,l,r,u,o,n,h,p,c,d,m,y,_,F){var g=e([r,u,o,n,h,d],{declaredClass:"esri.dijit.analysis.ConvertRasterToFeature",templateString:F,widgetsInTemplate:!0,browseType:[m.IS],inputLayer:null,valueField:null,simplify:!0,outputType:"Point",resultParameter:"outputFeatures",analysisType:"feature",toolName:"ConvertRasterToFeature",helpFileName:"ConvertRasterToFeature",toolNlsName:_.convertRasterToFeatureTool,rasterGPToolName:"ConvertRasterToFeature",constructor:function(e,t){this._pbConnects=[],e.containerNode&&(this.container=e.containerNode),e.rerun&&(e.inputLayer=e.inputRaster,e.simplify=e.simplifyLinesOrPolygons)},_getJobParameters:function(){var e=this.inputLayer.hasRasterAttributeTable?this.get("valueField"):null,i=a.toJson(this._getRasterObject(this.get("inputLayer"))),s=this.get("simplify"),l=this.get("outputType"),r={};return"Polygon"===l&&(r.createMultipartFeatures=this.get("createMultipartFeatures"),r.maxVerticesPerFeature=this.get("maxVerticesPerFeature")),t.mixin({valueField:e,inputRaster:i,simplifyLinesOrPolygons:s,outputType:l},r)},_setDefaultInputs:function(){this.set("valueFieldSelect",this.valueField),this._simplifyCheck.set("checked",this.simplify),this._simplifyCheck.set("disabled","Point"===this.outputType),this._point.set("checked","Point"===this.outputType),this._line.set("checked","Line"===this.outputType),"Polygon"===this.outputType?(this._polygon.set("checked",!0),this._showPolygonFeatures(!0)):this._showPolygonFeatures(!1)},_handleOutputTypePointChange:function(e){e&&(this.outputType="Point",this._simplifyCheck.set("disabled",!0),this._showPolygonFeatures(!1))},_handleOutputTypeLineChange:function(e){e&&(this.outputType="Line",this._simplifyCheck.set("disabled",!1),this._showPolygonFeatures(!1))},_handleOutputTypePolygonChange:function(e){e&&(this.outputType="Polygon",this._simplifyCheck.set("disabled",!e),this._showPolygonFeatures(!0))},_resetUI:function(){this.set("valueFieldSelect",this.valueField)},_setValueFieldSelectAttr:function(e){if(this._valueFieldSelect.removeOption(this._valueFieldSelect.getOptions()),this.inputLayer)if(this.inputLayer.hasRasterAttributeTable){var t=this.inputLayer._rasterAttributeTableFields;s.forEach(t,(function(e){-1!==s.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString"],e.type)&&e.name!==this.inputLayer.objectIdField&&this._valueFieldSelect.addOption({value:e.name,label:c.isDefined(e.alias)&&""!==e.alias?e.alias:e.name})}),this),e&&this._valueFieldSelect.set("value",e)}else this._valueFieldSelect.addOption({value:"VALUE",label:"VALUE"})},_setValueFieldAttr:function(e){this.valueField=e},_getValueFieldAttr:function(){return this._valueFieldSelect&&this._valueFieldSelect.get("value")&&(this.valueField=this._valueFieldSelect.get("value")),this.valueField},_setMaxVerticesPerFeatureAttr:function(e){this.maxVerticesPerFeature=e,this._maximumVertices&&this._maximumVertices.set("value",e)},_getMaxVerticesPerFeatureAttr:function(){if("Polygon"===this.outputType&&this._maximumVertices&&this._maximumVertices.get("value"))return this.maxVerticesPerFeature=this._maximumVertices.get("value"),this.maxVerticesPerFeature},_setCreateMultipartFeaturesAttr:function(e){this.createMultipartFeatures=e,this._multipartCheck&&this._multipartCheck.set("checked",e)},_getCreateMultipartFeaturesAttr:function(){if("Polygon"===this.outputType&&this._multipartCheck&&this._multipartCheck.get("value"))return this.createMultipartFeatures=this._multipartCheck.get("checked"),this.createMultipartFeatures},_getSimplifyAttr:function(){return this._simplifyCheck&&(this.simplify=this._simplifyCheck.get("checked")),this.simplify},_setSimplifyAttr:function(e){this.simplify=e},_showPolygonFeatures:function(e){l.toggle(this._multipartCheckRow,"hide",!e),l.toggle(this._maximumVerticesRow,"hide",!e),l.toggle(this._multipartCheckRow,"show",e),l.toggle(this._maximumVerticesRow,"show",e)}});return i("extend-esri")&&t.setObject("dijit.analysis.ConvertRasterToFeature",g,p),g}));