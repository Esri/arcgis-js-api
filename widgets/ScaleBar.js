/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/screenUtils","../core/watchUtils","./support/widgetUtils","./support/decorators/messageBundle","../chunks/index","./Widget","./ScaleBar/ScaleBarViewModel"],(function(e,r,t,s,a,i,l,o,n,c,d,u,b,p,_,h,v,w){"use strict";const y={base:"esri-scale-bar esri-widget",labelContainer:"esri-scale-bar__label-container",rulerLabelContainer:"esri-scale-bar__label-container--ruler",lineLabelContainer:"esri-scale-bar__label-container--line",topLabelContainer:"esri-scale-bar__label-container--top",bottomLabelContainer:"esri-scale-bar__label-container--bottom",label:"esri-scale-bar__label",line:"esri-scale-bar__line",topLine:"esri-scale-bar__line--top",bottomLine:"esri-scale-bar__line--bottom",ruler:"esri-scale-bar__ruler",rulerBlock:"esri-scale-bar__ruler-block",barContainer:"esri-scale-bar__bar-container",rulerBarContainer:"esri-scale-bar__bar-container--ruler",lineBarContainer:"esri-scale-bar__bar-container--line",disabled:"esri-disabled"};function m(e){return 2*e}let f=function(r){function t(e,t){var s;return(s=r.call(this,e,t)||this).label=void 0,s.messages=null,s.unit="non-metric",s.view=null,s.viewModel=new w,s}e._inheritsLoose(t,r);var s=t.prototype;return s.initialize=function(){this.own([b.whenTrue(this,"view.stationary",(()=>this.scheduleRender())),b.watch(this,["view.center","view.scale","view.zoom"],(()=>{this.view.stationary&&this.scheduleRender()}))])},s.castStyle=function(e){return"line"===e?e:"ruler"},s.castUnit=function(e){return"metric"===e||"dual"===e?e:"non-metric"},s.render=function(){const e="disabled"===this.get("viewModel.state"),r={[y.disabled]:e};let t,s;if(!e){const{unit:e,style:r}=this,a="metric"===e||"dual"===e,i=50;if("non-metric"===e||"dual"===e){const e=this.viewModel.getScaleBarProperties(i,"non-metric");e&&(s="ruler"===r?this._renderRuler(e):this._renderLine(e,"bottom"))}if(a){const e=this.viewModel.getScaleBarProperties(i,"metric");e&&(t="ruler"===r?this._renderRuler(e):this._renderLine(e,"top"))}}return h.jsx("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(y.base,r)},t,s)},s._renderRuler=function(e){const r=m(Math.round(e.length)),{messages:t}=this,s=t[e.unit]||t.unknownUnit,a=`${m(e.value)} ${s}`;return h.jsx("div",{class:this.classes(y.barContainer,y.rulerBarContainer),key:"esri-scale-bar__ruler"},h.jsx("div",{class:y.ruler,styles:{width:`${r}px`}},h.jsx("div",{class:y.rulerBlock}),h.jsx("div",{class:y.rulerBlock}),h.jsx("div",{class:y.rulerBlock}),h.jsx("div",{class:y.rulerBlock})),h.jsx("div",{class:this.classes(y.labelContainer,y.rulerLabelContainer)},h.jsx("div",{class:y.label},"0"),h.jsx("div",{class:y.label},a)))},s._renderLine=function(e,r){const{messages:t}=this,s=t[e.unit]||t.unknownUnit,a=`${m(e.value)} ${s}`,i={[y.topLabelContainer]:"top"===r,[y.bottomLabelContainer]:"bottom"===r},l=h.jsx("div",{class:this.classes(y.labelContainer,y.lineLabelContainer,i),key:"esri-scale-bar__label"},h.jsx("div",{class:y.label},a)),o={[y.topLine]:"top"===r,[y.bottomLine]:"bottom"===r},n=m(Math.round(e.length)),c=h.jsx("div",{class:this.classes(y.line,o),key:"esri-scale-bar__line",styles:{width:`${n}px`}});return h.jsx("div",{class:this.classes(y.barContainer,y.lineBarContainer),key:"esri-scale-bar__line-container"},[c,l])},s._handleRootCreateOrUpdate=function(e){const r=this.viewModel;if(!r)return;const t=e.getBoundingClientRect(),s=t.left+window.pageXOffset,a=t.top+window.pageYOffset,i=u.createScreenPoint(s,a);(i.x!==r.scaleComputedFrom.x||i.y!==r.scaleComputedFrom.y)&&(r.scaleComputedFrom=i)},e._createClass(t,[{key:"style",set:function(e){const r="dual"===this.unit?"line":e;this._set("style",r)}}]),t}(v);return r.__decorate([a.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0),r.__decorate([a.property(),_.messageBundle("esri/widgets/ScaleBar/t9n/ScaleBar")],f.prototype,"messages",void 0),r.__decorate([a.property()],f.prototype,"style",null),r.__decorate([l.cast("style")],f.prototype,"castStyle",null),r.__decorate([a.property()],f.prototype,"unit",void 0),r.__decorate([l.cast("unit")],f.prototype,"castUnit",null),r.__decorate([i.aliasOf("viewModel.view")],f.prototype,"view",void 0),r.__decorate([a.property()],f.prototype,"viewModel",void 0),f=r.__decorate([o.subclass("esri.widgets.ScaleBar")],f),f}));
