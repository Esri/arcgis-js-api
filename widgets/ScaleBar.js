// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../core/screenUtils","../core/watchUtils","../core/accessorSupport/decorators","./Widget","./ScaleBar/ScaleBarViewModel","./support/widget"],(function(e,t,r,s,i,a,l,n,o){"use strict";var c="esri-scale-bar esri-widget",d="esri-scale-bar__label-container",u="esri-scale-bar__label-container--ruler",p="esri-scale-bar__label-container--line",_="esri-scale-bar__label-container--top",b="esri-scale-bar__label-container--bottom",v="esri-scale-bar__label",h="esri-scale-bar__line",y="esri-scale-bar__line--top",w="esri-scale-bar__line--bottom",f="esri-scale-bar__ruler",g="esri-scale-bar__ruler-block",m="esri-scale-bar__bar-container",x="esri-scale-bar__bar-container--ruler",M="esri-scale-bar__bar-container--line",S="esri-disabled";function U(e){return 2*e}return function(e){function t(t,r){var s=e.call(this,t,r)||this;return s.label=void 0,s.messages=null,s.unit="non-metric",s.view=null,s.viewModel=new n,s}return r.__extends(t,e),t.prototype.initialize=function(){var e=this;this.own([i.whenTrue(this,"view.stationary",(function(){return e.scheduleRender()})),i.watch(this,["view.center","view.scale","view.zoom"],(function(){e.view.stationary&&e.scheduleRender()}))])},Object.defineProperty(t.prototype,"style",{set:function(e){var t="dual"===this.unit?"line":e;this._set("style",t)},enumerable:!1,configurable:!0}),t.prototype.castStyle=function(e){return"line"===e?e:"ruler"},t.prototype.castUnit=function(e){return"metric"===e||"dual"===e?e:"non-metric"},t.prototype.render=function(){var e,t,r,s="disabled"===this.get("viewModel.state"),i=((e={})[S]=s,e);if(!s){var a=this.unit,l=this.style,n="metric"===a||"dual"===a;if("non-metric"===a||"dual"===a){var d=this.viewModel.getScaleBarProperties(50,"non-metric");d&&(r="ruler"===l?this._renderRuler(d):this._renderLine(d,"bottom"))}if(n){var u=this.viewModel.getScaleBarProperties(50,"metric");u&&(t="ruler"===l?this._renderRuler(u):this._renderLine(u,"top"))}}return o.tsx("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(c,i)},t,r)},t.prototype._renderRuler=function(e){var t=U(Math.round(e.length)),r=this.messages,s=r[e.unit]||r.unknownUnit,i=U(e.value)+" "+s;return o.tsx("div",{class:this.classes(m,x),key:"esri-scale-bar__ruler"},o.tsx("div",{class:f,styles:{width:t+"px"}},o.tsx("div",{class:g}),o.tsx("div",{class:g}),o.tsx("div",{class:g}),o.tsx("div",{class:g})),o.tsx("div",{class:this.classes(d,u)},o.tsx("div",{class:v},"0"),o.tsx("div",{class:v},i)))},t.prototype._renderLine=function(e,t){var r,s,i=this.messages,a=i[e.unit]||i.unknownUnit,l=U(e.value)+" "+a,n=((r={})[_]="top"===t,r[b]="bottom"===t,r),c=o.tsx("div",{class:this.classes(d,p,n),key:"esri-scale-bar__label"},o.tsx("div",{class:v},l)),u=((s={})[y]="top"===t,s[w]="bottom"===t,s),f=U(Math.round(e.length)),g=o.tsx("div",{class:this.classes(h,u),key:"esri-scale-bar__line",styles:{width:f+"px"}});return o.tsx("div",{class:this.classes(m,M),key:"esri-scale-bar__line-container"},[g,c])},t.prototype._handleRootCreateOrUpdate=function(e){var t=this.viewModel;if(t){var r=e.getBoundingClientRect(),i=r.left+window.pageXOffset,a=r.top+window.pageYOffset;t.scaleComputedFrom=s.createScreenPoint(i,a)}},r.__decorate([a.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),r.__decorate([a.property(),o.renderable(),o.messageBundle("esri/widgets/ScaleBar/t9n/ScaleBar")],t.prototype,"messages",void 0),r.__decorate([a.property({dependsOn:["unit"]}),o.renderable()],t.prototype,"style",null),r.__decorate([a.cast("style")],t.prototype,"castStyle",null),r.__decorate([a.property(),o.renderable()],t.prototype,"unit",void 0),r.__decorate([a.cast("unit")],t.prototype,"castUnit",null),r.__decorate([a.aliasOf("viewModel.view"),o.renderable()],t.prototype,"view",void 0),r.__decorate([a.property(),o.renderable(["viewModel.state"])],t.prototype,"viewModel",void 0),t=r.__decorate([a.subclass("esri.widgets.ScaleBar")],t)}(l)}));