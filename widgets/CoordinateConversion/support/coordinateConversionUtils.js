/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../../geometry","../../../core/Error","../../../core/maybe","../../../geometry/support/webMercatorUtils","../../../rest/support/ProjectParameters","../../../geometry/Point","../../../geometry/SpatialReference"],(function(e,o,t,n,r,i,c,a){"use strict";const s={utm:{conversionMode:"utmDefault",addSpaces:!0},usng:{numOfDigits:5,rounding:!1,addSpaces:!1},mgrs:{rounding:!1}},u=new Array(3);function d(e,o){const t=f(o);return[e[0].toFixed(t),e[1].toFixed(t)]}function f(e){return e>=500?6:e<500&&e>=50?7:e<50&&e>=5?8:9}function l(e){const{geometryServicePromise:o,coordinate:n,spatialReference:r,formatName:i}=e;return o.then((e=>e.fromGeoCoordinateString({strings:[n],sr:r,conversionType:i}).then((e=>{const o=new c({x:e[0][0],y:e[0][1],spatialReference:r});if(!g(o))throw e;return o})).catch((e=>{throw new t("coordinate-conversion:from-geo-coordinate-string-failed","Failed to convert coordinate notation",{notationResult:e})}))))}function m(e,o){const t=e.indexOf(",")>=0?",":" ",[n,r,i]=e.split(t).map((e=>{const o=e.trim();return o?Number(o):null}));if(!p(n)||!p(r))return null;const s=new c({x:n,y:r,spatialReference:o||a.WGS84});return i&&(s.z=i,s.hasZ=!0),s}function p(e){return"number"==typeof e&&isFinite(e)}function g(e){return e&&p(e.x)&&p(e.y)}function y(e,o){if(e.spatialReference.isGeographic&&o){const[t,n]=d([e.x,e.y],o);return`${t}, ${n}`}return`${e.x.toFixed(3)}, ${e.y.toFixed(3)}`}function w(e,o){const{spatialReference:c,geometryServicePromise:a,location:s,scale:d}=e;if(!c||s.spatialReference.wkid===c.wkid)return Promise.resolve({location:s,coordinate:y(s,d)});const f=r.project(s,c);if(n.isSome(f))return Promise.resolve({location:f,coordinate:y(f,d)});if(u[0]===s&&u[1]===c.wkid)return u[2];u[0]=s,u[1]=c.wkid;const l=a.then((e=>e.project(new i({geometries:[s],outSpatialReference:c}),{signal:o}).then((e=>{if(!g(e[0]))throw e[0];return{location:e[0],coordinate:y(e[0],d)}})).catch((e=>{throw new t("coordinate-conversion:projection-failed","Failed to project point",{projectionResult:e})}))));return u[2]=l,l}function h(e){const{formatName:o,location:n,geometryServicePromise:r}=e,i=s[o]||{},c={coordinates:[[n.x,n.y]],sr:n.spatialReference,conversionType:o,...i};return r.then((e=>e.toGeoCoordinateString(c).then((e=>{const o=e[0];if(!o)throw e;return o})).catch((e=>{throw new t("coordinate-conversion:to-geo-coordinate-string-failed","Failed to convert coordinate notation",{notationResult:e})}))))}function v(e){return"dd"===e||"dms"===e||"ddm"===e||"mgrs"===e||"usng"===e||"utm"===e}e.clipLonLat=d,e.fromGeoCoordinateString=l,e.fromXY=m,e.getDegreePrecision=f,e.isSupportedNotation=v,e.isValidPoint=g,e.pointToCoordinate=y,e.project=w,e.toGeoCoordinateString=h,Object.defineProperty(e,"__esModule",{value:!0})}));
