/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/promiseUtils","./support/widgetUtils","./support/decorators/messageBundle","../chunks/index","./Widget","./Measurement/MeasurementViewModel"],(function(e,t,i,s,r,o,n,a,c,l,d,u,w,v,p,g,h,_){"use strict";function f(e){return Object.freeze({__proto__:null,default:e})}const M={base:"esri-measurement",widgetIcon:"esri-icon-measure"};function y(e){return e&&("esri.widgets.AreaMeasurement2D"===e.declaredClass||"esri.widgets.AreaMeasurement3D"===e.declaredClass)}let m=function(i){function s(e,t){var s;return(s=i.call(this,e,t)||this)._widgets=new Map,s.activeTool=null,s.activeWidget=null,s.areaUnit=null,s.iconClass=M.widgetIcon,s.label=void 0,s.linearUnit=null,s.messages=null,s.view=null,s.viewModel=new _,s}t._inheritsLoose(s,i);var r=s.prototype;return r.initialize=function(){this.activeWidget&&this.viewModel.set("activeViewModel",this.activeWidget.viewModel),this.view&&this.activeTool&&this._getActiveWidget().then((e=>{this._set("activeWidget",e)})),this.own([this.watch(["view","activeTool"],(()=>{this._getActiveWidget().then((e=>{this._set("activeWidget",e)}))})),this.watch("activeWidget",((e,t)=>{this.viewModel.set("activeViewModel",e?e.viewModel:null),t&&(t.visible=!1)})),this.watch(["areaUnit","linearUnit"],(()=>this._updateWidgetUnits()))])},r.destroy=function(){this._destroyWidgets()},r.render=function(){const{activeWidget:e}=this,t=e&&!e.destroyed?e.render():null;return g.jsx("div",{class:M.base},t)},r.clear=function(){this.activeTool=null,this._destroyWidgets()},r.startMeasurement=function(){const{activeViewModel:e}=this.viewModel;e&&w.ignoreAbortErrors(e.start())},r._createWidget=async function(t){const{areaUnit:i,linearUnit:s,view:r}=this;switch(t){case"area":{const{type:t}=r;switch(t){case"2d":return new(0,(await new Promise((function(t,i){e(["./AreaMeasurement2D"],(function(e){t(f(e))}),i)}))).default)({view:r,unit:i});case"3d":return new(0,(await new Promise((function(t,i){e(["./AreaMeasurement3D"],(function(e){t(f(e))}),i)}))).default)({view:r,unit:i});default:return null}}case"distance":return new(0,(await new Promise((function(t,i){e(["./DistanceMeasurement2D"],(function(e){t(f(e))}),i)}))).default)({view:r,unit:s});case"direct-line":return new(0,(await new Promise((function(t,i){e(["./DirectLineMeasurement3D"],(function(e){t(f(e))}),i)}))).default)({view:r,unit:s});default:return null}},r._destroyWidgets=function(){this._widgets.forEach((e=>e.destroy())),this._widgets.clear()},r._getActiveWidget=async function(){const{activeTool:e,view:t}=this;if(!t||!e)return null;let i=null;if(this._widgets.has(e))i=this._widgets.get(e),i.visible=!0;else{if(i=await this._createWidget(e),!i)return null;await i.viewModel.start(),this._widgets.set(e,i)}return i},r._updateWidgetUnits=function(){this._widgets.forEach((e=>{const{areaUnit:t,linearUnit:i}=this;e.unit=y(e)?t:i}))},s}(h);return i.__decorate([a.aliasOf("viewModel.activeTool")],m.prototype,"activeTool",void 0),i.__decorate([n.property({readOnly:!0})],m.prototype,"activeWidget",void 0),i.__decorate([a.aliasOf("viewModel.areaUnit")],m.prototype,"areaUnit",void 0),i.__decorate([n.property()],m.prototype,"iconClass",void 0),i.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],m.prototype,"label",void 0),i.__decorate([a.aliasOf("viewModel.linearUnit")],m.prototype,"linearUnit",void 0),i.__decorate([n.property(),p.messageBundle("esri/widgets/Measurement/t9n/Measurement")],m.prototype,"messages",void 0),i.__decorate([a.aliasOf("viewModel.view")],m.prototype,"view",void 0),i.__decorate([n.property({type:_})],m.prototype,"viewModel",void 0),m=i.__decorate([c.subclass("esri.widgets.Measurement")],m),m}));
