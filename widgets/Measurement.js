/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/promiseUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/arrayUtils","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","./Widget","./Measurement/MeasurementViewModel","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(e,t,i,r,s,n,o,a,c,l,u,d,p,g){"use strict";const v=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),h={base:"esri-measurement",widgetIcon:"esri-icon-measure"};function w(e){return"esri.widgets.AreaMeasurement2D"===e?.declaredClass||"esri.widgets.AreaMeasurement3D"===e?.declaredClass}let _=function(i){function n(e,t){var r;return(r=i.call(this,e,t)||this)._widgets=new Map,r.activeWidget=null,r.iconClass=h.widgetIcon,r.messages=null,r.viewModel=new u,r}t._inheritsLoose(n,i);var o=n.prototype;return o.initialize=function(){var e=this;this.activeWidget&&this.viewModel.set("activeViewModel",this.activeWidget.viewModel),this.view&&this.activeTool&&this._getActiveWidget().then((e=>{this._set("activeWidget",e)})),this.addHandles([s.watch((()=>[this.view,this.activeTool]),t._asyncToGenerator((function*(){e._set("activeWidget",yield e._getActiveWidget())}))),s.watch((()=>this.activeWidget),((e,t)=>{this.viewModel.set("activeViewModel",e?e.viewModel:null),t&&(t.visible=!1)})),s.watch((()=>[this.areaUnit,this.linearUnit,this.uiStrings]),(()=>this._updateSubWidgetProperties()))])},o.destroy=function(){this._destroyWidgets()},o.render=function(){const{activeWidget:e}=this,t=e&&!e.destroyed?e.render():null;return g.tsx("div",{class:h.base},t)},o.clear=function(){this.activeTool=null,this._destroyWidgets()},o.startMeasurement=function(){const{activeViewModel:e}=this.viewModel;e&&r.ignoreAbortErrors(e.start())},o._createWidget=function(){var i=t._asyncToGenerator((function*(t){const{areaUnit:i,linearUnit:r,view:s}=this;switch(t){case"area":{const{type:r}=s;switch(r){case"2d":return new(0,(yield new Promise(((t,i)=>e(["./AreaMeasurement2D"],(e=>t(v(e))),i)))).default)({view:s,unit:i,uiStrings:this._createUIStringsForWidget(t)});case"3d":return new(0,(yield new Promise(((t,i)=>e(["./AreaMeasurement3D"],(e=>t(v(e))),i)))).default)({view:s,unit:i,uiStrings:this._createUIStringsForWidget(t)});default:return null}}case"distance":{const{type:i}=s;if("2d"===i){return new(0,(yield new Promise(((t,i)=>e(["./DistanceMeasurement2D"],(e=>t(v(e))),i)))).default)({view:s,unit:r,uiStrings:this._createUIStringsForWidget(t)})}return null}case"direct-line":{const{type:i}=s;if("3d"===i){return new(0,(yield new Promise(((t,i)=>e(["./DirectLineMeasurement3D"],(e=>t(v(e))),i)))).default)({view:s,unit:r,uiStrings:this._createUIStringsForWidget(t)})}return null}default:return null}}));function r(e){return i.apply(this,arguments)}return r}(),o._destroyWidgets=function(){this._widgets.forEach((e=>e.destroy())),this._widgets.clear()},o._getActiveWidget=function(){var e=t._asyncToGenerator((function*(){const{activeTool:e,view:t}=this;if(!t||!e)return null;let i=null;if(this._widgets.has(e))i=this._widgets.get(e),i.visible=!0;else{if(i=yield this._createWidget(e),!i)return null;yield i.viewModel.start(),this._widgets.set(e,i)}return i}));function i(){return e.apply(this,arguments)}return i}(),o._createUIStringsForWidget=function(e){if(!this.uiStrings)return null;const t=e+"-"+this.view.type;return this.uiStrings[t]},o._updateSubWidgetProperties=function(){this._widgets.forEach(((e,t)=>{const{areaUnit:i,linearUnit:r}=this;e.unit=w(e)?i:r,e.uiStrings=this._createUIStringsForWidget(t)}))},t._createClass(n,[{key:"activeTool",get:function(){return this.viewModel.activeTool},set:function(e){this.viewModel.activeTool=e}},{key:"areaUnit",get:function(){return this.viewModel.areaUnit},set:function(e){this.viewModel.areaUnit=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"linearUnit",get:function(){return this.viewModel.linearUnit},set:function(e){this.viewModel.linearUnit=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}}]),n}(l);i.__decorate([n.property()],_.prototype,"activeTool",null),i.__decorate([n.property({readOnly:!0})],_.prototype,"activeWidget",void 0),i.__decorate([n.property()],_.prototype,"areaUnit",null),i.__decorate([n.property()],_.prototype,"iconClass",void 0),i.__decorate([n.property()],_.prototype,"label",null),i.__decorate([n.property()],_.prototype,"linearUnit",null),i.__decorate([n.property(),p.messageBundle("esri/widgets/Measurement/t9n/Measurement")],_.prototype,"messages",void 0),i.__decorate([n.property()],_.prototype,"uiStrings",void 0),i.__decorate([n.property()],_.prototype,"view",null),i.__decorate([n.property({type:u})],_.prototype,"viewModel",void 0),_=i.__decorate([c.subclass("esri.widgets.Measurement")],_);return _}));
