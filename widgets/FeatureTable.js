/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/HandleOwner","../core/reactiveUtils","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./FeatureTable/FeatureTableViewModel","./FeatureTable/Grid/support/ButtonMenu","./FeatureTable/Grid/support/ButtonMenuItem","./support/widgetUtils","./support/decorators/messageBundle","../core/Logger","./support/jsxFactory","../intl/locale","../intl/substitute","../intl/messages"],(function(e,t,l,o,n,i,s,r,a,c,d,u,h,m,g,p,v,_,f,w,b,y){"use strict";const M={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0,selectedRecordsShowAllToggle:!0,selectedRecordsShowSelectedToggle:!0,zoomToSelection:!0},selectionColumn:!0,columnMenus:!0},S={base:"esri-feature-table",header:"esri-feature-table__header",title:"esri-feature-table__title",content:"esri-feature-table__content",loader:"esri-feature-table__loader",loaderContainer:"esri-feature-table__loader-container",menuContainer:"esri-feature-table__menu",menuIcon:"esri-icon-handle-horizontal",menuItemGroupOpenedIcon:"esri-icon-down",menuItemGroupClosedIcon:"esri-icon-right",checkmarkIcon:"esri-icon-check-mark",widget:"esri-widget"};let C=function(t){function l(e,l){var o;return(o=t.call(this,e,l)||this).activeSortOrders=null,o.attachmentsEnabled=null,o.autoRefreshEnabled=null,o.columnReorderingEnabled=null,o.columns=null,o.editingEnabled=null,o.fieldConfigs=null,o.filterGeometry=null,o.grid=null,o.highlightOnRowSelectEnabled=null,o.label=void 0,o.layer=null,o.messages=null,o.menu=null,o.menuConfig=null,o.multiSortEnabled=null,o.pageSize=null,o.relatedRecordsEnabled=null,o.state=null,o.view=null,o.viewModel=new h,o.visibleElements={...M},o}e._inheritsLoose(l,t);var o=l.prototype;return o.initialize=function(){var t,l,o,i=this;const s=function(){var t=e._asyncToGenerator((function*(){return i.messages=yield y.fetchMessageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")}));return function(){return t.apply(this,arguments)}}();s(),this.handles.add([w.onLocaleChange(s),n.on((()=>this.viewModel.columns),"change",(()=>this._syncMenuConfig())),n.on((()=>this.viewModel.activeFilters),"change",(()=>this._syncMenuConfig())),n.on((()=>this.grid.selectedItems),"change",(e=>{this._syncMenuConfig(),this._onSelectionChange(e)})),n.watch((()=>[this.viewModel.store.querying,this.viewModel.store.syncing]),(()=>this.scheduleRender())),n.watch((()=>this.menuConfig),(()=>this._syncMenuConfig())),n.watch((()=>this.messages),(()=>{var e;this.menu.label=null==(e=this.messages)?void 0:e.options,this._syncMenuConfig()}))]),this._set("menu",new m({label:null==(t=this.messages)?void 0:t.options,iconClass:S.menuIcon,...this.menuConfig}));const{attachmentsEnabled:r,relatedRecordsEnabled:a}=this;null==(l=this.viewModel)||null==(o=l.store)||o.set({attachmentsEnabled:r,relatedRecordsEnabled:a})},o.destroy=function(){var e;this.clearSelection(),this.handles.removeAll(),null==(e=this.menu)||e.destroy()},o.castVisibleElements=function(e){var t;const l={...M,...e};return null==(t=this.grid)||t.set("visibleElements",{...this.grid.visibleElements,selectionColumn:l.selectionColumn,columnMenus:l.columnMenus}),l},o.clearHighlights=function(){},o.clearSelection=function(){},o.clearSelectionFilter=function(){},o.deselectRows=function(){},o.filterBySelection=function(){},o.hideColumn=function(e){var t;null==(t=this.grid)||t.hideColumn(e),this._syncMenuConfig()},o.refresh=function(){},o.showColumn=function(e){var t;null==(t=this.grid)||t.showColumn(e),this._syncMenuConfig()},o.sortColumn=function(){},o.selectRows=function(){},o.scrollToIndex=function(){},o.render=function(){var e;return f.tsx("div",{bind:this,class:this.classes(S.base,S.widget)},this.visibleElements.header?this._renderHeader():null,f.tsx("div",{class:S.content},"disabled"!==this.state&&(null==(e=this.grid)?void 0:e.render())))},o.zoomToSelection=function(){},o._renderHeader=function(){return f.tsx("div",{key:"header",class:S.header},this._renderLoader(),this._renderTitle(),this.visibleElements.menu?this._renderMenu():null)},o._renderTitle=function(){return f.tsx("div",{class:S.title,key:"title"},this._getTitle())},o._getTitle=function(){const{grid:e,layer:{title:t},messages:l,viewModel:{size:o}}=this;return e?b.substitute(l.header,{title:t,count:o,selected:e.selectedItems.length||0}):""},o._renderLoader=function(){const{state:e,store:t}=this.viewModel,l="loading"===e||t.syncing||t.querying;return f.tsx("div",{class:S.loaderContainer},l?f.tsx("div",{class:S.loader,key:"loader"}):null)},o._renderMenu=function(){return f.tsx("div",{class:S.menuContainer},this.menu.render())},o._onSelectionChange=function(e){const{added:t,removed:l}=e;this.emit("selection-change",{added:[...t],removed:[...l]})},o._syncMenuConfig=function(){var e;null==(e=this.menu)||e.set({...this.menuConfig,items:this._getMenuItems()})},o._getMenuItems=function(){var e;const t=null==(e=this.menuConfig)?void 0:e.items,l=this._getDefaultMenuItems(),o=[];return(null==l?void 0:l.length)&&o.push(...l),(null==t?void 0:t.length)&&o.push(...t),o},o._getDefaultMenuItems=function(){var e;const{messages:t,viewModel:l,visibleElements:o}=this,{menuItems:n}=o,i=[];if((null==n?void 0:n.refreshData)&&i.push(new g({selectionEnabled:!1,label:null==t?void 0:t.refreshData,clickFunction:()=>this.refresh()})),this._hasActiveSelection()){const e=this.grid.selectedItems.length,l=this._getSelectionFilter();if((null==n?void 0:n.clearSelection)&&i.push(new g({selectionEnabled:!1,label:null==t?void 0:t.clearSelection,clickFunction:()=>this.clearSelection()})),null!=n&&n.zoomToSelection&&this.view&&i.push(new g({selectionEnabled:!1,label:null==t?void 0:t.zoomToSelection,clickFunction:()=>this.viewModel.zoomToSelection()})),null!=n&&n.selectedRecordsShowSelectedToggle&&(!l||e!==l.objectIds.length)){const e=t.showSelected,l=new g({selectionEnabled:!1,label:e,clickFunction:()=>{this.filterBySelection(),l.set("label",e)}});i.push(l)}}if(null!=n&&n.selectedRecordsShowAllToggle&&this._hasSelectionFilter()){const e=t.showAllRecords,l=new g({selectionEnabled:!1,label:e,clickFunction:()=>{this.clearSelectionFilter(),l.set("label",e)}});i.push(l)}return(null==n?void 0:n.toggleColumns)&&i.push(new g({iconClass:S.menuItemGroupClosedIcon,label:null==t?void 0:t.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:null==l||null==(e=l.columns)?void 0:e.items.map((({header:e,hidden:t,path:l})=>new g({label:e||l,selected:!t,selectionEnabled:!0,iconClass:S.checkmarkIcon,clickFunction:()=>this._toggleColumnFromMenuItem(l)})))})),i.length?i:null},o._toggleMenuItemSelectedIcon=function({item:e}){null==e||e.set("iconClass",null!=e&&e.selected?S.menuItemGroupOpenedIcon:S.menuItemGroupClosedIcon)},o._toggleColumnFromMenuItem=function(e){const{grid:t,viewModel:l}=this,o=l.findColumn(e);null!=o&&o.hidden?t.showColumn(e):t.hideColumn(e)},o._hasActiveSelection=function(){var e,t;return!(null==(e=this.grid)||null==(t=e.selectedItems)||!t.length)},o._getSelectionFilter=function(){var e;return null==(e=this.viewModel.activeFilters)?void 0:e.find((e=>"selection"===e.type))},o._hasSelectionFilter=function(){return!!this._getSelectionFilter()},l}(o.HandleOwnerMixin(u));t.__decorate([i.aliasOf("viewModel.activeSortOrders")],C.prototype,"activeSortOrders",void 0),t.__decorate([i.aliasOf("viewModel.attachmentsEnabled")],C.prototype,"attachmentsEnabled",void 0),t.__decorate([i.aliasOf("viewModel.autoRefreshEnabled")],C.prototype,"autoRefreshEnabled",void 0),t.__decorate([i.aliasOf("viewModel.columnReorderingEnabled")],C.prototype,"columnReorderingEnabled",void 0),t.__decorate([i.aliasOf("viewModel.columns")],C.prototype,"columns",void 0),t.__decorate([i.aliasOf("viewModel.editingEnabled")],C.prototype,"editingEnabled",void 0),t.__decorate([i.aliasOf("viewModel.fieldConfigs")],C.prototype,"fieldConfigs",void 0),t.__decorate([i.aliasOf("viewModel.filterGeometry")],C.prototype,"filterGeometry",void 0),t.__decorate([i.aliasOf("viewModel.grid")],C.prototype,"grid",void 0),t.__decorate([i.aliasOf("viewModel.highlightOnRowSelectEnabled")],C.prototype,"highlightOnRowSelectEnabled",void 0),t.__decorate([c.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],C.prototype,"label",void 0),t.__decorate([i.aliasOf("viewModel.layer")],C.prototype,"layer",void 0),t.__decorate([c.property(),v.messageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")],C.prototype,"messages",void 0),t.__decorate([c.property({readOnly:!0})],C.prototype,"menu",void 0),t.__decorate([c.property()],C.prototype,"menuConfig",void 0),t.__decorate([i.aliasOf("viewModel.multiSortEnabled")],C.prototype,"multiSortEnabled",void 0),t.__decorate([i.aliasOf("viewModel.pageSize")],C.prototype,"pageSize",void 0),t.__decorate([i.aliasOf("viewModel.relatedRecordsEnabled")],C.prototype,"relatedRecordsEnabled",void 0),t.__decorate([i.aliasOf("viewModel.state")],C.prototype,"state",void 0),t.__decorate([i.aliasOf("viewModel.view")],C.prototype,"view",void 0),t.__decorate([c.property()],C.prototype,"viewModel",void 0),t.__decorate([c.property()],C.prototype,"visibleElements",void 0),t.__decorate([a.cast("visibleElements")],C.prototype,"castVisibleElements",null),t.__decorate([i.aliasOf("viewModel.clearHighlights")],C.prototype,"clearHighlights",null),t.__decorate([i.aliasOf("viewModel.clearSelection")],C.prototype,"clearSelection",null),t.__decorate([i.aliasOf("viewModel.clearSelectionFilter")],C.prototype,"clearSelectionFilter",null),t.__decorate([i.aliasOf("viewModel.deselectRows")],C.prototype,"deselectRows",null),t.__decorate([i.aliasOf("viewModel.filterBySelection")],C.prototype,"filterBySelection",null),t.__decorate([i.aliasOf("viewModel.refresh")],C.prototype,"refresh",null),t.__decorate([i.aliasOf("viewModel.sortColumn")],C.prototype,"sortColumn",null),t.__decorate([i.aliasOf("viewModel.selectRows")],C.prototype,"selectRows",null),t.__decorate([i.aliasOf("viewModel.scrollToIndex")],C.prototype,"scrollToIndex",null),t.__decorate([i.aliasOf("viewModel.zoomToSelection")],C.prototype,"zoomToSelection",null),C=t.__decorate([d.subclass("esri.widgets.FeatureTable")],C);return C}));
