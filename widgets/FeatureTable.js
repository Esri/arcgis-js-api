/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/Collection","../intl/locale","../intl/substitute","../intl/messages","../intl","../core/watchUtils","../core/HandleOwner","./support/widgetUtils","./support/decorators/messageBundle","../chunks/index","./Widget","./FeatureTable/Grid/support/ButtonMenuItem","./FeatureTable/Grid/support/ButtonMenu","./FeatureTable/FeatureTableViewModel"],(function(e,t,l,o,n,i,s,r,a,d,c,u,h,m,p,g,_,v,f,w,b,y,M,C,I){"use strict";const E={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0},selectionColumn:!0},O={base:"esri-feature-table",header:"esri-feature-table__header",title:"esri-feature-table__title",content:"esri-feature-table__content",loader:"esri-feature-table__loader",loaderContainer:"esri-feature-table__loader-container",menuContainer:"esri-feature-table__menu",menuIcon:"esri-icon-handle-horizontal",menuItemGroupOpenedIcon:"esri-icon-down",menuItemGroupClosedIcon:"esri-icon-right",checkmarkIcon:"esri-icon-check-mark",widget:"esri-widget"};let S=function(t){function l(e,l){var o;return(o=t.call(this,e,l)||this).attachmentsEnabled=null,o.columns=new u,o.editingEnabled=null,o.fieldConfigs=null,o.filterGeometry=null,o.grid=null,o.highlightOnRowSelectEnabled=!0,o.label=void 0,o.layer=null,o.messages=null,o.menu=null,o.menuConfig=null,o.pageSize=50,o.view=null,o.viewModel=new I,o.visibleElements={...E},o}e._inheritsLoose(l,t);var o=l.prototype;return o.initialize=function(){var e,t,l;const o=async()=>this.messages=await p.fetchMessageBundle("esri/widgets/FeatureTable/t9n/FeatureTable");o(),this.handles.add([h.onLocaleChange(o),_.on(this,"grid.selectedItems","change",(e=>this._onSelectionChange(e))),_.watch(this,["viewModel.store.querying","viewModel.store.syncing","grid.size"],(()=>this.scheduleRender())),_.on(this,"viewModel.columns","change",(()=>this._updateMenuItems())),_.watch(this,"menuConfig",(()=>this._syncMenuConfig())),_.watch(this,"messages",(()=>{var e;this.menu.label=null==(e=this.messages)?void 0:e.options,this._updateMenuItems()}))]),this._set("menu",new C({label:null==(e=this.messages)?void 0:e.options,iconClass:O.menuIcon,...this.menuConfig}));const{attachmentsEnabled:n,relatedRecordsEnabled:i}=this;null==(t=this.viewModel)||null==(l=t.store)||l.set({attachmentsEnabled:n,relatedRecordsEnabled:i})},o.destroy=function(){var e;this.clearSelection(),this.handles.removeAll(),null==(e=this.menu)||e.destroy()},o.castVisibleElements=function(e){var t;const l={...E,...e};return null==(t=this.grid)||t.set("visibleElements",{...this.grid.visibleElements,selectionColumn:l.selectionColumn}),l},o.clearHighlights=function(){},o.clearSelection=function(){},o.deselectRows=function(){},o.hideColumn=function(e){var t;null==(t=this.grid)||t.hideColumn(e),this._updateMenuItems()},o.refresh=function(){},o.showColumn=function(e){var t;null==(t=this.grid)||t.showColumn(e),this._updateMenuItems()},o.sortColumn=function(){},o.selectRows=function(){},o.scrollToIndex=function(){},o.render=function(){var e;return b.jsx("div",{bind:this,class:this.classes(O.base,O.widget)},this.visibleElements.header?this._renderHeader():null,b.jsx("div",{class:O.content},"disabled"!==this.state&&(null==(e=this.grid)?void 0:e.render())))},o._renderHeader=function(){return b.jsx("div",{key:"header",class:O.header},this._renderLoader(),this._renderTitle(),this.visibleElements.menu?this._renderMenu():null)},o._renderTitle=function(){return b.jsx("div",{class:O.title,key:"title"},this._getTitle())},o._getTitle=function(){const{grid:e,layer:{title:t},messages:l,viewModel:{size:o}}=this;return e?m.substitute(l.header,{title:t,count:o,selected:e.selectedItems.length||0}):""},o._renderLoader=function(){const{state:e,store:t}=this.viewModel,l="loading"===e||t.syncing||t.querying;return b.jsx("div",{class:O.loaderContainer},l?b.jsx("div",{class:O.loader,key:"loader"}):null)},o._renderMenu=function(){return b.jsx("div",{class:O.menuContainer},this.menu.render())},o._onSelectionChange=function(e){const{added:t,removed:l}=e;this.emit("selection-change",{added:[...t],removed:[...l]})},o._syncMenuConfig=function(){var e;null==(e=this.menu)||e.set({...this.menuConfig,items:this._getMenuItems()})},o._updateMenuItems=function(){var e;null==(e=this.menu)||e.set("items",this._getMenuItems())},o._getMenuItems=function(){var e;const t=null==(e=this.menuConfig)?void 0:e.items,l=this._getDefaultMenuItems(),o=[];return(null==l?void 0:l.length)&&o.push(...l),(null==t?void 0:t.length)&&o.push(...t),o},o._getDefaultMenuItems=function(){var e;const{messages:t,viewModel:l,visibleElements:o}=this,{menuItems:n}=o,i=[];return(null==n?void 0:n.clearSelection)&&i.push(new M({selectionEnabled:!1,label:null==t?void 0:t.clearSelection,clickFunction:()=>this.clearSelection()})),(null==n?void 0:n.refreshData)&&i.push(new M({selectionEnabled:!1,label:null==t?void 0:t.refreshData,clickFunction:()=>this.refresh()})),(null==n?void 0:n.toggleColumns)&&i.push(new M({iconClass:O.menuItemGroupClosedIcon,label:null==t?void 0:t.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:null==l||null==(e=l.columns)?void 0:e.items.map((({header:e,hidden:t,path:l})=>new M({label:e||l,selected:!t,selectionEnabled:!0,iconClass:O.checkmarkIcon,clickFunction:()=>this._toggleColumnFromMenuItem(l)})))})),i.length?i:null},o._toggleMenuItemSelectedIcon=function({item:e}){null==e||e.set("iconClass",null!=e&&e.selected?O.menuItemGroupOpenedIcon:O.menuItemGroupClosedIcon)},o._toggleColumnFromMenuItem=function(e){const{grid:t,viewModel:l}=this,o=l.findColumn(e);null!=o&&o.hidden?t.showColumn(e):t.hideColumn(e)},l}(v.HandleOwnerMixin(y));return t.__decorate([i.aliasOf("viewModel.attachmentsEnabled")],S.prototype,"attachmentsEnabled",void 0),t.__decorate([i.aliasOf("viewModel.columns")],S.prototype,"columns",void 0),t.__decorate([i.aliasOf("viewModel.editingEnabled")],S.prototype,"editingEnabled",void 0),t.__decorate([i.aliasOf("viewModel.fieldConfigs")],S.prototype,"fieldConfigs",void 0),t.__decorate([i.aliasOf("viewModel.filterGeometry")],S.prototype,"filterGeometry",void 0),t.__decorate([i.aliasOf("viewModel.grid")],S.prototype,"grid",void 0),t.__decorate([i.aliasOf("viewModel.highlightOnRowSelectEnabled")],S.prototype,"highlightOnRowSelectEnabled",void 0),t.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],S.prototype,"label",void 0),t.__decorate([i.aliasOf("viewModel.layer")],S.prototype,"layer",void 0),t.__decorate([n.property(),w.messageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")],S.prototype,"messages",void 0),t.__decorate([n.property({readOnly:!0})],S.prototype,"menu",void 0),t.__decorate([n.property()],S.prototype,"menuConfig",void 0),t.__decorate([i.aliasOf("viewModel.pageSize")],S.prototype,"pageSize",void 0),t.__decorate([i.aliasOf("viewModel.relatedRecordsEnabled")],S.prototype,"relatedRecordsEnabled",void 0),t.__decorate([i.aliasOf("viewModel.state")],S.prototype,"state",void 0),t.__decorate([i.aliasOf("viewModel.view")],S.prototype,"view",void 0),t.__decorate([n.property()],S.prototype,"viewModel",void 0),t.__decorate([n.property()],S.prototype,"visibleElements",void 0),t.__decorate([s.cast("visibleElements")],S.prototype,"castVisibleElements",null),t.__decorate([i.aliasOf("viewModel.clearHighlights")],S.prototype,"clearHighlights",null),t.__decorate([i.aliasOf("viewModel.clearSelection")],S.prototype,"clearSelection",null),t.__decorate([i.aliasOf("viewModel.deselectRows")],S.prototype,"deselectRows",null),t.__decorate([i.aliasOf("viewModel.refresh")],S.prototype,"refresh",null),t.__decorate([i.aliasOf("viewModel.sortColumn")],S.prototype,"sortColumn",null),t.__decorate([i.aliasOf("viewModel.selectRows")],S.prototype,"selectRows",null),t.__decorate([i.aliasOf("viewModel.scrollToIndex")],S.prototype,"scrollToIndex",null),S=t.__decorate([r.subclass("esri.widgets.FeatureTable")],S),S}));
