// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.16/esri/copyright.txt for details.

define(["require","exports","tslib","../intl","../core/Collection","../core/HandleOwner","../core/watchUtils","../core/accessorSupport/decorators","./Widget","./FeatureTable/FeatureTableViewModel","./FeatureTable/Grid/support/ButtonMenu","./FeatureTable/Grid/support/ButtonMenuItem","./support/widget"],(function(e,t,o,l,i,n,r,s,a,d,u,c,p){var h={header:!0,menu:!0,menuItems:{clearSelection:!0,refreshData:!0,toggleColumns:!0}},v="esri-feature-table",_="esri-feature-table__header",g="esri-feature-table__title",m="esri-feature-table__content",f="esri-feature-table__loader",w="esri-feature-table__loader-container",y="esri-feature-table__menu",b="esri-icon-handle-horizontal",M="esri-icon-down",C="esri-icon-right",E="esri-icon-check-mark",O="esri-widget";return function(e){function t(t,l){var n=e.call(this,t,l)||this;return n._menu=null,n.attachmentsEnabled=null,n.columns=new i,n.editingEnabled=null,n.fieldConfigs=null,n.grid=null,n.highlightOnRowSelectEnabled=!0,n.label=void 0,n.layer=null,n.messages=null,n.menuConfig=null,n.view=null,n.viewModel=new d,n.visibleElements=o.__assign({},h),n}return o.__extends(t,e),t.prototype.initialize=function(){var e,t,i,n=this,s=function(){return o.__awaiter(n,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){switch(t.label){case 0:return e=this,[4,l.loadMessageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")];case 1:return[2,e.messages=t.sent()]}}))}))};s(),this.handles.add([l.onLocaleChange(s),r.on(this,"grid.selectedItems","change",(function(e){return n._onSelectionChange(e)})),r.watch(this,["viewModel.store.querying","viewModel.store.syncing","grid.size"],(function(){return n.scheduleRender()})),r.on(this,"viewModel.columns","change",(function(){return n._updateMenuItems()})),r.watch(this,"menuConfig",(function(){return n._updateMenuItems()})),r.watch(this,"messages",(function(){var e;n._menu.label=null===(e=n.messages)||void 0===e?void 0:e.options,n._updateMenuItems()}))]),this._menu=new u(o.__assign({label:null===(e=this.messages)||void 0===e?void 0:e.options,iconClass:b},this.menuConfig));var a=this.attachmentsEnabled,d=this.relatedRecordsEnabled;null===(i=null===(t=this.viewModel)||void 0===t?void 0:t.store)||void 0===i||i.set({attachmentsEnabled:a,relatedRecordsEnabled:d})},t.prototype.destroy=function(){this.clearSelection(),this.handles.removeAll()},t.prototype.castVisibleElements=function(e){return o.__assign(o.__assign({},h),e)},t.prototype.clearHighlights=function(){},t.prototype.clearSelection=function(){},t.prototype.deselectRows=function(){},t.prototype.hideColumn=function(e){var t;null===(t=this.grid)||void 0===t||t.hideColumn(e)},t.prototype.refresh=function(){},t.prototype.showColumn=function(e){var t;null===(t=this.grid)||void 0===t||t.showColumn(e)},t.prototype.sortColumn=function(){},t.prototype.selectRows=function(){},t.prototype.render=function(){var e;return p.tsx("div",{bind:this,class:this.classes(v,O)},this.visibleElements.header?this._renderHeader():null,p.tsx("div",{class:m},"disabled"!==this.state&&(null===(e=this.grid)||void 0===e?void 0:e.render())))},t.prototype._renderHeader=function(){return p.tsx("div",{key:"header",class:_},this._renderLoader(),this._renderTitle(),this._renderMenu())},t.prototype._renderTitle=function(){return p.tsx("div",{class:g,key:"title"},this._getTitle())},t.prototype._getTitle=function(){var e=this.grid,t=this.layer.title,o=this.messages,i=this.viewModel.size;return e?l.substitute(o.header,{title:t,count:i,selected:e.selectedItems.length||0}):""},t.prototype._renderLoader=function(){var e=this.viewModel,t=e.state,o=e.store,l="loading"===t||o.syncing||o.querying;return p.tsx("div",{class:w},l?p.tsx("div",{class:f,key:"loader"}):null)},t.prototype._renderMenu=function(){return p.tsx("div",{class:y},this._menu.render())},t.prototype._onSelectionChange=function(e){var t=e.added,l=e.removed;this.emit("selection-change",{added:o.__spreadArrays(t),removed:o.__spreadArrays(l)})},t.prototype._updateMenuItems=function(){var e,t,o=null===(e=this.menuConfig)||void 0===e?void 0:e.items,l=this._getDefaultMenuItems(),i=[];(null==l?void 0:l.length)&&i.push.apply(i,l),(null==o?void 0:o.length)&&i.push.apply(i,o),i.length&&(null===(t=this._menu)||void 0===t||t.set("items",i))},t.prototype._getDefaultMenuItems=function(){var e,t=this,o=this.messages,l=this.viewModel,i=this.visibleElements.menuItems,n=[];return(null==i?void 0:i.clearSelection)&&n.push(new c({selectionEnabled:!1,label:null==o?void 0:o.clearSelection,clickFunction:function(){return t.clearSelection()}})),(null==i?void 0:i.refreshData)&&n.push(new c({selectionEnabled:!1,label:null==o?void 0:o.refreshData,clickFunction:function(){return t.refresh()}})),(null==i?void 0:i.toggleColumns)&&n.push(new c({iconClass:C,label:null==o?void 0:o.toggleColumns,clickFunction:this._toggleMenuItemSelectedIcon,items:null===(e=null==l?void 0:l.columns)||void 0===e?void 0:e.items.map((function(e){var o=e.header,l=e.hidden,i=e.path;return new c({label:o||i,selected:!l,selectionEnabled:!0,iconClass:E,clickFunction:function(){return t._toggleColumnFromMenuItem(i)}})}))})),n.length?n:null},t.prototype._toggleMenuItemSelectedIcon=function(e){var t=e.item;null==t||t.set("iconClass",(null==t?void 0:t.selected)?M:C)},t.prototype._toggleColumnFromMenuItem=function(e){var t,o=null===(t=this.viewModel)||void 0===t?void 0:t.findColumn(e);(null==o?void 0:o.hidden)?this.showColumn(e):this.hideColumn(e)},o.__decorate([s.aliasOf("viewModel.attachmentsEnabled")],t.prototype,"attachmentsEnabled",void 0),o.__decorate([s.aliasOf("viewModel.columns")],t.prototype,"columns",void 0),o.__decorate([s.aliasOf("viewModel.editingEnabled")],t.prototype,"editingEnabled",void 0),o.__decorate([s.aliasOf("viewModel.fieldConfigs")],t.prototype,"fieldConfigs",void 0),o.__decorate([s.aliasOf("viewModel.grid")],t.prototype,"grid",void 0),o.__decorate([s.aliasOf("viewModel.highlightOnRowSelectEnabled")],t.prototype,"highlightOnRowSelectEnabled",void 0),o.__decorate([s.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),o.__decorate([s.aliasOf("viewModel.layer")],t.prototype,"layer",void 0),o.__decorate([s.property(),p.renderable(),p.messageBundle("esri/widgets/FeatureTable/t9n/FeatureTable")],t.prototype,"messages",void 0),o.__decorate([s.property()],t.prototype,"menuConfig",void 0),o.__decorate([s.aliasOf("viewModel.relatedRecordsEnabled")],t.prototype,"relatedRecordsEnabled",void 0),o.__decorate([s.aliasOf("viewModel.state")],t.prototype,"state",void 0),o.__decorate([s.aliasOf("viewModel.view")],t.prototype,"view",void 0),o.__decorate([s.property(),p.renderable(["viewModel.attachmentsEnabled","viewModel.columns","viewModel.editingEnabled","viewModel.layer","viewModel.relatedRecordsEnabled","viewModel.state"])],t.prototype,"viewModel",void 0),o.__decorate([s.property(),p.renderable()],t.prototype,"visibleElements",void 0),o.__decorate([s.cast("visibleElements")],t.prototype,"castVisibleElements",null),o.__decorate([s.aliasOf("viewModel.clearHighlights")],t.prototype,"clearHighlights",null),o.__decorate([s.aliasOf("viewModel.clearSelection")],t.prototype,"clearSelection",null),o.__decorate([s.aliasOf("viewModel.deselectRows")],t.prototype,"deselectRows",null),o.__decorate([s.aliasOf("viewModel.refresh")],t.prototype,"refresh",null),o.__decorate([s.aliasOf("viewModel.sortColumn")],t.prototype,"sortColumn",null),o.__decorate([s.aliasOf("viewModel.selectRows")],t.prototype,"selectRows",null),t=o.__decorate([s.subclass("esri.widgets.FeatureTable")],t)}(n.HandleOwnerMixin(a))}));