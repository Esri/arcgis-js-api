/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/Error","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Evented","../../core/Collection","../../Viewpoint","../../webdoc/support/Thumbnail","../../webmap/Bookmark","../support/GoTo"],(function(e,t,o,r,i,n,a,c,s,u,p,l,k,d,w,v,h){"use strict";const m="esri.widgets.Bookmarks.BookmarksViewModel",f=r.getLogger(m),y=k.ofType(v),_={width:128,height:128,format:"png"},b={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0};let g=function(t){function o(e){var o;return(o=t.call(this,e)||this).activeBookmark=null,o}e._inheritsLoose(o,t);var r=o.prototype;return r.destroy=function(){this.view=null,this._set("activeBookmark",null)},r.createBookmark=async function(e){const{view:t,defaultCreateOptions:o}=this;if(!t){const e=new c("create-bookmark:invalid-view","Cannot create a bookmark without a view.");return f.error(e),Promise.reject(e)}const{takeScreenshot:r,screenshotSettings:i,captureExtent:n,captureViewpoint:a,captureRotation:s,captureScale:u}={...o,...e},p=r?await this._createThumbnail(i):void 0;return new v({...p&&{thumbnail:p},...(a||n)&&{viewpoint:this._createViewpoint({view:t,captureScale:u,captureRotation:s})}})},r.editBookmark=async function(e,t){const{view:o,defaultEditOptions:r}=this;if(!o){const e=new c("edit-bookmark:invalid-view","Cannot edit a bookmark without a view.");return f.error(e),Promise.reject(e)}const{takeScreenshot:i,screenshotSettings:n,captureExtent:a,captureViewpoint:s,captureRotation:u,captureScale:p}={...r,...t},l=i?await this._createThumbnail(n):void 0;return l&&(e.thumbnail=l),(s||a)&&(e.viewpoint=this._createViewpoint({view:o,captureScale:p,captureRotation:u})),this.emit("bookmark-edit",{bookmark:e}),e},r.goTo=function(e){const{view:t}=this;if(!t){const e=new c("go-to:invalid-view","Cannot go to a bookmark without a view");return f.error(e),Promise.reject(e)}const o=null==e?void 0:e.viewpoint;if(!o){const t=new c("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:e});return f.error(t),Promise.reject(t)}this._set("activeBookmark",e);const r={target:o},i=this.callGoTo(r);return this.emit("select-bookmark",{bookmark:e}),this.emit("bookmark-select",{bookmark:e}),i.catch((()=>{})).then((()=>this._set("activeBookmark",null))),i},r._createThumbnail=async function(e){const t=await this.view.takeScreenshot({..._,...e});return new w({url:t.dataUrl})},r._createViewpoint=function({view:e,captureRotation:t,captureScale:o}){var r,i;const n=null==(r=e.viewpoint)?void 0:r.clone();return new d({targetGeometry:null==(i=e.extent)?void 0:i.clone(),rotation:t&&(null==n?void 0:n.rotation)||0,scale:o&&(null==n?void 0:n.scale)||0})},e._createClass(o,[{key:"bookmarks",get:function(){return this.get("view.map.bookmarks")||new y},set:function(e){void 0!==e?this._override("bookmarks",e):this._clearOverride("bookmarks")}},{key:"defaultCreateOptions",get:function(){return b},set:function(e){this._set("defaultCreateOptions",{...b,...e})}},{key:"defaultEditOptions",get:function(){return b},set:function(e){this._set("defaultEditOptions",{...b,...e})}},{key:"state",get:function(){const e=this.get("view");return e&&!e.ready?"loading":"ready"}},{key:"view",get:function(){return this._get("view")},set:function(e){e&&"2d"!==e.type&&f.error(new c("view:invalid-view","SceneView is not supported",{view:e})),this._set("view",e)}}]),o}(h.GoToMixin(l.EventedAccessor));return t.__decorate([n.property({readOnly:!0})],g.prototype,"activeBookmark",void 0),t.__decorate([n.property({type:y})],g.prototype,"bookmarks",null),t.__decorate([n.property()],g.prototype,"defaultCreateOptions",null),t.__decorate([n.property()],g.prototype,"defaultEditOptions",null),t.__decorate([n.property({readOnly:!0})],g.prototype,"state",null),t.__decorate([n.property({value:null})],g.prototype,"view",null),g=t.__decorate([a.subclass(m)],g),g}));
