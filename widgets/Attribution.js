/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/watchUtils","./support/widgetUtils","./support/decorators/accessibleHandler","./support/decorators/messageBundle","../chunks/index","./Widget","./Attribution/AttributionViewModel"],(function(e,t,i,r,o,s,n,c,a,d,u,l,p,h,_,b,v,w){"use strict";const g={base:"esri-attribution esri-widget",anchor:"esri-widget__anchor",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let f=function(t){function i(e,i){var r;return(r=t.call(this,e,i)||this)._isOpen=!1,r._attributionTextOverflowed=!1,r._prevSourceNodeHeight=0,r.iconClass=g.widgetIcon,r.itemDelimiter=" | ",r.label=void 0,r.messages=null,r.view=null,r.viewModel=new w,r}e._inheritsLoose(i,t);var r=i.prototype;return r.initialize=function(){this.own(l.on(this,"viewModel.items","change",(()=>this.scheduleRender())))},r.render=function(){const e={[g.open]:this._isOpen};return b.jsx("div",{bind:this,class:this.classes(g.base,e),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())},r.renderPoweredBy=function(){return b.jsx("div",{class:g.poweredBy},"Powered by"," ",b.jsx("a",{class:this.classes(g.link,g.anchor),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))},r.renderSourcesNode=function(){const e=this._isOpen,t=this._isInteractive(),i=t?0:-1,{attributionText:r}=this,o=t?"button":void 0,s={[g.sourcesOpen]:e,[g.interactive]:t};return b.jsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes(g.sources,s),innerHTML:r,role:o,tabIndex:i})},r._afterSourcesNodeCreate=function(e){this._prevSourceNodeHeight=e.clientWidth},r._afterSourcesNodeUpdate=function(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:o}=e,s=o>=r,n=this._attributionTextOverflowed!==s;if(this._attributionTextOverflowed=s,n&&(t=!0),this._isOpen){const e=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,e&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()},r._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)},r._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed},e._createClass(i,[{key:"attributionText",get:function(){return this.viewModel.items.reduce(((e,t)=>(-1===e.indexOf(t.text)&&e.push(t.text),e)),[]).join(this.itemDelimiter)}}]),i}(v);return t.__decorate([s.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],f.prototype,"attributionText",null),t.__decorate([s.property()],f.prototype,"iconClass",void 0),t.__decorate([s.property()],f.prototype,"itemDelimiter",void 0),t.__decorate([s.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0),t.__decorate([s.property(),_.messageBundle("esri/widgets/Attribution/t9n/Attribution")],f.prototype,"messages",void 0),t.__decorate([n.aliasOf("viewModel.view")],f.prototype,"view",void 0),t.__decorate([s.property({type:w})],f.prototype,"viewModel",void 0),t.__decorate([h.accessibleHandler()],f.prototype,"_toggleState",null),f=t.__decorate([c.subclass("esri.widgets.Attribution")],f),f}));
