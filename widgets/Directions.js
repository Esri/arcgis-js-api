/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../Graphic","../intl","../core/Collection","../core/events","../core/Handles","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../rest/support/Stop","./Search","./Widget","./Directions/DirectionsViewModel","./Directions/support/directionsUtils","./Directions/support/resources","./Search/support/locatorUtils","./support/DatePicker","./support/Heading","./support/TimePicker","./support/decorators/accessibleHandler","./support/decorators/messageBundle","../core/Logger","./support/jsxFactory","./support/widgetUtils","../chunks/sortable.esm","../intl/substitute","../intl/date","../intl/number"],(function(e,t,s,i,o,n,r,a,l,c,d,u,h,p,S,_,m,v,g,C,f,w,y,b,T,M,x,I,D,k,R,P,H,O){"use strict";function U(e){const t=e.getTimezoneOffset(),s=t>0?"-":"+",i=60,o=Math.abs(Math.floor(t/i)),n=Math.abs(Math.floor(t)%i),r={minimumIntegerDigits:2};return`GMT${s}${O.formatNumber(o,r)}${O.formatNumber(n,r)}`}function L(){return[{},{}]}function N(e){return e.results[0].results[0]}function z(e){return!(null==e.composedPath||!e.composedPath().find((e=>{var t;return null==(t=e.classList)?void 0:t.contains("esri-search__suggestions-list")})))}const A={awaitingViewClickStop:"awaiting-view-click-stop"},E=100,B=500;let $=function(t){function i(e,s){var i;return(i=t.call(this,e,s)||this)._autoStopRemovalDelay=E,i._departureTime=f.DepartureTime.NOW,i._datePicker=new y,i._handles=new r,i._newPlaceholderStop=null,i._pointerPressedSearchSuggestionStop=null,i._sections=null,i._stops=new o(L()),i._stopsToSearches=new Map,i._timePicker=new T,i.apiKey=null,i.goToOverride=null,i.headingLevel=2,i.iconClass=f.CSS.widgetIcon,i.label=void 0,i.lastRoute=null,i.maxStops=null,i.messages=null,i.messagesCommon=null,i.messagesUnits=null,i.routeServiceUrl=void 0,i.routeSymbol=null,i.searchProperties=null,i.stopSymbols=null,i.view=null,i.viewModel=new g,i._setUpDragAndDropStops=e=>{i._sortable=R.Sortable.create(e,{draggable:`.${f.CSS.validStopRow}`,ghostClass:f.CSS.stopRowGhost,handle:`.${f.CSS.stopHandle}`,onEnd:i._handleStopInputDragEnd})},i._handleDragHandlePointerDown=()=>i._stops.forEach((e=>i._acquireSearch(e).activeMenu="none")),i._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:s})=>{if(e===t)return;const{children:o}=s,n=o[t],r=o[e],a=t-e<0;s.insertBefore(n,a?r.nextElementSibling:r);const l=i._stops;l.reorder(l.getItemAt(e),t),i._processStops()},i}e._inheritsLoose(i,t);var c=i.prototype;return c.initialize=function(){this.own([l.watch((()=>this.viewModel.lastRoute),(()=>{this._activeManeuver=null,this._focusedManeuver=null,this._sections=this._getSections(),this.scheduleRender()}),l.initial),l.watch((()=>[this.viewModel.selectedTravelMode,this.viewModel.departureTime]),(()=>{this.viewModel.stops.length>1&&this.getDirections()}),l.initial),l.when((()=>this.view),((e,t)=>{if(t&&(this._viewClickHandle=null,this._handles.remove(t)),e){const t=this._prepPointerDownUpClick(),s=this._prepViewClick();t.pause(),s.pause(),this._handles.add([n.on(e.surface,"mousedown",(()=>this._autoStopRemovalDelay=B)),n.on(e.surface,"mouseup",(()=>this._autoStopRemovalDelay=E)),t,s],this.view.surface),this._pointerDownUpHandle=t,this._viewClickHandle=s}}),l.initial),l.when((()=>0===this.viewModel.stops.length),(()=>{this._stops.drain((e=>{this._disposeSearch(e)})),this._stops.addMany(L()),this.scheduleRender()})),l.when((()=>a.isNone(this.viewModel.serviceDescription)),(()=>{this.viewModel.load()}),l.initial)])},c.destroy=function(){this._datePicker.destroy(),this._timePicker.destroy(),this._stopsToSearches.forEach((e=>e.destroy())),this._sortable&&this._sortable.destroy()},c.getDirections=function(){return null},c.zoomToRoute=function(){},c.render=function(){return D.tsx("div",{class:this.classes(f.CSS.base,f.CSS.scroller)},this._renderPanelContent())},c._renderPanelContent=function(){const{viewModel:{state:e}}=this,t="initializing"===e,s="error"===e&&!this.viewModel.serviceDescription,i="unauthenticated"===e,o={[f.CSS.panelContentLoading]:t,[f.CSS.panelContentError]:s,[f.CSS.panelContentSignIn]:i},n=t?"presentation":"group",r=i?this._renderSignIn():s?this._renderMessage(this._getErrorMessage()):t?this._renderLoader():this._renderReadyContent();return D.tsx("div",{class:this.classes(f.CSS.panelContent,o),role:n},r)},c._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSectionSplitter(),this._renderDirectionsContainer()]},c._renderSignIn=function(){return D.tsx("div",{key:"sign-in",class:f.CSS.signInContent},D.tsx(b.Heading,{class:f.CSS.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),D.tsx(b.Heading,{level:b.incrementHeadingLevel(this.headingLevel)},this.messages.signInRequired),D.tsx("button",{class:this.classes(f.CSS.button,f.CSS.buttonSecondary,f.CSS.signInButton),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))},c._handleSignInClick=function(){this.viewModel.load().catch((()=>{}))},c._renderTravelModeOptions=function(){const{selectedTravelMode:e,travelModes:t}=this.viewModel;if(0===t.length)return null;const s=a.isSome(e)?e.name:this.messages.travelMode;return D.tsx("select",{"aria-label":s,bind:this,class:this.classes(f.CSS.travelModeSelect,f.CSS.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},t.map((t=>{const s=a.isSome(e)&&t.id===e.id;return D.tsx("option",{key:t,"data-mode":t,selected:s,value:t.id},t.name)})))},c._handleTravelModeChange=function(e){const t=e.currentTarget,s=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=s["data-mode"]},c._renderStopsContainer=function(){return D.tsx("div",{class:f.CSS.section,key:"esri-directions__stops-container",role:"group"},this._renderStops())},c._renderDepartureTimeControls=function(){const e=this._departureTime,{messages:t}=this,s=t.departureTime;return D.tsx("div",{class:f.CSS.departureTime,key:"esri-directions__departure-time-controls",role:"group"},D.tsx("select",{"aria-label":s,bind:this,class:this.classes(f.CSS.departureTimeSelect,f.CSS.select),onchange:this._handleDepartureOptionChange,title:s},D.tsx("option",{value:f.DepartureTime.NOW,selected:e===f.DepartureTime.NOW},t.leaveNow),D.tsx("option",{value:f.DepartureTime.DEPART_BY,selected:e===f.DepartureTime.DEPART_BY},t.departBy),D.tsx("option",{value:f.DepartureTime.UNSPECIFIED,selected:e===f.DepartureTime.UNSPECIFIED},t.timeUnspecified)),e===f.DepartureTime.DEPART_BY?this._renderTimeControls():null)},c._renderStops=function(){const e=this._stops;let t=0;e.forEach((e=>{"none"!==this._acquireSearch(e).activeMenu&&(t+=1)}));const s=e.toArray().map(((s,i)=>{const o=e.length,n=i>1&&!s.result,r={[f.CSS.stopsIcon]:i>=0&&i<o-1,[f.CSS.lastStopIcon]:i===o-1},a={[f.CSS.lastStopIconContainer]:i===o-1},l={[f.CSS.validStopRow]:!n},c=e.getItemAt(o-1),d=c&&c.result,u=e.getItemAt(i+1),h=u&&u.result,p=i===o-1,S=i===o-2,_=2===o&&0===i||o>2&&!p&&!S||o>2&&S&&h||o>2&&p&&!s.result,m=2===o||3===o&&!d||n,v=this._acquireSearch(s),{messages:g}=this,{removeStop:C,reverseStops:w,unlocated:y}=g,b=P.substitute(g.stopLabelTemplate,{number:i+1,label:s.result?s.result.name:y}),T=`${this.id}__stop--${i}`,M=!!v.searchTerm&&!!v.selectedResult&&!!s.result&&v.selectedResult===s.result,x={zIndex:"none"!==v.activeMenu?""+t--:""};return D.tsx("li",{"aria-label":b,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(f.CSS.stopRow,l),id:T,key:i,"data-stop-index":i,styles:x},D.tsx("div",{class:f.CSS.stopHandle},D.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.stopIcon,f.CSS.handleIcon,f.CSS.stopHandleIcon,f.CSS.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),D.tsx("div",{bind:this,"aria-labelledby":T,class:this.classes(f.CSS.stopIconContainer,a),"data-stop-index":i,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},D.tsx("span",{class:this.classes(f.CSS.stopIcon,r),tabindex:M?"0":null}))),D.tsx("div",{class:f.CSS.stopInput},v.render()),D.tsx("div",{class:f.CSS.stopOptions,role:"group"},D.tsx("div",{"aria-label":C,class:f.CSS.removeStopButton,bind:this,"data-stop-index":i,hidden:m,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:C},D.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.stopIcon,f.CSS.removeStop,f.CSS.removeStopIcon,f.CSS.interactiveStopIcon)}),D.tsx("span",{class:f.CSS.screenReaderText},"removeStopTitle")),D.tsx("div",{"aria-label":w,class:f.CSS.reverseStops,bind:this,hidden:_,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:w},D.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.stopIcon,f.CSS.reverseStopIcon,f.CSS.interactiveStopIcon)}),D.tsx("span",{class:f.CSS.screenReaderText},"removeStopTitle"))))})),i=e.every((e=>{const t=this._stopsToSearches.get(e);return e.result&&t.selectedResult===e.result})),o=this._stops.length>=this.maxStops,n=this.messages.addStop,r=e.length>=2&&i&&!o?D.tsx("div",{"aria-label":n,bind:this,class:f.CSS.addStop,key:"esri-directions__add-stop",onfocus:this._handleAddStopFocus,tabIndex:0},D.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.addStopIcon,f.CSS.stopIcon,f.CSS.interactiveStopIcon)}),D.tsx("div",{"aria-hidden":"true",class:f.CSS.addStopText},n)):null;return D.tsx("div",null,D.tsx("ol",{class:f.CSS.stops,role:"group",afterCreate:this._setUpDragAndDropStops},s),r)},c._handleStopIconClick=function(e){const t=e.currentTarget["data-stop-index"],s=this._stops.getItemAt(t);s&&s.result&&this._centerAtStop(s)},c._handleClearRouteClick=function(){this.viewModel.reset()},c._centerAtStop=function(e){this.viewModel.centerAt(e.result.feature)},c._handleStopFieldCreation=function(e){const t=this._newPlaceholderStop;if(!t)return;const s=e["data-stop-index"],i=this._stops.getItemAt(s);if(t===i){const e=this._acquireSearch(i);e.when((()=>{this.renderNow(),e.focus()}))}this._newPlaceholderStop=null},c._handleStopInputBlur=function(e,t){this._handles.remove(A.awaitingViewClickStop),this.view.cursor=this._previousCursor;if(!e.selectedResult||!t.result||e.selectedResult!==t.result)return"none"!==e.activeMenu||!e.searchTerm||e.selectedResult===t.result&&(e.selectedResult||t.result)?void(e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{if(this.destroyed)return;if(this._viewClickHandle.pause(),"searching"===e.viewModel.state)return void this._pointerDownUpHandle.pause();if(this._pointerPressedSearchSuggestionStop)return;!!t.result&&(t.result=null,this._processStops()),this.scheduleRender()}),this._autoStopRemovalDelay))):(e.search(),void this._pointerDownUpHandle.pause());this._pointerDownUpHandle.pause()},c._handleStopInputFocus=function(e,t){if(this._pointerDownUpHandle.resume(),this._handles.has(A.awaitingViewClickStop))return;const{view:s,view:{cursor:i}}=this;this._previousCursor=i,this._handles.add(l.watch((()=>e.searchTerm),(e=>{s.cursor=0===e.length?"copy":i}),l.initial),A.awaitingViewClickStop),this._activeStop=t},c._prepViewClick=function(){const{view:e}=this.viewModel,t=n.pausable(e,"click",this._handleViewClick.bind(this)),s=n.pausable(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),s.pause()}));return{remove(){s.remove(),t.remove()},pause(){s.pause(),t.pause()},resume(){s.resume(),t.resume()}}},c._prepPointerDownUpClick=function(){const e=n.pausable(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=z(e)?this._activeStop:null})),t=n.pausable(document,"pointerup",(e=>{this._pointerDownUpHandle.pause();const t=z(e),s=this._activeStop;t||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?this._activeStop:null}));return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}},c._handleViewClick=function(e){const t=this._stopsToSearches.get(this._activeStop);t&&!t.searchTerm&&(t.search(e.mapPoint).then((e=>{const s=N(e),i=this._activeStop;i.result=s,i.result.feature.attributes.Name=s.name,t.searchTerm=s.name})),this.scheduleRender()),this._viewClickHandle.pause(),clearTimeout(this._autoStopRemovalTimeoutId)},c._handleAddStopFocus=function(){this._addNewPlaceholder()},c._addNewPlaceholder=function(){if(this._pointerDownUpHandle.pause(),this._newPlaceholderStop)return;const e={};this._stops.add(e),this._newPlaceholderStop=e},c._handleReverseStops=function(){this._reverseStops()},c._reverseStops=function(){this._stops.reverse(),this._processStops()},c._handleRemoveStop=function(e){const t=e.currentTarget["data-stop-index"];this._removeStop(this._stops.getItemAt(t)),this._processStops()},c._removeStop=function(e){this._stops.length<=2||(this._disposeSearch(e),this._stops.remove(e))},c._handleDepartureOptionChange=function(e){const t=e.currentTarget,s=t.item(t.selectedIndex);s.value===f.DepartureTime.NOW?(this._departureTime=f.DepartureTime.NOW,this.viewModel.departureTime=f.DepartureTime.NOW,this._handles.remove("departure-time-controls")):s.value===f.DepartureTime.DEPART_BY?(this._departureTime=f.DepartureTime.DEPART_BY,this._handles.add([l.watch((()=>this._datePicker.value),(()=>this._updateDepartureTime()),l.initial),l.watch((()=>this._timePicker.value),(()=>this._updateDepartureTime()),l.initial)],"departure-time-controls")):(this._departureTime=f.DepartureTime.UNSPECIFIED,this.viewModel.departureTime=null)},c._updateDepartureTime=function(){const e=this._datePicker.value,t=this._timePicker.value;e&&t&&(this.viewModel.departureTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes()))},c._renderTimeControls=function(){return D.tsx("div",{class:f.CSS.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())},c._renderSectionSplitter=function(){return D.tsx("div",{class:f.CSS.sectionSplitter})},c._renderDirectionsContainer=function(){return D.tsx("div",{class:this.classes(f.CSS.directionsSection,f.CSS.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())},c._renderLoader=function(){return D.tsx("div",{class:f.CSS.loader,key:"loader"})},c._renderWarningCard=function(){return D.tsx("div",{class:f.CSS.warningCard,role:"alert"},D.tsx("div",{class:f.CSS.warningHeader},D.tsx("span",{class:f.CSS.warningIcon,"aria-hidden":"true"}),D.tsx(b.Heading,{class:f.CSS.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),D.tsx("div",{class:f.CSS.warningMessage},this._getErrorMessage()))},c._renderDirectionsContainerContent=function(){const{lastRoute:e,viewModel:{state:t}}=this,s="routing"===t;return"error"===t?this._renderWarningCard():s?this._renderLoader():a.isSome(e)&&a.isSome(e.directionLines)?D.tsx("div",{class:f.CSS.summary,key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):D.tsx("div",{key:"esri-directions__placeholder",class:f.CSS.emptyContent},this._renderPlaceholder(),D.tsx(b.Heading,{class:f.CSS.message,level:this.headingLevel},this.messages.directionsPlaceholder))},c._renderPlaceholder=function(){return D.tsx("svg",{class:f.CSS.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},D.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))},c._renderMessage=function(e){return D.tsx(b.Heading,{level:this.headingLevel},e)},c._renderRouteActions=function(){return D.tsx("div",{class:f.CSS.routeActions},D.tsx("button",{"aria-label":this.messages.clearRoute,class:this.classes(f.CSS.clearRouteButton,f.CSS.button,f.CSS.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))},c._getSections=function(){if(a.isNone(this.lastRoute))return null;const{directionPoints:e,directionLines:t,stops:s}=this.lastRoute;if(a.isNone(e)||a.isNone(t))return null;const i=[];let o=null;for(const n of e){const{objectId:e,stopId:r}=n;if(a.isSome(r)){const e=s.find((e=>e.objectId===r)),t=0===i.length;(a.isNone(o)||o.stop!==e)&&(o={stop:e,directions:[],open:t},i.push(o));continue}if(a.isNone(o))continue;const l=t.find((t=>t.directionPointId===e));a.isNone(l)||o.directions.push({directionPoint:n,directionLine:l})}return i},c._renderManeuverSections=function(){return a.isNone(this._sections)?null:D.tsx("div",{class:f.CSS.maneuvers,role:"group"},this._sections.map(((e,t)=>{const{open:s}=e;let i;e.directions.length>0&&s&&(i=D.tsx("ol",{class:f.CSS.maneuverList},e.directions.map((e=>this._renderManeuver(e)))));const o=a.unwrap(this._sections).length>2,n=t===a.unwrap(this._sections).length-1,r={[f.CSS.collapsibleSection]:o},l={[f.CSS.openIcon]:!s,[f.CSS.closeIcon]:s};let c;if(o&&!n){const t=s?this.messagesCommon.open:this.messagesCommon.close;c=D.tsx("header",{class:this.classes(f.CSS.maneuverSectionHeader,f.CSS.maneuverSectionToggle),key:"esri-directions__maneuver-section-header"},D.tsx("div",{"aria-expanded":s.toString(),"aria-label":t,bind:this,class:f.CSS.maneuverSectionHeaderButton,"data-maneuver-section":e,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:t},D.tsx(b.Heading,{class:f.CSS.maneuverSectionTitle,level:this.headingLevel},e.stop.name),D.tsx("span",{"aria-hidden":"true",class:this.classes(l)})))}else c=D.tsx("header",{class:f.CSS.maneuverSectionHeader,key:"esri-directions__maneuver-section-header"},D.tsx(b.Heading,{class:f.CSS.maneuverSectionTitle,level:this.headingLevel},e.stop.name));return D.tsx("section",{class:this.classes(f.CSS.maneuverSection,r),key:t},c,i)})))},c._handleSectionToggle=function(e){const t=e.currentTarget["data-maneuver-section"];t.open=!t.open},c._renderCosts=function(){const{lastRoute:e}=this;if(a.isNone(e))return null;const t=this._getCostSummary(),{directionPoints:s}=e;if(a.isNone(s)||a.isNone(t))return null;const i=s.getItemAt(s.length-1).arrivalTime,{primary:o,secondary:n}=t,{eta:r,etaTemplate:l,primaryCosts:c,secondaryCosts:d,zoomToRoute:u}=this.messages,h=H.convertDateFormatToIntlOptions("short-time"),p=a.isSome(i)?`<strong>${H.formatDate(i,h)}</strong>`:null,S=a.isSome(i)?`${U(i)}`:null,_=P.substitute(l,{time:p,gmt:S});return D.tsx("div",{"aria-label":u,bind:this,class:f.CSS.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:u},D.tsx("div",{class:f.CSS.costsDetails,role:"group"},D.tsx("div",{"aria-label":c,class:f.CSS.primaryCosts,title:c},o),D.tsx("div",{class:f.CSS.verticalSplitter}),D.tsx("div",{"aria-label":d,class:f.CSS.secondaryCosts,title:d},n)),D.tsx("div",{"aria-label":r,innerHTML:_,title:r}))},c._handleSummaryInteraction=function(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()},c._getErrorMessage=function(){const{messages:e,viewModel:{error:t}}=this;if(a.isSome(t))switch(t.name){case"directions-view-model:unable-to-route":return e.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return e.errors.unableToLoadServiceMetadata}return e.errors.unknownError},c._normalizeSearchSources=function(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)},c._overrideDefaultSources=function(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1}))},c._applyLocatorSourceOverrides=function({allSources:e}){0!==e.length&&e.forEach((e=>{"url"in e&&e.url&&(null===e.locationType&&(e.locationType="street"),w.isArcGISWorldGeocoder(e.url)&&this.apiKey&&null==e.apiKey&&(e.apiKey=this.apiKey,e.url=w.meteredArcGISLocatorUrl))}))},c._acquireSearch=function(e){const t=this.get("viewModel.view");if(this._stopsToSearches.has(e)){const s=this._stopsToSearches.get(e);return s.view=t,this._overrideDefaultSources(s),s}const s=new m({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this._handles.add([l.on((()=>s.allSources),"change",(()=>this._normalizeSearchSources(s))),s.on("select-result",(()=>{e.result=s.selectedResult,e.result.feature.attributes.Name=s.selectedResult.name,this._processStops(),this.scheduleRender()})),s.on("search-focus",(()=>this._handleStopInputFocus(s,e))),s.on("search-blur",(()=>this._handleStopInputBlur(s,e)))],s),this._stopsToSearches.set(e,s),s},c._disposeSearch=function(e){this._stopsToSearches.get(e).destroy(),this._stopsToSearches.delete(e)},c._processStops=function(){const e=this._stops.filter((e=>!!e.result)).map((e=>_.fromJSON(e.result.feature.toJSON())));this.viewModel.stops=e,e.length>1&&this.getDirections()},c._renderManeuver=function(e){const t="",{directionsLengthUnits:s}=this.viewModel.routeParameters,{directionPoint:i,directionLine:o}=e,{distance:n,duration:r}=o,{messages:l,messagesUnits:c}=this,d=C.formatDistance(l,c,a.unwrapOrValue(n,0),{fromUnits:"meters",toUnits:s}),u=C.formatTime(a.unwrapOrValue(r,0),"minutes"),h=d&&u?`${d}&nbsp;&middot;&nbsp;${u}`:`${d}${u}`,p=this._getFormattedManeuverText(i),{objectId:S,directionPointType:_}=i,m=f.getIconPath(_),v=`esri-directions__maneuver-${S}`,g=`esri-directions__cumulative-costs-${S}`,w=`esri-directions__intermediate-costs-${S}`,y={[f.CSS.maneuverActive]:this._activeManeuver===o};return D.tsx("li",{"aria-labelledby":`${v} ${g} ${w}`,bind:this,class:this.classes(f.CSS.maneuver,y),"data-maneuver":o,key:o,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},a.isSome(m)&&D.tsx("img",{alt:"",class:f.CSS.maneuverIcon,src:m}),D.tsx("div",{class:f.CSS.maneuverCostsContainer},D.tsx("span",{id:v,innerHTML:a.unwrapOrValue(p,"")}),D.tsx("div",{class:f.CSS.maneuverCosts},D.tsx("div",{class:f.CSS.horizontalSplitter}),D.tsx("div",{id:g,"aria-label":l.cumulativeCosts,class:f.CSS.cumulativeCost,innerHTML:t,title:l.cumulativeCosts}),D.tsx("div",{id:w,"aria-label":l.intermediateCosts,class:f.CSS.intermediateCost,innerHTML:h,title:l.intermediateCosts}))))},c._handleManeuverClick=function(e){const t=e.currentTarget["data-maneuver"];if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t;const{geometry:i,symbol:o}=t,n=new s({geometry:i,symbol:o});this.viewModel.centerAt(n),this.viewModel.highlightSegment(n)},c._handleManeuverMouseOver=function(e){if(this._activeManeuver||this._focusedManeuver)return;const t=e.currentTarget["data-maneuver"],{geometry:i,symbol:o}=t,n=new s({geometry:i,symbol:o});this.viewModel.highlightSegment(n)},c._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()},c._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())},c._handleManeuverFocus=function(e){if(this._activeManeuver)return;const t=e.currentTarget["data-maneuver"];this._focusedManeuver=t;const{geometry:i,symbol:o}=t,n=new s({geometry:i,symbol:o});this.viewModel.highlightSegment(n)},c._getFormattedManeuverText=function(e){const{displayText:t,name:s,intersectingName:i}=e;if(a.isNone(t))return"";let o=t;return a.isSome(s)&&o.includes(s)&&(o=o.replace(s,`<strong>${s}</strong>`)),a.isSome(i)&&o.includes(i)&&(o=o.replace(i,`<strong>${i}</strong>`)),o},c._getCostSummary=function(){const{viewModel:{impedanceAttribute:e,routeParameters:t},lastRoute:s}=this;if(a.isNone(e)||a.isNone(s))return null;const{routeInfo:i}=s;let{totalDuration:o,totalDistance:n}=i;const{directionsLengthUnits:r}=t;n=a.isSome(n)?n:0,o=a.isSome(o)?o:0;const l=C.formatDistance(this.messages,this.messagesUnits,n,{fromUnits:"meters",toUnits:r}),c=C.formatTime(o,"minutes"),[d,u]=C.isTimeUnits(e.units)?[c,l]:[l,c];return{primary:d,secondary:u}},i}(v);t.__decorate([c.aliasOf("viewModel.apiKey")],$.prototype,"apiKey",void 0),t.__decorate([c.aliasOf("viewModel.goToOverride")],$.prototype,"goToOverride",void 0),t.__decorate([p.property()],$.prototype,"headingLevel",void 0),t.__decorate([p.property()],$.prototype,"iconClass",void 0),t.__decorate([p.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],$.prototype,"label",void 0),t.__decorate([c.aliasOf("viewModel.lastRoute")],$.prototype,"lastRoute",void 0),t.__decorate([c.aliasOf("viewModel.maxStops")],$.prototype,"maxStops",void 0),t.__decorate([p.property(),x.messageBundle("esri/widgets/Directions/t9n/Directions")],$.prototype,"messages",void 0),t.__decorate([p.property(),x.messageBundle("esri/t9n/common")],$.prototype,"messagesCommon",void 0),t.__decorate([p.property(),x.messageBundle("esri/core/t9n/Units")],$.prototype,"messagesUnits",void 0),t.__decorate([c.aliasOf("viewModel.routeServiceUrl")],$.prototype,"routeServiceUrl",void 0),t.__decorate([c.aliasOf("viewModel.routeSymbol")],$.prototype,"routeSymbol",void 0),t.__decorate([p.property()],$.prototype,"searchProperties",void 0),t.__decorate([c.aliasOf("viewModel.stopSymbols")],$.prototype,"stopSymbols",void 0),t.__decorate([c.aliasOf("viewModel.view")],$.prototype,"view",void 0),t.__decorate([p.property({type:g})],$.prototype,"viewModel",void 0),t.__decorate([c.aliasOf("viewModel.getDirections")],$.prototype,"getDirections",null),t.__decorate([c.aliasOf("viewModel.zoomToRoute")],$.prototype,"zoomToRoute",null),t.__decorate([M.accessibleHandler()],$.prototype,"_handleStopIconClick",null),t.__decorate([M.accessibleHandler()],$.prototype,"_handleClearRouteClick",null),t.__decorate([M.accessibleHandler()],$.prototype,"_handleReverseStops",null),t.__decorate([M.accessibleHandler()],$.prototype,"_handleRemoveStop",null),t.__decorate([M.accessibleHandler()],$.prototype,"_handleSectionToggle",null),t.__decorate([M.accessibleHandler()],$.prototype,"_handleSummaryInteraction",null),t.__decorate([M.accessibleHandler()],$.prototype,"_handleManeuverClick",null),$=t.__decorate([S.subclass("esri.widgets.Directions")],$);return $}));
