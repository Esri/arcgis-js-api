/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/deprecate","../core/events","../core/Logger","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/arrayUtils","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../properties/defaultUnit","../rest/support/Stop","../symbols/SimpleMarkerSymbol","./Search","./Widget","./Directions/DirectionsViewModel","./Directions/components/SaveLayer","./Directions/support/directionsUtils","./Directions/support/resources","./Search/support/locatorUtils","./support/DatePicker","./support/Heading","./support/TimePicker","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/jsxFactory","./support/widgetUtils","../chunks/sortable.esm","../intl/substitute","../intl/date","../intl/number"],(function(e,t,s,o,i,n,r,a,l,c,d,u,h,p,S,v,m,_,g,y,C,f,w,b,M,T,x,k,D,I,P,L,R,B){"use strict";const H={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};function A(e){const t=e.getTimezoneOffset(),s=t>0?"-":"+",o=60,i=Math.abs(Math.floor(t/o)),n=Math.abs(Math.floor(t)%o),r={minimumIntegerDigits:2};return`GMT${s}${B.formatNumber(i,r)}${B.formatNumber(n,r)}`}function E(e){return!!e.composedPath?.().find((e=>e.classList?.contains("esri-search__suggestions-list")))}const N="search-term",O="date-time-picker",U=100,z=500,$="esri.widgets.Directions",F=r.getLogger($);let V=function(s){function o(e,t){var o;return(o=s.call(this,e,t)||this)._autoStopRemovalDelay=U,o._departureTime=f.DepartureTime.NOW,o._datePicker=new b,o._newPlaceholderStop=null,o._pointerPressedSearchSuggestionStop=null,o._renderSavePopoverFunction=null,o._saveAsButtonNode=null,o._saveLayer=new y.SaveLayer,o._sections=null,o._stopsToSearches=new Map,o._timePicker=new T,o.headingLevel=2,o.iconClass=f.CSS.widgetIcon,o.messages=null,o.messagesCommon=null,o.messagesUnits=null,o.searchProperties=null,o.viewModel=new g,o.visibleElements={...H},o._setUpDragAndDropStops=e=>{o._sortable=P.Sortable.create(e,{draggable:`.${f.CSS.validStopRow}`,ghostClass:f.CSS.stopRowGhost,handle:`.${f.CSS.stopHandle}`,onEnd:o._handleStopInputDragEnd})},o._handleDragHandlePointerDown=()=>o.viewModel.layer.stops.forEach((e=>o._acquireSearch(e).activeMenu="none")),o._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:s})=>{if(e===t)return;const{children:i}=s,n=i[t],r=i[e],a=t-e<0;s.insertBefore(n,a?r.nextElementSibling:r);const l=o.viewModel.layer.stops;l.reorder(l.getItemAt(e),t);for(const o of l)o.sequence=null;o._getDirections()},o}t._inheritsLoose(o,s);var r=o.prototype;return r.initialize=function(){this.addHandles([l.watch((()=>this.viewModel.layer.routeInfo),(()=>{this._activeManeuver=null,this._focusedManeuver=null,this._sections=this._getSections(),this.scheduleRender()}),l.initial),l.when((()=>this.view),((e,t)=>{if(t&&(this._viewClickHandle=null,this.removeHandles(t)),e){const t=this._prepPointerDownUpClick(),s=this._prepViewClick();t.pause(),s.pause(),this.addHandles([n.on(e.surface,"mousedown",(()=>this._autoStopRemovalDelay=z)),n.on(e.surface,"mouseup",(()=>this._autoStopRemovalDelay=U)),t,s],e),this._pointerDownUpHandle=t,this._viewClickHandle=s}}),l.initial),l.when((()=>a.isNone(this.viewModel.serviceDescription)),(()=>{try{this.viewModel.load()}catch{}}),l.initial),l.watch((()=>this._saveLayer.state),(()=>{this.scheduleRender()}))]),this.when((()=>{this.destroyed||(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))}))},r.loadDependencies=function(){return Promise.all([new Promise(((t,s)=>e(["../chunks/calcite-button"],t,s))),new Promise(((t,s)=>e(["../chunks/calcite-link"],t,s))),new Promise(((t,s)=>e(["../chunks/calcite-popover"],t,s)))])},r.destroy=function(){this._datePicker.destroy(),this._timePicker.destroy();for(const e of this._stopsToSearches.values())e.destroy();this._sortable&&this._sortable.destroy(),a.isSome(this._renderSavePopoverFunction)&&this._projector.detach(this._renderSavePopoverFunction)},r.castVisibleElements=function(e){return{...H,...e}},r.getDirections=function(){return this.viewModel.getDirections()},r.render=function(){return D.tsx("div",{class:this.classes(f.CSS.base,f.CSS.scroller)},this._renderPanelContent())},r.save=function(){return this.viewModel.layer.save()},r.saveAs=function(e,t={}){return this.viewModel.layer.saveAs(e,t)},r.zoomToRoute=function(){return this.viewModel.zoomToRoute()},r._renderPanelContent=function(){const{viewModel:{serviceDescription:e,state:t}}=this,s="initializing"===t,o="error"===t&&!e,i="unauthenticated"===t,n={[f.CSS.panelContentLoading]:s,[f.CSS.panelContentError]:o,[f.CSS.panelContentSignIn]:i},r=s?"presentation":"group",a=i?this._renderSignIn():o?this._renderMessage(this._getErrorMessage()):s?this._renderLoader():this._renderReadyContent();return D.tsx("div",{class:this.classes(f.CSS.panelContent,n),role:r},a)},r._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]},r._renderSignIn=function(){return D.tsx("div",{key:"sign-in",class:f.CSS.signInContent},D.tsx(M.Heading,{class:f.CSS.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),D.tsx(M.Heading,{level:M.incrementHeadingLevel(this.headingLevel)},this.messages.signInRequired),D.tsx("button",{class:this.classes(f.CSS.button,f.CSS.buttonSecondary,f.CSS.signInButton),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))},r._handleSignInClick=function(){this.viewModel.load().catch((()=>{}))},r._renderTravelModeOptions=function(){if(!this.visibleElements.traveMode)return null;const{selectedTravelMode:e,travelModes:t}=this.viewModel;if(0===t.length)return null;const s=a.isSome(e)?e.name:this.messages.travelMode;return D.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(f.CSS.travelMode,this._saveLayer.opened&&f.CSS.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},D.tsx("select",{"aria-label":s,bind:this,class:this.classes(f.CSS.travelModeSelect,f.CSS.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},t.map((t=>{const s=a.isSome(e)&&t.id===e.id;return D.tsx("option",{key:`esri-directions__travel-mode-${t.id}`,"data-mode":t,selected:s,value:t.id},t.name)}))))},r._handleTravelModeChange=function(e){const t=e.currentTarget,s=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=s["data-mode"],this._getDirections()},r._renderStopsContainer=function(){return this.visibleElements.stops?D.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(f.CSS.section,this._saveLayer.opened&&f.CSS.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null},r._renderDepartureTimeControls=function(){if(!this.visibleElements.departureTime)return null;const e=this._departureTime,{messages:t}=this,s=t.departureTime;return D.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(f.CSS.departureTime,this._saveLayer.opened&&f.CSS.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},D.tsx("select",{"aria-label":s,bind:this,class:this.classes(f.CSS.departureTimeSelect,f.CSS.select),onchange:this._handleDepartureOptionChange,title:s},D.tsx("option",{value:f.DepartureTime.NOW,selected:e===f.DepartureTime.NOW},t.leaveNow),D.tsx("option",{value:f.DepartureTime.DEPART_BY,selected:e===f.DepartureTime.DEPART_BY},t.departBy),D.tsx("option",{value:f.DepartureTime.UNSPECIFIED,selected:e===f.DepartureTime.UNSPECIFIED},t.timeUnspecified)),e===f.DepartureTime.DEPART_BY?this._renderTimeControls():null)},r._renderStops=function(){const e=this.viewModel.layer.stops;let t=0;for(const i of this._stopsToSearches.keys())e.includes(i)||this._disposeSearch(i);for(const i of e){const e=this._acquireSearch(i);"none"!==e.activeMenu&&(t+=1),a.isSome(i.name)&&(e.searchTerm=i.name)}const s=e.toArray().map(((s,o)=>{const i=e.length,n=o>1&&a.isNone(s.geometry),r={[f.CSS.stopsIcon]:o>=0&&o<i-1,[f.CSS.lastStopIcon]:o===i-1},l={[f.CSS.lastStopIconContainer]:o===i-1},c={[f.CSS.validStopRow]:!n},d=e.getItemAt(o+1),u=d&&a.isSome(d.geometry),h=o===i-1,p=o===i-2,S=2===i&&0===o||i>2&&!h&&!p||i>2&&p&&u||i>2&&h&&a.isNone(s.geometry),v=i<3,m=this._acquireSearch(s),{messages:_}=this,{removeStop:g,reverseStops:y,unlocated:C}=_,w=L.substitute(_.stopLabelTemplate,{number:o+1,label:a.isSome(s.geometry)?s.name:C}),b=`${this.id}__stop--${o}`,M=!!m.searchTerm&&!!m.selectedResult&&a.isSome(s.geometry)&&m.selectedResult.name===s.name,T={zIndex:"none"!==m.activeMenu?""+t--:""};return D.tsx("li",{"aria-label":w,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(f.CSS.stopRow,c),id:b,key:o,"data-stop-index":o,styles:T},D.tsx("div",{class:f.CSS.stopHandle},D.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.stopIcon,f.CSS.handleIcon,f.CSS.stopHandleIcon,f.CSS.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),D.tsx("div",{bind:this,"aria-labelledby":b,class:this.classes(f.CSS.stopIconContainer,l),"data-stop-index":o,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},D.tsx("span",{class:this.classes(f.CSS.stopIcon,r),tabindex:M?"0":null}))),D.tsx("div",{class:f.CSS.stopInput},m.render()),D.tsx("div",{class:f.CSS.stopOptions,role:"group"},D.tsx("div",{"aria-label":g,class:f.CSS.removeStopButton,bind:this,"data-stop-index":o,hidden:v,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:g},D.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.stopIcon,f.CSS.removeStop,f.CSS.removeStopIcon,f.CSS.interactiveStopIcon)}),D.tsx("span",{class:f.CSS.screenReaderText},"removeStopTitle")),D.tsx("div",{"aria-label":y,class:f.CSS.reverseStops,bind:this,hidden:S,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:y},D.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.stopIcon,f.CSS.reverseStopIcon,f.CSS.interactiveStopIcon)}),D.tsx("span",{class:f.CSS.screenReaderText},"removeStopTitle"))))})),o=this._renderAddStop();return D.tsx("div",null,D.tsx("ol",{class:f.CSS.stops,role:"group",afterCreate:this._setUpDragAndDropStops},s),o)},r._renderAddStop=function(){const{stops:e}=this.viewModel.layer,t=e.filter((({geometry:e})=>a.isSome(e))),s=e.at(-1);return t.length>1&&t.length<this.maxStops&&a.isSome(s)&&a.isSome(s.geometry)?D.tsx("div",{class:f.CSS.toolbarSection},D.tsx("div",{class:f.CSS.toolbarButtons},D.tsx("calcite-button",{appearance:"outline",class:f.CSS.addStopButton,color:"neutral",scale:"s",round:!0,"icon-start":"plus",key:f.CSS.addStopButton,onclick:()=>{this._addNewPlaceholder()},text:this.messages.addStop,width:"full"},this.messages.addStop))):null},r._handleStopIconClick=function(e){const t=e.currentTarget["data-stop-index"],s=this.viewModel.layer.stops.getItemAt(t);s&&a.isSome(s.geometry)&&this._centerAtStop(s)},r._handleClearRouteClick=function(){this.viewModel.reset()},r._centerAtStop=function(e){this.viewModel.centerAt(e)},r._handleStopFieldCreation=function(e){const t=this._newPlaceholderStop;if(!t)return;const s=e["data-stop-index"],o=this.viewModel.layer.stops.getItemAt(s);if(t===o){const e=this._acquireSearch(o);e.when((()=>{this.renderNow(),e.focus()}))}this._newPlaceholderStop=null},r._handleStopInputBlur=function(e,t){if(this._saveLayer.opened)return;this.removeHandles(N);if(!!e.selectedResult&&a.isSome(t.geometry)&&a.isSome(e.selectedResult?.feature.geometry)&&t.geometry===e.selectedResult?.feature.geometry)return void this._pointerDownUpHandle.pause();const s=a.isNone(t.geometry)&&a.isNone(e.selectedResult?.feature.geometry),o=a.isSome(t.geometry)&&a.isSome(e.selectedResult?.feature.geometry)&&t.geometry!==e.selectedResult.feature.geometry;if((s||o)&&"none"===e.activeMenu&&e.searchTerm)return e.search(),void this._pointerDownUpHandle.pause();e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{this.destroyed||(this._viewClickHandle.pause(),"searching"!==e.viewModel.state?this._pointerPressedSearchSuggestionStop||(a.isSome(t.geometry)&&(t.geometry=null,this._getDirections()),this.scheduleRender()):this._pointerDownUpHandle.pause())}),this._autoStopRemovalDelay))},r._handleStopInputFocus=function(e,t){if(this._pointerDownUpHandle.resume(),this.hasHandles(N))return;const{view:s}=this,o=s.cursor;this.addHandles([{remove(){s.cursor=o}},l.watch((()=>e.searchTerm),(t=>{e.destroyed||(s.cursor=t.length?o:"copy")}),l.initial)],N),this._activeStop=t},r._prepViewClick=function(){const{view:e}=this.viewModel,t=n.pausable(e,"click",this._handleViewClick.bind(this)),s=n.pausable(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),s.pause()}));return{remove(){s.remove(),t.remove()},pause(){s.pause(),t.pause()},resume(){s.resume(),t.resume()}}},r._prepPointerDownUpClick=function(){const e=n.pausable(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=E(e)?this._activeStop:null})),t=n.pausable(document,"pointerup",(e=>{this._pointerDownUpHandle.pause();const t=E(e),s=this._activeStop;t||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?s:null}));return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}},r._handleViewClick=function(e){e.stopPropagation();const t=this._stopsToSearches.get(this._activeStop);t&&!t.searchTerm&&(t.search(e.mapPoint).then((e=>{const s=e.results[0].results[0],{feature:o,name:i}=s;this._activeStop.geometry=o.geometry,this._activeStop.name=i,t.searchTerm=i})),this.scheduleRender()),this._viewClickHandle.pause(),clearTimeout(this._autoStopRemovalTimeoutId)},r._addNewPlaceholder=function(){if(this._pointerDownUpHandle.pause(),this._newPlaceholderStop)return;const e=new S({symbol:new v});this.viewModel.layer.stops.add(e),this._newPlaceholderStop=e},r._handleReverseStops=function(){this._reverseStops()},r._reverseStops=function(){this.viewModel.layer.stops.reverse();for(const e of this.viewModel.layer.stops)e.sequence=null;this._getDirections()},r._handleRemoveStop=function(e){const t=e.currentTarget["data-stop-index"],s=this.viewModel.layer.stops.getItemAt(t);this._removeStop(s),(a.isSome(s.geometry)||a.isNone(this.viewModel.layer.routeInfo))&&this._getDirections()},r._removeStop=function(e){this.viewModel.layer.stops.length<=2||(this._disposeSearch(e),this.viewModel.layer.stops.remove(e))},r._handleDepartureOptionChange=function(e){const t=e.currentTarget,s=t.item(t.selectedIndex);s.value===f.DepartureTime.NOW?(this._departureTime=f.DepartureTime.NOW,this.viewModel.departureTime=f.DepartureTime.NOW,this.removeHandles(O),this._getDirections()):s.value===f.DepartureTime.DEPART_BY?(this._departureTime=f.DepartureTime.DEPART_BY,this.addHandles(l.watch((()=>[this._datePicker.value,this._timePicker.value]),(()=>{this._updateDepartureTime(),this._getDirections()}),l.initial),O)):(this._departureTime=f.DepartureTime.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())},r._updateDepartureTime=function(){const e=this._datePicker.value,t=this._timePicker.value;e&&t&&(this.viewModel.departureTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes()))},r._renderTimeControls=function(){return D.tsx("div",{class:f.CSS.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())},r._renderSectionSplitter=function(){return D.tsx("div",{class:f.CSS.sectionSplitter})},r._renderSaveContainer=function(){const{saveButton:e,saveAsButton:t,printButton:s,layerDetails:o}=this.visibleElements;return e||t||s||o?D.tsx("div",{class:f.CSS.saveSection,key:f.CSS.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null},r._renderSaveButtons=function(){const{saveButton:e,saveAsButton:t,printButton:s}=this.visibleElements;return e||t||s?D.tsx("div",{class:f.CSS.saveButtons,key:f.CSS.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null},r._renderSaveButton=function(){if(!this.visibleElements.saveButton)return null;const e=this.viewModel.layer.portalItem?.itemControl,t=a.isSome(this.viewModel.layer.routeInfo)&&("admin"===e||"update"===e);return D.tsx("calcite-button",{appearance:"outline",class:f.CSS.saveButton,color:"blue",disabled:!t,"icon-start":"save",key:f.CSS.saveButton,onclick:()=>{this._handleSaveButtonClick()},text:this.messagesCommon.save,width:"full"},this.messagesCommon.save)},r._renderSaveAsButton=function(){if(!this.visibleElements.saveAsButton)return null;const e=a.isNone(this.viewModel.layer.routeInfo);return D.tsx("div",{class:f.CSS.saveAsButtonPopover,key:f.CSS.saveAsButtonPopover},D.tsx("calcite-button",{afterCreate:e=>{this._saveAsButtonNode=e},appearance:"outline",class:f.CSS.saveAsButton,color:"blue",disabled:e,"icon-start":"duplicate",key:f.CSS.saveAsButton,onclick:()=>this._handleSaveAsButtonClick(),text:this.messagesCommon.saveAs,width:"full"},this.messagesCommon.saveAs))},r._renderSavePopover=function(){return D.tsx("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,"overlay-positioning":"fixed",referenceElement:a.unwrap(this._saveAsButtonNode)},this._saveLayer.render())},r._handleSaveAsButtonClick=function(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)},r._renderPrintButton=function(){return this.visibleElements.printButton?D.tsx("calcite-button",{appearance:"outline",class:f.CSS.printButton,color:"blue","icon-start":"print",key:f.CSS.printButton,text:this.messagesCommon.print}):null},r._renderRouteLayerDetailsLink=function(){if(!this.visibleElements.layerDetails)return null;const{portalItem:e}=this.viewModel.layer;if(!e)return null;const{id:t,portal:{url:s}}=e,o=`${s}/home/item.html?id=${t}`;return D.tsx("calcite-link",{class:f.CSS.layerDetailsLink,href:o,key:f.CSS.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)},r._handleSaveButtonClick=function(){this.viewModel.layer.save()},r._renderDirectionsContainer=function(){return D.tsx("div",{class:this.classes(f.CSS.directionsSection,f.CSS.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())},r._renderLoader=function(){return D.tsx("div",{class:f.CSS.loader,key:"loader"})},r._renderWarningCard=function(){return D.tsx("div",{class:f.CSS.warningCard,role:"alert"},D.tsx("div",{class:f.CSS.warningHeader},D.tsx("span",{class:f.CSS.warningIcon,"aria-hidden":"true"}),D.tsx(M.Heading,{class:f.CSS.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),D.tsx("div",{class:f.CSS.warningMessage},this._getErrorMessage()))},r._renderDirectionsContainerContent=function(){const{viewModel:{layer:e,state:t}}=this,s="routing"===t;return"error"===t?this._renderWarningCard():s?this._renderLoader():a.isSome(e.directionLines)?D.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(f.CSS.summary,this._saveLayer.opened&&f.CSS.buttonDisabled),key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):D.tsx("div",{key:"esri-directions__placeholder",class:f.CSS.emptyContent},this._renderPlaceholder(),D.tsx(M.Heading,{class:f.CSS.message,level:this.headingLevel},this.messages.directionsPlaceholder))},r._renderPlaceholder=function(){return D.tsx("svg",{class:f.CSS.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},D.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))},r._renderMessage=function(e){return D.tsx(M.Heading,{level:this.headingLevel},e)},r._renderRouteActions=function(){return D.tsx("div",{class:f.CSS.routeActions},D.tsx("button",{"aria-label":this.messages.clearRoute,class:this.classes(f.CSS.clearRouteButton,f.CSS.button,f.CSS.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))},r._getSections=function(){const{directionPoints:e,directionLines:t,stops:s}=this.viewModel.layer;if(a.isNone(e)||a.isNone(t))return null;const o=[];let i=null;for(const n of e){const{objectId:e,stopId:r}=n;if(a.isSome(r)){const e=s.find((e=>e.objectId===r)),t=0===o.length;(a.isNone(i)||i.stop!==e)&&(i={stop:e,directions:[],open:t},o.push(i));continue}if(a.isNone(i))continue;const l=t.find((t=>t.directionPointId===e));a.isNone(l)||i.directions.push({directionPoint:n,directionLine:l})}return o},r._renderManeuverSections=function(){return a.isNone(this._sections)?null:D.tsx("div",{class:f.CSS.maneuvers,role:"group"},this._sections.map(((e,t)=>{const{open:s}=e;let o;e.directions.length>0&&s&&(o=D.tsx("ol",{class:f.CSS.maneuverList},e.directions.map((e=>this._renderManeuver(e)))));const i=a.unwrap(this._sections).length>2,n=t===a.unwrap(this._sections).length-1,r={[f.CSS.collapsibleSection]:i},l={[f.CSS.openIcon]:!s,[f.CSS.closeIcon]:s};let c;if(i&&!n){const t=s?this.messagesCommon.close:this.messagesCommon.open;c=D.tsx("header",{class:this.classes(f.CSS.maneuverSectionHeader,f.CSS.maneuverSectionToggle),key:f.CSS.maneuverSectionHeader},D.tsx("div",{"aria-expanded":s.toString(),"aria-label":t,bind:this,class:f.CSS.maneuverSectionHeaderButton,"data-maneuver-section":e,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:t},D.tsx(M.Heading,{class:f.CSS.maneuverSectionTitle,level:this.headingLevel},e.stop.name),D.tsx("span",{"aria-hidden":"true",class:this.classes(l)})))}else c=D.tsx("header",{class:f.CSS.maneuverSectionHeader,key:f.CSS.maneuverSectionHeader},D.tsx(M.Heading,{class:f.CSS.maneuverSectionTitle,level:this.headingLevel},e.stop.name));return D.tsx("section",{class:this.classes(f.CSS.maneuverSection,r),key:t},c,o)})))},r._handleSectionToggle=function(e){const t=e.currentTarget["data-maneuver-section"];t.open=!t.open},r._renderCosts=function(){const e=this._getCostSummary(),{directionPoints:t}=this.viewModel.layer;if(a.isNone(t)||a.isNone(e))return null;const s=t.getItemAt(t.length-1).arrivalTime,{distance:o,duration:i}=e,{eta:n,etaTemplate:r,primaryCosts:l,secondaryCosts:c,zoomToRoute:d}=this.messages,u=R.convertDateFormatToIntlOptions("short-time"),h=a.isSome(s)?`<strong>${R.formatDate(s,u)}</strong>`:null,p=a.isSome(s)?`${A(s)}`:null,S=L.substitute(r,{time:h,gmt:p});return D.tsx("div",{"aria-label":d,bind:this,class:f.CSS.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:d},D.tsx("div",{class:f.CSS.costsDetails,role:"group"},D.tsx("div",{class:f.CSS.primaryCosts,title:l},i),D.tsx("div",{class:f.CSS.verticalSplitter}),D.tsx("div",{class:f.CSS.secondaryCosts,title:c},o)),D.tsx("div",{innerHTML:S,title:n}))},r._handleSummaryInteraction=function(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()},r._getErrorMessage=function(){const{messages:e,viewModel:{lastError:t}}=this;if(a.isSome(t))switch(t.name){case"directions-view-model:unable-to-route":return e.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return e.errors.unableToLoadServiceMetadata}return e.errors.unknownError},r._normalizeSearchSources=function(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)},r._overrideDefaultSources=function(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1}))},r._applyLocatorSourceOverrides=function({allSources:e}){for(const t of e)"url"in t&&t.url&&(t.locationType??(t.locationType="street"),w.isArcGISWorldGeocoder(t.url)&&this.apiKey&&null==t.apiKey&&(t.apiKey=this.apiKey,t.url=w.meteredArcGISLocatorUrl))},r._acquireSearch=function(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const s=this._stopsToSearches.get(e);return s.view=t,this._overrideDefaultSources(s),s}const s=new m({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this.addHandles([l.on((()=>s.allSources),"change",(()=>this._normalizeSearchSources(s))),s.on("select-result",(()=>{e.geometry=s.selectedResult.feature.geometry,e.name=s.selectedResult.name,this._getDirections()})),s.on("search-focus",(()=>this._handleStopInputFocus(s,e))),s.on("search-blur",(()=>this._handleStopInputBlur(s,e))),s.on("search-clear",(()=>{e.geometry=null,e.name=null,this._activeStop=e,this.viewModel.layer.removeResult()})),l.watch((()=>s.searchTerm),(t=>{e.name=t}))],s),this._stopsToSearches.set(e,s),s},r._disposeSearch=function(e){if(this._stopsToSearches.has(e)){const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}},r._renderManeuver=function(e){const{directionPoint:t,directionLine:s}=e,{distance:o,duration:i}=s,{messages:n,messagesUnits:r,unit:l}=this,c=C.formatDistance(r,a.unwrapOrValue(o,0),l),d=C.formatDuration(a.unwrapOrValue(i,0)),u=c&&d?`${c}&nbsp;&middot;&nbsp;${d}`:`${c}${d}`,h=this._getFormattedManeuverText(t),{objectId:p,directionPointType:S}=t,v=f.getIconPath(S),m=`esri-directions__maneuver-${p}`,_=`esri-directions__intermediate-costs-${p}`,g={[f.CSS.maneuverActive]:this._activeManeuver===s};return D.tsx("li",{"aria-labelledby":`${m} ${_}`,bind:this,class:this.classes(f.CSS.maneuver,g),"data-maneuver":s,key:s,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},a.isSome(v)&&D.tsx("img",{alt:"",class:f.CSS.maneuverIcon,src:v}),D.tsx("div",{class:f.CSS.maneuverCostsContainer},D.tsx("span",{id:m,innerHTML:a.unwrapOrValue(h,"")}),D.tsx("div",{class:f.CSS.maneuverCosts},D.tsx("div",{class:f.CSS.horizontalSplitter}),D.tsx("div",{"aria-hidden":"true",id:_,class:f.CSS.intermediateCost,innerHTML:u,title:n.intermediateCosts}))))},r._handleManeuverClick=function(e){const t=e.currentTarget["data-maneuver"];if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t;const{geometry:s}=t;this.viewModel.centerAt(s),this.viewModel.highlight(t)},r._handleManeuverMouseOver=function(e){if(this._activeManeuver||this._focusedManeuver)return;const t=e.currentTarget["data-maneuver"];this.viewModel.highlight(t)},r._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()},r._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())},r._handleManeuverFocus=function(e){if(this._activeManeuver)return;const t=e.currentTarget["data-maneuver"];this._focusedManeuver=t,this.viewModel.highlight(t)},r._getFormattedManeuverText=function(e){const{displayText:t,name:s,intersectingName:o}=e;if(a.isNone(t))return"";let i=t;return a.isSome(s)&&i.includes(s)&&(i=i.replace(s,`<strong>${s}</strong>`)),a.isSome(o)&&i.includes(o)&&(i=i.replace(o,`<strong>${o}</strong>`)),i},r._getCostSummary=function(){const{messagesUnits:e,unit:t,viewModel:s}=this,{routeInfo:o}=s.layer;if(a.isNone(o))return null;const i=a.unwrapOrValue(o.totalDistance,0),n=a.unwrapOrValue(o.totalDuration,0);return{distance:C.formatDistance(e,i,t),duration:C.formatDuration(n)}},r._getDirections=function(){var e=t._asyncToGenerator((function*(){if(!(this.viewModel.layer.stops.filter((e=>a.isSome(e.geometry))).length<2))try{yield this.viewModel.getDirections()}catch{}}));function s(){return e.apply(this,arguments)}return s}(),t._createClass(o,[{key:"apiKey",get:function(){return this.viewModel.apiKey},set:function(e){this.viewModel.apiKey=e}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(e){this.viewModel.goToOverride=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"lastRoute",get:function(){return this.viewModel.lastRoute}},{key:"layer",get:function(){return this.viewModel.layer},set:function(e){this.viewModel.layer=e}},{key:"maxStops",get:function(){return this.viewModel.maxStops},set:function(e){this.viewModel.maxStops=e}},{key:"routeServiceUrl",get:function(){return i.deprecatedProperty(F,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.url},set:function(e){i.deprecatedProperty(F,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.url=e}},{key:"routeSymbol",get:function(){return i.deprecatedProperty(F,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.directionLines},set:function(e){i.deprecatedProperty(F,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.directionLines=e}},{key:"stopSymbols",get:function(){return i.deprecatedProperty(F,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.stops},set:function(e){i.deprecatedProperty(F,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0}),this.viewModel.legacyLayer.defaultSymbols.stops=e}},{key:"unit",get:function(){return this.defaultUnit},set:function(e){this._overrideIfSome("unit",e)}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}}]),o}(_);s.__decorate([c.property()],V.prototype,"apiKey",null),s.__decorate([c.property(p.defaultUnitPropertyMetadata)],V.prototype,"defaultUnit",void 0),s.__decorate([c.property()],V.prototype,"goToOverride",null),s.__decorate([c.property()],V.prototype,"headingLevel",void 0),s.__decorate([c.property()],V.prototype,"iconClass",void 0),s.__decorate([c.property()],V.prototype,"label",null),s.__decorate([c.property({readOnly:!0})],V.prototype,"lastRoute",null),s.__decorate([c.property()],V.prototype,"layer",null),s.__decorate([c.property()],V.prototype,"maxStops",null),s.__decorate([c.property(),k.messageBundle("esri/widgets/Directions/t9n/Directions")],V.prototype,"messages",void 0),s.__decorate([c.property(),k.messageBundle("esri/t9n/common")],V.prototype,"messagesCommon",void 0),s.__decorate([c.property(),k.messageBundle("esri/core/t9n/Units")],V.prototype,"messagesUnits",void 0),s.__decorate([c.property()],V.prototype,"routeServiceUrl",null),s.__decorate([c.property()],V.prototype,"routeSymbol",null),s.__decorate([c.property()],V.prototype,"searchProperties",void 0),s.__decorate([c.property()],V.prototype,"stopSymbols",null),s.__decorate([c.property()],V.prototype,"unit",null),s.__decorate([c.property()],V.prototype,"view",null),s.__decorate([c.property({type:g})],V.prototype,"viewModel",void 0),s.__decorate([c.property()],V.prototype,"visibleElements",void 0),s.__decorate([u.cast("visibleElements")],V.prototype,"castVisibleElements",null),s.__decorate([x.accessibleHandler()],V.prototype,"_handleStopIconClick",null),s.__decorate([x.accessibleHandler()],V.prototype,"_handleClearRouteClick",null),s.__decorate([x.accessibleHandler()],V.prototype,"_handleReverseStops",null),s.__decorate([x.accessibleHandler()],V.prototype,"_handleRemoveStop",null),s.__decorate([x.accessibleHandler()],V.prototype,"_handleSectionToggle",null),s.__decorate([x.accessibleHandler()],V.prototype,"_handleSummaryInteraction",null),s.__decorate([x.accessibleHandler()],V.prototype,"_handleManeuverClick",null),V=s.__decorate([h.subclass($)],V);return V}));
