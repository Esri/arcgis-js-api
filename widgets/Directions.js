// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../assets","../intl","../core/arrayUtils","../core/Collection","../core/events","../core/Handles","../core/watchUtils","../core/accessorSupport/decorators","../intl/moment","../libs/sortablejs/Sortable","./Search","./Widget","./Directions/DirectionsViewModel","./Directions/support/CostSummary","./Directions/support/directionsUtils","./Directions/support/maneuverUtils","./Directions/support/RouteSections","./support/DatePicker","./support/TimePicker","./support/widget"],(function(e,t,s,r,i,o,n,a,l,c,d,u,p,_,h,v,m,g,f,y,S,w,b){"use strict";var M="now",x="esri-directions esri-widget esri-widget--panel",T="esri-directions__clear-route-button",C="esri-directions__scroller",k="esri-directions__panel-content",D="esri-directions__panel-content--loading",R="esri-directions__panel-content--error",I="esri-directions__panel-content--sign-in",P="esri-directions__loader",H="esri-directions__message",z="esri-directions__travel-modes-select",O="esri-directions__departure-time",U="esri-directions__departure-time-select",L="esri-directions__directions-section",A="esri-directions__departure-time-controls",E="esri-directions__section",N="esri-directions__summary",F="esri-directions__stop-icon",B="esri-directions__stop-icon--interactive",V="esri-directions__remove-stop",q="esri-directions__remove-stop-icon",W="esri-directions__reverse-stops",G="esri-directions__stop-icon-container",j="esri-directions__stop-icon-container--last",J="esri-directions__stop-handle",K="esri-directions__stop-input",Q="esri-directions__stop-options",X="esri-directions__stop-handle-icon",Y="esri-directions__vertical-splitter",Z="esri-directions__stop-row",$="esri-directions__stop-row-ghost",ee="esri-directions__stop-row--valid",te="esri-directions__stops",se="esri-directions__add-stop",re="esri-directions__add-stop-text",ie="esri-directions__costs",oe="esri-directions__costs-details",ne="esri-directions__costs-value",ae="esri-directions__other-costs-total",le="esri-directions__route-actions",ce="esri-directions__maneuvers",de="esri-directions__maneuver-list",ue="esri-directions__maneuver-section",pe="esri-directions__maneuver-section-header",_e="esri-directions__maneuver-section-header-toggle-button",he="esri-directions__maneuver-section-title",ve="esri-directions__maneuver-section--collapsible",me="esri-directions__maneuver-section-toggle",ge="esri-directions__maneuver",fe="esri-directions__maneuver--active",ye="esri-directions__maneuver-costs",Se="esri-directions__maneuver-costs-container",we="esri-directions__maneuver-icon",be="esri-directions__cost--cumulative",Me="esri-directions__cost--intermediate",xe="esri-directions__horizontal-splitter",Te="esri-directions__section-splitter",Ce="esri-directions__disclaimer",ke="esri-directions__sign-in-content",De="esri-directions__sign-in-button",Re="esri-directions__content-title",Ie="esri-directions__warning-card",Pe="esri-directions__warning-header",He="esri-directions__warning-heading",ze="esri-directions__warning-message",Oe="esri-icon-radio-unchecked",Ue="esri-icon-radio-checked",Le="esri-icon-handle-vertical",Ae="esri-icon-plus",Ee="esri-icon-trash",Ne="esri-icon-up-down-arrows",Fe="esri-icon-right-triangle-arrow",Be="esri-icon-down-arrow",Ve="esri-icon-notice-triangle",qe="esri-icon-directions",We="esri-widget__anchor",Ge="esri-button",je="esri-button--secondary",Je="esri-button--tertiary",Ke="esri-widget__content--empty",Qe="esri-widget__content-illustration--empty",Xe="esri-widget__heading",Ye="esri-select",Ze="esri-icon-font-fallback-text",$e="awaiting-view-click-stop",et=r.getAssetUrl("esri/themes/base/images/maneuvers/");var tt={hour:"numeric",minute:"numeric"},st={minimumIntegerDigits:2};function rt(e){var t;return!!o.find(null===(t=e.composedPath)||void 0===t?void 0:t.call(e),(function(e){var t;return null===(t=e.classList)||void 0===t?void 0:t.contains("esri-search__suggestions-list")}))}return function(e){function t(t,s){var r=e.call(this,t,s)||this;return r._autoStopRemovalDelay=100,r._costSummary=new m,r._departureTime=M,r._datePicker=new S,r._handles=new l,r._newPlaceholderStop=null,r._pointerPressedSearchSuggestionStop=null,r._routeSections=new y,r._stops=new n([{},{}]),r._stopsToSearches=new Map,r._timePicker=new w,r.goToOverride=null,r.iconClass=qe,r.label=void 0,r.lastRoute=null,r.maxStops=null,r.messages=null,r.messagesCommon=null,r.routeServiceUrl=null,r.routeSymbol=null,r.searchProperties=null,r.stopSymbols=null,r.view=null,r.viewModel=new v,r._setUpDragAndDropStops=function(e){r._sortable=p.create(e,{draggable:"."+ee,ghostClass:$,handle:"."+J,onEnd:r._handleStopInputDragEnd})},r._handleDragHandlePointerDown=function(){return r._stops.forEach((function(e){return r._acquireSearch(e).activeMenu="none"}))},r._handleStopInputDragEnd=function(e){var t=e.oldIndex,s=e.newIndex,i=e.target;if(t!==s){var o=i.children,n=o[s],a=o[t],l=s-t<0;i.insertBefore(n,l?a.nextElementSibling:a);var c=r._stops;c.reorder(c.getItemAt(t),s),r._processStops()}},r}return s.__extends(t,e),t.prototype.loadLocale=function(){return s.__awaiter(this,void 0,void 0,(function(){var e;return s.__generator(this,(function(t){switch(t.label){case 0:return e=this,[4,u.loadMoment()];case 1:return e._moment=t.sent(),[2]}}))}))},t.prototype.initialize=function(){var e=this;this.own([c.init(this,"viewModel.lastRoute",(function(){e._routeSections.routePath=e.get("viewModel.directionLines"),e._activeManeuver=null,e._focusedManeuver=null,e.scheduleRender()})),c.init(this,"viewModel.selectedTravelMode, viewModel.departureTime",(function(){e.get("viewModel.stops.length")>1&&e.getDirections()})),c.when(this,"view",(function(t,s){if(s&&(e._viewClickHandle=null,e._handles.remove(s)),t){var r=e._prepPointerDownUpClick(),i=e._prepViewClick();r.pause(),i.pause(),e._handles.add([a.on(t.surface,"mousedown",(function(){return e._autoStopRemovalDelay=500})),a.on(t.surface,"mouseup",(function(){return e._autoStopRemovalDelay=100})),r,i],e.view.surface),e._pointerDownUpHandle=r,e._viewClickHandle=i}})),c.whenOnce(this,"routeServiceUrl",(function(){return e.viewModel.load()})),c.watch(this,"viewModel.stops.length",(function(t){0===t&&(e._stops.toArray().forEach((function(t){return e._removeStop(t,!0)})),e._stops.addMany([{},{}]),e.scheduleRender())}))])},t.prototype.destroy=function(){this._datePicker.destroy(),this._timePicker.destroy(),this._stopsToSearches.forEach((function(e){return e.destroy()})),this._sortable&&this._sortable.destroy()},t.prototype.getDirections=function(){return null},t.prototype.zoomToRoute=function(){},t.prototype.render=function(){return b.tsx("div",{class:this.classes(x,C)},this._renderPanelContent())},t.prototype._renderPanelContent=function(){var e,t=this.viewModel.state,s="initializing"===t,r="error"===t&&!this.viewModel.serviceDescription,i="unauthenticated"===t,o=((e={})[D]=s,e[R]=r,e[I]=i,e),n=s?"presentation":"group",a=i?this._renderSignIn():r?this._renderMessage(this._getErrorMessage()):s?this._renderLoader():this._renderReadyContent();return b.tsx("div",{class:this.classes(k,o),role:n},a)},t.prototype._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSectionSplitter(),this._renderDirectionsContainer(),this._renderDisclaimer()]},t.prototype._renderSignIn=function(){return b.tsx("div",{key:"sign-in",class:ke},b.tsx("h2",{class:this.classes(Xe,Re)},this.messages.widgetLabel),this._renderPlaceholder(),b.tsx("h3",{class:Xe},this.messages.signInRequired),b.tsx("button",{class:this.classes(Ge,je,De),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))},t.prototype._handleSignInClick=function(){this.viewModel.load().catch((function(){}))},t.prototype._renderTravelModeOptions=function(){var e=this.viewModel.travelModes;if(0===e.length)return null;var t=this.viewModel.selectedTravelMode,s=t.name||this.messages.travelMode;return b.tsx("select",{"aria-label":s,bind:this,class:this.classes(z,Ye),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},e.map((function(e){var s=e.id===t.id;return b.tsx("option",{key:e,"data-mode":e,selected:s,value:e.id},e.name)})))},t.prototype._handleTravelModeChange=function(e){var t=e.currentTarget,s=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=s["data-mode"]},t.prototype._renderStopsContainer=function(){return b.tsx("div",{class:E,key:"esri-directions__stops-container",role:"group"},this._renderStops())},t.prototype._renderDepartureTimeControls=function(){var e=this._departureTime===M,t=this.messages,s=t.departureTime;return b.tsx("div",{class:O,key:"esri-directions__departure-time-controls",role:"group"},b.tsx("select",{"aria-label":s,bind:this,class:this.classes(U,Ye),onchange:this._handleDepartureOptionChange,title:s},b.tsx("option",{value:M,selected:e},t.leaveNow),b.tsx("option",{value:"depart-by",selected:!e},t.departBy)),e?null:this._renderTimeControls())},t.prototype._renderStops=function(){var e=this,t=this._stops,s=0;t.forEach((function(t){"none"!==e._acquireSearch(t).activeMenu&&(s+=1)}));var r=t.toArray().map((function(r,o){var n,a,l,c=t.length,d=o>1&&!r.result,u=((n={})[Oe]=o>=0&&o<c-1,n[Ue]=o===c-1,n),p=((a={})[j]=o===c-1,a),_=((l={})[ee]=!d,l),h=t.getItemAt(c-1),v=h&&h.result,m=t.getItemAt(o+1),g=m&&m.result,f=o===c-1,y=o===c-2,S=2===c&&0===o||c>2&&!f&&!y||c>2&&y&&g||c>2&&f&&!r.result,w=2===c||3===c&&!v||d,M=e._acquireSearch(r),x=e.messages,T=x.removeStop,C=x.reverseStops,k=x.unlocated,D=i.substitute(x.stopLabelTemplate,{number:o+1,label:r.result?r.result.name:k}),R=e.id+"__stop--"+o,I=!!M.searchTerm&&!!M.selectedResult&&!!r.result&&M.selectedResult===r.result,P={zIndex:"none"!==M.activeMenu?""+s--:""};return b.tsx("li",{"aria-label":D,afterCreate:e._handleStopFieldCreation,bind:e,class:e.classes(Z,_),id:R,key:o,"data-stop-index":o,styles:P},b.tsx("div",{class:J},b.tsx("span",{"aria-hidden":"true",class:e.classes(F,Le,X,B),onpointerdown:e._handleDragHandlePointerDown}),b.tsx("div",{bind:e,"aria-labelledby":R,class:e.classes(G,p),"data-stop-index":o,onclick:e._handleStopIconClick,onkeydown:e._handleStopIconClick,role:"button"},b.tsx("span",{class:e.classes(F,u),tabindex:I?"0":null}))),b.tsx("div",{class:K},M.render()),b.tsx("div",{class:Q,role:"group"},b.tsx("div",{"aria-label":T,class:V,bind:e,"data-stop-index":o,hidden:w,onkeydown:e._handleRemoveStop,onclick:e._handleRemoveStop,role:"button",tabIndex:0,title:T},b.tsx("span",{"aria-hidden":"true",class:e.classes(F,q,Ee,B)}),b.tsx("span",{class:Ze},"removeStopTitle")),b.tsx("div",{"aria-label":C,class:W,bind:e,hidden:S,onkeydown:e._handleReverseStops,onclick:e._handleReverseStops,role:"button",tabIndex:0,title:C},b.tsx("span",{"aria-hidden":"true",class:e.classes(F,Ne,B)}),b.tsx("span",{class:Ze},"removeStopTitle"))))})),o=t.every((function(t){var s=e._stopsToSearches.get(t);return t.result&&s.selectedResult===t.result})),n=this._stops.length>=this.maxStops,a=this.messages.addStop,l=t.length>=2&&o&&!n?b.tsx("div",{"aria-label":a,bind:this,class:se,key:"esri-directions__add-stop",onfocus:this._handleAddStopFocus,tabIndex:0},b.tsx("span",{"aria-hidden":"true",class:this.classes(Ae,F,B)}),b.tsx("div",{"aria-hidden":"true",class:re},a)):null;return b.tsx("div",null,b.tsx("ol",{class:te,role:"group",afterCreate:this._setUpDragAndDropStops},r),l)},t.prototype._handleStopIconClick=function(e){var t=e.currentTarget["data-stop-index"],s=this._stops.getItemAt(t);s&&s.result&&this._centerAtStop(s)},t.prototype._handleClearRouteClick=function(){this.viewModel.reset()},t.prototype._centerAtStop=function(e){this.viewModel.centerAt(e.result.feature)},t.prototype._handleStopFieldCreation=function(e){var t=this,s=this._newPlaceholderStop;if(s){var r=e["data-stop-index"],i=this._stops.getItemAt(r);if(s===i){var o=this._acquireSearch(i);o.when((function(){t.renderNow(),o.focus()}))}this._newPlaceholderStop=null}},t.prototype._handleStopInputBlur=function(e,t){var s=this;if(this._handles.remove($e),this.view.cursor=this._previousCursor,!(!!e.selectedResult&&!!t.result&&e.selectedResult===t.result))return"none"!==e.activeMenu||!e.searchTerm||e.selectedResult===t.result&&(e.selectedResult||t.result)?void(e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((function(){s.destroyed||(s._viewClickHandle.pause(),"searching"!==e.viewModel.state?s._pointerPressedSearchSuggestionStop||(s._removeStop(t),!!t.result&&(t.result=null,s._processStops()),s.scheduleRender()):s._pointerDownUpHandle.pause())}),this._autoStopRemovalDelay))):(e.search(),void this._pointerDownUpHandle.pause());this._pointerDownUpHandle.pause()},t.prototype._handleStopInputFocus=function(e,t){if(this._pointerDownUpHandle.resume(),!this._handles.has($e)){var s=this.view,r=this.view.cursor;this._previousCursor=r,this._handles.add(c.init(e,"searchTerm",(function(e){s.cursor=0===e.length?"copy":r})),$e),this._activeStop=t}},t.prototype._prepViewClick=function(){var e=this,t=this.get("viewModel.view"),s=a.pausable(t,"click",this._handleViewClick.bind(this)),r=a.pausable(t.surface,"click",(function(){clearTimeout(e._autoStopRemovalTimeoutId),r.pause()}));return{remove:function(){r.remove(),s.remove()},pause:function(){r.pause(),s.pause()},resume:function(){r.resume(),s.resume()}}},t.prototype._prepPointerDownUpClick=function(){var e=this,t=a.pausable(document,"pointerdown",(function(t){e._pointerPressedSearchSuggestionStop=rt(t)?e._activeStop:null})),s=a.pausable(document,"pointerup",(function(t){e._pointerDownUpHandle.pause();var s=rt(t),r=e._activeStop;s||r!==e._pointerPressedSearchSuggestionStop||e._removeStop(r),e.scheduleRender(),e._pointerPressedSearchSuggestionStop=s?e._activeStop:null}));return{remove:function(){s.remove(),t.remove()},pause:function(){s.pause(),t.pause()},resume:function(){t.resume()}}},t.prototype._handleViewClick=function(e){var t=this,s=this._stopsToSearches.get(this._activeStop);s&&!s.searchTerm&&(s.search(e.mapPoint).then((function(e){var r=function(e){return e.results[0].results[0]}(e),i=t._activeStop;i.result=r,i.result.feature.attributes.Name=r.name,s.searchTerm=r.name})),this.scheduleRender()),this._viewClickHandle.pause(),clearTimeout(this._autoStopRemovalTimeoutId)},t.prototype._handleAddStopFocus=function(){this._addNewPlaceholder()},t.prototype._addNewPlaceholder=function(){if(this._pointerDownUpHandle.pause(),!this._newPlaceholderStop){var e={};this._stops.add(e),this._newPlaceholderStop=e}},t.prototype._handleReverseStops=function(){this._reverseStops()},t.prototype._reverseStops=function(){this._stops.reverse(),this._processStops()},t.prototype._handleRemoveStop=function(e){var t=e.currentTarget["data-stop-index"];this._removeStop(this._stops.getItemAt(t)),this._processStops()},t.prototype._removeStop=function(e,t){void 0===t&&(t=!1),this._stops.length<=2&&!t||(this._disposeSearch(e),this._stops.remove(e))},t.prototype._handleDepartureOptionChange=function(){var e=this,t=event.currentTarget,s=t.item(t.selectedIndex);s.value===M?(this._departureTime=M,this.viewModel.departureTime=M,this._handles.remove("departure-time-controls")):"depart-by"===s.value&&(this._departureTime="depart-by",this._handles.add([c.init(this._datePicker,"value",(function(){return e._updateDepartureTime()})),c.init(this._timePicker,"value",(function(){return e._updateDepartureTime()}))],"departure-time-controls"))},t.prototype._updateDepartureTime=function(){var e=this._moment(this._datePicker.value),t=this._moment(this._timePicker.value),s=this._moment({date:e.date(),month:e.month(),year:e.year(),hour:t.hour(),minute:t.minute()});this.viewModel.departureTime=s.toDate()},t.prototype._renderTimeControls=function(){return b.tsx("div",{class:A,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())},t.prototype._renderSectionSplitter=function(){return b.tsx("div",{class:Te})},t.prototype._renderDisclaimer=function(){var e=this.messages,t='<a class="'+We+'" href="http://www.esri.com/legal/software-license" rel="noreferrer" target="_blank">'+e.esriTerms+"</a>",s=i.substitute(e.disclaimer,{esriTerms:t});return b.tsx("div",{class:Ce,innerHTML:s,key:"esri-directions__disclaimer"})},t.prototype._renderDirectionsContainer=function(){return b.tsx("div",{class:this.classes(L,E),key:"esri-directions__container"},this._renderDirectionsContainerContent())},t.prototype._renderLoader=function(){return b.tsx("div",{class:P,key:"loader"})},t.prototype._renderWarningCard=function(){return b.tsx("div",{class:Ie,role:"alert"},b.tsx("div",{class:Pe},b.tsx("span",{class:Ve,"aria-hidden":"true"}),b.tsx("div",{class:this.classes(Xe,He)},this.messagesCommon.warning)),b.tsx("div",{class:ze},this._getErrorMessage()))},t.prototype._renderDirectionsContainerContent=function(){var e=this.viewModel,t=e.lastRoute,s=e.state,r="routing"===s;return"error"===s?this._renderWarningCard():r?this._renderLoader():t?b.tsx("div",{class:N,key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):b.tsx("div",{key:"esri-directions__placeholder",class:Ke},this._renderPlaceholder(),b.tsx("h3",{class:this.classes(H,Xe)},this.messages.directionsPlaceholder))},t.prototype._renderPlaceholder=function(){return b.tsx("svg",{class:Qe,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},b.tsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))},t.prototype._renderMessage=function(e){return b.tsx("h3",null,e)},t.prototype._renderRouteActions=function(){return b.tsx("div",{class:le},b.tsx("button",{"aria-label":this.messages.clearRoute,class:this.classes(T,Ge,Je),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))},t.prototype._renderManeuverSections=function(){var e=this,t=this._routeSections.sections;return b.tsx("div",{class:ce,role:"group"},t.map((function(s,r){var i,o,n,a=s.open;s.maneuvers.length>0&&a&&(n=b.tsx("ol",{class:de},s.maneuvers.map((function(t){return e._renderManeuver(t)}))));var l,c=t.length>2,d=r===t.length-1,u=((i={})[ve]=c,i),p=((o={})[Fe]=!a,o[Be]=a,o);if(c&&!d){var _=a?e.messagesCommon.open:e.messagesCommon.close;l=b.tsx("header",{class:e.classes(pe,me),key:"esri-directions__maneuver-section-header"},b.tsx("div",{"aria-expanded":a,"aria-label":_,bind:e,class:_e,"data-maneuver-section":s,onkeydown:e._handleSectionToggle,onclick:e._handleSectionToggle,role:"button",tabIndex:0,title:_},b.tsx("span",{"aria-hidden":"true",class:e.classes(p)}),b.tsx("h2",{class:e.classes(Xe,he)},s.name)))}else l=b.tsx("header",{class:pe,key:"esri-directions__maneuver-section-header"},d?b.tsx("span",{"aria-hidden":"true",class:Ue}):null,b.tsx("h2",{class:e.classes(Xe,he)},s.name));return b.tsx("section",{class:e.classes(ue,u)},l,n)})))},t.prototype._handleSectionToggle=function(e){var t=e.currentTarget["data-maneuver-section"];t.open=!t.open},t.prototype._renderCosts=function(){var e,t,s,r,o,n=this.get("viewModel.directionLines"),a=n[n.length-1],l=new Date(a.attributes.arriveTimeUTC),c=this._costSummary.set({directionsViewModel:this.viewModel,messages:this.messages}),d=this.messages,u=d.zoomToRoute,p=i.formatDate(l,tt),_=i.substitute(d.etaTemplate,{time:"<strong>"+p+"</strong>",gmt:(e=l,t=e.getTimezoneOffset(),s=t>0?"-":"+",r=Math.abs(Math.floor(t/60)),o=Math.abs(Math.floor(t)%60),"GMT"+s+i.formatNumber(r,st)+i.formatNumber(o,st))}),h=d.primaryCosts,v=d.secondaryCosts,m=d.eta;return b.tsx("div",{"aria-label":u,bind:this,class:ie,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:u},b.tsx("div",{class:oe,role:"group"},b.tsx("div",{"aria-label":h,class:ne,title:h},c.primary),b.tsx("div",{class:Y}),b.tsx("div",{"aria-label":v,class:ae,title:v},c.secondary)),b.tsx("div",{"aria-label":m,innerHTML:_,title:m}))},t.prototype._handleSummaryInteraction=function(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()},t.prototype._getErrorMessage=function(){var e=this.messages,t=this.viewModel.error;return"directions-view-model:unable-to-route"===t.name?e.errors.unableToRoute:"directions-view-model:service-metadata-unavailable"===t.name?e.errors.unableToLoadServiceMetadata:e.errors.unknownError},t.prototype._normalizeSearchSources=function(e){this._overrideDefaultSources(e),this._ensureLocationTypeOnLocatorSources(e)},t.prototype._overrideDefaultSources=function(e){e.viewModel.defaultSources.forEach((function(e){e.autoNavigate=!1}))},t.prototype._ensureLocationTypeOnLocatorSources=function(e){var t=e.allSources;0!==t.length&&t.forEach((function(e){"locator"in e&&e.locator&&null===e.locationType&&(e.locationType="street")}))},t.prototype._acquireSearch=function(e){var t=this,r=this.get("viewModel.view");if(this._stopsToSearches.has(e)){var i=this._stopsToSearches.get(e);return i.view=r,this._overrideDefaultSources(i),i}var o=new _(s.__assign({view:r,resultGraphicEnabled:!1,popupEnabled:!1},this.searchProperties));return this._normalizeSearchSources(o),this._handles.add([c.on(o,"allSources","change",(function(){return t._normalizeSearchSources(o)})),o.on("select-result",(function(){e.result=o.selectedResult,e.result.feature.attributes.Name=o.selectedResult.name,t._processStops(),t.scheduleRender()})),o.on("search-focus",(function(){return t._handleStopInputFocus(o,e)})),o.on("search-blur",(function(){return t._handleStopInputBlur(o,e)}))],o),this._stopsToSearches.set(e,o),o},t.prototype._disposeSearch=function(e){this._stopsToSearches.get(e).destroy(),this._stopsToSearches.delete(e)},t.prototype._processStops=function(){var e=this.viewModel;e.stops.removeAll(),e.stops.addMany(this._stops.filter((function(e){return!!e.result})).map((function(e){return e.result.feature}))),e.stops.length>1&&e.getDirections()},t.prototype._renderManeuver=function(e){var t,s,r=e.attributes,i=this.get("viewModel.routeParameters.directionsLengthUnits"),o=this.messages,n=g.formatDistance(o,r.length,{toUnits:i}),a=g.formatTime(r.time),l=g.getAssociatedStop(e);g.useSpatiallyLocalTime(e,this.get("viewModel.routeParameters.startTime"))?s=g.toSpatiallyLocalTimeString(o,r.arriveTimeUTC,r.ETA,this._departureTime===M):n&&(s=a?n+"&nbsp;&middot;&nbsp;"+a:n);var c=l,d=this._getFormattedManeuverText(e),u=this._getIconPath(r.maneuverType);if(c)return b.tsx("li",{class:ge,key:e},b.tsx("header",null,l.attributes.Name));var p="esri-directions__maneuver-"+e.uid,_="esri-directions__cumulative-costs-"+e.uid,h="esri-directions__intermediate-costs-"+e.uid,v=((t={})[fe]=this._activeManeuver===e,t);return b.tsx("li",{"aria-labelledby":p+" "+_+" "+h,bind:this,class:this.classes(ge,v),"data-maneuver":e,key:e,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},b.tsx("img",{alt:"",class:we,src:u}),b.tsx("div",{class:Se},b.tsx("span",{id:p,innerHTML:d}),b.tsx("div",{class:ye},b.tsx("div",{class:xe}),b.tsx("div",{id:_,"aria-label":o.cumulativeCosts,class:be,innerHTML:"",title:o.cumulativeCosts}),b.tsx("div",{id:h,"aria-label":o.intermediateCosts,class:Me,innerHTML:s,title:o.intermediateCosts}))))},t.prototype._getIconPath=function(e){var t=f.toIconName(e),s=2===window.devicePixelRatio?"@2x":"";return""+et+t+s+".png"},t.prototype._handleManeuverClick=function(e){var t=e.currentTarget["data-maneuver"];if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t,this.viewModel.centerAt(t),this.viewModel.highlightSegment(t)},t.prototype._handleManeuverMouseOver=function(e){if(!this._activeManeuver&&!this._focusedManeuver){var t=e.currentTarget["data-maneuver"];this.viewModel.highlightSegment(t)}},t.prototype._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()},t.prototype._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())},t.prototype._handleManeuverFocus=function(e){if(!this._activeManeuver){var t=e.currentTarget["data-maneuver"];this._focusedManeuver=t,this.viewModel.highlightSegment(t)}},t.prototype._getFormattedManeuverText=function(e){var t=e.attributes.text,s=e.strings;if(!s)return t;var r=t;return s.forEach((function(e){r=r.replace(e.string,"<strong>"+e.string+"</strong>")})),r},s.__decorate([d.aliasOf("viewModel.goToOverride")],t.prototype,"goToOverride",void 0),s.__decorate([d.property()],t.prototype,"iconClass",void 0),s.__decorate([d.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),s.__decorate([d.aliasOf("viewModel.lastRoute")],t.prototype,"lastRoute",void 0),s.__decorate([d.aliasOf("viewModel.maxStops")],t.prototype,"maxStops",void 0),s.__decorate([d.property(),b.renderable(),b.messageBundle("esri/widgets/Directions/t9n/Directions")],t.prototype,"messages",void 0),s.__decorate([d.property(),b.renderable(),b.messageBundle("esri/t9n/common")],t.prototype,"messagesCommon",void 0),s.__decorate([d.aliasOf("viewModel.routeServiceUrl")],t.prototype,"routeServiceUrl",void 0),s.__decorate([d.aliasOf("viewModel.routeSymbol")],t.prototype,"routeSymbol",void 0),s.__decorate([d.property()],t.prototype,"searchProperties",void 0),s.__decorate([d.aliasOf("viewModel.stopSymbols")],t.prototype,"stopSymbols",void 0),s.__decorate([d.aliasOf("viewModel.view")],t.prototype,"view",void 0),s.__decorate([b.renderable(["lastRoute","state","travelModes"]),d.property({type:v})],t.prototype,"viewModel",void 0),s.__decorate([d.aliasOf("viewModel.getDirections")],t.prototype,"getDirections",null),s.__decorate([d.aliasOf("viewModel.zoomToRoute")],t.prototype,"zoomToRoute",null),s.__decorate([b.accessibleHandler()],t.prototype,"_handleStopIconClick",null),s.__decorate([b.accessibleHandler()],t.prototype,"_handleClearRouteClick",null),s.__decorate([b.accessibleHandler()],t.prototype,"_handleReverseStops",null),s.__decorate([b.accessibleHandler()],t.prototype,"_handleRemoveStop",null),s.__decorate([b.accessibleHandler()],t.prototype,"_handleSectionToggle",null),s.__decorate([b.accessibleHandler()],t.prototype,"_handleSummaryInteraction",null),s.__decorate([b.accessibleHandler()],t.prototype,"_handleManeuverClick",null),t=s.__decorate([d.subclass("esri.widgets.Directions")],t)}(h)}));