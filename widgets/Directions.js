/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/events","../core/Collection","../intl/date","../intl/number","../intl/substitute","../assets","../intl","../core/Handles","../core/watchUtils","../intl/moment","./support/widgetUtils","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/decorators/renderable","../chunks/index","./Widget","../chunks/sortable.esm","./support/DatePicker","./Search","./Directions/support/directionsUtils","./Directions/DirectionsViewModel","./Directions/support/CostSummary","./Directions/support/maneuverUtils","./Directions/support/RouteSections","./support/TimePicker"],(function(e,t,s,i,r,o,n,a,l,c,d,u,h,_,p,m,v,g,S,w,f,b,M,y,x,T,k,C,j,D,R,I,P,H,U,z){"use strict";const O="now",L="depart-by",$="esri-directions esri-widget esri-widget--panel",A="esri-directions__clear-route-button",E="esri-directions__scroller",B="esri-directions__panel-content",N="esri-directions__panel-content--loading",F="esri-directions__panel-content--error",V="esri-directions__panel-content--sign-in",q="esri-directions__loader",W="esri-directions__message",G="esri-directions__travel-modes-select",J="esri-directions__departure-time",K="esri-directions__departure-time-select",Q="esri-directions__directions-section",X="esri-directions__departure-time-controls",Y="esri-directions__section",Z="esri-directions__summary",ee="esri-directions__stop-icon",te="esri-directions__stop-icon--interactive",se="esri-directions__remove-stop",ie="esri-directions__remove-stop-icon",re="esri-directions__reverse-stops",oe="esri-directions__stop-icon-container",ne="esri-directions__stop-icon-container--last",ae="esri-directions__stop-handle",le="esri-directions__stop-input",ce="esri-directions__stop-options",de="esri-directions__stop-handle-icon",ue="esri-directions__vertical-splitter",he="esri-directions__stop-row",_e="esri-directions__stop-row-ghost",pe="esri-directions__stop-row--valid",me="esri-directions__stops",ve="esri-directions__add-stop",ge="esri-directions__add-stop-text",Se="esri-directions__costs",we="esri-directions__costs-details",fe="esri-directions__costs-value",be="esri-directions__other-costs-total",Me="esri-directions__route-actions",ye="esri-directions__maneuvers",xe="esri-directions__maneuver-list",Te="esri-directions__maneuver-section",ke="esri-directions__maneuver-section-header",Ce="esri-directions__maneuver-section-header-toggle-button",je="esri-directions__maneuver-section-title",De="esri-directions__maneuver-section--collapsible",Re="esri-directions__maneuver-section-toggle",Ie="esri-directions__maneuver",Pe="esri-directions__maneuver--active",He="esri-directions__maneuver-costs",Ue="esri-directions__maneuver-costs-container",ze="esri-directions__maneuver-icon",Oe="esri-directions__cost--cumulative",Le="esri-directions__cost--intermediate",$e="esri-directions__horizontal-splitter",Ae="esri-directions__section-splitter",Ee="esri-directions__disclaimer",Be="esri-directions__sign-in-content",Ne="esri-directions__sign-in-button",Fe="esri-directions__content-title",Ve="esri-directions__warning-card",qe="esri-directions__warning-header",We="esri-directions__warning-heading",Ge="esri-directions__warning-message",Je="esri-icon-radio-unchecked",Ke="esri-icon-radio-checked",Qe="esri-icon-handle-vertical",Xe="esri-icon-plus",Ye="esri-icon-trash",Ze="esri-icon-up-down-arrows",et="esri-icon-down",tt="esri-icon-up",st="esri-icon-notice-triangle",it="esri-icon-directions",rt="esri-widget__anchor",ot="esri-button",nt="esri-button--secondary",at="esri-button--tertiary",lt="esri-widget__content--empty",ct="esri-widget__content-illustration--empty",dt="esri-widget__heading",ut="esri-select",ht="esri-icon-font-fallback-text",_t="awaiting-view-click-stop",pt=v.getAssetUrl("esri/themes/base/images/maneuvers/");const mt={hour:"numeric",minute:"numeric"},vt={minimumIntegerDigits:2};function gt(e){const t=e.getTimezoneOffset(),s=t>0?"-":"+",i=Math.abs(Math.floor(t/60)),r=Math.abs(Math.floor(t)%60);return`GMT${s}${p.formatNumber(i,vt)}${p.formatNumber(r,vt)}`}function St(e){return!(null==e.composedPath||!e.composedPath().find((e=>{var t;return null==(t=e.classList)?void 0:t.contains("esri-search__suggestions-list")})))}let wt=function(t){function s(e,s){var i;return(i=t.call(this,e,s)||this)._autoStopRemovalDelay=100,i._costSummary=new P,i._departureTime=O,i._datePicker=new j,i._handles=new S,i._newPlaceholderStop=null,i._pointerPressedSearchSuggestionStop=null,i._routeSections=new U,i._stops=new h([{},{}]),i._stopsToSearches=new Map,i._timePicker=new z,i.goToOverride=null,i.iconClass=it,i.label=void 0,i.lastRoute=null,i.maxStops=null,i.messages=null,i.messagesCommon=null,i.messagesUnits=null,i.routeServiceUrl=null,i.routeSymbol=null,i.searchProperties=null,i.stopSymbols=null,i.view=null,i.viewModel=new I,i._setUpDragAndDropStops=e=>{i._sortable=C.Sortable.create(e,{draggable:`.${pe}`,ghostClass:_e,handle:`.${ae}`,onEnd:i._handleStopInputDragEnd})},i._handleDragHandlePointerDown=()=>i._stops.forEach((e=>i._acquireSearch(e).activeMenu="none")),i._handleStopInputDragEnd=({oldIndex:e,newIndex:t,target:s})=>{if(e===t)return;const{children:r}=s,o=r[t],n=r[e],a=t-e<0;s.insertBefore(o,a?n.nextElementSibling:n);const l=i._stops;l.reorder(l.getItemAt(e),t),i._processStops()},i}e._inheritsLoose(s,t);var i=s.prototype;return i.loadLocale=async function(){this._moment=await f.loadMoment()},i.initialize=function(){this.own([w.init(this,"viewModel.lastRoute",(()=>{this._routeSections.routePath=this.get("viewModel.directionLines"),this._activeManeuver=null,this._focusedManeuver=null,this.scheduleRender()})),w.init(this,"viewModel.selectedTravelMode, viewModel.departureTime",(()=>{this.get("viewModel.stops.length")>1&&this.getDirections()})),w.when(this,"view",((e,t)=>{if(t&&(this._viewClickHandle=null,this._handles.remove(t)),e){const t=this._prepPointerDownUpClick(),s=this._prepViewClick();t.pause(),s.pause(),this._handles.add([u.on(e.surface,"mousedown",(()=>this._autoStopRemovalDelay=500)),u.on(e.surface,"mouseup",(()=>this._autoStopRemovalDelay=100)),t,s],this.view.surface),this._pointerDownUpHandle=t,this._viewClickHandle=s}})),w.whenOnce(this,"routeServiceUrl",(()=>this.viewModel.load())),w.watch(this,"viewModel.stops.length",(e=>{0===e&&(this._stops.toArray().forEach((e=>this._removeStop(e,!0))),this._stops.addMany([{},{}]),this.scheduleRender())}))])},i.destroy=function(){this._datePicker.destroy(),this._timePicker.destroy(),this._stopsToSearches.forEach((e=>e.destroy())),this._sortable&&this._sortable.destroy()},i.getDirections=function(){return null},i.zoomToRoute=function(){},i.render=function(){return T.jsx("div",{class:this.classes($,E)},this._renderPanelContent())},i._renderPanelContent=function(){const{viewModel:{state:e}}=this,t="initializing"===e,s="error"===e&&!this.viewModel.serviceDescription,i="unauthenticated"===e,r={[N]:t,[F]:s,[V]:i},o=t?"presentation":"group",n=i?this._renderSignIn():s?this._renderMessage(this._getErrorMessage()):t?this._renderLoader():this._renderReadyContent();return T.jsx("div",{class:this.classes(B,r),role:o},n)},i._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSectionSplitter(),this._renderDirectionsContainer(),this._renderDisclaimer()]},i._renderSignIn=function(){return T.jsx("div",{key:"sign-in",class:Be},T.jsx("h2",{class:this.classes(dt,Fe)},this.messages.widgetLabel),this._renderPlaceholder(),T.jsx("h3",{class:dt},this.messages.signInRequired),T.jsx("button",{class:this.classes(ot,nt,Ne),tabIndex:0,onclick:this._handleSignInClick,bind:this,type:"button"},this.messagesCommon.auth.signIn))},i._handleSignInClick=function(){this.viewModel.load().catch((()=>{}))},i._renderTravelModeOptions=function(){const{travelModes:e}=this.viewModel;if(0===e.length)return null;const{selectedTravelMode:t}=this.viewModel,s=t.name||this.messages.travelMode;return T.jsx("select",{"aria-label":s,bind:this,class:this.classes(G,ut),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},e.map((e=>{const s=e.id===t.id;return T.jsx("option",{key:e,"data-mode":e,selected:s,value:e.id},e.name)})))},i._handleTravelModeChange=function(e){const t=e.currentTarget,s=t.item(t.selectedIndex);this.viewModel.selectedTravelMode=s["data-mode"]},i._renderStopsContainer=function(){return T.jsx("div",{class:Y,key:"esri-directions__stops-container",role:"group"},this._renderStops())},i._renderDepartureTimeControls=function(){const e=this._departureTime===O,{messages:t}=this,s=t.departureTime;return T.jsx("div",{class:J,key:"esri-directions__departure-time-controls",role:"group"},T.jsx("select",{"aria-label":s,bind:this,class:this.classes(K,ut),onchange:this._handleDepartureOptionChange,title:s},T.jsx("option",{value:O,selected:e},t.leaveNow),T.jsx("option",{value:L,selected:!e},t.departBy)),e?null:this._renderTimeControls())},i._renderStops=function(){const e=this._stops;let t=0;e.forEach((e=>{"none"!==this._acquireSearch(e).activeMenu&&(t+=1)}));const s=e.toArray().map(((s,i)=>{const r=e.length,o=i>1&&!s.result,n={[Je]:i>=0&&i<r-1,[Ke]:i===r-1},a={[ne]:i===r-1},l={[pe]:!o},c=e.getItemAt(r-1),d=c&&c.result,u=e.getItemAt(i+1),h=u&&u.result,_=i===r-1,p=i===r-2,v=2===r&&0===i||r>2&&!_&&!p||r>2&&p&&h||r>2&&_&&!s.result,g=2===r||3===r&&!d||o,S=this._acquireSearch(s),{messages:w}=this,{removeStop:f,reverseStops:b,unlocated:M}=w,y=m.substitute(w.stopLabelTemplate,{number:i+1,label:s.result?s.result.name:M}),x=`${this.id}__stop--${i}`,k=!!S.searchTerm&&!!S.selectedResult&&!!s.result&&S.selectedResult===s.result,C={zIndex:"none"!==S.activeMenu?""+t--:""};return T.jsx("li",{"aria-label":y,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(he,l),id:x,key:i,"data-stop-index":i,styles:C},T.jsx("div",{class:ae},T.jsx("span",{"aria-hidden":"true",class:this.classes(ee,Qe,de,te),onpointerdown:this._handleDragHandlePointerDown}),T.jsx("div",{bind:this,"aria-labelledby":x,class:this.classes(oe,a),"data-stop-index":i,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},T.jsx("span",{class:this.classes(ee,n),tabindex:k?"0":null}))),T.jsx("div",{class:le},S.render()),T.jsx("div",{class:ce,role:"group"},T.jsx("div",{"aria-label":f,class:se,bind:this,"data-stop-index":i,hidden:g,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,role:"button",tabIndex:0,title:f},T.jsx("span",{"aria-hidden":"true",class:this.classes(ee,ie,Ye,te)}),T.jsx("span",{class:ht},"removeStopTitle")),T.jsx("div",{"aria-label":b,class:re,bind:this,hidden:v,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:b},T.jsx("span",{"aria-hidden":"true",class:this.classes(ee,Ze,te)}),T.jsx("span",{class:ht},"removeStopTitle"))))})),i=e.every((e=>{const t=this._stopsToSearches.get(e);return e.result&&t.selectedResult===e.result})),r=this._stops.length>=this.maxStops,o=this.messages.addStop,n=e.length>=2&&i&&!r?T.jsx("div",{"aria-label":o,bind:this,class:ve,key:"esri-directions__add-stop",onfocus:this._handleAddStopFocus,tabIndex:0},T.jsx("span",{"aria-hidden":"true",class:this.classes(Xe,ee,te)}),T.jsx("div",{"aria-hidden":"true",class:ge},o)):null;return T.jsx("div",null,T.jsx("ol",{class:me,role:"group",afterCreate:this._setUpDragAndDropStops},s),n)},i._handleStopIconClick=function(e){const t=e.currentTarget["data-stop-index"],s=this._stops.getItemAt(t);s&&s.result&&this._centerAtStop(s)},i._handleClearRouteClick=function(){this.viewModel.reset()},i._centerAtStop=function(e){this.viewModel.centerAt(e.result.feature)},i._handleStopFieldCreation=function(e){const t=this._newPlaceholderStop;if(!t)return;const s=e["data-stop-index"],i=this._stops.getItemAt(s);if(t===i){const e=this._acquireSearch(i);e.when((()=>{this.renderNow(),e.focus()}))}this._newPlaceholderStop=null},i._handleStopInputBlur=function(e,t){this._handles.remove(_t),this.view.cursor=this._previousCursor;if(!e.selectedResult||!t.result||e.selectedResult!==t.result)return"none"!==e.activeMenu||!e.searchTerm||e.selectedResult===t.result&&(e.selectedResult||t.result)?void(e.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout((()=>{if(this.destroyed)return;if(this._viewClickHandle.pause(),"searching"===e.viewModel.state)return void this._pointerDownUpHandle.pause();if(this._pointerPressedSearchSuggestionStop)return;this._removeStop(t);!!t.result&&(t.result=null,this._processStops()),this.scheduleRender()}),this._autoStopRemovalDelay))):(e.search(),void this._pointerDownUpHandle.pause());this._pointerDownUpHandle.pause()},i._handleStopInputFocus=function(e,t){if(this._pointerDownUpHandle.resume(),this._handles.has(_t))return;const{view:s,view:{cursor:i}}=this;this._previousCursor=i,this._handles.add(w.init(e,"searchTerm",(e=>{s.cursor=0===e.length?"copy":i})),_t),this._activeStop=t},i._prepViewClick=function(){const e=this.get("viewModel.view"),t=u.pausable(e,"click",this._handleViewClick.bind(this)),s=u.pausable(e.surface,"click",(()=>{clearTimeout(this._autoStopRemovalTimeoutId),s.pause()}));return{remove(){s.remove(),t.remove()},pause(){s.pause(),t.pause()},resume(){s.resume(),t.resume()}}},i._prepPointerDownUpClick=function(){const e=u.pausable(document,"pointerdown",(e=>{this._pointerPressedSearchSuggestionStop=St(e)?this._activeStop:null})),t=u.pausable(document,"pointerup",(e=>{this._pointerDownUpHandle.pause();const t=St(e),s=this._activeStop;t||s!==this._pointerPressedSearchSuggestionStop||this._removeStop(s),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=t?this._activeStop:null}));return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}},i._handleViewClick=function(e){const t=this._stopsToSearches.get(this._activeStop);t&&!t.searchTerm&&(t.search(e.mapPoint).then((e=>{const s=function(e){return e.results[0].results[0]}(e),i=this._activeStop;i.result=s,i.result.feature.attributes.Name=s.name,t.searchTerm=s.name})),this.scheduleRender()),this._viewClickHandle.pause(),clearTimeout(this._autoStopRemovalTimeoutId)},i._handleAddStopFocus=function(){this._addNewPlaceholder()},i._addNewPlaceholder=function(){if(this._pointerDownUpHandle.pause(),this._newPlaceholderStop)return;const e={};this._stops.add(e),this._newPlaceholderStop=e},i._handleReverseStops=function(){this._reverseStops()},i._reverseStops=function(){this._stops.reverse(),this._processStops()},i._handleRemoveStop=function(e){const t=e.currentTarget["data-stop-index"];this._removeStop(this._stops.getItemAt(t)),this._processStops()},i._removeStop=function(e,t=!1){this._stops.length<=2&&!t||(this._disposeSearch(e),this._stops.remove(e))},i._handleDepartureOptionChange=function(){const e=event.currentTarget,t=e.item(e.selectedIndex);t.value===O?(this._departureTime=O,this.viewModel.departureTime=O,this._handles.remove("departure-time-controls")):t.value===L&&(this._departureTime=L,this._handles.add([w.init(this._datePicker,"value",(()=>this._updateDepartureTime())),w.init(this._timePicker,"value",(()=>this._updateDepartureTime()))],"departure-time-controls"))},i._updateDepartureTime=function(){const e=this._moment(this._datePicker.value),t=this._moment(this._timePicker.value),s=this._moment({date:e.date(),month:e.month(),year:e.year(),hour:t.hour(),minute:t.minute()});this.viewModel.departureTime=s.toDate()},i._renderTimeControls=function(){return T.jsx("div",{class:X,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())},i._renderSectionSplitter=function(){return T.jsx("div",{class:Ae})},i._renderDisclaimer=function(){const{messages:e}=this,t=`<a class="${rt}" href="http://www.esri.com/legal/software-license" rel="noreferrer" target="_blank">${e.esriTerms}</a>`,s=m.substitute(e.disclaimer,{esriTerms:t});return T.jsx("div",{class:Ee,innerHTML:s,key:"esri-directions__disclaimer"})},i._renderDirectionsContainer=function(){return T.jsx("div",{class:this.classes(Q,Y),key:"esri-directions__container"},this._renderDirectionsContainerContent())},i._renderLoader=function(){return T.jsx("div",{class:q,key:"loader"})},i._renderWarningCard=function(){return T.jsx("div",{class:Ve,role:"alert"},T.jsx("div",{class:qe},T.jsx("span",{class:st,"aria-hidden":"true"}),T.jsx("div",{class:this.classes(dt,We)},this.messagesCommon.warning)),T.jsx("div",{class:Ge},this._getErrorMessage()))},i._renderDirectionsContainerContent=function(){const{lastRoute:e,state:t}=this.viewModel,s="routing"===t;return"error"===t?this._renderWarningCard():s?this._renderLoader():e?T.jsx("div",{class:Z,key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):T.jsx("div",{key:"esri-directions__placeholder",class:lt},this._renderPlaceholder(),T.jsx("h3",{class:this.classes(W,dt)},this.messages.directionsPlaceholder))},i._renderPlaceholder=function(){return T.jsx("svg",{class:ct,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},T.jsx("path",{fill:"currentcolor",d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))},i._renderMessage=function(e){return T.jsx("h3",null,e)},i._renderRouteActions=function(){return T.jsx("div",{class:Me},T.jsx("button",{"aria-label":this.messages.clearRoute,class:this.classes(A,ot,at),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))},i._renderManeuverSections=function(){const{sections:e}=this._routeSections;return T.jsx("div",{class:ye,role:"group"},e.map(((t,s)=>{const{open:i}=t;let r;t.maneuvers.length>0&&i&&(r=T.jsx("ol",{class:xe},t.maneuvers.map((e=>this._renderManeuver(e)))));const o=e.length>2,n=s===e.length-1,a={[De]:o},l={[et]:!i,[tt]:i};let c;if(o&&!n){const e=i?this.messagesCommon.open:this.messagesCommon.close;c=T.jsx("header",{class:this.classes(ke,Re),key:"esri-directions__maneuver-section-header"},T.jsx("div",{"aria-expanded":i,"aria-label":e,bind:this,class:Ce,"data-maneuver-section":t,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:e},T.jsx("h2",{class:this.classes(dt,je)},t.name),T.jsx("span",{"aria-hidden":"true",class:this.classes(l)})))}else c=T.jsx("header",{class:ke,key:"esri-directions__maneuver-section-header"},T.jsx("h2",{class:this.classes(dt,je)},t.name));return T.jsx("section",{class:this.classes(Te,a)},c,r)})))},i._handleSectionToggle=function(e){const t=e.currentTarget["data-maneuver-section"];t.open=!t.open},i._renderCosts=function(){const e=this.get("viewModel.directionLines"),t=e[e.length-1],s=new Date(t.attributes.arriveTimeUTC),i=this._costSummary.set({directionsViewModel:this.viewModel,messages:this.messages,messagesUnits:this.messagesUnits}),{messages:r}=this,o=r.zoomToRoute,n=_.formatDate(s,mt),a=m.substitute(r.etaTemplate,{time:`<strong>${n}</strong>`,gmt:`${gt(s)}`}),l=r.primaryCosts,c=r.secondaryCosts,d=r.eta;return T.jsx("div",{"aria-label":o,bind:this,class:Se,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,role:"button",tabIndex:0,title:o},T.jsx("div",{class:we,role:"group"},T.jsx("div",{"aria-label":l,class:fe,title:l},i.primary),T.jsx("div",{class:ue}),T.jsx("div",{"aria-label":c,class:be,title:c},i.secondary)),T.jsx("div",{"aria-label":d,innerHTML:a,title:d}))},i._handleSummaryInteraction=function(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()},i._getErrorMessage=function(){const{messages:e}=this,{error:t}=this.viewModel;return"directions-view-model:unable-to-route"===t.name?e.errors.unableToRoute:"directions-view-model:service-metadata-unavailable"===t.name?e.errors.unableToLoadServiceMetadata:e.errors.unknownError},i._normalizeSearchSources=function(e){this._overrideDefaultSources(e),this._ensureLocationTypeOnLocatorSources(e)},i._overrideDefaultSources=function(e){e.viewModel.defaultSources.forEach((e=>{e.autoNavigate=!1}))},i._ensureLocationTypeOnLocatorSources=function({allSources:e}){0!==e.length&&e.forEach((e=>{"locator"in e&&e.locator&&null===e.locationType&&(e.locationType="street")}))},i._acquireSearch=function(e){const t=this.get("viewModel.view");if(this._stopsToSearches.has(e)){const s=this._stopsToSearches.get(e);return s.view=t,this._overrideDefaultSources(s),s}const s=new D({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this._handles.add([w.on(s,"allSources","change",(()=>this._normalizeSearchSources(s))),s.on("select-result",(()=>{e.result=s.selectedResult,e.result.feature.attributes.Name=s.selectedResult.name,this._processStops(),this.scheduleRender()})),s.on("search-focus",(()=>this._handleStopInputFocus(s,e))),s.on("search-blur",(()=>this._handleStopInputBlur(s,e)))],s),this._stopsToSearches.set(e,s),s},i._disposeSearch=function(e){this._stopsToSearches.get(e).destroy(),this._stopsToSearches.delete(e)},i._processStops=function(){const e=this.viewModel;e.stops.removeAll(),e.stops.addMany(this._stops.filter((e=>!!e.result)).map((e=>e.result.feature))),e.stops.length>1&&e.getDirections()},i._renderManeuver=function(e){let t;const{attributes:s}=e,i=this.get("viewModel.routeParameters.directionsLengthUnits"),{messages:r,messagesUnits:o}=this,n=R.formatDistance(r,o,s.length,{toUnits:i}),a=R.formatTime(s.time),l=R.getAssociatedStop(e);R.useSpatiallyLocalTime(e,this.get("viewModel.routeParameters.startTime"))?t=R.toSpatiallyLocalTimeString(r,s.arriveTimeUTC,s.ETA,this._departureTime===O):n&&(t=a?`${n}&nbsp;&middot;&nbsp;${a}`:n);const c=l,d=this._getFormattedManeuverText(e),u=this._getIconPath(s.maneuverType);if(c)return T.jsx("li",{class:Ie,key:e},T.jsx("header",null,l.attributes.Name));const h=`esri-directions__maneuver-${e.uid}`,_=`esri-directions__cumulative-costs-${e.uid}`,p=`esri-directions__intermediate-costs-${e.uid}`,m={[Pe]:this._activeManeuver===e};return T.jsx("li",{"aria-labelledby":`${h} ${_} ${p}`,bind:this,class:this.classes(Ie,m),"data-maneuver":e,key:e,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},T.jsx("img",{alt:"",class:ze,src:u}),T.jsx("div",{class:Ue},T.jsx("span",{id:h,innerHTML:d}),T.jsx("div",{class:He},T.jsx("div",{class:$e}),T.jsx("div",{id:_,"aria-label":r.cumulativeCosts,class:Oe,innerHTML:"",title:r.cumulativeCosts}),T.jsx("div",{id:p,"aria-label":r.intermediateCosts,class:Le,innerHTML:t,title:r.intermediateCosts}))))},i._getIconPath=function(e){const t=H.toIconName(e),s=2===window.devicePixelRatio?"@2x":"";return`${pt}${t}${s}.png`},i._handleManeuverClick=function(e){const t=e.currentTarget["data-maneuver"];if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t,this.viewModel.centerAt(t),this.viewModel.highlightSegment(t)},i._handleManeuverMouseOver=function(e){if(this._activeManeuver||this._focusedManeuver)return;const t=e.currentTarget["data-maneuver"];this.viewModel.highlightSegment(t)},i._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()},i._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())},i._handleManeuverFocus=function(e){if(this._activeManeuver)return;const t=e.currentTarget["data-maneuver"];this._focusedManeuver=t,this.viewModel.highlightSegment(t)},i._getFormattedManeuverText=function(e){const{attributes:{text:t},strings:s}=e;if(!s)return t;let i=t;return s.forEach((e=>{i=i.replace(e.string,`<strong>${e.string}</strong>`)})),i},s}(k);return t.__decorate([n.aliasOf("viewModel.goToOverride")],wt.prototype,"goToOverride",void 0),t.__decorate([o.property()],wt.prototype,"iconClass",void 0),t.__decorate([o.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],wt.prototype,"label",void 0),t.__decorate([n.aliasOf("viewModel.lastRoute")],wt.prototype,"lastRoute",void 0),t.__decorate([n.aliasOf("viewModel.maxStops")],wt.prototype,"maxStops",void 0),t.__decorate([o.property(),x.renderable(),y.messageBundle("esri/widgets/Directions/t9n/Directions")],wt.prototype,"messages",void 0),t.__decorate([o.property(),x.renderable(),y.messageBundle("esri/t9n/common")],wt.prototype,"messagesCommon",void 0),t.__decorate([o.property(),x.renderable(),y.messageBundle("esri/core/t9n/Units")],wt.prototype,"messagesUnits",void 0),t.__decorate([n.aliasOf("viewModel.routeServiceUrl")],wt.prototype,"routeServiceUrl",void 0),t.__decorate([n.aliasOf("viewModel.routeSymbol")],wt.prototype,"routeSymbol",void 0),t.__decorate([o.property()],wt.prototype,"searchProperties",void 0),t.__decorate([n.aliasOf("viewModel.stopSymbols")],wt.prototype,"stopSymbols",void 0),t.__decorate([n.aliasOf("viewModel.view")],wt.prototype,"view",void 0),t.__decorate([x.renderable(["lastRoute","state","travelModes"]),o.property({type:I})],wt.prototype,"viewModel",void 0),t.__decorate([n.aliasOf("viewModel.getDirections")],wt.prototype,"getDirections",null),t.__decorate([n.aliasOf("viewModel.zoomToRoute")],wt.prototype,"zoomToRoute",null),t.__decorate([M.accessibleHandler()],wt.prototype,"_handleStopIconClick",null),t.__decorate([M.accessibleHandler()],wt.prototype,"_handleClearRouteClick",null),t.__decorate([M.accessibleHandler()],wt.prototype,"_handleReverseStops",null),t.__decorate([M.accessibleHandler()],wt.prototype,"_handleRemoveStop",null),t.__decorate([M.accessibleHandler()],wt.prototype,"_handleSectionToggle",null),t.__decorate([M.accessibleHandler()],wt.prototype,"_handleSummaryInteraction",null),t.__decorate([M.accessibleHandler()],wt.prototype,"_handleManeuverClick",null),wt=t.__decorate([a.subclass("esri.widgets.Directions")],wt),wt}));
