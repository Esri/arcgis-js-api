/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/deprecate","../core/domUtils","../core/Evented","../core/Handles","../core/has","../core/lang","../core/Logger","../core/maybe","../core/Promise","../core/promiseUtils","../core/uuid","../core/watchUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/accessorSupport/tracking","../core/accessorSupport/tracking/SimpleTrackingTarget","../libs/maquette-advanced-projector/projector","../chunks/componentsUtils","./support/jsxWidgetSupport","./support/widgetUtils","../intl/locale","../intl/messages"],(function(e,t,r,o,n,i,s,a,c,d,l,p,u,h,_,y,g,f,v,m,k,b,w,T,I,S){"use strict";const j="esri.widgets.Widget",C=d.getLogger(j);let R=0;const P=new Map,E={widgetIcon:"esri-icon-checkbox-unchecked"};function L(e,t){for(const r in t)null!=e[r]&&("object"==typeof e[r]&&"object"==typeof t[r]?L(e[r],t[r]):e[r]=t[r]);return e}const N=k.createAdvancedProjector({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,r=/capture$/i;e.eventHandlerInterceptor=(e,o,n,i)=>{const s=t(e,o,n,i),a=r.test(e);if(!((e=e.replace(r,"")).toLowerCase()in n)||a){const t=e[2].toLowerCase()+e.slice(3),r=e=>s.call(n,e);n.addEventListener(t,r,a);const o=()=>n.removeEventListener(t,r,a),c=i.afterRemoved;i.afterRemoved=e=>{null==c||c(e),o()}}return s}},handleInterceptedEvent(e,t,r,o){const{eventPhase:n,type:i}=o,s=n===Event.CAPTURING_PHASE;let a=`on${i}${s?"capture":""}`;const c=t.properties;(a in c||(a=`on${i[0].toUpperCase()}${i.slice(1)}${s?"Capture":""}`,a in c))&&(P.clear(),e.scheduleRender(),c[a].call(c.bind||r,o))}});let H=!1,z=function(t){function r(r,n){var i;(i=t.call(this,r,n)||this)._attached=!1,i._internalHandles=new s,i._projector=N,i._readyForTrueRender=!1,i.domNode=null,i.iconClass=E.widgetIcon,i.label=i.declaredClass.split(".").pop(),i.visible=!0,i.key=e._assertThisInitialized(i),i._loadLocale=u.debounce(e._asyncToGenerator((function*(){if(i._messageBundleProps&&i._messageBundleProps.length){const t=yield u.eachAlways(i._messageBundleProps.map(function(){var t=e._asyncToGenerator((function*({bundlePath:e,propertyName:t}){let r=yield S.fetchMessageBundle(e);i.uiStrings&&Object.keys(i.uiStrings)&&(r=L(c.clone(r),i.uiStrings)),i[t]=r}));return function(e){return t.apply(this,arguments)}}()));for(const e of t)e.error&&C.error("widget-intl:locale-error",i.declaredClass,e.error)}yield i.loadLocale()}))),b.commitAssetPath();const a=["light","dark"],d=T.getThemeName()||"light";a.includes(d)||o.deprecated(C,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const l="esri-widget-uid-"+h.generateUUID(),p=i.render.bind(e._assertThisInitialized(i));i._trackingTarget=new m.SimpleTrackingTarget((()=>i.scheduleRender()));const _=()=>{var t;if(!i._readyForTrueRender||i.destroyed)return null;if(!i.visible)return{vnodeSelector:"div",properties:{key:l,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const r=p();let{properties:o}=r;o||(r.properties=o={});let{key:n,styles:s}=o;n||(o.key=l),s||(o.styles=s={}),s.display||(s.display="");let a=0;return null==(t=r.children)||t.forEach((e=>{if(w.isWidgetConstructor(e.vnodeSelector))return;let{properties:t}=e;t||(e.properties=t={}),t.key||(t.key=`${i.id}--${a++}`)})),w.processWidgets(e._assertThisInitialized(i),r)};return i.render=()=>{if(H)return _();let t=P.get(e._assertThisInitialized(i));if(t)return t;i._trackingTarget.clear(),H=!0;try{t=v.runTracked(i._trackingTarget,_)}finally{H=!1}return P.set(e._assertThisInitialized(i),t),t},i.addResolvingPromise(i._resourcesFetch=i.beforeFirstRender().then((()=>{i._readyForTrueRender=!0,i._postInitialize()}))),i}e._inheritsLoose(r,t);var i=r.prototype;return i.normalizeCtorArgs=function(e,t){const r={...e};return t&&(r.container=t),r},i.postInitialize=function(){},i.beforeFirstRender=function(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then((()=>{})).catch(u.throwIfNotAbortError)},i.loadDependencies=function(){var t=e._asyncToGenerator((function*(){}));function r(){return t.apply(this,arguments)}return r}(),i.loadLocale=function(){var t=e._asyncToGenerator((function*(){}));function r(){return t.apply(this,arguments)}return r}(),i.destroy=function(){this.destroyed||(this._trackingTarget=l.destroyMaybe(this._trackingTarget),this.viewModel=l.destroyMaybe(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,P.delete(this))},i.castContainer=function(e){return n.byId(e)},i.render=function(){throw new Error("not implemented")},i.scheduleRender=function(){this.destroyed||(P.delete(this),this._projector.scheduleRender())},i.classes=function(...e){return T.classes.apply(this,e)},i.own=function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)},i.renderNow=function(){P.delete(this),this._projector.renderNow()},i._postInitialize=function(){var t,r=this;if(this.destroyed)return;this.scheduleRender(),null!=(t=this._delegatedEventNames)&&t.length&&this._internalHandles.add(_.init(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize();const o=function(){var t=e._asyncToGenerator((function*(){yield r._loadLocale().catch(u.throwIfNotAbortError),r.scheduleRender()}));return function(){return t.apply(this,arguments)}}();this._internalHandles.add([I.onLocaleChange(o),this.watch("uiStrings",o),_.whenOnce(this,"container",function(){var t=e._asyncToGenerator((function*(e){r.destroyed||r._attach(e)}));return function(e){return t.apply(this,arguments)}}())])},i._attach=function(e){e&&(this._projector.merge(e,this.render),this._attached=!0)},i._detach=function(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)},e._createClass(r,[{key:"container",set:function(e){this._get("container")||this._set("container",e)}},{key:"id",get:function(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+R++},set:function(e){e&&this._set("id",e)}},{key:"renderable",get:function(){return this._resourcesFetch}},{key:"test",get:function(){return{projector:this._projector,handles:this._internalHandles}}}]),r}(p.EsriPromiseMixin(i.EventedAccessor));z[w.WIDGET_SYMBOL]=!0,t.__decorate([y.property()],z.prototype,"_readyForTrueRender",void 0),t.__decorate([y.property({value:null})],z.prototype,"container",null),t.__decorate([g.cast("container")],z.prototype,"castContainer",null),t.__decorate([y.property({aliasOf:"container"})],z.prototype,"domNode",void 0),t.__decorate([y.property()],z.prototype,"iconClass",void 0),t.__decorate([y.property()],z.prototype,"id",null),t.__decorate([y.property()],z.prototype,"label",void 0),t.__decorate([y.property()],z.prototype,"renderable",null),t.__decorate([y.property()],z.prototype,"uiStrings",void 0),t.__decorate([y.property()],z.prototype,"viewModel",void 0),t.__decorate([y.property()],z.prototype,"visible",void 0),t.__decorate([y.property()],z.prototype,"key",void 0),t.__decorate([y.property()],z.prototype,"children",void 0),t.__decorate([y.property()],z.prototype,"afterCreate",void 0),t.__decorate([y.property()],z.prototype,"afterUpdate",void 0),t.__decorate([y.property()],z.prototype,"afterRemoved",void 0),z=t.__decorate([f.subclass(j)],z);return z}));
