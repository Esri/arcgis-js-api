/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/deprecate","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/accessorSupport/tracking","../core/promiseUtils","../core/accessorSupport/tracking/SimpleTrackingTarget","../core/Evented","../intl/locale","../intl/messages","../intl","../core/Promise","../core/Handles","../core/watchUtils","../core/domUtils","./support/widgetUtils","../libs/maquette/projection","../libs/maquette/projector"],(function(e,t,r,o,n,i,s,a,c,l,d,p,h,u,_,g,y,f,m,w,v,k,b,T,N){"use strict";const I=o.getLogger("esri.widgets.Widget");let j=0;const C={widgetIcon:"esri-icon-checkbox-unchecked"},H=N.createProjector();let E=!1,L=function(t){function r(r,o){var n;(n=t.call(this,r,o)||this)._attached=!1,n._internalHandles=new w,n._projector=H,n.domNode=null,n.iconClass=C.widgetIcon,n.label=n.declaredClass.split(".").pop(),n.visible=!0,n._loadLocale=h.debounce((async()=>{if(n._messageBundleProps&&n._messageBundleProps.length){const e=await h.eachAlways(n._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{n[t]=await y.fetchMessageBundle(e)})));for(const t of e)t.error&&I.error("widget-intl:locale-error",n.declaredClass,t.error)}await n.loadLocale()}));const i=["light","dark"],a=b.getThemeName()||"light";i.includes(a)||s.deprecated(I,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const c="esri-widget-uid-"+l.generateUUID(),d=n.render.bind(e._assertThisInitialized(n));let _=!1;n._trackingTarget=new u.SimpleTrackingTarget((()=>n.scheduleRender()));const g=()=>{if(!_||n.destroyed)return null;const e=d();return e.properties?e.properties.key||(e.properties.key=c):e.properties={key:c},e};return n.render=()=>{if(E)return g();let e;n._trackingTarget.clear(),E=!0;try{e=p.runTracked(n._trackingTarget,g)}finally{E=!1}return e},n.addResolvingPromise(n._resourcesFetch=n.beforeFirstRender().then((()=>{_=!0,n._postInitialize()}))),n}e._inheritsLoose(r,t);var o=r.prototype;return o.normalizeCtorArgs=function(e,t){const r={...e};return t&&(r.container=t),r},o.postInitialize=function(){},o.beforeFirstRender=function(){return this._loadLocale().catch(h.throwIfNotAbortError)},o.loadLocale=async function(){},o.destroy=function(){this.destroyed||(this._trackingTarget.destroy(),this._trackingTarget=null,this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)},o.castContainer=function(e){return k.byId(e)},o.render=function(){throw new Error("not implemented")},o.scheduleRender=function(){this.destroyed||this._projector.scheduleRender()},o.classes=function(...e){return b.classes.apply(this,e)},o.own=function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)},o.renderNow=function(){this._projector.renderNow()},o._postInitialize=function(){var e;this.destroyed||(this.scheduleRender(),null!=(e=this._delegatedEventNames)&&e.length&&this._internalHandles.add(v.init(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize(),this._internalHandles.add(g.onLocaleChange((async()=>{await this._loadLocale().catch(h.throwIfNotAbortError),this.scheduleRender()}))),this._internalHandles.add(v.whenOnce(this,"container",(async e=>{this.destroyed||this._attach(e)}))))},o._attach=function(e){e&&(this._projector.merge(e,this.render),this._attached=!0)},o._detach=function(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)},e._createClass(r,[{key:"container",set:function(e){this._get("container")||this._set("container",e)}},{key:"id",get:function(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+j++},set:function(e){e&&this._set("id",e)}},{key:"renderable",get:function(){return this._resourcesFetch}}]),r}(m.EsriPromiseMixin(_.EventedAccessor));return t.__decorate([n.property({value:null})],L.prototype,"container",null),t.__decorate([i.cast("container")],L.prototype,"castContainer",null),t.__decorate([n.property({aliasOf:"container"})],L.prototype,"domNode",void 0),t.__decorate([n.property()],L.prototype,"iconClass",void 0),t.__decorate([n.property()],L.prototype,"id",null),t.__decorate([n.property()],L.prototype,"label",void 0),t.__decorate([n.property()],L.prototype,"renderable",null),t.__decorate([n.property()],L.prototype,"viewModel",void 0),t.__decorate([n.property()],L.prototype,"visible",void 0),L=t.__decorate([a.subclass("esri.widgets.Widget")],L),L}));
