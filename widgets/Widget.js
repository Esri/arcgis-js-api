// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../intl","../core/Collection","../core/domUtils","../core/Evented","../core/Handles","../core/Logger","../core/Promise","../core/promiseUtils","../core/watchUtils","../core/accessorSupport/decorators","../libs/maquette/index","./support/widget"],(function(e,t,r,n,o,i,s,a,d,c,l,u,p,h,_){"use strict";var f=d.getLogger("esri.widgets.Widget"),y=0,v="esri-icon-checkbox-unchecked",g=h.createProjector();return function(e){function t(t,o){var i=e.call(this,t,o)||this;i._attached=!1,i._internalHandles=new a,i._projector=g,i.domNode=null,i.iconClass=v,i.label=i.declaredClass.split(".").pop(),i.visible=!0,i._loadLocale=l.debounce((function(){return r.__awaiter(i,void 0,void 0,(function(){var e=this;return r.__generator(this,(function(t){switch(t.label){case 0:return this._messageBundleProps&&this._messageBundleProps.length?[4,l.eachAlways(this._messageBundleProps.map((function(t){var o=t.bundlePath,i=t.propertyName;return r.__awaiter(e,void 0,void 0,(function(){var e,t;return r.__generator(this,(function(r){switch(r.label){case 0:return e=this,t=i,[4,n.loadMessageBundle(o)];case 1:return e[t]=r.sent(),[2]}}))}))}))).then((function(t){for(var r=0,n=t;r<n.length;r++){var o=n[r];o.error&&f.error("widget-intl:locale-error",e.declaredClass,o.error)}}))]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this.loadLocale()];case 3:return t.sent(),[2]}}))}))}));var s="esri-widget-uid-"+Date.now().toString(16),d=i.render.bind(i),c=!1;return i.render=function(){if(!c||i.destroyed)return null;var e=d();return e.properties?e.properties.key||(e.properties.key=s):e.properties={key:s},e},i.addResolvingPromise(i._resourcesFetch=i.beforeFirstRender().then((function(){c=!0,i._postInitialize()}))),i}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){var n=r.__assign({},e);return t&&(n.container=t),n},t.prototype.postInitialize=function(){},t.prototype.beforeFirstRender=function(){return this._loadLocale()},t.prototype.loadLocale=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2]}))}))},t.prototype.destroy=function(){this.destroyed||(this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=function(){return null},this._projector=null)},Object.defineProperty(t.prototype,"container",{set:function(e){this._get("container")||this._set("container",e)},enumerable:!1,configurable:!0}),t.prototype.castContainer=function(e){return i.byId(e)},Object.defineProperty(t.prototype,"id",{get:function(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+y++},set:function(e){e&&this._set("id",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderable",{get:function(){return this._resourcesFetch},enumerable:!1,configurable:!0}),t.prototype.render=function(){throw new Error("not implemented")},t.prototype.scheduleRender=function(){this.destroyed||this._projector.scheduleRender()},t.prototype.classes=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _.classes.apply(this,e)},t.prototype.own=function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)},t.prototype.renderNow=function(){this._projector.renderNow()},t.prototype._postInitialize=function(){var e,t,i=this;this.destroyed||((null===(e=this._renderableProps)||void 0===e?void 0:e.length)&&this._internalHandles.add(this._renderableProps.map((function(e){return u.init(i,e,(function(t,r){var n=this;if(o.isCollection(r)&&this._internalHandles.remove(this.declaredClass+":"+e+"-collection-change-event-listener"),o.isCollection(t)){var i=t.on("change",(function(){return n.scheduleRender()}));this._internalHandles.add(i,this.declaredClass+":"+e+"-collection-change-event-listener")}this.scheduleRender()}))}))),(null===(t=this._delegatedEventNames)||void 0===t?void 0:t.length)&&this._internalHandles.add(u.init(this,"viewModel",(function(e,t){t&&i._internalHandles.remove("delegated-events"),e&&i._internalHandles.add(i._delegatedEventNames.map((function(t){return e.on(t,(function(e){i.emit(t,e)}))})),"delegated-events")}))),this.postInitialize(),this._internalHandles.add(n.onLocaleChange((function(){return r.__awaiter(i,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,this._loadLocale()];case 1:return e.sent(),this.scheduleRender(),[2]}}))}))}))),this._internalHandles.add(u.whenOnce(this,"container",(function(e){return r.__awaiter(i,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.destroyed?[2]:(this._attach(e),[2])}))}))}))))},t.prototype._attach=function(e){e&&(this._projector.merge(e,this.render),this._attached=!0)},t.prototype._detach=function(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)},r.__decorate([p.property({value:null})],t.prototype,"container",null),r.__decorate([p.cast("container")],t.prototype,"castContainer",null),r.__decorate([p.property({aliasOf:"container"})],t.prototype,"domNode",void 0),r.__decorate([p.property()],t.prototype,"iconClass",void 0),r.__decorate([p.property({dependsOn:["container"]})],t.prototype,"id",null),r.__decorate([p.property()],t.prototype,"label",void 0),r.__decorate([p.property()],t.prototype,"renderable",null),r.__decorate([p.property()],t.prototype,"viewModel",void 0),r.__decorate([p.property()],t.prototype,"visible",void 0),t=r.__decorate([p.subclass("esri.widgets.Widget")],t)}(c.EsriPromiseMixin(s.EventedAccessor))}));