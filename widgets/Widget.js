/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/promiseUtils","../core/Evented","../core/Collection","../intl/locale","../intl/messages","../intl","../core/Promise","../core/Handles","../core/watchUtils","../core/domUtils","./support/widgetUtils","../libs/maquette/projection","../libs/maquette/projector"],(function(e,t,r,o,n,s,i,a,l,c,d,h,p,u,_,y,g,f,m,v,w,b,C){"use strict";const H=o.getLogger("esri.widgets.Widget");let P=0;const k="esri-icon-checkbox-unchecked",j=C.createProjector();let E=function(t){function r(r,o){var n;(n=t.call(this,r,o)||this)._attached=!1,n._internalHandles=new f,n._projector=j,n.domNode=null,n.iconClass=k,n.label=n.declaredClass.split(".").pop(),n.visible=!0,n._loadLocale=d.debounce((async()=>{n._messageBundleProps&&n._messageBundleProps.length&&await d.eachAlways(n._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{n[t]=await _.fetchMessageBundle(e)}))).then((e=>{for(const t of e)t.error&&H.error("widget-intl:locale-error",n.declaredClass,t.error)})),await n.loadLocale()}));const s="esri-widget-uid-"+Date.now().toString(16),i=n.render.bind(e._assertThisInitialized(n));let a=!1;return n.render=()=>{if(!a||n.destroyed)return null;const e=i();return e.properties?e.properties.key||(e.properties.key=s):e.properties={key:s},e},n.addResolvingPromise(n._resourcesFetch=n.beforeFirstRender().then((()=>{a=!0,n._postInitialize()}))),n}e._inheritsLoose(r,t);var o=r.prototype;return o.normalizeCtorArgs=function(e,t){const r={...e};return t&&(r.container=t),r},o.postInitialize=function(){},o.beforeFirstRender=function(){return this._loadLocale().catch((e=>{if(!d.isAbortError(e))throw e}))},o.loadLocale=async function(){},o.destroy=function(){this.destroyed||(this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)},o.castContainer=function(e){return v.byId(e)},o.render=function(){throw new Error("not implemented")},o.scheduleRender=function(){this.destroyed||this._projector.scheduleRender()},o.classes=function(...e){return w.classes.apply(this,e)},o.own=function(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)},o.renderNow=function(){this._projector.renderNow()},o._postInitialize=function(){var e,t;this.destroyed||(null!=(e=this._renderableProps)&&e.length&&this._internalHandles.add(this._renderableProps.map((e=>m.init(this,e,(function(t,r){if(p.isCollection(r)&&this._internalHandles.remove(`${this.declaredClass}:${e}-collection-change-event-listener`),p.isCollection(t)){const r=t.on("change",(()=>this.scheduleRender()));this._internalHandles.add(r,`${this.declaredClass}:${e}-collection-change-event-listener`)}this.scheduleRender()}))))),null!=(t=this._delegatedEventNames)&&t.length&&this._internalHandles.add(m.init(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize(),this._internalHandles.add(u.onLocaleChange((async()=>{await this._loadLocale().catch((e=>{if(!d.isAbortError(e))throw e})),this.scheduleRender()}))),this._internalHandles.add(m.whenOnce(this,"container",(async e=>{this.destroyed||this._attach(e)}))))},o._attach=function(e){e&&(this._projector.merge(e,this.render),this._attached=!0)},o._detach=function(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)},e._createClass(r,[{key:"container",set:function(e){this._get("container")||this._set("container",e)}},{key:"id",get:function(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+P++},set:function(e){e&&this._set("id",e)}},{key:"renderable",get:function(){return this._resourcesFetch}}]),r}(g.EsriPromiseMixin(h.EventedAccessor));return t.__decorate([n.property({value:null})],E.prototype,"container",null),t.__decorate([s.cast("container")],E.prototype,"castContainer",null),t.__decorate([n.property({aliasOf:"container"})],E.prototype,"domNode",void 0),t.__decorate([n.property()],E.prototype,"iconClass",void 0),t.__decorate([n.property({dependsOn:["container"]})],E.prototype,"id",null),t.__decorate([n.property()],E.prototype,"label",void 0),t.__decorate([n.property()],E.prototype,"renderable",null),t.__decorate([n.property()],E.prototype,"viewModel",void 0),t.__decorate([n.property()],E.prototype,"visible",void 0),E=t.__decorate([i.subclass("esri.widgets.Widget")],E),E}));
