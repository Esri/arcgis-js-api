/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/maybe","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/aliasOf","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../support/widgetUtils","../../support/decorators/renderable","../../../chunks/index","../../Widget","../BuildingPhase"],(function(e,s,t,r,i,o,a,n,h,l,u,c,d,p,_,v,w){"use strict";const f={nextPhase:"nextPhase",previousPhase:"previousPhase",currentPhase:"{{value}}"},P="esri-building-phase-picker",b={container:`${P}`,phasesContainer:`${P}__phases-container`,phase:`${P}__phase`,phaseActive:`${P}__phase--active`,phaseCurrent:`${P}__phase--current`,divider:`${P}__divider`,dividerActive:`${P}__divider--active`,arrowLeft:`${P}__arrow-left`,arrowRight:`${P}__arrow-right`};let g=function(s){function t(e,t){var r;return(r=s.call(this,e,t)||this)._defaultViewModel=new w,r.viewModel=r._defaultViewModel,r.messages=f,r._phasesContainer=null,r._shouldScrollCurrentPhaseIntoView=!0,r._shouldFocusCurrentPhase=!1,r}e._inheritsLoose(t,s);var i=t.prototype;return i.initialize=function(){this.own(this.watch(["_currentPhase","_container"],(()=>{this._shouldScrollCurrentPhaseIntoView=!0})))},i.destroy=function(){this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()},i.render=function(){if(this._phases.length<2)return _.jsx("div",null);const e=d.isRTL(),s=this.messages.previousPhase,t=this.messages.nextPhase;return _.jsx("div",{bind:this,key:this,class:this.classes("esri-widget",b.container),onkeydown:this._onKeyDown},_.jsx("button",{bind:this,class:e?b.arrowRight:b.arrowLeft,disabled:!this.viewModel.hasPrevious,onclick:this._onArrowLeftClick,"aria-label":s,title:s,type:"button"}),_.jsx("div",{bind:this,class:b.phasesContainer,afterCreate:d.storeNode,"data-node-ref":"_phasesContainer",afterUpdate:this._onPhasesContainerAfterUpdate},this._renderPhaseButtons()),_.jsx("button",{bind:this,class:e?b.arrowLeft:b.arrowRight,disabled:!this.viewModel.hasNext,onclick:this._onArrowRightClick,"aria-label":t,title:t,type:"button"}))},i._renderPhaseButtons=function(){const e=this._phases,s=[];for(let t=0;t<e.length;++t){const i=e[t],o={phase:i,active:!!r.isSome(this._currentPhase)&&i<=this._currentPhase,current:!!r.isSome(this._currentPhase)&&i===this._currentPhase};t>0&&s.push(this._renderDivider(o)),s.push(this._renderPhaseButton(o))}return s},i._renderPhaseButton=function({phase:e,active:s,current:t}){const i=r.unwrap(this.viewModel.getValueLabel(e));return _.jsx("button",{key:`phase-${e}`,class:this.classes(b.phase,{[b.phaseActive]:s,[b.phaseCurrent]:t}),"aria-label":i,title:i,onclick:()=>this.viewModel.select(e),type:"button"},e)},i._renderDivider=function({phase:e,active:s}){return _.jsx("div",{key:`phase-divider-${e}`,class:this.classes(b.divider,{[b.dividerActive]:s})})},i._onKeyDown=function(e){switch(e.key){case"ArrowDown":case"ArrowLeft":e.stopPropagation(),e.preventDefault(),this.viewModel.previous(),this._shouldFocusCurrentPhase=!0;break;case"ArrowUp":case"ArrowRight":e.stopPropagation(),e.preventDefault(),this.viewModel.next(),this._shouldFocusCurrentPhase=!0}},i._onArrowLeftClick=function(){this.viewModel.previous()},i._onArrowRightClick=function(){this.viewModel.next()},i._onPhasesContainerAfterUpdate=function(){if(r.isNone(this._phasesContainer))return;const e=this._phasesContainer.querySelector(`.${b.phaseCurrent}`);if(!r.isNone(e)){if(this._shouldScrollCurrentPhaseIntoView){const s=this._phasesContainer.offsetWidth,t=e.offsetLeft,r=e.offsetWidth;this._phasesContainer.scrollLeft=-s/2+t-r/2,this._shouldScrollCurrentPhaseIntoView=!1}this._shouldFocusCurrentPhase&&(e.focus(),this._shouldFocusCurrentPhase=!1)}},e._createClass(t,[{key:"_currentPhase",get:function(){return this.viewModel.enabled?this.viewModel.value:null}}]),t}(v);return s.__decorate([a.property({type:w}),p.renderable(["viewModel.layers.length","viewModel.hasNext","viewModel.hasPrevious"])],g.prototype,"viewModel",void 0),s.__decorate([a.property(),p.renderable()],g.prototype,"messages",void 0),s.__decorate([n.aliasOf("viewModel.allowedValues"),p.renderable()],g.prototype,"_phases",void 0),s.__decorate([a.property({readOnly:!0,dependsOn:["viewModel.enabled","viewModel.value"]}),p.renderable()],g.prototype,"_currentPhase",null),s.__decorate([a.property()],g.prototype,"_phasesContainer",void 0),g=s.__decorate([h.subclass("esri.widgets.BuildingExplorer.BuildingPhasePicker.BuildingPhasePicker")],g),g}));
