/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/arrayUtils","../../core/promiseUtils","../../core/Accessor","../../core/Collection","../../core/collectionUtils","../../core/Handles","./support/layerUtils","./support/validation"],(function(e,t,l,n,s,a,o,r,i,u,d,h,c,p,y,_,f,g,v){"use strict";let b=function(t){function l(e){var l;return(l=t.call(this,e)||this).state="disabled",l._handles=new f,l._domainInfo=v.getDomainInfo([]),l._loadLayers=g.createLoadLayersFunction(),l.layers=new y,l}e._inheritsLoose(l,t);var s=l.prototype;return s.initialize=function(){this._handles.add(this.layers.on("change",(()=>this._onLayersChange()))),this._onLayersChange()},s.destroy=function(){this._set("state","disabled"),this._handles.destroy()},s.select=function(e){const t=v.getValidNumber(e,this);n.isSome(t)&&(this.enabled=!0,this.value=e)},s.clear=function(){this.enabled=!1},s.next=function(){if(0!==this.allowedValues.length)return this.enabled?void(this.hasNext&&(this.value=this.allowedValues[this._valueIndex+1])):(this.enabled=!0,void(this.value=this.allowedValues[0]))},s.previous=function(){if(0!==this.allowedValues.length)return this.enabled?void(this.hasPrevious&&(this.value=this.allowedValues[this._valueIndex-1])):(this.enabled=!0,void(this.value=this.allowedValues[this.allowedValues.length-1]))},s.getValueLabel=function(e){var t;return 0===this.layers.length?null:null!=(t=this._domainInfo.fieldValueMap.get(e))?t:null},s._onLayersChange=async function(){if(this._set("state","loading"),this._domainInfo=v.getDomainInfo([]),0!==this.layers.length)try{await this._loadLayers(this.layers),this._setup(),this._set("state","ready")}catch(e){c.isAbortError(e)||this._set("state","failed")}},e._createClass(l,[{key:"enabled",get:function(){return this.allowedValues.length>0&&this._get("enabled")},set:function(e){e!==this.enabled&&this.allowedValues.length>0&&this._set("enabled",e)}},{key:"value",set:function(e){if(e===this.value)return;const t=v.getValidNumber(e,this);n.isNone(t)||this._set("value",t)}},{key:"min",get:function(){return v.getMin(this.allowedValues)}},{key:"max",get:function(){return v.getMax(this.allowedValues)}},{key:"allowedValues",get:function(){return this._domainInfo.allowedValues}},{key:"hasNext",get:function(){if(!this.enabled)return!0;const e=this._valueIndex;return e>=0&&e<this.allowedValues.length-1}},{key:"hasPrevious",get:function(){return!this.enabled||this._valueIndex>0}},{key:"layers",set:function(e){const t=this._get("layers");this._set("layers",_.referenceSetter(e,t))}},{key:"filterExpressions",get:function(){return{solid:null,xRay:null}}},{key:"_valueIndex",get:function(){return h.binaryIndexOf(this.allowedValues,this.value)}}]),l}(p);return t.__decorate([o.property({value:!1,nonNullable:!0,dependsOn:["allowedValues"]})],b.prototype,"enabled",null),t.__decorate([o.property({value:0,nonNullable:!0})],b.prototype,"value",null),t.__decorate([o.property({readOnly:!0,dependsOn:["allowedValues"]})],b.prototype,"min",null),t.__decorate([o.property({readOnly:!0,dependsOn:["allowedValues"]})],b.prototype,"max",null),t.__decorate([o.property({readOnly:!0,dependsOn:["_domainInfo"]})],b.prototype,"allowedValues",null),t.__decorate([o.property({readOnly:!0,dependsOn:["allowedValues","_valueIndex","enabled"]})],b.prototype,"hasNext",null),t.__decorate([o.property({readOnly:!0,dependsOn:["_valueIndex","enabled"]})],b.prototype,"hasPrevious",null),t.__decorate([o.property({type:y,nonNullable:!0})],b.prototype,"layers",null),t.__decorate([o.property({nonNullable:!0})],b.prototype,"state",void 0),t.__decorate([o.property({readOnly:!0,dependsOn:["value","allowedValues"]})],b.prototype,"_valueIndex",null),t.__decorate([o.property()],b.prototype,"_domainInfo",void 0),b=t.__decorate([r.subclass("esri.widgets.BuildingExplorer.BuildingNumericFilterViewModel")],b),b}));
