/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/maybe","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/Accessor","../../../core/Collection","../../../core/Handles","../../../core/watchUtils"],(function(e,t,r,i,o,l,s,n,a,d,p,c,y,h,u,_){"use strict";function f(e,t){let r=null;for(const i of e.items){const e=t(i);if(o.isSome(r)&&r!==e)return null;r=e}return r}e.LayerTreeNode=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).id="root",t.parent=null,t.children=new h,t.layers=new h,t.level=0,t.collapsed=!0,t._handles=new u,t._childIds=new Set,t._layerUniqueIds=new Set,t}t._inheritsLoose(r,e);var i=r.prototype;return i.initialize=function(){this._handles.add([this.layers.on("before-add",(e=>{this._layerUniqueIds.has(e.item.uid)?e.preventDefault():this._layerUniqueIds.add(e.item.uid)})),this.layers.on("after-add",(({item:e})=>{this._handles.add([_.init(e,"visible",(()=>this.notifyChange("visible"))),_.init(e,"title",(()=>this.notifyChange("title")))],e.uid)})),this.layers.on("before-remove",(({item:e})=>{this._handles.remove(e.uid),this.notifyChange("title"),this.notifyChange("visible")})),this.children.on("before-add",(e=>{this._childIds.has(e.item.id)?e.preventDefault():(e.item._set("parent",this),this._childIds.add(e.item.id))}))])},i.destroy=function(){this._handles.destroy(),this.children.forEach((e=>e.destroy()))},i.toggleVisibility=function(e){const t=void 0===e?!this.visible:e;this.layers.forEach((e=>{e.visible=t})),t&&o.isSome(this.parent)&&this.parent.toggleVisibility(!0)},i.toggleCollapsed=function(e){this.collapsed=void 0===e?!this.collapsed:e},i.expand=function(){this.collapsed=!1},i.expandAll=function(){this.expand(),this.children.forEach((e=>e.expandAll()))},i.collapse=function(){this.collapsed=!0},i.collapseAll=function(){this.collapse(),this.children.forEach((e=>e.collapseAll()))},i.toggleAllSiblingsVisibility=function(e){const t=void 0===e?!this.visible:e;this.toggleVisibility(t),o.isSome(this.parent)&&(this.parent.toggleVisibility(t),this.parent.children.forEach((e=>e.toggleVisibility(t))))},t._createClass(r,[{key:"hasChildren",get:function(){return this.children.length>0}},{key:"isRoot",get:function(){return 0===this.level}},{key:"isLeaf",get:function(){return!this.hasChildren}},{key:"isDiscipline",get:function(){return 1===this.level}},{key:"visible",get:function(){return f(this.layers,(e=>e.visible))}},{key:"title",get:function(){return f(this.layers,(e=>e.title))||this.layers.items.map((e=>e.title)).join(", ")||null}}]),r}(y),r.__decorate([n.property({nonNullable:!0})],e.LayerTreeNode.prototype,"id",void 0),r.__decorate([n.property()],e.LayerTreeNode.prototype,"parent",void 0),r.__decorate([n.property({nonNullable:!0,readOnly:!0})],e.LayerTreeNode.prototype,"children",void 0),r.__decorate([n.property({nonNullable:!0,readOnly:!0})],e.LayerTreeNode.prototype,"layers",void 0),r.__decorate([n.property({nonNullable:!0})],e.LayerTreeNode.prototype,"level",void 0),r.__decorate([n.property({nonNullable:!0})],e.LayerTreeNode.prototype,"collapsed",void 0),r.__decorate([n.property({readOnly:!0})],e.LayerTreeNode.prototype,"hasChildren",null),r.__decorate([n.property({readOnly:!0})],e.LayerTreeNode.prototype,"isRoot",null),r.__decorate([n.property({readOnly:!0})],e.LayerTreeNode.prototype,"isLeaf",null),r.__decorate([n.property({readOnly:!0})],e.LayerTreeNode.prototype,"isDiscipline",null),r.__decorate([n.property({readOnly:!0})],e.LayerTreeNode.prototype,"visible",null),r.__decorate([n.property({readOnly:!0})],e.LayerTreeNode.prototype,"title",null),e.LayerTreeNode=r.__decorate([a.subclass("esri.widgets.BuildingExplorer.support.LayerTreeNode")],e.LayerTreeNode),Object.defineProperty(e,"__esModule",{value:!0})}));
