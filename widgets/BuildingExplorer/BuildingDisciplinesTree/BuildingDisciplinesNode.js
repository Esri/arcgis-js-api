// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../../../core/watchUtils","../../../core/accessorSupport/decorators","../../Widget","../support/LayerTreeNode","../../support/widget"],(function(e,i,t,o,s,l,n,r){"use strict";var d={expand:"expand",collapse:"collapse",hideSublayer:"hideSublayer",showSublayer:"showSublayer"},a="esri-building-disciplines-tree-node",c={base:""+a,root:a+"--root",leaf:a+"--leaf",label:a+"__label",checkbox:a+"__checkbox",checkboxChecked:a+"__checkbox--checked esri-icon-check-mark",checkboxIndeterminate:a+"__checkbox--indeterminate esri-icon-minus",collapseToggle:a+"__collapse-toggle esri-icon-right",collapseToggleCollapsed:a+"__collapse-toggle--collapsed",children:a+"__children",level:function(e){return a+"--level-"+e}};return function(e){function i(i){var t=e.call(this,i)||this;return t.messages=d,t.toggleSiblingsVisibility=!1,t._childWidgets=[],t._updateChildWidgets=function(){t._destroyChildWidgets(),t._childWidgets=t.node.children.toArray().reverse().map((function(e){return new l({node:e,messages:t.messages,toggleSiblingsVisibility:t.toggleSiblingsVisibility})}))},t}var l;return t.__extends(i,e),l=i,i.prototype.initialize=function(){this.own(o.on(this,"node.children","after-changes",this._updateChildWidgets,this._updateChildWidgets,this._updateChildWidgets),this.watch(["messages","toggleSiblingsVisibility"],this._updateChildWidgets))},i.prototype.destroy=function(){this._destroyChildWidgets()},i.prototype.render=function(){var e,i=this.node,t=i.isRoot,o=i.isLeaf;return i.isDiscipline&&o?[]:r.tsx("div",{key:i.id,class:this.classes(c.base,c.level(i.level),(e={},e[c.root]=t,e[c.leaf]=o,e)),bind:this,onkeydown:this._onKeydown,tabIndex:o?null:0,role:"treeitem","aria-expanded":i.collapsed?"false":"true"},r.tsx("label",{bind:this,class:c.label,onclick:this._onCheckboxToggle},this._renderCollapseToggle(),this._renderCheckbox(),r.tsx("span",null,i.title)),this._renderChildren(i))},i.prototype._renderCheckbox=function(){var e,i,t,o=this.node.visible,s=!0===o,l=null===o,n=s?null===(i=this.messages)||void 0===i?void 0:i.hideSublayer:null===(t=this.messages)||void 0===t?void 0:t.showSublayer;return r.tsx("button",{bind:this,class:this.classes(c.checkbox,(e={},e[c.checkboxChecked]=s,e[c.checkboxIndeterminate]=l,e)),onclick:this._onCheckboxToggle,role:"checkbox","aria-checked":s?"true":"false","aria-label":n,title:n,type:"button"})},i.prototype._renderCollapseToggle=function(){var e,i,t;if(!this.node.hasChildren)return[];var o=this.node.collapsed,s=o?null===(i=this.messages)||void 0===i?void 0:i.expand:null===(t=this.messages)||void 0===t?void 0:t.collapse;return r.tsx("div",{bind:this,class:this.classes(c.collapseToggle,(e={},e[c.collapseToggleCollapsed]=o,e)),onclick:this._onCollapseToggle,"aria-label":s,title:s})},i.prototype._renderChildren=function(e){return!e.hasChildren||e.collapsed?[]:r.tsx("div",{class:c.children},this._childWidgets.map((function(e){return e.render()})))},i.prototype._onKeydown=function(e){switch(e.key){case"Space":case"Enter":if(!e.target.classList.contains(c.base))return;e.stopPropagation(),this.node.toggleVisibility();break;case"ArrowLeft":e.stopPropagation(),this.node.toggleCollapsed(!r.isRTL());break;case"ArrowRight":e.stopPropagation(),this.node.toggleCollapsed(!!r.isRTL())}},i.prototype._onCheckboxToggle=function(e){e.preventDefault(),e.stopPropagation(),(e.metaKey||e.ctrlKey)&&this.toggleSiblingsVisibility?this.node.toggleAllSiblingsVisibility():this.node.toggleVisibility()},i.prototype._onCollapseToggle=function(e){e.preventDefault(),e.stopPropagation(),this.node.toggleCollapsed()},i.prototype._destroyChildWidgets=function(){this._childWidgets.forEach((function(e){return e.destroy()})),this._childWidgets=[]},t.__decorate([s.property({type:n.LayerTreeNode}),r.renderable(["node.hasChildren","node.isDiscipline","node.level","node.title","node.visible"])],i.prototype,"node",void 0),t.__decorate([s.property(),r.renderable()],i.prototype,"messages",void 0),t.__decorate([s.property({nonNullable:!0})],i.prototype,"toggleSiblingsVisibility",void 0),t.__decorate([s.property(),r.renderable()],i.prototype,"_childWidgets",void 0),i=l=t.__decorate([s.subclass("esri.widgets.BuildingExplorer.BuildingDisciplinesTree.BuildingDisciplinesNode")],i)}(l)}));