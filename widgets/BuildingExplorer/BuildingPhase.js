/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","./support/buildingLayerUtils","./support/validation","./BuildingNumericFilterViewModel","./support/filterUtils"],(function(e,s,t,l,r,o,i,a,n,d,u,c,p,h,m){"use strict";let _=function(s){function t(){var e;return(e=s.apply(this,arguments)||this)._createdPhaseFieldName=null,e._demolishedPhaseFieldName=null,e._parseValueFromFilter=s=>{const t=e._createdPhaseFieldName,l=new RegExp(`${t}\\s*<=\\s*(\\d+)\\s*OR\\s*${t}\\s*IS\\s*NULL`,"gi"),r=e._demolishedPhaseFieldName,o=new RegExp(`${r}\\s*>\\s*(\\d+)\\s*OR\\s*${r}\\s*IS\\s*NULL`,"gi");for(const{filterExpression:e}of s.filterBlocks.items){var i;const s=null!=(i=l.exec(e))?i:o.exec(e);if(s)return parseInt(s[1],10)}return null},e}return e._inheritsLoose(t,s),t.prototype._setup=function(){const e=[];this.layers.forEach((s=>{const t=c.findFieldInfoByModelName(s,"createdphase");l.isSome(t)&&(this._createdPhaseFieldName=t.fieldName,e.push(t));const r=c.findFieldInfoByModelName(s,"demolishedphase");l.isSome(r)&&(this._demolishedPhaseFieldName=r.fieldName,e.push(r))})),this._domainInfo=p.getDomainInfo(e);const s=m.getValueFromFilters(this.layers,this._parseValueFromFilter);this.allowedValues.length>0?this.select(l.isSome(s)?s:this._lastValue):this.clear()},e._createClass(t,[{key:"filterExpressions",get:function(){if(!this.enabled)return{solid:null,xRay:null};const e=[],s=this._createdPhaseFieldName;s&&e.push(`(${s} <= ${this.value} OR ${s} IS NULL)`);const t=this._demolishedPhaseFieldName;t&&e.push(`(${t} > ${this.value} OR ${t} IS NULL)`);const l=e.join(" AND ");return{solid:l,xRay:l}}},{key:"_lastValue",get:function(){const e=this.allowedValues;return e.length>0?e[e.length-1]:0}}]),t}(h);return s.__decorate([i.property({readOnly:!0,dependsOn:["enabled","value","_createdPhaseFieldName","_demolishedPhaseFieldName"]})],_.prototype,"filterExpressions",null),s.__decorate([i.property()],_.prototype,"_createdPhaseFieldName",void 0),s.__decorate([i.property()],_.prototype,"_demolishedPhaseFieldName",void 0),s.__decorate([i.property({readOnly:!0,dependsOn:["allowedValues.length"]})],_.prototype,"_lastValue",null),_=s.__decorate([a.subclass("esri.widgets.BuildingExplorer.BuildingPhase")],_),_}));
