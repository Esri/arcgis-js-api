/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","./ShadowAccumulation/components/DiscreteConfigurator","../intl","../core/Handles","../core/maybe","../core/timeUtils","../core/accessorSupport/decorators/aliasOf","../core/has","../core/accessorSupport/ensureType","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../core/accessorSupport/trackingUtils","../intl/substitute","./Slider","./Widget","./ShadowAccumulation/css","./ShadowAccumulation/ShadowAccumulationViewModel","./ShadowAccumulation/ShadowAccumulationVisibleElements","./ShadowAccumulation/components/DurationConfigurator","./ShadowAccumulation/components/ShadowTooltip","./ShadowAccumulation/components/ThresholdConfigurator","./ShadowAccumulation/components/TimezonePicker","./support/DatePicker","./support/Heading","./support/timeWidgetUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","../intl/date"],(function(e,i,t,o,s,n,a,l,r,d,c,u,p,m,h,v,S,g,_,y,w,b,f,C,M,T,k,x,z,D,O){"use strict";const V={hour:"2-digit",minute:"2-digit",timeZone:"UTC"},L={labelFormatFunction:k.formatSliderLabel,min:0,max:1439,steps:5,rangeLabelInputsEnabled:!1,visibleElements:{labels:!1,rangeLabels:!1},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:(e,i,t)=>{i.classList.add(g.CSS.timeRangePrimaryTick),t.classList.add(g.CSS.timeRangePrimaryTickLabel);const o=t.innerText;-1!==o.indexOf(" ")&&(t.innerHTML=o.replace(/(.*) (.*)/,`$1<br><div class="${g.CSS.timeRangeAMPMLabel}">$2</div>`))}},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:(e,i)=>{i.classList.add(g.CSS.timeRangeSecondaryTick)}}]};let A=function(i){function o(e,t){var o;return(o=i.call(this,e,t)||this).viewModel=null,o.view=null,o.headingLevel=4,o.iconClass=g.CSS.widgetIcon,o.label=void 0,o.visibleElements=new y,o._handles=new s,o._defaultViewModel=null,o._timeSlider=new v({...L,container:document.createElement("div")}),o._tooltip=null,o._onTimezoneChange=e=>{o.viewModel.utcOffset=e},o._onDateChange=e=>{o.viewModel.date=e},null!=e&&e.viewModel||(o._defaultViewModel=new _({view:null==e?void 0:e.view}),o.viewModel=o._defaultViewModel),o}e._inheritsLoose(o,i);var l=o.prototype;return l.initialize=function(){this._handles.add([m.reactionInit((()=>({viewModel:this.viewModel,slider:this._timeSlider})),(e=>this._connectTimeSlider(e))),m.reactionInit((()=>({container:n.applySome(this.view,(e=>e.surface)),viewModel:this.viewModel,tooltipVisible:this.visibleElements.tooltip})),(({container:e,viewModel:i,tooltipVisible:t})=>{this._tooltip=n.destroyMaybe(this._tooltip),!n.isNone(e)&&t&&(this._tooltip=new b.ShadowTooltip({viewModel:i,container:e}))})),m.reactionInit((()=>({viewModel:this.viewModel,visible:this.visible})),(({viewModel:e,visible:i})=>e.setRunning(i)))])},l.destroy=function(){this._handles=n.destroyMaybe(this._handles),this._timeSlider=n.destroyMaybe(this._timeSlider),n.isSome(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()},l.render=function(){const{visibleElements:e,viewModel:i}=this,t="disabled"===i.state;return D.tsx("div",{key:this,class:this.classes(g.CSS.base,g.CSS.esriWidget,{[g.CSS.esriWidgetDisabled]:t})},this._renderTimeRangeSection(),e.visualizationOptions&&this._renderVisualizationOptionsSection())},l._connectTimeSlider=function({viewModel:e,slider:i}){if(this._handles.remove("slider"),n.isNone(i))return;const t=e=>a.convertTime(e,"milliseconds","minutes"),o=e=>a.convertTime(e,"minutes","milliseconds"),s=({index:i,value:t})=>{0===i?e.startTimeOfDay=o(t):e.endTimeOfDay=o(t)};this._handles.add([m.reactionInit((()=>[e.startTimeOfDay,e.endTimeOfDay]),(e=>{i.values=e.map(t)})),i.on("thumb-change",s),i.on("thumb-drag",s),i.on("segment-drag",(()=>{[e.startTimeOfDay,e.endTimeOfDay]=i.values.map(o)}))],"slider")},l._renderTimeRangeSection=function(){const{visibleElements:e}=this;return e.timeRangeSlider||e.datePicker?D.tsx("section",{key:"time-range",class:g.CSS.timeRange},D.tsx(T.Heading,{level:this.headingLevel},this.messages.timeLabel),e.timeRangeSlider&&this._renderTimeRange(),e.datePicker&&this._renderDatePicker()):null},l._renderTimeRange=function(){const{messages:e,viewModel:i,visibleElements:t}=this,{startTimeOfDay:o,endTimeOfDay:s}=i,[n,a]=[o,s].map((e=>O.formatDate(new Date(e),V)));return[D.tsx("div",{key:"time-range-indicator",class:g.CSS.timeRangeIndicator},h.substitute(e.timeRange,{start:n,end:a}),t.timezone&&D.tsx(C.TimezonePicker,{value:i.utcOffset,onChange:this._onTimezoneChange})),D.tsx("div",{key:"time-slider-container",bind:this,afterCreate:this._timeSliderContainerAfterCreate,afterRemoved:this._timeSliderContainerAfterRemoved})]},l._timeSliderContainerAfterCreate=function(e){n.applySome(this._timeSlider,(i=>{e.appendChild(i.container)}))},l._timeSliderContainerAfterRemoved=function(e){n.applySome(this._timeSlider,(i=>{e.removeChild(i.container)}))},l._renderDatePicker=function(){return D.tsx("div",{key:"date-picker",class:g.CSS.datePickerContainer},D.tsx(M,{value:this.viewModel.date,onChange:this._onDateChange}))},l._renderVisualizationOptionsSection=function(){const{headingLevel:e,messages:i,viewModel:o,visibleElements:s}=this,n=s.colorPicker,a=e=>this.classes(o.visualizationType===e?null:g.CSS.visualizationConfigHidden);return D.tsx("section",{key:"visualization",class:g.CSS.visualization},D.tsx(T.Heading,{level:e},i.visualizationLabel),this._renderVisualizationSelect(),D.tsx("div",{key:"threshold-configurator",class:a("threshold")},D.tsx(f.ThresholdConfigurator,{options:o.thresholdOptions,colorPickerVisible:n})),D.tsx("div",{key:"duration-configurator",class:a("duration")},D.tsx(w.DurationConfigurator,{options:o.durationOptions,colorPickerVisible:n})),D.tsx("div",{key:"discrete-configurator",class:a("discrete")},D.tsx(t.DiscreteConfigurator,{options:o.discreteOptions,colorPickerVisible:n})))},l._renderVisualizationSelect=function(){const e=this.messages,i=this.viewModel.visualizationType;return D.tsx("calcite-select",{class:g.CSS.visualizationSelect,key:"visualization-select",label:e.visualizationLabel,bind:this,onCalciteSelectChange:this._onVisualizationTypeChange},[{type:"threshold",label:e.threshold.label},{type:"duration",label:e.duration.label},{type:"discrete",label:e.discrete.label}].map((({type:e,label:t})=>D.tsx("calcite-option",{value:e,selected:e===i},t))))},l._onVisualizationTypeChange=function(e){var i;const t=null==(i=e.target.selectedOption)?void 0:i.value;this.viewModel.visualizationType=null!=t?t:"threshold"},e._createClass(o,[{key:"testData",get:function(){return{tooltip:this._tooltip}}}]),o}(S);return i.__decorate([u.property()],A.prototype,"viewModel",void 0),i.__decorate([l.aliasOf("viewModel.view")],A.prototype,"view",void 0),i.__decorate([u.property()],A.prototype,"headingLevel",void 0),i.__decorate([u.property()],A.prototype,"iconClass",void 0),i.__decorate([l.aliasOf("messages.widgetLabel",{overridable:!0})],A.prototype,"label",void 0),i.__decorate([u.property({type:y,nonNullable:!0})],A.prototype,"visibleElements",void 0),i.__decorate([u.property(),z.messageBundle("esri/widgets/ShadowAccumulation/t9n/ShadowAccumulation")],A.prototype,"messages",void 0),i.__decorate([u.property()],A.prototype,"_defaultViewModel",void 0),i.__decorate([u.property()],A.prototype,"_timeSlider",void 0),i.__decorate([u.property()],A.prototype,"_tooltip",void 0),A=i.__decorate([p.subclass("esri.widgets.ShadowAccumulation")],A),A}));
