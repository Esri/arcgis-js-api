/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","exports","../../../chunks/_rollupPluginBabelHelpers","../../../Color","../../../symbols","../../../renderers/support/numberUtils","../../../symbols/support/cimSymbolUtils","../../../symbols/support/utils","./utils","../../support/widgetUtils","../../../support/themeUtils","../../../symbols/SimpleMarkerSymbol","../../../symbols/SimpleLineSymbol"],(function(e,l,n,t,o,r,i,s,u,a,c,p,y){"use strict";const m=30,f=12,b=[255,255,255],h=[200,200,200],d=[128,128,128],S=20,g=5;function v(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}function z(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}function w(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}function V(e){return"esri.symbols.TextSymbol"===e.declaredClass}function _(e,l){const n=e.length-1;return e.map(((e,t)=>u.createStopLabel(e,t,n,l)))}function k(e,l,n,t,o,r,i){return L.apply(this,arguments)}function L(){return L=n._asyncToGenerator((function*(e,l,t,o,i,u,a){const c=l.legendOptions,p=c&&c.customValues,y=a||(yield x(e,t)),m=!!y,f=!!p,b=null!=l.minSize&&null!=l.maxSize,h=l.stops&&l.stops.length>1,d=!!l.target;if(!m||!f&&!(b||h&&!d))return;const S=s.isVolumetricSymbol(y);let g=null,v=null,z=null;v=S&&!h?r.round([l.minDataValue,l.maxDataValue]):p||(yield R(l,y,o,i));const w=e?.authoringInfo,V="univariate-color-size"===w?.type,k=V&&"above-and-below"===w?.univariateTheme;if(!v&&h&&(v=l.stops.map((e=>e.value)),g=l.stops.some((e=>!!e.label)),"flow"===e.type&&(v=r.round(v)),g&&(z=l.stops.map((e=>e.label)))),S&&v?.length>2&&!k&&(v=[v[0],v[v.length-1]]),!v)return null;V&&5!==v?.length&&(v=P({minSize:v[0],maxSize:v[v.length-1]}));const L=S?D(e,v):null,C=s.getSymbolOutlineSize(y),I=g?null:_(v,u),M=yield Promise.all(v.map(function(){var t=n._asyncToGenerator((function*(n,t){const r=S?L[t]:yield q(l,y,n,o,i);return{value:n,symbol:F(k&&"class-breaks"===e.type?T(e,t):y,r),label:g?z[t]:I[t],size:r,outlineSize:C}}));return function(e,l){return t.apply(this,arguments)}}()));return M.reverse()})),L.apply(this,arguments)}function D(e,l){const n=e?.authoringInfo,t="univariate-color-size"===n?.type;let o=[f,m];if(t){const e=l[0],n=l[l.length-1],t=f,r=m;o=l.map((l=>t+(l-e)/(n-e)*(r-t)))}return t&&"below"===n?.univariateTheme&&o.reverse(),o}function T(e,l){const n=e.classBreakInfos,t=n.length,o=t<2||!(l>=2)?n[0].symbol.clone():n[t-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(o.type.includes("3d")?M(o):E(o)),o}function x(e,l){return C.apply(this,arguments)}function C(){return(C=n._asyncToGenerator((function*(e,l){if("flow"===e.type)return u.getSymbolForFlowRenderer(e,l);if("pie-chart"===e.type)return new p({color:null,outline:e.outline?.width?e.outline:new y});let n=null,t=null;if("simple"===e.type)n=e.symbol;else if("class-breaks"===e.type){const l=e.classBreakInfos;n=l&&l[0]&&l[0].symbol,t=l.length>1}else if("unique-value"===e.type){const l=e.uniqueValueInfos;n=l&&l[0]&&l[0].symbol,t=l.length>1}return!n||I(n)?null:(n=n.clone(),(l||t)&&(n.type.includes("3d")?M(n):E(n)),n)}))).apply(this,arguments)}function I(e){if(e){if(o.isSymbol3D(e)){return!!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type))}return e.type.includes("fill")}return!1}function M(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:d}})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:h}:(e.material={color:b},e.outline={color:d,size:1.5})}))}function E(e){const l=c.isDarkTheme();if("cim"===e.type)i.applyCIMSymbolColor(e,new t(h));else if(e.type.includes("line"))e.color=d;else if(e.color=l?d:b,"simple-marker"===e.type)if(e.outline){const l=e.outline?.color?.toHex();"#ffffff"===l&&(e.outline.color=d)}else e.outline={color:d,width:1.5}}function R(e,l,n,t){return G.apply(this,arguments)}function G(){return(G=n._asyncToGenerator((function*(l,n,t,o){const i=(yield new Promise(((l,n)=>e(["../../../renderers/visualVariables/support/visualVariableUtils"],l,n)))).getSizeRangeAtScale(l,t,o),s=i&&P(i);if(!i&&!s)return;let u=s.map((e=>U(e,l,i)));u=r.round(u);for(let e=1;e<u.length-1;e++){const r=yield O(l,n,u[e],u[e-1],t,o);r&&(u[e]=r[0],s[e]=r[1])}return u}))).apply(this,arguments)}function P(e){const l=e.minSize,n=e.maxSize,t=g,o=(n-l)/(t-1),r=[];for(let i=0;i<t;i++)r.push(l+o*i);return r}function U(e,l,n){const t=n.minSize,o=n.maxSize,r=l.minDataValue,i=l.maxDataValue;let s=null;if(e<=t)s=r;else if(e>=o)s=i;else{s=(e-t)/(o-t)*(i-r)+r}return s}function O(e,l,n,t,o,r){return A.apply(this,arguments)}function A(){return(A=n._asyncToGenerator((function*(e,l,n,t,o,i){const s=yield q(e,l,n,o,i),u=yield q(e,l,t,o,i),a=r.numDigits(n),c=a.fractional,p=S;let y=a.integer,m=null,f=null;n>0&&n<1&&(m=10**c,n*=m,y=r.numDigits(n).integer);for(let b=y-1;b>=0;b--){const t=10**b;let a=Math.floor(n/t)*t,c=Math.ceil(n/t)*t;null!=m&&(a/=m,c/=m);let y=(a+c)/2;[,y]=r.round([a,y,c],{indexes:[1]});const h=yield q(e,l,a,o,i),d=yield q(e,l,c,o,i),S=yield q(e,l,y,o,i),g=r.percentChange(s,h,u,null),v=r.percentChange(s,d,u,null),z=r.percentChange(s,S,u,null);let w=g.previous<=p,V=v.previous<=p;if(w&&V&&(g.previous<=v.previous?(w=!0,V=!1):(V=!0,w=!1)),w?f=[a,h]:V?f=[c,d]:z.previous<=p&&(f=[y,S]),f)break}return f}))).apply(this,arguments)}function q(e,l,n,t,o){return B.apply(this,arguments)}function B(){return(B=n._asyncToGenerator((function*(l,n,t,o,r){const{getSize:i}=yield new Promise(((l,n)=>e(["../../../renderers/visualVariables/support/visualVariableUtils"],l,n)));return i(l,t,{scale:o,view:r,shape:"simple-marker"===n.type?n.style:null})}))).apply(this,arguments)}function F(e,l){const n=e.clone();if(o.isSymbol3D(n))s.isVolumetricSymbol(n)||n.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=l)}));else if(v(n))n.size=l;else if(z(n)){const e=n.width,t=n.height;n.height=l,n.width=l*(e/t)}else w(n)?n.width=l:V(n)&&n.font&&(n.font.size=l);return n}l.REAL_WORLD_MAX_SIZE=m,l.REAL_WORLD_MIN_SIZE=f,l.getRampStops=k,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})}));
