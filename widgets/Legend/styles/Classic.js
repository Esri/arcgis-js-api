/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../intl/number","../../../intl","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/decorators/renderable","../../../chunks/index","../../Widget","./support/utils","../support/styleUtils"],(function(e,s,t,r,l,i,a,n,o,d,c,p,g,y,m,u,v,_,h){"use strict";const b="esri-legend__service",x="esri-legend__service-label",f="esri-legend__layer",j="esri-legend__group-layer",w="esri-legend__group-layer-child",L="esri-legend__layer-table",A="esri-legend__layer-table--size-ramp",R="esri-legend__layer-child-table",S="esri-legend__layer-caption",T="esri-legend__layer-body",B="esri-legend__layer-row",C="esri-legend__layer-cell esri-legend__layer-cell--info",U="esri-legend__imagery-layer-image--stretched",E="esri-legend__imagery-layer-info--stretched",F="esri-legend__layer-cell esri-legend__layer-cell--symbols",$="esri-legend__symbol",k="esri-legend__ramps",I="esri-legend__size-ramp",N="esri-legend__color-ramp",z="esri-legend__opacity-ramp",P="esri-legend__ramp-labels",O="esri-legend__ramp-label",H="esri-univariate-above-and-below-ramp__label",M="esri-legend__message",W="esri-widget__heading",q={display:"flex",alignItems:"flex-start"},D={marginLeft:"3px"},G={display:"table-cell",verticalAlign:"middle"};let J=function(s){function t(e,t){var r;return(r=s.call(this,e,t)||this).activeLayerInfos=null,r.messages=null,r.type="classic",r}e._inheritsLoose(t,s);var r=t.prototype;return r.render=function(){const e=this.activeLayerInfos,s=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return u.jsx("div",null,s&&s.length?s:u.jsx("div",{class:M},this.messages.noLegend))},r._renderLegendForLayer=function(e){if(!e.ready)return null;const s=!!e.children.length,t=`esri-legend__${e.layer.uid}-version-${e.version}`,r=e.title?u.jsx("h3",{class:this.classes(W,x)},e.title):null;if(s){const s=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return u.jsx("div",{key:t,class:this.classes(b,j)},r,s)}{const s=e.legendElements;if(s&&!s.length)return null;const l=s.map((s=>this._renderLegendForElement(s,e.layer))).filter((e=>!!e));if(!l.length)return null;const i={[w]:!!e.parent};return u.jsx("div",{key:t,class:this.classes(b,i)},r,u.jsx("div",{class:f},l))}},r._renderLegendForElement=function(e,s,t){const r="color-ramp"===e.type,l="opacity-ramp"===e.type,i="size-ramp"===e.type;let a=null;if("symbol-table"===e.type||i){const t=e.infos.map((t=>this._renderLegendForElementInfo(t,s,i,e.legendType))).filter((e=>!!e));t.length&&(a=u.jsx("div",{class:T},t))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?a=this._renderLegendForRamp(e,s.opacity):"relationship-ramp"===e.type?a=_.renderRelationshipRamp(e,this.id,s.opacity):"univariate-above-and-below-ramp"===e.type&&(a=this._renderUnivariateAboveAndBelowRamp(e,s.opacity));if(!a)return null;const n=e.title;let o=null;if("string"==typeof n)o=n;else if(n){const e=h.getTitle(this.messages,n,r||l);o=h.isRendererTitle(n,r||l)&&n.title?`${n.title} (${e})`:e}const d=t?R:L,c=o?u.jsx("div",{class:S},o):null,p={[A]:i||!t};return u.jsx("div",{class:this.classes(d,p)},c,a)},r._renderUnivariateAboveAndBelowRamp=function(e,s){const{sizeRampElement:t,colorRampElement:r}=_.getUnivariateAboveAndBelowRampElements(e,s),l=_.getUnivariateAboveAndBelowColorRampSize(t,"above"),i=_.getUnivariateAboveAndBelowColorRampSize(t,"below"),a=_.getUnivariateAboveAndBelowColorRampPreview(r,{width:12,height:l,rampAlignment:"vertical",opacity:s,type:"above"}),n=_.getUnivariateAboveAndBelowColorRampPreview(r,{width:12,height:i,rampAlignment:"vertical",opacity:s,type:"below"}),o=_.getUnivariateAboveAndBelowColorRampMargin(t),d=t.infos.map((e=>e.label)),c=d.map(((e,s)=>{const t=2===s;return 0===s?u.jsx("div",{key:s,class:e?a?H:O:null},e):t?u.jsx("div",null):null})),p=d.map(((e,s)=>2===s||4===s?u.jsx("div",{key:s,class:e?a?H:O:null},e):null)),g={display:"table-cell",verticalAlign:"middle"},y={marginTop:`${o}px`},m={height:`${l}px`},v={height:`${i}px`};return u.jsx("div",{key:"univariate-above-and-below-ramp-preview",styles:q},u.jsx("div",{class:T},t.infos.map(((e,s)=>u.jsx("div",{class:this.classes(B,I)},u.jsx("div",{class:$,styles:g,bind:e.preview,afterCreate:h.attachToNode}),a||s%2!=0?null:u.jsx("div",{class:C},d[s]))))),a?u.jsx("div",{styles:y,key:"color-ramp-preview"},u.jsx("div",{styles:D},u.jsx("div",{styles:G},u.jsx("div",{class:k,bind:a,afterCreate:h.attachToNode})),u.jsx("div",{styles:G},u.jsx("div",{class:P,styles:m},c))),u.jsx("div",{styles:D},u.jsx("div",{styles:G},u.jsx("div",{class:k,bind:n,afterCreate:h.attachToNode})),u.jsx("div",{styles:G},u.jsx("div",{class:P,styles:v},p)))):null)},r._renderLegendForRamp=function(e,s){const t=e.infos,r="opacity-ramp"===e.type,l="heatmap-ramp"===e.type,i="stretch-ramp"===e.type,a=e.preview,n=r?z:"";a.className=`${N} ${n}`,null!=s&&(a.style.opacity=s.toString());const o=t.map((e=>u.jsx("div",{class:e.label?O:null},l?this.messages[e.label]:i?this._getStretchStopLabel(e):e.label))),d={width:"24px"},c={height:a.style.height};return u.jsx("div",{class:B},u.jsx("div",{class:F,styles:d},u.jsx("div",{class:k,bind:a,afterCreate:h.attachToNode})),u.jsx("div",{class:C},u.jsx("div",{class:P,styles:c},o)))},r._getStretchStopLabel=function(e){return e.label?this.messages[e.label]+": "+c.formatNumber(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"}):""},r._renderLegendForElementInfo=function(e,s,t,r){if(e.type)return this._renderLegendForElement(e,s,!0);let l=null;const i=h.isImageryStretchedLegend(s,r);if(e.preview?l=u.jsx("div",{class:$,bind:e.preview,afterCreate:h.attachToNode}):e.src&&(l=this._renderImage(e,s,i)),!l)return null;const a={[E]:i},n={[E]:i,[I]:!i&&t};return u.jsx("div",{class:B},u.jsx("div",{class:this.classes(F,n)},l),u.jsx("div",{class:this.classes(C,a)},h.getTitle(this.messages,e.label,!1)||""))},r._renderImage=function(e,s,t){const{label:r,src:l,opacity:i}=e,a={[U]:t,[$]:!t},n={opacity:`${null!=i?i:s.opacity}`};return u.jsx("img",{alt:h.getTitle(this.messages,r,!1),src:l,border:0,width:e.width,height:e.height,class:this.classes(a),styles:n})},t}(v);return s.__decorate([m.renderable(),i.property()],J.prototype,"activeLayerInfos",void 0),s.__decorate([i.property(),m.renderable(),y.messageBundle("esri/widgets/Legend/t9n/Legend")],J.prototype,"messages",void 0),s.__decorate([i.property({readOnly:!0})],J.prototype,"type",void 0),J=s.__decorate([a.subclass("esri.widgets.Legend.styles.Classic")],J),J}));
