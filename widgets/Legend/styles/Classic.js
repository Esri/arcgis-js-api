/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../intl","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/arrayUtils","../../../core/accessorSupport/decorators/subclass","../../Widget","./ClassicCSS","./support/relationshipUtils","./support/univariateUtils","../support/styleUtils","../../support/Heading","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/jsxFactory","../../../intl/number"],(function(e,t,s,a,r,i,l,n,o,p,c,d,y,m,S,v,u){"use strict";const h=`${o.LEGEND}__`,g=24,C={display:"flex",alignItems:"flex-start"},f={marginLeft:"3px"},b={display:"table-cell",verticalAlign:"middle"};let x=function(t){function s(e,s){var a;return(a=t.call(this,e,s)||this).activeLayerInfos=null,a.headingLevel=3,a.messages=null,a.type="classic",a}e._inheritsLoose(s,t);var a=s.prototype;return a.render=function(){const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return v.tsx("div",null,t&&t.length?t:v.tsx("div",{class:o.CSS.message},this.messages.noLegend))},a._renderLegendForLayer=function(e){if(!e.ready)return null;const t=!!e.children.length,s=`${h}${e.layer.uid}-version-${e.version}`,a=e.title?y.Heading({level:this.headingLevel,class:this.classes(o.CSS.header,o.CSS.label)},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return v.tsx("div",{key:s,class:this.classes(o.CSS.service,o.CSS.groupLayer)},a,t)}{const t=e.legendElements;if(t&&!t.length)return null;const r=t.map((t=>this._renderLegendForElement(t,e.layer,e.effectList))).filter((e=>!!e));if(!r.length)return null;const i={[o.CSS.groupLayerChild]:!!e.parent};return v.tsx("div",{key:s,class:this.classes(o.CSS.service,i),tabIndex:0},a,v.tsx("div",{class:o.CSS.layer},r))}},a._renderLegendForElement=function(e,t,s,a){const r="color-ramp"===e.type,i="opacity-ramp"===e.type,l="size-ramp"===e.type;let n=null;if("symbol-table"===e.type||l){const a=e.infos.map((a=>this._renderLegendForElementInfo(a,t,s,l,e.legendType))).filter((e=>!!e));a.length&&(n=v.tsx("div",{class:o.CSS.layerBody},a))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?n=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?n=p.renderRelationshipRamp(e,this.id,t.opacity,s):"pie-chart-ramp"===e.type?n=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?n=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,s):"univariate-color-size-ramp"===e.type&&(n=this._renderUnivariateColorSizeRamp(e,t.opacity,s));if(!n)return null;const c=e.title;let y=null;if("string"==typeof c)y=c;else if(c){const e=d.getTitle(this.messages,c,r||i);y=d.isRendererTitle(c,r||i)&&c.title?`${c.title} (${e})`:e}const m=a?o.CSS.layerChildTable:o.CSS.layerTable,S=y?v.tsx("div",{class:o.CSS.layerCaption},y):null,u={[o.CSS.layerTableSizeRamp]:l||!a};return v.tsx("div",{class:this.classes(m,u)},S,n)},a._renderPieChartRamp=function(e){return v.tsx("div",{bind:e.preview,afterCreate:d.attachToNode})},a._renderUnivariateAboveAndBelowRamp=function(e,t,s){const{sizeRampElement:a,colorRampElement:r}=c.getUnivariateAboveAndBelowRampElements(e,t);if(!a)return null;const i=c.getUnivariateColorRampSize(a,"above",!0),l=c.getUnivariateColorRampSize(a,"below",!0),n=12,p=c.getUnivariateColorRampPreview(r,{width:n,height:i,rampAlignment:"vertical",opacity:t,type:"above",effectList:s}),y=c.getUnivariateColorRampPreview(r,{width:n,height:l,rampAlignment:"vertical",opacity:t,type:"below",effectList:s}),m=c.getUnivariateColorRampMargin(a),S=a.infos.map((e=>e.label)),u=S.map(((e,t)=>{const s=2===t;return 0===t?v.tsx("div",{key:t,class:e?p?o.CSS.univariateAboveAndBelowLabel:o.CSS.rampLabel:null},e):s?v.tsx("div",null):null})),h=S.length-1,g=Math.floor(S.length/2),x=S.map(((e,t)=>t===g||t===h?v.tsx("div",{key:t,class:e?p?o.CSS.univariateAboveAndBelowLabel:o.CSS.rampLabel:null},e):null)),L={display:"table-cell",verticalAlign:"middle"},w={marginTop:`${m}px`},R={height:`${i}px`},_={height:`${l}px`};return v.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:C},v.tsx("div",{class:o.CSS.layerBody},a.infos.map(((e,t)=>v.tsx("div",{class:this.classes(o.CSS.layerRow,o.CSS.sizeRamp)},v.tsx("div",{class:o.CSS.symbol,styles:L,bind:e.preview,afterCreate:d.attachToNode}),p||t%2!=0?null:v.tsx("div",{class:o.CSS.layerInfo},S[t]))))),p?v.tsx("div",{styles:w,key:"color-ramp-preview"},v.tsx("div",{styles:f},v.tsx("div",{styles:b},v.tsx("div",{class:o.CSS.rampContainer,bind:p,afterCreate:d.attachToNode})),v.tsx("div",{styles:b},v.tsx("div",{class:o.CSS.rampLabelsContainer,styles:R},u))),v.tsx("div",{styles:f},v.tsx("div",{styles:b},v.tsx("div",{class:o.CSS.rampContainer,bind:y,afterCreate:d.attachToNode})),v.tsx("div",{styles:b},v.tsx("div",{class:o.CSS.rampLabelsContainer,styles:_},x)))):null)},a._renderUnivariateColorSizeRamp=function(e,t,s){const{sizeRampElement:a,colorRampElement:r}=c.getUnivariateColorSizeRampElements(e);if(!a)return null;const i=c.getUnivariateColorRampMargin(a),l=12,n=c.getUnivariateColorRampSize(a,"full",!1),p=c.getUnivariateColorRampPreview(r,{width:l,height:n,rampAlignment:"vertical",opacity:t,type:"full",effectList:s}),y=a.infos.length-1,m=a.infos.map(((e,t)=>0===t||t===y?v.tsx("div",{key:t,class:e.label?r?o.CSS.univariateAboveAndBelowLabel:o.CSS.rampLabel:null},e.label):null)),S={display:"table-cell",verticalAlign:"middle"},u={marginTop:`${i}px`},h={height:`${n}px`};return v.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:C},v.tsx("div",{class:o.CSS.layerBody},a.infos.map((e=>v.tsx("div",{class:this.classes(o.CSS.layerRow,o.CSS.sizeRamp)},v.tsx("div",{class:o.CSS.symbol,styles:S,bind:e.preview,afterCreate:d.attachToNode}))))),v.tsx("div",{styles:u,key:"color-ramp-preview"},v.tsx("div",{styles:f},v.tsx("div",{styles:b},v.tsx("div",{class:o.CSS.rampContainer,bind:p,afterCreate:d.attachToNode})),v.tsx("div",{styles:b},v.tsx("div",{class:o.CSS.rampLabelsContainer,styles:h},m)))))},a._renderLegendForRamp=function(e,t){const s=e.infos,a="opacity-ramp"===e.type,r="heatmap-ramp"===e.type,i="stretch-ramp"===e.type,l=e.preview,n=a?o.CSS.opacityRamp:"";l.className=`${o.CSS.colorRamp} ${n}`,null!=t&&(l.style.opacity=t.toString());const p=s.map((e=>v.tsx("div",{class:e.label?o.CSS.rampLabel:null},r?this.messages[e.label]||e.label:i?this._getStretchStopLabel(e):e.label))),c={width:`${g}px`},y={height:l.style.height};return v.tsx("div",{class:o.CSS.layerRow},v.tsx("div",{class:o.CSS.symbolContainer,styles:c},v.tsx("div",{class:o.CSS.rampContainer,bind:l,afterCreate:d.attachToNode})),v.tsx("div",{class:o.CSS.layerInfo},v.tsx("div",{class:o.CSS.rampLabelsContainer,styles:y},p)))},a._getStretchStopLabel=function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:u.formatNumber(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""},a._renderLegendForElementInfo=function(e,t,s,a,r){if(e.type)return this._renderLegendForElement(e,t,s,!0);let i=null;const l=d.isImageryStretchedLegend(t,r);if(e.preview?i=v.tsx("div",{class:o.CSS.symbol,bind:e.preview,afterCreate:d.attachToNode}):e.src&&(i=this._renderImage(e,t,l)),!i)return null;const n={[o.CSS.imageryLayerInfoStretched]:l},p={[o.CSS.imageryLayerInfoStretched]:l,[o.CSS.sizeRamp]:!l&&a};return v.tsx("div",{class:o.CSS.layerRow},v.tsx("div",{class:this.classes(o.CSS.symbolContainer,p)},i),v.tsx("div",{class:this.classes(o.CSS.layerInfo,n)},d.getTitle(this.messages,e.label,!1)||""))},a._renderImage=function(e,t,s){const{label:a,src:r,opacity:i}=e,l={[o.CSS.imageryLayerStretchedImage]:s,[o.CSS.symbol]:!s},n={opacity:`${null!=i?i:t.opacity}`};return v.tsx("img",{alt:d.getTitle(this.messages,a,!1),src:r,border:0,width:e.width,height:e.height,class:this.classes(l),styles:n})},s}(n);t.__decorate([a.property()],x.prototype,"activeLayerInfos",void 0),t.__decorate([a.property()],x.prototype,"headingLevel",void 0),t.__decorate([a.property(),S.messageBundle("esri/widgets/Legend/t9n/Legend")],x.prototype,"messages",void 0),t.__decorate([a.property({readOnly:!0})],x.prototype,"type",void 0),x=t.__decorate([l.subclass("esri.widgets.Legend.styles.Classic")],x);return x}));
