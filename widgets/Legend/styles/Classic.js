/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../intl","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","../../Widget","./support/relationshipUtils","./support/univariateUtils","../support/styleUtils","../../support/Heading","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/jsxFactory","../../../intl/number"],(function(e,t,a,r,s,l,i,n,o,d,p,c,y,m,g,v){"use strict";const h={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},u="esri-legend__",_=24,b={display:"flex",alignItems:"flex-start"},f={marginLeft:"3px"},x={display:"table-cell",verticalAlign:"middle"};let L=function(t){function a(e,a){var r;return(r=t.call(this,e,a)||this).activeLayerInfos=null,r.headingLevel=3,r.messages=null,r.type="classic",r}e._inheritsLoose(a,t);var r=a.prototype;return r.render=function(){const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return g.tsx("div",null,t&&t.length?t:g.tsx("div",{class:h.message},this.messages.noLegend))},r._renderLegendForLayer=function(e){if(!e.ready)return null;const t=!!e.children.length,a=`${u}${e.layer.uid}-version-${e.version}`,r=e.title?c.Heading({level:this.headingLevel,class:this.classes(h.header,h.label)},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return g.tsx("div",{key:a,class:this.classes(h.service,h.groupLayer)},r,t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.map((t=>this._renderLegendForElement(t,e.layer,e.effectList))).filter((e=>!!e));if(!s.length)return null;const l={[h.groupLayerChild]:!!e.parent};return g.tsx("div",{key:a,class:this.classes(h.service,l),tabIndex:0},r,g.tsx("div",{class:h.layer},s))}},r._renderLegendForElement=function(e,t,a,r){const s="color-ramp"===e.type,l="opacity-ramp"===e.type,i="size-ramp"===e.type;let n=null;if("symbol-table"===e.type||i){const r=e.infos.map((r=>this._renderLegendForElementInfo(r,t,a,i,e.legendType))).filter((e=>!!e));r.length&&(n=g.tsx("div",{class:h.layerBody},r))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?n=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?n=o.renderRelationshipRamp(e,this.id,t.opacity,a):"pie-chart-ramp"===e.type?n=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?n=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,a):"univariate-color-size-ramp"===e.type&&(n=this._renderUnivariateColorSizeRamp(e,t.opacity,a));if(!n)return null;const d=e.title;let c=null;if("string"==typeof d)c=d;else if(d){const e=p.getTitle(this.messages,d,s||l);c=p.isRendererTitle(d,s||l)&&d.title?`${d.title} (${e})`:e}const y=r?h.layerChildTable:h.layerTable,m=c?g.tsx("div",{class:h.layerCaption},c):null,v={[h.layerTableSizeRamp]:i||!r};return g.tsx("div",{class:this.classes(y,v)},m,n)},r._renderPieChartRamp=function(e){return g.tsx("div",{bind:e.preview,afterCreate:p.attachToNode})},r._renderUnivariateAboveAndBelowRamp=function(e,t,a){const{sizeRampElement:r,colorRampElement:s}=d.getUnivariateAboveAndBelowRampElements(e,t);if(!r)return null;const l=d.getUnivariateColorRampSize(r,"above",!0),i=d.getUnivariateColorRampSize(r,"below",!0),n=12,o=d.getUnivariateColorRampPreview(s,{width:n,height:l,rampAlignment:"vertical",opacity:t,type:"above",effectList:a}),c=d.getUnivariateColorRampPreview(s,{width:n,height:i,rampAlignment:"vertical",opacity:t,type:"below",effectList:a}),y=d.getUnivariateColorRampMargin(r),m=r.infos.map((e=>e.label)),v=m.map(((e,t)=>{const a=2===t;return 0===t?g.tsx("div",{key:t,class:e?o?h.univariateAboveAndBelowLabel:h.rampLabel:null},e):a?g.tsx("div",null):null})),u=m.length-1,_=Math.floor(m.length/2),L=m.map(((e,t)=>t===_||t===u?g.tsx("div",{key:t,class:e?o?h.univariateAboveAndBelowLabel:h.rampLabel:null},e):null)),w={display:"table-cell",verticalAlign:"middle"},C={marginTop:`${y}px`},R={height:`${l}px`},S={height:`${i}px`};return g.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:b},g.tsx("div",{class:h.layerBody},r.infos.map(((e,t)=>g.tsx("div",{class:this.classes(h.layerRow,h.sizeRamp)},g.tsx("div",{class:h.symbol,styles:w,bind:e.preview,afterCreate:p.attachToNode}),o||t%2!=0?null:g.tsx("div",{class:h.layerInfo},m[t]))))),o?g.tsx("div",{styles:C,key:"color-ramp-preview"},g.tsx("div",{styles:f},g.tsx("div",{styles:x},g.tsx("div",{class:h.rampContainer,bind:o,afterCreate:p.attachToNode})),g.tsx("div",{styles:x},g.tsx("div",{class:h.rampLabelsContainer,styles:R},v))),g.tsx("div",{styles:f},g.tsx("div",{styles:x},g.tsx("div",{class:h.rampContainer,bind:c,afterCreate:p.attachToNode})),g.tsx("div",{styles:x},g.tsx("div",{class:h.rampLabelsContainer,styles:S},L)))):null)},r._renderUnivariateColorSizeRamp=function(e,t,a){const{sizeRampElement:r,colorRampElement:s}=d.getUnivariateColorSizeRampElements(e);if(!r)return null;const l=d.getUnivariateColorRampMargin(r),i=12,n=d.getUnivariateColorRampSize(r,"full",!1),o=d.getUnivariateColorRampPreview(s,{width:i,height:n,rampAlignment:"vertical",opacity:t,type:"full",effectList:a}),c=r.infos.length-1,y=r.infos.map(((e,t)=>0===t||t===c?g.tsx("div",{key:t,class:e.label?s?h.univariateAboveAndBelowLabel:h.rampLabel:null},e.label):null)),m={display:"table-cell",verticalAlign:"middle"},v={marginTop:`${l}px`},u={height:`${n}px`};return g.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:b},g.tsx("div",{class:h.layerBody},r.infos.map((e=>g.tsx("div",{class:this.classes(h.layerRow,h.sizeRamp)},g.tsx("div",{class:h.symbol,styles:m,bind:e.preview,afterCreate:p.attachToNode}))))),g.tsx("div",{styles:v,key:"color-ramp-preview"},g.tsx("div",{styles:f},g.tsx("div",{styles:x},g.tsx("div",{class:h.rampContainer,bind:o,afterCreate:p.attachToNode})),g.tsx("div",{styles:x},g.tsx("div",{class:h.rampLabelsContainer,styles:u},y)))))},r._renderLegendForRamp=function(e,t){const a=e.infos,r="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,i=e.preview,n=r?h.opacityRamp:"";i.className=`${h.colorRamp} ${n}`,null!=t&&(i.style.opacity=t.toString());const o=a.map((e=>g.tsx("div",{class:e.label?h.rampLabel:null},s?this.messages[e.label]||e.label:l?this._getStretchStopLabel(e):e.label))),d={width:`${_}px`},c={height:i.style.height};return g.tsx("div",{class:h.layerRow},g.tsx("div",{class:h.symbolContainer,styles:d},g.tsx("div",{class:h.rampContainer,bind:i,afterCreate:p.attachToNode})),g.tsx("div",{class:h.layerInfo},g.tsx("div",{class:h.rampLabelsContainer,styles:c},o)))},r._getStretchStopLabel=function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:v.formatNumber(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""},r._renderLegendForElementInfo=function(e,t,a,r,s){if(e.type)return this._renderLegendForElement(e,t,a,!0);let l=null;const i=p.isImageryStretchedLegend(t,s);if(e.preview?l=g.tsx("div",{class:h.symbol,bind:e.preview,afterCreate:p.attachToNode}):e.src&&(l=this._renderImage(e,t,i)),!l)return null;const n={[h.imageryLayerInfoStretched]:i},o={[h.imageryLayerInfoStretched]:i,[h.sizeRamp]:!i&&r};return g.tsx("div",{class:h.layerRow},g.tsx("div",{class:this.classes(h.symbolContainer,o)},l),g.tsx("div",{class:this.classes(h.layerInfo,n)},p.getTitle(this.messages,e.label,!1)||""))},r._renderImage=function(e,t,a){const{label:r,src:s,opacity:l}=e,i={[h.imageryLayerStretchedImage]:a,[h.symbol]:!a},n={opacity:`${null!=l?l:t.opacity}`};return g.tsx("img",{alt:p.getTitle(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(i),styles:n})},a}(n);t.__decorate([r.property()],L.prototype,"activeLayerInfos",void 0),t.__decorate([r.property()],L.prototype,"headingLevel",void 0),t.__decorate([r.property(),m.messageBundle("esri/widgets/Legend/t9n/Legend")],L.prototype,"messages",void 0),t.__decorate([r.property({readOnly:!0})],L.prototype,"type",void 0),L=t.__decorate([i.subclass("esri.widgets.Legend.styles.Classic")],L);return L}));
