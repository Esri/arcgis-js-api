/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../intl","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../Widget","./support/relationshipUtils","./support/univariateUtils","../support/styleUtils","../../support/Heading","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/jsxFactory","../../../intl/number"],(function(e,a,t,r,s,l,i,n,o,d,p,c,y,m,g,v,h){"use strict";const u={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},_="esri-legend__",b=24,f={display:"flex",alignItems:"flex-start"},x={marginLeft:"3px"},L={display:"table-cell",verticalAlign:"middle"};let w=function(a){function t(e,t){var r;return(r=a.call(this,e,t)||this).activeLayerInfos=null,r.headingLevel=3,r.messages=null,r.type="classic",r}e._inheritsLoose(t,a);var r=t.prototype;return r.render=function(){const e=this.activeLayerInfos,a=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return v.tsx("div",null,a&&a.length?a:v.tsx("div",{class:u.message},this.messages.noLegend))},r._renderLegendForLayer=function(e){if(!e.ready)return null;const a=!!e.children.length,t=`${_}${e.layer.uid}-version-${e.version}`,r=e.title?y.Heading({level:this.headingLevel,class:this.classes(u.header,u.label)},e.title):null;if(a){const a=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return v.tsx("div",{key:t,class:this.classes(u.service,u.groupLayer)},r,a)}{const a=e.legendElements;if(a&&!a.length)return null;const s=a.map((a=>this._renderLegendForElement(a,e.layer))).filter((e=>!!e));if(!s.length)return null;const l={[u.groupLayerChild]:!!e.parent};return v.tsx("div",{key:t,class:this.classes(u.service,l),tabIndex:0},r,v.tsx("div",{class:u.layer},s))}},r._renderLegendForElement=function(e,a,t){const r="color-ramp"===e.type,s="opacity-ramp"===e.type,l="size-ramp"===e.type;let i=null;if("symbol-table"===e.type||l){const t=e.infos.map((t=>this._renderLegendForElementInfo(t,a,l,e.legendType))).filter((e=>!!e));t.length&&(i=v.tsx("div",{class:u.layerBody},t))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?i=this._renderLegendForRamp(e,a.opacity):"relationship-ramp"===e.type?i=d.renderRelationshipRamp(e,this.id,a.opacity):"univariate-above-and-below-ramp"===e.type?i=this._renderUnivariateAboveAndBelowRamp(e,a.opacity):"univariate-color-size-ramp"===e.type&&(i=this._renderUnivariateColorSizeRamp(e,a.opacity));if(!i)return null;const n=e.title;let o=null;if("string"==typeof n)o=n;else if(n){const e=c.getTitle(this.messages,n,r||s);o=c.isRendererTitle(n,r||s)&&n.title?`${n.title} (${e})`:e}const p=t?u.layerChildTable:u.layerTable,y=o?v.tsx("div",{class:u.layerCaption},o):null,m={[u.layerTableSizeRamp]:l||!t};return v.tsx("div",{class:this.classes(p,m)},y,i)},r._renderUnivariateAboveAndBelowRamp=function(e,a){const{sizeRampElement:t,colorRampElement:r}=p.getUnivariateAboveAndBelowRampElements(e,a),s=p.getUnivariateColorRampSize(t,"above",!0),l=p.getUnivariateColorRampSize(t,"below",!0),i=12,n=p.getUnivariateColorRampPreview(r,{width:i,height:s,rampAlignment:"vertical",opacity:a,type:"above"}),o=p.getUnivariateColorRampPreview(r,{width:i,height:l,rampAlignment:"vertical",opacity:a,type:"below"}),d=p.getUnivariateColorRampMargin(t),y=t.infos.map((e=>e.label)),m=y.map(((e,a)=>{const t=2===a;return 0===a?v.tsx("div",{key:a,class:e?n?u.univariateAboveAndBelowLabel:u.rampLabel:null},e):t?v.tsx("div",null):null})),g=y.length-1,h=Math.floor(y.length/2),_=y.map(((e,a)=>a===h||a===g?v.tsx("div",{key:a,class:e?n?u.univariateAboveAndBelowLabel:u.rampLabel:null},e):null)),b={display:"table-cell",verticalAlign:"middle"},w={marginTop:`${d}px`},C={height:`${s}px`},R={height:`${l}px`};return v.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:f},v.tsx("div",{class:u.layerBody},t.infos.map(((e,a)=>v.tsx("div",{class:this.classes(u.layerRow,u.sizeRamp)},v.tsx("div",{class:u.symbol,styles:b,bind:e.preview,afterCreate:c.attachToNode}),n||a%2!=0?null:v.tsx("div",{class:u.layerInfo},y[a]))))),n?v.tsx("div",{styles:w,key:"color-ramp-preview"},v.tsx("div",{styles:x},v.tsx("div",{styles:L},v.tsx("div",{class:u.rampContainer,bind:n,afterCreate:c.attachToNode})),v.tsx("div",{styles:L},v.tsx("div",{class:u.rampLabelsContainer,styles:C},m))),v.tsx("div",{styles:x},v.tsx("div",{styles:L},v.tsx("div",{class:u.rampContainer,bind:o,afterCreate:c.attachToNode})),v.tsx("div",{styles:L},v.tsx("div",{class:u.rampLabelsContainer,styles:R},_)))):null)},r._renderUnivariateColorSizeRamp=function(e,a){const{sizeRampElement:t,colorRampElement:r}=p.getUnivariateColorSizeRampElements(e),s=p.getUnivariateColorRampMargin(t),l=12,i=p.getUnivariateColorRampSize(t,"full",!1),n=p.getUnivariateColorRampPreview(r,{width:l,height:i,rampAlignment:"vertical",opacity:a,type:"full"}),o=t.infos.length-1,d=t.infos.map(((e,a)=>0===a||a===o?v.tsx("div",{key:a,class:e.label?r?u.univariateAboveAndBelowLabel:u.rampLabel:null},e.label):null)),y={display:"table-cell",verticalAlign:"middle"},m={marginTop:`${s}px`},g={height:`${i}px`};return v.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:f},v.tsx("div",{class:u.layerBody},t.infos.map((e=>v.tsx("div",{class:this.classes(u.layerRow,u.sizeRamp)},v.tsx("div",{class:u.symbol,styles:y,bind:e.preview,afterCreate:c.attachToNode}))))),v.tsx("div",{styles:m,key:"color-ramp-preview"},v.tsx("div",{styles:x},v.tsx("div",{styles:L},v.tsx("div",{class:u.rampContainer,bind:n,afterCreate:c.attachToNode})),v.tsx("div",{styles:L},v.tsx("div",{class:u.rampLabelsContainer,styles:g},d)))))},r._renderLegendForRamp=function(e,a){const t=e.infos,r="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,i=e.preview,n=r?u.opacityRamp:"";i.className=`${u.colorRamp} ${n}`,null!=a&&(i.style.opacity=a.toString());const o=t.map((e=>v.tsx("div",{class:e.label?u.rampLabel:null},s?this.messages[e.label]:l?this._getStretchStopLabel(e):e.label))),d={width:`${b}px`},p={height:i.style.height};return v.tsx("div",{class:u.layerRow},v.tsx("div",{class:u.symbolContainer,styles:d},v.tsx("div",{class:u.rampContainer,bind:i,afterCreate:c.attachToNode})),v.tsx("div",{class:u.layerInfo},v.tsx("div",{class:u.rampLabelsContainer,styles:p},o)))},r._getStretchStopLabel=function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:h.formatNumber(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""},r._renderLegendForElementInfo=function(e,a,t,r){if(e.type)return this._renderLegendForElement(e,a,!0);let s=null;const l=c.isImageryStretchedLegend(a,r);if(e.preview?s=v.tsx("div",{class:u.symbol,bind:e.preview,afterCreate:c.attachToNode}):e.src&&(s=this._renderImage(e,a,l)),!s)return null;const i={[u.imageryLayerInfoStretched]:l},n={[u.imageryLayerInfoStretched]:l,[u.sizeRamp]:!l&&t};return v.tsx("div",{class:u.layerRow},v.tsx("div",{class:this.classes(u.symbolContainer,n)},s),v.tsx("div",{class:this.classes(u.layerInfo,i)},c.getTitle(this.messages,e.label,!1)||""))},r._renderImage=function(e,a,t){const{label:r,src:s,opacity:l}=e,i={[u.imageryLayerStretchedImage]:t,[u.symbol]:!t},n={opacity:`${null!=l?l:a.opacity}`};return v.tsx("img",{alt:c.getTitle(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(i),styles:n})},t}(o);return a.__decorate([r.property()],w.prototype,"activeLayerInfos",void 0),a.__decorate([r.property()],w.prototype,"headingLevel",void 0),a.__decorate([r.property(),g.messageBundle("esri/widgets/Legend/t9n/Legend")],w.prototype,"messages",void 0),a.__decorate([r.property({readOnly:!0})],w.prototype,"type",void 0),w=a.__decorate([n.subclass("esri.widgets.Legend.styles.Classic")],w),w}));
