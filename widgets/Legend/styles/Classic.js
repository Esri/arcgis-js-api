/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../intl","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","../../Widget","./support/relationshipUtils","./support/univariateUtils","../support/styleUtils","../../support/Heading","../../support/widgetUtils","../../support/decorators/messageBundle","../../../core/Logger","../../support/jsxFactory","../../../intl/number"],(function(e,t,a,r,s,l,i,n,o,d,p,c,y,m,g,v,h,u){"use strict";const _={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},b="esri-legend__",f=24,x={display:"flex",alignItems:"flex-start"},L={marginLeft:"3px"},w={display:"table-cell",verticalAlign:"middle"};let C=function(t){function a(e,a){var r;return(r=t.call(this,e,a)||this).activeLayerInfos=null,r.headingLevel=3,r.messages=null,r.type="classic",r}e._inheritsLoose(a,t);var r=a.prototype;return r.render=function(){const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return h.tsx("div",null,t&&t.length?t:h.tsx("div",{class:_.message},this.messages.noLegend))},r._renderLegendForLayer=function(e){if(!e.ready)return null;const t=!!e.children.length,a=`${b}${e.layer.uid}-version-${e.version}`,r=e.title?y.Heading({level:this.headingLevel,class:this.classes(_.header,_.label)},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return h.tsx("div",{key:a,class:this.classes(_.service,_.groupLayer)},r,t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.map((t=>this._renderLegendForElement(t,e.layer,e.effectList))).filter((e=>!!e));if(!s.length)return null;const l={[_.groupLayerChild]:!!e.parent};return h.tsx("div",{key:a,class:this.classes(_.service,l),tabIndex:0},r,h.tsx("div",{class:_.layer},s))}},r._renderLegendForElement=function(e,t,a,r){const s="color-ramp"===e.type,l="opacity-ramp"===e.type,i="size-ramp"===e.type;let n=null;if("symbol-table"===e.type||i){const r=e.infos.map((r=>this._renderLegendForElementInfo(r,t,a,i,e.legendType))).filter((e=>!!e));r.length&&(n=h.tsx("div",{class:_.layerBody},r))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?n=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?n=d.renderRelationshipRamp(e,this.id,t.opacity,a):"univariate-above-and-below-ramp"===e.type?n=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,a):"univariate-color-size-ramp"===e.type&&(n=this._renderUnivariateColorSizeRamp(e,t.opacity,a));if(!n)return null;const o=e.title;let p=null;if("string"==typeof o)p=o;else if(o){const e=c.getTitle(this.messages,o,s||l);p=c.isRendererTitle(o,s||l)&&o.title?`${o.title} (${e})`:e}const y=r?_.layerChildTable:_.layerTable,m=p?h.tsx("div",{class:_.layerCaption},p):null,g={[_.layerTableSizeRamp]:i||!r};return h.tsx("div",{class:this.classes(y,g)},m,n)},r._renderUnivariateAboveAndBelowRamp=function(e,t,a){const{sizeRampElement:r,colorRampElement:s}=p.getUnivariateAboveAndBelowRampElements(e,t);if(!r)return null;const l=p.getUnivariateColorRampSize(r,"above",!0),i=p.getUnivariateColorRampSize(r,"below",!0),n=12,o=p.getUnivariateColorRampPreview(s,{width:n,height:l,rampAlignment:"vertical",opacity:t,type:"above",effectList:a}),d=p.getUnivariateColorRampPreview(s,{width:n,height:i,rampAlignment:"vertical",opacity:t,type:"below",effectList:a}),y=p.getUnivariateColorRampMargin(r),m=r.infos.map((e=>e.label)),g=m.map(((e,t)=>{const a=2===t;return 0===t?h.tsx("div",{key:t,class:e?o?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):a?h.tsx("div",null):null})),v=m.length-1,u=Math.floor(m.length/2),b=m.map(((e,t)=>t===u||t===v?h.tsx("div",{key:t,class:e?o?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):null)),f={display:"table-cell",verticalAlign:"middle"},C={marginTop:`${y}px`},R={height:`${l}px`},S={height:`${i}px`};return h.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:x},h.tsx("div",{class:_.layerBody},r.infos.map(((e,t)=>h.tsx("div",{class:this.classes(_.layerRow,_.sizeRamp)},h.tsx("div",{class:_.symbol,styles:f,bind:e.preview,afterCreate:c.attachToNode}),o||t%2!=0?null:h.tsx("div",{class:_.layerInfo},m[t]))))),o?h.tsx("div",{styles:C,key:"color-ramp-preview"},h.tsx("div",{styles:L},h.tsx("div",{styles:w},h.tsx("div",{class:_.rampContainer,bind:o,afterCreate:c.attachToNode})),h.tsx("div",{styles:w},h.tsx("div",{class:_.rampLabelsContainer,styles:R},g))),h.tsx("div",{styles:L},h.tsx("div",{styles:w},h.tsx("div",{class:_.rampContainer,bind:d,afterCreate:c.attachToNode})),h.tsx("div",{styles:w},h.tsx("div",{class:_.rampLabelsContainer,styles:S},b)))):null)},r._renderUnivariateColorSizeRamp=function(e,t,a){const{sizeRampElement:r,colorRampElement:s}=p.getUnivariateColorSizeRampElements(e);if(!r)return null;const l=p.getUnivariateColorRampMargin(r),i=12,n=p.getUnivariateColorRampSize(r,"full",!1),o=p.getUnivariateColorRampPreview(s,{width:i,height:n,rampAlignment:"vertical",opacity:t,type:"full",effectList:a}),d=r.infos.length-1,y=r.infos.map(((e,t)=>0===t||t===d?h.tsx("div",{key:t,class:e.label?s?_.univariateAboveAndBelowLabel:_.rampLabel:null},e.label):null)),m={display:"table-cell",verticalAlign:"middle"},g={marginTop:`${l}px`},v={height:`${n}px`};return h.tsx("div",{key:"univariate-above-and-below-ramp-preview",styles:x},h.tsx("div",{class:_.layerBody},r.infos.map((e=>h.tsx("div",{class:this.classes(_.layerRow,_.sizeRamp)},h.tsx("div",{class:_.symbol,styles:m,bind:e.preview,afterCreate:c.attachToNode}))))),h.tsx("div",{styles:g,key:"color-ramp-preview"},h.tsx("div",{styles:L},h.tsx("div",{styles:w},h.tsx("div",{class:_.rampContainer,bind:o,afterCreate:c.attachToNode})),h.tsx("div",{styles:w},h.tsx("div",{class:_.rampLabelsContainer,styles:v},y)))))},r._renderLegendForRamp=function(e,t){const a=e.infos,r="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,i=e.preview,n=r?_.opacityRamp:"";i.className=`${_.colorRamp} ${n}`,null!=t&&(i.style.opacity=t.toString());const o=a.map((e=>h.tsx("div",{class:e.label?_.rampLabel:null},s?this.messages[e.label]:l?this._getStretchStopLabel(e):e.label))),d={width:`${f}px`},p={height:i.style.height};return h.tsx("div",{class:_.layerRow},h.tsx("div",{class:_.symbolContainer,styles:d},h.tsx("div",{class:_.rampContainer,bind:i,afterCreate:c.attachToNode})),h.tsx("div",{class:_.layerInfo},h.tsx("div",{class:_.rampLabelsContainer,styles:p},o)))},r._getStretchStopLabel=function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:u.formatNumber(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""},r._renderLegendForElementInfo=function(e,t,a,r,s){if(e.type)return this._renderLegendForElement(e,t,a,!0);let l=null;const i=c.isImageryStretchedLegend(t,s);if(e.preview?l=h.tsx("div",{class:_.symbol,bind:e.preview,afterCreate:c.attachToNode}):e.src&&(l=this._renderImage(e,t,i)),!l)return null;const n={[_.imageryLayerInfoStretched]:i},o={[_.imageryLayerInfoStretched]:i,[_.sizeRamp]:!i&&r};return h.tsx("div",{class:_.layerRow},h.tsx("div",{class:this.classes(_.symbolContainer,o)},l),h.tsx("div",{class:this.classes(_.layerInfo,n)},c.getTitle(this.messages,e.label,!1)||""))},r._renderImage=function(e,t,a){const{label:r,src:s,opacity:l}=e,i={[_.imageryLayerStretchedImage]:a,[_.symbol]:!a},n={opacity:`${null!=l?l:t.opacity}`};return h.tsx("img",{alt:c.getTitle(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(i),styles:n})},a}(o);t.__decorate([r.property()],C.prototype,"activeLayerInfos",void 0),t.__decorate([r.property()],C.prototype,"headingLevel",void 0),t.__decorate([r.property(),g.messageBundle("esri/widgets/Legend/t9n/Legend")],C.prototype,"messages",void 0),t.__decorate([r.property({readOnly:!0})],C.prototype,"type",void 0),C=t.__decorate([n.subclass("esri.widgets.Legend.styles.Classic")],C);return C}));
