// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../../../intl","../../../core/accessorSupport/decorators","../../Widget","./support/utils","../support/styleUtils","../../support/widget"],(function(e,r,t,s,l,i,a,n,o){"use strict";var d="esri-legend__service",p="esri-legend__service-label",c="esri-legend__layer",g="esri-legend__group-layer",y="esri-legend__group-layer-child",_="esri-legend__layer-table",u="esri-legend__layer-table--size-ramp",m="esri-legend__layer-child-table",h="esri-legend__layer-caption",v="esri-legend__layer-body",f="esri-legend__layer-row",b="esri-legend__layer-cell esri-legend__layer-cell--info",x="esri-legend__imagery-layer-image--stretched",L="esri-legend__imagery-layer-info--stretched",w="esri-legend__layer-cell esri-legend__layer-cell--symbols",F="esri-legend__symbol",I="esri-legend__ramps",S="esri-legend__size-ramp",T="esri-legend__color-ramp",E="esri-legend__opacity-ramp",R="esri-legend__ramp-labels",N="esri-legend__ramp-label",z="esri-legend__message",C="esri-widget__heading";return function(e){function r(r,t){var s=e.call(this,r,t)||this;return s.activeLayerInfos=null,s.messages=null,s.type="classic",s}return t.__extends(r,e),r.prototype.render=function(){var e=this,r=this.activeLayerInfos,t=r&&r.toArray().map((function(r){return e._renderLegendForLayer(r)})).filter((function(e){return!!e}));return o.tsx("div",null,t&&t.length?t:o.tsx("div",{class:z},this.messages.noLegend))},r.prototype._renderLegendForLayer=function(e){var r,t=this;if(!e.ready)return null;var s=!!e.children.length,l="esri-legend__"+e.layer.uid+"-version-"+e.version,i=e.title?o.tsx("h3",{class:this.classes(C,p)},e.title):null;if(s){var a=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return o.tsx("div",{key:l,class:this.classes(d,g)},i,a)}var n=e.legendElements;if(n&&!n.length)return null;var _=n.map((function(r){return t._renderLegendForElement(r,e.layer)})).filter((function(e){return!!e}));if(!_.length)return null;var u=((r={})[y]=!!e.parent,r);return o.tsx("div",{key:l,class:this.classes(d,u)},i,o.tsx("div",{class:c},_))},r.prototype._renderLegendForElement=function(e,r,t){var s,l=this,i="color-ramp"===e.type,d="opacity-ramp"===e.type,p="size-ramp"===e.type,c=null;if("symbol-table"===e.type||p){var g=e.infos.map((function(t){return l._renderLegendForElementInfo(t,r,p,e.legendType)})).filter((function(e){return!!e}));g.length&&(c=o.tsx("div",{class:v},g))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?c=this._renderLegendForRamp(e,r.opacity):"relationship-ramp"===e.type&&(c=a.renderRelationshipRamp(e,this.id,r.opacity));if(!c)return null;var y=e.title,f=null;if("string"==typeof y)f=y;else if(y){var b=n.getTitle(this.messages,y,i||d);f=n.isRendererTitle(y,i||d)&&y.title?y.title+" ("+b+")":b}var x=t?m:_,L=f?o.tsx("div",{class:h},f):null,w=((s={})[u]=p||!t,s);return o.tsx("div",{class:this.classes(x,w)},L,c)},r.prototype._renderLegendForRamp=function(e,r){var t=this,s=e.infos,l="opacity-ramp"===e.type,i="heatmap-ramp"===e.type,a="stretch-ramp"===e.type,d=e.preview,p=l?E:"";d.className=T+" "+p,null!=r&&(d.style.opacity=r.toString());var c=s.map((function(e){return o.tsx("div",{class:e.label?N:null},i?t.messages[e.label]:a?t._getStretchStopLabel(e):e.label)})),g={width:"24px"},y={height:d.style.height};return o.tsx("div",{class:f},o.tsx("div",{class:w,styles:g},o.tsx("div",{class:I,bind:d,afterCreate:n.attachToNode})),o.tsx("div",{class:b},o.tsx("div",{class:R,styles:y},c)))},r.prototype._getStretchStopLabel=function(e){return e.label?this.messages[e.label]+": "+s.formatNumber(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"}):""},r.prototype._renderLegendForElementInfo=function(e,r,t,s){var l,i;if(e.type)return this._renderLegendForElement(e,r,!0);var a=null,d=n.isImageryStretchedLegend(r,s);if(e.symbol&&e.preview?a=o.tsx("div",{class:F,bind:e.preview,afterCreate:n.attachToNode}):e.src&&(a=this._renderImage(e,r,d)),!a)return null;var p=((l={})[L]=d,l),c=((i={})[L]=d,i[S]=!d&&t,i);return o.tsx("div",{class:f},o.tsx("div",{class:this.classes(w,c)},a),o.tsx("div",{class:this.classes(b,p)},n.getTitle(this.messages,e.label,!1)||""))},r.prototype._renderImage=function(e,r,t){var s,l=e.label,i=e.src,a=e.opacity,d=((s={})[x]=t,s[F]=!t,s),p={opacity:""+(null!=a?a:r.opacity)};return o.tsx("img",{alt:n.getTitle(this.messages,l,!1),src:i,border:0,width:e.width,height:e.height,class:this.classes(d),styles:p})},t.__decorate([o.renderable(),l.property()],r.prototype,"activeLayerInfos",void 0),t.__decorate([l.property(),o.renderable(),o.messageBundle("esri/widgets/Legend/t9n/Legend")],r.prototype,"messages",void 0),t.__decorate([l.property({readOnly:!0})],r.prototype,"type",void 0),r=t.__decorate([l.subclass("esri.widgets.Legend.styles.Classic")],r)}(i)}));