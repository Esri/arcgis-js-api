/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../intl/number","../../../intl","../../support/widgetUtils","../../support/decorators/messageBundle","../../../chunks/index","../../Widget","./support/relationshipUtils","./support/univariateUtils","../support/styleUtils"],(function(e,a,r,s,l,t,i,n,o,d,p,c,y,m,g,v,h,u,b){"use strict";const _={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},f="esri-legend__",x=24,L={display:"flex",alignItems:"flex-start"},j={marginLeft:"3px"},w={display:"table-cell",verticalAlign:"middle"};let C=function(a){function r(e,r){var s;return(s=a.call(this,e,r)||this).activeLayerInfos=null,s.messages=null,s.type="classic",s}e._inheritsLoose(r,a);var s=r.prototype;return s.render=function(){const e=this.activeLayerInfos,a=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return g.jsx("div",null,a&&a.length?a:g.jsx("div",{class:_.message},this.messages.noLegend))},s._renderLegendForLayer=function(e){if(!e.ready)return null;const a=!!e.children.length,r=`${f}${e.layer.uid}-version-${e.version}`,s=e.title?g.jsx("h3",{class:this.classes(_.header,_.label)},e.title):null;if(a){const a=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return g.jsx("div",{key:r,class:this.classes(_.service,_.groupLayer)},s,a)}{const a=e.legendElements;if(a&&!a.length)return null;const l=a.map((a=>this._renderLegendForElement(a,e.layer))).filter((e=>!!e));if(!l.length)return null;const t={[_.groupLayerChild]:!!e.parent};return g.jsx("div",{key:r,class:this.classes(_.service,t),tabIndex:0},s,g.jsx("div",{class:_.layer},l))}},s._renderLegendForElement=function(e,a,r){const s="color-ramp"===e.type,l="opacity-ramp"===e.type,t="size-ramp"===e.type;let i=null;if("symbol-table"===e.type||t){const r=e.infos.map((r=>this._renderLegendForElementInfo(r,a,t,e.legendType))).filter((e=>!!e));r.length&&(i=g.jsx("div",{class:_.layerBody},r))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?i=this._renderLegendForRamp(e,a.opacity):"relationship-ramp"===e.type?i=h.renderRelationshipRamp(e,this.id,a.opacity):"univariate-above-and-below-ramp"===e.type?i=this._renderUnivariateAboveAndBelowRamp(e,a.opacity):"univariate-color-size-ramp"===e.type&&(i=this._renderUnivariateColorSizeRamp(e,a.opacity));if(!i)return null;const n=e.title;let o=null;if("string"==typeof n)o=n;else if(n){const e=b.getTitle(this.messages,n,s||l);o=b.isRendererTitle(n,s||l)&&n.title?`${n.title} (${e})`:e}const d=r?_.layerChildTable:_.layerTable,p=o?g.jsx("div",{class:_.layerCaption},o):null,c={[_.layerTableSizeRamp]:t||!r};return g.jsx("div",{class:this.classes(d,c)},p,i)},s._renderUnivariateAboveAndBelowRamp=function(e,a){const{sizeRampElement:r,colorRampElement:s}=u.getUnivariateAboveAndBelowRampElements(e,a),l=u.getUnivariateColorRampSize(r,"above",!0),t=u.getUnivariateColorRampSize(r,"below",!0),i=12,n=u.getUnivariateColorRampPreview(s,{width:i,height:l,rampAlignment:"vertical",opacity:a,type:"above"}),o=u.getUnivariateColorRampPreview(s,{width:i,height:t,rampAlignment:"vertical",opacity:a,type:"below"}),d=u.getUnivariateColorRampMargin(r),p=r.infos.map((e=>e.label)),c=p.map(((e,a)=>{const r=2===a;return 0===a?g.jsx("div",{key:a,class:e?n?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):r?g.jsx("div",null):null})),y=p.length-1,m=Math.floor(p.length/2),v=p.map(((e,a)=>a===m||a===y?g.jsx("div",{key:a,class:e?n?_.univariateAboveAndBelowLabel:_.rampLabel:null},e):null)),h={display:"table-cell",verticalAlign:"middle"},f={marginTop:`${d}px`},x={height:`${l}px`},C={height:`${t}px`};return g.jsx("div",{key:"univariate-above-and-below-ramp-preview",styles:L},g.jsx("div",{class:_.layerBody},r.infos.map(((e,a)=>g.jsx("div",{class:this.classes(_.layerRow,_.sizeRamp)},g.jsx("div",{class:_.symbol,styles:h,bind:e.preview,afterCreate:b.attachToNode}),n||a%2!=0?null:g.jsx("div",{class:_.layerInfo},p[a]))))),n?g.jsx("div",{styles:f,key:"color-ramp-preview"},g.jsx("div",{styles:j},g.jsx("div",{styles:w},g.jsx("div",{class:_.rampContainer,bind:n,afterCreate:b.attachToNode})),g.jsx("div",{styles:w},g.jsx("div",{class:_.rampLabelsContainer,styles:x},c))),g.jsx("div",{styles:j},g.jsx("div",{styles:w},g.jsx("div",{class:_.rampContainer,bind:o,afterCreate:b.attachToNode})),g.jsx("div",{styles:w},g.jsx("div",{class:_.rampLabelsContainer,styles:C},v)))):null)},s._renderUnivariateColorSizeRamp=function(e,a){const{sizeRampElement:r,colorRampElement:s}=u.getUnivariateColorSizeRampElements(e),l=u.getUnivariateColorRampMargin(r),t=12,i=u.getUnivariateColorRampSize(r,"full",!1),n=u.getUnivariateColorRampPreview(s,{width:t,height:i,rampAlignment:"vertical",opacity:a,type:"full"}),o=r.infos.length-1,d=r.infos.map(((e,a)=>0===a||a===o?g.jsx("div",{key:a,class:e.label?s?_.univariateAboveAndBelowLabel:_.rampLabel:null},e.label):null)),p={display:"table-cell",verticalAlign:"middle"},c={marginTop:`${l}px`},y={height:`${i}px`};return g.jsx("div",{key:"univariate-above-and-below-ramp-preview",styles:L},g.jsx("div",{class:_.layerBody},r.infos.map((e=>g.jsx("div",{class:this.classes(_.layerRow,_.sizeRamp)},g.jsx("div",{class:_.symbol,styles:p,bind:e.preview,afterCreate:b.attachToNode}))))),g.jsx("div",{styles:c,key:"color-ramp-preview"},g.jsx("div",{styles:j},g.jsx("div",{styles:w},g.jsx("div",{class:_.rampContainer,bind:n,afterCreate:b.attachToNode})),g.jsx("div",{styles:w},g.jsx("div",{class:_.rampLabelsContainer,styles:y},d)))))},s._renderLegendForRamp=function(e,a){const r=e.infos,s="opacity-ramp"===e.type,l="heatmap-ramp"===e.type,t="stretch-ramp"===e.type,i=e.preview,n=s?_.opacityRamp:"";i.className=`${_.colorRamp} ${n}`,null!=a&&(i.style.opacity=a.toString());const o=r.map((e=>g.jsx("div",{class:e.label?_.rampLabel:null},l?this.messages[e.label]:t?this._getStretchStopLabel(e):e.label))),d={width:`${x}px`},p={height:i.style.height};return g.jsx("div",{class:_.layerRow},g.jsx("div",{class:_.symbolContainer,styles:d},g.jsx("div",{class:_.rampContainer,bind:i,afterCreate:b.attachToNode})),g.jsx("div",{class:_.layerInfo},g.jsx("div",{class:_.rampLabelsContainer,styles:p},o)))},s._getStretchStopLabel=function(e){return e.label?this.messages[e.label]+": "+p.formatNumber(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"}):""},s._renderLegendForElementInfo=function(e,a,r,s){if(e.type)return this._renderLegendForElement(e,a,!0);let l=null;const t=b.isImageryStretchedLegend(a,s);if(e.preview?l=g.jsx("div",{class:_.symbol,bind:e.preview,afterCreate:b.attachToNode}):e.src&&(l=this._renderImage(e,a,t)),!l)return null;const i={[_.imageryLayerInfoStretched]:t},n={[_.imageryLayerInfoStretched]:t,[_.sizeRamp]:!t&&r};return g.jsx("div",{class:_.layerRow},g.jsx("div",{class:this.classes(_.symbolContainer,n)},l),g.jsx("div",{class:this.classes(_.layerInfo,i)},b.getTitle(this.messages,e.label,!1)||""))},s._renderImage=function(e,a,r){const{label:s,src:l,opacity:t}=e,i={[_.imageryLayerStretchedImage]:r,[_.symbol]:!r},n={opacity:`${null!=t?t:a.opacity}`};return g.jsx("img",{alt:b.getTitle(this.messages,s,!1),src:l,border:0,width:e.width,height:e.height,class:this.classes(i),styles:n})},r}(v);return a.__decorate([t.property()],C.prototype,"activeLayerInfos",void 0),a.__decorate([t.property(),m.messageBundle("esri/widgets/Legend/t9n/Legend")],C.prototype,"messages",void 0),a.__decorate([t.property({readOnly:!0})],C.prototype,"type",void 0),C=a.__decorate([i.subclass("esri.widgets.Legend.styles.Classic")],C),C}));
