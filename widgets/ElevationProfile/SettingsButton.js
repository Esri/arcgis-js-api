/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/handleUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/events","../../core/unitUtils","../support/widgetUtils","../support/decorators/messageBundle","../support/decorators/renderable","../../chunks/index","../Widget","../support/Popover","./css"],(function(e,t,o,s,n,r,i,p,a,l,c,u,_,d,h,v,S,g,f,m,y,P){"use strict";e.SettingsButton=function(e){function o(t,o){var s;return(s=e.call(this,t,o)||this)._messagesUnits=null,s._popover=null,s._buttonElement=null,s._clickOutsideHandle=null,s._requestFocusOnCreate=!1,s}t._inheritsLoose(o,e);var s=o.prototype;return s.destroy=function(){this._destroyPopover()},s.render=function(){const e=n.isSome(this._popover)&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return f.jsx("button",{class:this.classes(P.SETTINGS_CSS.base),title:e,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":e})},s._initializePopover=function(e){this._destroyPopover(),this._buttonElement=e;const t=parseInt(getComputedStyle(e).getPropertyValue("--button-offset"),10);this._popover=new y({owner:this,placement:"bottom-end",offset:[t,0],anchorElement:e,renderContentFunction:()=>this._renderPopoverContent()})},s._destroyPopover=function(){n.applySome(this._clickOutsideHandle,(e=>e.remove())),n.destroyMaybe(this._popover)},s._renderPopoverContent=function(){const e=this._messagesUnits,{unit:t,unitOptions:o}=this.viewModel;return f.jsx("div",{class:P.SETTINGS_CSS.popoverContent,bind:this,onkeydown:this._onPopoverKeyDown,afterCreate:this._onPopoverContentAfterCreate},f.jsx("label",{class:P.SETTINGS_CSS.selectLabel},this._messages.unitSelectLabel),f.jsx("select",{class:P.SETTINGS_CSS.select,value:t,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},o.map((t=>f.jsx("option",{key:t,value:t},h.isMeasurementSystem(t)?e.systems[t]:e.units[t].pluralCapitalized)))))},s._onUnitChange=function(e){const t=e.target;this.viewModel.unit=t.value,this._closePopover()},s._onUnitSelectAfterCreate=function(e){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,e.focus())},s._onPopoverKeyDown=function(e){switch(e.key){case"Enter":case"Escape":e.stopPropagation(),e.preventDefault(),this._closePopover()}},s._togglePopover=function(e){n.isSome(this._popover)&&this._popover.open?this._closePopover():this._openPopover()},s._openPopover=function(){n.applySome(this._popover,(e=>e.open=!0)),this._requestFocusOnCreate=!0},s._closePopover=function({focusOnButton:e=!0}={}){n.applySome(this._popover,(e=>e.open=!1)),n.applySome(this._clickOutsideHandle,(e=>e.remove())),e&&n.applySome(this._buttonElement,(e=>e.focus()))},s._onPopoverContentAfterCreate=function(e){n.applySome(this._clickOutsideHandle,(e=>e.remove())),this._clickOutsideHandle=p.handlesGroup([d.on(e,"click",(e=>e.stopPropagation())),d.on(window,"click",(()=>this._closePopover({focusOnButton:!1})))])},o}(m),o.__decorate([a.property(),g.renderable(["unit","unitOptions"])],e.SettingsButton.prototype,"viewModel",void 0),o.__decorate([a.property(),g.renderable(),S.messageBundle("esri/widgets/ElevationProfile/t9n/ElevationProfile")],e.SettingsButton.prototype,"_messages",void 0),o.__decorate([a.property(),g.renderable(),S.messageBundle("esri/core/t9n/Units")],e.SettingsButton.prototype,"_messagesUnits",void 0),e.SettingsButton=o.__decorate([l.subclass("esri.widgets.ElevationProfile.SettingsButton")],e.SettingsButton),Object.defineProperty(e,"__esModule",{value:!0})}));
