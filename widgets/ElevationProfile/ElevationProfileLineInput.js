/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/handleUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../Color","../../core/watchUtils","../../core/memoize","../../support/elevationInfoUtils","./ElevationProfileLine","../../layers/support/ElevationQuery"],(function(e,t,o,r,n,i,a,l,s,c,p,u,v,y,d,f,h,_){"use strict";let E=function(t){function o(e){var o;return(o=t.call(this,e)||this).type="input",o.color=new v("#00c8c8"),o.numSamplesForPreview=50,o.numSamplesPerChunk=500,o.chartFillEnabled=!1,o.chartStrokeOffsetY=-1,o._getQueryElevationDependencies=d.memoize(((e,t,o,n,i)=>r.applySome(e,(e=>({elevationInfo:e,visibleLayers:t,view:o,stationary:n,spatialReference:i}))))),o}e._inheritsLoose(o,t);var n=o.prototype;return n.queryElevation=async function(e,{noDataValue:t,signal:o}){const n=this.queryElevationDependencies;if(r.isNone(n))throw new Error("ElevationProfileLineInput: no dependencies");const{view:i,elevationInfo:a,spatialReference:l}=n;if("on-the-ground"===a.mode&&"3d"===i.type){const n=await _.GeometryDescriptor.fromGeometry(e).project(l,o),a=i.elevationProvider;return n.coordinates.forEach((e=>{e.z=r.unwrapOr(a.getElevation(e.x,e.y,0,l,"ground"),0)})),{geometry:n.export(),noDataValue:t}}return{geometry:e,noDataValue:t}},n.attach=function(e){const o=()=>this._onChange();return a.handlesGroup([t.prototype.attach.call(this,e),this.watch("queryElevationDependencies",o),y.on(e,"view.elevationProvider","elevation-change",o)])},e._createClass(o,[{key:"queryElevationDependencies",get:function(){const e=this._viewModel.view;return r.isNone(e)?null:this._getQueryElevationDependencies(this._elevationInfo,this._visibleLayers,e,e.stationary,e.spatialReference)}},{key:"available",get:function(){return!this._viewModel.inputIsSketched}},{key:"_elevationInfo",get:function(){return r.applySome(this._viewModel.input,f.getGraphicEffectiveElevationInfo)}},{key:"_visibleLayers",get:function(){var e;const t=null==(e=this._viewModel)?void 0:e.view,o=r.applySome(t,(e=>{var t,o;return null==(t=e.map)||null==(o=t.allLayers)?void 0:o.filter((e=>e.visible)).toArray()}));return r.unwrapOr(o,[])}}]),o}(h.ElevationProfileLine);return t.__decorate([l.property({type:v,nonNullable:!0})],E.prototype,"color",void 0),t.__decorate([l.property()],E.prototype,"queryElevationDependencies",null),t.__decorate([l.property()],E.prototype,"available",null),t.__decorate([l.property()],E.prototype,"_elevationInfo",null),t.__decorate([l.property()],E.prototype,"_visibleLayers",null),E=t.__decorate([s.subclass("esri.widgets.ElevationProfile.ElevationProfileLineInput")],E),E}));
