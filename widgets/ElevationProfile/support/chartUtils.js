/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../intl","../../../core/arrayUtils","../../../core/handleUtils","../../../core/maybe","../../../core/promiseUtils","../../../core/unitFormatUtils","../../../core/unitUtils","../css","./constants","./intlUtils","./niceScale","../../support/chartUtils","../../support/widgetUtils","../../../support/themeUtils","../../../intl/substitute","../../../intl/number"],(function(e,i,t,o,n,a,s,l,r,d,c,m,p,u,x,g,f,h){"use strict";const b="#f8f8f8",v="#a9a9a9",y="#323232",T="line",S="fill",C=15,A=12,L=30,k=.001,P=.5,z=.5,F=30,w=.02,M=.02,N={sideSpacing:C,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,axisFontSize:9,axisFontWeight:"400",axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:v,axisTooltipFontSize:12,axisTooltipBackgroundColor:y,axisTooltipLabelColor:b,axisTooltipPaddingTop:Math.round(A/4),axisTooltipPaddingBottom:Math.round(A/4),axisTooltipPaddingHorizontal:Math.round(C/4),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(A/2),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(C/4),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:b,seriesTooltipLabelColor:y,seriesFillLighten:.9,seriesTooltipSpacing:A/2,seriesTooltipPaddingVertical:Math.round(C/4),seriesTooltipPaddingHorizontal:Math.round(C/4),tooltipBorderRadius:0},Y={...N,axisGridStroke:y,axisLabelsColor:v,axisTooltipBackgroundColor:y,axisTooltipLabelColor:b,seriesTooltipBackgroundColor:y,seriesTooltipLabelColor:b,seriesFillLighten:-.75},H={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};function I(e){return X.apply(this,arguments)}function X(){return(X=i._asyncToGenerator((function*(e){const i=yield u.loadChartsModule(),{am4core:t,am4charts:o}=i;s.throwIfAborted(e.abortOptions);const{options:l}=t;l.minPolylineStep=P,l.autoSetClassName=!0,l.animationsEnabled=!1;const r=g.isDarkTheme(),d=r?Y:N;r&&t.useTheme(i.am4themes_dark);const c=t.create(e.container,o.XYChart);c.arrangeTooltips=!1,c.preloader.disabled=!0,c.zoomOutButton.disabled=!0;const m=x.isRTL(e.container);c.rtl=m,c.padding(d.paddingTop,m?d.paddingLeft:d.paddingRight,d.paddingBottom,m?d.paddingRight:d.paddingLeft);const p=c.plotContainer.background;p.strokeWidth=0,p.strokeOpacity=0,p.stroke=null;const f=c.xAxes.push(new o.ValueAxis),h=c.yAxes.push(new o.ValueAxis),b={params:e,amCharts4Index:i,amChart:c,xAxis:f,yAxis:h,series:new Map,data:null,messages:null,theme:d,zooming:!1,pointerIsOver:!1};c.cursor=O(b),W(b),B(b),D(b);const v=[J(b,e.onRangeChange),Q(b,e.onCursorPositionChange),K(b)];let y=null,T=!1;const S=()=>{a.isNone(y)||("undefined"!=typeof window&&"cancelIdleCallback"in window?window.cancelIdleCallback(y):clearTimeout(y),y=null)};return{...b,destroy(){T=!0,S(),n.handlesGroup(v).remove(),c.dispose()},update(e){if(e.data===b.data&&e.messages===b.messages)return;if(S(),T)return;const i=()=>{T||(y=null,U(b,e))};y="undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(i,{timeout:F}):setTimeout(i,F)},zoomOut(){T||(b.yAxis.zoom({start:0,end:1},!1,!0),b.xAxis.zoom({start:0,end:1},!1,!0))}}}))).apply(this,arguments)}function O(e){const i=new e.amCharts4Index.am4charts.XYCursor;return i.trackable=!0,i.lineY.disabled=!0,i.behavior="zoomXY",i}function W(e){const i=e.theme,t=e.amChart.tooltip,{am4core:o}=e.amCharts4Index;t.id="series-tooltip",t.fitPointerToBounds=!0,t.pointerOrientation="vertical",t.zIndex=-1,t.getFillFromObject=!1,t.label.fontSize=i.seriesTooltipFontSize,t.label.fill=o.color(i.seriesTooltipLabelColor),t.label.padding(i.seriesTooltipPaddingVertical,i.seriesTooltipPaddingHorizontal,i.seriesTooltipPaddingVertical,i.seriesTooltipPaddingHorizontal),t.background.cornerRadius=i.tooltipBorderRadius,t.background.stroke=null,t.background.fill=o.color(i.seriesTooltipBackgroundColor),t.background.padding(0,0,0,0),t.adapter.add("dy",(()=>i.seriesTooltipSpacing*(t.background.pointerY<=0?1:-1))),x.isRTL(e.params.container)&&(t.label.textAlign="middle")}function B(e){const{xAxis:i,theme:t}=e,{am4core:o}=e.amCharts4Index;i.numberFormatter=ae(e,"distance"),i.strictMinMax=!0,i.cursorTooltipEnabled=!1,i.title.visible=!1;const n=i.renderer;n.line.visible=!1,n.minGridDistance=t.xAxisMinGridDistance,n.minLabelPosition=t.xAxisMinLabelPosition,n.maxLabelPosition=t.xAxisMaxLabelPosition,n.fontWeight=t.axisFontWeight,n.fontSize=t.axisFontSize,n.baseGrid.disabled=!0;const a=n.labels.template;a.fontSize=t.axisLabelsFontSize,a.fontWeight=t.axisLabelsFontWeight,a.fill=o.color(t.axisLabelsColor),a.paddingTop=t.xAxisLabelsSpacing,a.horizontalCenter="left",a.paddingLeft=0;const s=i.tooltip;s.id="axis-tooltip",s.background.fill=o.color(t.axisTooltipBackgroundColor),s.background.stroke=null,s.background.padding(0,0,0,0),s.label.fontSize=t.axisTooltipFontSize,s.label.fill=o.color(t.axisTooltipLabelColor),s.label.padding(t.axisTooltipPaddingTop,t.axisTooltipPaddingHorizontal,t.axisTooltipPaddingBottom,t.axisTooltipPaddingHorizontal);const l=n.grid.template;l.strokeOpacity=1,l.stroke=o.color(t.axisGridStroke)}function D(e){const{yAxis:i,theme:t}=e,{am4core:o}=e.amCharts4Index;i.numberFormatter=ae(e,"elevation"),i.title.visible=!1,i.cursorTooltipEnabled=!1,i.strictMinMax=!0,i.baseValue=c.getConfig().noDataValue;const n=i.renderer;n.inside=!0,n.line.opacity=0,n.line.visible=!1,n.minGridDistance=t.yAxisMinGridDistance,n.minLabelPosition=t.yAxisMinLabelPosition,n.maxLabelPosition=t.yAxisMaxLabelPosition,n.fontWeight=t.axisFontWeight,n.fontSize=t.axisFontSize,n.baseGrid.disabled=!0;const a=n.labels.template;a.fontSize=t.axisLabelsFontSize,a.fontWeight=t.axisLabelsFontWeight,a.fill=o.color(t.axisLabelsColor),a.verticalCenter="bottom",a.paddingLeft=t.yAxisLabelSpacing,a.paddingBottom=0;const s=n.grid.template;s.strokeOpacity=1,s.stroke=o.color(t.axisGridStroke),x.isRTL(e.params.container)&&(n.opposite=!0,a.textAlign="middle",a.paddingLeft=0,a.paddingRight=t.yAxisLabelSpacing)}function U(e,{data:i,messages:t}){const{htmlContainer:o}=e.amChart;if(!o)return;const n=a.isSome(i)&&i.refined;e.amChart.cursor.disabled=!n,o.classList.toggle(d.CHART_CSS.cursorEnabled,n);const s=e.data!==i,l=a.applySome(e.data,(e=>e.effectiveUnits))!==a.applySome(i,(e=>e.effectiveUnits));e.data=i,e.messages=t,s&&(R(e),$(e)),l&&(e.yAxis.invalidateLabels(),e.xAxis.invalidateLabels()),ee(e)}function R(e){const{xAxis:i,yAxis:t}=e,{minX:o,maxX:n,minY:a,maxY:s}=E({data:e.data,pixelWidth:i.pixelWidth,pixelHeight:t.pixelHeight});i.min=o,i.max=n,t.min=a,t.max=s}function E({data:e,pixelWidth:i,pixelHeight:t}){if(a.isNone(e))return H;const o=e.statistics,n=0,s=a.applySome(o,(e=>e.maxDistance));let l=a.applySome(o,(e=>e.minElevation)),d=a.applySome(o,(e=>e.maxElevation));if(a.isNone(s)||a.isNone(l)||a.isNone(d))return H;const m=Math.max(s-n,k);let u=Math.max(d-l,k);const x=e.effectiveUnits;if(e.dynamicElevationRange){const e=r.convertUnit(m,x.distance,x.elevation);u=Math.max(u,e/c.getConfig().maxChartRatio)}return l-=M*u,d=l+u+w*u,[l,d]=p.niceScale(l,d,10),u=d-l,e.uniformScaling?G({data:e,bounds:{minX:n,maxX:s,minY:l,maxY:d},pixelWidth:i,pixelHeight:t,centered:!0}):{minX:n,maxX:n+m,minY:l,maxY:l+u}}function G({data:e,bounds:i,pixelWidth:t,pixelHeight:o,centered:n}){if(a.isNone(e))return i;let{minX:s,maxX:l,minY:d,maxY:c}=i;const m=l-s,p=c-d,u=e.effectiveUnits,x=r.convertUnit(p,u.elevation,u.distance)/o/(m/t);return x>=1?[s,l]=V([s,l],x,n):[d,c]=V([d,c],1/x,n),{minX:s,maxX:l,minY:d,maxY:c}}function V([e,i],t,o){const n=(i-e)*t;if(o){const t=(e+i)/2-n/2;return[t,t+n]}return[e,e+n]}function $(e){const{amChart:i,data:t}=e;if(a.isNone(t)||0===t.lines.length)return void i.series.clear();const o=new Map,n=new Set(i.series.values),s=t.lines.length;for(let l=0;l<s;l++){const r=t.lines[l];let d=e.series.get(r.id);d?(a.applySome(d.fill,(e=>n.delete(e))),n.delete(d.line)):(d=Z(e,r),a.applySome(d.fill,(e=>i.series.push(e))),i.series.push(d.line)),o.set(d.id,d);const c=s-l-1;a.applySome(d.fill,(e=>e.zIndex=c)),d.line.zIndex=s+c,_(e,d,r)}e.series=o;for(const a of n)i.series.removeValue(a)}function _(e,{line:i,fill:t},o){const{theme:n}=e,{am4core:s}=e.amCharts4Index,{r:l,g:r,b:d,a:c}=o.color,m=s.color({r:l,g:r,b:d,a:c}),p=a.unwrapOr(o.samples,new Array),u=p.length>0;i.stroke=m,i.visible=u,a.applySome(t,(e=>{e.visible=u,e.fill=m.lighten(n.seriesFillLighten)}));const x=p.length,g=i.data;if(g.length===x){let e=!1;for(let i=0;i<x;++i){const t=g[i],o=p[i];e=e||a.isSome(t.elevation)!==a.isSome(o.elevation),j(t,o)}e?(i.invalidateData(),a.applySome(t,(e=>e.invalidateData()))):(i.invalidateRawData(),a.applySome(t,(e=>e.invalidateRawData())))}else i.data=p,a.applySome(t,(e=>e.data=p))}function j(e,i){e.x=i.x,e.y=i.y,e.z=i.z,e.distance=i.distance,e.elevation=i.elevation}function Z(e,i){const{id:t}=i,o=q(e,`${T}-${t}`);o.strokeWidth=i.chartStrokeWidth,o.dy=i.chartStrokeOffsetY;let n=null;return i.chartFillEnabled&&(n=q(e,`${S}-${t}`),n.fillOpacity=1),{id:t,line:o,fill:n}}function q(e,i){const t=new e.amCharts4Index.am4charts.LineSeries;t.id=i,t.showOnInit=!1,t.simplifiedProcessing=!0,t.minDistance=z,t.excludeFromTotal=!0,t.clickable=!1,t.contextMenuDisabled=!0,t.cursorHoverEnabled=!1,t.cursorTooltipEnabled=!1,t.connect=!1,t.fill=null,t.stroke=null;const o="distance";t.dataFields.valueX=o;const n="elevation";return t.dataFields.valueY=n,t}function J(e,i){const{amChart:t,xAxis:o,yAxis:s}=e;let l=!1;const r=()=>{const{data:i}=e;if(!l||a.isNone(i)||!i.uniformScaling)return;l=!1;const{minX:n,maxX:r,minY:d,maxY:c}=G({data:e.data,bounds:{minX:o.minZoomed,maxX:o.maxZoomed,minY:s.minZoomed,maxY:s.maxZoomed},pixelWidth:o.pixelWidth,pixelHeight:s.pixelHeight,centered:!0});o.zoomToValues(n,r,!0),s.zoomToValues(d,c,!0),t.validate(),ee(e)},d=()=>{i(e.xAxis.zoomFactor,e.yAxis.zoomFactor)},c=i=>{e.zooming=i,ee(e)},m=[t.events.on("down",(()=>c(!0))),t.events.on("up",(()=>c(!1))),t.cursor.events.on("zoomended",(()=>{l=!0})),o.events.on("startendchanged",r),s.events.on("startendchanged",r),o.events.on("rangechangeended",d),s.events.on("rangechangeended",d)];return n.makeHandle((()=>{m.forEach((e=>e.dispose()))}))}function K({xAxis:e,yAxis:i}){const t=e=>()=>{e.renderer.grid.each((e=>{e.visible="none"!==e.dataItem.label.dom.getAttribute("display")}))},o=[e.events.on("rangechangeended",t(e)),e.events.on("validated",t(e)),i.events.on("rangechangeended",t(i)),i.events.on("validated",t(i))];return n.makeHandle((()=>{o.forEach((e=>e.dispose()))}))}function Q(e,i){const{amChart:t,xAxis:o,yAxis:a}=e,{cursor:s,events:l}=t,r=i=>{e.pointerIsOver=i,ee(e)},d=()=>{r(!1),i(null,null)},c=[s.events.on("cursorpositionchanged",(()=>{if(!e.pointerIsOver)return;ee(e);const t=o.toAxisPosition(s.xPosition),n=a.toAxisPosition(s.yPosition);i(t,n)})),l.on("over",(()=>r(!0))),l.on("out",d),l.on("blur",d)];return n.makeHandle((()=>{c.forEach((e=>e.dispose()))}))}function ee(e){const{amChart:i,xAxis:t,data:o,theme:n,zooming:s,pointerIsOver:l}=e;if(e.amChart.tooltip.hide(),e.xAxis.hideTooltip(),!l)return;if(s)return;if(a.isNone(o)||!o.refined)return;const r=ie(e);if(a.isSome(r)){const{cursor:o,tooltip:a}=i;o.show(0),o.validate(),a.text=r.text,a.show(0),a.validate();const s=r.y-a.contentHeight-n.seriesTooltipSpacing;a.pointerOrientation=s<L?"up":"down",a.pointTo(r,!0),a.validate();const l=t.tooltip;l.text=ne(e),l.show(0),l.validate()}}function ie(e){const{amChart:i,yAxis:t,data:o}=e;if(a.isNone(o))return null;const n=o.lines.map((i=>({line:i,y:a.applySome(se(e,i),(e=>e.elevation))}))).sort(te),s=n.length?n[0].y:null;if(a.isNone(s))return null;const l=i.cursor,r=t.measuredHeight,d=r+i.pixelPaddingTop;return{text:n.map((({y:i,line:t})=>oe(e,t,i))).join("\n"),x:l.point.x+l.parent.pixelX+i.pixelPaddingLeft,y:d-t.valueToPosition(s)*r}}function te({y:e},{y:i}){return a.isNone(e)?1:a.isNone(i)?-1:i-e}function oe(e,i,t){const{data:o,messages:n}=e;if(a.isNone(o)||a.isNone(n))return"";const s=c.getConfig().formatPrecision,r=f.substitute(n.chartTooltip,{name:m.getTranslatedLineTitle(i,n),elevation:a.isSome(t)?l.formatDecimal(n,t,o.effectiveUnits.elevation,s):c.NOT_AVAILABLE});return`[${i.color.toHex()}]●[/] ${r}`}function ne(e){const{data:i,messages:t}=e;if(a.isNone(i)||a.isNone(t))return"";const o=i.lines[0],n=o?se(e,o):null,s=c.getConfig().formatPrecision;return a.isSome(n)?l.formatDecimal(t,n.distance,i.effectiveUnits.distance,s):"-"}function ae(e,i){const t=e.xAxis.numberFormatter.clone();return t.format=(t,o,n)=>{const{messages:s,data:r}=e;if(a.isNone(s)||a.isNone(r)||"string"==typeof t)return"";return`${h.formatNumber(t,{maximumFractionDigits:n})} ${l.unitName(s,r.effectiveUnits[i],"abbr")}`},t}function se({amChart:e,xAxis:i},t){const n=a.unwrapOr(t.samples,[]);if(0===n.length)return null;const s=i.toAxisPosition(e.cursor.xPosition),l=i.positionToValue(s);return o.binaryFindClosest(n,l,(e=>e.distance))}e.createChart=I,e.getAdjustedBounds=E,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
