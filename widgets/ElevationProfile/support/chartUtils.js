/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../intl","../../../core/arrayUtils","../../../core/handleUtils","../../../core/maybe","../../../core/promiseUtils","../../../core/unitFormatUtils","../../../core/unitUtils","../css","./constants","./intlUtils","./niceScale","../../support/chartUtils","../../support/widgetUtils","../../../core/has","../../../core/Logger","../../../intl/substitute","../../../intl/number"],(function(e,i,t,o,n,a,s,l,r,d,c,p,m,u,x,g,f,h,b){"use strict";const v="#f8f8f8",T="#a9a9a9",y="#323232",A="line",S="fill",C=15,L=12,k=30,P=.001,z=.5,F=.5,M=30,w=.02,I=.02,N={sideSpacing:C,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,axisFontSize:9,axisFontWeight:"400",axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:T,axisTooltipFontSize:12,axisTooltipBackgroundColor:y,axisTooltipLabelColor:v,axisTooltipPaddingTop:Math.round(L/4),axisTooltipPaddingBottom:Math.round(L/4),axisTooltipPaddingHorizontal:Math.round(C/4),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(L/2),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(C/4),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:v,seriesTooltipLabelColor:y,seriesFillLighten:.9,seriesTooltipSpacing:L/2,seriesTooltipPaddingVertical:Math.round(C/4),seriesTooltipPaddingHorizontal:Math.round(C/4),tooltipBorderRadius:0},O={...N,axisGridStroke:y,axisLabelsColor:T,axisTooltipBackgroundColor:y,axisTooltipLabelColor:v,seriesTooltipBackgroundColor:y,seriesTooltipLabelColor:v,seriesFillLighten:-.75},H={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};function Y(e){return X.apply(this,arguments)}function X(){return(X=i._asyncToGenerator((function*(e){const i=yield u.loadChartsModule();s.throwIfAborted(e.abortOptions);const{am4core:t,am4charts:o}=i;t.options.minPolylineStep=z,t.options.autoSetClassName=!0,t.options.animationsEnabled=!1;const l=x.isDarkTheme(),r=l?O:N;l&&t.useTheme(i.am4themes_dark);const d=t.create(e.container,o.XYChart);d.arrangeTooltips=!1,d.preloader.disabled=!0,d.zoomOutButton.disabled=!0;const c=x.isRTL(e.container);d.rtl=c,d.padding(r.paddingTop,c?r.paddingLeft:r.paddingRight,r.paddingBottom,c?r.paddingRight:r.paddingLeft);const p=d.plotContainer.background;p.strokeWidth=0,p.strokeOpacity=0,p.stroke=null;const m=d.xAxes.push(new o.ValueAxis),g=d.yAxes.push(new o.ValueAxis),f={params:e,amCharts4Index:i,amChart:d,xAxis:m,yAxis:g,series:new Map,data:null,messages:null,theme:r,zooming:!1,pointerIsOver:!1};d.cursor=R(f),W(f),B(f),U(f);const h=[K(f,e.onRangeChange),ee(f,e.onCursorPositionChange),Q(f)];let b=null,v=!1;const T=()=>{a.isNone(b)||("undefined"!=typeof window&&"cancelIdleCallback"in window?window.cancelIdleCallback(b):clearTimeout(b),b=null)};return{...f,destroy(){v=!0,T(),n.handlesGroup(h).remove(),d.dispose()},update(e){if(e.data===f.data&&e.messages===f.messages)return;if(T(),v)return;const i=()=>{v||(b=null,E(f,e))};b="undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(i,{timeout:M}):setTimeout(i,M)},zoomOut(){v||(f.yAxis.zoom({start:0,end:1},!1,!0),f.xAxis.zoom({start:0,end:1},!1,!0))}}}))).apply(this,arguments)}function R(e){const i=new e.amCharts4Index.am4charts.XYCursor;return i.trackable=!0,i.lineY.disabled=!0,i.behavior="zoomXY",i}function W(e){const i=e.theme,t=e.amChart.tooltip,{am4core:o}=e.amCharts4Index;t.id="series-tooltip",t.fitPointerToBounds=!0,t.pointerOrientation="vertical",t.zIndex=-1,t.getFillFromObject=!1,t.label.fontSize=i.seriesTooltipFontSize,t.label.fill=o.color(i.seriesTooltipLabelColor),t.label.padding(i.seriesTooltipPaddingVertical,i.seriesTooltipPaddingHorizontal,i.seriesTooltipPaddingVertical,i.seriesTooltipPaddingHorizontal),t.background.cornerRadius=i.tooltipBorderRadius,t.background.stroke=null,t.background.fill=o.color(i.seriesTooltipBackgroundColor),t.background.padding(0,0,0,0),t.adapter.add("dy",(()=>i.seriesTooltipSpacing*(t.background.pointerY<=0?1:-1))),x.isRTL(e.params.container)&&(t.label.textAlign="middle")}function B(e){const{xAxis:i,theme:t}=e,{am4core:o}=e.amCharts4Index;i.numberFormatter=se(e,"distance"),i.strictMinMax=!0,i.cursorTooltipEnabled=!1,i.title.visible=!1;const n=i.renderer;n.line.visible=!1,n.minGridDistance=t.xAxisMinGridDistance,n.minLabelPosition=t.xAxisMinLabelPosition,n.maxLabelPosition=t.xAxisMaxLabelPosition,n.fontWeight=t.axisFontWeight,n.fontSize=t.axisFontSize,n.baseGrid.disabled=!0;const a=n.labels.template;a.fontSize=t.axisLabelsFontSize,a.fontWeight=t.axisLabelsFontWeight,a.fill=o.color(t.axisLabelsColor),a.paddingTop=t.xAxisLabelsSpacing,a.horizontalCenter="left",a.paddingLeft=0;const s=i.tooltip;s.id="axis-tooltip",s.background.fill=o.color(t.axisTooltipBackgroundColor),s.background.stroke=null,s.background.padding(0,0,0,0),s.label.fontSize=t.axisTooltipFontSize,s.label.fill=o.color(t.axisTooltipLabelColor),s.label.padding(t.axisTooltipPaddingTop,t.axisTooltipPaddingHorizontal,t.axisTooltipPaddingBottom,t.axisTooltipPaddingHorizontal);const l=n.grid.template;l.strokeOpacity=1,l.stroke=o.color(t.axisGridStroke)}function U(e){const{yAxis:i,theme:t}=e,{am4core:o}=e.amCharts4Index;i.numberFormatter=se(e,"elevation"),i.title.visible=!1,i.cursorTooltipEnabled=!1,i.strictMinMax=!0,i.baseValue=c.NO_DATA_VALUE;const n=i.renderer;n.inside=!0,n.line.opacity=0,n.line.visible=!1,n.minGridDistance=t.yAxisMinGridDistance,n.minLabelPosition=t.yAxisMinLabelPosition,n.maxLabelPosition=t.yAxisMaxLabelPosition,n.fontWeight=t.axisFontWeight,n.fontSize=t.axisFontSize,n.baseGrid.disabled=!0;const a=n.labels.template;a.fontSize=t.axisLabelsFontSize,a.fontWeight=t.axisLabelsFontWeight,a.fill=o.color(t.axisLabelsColor),a.verticalCenter="bottom",a.paddingLeft=t.yAxisLabelSpacing,a.paddingBottom=0;const s=n.grid.template;s.strokeOpacity=1,s.stroke=o.color(t.axisGridStroke),x.isRTL(e.params.container)&&(n.opposite=!0,a.textAlign="middle",a.paddingLeft=0,a.paddingRight=t.yAxisLabelSpacing)}function E(e,{data:i,messages:t}){const o=a.isSome(i)&&i.refined;e.amChart.cursor.disabled=!o,e.amChart.htmlContainer.classList.toggle(d.CHART_CSS.cursorEnabled,o);const n=e.data!==i,s=a.applySome(e.data,(e=>e.effectiveUnits))!==a.applySome(i,(e=>e.effectiveUnits));e.data=i,e.messages=t,n&&(D(e),$(e)),s&&(e.yAxis.invalidateLabels(),e.xAxis.invalidateLabels()),ie(e)}function D(e){const{xAxis:i,yAxis:t}=e,{minX:o,maxX:n,minY:a,maxY:s}=G({data:e.data,pixelWidth:i.pixelWidth,pixelHeight:t.pixelHeight});i.min=o,i.max=n,t.min=a,t.max=s}function G({data:e,pixelWidth:i,pixelHeight:t}){if(a.isNone(e))return H;const o=e.statistics,n=0,s=a.applySome(o,(e=>e.maxDistance));let l=a.applySome(o,(e=>e.minElevation)),d=a.applySome(o,(e=>e.maxElevation));if(a.isNone(s)||a.isNone(l)||a.isNone(d))return H;const p=Math.max(s-n,P);let u=Math.max(d-l,P);const x=e.effectiveUnits;if(e.dynamicElevationRange){const e=r.convertUnit(p,x.distance,x.elevation);u=Math.max(u,e/c.MAX_CHART_RATIO)}return l-=I*u,d=l+u+w*u,[l,d]=m.niceScale(l,d,10),u=d-l,e.uniformScaling?_({data:e,bounds:{minX:n,maxX:s,minY:l,maxY:d},pixelWidth:i,pixelHeight:t,centered:!0}):{minX:n,maxX:n+p,minY:l,maxY:l+u}}function _({data:e,bounds:i,pixelWidth:t,pixelHeight:o,centered:n}){if(a.isNone(e))return i;let{minX:s,maxX:l,minY:d,maxY:c}=i;const p=l-s,m=c-d,u=e.effectiveUnits,x=r.convertUnit(m,u.elevation,u.distance)/o/(p/t);return x>=1?[s,l]=V([s,l],x,n):[d,c]=V([d,c],1/x,n),{minX:s,maxX:l,minY:d,maxY:c}}function V([e,i],t,o){const n=(i-e)*t;if(o){const t=(e+i)/2-n/2;return[t,t+n]}return[e,e+n]}function $(e){const{amChart:i,data:t}=e;if(a.isNone(t)||0===t.lines.length)return void i.series.clear();const o=new Map,n=new Set(i.series.values),s=t.lines.length;for(let l=0;l<s;l++){const r=t.lines[l];let d=e.series.get(r.id);d?(a.applySome(d.fill,(e=>n.delete(e))),n.delete(d.line)):(d=q(e,r),a.applySome(d.fill,(e=>i.series.push(e))),i.series.push(d.line)),o.set(d.id,d);const c=s-l-1;a.applySome(d.fill,(e=>e.zIndex=c)),d.line.zIndex=s+c,j(e,d,r)}e.series=o;for(const a of n)i.series.removeValue(a)}function j(e,{line:i,fill:t},o){const{theme:n}=e,{am4core:s}=e.amCharts4Index,{r:l,g:r,b:d,a:c}=o.color,p=s.color({r:l,g:r,b:d,a:c}),m=a.unwrapOr(o.samples,[]),u=m.length>0;i.stroke=p,i.visible=u,a.applySome(t,(e=>{e.visible=u,e.fill=p.lighten(n.seriesFillLighten)}));const x=m.length,g=i.data;if(g.length===x){for(let e=0;e<x;++e)Z(g[e],m[e]);i.invalidateRawData(),a.applySome(t,(e=>e.invalidateRawData()))}else i.data=m,a.applySome(t,(e=>e.data=m))}function Z(e,i){e.x=i.x,e.y=i.y,e.z=i.z,e.distance=i.distance,e.elevation=i.elevation}function q(e,i){const{id:t}=i,o=J(e,`${A}-${t}`);o.strokeWidth=i.chartStrokeWidth,o.dy=i.chartStrokeOffsetY;let n=null;return i.chartFillEnabled&&(n=J(e,`${S}-${t}`),n.fillOpacity=1),{id:t,line:o,fill:n}}function J(e,i){const t=new e.amCharts4Index.am4charts.LineSeries;t.id=i,t.showOnInit=!1,t.simplifiedProcessing=!0,t.minDistance=F,t.excludeFromTotal=!0,t.clickable=!1,t.contextMenuDisabled=!0,t.cursorHoverEnabled=!1,t.cursorTooltipEnabled=!1,t.connect=!1,t.fill=null,t.stroke=null;const o="distance";t.dataFields.valueX=o;const n="elevation";return t.dataFields.valueY=n,t}function K(e,i){const{amChart:t,xAxis:o,yAxis:s}=e;let l=!1;const r=()=>{const{data:i}=e;if(!l||a.isNone(i)||!i.uniformScaling)return;l=!1;const{minX:n,maxX:r,minY:d,maxY:c}=_({data:e.data,bounds:{minX:o.minZoomed,maxX:o.maxZoomed,minY:s.minZoomed,maxY:s.maxZoomed},pixelWidth:o.pixelWidth,pixelHeight:s.pixelHeight,centered:!0});o.zoomToValues(n,r,!0),s.zoomToValues(d,c,!0),t.validate(),ie(e)},d=()=>{i(e.xAxis.zoomFactor,e.yAxis.zoomFactor)},c=i=>{e.zooming=i,ie(e)},p=[t.events.on("down",(()=>c(!0))),t.events.on("up",(()=>c(!1))),t.cursor.events.on("zoomended",(()=>{l=!0})),o.events.on("startendchanged",r),s.events.on("startendchanged",r),o.events.on("rangechangeended",d),s.events.on("rangechangeended",d)];return n.makeHandle((()=>{p.forEach((e=>e.dispose()))}))}function Q({xAxis:e,yAxis:i}){const t=e=>()=>{e.renderer.grid.each((e=>{e.visible="none"!==e.dataItem.label.dom.getAttribute("display")}))},o=[e.events.on("rangechangeended",t(e)),e.events.on("validated",t(e)),i.events.on("rangechangeended",t(i)),i.events.on("validated",t(i))];return n.makeHandle((()=>{o.forEach((e=>e.dispose()))}))}function ee(e,i){const{amChart:t,xAxis:o,yAxis:a}=e,{cursor:s,events:l}=t,r=i=>{e.pointerIsOver=i,ie(e)},d=()=>{r(!1),i(null,null)},c=[s.events.on("cursorpositionchanged",(()=>{if(!e.pointerIsOver)return;ie(e);const t=o.toAxisPosition(s.xPosition),n=a.toAxisPosition(s.yPosition);i(t,n)})),l.on("over",(()=>r(!0))),l.on("out",d),l.on("blur",d)];return n.makeHandle((()=>{c.forEach((e=>e.dispose()))}))}function ie(e){const{amChart:i,xAxis:t,data:o,theme:n,zooming:s,pointerIsOver:l}=e;if(e.amChart.tooltip.hide(),e.xAxis.hideTooltip(),!l)return;if(s)return;if(a.isNone(o)||!o.refined)return;const r=te(e);if(a.isSome(r)){const{cursor:o,tooltip:a}=i;o.show(0),o.validate(),a.text=r.text,a.show(0),a.validate();const s=r.y-a.contentHeight-n.seriesTooltipSpacing;a.pointerOrientation=s<k?"up":"down",a.pointTo(r,!0),a.validate();const l=t.tooltip;l.text=ae(e),l.show(0),l.validate()}}function te(e){const{amChart:i,yAxis:t,data:o}=e;if(a.isNone(o))return null;const n=o.lines.map((i=>({line:i,y:a.applySome(le(e,i),(e=>e.elevation))}))).sort(oe),s=n.length?n[0].y:null;if(a.isNone(s))return null;const l=i.cursor,r=t.measuredHeight,d=r+i.pixelPaddingTop;return{text:n.map((({y:i,line:t})=>ne(e,t,i))).join("\n"),x:l.point.x+l.parent.pixelX+i.pixelPaddingLeft,y:d-t.valueToPosition(s)*r}}function oe({y:e},{y:i}){return a.isNone(e)?1:a.isNone(i)?-1:i-e}function ne(e,i,t){const{data:o,messages:n}=e;if(a.isNone(o)||a.isNone(n))return"";const s=h.substitute(n.chartTooltip,{name:p.getTranslatedLineTitle(i,n),elevation:a.isSome(t)?l.formatDecimal(n,t,o.effectiveUnits.elevation,c.FORMAT_PRECISION):c.NOT_AVAILABLE});return`[${i.color.toHex()}]●[/] ${s}`}function ae(e){const{data:i,messages:t}=e;if(a.isNone(i)||a.isNone(t))return"";const o=i.lines[0],n=o?le(e,o):null;return a.isSome(n)?l.formatDecimal(t,n.distance,i.effectiveUnits.distance,c.FORMAT_PRECISION):"-"}function se(e,i){const t=e.xAxis.numberFormatter.clone();return t.format=(t,o,n)=>{const{messages:s,data:r}=e;if(a.isNone(s)||a.isNone(r)||"string"==typeof t)return"";return`${b.formatNumber(t,{maximumFractionDigits:n})} ${l.unitName(s,r.effectiveUnits[i],"abbr")}`},t}function le({amChart:e,xAxis:i},t){const n=a.unwrapOr(t.samples,[]);if(0===n.length)return null;const s=i.toAxisPosition(e.cursor.xPosition),l=i.positionToValue(s);return o.binaryFindClosest(n,l,(e=>e.distance))}e.createChart=Y,e.getAdjustedBounds=G,Object.defineProperty(e,"__esModule",{value:!0})}));
