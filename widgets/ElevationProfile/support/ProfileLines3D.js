/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/maybe","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/accessorSupport/trackingUtils","../../../core/Accessor","../../../geometry/Polyline","../../../Color","../../../core/Handles","../../../chunks/vec4f64","../../../core/throttle","./constants","../../../views/3d/interactive/visualElements/OutlineVisualElement"],(function(e,t,s,o,r,i,n,l,a,c,u,h,p,f,d,_,y,m,v,E,D){"use strict";const L=100;e.ProfileLines3D=function(e){function s(t){var s;return(s=e.call(this,t)||this)._chartData=null,s._visualElements=[],s._handles=new y,s}t._inheritsLoose(s,e);var o=s.prototype;return o.initialize=function(){const e=v.throttle((e=>{this._update(e)}),L);this._handles.add([p.reactionInit((()=>({spatialReference:this.view.spatialReference,chartData:this._chartData})),e),e])},o.destroy=function(){this._handles.destroy(),this._destroyVisualElements()},o.remove=function(){this._destroyVisualElements()},o.update=function(e){this._chartData=e},o._update=function(e){const{chartData:t}=e;if(r.isNone(t))return this.remove();if(!t.fullyRefined)return;const s=t.lines.filter((e=>this._shouldDisplayLine(e))),o=s.length;for(;this._visualElements.length>o;)this._visualElements.pop().destroy();const i=E.PROFILE_LINES_STYLE_3D;for(;this._visualElements.length<o;){const e=new D.OutlineVisualElement({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:i.width-i.outlineSize,width:i.width,falloff:i.falloff,color:i.outlineColor,renderOccluded:i.renderOccluded});this._visualElements.push(e)}const n=e.spatialReference;for(let r=0;r<o;++r){const e=this._visualElements[r],t=s[o-1-r];e.geometry=this._createLineGeometry(t,n),e.innerColor=m.fromArray(_.toUnitRGBA(t.color))}},o._shouldDisplayLine=function(e){return"input"!==e.type},o._createLineGeometry=function(e,t){const s=r.unwrapOr(e.samples,[]),o=s.length-1,i=[];let n=[];for(let l=0;l<=o;l++){const{x:e,y:t,z:a}=s[l];r.isSome(a)&&n.push([e,t,a]),(l===o||r.isNone(a))&&n.length&&(i.push(n),n=[])}return new d({paths:i,hasZ:!0,spatialReference:t})},o._destroyVisualElements=function(){this._visualElements.forEach((e=>e.destroy())),this._visualElements.length=0},s}(f),s.__decorate([l.property()],e.ProfileLines3D.prototype,"view",void 0),s.__decorate([l.property()],e.ProfileLines3D.prototype,"_chartData",void 0),e.ProfileLines3D=s.__decorate([a.subclass("esri.widgets.ElevationProfile.support.ProfileLines3D")],e.ProfileLines3D),Object.defineProperty(e,"__esModule",{value:!0})}));
