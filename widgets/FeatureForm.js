/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/compilerUtils","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/arrayUtils","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","../layers/support/domainUtils","../layers/support/fieldUtils","./Widget","./FeatureForm/FeatureFormViewModel","./support/Heading","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","../chunks/datetime","../intl/locale"],(function(e,t,i,n,a,s,l,r,u,o,d,p,c,m,h,f,_,g,v,b,y,I){"use strict";const F={base:"esri-feature-form",form:"esri-feature-form__form",formHeader:"esri-feature-form__form-header",label:"esri-feature-form__label",inputFieldWrapper:"esri-feature-form__input-wrapper",inputFieldLoader:"esri-feature-form__input-loader",inputField:"esri-feature-form__input",inputDate:"esri-feature-form__input--date",inputTime:"esri-feature-form__input--time",inputRadioGroup:"esri-feature-form__input--radio-group",inputRadio:"esri-feature-form__input--radio",inputRadioLabel:"esri-feature-form__input--radio-label",inputDisabled:"esri-feature-form__input--disabled",inputSwitch:"esri-feature-form__input--switch",inputInvalid:"esri-feature-form__input--invalid",inputIconInvalid:"esri-feature-form__input-icon--invalid",errorMessage:"esri-feature-form__field-error-message",description:"esri-feature-form__description-text",dateInputPart:"esri-feature-form__date-input-part",loneDateInputPart:"esri-feature-form__date-input-part--lone",dateInputContainer:"esri-feature-form__date-input-container",dateFormatHint:"esri-feature-form__date-format-hint",group:"esri-feature-form__group",groupLabel:"esri-feature-form__group-label",groupHeader:"esri-feature-form__group-header",groupHeading:"esri-feature-form__group-header",groupTitle:"esri-feature-form__group-title",groupDescription:"esri-feature-form__group-description",groupToggleIcon:"esri-feature-form__group-toggle-icon",groupCollapsed:"esri-feature-form__group--collapsed",groupSequential:"esri-feature-form__group--sequential",groupActive:"esri-feature-form__group--active",collapseIcon:"esri-icon-up",errorIcon:"esri-icon-notice-triangle",expandIcon:"esri-icon-down",widget:"esri-widget",panel:"esri-widget--panel",input:"esri-input",select:"esri-select"},w={datePattern:"D",timePattern:"tt"};function x(e){return e&&e.inputFields}const D="data-field-name";let T=function(i){function n(e,n){var a;return(a=i.call(this,e,n)||this)._activeDateFieldEdit=null,a._activeInputName=null,a._activeNumberFieldEdit=null,a._fieldFocusNeeded=!1,a._fieldToInitialIncompatibleDomainValue=new Map,a._switchFieldsWithInitialIncompatibleValue=new Set,a._userUpdatedInputFieldNames=new Set,a.disabled=!1,a.groupDisplay="all",a.headingLevel=2,a.messages=null,a.messagesTemplates=null,a.viewModel=new h,a._handleRadioInputChange=e=>{a._commitInputValue(e.target)},a._handleInputInput=e=>{a._commitInputValue(e.currentTarget,!0)},a._handleFormKeyDown=a._handleFormKeyDown.bind(t._assertThisInitialized(a)),a._handleInputBlur=a._handleInputBlur.bind(t._assertThisInitialized(a)),a._handleInputFocus=a._handleInputFocus.bind(t._assertThisInitialized(a)),a._handleNumberInputMouseDown=a._handleNumberInputMouseDown.bind(t._assertThisInitialized(a)),a._handleInputKeyDown=a._handleInputKeyDown.bind(t._assertThisInitialized(a)),a._handleOptionChange=a._handleOptionChange.bind(t._assertThisInitialized(a)),a._handleGroupClick=a._handleGroupClick.bind(t._assertThisInitialized(a)),a._handleSubmit=a._handleSubmit.bind(t._assertThisInitialized(a)),a._afterInputCreateOrUpdate=a._afterInputCreateOrUpdate.bind(t._assertThisInitialized(a)),a}t._inheritsLoose(n,i);var r=n.prototype;return r.initialize=function(){this.addHandles([l.watch((()=>this.feature),(()=>{const e=this._getFocusableInput("forward");this._activeInputName=e&&e.name,this._userUpdatedInputFieldNames.clear(),this._fieldToInitialIncompatibleDomainValue.clear(),this._switchFieldsWithInitialIncompatibleValue.clear(),this._fieldFocusNeeded=!0})),this.on("submit",(e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach((e=>this._userUpdatedInputFieldNames.add(e))),this._activeInputName=t,this._fieldFocusNeeded=!0,this.scheduleRender()}}))])},r.loadDependencies=function(){return Promise.all([new Promise(((t,i)=>e(["../chunks/calcite-combobox"],t,i))),new Promise(((t,i)=>e(["../chunks/calcite-combobox-item"],t,i))),new Promise(((t,i)=>e(["../chunks/calcite-combobox-item-group"],t,i))),new Promise(((t,i)=>e(["../chunks/calcite-input-message"],t,i))),new Promise(((t,i)=>e(["../chunks/calcite-progress"],t,i))),new Promise(((t,i)=>e(["../chunks/calcite-switch"],t,i)))])},r.destroy=function(){this._userUpdatedInputFieldNames.clear(),this._userUpdatedInputFieldNames=null},r.getValues=function(){return this.viewModel.getValues()},r.submit=function(){return this.viewModel.submit()},r.render=function(){const{state:e}=this.viewModel;return b.tsx("div",{class:this.classes(F.base,F.widget,F.panel)},"ready"===e?this.renderForm():null)},r.renderForm=function(){const{formTemplate:e}=this,t=s.isSome(e)&&e.title&&b.tsx(f.Heading,{key:"title",level:this.headingLevel},e.title),i=s.isSome(e)&&e.description&&b.tsx("p",{class:F.description,key:"description"},e.description),n=t||i?b.tsx("div",{class:F.formHeader},t,i):null;return b.tsx("form",{class:F.form,novalidate:!0,onsubmit:this._handleSubmit,onkeydown:this._handleFormKeyDown},n,this.renderFields())},r.renderFields=function(){const{viewModel:{inputFields:e}}=this;return e.filter((e=>e.visible)).map(((e,t)=>x(e)?this.renderGroup(e,t):this.renderLabeledField(e)))},r.renderGroup=function(e,t){const{formTemplate:i,disabled:n}=this,{description:a,inputFields:l,label:r,state:u}=e,o=l.filter((e=>e.visible)),d=this.viewModel.findField(this._activeInputName),p=!(!d||d.group!==e),c=`${this.id}_group_${t}`,m=`${this.id}_group-label_${t}`,h=`${this.id}_group-description_${t}`,_=a?b.tsx("p",{class:this.classes(F.groupDescription,F.description),id:h},a):null,g="sequential"===this.groupDisplay,v=g?p:"expanded"===u,y=v?F.collapseIcon:F.expandIcon;return b.tsx("fieldset",{"aria-expanded":v.toString(),"aria-labelledby":m,"aria-describedby":a?h:"",class:this.classes(F.group,g?F.groupSequential:null,v?null:F.groupCollapsed,p?F.groupActive:null,n?F.inputDisabled:null),disabled:n,"data-group":e,id:c,key:t,onclick:this._handleGroupClick},b.tsx("button",{role:g?"presentation":void 0,class:F.groupHeader,type:"button",tabIndex:g?-1:0},b.tsx("div",{class:F.groupTitle},b.tsx(f.Heading,{class:F.groupLabel,id:m,level:s.isSome(i)&&i.title?f.incrementHeadingLevel(this.headingLevel):this.headingLevel},r),_),g?null:b.tsx("span",{class:this.classes(y,F.groupToggleIcon)})),o.map((e=>this.renderLabeledField(e))))},r._getFocusableInput=function(e,t){const i=this.viewModel.allInputFields,n="forward"===e?i:i.slice().reverse();let a;if(t)if(x(t))a=n.indexOf(t.inputFields[0]);else{let i;if(this._isInputFieldInGroup(t)&&"collapsed"===t.group.state){const{inputFields:n}=t.group;i="forward"===e?n[n.length-1]:n[0]}else i=t;a=n.indexOf(i)+1}else a=0;for(let s=a;s<n.length;s++){const e=n[s];if(e.visible)return e}return null},r.renderLabeledField=function(e){const{feature:t,label:i,layer:n,type:a}=e;return b.tsx("label",{key:`${n.id}-${t.uid}-${e.name}`,class:F.label},[i,"unsupported"!==a?this.renderInputField(e):this.renderUnsupportedField(e),this.renderAuxiliaryText(e)])},r.renderInputField=function(e){const{domain:t,name:i,type:n,updating:a,value:l}=e,r=this.getCommonInputProps(e);if("coded-value"===t?.type){if(this._inputFieldHasInputType(e,"switch")){const{fieldElement:t}=e;if(!(this._switchFieldsWithInitialIncompatibleValue.has(i)||null==l||t.input.onValue!==l&&t.input.offValue!==l))return this.renderSwitchInputField(e,r);this._switchFieldsWithInitialIncompatibleValue.add(i)}return"radio-buttons"===e.inputType?this.renderRadioButtonsInputField(e,t.codedValues.map((({code:e,name:t})=>({value:e,name:t}))),r):this.renderSelectInputField(e,this._getFieldValueOptions(i,t),r)}if("datetime-picker"===e.inputType||"date"===n)return this.renderDateInputField(e,r);const u="number"===n?b.tsx("input",{type:"number",...r,value:s.isSome(this._activeNumberFieldEdit)&&this._activeNumberFieldEdit.fieldName===e.name?this._activeNumberFieldEdit.value:`${r.value}`}):"text-area"===e.inputType?b.tsx("textarea",{...r}):b.tsx("input",{type:"text",...r});return a?b.tsx("div",{class:F.inputFieldWrapper},u,b.tsx("div",{class:F.inputFieldLoader},b.tsx("calcite-progress",{type:"indeterminate"}))):u},r._parseDateTime=function(e,t,i){if(i){let n=y.DateTime.fromJSDate(this._parseDate(e,i));const a=y.DateTime.fromMillis(t.value??Date.now());return n="date"===i?n.set({hour:a.hour,minute:a.minute,second:a.second}):n.set({day:a.day,month:a.month,year:a.year}),n.isValid?n.toMillis():null}const n=y.DateTime.fromJSDate(this._parseDate(e));return n.isValid?n.toMillis():null},r.renderDateInputField=function(e,t){const{value:i,includeTime:n}=e,{date:a,time:s}=this._formatDate(0),l=`${this.id}-${t.key}`,r=`${l}-date`,u=`${l}-time`,{_activeDateFieldEdit:o}=this;let{date:d,time:p}=this._formatDate(i);return o?.fieldName===e.name&&(d=o.date.input?.value??d,p=o.time.input?.value??p),b.tsx("div",{key:`${t.key}-date`,class:F.dateInputContainer},b.tsx("div",{class:this.classes(F.dateInputPart,n?null:F.loneDateInputPart)},b.tsx("input",{"aria-label":e.label,"aria-describedby":r,type:"text",...t,"data-date-part":"date",class:this.classes(t.class,F.inputDate),value:d}),b.tsx("div",{class:F.dateFormatHint,id:r},a)),n?b.tsx("div",{class:F.dateInputPart,key:"time-input"},b.tsx("input",{"aria-describedby":u,"aria-label":e.label,type:"text",...t,"data-date-part":"time",class:this.classes(t.class,F.inputTime),value:p}),b.tsx("div",{class:F.dateFormatHint,id:u},s)):null)},r.renderUnsupportedField=function(e){const t=this.getCommonInputProps(e);return b.tsx("input",{afterCreate:t.afterCreate,afterUpdate:t.afterUpdate,disabled:t.disabled,class:this.classes(F.input,F.inputField,F.inputDisabled),onfocus:t.onfocus,readOnly:!0,tabIndex:t.tabIndex,type:"text",value:t.value,[D]:t[D]})},r.renderSelectInputField=function(e,t,i){const{value:n}=e,{messages:a,messagesTemplates:l}=this,r=t.map((e=>e.map((e=>b.tsx("calcite-combobox-item",{value:`${e.value}`,"text-label":e.name,key:`#${e.value}`,selected:n===e.value}))))),[u,o]=r;this._registerIncompatibleValue(n,t.flat(),e,(e=>{o.unshift(b.tsx("calcite-combobox-item",{value:`${e}`,"text-label":`${e}`,key:"incompatible-option",readOnly:!0}))}));const d=o.length>0?[b.tsx("calcite-combobox-item-group",{key:"recommended",label:a.recommended},u),b.tsx("calcite-combobox-item-group",{key:"other",label:l.other},o)]:u,p=s.isNone(e.fieldElement)||this._inputFieldHasInputType(e,"combo-box")&&e.fieldElement.input.showNoValueOption;if(!e.required&&p){const t="",i=this._inputFieldHasInputType(e,"combo-box")&&e.fieldElement.input.noValueOptionLabel||this.messages.empty;d.unshift(b.tsx("calcite-combobox-item",{value:t,"text-label":this.messages.empty,key:"empty-option"},i))}return b.tsx("calcite-combobox",{...i,"selection-mode":"single","overlay-positioning":"fixed",disabled:i.disabled||i.readOnly,allowCustomValues:!1,onCalciteComboboxChange:e=>this._handleOptionChange(e.target)},d)},r._registerIncompatibleValue=function(e,t,i,n){const a=this._fieldToInitialIncompatibleDomainValue,s=a.has(i.name);(s||null!=e&&""!==e&&!t.some((t=>t.value===e))||s)&&(s||a.set(i.name,e),n?.(a.get(i.name)))},r.renderRadioButtonsInputField=function(e,t,i){const{value:n}=e,a=t.map((t=>this.renderRadioButton({key:t.name,label:t.name,name:e.name,value:t.value,selected:t.value===n,props:i})));this._registerIncompatibleValue(n,t,e);const l=s.isNone(e.fieldElement)||this._inputFieldHasInputType(e,"radio-buttons")&&e.fieldElement.input.showNoValueOption;if(!e.required&&l){const t="",s=this._inputFieldHasInputType(e,"radio-buttons")&&e.fieldElement.input.noValueOptionLabel||this.messages.empty,l=n===t||null===n;a.unshift(this.renderRadioButton({key:"empty-option",label:s,name:e.name,value:t,selected:l,props:i}))}return b.tsx("div",{key:`${i.key}-radio`,class:F.inputRadioGroup},a)},r.renderSwitchInputField=function(e,t){const{value:i}=e,n=!!this._inputFieldHasInputType(e,"switch")&&i===e.fieldElement.input.onValue;return b.tsx("calcite-switch",{...t,class:F.inputSwitch,onCalciteSwitchChange:e=>{this._parseValue(e.currentTarget)},checked:n,disabled:t.disabled||t.readOnly})},r.renderRadioButton=function({key:e,name:t,value:i,selected:n,label:a,props:s}){return b.tsx("label",{key:e,class:F.inputRadioLabel},b.tsx("input",{...s,class:F.inputRadio,name:t,type:"radio",value:i,checked:n,onchange:this._handleRadioInputChange}),a)},r.renderAuxiliaryText=function(e){const t=this._userUpdatedInputFieldNames.has(e.name)&&!e.valid?e.errorMessage:s.isSome(this.viewModel.contingencyConstraintViolations.get(e.name))?this.messages.validationErrors.valuesIncompatible:s.isSome(e.valueExpressionExecutor)&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return s.isSome(t)?b.tsx("calcite-input-message",{status:"invalid",icon:!0,active:!0},t):e.description?b.tsx("div",{key:"description",class:F.description},e.description):void 0},r.getCommonInputProps=function(e){const{disabled:t,groupDisplay:i}=this,{editable:n,group:a,hint:l,maxLength:r,minLength:u,name:o,required:d,type:p,valid:c,value:m}=e,h=this._userUpdatedInputFieldNames.has(o),f=!n,_="all"===i&&s.isSome(a)&&"collapsed"===a.state;return{afterCreate:this._afterInputCreateOrUpdate,afterUpdate:this._afterInputCreateOrUpdate,"aria-invalid":c?"false":"true",class:this.classes(F.input,F.inputField,t||f?F.inputDisabled:null,h&&!c?F.inputInvalid:null),key:o,label:o,minlength:u>-1?`${u}`:"",maxlength:r>-1?`${r}`:"",...this._getNumberFieldConstraints(e),disabled:t,readOnly:f,value:null==m?"":`${m}`,[D]:o,onfocus:this._handleInputFocus,oninput:this._handleInputInput,onblur:this._handleInputBlur,onkeydown:this._handleInputKeyDown,onmousedown:"number"===p?this._handleNumberInputMouseDown:null,placeholder:"number"===p||"text"===p?l:"",required:d,tabIndex:_?-1:0}},r._isInputFieldInGroup=function(e){return!x(e)&&s.isSome(e.group)},r._handleNumberInputMouseDown=function({target:e}){e.focus(),this.scheduleRender()},r._getFieldValueOptions=function(e,t){const i=t.codedValues.map((({code:e,name:t})=>({value:e,name:t}))),n=this.viewModel.fieldsWithContingentValues.has(e)?this._getContingentValueOptions(e):[];if(n.length>0){const e=new Set(n.map((e=>e.value)));return[n,i.filter((t=>!e.has(t.value)))]}return[i,[]]},r._getContingentValueOptions=function(e){const t={};for(const a of this.viewModel.allInputFields){const{name:i,value:n}=a;!s.isNone(n)&&i!==e&&this.viewModel.fieldsWithContingentValues.has(i)&&(t[i]=n)}const i=this.viewModel.joinedContingentValues.slice(),n=new Map;for(const a of i){const i=a.values[e];if(s.isNone(i)||"code"!==i.objectType&&"null"!==i.objectType)continue;const{code:l,name:r}="null"===i.objectType?{code:"",name:this.messages.empty}:i.codedValue;if(n.has(l))continue;Object.entries(t).every((([e,t])=>!a.values.hasOwnProperty(e)||this._valueIsValidContingentValue(t,a.values[e])))&&n.set(l,{name:r,value:l})}return[...n.values()]},r._getInputFieldFromInput=function(e){return this.viewModel.findField(e.getAttribute(D))},r._getNumberFieldConstraints=function(e){const t=p.getDomainRange(e.domain)||c.getFieldRange(e.field);return t&&t.max!==Number.MAX_VALUE&&t.min!==Number.MIN_VALUE?t:{min:null,max:null}},r._afterInputCreateOrUpdate=function(e){const{viewModel:t}=this,i=this._getInputFieldFromInput(e),n=t.findField(this._activeInputName),a=this._fieldToInitialIncompatibleDomainValue.get(i.name)===i.value;this._fieldFocusNeeded&&n===i&&("radio-buttons"!==i.inputType||a||e.checked)&&(this._fieldFocusNeeded=!1,this._isInputFieldInGroup(i)&&(i.group.state="expanded"),e.focus())},r._handleInputFocus=function(e){const t=e.target,i=this._getInputFieldFromInput(t);this._activeInputName=i.name,"date"===i.type?this._syncDateFieldEdits(t):this._isNumberInputField(i)&&this._setUpNumberFieldEdit(t)},r._isNumberInputField=function({domain:e,inputType:t="text-box",type:i}){return"number"===i&&"text-box"===t&&(!e||"coded-value"!==e.type)},r._handleInputBlur=function(e){const t=e.target,i=this._getInputFieldFromInput(t);if("date"===i.type){const n=e.relatedTarget,a=n&&this._getInputFieldFromInput(n);if(a&&"date"===i.type&&"date"===a.type&&i.field===a.field){if(""!==t.value&&""===n.value){const a=n.getAttribute("data-date-part");n.value=this._formatDate(i.value??Date.now())[a],this._parseDate(t.value,t.getAttribute("data-date-part"))&&this._commitInputValue(e.target,!0,!1)}return}}"number"===i.type&&s.isSome(this._activeNumberFieldEdit)&&(this._activeNumberFieldEdit.input.value=`${i.value}`,this._activeNumberFieldEdit=null),this._commitInputValue(t),this.scheduleRender()},r._commitInputValue=function(e,t=!1,i=!0){const n=this._getInputFieldFromInput(e);if(this._activeDateFieldEdit){const{date:a,time:s}=this._activeDateFieldEdit,l=this._parseDateTime(e.value,n,a.active?"date":"time"),r=null!==this.viewModel.getValue(n.name),u=a.input&&(s.input||!n.includeTime),o=null===l;if(t){if(o)return;(u||!i||r)&&this._updateDateFieldValue(n,l)}else{if(""===a.input?.value||""===s.input?.value)this._updateDateFieldValue(n,null);else if(u){const e=`${a.input.value} ${s.input?.value??""}`,t=this._parseDateTime(e,n);!(null!==t)&&r||this._updateDateFieldValue(n,t)}this._activeDateFieldEdit=null}}else s.isSome(this._activeNumberFieldEdit)&&this._isNumberInputField(n)&&(this._activeNumberFieldEdit.value=e.value),this._updateFieldValue(e)},r._handleInputKeyDown=function(e){const{key:t,altKey:i,ctrlKey:n,metaKey:a}=e,s=this._getInputFieldFromInput(e.target);if("Enter"===t)this._isInputFieldInGroup(s)&&"collapsed"===s.group.state&&(s.group.state="expanded");else{const{type:l}=s.field,r="single"===l||"double"===l,u=!i&&!n&&!a;if(("integer"===l||"small-integer"===l||r)&&u&&1===t.length){const i=Number(t),n=["-","+"],a=["e","."],s=r?[...n,...a]:n;isNaN(i)&&!s.includes(t)&&e.preventDefault()}}},r._setUpNumberFieldEdit=function(e){const t=this._getInputFieldFromInput(e);this._activeNumberFieldEdit={fieldName:t.name,input:e,value:e.value}},r._syncDateFieldEdits=function(e){const t=this._getInputFieldFromInput(e);if("date"!==t.type)return;const i=e.getAttribute("data-date-part"),n="date"===i?{value:e.value,input:e,active:!0}:{...this._activeDateFieldEdit?.date,active:!1},a="time"===i?{value:e.value,input:e,active:!0}:{...this._activeDateFieldEdit?.time,active:!1};this._activeDateFieldEdit={fieldName:t.name,date:n,time:a}},r._updateFieldValue=function(e){const t=e.getAttribute(D);if(this.viewModel.setValue(t,this._parseValue(e)),this._userUpdatedInputFieldNames.add(t),this.viewModel.fieldsWithContingentValues.has(t)){const e=Object.fromEntries(Object.entries(this.getValues()).filter((([e,t])=>s.isSome(t))));this.viewModel.validateContingencyConstraints(e)}},r._updateDateFieldValue=function(e,t){this.viewModel.setValue(e.name,t),this._userUpdatedInputFieldNames.add(e.name)},r._parseValue=function(e){const t=this._getInputFieldFromInput(e),i=e.value;if(this._inputFieldHasInputType(t,"switch")&&"CALCITE-COMBOBOX"!==e.tagName)return e.checked?t.fieldElement.input.onValue:t.fieldElement.input.offValue;if("radio-buttons"===t.inputType&&"radio"===e.type&&!e.checked)return t.value;const{type:n}=t;if("number"===n)return i?parseFloat(i):null;if("date"===n){if(!i)return null;const n=Number(i);if(!isNaN(n))return n;const a=e.getAttribute("data-date-part"),s=this._parseDate(i,a);if(!s)return null;let l=y.DateTime.fromJSDate(s);const r=t.domain,u=y.DateTime.now();let o=u;if(r&&"range"===r.type){const e=y.DateTime.fromMillis(r.maxValue);u<e&&(o=e)}const d=this.viewModel.getValue(t.name),p=null!=d?y.DateTime.fromMillis(d):o;return l="date"===a?l.set({hour:p.hour,minute:p.minute,second:p.second}):l.set({day:p.day,month:p.month,year:p.year}),l.toMillis()}return i},r._handleOptionChange=function(e){this._commitInputValue(e),this.scheduleRender()},r._handleGroupClick=function(e){const t=e.currentTarget["data-group"],i="expanded"===t.state,n="sequential"===this.groupDisplay,a=`.${F.groupHeader}`;if(!(i&&!e.target.closest(a))){if(this._activeInputName=this._getFocusableInput("forward",t)?.name,n){const n=e.target.closest(a);if(i&&!n)return;this.viewModel.inputFields.forEach((e=>{x(e)&&e!==t&&(e.state="collapsed")}))}t.state=i?"collapsed":"expanded",this._fieldFocusNeeded=n,this.scheduleRender()}},r._handleSubmit=function(e){e.preventDefault()},r._handleFormKeyDown=function(e){"Enter"===e.key&&this.viewModel.submit()},r._formatDate=function(e){if(null==e)return{date:"",time:""};const t=y.DateTime.fromMillis(e,{locale:I.getLocale(),numberingSystem:"latn"});return{date:t.toLocaleString({year:"numeric",month:"2-digit",day:"2-digit"}),time:t.toFormat(w.timePattern)}},r._parseDate=function(e,t){if(null==e||""===e)return null;const{timePattern:i,datePattern:n}=w,a=t?"date"===t?n:i:`${n} ${i}`,s=y.DateTime.fromFormat(e,a,{locale:I.getLocale(),numberingSystem:"latn"});return s.isValid?s.toJSDate():null},r._inputFieldHasInputType=function(e,t){return s.isSome(e.fieldElement)&&e.fieldElement.input?.type===t},r._valueIsValidContingentValue=function(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return e>=t.minValue&&e<=t.maxValue;default:return a.neverReached(t.objectType),!1}},t._createClass(n,[{key:"feature",get:function(){return this.viewModel.feature},set:function(e){this.viewModel.feature=e}},{key:"formTemplate",get:function(){return this.viewModel.formTemplate},set:function(e){this.viewModel.formTemplate=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"layer",get:function(){return this.viewModel.layer},set:function(e){this.viewModel.layer=e}},{key:"spatialReference",get:function(){return this.viewModel.spatialReference},set:function(e){this.viewModel.spatialReference=e}},{key:"strict",get:function(){return this.viewModel.strict},set:function(e){this.viewModel.strict=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}}]),n}(m);i.__decorate([r.property()],T.prototype,"disabled",void 0),i.__decorate([r.property()],T.prototype,"feature",null),i.__decorate([r.property()],T.prototype,"formTemplate",null),i.__decorate([r.property()],T.prototype,"groupDisplay",void 0),i.__decorate([r.property()],T.prototype,"headingLevel",void 0),i.__decorate([r.property()],T.prototype,"label",null),i.__decorate([r.property()],T.prototype,"layer",null),i.__decorate([r.property(),g.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],T.prototype,"messages",void 0),i.__decorate([r.property(),g.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],T.prototype,"messagesTemplates",void 0),i.__decorate([r.property()],T.prototype,"spatialReference",null),i.__decorate([r.property()],T.prototype,"strict",null),i.__decorate([r.property()],T.prototype,"view",null),i.__decorate([r.property(),v.vmEvent(["value-change","submit"])],T.prototype,"viewModel",void 0),T=i.__decorate([d.subclass("esri.widgets.FeatureForm")],T);return T}));
