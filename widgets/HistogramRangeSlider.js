/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../Color","../core/watchUtils","./support/widgetUtils","./support/decorators/messageBundle","../chunks/index","./Widget","./Slider","./Histogram","./smartMapping/support/utils","./HistogramRangeSlider/HistogramRangeSliderViewModel"],(function(e,t,a,i,r,o,s,n,l,d,u,c,h,p,g,_,m,v,b,y,C){"use strict";const F={base:"esri-histogram-range-slider",sliderContainer:"esri-histogram-range-slider__slider-container",histogramContainer:"esri-histogram-range-slider__histogram-container",rangeTypePrefix:"esri-histogram-range-slider__range-type--",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"};let w=function(t){function a(e,a){var i;return(i=t.call(this,e,a)||this)._barElements=[],i._histogram=null,i._slider=null,i.average=null,i.barCreatedFunction=null,i.bins=null,i.dataLines=null,i.dataLineCreatedFunction=null,i.excludedBarColor=new c("#d7e5f0"),i.hasTimeData=null,i.includedBarColor=new c("#599dd4"),i.label=void 0,i.labelFormatFunction=null,i.max=null,i.messages=null,i.min=null,i.precision=4,i.rangeType=null,i.standardDeviation=null,i.standardDeviationCount=1,i.values=null,i.viewModel=new C,i}e._inheritsLoose(a,t);var i=a.prototype;return i.initialize=function(){const{average:e,bins:t,hasTimeData:a,max:i,min:r,viewModel:o}=this;this._updateBarFill=this._updateBarFill.bind(this),this._histogram=new b({average:e,bins:t,barCreatedFunction:(e,t)=>{0===e&&(this._barElements=[]),this._barElements.push(t),this._updateBarFill(e,t),this.barCreatedFunction&&this.barCreatedFunction(e,t)},dataLines:this._getDataLines(),dataLineCreatedFunction:(e,t)=>{this.dataLineCreatedFunction&&this.dataLineCreatedFunction(e,t)},labelFormatFunction:this.labelFormatFunction,layout:"horizontal",max:i,min:r}),this._slider=new v({labelFormatFunction:this.labelFormatFunction,layout:"horizontal",visibleElements:{labels:!0,rangeLabels:!0},rangeLabelInputsEnabled:!a,viewModel:o}),this.own(this._slider.on(["max-change","min-change"],(e=>this.emit(e.type,e))),this._slider.on(["segment-drag","thumb-change","thumb-drag"],(e=>{this._updateBarFills(),this.emit(e.type,e)})),h.watch(this,"bins",(()=>{const{_histogram:e,bins:t}=this;if(t&&e.bins){const a=e.bins.length-t.length;this._barElements.splice(-a,a)}else this._barElements=[];e.set({bins:t}),this._updateBarFills(),this.scheduleRender()})),h.watch(this,["max","min","rangeType","values"],(()=>{const{_histogram:e,max:t,min:a}=this;e.set({max:t,min:a}),this._updateBarFills(),this.scheduleRender()})),h.watch(this,["average","dataLines","standardDeviation","standardDeviationCount"],(()=>{const{_histogram:e,average:t}=this;e.set({average:t,dataLines:this._getDataLines()})})),h.watch(this,"labelFormatFunction",(()=>{const{_histogram:e,labelFormatFunction:t}=this;e.set({labelFormatFunction:t})})),h.watch(this,"hasTimeData",(()=>{this._slider.set({rangeLabelInputsEnabled:!this.hasTimeData})})))},i.generateWhereClause=function(e){return this.viewModel.generateWhereClause(e)},i.render=function(){const{rangeType:e,viewModel:t,label:a}=this,i=this.classes(F.base,F.esriWidget,`${F.rangeTypePrefix}${e}`,"disabled"===t.state?F.disabled:null);return _.jsx("div",{"aria-label":a,class:i},"disabled"===t.state?null:this.renderContent())},i.renderContent=function(){return[this.renderHistogram(),this.renderSlider()]},i.renderSlider=function(){return _.jsx("div",{key:`${this.id}-slider-container`,class:F.sliderContainer},this._slider.render())},i.renderHistogram=function(){return _.jsx("div",{class:F.histogramContainer},this._histogram.render())},i._getDataLines=function(){return[...this._getStandardDeviationDataLines(),...this.dataLines||[]]},i._getStandardDeviationDataLines=function(){const{average:e,standardDeviation:t,standardDeviationCount:a}=this;return y.getDeviationValues(t,e,a).map((e=>({value:e})))},i._updateBarFills=function(){this._barElements.forEach(((e,t)=>this._updateBarFill(t,e)))},i._updateBarFill=function(e,t){t.setAttribute("fill",this._getFillForBar(e).toHex())},i._getFillForBar=function(e){const{bins:t,rangeType:a,values:i}=this;if(!(t&&t.length&&a&&i.length))return null;const r=t[e];if(!r)return null;const{maxValue:o,minValue:s}=r,n=o-s,l=i[0]>s&&i[0]<o;switch(a){case"equal":case"not-equal":return this.includedBarColor;case"less-than":case"at-most":return l?this._getBlendedColor((i[0]-s)/n):o<=i[0]?this.includedBarColor:this.excludedBarColor;case"greater-than":case"at-least":return l?this._getBlendedColor(1-(i[0]-s)/n):s>=i[0]?this.includedBarColor:this.excludedBarColor;case"between":if(2===i.length)return i[0]>s&&i[0]<o?this._getBlendedColor(1-(i[0]-s)/n):i[1]>s&&i[1]<o?this._getBlendedColor((i[1]-s)/n):s>=i[0]&&o<=i[1]?this.includedBarColor:this.excludedBarColor;case"not-between":if(2===i.length)return i[0]>s&&i[0]<o?this._getBlendedColor((i[0]-s)/n):i[1]>s&&i[1]<o?this._getBlendedColor(1-(i[1]-s)/n):s>i[0]&&o<i[1]?this.excludedBarColor:this.includedBarColor;default:return this.includedBarColor}},i._getBlendedColor=function(e){return c.blendColors(this.excludedBarColor,this.includedBarColor,e)},a}(m);return t.__decorate([s.aliasOf("viewModel.average")],w.prototype,"average",void 0),t.__decorate([o.property()],w.prototype,"barCreatedFunction",void 0),t.__decorate([s.aliasOf("viewModel.bins")],w.prototype,"bins",void 0),t.__decorate([o.property()],w.prototype,"dataLines",void 0),t.__decorate([o.property()],w.prototype,"dataLineCreatedFunction",void 0),t.__decorate([o.property({type:c,json:{type:[r.Integer],write:!0}})],w.prototype,"excludedBarColor",void 0),t.__decorate([s.aliasOf("viewModel.hasTimeData")],w.prototype,"hasTimeData",void 0),t.__decorate([o.property({type:c,json:{type:[r.Integer],write:!0}})],w.prototype,"includedBarColor",void 0),t.__decorate([o.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],w.prototype,"label",void 0),t.__decorate([s.aliasOf("viewModel.labelFormatFunction")],w.prototype,"labelFormatFunction",void 0),t.__decorate([s.aliasOf("viewModel.max")],w.prototype,"max",void 0),t.__decorate([o.property(),g.messageBundle("esri/widgets/HistogramRangeSlider/t9n/HistogramRangeSlider")],w.prototype,"messages",void 0),t.__decorate([s.aliasOf("viewModel.min")],w.prototype,"min",void 0),t.__decorate([s.aliasOf("viewModel.precision")],w.prototype,"precision",void 0),t.__decorate([s.aliasOf("viewModel.rangeType")],w.prototype,"rangeType",void 0),t.__decorate([s.aliasOf("viewModel.standardDeviation")],w.prototype,"standardDeviation",void 0),t.__decorate([o.property()],w.prototype,"standardDeviationCount",void 0),t.__decorate([s.aliasOf("viewModel.values")],w.prototype,"values",void 0),t.__decorate([o.property()],w.prototype,"viewModel",void 0),w=t.__decorate([n.subclass("esri.widgets.HistogramRangeSlider")],w),w}));
