/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../assets","../core/Handles","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/arrayUtils","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","./Widget","./BasemapGallery/BasemapGalleryViewModel","./support/Heading","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/jsxFactory","./support/widgetUtils"],(function(e,t,s,a,i,r,o,l,n,d,c,p,m,u,h,g,_){"use strict";const y={base:"esri-basemap-gallery esri-widget esri-widget--panel-height-only",sourceLoading:"esri-basemap-gallery--source-loading",loader:"esri-basemap-gallery__loader",item:"esri-basemap-gallery__item",itemContainer:"esri-basemap-gallery__item-container",itemTitle:"esri-basemap-gallery__item-title",itemThumbnail:"esri-basemap-gallery__item-thumbnail",selectedItem:"esri-basemap-gallery__item--selected",itemError:"esri-basemap-gallery__item--error",emptyMessage:"esri-widget__content--empty",widgetIcon:"esri-icon-basemap",disabled:"esri-disabled",loaderAnimation:"esri-widget__loader-animation"};let b=function(s){function o(e,t){var a;return(a=s.call(this,e,t)||this)._handles=new i,a._focusBasemapItemEnabled=!1,a.disabled=!1,a.headingLevel=2,a.iconClass=y.widgetIcon,a.messages=null,a.viewModel=new p,a}t._inheritsLoose(o,s);var l=o.prototype;return l.initialize=function(){const e=this._handles;this.addHandles([r.on((()=>this.viewModel.items),"change",(t=>{const s="basemap-gallery-item-changes",{added:a,moved:i}=t;e.remove(s),e.add([...a,...i].map((e=>r.watch((()=>e.state),(()=>this.scheduleRender())))),s),this.scheduleRender()})),r.when((()=>this.source),(()=>this.viewModel.load()),{initial:!0,once:!0})])},l.destroy=function(){this._handles.destroy()},l.loadDependencies=function(){return new Promise(((t,s)=>e(["../chunks/calcite-scrim"],t,s)))},l.render=function(){const e="loading"===this.source.state,t=this.disabled||"disabled"===this.viewModel.state,s=this.viewModel.items.map(((e,t)=>this._renderBasemapGalleryItem(e,t))).toArray(),a={[y.sourceLoading]:e,[y.disabled]:t},i=e?g.tsx("div",{class:y.loader,key:"esri-basemap-gallery__loader"}):null,r=e?null:s.length>0?g.tsx("ul",{bind:this,"aria-disabled":this.disabled,"aria-label":this.label,class:y.itemContainer,key:"esri-basemap-gallery__item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},s):g.tsx("div",{class:y.emptyMessage,key:"esri-basemap-gallery__empty-message"},g.tsx(m.Heading,{level:this.headingLevel},this.messages.noBasemaps));return g.tsx("div",{class:this.classes(y.base,a)},i,r)},l._getRoundRobinIndex=function(e,t){return(e+t)%t},l._handleKeyDown=function(e){const{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();const{items:s,activeBasemapIndex:a}=this.viewModel,i="ArrowUp"===t||"ArrowLeft"===t?this._getRoundRobinIndex(Math.max(a-1,-1),s.length):this._getRoundRobinIndex(a+1,s.length),r=s.getItemAt(i);"ready"===r?.state&&(this.viewModel.activeBasemap=r.basemap),this._focusBasemapItemEnabled=!0},l._focusBasemapItem=function(e){this._focusBasemapItemEnabled&&0===e.tabIndex&&(e.focus(),this._focusBasemapItemEnabled=!1)},l._handleClick=function(e){const t=e.currentTarget["data-item"];"ready"===t.state&&(this.viewModel.activeBasemap=t.basemap)},l._renderBasemapGalleryItem=function(e,t){const s=e.basemap.thumbnailUrl||a.getAssetUrl("esri/themes/base/images/basemap-toggle-64.svg"),i=e.basemap.title,r=e.basemap.portalItem?.snippet,o=e.error?.message||r||i,{viewModel:{state:l,activeBasemapIndex:n}}=this,d=this.disabled||"disabled"===l,c=n===t,p=c||-1===n&&0===t?0:-1,m="loading"===l,u={[y.selectedItem]:c,[y.itemError]:"error"===e.state},h=`basemapgallery-item-${e.uid}`;return g.tsx("li",{"aria-checked":c.toString(),"aria-disabled":d.toString(),"aria-labelledby":h,bind:this,class:this.classes(y.item,u),"data-item":e,onkeydown:this._handleClick,onclick:this._handleClick,role:"radio",tabIndex:p,afterUpdate:this._focusBasemapItem,title:o},g.tsx("img",{alt:"",class:y.itemThumbnail,src:s}),g.tsx("div",{id:h,class:y.itemTitle},i),"loading"===e.state||c&&m?g.tsx("calcite-scrim",null,g.tsx("span",{"aria-hidden":"true",role:"presentation",class:y.loaderAnimation})):null)},t._createClass(o,[{key:"activeBasemap",get:function(){return this.viewModel.activeBasemap},set:function(e){this.viewModel.activeBasemap=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"source",get:function(){return this.viewModel.source},set:function(e){this.viewModel.source=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}}]),o}(c);s.__decorate([o.property()],b.prototype,"activeBasemap",null),s.__decorate([o.property()],b.prototype,"disabled",void 0),s.__decorate([o.property()],b.prototype,"headingLevel",void 0),s.__decorate([o.property()],b.prototype,"iconClass",void 0),s.__decorate([o.property()],b.prototype,"label",null),s.__decorate([o.property(),h.messageBundle("esri/widgets/BasemapGallery/t9n/BasemapGallery")],b.prototype,"messages",void 0),s.__decorate([o.property()],b.prototype,"source",null),s.__decorate([o.property()],b.prototype,"view",null),s.__decorate([o.property()],b.prototype,"viewModel",void 0),s.__decorate([u.accessibleHandler()],b.prototype,"_handleClick",null),b=s.__decorate([d.subclass("esri.widgets.BasemapGallery")],b);return b}));
