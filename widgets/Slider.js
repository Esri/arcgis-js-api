/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/maybe","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/deprecate","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/events","../intl/substitute","../intl","./support/widgetUtils","./support/decorators/messageBundle","../chunks/index","./Widget","./Slider/SliderViewModel"],(function(e,t,n,i,s,o,r,a,l,u,h,c,d,_,m,p,v,g,f,b,x){"use strict";const E={base:"esri-slider",reversed:"esri-slider--reversed",horizontalLayout:"esri-slider--horizontal",verticalLayout:"esri-slider--vertical",contentElement:"esri-slider__content",extraContentElement:"esri-slider__extra-content",trackElement:"esri-slider__track",ticksContainerElement:"esri-slider__ticks",tickElement:"esri-slider__tick",tickLabelElement:"esri-slider__tick-label",maxElement:"esri-slider__max",minElement:"esri-slider__min",maxElementInteractive:"esri-slider__max--interactive",minElementInteractive:"esri-slider__min--interactive",rangeInput:"esri-slider__range-input",anchorElement:"esri-slider__anchor",movingAnchorElement:"esri-slider__anchor--moving",lastMovedAnchorElement:"esri-slider__anchor--moved",anchorElementIndexPrefix:"esri-slider__anchor-",segmentElement:"esri-slider__segment",segmentElementIndexPrefix:"esri-slider__segment-",segmentElementInteractive:"esri-slider__segment--interactive",thumbElement:"esri-slider__thumb",labelElement:"esri-slider__label",labelElementInteractive:"esri-slider__label--interactive",labelInput:"esri-slider__label-input",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},y={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},I="esri.widgets.Slider",P=s.getLogger("esri.widgets.Slider"),k={labels:!1,rangeLabels:!1};let A=function(t){function n(n,i){var s;return(s=t.call(this,n,i)||this)._activeLabelInputIndex=null,s._anchorElements=[],s._baseNode=null,s._dragged=!1,s._dragStartInfo=null,s._focusedAnchorIndex=null,s._isMinInputActive=!1,s._isMaxInputActive=!1,s._labelElements=[],s._lastMovedHandleIndex=null,s._observer=null,s._positionPrecision=5,s._segmentDragStartInfo=null,s._segmentElements=[],s._thumbElements=[],s._tickElements=[],s._trackHeight=null,s._trackWidth=null,s._zIndices=null,s._zIndexOffset=3,s.disabled=!1,s.extraNodes=[],s.draggableSegmentsEnabled=!0,s.inputCreatedFunction=null,s.inputFormatFunction=null,s.inputParseFunction=null,s.label=void 0,s.labelInputsEnabled=!1,s.labelFormatFunction=null,s.labels=null,s.max=null,s.messages=null,s.min=null,s.precision=4,s.rangeLabelInputsEnabled=!1,s.snapOnClickEnabled=!0,s.steps=null,s.thumbsConstrained=!0,s.thumbCreatedFunction=null,s.tickConfigs=null,s.trackElement=null,s.values=null,s.viewModel=new x,s.visibleElements={...k},s._observer=new ResizeObserver((()=>s.scheduleRender())),s._onAnchorPointerDown=s._onAnchorPointerDown.bind(e._assertThisInitialized(s)),s._onAnchorPointerMove=s._onAnchorPointerMove.bind(e._assertThisInitialized(s)),s._onAnchorPointerUp=s._onAnchorPointerUp.bind(e._assertThisInitialized(s)),s._onLabelPointerDown=s._onLabelPointerDown.bind(e._assertThisInitialized(s)),s._onLabelPointerUp=s._onLabelPointerUp.bind(e._assertThisInitialized(s)),s._onSegmentPointerDown=s._onSegmentPointerDown.bind(e._assertThisInitialized(s)),s._onSegmentPointerMove=s._onSegmentPointerMove.bind(e._assertThisInitialized(s)),s._onSegmentPointerUp=s._onSegmentPointerUp.bind(e._assertThisInitialized(s)),s._onTrackPointerDown=s._onTrackPointerDown.bind(e._assertThisInitialized(s)),s}e._inheritsLoose(n,t);var s=n.prototype;return s.destroy=function(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove)},s.castVisibleElements=function(e){return{...k,...e}},s.render=function(){const{label:e}=this,t=this.classes(E.base,E.esriWidget,this._isHorizontalLayout()?E.horizontalLayout:E.verticalLayout,this._isReversedLayout()?E.reversed:null,this._isDisabled()?E.disabled:null);return this._storeTrackDimensions(),f.jsx("div",{afterCreate:this._afterBaseNodeCreate,bind:this,"aria-label":e,class:t,"touch-action":"none"},this.renderContent())},s.toNextStep=function(e){this._toStep(e,1)},s.toPreviousStep=function(e){this._toStep(e,-1)},s.renderContent=function(){const{max:e,min:t}=this;if(i.isSome(t)&&i.isSome(e)&&!(t>e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]},s.renderSliderContainer=function(){return f.jsx("div",{key:"slider-container",bind:this,class:E.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())},s.renderTrackElement=function(){return f.jsx("div",{afterCreate:this._afterTrackCreate,bind:this,class:E.trackElement,"data-node-ref":"trackElement","touch-action":"none"},this.renderSegmentElements(),this.renderAnchorElements())},s.renderSegmentElements=function(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length+1,t=[];for(let n=0;n<e;n++)t.push(this.renderSegmentElement(n));return t},s.renderSegmentElement=function(e){const{_trackHeight:t,_trackWidth:n,draggableSegmentsEnabled:s,id:o,state:r,values:a}=this,l=this._isHorizontalLayout(),u=l?n:t,h=e===a.length?null:e,c=0===e?null:e-1,d=i.isSome(h),_=i.isSome(c);let m,p;const v=[...a].sort(((e,t)=>e-t));this._isReversedLayout()?(m=_?this._positionFromValue(v[c]):l?u:0,p=d?this._positionFromValue(v[h]):l?0:u):(m=d?this._positionFromValue(v[h]):l?u:0,p=_?this._positionFromValue(v[c]):l?0:u);const g=this._applyPrecisionToPosition(100*p/u),b=(m-p)/u,x=l?`transform: translate(${g}%, 0px) scale(${b}, 1);`:`transform: translate(0px, ${g}%) scale(1, ${b});`,y=this.classes(E.segmentElement,E.segmentElementIndexPrefix+e,s&&d&&_&&"disabled"!==r?E.segmentElementInteractive:null);return f.jsx("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:y,"data-max-thumb-index":h,"data-min-thumb-index":c,"data-segment-index":e,key:`${o}-segment-${e}`,style:x,"touch-action":"none"})},s.renderAnchorElements=function(){const{trackElement:e,values:t}=this;if(t&&t.length)return this._zIndices=t.map(((e,n)=>{const i=this._positionFromValue(e),s=this._positionToPercent(i),o=(this._isHorizontalLayout()?s>50:s<50)?-1:1;return this._zIndexOffset+(t.length+o*n)})),e&&t&&t.length?t.map(((e,t)=>this.renderAnchorElement(e,t))):null},s.renderAnchorElement=function(e,t){const n=this._positionFromValue(e),s=this._valueFromPosition(n);if(!i.isSome(s)||isNaN(s))return;const{_dragStartInfo:o,_lastMovedHandleIndex:r,id:a,layout:l,values:u,visibleElements:{labels:h}}=this,c=o&&o.index===t,d=r===t,_=this.classes(E.anchorElement,E.anchorElementIndexPrefix+t,c?E.movingAnchorElement:null,d?E.lastMovedAnchorElement:null),p=this.labels.values[t],v=this._getStyleForAnchor(e,t,c||d),{min:g,max:b}=this.viewModel.getBoundsForValueAtIndex(t),{messages:x}=this,y=2===u.length?0===t?m.substitute(x.rangeMinimum,{value:e}):m.substitute(x.rangeMaximum,{value:e}):p,I=1===u.length?null:0===t?`${a}-handle-${t+1}`:t===u.length-1?`${a}-handle-${t-1}`:`${a}-handle-${t-1} ${a}-handle-${t+1}`;return f.jsx("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":I,"aria-label":x.sliderValue,"aria-labelledby":h?`${a}-label-${t}`:null,"aria-orientation":l,"aria-valuemax":b.toString(),"aria-valuemin":g.toString(),"aria-valuenow":e.toString(),"aria-valuetext":y,bind:this,class:_,"data-thumb-index":t,"data-value":e,id:`${a}-handle-${t}`,key:`${a}-handle-${t}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:v,tabIndex:0},f.jsx("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:E.thumbElement,"data-thumb-index":t,"touch-action":"none"}),this.renderThumbLabel(t))},s.renderThumbLabel=function(e){const{id:t,labels:n,labelInputsEnabled:i,state:s}=this,o=this.visibleElements.labels,r=n.values[e],a=this.classes(E.labelElement,o?null:E.hidden,i&&"disabled"!==s?E.labelElementInteractive:null);return f.jsx("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!o).toString(),bind:this,class:a,"data-thumb-index":e,key:`${t}-label-${e}`,id:`${t}-label-${e}`,role:i?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):r)},s.renderValueInput=function(e){const t=this.values[e];return f.jsx("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:E.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:0,type:"text",value:this._formatInputValue(t,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})},s.renderMax=function(){const{_isMaxInputActive:e,labels:t,rangeLabelInputsEnabled:n,state:i}=this,s=this.visibleElements.rangeLabels,o=this.classes(E.maxElement,s?null:E.hidden,n&&"disabled"!==i?E.maxElementInteractive:null);return f.jsx("div",{"aria-hidden":(!s).toString(),bind:this,class:o,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:n?"button":null,tabIndex:n?0:null},e?this.renderMaxInput():t.max)},s.renderMin=function(){const{_isMinInputActive:e,labels:t,rangeLabelInputsEnabled:n,state:i}=this,s=this.visibleElements.rangeLabels,o=this.classes(E.minElement,s?null:E.hidden,n&&"disabled"!==i?E.minElementInteractive:null);return f.jsx("div",{"aria-hidden":(!s).toString(),bind:this,class:o,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:n?"button":null,tabIndex:n?0:null},e?this.renderMinInput():t.min)},s.renderMaxInput=function(){return f.jsx("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:E.rangeInput,"data-input-type":"max",required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})},s.renderMinInput=function(){return f.jsx("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:E.rangeInput,"data-input-type":"min",required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})},s.renderExtraContentElements=function(){return f.jsx("div",{bind:this,class:E.extraContentElement},this.extraNodes)},s.renderTicksContainer=function(){if(this.tickConfigs&&this.trackElement&&(0!==this._trackHeight||0!==this._trackWidth))return this.tickConfigs.map(((e,t)=>f.jsx("div",{key:"ticks-container",class:this.classes(E.ticksContainerElement)},this.renderTicks(e,t))))},s.renderTicks=function(e,t){const{mode:n,values:i}=e;if(this._tickElements[t]=[],"position"===n){const n=Array.isArray(i)?i:[i];return this._calculateTickPositions(n).map(((n,i)=>this.renderTickGroup(e,i,t,n)))}if("percent"===n&&Array.isArray(i)){const{max:n,min:s}=this,o=n-s,r=i.map((e=>this._applyPrecisionToPosition(e/100*o+s)));return this._calculateTickPositions(r).map(((n,i)=>this.renderTickGroup(e,i,t,n)))}const s=Array.isArray(i)&&i.length?i[0]:isNaN(i)?null:i,o=this._getTickCounts(s,e);return this._calculateEquidistantTickPositions(o).map(((n,i)=>this.renderTickGroup(e,i,t,n)))},s.renderTickGroup=function(e,t,n,s){const o="position"===e.mode?Array.isArray(e.values)?e.values[t]:e.values:this._valueFromPosition(s);if(i.isSome(o)&&!isNaN(o))return f.jsx("div",{afterCreate:this._afterTickGroupCreate,bind:this,"data-config":e,"data-position":s,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":o,key:`tick-group-${t}`},this.renderTickLine(e,t,n,o),e.labelsVisible?this.renderTickLabel(e,t,n,o):null)},s.renderTickLine=function(e,t,n,i){return f.jsx("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":i.toString(),bind:this,class:E.tickElement,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":i,key:`tick-label-${t}`,style:this._getPositionStyleForElement(i)})},s.renderTickLabel=function(e,t,n,i){const s=e.labelFormatFunction?e.labelFormatFunction(i,"tick",t):this.viewModel.getLabelForValue(i,"tick",t);return f.jsx("div",{afterCreate:this._afterTickLabelCreate,"aria-label":s,"aria-valuenow":i.toString(),"aria-valuetext":s,bind:this,class:E.tickLabelElement,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":i,key:`tick-label-${t}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(i)}`},s)},s._afterBaseNodeCreate=function(e){this._baseNode&&this._observer.unobserve(this._baseNode),this._baseNode=e,this._observer.observe(this._baseNode)},s._afterTrackCreate=function(e){v.storeNode.call(this,e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()},s._afterSegmentCreate=function(e){this._segmentElements.push(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)},s._afterSegmentRemoved=function(e){const t=this._segmentElements.indexOf(e,0);t>-1&&this._segmentElements.splice(t,1),e.removeEventListener("pointerdown",this._onSegmentPointerDown)},s._afterAnchorCreate=function(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const t=e["data-thumb-index"],n=e["data-value"],i=this._thumbElements[t]||null,s=this._labelElements[t]||null;this.thumbCreatedFunction(t,n,i,s)}},s._afterAnchorUpdate=function(e){if(i.isSome(this._focusedAnchorIndex)){e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}},s._afterAnchorRemoved=function(e){const t=this._anchorElements.indexOf(e,0);t>-1&&this._anchorElements.splice(t,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)},s._afterThumbCreate=function(e){this._thumbElements.push(e)},s._afterThumbRemoved=function(e){const t=this._thumbElements.indexOf(e,0);t>-1&&this._thumbElements.splice(t,1)},s._afterLabelCreate=function(e){this._labelElements.push(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)},s._afterLabelRemoved=function(e){const t=this._labelElements.indexOf(e,0);t>-1&&this._labelElements.splice(t,1),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)},s._afterInputCreate=function(e){if(e.focus(),e.select(),this.inputCreatedFunction){const t=e.getAttribute("data-input-type"),n="thumb"===t?e["data-input-index"]:null;this.inputCreatedFunction(e,t,n)}},s._afterTickLineCreate=function(e){const t=e["data-tick-config-index"],n=e["data-tick-group-index"],i=this._tickElements[t];i[n]?i[n].line=e:i[n]={line:e,label:null}},s._afterTickLabelCreate=function(e){const t=e["data-tick-config-index"],n=e["data-tick-group-index"],i=this._tickElements[t];i[n]?i[n].label=e:i[n]={label:e,line:null}},s._afterTickGroupCreate=function(e){const t=e["data-config"];if(t&&t.tickCreatedFunction){const n=e["data-tick-config-index"],i=e["data-tick-group-index"],s=e["data-value"],o=this._tickElements[n][i];if(o){const e=o.line||null,n=o.label||null;t.tickCreatedFunction(s,e,n)}}},s._onAnchorKeyDown=function(e){if(this._isDisabled()||"editing"===this.state)return;const{target:t}=e,n=_.eventKey(e),{_anchorElements:s,values:o}=this,r=t["data-thumb-index"],a=s[r],l=o[r],u=this._isHorizontalLayout(),h=[y.moveAnchorUp,y.moveAnchorDown,y.moveAnchorLeft,y.moveAnchorRight];if(n===y.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=r,this.notifyChange("state");else if(h.indexOf(n)>-1){e.preventDefault();const{steps:t}=this,s=n===y.moveAnchorUp||n===y.moveAnchorRight?1:-1;if(i.isSome(t))this._toStep(r,this._isReversedLayout()?-1*s:s);else{const{precision:e}=this,t=this._getPositionOfElement(a),n=this._valueFromPosition(t),i=this._isHorizontalLayout()?s:-1*s;let o;o=0===e?this._positionFromValue(n+i):1===e?this._positionFromValue(n+.1*i):t+i,this._toPosition(r,o)}const o=this.values[r];l!==o&&this._emitThumbChangeEvent({index:r,oldValue:l,value:o})}else if(n===y.moveAnchorToMax||n===y.moveAnchorToMin){e.preventDefault();const{min:t,max:i}=this._getAnchorBoundsInPixels(r),s=u?n===y.moveAnchorToMax?i:t:n===y.moveAnchorToMin?i:t;this._toPosition(r,s);const o=this.values[r];l!==o&&this._emitThumbChangeEvent({index:r,oldValue:l,value:o})}},s._onAnchorPointerDown=function(e){if(this._isDisabled())return;const{target:t,clientX:n,clientY:i}=e,s=t["data-thumb-index"];void 0!==s&&(e.preventDefault(),this._anchorElements[s]&&this._anchorElements[s].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:n,clientY:i,index:s,position:this._getPositionOfElement(this._anchorElements[s])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))},s._onAnchorPointerMove=function(e){if("editing"===this.state||!this._dragStartInfo)return;e.preventDefault();const{values:t,_anchorElements:n,_dragged:i,_dragStartInfo:s,_dragStartInfo:{index:o,position:r}}=this,{clientX:a,clientY:l}=e,u=i?"drag":"start",h=n[o],c=this._getPositionOfElement(h),d=this._applyPrecisionToPosition(this._isHorizontalLayout()?r+a-s.clientX:r+l-s.clientY);if(c===d)return;const _=t[o];this._dragged=!0,this._toPosition(o,d);const m=this.values[o];i?_!==m&&this._emitThumbDragEvent({index:o,state:u,value:m}):this._emitThumbDragEvent({index:o,state:u,value:_})},s._onAnchorPointerUp=function(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:t}=this._dragStartInfo,n=this._dragged;this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=t,n?(this.notifyChange("state"),this._emitThumbDragEvent({index:t,state:"stop",value:this.values[t]})):this.scheduleRender()},s._onTrackPointerDown=function(e){const{_dragStartInfo:t,snapOnClickEnabled:n,state:s,values:o}=this;if(this._isDisabled()||"editing"===s||t||!n||!o.length)return;const{steps:r}=this,{clientX:a,clientY:l}=e,u=this._getCursorPositionFromEvent(e),h=this._valueFromPosition(u),c=this._getIndexOfNearestValue(h);if(!i.isSome(c))return;const d=o[c],_=i.isSome(r)?this._calculateNearestStepPosition(u):u;this._toPosition(c,_),this._dragged=!0,this._dragStartInfo={clientX:a,clientY:l,index:c,position:_},this._focusedAnchorIndex=c,this.notifyChange("state"),this._emitThumbDragEvent({index:c,state:"start",value:d});const m=this.values[c];d!==m&&this._emitThumbDragEvent({index:c,state:"drag",value:m}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)},s._onSegmentPointerDown=function(e){e.preventDefault();const{draggableSegmentsEnabled:t}=this,n=e.target,s=n["data-segment-index"],o=n["data-min-thumb-index"],r=n["data-max-thumb-index"];!this._isDisabled()&&t&&i.isSome(o)&&i.isSome(r)&&(e.stopPropagation(),this._storeTrackDimensions(),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:s,details:this._normalizeSegmentDetails({min:this._getAnchorDetails(o),max:this._getAnchorDetails(r)})},this.notifyChange("state"),this._emitSegmentDragEvent({index:s,state:"start",thumbIndices:[o,r]}),document.addEventListener("pointerup",this._onSegmentPointerUp),document.addEventListener("pointermove",this._onSegmentPointerMove))},s._onSegmentPointerMove=function(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:t,_trackWidth:n,_segmentDragStartInfo:{index:i,cursorPosition:s,details:{min:o,max:r}}}=this,{index:a,position:l,value:u}=o,{index:h,position:c,value:d}=r;this._dragged=!0;const _=this._getCursorPositionFromEvent(e);if(_===s)return;const m=this._positionToPercent(s),p=this._positionToPercent(_)-m,v=this._positionToPercent(l)+p,g=this._positionToPercent(c)+p,{min:f}=this._getAnchorBoundsAsPercents(a),{max:b}=this._getAnchorBoundsAsPercents(h);let x=!1,E=!1;if(v<f?x=!0:g>b&&(E=!0),x){const{min:e,max:t}=this.viewModel.getBoundsForValueAtIndex(a),n=this._isPositionInverted()?t:e,i=n,s=d+(n-u);return void this._updateAnchorValues([a,h],[i,s])}if(E){const{min:e,max:t}=this.viewModel.getBoundsForValueAtIndex(h),n=this._isPositionInverted()?e:t,i=n,s=u+(n-d);return void this._updateAnchorValues([a,h],[s,i])}const y=this._isHorizontalLayout()?n:t,I=g/100*y,P=v/100*y,k=this.values,A=[k[a],k[h]],S=this._getValueForAnchorAtPosition(a,P),L=this._getValueForAnchorAtPosition(h,I);this._updateAnchorValues([a,h],[S,L]);[this.values[a],this.values[h]].every(((e,t)=>e===A[t]))||this._emitSegmentDragEvent({index:i,state:"drag",thumbIndices:[a,h]})},s._onSegmentPointerUp=function(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{max:t,min:n,values:i}=this,{index:s,details:{min:{index:o},max:{index:r}}}=this._segmentDragStartInfo,a=t-n,l=i[o],u=i[r];this._lastMovedHandleIndex=l===u?l>a/2?o:r:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:s,state:"stop",thumbIndices:[o,r]})},s._storeTrackDimensions=function(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}},s._onLabelPointerDown=function(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))},s._onLabelPointerMove=function(){this._isDisabled()||(this._dragged=!0)},s._onLabelPointerUp=function(e){if(this._isDisabled())return;const t=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&i.isSome(t)&&(this._activeLabelInputIndex=t),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)},s._onLabelInputBlur=function(e){const{_activeLabelInputIndex:t,values:n,viewModel:i}=this,s=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!s)return;const o=this._parseInputValue(s,"value",t),r=n[t],{min:a,max:l}=this.viewModel.getBoundsForValueAtIndex(t);if(o<a||o>l)return;i.setValue(t,o);const u=this.values[t];r!==u&&this._emitThumbChangeEvent({index:t,oldValue:r,value:u})},s._onInputKeyDown=function(e){if(this._isDisabled())return;const{target:t}=e,n=_.eventKey(e),{hideInput1:s,hideInput2:o,hideInput3:r}=y,{_activeLabelInputIndex:a,_anchorElements:l}=this,u=t;if(n===s||n===o||n===r){e.stopPropagation();const t=a;u.blur(),i.isSome(t)?l[t].focus():u.parentElement.focus()}},s._onMaxLabelClick=function(){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state"))},s._onMaxLabelKeyDown=function(e){this._isDisabled()||_.eventKey(e)!==y.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))},s._onMaxInputBlur=function(e){const t=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!t)return;const n=this.max,i=this._parseInputValue(t,"max");i<=this.min||(this.viewModel.set("max",i),this.max!==n&&this._emitMaxChangeEvent({oldValue:n,value:this.max}))},s._onMinLabelClick=function(){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state"))},s._onMinLabelKeyDown=function(e){this._isDisabled()||_.eventKey(e)!==y.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))},s._onMinInputBlur=function(){const e=event.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!e)return;const t=this.min,n=this._parseInputValue(e,"min");n>=this.max||(this.viewModel.set("min",n),this.min!==t&&this._emitMinChangeEvent({oldValue:t,value:this.min}))},s._isDisabled=function(){return this.disabled||"disabled"===this.state},s._positionFromValue=function(e){const{max:t,min:n}=this,i=t-n;if(0===i)return 0;const{_trackHeight:s,_trackWidth:o}=this,r=this._isHorizontalLayout();let a=r?parseFloat((o*(e-n)/i).toFixed(2)):parseFloat((s*(t-e)/i).toFixed(2));return this._isReversedLayout()&&(a=r?o-a:s-a),a},s._valueFromPosition=function(e){const{_trackHeight:t,_trackWidth:n,max:i,min:s,precision:o}=this,r=i-s;let a=this._isHorizontalLayout()?e*r/n+s:r*(1e3-e/t*1e3)/1e3+s;return this._isReversedLayout()&&(a=i+s-a),parseFloat(a.toFixed(o))},s._positionToPercent=function(e){const{_trackHeight:t,_trackWidth:n}=this,i=100*e/(this._isHorizontalLayout()?n:t);return this._applyPrecisionToPosition(i)},s._applyPrecisionToPosition=function(e){return parseFloat(e.toFixed(this._positionPrecision))},s._isPositionInverted=function(){const{layout:e}=this;return"horizontal-reversed"===e||"vertical"===e},s._isHorizontalLayout=function(){return this.layout.indexOf("horizontal")>-1},s._isReversedLayout=function(){return this.layout.indexOf("reversed")>-1},s._normalizeSegmentDetails=function(e){if(this._isPositionInverted()){const{min:t,max:n}=e;return{min:n,max:t}}return e},s._parseInputValue=function(e,t,n){return this.inputParseFunction?this.inputParseFunction(e,t,n):this.viewModel.defaultInputParseFunction(e)},s._formatInputValue=function(e,t,n){return this.inputFormatFunction?this.inputFormatFunction(e,t,n):this.viewModel.defaultInputFormatFunction(e)},s._getAnchorDetails=function(e){return{index:e,position:this._getPositionOfElement(this._anchorElements[e]),value:this.values[e]}},s._updateAnchorStyle=function(e,t){const n=this._anchorElements[e];n&&(this._isHorizontalLayout()?n.style.left=`${t}`:n.style.top=`${t}`)},s._getStyleForAnchor=function(e,t,n){const i=this._getPositionStyleForElement(e);if(1===this.values.length)return`${i}`;const s=this._zIndices[t];return`${i}; z-index: ${n?this._zIndexOffset+s:s}`},s._getPositionStyleForElement=function(e){const t=this._positionFromValue(e),n=this._positionToPercent(t);return`${this._isHorizontalLayout()?"left":"top"}: ${n+"%"}`},s._getPositionOfElement=function(e){const t=this._getDimensions(e.offsetParent),n=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(n.left-t.left):this._applyPrecisionToPosition(n.top-t.top)},s._updateAnchorValues=function(e,t){e.forEach(((e,n)=>this._toValue(e,t[n])))},s._toValue=function(e,t){if(i.isSome(this.steps)){t=this._getStepValues()[this._getIndexOfNearestStepValue(t)]}this._updateAnchorStyle(e,this._getPositionStyleForElement(t)),this.viewModel.setValue(e,t)},s._toPosition=function(e,t){const n=i.isSome(this.steps)?this._getStepValueForAnchorAtPosition(e,t):this._getValueForAnchorAtPosition(e,t);this._updateAnchorStyle(e,this._getPositionStyleForElement(n)),this.viewModel.setValue(e,n)},s._getValueForAnchorAtPosition=function(e,t){const{min:n,max:i}=this._getAnchorBoundsInPixels(e),{min:s,max:o}=this.viewModel.getBoundsForValueAtIndex(e);let r,a,l=null;return this._isPositionInverted()?(r=s,a=o):(r=o,a=s),l=t>i?r:t<n?a:this._valueFromPosition(t),l>o?l=o:l<s&&(l=s),l},s._getStepValueForAnchorAtPosition=function(e,t){const n=this._getStepValues(),i=this._calculateNearestStepPosition(t),s=this._getValueForAnchorAtPosition(e,i);return n[this._getIndexOfNearestStepValue(s)]},s._getAnchorBoundsAsPercents=function(e){const{min:t,max:n}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(t),max:this._positionToPercent(n)}},s._getAnchorBoundsInPixels=function(e){const{_anchorElements:t,_trackHeight:n,_trackWidth:i,thumbsConstrained:s}=this,o=t[e-1],r=t[e+1],a=this._isHorizontalLayout()?i:n;return s?this._isPositionInverted()?{max:o?this._getPositionOfElement(o):a,min:r?this._getPositionOfElement(r):0}:{max:r?this._getPositionOfElement(r):a,min:o?this._getPositionOfElement(o):0}:{max:a,min:0}},s._getIndexOfNearestValue=function(e){return this.values.indexOf(this.values.reduce(((t,n)=>Math.abs(n-e)<Math.abs(t-e)?n:t)))},s._getCursorPositionFromEvent=function(e){const t=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-t.left:e.clientY-t.top},s._getStepValues=function(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:t,min:n}=this,i=Math.ceil((t-n)/e),s=[];for(let o=0;o<=i;o++){const i=n+e*o;s.push(i>t?t:i)}return s},s._toStep=function(e,t){const{values:n,viewModel:i}=this,s=n[e],o=this._getStepValues(),r=o.indexOf(s);let a=null;if(r>-1){const n=o[r+t],i=this._positionFromValue(n);a=this._getStepValueForAnchorAtPosition(e,i)}else{a=o[this._getIndexOfNearestStepValue(s)+t]}i.setValue(e,a)},s._getIndexOfNearestStepValue=function(e){const{steps:t}=this;if(!i.isSome(t))return null;const n=this._getStepValues(),s=n.reduce(((t,n)=>Math.abs(n-e)<Math.abs(t-e)?n:t));return n.indexOf(s)},s._calculateNearestStepPosition=function(e){const t=this._valueFromPosition(e),n=this._getIndexOfNearestStepValue(t),i=this._getStepValues();return this._positionFromValue(i[n])},s._getTickCounts=function(e,t){const{mode:n}=t;return"count"===n||"position"===n?e||0:"percent"===n&&100/e||0},s._calculateTickPositions=function(e){return e.map((e=>this._positionFromValue(e)))},s._calculateEquidistantTickPositions=function(e){const{_trackWidth:t,_trackHeight:n}=this,i=this._isHorizontalLayout()?t:n,s=i/(e-1),o=[];if(1===e)return[i/2];for(let r=0;r<e;r++){const e=r*s;e<=i&&o.push(e)}return o},s._getDimensions=function(e){try{return e.getBoundingClientRect()}catch(t){if("object"==typeof t&&null!==t)return{top:0,bottom:0,left:0,width:0,height:0,right:0};throw t}},s._emitMaxChangeEvent=function(e){this.emit("max-change",{...e,type:"max-change"})},s._emitMinChangeEvent=function(e){this.emit("min-change",{...e,type:"min-change"})},s._emitThumbChangeEvent=function(e){this.emit("thumb-change",{...e,type:"thumb-change"})},s._emitThumbDragEvent=function(e){this.emit("thumb-drag",{...e,type:"thumb-drag"})},s._emitSegmentDragEvent=function(e){this.emit("segment-drag",{...e,type:"segment-drag"})},e._createClass(n,[{key:"labelsVisible",set:function(e){l.deprecatedProperty(P,"labelsVisible",{replacement:"visibleElements.labels",version:"4.15"}),this.visibleElements={...this.visibleElements,labels:e}}},{key:"layout",set:function(e){-1===["vertical","vertical-reversed","horizontal","horizontal-reversed"].indexOf(e)&&(e="horizontal"),this._set("layout",e)}},{key:"rangeLabelsVisible",set:function(e){l.deprecatedProperty(P,"rangeLabelsVisible",{replacement:"visibleElements.rangeLabels",version:"4.15"}),this.visibleElements={...this.visibleElements,rangeLabels:e}}},{key:"state",get:function(){const{_activeLabelInputIndex:e,_isMaxInputActive:t,_isMinInputActive:n,_dragStartInfo:s,_segmentDragStartInfo:o,viewModel:r}=this,a=i.isSome(s)||i.isSome(o);return!(null===e&&!t&&!n)?"editing":a?"dragging":r.state}}]),n}(b);return t.__decorate([o.property()],A.prototype,"disabled",void 0),t.__decorate([o.property()],A.prototype,"extraNodes",void 0),t.__decorate([o.property()],A.prototype,"draggableSegmentsEnabled",void 0),t.__decorate([o.property()],A.prototype,"inputCreatedFunction",void 0),t.__decorate([r.aliasOf("viewModel.inputFormatFunction")],A.prototype,"inputFormatFunction",void 0),t.__decorate([r.aliasOf("viewModel.inputParseFunction")],A.prototype,"inputParseFunction",void 0),t.__decorate([o.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],A.prototype,"label",void 0),t.__decorate([o.property()],A.prototype,"labelInputsEnabled",void 0),t.__decorate([r.aliasOf("viewModel.labelFormatFunction")],A.prototype,"labelFormatFunction",void 0),t.__decorate([r.aliasOf("viewModel.labels")],A.prototype,"labels",void 0),t.__decorate([o.property()],A.prototype,"labelsVisible",null),t.__decorate([o.property({value:"horizontal"})],A.prototype,"layout",null),t.__decorate([r.aliasOf("viewModel.max")],A.prototype,"max",void 0),t.__decorate([o.property(),g.messageBundle("esri/widgets/Slider/t9n/Slider")],A.prototype,"messages",void 0),t.__decorate([r.aliasOf("viewModel.min")],A.prototype,"min",void 0),t.__decorate([r.aliasOf("viewModel.precision")],A.prototype,"precision",void 0),t.__decorate([o.property()],A.prototype,"rangeLabelInputsEnabled",void 0),t.__decorate([o.property()],A.prototype,"rangeLabelsVisible",null),t.__decorate([o.property()],A.prototype,"snapOnClickEnabled",void 0),t.__decorate([o.property({readOnly:!0})],A.prototype,"state",null),t.__decorate([o.property()],A.prototype,"steps",void 0),t.__decorate([r.aliasOf("viewModel.thumbsConstrained")],A.prototype,"thumbsConstrained",void 0),t.__decorate([o.property()],A.prototype,"thumbCreatedFunction",void 0),t.__decorate([o.property()],A.prototype,"tickConfigs",void 0),t.__decorate([o.property()],A.prototype,"trackElement",void 0),t.__decorate([r.aliasOf("viewModel.values")],A.prototype,"values",void 0),t.__decorate([o.property()],A.prototype,"viewModel",void 0),t.__decorate([o.property()],A.prototype,"visibleElements",void 0),t.__decorate([a.cast("visibleElements")],A.prototype,"castVisibleElements",null),A=t.__decorate([u.subclass(I)],A),A}));
