/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/Collection","../core/events","../core/maybe","../core/accessorSupport/decorators/property","../core/arrayUtils","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","./Widget","./Slider/SliderViewModel","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","../intl/substitute"],(function(e,t,n,i,s,o,r,a,l,c,u,h,d,m,_,p){"use strict";const v={base:"esri-slider",reversed:"esri-slider--reversed",horizontalLayout:"esri-slider--horizontal",verticalLayout:"esri-slider--vertical",contentElement:"esri-slider__content",extraContentElement:"esri-slider__extra-content",trackElement:"esri-slider__track",ticksContainerElement:"esri-slider__ticks",tickElement:"esri-slider__tick",tickLabelElement:"esri-slider__tick-label",maxElement:"esri-slider__max",minElement:"esri-slider__min",maxElementInteractive:"esri-slider__max--interactive",minElementInteractive:"esri-slider__min--interactive",rangeElementActive:"esri-slider__range--active",rangeInput:"esri-slider__range-input",anchorElement:"esri-slider__anchor",movingAnchorElement:"esri-slider__anchor--moving",lastMovedAnchorElement:"esri-slider__anchor--moved",anchorElementActive:"esri-slider__anchor--active",anchorElementIndexPrefix:"esri-slider__anchor-",segmentElement:"esri-slider__segment",segmentElementIndexPrefix:"esri-slider__segment-",segmentElementInteractive:"esri-slider__segment--interactive",segmentElementActive:"esri-slider__segment--active",effectiveSegmentElement:"esri-slider__effective-segment",effectiveMaxSegmentElement:"esri-slider__effective-max-segment",effectiveMinSegmentElement:"esri-slider__effective-min-segment",thumbElement:"esri-slider__thumb",labelElement:"esri-slider__label",labelElementInteractive:"esri-slider__label--interactive",labelInput:"esri-slider__label-input",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},f={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},g="esri.widgets.Slider",b={labels:!1,rangeLabels:!1};let E=function(t){function n(n,s){var o;return(o=t.call(this,n,s)||this)._activeLabelInputIndex=null,o._anchorElements=[],o._dragged=!1,o._dragStartInfo=null,o._focusedAnchorIndex=null,o._isMinInputActive=!1,o._isMaxInputActive=!1,o._lastMovedHandleIndex=null,o._positionPrecision=5,o._segmentDragStartInfo=null,o._trackHeight=null,o._trackWidth=null,o._zIndices=null,o._zIndexOffset=3,o.disabled=!1,o.draggableSegmentsEnabled=!0,o.effectiveSegmentElements=new i,o.extraNodes=[],o.inputCreatedFunction=null,o.labelElements=new i,o.labelInputsEnabled=!1,o.maxLabelElement=null,o.messages=null,o.minLabelElement=null,o.rangeLabelInputsEnabled=!1,o.segmentElements=new i,o.snapOnClickEnabled=!0,o.steps=null,o.syncedSegmentsEnabled=!1,o.thumbCreatedFunction=null,o.thumbElements=new i,o.tickElements=new i,o.trackElement=null,o.viewModel=new h,o.visibleElements={...b},o._onAnchorPointerDown=o._onAnchorPointerDown.bind(e._assertThisInitialized(o)),o._onAnchorPointerMove=o._onAnchorPointerMove.bind(e._assertThisInitialized(o)),o._onAnchorPointerUp=o._onAnchorPointerUp.bind(e._assertThisInitialized(o)),o._onLabelPointerDown=o._onLabelPointerDown.bind(e._assertThisInitialized(o)),o._onLabelPointerUp=o._onLabelPointerUp.bind(e._assertThisInitialized(o)),o._onSegmentPointerDown=o._onSegmentPointerDown.bind(e._assertThisInitialized(o)),o._onSegmentPointerMove=o._onSegmentPointerMove.bind(e._assertThisInitialized(o)),o._onSegmentPointerUp=o._onSegmentPointerUp.bind(e._assertThisInitialized(o)),o._onTrackPointerDown=o._onTrackPointerDown.bind(e._assertThisInitialized(o)),o._onTrackPointerMove=o._onTrackPointerMove.bind(e._assertThisInitialized(o)),o._onTrackPointerUp=o._onTrackPointerUp.bind(e._assertThisInitialized(o)),o}e._inheritsLoose(n,t);var r=n.prototype;return r.destroy=function(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this.labelElements.removeAll(),this.labelElements.destroy(),this.segmentElements.removeAll(),this.segmentElements.destroy(),this.effectiveSegmentElements.removeAll(),this.effectiveSegmentElements.destroy(),this.thumbElements.removeAll(),this.thumbElements.destroy(),this.tickElements.removeAll(),this.tickElements.destroy()},r.castVisibleElements=function(e){return{...b,...e}},r.render=function(){const{label:e}=this,t=this.classes(v.base,v.esriWidget,this._isHorizontalLayout()?v.horizontalLayout:v.verticalLayout,this._isReversedLayout()?v.reversed:null,this._isDisabled()?v.disabled:null);return this._storeTrackDimensions(),_.tsx("div",{"aria-label":e,class:t,"touch-action":"none",bind:this,afterCreate:this._afterContainerCreate},this.renderContent())},r.toNextStep=function(e){this._toStep(e,1)},r.toPreviousStep=function(e){this._toStep(e,-1)},r.renderContent=function(){const{max:e,min:t}=this;if(!(o.isNone(t)||o.isNone(e)||t>=e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]},r.renderSliderContainer=function(){return _.tsx("div",{key:"slider-container",bind:this,class:v.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())},r.renderTrackElement=function(){return _.tsx("div",{afterCreate:this._afterTrackCreate,afterRemoved:this._afterTrackRemoved,bind:this,class:v.trackElement,"touch-action":"none"},this.renderEffectiveSegmentElements(),this.renderSegmentElements(),this.renderAnchorElements())},r.renderEffectiveSegmentElements=function(){if(!this.trackElement||!this.values||!this.values.length)return;const e=o.isSome(this.effectiveMax),t=o.isSome(this.effectiveMin);if(!e&&!t)return;const{max:n,min:i,viewModel:s}=this,r=s.getBounds(),a=[];return t&&a.push(this.renderEffectiveSegmentElement(i,r.min,!0)),e&&a.push(this.renderEffectiveSegmentElement(r.max,n,!1)),a},r.renderSegmentElements=function(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length,t=[];for(let n=0;n<=e;n++)t.push(this.renderSegmentElement(n));return t},r.renderSegmentElement=function(e){const{_trackHeight:t,_trackWidth:n,draggableSegmentsEnabled:i,id:s,state:r,values:a}=this,l=this._isHorizontalLayout(),c=l?n:t,u=this.viewModel.getBounds(),h=this._positionFromValue(u.max),d=this._positionFromValue(u.min),m=e===a.length?null:e,p=0===e?null:e-1,f=o.isSome(m),g=o.isSome(p);let b,E;const y=[...a].sort(((e,t)=>e-t));this._isReversedLayout()?(b=g?this._positionFromValue(y[p]):d,E=f?this._positionFromValue(y[m]):h):(b=f?this._positionFromValue(y[m]):h,E=g?this._positionFromValue(y[p]):d);const x=this._applyPrecisionToPosition(100*E/c),k=(b-E)/c,I=l?`transform: translate(${x}%, 0px) scale(${k}, 1);`:`transform: translate(0px, ${x}%) scale(1, ${k});`,P=this.classes(v.segmentElement,v.segmentElementIndexPrefix+e,i&&f&&g&&"disabled"!==r?v.segmentElementInteractive:null);return _.tsx("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:P,"data-max-thumb-index":m,"data-min-thumb-index":p,"data-segment-index":e,key:`${s}-segment-${e}`,style:I,"touch-action":"none"})},r.renderEffectiveSegmentElement=function(e,t,n){const{_trackHeight:i,_trackWidth:s,layout:o}=this,r=this._positionFromValue(e),a=this._positionFromValue(t),l=this._isHorizontalLayout(),c=l?s:i,u=this._applyPrecisionToPosition(100*r/c);let h=null;if("horizontal"===o){const e=n?c-a:a,t=r===c?0:u;h=`clip-path: inset(0% ${a===c?0:this._applyPrecisionToPosition(e/c*100)}% 0% ${t}%);`}else{const e=(a-r)/c;h=l?`transform: translate(${u}%, 0px) scale(${e}, 1);`:`transform: translate(0px, ${u}%) scale(1, ${e});`}const d=n?v.effectiveMinSegmentElement:v.effectiveMaxSegmentElement,m=this.classes(v.segmentElement,v.effectiveSegmentElement,d);return _.tsx("div",{afterCreate:this._afterEffectiveSegmentCreate,afterRemoved:this._afterEffectiveSegmentRemoved,bind:this,class:m,style:h,"touch-action":"none"})},r.renderAnchorElements=function(){const{trackElement:e,values:t}=this;if(t&&t.length)return this._zIndices=t.map(((e,n)=>{const i=this._positionFromValue(e),s=this._positionToPercent(i),o=(this._isHorizontalLayout()?s>50:s<50)?-1:1;return this._zIndexOffset+(t.length+o*n)})),e&&t&&t.length?t.map(((e,t)=>this.renderAnchorElement(e,t))):null},r.renderAnchorElement=function(e,t){const n=this._positionFromValue(e),i=this._valueFromPosition(n);if(o.isNone(i)||isNaN(i))return;const{_dragStartInfo:s,_lastMovedHandleIndex:r,id:a,layout:l,values:c,visibleElements:{labels:u}}=this,h=s&&s.index===t,d=r===t,m=this.classes(v.anchorElement,v.anchorElementIndexPrefix+t,h?v.movingAnchorElement:null,d?v.lastMovedAnchorElement:null),f=this.labels.values[t],g=this._getStyleForAnchor(e,t,h||d),{min:b,max:E}=this.viewModel.getBoundsForValueAtIndex(t),{disabled:y,messages:x}=this,k=2===c.length?0===t?p.substitute(x.rangeMinimum,{value:e}):p.substitute(x.rangeMaximum,{value:e}):f,I=1===c.length?null:0===t?`${a}-handle-${t+1}`:t===c.length-1?`${a}-handle-${t-1}`:`${a}-handle-${t-1} ${a}-handle-${t+1}`;return _.tsx("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":I,"aria-label":x.sliderValue,"aria-labelledby":u?`${a}-label-${t}`:null,"aria-orientation":l,"aria-valuemax":E.toString(),"aria-valuemin":b.toString(),"aria-valuenow":e.toString(),"aria-valuetext":k,bind:this,class:m,"data-thumb-index":t,"data-value":e,id:`${a}-handle-${t}`,key:`${a}-handle-${t}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:g,tabIndex:y?-1:0},_.tsx("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:v.thumbElement,"data-thumb-index":t,"touch-action":"none"}),this.renderThumbLabel(t))},r.renderThumbLabel=function(e){const{id:t,labels:n,labelInputsEnabled:i,state:s}=this,o=this.visibleElements.labels,r=n.values[e],a=this.classes(v.labelElement,o?null:v.hidden,i&&"disabled"!==s?v.labelElementInteractive:null);return _.tsx("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!o).toString(),bind:this,class:a,"data-thumb-index":e,key:`${t}-label-${e}`,id:`${t}-label-${e}`,role:i?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):r)},r.renderValueInput=function(e){const{disabled:t,values:n}=this,i=n[e];return _.tsx("input",{key:`value-input-${e}`,afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:v.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:t?-1:0,type:"text",value:this._formatInputValue(i,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})},r.renderMax=function(){const{_isMaxInputActive:e,labels:t,rangeLabelInputsEnabled:n,state:i}=this,s=this.visibleElements.rangeLabels,o=this.classes(v.maxElement,{[v.hidden]:!s,[v.maxElementInteractive]:n&&"disabled"!==i,[v.rangeElementActive]:e});return _.tsx("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMaxLabelCreate,bind:this,class:o,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:n?"button":null,tabIndex:!this.disabled&&n?0:-1},e?this.renderMaxInput():t.max)},r.renderMin=function(){const{_isMinInputActive:e,labels:t,rangeLabelInputsEnabled:n,state:i}=this,s=this.visibleElements.rangeLabels,o=this.classes(v.minElement,{[v.hidden]:!s,[v.minElementInteractive]:n&&"disabled"!==i,[v.rangeElementActive]:e});return _.tsx("div",{"aria-hidden":(!s).toString(),afterCreate:this._afterMinLabelCreate,bind:this,class:o,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:n?"button":null,tabIndex:!this.disabled&&n?0:-1},e?this.renderMinInput():t.min)},r.renderMaxInput=function(){return _.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:v.rangeInput,"data-input-type":"max",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})},r.renderMinInput=function(){return _.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:v.rangeInput,"data-input-type":"min",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})},r.renderExtraContentElements=function(){return _.tsx("div",{bind:this,class:v.extraContentElement},this.extraNodes)},r.renderTicksContainer=function(){if(this.tickConfigs&&this.trackElement&&(0!==this._trackHeight||0!==this._trackWidth))return this.tickConfigs.map(((e,t)=>_.tsx("div",{key:"ticks-container",class:this.classes(v.ticksContainerElement)},this.renderTicks(e,t))))},r.renderTicks=function(e,t){const{mode:n,values:s}=e;if(this.tickElements.getItemAt(t)||this.tickElements.add(new i,t),"position"===n){const n=Array.isArray(s)?s:[s];return this._calculateTickPositions(n).map(((n,i)=>this.renderTickGroup(e,i,t,n)))}if("percent"===n&&Array.isArray(s)){const{max:n,min:i}=this,o=n-i,r=s.map((e=>this._applyPrecisionToPosition(e/100*o+i)));return this._calculateTickPositions(r).map(((n,i)=>this.renderTickGroup(e,i,t,n)))}const o=Array.isArray(s)&&s.length?s[0]:isNaN(s)?null:s,r=this._getTickCounts(o,e);return this._calculateEquidistantTickPositions(r).map(((n,i)=>this.renderTickGroup(e,i,t,n)))},r.renderTickGroup=function(e,t,n,i){const s="position"===e.mode?Array.isArray(e.values)?e.values[t]:e.values:this._valueFromPosition(i);if(!o.isNone(s)&&!isNaN(s))return _.tsx("div",{afterCreate:this._afterTickGroupCreate,afterRemoved:this._afterTickGroupRemoved,bind:this,"data-config":e,"data-position":i,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":s,onclick:this._onTickGroupClick,key:`tick-group-${t}`},this.renderTickLine(e,t,n,s),e.labelsVisible?this.renderTickLabel(e,t,n,s):null)},r.renderTickLine=function(e,t,n,i){return _.tsx("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":i.toString(),bind:this,class:v.tickElement,"data-config":e,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":i,key:`tick-label-${t}`,style:this._getPositionStyleForElement(i)})},r.renderTickLabel=function(e,t,n,i){const s=e.labelFormatFunction?e.labelFormatFunction(i,"tick",t):this.viewModel.getLabelForValue(i,"tick",t);return _.tsx("div",{afterCreate:this._afterTickLabelCreate,"aria-label":s,"aria-valuenow":i.toString(),"aria-valuetext":s,bind:this,class:v.tickLabelElement,"data-config":e,"data-tick-config-index":n,"data-tick-group-index":t,"data-value":i,key:`tick-label-${t}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(i)}`},s)},r._afterContainerCreate=function(e){this.addHandles(d.onResize(e,(()=>this.scheduleRender())))},r._afterTrackCreate=function(e){this._set("trackElement",e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()},r._afterTrackRemoved=function(e){e.removeEventListener("pointerdown",this._onTrackPointerDown),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp)},r._afterSegmentCreate=function(e){this.segmentElements.add(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)},r._afterSegmentRemoved=function(e){this.segmentElements.remove(e),e.removeEventListener("pointerdown",this._onSegmentPointerDown)},r._afterEffectiveSegmentCreate=function(e){this.effectiveSegmentElements.add(e)},r._afterEffectiveSegmentRemoved=function(e){this.effectiveSegmentElements.remove(e)},r._afterAnchorCreate=function(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const t=e["data-thumb-index"],n=e["data-value"],i=this.thumbElements.getItemAt(t)||null,s=this.labelElements.getItemAt(t)||null;this.thumbCreatedFunction(t,n,i,s)}},r._afterAnchorUpdate=function(e){if(o.isSome(this._focusedAnchorIndex)){e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}},r._afterAnchorRemoved=function(e){const t=this._anchorElements.indexOf(e,0);t>-1&&this._anchorElements.splice(t,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)},r._afterThumbCreate=function(e){this.thumbElements.add(e)},r._afterThumbRemoved=function(e){this.thumbElements.remove(e)},r._afterLabelCreate=function(e){this.labelElements.add(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)},r._afterLabelRemoved=function(e){this.labelElements.remove(e),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)},r._afterInputCreate=function(e){if(e.focus(),e.select(),this.inputCreatedFunction){const t=e.getAttribute("data-input-type"),n="thumb"===t?e["data-input-index"]:null;this.inputCreatedFunction(e,t,n)}},r._afterTickLineCreate=function(e){const t=e["data-tick-config-index"],n=e["data-tick-group-index"],i=this.tickElements.getItemAt(t);i.getItemAt(n)?i.getItemAt(n).tickElement=e:i.add({groupElement:null,tickElement:e,labelElement:null},n)},r._afterTickLabelCreate=function(e){const t=e["data-tick-config-index"],n=e["data-tick-group-index"],i=this.tickElements.getItemAt(t);i.getItemAt(n)?i.getItemAt(n).labelElement=e:i.add({groupElement:null,labelElement:e,tickElement:null},n)},r._afterTickGroupRemoved=function(e){const t=e["data-tick-config-index"],n=this.tickElements.items[t],i=n?.find((t=>t.groupElement===e));i&&n.remove(i)},r._afterTickGroupCreate=function(e){const t=e["data-config"];if(t&&t.tickCreatedFunction){const n=e["data-tick-config-index"],i=e["data-tick-group-index"],s=e["data-value"],o=this.tickElements?.getItemAt(n)?.getItemAt(i);if(o){o.groupElement=e;const n=o.tickElement||null,i=o.labelElement||null;t.tickCreatedFunction(s,n,i)}}},r._afterMaxLabelCreate=function(e){this._set("maxLabelElement",e)},r._afterMinLabelCreate=function(e){this._set("minLabelElement",e)},r._onAnchorKeyDown=function(e){if(this._isDisabled()||"editing"===this.state)return;const{target:t}=e,n=s.eventKey(e),{_anchorElements:i,values:r}=this,a=t["data-thumb-index"],l=i[a],c=r[a],u=[f.moveAnchorUp,f.moveAnchorDown,f.moveAnchorLeft,f.moveAnchorRight];if(n===f.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=a,this.notifyChange("state");else if(u.includes(n)){e.preventDefault();const{steps:t}=this,i=n===f.moveAnchorUp||n===f.moveAnchorRight?1:-1;if(o.isSome(t))this._toStep(a,this._isReversedLayout()?-1*i:i);else{const{precision:e}=this,t=this._getPositionOfElement(l),n=this._valueFromPosition(t),s=this._isHorizontalLayout()?i:-1*i;let o;o=0===e?this._positionFromValue(n+s):1===e?this._positionFromValue(n+.1*s):t+s,this._toPosition(a,o)}const s=this.values[a];c!==s&&this._emitThumbChangeEvent({index:a,oldValue:c,value:s})}else if(n===f.moveAnchorToMax||n===f.moveAnchorToMin){e.preventDefault();const{min:t,max:i}=this._getAnchorBoundsInPixels(a),s=this._isPositionInverted()?n===f.moveAnchorToMax?t:i:n===f.moveAnchorToMin?t:i;this._toPosition(a,s);const o=this.values[a];c!==o&&this._emitThumbChangeEvent({index:a,oldValue:c,value:o})}},r._onAnchorPointerDown=function(e){if(this._isDisabled())return;const{target:t,clientX:n,clientY:i}=e,s=t["data-thumb-index"];void 0!==s&&(e.preventDefault(),this._anchorElements[s]&&this._anchorElements[s].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:n,clientY:i,index:s,position:this._getPositionOfElement(this._anchorElements[s])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))},r._onAnchorPointerMove=function(e){if("editing"===this.state||!this._dragStartInfo)return;e.preventDefault();const{values:t,_anchorElements:n,_dragged:i,_dragStartInfo:s,_dragStartInfo:{index:o,position:r}}=this,{clientX:a,clientY:l}=e,c=i?"drag":"start",u=n[o],h=this._getPositionOfElement(u),d=this._applyPrecisionToPosition(this._isHorizontalLayout()?r+a-s.clientX:r+l-s.clientY);if(h===d)return;const m=t[o];this._dragged=!0,this._toPosition(o,d);const _=this.values[o];i?m!==_&&this._emitThumbDragEvent({index:o,state:c,value:_}):this._emitThumbDragEvent({index:o,state:c,value:m})},r._onAnchorPointerUp=function(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:t}=this._dragStartInfo,n=this._dragged,i=this.values[t];this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=t,this.notifyChange("state"),n?this._emitThumbDragEvent({index:t,state:"stop",value:i}):(this.scheduleRender(),"editing"!==this.state&&this._emitThumbClickEvent({index:t,value:i}))},r._onTrackPointerDown=function(e){const{_dragStartInfo:t,snapOnClickEnabled:n,state:i,values:s}=this;if(this._isDisabled()||"editing"===i||t)return;if(document.addEventListener("pointermove",this._onTrackPointerMove),document.addEventListener("pointerup",this._onTrackPointerUp),!n||!s.length)return;const{steps:r}=this,{clientX:a,clientY:l}=e,c=this._getCursorPositionFromEvent(e),u=this._valueFromPosition(c),h=this._getIndexOfNearestValue(u),d=s[h],m=s.some(((e,t)=>e===d&&t!==h))&&u>d?this.values.lastIndexOf(d):h;if(o.isNone(m))return;const _=s[m],p=o.isSome(r)?this._calculateNearestStepPosition(c):c;this._toPosition(m,p),this._dragged=!0,this._dragStartInfo={clientX:a,clientY:l,index:m,position:p},this._focusedAnchorIndex=m,this.notifyChange("state"),this._emitThumbDragEvent({index:m,state:"start",value:_});const v=this.values[m];_!==v&&this._emitThumbDragEvent({index:m,state:"drag",value:v}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)},r._onTrackPointerMove=function(e){e.preventDefault(),this._dragged=!0},r._onTrackPointerUp=function(e){if(e.preventDefault(),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp),this.snapOnClickEnabled||(this._dragged=!1),!this._dragged){const t=this._getCursorPositionFromEvent(e),n=this._valueFromPosition(t);this._emitTrackClickEvent({value:n})}},r._onSegmentPointerDown=function(e){e.preventDefault();const t=e.target,n=t["data-segment-index"],i=t["data-min-thumb-index"],s=t["data-max-thumb-index"];if(this._isDisabled()||o.isNone(i)||o.isNone(s))return;e.stopPropagation(),this._storeTrackDimensions(),document.addEventListener("pointerup",this._onSegmentPointerUp);const r=this._getAnchorDetails(i),a=this._getAnchorDetails(s);this.syncedSegmentsEnabled?(this.segmentElements.forEach((e=>e.classList.add(v.segmentElementActive))),this._anchorElements.forEach((e=>e.classList.add(v.anchorElementActive)))):(this.segmentElements.getItemAt(n).classList.add(v.segmentElementActive),this._anchorElements[r.index]?.classList.add(v.anchorElementActive),this._anchorElements[a.index]?.classList.add(v.anchorElementActive)),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:n,details:this._normalizeSegmentDetails({min:r,max:a})},this.draggableSegmentsEnabled&&(document.addEventListener("pointermove",this._onSegmentPointerMove),this.notifyChange("state"),this._emitSegmentDragEvent({index:n,state:"start",thumbIndices:[i,s]}))},r._onSegmentPointerMove=function(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:t,_trackWidth:n,_segmentDragStartInfo:{index:i,cursorPosition:s,details:{min:o,max:r}}}=this,{index:a,position:l,value:c}=o,{index:u,position:h,value:d}=r;this._dragged=!0;const m=this._getCursorPositionFromEvent(e);if(m===s)return;const _=this._positionToPercent(s),p=this._positionToPercent(m)-_,v=this._positionToPercent(l)+p,f=this._positionToPercent(h)+p,{min:g}=this._getAnchorBoundsAsPercents(a),{max:b}=this._getAnchorBoundsAsPercents(u);let E=!1,y=!1;if(v<g?E=!0:f>b&&(y=!0),E){const{min:e,max:t}=this.viewModel.getBoundsForValueAtIndex(a),n=this._isPositionInverted()?t:e,i=n,s=d+(n-c),o=s-this.values[u];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(o):this._updateAnchorValues([a,u],[i,s]))}if(y){const{min:e,max:t}=this.viewModel.getBoundsForValueAtIndex(u),n=this._isPositionInverted()?e:t,i=n,s=c+(n-d),o=s-this.values[a];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(o):this._updateAnchorValues([a,u],[s,i]))}const x=this._isHorizontalLayout()?n:t,k=f/100*x,I=v/100*x,P=this.values,A=[P[a],P[u]],S=this._getValueForAnchorAtPosition(a,I),L=this._getValueForAnchorAtPosition(u,k);this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(S-A[0]):this._updateAnchorValues([a,u],[S,L]);[this.values[a],this.values[u]].every(((e,t)=>e===A[t]))||this._emitSegmentDragEvent({index:i,state:"drag",thumbIndices:[a,u]})},r._onSegmentPointerUp=function(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{_dragged:t,max:n,min:i,values:s}=this,{index:o,details:{min:{index:r},max:{index:a}}}=this._segmentDragStartInfo;if(this.segmentElements.forEach((e=>e.classList.remove(v.segmentElementActive))),this._anchorElements.forEach((e=>e.classList.remove(v.anchorElementActive))),this.draggableSegmentsEnabled){const e=n-i,t=s[r],l=s[a];this._lastMovedHandleIndex=t===l?t>e/2?r:a:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:o,state:"stop",thumbIndices:[r,a]})}if(!t){const t=this._getCursorPositionFromEvent(e),n=this._valueFromPosition(t);this._emitSegmentClickEvent({index:o,value:n,thumbIndices:[r,a]})}},r._onTickGroupClick=function(e){const t=e.target;if(t["data-config"]){const e=t["data-tick-config-index"],n=t["data-tick-group-index"],i=t["data-value"];this._emitTickClickEvent({configIndex:e,groupIndex:n,value:i})}},r._storeTrackDimensions=function(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}},r._onLabelPointerDown=function(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))},r._onLabelPointerMove=function(){this._isDisabled()||(this._dragged=!0)},r._onLabelPointerUp=function(e){if(this._isDisabled())return;const t=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&o.isSome(t)&&(this._activeLabelInputIndex=t),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)},r._onLabelInputBlur=function(e){const{_activeLabelInputIndex:t,values:n,viewModel:i}=this,s=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!s)return;const o=this._parseInputValue(s,"value",t),r=n[t],{min:a,max:l}=this.viewModel.getBoundsForValueAtIndex(t);if(o<a||o>l)return;i.setValue(t,o);const c=this.values[t];r!==c&&this._emitThumbChangeEvent({index:t,oldValue:r,value:c})},r._onInputKeyDown=function(e){if(this._isDisabled())return;const{target:t}=e,n=s.eventKey(e),{hideInput1:i,hideInput2:r,hideInput3:a}=f,{_activeLabelInputIndex:l,_anchorElements:c}=this,u=t;if(n===i||n===r||n===a){e.stopPropagation();const t=l;u.blur(),o.isSome(t)?c[t].focus():u.parentElement.focus()}},r._onMaxLabelClick=function(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"max-click",value:this.max}),this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state")))},r._onMaxLabelKeyDown=function(e){this._isDisabled()||s.eventKey(e)!==f.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))},r._onMaxInputBlur=function(e){const t=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!t)return;const n=this.max,i=this._parseInputValue(t,"max");i<=this.min||(this.viewModel.set("max",i),this.max!==n&&this._emitMaxChangeEvent({oldValue:n,value:this.max}))},r._onMinLabelClick=function(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"min-click",value:this.min}),this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state")))},r._onMinLabelKeyDown=function(e){this._isDisabled()||s.eventKey(e)!==f.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))},r._onMinInputBlur=function(e){const t=e.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!t)return;const n=this.min,i=this._parseInputValue(t,"min");i>=this.max||(this.viewModel.set("min",i),this.min!==n&&this._emitMinChangeEvent({oldValue:n,value:this.min}))},r._isDisabled=function(){return this.disabled||"disabled"===this.state},r._positionFromValue=function(e){const{max:t,min:n}=this,i=t-n;if(0===i)return 0;const{_trackHeight:s,_trackWidth:o}=this,r=this._isHorizontalLayout();let a=r?parseFloat((o*(e-n)/i).toFixed(2)):parseFloat((s*(t-e)/i).toFixed(2));return this._isReversedLayout()&&(a=r?o-a:s-a),a},r._valueFromPosition=function(e){const{_trackHeight:t,_trackWidth:n,max:i,min:s,precision:o}=this,r=i-s;let a=this._isHorizontalLayout()?e*r/n+s:r*(1e3-e/t*1e3)/1e3+s;return this._isReversedLayout()&&(a=i+s-a),parseFloat(a.toFixed(o))},r._positionToPercent=function(e){const{_trackHeight:t,_trackWidth:n}=this,i=100*e/(this._isHorizontalLayout()?n:t);return this._applyPrecisionToPosition(i)},r._applyPrecisionToPosition=function(e){return parseFloat(e.toFixed(this._positionPrecision))},r._isPositionInverted=function(){const{layout:e}=this;return"horizontal-reversed"===e||"vertical"===e},r._isHorizontalLayout=function(){return this.layout.includes("horizontal")},r._isReversedLayout=function(){return this.layout.includes("reversed")},r._normalizeSegmentDetails=function(e){if(this._isPositionInverted()){const{min:t,max:n}=e;return{min:n,max:t}}return e},r._parseInputValue=function(e,t,n){return this.inputParseFunction?this.inputParseFunction(e,t,n):this.viewModel.defaultInputParseFunction(e)},r._formatInputValue=function(e,t,n){return this.inputFormatFunction?this.inputFormatFunction(e,t,n):this.viewModel.defaultInputFormatFunction(e)},r._getAnchorDetails=function(e){const t=[...this.values].sort(((e,t)=>e-t))[e],n=this.values.indexOf(t);return{index:n,position:this._getPositionOfElement(this._anchorElements[n]),value:t}},r._updateAnchorStyle=function(e,t){const n=this._anchorElements[e];n&&(this._isHorizontalLayout()?n.style.left=`${t}`:n.style.top=`${t}`)},r._getStyleForAnchor=function(e,t,n){const i=this._getPositionStyleForElement(e);if(1===this.values.length)return`${i}`;const s=this._zIndices[t];return`${i}; z-index: ${n?this._zIndexOffset+s:s}`},r._getPositionStyleForElement=function(e){const t=this._positionFromValue(e),n=this._positionToPercent(t);return`${this._isHorizontalLayout()?"left":"top"}: ${n+"%"}`},r._getPositionOfElement=function(e){const t=this._getDimensions(e.offsetParent),n=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(n.left-t.left):this._applyPrecisionToPosition(n.top-t.top)},r._updateAnchorValues=function(e,t){e.forEach(((e,n)=>this._toValue(e,t[n])))},r._updateAnchorValuesByDifference=function(e){const{min:t,max:n,values:i}=this;i.forEach(((i,s)=>this._toValue(s,Math.max(Math.min(i+e,n),t))))},r._toValue=function(e,t){if(o.isSome(this.steps)){t=this._getStepValues()[this._getIndexOfNearestStepValue(t)]}this._updateAnchorStyle(e,this._getPositionStyleForElement(t)),this.viewModel.setValue(e,t)},r._toPosition=function(e,t){const n=o.isSome(this.steps)?this._getStepValueForAnchorAtPosition(e,t):this._getValueForAnchorAtPosition(e,t);this._updateAnchorStyle(e,this._getPositionStyleForElement(n)),this.viewModel.setValue(e,n)},r._getValueForAnchorAtPosition=function(e,t){const{min:n,max:i}=this._getAnchorBoundsInPixels(e),{min:s,max:o}=this.viewModel.getBoundsForValueAtIndex(e);let r,a,l=null;return this._isPositionInverted()?(r=s,a=o):(r=o,a=s),l=t>i?r:t<n?a:this._valueFromPosition(t),l>o?l=o:l<s&&(l=s),l},r._getStepValueForAnchorAtPosition=function(e,t){const n=this._getStepValues(),i=this._calculateNearestStepPosition(t),s=this._getValueForAnchorAtPosition(e,i);return n[this._getIndexOfNearestStepValue(s)]},r._getAnchorBoundsAsPercents=function(e){const{min:t,max:n}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(t),max:this._positionToPercent(n)}},r._getAnchorBoundsInPixels=function(e){const{_anchorElements:t,_trackHeight:n,_trackWidth:i,effectiveMax:s,effectiveMin:r,thumbsConstrained:a}=this,l=t[e-1],c=t[e+1],u=this._isHorizontalLayout()?i:n;let h,d;return this._isPositionInverted()?(h=o.isSome(r)?this._positionFromValue(r):u,d=o.isSome(s)?this._positionFromValue(s):0):(h=o.isSome(s)?this._positionFromValue(s):u,d=o.isSome(r)?this._positionFromValue(r):0),a?this._isPositionInverted()?{max:l?this._getPositionOfElement(l):h,min:c?this._getPositionOfElement(c):d}:{max:c?this._getPositionOfElement(c):h,min:l?this._getPositionOfElement(l):d}:{max:h,min:d}},r._getIndexOfNearestValue=function(e){return this.values.indexOf(this.values.reduce(((t,n)=>Math.abs(n-e)<Math.abs(t-e)?n:t)))},r._getCursorPositionFromEvent=function(e){const t=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-t.left:e.clientY-t.top},r._getStepValues=function(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:t,min:n}=this,i=Math.ceil((t-n)/e),s=[];for(let o=0;o<=i;o++){const i=n+e*o;s.push(i>t?t:i)}return s},r._toStep=function(e,t){const{values:n,viewModel:i}=this,s=n[e],o=this._getStepValues(),r=o.indexOf(s);let a=null;if(r>-1){let n=o[r+t];isNaN(n)&&(n=o[r]);const i=this._positionFromValue(n);a=this._getStepValueForAnchorAtPosition(e,i)}else{a=o[this._getIndexOfNearestStepValue(s)+t]}i.setValue(e,a)},r._getIndexOfNearestStepValue=function(e){const{steps:t}=this;if(o.isNone(t))return null;const n=this._getStepValues(),i=n.reduce(((t,n)=>Math.abs(n-e)<Math.abs(t-e)?n:t));return n.indexOf(i)},r._calculateNearestStepPosition=function(e){const t=this._valueFromPosition(e),n=this._getIndexOfNearestStepValue(t),i=this._getStepValues();return this._positionFromValue(i[n])},r._getTickCounts=function(e,t){const{mode:n}=t;return"count"===n||"position"===n?e||0:"percent"===n&&100/e||0},r._calculateTickPositions=function(e){return e.map((e=>this._positionFromValue(e)))},r._calculateEquidistantTickPositions=function(e){const{_trackWidth:t,_trackHeight:n}=this,i=this._isHorizontalLayout()?t:n,s=i/(e-1),o=[];if(1===e)return[i/2];for(let r=0;r<e;r++){const e=r*s;e<=i&&o.push(e)}return o},r._getDimensions=function(e){try{return e.getBoundingClientRect()}catch(t){if("object"==typeof t&&null!==t)return new DOMRect(0,0,0,0);throw t}},r._emitTrackClickEvent=function(e){this.emit("track-click",{...e,type:"track-click"})},r._emitTickClickEvent=function(e){this.emit("tick-click",{...e,type:"tick-click"})},r._emitMaxChangeEvent=function(e){this.emit("max-change",{...e,type:"max-change"})},r._emitMinChangeEvent=function(e){this.emit("min-change",{...e,type:"min-change"})},r._emitThumbChangeEvent=function(e){this.emit("thumb-change",{...e,type:"thumb-change"})},r._emitThumbClickEvent=function(e){this.emit("thumb-click",{...e,type:"thumb-click"})},r._emitThumbDragEvent=function(e){this.emit("thumb-drag",{...e,type:"thumb-drag"})},r._emitSegmentClickEvent=function(e){this.emit("segment-click",{...e,type:"segment-click"})},r._emitSegmentDragEvent=function(e){this.emit("segment-drag",{...e,type:"segment-drag"})},r._emitRangeLabelClickEvent=function(e){this.emit(e.type,{...e})},e._createClass(n,[{key:"effectiveMax",get:function(){return this.viewModel.effectiveMax},set:function(e){this.viewModel.effectiveMax=e}},{key:"effectiveMin",get:function(){return this.viewModel.effectiveMin},set:function(e){this.viewModel.effectiveMin=e}},{key:"inputFormatFunction",get:function(){return this.viewModel.inputFormatFunction},set:function(e){this.viewModel.inputFormatFunction=e}},{key:"inputParseFunction",get:function(){return this.viewModel.inputParseFunction},set:function(e){this.viewModel.inputParseFunction=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"labelFormatFunction",get:function(){return this.viewModel.labelFormatFunction},set:function(e){this.viewModel.labelFormatFunction=e}},{key:"labels",get:function(){return this.viewModel.labels}},{key:"layout",set:function(e){["vertical","vertical-reversed","horizontal","horizontal-reversed"].includes(e)||(e="horizontal"),this._set("layout",e)}},{key:"max",get:function(){return this.viewModel.max},set:function(e){this.viewModel.max=e}},{key:"min",get:function(){return this.viewModel.min},set:function(e){this.viewModel.min=e}},{key:"precision",get:function(){return this.viewModel.precision},set:function(e){this.viewModel.precision=e}},{key:"state",get:function(){const{_activeLabelInputIndex:e,_isMaxInputActive:t,_isMinInputActive:n,_dragStartInfo:i,_segmentDragStartInfo:s,disabled:r,viewModel:a}=this,l=o.isSome(i)||o.isSome(s);return r?"disabled":!(null===e&&!t&&!n)?"editing":l?"dragging":a.state}},{key:"thumbsConstrained",get:function(){return this.viewModel.thumbsConstrained},set:function(e){this.viewModel.thumbsConstrained=e}},{key:"tickConfigs",set:function(e){this._set("tickConfigs",e),this.scheduleRender()}},{key:"values",get:function(){return this.viewModel.values},set:function(e){this.viewModel.values=e}}]),n}(u);t.__decorate([r.property()],E.prototype,"disabled",void 0),t.__decorate([r.property()],E.prototype,"draggableSegmentsEnabled",void 0),t.__decorate([r.property()],E.prototype,"effectiveMax",null),t.__decorate([r.property()],E.prototype,"effectiveMin",null),t.__decorate([r.property({readOnly:!0})],E.prototype,"effectiveSegmentElements",void 0),t.__decorate([r.property()],E.prototype,"extraNodes",void 0),t.__decorate([r.property()],E.prototype,"inputCreatedFunction",void 0),t.__decorate([r.property()],E.prototype,"inputFormatFunction",null),t.__decorate([r.property()],E.prototype,"inputParseFunction",null),t.__decorate([r.property()],E.prototype,"label",null),t.__decorate([r.property({readOnly:!0})],E.prototype,"labelElements",void 0),t.__decorate([r.property()],E.prototype,"labelInputsEnabled",void 0),t.__decorate([r.property()],E.prototype,"labelFormatFunction",null),t.__decorate([r.property({readOnly:!0})],E.prototype,"labels",null),t.__decorate([r.property({value:"horizontal"})],E.prototype,"layout",null),t.__decorate([r.property()],E.prototype,"max",null),t.__decorate([r.property({readOnly:!0})],E.prototype,"maxLabelElement",void 0),t.__decorate([r.property(),m.messageBundle("esri/widgets/Slider/t9n/Slider")],E.prototype,"messages",void 0),t.__decorate([r.property()],E.prototype,"min",null),t.__decorate([r.property({readOnly:!0})],E.prototype,"minLabelElement",void 0),t.__decorate([r.property()],E.prototype,"precision",null),t.__decorate([r.property()],E.prototype,"rangeLabelInputsEnabled",void 0),t.__decorate([r.property({readOnly:!0})],E.prototype,"segmentElements",void 0),t.__decorate([r.property()],E.prototype,"snapOnClickEnabled",void 0),t.__decorate([r.property({readOnly:!0})],E.prototype,"state",null),t.__decorate([r.property()],E.prototype,"steps",void 0),t.__decorate([r.property()],E.prototype,"syncedSegmentsEnabled",void 0),t.__decorate([r.property()],E.prototype,"thumbsConstrained",null),t.__decorate([r.property()],E.prototype,"thumbCreatedFunction",void 0),t.__decorate([r.property({readOnly:!0})],E.prototype,"thumbElements",void 0),t.__decorate([r.property()],E.prototype,"tickConfigs",null),t.__decorate([r.property({readOnly:!0})],E.prototype,"tickElements",void 0),t.__decorate([r.property({readOnly:!0})],E.prototype,"trackElement",void 0),t.__decorate([r.property()],E.prototype,"values",null),t.__decorate([r.property()],E.prototype,"viewModel",void 0),t.__decorate([r.property()],E.prototype,"visibleElements",void 0),t.__decorate([l.cast("visibleElements")],E.prototype,"castVisibleElements",null),E=t.__decorate([c.subclass(g)],E);return E}));
