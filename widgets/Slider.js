// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../intl","../core/deprecate","../core/events","../core/Logger","../core/maybe","../core/accessorSupport/decorators","../core/libs/pep/pep","../libs/resize-observer/ResizeObserver","./Widget","./Slider/SliderViewModel","./support/widget"],(function(e,t,i,n,o,r,s,a,l,u,h,d,p,c){"use strict";var _="esri-slider",m="esri-slider--reversed",v="esri-slider--horizontal",f="esri-slider--vertical",g="esri-slider__content",b="esri-slider__extra-content",y="esri-slider__track",x="esri-slider__ticks",E="esri-slider__tick",P="esri-slider__tick-label",I="esri-slider__max",k="esri-slider__min",L="esri-slider__max--interactive",S="esri-slider__min--interactive",A="esri-slider__range-input",M="esri-slider__anchor",C="esri-slider__anchor--moving",w="esri-slider__anchor--moved",F="esri-slider__anchor-",D="esri-slider__segment",V="esri-slider__segment-",T="esri-slider__segment--interactive",O="esri-slider__thumb",z="esri-slider__label",H="esri-slider__label--interactive",N="esri-slider__label-input",R="esri-widget",U="esri-disabled",B="esri-hidden",K="Enter",W="Enter",X="Escape",Y="Tab",q="ArrowUp",G="ArrowDown",j="ArrowLeft",J="ArrowRight",Q="End",Z="Home",$=s.getLogger("esri.widgets.Slider"),ee={labels:!1,rangeLabels:!1};return function(e){function t(t,n){var o=e.call(this,t,n)||this;return o._activeLabelInputIndex=null,o._anchorElements=[],o._baseNode=null,o._dragged=!1,o._dragStartInfo=null,o._focusedAnchorIndex=null,o._isMinInputActive=!1,o._isMaxInputActive=!1,o._labelElements=[],o._lastMovedHandleIndex=null,o._observer=null,o._positionPrecision=5,o._segmentDragStartInfo=null,o._segmentElements=[],o._thumbElements=[],o._tickElements=[],o._trackHeight=null,o._trackWidth=null,o._zIndices=null,o._zIndexOffset=3,o.disabled=!1,o.extraNodes=[],o.draggableSegmentsEnabled=!0,o.inputCreatedFunction=null,o.inputFormatFunction=null,o.inputParseFunction=null,o.label=void 0,o.labelInputsEnabled=!1,o.labelFormatFunction=null,o.labels=null,o.max=null,o.messages=null,o.min=null,o.precision=4,o.rangeLabelInputsEnabled=!1,o.snapOnClickEnabled=!0,o.steps=null,o.thumbsConstrained=!0,o.thumbCreatedFunction=null,o.tickConfigs=null,o.trackElement=null,o.values=null,o.viewModel=new p,o.visibleElements=i.__assign({},ee),o._observer=new h((function(){return o.scheduleRender()})),o._onAnchorPointerDown=o._onAnchorPointerDown.bind(o),o._onAnchorPointerMove=o._onAnchorPointerMove.bind(o),o._onAnchorPointerUp=o._onAnchorPointerUp.bind(o),o._onLabelPointerDown=o._onLabelPointerDown.bind(o),o._onLabelPointerUp=o._onLabelPointerUp.bind(o),o._onSegmentPointerDown=o._onSegmentPointerDown.bind(o),o._onSegmentPointerMove=o._onSegmentPointerMove.bind(o),o._onSegmentPointerUp=o._onSegmentPointerUp.bind(o),o._onTrackPointerDown=o._onTrackPointerDown.bind(o),o}return i.__extends(t,e),t.prototype.destroy=function(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove)},Object.defineProperty(t.prototype,"labelsVisible",{set:function(e){o.deprecatedProperty($,"labelsVisible",{replacement:"visibleElements.labels",version:"4.15"}),this.visibleElements=i.__assign(i.__assign({},this.visibleElements),{labels:e})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layout",{set:function(e){-1===["vertical","vertical-reversed","horizontal","horizontal-reversed"].indexOf(e)&&(e="horizontal"),this._set("layout",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rangeLabelsVisible",{set:function(e){o.deprecatedProperty($,"rangeLabelsVisible",{replacement:"visibleElements.rangeLabels",version:"4.15"}),this.visibleElements=i.__assign(i.__assign({},this.visibleElements),{rangeLabels:e})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){var e=this,t=e._activeLabelInputIndex,i=e._isMaxInputActive,n=e._isMinInputActive,o=e._dragStartInfo,r=e._segmentDragStartInfo,s=e.viewModel,l=a.isSome(o)||a.isSome(r);return!(null===t&&!i&&!n)?"editing":l?"dragging":s.state},enumerable:!1,configurable:!0}),t.prototype.castVisibleElements=function(e){return i.__assign(i.__assign({},ee),e)},t.prototype.render=function(){var e=this.label,t=this.classes(_,R,this._isHorizontalLayout()?v:f,this._isReversedLayout()?m:null,this._isDisabled()?U:null);return this._storeTrackDimensions(),c.tsx("div",{afterCreate:this._afterBaseNodeCreate,bind:this,"aria-label":e,class:t,"touch-action":"none"},this.renderContent())},t.prototype.toNextStep=function(e){this._toStep(e,1)},t.prototype.toPreviousStep=function(e){this._toStep(e,-1)},t.prototype.renderContent=function(){var e=this.max,t=this.min;if(a.isSome(t)&&a.isSome(e)&&!(t>e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]},t.prototype.renderSliderContainer=function(){return c.tsx("div",{key:"slider-container",bind:this,class:g},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())},t.prototype.renderTrackElement=function(){return c.tsx("div",{afterCreate:this._afterTrackCreate,bind:this,class:y,"data-node-ref":"trackElement","touch-action":"none"},this.renderSegmentElements(),this.renderAnchorElements())},t.prototype.renderSegmentElements=function(){if(this.trackElement&&this.values&&this.values.length){for(var e=this.values.length+1,t=[],i=0;i<e;i++)t.push(this.renderSegmentElement(i));return t}},t.prototype.renderSegmentElement=function(e){var t,n,o=this,r=o._trackHeight,s=o._trackWidth,l=o.draggableSegmentsEnabled,u=o.id,h=o.state,d=o.values,p=this._isHorizontalLayout(),_=p?s:r,m=e===d.length?null:e,v=0===e?null:e-1,f=a.isSome(m),g=a.isSome(v),b=i.__spreadArrays(d).sort((function(e,t){return e-t}));this._isReversedLayout()?(t=g?this._positionFromValue(b[v]):p?_:0,n=f?this._positionFromValue(b[m]):p?0:_):(t=f?this._positionFromValue(b[m]):p?_:0,n=g?this._positionFromValue(b[v]):p?0:_);var y=this._applyPrecisionToPosition(100*n/_),x=(t-n)/_,E=p?"transform: translate("+y+"%, 0px) scale("+x+", 1);":"transform: translate(0px, "+y+"%) scale(1, "+x+");",P=this.classes(D,V+e,l&&f&&g&&"disabled"!==h?T:null);return c.tsx("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:P,"data-max-thumb-index":m,"data-min-thumb-index":v,"data-segment-index":e,key:u+"-segment-"+e,style:E,"touch-action":"none"})},t.prototype.renderAnchorElements=function(){var e=this,t=this.trackElement,i=this.values;if(i&&i.length)return this._zIndices=i.map((function(t,n){var o=e._positionFromValue(t),r=e._positionToPercent(o),s=(e._isHorizontalLayout()?r>50:r<50)?-1:1;return e._zIndexOffset+(i.length+s*n)})),t&&i&&i.length?i.map((function(t,i){return e.renderAnchorElement(t,i)})):null},t.prototype.renderAnchorElement=function(e,t){var i=this._positionFromValue(e),o=this._valueFromPosition(i);if(a.isSome(o)&&!isNaN(o)){var r=this,s=r._dragStartInfo,l=r._lastMovedHandleIndex,u=r.id,h=r.layout,d=r.values,p=r.visibleElements.labels,_=s&&s.index===t,m=l===t,v=this.classes(M,F+t,_?C:null,m?w:null),f=this.labels.values[t],g=this._getStyleForAnchor(e,t,_||m),b=this.viewModel.getBoundsForValueAtIndex(t),y=b.min,x=b.max,E=this.messages,P=2===d.length?0===t?n.substitute(E.rangeMinimum,{value:e}):n.substitute(E.rangeMaximum,{value:e}):f,I=1===d.length?null:0===t?u+"-handle-"+(t+1):t===d.length-1?u+"-handle-"+(t-1):u+"-handle-"+(t-1)+" "+u+"-handle-"+(t+1);return c.tsx("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":I,"aria-label":E.sliderValue,"aria-labelledby":p?u+"-label-"+t:null,"aria-orientation":h,"aria-valuemax":x.toString(),"aria-valuemin":y.toString(),"aria-valuenow":e.toString(),"aria-valuetext":P,bind:this,class:v,"data-thumb-index":t,"data-value":e,id:u+"-handle-"+t,key:u+"-handle-"+t,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:g,tabIndex:0},c.tsx("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:O,"data-thumb-index":t,"touch-action":"none"}),this.renderThumbLabel(t))}},t.prototype.renderThumbLabel=function(e){var t=this.id,i=this.labels,n=this.labelInputsEnabled,o=this.state,r=this.visibleElements.labels,s=i.values[e],a=this.classes(z,r?null:B,n&&"disabled"!==o?H:null);return c.tsx("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":!r,bind:this,class:a,"data-thumb-index":e,key:t+"-label-"+e,id:t+"-label-"+e,role:n?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):s)},t.prototype.renderValueInput=function(e){var t=this.values[e];return c.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:N,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:0,type:"text",value:this._formatInputValue(t,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})},t.prototype.renderMax=function(){var e=this._isMaxInputActive,t=this.labels,i=this.rangeLabelInputsEnabled,n=this.state,o=this.visibleElements.rangeLabels,r=this.classes(I,o?null:B,i&&"disabled"!==n?L:null);return c.tsx("div",{"aria-hidden":!o,bind:this,class:r,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:i?"button":null,tabIndex:i?0:null},e?this.renderMaxInput():t.max)},t.prototype.renderMin=function(){var e=this._isMinInputActive,t=this.labels,i=this.rangeLabelInputsEnabled,n=this.state,o=this.visibleElements.rangeLabels,r=this.classes(k,o?null:B,i&&"disabled"!==n?S:null);return c.tsx("div",{"aria-hidden":!o,bind:this,class:r,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:i?"button":null,tabIndex:i?0:null},e?this.renderMinInput():t.min)},t.prototype.renderMaxInput=function(){return c.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:A,"data-input-type":"max",required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})},t.prototype.renderMinInput=function(){return c.tsx("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:A,"data-input-type":"min",required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})},t.prototype.renderExtraContentElements=function(){return c.tsx("div",{bind:this,class:b},this.extraNodes)},t.prototype.renderTicksContainer=function(){var e=this;if(this.tickConfigs&&this.trackElement&&(0!==this._trackHeight||0!==this._trackWidth))return this.tickConfigs.map((function(t,i){return c.tsx("div",{key:"ticks-container",class:e.classes(x)},e.renderTicks(t,i))}))},t.prototype.renderTicks=function(e,t){var i=this,n=e.mode,o=e.values;if(this._tickElements[t]=[],"position"===n){var r=Array.isArray(o)?o:[o];return this._calculateTickPositions(r).map((function(n,o){return i.renderTickGroup(e,o,t,n)}))}if("percent"===n&&Array.isArray(o)){var s=this.max,a=this.min,l=s-a,u=o.map((function(e){return i._applyPrecisionToPosition(e/100*l+a)}));return this._calculateTickPositions(u).map((function(n,o){return i.renderTickGroup(e,o,t,n)}))}var h=Array.isArray(o)&&o.length?o[0]:isNaN(o)?null:o,d=this._getTickCounts(h,e);return this._calculateEquidistantTickPositions(d).map((function(n,o){return i.renderTickGroup(e,o,t,n)}))},t.prototype.renderTickGroup=function(e,t,i,n){var o="position"===e.mode?Array.isArray(e.values)?e.values[t]:e.values:this._valueFromPosition(n);if(a.isSome(o)&&!isNaN(o))return c.tsx("div",{afterCreate:this._afterTickGroupCreate,bind:this,"data-config":e,"data-position":n,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":o,key:"tick-group-"+t},this.renderTickLine(e,t,i,o),e.labelsVisible?this.renderTickLabel(e,t,i,o):null)},t.prototype.renderTickLine=function(e,t,i,n){return c.tsx("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":n.toString(),bind:this,class:E,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":n,key:"tick-label-"+t,style:this._getPositionStyleForElement(n)})},t.prototype.renderTickLabel=function(e,t,i,n){var o=e.labelFormatFunction?e.labelFormatFunction(n,"tick",t):this.viewModel.getLabelForValue(n,"tick",t);return c.tsx("div",{afterCreate:this._afterTickLabelCreate,"aria-label":o,"aria-valuenow":n.toString(),"aria-valuetext":o,bind:this,class:P,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":n,key:"tick-label-"+t,style:"transform: translate(-50%); "+this._getPositionStyleForElement(n)},o)},t.prototype._afterBaseNodeCreate=function(e){this._baseNode&&this._observer.unobserve(this._baseNode),this._baseNode=e,this._observer.observe(this._baseNode)},t.prototype._afterTrackCreate=function(e){c.storeNode.call(this,e),u.applyLocal(e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()},t.prototype._afterSegmentCreate=function(e){this._segmentElements.push(e),u.applyLocal(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)},t.prototype._afterSegmentRemoved=function(e){var t=this._segmentElements.indexOf(e,0);t>-1&&this._segmentElements.splice(t,1),e.removeEventListener("pointerdown",this._onSegmentPointerDown)},t.prototype._afterAnchorCreate=function(e){if(this._anchorElements.push(e),u.applyLocal(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){var t=e["data-thumb-index"],i=e["data-value"],n=this._thumbElements[t]||null,o=this._labelElements[t]||null;this.thumbCreatedFunction(t,i,n,o)}},t.prototype._afterAnchorUpdate=function(e){a.isSome(this._focusedAnchorIndex)&&(e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null))},t.prototype._afterAnchorRemoved=function(e){var t=this._anchorElements.indexOf(e,0);t>-1&&this._anchorElements.splice(t,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)},t.prototype._afterThumbCreate=function(e){this._thumbElements.push(e)},t.prototype._afterThumbRemoved=function(e){var t=this._thumbElements.indexOf(e,0);t>-1&&this._thumbElements.splice(t,1)},t.prototype._afterLabelCreate=function(e){this._labelElements.push(e),u.applyLocal(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)},t.prototype._afterLabelRemoved=function(e){var t=this._labelElements.indexOf(e,0);t>-1&&this._labelElements.splice(t,1),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)},t.prototype._afterInputCreate=function(e){if(e.focus(),e.select(),this.inputCreatedFunction){var t=e.getAttribute("data-input-type"),i="thumb"===t?e["data-input-index"]:null;this.inputCreatedFunction(e,t,i)}},t.prototype._afterTickLineCreate=function(e){var t=e["data-tick-config-index"],i=e["data-tick-group-index"],n=this._tickElements[t];n[i]?n[i].line=e:n[i]={line:e,label:null}},t.prototype._afterTickLabelCreate=function(e){var t=e["data-tick-config-index"],i=e["data-tick-group-index"],n=this._tickElements[t];n[i]?n[i].label=e:n[i]={label:e,line:null}},t.prototype._afterTickGroupCreate=function(e){var t=e["data-config"];if(t&&t.tickCreatedFunction){var i=e["data-tick-config-index"],n=e["data-tick-group-index"],o=e["data-value"],r=this._tickElements[i][n];if(r){var s=r.line||null,a=r.label||null;t.tickCreatedFunction(o,s,a)}}},t.prototype._onAnchorKeyDown=function(e){if(!this._isDisabled()&&"editing"!==this.state){var t=e.target,i=r.eventKey(e),n=this._anchorElements,o=this.values,s=t["data-thumb-index"],l=n[s],u=o[s],h=this._isHorizontalLayout(),d=[q,G,j,J];if(i===K&&this.labelInputsEnabled)this._activeLabelInputIndex=s,this.notifyChange("state");else if(d.indexOf(i)>-1){e.preventDefault();var p=this.steps,c=i===q||i===J?1:-1;if(a.isSome(p))this._toStep(s,this._isReversedLayout()?-1*c:c);else{var _=this.precision,m=this._getPositionOfElement(l),v=this._valueFromPosition(m),f=this._isHorizontalLayout()?c:-1*c,g=void 0;g=0===_?this._positionFromValue(v+f):1===_?this._positionFromValue(v+.1*f):m+f,this._toPosition(s,g)}u!==(b=this.values[s])&&this._emitThumbChangeEvent({index:s,oldValue:u,value:b})}else if(i===Q||i===Z){e.preventDefault();var b,y=this._getAnchorBoundsInPixels(s),x=y.min,E=y.max,P=h?i===Q?E:x:i===Z?E:x;this._toPosition(s,P),u!==(b=this.values[s])&&this._emitThumbChangeEvent({index:s,oldValue:u,value:b})}}},t.prototype._onAnchorPointerDown=function(e){if(!this._isDisabled()){var t=e.target,i=e.clientX,n=e.clientY,o=t["data-thumb-index"];void 0!==o&&(e.preventDefault(),this._anchorElements[o]&&this._anchorElements[o].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:i,clientY:n,index:o,position:this._getPositionOfElement(this._anchorElements[o])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}},t.prototype._onAnchorPointerMove=function(e){if("editing"!==this.state&&this._dragStartInfo){e.preventDefault();var t=this,i=t.values,n=t._anchorElements,o=t._dragged,r=t._dragStartInfo,s=t._dragStartInfo,a=s.index,l=s.position,u=e.clientX,h=e.clientY,d=o?"drag":"start",p=n[a],c=this._getPositionOfElement(p),_=this._applyPrecisionToPosition(this._isHorizontalLayout()?l+u-r.clientX:l+h-r.clientY);if(c!==_){var m=i[a];this._dragged=!0,this._toPosition(a,_);var v=this.values[a];o?m!==v&&this._emitThumbDragEvent({index:a,state:d,value:v}):this._emitThumbDragEvent({index:a,state:d,value:m})}}},t.prototype._onAnchorPointerUp=function(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this._dragStartInfo){e.preventDefault();var t=this._dragStartInfo.index,i=this._dragged;this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=t,i?(this.notifyChange("state"),this._emitThumbDragEvent({index:t,state:"stop",value:this.values[t]})):this.scheduleRender()}},t.prototype._onTrackPointerDown=function(e){var t=this._dragStartInfo,i=this.snapOnClickEnabled,n=this.state,o=this.values;if(!this._isDisabled()&&"editing"!==n&&!t&&i&&o.length){var r=this.steps,s=e.clientX,l=e.clientY,u=this._getCursorPositionFromEvent(e),h=this._valueFromPosition(u),d=this._getIndexOfNearestValue(h);if(a.isSome(d)){var p=o[d],c=a.isSome(r)?this._calculateNearestStepPosition(u):u;this._toPosition(d,c),this._dragged=!0,this._dragStartInfo={clientX:s,clientY:l,index:d,position:c},this._focusedAnchorIndex=d,this.notifyChange("state"),this._emitThumbDragEvent({index:d,state:"start",value:p});var _=this.values[d];p!==_&&this._emitThumbDragEvent({index:d,state:"drag",value:_}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}}},t.prototype._onSegmentPointerDown=function(e){e.preventDefault();var t=this.draggableSegmentsEnabled,i=e.target,n=i["data-segment-index"],o=i["data-min-thumb-index"],r=i["data-max-thumb-index"];!this._isDisabled()&&t&&a.isSome(o)&&a.isSome(r)&&(e.stopPropagation(),this._storeTrackDimensions(),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:n,details:this._normalizeSegmentDetails({min:this._getAnchorDetails(o),max:this._getAnchorDetails(r)})},this.notifyChange("state"),this._emitSegmentDragEvent({index:n,state:"start",thumbIndices:[o,r]}),document.addEventListener("pointerup",this._onSegmentPointerUp),document.addEventListener("pointermove",this._onSegmentPointerMove))},t.prototype._onSegmentPointerMove=function(e){if(this._segmentDragStartInfo){e.preventDefault();var t=this._trackHeight,i=this._trackWidth,n=this._segmentDragStartInfo,o=n.index,r=n.cursorPosition,s=n.details,a=s.min,l=s.max,u=a.index,h=a.position,d=a.value,p=l.index,c=l.position,_=l.value;this._dragged=!0;var m=this._getCursorPositionFromEvent(e);if(m!==r){var v=this._positionToPercent(r),f=this._positionToPercent(m)-v,g=this._positionToPercent(h)+f,b=this._positionToPercent(c)+f,y=this._getAnchorBoundsAsPercents(u).min,x=this._getAnchorBoundsAsPercents(p).max,E=!1,P=!1;if(g<y?E=!0:b>x&&(P=!0),E){var I=this.viewModel.getBoundsForValueAtIndex(u),k=I.min,L=I.max,S=M=this._isPositionInverted()?L:k,A=_+(M-d);this._updateAnchorValues([u,p],[S,A])}else if(P){var M,C=this.viewModel.getBoundsForValueAtIndex(p);k=C.min,L=C.max,A=M=this._isPositionInverted()?k:L,S=d+(M-_);this._updateAnchorValues([u,p],[S,A])}else{var w=this._isHorizontalLayout()?i:t,F=b/100*w,D=g/100*w,V=this.values,T=[V[u],V[p]],O=this._getValueForAnchorAtPosition(u,D),z=this._getValueForAnchorAtPosition(p,F);this._updateAnchorValues([u,p],[O,z]),[this.values[u],this.values[p]].every((function(e,t){return e===T[t]}))||this._emitSegmentDragEvent({index:o,state:"drag",thumbIndices:[u,p]})}}}},t.prototype._onSegmentPointerUp=function(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),this._segmentDragStartInfo){var t=this.max,i=this.min,n=this.values,o=this._segmentDragStartInfo,r=o.index,s=o.details,a=s.min.index,l=s.max.index,u=t-i,h=n[a],d=n[l];this._lastMovedHandleIndex=h===d?h>u/2?a:l:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:r,state:"stop",thumbIndices:[a,l]})}},t.prototype._storeTrackDimensions=function(){if(this.trackElement){var e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}},t.prototype._onLabelPointerDown=function(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))},t.prototype._onLabelPointerMove=function(){this._isDisabled()||(this._dragged=!0)},t.prototype._onLabelPointerUp=function(e){if(!this._isDisabled()){var t=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&a.isSome(t)&&(this._activeLabelInputIndex=t),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}},t.prototype._onLabelInputBlur=function(e){var t=this._activeLabelInputIndex,i=this.values,n=this.viewModel,o=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),o){var r=this._parseInputValue(o,"value",t),s=i[t],a=this.viewModel.getBoundsForValueAtIndex(t),l=a.min,u=a.max;if(!(r<l||r>u)){n.setValue(t,r);var h=this.values[t];s!==h&&this._emitThumbChangeEvent({index:t,oldValue:s,value:h})}}},t.prototype._onInputKeyDown=function(e){if(!this._isDisabled()){var t=e.target,i=r.eventKey(e),n=W,o=X,s=Y,l=this._activeLabelInputIndex,u=this._anchorElements,h=t;if(i===n||i===o||i===s){e.stopPropagation();var d=l;h.blur(),a.isSome(d)?u[d].focus():h.parentElement.focus()}}},t.prototype._onMaxLabelClick=function(){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state"))},t.prototype._onMaxLabelKeyDown=function(e){this._isDisabled()||r.eventKey(e)!==K||(this._isMaxInputActive=!0,this.notifyChange("state"))},t.prototype._onMaxInputBlur=function(e){var t=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),t){var i=this.max,n=this._parseInputValue(t,"max");n<=this.min||(this.viewModel.set("max",n),this.max!==i&&this._emitMaxChangeEvent({oldValue:i,value:this.max}))}},t.prototype._onMinLabelClick=function(){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state"))},t.prototype._onMinLabelKeyDown=function(e){this._isDisabled()||r.eventKey(e)!==K||(this._isMinInputActive=!0,this.notifyChange("state"))},t.prototype._onMinInputBlur=function(){var e=event.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),e){var t=this.min,i=this._parseInputValue(e,"min");i>=this.max||(this.viewModel.set("min",i),this.min!==t&&this._emitMinChangeEvent({oldValue:t,value:this.min}))}},t.prototype._isDisabled=function(){return this.disabled||"disabled"===this.state},t.prototype._positionFromValue=function(e){var t=this.max,i=this.min,n=t-i;if(0===n)return 0;var o=this._trackHeight,r=this._trackWidth,s=this._isHorizontalLayout(),a=s?parseFloat((r*(e-i)/n).toFixed(2)):parseFloat((o*(t-e)/n).toFixed(2));return this._isReversedLayout()&&(a=s?r-a:o-a),a},t.prototype._valueFromPosition=function(e){var t=this,i=t._trackHeight,n=t._trackWidth,o=t.max,r=t.min,s=t.precision,a=o-r,l=this._isHorizontalLayout()?e*a/n+r:a*(1e3-e/i*1e3)/1e3+r;return this._isReversedLayout()&&(l=o+r-l),parseFloat(l.toFixed(s))},t.prototype._positionToPercent=function(e){var t=this._trackHeight,i=this._trackWidth,n=100*e/(this._isHorizontalLayout()?i:t);return this._applyPrecisionToPosition(n)},t.prototype._applyPrecisionToPosition=function(e){return parseFloat(e.toFixed(this._positionPrecision))},t.prototype._isPositionInverted=function(){var e=this.layout;return"horizontal-reversed"===e||"vertical"===e},t.prototype._isHorizontalLayout=function(){return this.layout.indexOf("horizontal")>-1},t.prototype._isReversedLayout=function(){return this.layout.indexOf("reversed")>-1},t.prototype._normalizeSegmentDetails=function(e){if(this._isPositionInverted()){var t=e.min;return{min:e.max,max:t}}return e},t.prototype._parseInputValue=function(e,t,i){return this.inputParseFunction?this.inputParseFunction(e,t,i):this.viewModel.defaultInputParseFunction(e)},t.prototype._formatInputValue=function(e,t,i){return this.inputFormatFunction?this.inputFormatFunction(e,t,i):this.viewModel.defaultInputFormatFunction(e)},t.prototype._getAnchorDetails=function(e){return{index:e,position:this._getPositionOfElement(this._anchorElements[e]),value:this.values[e]}},t.prototype._updateAnchorStyle=function(e,t){var i=this._anchorElements[e];i&&(this._isHorizontalLayout()?i.style.left=""+t:i.style.top=""+t)},t.prototype._getStyleForAnchor=function(e,t,i){var n=this._getPositionStyleForElement(e);if(1===this.values.length)return""+n;var o=this._zIndices[t];return n+"; z-index: "+(i?this._zIndexOffset+o:o)},t.prototype._getPositionStyleForElement=function(e){var t=this._positionFromValue(e),i=this._positionToPercent(t);return(this._isHorizontalLayout()?"left":"top")+": "+i+"%"},t.prototype._getPositionOfElement=function(e){var t=this._getDimensions(e.offsetParent),i=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(i.left-t.left):this._applyPrecisionToPosition(i.top-t.top)},t.prototype._updateAnchorValues=function(e,t){var i=this;e.forEach((function(e,n){return i._toValue(e,t[n])}))},t.prototype._toValue=function(e,t){a.isSome(this.steps)&&(t=this._getStepValues()[this._getIndexOfNearestStepValue(t)]);this._updateAnchorStyle(e,this._getPositionStyleForElement(t)),this.viewModel.setValue(e,t)},t.prototype._toPosition=function(e,t){var i=a.isSome(this.steps)?this._getStepValueForAnchorAtPosition(e,t):this._getValueForAnchorAtPosition(e,t);this._updateAnchorStyle(e,this._getPositionStyleForElement(i)),this.viewModel.setValue(e,i)},t.prototype._getValueForAnchorAtPosition=function(e,t){var i,n,o=this._getAnchorBoundsInPixels(e),r=o.min,s=o.max,a=this.viewModel.getBoundsForValueAtIndex(e),l=a.min,u=a.max,h=null;return this._isPositionInverted()?(i=l,n=u):(i=u,n=l),(h=t>s?i:t<r?n:this._valueFromPosition(t))>u?h=u:h<l&&(h=l),h},t.prototype._getStepValueForAnchorAtPosition=function(e,t){var i=this._getStepValues(),n=this._calculateNearestStepPosition(t),o=this._getValueForAnchorAtPosition(e,n);return i[this._getIndexOfNearestStepValue(o)]},t.prototype._getAnchorBoundsAsPercents=function(e){var t=this._getAnchorBoundsInPixels(e),i=t.min,n=t.max;return{min:this._positionToPercent(i),max:this._positionToPercent(n)}},t.prototype._getAnchorBoundsInPixels=function(e){var t=this._anchorElements,i=this._trackHeight,n=this._trackWidth,o=this.thumbsConstrained,r=t[e-1],s=t[e+1],a=this._isHorizontalLayout()?n:i;return o?this._isPositionInverted()?{max:r?this._getPositionOfElement(r):a,min:s?this._getPositionOfElement(s):0}:{max:s?this._getPositionOfElement(s):a,min:r?this._getPositionOfElement(r):0}:{max:a,min:0}},t.prototype._getIndexOfNearestValue=function(e){return this.values.indexOf(this.values.reduce((function(t,i){return Math.abs(i-e)<Math.abs(t-e)?i:t})))},t.prototype._getCursorPositionFromEvent=function(e){var t=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-t.left:e.clientY-t.top},t.prototype._getStepValues=function(){var e=this.steps;if(Array.isArray(e))return e;for(var t=this.max,i=this.min,n=Math.ceil((t-i)/e),o=[],r=0;r<=n;r++){var s=i+e*r;o.push(s>t?t:s)}return o},t.prototype._toStep=function(e,t){var i=this.values,n=this.viewModel,o=i[e],r=this._getStepValues(),s=r.indexOf(o),a=null;if(s>-1){var l=r[s+t],u=this._positionFromValue(l);a=this._getStepValueForAnchorAtPosition(e,u)}else{a=r[this._getIndexOfNearestStepValue(o)+t]}n.setValue(e,a)},t.prototype._getIndexOfNearestStepValue=function(e){var t=this.steps;if(!a.isSome(t))return null;var i=this._getStepValues(),n=i.reduce((function(t,i){return Math.abs(i-e)<Math.abs(t-e)?i:t}));return i.indexOf(n)},t.prototype._calculateNearestStepPosition=function(e){var t=this._valueFromPosition(e),i=this._getIndexOfNearestStepValue(t),n=this._getStepValues();return this._positionFromValue(n[i])},t.prototype._getTickCounts=function(e,t){var i=t.mode;return"count"===i||"position"===i?e||0:"percent"===i&&100/e||0},t.prototype._calculateTickPositions=function(e){var t=this;return e.map((function(e){return t._positionFromValue(e)}))},t.prototype._calculateEquidistantTickPositions=function(e){var t=this._trackWidth,i=this._trackHeight,n=this._isHorizontalLayout()?t:i,o=n/(e-1),r=[];if(1===e)return[n/2];for(var s=0;s<e;s++){var a=s*o;a<=n&&r.push(a)}return r},t.prototype._getDimensions=function(e){try{return e.getBoundingClientRect()}catch(e){if("object"==typeof e&&null!==e)return{top:0,bottom:0,left:0,width:0,height:0,right:0};throw e}},t.prototype._emitMaxChangeEvent=function(e){this.emit("max-change",i.__assign(i.__assign({},e),{type:"max-change"}))},t.prototype._emitMinChangeEvent=function(e){this.emit("min-change",i.__assign(i.__assign({},e),{type:"min-change"}))},t.prototype._emitThumbChangeEvent=function(e){this.emit("thumb-change",i.__assign(i.__assign({},e),{type:"thumb-change"}))},t.prototype._emitThumbDragEvent=function(e){this.emit("thumb-drag",i.__assign(i.__assign({},e),{type:"thumb-drag"}))},t.prototype._emitSegmentDragEvent=function(e){this.emit("segment-drag",i.__assign(i.__assign({},e),{type:"segment-drag"}))},i.__decorate([l.property(),c.renderable()],t.prototype,"disabled",void 0),i.__decorate([l.property()],t.prototype,"extraNodes",void 0),i.__decorate([l.property(),c.renderable()],t.prototype,"draggableSegmentsEnabled",void 0),i.__decorate([l.property()],t.prototype,"inputCreatedFunction",void 0),i.__decorate([l.aliasOf("viewModel.inputFormatFunction")],t.prototype,"inputFormatFunction",void 0),i.__decorate([l.aliasOf("viewModel.inputParseFunction")],t.prototype,"inputParseFunction",void 0),i.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),i.__decorate([l.property()],t.prototype,"labelInputsEnabled",void 0),i.__decorate([l.aliasOf("viewModel.labelFormatFunction")],t.prototype,"labelFormatFunction",void 0),i.__decorate([l.aliasOf("viewModel.labels")],t.prototype,"labels",void 0),i.__decorate([l.property(),c.renderable()],t.prototype,"labelsVisible",null),i.__decorate([l.property({value:"horizontal"}),c.renderable()],t.prototype,"layout",null),i.__decorate([l.aliasOf("viewModel.max")],t.prototype,"max",void 0),i.__decorate([l.property(),c.renderable(),c.messageBundle("esri/widgets/Slider/t9n/Slider")],t.prototype,"messages",void 0),i.__decorate([l.aliasOf("viewModel.min")],t.prototype,"min",void 0),i.__decorate([l.aliasOf("viewModel.precision")],t.prototype,"precision",void 0),i.__decorate([l.property()],t.prototype,"rangeLabelInputsEnabled",void 0),i.__decorate([l.property(),c.renderable()],t.prototype,"rangeLabelsVisible",null),i.__decorate([l.property()],t.prototype,"snapOnClickEnabled",void 0),i.__decorate([l.property({dependsOn:["viewModel.state"],readOnly:!0}),c.renderable()],t.prototype,"state",null),i.__decorate([l.property(),c.renderable()],t.prototype,"steps",void 0),i.__decorate([l.aliasOf("viewModel.thumbsConstrained")],t.prototype,"thumbsConstrained",void 0),i.__decorate([l.property()],t.prototype,"thumbCreatedFunction",void 0),i.__decorate([l.property(),c.renderable()],t.prototype,"tickConfigs",void 0),i.__decorate([l.property()],t.prototype,"trackElement",void 0),i.__decorate([l.aliasOf("viewModel.values")],t.prototype,"values",void 0),i.__decorate([l.property(),c.renderable(["viewModel.thumbsConstrained","viewModel.max","viewModel.min","viewModel.precision","viewModel.labelFormatFunction","viewModel.labels","viewModel.values"])],t.prototype,"viewModel",void 0),i.__decorate([l.property(),c.renderable()],t.prototype,"visibleElements",void 0),i.__decorate([l.cast("visibleElements")],t.prototype,"castVisibleElements",null),t=i.__decorate([l.subclass("esri.widgets.Slider")],t)}(d)}));