/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Handles","../../core/Logger","../../core/maybe","../../core/reactiveUtils","../../core/unitUtils","../../core/watchUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../../properties/defaultUnit","../../views/3d/interactive/measurementTools/directLineMeasurement3D/DirectLineMeasurement3DTool","../support/InteractiveToolViewModel"],(function(e,t,i,n,r,s,o,a,l,u,c,d,h,p,_){"use strict";const f=n.getLogger("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel");let y=function(t){function n(e){var n;return(n=t.call(this,e)||this).logger=f,n.supportedViewType="3d",n.unsupportedErrorMessage="DirectLineMeasurement3DViewModel is only supported in 3D views.",n._handles=new i,n._userUnitOptions=null,n._userUnit=null,n.ready=!1,n}e._inheritsLoose(n,t);var l=n.prototype;return l.initialize=function(){this._handles.add([a.init(this,"unit",(e=>{r.isSome(this.tool)&&(this.tool.unit=e)})),s.react((()=>({view:this.view,ready:r.isSome(this.view)&&this.view.ready})),(({view:e})=>{this._disconnectFromView(),this._connectToView(e)}),{sync:!0})]),this._connectToView(this.view)},l.destroy=function(){this._handles=r.destroyMaybe(this._handles)},l.start=function(){return this.createTool()},l.clear=function(){this.removeTool()},l.createToolParams=function(){return{toolConstructor:p,constructorArguments:()=>({unit:this.unit})}},l._findSelectableUnit=function(e,t){const i=this.unitOptions;return-1!==i.indexOf(e)?e:t?this._findSelectableUnit(t):i[0]},l._filteredOrAllUnits=function(e){if(!e)return o.measurementLengthUnits.slice();const t=e.filter((e=>-1!==o.measurementLengthUnits.indexOf(e)));return 0===t.length?o.measurementLengthUnits.slice():t},l._connectToView=function(){var t=e._asyncToGenerator((function*(e){r.isSome(e)&&e.ready&&"3d"===e.type&&(this.ready=!0)}));function i(e){return t.apply(this,arguments)}return i}(),l._disconnectFromView=function(){this.ready=!1},e._createClass(n,[{key:"state",get:function(){return this.disabled?"disabled":r.isNone(this.tool)?"ready":this.tool.state}},{key:"measurement",get:function(){if(r.isNone(this.tool))return null;const e={mode:"euclidean",directDistance:{text:null,state:"unavailable"},horizontalDistance:{text:null,state:"unavailable"},verticalDistance:{text:null,state:"unavailable"}},t=this.tool.measurementView.analysisView;if(r.isNone(t))return e;const i=t.actualVisualizedMeasurement,n=this.tool.measurementView,s=r.isSome(t.result)?"available":"unavailable";switch(i){case 1:return{mode:"euclidean",directDistance:{text:n.directLabelText,state:s},horizontalDistance:{text:n.horizontalLabelText,state:s},verticalDistance:{text:n.verticalLabelText,state:s}};case 2:return{mode:"geodesic",directDistance:{text:null,state:"unavailable"},horizontalDistance:{text:n.horizontalLabelText,state:s},verticalDistance:{text:n.verticalLabelText,state:s}};default:return e}}},{key:"unitOptions",get:function(){return this._filteredOrAllUnits(this._userUnitOptions)},set:function(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}},{key:"unit",get:function(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)},set:function(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}}]),n}(_.InteractiveToolViewModel);return t.__decorate([l.property()],y.prototype,"ready",void 0),t.__decorate([l.property({readOnly:!0})],y.prototype,"state",null),t.__decorate([l.property({readOnly:!0})],y.prototype,"measurement",null),t.__decorate([l.property(h.defaultUnitPropertyMetadata)],y.prototype,"defaultUnit",void 0),t.__decorate([l.property()],y.prototype,"unitOptions",null),t.__decorate([l.property()],y.prototype,"unit",null),y=t.__decorate([d.subclass("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel")],y),y}));
