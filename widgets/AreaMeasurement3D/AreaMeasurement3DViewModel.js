/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../analysis/AreaMeasurement","../../core/Logger","../../core/maybe","../../core/unitUtils","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../../properties/defaultUnit","../../views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DTool","../support/InteractiveToolViewModel"],(function(e,t,i,n,r,s,o,a,l,u,c,d,p,y){"use strict";const h=n.getLogger("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel");let _=function(t){function n(e){var n;return(n=t.call(this,e)||this).logger=h,n.supportedViewType="3d",n.unsupportedErrorMessage="AreaMeasurement3DViewModel is only supported in 3D views.",n._userUnitOptions=null,n._userUnit=null,n.ready=!1,n.analysis=new i,n}e._inheritsLoose(n,t);var o=n.prototype;return o.initialize=function(){this.analysis.unit=this.unit},o.start=function(){return this.createTool()},o.clear=function(){this.removeTool()},o.createToolParams=function(){return{toolConstructor:p}},o._findSelectableUnit=function(e,t){const i=this.unitOptions;return-1!==i.indexOf(e)?e:r.isSome(t)?this._findSelectableUnit(t):i[0]},o._filteredOrAllUnits=function(e){if(r.isNone(e))return s.measurementAreaUnits.slice();const t=e.filter((e=>-1!==s.measurementAreaUnits.indexOf(e)));return 0===t.length?s.measurementAreaUnits.slice():t},o.onConnectToAnalysisView=function(){var t=e._asyncToGenerator((function*(){r.isSome(this.view)&&this.view.ready&&(this.ready=!0)}));function i(){return t.apply(this,arguments)}return i}(),o.onDisconnectFromAnalysisView=function(){this.ready=!1},e._createClass(n,[{key:"state",get:function(){return this.disabled?"disabled":r.isNone(this.tool)?"ready":this.tool.state}},{key:"measurement",get:function(){if(r.isNone(this.tool)||this.disabled||this.tool.destroyed||"pending"===this.tool.toolState)return null;const e=this.tool.measurementView;if("pending"===e.state||"destroyed"===e.state)return null;const t=e.analysisVisualization,i=t.viewData,n=i.measurementData,s=i.validMeasurement,o="euclidean"===i.mode,a=0===(o?n.intersectingSegments:n.geodesicIntersectingSegments).size,l=a?s?"available":"unavailable":"invalid";return{mode:o?"euclidean":"geodesic",area:{text:a&&s?t.areaLabel:null,state:l},perimeterLength:{text:a&&s?t.perimeterLengthLabel:null,state:l}}}},{key:"unitOptions",get:function(){return this._filteredOrAllUnits(this._userUnitOptions)},set:function(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}},{key:"unit",get:function(){return r.isSome(this._userUnit)?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)},set:function(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.analysis.unit=this._userUnit}}]),n}(y.InteractiveToolViewModel);t.__decorate([o.property()],_.prototype,"_userUnit",void 0),t.__decorate([o.property()],_.prototype,"ready",void 0),t.__decorate([o.property({readOnly:!0})],_.prototype,"state",null),t.__decorate([o.property({readOnly:!0})],_.prototype,"measurement",null),t.__decorate([o.property(d.defaultUnitPropertyMetadata)],_.prototype,"defaultUnit",void 0),t.__decorate([o.property()],_.prototype,"unitOptions",null),t.__decorate([o.property()],_.prototype,"unit",null),t.__decorate([o.property()],_.prototype,"analysis",void 0),_=t.__decorate([c.subclass("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],_);return _}));
