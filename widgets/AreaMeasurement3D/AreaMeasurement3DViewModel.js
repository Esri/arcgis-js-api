/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Handles","../../core/Logger","../../core/unitUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../../properties/defaultUnit","../../views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DTool","../support/InteractiveToolViewModel"],(function(e,t,n,i,r,s,o,l,a,u,c,d){"use strict";const p=i.getLogger("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel");let h=function(t){function i(e){var i;return(i=t.call(this,e)||this).supportedViewType="3d",i._handles=new n,i._userUnitOptions=null,i._userUnit=null,i.tool=null,i}e._inheritsLoose(i,t);var s=i.prototype;return s.initialize=function(){this.tool&&(this.tool.unit=this.unit)},s.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},s.start=function(){return this.createTool()},s.clear=function(){this.removeTool()},s.createToolParams=function(){return{toolConstructor:c,constructorArguments:()=>({unit:this.unit})}},s.logUnsupportedError=function(){p.error("AreaMeasurement3D widget is not implemented for MapView")},s.logError=function(...e){p.error(...e)},s._findSelectableUnit=function(e,t){const n=this.unitOptions;return-1!==n.indexOf(e)?e:t?this._findSelectableUnit(t):n[0]},s._filteredOrAllUnits=function(e){if(!e)return r.measurementAreaUnits.slice();const t=e.filter((e=>-1!==r.measurementAreaUnits.indexOf(e)));return 0===t.length?r.measurementAreaUnits.slice():t},e._createClass(i,[{key:"state",get:function(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}},{key:"measurement",get:function(){if(!this.tool||this.isDisabled)return null;if("pending"===this.tool.toolState||"destroyed"===this.tool.toolState)return null;const e=this.tool.measurementView;if("pending"===e.state||"destroyed"===e.state)return null;const t=e.analysisView,n=t.viewData,i=n.mode,r=n.measurementData,s=n.validMeasurement,o=0===("euclidean"===i?r.intersectingSegments:r.geodesicIntersectingSegments).size,l=o?s?"available":"unavailable":"invalid";return{mode:i,area:{text:o&&s?t.areaLabel:null,state:l},perimeterLength:{text:o&&s?t.perimeterLengthLabel:null,state:l}}}},{key:"unitOptions",get:function(){return this._filteredOrAllUnits(this._userUnitOptions)},set:function(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}},{key:"unit",get:function(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)},set:function(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.tool&&(this.tool.unit=this._userUnit),this.notifyChange("unit")}}]),i}(d.InteractiveToolViewModel);return t.__decorate([s.property({readOnly:!0})],h.prototype,"state",null),t.__decorate([s.property({readOnly:!0})],h.prototype,"measurement",null),t.__decorate([s.property({constructOnly:!0})],h.prototype,"tool",void 0),t.__decorate([s.property(u.defaultUnitPropertyMetadata)],h.prototype,"defaultUnit",void 0),t.__decorate([s.property()],h.prototype,"unitOptions",null),t.__decorate([s.property()],h.prototype,"unit",null),h=t.__decorate([a.subclass("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],h),h}));
