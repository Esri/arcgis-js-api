/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Handles","../../core/watchUtils","../../core/unitUtils","../support/commonProperties","../support/InteractiveToolViewModel","../../views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DTool"],(function(e,t,r,n,i,s,o,l,u,a,c,d,p,h,_,f){"use strict";const m=n.getLogger("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel");let U=function(t){function r(e){var r;return(r=t.call(this,e)||this).supportedViewType="3d",r._handles=new c,r._userUnitOptions=null,r._userUnit=null,r.tool=null,r}e._inheritsLoose(r,t);var n=r.prototype;return n.initialize=function(){this._handles.add([d.init(this,"unit",(e=>{this.tool&&(this.tool.model.unit=e)}))])},n.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},n.start=function(){return this.createTool()},n.clear=function(){this.removeTool()},n.createToolParams=function(){return{toolConstructor:f,constructorArguments:()=>({unit:this.unit})}},n.logUnsupportedError=function(){m.error("AreaMeasurement3D widget is not implemented for MapView")},n.logError=function(...e){m.error(...e)},n._findSelectableUnit=function(e,t){const r=this.unitOptions;return-1!==r.indexOf(e)?e:t?this._findSelectableUnit(t):r[0]},n._filteredOrAllUnits=function(e){if(!e)return p.measurementAreaUnits.slice();const t=e.filter((e=>-1!==p.measurementAreaUnits.indexOf(e)));return 0===t.length?p.measurementAreaUnits.slice():t},e._createClass(r,[{key:"state",get:function(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}},{key:"measurement",get:function(){if(!this.tool||this.isDisabled)return null;const e=this.tool.model,t=e.measurementMode,r=e.measurementData,n=e.validMeasurement,i=0===("euclidean"===t?r.intersectingSegments:r.geodesicIntersectingSegments).size,s=i?n?"available":"unavailable":"invalid";return{mode:t,area:{text:i&&n?e.areaLabel:null,state:s},perimeterLength:{text:i&&n?e.perimeterLengthLabel:null,state:s}}}},{key:"unitOptions",get:function(){return this._filteredOrAllUnits(this._userUnitOptions)},set:function(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}},{key:"unit",get:function(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)},set:function(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}}]),r}(_.InteractiveToolViewModel);return t.__decorate([s.property({readOnly:!0})],U.prototype,"state",null),t.__decorate([s.property({readOnly:!0})],U.prototype,"measurement",null),t.__decorate([s.property({constructOnly:!0})],U.prototype,"tool",void 0),t.__decorate([s.property(h.defaultUnitPropertyMetadata)],U.prototype,"defaultUnit",void 0),t.__decorate([s.property()],U.prototype,"unitOptions",null),t.__decorate([s.property()],U.prototype,"unit",null),U=t.__decorate([o.subclass("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],U),U}));
