// COPYRIGHT Â© 2019 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/next/esri/copyright.txt for details.

define(["require","exports","../core/tsSupport/declareExtendsHelper","../core/tsSupport/decorateHelper","../core/tsSupport/assignHelper","dojo/i18n!../nls/common","dojo/i18n!./BasemapLayerList/nls/BasemapLayerList","../core/Collection","../core/events","../core/HandleOwner","../core/watchUtils","../core/accessorSupport/decorators","../libs/sortablejs/Sortable","./Widget","./BasemapLayerList/BasemapLayerListViewModel","./LayerList/ListItem","./support/widget"],function(e,t,i,s,n,r,a,o,l,c,d,u,p,g,h,b,m){function y(e,t,i){e.splice(i,0,e.splice(t,1)[0])}function _(e){var t=e.actionsOpen,i=e.children;t&&(e.actionsOpen=!1),i.forEach(function(e){return _(e)})}var f=o.ofType(b),v={base:"esri-basemap-layer-list esri-widget esri-widget--panel",titleContainer:"esri-basemap-layer-list__title-container",mainHeading:"esri-basemap-layer-list__main-heading",editingCard:"esri-basemap-layer-list__editing-card",editingInput:"esri-basemap-layer-list__editing-input",editingActions:"esri-basemap-layer-list__editing-actions",editButton:"esri-basemap-layer-list__edit-button",editButtonIcon:"esri-basemap-layer-list__edit-button-icon",submitButton:"esri-basemap-layer-list__submit-button",cancelButton:"esri-basemap-layer-list__cancel-button",noItems:"esri-basemap-layer-list__no-items",horizontalRule:"esri-basemap-layer-list__hr",listHeading:"esri-basemap-layer-list__list-heading",list:"esri-basemap-layer-list__list",listRoot:"esri-basemap-layer-list__list--root",listExclusive:"esri-basemap-layer-list__list--exclusive",listInherited:"esri-basemap-layer-list__list--inherited",listIndependent:"esri-basemap-layer-list__list--independent",item:"esri-basemap-layer-list__item",itemOnlyChild:"esri-basemap-layer-list__item--only-child",itemContent:"esri-basemap-layer-list__item-content",itemError:"esri-basemap-layer-list__item--error",itemInvisibleAtScale:"esri-basemap-layer-list__item--invisible-at-scale",itemUpdating:"esri-basemap-layer-list__item--updating",itemChildren:"esri-basemap-layer-list__item--has-children",itemSelectable:"esri-basemap-layer-list__item--selectable",itemContainer:"esri-basemap-layer-list__item-container",actionsMenu:"esri-basemap-layer-list__item-actions-menu",actionsMenuItem:"esri-basemap-layer-list__item-actions-menu-item",actionsMenuItemActive:"esri-basemap-layer-list__item-actions-menu-item--active",actions:"esri-basemap-layer-list__item-actions",actionsList:"esri-basemap-layer-list__item-actions-list",action:"esri-basemap-layer-list__item-action",actionIcon:"esri-basemap-layer-list__item-action-icon",actionImage:"esri-basemap-layer-list__item-action-image",actionTitle:"esri-basemap-layer-list__item-action-title",actionToggle:"esri-basemap-layer-list__action-toggle",actionToggleOn:"esri-basemap-layer-list__action-toggle--on",label:"esri-basemap-layer-list__item-label",errorMessage:"esri-basemap-layer-list__item-error-message",title:"esri-basemap-layer-list__item-title",toggleVisible:"esri-basemap-layer-list__item-toggle",toggleVisibleIcon:"esri-basemap-layer-list__item-toggle-icon",childToggle:"esri-basemap-layer-list__child-toggle",childToggleOpen:"esri-basemap-layer-list__child-toggle--open",childOpened:"esri-basemap-layer-list__child-toggle-icon--opened",childClosed:"esri-basemap-layer-list__child-toggle-icon--closed",childClosed_RTL:"esri-basemap-layer-list__child-toggle-icon--closed-rtl",button:"esri-button",buttonTertiary:"esri-button--tertiary",input:"esri-input",disabled:"esri-disabled",disabledElement:"esri-disabled-element",hidden:"esri-hidden",rotating:"esri-rotating",heading:"esri-widget__heading",iconEdit:"esri-icon-edit",iconCheckMark:"esri-icon-check-mark",iconClose:"esri-icon-close",iconEllipses:"esri-icon-handle-horizontal",iconVisible:"esri-icon-visible",iconInvisible:"esri-icon-non-visible",iconRadioSelected:"esri-icon-radio-checked",iconRadioUnselected:"esri-icon-radio-unchecked",iconNoticeTriangle:"esri-icon-notice-triangle",iconChildrenOpen:"esri-icon-down-arrow",iconDownArrow:"esri-icon-down-arrow",iconRightArrow:"esri-icon-right-triangle-arrow",iconLeftArrow:"esri-icon-left-triangle-arrow",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",widgetIcon:"esri-icon-layers"},I={actions:"actions",actionSection:"action-section",baseItems:"base-items",referenceItems:"reference-items"},x={exclusive:"exclusive",inherited:"inherited",independent:"independent"};return function(e){function t(t){var i=e.call(this)||this;return i._editingTitle=!1,i._editTitleInput=null,i._editTitleButton=null,i._focusOnElement=null,i._sortableBaseLayers=null,i._sortableReferenceLayers=null,i._sortableBaseLayersNode=null,i._sortableReferenceLayersNode=null,i._focusSortUid=null,i.basemapTitle=null,i.baseListItemCreatedFunction=null,i.editingEnabled=!1,i.iconClass=v.widgetIcon,i.label=a.widgetLabel,i.referenceListItemCreatedFunction=null,i.baseItems=null,i.referenceItems=null,i.selectedItems=new f,i.statusIndicatorsVisible=!0,i.view=null,i.viewModel=new h,i}return i(t,e),t.prototype.postInitialize=function(){var e=this,t=this,i=t.baseItems,s=t.referenceItems;this.own([d.on(this,"baseItems","change",function(){e._itemsChanged(i,I.baseItems),e._toggleSortingBaseLayers()}),d.on(this,"referenceItems","change",function(){return e._itemsChanged(s,I.referenceItems)}),d.init(this,"editingEnabled",function(){return e._toggleSorting()})])},t.prototype.destroy=function(){this._destroyBaseSortable(),this._destroyReferenceSortable()},t.prototype.triggerAction=function(e,t){},t.prototype.render=function(){var e,t=this.viewModel.state,i=(e={},e[v.hidden]="loading"===t,e[v.disabled]="disabled"===t,e);return m.tsx("div",{class:this.classes(v.base,i)},this._renderTitleContainer(),this._renderReferenceSection(),this._renderBaseSection())},t.prototype._destroyReferenceSortable=function(){var e=this._sortableReferenceLayers;e&&e.destroy(),this._sortableReferenceLayersNode=null},t.prototype._destroyBaseSortable=function(){var e=this._sortableBaseLayers;e&&e.destroy(),this._sortableBaseLayersNode=null},t.prototype._toggleEditingTitle=function(){var e=this._editingTitle,t=!e;this._editingTitle=t,this._focusOnElement=t?"edit-input":"edit-button",this.scheduleRender()},t.prototype._storeEditTitleInput=function(e){this._editTitleInput=e,this._focusEditElement()},t.prototype._focusEditElement=function(){this._editTitleInput&&"edit-input"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleInput.focus()),this._editTitleButton&&"edit-button"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleButton.focus())},t.prototype._storeEditTitleButton=function(e){this._editTitleButton=e,this._focusEditElement()},t.prototype._formSubmit=function(e){e.preventDefault();var t=this._editTitleInput;t&&(this.basemapTitle=t.value),this._toggleEditingTitle()},t.prototype._renderTitleContainer=function(){var e=this,t=e._editingTitle,i=e.editingEnabled,s=this.viewModel.basemapTitle,n=t?m.tsx("div",{class:v.editingCard},m.tsx("form",{bind:this,onsubmit:this._formSubmit},m.tsx("label",{class:v.editingInput},a.basemapTitle,m.tsx("input",{bind:this,class:v.input,title:a.basemapTitle,"aria-label":a.basemapTitle,placeholder:a.basemapTitle,type:"text",role:"textbox",value:s,afterCreate:this._storeEditTitleInput,afterUpdate:this._focusEditElement})),m.tsx("div",{class:v.editingActions},m.tsx("button",{title:r.cancel,"aria-label":r.cancel,type:"button",bind:this,class:this.classes(v.button,v.buttonTertiary),onclick:this._toggleEditingTitle},r.cancel),m.tsx("button",{title:r.form.submit,"aria-label":r.form.submit,type:"button",bind:this,class:v.button,onclick:this._formSubmit},r.form.ok)))):m.tsx("h2",{class:this.classes(v.heading,v.mainHeading)},s),o=i&&!t?m.tsx("button",{bind:this,class:v.editButton,title:r.edit,"aria-label":r.edit,onclick:this._toggleEditingTitle,afterCreate:this._storeEditTitleButton,afterUpdate:this._focusEditElement,"data-node-ref":"_editButtonNode"},m.tsx("span",{"aria-hidden":"true",class:this.classes(v.iconEdit,v.editButtonIcon)})):null;return m.tsx("div",{class:v.titleContainer},n,o)},t.prototype._renderNoLayersInfo=function(e,t){return m.tsx("div",{key:t,class:v.noItems},e)},t.prototype._renderList=function(e,t){var i=this,s="reference"===t?this._destroyReferenceSortable:this._destroyBaseSortable;return m.tsx("ul",{key:t,"aria-label":a.widgetLabel,role:this.editingEnabled&&e.length?"listbox":void 0,afterCreate:this._sortNodeCreated,afterRemoved:s,"data-node-ref":t,bind:this,class:this.classes(v.list,v.listRoot,v.listIndependent)},e.map(function(s){return i._renderItem({item:s,parent:null,itemType:t,isOnlyChild:1===e.length})}))},t.prototype._itemMovedList=function(e){var t=e.item,i=t["data-item"],s=e.to.dataset.nodeRef,n=e.from.dataset.nodeRef,r=e.newIndex;this.viewModel.transferListItem({listItem:i,from:n,to:s,newIndex:r})},t.prototype._toggleSortingBaseLayers=function(){var e=this,t=this,i=t._sortableBaseLayers,s=t._sortableBaseLayersNode,n=t.editingEnabled;if(s){var r=!n;if(i)i.option("disabled",r);else{var a=p.create(s,{dataIdAttr:"data-layer-uid",group:"root-layers",filter:"."+v.itemOnlyChild,disabled:r,onSort:function(){return e._sortLayersToItems({type:"base",itemIds:a.toArray()})},onAdd:function(t){return e._itemMovedList(t)}});this._sortableBaseLayers=a}}},t.prototype._toggleSortingReferenceLayers=function(){var e=this,t=this,i=t._sortableReferenceLayers,s=t._sortableReferenceLayersNode,n=t.editingEnabled;if(s){var r=!n;if(i)i.option("disabled",r);else{var a=p.create(s,{dataIdAttr:"data-layer-uid",group:"root-layers",disabled:r,onSort:function(){return e._sortLayersToItems({type:"reference",itemIds:a.toArray()})},onAdd:function(t){return e._itemMovedList(t)}});this._sortableReferenceLayers=a}}},t.prototype._toggleSorting=function(){this._toggleSortingBaseLayers(),this._toggleSortingReferenceLayers()},t.prototype._sortNodeCreated=function(e){var t=e.getAttribute("data-node-ref");"base"===t&&(this._sortableBaseLayersNode=e),"reference"===t&&(this._sortableReferenceLayersNode=e),this._toggleSorting()},t.prototype._renderBaseSection=function(){var e=this.baseItems,t=this._getItems(e),i=m.tsx("h3",{class:this.classes(v.heading,v.listHeading)},a.baseHeading),s=this._renderList(t,"base"),n=0===t.length?this._renderNoLayersInfo(a.noBaseLayers,"base"):null,r=[n,s];return[m.tsx("hr",{class:v.horizontalRule}),i,r]},t.prototype._renderReferenceSection=function(){var e=this.referenceItems,t=this._getItems(e),i=m.tsx("h3",{class:this.classes(v.heading,v.listHeading)},a.referenceHeading),s=this._renderList(t,"reference");return[i,[0===t.length?this._renderNoLayersInfo(a.noReferenceLayers,"reference"):null,s]]},t.prototype._getItems=function(e){var t=this;return e.toArray().filter(function(e){return t.errorsVisible||!e.error})},t.prototype._getSingleActionButton=function(e){return e.actionsSections.reduce(function(e){return e}).filter(function(e){return e&&"button"===e.type}).getItemAt(0)},t.prototype._renderItem=function(e){var t,i,s,o,l,c,d,u=this,p=e.item,g=e.parent,h=e.itemType,b=e.isOnlyChild,y=this.id,_=y+"_"+p.uid,f=_+"_actions",I=_+"__list",L=_+"__title",A=p.children.length,w=!!p.error,S=!!A&&!w,T=w?a.layerError:"",C=p.visibilityMode,k=p.children&&p.children.toArray(),E=x.exclusive,O=x.inherited,R=(t={},t[v.listExclusive]=C===E,t[v.listInherited]=C===O,t[v.listIndependent]=C!==O&&C!==E,t),B=(i={},i[v.itemChildren]=S,i[v.itemError]=!!w,i[v.itemUpdating]=p.updating&&!g&&this.statusIndicatorsVisible,i[v.itemInvisibleAtScale]=!p.visibleAtCurrentScale,i[v.itemSelectable]=this.editingEnabled,i),M=this._countActions(p.actionsSections),N=p.panel,U=N&&N.open?N.render():null,V=N&&N.visible?this._renderPanelButton(N):null,H=(s={},s[v.actionsMenuItemActive]=p.actionsOpen,s),P=p.actionsOpen?r.close:r.open,D=1===M&&this._getSingleActionButton(p),F=D?this._renderAction({item:p,action:D,singleAction:!0}):null,K=!D&&M?m.tsx("div",{key:"actions-menu-toggle","data-item":p,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(v.actionsMenuItem,H),tabindex:"0",role:"button","aria-controls":f,"aria-label":P,title:P},m.tsx("span",{"aria-hidden":"true",class:v.iconEllipses})):null,z=K||V||F?m.tsx("div",{key:"esri-basemap-layer-list__actions-menu",class:v.actionsMenu},V,F,K):null,j=M?this._renderActionsSections(p,p.actionsSections,f):null,q=S?m.tsx("ul",{key:"esri-basemap-layer-list__list-items",id:I,class:this.classes(v.list,R),"aria-expanded":p.open?"true":"false",role:C===E?"radiogroup":"group",hidden:!p.open||null},k.map(function(e){return u._renderItem({item:e,parent:p})})):null,W=(o={},o[v.childToggleOpen]=p.open,o),G=p.open?r.collapse:r.expand,J=S?m.tsx("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":p,key:"esri-basemap-layer-list__toggle-children",class:this.classes(v.childToggle,W),tabindex:"0",role:"button","aria-controls":I,"aria-label":G,title:G},m.tsx("span",{"aria-hidden":"true",class:this.classes(v.childClosed,v.iconRightArrow)}),m.tsx("span",{"aria-hidden":"true",class:this.classes(v.childOpened,v.iconDownArrow)}),m.tsx("span",{"aria-hidden":"true",class:this.classes(v.childClosed_RTL,v.iconLeftArrow)})):null,Q=this._createLabelNode(p,g,L),X=w?m.tsx("div",{key:"esri-basemap-layer-list__error",class:v.errorMessage,role:"alert"},m.tsx("span",null,T)):null,Y=this.selectedItems.indexOf(p)>-1,Z=g?null:p.get("layer.uid"),$=(l={},l["data-layer-uid"]=Z,l),ee=m.tsx("div",{key:"esri-basemap-layer-list__list-item-container",class:v.itemContainer},J,Q,z);return this.editingEnabled?m.tsx("li",n({key:p,bind:this,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item":p,"data-item-type":h,tabIndex:0,"aria-labelledby":L,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(v.item,B,(c={},c[v.itemOnlyChild]=b,c)),"aria-selected":Y?"true":"false",role:"option"},$),ee,X,j,U,q):m.tsx("li",{key:p,class:this.classes(v.item,B,(d={},d[v.itemOnlyChild]=b,d))},ee,X,j,U,q)},t.prototype._sortLayersToItems=function(e){var t=e.type,i=e.itemIds,s="base"===t?this.get("view.map.basemap.baseLayers"):"reference"===t?this.get("view.map.basemap.referenceLayers"):null;s&&s.sort(function(e,t){var s=i.indexOf(e.uid),n=i.indexOf(t.uid);return s>n?-1:s<n?1:0})},t.prototype._focusListItem=function(e){var t=this._focusSortUid;if(e&&t){e.dataset.layerUid===t&&(e.focus(),this._focusSortUid=null)}},t.prototype._selectionKeydown=function(e){var t=["ArrowDown","ArrowUp"],i=l.eventKey(e);if(-1===t.indexOf(i))return void this._toggleSelection(e);e.stopPropagation();var s=e.currentTarget,n=s["data-item"],r=s.dataset.itemType,a=this,o=a._sortableBaseLayers,c=a._sortableReferenceLayers,d=a.selectedItems,u="base"===r?o:"reference"===r?c:null,p=d.indexOf(n)>-1,g=u.toArray(),h=e.target,b=g.indexOf(h.dataset.layerUid),m=this.viewModel,_=m.baseItems,f=m.referenceItems;if(-1!==b){if("ArrowDown"===i){var v=b+1,I=v>=g.length;if(I&&"reference"===r&&p){var x=_.length;return this.viewModel.transferListItem({listItem:n,from:"reference",to:"base",newIndex:x}),this._focusSortUid=n.get("layer.uid"),void this.scheduleRender()}if(I&&"reference"===r){var L=_.getItemAt(0);return this._focusSortUid=L&&L.get("layer.uid"),void this.scheduleRender()}if(I)return;return p&&(y(g,b,v),u.sort(g),this._sortLayersToItems({type:r,itemIds:u.toArray()})),this._focusSortUid=g[v],void this.scheduleRender()}if("ArrowUp"===i){var v=b-1,A=v<0;if(A&&"base"===r&&p){if(1===_.length)return;var x=0;return this.viewModel.transferListItem({listItem:n,from:"base",to:"reference",newIndex:x}),this._focusSortUid=n.get("layer.uid"),void this.scheduleRender()}if(A&&"base"===r){var L=f.getItemAt(f.length-1);return this._focusSortUid=L&&L.get("layer.uid"),void this.scheduleRender()}if(A)return;p&&(y(g,b,v),u.sort(g),this._sortLayersToItems({type:r,itemIds:u.toArray()})),this._focusSortUid=g[v],this.scheduleRender()}}},t.prototype._createLabelNode=function(e,t,i){var s,n=this.editingEnabled,r=x.exclusive,o=x.inherited,l=t&&t.visibilityMode,c=(s={},s[v.iconRadioSelected]=l===r&&e.visible,s[v.iconRadioUnselected]=l===r&&!e.visible,s[v.iconVisible]=l!==r&&e.visible,s[v.iconInvisible]=l!==r&&!e.visible,s),d=l===r?"radio":"switch",u=e.title||a.untitledLayer,p=e.visibleAtCurrentScale?u:u+" ("+a.layerInvisibleAtScale+")",g=m.tsx("span",{id:i,title:p,"aria-label":p,class:v.title},u),h=m.tsx("span",{class:this.classes(v.toggleVisibleIcon,c),"aria-hidden":"true"}),b=n?m.tsx("span",{key:"label-icon",class:v.toggleVisible,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":l,tabIndex:0,"aria-checked":e.visible?"true":"false",role:d,"aria-labelledby":i},h):m.tsx("span",{key:"label-icon",class:v.toggleVisible},h),y=n?m.tsx("div",{key:"label",class:v.label},b,g):m.tsx("div",{key:"label",class:v.label,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":l,tabIndex:0,"aria-checked":e.visible?"true":"false",role:d,"aria-labelledby":i},b,g),_=!!e.error,f=_?m.tsx("span",{"aria-hidden":"true",class:v.iconNoticeTriangle}):null;return l===o||_?m.tsx("div",{key:e,class:v.label},f,g):y},t.prototype._renderPanelButton=function(e){var t,i,s=e.className,n=e.open,r=e.title,a=e.image,o=a||s?s:v.iconDefaultAction,l=this._getIconImageStyles(e),c=(t={},t[v.actionsMenuItemActive]=n,t),d=(i={},i[v.actionImage]=!!l["background-image"],i);return o&&(d[o]=!!o),m.tsx("div",{key:e,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(v.actionsMenuItem,c),role:"button",tabindex:"0",title:r,"aria-label":r},m.tsx("span",{class:this.classes(d),styles:l}))},t.prototype._watchActionSectionChanges=function(e,t){var i=this;this.handles.add(e.on("change",function(){return i.scheduleRender()}),t),e.forEach(function(e){return i._renderOnActionChanges(e,t)})},t.prototype._renderOnActionChanges=function(e,t){var i=this;return"toggle"===e.type?void this.handles.add([d.init(e,["className","image","id","title","visible","value"],function(){return i.scheduleRender()})],t):"slider"===e.type?void this.handles.add([d.init(e,["className","id","title","visible","value","displayValueEnabled","max","min","step"],function(){return i.scheduleRender()})],t):void this.handles.add([d.init(e,["className","image","id","title","visible"],function(){return i.scheduleRender()})],t)},t.prototype._renderOnItemChanges=function(e,t){var i=this;this.handles.add([d.init(e,["actionsOpen","visible","open","updating","title","visibleAtCurrentScale","error","visibilityMode","panel","panel.title","panel.content","panel.className"],function(){return i.scheduleRender()}),e.actionsSections.on("change",function(){return i.scheduleRender()}),e.children.on("change",function(){return i.scheduleRender()})],t),e.children.forEach(function(e){return i._renderOnItemChanges(e,t)}),e.actionsSections.forEach(function(e){return i._watchActionSectionChanges(e,t)})},t.prototype._itemsChanged=function(e,t){var i=this;this.handles.remove(t),e.forEach(function(e){return i._renderOnItemChanges(e,t)}),this.scheduleRender()},t.prototype._renderActionsSections=function(e,t,i){var s=this,n=t.toArray(),r=n.map(function(t){return m.tsx("ul",{key:t,class:v.actionsList},s._renderActionSection(e,t))});return m.tsx("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"esri-basemap-layer-list__actions-section",id:i,class:v.actions,hidden:!e.actionsOpen||null},r)},t.prototype._renderActionSection=function(e,t){var i=this;return(t&&t.toArray()).map(function(t){return i._renderAction({item:e,action:t})})},t.prototype._renderAction=function(e){var t,i,s=e.item,n=e.action,r=e.singleAction,a=this._getIconImageStyles(n),o=n.active,l=n.className,c=n.disabled,d=n.title,u="button"!==n.type||n.image||l?l:v.iconDefaultAction,p=(t={},t[v.actionsMenuItem]=r&&"button"===n.type,t[v.action]=!r&&"toggle"!==n.type,t[v.actionToggle]="toggle"===n.type,t[v.actionToggleOn]="toggle"===n.type&&n.value,t[v.disabledElement]=c,t),g=(i={},i[v.actionImage]=!o&&!!a["background-image"],i[v.iconLoading]=o,i[v.rotating]=o,i);u&&(g[u]=!0);var h=m.tsx("span",{"aria-hidden":"true",class:this.classes(v.actionIcon,g),styles:a}),b=r?null:m.tsx("span",{class:v.actionTitle},d),y=[h,b];return r?m.tsx("div",{bind:this,"data-item":s,"data-action":n,role:s.actionsOpen?"button":null,key:n,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:p,tabindex:"0",title:d,"aria-label":d},y):m.tsx("li",{bind:this,"data-item":s,"data-action":n,key:n,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:p,tabindex:"0",role:s.actionsOpen?"button":null,title:d,"aria-label":d},y)},t.prototype._countActions=function(e){return e.reduce(function(e,t){return e+t.length},0)},t.prototype._getIconImageStyles=function(e){var t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?'url("'+t+'")':null}},t.prototype._toggleActionsOpen=function(e){e.stopPropagation();var t=e.currentTarget,i=t["data-item"],s=i.actionsOpen,n=!s,r=this,a=r.baseItems,o=r.referenceItems;n&&(a.forEach(function(e){return _(e)}),o.forEach(function(e){return _(e)})),i.actionsOpen=n},t.prototype._triggerPanel=function(e){e.stopPropagation();var t=e.currentTarget,i=t["data-panel"];i&&(i.open=!i.open)},t.prototype._triggerAction=function(e){e.stopPropagation();var t=e.currentTarget,i=t["data-action"],s=t["data-item"];"toggle"===i.type&&(i.value=!i.value),this.triggerAction(i,s)},t.prototype._toggleVisibility=function(e){e.stopPropagation();var t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),s=t["data-item"];i===x.exclusive&&s.visible||(s.visible=!s.visible)},t.prototype._toggleChildrenClick=function(e){e.stopPropagation();var t=e.currentTarget,i=t["data-item"];i.open=!i.open},t.prototype._toggleSelection=function(e){e.stopPropagation();var t=e.metaKey||e.ctrlKey,i=e.currentTarget,s=i["data-item"],n=this.selectedItems,r=n.indexOf(s)>-1,a=n.length,o=r&&1===a;return t?void(r?n.remove(s):n.add(s)):a&&!o?(n.removeAll(),void n.add(s)):void(r?n.remove(s):n.add(s))},s([u.aliasOf("viewModel.basemapTitle")],t.prototype,"basemapTitle",void 0),s([u.aliasOf("viewModel.baseListItemCreatedFunction"),m.renderable()],t.prototype,"baseListItemCreatedFunction",void 0),s([u.property(),m.renderable()],t.prototype,"editingEnabled",void 0),s([u.property(),m.renderable()],t.prototype,"errorsVisible",void 0),s([u.property()],t.prototype,"iconClass",void 0),s([u.property()],t.prototype,"label",void 0),s([u.aliasOf("viewModel.referenceListItemCreatedFunction"),m.renderable()],t.prototype,"referenceListItemCreatedFunction",void 0),s([u.aliasOf("viewModel.baseItems"),m.renderable()],t.prototype,"baseItems",void 0),s([u.aliasOf("viewModel.referenceItems"),m.renderable()],t.prototype,"referenceItems",void 0),s([u.property(),m.renderable()],t.prototype,"selectedItems",void 0),s([u.property(),m.renderable()],t.prototype,"statusIndicatorsVisible",void 0),s([u.aliasOf("viewModel.view"),m.renderable()],t.prototype,"view",void 0),s([m.vmEvent("trigger-action"),u.property({type:h}),m.renderable("viewModel.state")],t.prototype,"viewModel",void 0),s([u.aliasOf("viewModel.triggerAction")],t.prototype,"triggerAction",null),s([m.accessibleHandler()],t.prototype,"_toggleActionsOpen",null),s([m.accessibleHandler()],t.prototype,"_triggerPanel",null),s([m.accessibleHandler()],t.prototype,"_triggerAction",null),s([m.accessibleHandler()],t.prototype,"_toggleVisibility",null),s([m.accessibleHandler()],t.prototype,"_toggleChildrenClick",null),s([m.accessibleHandler()],t.prototype,"_toggleSelection",null),t=s([u.subclass("esri.widgets.BasemapLayerList")],t)}(u.declared(c.HandleOwnerMixin(g)))});