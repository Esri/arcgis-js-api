/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/Collection","../core/events","../core/HandleOwner","../core/has","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/arrayUtils","../core/accessorSupport/decorators/subclass","./Widget","./BasemapLayerList/BasemapLayerListViewModel","./LayerList/ListItem","./LayerList/support/layerListUtils","./support/Heading","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/widgetUtils","../chunks/sortable.esm"],(function(e,t,i,n,s,o,r,a,l,c,d,u,h,g,m,p,b,_,f,y,I,v,L,w){"use strict";const C=n.ofType(p);function T(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const A=".*\\S+.*",x="esri-basemaplayerlist-new-ui",S="root-layers",$="data-layer-uid",k="layerUid",E="esri-basemap-layer-list",M=`${E}__item`,R=`${E}__list`,B={base:`${E} esri-widget esri-widget--panel`,newUI:`${E}--new-ui`,titleContainer:`${E}__title-container`,mainHeading:`${E}__main-heading`,editingCard:`${E}__editing-card`,editingInput:`${E}__editing-input`,editingActions:`${E}__editing-actions`,editButton:`${E}__edit-button`,editButtonIcon:`${E}__edit-button-icon`,submitButton:`${E}__submit-button`,cancelButton:`${E}__cancel-button`,noItems:`${E}__no-items`,horizontalRule:`${E}__hr`,list:R,listHeading:`${R}-heading`,listRoot:`${R}--root`,listExclusive:`${R}--exclusive`,listInherited:`${R}--inherited`,listIndependent:`${R}--independent`,item:M,itemOnlyChild:`${M}--only-child`,itemContent:`${M}-content`,itemMessage:`${M}--has-message`,itemInvisible:`${M}--invisible`,itemInvisibleAtScale:`${M}--invisible-at-scale`,itemChildren:`${M}--has-children`,itemSelectable:`${M}--selectable`,itemContainer:`${M}-container`,actionsMenu:`${M}-actions-menu`,actionsMenuItem:`${M}-actions-menu-item`,actionsMenuItemActive:`${M}-actions-menu-item--active`,actions:`${M}-actions`,actionsList:`${M}-actions-list`,action:`${M}-action`,actionIcon:`${M}-action-icon`,actionImage:`${M}-action-image`,actionTitle:`${M}-action-title`,actionToggle:`${E}__action-toggle`,actionToggleOn:`${E}__action-toggle--on`,label:`${M}-label`,message:`${M}-message`,title:`${M}-title`,statusIndicator:`${E}__status-indicator`,publishing:`${E}__publishing`,updating:`${E}__updating`,connectionStatus:`${E}__connection-status`,connectionStatusConnected:`${E}__connection-status--connected`,toggleVisible:`${M}-toggle`,toggleVisibleIcon:`${M}-toggle-icon`,toggleIcon:`${M}-toggle-icon`,radioIcon:`${M}-radio-icon`,childToggle:`${E}__child-toggle`,childToggleOpen:`${E}__child-toggle--open`,childOpened:`${E}__child-toggle-icon--opened`,childClosed:`${E}__child-toggle-icon--closed`,childClosed_RTL:`${E}__child-toggle-icon--closed-rtl`,sortableChosen:`${E}--chosen`,button:"esri-button",buttonTertiary:"esri-button--tertiary",input:"esri-input",disabled:"esri-disabled",disabledElement:"esri-disabled-element",hidden:"esri-hidden",rotating:"esri-rotating",heading:"esri-widget__heading",iconEdit:"esri-icon-edit",iconCheckMark:"esri-icon-check-mark",iconClose:"esri-icon-close",iconEllipses:"esri-icon-handle-horizontal",iconVisible:"esri-icon-visible",iconInvisible:"esri-icon-non-visible",iconRadioSelected:"esri-icon-radio-checked",iconRadioUnselected:"esri-icon-radio-unchecked",iconNoticeTriangle:"esri-icon-notice-triangle",iconChildrenOpen:"esri-icon-down-arrow",iconDownArrow:"esri-icon-down-arrow",iconRightArrow:"esri-icon-right-triangle-arrow",iconLeftArrow:"esri-icon-left-triangle-arrow",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",widgetIcon:"esri-icon-layers"},O={actions:"actions",actionSection:"action-section",baseItems:"base-items",referenceItems:"reference-items"},U={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function H(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach((e=>H(e)))}const N={baseLayers:!0,referenceLayers:!0,statusIndicators:!0,errors:!1};let V=function(i){function n(e,t){var n;return(n=i.call(this,e,t)||this)._tooltipReferenceMap=new Map,n._editingTitle=!1,n._editTitleInput=null,n._editTitleButton=null,n._focusOnElement=null,n._sortableBaseLayers=null,n._sortableReferenceLayers=null,n._sortableBaseLayersNode=null,n._sortableReferenceLayersNode=null,n._focusSortUid=null,n._newUI=r(x),n.visibleItems=null,n.editingEnabled=!1,n.headingLevel=2,n.iconClass=B.widgetIcon,n.messages=null,n.messagesCommon=null,n.multipleSelectionEnabled=!1,n.selectedItems=new C,n.viewModel=new m,n.visibleElements={...N},n}t._inheritsLoose(n,i);var o=n.prototype;return o.initialize=function(){const{baseItems:e,referenceItems:t}=this;this._setVisibleItems(),this.addHandles([l.watch((()=>this.visibleElements),(()=>{this._itemsChanged(e,O.baseItems),this._itemsChanged(t,O.referenceItems)})),l.on((()=>this.baseItems),"change",(()=>{this._itemsChanged(e,O.baseItems)})),l.on((()=>this.referenceItems),"change",(()=>this._itemsChanged(t,O.referenceItems))),l.watch((()=>this.editingEnabled),(()=>this._toggleSorting()),l.initial)])},o.loadDependencies=function(){return Promise.all([new Promise(((t,i)=>e(["../chunks/calcite-icon"],t,i))),new Promise(((t,i)=>e(["../chunks/calcite-tooltip"],t,i)))])},o.destroy=function(){this._destroyBaseSortable(),this._destroyReferenceSortable(),this._tooltipReferenceMap.clear()},o.castVisibleElements=function(e){return{...N,...e}},o.triggerAction=function(e,t){return this.viewModel.triggerAction(e,t)},o.render=function(){const{state:e}=this.viewModel,t={[B.newUI]:this._newUI,[B.hidden]:"loading"===e,[B.disabled]:"disabled"===e},i=this.renderItemTooltips(),n=this.renderReferenceSection(),s=this.renderBaseSection(),o=n&&s?v.tsx("hr",{class:B.horizontalRule}):null,r=[this.renderTitleContainer(),n,o,s];return v.tsx("div",{class:this.classes(B.base,t)},[i,r])},o.renderItemTooltip=function(e){const{_tooltipReferenceMap:t,messages:i}=this;return e?v.tsx("calcite-tooltip",{label:i.layerIncompatible,referenceElement:t.get(e.uid)},i.layerIncompatibleTooltip):null},o.renderItemTooltipNodes=function(e){const{incompatible:t,children:i}=e;return[t?this.renderItemTooltip(e):null,...t?[]:i?.toArray().map((e=>this.renderItemTooltipNodes(e)))]},o.renderItemTooltips=function(){return this.visibleItems.toArray().map((e=>this.renderItemTooltipNodes(e)))},o.renderEditingInput=function(){const{messages:e}=this,{basemapTitle:t}=this.viewModel;return v.tsx("label",{class:B.editingInput},e.basemapTitle,v.tsx("input",{bind:this,class:B.input,title:e.basemapTitle,"aria-label":e.basemapTitle,placeholder:e.basemapTitle,type:"text",role:"textbox",required:!0,pattern:A,value:t,afterCreate:this._storeEditTitleInput,afterUpdate:this._focusEditElement}))},o.renderCancelButton=function(){const{messagesCommon:e}=this;return v.tsx("button",{title:e.cancel,"aria-label":e.cancel,type:"button",bind:this,class:this.classes(B.button,B.buttonTertiary),onclick:this._toggleEditingTitle},e.cancel)},o.renderSubmitButton=function(){const{messagesCommon:e}=this;return v.tsx("button",{title:e.form.submit,"aria-label":e.form.submit,type:"submit",bind:this,class:B.button},e.form.ok)},o.renderEditingForm=function(){return v.tsx("div",{class:B.editingCard},v.tsx("form",{bind:this,onsubmit:this._formSubmit},this.renderEditingInput(),v.tsx("div",{class:B.editingActions},this.renderCancelButton(),this.renderSubmitButton())))},o.renderBasemapTitle=function(){const{basemapTitle:e}=this.viewModel;return v.tsx(_.Heading,{level:this.headingLevel,class:this.classes(B.heading,B.mainHeading)},e)},o.renderEditTitleButton=function(){const{_editingTitle:e,editingEnabled:t,messagesCommon:i}=this;return t&&!e?v.tsx("button",{bind:this,class:B.editButton,title:i.edit,"aria-label":i.edit,onclick:this._toggleEditingTitle,afterCreate:this._storeEditTitleButton,afterUpdate:this._focusEditElement,"data-node-ref":"_editButtonNode",type:"button"},v.tsx("span",{"aria-hidden":"true",class:this.classes(B.iconEdit,B.editButtonIcon)})):null},o.renderTitleContainer=function(){return v.tsx("div",{class:B.titleContainer},this._editingTitle?this.renderEditingForm():this.renderBasemapTitle(),this.renderEditTitleButton())},o.renderNoLayersInfo=function(e,t){return v.tsx("div",{key:t,class:B.noItems},e)},o.renderList=function(e,t){const{messages:i}=this,n="reference"===t?this._destroyReferenceSortable:this._destroyBaseSortable;return v.tsx("ul",{key:t,"aria-label":i.widgetLabel,role:this.editingEnabled&&e.length?"listbox":void 0,afterCreate:this._sortNodeCreated,afterRemoved:n,"data-node-ref":t,bind:this,class:this.classes(B.list,B.listRoot,B.listIndependent)},e.map((i=>this.renderItem({item:i,parent:null,itemType:t,isOnlyChild:1===e.length}))))},o.renderBaseHeader=function(){return v.tsx(_.Heading,{key:"base-heading",level:_.incrementHeadingLevel(this.headingLevel),class:this.classes(B.heading,B.listHeading)},this.messages.baseHeading)},o.renderBaseSection=function(){const{baseItems:e,messages:t,visibleElements:i}=this;if(!i.baseLayers)return null;const n=this._getItems(e),s="base";return[this.renderBaseHeader(),[0===n.length?this.renderNoLayersInfo(t.noBaseLayers,s):null,this.renderList(n,s)]]},o.renderReferenceHeader=function(){return v.tsx(_.Heading,{key:"reference-heading",level:_.incrementHeadingLevel(this.headingLevel),class:this.classes(B.heading,B.listHeading)},this.messages.referenceHeading)},o.renderReferenceSection=function(){const{referenceItems:e,messages:t,visibleElements:i}=this;if(!i.referenceLayers)return null;const n=this._getItems(e),s="reference";return[this.renderReferenceHeader(),[0===n.length?this.renderNoLayersInfo(t.noReferenceLayers,s):null,this.renderList(n,s)]]},o.renderChildrenToggle=function(e,t){const{messagesCommon:i}=this,{children:n}=e,s=!!e.error,o=!!n.length&&!s,r={[B.childToggleOpen]:e.open},a=e.open?i.collapse:i.expand;return o?v.tsx("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":e,key:"toggle-children",class:this.classes(B.childToggle,r),tabindex:"0",role:"button","aria-controls":t,"aria-label":a,title:a},v.tsx("span",{"aria-hidden":"true",class:this.classes(B.childClosed,B.iconRightArrow)}),v.tsx("span",{"aria-hidden":"true",class:this.classes(B.childOpened,B.iconDownArrow)}),v.tsx("span",{"aria-hidden":"true",class:this.classes(B.childClosed_RTL,B.iconLeftArrow)})):null},o.renderItemMessage=function(e){return e.error?v.tsx("div",{key:"esri-basemap-layer-list__error",class:B.message,role:"alert"},v.tsx("span",{"aria-hidden":"true",class:B.iconNoticeTriangle}),this.messages.layerError):e.incompatible?v.tsx("div",{key:"esri-basemap-layer-list__incompatible",class:B.message,role:"alert"},v.tsx("span",{bind:this,tabIndex:0,"aria-hidden":"true",class:B.iconNoticeTriangle,afterCreate:t=>this._setTooltipReference(t,e)}),this.messages.layerIncompatible):null},o.renderActionsMenuIcon=function(e,t){const{messagesCommon:i}=this,n={[B.actionsMenuItemActive]:e.actionsOpen};return v.tsx("div",{key:"actions-menu-toggle","data-item":e,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(B.actionsMenuItem,n),tabindex:"0",role:"button","aria-controls":t,"aria-label":i.options,title:i.options},v.tsx("span",{"aria-hidden":"true",class:B.iconEllipses}))},o.renderActionsMenu=function(e,t,i,n){const{panel:s}=e,o=s&&s.visible?this.renderPanelButton(s):null,r=1===i&&this._getSingleActionButton(t),a=r?this.renderAction({item:e,action:r,singleAction:!0}):null,l=!r&&i?this.renderActionsMenuIcon(e,n):null;return l||o||r?v.tsx("div",{key:"actions-menu",class:B.actionsMenu},o,a,l):null},o.renderChildList=function(e,t){const{editingEnabled:i}=this,{visibilityMode:n,children:s}=e,o=this._hasChildren(e),r=!o&&i&&"group"===e.layer?.type,{exclusive:a,inherited:l}=U,c={[B.listExclusive]:n===a,[B.listInherited]:n===l,[B.listIndependent]:n!==l&&n!==a};return o||r?v.tsx("ul",{bind:this,key:"list-items",id:t,"data-group":e.uid,"data-item":e,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,class:this.classes(B.list,c),"aria-expanded":e.open?"true":"false",role:i?"listbox":n===a?"radiogroup":"group",hidden:!e.open||null},s?.map((t=>this.renderItem({item:t,parent:e}))).toArray()):null},o.renderItemContent=function(e,t,i){const{id:n}=this,s=`${n}_${e.uid}`,o=`${s}_actions`,r=`${s}__list`,{panel:a}=e,l=this._filterActions(e.actionsSections),c=this._countActions(l);return[v.tsx("div",{key:"list-item-container",class:B.itemContainer},this.renderChildrenToggle(e,r),this.renderLabel(e,t,i),this.renderActionsMenu(e,l,c,o)),this.renderItemMessage(e),c?this.renderActionsSections(e,l,o):null,a&&a.open&&!a.disabled?a.render():null,this.renderChildList(e,r)]},o.renderItem=function({item:e,parent:t,itemType:i,isOnlyChild:n}){const{_newUI:s,id:o,editingEnabled:r,selectedItems:a}=this,l=`${`${o}_${e.uid}`}__title`,c=this._hasMessage(e),d=this._hasChildren(e),u={[B.itemChildren]:d,[B.itemMessage]:!!c,[B.itemInvisible]:s&&!e.visible,[B.itemInvisibleAtScale]:!e.visibleAtCurrentScale,[B.itemSelectable]:r};if(r){const s={[$]:e.layer?.uid};return v.tsx("li",{key:`item-with-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(B.item,u,{[B.itemOnlyChild]:n}),"aria-labelledby":l,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item-type":i,"data-item":e,tabIndex:0,"aria-selected":b.findSelectedItem(e,a)?"true":"false",role:"option",...s},this.renderItemContent(e,t,l))}return v.tsx("li",{key:`item-no-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(B.item,u),"aria-labelledby":l},this.renderItemContent(e,t,l))},o.renderConnectionIcon=function(e){const{connectionStatus:t}=e;return a.isSome(t)?v.tsx("calcite-icon",{icon:"connected"===t?"check-circle":"offline",scale:"s"}):null},o.renderItemStatus=function(e,t){const{visibleElements:i}=this;if(!i.statusIndicators)return null;const{connectionStatus:n,publishing:s,updating:o}=e,r=o&&!t,a=!!n;return v.tsx("span",{class:this.classes({[B.statusIndicator]:!0,[B.publishing]:s,[B.updating]:r,[B.connectionStatus]:a,[B.connectionStatusConnected]:a&&"connected"===n}),key:"layer-item-status"},this.renderConnectionIcon(e))},o.renderItemTitle=function(e,t){const{messages:i}=this,n=e.title||i.untitledLayer,s=e.visibleAtCurrentScale?n:`${n} (${i.layerInvisibleAtScale})`;return v.tsx("span",{key:"layer-title-container",id:t,title:s,"aria-label":s,class:B.title},n)},o.renderItemToggleIcon=function(e,t){const{_newUI:i}=this,{exclusive:n}=U,s=t&&t.visibilityMode,o={[B.toggleVisibleIcon]:i,[B.toggleIcon]:i&&s!==n,[B.radioIcon]:i&&s===n,[B.iconRadioSelected]:s===n&&e.visible,[B.iconRadioUnselected]:s===n&&!e.visible,[B.iconVisible]:s!==n&&e.visible,[B.iconInvisible]:s!==n&&!e.visible};return v.tsx("span",{key:"item-toggle-icon",class:this.classes(o),"aria-hidden":"true"})},o.renderItemToggle=function(e,t,i){const{editingEnabled:n,messages:s}=this,{exclusive:o}=U,r=t&&t.visibilityMode,a=r===o?"radio":"switch";return n?v.tsx("span",{key:"item-toggle-selection-enabled",class:B.toggleVisible,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":r,tabIndex:0,"aria-checked":e.visible?"true":"false",title:e.visible?s.hideLayer:s.showLayer,role:a,"aria-labelledby":i},this.renderItemToggleIcon(e,t)):v.tsx("span",{key:"item-toggle",class:B.toggleVisible},this.renderItemToggleIcon(e,t))},o.renderLabel=function(e,t,i){const{editingEnabled:n,_newUI:s,messages:o}=this,{inherited:r,exclusive:a}=U,l=t?.visibilityMode,c=l===a?"radio":"switch",d=s?[this.renderItemTitle(e,i),this.renderItemStatus(e,t),this.renderItemToggle(e,t,i)]:[this.renderItemToggle(e,t,i),this.renderItemTitle(e,i),this.renderItemStatus(e,t)],u=n?v.tsx("div",{key:`item-label-no-selection-${e.uid}`,class:B.label},d):v.tsx("div",{key:`item-label-with-selection-${e.uid}`,class:B.label,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":l,tabIndex:0,title:e.visible?o.hideLayer:o.showLayer,"aria-checked":e.visible?"true":"false",role:c,"aria-labelledby":i},d);return l===r||e.error?v.tsx("div",{key:`item-label-container-${e.uid}`,class:B.label},this.renderItemTitle(e,i),this.renderItemStatus(e,t)):u},o.renderPanelButton=function(e){const{className:t,open:i,title:n,image:s}=e,o=s||t?t:B.iconDefaultAction,r=this._getIconImageStyles(e),a={[B.actionsMenuItemActive]:i},l={[B.actionImage]:!!r["background-image"],[B.disabledElement]:e.disabled};return o&&(l[o]=!!o),v.tsx("div",{"aria-disabled":e.disabled.toString(),key:`panel-${e.uid}`,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(B.actionsMenuItem,a),role:"button",tabindex:e.disabled?null:0,title:n,"aria-label":n},v.tsx("span",{class:this.classes(l),styles:r}))},o.renderActionsSections=function(e,t,i){const n=t.toArray().map(((t,i)=>v.tsx("ul",{key:`${e}-action-section-${i}`,class:B.actionsList},this.renderActionSection(e,t))));return v.tsx("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"actions-section",id:i,class:B.actions,hidden:!e.actionsOpen||null},n)},o.renderActionSection=function(e,t){return(t&&t.toArray()).map((t=>this.renderAction({item:e,action:t})))},o.renderActionIcon=function(e){const{active:t,className:i}=e,n=this._getIconImageStyles(e),s="button"!==e.type||e.image||i?i:B.iconDefaultAction,o={[B.actionImage]:!t&&!!n["background-image"],[B.iconLoading]:t,[B.rotating]:t};return s&&!t&&(o[s]=!0),v.tsx("span",{key:"action-icon","aria-hidden":"true",class:this.classes(B.actionIcon,o),styles:n})},o.renderActionTitle=function(e,t){return t?null:v.tsx("span",{key:"action-title",class:B.actionTitle},e)},o.renderAction=function(e){const{item:t,action:i,singleAction:n}=e,{active:s,disabled:o,title:r}=i,a={[B.actionsMenuItem]:n&&"button"===i.type,[B.action]:s||!n&&"toggle"!==i.type,[B.actionToggle]:!s&&"toggle"===i.type,[B.actionToggleOn]:!s&&"toggle"===i.type&&i.value,[B.disabledElement]:o},l=[this.renderActionIcon(i),this.renderActionTitle(r,n)];return n?v.tsx("div",{bind:this,"data-item":t,"data-action":i,role:"button",key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",title:r,"aria-label":r},l):v.tsx("li",{bind:this,"data-item":t,"data-action":i,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",role:"button",title:r,"aria-label":r},l)},o._setVisibleItems=function(){const{referenceItems:e,baseItems:t,visibleElements:i}=this,n=e.concat(t);this.visibleItems=n?.filter((e=>!e.hidden&&(i.errors||!e.error)))},o._setTooltipReference=function(e,t){this._tooltipReferenceMap.set(t.uid,e),this.scheduleRender()},o._hasMessage=function(e){return!!e.error||e.incompatible},o._hasChildren=function(e){return!!e.children.length&&!this._hasMessage(e)},o._filterActions=function(e){return e.map((e=>e.filter((e=>e.visible))))},o._destroyReferenceSortable=function(){const{_sortableReferenceLayers:e}=this;e?.el&&e.destroy(),this._sortableReferenceLayersNode=null},o._destroyBaseSortable=function(){const{_sortableBaseLayers:e}=this;e?.el&&e.destroy(),this._sortableBaseLayersNode=null},o._toggleEditingTitle=function(){const{_editingTitle:e}=this,t=!e;this._editingTitle=t,this._focusOnElement=t?"edit-input":"edit-button",this.scheduleRender()},o._storeEditTitleInput=function(e){this._editTitleInput=e,this._focusEditElement()},o._focusEditElement=function(){this._editTitleInput&&"edit-input"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleInput.focus()),this._editTitleButton&&"edit-button"===this._focusOnElement&&(this._focusOnElement=null,this._editTitleButton.focus())},o._storeEditTitleButton=function(e){this._editTitleButton=e,this._focusEditElement()},o._formSubmit=function(e){e.preventDefault();const t=this._editTitleInput?.value;t?.trim()&&(this.basemapTitle=t),this._toggleEditingTitle()},o._itemMovedList=function(e){const t=e.item["data-item"],i=e.to.dataset.nodeRef,n=e.from.dataset.nodeRef,{newIndex:s}=e;this.viewModel.transferListItem({listItem:t,from:n,to:i,newIndex:s})},o._toggleSortingBaseLayers=function(){const{_sortableBaseLayers:e,_sortableBaseLayersNode:t,editingEnabled:i}=this;if(!t)return;const n=!i;if(e)e.option("disabled",n);else{const e=w.Sortable.create(t,{dataIdAttr:$,group:S,filter:`.${B.itemOnlyChild}`,fallbackTolerance:4,disabled:n,onSort:()=>this._sortLayersToItems({type:"base",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:B.sortableChosen});this._sortableBaseLayers=e}},o._toggleSortingReferenceLayers=function(){const{_sortableReferenceLayers:e,_sortableReferenceLayersNode:t,editingEnabled:i}=this;if(!t)return;const n=!i;if(e)e.option("disabled",n);else{const e=w.Sortable.create(t,{dataIdAttr:$,group:S,disabled:n,fallbackTolerance:4,onSort:()=>this._sortLayersToItems({type:"reference",itemIds:e.toArray()}),onAdd:e=>this._itemMovedList(e),chosenClass:B.sortableChosen});this._sortableReferenceLayers=e}},o._toggleSorting=function(){this._toggleSortingBaseLayers(),this._toggleSortingReferenceLayers()},o._sortNodeCreated=function(e){const t=e.getAttribute("data-node-ref");"base"===t&&(this._sortableBaseLayersNode=e),"reference"===t&&(this._sortableReferenceLayersNode=e),this._toggleSorting()},o._getItems=function(e){return e.toArray().filter((e=>!e.hidden&&(this.visibleElements.errors||!e.error)))},o._getSingleActionButton=function(e){return e.reduce((e=>e)).filter((e=>e&&"button"===e.type)).getItemAt(0)},o._sortLayersToItems=function({type:e,itemIds:t}){const i="base"===e?this.get("view.map.basemap.baseLayers"):"reference"===e?this.get("view.map.basemap.referenceLayers"):null;i&&i.sort(((e,i)=>{const n=t.indexOf(e.uid),s=t.indexOf(i.uid);return n>s?-1:n<s?1:0}))},o._focusListItem=function(e){const{_focusSortUid:t}=this;if(!e||!t)return;e["data-item"].layer?.uid===t&&(e.focus(),this._focusSortUid=null)},o._selectionKeydown=function(e){const t=["ArrowDown","ArrowUp"],i=s.eventKey(e);if(!t.includes(i))return void this._toggleSelection(e);e.stopPropagation();const n=e.currentTarget,o=n["data-item"],r=n.dataset.itemType,{_sortableBaseLayers:a,_sortableReferenceLayers:l,selectedItems:c}=this,d="base"===r?a:"reference"===r?l:null;if(!d)return;const u=b.findSelectedItem(o,c),h=d.toArray(),g=e.target,m=h.indexOf(g.dataset[k]),{baseItems:p,referenceItems:_}=this.viewModel;if(-1!==m){if("ArrowDown"===i){const e=m+1,t=e>=h.length;if(t&&"reference"===r&&u){const e=p.length;return this.viewModel.transferListItem({listItem:o,from:"reference",to:"base",newIndex:e}),this._focusSortUid=o.layer?.uid,void this.scheduleRender()}if(t&&"reference"===r){const e=p.getItemAt(0);return this._focusSortUid=e?.layer?.uid,void this.scheduleRender()}if(t)return;return u&&(T(h,m,e),d.sort(h),this._sortLayersToItems({type:r,itemIds:d.toArray()})),this._focusSortUid=o.layer?.uid,void this.scheduleRender()}if("ArrowUp"===i){const e=m-1,t=e<0;if(t&&"base"===r&&u){if(1===p.length)return;const e=0;return this.viewModel.transferListItem({listItem:o,from:"base",to:"reference",newIndex:e}),this._focusSortUid=o.layer?.uid,void this.scheduleRender()}if(t&&"base"===r){const e=_.getItemAt(_.length-1);return this._focusSortUid=e?.layer?.uid,void this.scheduleRender()}if(t)return;u&&(T(h,m,e),d.sort(h),this._sortLayersToItems({type:r,itemIds:d.toArray()})),this._focusSortUid=o.layer?.uid,this.scheduleRender()}}},o._watchActionSectionChanges=function(e,t){this.handles.add(e.on("change",(()=>this.scheduleRender())),t),e.forEach((e=>this._renderOnActionChanges(e,t)))},o._renderOnActionChanges=function(e,t){"toggle"!==e.type?"slider"!==e.type?this.handles.add([l.watch((()=>[e.className,e.image,e.id,e.title,e.visible]),(()=>this.scheduleRender()),l.initial)],t):this.handles.add([l.watch((()=>[e.className,e.id,e.title,e.visible,e.value,e.displayValueEnabled,e.max,e.min,e.step]),(()=>this.scheduleRender()),l.initial)],t):this.handles.add([l.watch((()=>[e.className,e.image,e.id,e.title,e.visible,e.value]),(()=>this.scheduleRender()),l.initial)],t)},o._renderOnItemChanges=function(e,t){this.handles.add([l.watch((()=>[e.actionsOpen,e.visible,e.open,e.updating,e.connectionStatus,e.publishing,e.title,e.visibleAtCurrentScale,e.error,e.visibilityMode,e.panel,e.panel?.title,e.panel?.content,e.panel?.className]),(()=>this.scheduleRender()),l.initial),l.watch((()=>[e.hidden,e.error]),(()=>this._setVisibleItems())),e.actionsSections.on("change",(()=>this.scheduleRender())),e.children.on("change",(()=>this.scheduleRender()))],t),e.children.forEach((e=>this._renderOnItemChanges(e,t))),e.actionsSections.forEach((e=>this._watchActionSectionChanges(e,t)))},o._itemsChanged=function(e,t){this.handles.remove(t),this._tooltipReferenceMap.clear(),this._setVisibleItems(),e.forEach((e=>this._renderOnItemChanges(e,t))),this.scheduleRender()},o._countActions=function(e){return e.reduce(((e,t)=>e+t.length),0)},o._getIconImageStyles=function(e){const t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?`url("${t}")`:null}},o._toggleActionsOpen=function(e){e.stopPropagation();const t=e.currentTarget["data-item"],{actionsOpen:i}=t,n=!i,{baseItems:s,referenceItems:o}=this;n&&(s.forEach((e=>H(e))),o.forEach((e=>H(e)))),t.actionsOpen=n},o._triggerPanel=function(e){e.stopPropagation();const t=e.currentTarget["data-panel"];t&&!t.disabled&&(t.open=!t.open)},o._triggerAction=function(e){e.stopPropagation();const t=e.currentTarget,i=t["data-action"],n=t["data-item"];"toggle"===i.type&&(i.value=!i.value),this.triggerAction(i,n)},o._toggleVisibility=function(e){e.stopPropagation();const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),n=t["data-item"];i===U.exclusive&&n.visible||(n.visible=!n.visible)},o._toggleChildrenClick=function(e){e.stopPropagation();const t=e.currentTarget["data-item"];t.open=!t.open},o._toggleSelection=function(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,n=t&&(e.metaKey||e.ctrlKey),s=e.currentTarget["data-item"],o=b.findSelectedItem(s,i),{length:r}=i;if(!n)return r&&!(o&&1===r)?(i.removeAll(),void i.add(s)):void(o?i.remove(o):i.add(s));o?i.remove(o):i.add(s)},t._createClass(n,[{key:"basemapTitle",get:function(){return this.viewModel.basemapTitle},set:function(e){this.viewModel.basemapTitle=e}},{key:"baseListItemCreatedFunction",get:function(){return this.viewModel.baseListItemCreatedFunction},set:function(e){this.viewModel.baseListItemCreatedFunction=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"referenceListItemCreatedFunction",get:function(){return this.viewModel.referenceListItemCreatedFunction},set:function(e){this.viewModel.referenceListItemCreatedFunction=e}},{key:"baseItems",get:function(){return this.viewModel.baseItems}},{key:"referenceItems",get:function(){return this.viewModel.referenceItems}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}}]),n}(o.HandleOwnerMixin(g));i.__decorate([c.property()],V.prototype,"visibleItems",void 0),i.__decorate([c.property()],V.prototype,"basemapTitle",null),i.__decorate([c.property()],V.prototype,"baseListItemCreatedFunction",null),i.__decorate([c.property()],V.prototype,"editingEnabled",void 0),i.__decorate([c.property()],V.prototype,"headingLevel",void 0),i.__decorate([c.property()],V.prototype,"iconClass",void 0),i.__decorate([c.property()],V.prototype,"label",null),i.__decorate([c.property(),y.messageBundle("esri/widgets/BasemapLayerList/t9n/BasemapLayerList")],V.prototype,"messages",void 0),i.__decorate([c.property(),y.messageBundle("esri/t9n/common")],V.prototype,"messagesCommon",void 0),i.__decorate([c.property()],V.prototype,"multipleSelectionEnabled",void 0),i.__decorate([c.property()],V.prototype,"referenceListItemCreatedFunction",null),i.__decorate([c.property({readOnly:!0})],V.prototype,"baseItems",null),i.__decorate([c.property({readOnly:!0})],V.prototype,"referenceItems",null),i.__decorate([c.property()],V.prototype,"selectedItems",void 0),i.__decorate([c.property()],V.prototype,"view",null),i.__decorate([I.vmEvent("trigger-action"),c.property({type:m})],V.prototype,"viewModel",void 0),i.__decorate([c.property()],V.prototype,"visibleElements",void 0),i.__decorate([d.cast("visibleElements")],V.prototype,"castVisibleElements",null),i.__decorate([f.accessibleHandler()],V.prototype,"_toggleActionsOpen",null),i.__decorate([f.accessibleHandler()],V.prototype,"_triggerPanel",null),i.__decorate([f.accessibleHandler()],V.prototype,"_triggerAction",null),i.__decorate([f.accessibleHandler()],V.prototype,"_toggleVisibility",null),i.__decorate([f.accessibleHandler()],V.prototype,"_toggleChildrenClick",null),i.__decorate([f.accessibleHandler()],V.prototype,"_toggleSelection",null),V=i.__decorate([h.subclass("esri.widgets.BasemapLayerList")],V);return V}));
