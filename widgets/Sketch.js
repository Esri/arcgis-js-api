/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/handleUtils","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/arrayUtils","../core/accessorSupport/decorators/subclass","./Widget","./Sketch/SketchViewModel","./support/SelectionToolbar","./support/SnappingControls","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","../intl/substitute"],(function(e,t,n,o,i,s,l,a,r,c,u,d,p,h,v,g,_,f,y,b){"use strict";const m="esri-sketch",w={base:m,verticalLayout:`${m}--vertical`,panel:`${m}__panel`,infoPanel:`${m}__info-panel`,section:`${m}__section`,toolSection:`${m}__tool-section`,infoSection:`${m}__info-section`,infoCountSection:`${m}__info-count-section`,menuContainer:`${m}__menu-container`,menuHeader:`${m}__menu-header`,menuTitle:`${m}__menu-title`,featureCountBadge:`${m}__feature-count-badge`,featureCountText:`${m}__feature-count-text`,featureCountNumber:`${m}__feature-count-number`,actionToggle:`${m}__action-toggle`,actionToggleOn:`${m}__action-toggle--on`,actionTitle:`${m}__item-action-title`,actionIcon:`${m}__item-action-icon`,disabled:"esri-disabled",esriWidget:"esri-widget",rotating:"esri-rotating",widgetIcon:"esri-icon-edit"},C={createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{"rectangle-selection":!0,"lasso-selection":!0},undoRedoMenu:!0,settingsMenu:!0,snappingControls:!0,snappingControlsElements:{header:!1,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0}};let M=function(n){function o(e,o){var i;return(i=n.call(this,e,o)||this)._activeCreateOptions=null,i._menuOpen=!1,i._selectionToolbar=null,i._snappingControls=null,i._viewModelHandlesGroup=null,i.availableCreateTools=["point","polyline","polygon","rectangle","circle"],i.creationMode="continuous",i.iconClass=w.widgetIcon,i.layout="horizontal",i.messages=null,i.visibleElements={...C},i._activateCreateTool=i._activateCreateTool.bind(t._assertThisInitialized(i)),i.viewModel=e?.viewModel||new p,i}t._inheritsLoose(o,n);var a=o.prototype;return a.initialize=function(){const{layer:e,view:t}=this,n=new h({view:"2d"===t?.type?t:null,layers:e?[e]:null});this.addHandles([l.watch((()=>this.viewModel),(e=>{this._viewModelHandlesGroup=s.removeMaybe(this._viewModelHandlesGroup),e&&(this._viewModelHandlesGroup=i.handlesGroup([e.on("create",(e=>{this.scheduleRender(),this._onCreateOperation(e)})),e.on("update",(()=>this.scheduleRender())),e.on("delete",(e=>this.emit("delete",e))),e.on("undo",(()=>this.scheduleRender())),e.on("redo",(()=>this.scheduleRender())),l.watch((()=>e.layer),(e=>{this._selectionToolbar.layers=e?[e]:null})),l.watch((()=>e.view),(e=>{this._selectionToolbar.view="2d"===e?.type?e:null,this._setUpSnappingControls()})),l.watch((()=>e.state),(()=>this.notifyChange("state")))]))}),l.syncAndInitial),l.when((()=>n.activeToolInfo),(()=>this.viewModel.cancel())),n.on("complete",(e=>this._onSelectionOperationComplete(e)))]),this._selectionToolbar=n,this._setUpSnappingControls()},a.loadDependencies=function(){return Promise.all([new Promise(((t,n)=>e(["../chunks/calcite-action"],t,n))),new Promise(((t,n)=>e(["../chunks/calcite-icon"],t,n)))])},a.destroy=function(){this._selectionToolbar.destroy(),this._viewModelHandlesGroup=s.removeMaybe(this._viewModelHandlesGroup),this._snappingControls=s.destroyMaybe(this._snappingControls)},a.castVisibleElements=function(e){const t={...C,...e,createTools:{...C.createTools,...e?.createTools},selectionTools:{...C.selectionTools,...e?.selectionTools},snappingControlsElements:{...C.snappingControlsElements,...e?.snappingControlsElements}};return s.isSome(this._snappingControls)&&(this._snappingControls.visibleElements=t.snappingControlsElements),t},a.create=function(e,t){this._activeCreateOptions=t||null,this.viewModel.create(e,t)},a.update=function(e,t){return this.viewModel.update(e,t)},a.complete=function(){this.viewModel.complete()},a.cancel=function(){this._selectionToolbar.cancel(),this.viewModel.cancel()},a.undo=function(){this.viewModel.undo(),this.view?.focus()},a.redo=function(){this.viewModel.redo(),this.view?.focus()},a.delete=function(){this.viewModel.delete()},a.duplicate=function(){return this.viewModel.duplicate()},a.render=function(){const{label:e,layout:t,viewModel:{state:n}}=this;return y.tsx("div",{"aria-label":e,class:this.classes(w.base,w.esriWidget,{[w.disabled]:"disabled"===n,[w.verticalLayout]:"vertical"===t})},y.tsx("div",{role:"toolbar",class:w.panel},this.renderTopPanelContents()),y.tsx("div",{class:this.classes(w.panel,w.infoPanel)},this.renderInfoPanelContents()))},a.renderTopPanelContents=function(){const e=this.classes(w.section,w.toolSection),{availableCreateTools:t,visibleElements:n}=this;return[y.tsx("div",{role:"menu",key:"selection-button-container",class:e},this.renderDefaultSelectionButton(),this.renderSelectionToolbar()),t&&t.length?y.tsx("div",{role:"menu",class:e},this.renderDrawButtons()):null,n.undoRedoMenu?y.tsx("div",{role:"menu",key:"undo-redo-menu-button-container",class:e},this.renderUndoRedoMenuButtons()):null,n.settingsMenu?y.tsx("div",{key:"settings-menu-button-container",class:w.section},this.renderSettingsMenuButton()):null]},a.renderInfoPanelContents=function(){return this._menuOpen?this.renderSettingsMenu():this.updateGraphics.length?[y.tsx("div",{class:this.classes(w.section,w.infoSection,w.infoCountSection),key:"feature-count-container"},this.renderFeatureCount()),y.tsx("div",{class:this.classes(w.section,w.infoSection),key:"delete-button-container"},this.renderDuplicateButton(),this.renderDeleteButton())]:void 0},a.renderSettingsMenu=function(){const{settings:e}=this.messages;return[y.tsx("div",{role:"menu",class:w.menuContainer,key:"settings-menu-container"},y.tsx("header",{class:w.menuHeader,key:"settings-menu-header"},y.tsx("span",{class:w.menuTitle},e)),this.renderSnappingControls())]},a.renderSnappingControls=function(){const{snappingControls:e}=this.visibleElements;if(s.isSome(this._snappingControls)&&e)return this._snappingControls.render()},a.renderFeatureCount=function(){const{layout:e,messages:t,updateGraphics:{length:n}}=this,o=b.substitute(1===n?t.featureCount:t.featuresCount,{count:n});return y.tsx("div",{class:w.featureCountBadge,"aria-label":o},y.tsx("span",{class:w.featureCountNumber},"vertical"===e?n:o))},a.renderDuplicateButton=function(){const e=this.messages,t=this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature;return y.tsx("calcite-action",{bind:this,label:t,onclick:this._onDuplicateSelect,scale:"s",text:t,title:t},y.tsx("calcite-icon",{scale:"s",icon:"copy"}))},a.renderDeleteButton=function(){const e=this.messages,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return y.tsx("calcite-action",{bind:this,label:t,onclick:this.delete,scale:"s",text:t,title:t},y.tsx("calcite-icon",{scale:"s",icon:"trash"}))},a.renderDefaultSelectionButton=function(){if(!this.viewModel.updateOnGraphicClick)return;const e=this.messages.selectFeature;return y.tsx("calcite-action",{active:"ready"===this.state,bind:this,label:e,onclick:this._activateDefaultSelectTool,scale:"s",text:e,title:e},y.tsx("calcite-icon",{scale:"s",icon:"cursor"}))},a.renderSelectionToolbar=function(){if("2d"!==this.view?.type)return;const e=this.visibleElements.selectionTools;return this._selectionToolbar.visibleElements={lassoTool:!!e["lasso-selection"],rectangleTool:!!e["rectangle-selection"]},this._selectionToolbar.render()},a.renderDrawButtons=function(){const e=this.visibleElements.createTools;return this.availableCreateTools.map((t=>"point"===t&&e.point?this.renderPointButton():"polyline"===t&&e.polyline?this.renderPolylineButton():"polygon"===t&&e.polygon?this.renderPolygonButton():"rectangle"===t&&e.rectangle?this.renderRectangleButton():"circle"===t&&e.circle?this.renderCircleButton():void 0))},a.renderPointButton=function(){const e="point",t=this.messages.drawPoint;return y.tsx("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},y.tsx("calcite-icon",{scale:"s",icon:"pin"}))},a.renderPolygonButton=function(){const e="polygon",t=this.messages.drawPolygon;return y.tsx("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},y.tsx("calcite-icon",{scale:"s",icon:"polygon"}))},a.renderPolylineButton=function(){const e="polyline",t=this.messages.drawPolyline;return y.tsx("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},y.tsx("calcite-icon",{scale:"s",icon:"line"}))},a.renderCircleButton=function(){const e="circle",t=this.messages.drawCircle;return y.tsx("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},y.tsx("calcite-icon",{scale:"s",icon:"circle"}))},a.renderRectangleButton=function(){const e="rectangle",t=this.messages.drawRectangle;return y.tsx("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},y.tsx("calcite-icon",{scale:"s",icon:"rectangle"}))},a.renderUndoRedoMenuButtons=function(){return[this.renderUndoButton(),this.renderRedoButton()]},a.renderUndoButton=function(){const e=this.messages.undo;return y.tsx("calcite-action",{disabled:!this.viewModel.canUndo(),bind:this,label:e,onclick:this.undo,scale:"s",text:e,title:e},y.tsx("calcite-icon",{scale:"s",icon:g.isRTL(this.container)?"redo":"undo"}))},a.renderRedoButton=function(){const e=this.messages.redo;return y.tsx("calcite-action",{disabled:!this.viewModel.canRedo(),bind:this,label:e,onclick:this.redo,scale:"s",text:e,title:e},y.tsx("calcite-icon",{scale:"s",icon:g.isRTL(this.container)?"undo":"redo"}))},a.renderSettingsMenuButton=function(){const e=this.messages.settings;return y.tsx("calcite-action",{active:this._menuOpen,bind:this,label:e,onclick:this._toggleMenu,scale:"s",text:e,title:e},y.tsx("calcite-icon",{scale:"s",icon:"gear"}))},a._activateCreateTool=function(e){this.activeTool!==e?(this._selectionToolbar.cancel(),this.create(e)):this.cancel()},a._onCreateOperation=function(e){if("complete"!==e.state)return;const{creationMode:t}=this,{type:n}=e;if("create"===n){const{tool:n,graphic:o}=e,i=this._activeCreateOptions;this._activeCreateOptions=null,"continuous"===t?this.create(n,i):"update"===t&&this.update([o])}},a._toggleMenu=function(){this._menuOpen=!this._menuOpen,this.scheduleRender()},a._onDuplicateSelect=function(){const e=this.duplicate(),t=this.viewModel.activeTool;"transform"!==t&&"reshape"!==t||this.update(e,{tool:t})},a._onSelectionOperationComplete=function(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:n}=e;if(!e.aborted&&n.length){const e=t.tool,o=n.length>1&&"reshape"===e?"transform":e;this.update(n,{...t,tool:o})}this.notifyChange("state")},a._activateDefaultSelectTool=function(){this.cancel(),this.view?.focus()},a._setUpSnappingControls=function(){const{snappingOptions:e,view:t}=this;if(this._snappingControls=s.destroyMaybe(this._snappingControls),!e||!t)return;const n=new v({snappingOptions:e,view:t,visibleElements:this.visibleElements.snappingControlsElements});this._snappingControls=n},t._createClass(o,[{key:"activeTool",get:function(){const e=this._selectionToolbar.activeToolInfo;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}return this.viewModel.activeTool}},{key:"createGraphic",get:function(){return this.viewModel.createGraphic}},{key:"defaultCreateOptions",get:function(){return this.viewModel.defaultCreateOptions},set:function(e){this.viewModel.defaultCreateOptions=e}},{key:"defaultUpdateOptions",get:function(){return this.viewModel.defaultUpdateOptions},set:function(e){this.viewModel.defaultUpdateOptions=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"labelOptions",get:function(){return this.viewModel.labelOptions},set:function(e){this.viewModel.labelOptions=e}},{key:"layer",get:function(){return this.viewModel.layer},set:function(e){this.viewModel.layer=e}},{key:"snappingOptions",get:function(){return this.viewModel.snappingOptions},set:function(e){this.viewModel.snappingOptions=e}},{key:"state",get:function(){return this._selectionToolbar.activeToolInfo?"active":this.viewModel.state}},{key:"tooltipOptions",get:function(){return this.viewModel.tooltipOptions},set:function(e){this.viewModel.tooltipOptions=e}},{key:"updateGraphics",get:function(){return this.viewModel.updateGraphics}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"viewModel",set:function(e){const t=this._get("viewModel");e!==t&&(t&&s.destroyMaybe(t),this._set("viewModel",e))}}]),o}(d);n.__decorate([a.property()],M.prototype,"activeTool",null),n.__decorate([a.property({cast:e=>{if(!e||!e.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle"]);return e.filter((e=>t.has(e)))}})],M.prototype,"availableCreateTools",void 0),n.__decorate([a.property({readOnly:!0})],M.prototype,"createGraphic",null),n.__decorate([a.property()],M.prototype,"creationMode",void 0),n.__decorate([a.property()],M.prototype,"defaultCreateOptions",null),n.__decorate([a.property()],M.prototype,"defaultUpdateOptions",null),n.__decorate([a.property()],M.prototype,"iconClass",void 0),n.__decorate([a.property()],M.prototype,"label",null),n.__decorate([a.property()],M.prototype,"labelOptions",null),n.__decorate([a.property()],M.prototype,"layer",null),n.__decorate([a.property({type:["horizontal","vertical"]})],M.prototype,"layout",void 0),n.__decorate([a.property(),_.messageBundle("esri/widgets/Sketch/t9n/Sketch")],M.prototype,"messages",void 0),n.__decorate([a.property()],M.prototype,"snappingOptions",null),n.__decorate([a.property()],M.prototype,"state",null),n.__decorate([a.property()],M.prototype,"tooltipOptions",null),n.__decorate([a.property({readOnly:!0})],M.prototype,"updateGraphics",null),n.__decorate([a.property()],M.prototype,"view",null),n.__decorate([a.property(),f.vmEvent(["create","update","undo","redo"])],M.prototype,"viewModel",null),n.__decorate([a.property()],M.prototype,"visibleElements",void 0),n.__decorate([r.cast("visibleElements")],M.prototype,"castVisibleElements",null),M=n.__decorate([u.subclass("esri.widgets.Sketch")],M);return M}));
