/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/compilerUtils","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Accessor","../../core/Collection","../../core/Handles","../../layers/Layer","../../core/watchUtils","../../views/layers/support/ClipRect"],(function(e,t,i,r,o,n,s,l,a,p,c,y,d,_,u,h,g){"use strict";const w=d.ofType(u);const v={left:0,right:0,top:0,bottom:0};let f=function(t){function i(e){var i;return(i=t.call(this,e)||this)._handles=new _,i._leadingClips=new Map,i._trailingClips=new Map,i.direction="horizontal",i.leadingLayers=new w,i.max=100,i.min=0,i.precision=4,i.step=.5,i.stepMultiplier=10,i.trailingLayers=new w,i.view=null,i}e._inheritsLoose(i,t);var o=i.prototype;return o.initialize=function(){this._handles.add([h.init(this,["view","view.ready","position","direction"],(()=>this._clipLayers())),h.on(this,"leadingLayers","change",(()=>this._clipLeadingLayers())),h.on(this,"trailingLayers","change",(()=>this._clipTrailingLayers()))])},o.destroy=function(){this._removeExistingClips(),this._handles.destroy(),this._handles=null},o._clipLayers=function(){this._clipLeadingLayers(),this._clipTrailingLayers()},o._clipLeadingLayers=function(){this._removeClips("leading");const{leadingLayers:e}=this;e.forEach((e=>this._clipLayer({layer:e,type:"leading"})))},o._clipTrailingLayers=function(){this._removeClips("trailing");const{trailingLayers:e}=this;e.forEach((e=>this._clipLayer({layer:e,type:"trailing"})))},o._getLayerView=async function(e){const{view:t}=this;if(!e||!t)return null;const i=await r.typeCast(t)().whenLayerView(e);return"clips"in i?i:null},o._getVerticalClipRect=function(e){const{position:t}=this;return"leading"===e?new g({...v,bottom:100-t+"%"}):"trailing"===e?new g({...v,top:`${t}%`}):null},o._getHorizontalClipRect=function(e){const{position:t}=this;return"leading"===e?new g({...v,right:100-t+"%"}):"trailing"===e?new g({...v,left:`${t}%`}):null},o._getClipRect=function(e){const{direction:t}=this;return"vertical"===t?this._getVerticalClipRect(e):"horizontal"===t?this._getHorizontalClipRect(e):null},o._clipLayer=async function(e){const{_leadingClips:t,_trailingClips:i}=this,{layer:r,type:o}=e,n="trailing"===o?i:"leading"===o?t:null,s=await this._getLayerView(r);if(!(s&&"clips"in s&&n&&s.hasOwnProperty("clips")))return;const l=n.get(s);l&&s.clips.remove(l);const a=this._getClipRect(o);a&&(n.set(s,a),s.clips.add(a))},o._removeClips=function(e){const{_leadingClips:t,_trailingClips:i}=this,r="trailing"===e?i:"leading"===e?t:null;r&&(r.forEach(((e,t)=>{t&&t.hasOwnProperty("clips")&&t.clips.remove(e)})),r.clear())},o._removeExistingClips=function(){this._removeClips("leading"),this._removeClips("trailing")},e._createClass(i,[{key:"position",get:function(){return 25},set:function(e){const{precision:t,min:i,max:r}=this;this._set("position",function(e,t){const i=Math.pow(10,t);return Math.round(e*i)/i}(Math.max(Math.min(e,r),i),t))}},{key:"state",get:function(){const{view:e}=this;return e&&e.ready?"ready":"disabled"}}]),i}(y);return t.__decorate([s.property()],f.prototype,"direction",void 0),t.__decorate([s.property({type:w})],f.prototype,"leadingLayers",void 0),t.__decorate([s.property({readOnly:!0})],f.prototype,"max",void 0),t.__decorate([s.property({readOnly:!0})],f.prototype,"min",void 0),t.__decorate([s.property()],f.prototype,"position",null),t.__decorate([s.property()],f.prototype,"precision",void 0),t.__decorate([s.property({dependsOn:["view.ready"],readOnly:!0})],f.prototype,"state",null),t.__decorate([s.property()],f.prototype,"step",void 0),t.__decorate([s.property()],f.prototype,"stepMultiplier",void 0),t.__decorate([s.property({type:w})],f.prototype,"trailingLayers",void 0),t.__decorate([s.property()],f.prototype,"view",void 0),f=t.__decorate([l.subclass("esri.widgets.Swipe.SwipeViewModel")],f),f}));
