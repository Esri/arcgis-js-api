/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/maybe","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/watchUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/renderable","../chunks/index","./Widget","./Daylight/daylightUtils","./Daylight/DaylightViewModel","./Daylight/support/SliderWithDropdown","./support/DatePicker"],(function(e,i,t,s,o,r,a,l,n,d,c,h,p,u,g,w,_,v,m,y,b,S){"use strict";const f="esri-daylight",M="esri-button",k="esri-daylight__checkbox",x="esri-icon-checkbox-checked",O="esri-daylight__container esri-daylight__day-container",E="esri-daylight__container esri-daylight__date-container",P="esri-widget__heading",D="esri-interactive",j=" esri-widget__anchor",T="esri-daylight__container__labelled-tick",C="esri-icon-pause",B="esri-icon-play",z="esri-daylight__play-pause-button",L="esri-select",V="esri-daylight__season-picker",I="esri-daylight__shadow-container",F="esri-slider--shadow-off",U="esri-slider--shadow-on",N="esri-daylight__container__tick",$="esri-icon-checkbox-unchecked",Y="esri-widget",A="esri-slider--date-on",H="esri-slider--date-off",R="esri-daylight__panel--error",W={playButtons:!0,shadowsToggle:!0,datePicker:!0,timezone:!0},G=o.getLogger("esri.widgets.Daylight"),q="date";let J=function(i){function t(t,s){var o,r;return(r=i.call(this,t,s)||this).playSpeedMultiplier=1,r.timeSliderSteps=5,r.view=null,r.viewModel=new y,r.visibleElements={...W},r.dateOrSeason=q,r._timeSlider=new b({viewModel:r.viewModel.timeSliderViewModel,labelFormatFunction:m.formatSliderLabel,inputFormatFunction:m.formatSliderLabel,min:0,max:1439,steps:null!=(o=r.timeSliderSteps)?o:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:r._onPrimaryTickCreated.bind(e._assertThisInitialized(r))},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:r._onSecondaryTickCreated.bind(e._assertThisInitialized(r))}],items:[]}),r._datePicker=new S({viewModel:r.viewModel.datePickerViewModel,commitOnMonthChange:!0}),r}e._inheritsLoose(t,i);var o=t.prototype;return o.castVisibleElements=function(e){return{...W,...e}},o.postInitialize=function(){this.viewModel.isSupported&&this.own(p.init(this.viewModel,"datePickerViewModel",(e=>{this._datePicker.viewModel=e})),p.init(this.viewModel,"timeSliderViewModel",(e=>{this._timeSlider.viewModel=e})),p.init(this,"messages",(()=>{this._timeSlider.buttonTooltip=this.messages.chooseTimezone})),p.init(this,"visibleElements",(()=>{this._timeSlider.showDropDown=this.visibleElements.timezone})),p.init(this,"gmtOffsets",(e=>{s.isSome(e)&&(this._timeSlider.items=e)})),p.init(this,["viewModel.utcOffset","gmtOffsets"],(()=>this._onUTCOffsetChange())))},o.destroy=function(){this._datePicker.destroy(),this._timeSlider.destroy()},o.render=function(){return this.viewModel.isSupported?_.jsx("div",{class:this.classes(f,Y)},_.jsx("h3",{class:P},this.messages.title),this.renderTimeOptions(),this.visibleElements.datePicker?"date"===this.dateOrSeason?this.renderDateOptions():this.renderSeasonOptions():null,this.visibleElements.shadowsToggle?this.renderShadowOptions():null):_.jsx("div",{class:this.classes(f,Y)},_.jsx("div",{key:"daylight__unsupported",class:R},_.jsx("p",null,this.messages.unsupported)))},o.renderTimeOptions=function(){const e={[B]:!this.viewModel.dayPlaying,[C]:this.viewModel.dayPlaying},i={[U]:this.viewModel.directShadowsEnabled,[F]:!this.viewModel.directShadowsEnabled},t={[A]:this.visibleElements.datePicker,[H]:!this.visibleElements.datePicker};return _.jsx("div",{class:this.classes(O,i,t),key:"daylight-time-options"},this._timeSlider.render(),this.visibleElements.playButtons?_.jsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleDayPlaying,"aria-label":this.messages.playDay,title:this.messages.playDay,type:"button",class:this.classes(M,z,e)},_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},_.jsx("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)},o.renderDateOptions=function(){const e={[B]:!this.viewModel.yearPlaying,[C]:this.viewModel.yearPlaying};return _.jsx("div",{class:E,key:"daylight-date-options"},this._datePicker.render(),this.visibleElements.playButtons?_.jsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleYearPlaying,"aria-label":this.messages.playYear,title:this.messages.playYear,type:"button",class:this.classes(M,z,e)},_.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},_.jsx("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)},o.renderShadowOptions=function(){const e=`${this.id}__shadowButton`,i={[x]:this.viewModel.directShadowsEnabled,[$]:!this.viewModel.directShadowsEnabled};return _.jsx("div",{class:I,key:"daylight-shadow-options"},_.jsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,name:e,class:this.classes(M,k,i),"aria-label":this.messages.directShadow,title:this.messages.directShadow,type:"button"}),_.jsx("label",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,for:e,class:this.classes(j,D),"aria-label":this.messages.directShadow,title:this.messages.directShadow},this.messages.directShadow))},o.renderSeasonOptions=function(){return _.jsx("select",{bind:this,onchange:this._onSeasonChange,class:this.classes(L,V),value:this.viewModel.currentSeason,"aria-label":this.messages.season},m.ORDERED_SEASONS.map((e=>_.jsx("option",{value:e},this.messages[e]))))},o._onSeasonChange=function(e){const i=e.target;this.viewModel.currentSeason=i.value},o._onUTCOffsetChange=function(){var e;const i=this.viewModel.utcOffset,t=null==(e=this._timeSlider.currentItem)?void 0:e.abbr,o=this.gmtOffsets;if(!s.isSome(o)||t===i)return;const r=o.findIndex((({abbr:e})=>e===i));r>-1&&(this._timeSlider.currentIndex=r)},o._onPrimaryTickCreated=function(e,i,t){i.className+=" esri-interactive esri-widget__anchor "+N+" "+T,t.className+=" esri-interactive esri-widget__anchor";const s=()=>{this.viewModel.timeSliderPosition=e};i.onclick=s,t.onclick=s;const o=t.innerText;-1!==o.indexOf(" ")&&(t.innerHTML=o.replace(/(.*) (.*)/,'$1<br><div class="esri-label__ampm">$2</div>'))},o._onSecondaryTickCreated=function(e,i){i.className+=" esri-interactive esri-widget__anchor "+N,i.onclick=()=>{this.viewModel.timeSliderPosition=e}},e._createClass(t,[{key:"gmtOffsets",get:function(){return this.messages?m.getGMTOffsets(this.messages):null}}]),t}(v);return i.__decorate([r.property({readOnly:!0,dependsOn:["messages"]})],J.prototype,"gmtOffsets",null),i.__decorate([r.property(),w.renderable(),g.messageBundle("esri/widgets/Daylight/t9n/Daylight")],J.prototype,"messages",void 0),i.__decorate([a.aliasOf("viewModel.playSpeedMultiplier")],J.prototype,"playSpeedMultiplier",void 0),i.__decorate([a.aliasOf("_timeSlider.steps")],J.prototype,"timeSliderSteps",void 0),i.__decorate([a.aliasOf("viewModel.view")],J.prototype,"view",void 0),i.__decorate([r.property({type:y}),w.renderable(["viewModel.directShadowsEnabled","viewModel.timeSliderPosition","viewModel.currentSeason","viewModel.localDate","viewModel.utcOffset"])],J.prototype,"viewModel",void 0),i.__decorate([r.property(),w.renderable()],J.prototype,"visibleElements",void 0),i.__decorate([l.cast("visibleElements")],J.prototype,"castVisibleElements",null),i.__decorate([r.property({cast:e=>"season"===e||"date"===e?e:(G.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "date".`),q)}),w.renderable()],J.prototype,"dateOrSeason",void 0),i.__decorate([r.property(),w.renderable()],J.prototype,"_timeSlider",void 0),i.__decorate([r.property(),w.renderable()],J.prototype,"_datePicker",void 0),J=i.__decorate([n.subclass("esri.widgets.Daylight")],J),J}));
