/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/Logger","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./Daylight/DaylightViewModel","./Daylight/support/daylightUtils","./Daylight/support/SliderWithDropdown","./support/DatePicker","./support/Heading","./support/timeWidgetUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(e,t,i,s,o,a,r,l,n,d,c,h,p,u,g,w,y,v,_,m,b){"use strict";const f={base:"esri-daylight",widgetIcon:"esri-icon-environment-settings",button:"esri-button",checkbox:"esri-daylight__checkbox",checked:"esri-icon-checkbox-checked",dayContainer:"esri-daylight__container esri-daylight__day-container",dateContainer:"esri-daylight__container esri-daylight__date-container",interactive:"esri-interactive",label:" esri-widget__anchor",labelledTick:"esri-daylight__container__labelled-tick",pause:"esri-icon-pause",play:"esri-icon-play",playPauseButton:"esri-daylight__play-pause-button",select:"esri-select",seasonPicker:"esri-daylight__season-picker",shadow:"esri-daylight__shadow-container",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",tick:"esri-daylight__container__tick",unchecked:"esri-icon-checkbox-unchecked",widget:"esri-widget",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",panelError:"esri-daylight__panel--error"},S={playButtons:!0,shadowsToggle:!0,datePicker:!0,timezone:!0},k=/(.*)\s(.*)/,M=i.getLogger("esri.widgets.Daylight"),O="date";let x=function(t){function i(i,s){var o,a;return(a=t.call(this,i,s)||this).headingLevel=3,a.iconClass=f.widgetIcon,a.label=void 0,a.playSpeedMultiplier=1,a.timeSliderSteps=5,a.view=null,a.viewModel=new p,a.visibleElements={...S},a.dateOrSeason=O,a._timeSlider=new g({viewModel:a.viewModel.timeSliderViewModel,labelFormatFunction:v.formatSliderLabel,inputFormatFunction:v.formatSliderLabel,min:0,max:1439,steps:null!=(o=a.timeSliderSteps)?o:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:a._onPrimaryTickCreated.bind(e._assertThisInitialized(a))},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:a._onSecondaryTickCreated.bind(e._assertThisInitialized(a))}],items:[]}),a._datePicker=new w({viewModel:a.viewModel.datePickerViewModel,commitOnMonthChange:!0}),a}e._inheritsLoose(i,t);var a=i.prototype;return a.castVisibleElements=function(e){return{...S,...e}},a.postInitialize=function(){this.viewModel.isSupported&&this.own(o.watch((()=>this.viewModel.datePickerViewModel),(e=>this._datePicker.viewModel=e),o.initial),o.watch((()=>this.viewModel.timeSliderViewModel),(e=>this._timeSlider.viewModel=e),o.initial),o.watch((()=>{var e;return null==(e=this.timezoneMessages)?void 0:e.chooseTimezone}),(e=>this._timeSlider.buttonTooltip=e),o.initial),o.watch((()=>{var e;return null==(e=this.visibleElements)?void 0:e.timezone}),(e=>this._timeSlider.showDropDown=e),o.initial),o.when((()=>this.gmtOffsets),(e=>{this._timeSlider.items=e.map((e=>({utcOffset:e.utcOffset,name:e.short,label:[e.shortWithUTC,e.long]})))}),o.initial),o.watch((()=>[this.viewModel.utcOffset,this.gmtOffsets]),(()=>this._onUTCOffsetChange()),o.initial))},a.destroy=function(){this._datePicker.destroy(),this._timeSlider.destroy()},a.render=function(){return this.viewModel.isSupported?b.tsx("div",{class:this.classes(f.base,f.widget)},b.tsx(y.Heading,{level:this.headingLevel},this.messages.title),this.renderTimeOptions(),this.visibleElements.datePicker?"date"===this.dateOrSeason?this.renderDateOptions():this.renderSeasonOptions():null,this.visibleElements.shadowsToggle?this.renderShadowOptions():null):b.tsx("div",{class:this.classes(f.base,f.widget)},b.tsx("div",{key:"daylight__unsupported",class:f.panelError},b.tsx("p",null,this.messages.unsupported)))},a.renderTimeOptions=function(){const e={[f.play]:!this.viewModel.dayPlaying,[f.pause]:this.viewModel.dayPlaying},t={[f.shadowOn]:this.viewModel.directShadowsEnabled,[f.shadowOff]:!this.viewModel.directShadowsEnabled},i={[f.sliderDateOn]:this.visibleElements.datePicker,[f.sliderDateOff]:!this.visibleElements.datePicker};return b.tsx("div",{class:this.classes(f.dayContainer,t,i),key:"daylight-time-options"},this._timeSlider.render(),this.visibleElements.playButtons?b.tsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleDayPlaying,"aria-label":this.messages.playDay,title:this.messages.playDay,type:"button",class:this.classes(f.button,f.playPauseButton,e)},b.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},b.tsx("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)},a.renderDateOptions=function(){const e={[f.play]:!this.viewModel.yearPlaying,[f.pause]:this.viewModel.yearPlaying};return b.tsx("div",{class:f.dateContainer,key:"daylight-date-options"},this._datePicker.render(),this.visibleElements.playButtons?b.tsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleYearPlaying,"aria-label":this.messages.playYear,title:this.messages.playYear,type:"button",class:this.classes(f.button,f.playPauseButton,e)},b.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},b.tsx("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)},a.renderShadowOptions=function(){const e=`${this.id}__shadowButton`,t={[f.checked]:this.viewModel.directShadowsEnabled,[f.unchecked]:!this.viewModel.directShadowsEnabled};return b.tsx("div",{class:f.shadow,key:"daylight-shadow-options"},b.tsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,name:e,class:this.classes(f.button,f.checkbox,t),"aria-label":this.messages.directShadow,title:this.messages.directShadow,type:"button"}),b.tsx("label",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,for:e,class:this.classes(f.label,f.interactive),"aria-label":this.messages.directShadow,title:this.messages.directShadow},this.messages.directShadow))},a.renderSeasonOptions=function(){return b.tsx("select",{bind:this,onchange:this._onSeasonChange,class:this.classes(f.select,f.seasonPicker),value:this.viewModel.currentSeason,"aria-label":this.messages.season},u.ORDERED_SEASONS.map((e=>b.tsx("option",{value:e},this.messages[e]))))},a._onSeasonChange=function(e){const t=e.target;this.viewModel.currentSeason=t.value},a._onUTCOffsetChange=function(){var e;const t=this.viewModel.utcOffset,i=null==(e=this._timeSlider.currentItem)?void 0:e.utcOffset,o=this.gmtOffsets;if(!s.isSome(o)||i===t)return;const a=o.findIndex((({utcOffset:e})=>e===t));a>-1&&(this._timeSlider.currentIndex=a)},a._onPrimaryTickCreated=function(e,t,i){t.className+=" esri-interactive esri-widget__anchor "+f.tick+" "+f.labelledTick,i.className+=" esri-interactive esri-widget__anchor";const s=()=>{this.viewModel.timeSliderPosition=e};t.onclick=s,i.onclick=s;const o=i.innerText.match(k);o&&(i.innerHTML=`${o[1]}<br><div class="esri-label__ampm">${o[2]}</div>`)},a._onSecondaryTickCreated=function(e,t){t.className+=" esri-interactive esri-widget__anchor "+f.tick,t.onclick=()=>{this.viewModel.timeSliderPosition=e}},e._createClass(i,[{key:"gmtOffsets",get:function(){return s.applySome(this.timezoneMessages,v.getTimezoneInfos)}}]),i}(h);t.__decorate([d.property({readOnly:!0})],x.prototype,"gmtOffsets",null),t.__decorate([d.property(),m.messageBundle("esri/widgets/Daylight/t9n/Daylight")],x.prototype,"messages",void 0),t.__decorate([d.property(),m.messageBundle("esri/widgets/support/t9n/timezone")],x.prototype,"timezoneMessages",void 0),t.__decorate([d.property()],x.prototype,"headingLevel",void 0),t.__decorate([d.property()],x.prototype,"iconClass",void 0),t.__decorate([d.property({aliasOf:{source:"messages.title",overridable:!0}})],x.prototype,"label",void 0),t.__decorate([a.aliasOf("viewModel.playSpeedMultiplier")],x.prototype,"playSpeedMultiplier",void 0),t.__decorate([a.aliasOf("_timeSlider.steps")],x.prototype,"timeSliderSteps",void 0),t.__decorate([a.aliasOf("viewModel.view")],x.prototype,"view",void 0),t.__decorate([d.property({type:p})],x.prototype,"viewModel",void 0),t.__decorate([d.property()],x.prototype,"visibleElements",void 0),t.__decorate([n.cast("visibleElements")],x.prototype,"castVisibleElements",null),t.__decorate([d.property({cast:e=>"season"===e||"date"===e?e:(M.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${O}".`),O)})],x.prototype,"dateOrSeason",void 0),t.__decorate([d.property()],x.prototype,"_timeSlider",void 0),t.__decorate([d.property()],x.prototype,"_datePicker",void 0),x=t.__decorate([c.subclass("esri.widgets.Daylight")],x);return x}));
