/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/maybe","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/watchUtils","./support/widgetUtils","./support/decorators/messageBundle","../chunks/index","./Widget","./Daylight/daylightUtils","./Daylight/DaylightViewModel","./Daylight/support/SliderWithDropdown","./support/DatePicker"],(function(e,i,t,s,o,a,r,l,n,d,c,h,p,u,g,w,y,_,v,m,b){"use strict";const f={base:"esri-daylight",widgetIcon:"esri-icon-environment-settings",button:"esri-button",checkbox:"esri-daylight__checkbox",checked:"esri-icon-checkbox-checked",dayContainer:"esri-daylight__container esri-daylight__day-container",dateContainer:"esri-daylight__container esri-daylight__date-container",header:"esri-widget__heading",interactive:"esri-interactive",label:" esri-widget__anchor",labelledTick:"esri-daylight__container__labelled-tick",pause:"esri-icon-pause",play:"esri-icon-play",playPauseButton:"esri-daylight__play-pause-button",select:"esri-select",seasonPicker:"esri-daylight__season-picker",shadow:"esri-daylight__shadow-container",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",tick:"esri-daylight__container__tick",unchecked:"esri-icon-checkbox-unchecked",widget:"esri-widget",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",panelError:"esri-daylight__panel--error"},S={playButtons:!0,shadowsToggle:!0,datePicker:!0,timezone:!0},k=o.getLogger("esri.widgets.Daylight"),M="date";let O=function(i){function t(t,s){var o,a;return(a=i.call(this,t,s)||this).iconClass=f.widgetIcon,a.label=void 0,a.playSpeedMultiplier=1,a.timeSliderSteps=5,a.view=null,a.viewModel=new v,a.visibleElements={...S},a.dateOrSeason=M,a._timeSlider=new m({viewModel:a.viewModel.timeSliderViewModel,labelFormatFunction:_.formatSliderLabel,inputFormatFunction:_.formatSliderLabel,min:0,max:1439,steps:null!=(o=a.timeSliderSteps)?o:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:a._onPrimaryTickCreated.bind(e._assertThisInitialized(a))},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:a._onSecondaryTickCreated.bind(e._assertThisInitialized(a))}],items:[]}),a._datePicker=new b({viewModel:a.viewModel.datePickerViewModel,commitOnMonthChange:!0}),a}e._inheritsLoose(t,i);var o=t.prototype;return o.castVisibleElements=function(e){return{...S,...e}},o.postInitialize=function(){this.viewModel.isSupported&&this.own(p.init(this.viewModel,"datePickerViewModel",(e=>{this._datePicker.viewModel=e})),p.init(this.viewModel,"timeSliderViewModel",(e=>{this._timeSlider.viewModel=e})),p.init(this,"messages",(()=>{this._timeSlider.buttonTooltip=this.messages.chooseTimezone})),p.init(this,"visibleElements",(()=>{this._timeSlider.showDropDown=this.visibleElements.timezone})),p.init(this,"gmtOffsets",(e=>{s.isSome(e)&&(this._timeSlider.items=e)})),p.init(this,["viewModel.utcOffset","gmtOffsets"],(()=>this._onUTCOffsetChange())))},o.destroy=function(){this._datePicker.destroy(),this._timeSlider.destroy()},o.render=function(){return this.viewModel.isSupported?w.jsx("div",{class:this.classes(f.base,f.widget)},w.jsx("h3",{class:f.header},this.messages.title),this.renderTimeOptions(),this.visibleElements.datePicker?"date"===this.dateOrSeason?this.renderDateOptions():this.renderSeasonOptions():null,this.visibleElements.shadowsToggle?this.renderShadowOptions():null):w.jsx("div",{class:this.classes(f.base,f.widget)},w.jsx("div",{key:"daylight__unsupported",class:f.panelError},w.jsx("p",null,this.messages.unsupported)))},o.renderTimeOptions=function(){const e={[f.play]:!this.viewModel.dayPlaying,[f.pause]:this.viewModel.dayPlaying},i={[f.shadowOn]:this.viewModel.directShadowsEnabled,[f.shadowOff]:!this.viewModel.directShadowsEnabled},t={[f.sliderDateOn]:this.visibleElements.datePicker,[f.sliderDateOff]:!this.visibleElements.datePicker};return w.jsx("div",{class:this.classes(f.dayContainer,i,t),key:"daylight-time-options"},this._timeSlider.render(),this.visibleElements.playButtons?w.jsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleDayPlaying,"aria-label":this.messages.playDay,title:this.messages.playDay,type:"button",class:this.classes(f.button,f.playPauseButton,e)},w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},w.jsx("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)},o.renderDateOptions=function(){const e={[f.play]:!this.viewModel.yearPlaying,[f.pause]:this.viewModel.yearPlaying};return w.jsx("div",{class:f.dateContainer,key:"daylight-date-options"},this._datePicker.render(),this.visibleElements.playButtons?w.jsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleYearPlaying,"aria-label":this.messages.playYear,title:this.messages.playYear,type:"button",class:this.classes(f.button,f.playPauseButton,e)},w.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},w.jsx("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)},o.renderShadowOptions=function(){const e=`${this.id}__shadowButton`,i={[f.checked]:this.viewModel.directShadowsEnabled,[f.unchecked]:!this.viewModel.directShadowsEnabled};return w.jsx("div",{class:f.shadow,key:"daylight-shadow-options"},w.jsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,name:e,class:this.classes(f.button,f.checkbox,i),"aria-label":this.messages.directShadow,title:this.messages.directShadow,type:"button"}),w.jsx("label",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,for:e,class:this.classes(f.label,f.interactive),"aria-label":this.messages.directShadow,title:this.messages.directShadow},this.messages.directShadow))},o.renderSeasonOptions=function(){return w.jsx("select",{bind:this,onchange:this._onSeasonChange,class:this.classes(f.select,f.seasonPicker),value:this.viewModel.currentSeason,"aria-label":this.messages.season},_.ORDERED_SEASONS.map((e=>w.jsx("option",{value:e},this.messages[e]))))},o._onSeasonChange=function(e){const i=e.target;this.viewModel.currentSeason=i.value},o._onUTCOffsetChange=function(){var e;const i=this.viewModel.utcOffset,t=null==(e=this._timeSlider.currentItem)?void 0:e.abbr,o=this.gmtOffsets;if(!s.isSome(o)||t===i)return;const a=o.findIndex((({abbr:e})=>e===i));a>-1&&(this._timeSlider.currentIndex=a)},o._onPrimaryTickCreated=function(e,i,t){i.className+=" esri-interactive esri-widget__anchor "+f.tick+" "+f.labelledTick,t.className+=" esri-interactive esri-widget__anchor";const s=()=>{this.viewModel.timeSliderPosition=e};i.onclick=s,t.onclick=s;const o=t.innerText;-1!==o.indexOf(" ")&&(t.innerHTML=o.replace(/(.*) (.*)/,'$1<br><div class="esri-label__ampm">$2</div>'))},o._onSecondaryTickCreated=function(e,i){i.className+=" esri-interactive esri-widget__anchor "+f.tick,i.onclick=()=>{this.viewModel.timeSliderPosition=e}},e._createClass(t,[{key:"gmtOffsets",get:function(){return this.messages?_.getGMTOffsets(this.messages):null}}]),t}(y);return i.__decorate([a.property({readOnly:!0})],O.prototype,"gmtOffsets",null),i.__decorate([a.property(),g.messageBundle("esri/widgets/Daylight/t9n/Daylight")],O.prototype,"messages",void 0),i.__decorate([a.property()],O.prototype,"iconClass",void 0),i.__decorate([a.property({aliasOf:{source:"messages.title",overridable:!0}})],O.prototype,"label",void 0),i.__decorate([r.aliasOf("viewModel.playSpeedMultiplier")],O.prototype,"playSpeedMultiplier",void 0),i.__decorate([r.aliasOf("_timeSlider.steps")],O.prototype,"timeSliderSteps",void 0),i.__decorate([r.aliasOf("viewModel.view")],O.prototype,"view",void 0),i.__decorate([a.property({type:v})],O.prototype,"viewModel",void 0),i.__decorate([a.property()],O.prototype,"visibleElements",void 0),i.__decorate([l.cast("visibleElements")],O.prototype,"castVisibleElements",null),i.__decorate([a.property({cast:e=>"season"===e||"date"===e?e:(k.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${M}".`),M)})],O.prototype,"dateOrSeason",void 0),i.__decorate([a.property()],O.prototype,"_timeSlider",void 0),i.__decorate([a.property()],O.prototype,"_datePicker",void 0),O=i.__decorate([n.subclass("esri.widgets.Daylight")],O),O}));
