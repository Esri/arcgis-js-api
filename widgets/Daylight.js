/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/Logger","../core/maybe","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/has","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./Daylight/DaylightViewModel","./Daylight/support/daylightUtils","./Daylight/support/SliderWithDropdown","./support/DatePicker","./support/Heading","./support/timeWidgetUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(e,t,i,s,o,a,r,l,n,d,c,h,p,u,g,y,w,v,_,m){"use strict";const b={base:"esri-daylight",widgetIcon:"esri-icon-environment-settings",button:"esri-button",checkbox:"esri-daylight__checkbox",checked:"esri-icon-checkbox-checked",dayContainer:"esri-daylight__container esri-daylight__day-container",dateContainer:"esri-daylight__container esri-daylight__date-container",interactive:"esri-interactive",label:" esri-widget__anchor",labelledTick:"esri-daylight__container__labelled-tick",pause:"esri-icon-pause",play:"esri-icon-play",playPauseButton:"esri-daylight__play-pause-button",select:"esri-select",seasonPicker:"esri-daylight__season-picker",shadow:"esri-daylight__shadow-container",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",tick:"esri-daylight__container__tick",unchecked:"esri-icon-checkbox-unchecked",widget:"esri-widget",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",panelError:"esri-daylight__panel--error"},f={playButtons:!0,shadowsToggle:!0,datePicker:!0,timezone:!0},S=/(.*)\s(.*)/,k=i.getLogger("esri.widgets.Daylight"),M="date";let O=function(t){function i(i,s){var o,a;return(a=t.call(this,i,s)||this).headingLevel=3,a.iconClass=b.widgetIcon,a.label=void 0,a.playSpeedMultiplier=1,a.timeSliderSteps=5,a.view=null,a.viewModel=new h,a.visibleElements={...f},a.dateOrSeason=M,a._timeSlider=new u({viewModel:a.viewModel.timeSliderViewModel,labelFormatFunction:w.formatSliderLabel,inputFormatFunction:w.formatSliderLabel,min:0,max:1439,steps:null!=(o=a.timeSliderSteps)?o:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:a._onPrimaryTickCreated.bind(e._assertThisInitialized(a))},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:a._onSecondaryTickCreated.bind(e._assertThisInitialized(a))}],items:[]}),a._datePicker=new g({viewModel:a.viewModel.datePickerViewModel,commitOnMonthChange:!0}),a}e._inheritsLoose(i,t);var a=i.prototype;return a.castVisibleElements=function(e){return{...f,...e}},a.postInitialize=function(){this.viewModel.isSupported&&this.own(o.init(this.viewModel,"datePickerViewModel",(e=>{this._datePicker.viewModel=e})),o.init(this.viewModel,"timeSliderViewModel",(e=>{this._timeSlider.viewModel=e})),o.init(this,"messages",(()=>{this._timeSlider.buttonTooltip=this.timezoneMessages.chooseTimezone})),o.init(this,"visibleElements",(()=>{this._timeSlider.showDropDown=this.visibleElements.timezone})),o.init(this,"gmtOffsets",(e=>{s.isSome(e)&&(this._timeSlider.items=e.map((e=>({utcOffset:e.utcOffset,name:e.short,label:[e.shortWithUTC,e.long]}))))})),o.init(this,["viewModel.utcOffset","gmtOffsets"],(()=>this._onUTCOffsetChange())))},a.destroy=function(){this._datePicker.destroy(),this._timeSlider.destroy()},a.render=function(){return this.viewModel.isSupported?m.tsx("div",{class:this.classes(b.base,b.widget)},m.tsx(y.Heading,{level:this.headingLevel},this.messages.title),this.renderTimeOptions(),this.visibleElements.datePicker?"date"===this.dateOrSeason?this.renderDateOptions():this.renderSeasonOptions():null,this.visibleElements.shadowsToggle?this.renderShadowOptions():null):m.tsx("div",{class:this.classes(b.base,b.widget)},m.tsx("div",{key:"daylight__unsupported",class:b.panelError},m.tsx("p",null,this.messages.unsupported)))},a.renderTimeOptions=function(){const e={[b.play]:!this.viewModel.dayPlaying,[b.pause]:this.viewModel.dayPlaying},t={[b.shadowOn]:this.viewModel.directShadowsEnabled,[b.shadowOff]:!this.viewModel.directShadowsEnabled},i={[b.sliderDateOn]:this.visibleElements.datePicker,[b.sliderDateOff]:!this.visibleElements.datePicker};return m.tsx("div",{class:this.classes(b.dayContainer,t,i),key:"daylight-time-options"},this._timeSlider.render(),this.visibleElements.playButtons?m.tsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleDayPlaying,"aria-label":this.messages.playDay,title:this.messages.playDay,type:"button",class:this.classes(b.button,b.playPauseButton,e)},m.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},m.tsx("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)},a.renderDateOptions=function(){const e={[b.play]:!this.viewModel.yearPlaying,[b.pause]:this.viewModel.yearPlaying};return m.tsx("div",{class:b.dateContainer,key:"daylight-date-options"},this._datePicker.render(),this.visibleElements.playButtons?m.tsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleYearPlaying,"aria-label":this.messages.playYear,title:this.messages.playYear,type:"button",class:this.classes(b.button,b.playPauseButton,e)},m.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},m.tsx("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)},a.renderShadowOptions=function(){const e=`${this.id}__shadowButton`,t={[b.checked]:this.viewModel.directShadowsEnabled,[b.unchecked]:!this.viewModel.directShadowsEnabled};return m.tsx("div",{class:b.shadow,key:"daylight-shadow-options"},m.tsx("button",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,name:e,class:this.classes(b.button,b.checkbox,t),"aria-label":this.messages.directShadow,title:this.messages.directShadow,type:"button"}),m.tsx("label",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,for:e,class:this.classes(b.label,b.interactive),"aria-label":this.messages.directShadow,title:this.messages.directShadow},this.messages.directShadow))},a.renderSeasonOptions=function(){return m.tsx("select",{bind:this,onchange:this._onSeasonChange,class:this.classes(b.select,b.seasonPicker),value:this.viewModel.currentSeason,"aria-label":this.messages.season},p.ORDERED_SEASONS.map((e=>m.tsx("option",{value:e},this.messages[e]))))},a._onSeasonChange=function(e){const t=e.target;this.viewModel.currentSeason=t.value},a._onUTCOffsetChange=function(){var e;const t=this.viewModel.utcOffset,i=null==(e=this._timeSlider.currentItem)?void 0:e.utcOffset,o=this.gmtOffsets;if(!s.isSome(o)||i===t)return;const a=o.findIndex((({utcOffset:e})=>e===t));a>-1&&(this._timeSlider.currentIndex=a)},a._onPrimaryTickCreated=function(e,t,i){t.className+=" esri-interactive esri-widget__anchor "+b.tick+" "+b.labelledTick,i.className+=" esri-interactive esri-widget__anchor";const s=()=>{this.viewModel.timeSliderPosition=e};t.onclick=s,i.onclick=s;const o=i.innerText.match(S);o&&(i.innerHTML=`${o[1]}<br><div class="esri-label__ampm">${o[2]}</div>`)},a._onSecondaryTickCreated=function(e,t){t.className+=" esri-interactive esri-widget__anchor "+b.tick,t.onclick=()=>{this.viewModel.timeSliderPosition=e}},e._createClass(i,[{key:"gmtOffsets",get:function(){return s.applySome(this.timezoneMessages,w.getTimezoneInfos)}}]),i}(c);return t.__decorate([n.property({readOnly:!0})],O.prototype,"gmtOffsets",null),t.__decorate([n.property(),_.messageBundle("esri/widgets/Daylight/t9n/Daylight")],O.prototype,"messages",void 0),t.__decorate([n.property(),_.messageBundle("esri/widgets/support/t9n/timezone")],O.prototype,"timezoneMessages",void 0),t.__decorate([n.property()],O.prototype,"headingLevel",void 0),t.__decorate([n.property()],O.prototype,"iconClass",void 0),t.__decorate([n.property({aliasOf:{source:"messages.title",overridable:!0}})],O.prototype,"label",void 0),t.__decorate([a.aliasOf("viewModel.playSpeedMultiplier")],O.prototype,"playSpeedMultiplier",void 0),t.__decorate([a.aliasOf("_timeSlider.steps")],O.prototype,"timeSliderSteps",void 0),t.__decorate([a.aliasOf("viewModel.view")],O.prototype,"view",void 0),t.__decorate([n.property({type:h})],O.prototype,"viewModel",void 0),t.__decorate([n.property()],O.prototype,"visibleElements",void 0),t.__decorate([l.cast("visibleElements")],O.prototype,"castVisibleElements",null),t.__decorate([n.property({cast:e=>"season"===e||"date"===e?e:(k.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${M}".`),M)})],O.prototype,"dateOrSeason",void 0),t.__decorate([n.property()],O.prototype,"_timeSlider",void 0),t.__decorate([n.property()],O.prototype,"_datePicker",void 0),O=t.__decorate([d.subclass("esri.widgets.Daylight")],O),O}));
