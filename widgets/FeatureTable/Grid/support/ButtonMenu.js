/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/events","../../../../core/HandleOwner","../../../../core/maybe","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/ensureType","../../../../core/arrayUtils","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./ButtonMenuViewModel","../../../support/Popover","../../../support/widgetUtils","../../../support/jsxFactory"],(function(e,t,n,o,i,s,r,a,d,l,c,u,p,h,_){"use strict";const m="esri-button-menu",b={base:m,content:`${m}__content`,contentWrapper:`${m}__content-wrapper`,itemWrapper:`${m}__item-wrapper`,label:`${m}__label`,icon:`${m}__icon`,item:`${m}__item`,itemLabel:`${m}__item-label`,itemLabelContent:`${m}__item-label-content`,selectableMenuItem:`${m}__item--selectable`,selectedMenuItem:`${m}__item--selected`,checkbox:`${m}__checkbox`,embeddedContentWrapper:`${m}__embedded-content-wrapper`,button:`${m}__button`,buttonSelected:`${m}__button--selected`,defaultIconClass:"esri-icon-menu",widget:"esri-widget"};let f=function(t){function o(n,o){var i;return(i=t.call(this,n,o)||this)._menuContentNode=null,i._popover=null,i._rootNode=null,i.disabled=!1,i.iconClass="",i.viewModel=new u,i._handleOutsideClick=i._handleOutsideClick.bind(e._assertThisInitialized(i)),i}e._inheritsLoose(o,t);var r=o.prototype;return r.postInitialize=function(){this._popover=new p({owner:this,open:!!this.open,placement:h.isRTL(this.container)?"bottom-start":"bottom-end",renderContentFunction:this.renderMenuContent,anchorElement:this._rootNode}),this.handles.add(s.watch((()=>this.open),(e=>this._popover?.set("open",e)))),document.addEventListener("click",this._handleOutsideClick)},r.destroy=function(){this._popover?.destroy(),this._popover=null,document.removeEventListener("click",this._handleOutsideClick)},r._handleOutsideClick=function(e){if(!this.open||!this._rootNode||!this._menuContentNode)return;const t=e.target;this._menuContentNode?.contains(t)||this._rootNode?.contains(t)||(this.open=!1)},r.render=function(){return _.tsx("div",{afterCreate:this._afterRootNodeCreate,bind:this,"data-node-ref":"_rootNode",class:this.classes(b.base,b.widget),key:"menu"},this.renderMenuButton())},r.renderMenuButton=function(){const{iconClass:e,id:t,label:n,open:o}=this,i=this.classes(b.button,e??b.defaultIconClass,o?b.buttonSelected:null);return _.tsx("button",{"aria-pressed":o.toString(),"aria-controls":`${t}-menu`,"aria-expanded":o.toString(),"aria-haspopup":"true","aria-label":n,bind:this,class:i,disabled:this.disabled,id:`${t}-button`,title:n??"",selected:o,onclick:this._toggleOpen,tabindex:this.disabled?-1:0,type:"button"})},r.renderMenuContent=function(){const{id:e,open:t}=this;return _.tsx("div",{afterCreate:this._afterMenuContentNodeCreate,bind:this,class:b.content,"data-node-ref":"_menuContentNode",key:"esri-button-menu-content",hidden:!t},_.tsx("ul",{"aria-labelledby":`${e}-button`,bind:this,class:b.itemWrapper,id:`${e}-menu`,role:"menu"},this.items?.length&&this.renderItems()))},r.renderItems=function(){return this.items?.map(((e,t)=>this.renderItem(e,t)))},r.renderItem=function(e,t,n){const o=i.isSome(n)?`${this.id}-menu-item-${t}-${n}`:`${this.id}-menu-item-${t}`,s=`${o}-label`,r=this.classes(b.item,e.selectionEnabled?b.selectableMenuItem:null,e.selectionEnabled&&e.selected?b.selectedMenuItem:null);return _.tsx("li",{afterCreate:this._afterMenuItemCreate,bind:this,class:r,"data-item-index":t,"data-item-subIndex":n,for:o,key:o,onkeydown:t=>this._handleMenuItemKeydown(t,e),onclick:t=>this._handleMenuItemInteraction(t,e),role:"menuitem",tabindex:this.disabled?-1:0},_.tsx("input",{disabled:!0,checked:e.selected,class:b.checkbox,id:o,name:o,tabindex:"-1",type:"checkbox"}),_.tsx("label",{bind:this,class:this.classes(b.button,b.itemLabel),for:o,id:s},_.tsx("span",{class:this.classes(b.icon,e.iconClass),"aria-hidden":"true"}),_.tsx("span",{class:b.itemLabelContent},h.renderingSanitizer.sanitize(e.label))),_.tsx("ul",{"aria-labelledby":s,class:b.embeddedContentWrapper,id:`${this.id}-submenu`,role:"menu"},e?.items?.map(((e,n)=>this.renderItem(e,t,n)))))},r._afterRootNodeCreate=function(e){this._rootNode=e,this._popover?.set("anchorElement",(()=>e))},r._handleMenuItemInteraction=function(e,t){t.selected=!t.selected,t.open=!(!t.selected||!t.items),t.autoCloseMenu&&this.set("open",!1),t.clickFunction&&t.clickFunction({event:e,item:t}),e.stopPropagation()},r._handleMenuItemKeydown=function(e,t){const o=n.eventKey(e);h.isActivationKey(o)&&this._handleMenuItemInteraction(e,t),"Escape"===o&&(this.open=!1,e.preventDefault(),e.stopPropagation())},r._afterMenuContentNodeCreate=function(e){this._menuContentNode=e,e.focus()},r._toggleOpen=function(){this.open=!this.open},r._afterMenuItemCreate=function(e){0===e["data-item-index"]&&e.focus()},e._createClass(o,[{key:"items",get:function(){return this.viewModel.items},set:function(e){this.viewModel.items=e}},{key:"open",get:function(){return this.viewModel.open},set:function(e){this.viewModel.open=e}}]),o}(o.HandleOwnerMixin(c));t.__decorate([r.property()],f.prototype,"disabled",void 0),t.__decorate([r.property()],f.prototype,"iconClass",void 0),t.__decorate([r.property()],f.prototype,"items",null),t.__decorate([r.property()],f.prototype,"open",null),t.__decorate([r.property()],f.prototype,"viewModel",void 0),f=t.__decorate([l.subclass("esri.widgets.FeatureTable.Grid.support.ButtonMenu")],f);return f}));
