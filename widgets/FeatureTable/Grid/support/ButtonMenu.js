/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/events","../../../../core/HandleOwner","../../../../core/maybe","../../../../core/watchUtils","../../../../core/accessorSupport/decorators/aliasOf","../../../../core/has","../../../../core/accessorSupport/ensureType","../../../../core/Logger","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./ButtonMenuViewModel","../../../support/Popover","../../../support/widgetUtils","../../../support/jsxFactory"],(function(e,t,n,o,i,s,r,a,l,u,d,c,p,m,h,b,_){"use strict";const f={base:"esri-button-menu",content:"esri-button-menu__content",contentWrapper:"esri-button-menu__content-wrapper",itemWrapper:"esri-button-menu__item-wrapper",label:"esri-button-menu__label",icon:"esri-button-menu__icon",item:"esri-button-menu__item",itemLabel:"esri-button-menu__item-label",itemLabelContent:"esri-button-menu__item-label-content",selectableMenuItem:"esri-button-menu__item--selectable",selectedMenuItem:"esri-button-menu__item--selected",checkbox:"esri-button-menu__checkbox",embeddedContentWrapper:"esri-button-menu__embedded-content-wrapper",button:"esri-button-menu__button",buttonSelected:"esri-button-menu__button--selected",defaultIconClass:"esri-icon-menu",widget:"esri-widget"};let v=function(t){function o(n,o){var i;return(i=t.call(this,n,o)||this)._menuContentNode=null,i._popover=null,i._rootNode=null,i.iconClass=null,i.items=null,i.label=null,i.open=!1,i.viewModel=new m,i._handleOutsideClick=i._handleOutsideClick.bind(e._assertThisInitialized(i)),i}e._inheritsLoose(o,t);var r=o.prototype;return r.postInitialize=function(){this._popover=new h({owner:this,open:!!this.open,placement:b.isRTL()?"bottom-start":"bottom-end",renderContentFunction:this.renderMenuContent,anchorElement:this._rootNode}),this.handles.add([s.watch(this,"open",(e=>this._popover.set("open",e)))]),document.addEventListener("click",this._handleOutsideClick)},r.destroy=function(){var e;null==(e=this._popover)||e.destroy(),this._popover=null,document.removeEventListener("click",this._handleOutsideClick)},r._handleOutsideClick=function(e){var t,n;if(!this.open||!this._rootNode||!this._menuContentNode)return;const o=e.target;null!=(t=this._menuContentNode)&&t.contains(o)||null!=(n=this._rootNode)&&n.contains(o)||(this.open=!1)},r.render=function(){return _.tsx("div",{afterCreate:this._afterRootNodeCreate,bind:this,"data-node-ref":"_rootNode",class:this.classes(f.base,f.widget),key:"menu"},this.renderMenuButton())},r.renderMenuButton=function(){const{iconClass:e,id:t,label:n,open:o}=this,i=this.classes([f.button,e||f.defaultIconClass,o?f.buttonSelected:null]);return _.tsx("button",{"aria-pressed":o.toString(),"aria-controls":`${t}-menu`,"aria-expanded":o.toString(),"aria-haspopup":"true","aria-label":n,bind:this,class:i,id:`${t}-button`,title:n,selected:o,onclick:this._toggleOpen,tabindex:"0",type:"button"})},r.renderMenuContent=function(){var e;const{id:t,open:n}=this;return _.tsx("div",{afterCreate:this._afterMenuContentNodeCreate,bind:this,class:f.content,"data-node-ref":"_menuContentNode",key:"esri-button-menu-content",hidden:!n},_.tsx("ul",{"aria-labelledby":`${t}-button`,bind:this,class:f.itemWrapper,id:`${t}-menu`,role:"menu"},(null==(e=this.items)?void 0:e.length)&&this.renderItems()))},r.renderItems=function(){var e;return null==(e=this.items)?void 0:e.map(((e,t)=>this.renderItem(e,t)))},r.renderItem=function(e,t,n){var o;const s=i.isSome(n)?`${this.id}-menu-item-${t}-${n}`:`${this.id}-menu-item-${t}`,r=`${s}-label`,a=this.classes(f.item,e.selectionEnabled?f.selectableMenuItem:null,e.selectionEnabled&&e.selected?f.selectedMenuItem:null);return _.tsx("li",{afterCreate:this._afterMenuItemCreate,bind:this,class:a,"data-item-index":t,"data-item-subIndex":n,for:s,key:s,onkeydown:t=>this._handleMenuItemKeydown(t,e),onclick:t=>this._handleMenuItemInteraction(t,e),role:"menuitem",tabindex:"0"},_.tsx("input",{disabled:!0,checked:e.selected,class:f.checkbox,id:s,name:s,tabindex:"-1",type:"checkbox"}),_.tsx("label",{bind:this,class:this.classes(f.button,f.itemLabel),for:s,id:r},_.tsx("span",{class:this.classes(f.icon,e.iconClass),"aria-hidden":"true"}),_.tsx("span",{class:f.itemLabelContent},e.label)),_.tsx("ul",{"aria-labelledby":r,class:f.embeddedContentWrapper,id:`${this.id}-submenu`,role:"menu"},null==e||null==(o=e.items)?void 0:o.map(((e,n)=>this.renderItem(e,t,n)))))},r._afterRootNodeCreate=function(e){var t;this._rootNode=e,null==(t=this._popover)||t.set("anchorElement",(()=>e))},r._handleMenuItemInteraction=function(e,t){t.selected=!t.selected,t.open=!(!t.selected||!t.items),t.autoCloseMenu&&this.set("open",!1),t.clickFunction&&t.clickFunction({event:e,item:t}),e.stopPropagation()},r._handleMenuItemKeydown=function(e,t){const o=n.eventKey(e);b.isActivationKey(o)&&this._handleMenuItemInteraction(e,t),"Escape"===o&&(this.open=!1,e.preventDefault(),e.stopPropagation())},r._afterMenuContentNodeCreate=function(e){this._menuContentNode=e,e.focus()},r._toggleOpen=function(){this.open=!this.open},r._afterMenuItemCreate=function(e){0===e["data-item-index"]&&e.focus()},o}(o.HandleOwnerMixin(p));return t.__decorate([d.property()],v.prototype,"iconClass",void 0),t.__decorate([r.aliasOf("viewModel.items")],v.prototype,"items",void 0),t.__decorate([d.property()],v.prototype,"label",void 0),t.__decorate([r.aliasOf("viewModel.open")],v.prototype,"open",void 0),t.__decorate([d.property()],v.prototype,"viewModel",void 0),v=t.__decorate([c.subclass("esri.widgets.FeatureTable.Grid.support.ButtonMenu")],v),v}));
