/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/has","../../../../core/maybe","../../../../core/Logger","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/decorators/aliasOf","../../../../core/accessorSupport/decorators/subclass","../../../../core/urlUtils","../../../../core/uuid","../../../../portal/support/resourceExtension","../../../../core/events","../../../../core/watchUtils","../../../../core/HandleOwner","../../../support/widgetUtils","../../../../chunks/index","../../../Widget","./ButtonMenuViewModel","../../../support/Popover"],(function(e,t,n,o,i,s,r,a,l,u,d,c,p,m,h,b,_,f,v,C){"use strict";const M={base:"esri-button-menu",content:"esri-button-menu__content",contentWrapper:"esri-button-menu__content-wrapper",itemWrapper:"esri-button-menu__item-wrapper",label:"esri-button-menu__label",icon:"esri-button-menu__icon",item:"esri-button-menu__item",itemLabel:"esri-button-menu__item-label",itemLabelContent:"esri-button-menu__item-label-content",selectableMenuItem:"esri-button-menu__item--selectable",selectedMenuItem:"esri-button-menu__item--selected",checkbox:"esri-button-menu__checkbox",embeddedContentWrapper:"esri-button-menu__embedded-content-wrapper",button:"esri-button-menu__button",buttonSelected:"esri-button-menu__button--selected",defaultIconClass:"esri-icon-menu",widget:"esri-widget"};let y=function(t){function n(n,o){var i;return(i=t.call(this,n,o)||this)._menuContentNode=null,i._popover=null,i._rootNode=null,i.iconClass=null,i.items=null,i.label=null,i.open=!1,i.viewModel=new v,i._handleOutsideClick=i._handleOutsideClick.bind(e._assertThisInitialized(i)),i}e._inheritsLoose(n,t);var i=n.prototype;return i.postInitialize=function(){this._popover=new C({owner:this,open:!!this.open,placement:b.isRTL()?"bottom-start":"bottom-end",renderContentFunction:this.renderMenuContent,anchorElement:this._rootNode}),this.handles.add([m.watch(this,"open",(e=>this._popover.set("open",e)))]),document.addEventListener("click",this._handleOutsideClick)},i.destroy=function(){var e;null==(e=this._popover)||e.destroy(),this._popover=null,document.removeEventListener("click",this._handleOutsideClick)},i._handleOutsideClick=function(e){var t,n;if(!this.open||!this._rootNode||!this._menuContentNode)return;const o=e.target;null!=(t=this._menuContentNode)&&t.contains(o)||null!=(n=this._rootNode)&&n.contains(o)||(this.open=!1)},i.render=function(){return _.jsx("div",{afterCreate:this._afterRootNodeCreate,bind:this,"data-node-ref":"_rootNode",class:this.classes(M.base,M.widget),key:"menu"},this.renderMenuButton())},i.renderMenuButton=function(){const{iconClass:e,id:t,label:n,open:o}=this,i=this.classes([M.button,e||M.defaultIconClass,o?M.buttonSelected:null]);return _.jsx("button",{"aria-pressed":o.toString(),"aria-controls":`${t}-menu`,"aria-expanded":o.toString(),"aria-haspopup":"true","aria-label":n,bind:this,class:i,id:`${t}-button`,title:n,selected:o,onclick:this._toggleOpen,tabindex:"0",type:"button"})},i.renderMenuContent=function(){var e;const{id:t,open:n}=this;return _.jsx("div",{afterCreate:this._afterMenuContentNodeCreate,bind:this,class:M.content,"data-node-ref":"_menuContentNode",key:"esri-button-menu-content",hidden:!n},_.jsx("ul",{"aria-labelledby":`${t}-button`,bind:this,class:M.itemWrapper,id:`${t}-menu`,role:"menu"},(null==(e=this.items)?void 0:e.length)&&this.renderItems()))},i.renderItems=function(){var e;return null==(e=this.items)?void 0:e.map(((e,t)=>this.renderItem(e,t)))},i.renderItem=function(e,t,n){var i;const s=o.isSome(n)?`${this.id}-menu-item-${t}-${n}`:`${this.id}-menu-item-${t}`,r=`${s}-label`,a=this.classes(M.item,e.selectionEnabled?M.selectableMenuItem:null,e.selectionEnabled&&e.selected?M.selectedMenuItem:null);return _.jsx("li",{afterCreate:this._afterMenuItemCreate,bind:this,class:a,"data-item-index":t,"data-item-subIndex":n,for:s,key:s,onkeydown:t=>this._handleMenuItemKeydown(t,e),onclick:t=>this._handleMenuItemInteraction(t,e),role:"menuitem",tabindex:"0"},_.jsx("input",{disabled:!0,checked:e.selected,class:M.checkbox,id:s,name:s,tabindex:"-1",type:"checkbox"}),_.jsx("label",{bind:this,class:this.classes(M.button,M.itemLabel),for:s,id:r},_.jsx("span",{class:this.classes(M.icon,e.iconClass),"aria-hidden":"true"}),_.jsx("span",{class:M.itemLabelContent},e.label)),_.jsx("ul",{"aria-labelledby":r,class:M.embeddedContentWrapper,id:`${this.id}-submenu`,role:"menu"},null==e||null==(i=e.items)?void 0:i.map(((e,n)=>this.renderItem(e,t,n)))))},i._afterRootNodeCreate=function(e){var t;this._rootNode=e,null==(t=this._popover)||t.set("anchorElement",(()=>e))},i._handleMenuItemInteraction=function(e,t){t.selected=!t.selected,t.open=!(!t.selected||!t.items),t.autoCloseMenu&&this.set("open",!1),t.clickFunction&&t.clickFunction({event:e,item:t}),e.stopPropagation()},i._handleMenuItemKeydown=function(e,t){const n=p.eventKey(e);"Enter"!==n&&" "!==n||this._handleMenuItemInteraction(e,t),"Escape"===n&&(this.open=!1,e.preventDefault(),e.stopPropagation())},i._afterMenuContentNodeCreate=function(e){this._menuContentNode=e,e.focus()},i._toggleOpen=function(){this.open=!this.open},i._afterMenuItemCreate=function(e){0===e["data-item-index"]&&e.focus()},n}(h.HandleOwnerMixin(f));return t.__decorate([r.property()],y.prototype,"iconClass",void 0),t.__decorate([a.aliasOf("viewModel.items")],y.prototype,"items",void 0),t.__decorate([r.property()],y.prototype,"label",void 0),t.__decorate([a.aliasOf("viewModel.open")],y.prototype,"open",void 0),t.__decorate([r.property()],y.prototype,"viewModel",void 0),y=t.__decorate([l.subclass("esri.widgets.FeatureTable.Grid.support.ButtonMenu")],y),y}));
