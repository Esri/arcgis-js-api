/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/events","../../../../core/HandleOwner","../../../../core/maybe","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/arrayUtils","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./ButtonMenuViewModel","../../../support/Popover","../../../support/widgetUtils","../../../support/jsxFactory"],(function(e,t,n,o,i,s,r,a,d,l,u,c,p,m,h){"use strict";const b={base:"esri-button-menu",content:"esri-button-menu__content",contentWrapper:"esri-button-menu__content-wrapper",itemWrapper:"esri-button-menu__item-wrapper",label:"esri-button-menu__label",icon:"esri-button-menu__icon",item:"esri-button-menu__item",itemLabel:"esri-button-menu__item-label",itemLabelContent:"esri-button-menu__item-label-content",selectableMenuItem:"esri-button-menu__item--selectable",selectedMenuItem:"esri-button-menu__item--selected",checkbox:"esri-button-menu__checkbox",embeddedContentWrapper:"esri-button-menu__embedded-content-wrapper",button:"esri-button-menu__button",buttonSelected:"esri-button-menu__button--selected",defaultIconClass:"esri-icon-menu",widget:"esri-widget"};let _=function(t){function o(n,o){var i;return(i=t.call(this,n,o)||this)._menuContentNode=null,i._popover=null,i._rootNode=null,i.disabled=!1,i.iconClass="",i.viewModel=new c,i._handleOutsideClick=i._handleOutsideClick.bind(e._assertThisInitialized(i)),i}e._inheritsLoose(o,t);var r=o.prototype;return r.postInitialize=function(){this._popover=new p({owner:this,open:!!this.open,placement:m.isRTL(this.container)?"bottom-start":"bottom-end",renderContentFunction:this.renderMenuContent,anchorElement:this._rootNode}),this.handles.add(s.watch((()=>this.open),(e=>this._popover?.set("open",e)))),document.addEventListener("click",this._handleOutsideClick)},r.destroy=function(){this._popover?.destroy(),this._popover=null,document.removeEventListener("click",this._handleOutsideClick)},r._handleOutsideClick=function(e){if(!this.open||!this._rootNode||!this._menuContentNode)return;const t=e.target;this._menuContentNode?.contains(t)||this._rootNode?.contains(t)||(this.open=!1)},r.render=function(){return h.tsx("div",{afterCreate:this._afterRootNodeCreate,bind:this,"data-node-ref":"_rootNode",class:this.classes(b.base,b.widget),key:"menu"},this.renderMenuButton())},r.renderMenuButton=function(){const{iconClass:e,id:t,label:n,open:o}=this,i=this.classes(b.button,e??b.defaultIconClass,o?b.buttonSelected:null);return h.tsx("button",{"aria-pressed":o.toString(),"aria-controls":`${t}-menu`,"aria-expanded":o.toString(),"aria-haspopup":"true","aria-label":n,bind:this,class:i,disabled:this.disabled,id:`${t}-button`,title:n??"",selected:o,onclick:this._toggleOpen,tabindex:this.disabled?-1:0,type:"button"})},r.renderMenuContent=function(){const{id:e,open:t}=this;return h.tsx("div",{afterCreate:this._afterMenuContentNodeCreate,bind:this,class:b.content,"data-node-ref":"_menuContentNode",key:"esri-button-menu-content",hidden:!t},h.tsx("ul",{"aria-labelledby":`${e}-button`,bind:this,class:b.itemWrapper,id:`${e}-menu`,role:"menu"},this.items?.length&&this.renderItems()))},r.renderItems=function(){return this.items?.map(((e,t)=>this.renderItem(e,t)))},r.renderItem=function(e,t,n){const o=i.isSome(n)?`${this.id}-menu-item-${t}-${n}`:`${this.id}-menu-item-${t}`,s=`${o}-label`,r=this.classes(b.item,e.selectionEnabled?b.selectableMenuItem:null,e.selectionEnabled&&e.selected?b.selectedMenuItem:null);return h.tsx("li",{afterCreate:this._afterMenuItemCreate,bind:this,class:r,"data-item-index":t,"data-item-subIndex":n,for:o,key:o,onkeydown:t=>this._handleMenuItemKeydown(t,e),onclick:t=>this._handleMenuItemInteraction(t,e),role:"menuitem",tabindex:this.disabled?-1:0},h.tsx("input",{disabled:!0,checked:e.selected,class:b.checkbox,id:o,name:o,tabindex:"-1",type:"checkbox"}),h.tsx("label",{bind:this,class:this.classes(b.button,b.itemLabel),for:o,id:s},h.tsx("span",{class:this.classes(b.icon,e.iconClass),"aria-hidden":"true"}),h.tsx("span",{class:b.itemLabelContent},e.label)),h.tsx("ul",{"aria-labelledby":s,class:b.embeddedContentWrapper,id:`${this.id}-submenu`,role:"menu"},e?.items?.map(((e,n)=>this.renderItem(e,t,n)))))},r._afterRootNodeCreate=function(e){this._rootNode=e,this._popover?.set("anchorElement",(()=>e))},r._handleMenuItemInteraction=function(e,t){t.selected=!t.selected,t.open=!(!t.selected||!t.items),t.autoCloseMenu&&this.set("open",!1),t.clickFunction&&t.clickFunction({event:e,item:t}),e.stopPropagation()},r._handleMenuItemKeydown=function(e,t){const o=n.eventKey(e);m.isActivationKey(o)&&this._handleMenuItemInteraction(e,t),"Escape"===o&&(this.open=!1,e.preventDefault(),e.stopPropagation())},r._afterMenuContentNodeCreate=function(e){this._menuContentNode=e,e.focus()},r._toggleOpen=function(){this.open=!this.open},r._afterMenuItemCreate=function(e){0===e["data-item-index"]&&e.focus()},e._createClass(o,[{key:"items",get:function(){return this.viewModel.items},set:function(e){this.viewModel.items=e}},{key:"open",get:function(){return this.viewModel.open},set:function(e){this.viewModel.open=e}}]),o}(o.HandleOwnerMixin(u));t.__decorate([r.property()],_.prototype,"disabled",void 0),t.__decorate([r.property()],_.prototype,"iconClass",void 0),t.__decorate([r.property()],_.prototype,"items",null),t.__decorate([r.property()],_.prototype,"open",null),t.__decorate([r.property()],_.prototype,"viewModel",void 0),_=t.__decorate([l.subclass("esri.widgets.FeatureTable.Grid.support.ButtonMenu")],_);return _}));
