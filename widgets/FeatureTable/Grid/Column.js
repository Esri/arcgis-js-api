/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Evented","../../../core/HandleOwner","../../../core/maybe","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/arrayUtils","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","./support/ButtonMenu","../../support/widgetUtils"],(function(e,t,r,o,n,i,s,a,d,c,l,p){"use strict";const u={sortAscIcon:"esri-icon-arrow-up",sortDescIcon:"esri-icon-arrow-down",menuContainer:"esri-column__menu-container",menuIcon:"esri-icon-handle-horizontal",sorter:"esri-column__sorter",headerContent:"esri-column__header-content",headerLabel:"esri-column__header-label"},h={keyboardSort1:"Enter",keyboardSort2:"Spacebar"};let m=function(t){function r(r){var o;return(o=t.call(this,r)||this)._menuContainer=document.createElement("div"),o.activeRowIndex=null,o.autoWidth=!1,o.cellValueFormatFunction=({value:e})=>p.renderingSanitizer.sanitize(e),o.flexGrow=1,o.footerRenderFunction=null,o.frozen=!1,o.grid=null,o.header=null,o.headerRenderFunction=t=>{const{root:r}=t,{headerMenuEnabled:n,sortable:i}=e._assertThisInitialized(o);if(o.removeCellContent(r),r.classList.add(u.headerContent),i)o.headerSorterRenderFunction(t);else{const{header:t,path:n}=e._assertThisInitialized(o),i=document.createElement("div");i.classList.add(u.headerLabel),i.innerHTML=t??n??"",r.appendChild(i)}n&&o.headerMenuRenderFunction(t)},o.headerMenuRenderFunction=({root:e})=>{o.menu?.items?.length&&e.appendChild(o._menuContainer)},o.headerSorterRenderFunction=({root:t})=>{const{header:r,path:n,sortElement:i}=e._assertThisInitialized(o),s=r??n??"";if(!i)return void(t.innerHTML=s);i.innerHTML!==s&&i.setAttribute("innerHTML",s),t.appendChild(i);const a=o.grid?.getSlotElementByName(t.slot),d=a?.parentElement;d&&!d.onkeydown&&(d.onkeydown=({key:e})=>{e!==h.keyboardSort1&&e!==h.keyboardSort2||i.click()})},o.hidden=!1,o.headerMenuEnabled=!0,o.initialSortPriority=null,o.menu=null,o.menuConfig=null,o.messages=null,o.messagesCommon=null,o.messagesURIUtils=null,o.path=null,o.renderFunction=({root:e,column:t,rowData:r})=>{const n=o.getCellValue(t,r),i=o.cellValueFormatFunction({column:t,rowData:r,value:n});e.innerHTML!==i&&(e.innerHTML=i)},o.resizable=!0,o.sortable=!0,o.textAlign="start",o.width=200,o}e._inheritsLoose(r,t);var o=r.prototype;return o.initialize=function(){const{messages:e,path:t}=this;this._set("sortElement",this.createSortElement()),this.sortElement.setAttribute("path",t??""),this._menuContainer.classList.add(u.menuContainer),this.menu=new l({label:e?.options,iconClass:u.menuIcon,...this.menuConfig}),this.menu.container=this._menuContainer,this.menu.set("items",this.getMenuItems()),this.handles.add(i.watch((()=>this.hidden),(()=>this.menu?.set("open",!1))),i.watch((()=>this.path),(e=>{this.sortElement&&this.sortElement.path!==e&&this.sortElement.setAttribute("path",e??"")})))},o.destroy=function(){this.menu?.destroy()},o.getMenuItems=function(){const{menuConfig:e,sortable:t}=this,r=e?.items,o=this.getSortMenuItems(),n=[];return t&&n.push(...o),r?.length&&n.push(...r),n.length?n:null},o.getSortMenuItems=function(){const{messages:e}=this;return[{selected:"asc"===this.direction,iconClass:u.sortAscIcon,label:e?.sortAsc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","asc"!==this.direction?"asc":null)},{selected:"desc"===this.direction,iconClass:u.sortDescIcon,label:e?.sortDesc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","desc"!==this.direction?"desc":null)}]},o.getCellValue=function(e,t){return t?.item[e?.path]??""},o.createSortElement=function(){const{direction:e,header:t,path:r,initialSortPriority:o}=this,i=t??r??"",s=document.createElement("vaadin-grid-sorter");return s.classList.add(u.sorter),s.setAttribute("path",r??""),s.setAttribute("title",i),s.innerHTML=i,e&&s.setAttribute("direction",e),n.isSome(o)&&(s._initialOrder=o),s.addEventListener("direction-changed",(()=>{this.direction!==s.direction&&this._set("direction",s.direction)})),s},o.removeCellContent=function(e){if(e)for(;e.firstChild;)try{e.removeChild(e.firstChild)}catch(t){}},e._createClass(r,[{key:"direction",get:function(){return this._get("direction")||null},set:function(e){this.sortable&&(this.sortElement&&(e?this.sortElement.direction!==e&&this.sortElement.setAttribute("direction",e):this.sortElement.removeAttribute("direction")),this._set("direction",e))}}]),r}(o.HandleOwnerMixin(r.EventedAccessor));t.__decorate([s.property()],m.prototype,"activeRowIndex",void 0),t.__decorate([s.property()],m.prototype,"autoWidth",void 0),t.__decorate([s.property()],m.prototype,"cellValueFormatFunction",void 0),t.__decorate([s.property()],m.prototype,"direction",null),t.__decorate([s.property()],m.prototype,"flexGrow",void 0),t.__decorate([s.property()],m.prototype,"footerRenderFunction",void 0),t.__decorate([s.property()],m.prototype,"frozen",void 0),t.__decorate([s.property()],m.prototype,"grid",void 0),t.__decorate([s.property()],m.prototype,"header",void 0),t.__decorate([s.property()],m.prototype,"headerRenderFunction",void 0),t.__decorate([s.property()],m.prototype,"headerMenuRenderFunction",void 0),t.__decorate([s.property()],m.prototype,"headerSorterRenderFunction",void 0),t.__decorate([s.property()],m.prototype,"hidden",void 0),t.__decorate([s.property()],m.prototype,"headerMenuEnabled",void 0),t.__decorate([s.property({constructOnly:!0})],m.prototype,"initialSortPriority",void 0),t.__decorate([s.property()],m.prototype,"menu",void 0),t.__decorate([s.property()],m.prototype,"menuConfig",void 0),t.__decorate([s.property()],m.prototype,"messages",void 0),t.__decorate([s.property()],m.prototype,"messagesCommon",void 0),t.__decorate([s.property()],m.prototype,"messagesURIUtils",void 0),t.__decorate([s.property()],m.prototype,"path",void 0),t.__decorate([s.property()],m.prototype,"renderFunction",void 0),t.__decorate([s.property()],m.prototype,"resizable",void 0),t.__decorate([s.property()],m.prototype,"sortable",void 0),t.__decorate([s.property({readOnly:!0})],m.prototype,"sortElement",void 0),t.__decorate([s.property()],m.prototype,"textAlign",void 0),t.__decorate([s.property()],m.prototype,"width",void 0),m=t.__decorate([c.subclass("esri.widgets.FeatureTable.Grid.Column")],m);return m}));
