/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Collection","../../core/Evented","../../core/HandleOwner","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/arrayUtils","../../core/accessorSupport/decorators/subclass","../LayerList/ListItem"],(function(e,t,s,i,a,r,n,c,o,l,m){"use strict";const h={view:"view",basemap:"basemap",baseLayers:"base-layers",referenceLayers:"reference-layers",baseLayersListMode:"reference-layers-list-mode",referenceLayersListMode:"base-layers-list-mode",baseLayerViews:"base-layer-views",referenceLayerViews:"reference-layer-views",children:"children"},d=s.ofType(m);let p=function(t){function s(s){var i;return(i=t.call(this,s)||this).baseItems=new d,i.baseListItemCreatedFunction=null,i.checkPublishStatusEnabled=!1,i.referenceListItemCreatedFunction=null,i.referenceItems=new d,i.view=null,i._compileBaseList=i._compileBaseList.bind(e._assertThisInitialized(i)),i._compileReferenceList=i._compileReferenceList.bind(e._assertThisInitialized(i)),i}e._inheritsLoose(s,t);var i=s.prototype;return i.initialize=function(){this.handles.add([r.watch((()=>[this.view?.map?.basemap,this.view,this.view?.ready,this.view?.basemapView]),(()=>this._watchBasemapLayers()),r.initial),r.watch((()=>[this.baseListItemCreatedFunction,this.checkPublishStatusEnabled]),(()=>this._baseListItemCreatedFunctionChanged())),r.watch((()=>[this.referenceListItemCreatedFunction,this.checkPublishStatusEnabled]),(()=>this._referenceListItemCreatedFunctionChanged()))],h.view)},i.destroy=function(){this.view=null,this.baseItems.removeAll(),this.referenceItems.removeAll()},i.triggerAction=function(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})},i.transferListItem=function({listItem:e,from:t,to:s,newIndex:i}){const{referenceItems:a,baseItems:r}=this,{layer:n}=e,c=this.get("view.map.basemap.baseLayers"),o=this.get("view.map.basemap.referenceLayers");if(!c||!o||t===s)return;const l="reference"===s?a:r,m="reference"===t?o:c,h="reference"===s?o:c;("reference"===t?a:r).remove(e),m.remove(n),l.add(e,i),h.add(n,i)},i._createItemChangeHandles=function({items:e,key:t,callback:s}){const{handles:i}=this;i.remove(t),s(),e&&i.add(e.on("change",(()=>s())),t)},i._createListItem=function({layer:e,type:t}){const{view:s,baseListItemCreatedFunction:i,referenceListItemCreatedFunction:a,checkPublishStatusEnabled:r}=this;return new m({layer:e,checkPublishStatusEnabled:r,listItemCreatedFunction:"base"===t?i:a,view:s})},i._watchLayersListMode=function({layers:e,key:t,callback:s}){const{handles:i}=this;i.remove(t),e&&e.forEach((e=>{i.add(r.watch((()=>e.listMode),(()=>s())),t)}))},i._compileListItems=function({layers:e,items:t,key:s,type:i,callback:a}){this._watchLayersListMode({layers:e,key:s,callback:a}),this._createNewItems({type:i,items:t,layers:e}),this._removeItems({items:t,layers:e}),this._sortItems(t,e)},i._compileReferenceList=function(){const{referenceItems:e}=this,t=this.get("view.map.basemap.referenceLayers");this._compileListItems({type:"reference",layers:t,items:e,key:h.referenceLayersListMode,callback:this._compileReferenceList})},i._compileBaseList=function(){const{baseItems:e}=this,t=this.get("view.map.basemap.baseLayers");this._compileListItems({type:"base",layers:t,items:e,key:h.baseLayersListMode,callback:this._compileBaseList})},i._compileLists=function(){this._compileReferenceList(),this._compileBaseList()},i._createNewItems=function({items:e,layers:t,type:s}){t&&t.forEach((t=>{e.find((e=>e.layer===t))||e.add(this._createListItem({type:s,layer:t}))}))},i._removeItems=function({items:e,layers:t}){const{handles:s}=this;e&&e.forEach((i=>{if(!i)return;t&&t.find((e=>i.layer===e))||(s.remove(`${h.children}-${i.uid}`),e.remove(i))}))},i._sortItems=function(e,t){e&&e.sort(((e,s)=>{const i=t.indexOf(e.layer),a=t.indexOf(s.layer);return i>a?-1:i<a?1:0}))},i._removeAllBaseItems=function(){const{handles:e,baseItems:t}=this;t.forEach((t=>{e.remove(`${h.children}-${t.uid}`)})),t.removeAll()},i._removeAllReferenceItems=function(){const{handles:e,referenceItems:t}=this;t.forEach((t=>{e.remove(`${h.children}-${t.uid}`)})),t.removeAll()},i._baseListItemCreatedFunctionChanged=function(){this._removeAllBaseItems(),this._compileLists()},i._referenceListItemCreatedFunctionChanged=function(){this._removeAllReferenceItems(),this._compileLists()},i._watchBasemapLayers=function(){const{handles:e,view:t}=this;e.remove([h.baseLayers,h.referenceLayers,h.basemap,h.baseLayerViews,h.referenceLayerViews]),this._compileLists(),t&&t.ready&&e.add([r.watch((()=>this.view?.map?.basemap?.baseLayers),(e=>this._createItemChangeHandles({items:e,key:h.baseLayers,callback:this._compileBaseList})),r.initial),r.watch((()=>this.view?.map?.basemap?.referenceLayers),(e=>this._createItemChangeHandles({items:e,key:h.referenceLayers,callback:this._compileReferenceList})),r.initial),r.watch((()=>this.view?.basemapView?.baseLayerViews),(e=>this._createItemChangeHandles({items:e,key:h.baseLayerViews,callback:this._compileBaseList})),r.initial),r.watch((()=>this.view?.basemapView?.referenceLayerViews),(e=>this._createItemChangeHandles({items:e,key:h.referenceLayerViews,callback:this._compileReferenceList})),r.initial)],h.basemap)},e._createClass(s,[{key:"basemapTitle",get:function(){return this.view?.map?.basemap?.title??null},set:function(e){this._override("basemapTitle",e)}},{key:"state",get:function(){return this.get("view.ready")?"ready":this.get("view")?"loading":"disabled"}}]),s}(a.HandleOwnerMixin(i.EventedAccessor));t.__decorate([n.property({type:d,readOnly:!0})],p.prototype,"baseItems",void 0),t.__decorate([n.property()],p.prototype,"basemapTitle",null),t.__decorate([n.property()],p.prototype,"baseListItemCreatedFunction",void 0),t.__decorate([n.property()],p.prototype,"checkPublishStatusEnabled",void 0),t.__decorate([n.property()],p.prototype,"referenceListItemCreatedFunction",void 0),t.__decorate([n.property({type:d,readOnly:!0})],p.prototype,"referenceItems",void 0),t.__decorate([n.property({readOnly:!0})],p.prototype,"state",null),t.__decorate([n.property()],p.prototype,"view",void 0),t.__decorate([n.property()],p.prototype,"transferListItem",null),p=t.__decorate([l.subclass("esri.widgets.BasemapLayerList.BasemapLayerListViewModel")],p);return p}));
