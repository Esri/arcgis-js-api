/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/events","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../Slider","./SliderWithDropdownViewModel","../../support/widgetUtils","../../support/jsxFactory"],(function(o,e,t,r,n,i,s,l,d,p,c,a,w){"use strict";const h={interactive:"esri-interactive",label:"esri-slider__label",box:"esri-slider-with-dropdown__box",dropdownRoot:"esri-slider-with-dropdown__dropdown-root",anchor:" esri-widget__anchor esri-slider-with-dropdown__anchor",anchorOpen:"esri-slider-with-dropdown__anchor--open",anchorClosed:"esri-slider-with-dropdown__anchor--closed",dropdownList:"esri-slider-with-dropdown__list",dropdownListItem:"esri-slider-with-dropdown__list-item",dropdownListItemSelected:"esri-slider-with-dropdown__list-item--selected",boxDropDownOn:"esri-slider-with-dropdown__box--drop-down-on",boxDropDownOff:"esri-slider-with-dropdown__box--drop-down-off"},u={selectItem:"Enter",closeDropdown:"Escape",moveSelectionUp:"ArrowUp",moveSelectionDown:"ArrowDown"};let _=function(e){function n(o,t){var r;return(r=e.call(this,o,t)||this).viewModel=new c.SliderWithDropdownViewModel,r.buttonTooltip="",r.showDropDown=!0,r.currentIndex=0,r._rootNode=null,r}o._inheritsLoose(n,e);var i=n.prototype;return i.renderThumbLabel=function(o){const t={[h.boxDropDownOn]:this.showDropDown,[h.boxDropDownOff]:!this.showDropDown};return w.tsx("div",{class:this.classes(h.box,h.label,t)},e.prototype.renderThumbLabel.call(this,o),this.showDropDown?w.tsx("div",{bind:this,afterCreate:this._onRootNodeCreate,class:h.dropdownRoot},w.tsx("button",{class:this.classes(h.interactive,h.anchor,this.isDropdownOpen?h.anchorOpen:h.anchorClosed),bind:this,onclick:this._onAnchorClick,onpointerdown:this._killEvent,"aria-label":this.buttonTooltip,title:this.buttonTooltip,"aria-expanded":this.isDropdownOpen.toString(),"aria-haspopup":"listbox",type:"button"},this.currentItem?this.currentItem.name+" ":""),this.isDropdownOpen?w.tsx("ol",{class:this.classes(h.dropdownList),onpointerdown:this._killEvent,onblur:this._onDropdownBlur,bind:this,tabindex:"-1","aria-label":this.buttonTooltip,role:"listbox",onkeydown:this._onOlKeyDown,afterCreate:this._focusOnSelectedItem},this.items.map(((o,e)=>w.tsx("li",{class:e===this.currentIndex?this.classes(h.interactive,h.dropdownListItem,h.dropdownListItemSelected):this.classes(h.interactive,h.dropdownListItem),bind:this,onclick:this._onDropdownItemClick,"data-result":e,"aria-label":o.label.join(" "),role:"option","aria-selected":(e===this.currentIndex).toString(),onkeydown:this._onLiKeyDown,onblur:this._onDropdownBlur,tabindex:"0"},o.label.map((o=>w.tsx("span",{bind:this},o))))))):null):null)},i._onRootNodeCreate=function(o){this._rootNode=o},i._focusOnSelectedItem=function(o){var e;const t=null!=(e=o.querySelector(`.${h.dropdownListItemSelected}`))?e:o.firstChild;r.isSome(t)&&t instanceof HTMLElement&&(t.scrollIntoView(),t.focus())},i._onAnchorClick=function(){return this.viewModel.toggle(),!0},i._onDropdownItemClick=function(o){const e=o.currentTarget;this.viewModel.selectItem(e["data-result"])},i._onDropdownBlur=function(o){let e=o.relatedTarget;null===e&&(e=document.activeElement),r.isSome(this._rootNode)&&!this._rootNode.contains(e)&&e!==this._rootNode.parentElement&&e!==this._rootNode.parentElement.parentElement&&(this.viewModel.isDropdownOpen=!1)},i._killEvent=function(o){return o.stopPropagation(),!0},i._onOlKeyDown=function(o){event.stopPropagation(),t.eventKey(o)===u.closeDropdown&&(this.viewModel.isDropdownOpen=!1)},i._onLiKeyDown=function(o){const e=event.target;switch(t.eventKey(o)){case u.moveSelectionUp:if(e.previousElementSibling){e.previousElementSibling.focus()}break;case u.moveSelectionDown:if(e.nextElementSibling){e.nextElementSibling.focus()}break;case u.selectItem:e.click()}},n}(p);return e.__decorate([n.property()],_.prototype,"viewModel",void 0),e.__decorate([n.property()],_.prototype,"buttonTooltip",void 0),e.__decorate([n.property()],_.prototype,"showDropDown",void 0),e.__decorate([n.property({aliasOf:"viewModel.items"})],_.prototype,"items",void 0),e.__decorate([n.property({aliasOf:"viewModel.currentIndex"})],_.prototype,"currentIndex",void 0),e.__decorate([n.property({aliasOf:"viewModel.currentItem"})],_.prototype,"currentItem",void 0),e.__decorate([n.property({aliasOf:"viewModel.isDropdownOpen"})],_.prototype,"isDropdownOpen",void 0),_=e.__decorate([d.subclass("esri.widgets.Daylight.SliderWithDropdown")],_),_}));
