/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/maybe","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/events","../../support/widgetUtils","../../../chunks/index","./SliderWithDropdownViewModel","../../Slider"],(function(o,e,t,r,n,i,s,l,d,p,c,a,w,h,u,_){"use strict";const b={interactive:"esri-interactive",label:"esri-slider__label",box:"esri-slider-with-dropdown__box",dropdownRoot:"esri-slider-with-dropdown__dropdown-root",anchor:" esri-widget__anchor esri-slider-with-dropdown__anchor",anchorOpen:"esri-slider-with-dropdown__anchor--open",anchorClosed:"esri-slider-with-dropdown__anchor--closed",dropdownList:"esri-slider-with-dropdown__list",dropdownListItem:"esri-slider-with-dropdown__list-item",dropdownListItemSelected:"esri-slider-with-dropdown__list-item--selected",boxDropDownOn:"esri-slider-with-dropdown__box--drop-down-on",boxDropDownOff:"esri-slider-with-dropdown__box--drop-down-off"},m={selectItem:"Enter",closeDropdown:"Escape",moveSelectionUp:"ArrowUp",moveSelectionDown:"ArrowDown"};let D=function(e){function t(o,t){var r;return(r=e.call(this,o,t)||this).viewModel=new u.SliderWithDropdownViewModel,r.buttonTooltip="",r.showDropDown=!0,r.currentIndex=0,r._rootNode=null,r}o._inheritsLoose(t,e);var n=t.prototype;return n.renderThumbLabel=function(o){const t={[b.boxDropDownOn]:this.showDropDown,[b.boxDropDownOff]:!this.showDropDown};return h.jsx("div",{class:this.classes(b.box,b.label,t)},e.prototype.renderThumbLabel.call(this,o),this.showDropDown?h.jsx("div",{bind:this,afterCreate:this._onRootNodeCreate,class:b.dropdownRoot},h.jsx("button",{class:this.classes(b.interactive,b.anchor,this.isDropdownOpen?b.anchorOpen:b.anchorClosed),bind:this,onclick:this._onAnchorClick,onpointerdown:this._killEvent,"aria-label":this.buttonTooltip,title:this.buttonTooltip,"aria-expanded":this.isDropdownOpen.toString(),"aria-haspopup":"listbox",type:"button"},this.currentItem?this.currentItem.name+" ":""),this.isDropdownOpen?h.jsx("ol",{class:this.classes(b.dropdownList),onpointerdown:this._killEvent,onblur:this._onDropdownBlur,bind:this,tabindex:"-1","aria-label":this.buttonTooltip,role:"listbox",onkeydown:this._onOlKeyDown,afterCreate:this._focusOnSelectedItem},this.items.map(((o,e)=>h.jsx("li",{class:e===this.currentIndex?this.classes(b.interactive,b.dropdownListItem,b.dropdownListItemSelected):this.classes(b.interactive,b.dropdownListItem),bind:this,onclick:this._onDropdownItemClick,"data-result":e,"aria-label":o.label.join(" "),role:"option","aria-selected":(e===this.currentIndex).toString(),onkeydown:this._onLiKeyDown,onblur:this._onDropdownBlur,tabindex:"0"},o.label.map((o=>h.jsx("span",{bind:this},o))))))):null):null)},n._onRootNodeCreate=function(o){this._rootNode=o},n._focusOnSelectedItem=function(o){var e;const t=null!=(e=o.querySelector(`.${b.dropdownListItemSelected}`))?e:o.firstChild;r.isSome(t)&&t instanceof HTMLElement&&(t.scrollIntoView(),t.focus())},n._onAnchorClick=function(){return this.viewModel.toggle(),!0},n._onDropdownItemClick=function(o){const e=o.currentTarget;this.viewModel.selectItem(e["data-result"])},n._onDropdownBlur=function(o){let e=o.relatedTarget;null===e&&(e=document.activeElement),r.isSome(this._rootNode)&&!this._rootNode.contains(e)&&e!==this._rootNode.parentElement&&e!==this._rootNode.parentElement.parentElement&&(this.viewModel.isDropdownOpen=!1)},n._killEvent=function(o){return o.stopPropagation(),!0},n._onOlKeyDown=function(o){event.stopPropagation(),a.eventKey(o)===m.closeDropdown&&(this.viewModel.isDropdownOpen=!1)},n._onLiKeyDown=function(o){const e=event.target;switch(a.eventKey(o)){case m.moveSelectionUp:if(e.previousElementSibling){e.previousElementSibling.focus()}break;case m.moveSelectionDown:if(e.nextElementSibling){e.nextElementSibling.focus()}break;case m.selectItem:e.click()}},t}(_);return e.__decorate([s.property()],D.prototype,"viewModel",void 0),e.__decorate([s.property()],D.prototype,"buttonTooltip",void 0),e.__decorate([s.property()],D.prototype,"showDropDown",void 0),e.__decorate([s.property({aliasOf:"viewModel.items"})],D.prototype,"items",void 0),e.__decorate([s.property({aliasOf:"viewModel.currentIndex"})],D.prototype,"currentIndex",void 0),e.__decorate([s.property({aliasOf:"viewModel.currentItem"})],D.prototype,"currentItem",void 0),e.__decorate([s.property({aliasOf:"viewModel.isDropdownOpen"})],D.prototype,"isDropdownOpen",void 0),D=e.__decorate([l.subclass("esri.widgets.Daylight.SliderWithDropdown")],D),D}));
