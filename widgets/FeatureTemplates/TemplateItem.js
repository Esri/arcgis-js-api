/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["require","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Graphic","../../core/Accessor","../../core/HandleOwner","../../core/watchUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../symbols/support/symbolUtils"],(function(e,t,r,n,o,i,l,a,s,u,c,p,y){"use strict";function m(e){return Object.freeze({__proto__:null,default:e})}var d;const h=e=>`${e.label}-${e.layer.id}`;let f=d=function(r){function o(e){var t;return(t=r.call(this,e)||this)._activeFetchInfo={id:null,request:null},t.description=null,t.label=null,t.layer=null,t.template=null,t.thumbnail=null,t}t._inheritsLoose(o,r);var i=o.prototype;return i.initialize=function(){this.handles.add(l.init(this,["layer.renderer","template"],(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)})))},i.clone=function(){const e=this.thumbnail?this.thumbnail.cloneNode(!0):null,t=new d({layer:this.layer,template:this.template});return t._set("thumbnail",e),t},i.fetchThumbnail=function(){var e=t._asyncToGenerator((function*(){var e=this;const{_activeFetchInfo:r}=this;return h(this)===r.id||(r.id=h(this),r.request=this._getPreviewSymbol().then(function(){var n=t._asyncToGenerator((function*(t){var n;if(h(e)!==r.id)return;const o={maxSize:36};"dictionary"===(null==(n=e.layer.renderer)?void 0:n.type)&&(o.fieldMap=e.layer.renderer.fieldMap,o.feature={attributes:e.template.prototype.attributes});const i=yield y.renderPreviewHTML(t,o);h(e)===r.id&&e._set("thumbnail",i)}));return function(e){return n.apply(this,arguments)}}())),r.request}));function r(){return e.apply(this,arguments)}return r}(),i._getPreviewSymbol=function(){var e=t._asyncToGenerator((function*(){const{layer:e,template:t,layer:{renderer:r}}=this;if(r){const e=new n({attributes:t.prototype.attributes}),o=yield r.getSymbolAsync(e);if(o)return o}return this._getFallbackSymbolFromGeometry(e)}));function r(){return e.apply(this,arguments)}return r}(),i._getFallbackSymbolFromGeometry=function(t){const{geometryType:r}=t;return"point"===r||"multipoint"===r?new Promise((function(t,r){e(["../../symbols/SimpleMarkerSymbol"],(function(e){t(m(e))}),r)})).then((e=>new e.default)):"polyline"===r?new Promise((function(t,r){e(["../../symbols/SimpleLineSymbol"],(function(e){t(m(e))}),r)})).then((e=>new e.default)):"polygon"===r||"mesh"===r||"multipatch"===r?new Promise((function(t,r){e(["../../symbols/SimpleFillSymbol"],(function(e){t(m(e))}),r)})).then((e=>new e.default)):void 0},o}(i.HandleOwnerMixin(o));return r.__decorate([a.property({aliasOf:"template.description"})],f.prototype,"description",void 0),r.__decorate([a.property({aliasOf:"template.name"})],f.prototype,"label",void 0),r.__decorate([a.property()],f.prototype,"layer",void 0),r.__decorate([a.property()],f.prototype,"template",void 0),r.__decorate([a.property({readOnly:!0})],f.prototype,"thumbnail",void 0),f=d=r.__decorate([p.subclass("esri.widgets.FeatureTemplates.TemplateItem")],f),f}));
