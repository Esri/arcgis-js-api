/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["require","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Graphic","../../core/Accessor","../../core/HandleOwner","../../core/watchUtils","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../../symbols/support/symbolUtils"],(function(e,t,r,n,o,l,i,a,s,u,c,p,y){"use strict";const m=e=>Object.freeze({__proto__:null,default:e});var d;const h=e=>`${e.label}-${e.layer.id}`;let b=d=function(r){function o(e){var t;return(t=r.call(this,e)||this)._activeFetchInfo={id:null,request:null},t.description=null,t.label=null,t.layer=null,t.template=null,t.thumbnail=null,t}t._inheritsLoose(o,r);var l=o.prototype;return l.initialize=function(){this.handles.add(i.init(this,["layer.renderer","template"],(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)})))},l.clone=function(){const e=this.thumbnail?this.thumbnail.cloneNode(!0):null,t=new d({layer:this.layer,template:this.template});return t._set("thumbnail",e),t},l.fetchThumbnail=function(){var e=t._asyncToGenerator((function*(){var e=this;const{_activeFetchInfo:r}=this;return h(this)===r.id||(r.id=h(this),r.request=this._getPreviewSymbol().then(function(){var n=t._asyncToGenerator((function*(t){var n;if(h(e)!==r.id)return;const o={maxSize:36};"dictionary"===(null==(n=e.layer.renderer)?void 0:n.type)&&(o.fieldMap=e.layer.renderer.fieldMap,o.feature={attributes:e.template.prototype.attributes});const l=yield y.renderPreviewHTML(t,o);h(e)===r.id&&e._set("thumbnail",l)}));return function(e){return n.apply(this,arguments)}}())),r.request}));function r(){return e.apply(this,arguments)}return r}(),l._getPreviewSymbol=function(){var e=t._asyncToGenerator((function*(){const{layer:e,template:t,layer:{renderer:r}}=this;if(r){const e=new n({attributes:t.prototype.attributes}),o=yield r.getSymbolAsync(e);if(o)return o}return this._getFallbackSymbolFromGeometry(e)}));function r(){return e.apply(this,arguments)}return r}(),l._getFallbackSymbolFromGeometry=function(t){const{geometryType:r}=t;return"point"===r||"multipoint"===r?new Promise(((t,r)=>e(["../../symbols/SimpleMarkerSymbol"],(e=>t(m(e))),r))).then((e=>new e.default)):"polyline"===r?new Promise(((t,r)=>e(["../../symbols/SimpleLineSymbol"],(e=>t(m(e))),r))).then((e=>new e.default)):"polygon"===r||"mesh"===r||"multipatch"===r?new Promise(((t,r)=>e(["../../symbols/SimpleFillSymbol"],(e=>t(m(e))),r))).then((e=>new e.default)):void 0},o}(l.HandleOwnerMixin(o));r.__decorate([a.property({aliasOf:"template.description"})],b.prototype,"description",void 0),r.__decorate([a.property({aliasOf:"template.name"})],b.prototype,"label",void 0),r.__decorate([a.property()],b.prototype,"layer",void 0),r.__decorate([a.property()],b.prototype,"template",void 0),r.__decorate([a.property({readOnly:!0})],b.prototype,"thumbnail",void 0),b=d=r.__decorate([p.subclass("esri.widgets.FeatureTemplates.TemplateItem")],b);return b}));
