/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["require","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Accessor","../../Graphic","../../core/watchUtils","../../core/HandleOwner","../../symbols/support/symbolUtils"],(function(e,t,r,o,i,n,l,s,a,c,u,p,y,h,m,d){"use strict";function b(e){return Object.freeze({__proto__:null,default:e})}var f;const _=e=>`${e.label}-${e.layer.id}`;let v=f=function(r){function o(e){var t;return(t=r.call(this,e)||this)._activeFetchInfo={id:null,request:null},t.description=null,t.label=null,t.layer=null,t.template=null,t.thumbnail=null,t}t._inheritsLoose(o,r);var i=o.prototype;return i.initialize=function(){this.handles.add(h.init(this,["layer.renderer","template"],(()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)})))},i.clone=function(){const e=this.thumbnail?this.thumbnail.cloneNode(!0):null,t=new f({layer:this.layer,template:this.template});return t._set("thumbnail",e),t},i.fetchThumbnail=async function(){const{_activeFetchInfo:e}=this;return _(this)===e.id||(e.id=_(this),e.request=this._getPreviewSymbol().then((async t=>{var r;if(_(this)!==e.id)return;const o={maxSize:36};"dictionary"===(null==(r=this.layer.renderer)?void 0:r.type)&&(o.fieldMap=this.layer.renderer.fieldMap,o.feature={attributes:this.template.prototype.attributes});const i=await d.renderPreviewHTML(t,o);_(this)===e.id&&this._set("thumbnail",i)}))),e.request},i._getPreviewSymbol=async function(){const{layer:e,template:t,layer:{renderer:r}}=this;if(r){const e=new y({attributes:t.prototype.attributes}),o=await r.getSymbolAsync(e);if(o)return o}return this._getFallbackSymbolFromGeometry(e)},i._getFallbackSymbolFromGeometry=function(t){const{geometryType:r}=t;return"point"===r||"multipoint"===r?new Promise((function(t,r){e(["../../symbols/SimpleMarkerSymbol"],(function(e){t(b(e))}),r)})).then((e=>new e.default)):"polyline"===r?new Promise((function(t,r){e(["../../symbols/SimpleLineSymbol"],(function(e){t(b(e))}),r)})).then((e=>new e.default)):"polygon"===r||"mesh"===r||"multipatch"===r?new Promise((function(t,r){e(["../../symbols/SimpleFillSymbol"],(function(e){t(b(e))}),r)})).then((e=>new e.default)):void 0},o}(m.HandleOwnerMixin(p));return r.__decorate([l.property({aliasOf:"template.description"})],v.prototype,"description",void 0),r.__decorate([l.property({aliasOf:"template.name"})],v.prototype,"label",void 0),r.__decorate([l.property()],v.prototype,"layer",void 0),r.__decorate([l.property()],v.prototype,"template",void 0),r.__decorate([l.property({readOnly:!0})],v.prototype,"thumbnail",void 0),v=f=r.__decorate([s.subclass("esri.widgets.FeatureTemplates.TemplateItem")],v),v}));
