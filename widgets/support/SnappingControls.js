/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/maybe","../../core/uid","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/arrayUtils","../../core/accessorSupport/decorators/subclass","../Widget","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SnappingControls/SnappingControlsViewModel"],(function(e,t,i,n,l,s,a,r,o,c,d,p,u,h){"use strict";const g={header:!0,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0},b="esri-snapping-controls",y={base:b,container:`${b}__container`,panel:`${b}__panel`,item:`${b}__item`,toggleBlock:`${b}__toggle-block`,layerListBlock:`${b}__layer-list-block`,layerList:`${b}__layer-list`,layerListFilter:`${b}__layer-list__filter`,layerListItem:`${b}__layer-list__item`,layerListItemCheckbox:`${b}__layer-list__item__checkbox`,layerListItemLabel:`${b}__layer-list__item__label`,nestedContainer:`${b}__nested-container`,disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"};let _=function(i){function s(e,t){var n;return(n=i.call(this,(()=>{const{view:t,viewModel:i,snappingOptions:n,...l}=e;return l})(),t)||this)._layerListFilter=null,n.iconClass=y.widgetIcon,n.layerListOpen=!0,n.messages=null,n.visibleElements={...g},n._defaultViewModel=null,e?.viewModel?n.viewModel=e.viewModel:(n._defaultViewModel=new h({snappingOptions:e.snappingOptions,view:e.view}),n.viewModel=n._defaultViewModel),n}t._inheritsLoose(s,i);var a=s.prototype;return a.destroy=function(){this._defaultViewModel=n.destroyMaybe(this._defaultViewModel)},a.loadDependencies=function(){return Promise.all([new Promise(((t,i)=>e(["../../chunks/calcite-accordion"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-accordion-item"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-block"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-checkbox"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-input"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-label"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-list"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-list-item"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-panel"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-switch"],t,i)))])},a.castVisibleElements=function(e){return{...g,...e}},a.render=function(){const{label:e,visibleElements:{header:t}}=this;return u.tsx("div",{"aria-label":e,class:this.classes(y.base,y.esriWidget)},u.tsx("div",{class:y.container},t?this.renderHeaderView():this.renderContent()))},a.renderHeaderView=function(){return u.tsx("calcite-panel",{heading:this.label,class:y.panel},this.renderContent())},a.renderContent=function(){return[this.renderToggles(),this.renderLayerList()]},a.renderToggles=function(){const{visibleElements:{enabledToggle:e,selfEnabledToggle:t,featureEnabledToggle:i}}=this;return e||t||i?u.tsx("calcite-block",{class:y.toggleBlock,key:"toggle-block",heading:"",open:!0},this.renderEnabledToggle(),u.tsx("div",{class:y.nestedContainer},this.renderSelfEnabledToggle(),this.renderFeatureEnabledToggle())):null},a.renderEnabledToggle=function(){if(!this.visibleElements.enabledToggle)return null;const{messages:{enableSnapping:e},viewModel:{snappingOptions:{enabled:t,enabledToggled:i}}}=this;return u.tsx("calcite-label",{layout:"inline-space-between"},e,u.tsx("calcite-switch",{checked:t,disabled:i,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))},a.renderSelfEnabledToggle=function(){if(!this.visibleElements.selfEnabledToggle)return null;const{messages:{geometryGuides:e},viewModel:{snappingOptions:{enabled:t,selfEnabled:i,enabledToggled:n}}}=this;return u.tsx("calcite-label",{layout:"inline-space-between",key:"self-enabled-toggle"},e,u.tsx("calcite-switch",{checked:i,disabled:n||!t,bind:this,onCalciteSwitchChange:this._selfEnabledSwitchChange}))},a.renderFeatureEnabledToggle=function(){if(!this.visibleElements.featureEnabledToggle)return null;const{messages:{featureToFeature:e},viewModel:{snappingOptions:{enabled:t,featureEnabled:i,enabledToggled:n}}}=this;return u.tsx("calcite-label",{layout:"inline-space-between",key:"feature-enabled-toggle"},e,u.tsx("calcite-switch",{checked:i,disabled:n||!t,bind:this,onCalciteSwitchChange:this._featureEnabledSwitchChange}))},a.renderLayerList=function(){if(!this.visibleElements.layerList)return null;const{messages:e}=this,t=({target:{value:e}})=>this._layerListFilter=""===e?null:new RegExp(e,"i"),i=this.viewModel.layerListViewModel.operationalItems.length>9?u.tsx("calcite-input",{class:y.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:t}):null;return u.tsx("calcite-block",{key:"list-block",heading:e.snappingLayers,class:y.layerListBlock,collapsible:!0,open:this.layerListOpen,onCalciteBlockToggle:e=>this.layerListOpen=e.target.open},i,u.tsx("calcite-list",{class:y.layerList},this.renderLayerListItemCollection(this.viewModel.layerListViewModel.operationalItems,n.unwrap(this._layerListFilter))))},a.renderLayerListItemCollection=function(e,t){return e.map((e=>{if(!t||this._itemTitleMatchesFilter(e,t))return e.children.length>0?this.renderLayerListItemGroup(e):this.renderLayerListItem(e);const i=e.children.filter((e=>this._itemTitleMatchesFilter(e,t)));return i.length>0?this.renderLayerListItemGroup(e,i):null})).toArray().filter(n.isSome)},a.renderLayerListItem=function(e){const{messages:{untitledLayer:t}}=this,i=e.title||t,n=e.enabled,l=u.tsx("calcite-checkbox",{value:e.layer.id,checked:n,bind:this,onCalciteCheckboxChange:e=>this._handleLayerListItemChange(e.target)}),s=()=>{const e=!l.properties.checked;this._handleLayerListItemChange({checked:e,value:l.properties.value})};return u.tsx("calcite-list-item",{key:`${this.id}-list-item-${e.uid}`,onCalciteListItemSelect:s},u.tsx("calcite-label",{class:y.layerListItem,slot:"content-start",tabIndex:-1,layout:"inline"},u.tsx("div",{class:y.layerListItemCheckbox},l),u.tsx("div",{class:y.layerListItemLabel},i)))},a.renderLayerListItemGroup=function(e,t){const i=e.title||this.messages.untitledLayer,n=e.title&&""!==e.title?e.title:l.generateUID(),s=!!t,a=t??e.children,r=e=>{e.append(...Array.from(e.children).map((e=>(e.remove(),e))))};return u.tsx("calcite-list-item",{key:n},u.tsx("calcite-accordion",{iconPosition:"start",appearance:"transparent",afterCreate:r},u.tsx("calcite-accordion-item",{expanded:s,heading:i,key:e.uid},u.tsx("calcite-list",null,[...this.renderLayerListItemCollection(a)]))))},a._enableSnappingSwitchChange=function(e){this.snappingOptions.enabled=e.target.checked},a._featureEnabledSwitchChange=function(e){this.snappingOptions.featureEnabled=e.target.checked},a._itemTitleMatchesFilter=function(e,t){return null!=t&&t.test(e.title)},a._selfEnabledSwitchChange=function(e){this.snappingOptions.selfEnabled=e.target.checked},a._handleLayerListItemChange=function(){var e=t._asyncToGenerator((function*(e){e.checked?this.viewModel.enableSnappingForLayer(e.value):this.viewModel.disableSnappingForLayer(e.value)}));function i(t){return e.apply(this,arguments)}return i}(),t._createClass(s,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"snappingOptions",get:function(){return this.viewModel.snappingOptions},set:function(e){this.viewModel.snappingOptions=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"viewModel",set:function(e){e!==this._get("viewModel")&&((n.isNone(this._defaultViewModel)||this._defaultViewModel!==e)&&(this._defaultViewModel=n.destroyMaybe(this._defaultViewModel)),this._set("viewModel",e))}}]),s}(c);i.__decorate([s.property()],_.prototype,"_layerListFilter",void 0),i.__decorate([s.property()],_.prototype,"iconClass",void 0),i.__decorate([s.property()],_.prototype,"label",null),i.__decorate([s.property()],_.prototype,"layerListOpen",void 0),i.__decorate([s.property(),p.messageBundle("esri/widgets/support/SnappingControls/t9n/SnappingControls")],_.prototype,"messages",void 0),i.__decorate([s.property()],_.prototype,"snappingOptions",null),i.__decorate([s.property()],_.prototype,"view",null),i.__decorate([s.property()],_.prototype,"viewModel",null),i.__decorate([s.property()],_.prototype,"visibleElements",void 0),i.__decorate([a.cast("visibleElements")],_.prototype,"castVisibleElements",null),_=i.__decorate([o.subclass("esri.widgets.support.SnappingControls")],_);return _}));
