/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/maybe","../../core/uid","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","../Widget","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SnappingControls/SnappingControlsViewModel"],(function(e,t,i,n,s,l,r,a,o,c,d,p,g,u){"use strict";const h={header:!0,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0},b={base:"esri-snapping-controls",container:"esri-snapping-controls__container",panel:"esri-snapping-controls__panel",item:"esri-snapping-controls__item",toggleBlock:"esri-snapping-controls__toggle-block",layerListBlock:"esri-snapping-controls__layer-list-block",layerList:"esri-snapping-controls__layer-list",layerListFilter:"esri-snapping-controls__layer-list__filter",layerListItem:"esri-snapping-controls__layer-list__item",layerListItemCheckbox:"esri-snapping-controls__layer-list__item__checkbox",layerListItemLabel:"esri-snapping-controls__layer-list__item__label",nestedContainer:"esri-snapping-controls__nested-container",disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"};let y=function(i){function l(e,t){var n;return(n=i.call(this,(()=>{const{view:t,viewModel:i,snappingOptions:n,...s}=e;return s})(),t)||this)._layerListFilter=null,n.messages=null,n.messagesCommon=null,n.visibleElements={...h},n._defaultViewModel=null,e?.viewModel?n.viewModel=e.viewModel:(n._defaultViewModel=new u({snappingOptions:e.snappingOptions,view:e.view}),n.viewModel=n._defaultViewModel),n}t._inheritsLoose(l,i);var r=l.prototype;return r.destroy=function(){this._defaultViewModel=n.destroyMaybe(this._defaultViewModel)},r.loadDependencies=function(){return Promise.all([new Promise(((t,i)=>e(["../../chunks/calcite-accordion"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-accordion-item"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-block"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-checkbox"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-input"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-label"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-list"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-list-item"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-panel"],t,i))),new Promise(((t,i)=>e(["../../chunks/calcite-switch"],t,i)))])},r.castVisibleElements=function(e){return{...h,...e}},r.render=function(){const{label:e,visibleElements:{header:t}}=this;return g.tsx("div",{"aria-label":e,class:this.classes(b.base,b.esriWidget)},g.tsx("div",{class:b.container},t?this.renderHeaderView():this.renderContent()))},r.renderHeaderView=function(){return g.tsx("calcite-panel",{heading:this.label,class:b.panel},this.renderContent())},r.renderContent=function(){return[this.renderToggles(),this.renderLayerList()]},r.renderToggles=function(){const{visibleElements:{enabledToggle:e,selfEnabledToggle:t,featureEnabledToggle:i}}=this;if(e||t||i)return g.tsx("calcite-block",{class:b.toggleBlock,key:"toggle-block",heading:"",open:!0},this.renderEnabledToggle(),g.tsx("div",{class:b.nestedContainer},this.renderSelfEnabledToggle(),this.renderFeatureEnabledToggle()))},r.renderEnabledToggle=function(){if(!this.visibleElements.enabledToggle)return;const{messages:{enableSnapping:e},viewModel:{snappingOptions:{enabled:t,enabledToggled:i}}}=this;return g.tsx("calcite-label",{layout:"inline-space-between"},e,g.tsx("calcite-switch",{checked:t,disabled:i,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))},r.renderSelfEnabledToggle=function(){if(!this.visibleElements.selfEnabledToggle)return;const{messages:{geometryGuides:e},viewModel:{snappingOptions:{enabled:t,selfEnabled:i,enabledToggled:n}}}=this;return g.tsx("calcite-label",{layout:"inline-space-between",key:"self-enabled-toggle"},e,g.tsx("calcite-switch",{checked:i,disabled:n||!t,bind:this,onCalciteSwitchChange:this._selfEnabledSwitchChange}))},r.renderFeatureEnabledToggle=function(){if(!this.visibleElements.featureEnabledToggle)return;const{messages:{featureToFeature:e},viewModel:{snappingOptions:{enabled:t,featureEnabled:i,enabledToggled:n}}}=this;return g.tsx("calcite-label",{layout:"inline-space-between",key:"feature-enabled-toggle"},e,g.tsx("calcite-switch",{checked:i,disabled:n||!t,bind:this,onCalciteSwitchChange:this._featureEnabledSwitchChange}))},r.renderLayerList=function(){if(!this.visibleElements.layerList)return;const{messages:e,messagesCommon:t}=this,i=({target:{value:e}})=>this._layerListFilter=""===e?null:new RegExp(e,"i"),s=this.viewModel.layerListViewModel.operationalItems.length>9?g.tsx("calcite-input",{class:b.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:i}):null;return g.tsx("calcite-block",{key:"list-block","intl-collapse":t?.collapse,"intl-expand":t?.expand,heading:e.snappingLayers,class:b.layerListBlock,open:!0,collapsible:!0},s,g.tsx("calcite-list",{class:b.layerList},this.renderLayerListItemCollection(this.viewModel.layerListViewModel.operationalItems,n.unwrap(this._layerListFilter))))},r.renderLayerListItemCollection=function(e,t){return e.map((e=>{if(!t||this._itemTitleMatchesFilter(e,t))return e.children.length>0?this.renderLayerListItemGroup(e):this.renderLayerListItem(e);const i=e.children.filter((e=>this._itemTitleMatchesFilter(e,t)));return i.length>0?this.renderLayerListItemGroup(e,i):null})).toArray()},r.renderLayerListItem=function(e){const{messages:{untitledLayer:t}}=this,i=e.title||t,n=e.enabled,s=g.tsx("calcite-checkbox",{value:e.layer.id,checked:n,bind:this,onCalciteCheckboxChange:e=>this._handleLayerListItemChange(e.target)}),l=()=>{const e=!s.properties.checked;this._handleLayerListItemChange({checked:e,value:s.properties.value})};return g.tsx("calcite-list-item",{key:`${this.id}-list-item-${e.uid}`,onclick:l},g.tsx("calcite-label",{class:b.layerListItem,slot:"content-start",tabIndex:-1,layout:"inline","disable-spacing":"true"},g.tsx("div",{class:b.layerListItemCheckbox},s),g.tsx("div",{class:b.layerListItemLabel},i)))},r.renderLayerListItemGroup=function(e,t){const i=e.title||this.messages.untitledLayer,n=e.title&&""!==e.title?e.title:s.generateUID(),l=!!t,r=t??e.children,a=e=>{e.append(...Array.from(e.children).map((e=>(e.remove(),e))))};return g.tsx("calcite-list-item",{key:n},g.tsx("calcite-accordion",{"icon-position":"start",appearance:"transparent",afterCreate:a},g.tsx("calcite-accordion-item",{active:l,"item-title":i,key:e.uid},g.tsx("calcite-list",null,[...this.renderLayerListItemCollection(r)]))))},r._enableSnappingSwitchChange=function(e){this.snappingOptions.enabled=e.target.checked},r._featureEnabledSwitchChange=function(e){this.snappingOptions.featureEnabled=e.target.checked},r._itemTitleMatchesFilter=function(e,t){return t.test(e.title)},r._selfEnabledSwitchChange=function(e){this.snappingOptions.selfEnabled=e.target.checked},r._handleLayerListItemChange=function(){var e=t._asyncToGenerator((function*(e){e.checked?this.viewModel.enableSnappingForLayer(e.value):this.viewModel.disableSnappingForLayer(e.value)}));function i(t){return e.apply(this,arguments)}return i}(),t._createClass(l,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"snappingOptions",get:function(){return this.viewModel.snappingOptions},set:function(e){this.viewModel.snappingOptions=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"viewModel",set:function(e){e!==this._get("viewModel")&&((n.isNone(this._defaultViewModel)||this._defaultViewModel!==e)&&(this._defaultViewModel=n.destroyMaybe(this._defaultViewModel)),this._set("viewModel",e))}}]),l}(c);i.__decorate([l.property()],y.prototype,"_layerListFilter",void 0),i.__decorate([l.property()],y.prototype,"label",null),i.__decorate([l.property(),p.messageBundle("esri/widgets/support/SnappingControls/t9n/SnappingControls")],y.prototype,"messages",void 0),i.__decorate([l.property(),p.messageBundle("esri/t9n/common")],y.prototype,"messagesCommon",void 0),i.__decorate([l.property()],y.prototype,"snappingOptions",null),i.__decorate([l.property()],y.prototype,"view",null),i.__decorate([l.property()],y.prototype,"viewModel",null),i.__decorate([l.property()],y.prototype,"visibleElements",void 0),i.__decorate([a.cast("visibleElements")],y.prototype,"castVisibleElements",null),y=i.__decorate([o.subclass("esri.widgets.support.SnappingControls")],y);return y}));
