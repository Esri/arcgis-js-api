/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../chunks/utils","../../chunks/icon","../../chunks/label","../../chunks/switch","../../core/maybe","../../core/accessorSupport/decorators/aliasOf","../../core/has","../../core/accessorSupport/decorators/cast","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../Widget","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SnappingControls/SnappingControlsViewModel"],(function(e,t,i,a,l,c,s,o,n,r,p,d,u,g,h,m,w,C){"use strict";i.register({"calcite-action":i.CalciteAction,"calcite-loader":i.CalciteLoader,"calcite-icon":i.CalciteIcon,"calcite-action-group":i.CalciteActionGroup,"calcite-action-menu":i.CalciteActionMenu,"calcite-tooltip-manager":i.CalciteTooltipManager,"calcite-popover":i.CalcitePopover,"calcite-action-bar":i.CalciteActionBar,"calcite-action-pad":i.CalciteActionPad}),i.register({"calcite-block":i.CalciteBlock,"calcite-scrim":i.CalciteScrim,"calcite-handle":i.CalciteHandle,"calcite-icon":i.CalciteIcon,"calcite-loader":i.CalciteLoader,"calcite-block-section":i.CalciteBlockSection,"calcite-switch":i.CalciteSwitch}),i.register({"calcite-panel":i.CalcitePanel,"calcite-action":i.CalciteAction,"calcite-action-menu":i.CalciteActionMenu,"calcite-scrim":i.CalciteScrim,"calcite-loader":i.CalciteLoader,"calcite-icon":i.CalciteIcon,"calcite-tooltip-manager":i.CalciteTooltipManager,"calcite-popover":i.CalcitePopover}),i.register({"calcite-pick-list":i.CalcitePickList,"calcite-filter":i.CalciteFilter,"calcite-scrim":i.CalciteScrim,"calcite-icon":i.CalciteIcon,"calcite-loader":i.CalciteLoader,"calcite-pick-list-group":i.CalcitePickListGroup,"calcite-pick-list-item":i.CalcitePickListItem,"calcite-action":i.CalciteAction});const b={header:!0},v={base:"esri-snapping-controls",container:"esri-snapping-controls__container",panel:"esri-snapping-controls__panel",item:"esri-snapping-controls__item",toggleBlock:"esri-snapping-controls__toggle-block",disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"};let y=function(t){function i(e,i){var a;return(a=t.call(this,(()=>{const{view:t,viewModel:i,snappingOptions:a,...l}=e;return l})(),i)||this).label=void 0,a.messages=null,a.messagesCommon=null,a.snappingOptions=null,a.view=null,a.visibleElements={...b},a._defaultViewModel=null,null!=e&&e.viewModel?a.viewModel=e.viewModel:(a._defaultViewModel=new C({snappingOptions:e.snappingOptions,view:e.view}),a.viewModel=a._defaultViewModel),a}e._inheritsLoose(i,t);var a=i.prototype;return a.destroy=function(){this._defaultViewModel=s.destroyMaybe(this._defaultViewModel)},a.castVisibleElements=function(e){return{...b,...e}},a.render=function(){const{label:e,messagesCommon:{close:t},visibleElements:{header:i}}=this,a=w.tsx("calcite-block",{class:v.toggleBlock,open:!0},this.renderSnappingToggle()),l=i?w.tsx("div",{class:v.container},w.tsx("calcite-panel",{heading:e,class:v.panel},w.tsx("calcite-action",{text:t,slot:"header-actions-end",icon:"x",appearance:"solid"}),a,this.renderLayerList())):w.tsx("div",{class:v.container},a,this.renderLayerList());return w.tsx("div",{"aria-label":e,class:this.classes(v.base,v.esriWidget)},l)},a.renderSnappingToggle=function(){const{messages:{enableSnapping:e},viewModel:{snappingOptions:{featureEnabled:t,enabledToggled:i}}}=this;return w.tsx("calcite-label",{layout:"inline-space-between"},e,w.tsx("calcite-switch",{switched:t,disabled:i,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))},a.renderLayerList=function(){const{messages:{snappingLayers:e,searchLayers:t}}=this;return w.tsx("calcite-block",{heading:e,open:!0,collapsible:!0},w.tsx("calcite-pick-list",{multiple:!0,bind:this,onCalciteListChange:this._layerListChange,filterEnabled:this.viewModel.layerListViewModel.operationalItems.length>=10,"filter-placeholder":t},this.renderLayerListItemCollection(this.viewModel.layerListViewModel.operationalItems)))},a.renderLayerListItemCollection=function(e){return e.map((e=>e.children.length>0?this.renderLayerListItemGroup(e):this.renderLayerListItem(e))).toArray()},a.renderLayerListItem=function(e){var t;const{messages:{untitledLayer:i}}=this,a=e.title||i,l=(null==(t=e.children)?void 0:t.length)>0,c=e.enabled;return w.tsx("calcite-pick-list-item",{slot:l?"parent-item":null,key:`${this.id}-pick-list-item-${e.uid}`,label:a,value:e.layer.id,selected:c})},a.renderLayerListItemGroup=function(e){const t=e.title||this.messages.untitledLayer;return w.tsx("calcite-pick-list-group",{"group-title":t},[...this.renderLayerListItemCollection(e.children)])},a._enableSnappingSwitchChange=function(e){this.snappingOptions.featureEnabled=e.detail.switched},a._layerListChange=function(e){const t=e.detail;this.viewModel.updateEnabledFeatureSources([...t.keys()])},e._createClass(i,[{key:"viewModel",set:function(e){e!==this._get("viewModel")&&((s.isNone(this._defaultViewModel)||this._defaultViewModel!==e)&&(this._defaultViewModel=s.destroyMaybe(this._defaultViewModel)),this._set("viewModel",e))}}]),i}(g);return t.__decorate([d.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],y.prototype,"label",void 0),t.__decorate([d.property(),m.messageBundle("esri/widgets/support/SnappingMenu/t9n/SnappingMenu")],y.prototype,"messages",void 0),t.__decorate([d.property(),m.messageBundle("esri/t9n/common")],y.prototype,"messagesCommon",void 0),t.__decorate([o.aliasOf("viewModel.snappingOptions")],y.prototype,"snappingOptions",void 0),t.__decorate([o.aliasOf("viewModel.view")],y.prototype,"view",void 0),t.__decorate([d.property()],y.prototype,"viewModel",null),t.__decorate([d.property()],y.prototype,"visibleElements",void 0),t.__decorate([r.cast("visibleElements")],y.prototype,"castVisibleElements",null),y=t.__decorate([u.subclass("esri.widgets.support.SnappingControls")],y),y}));
