/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import r from"../../../core/Accessor.js";import o from"../../../core/Error.js";import{HandleOwnerMixin as s}from"../../../core/HandleOwner.js";import{watch as i,initial as t}from"../../../core/reactiveUtils.js";import{property as n}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import{subclass as a}from"../../../core/accessorSupport/decorators/subclass.js";import p from"../../../views/interactive/snapping/FeatureSnappingLayerSource.js";import{canDisplayLayer as l}from"../../LayerList/support/layerListUtils.js";import{SnappingLayerListViewModel as c}from"./SnappingLayerListViewModel.js";const u="esri.widgets.support.SnappingControls.SnappingControlsViewModel";let d=class extends(s(r)){constructor(e){super(e),this.layerListViewModel=new c,this.snappingOptions=null,this.view=null}initialize(){this.handles.add([i((()=>({viewModel:this.layerListViewModel,view:this.view})),(({viewModel:e,view:r})=>{e.view=r}),t),i((()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources})),(({viewModel:e,sources:r})=>{e.featureSnappingSources=r}),t)])}get state(){return this.get("snappingOptions")?"ready":"disabled"}enableSnappingForLayer(e){(this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e)).enabled=!0}disableSnappingForLayer(e){const r=this._findSnappingSourceForLayer(e);r&&(r.enabled=!1)}updateEnabledFeatureSources(e){for(const r of this.snappingOptions.featureSources)l(r.layer)&&(r.enabled=e.includes(r.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find((r=>r.layer.id===e))}_makeSnappingSourceForLayer(e){const{layer:r}=this.layerListViewModel.operationalItemsFlat.find((r=>r.layer.id===e));if(!r)throw new o("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);const s=new p({layer:r});return this.snappingOptions.featureSources.add(s),s}};e([n({constructOnly:!0})],d.prototype,"layerListViewModel",void 0),e([n({constructOnly:!0})],d.prototype,"snappingOptions",void 0),e([n()],d.prototype,"state",null),e([n({constructOnly:!0})],d.prototype,"view",void 0),d=e([a(u)],d);const y=d;export{y as default};
