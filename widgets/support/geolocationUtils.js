/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../config","../../core/Logger","../../core/Error","../../core/urlUtils","../../geometry/Geometry","../../geometry/support/webMercatorUtils","../../geometry/Point","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Polygon","../../geometry/Polyline","../../geometry","../../request","../../portal/Portal","../../tasks/support/ProjectParameters","../../rest/geometryService/units","../../tasks/operations/generalize","../../tasks/support/GeneralizeParameters","../../tasks/operations/lengths","../../tasks/support/LengthsParameters","../../tasks/operations/offset","../../tasks/support/OffsetParameters","../../rest/geometryService/project","../../tasks/operations/relation","../../tasks/support/RelationParameters","../../tasks/operations/trimExtend","../../tasks/support/TrimExtendParameters"],(function(e,t,o,r,i,n,s,a,u,c,l,g,p,m,d,f,y,P,h,v,w,k,S,x,G,U,b,M,R){"use strict";const j=r.getLogger("esri.widgets.support.geolocationUtils"),A={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function E(){const e=t("esri-geolocation");return e||j.warn("geolocation-unsupported","Geolocation unsupported."),e}function L(){const e=window.isSecureContext;return e||j.warn("insecure-context","Geolocation requires a secure origin."),e}function T(){return E()&&L()}function z(e){const t=15e3;return e||(e=A),new Promise(((o,r)=>{setTimeout((()=>r(new i("geolocation:timeout","getting the current geolocation position timed out"))),t),navigator.geolocation.getCurrentPosition(o,r,e)}))}function C(e,t){const{position:o,view:r}=e;return O(q(W(o)),r,t)}function W(e){const t=e&&e.coords||{},o={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:o,timestamp:e.timestamp}:e}function q(e){const t=e&&e.coords;return t?new u({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}}):null}function O(e,t,o){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve(a.geographicToWebMercator(e)):_(o).then((t=>{if(!t)throw new i("geometry-service:missing-url","Geometry service URL is missing");const n=new y({geometries:[e],outSpatialReference:r});return G.project(t,n,o).then((e=>e[0]))}))}function _(e){if(o.geometryServiceUrl)return Promise.resolve(o.geometryServiceUrl);const t=f.getDefault();return t.load(e).catch((()=>{})).then((()=>t.get("helperServices.geometry.url")))}e.getCurrentPosition=z,e.positionToPoint=C,e.supported=T,Object.defineProperty(e,"__esModule",{value:!0})}));
