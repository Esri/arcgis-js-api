/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/has","../../config","../../core/Logger","../../core/Error","../../core/urlUtils","../../core/promiseUtils","../../geometry/Geometry","../../geometry/support/webMercatorUtils","../../geometry/Point","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Polygon","../../geometry/Polyline","../../geometry","../../request","../../portal/Portal","../../tasks/support/ProjectParameters","../../rest/geometryService/units","../../tasks/operations/generalize","../../tasks/support/GeneralizeParameters","../../tasks/operations/lengths","../../tasks/support/LengthsParameters","../../tasks/operations/offset","../../tasks/support/OffsetParameters","../../rest/geometryService/project","../../tasks/operations/relation","../../tasks/support/RelationParameters","../../tasks/operations/trimExtend","../../tasks/support/TrimExtendParameters"],(function(e,t,r,o,i,n,s,a,u,c,l,g,p,m,d,f,y,P,h,v,k,w,x,S,U,G,b,M,R,j){"use strict";const A=o.getLogger("esri.widgets.support.geolocationUtils"),E={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};e.getCurrentPosition=function(e){return e||(e=E),s.create(((t,r)=>{setTimeout((()=>r(new i("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(t,r,e)}))},e.positionToPoint=function(e,t){const{position:o,view:n}=e;return function(e,t,o){if(!t)return s.resolve(e);const n=t.spatialReference;if(n.isWGS84)return s.resolve(e);if(n.isWebMercator)return s.resolve(u.geographicToWebMercator(e));return function(e){if(r.geometryServiceUrl)return s.resolve(r.geometryServiceUrl);const t=y.getDefault();return t.load(e).catch((()=>{})).then((()=>t.get("helperServices.geometry.url")))}(o).then((t=>{if(!t)throw new i("geometry-service:missing-url","Geometry service URL is missing");const r=new P({geometries:[e],outSR:n});return G.project(t,r,o).then((e=>e[0]))}))}(function(e){const t=e&&e.coords;if(!t)return null;return new c({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}})}(function(e){const t=e&&e.coords||{},r={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:r,timestamp:e.timestamp}:e}(o)),n,t)},e.supported=function(){return function(){const e=t("esri-geolocation");return e||A.warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=t("esri-secure-context");return e||A.warn("insecure-context","Geolocation requires a secure origin."),e}()},Object.defineProperty(e,"__esModule",{value:!0})}));
