/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../config","../../core/Error","../../core/has","../../core/Logger","../../geometry/Point","../../geometry/support/webMercatorUtils","../../portal/Portal","../../chunks/_rollupPluginBabelHelpers","../../request","../../core/urlUtils","../../geometry","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Polygon","../../geometry/Polyline","../../rest/geometryService/units","../../rest/support/GeneralizeParameters","../../tasks/operations/generalize","../../rest/support/LengthsParameters","../../tasks/operations/lengths","../../rest/support/OffsetParameters","../../tasks/operations/offset","../../rest/geometryService/project","../../rest/support/RelationParameters","../../tasks/operations/relation","../../rest/support/TrimExtendParameters","../../tasks/operations/trimExtend","../../rest/support/ProjectParameters"],(function(e,t,r,o,i,n,s,u,a,c,l,g,p,m,d,f,y,P,h,v,w,S,k,x,b,G,U,M,R,j){"use strict";const A=i.getLogger("esri.widgets.support.geolocationUtils"),E={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function L(){const e=o("esri-geolocation");return e||A.warn("geolocation-unsupported","Geolocation unsupported."),e}function T(){const e=window.isSecureContext;return e||A.warn("insecure-context","Geolocation requires a secure origin."),e}function z(){return L()&&T()}function C(e){const t=15e3;return e||(e=E),new Promise(((o,i)=>{setTimeout((()=>i(new r("geolocation:timeout","getting the current geolocation position timed out"))),t),navigator.geolocation.getCurrentPosition(o,i,e)}))}function W(e,t){const{position:r,view:o}=e;return H(q(_(r)),o,t)}function _(e){const t=e&&e.coords||{},r={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:r,timestamp:e.timestamp}:e}function q(e){const t=e&&e.coords;return t?new n({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}}):null}function H(e,t,o){if(!t)return Promise.resolve(e);const i=t.spatialReference;return i.isWGS84?Promise.resolve(e):i.isWebMercator?Promise.resolve(s.geographicToWebMercator(e)):O(o).then((t=>{if(!t)throw new r("geometry-service:missing-url","Geometry service URL is missing");const n=new j({geometries:[e],outSpatialReference:i});return b.project(t,n,o).then((e=>e[0]))}))}function O(e){if(t.geometryServiceUrl)return Promise.resolve(t.geometryServiceUrl);const r=u.getDefault();return r.load(e).catch((()=>{})).then((()=>r.get("helperServices.geometry.url")))}e.getCurrentPosition=C,e.positionToPoint=W,e.supported=z,Object.defineProperty(e,"__esModule",{value:!0})}));
