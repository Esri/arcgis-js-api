/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/Error","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Accessor","../../core/Evented","../../assets","../../symbols/PictureMarkerSymbol","../../Graphic","./GoTo","./geolocationUtils"],(function(e,t,o,i,r,n,a,s,c,p,l,d,u,g,h,_,y,v){"use strict";const f=2500;let b=function(t){function o(){var e;return(e=t.apply(this,arguments)||this)._geolocationUsable=!0,e._iconPath=g.getAssetUrl("esri/images/support/sdk_gps_location.png"),e.geolocationOptions=null,e.goToLocationEnabled=!0,e.graphic=new _({symbol:new h({url:e._iconPath,width:21,height:21})}),e.scale=null,e.useHeadingEnabled=!0,e.view=null,e}e._inheritsLoose(o,t);var i=o.prototype;return i.initialize=function(){v.supported()||(this._geolocationUsable=!1)},i.destroy=function(){this._clear(),this.view=null},i._clear=function(){this.view&&this.view.graphics.remove(this.graphic)},i._getScaleWithinConstraints=function(e,t){if(!t)return e;if("2d"===t.type){const{effectiveMaxScale:o,effectiveMinScale:i}=t.constraints;return Math.min(i,Math.max(o,e))}return e},i._getScale=function(e){const{scale:t}=this,o="number"==typeof t?t:f;return this._getScaleWithinConstraints(o,e)},i._getHeading=function(e,t){const o=t&&t.spatialReference,i=o&&(o.isWebMercator||o.isGeographic),r=e.coords&&e.coords.heading;if(!(!i||"number"!=typeof r||isNaN(r)||r<0||r>360))return r},i._addHeading=function(e){const{heading:t,target:o,view:i}=e;i&&"number"==typeof t&&!isNaN(t)&&("3d"!==i.type?"2d"===i.type&&(o.rotation=360-t):o.heading=t)},i._animatePoint=function(e,t,o,i){const{view:r}=this;if(!this.goToLocationEnabled||!r)return Promise.resolve(t);const n=this.useHeadingEnabled?this._getHeading(t,r):void 0,a={target:e,scale:o};return this._addHeading({heading:n,target:a,view:r}),this.callGoTo({target:a,options:i}).then((()=>t))},i._setPosition=async function(e,t){try{const o=await v.positionToPoint({position:e,view:this.view},t),{graphic:i}=this,{timestamp:r}=e,{coords:n}=e,{accuracy:a,altitude:s,altitudeAccuracy:c,heading:p,latitude:l,longitude:d,speed:u}=n,g={timestamp:r,accuracy:a,altitude:s,altitudeAccuracy:c,heading:p,latitude:l,longitude:d,speed:u};i&&(i.geometry=o,i.attributes=g);const h=this._getScale(this.view);return this._animatePoint(o,e,h,t)}catch(o){throw new s("positioning:invalid-point","Cannot position invalid point",{error:o})}},o}(y.GoToMixin(u.EventedMixin(d)));return t.__decorate([n.property()],b.prototype,"_geolocationUsable",void 0),t.__decorate([n.property()],b.prototype,"geolocationOptions",void 0),t.__decorate([n.property()],b.prototype,"goToLocationEnabled",void 0),t.__decorate([n.property()],b.prototype,"graphic",void 0),t.__decorate([n.property()],b.prototype,"scale",void 0),t.__decorate([n.property()],b.prototype,"useHeadingEnabled",void 0),t.__decorate([n.property()],b.prototype,"view",void 0),b=t.__decorate([a.subclass("esri.widgets.support.GeolocationPositioning")],b),b}));
