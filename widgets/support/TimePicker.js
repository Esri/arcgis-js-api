/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import"../../intl.js";import{eventKey as t}from"../../core/events.js";import{aliasOf as i}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/arrayUtils.js";import"../../core/has.js";import"../../core/accessorSupport/ensureType.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import a from"../Widget.js";import o from"./TimePickerViewModel.js";import"./widgetUtils.js";import{messageBundle as n}from"./decorators/messageBundle.js";import{tsx as l}from"./jsxFactory.js";import{DateTime as u}from"luxon";import{formatDate as c}from"../../intl/date.js";import{getLocale as m}from"../../intl/locale.js";const h={base:"esri-time-picker esri-widget",timePicker:"esri-time-picker__date-picker",timePickerInput:"esri-time-picker__input",input:"esri-input",button:"esri-widget--button"},p={hour:"numeric",minute:"numeric"},d="t",_=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Tab"];function v(e){return c(e.valueOf(),p).includes(" ")}let f=class extends a{constructor(e,t){super(e,t),this._activeTime=null,this.label=void 0,this.messages=null,this.value=null,this.viewModel=new o}render(){const e=this._activeTime||this.viewModel.value;return l("div",{class:h.base},l("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes(h.timePickerInput,h.input),onblur:this._handleInputBlur,onfocus:this._handleInputFocus,onkeydown:this._handleInputKeydown,oninput:this._handleInputKeydown,onclick:this._handleInputClick,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:c(e.valueOf(),p)}))}_handleInputBlur(){this._activeTime.isValid&&(this.viewModel.value=this._activeTime.toJSDate()),this._activeTime=null,this._activePart=null}_handleInputUpdate(e){this._selectPart(e,this._activePart)}_selectPart(e,t){const i=this._activeTime;if(!i)return;const s=c(i.valueOf(),p),r=0,a=s.indexOf(":");if("hours"===t)return void e.setSelectionRange(r,a);const o=a+1,n=o+2;if("minutes"===t)return void e.setSelectionRange(o,n);const l=n+1,u=s.length;"meridiem"!==t||e.setSelectionRange(l,u)}_handleInputFocus(e){this._activePart="hours",this._activeTime=u.fromJSDate(this.viewModel.value).startOf("minute"),this._selectPart(e.target,"hours")}_caretIndexToPartName(e){const t=this._activeTime.toFormat(d,{locale:m(),numberingSystem:"latn"}),i=t.indexOf(":"),s=t.indexOf(" ");return e<=i?"hours":e>i&&e<=s?"minutes":"meridiem"}_handleInputKeydown(e){const{ctrlKey:i,metaKey:s,shiftKey:r}=e,a=t(e),o=this._activeTime,n=this._activePart,l=/\d/.test(a),u=/^a|p$/i.test(a),c=s||i;if(_.includes(a)||l||"meridiem"===n&&u&&!c){if("ArrowLeft"===a)this._activePart=this._prevPart();else if("ArrowRight"===a)this._activePart=this._nextPart();else if("Tab"===a){const e=r?this._prevPart():this._nextPart();if(e===this._activePart)return;this._activePart=e}else if("ArrowUp"===a)this._shift("up",n);else if("ArrowDown"===a)this._shift("down",n);else if(l)this._setTime(o,n,Number(a));else if(u){const e=a.toLowerCase(),t=o.hour;("a"===e&&t>=12||"p"===e&&t<12)&&this._shift("up",n)}e.preventDefault(),e.stopImmediatePropagation()}else c||(e.preventDefault(),e.stopImmediatePropagation())}_handleInputClick(e){const t=e.target;this._activePart=null,this.renderNow(),this._activePart=this._caretIndexToPartName(t.selectionStart)}_getOrderedParts(){return v(this._activeTime)?["hours","minutes","meridiem"]:["hours","minutes"]}_prevPart(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)-1;return e[Math.max(t,0)]}_nextPart(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)+1;return e[Math.min(t,e.length-1)]}_setTime(e,t,i){if("hours"===t){const t=v(e)?12:24,s=""+e.hour%t,r=i,a=Number(`${s}${i}`);2===s.length||a>t?this._activeTime=e.set({hour:r}):a<=t&&(this._activeTime=e.set({hour:a}))}else if("minutes"===t){const t=59,s=`${e.minute}`,r=i,a=Number(`${s}${i}`);2===s.length||a>t?this._activeTime=e.set({minute:r}):a<t&&(this._activeTime=e.set({minute:a}))}}_parseTime(e){const t={locale:m(),numberingSystem:"latn"};let i=u.fromFormat(e,d,t);return i.isValid?i:(i=u.fromISO(e,t),i.isValid?i:(i=u.fromRFC2822(e,t),i.isValid?i:(i=u.fromJSDate(new Date(e)),i.isValid?i:null)))}_handleInputPaste(e){const t=e.clipboardData.getData("text/plain"),i=this._parseTime(t);i&&(this._activeTime=i),e.preventDefault(),e.stopImmediatePropagation()}_handleInputWheel(e){const t=e.deltaY<0?"up":"down";this._shift(t,this._activePart)}_shift(e,t){if(!e||!t)return;const i="up"===e?"plus":"minus",s="meridiem"===t?12:1,r="hours"===t?"hour":"minutes"===t?"minute":"hours";this._activeTime=this._activeTime[i]({[r]:s})}};e([s({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0),e([s(),n("esri/widgets/support/t9n/TimePicker")],f.prototype,"messages",void 0),e([i("viewModel.value")],f.prototype,"value",void 0),e([s({type:o})],f.prototype,"viewModel",void 0),f=e([r("esri.widgets.support.TimePicker")],f);const P=f;export{P as default};
