/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../intl","../../core/events","../../core/accessorSupport/decorators/aliasOf","../../core/arrayUtils","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../Widget","./TimePickerViewModel","./widgetUtils","./decorators/messageBundle","../../core/Logger","./jsxFactory","../../chunks/datetime","../../intl/date","../../intl/locale"],(function(e,t,i,s,r,n,a,o,u,c,l,h,d,m,p,_,f,v,P){"use strict";const g={base:"esri-time-picker esri-widget",timePicker:"esri-time-picker__date-picker",timePickerInput:"esri-time-picker__input",input:"esri-input",button:"esri-widget--button"},w={hour:"numeric",minute:"numeric"},T="t",b=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Tab"];function y(e){return v.formatDate(e.valueOf(),w).indexOf(" ")>-1}let I=function(t){function i(e,i){var s;return(s=t.call(this,e,i)||this)._activeTime=null,s.label=void 0,s.messages=null,s.value=null,s.viewModel=new h,s}e._inheritsLoose(i,t);var r=i.prototype;return r.render=function(){const e=this._activeTime||this.viewModel.value;return _.tsx("div",{class:g.base},_.tsx("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes(g.timePickerInput,g.input),onblur:this._handleInputBlur,onfocus:this._handleInputFocus,onkeydown:this._handleInputKeydown,oninput:this._handleInputKeydown,onclick:this._handleInputClick,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:v.formatDate(e.valueOf(),w)}))},r._handleInputBlur=function(){this._activeTime.isValid&&(this.viewModel.value=this._activeTime.toJSDate()),this._activeTime=null,this._activePart=null},r._handleInputUpdate=function(e){this._selectPart(e,this._activePart)},r._selectPart=function(e,t){const i=this._activeTime;if(!i)return;const s=v.formatDate(i.valueOf(),w),r=0,n=s.indexOf(":");if("hours"===t)return void e.setSelectionRange(r,n);const a=n+1,o=a+2;if("minutes"===t)return void e.setSelectionRange(a,o);const u=o+1,c=s.length;"meridiem"!==t||e.setSelectionRange(u,c)},r._handleInputFocus=function(e){this._activePart="hours",this._activeTime=f.DateTime.fromJSDate(this.viewModel.value).startOf("minute"),this._selectPart(e.target,"hours")},r._caretIndexToPartName=function(e){const t=this._activeTime.toFormat(T,{locale:P.getLocale(),numberingSystem:"latn"}),i=t.indexOf(":"),s=t.indexOf(" ");return e<=i?"hours":e>i&&e<=s?"minutes":"meridiem"},r._handleInputKeydown=function(e){const{ctrlKey:t,metaKey:i,shiftKey:r}=e,n=s.eventKey(e),a=this._activeTime,o=this._activePart,u=/\d/.test(n),c=/^a|p$/i.test(n),l=i||t;if(b.indexOf(n)>-1||u||"meridiem"===o&&c&&!l){if("ArrowLeft"===n)this._activePart=this._prevPart();else if("ArrowRight"===n)this._activePart=this._nextPart();else if("Tab"===n){const e=r?this._prevPart():this._nextPart();if(e===this._activePart)return;this._activePart=e}else if("ArrowUp"===n)this._shift("up",o);else if("ArrowDown"===n)this._shift("down",o);else if(u)this._setTime(a,o,Number(n));else if(c){const e=n.toLowerCase(),t=a.hour;("a"===e&&t>=12||"p"===e&&t<12)&&this._shift("up",o)}e.preventDefault(),e.stopImmediatePropagation()}else l||(e.preventDefault(),e.stopImmediatePropagation())},r._handleInputClick=function(e){const t=e.target;this._activePart=null,this.renderNow(),this._activePart=this._caretIndexToPartName(t.selectionStart)},r._getOrderedParts=function(){return y(this._activeTime)?["hours","minutes","meridiem"]:["hours","minutes"]},r._prevPart=function(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)-1;return e[Math.max(t,0)]},r._nextPart=function(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)+1;return e[Math.min(t,e.length-1)]},r._setTime=function(e,t,i){if("hours"===t){const t=y(e)?12:24,s=""+e.hour%t,r=i,n=Number(`${s}${i}`);2===s.length||n>t?e.set({hour:r}):n<=t&&e.set({hour:n})}else if("minutes"===t){const t=59,s=`${e.minute}`,r=i,n=Number(`${s}${i}`);2===s.length||n>t?e.set({minute:r}):n<t&&e.set({minute:n})}},r._parseTime=function(e){const t={locale:P.getLocale(),numberingSystem:"latn"};let i=f.DateTime.fromFormat(e,T,t);return i.isValid?i:(i=f.DateTime.fromISO(e,t),i.isValid?i:(i=f.DateTime.fromRFC2822(e,t),i.isValid?i:(i=f.DateTime.fromJSDate(new Date(e)),i.isValid?i:null)))},r._handleInputPaste=function(e){const t=e.clipboardData.getData("text/plain"),i=this._parseTime(t);i&&(this._activeTime=i),e.preventDefault(),e.stopImmediatePropagation()},r._handleInputWheel=function(e){const t=e.deltaY<0?"up":"down";this._shift(t,this._activePart)},r._shift=function(e,t){if(!e||!t)return;const i="up"===e?"plus":"minus",s="meridiem"===t?12:1,r="hours"===t?"hour":"minutes"===t?"minute":"hours";this._activeTime=this._activeTime[i]({[r]:s})},i}(l);t.__decorate([u.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],I.prototype,"label",void 0),t.__decorate([u.property(),m.messageBundle("esri/widgets/support/t9n/TimePicker")],I.prototype,"messages",void 0),t.__decorate([r.aliasOf("viewModel.value")],I.prototype,"value",void 0),t.__decorate([u.property({type:h})],I.prototype,"viewModel",void 0),I=t.__decorate([c.subclass("esri.widgets.support.TimePicker")],I);return I}));
