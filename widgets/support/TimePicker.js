/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/aliasOf","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/events","../../intl/date","../../intl","../../intl/moment","./widgetUtils","./decorators/messageBundle","./decorators/renderable","../../chunks/index","../Widget","./TimePickerViewModel"],(function(e,t,i,r,s,n,a,o,u,c,l,h,d,p,_,m,f,v,P,g,w){"use strict";const T="esri-time-picker esri-widget",b="esri-time-picker__input",y="esri-input",I={hour:"numeric",minute:"numeric"},x=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Tab"];function O(e){return d.formatDate(e.valueOf(),I).indexOf(" ")>-1}let k=function(t){function i(e,i){var r;return(r=t.call(this,e,i)||this)._activeTime=null,r.label=void 0,r.messages=null,r.value=null,r.viewModel=new w,r}e._inheritsLoose(i,t);var r=i.prototype;return r.loadLocale=async function(){this._moment=await _.loadMoment()},r.render=function(){const e=this._activeTime||this.viewModel.value;return P.jsx("div",{class:T},P.jsx("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes(b,y),onblur:this._handleInputBlur,onfocus:this._handleInputFocus,onkeydown:this._handleInputKeydown,onclick:this._handleInputClick,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:d.formatDate(e.valueOf(),I)}))},r._handleInputBlur=function(){this._activeTime.isValid()&&(this.viewModel.value=this._activeTime.toDate()),this._activeTime=null,this._activePart=null},r._handleInputUpdate=function(e){this._selectPart(e,this._activePart)},r._selectPart=function(e,t){const i=this._activeTime;if(!i)return;const r=d.formatDate(i.valueOf(),I),s=r.indexOf(":");if("hours"===t)return void e.setSelectionRange(0,s);const n=s+1,a=n+2;if("minutes"===t)return void e.setSelectionRange(n,a);const o=a+1,u=r.length;"meridiem"!==t||e.setSelectionRange(o,u)},r._handleInputFocus=function(e){this._activePart="hours",this._activeTime=this._moment(this.viewModel.value).startOf("minute"),this._selectPart(e.target,"hours")},r._caretIndexToPartName=function(e){const t=this._activeTime.format("LT"),i=t.indexOf(":"),r=t.indexOf(" ");return e<=i?"hours":e>i&&e<=r?"minutes":"meridiem"},r._handleInputKeydown=function(e){const{ctrlKey:t,metaKey:i,shiftKey:r}=e,s=h.eventKey(e),n=this._activeTime,a=this._activePart,o=/\d/.test(s),u=/^a|p$/i.test(s),c=i||t;if(x.indexOf(s)>-1||o||"meridiem"===a&&u&&!c){if("ArrowLeft"===s)this._activePart=this._prevPart();else if("ArrowRight"===s)this._activePart=this._nextPart();else if("Tab"===s){const e=r?this._prevPart():this._nextPart();if(e===this._activePart)return;this._activePart=e}else if("ArrowUp"===s)this._shift("up",n,a);else if("ArrowDown"===s)this._shift("down",n,a);else if(o)this._setTime(n,a,Number(s));else if(u){const e=s.toLowerCase(),t=n.hour();("a"===e&&t>=12||"p"===e&&t<12)&&this._shift("up",n,a)}e.preventDefault(),e.stopImmediatePropagation()}else c||(e.preventDefault(),e.stopImmediatePropagation())},r._handleInputClick=function(e){const t=e.target;this._activePart=null,this.renderNow(),this._activePart=this._caretIndexToPartName(t.selectionStart)},r._getOrderedParts=function(){return O(this._activeTime)?["hours","minutes","meridiem"]:["hours","minutes"]},r._prevPart=function(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)-1;return e[Math.max(t,0)]},r._nextPart=function(){const e=this._getOrderedParts(),t=e.indexOf(this._activePart)+1;return e[Math.min(t,e.length-1)]},r._setTime=function(e,t,i){if("hours"===t){const t=O(e)?12:24,r=""+e.hour()%t,s=i,n=Number(`${r}${i}`);2===r.length||n>t?e.hour(s):n<=t&&e.hour(n)}else if("minutes"===t){const t=59,r=`${e.minute()}`,s=i,n=Number(`${r}${i}`);2===r.length||n>t?e.minute(s):n<t&&e.minute(n)}},r._handleInputPaste=function(e){const t=e.clipboardData.getData("text/plain"),i=this._moment(t);i.isValid()&&(this._activeTime=i),e.preventDefault(),e.stopImmediatePropagation()},r._handleInputWheel=function(e){const t=e.deltaY<0?"up":"down";this._shift(t,this._activeTime,this._activePart)},r._shift=function(e,t,i){if(!e||!t||!i)return;const r="meridiem"===i?12:1,s="hours"===i?"hour":"minutes"===i?"minute":"hours";t["up"===e?"add":"subtract"](r,s)},i}(g);return t.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],k.prototype,"label",void 0),t.__decorate([n.property(),v.renderable(),f.messageBundle("esri/widgets/support/t9n/TimePicker")],k.prototype,"messages",void 0),t.__decorate([a.aliasOf("viewModel.value")],k.prototype,"value",void 0),t.__decorate([n.property({type:w}),v.renderable("viewModel.value")],k.prototype,"viewModel",void 0),k=t.__decorate([o.subclass("esri.widgets.support.TimePicker")],k),k}));
