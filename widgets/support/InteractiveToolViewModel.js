/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/Error","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/promiseUtils","../../core/Accessor","../../core/Handles","../../core/watchUtils","../../views/interactive/interactiveToolUtils"],(function(e,o,t,r,i,s,l,n,c,a,p,u,d,h,v,_,y){"use strict";e.InteractiveToolViewModel=function(e){function t(o){var t;return(t=e.call(this,o)||this).tool=null,t._baseHandles=new v,t._loggedUnsupportedErrorOnce=!1,t._creationAbortController=null,o&&null!=o.visible&&(t.visible=o.visible),t}o._inheritsLoose(t,e);var r=t.prototype;return r.initialize=function(){this._baseHandles.add(_.init(this,["view.ready","isSupported"],(()=>{this.view&&this.view.ready&&!this.isSupported?this._loggedUnsupportedErrorOnce||(this.logUnsupportedError(),this._loggedUnsupportedErrorOnce=!0):this._loggedUnsupportedErrorOnce=!1})))},r.destroy=function(){this.removeTool(),this.view=null,this._baseHandles.destroy(),this._baseHandles=null},r.createTool=async function(){if(this.removeTool(),!this.isSupported)return d.reject(new c("tool:create","The view does not support the tool"));const e=this.createToolParams(),o=()=>{const o=y.evaluateToolConstructorArguments(e.constructorArguments);return{visible:this.visible,...o}},t=new AbortController,r=t.signal;this._creationAbortController=t;const i=()=>{t===this._creationAbortController&&(this._creationAbortController=null)};try{const t=await this.view.createTool(e.toolConstructor,o,{signal:r});this._set("tool",t),i()}catch(e){throw i(),e}},r.removeTool=function(){this._creationAbortController&&this._creationAbortController.abort(),this._creationAbortController=null;const e=this.tool;e&&(this.view&&this.view.tools&&this.view.tools.remove(e),e.destroyed||e.destroy(),this._set("tool",null))},o._createClass(t,[{key:"isSupported",get:function(){return!this.view||this.view.type===this.supportedViewType}},{key:"view",get:function(){return this._get("view")},set:function(e){if(e===this.view)return;this.removeTool(),this._set("view",e);const o="tools";this._baseHandles.remove(o),e&&this._baseHandles.add(e.tools.on("change",(e=>{if(this.tool)for(const o of e.removed)if(this.tool===o){o.destroyed||o.destroy(),this._set("tool",null);break}})),o)}},{key:"visible",set:function(e){this._set("visible",e),this.tool&&(this.tool.visible=e),!e&&this._creationAbortController&&(this._creationAbortController.abort(),this._creationAbortController=null)}},{key:"active",get:function(){return null!=this._creationAbortController||null!=this.tool&&this.tool.active}},{key:"isDisabled",get:function(){return!this.view||!this.view.ready||!this.isSupported}},{key:"creatingTool",get:function(){return!!this._creationAbortController}}]),t}(h),t.__decorate([l.property({constructOnly:!0})],e.InteractiveToolViewModel.prototype,"tool",void 0),t.__decorate([l.property({dependsOn:["view.type"]})],e.InteractiveToolViewModel.prototype,"isSupported",null),t.__decorate([l.property({value:null})],e.InteractiveToolViewModel.prototype,"view",null),t.__decorate([l.property({type:Boolean,value:!0})],e.InteractiveToolViewModel.prototype,"visible",null),t.__decorate([l.property({dependsOn:["_creationAbortController","tool.active"]})],e.InteractiveToolViewModel.prototype,"active",null),t.__decorate([l.property({dependsOn:["view","view.ready","isSupported"]})],e.InteractiveToolViewModel.prototype,"isDisabled",null),t.__decorate([l.property()],e.InteractiveToolViewModel.prototype,"_creationAbortController",void 0),t.__decorate([l.property({readOnly:!0,dependsOn:["_creationAbortController"]})],e.InteractiveToolViewModel.prototype,"creatingTool",null),e.InteractiveToolViewModel=t.__decorate([n.subclass("esri.widgets.support.InteractiveToolViewModel")],e.InteractiveToolViewModel),Object.defineProperty(e,"__esModule",{value:!0})}));
