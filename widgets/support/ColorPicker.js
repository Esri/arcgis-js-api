/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Color","../../core/Handles","../../core/handleUtils","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/trackingUtils","../Widget","./jsxFactory","./Popover","./widgetUtils","./decorators/messageBundle"],(function(e,o,t,n,r,i,s,a,l,c,p,u,h,_,d,v,m,f,C){"use strict";const y="esri-color-picker",P={base:y,backgroundPattern:`${y}__bg-pattern`,toggleButton:`${y}__toggle-button`,popover:`${y}__popover`,opacitySliderContainer:`${y}__opacity-slider-container`,opacitySlider:`${y}__opacity-slider`};function b(e,o){const t=setTimeout(e,o);return s.makeHandle((()=>clearTimeout(t)))}function g(e,o,t=50){let n;function r(){e()?o():n=setTimeout(r,t)}return n=setTimeout(r,t),s.makeHandle((()=>clearTimeout(n)))}o.ColorPicker=function(o){function n(e,t){var n;return(n=o.call(this,e,t)||this).value=new r,n.alphaEnabled=!0,n._handles=new i,n._containerElement=null,n._popover=null,n._popoverElement=null,n._buttonElement=null,n}t._inheritsLoose(n,o);var s=n.prototype;return s.initialize=function(){this.own(_.autorun((()=>{a.applySome(this._containerElement,(e=>{e.style.setProperty("--esri-color-picker-value",this.value.toCss(!0))}))})))},s.loadDependencies=function(){return Promise.all([new Promise((function(o,t){e(["../../chunks/button"],o,t)})),new Promise((function(o,t){e(["../../chunks/color-picker"],o,t)})),new Promise((function(o,t){e(["../../chunks/label"],o,t)})),new Promise((function(o,t){e(["../../chunks/slider"],o,t)}))])},s.destroy=function(){this._destroyPopover(),this._handles=a.destroyMaybe(this._handles),this._buttonElement=null},s.render=function(){const e=this._messages,o=a.isSome(this._popover)&&this._popover.open?e.close:e.open;return v.tsx("div",{class:this.classes(P.base,this.class),bind:this,afterCreate:this._onContainerAfterCreate},v.tsx("div",{class:P.backgroundPattern}),v.tsx("calcite-button",{appearance:"transparent",label:o,class:P.toggleButton,color:"neutral",id:this.id,scale:"s",tabIndex:-1,title:o,bind:this,onclick:this._togglePopover,afterCreate:this._onButtonAfterCreate}))},s._onContainerAfterCreate=function(e){this._containerElement=e},s._onButtonAfterCreate=function(e){this._destroyPopover(),this._buttonElement=e,this._popover=new m({owner:this,anchorElement:e,placement:"bottom-start",renderContentFunction:this._renderPopoverContent})},s._destroyPopover=function(){this._handles.remove("hex-input-poll-timeout"),this._popover=a.destroyMaybe(this._popover),this._popoverElement=null},s._renderPopoverContent=function(){const e=this.value,o=this._messages;return v.tsx("div",{class:P.popover,tabIndex:-1,bind:this,afterCreate:this._onPopoverAfterCreate,onfocusout:this._onPopoverFocusOut,onkeydown:this._onPopoverKeyDown},v.tsx("calcite-color-picker",{appearance:"minimal",hideSaved:!0,hideChannels:!0,scale:"m",value:e.toCss(),bind:this,onCalciteColorPickerInput:this._onColorInput,afterCreate:this._onColorPickerAfterCreate}),this.alphaEnabled&&v.tsx("section",{class:P.opacitySliderContainer},v.tsx("calcite-label",{scale:"s"},o.opacity,v.tsx("calcite-slider",{class:P.opacitySlider,labelHandles:!0,min:0,max:1,step:.01,value:e.a,bind:this,onCalciteSliderChange:this._onOpacityChange}))))},s._onColorInput=function(e){const o=e.target.value,t="string"==typeof o?r.fromRgb(o):new r;t.a=this.value.a,this._onChange(t)},s._onOpacityChange=function(e){const o=e.target,t=this.value.clone();t.a=o.value,this._onChange(t)},s._onChange=function(e){this.value=e,a.isSome(this.onChange)&&this.onChange(e)},s._onColorPickerAfterCreate=function(e){this._handles.remove("hex-input-poll-timeout"),this._handles.add(g((()=>!!e.hexInputNode),(()=>{this._handles.remove("hex-input-poll-timeout"),e.setFocus()})),"hex-input-poll-timeout")},s._togglePopover=function(e){a.isSome(this._popover)&&this._popover.open?this._closePopover():this._openPopover()},s._openPopover=function(){a.applySome(this._popover,(e=>e.open=!0))},s._closePopover=function(){this._handles.remove("hex-input-poll-timeout"),a.applySome(this._popover,(e=>e.open=!1)),this._setFocusOnButton()},s._setFocusOnButton=function(){this._handles.remove("button-focus-timeout"),this._handles.add(b((()=>{a.applySome(this._buttonElement,(e=>e.setFocus()))})),"button-focus-timeout")},s._onPopoverAfterCreate=function(e){this._popoverElement=e},s._onPopoverFocusOut=function(e){const o=this._popoverElement;if(a.isNone(o))return;const t=e.relatedTarget;if(t&&t instanceof Node){if(o.contains(t))return;if(t===this._buttonElement||this._isAssociatedLabel(t))return}this._closePopover()},s._isAssociatedLabel=function(e){var o;const t=this.id,n=null==(o=e.tagName)?void 0:o.toLowerCase();return"calcite-label"===n&&e.for===t||"label"===n&&e.htmlFor===t},s._onPopoverKeyDown=function(e){"Escape"!==e.key&&"Enter"!==e.key||(e.stopPropagation(),this._closePopover())},n}(d),n.__decorate([l.property()],o.ColorPicker.prototype,"class",void 0),n.__decorate([l.property()],o.ColorPicker.prototype,"value",void 0),n.__decorate([l.property()],o.ColorPicker.prototype,"alphaEnabled",void 0),n.__decorate([l.property()],o.ColorPicker.prototype,"onChange",void 0),n.__decorate([l.property()],o.ColorPicker.prototype,"_containerElement",void 0),n.__decorate([l.property()],o.ColorPicker.prototype,"_popover",void 0),n.__decorate([l.property()],o.ColorPicker.prototype,"_popoverElement",void 0),n.__decorate([l.property()],o.ColorPicker.prototype,"_buttonElement",void 0),n.__decorate([l.property(),C.messageBundle("esri/widgets/support/t9n/ColorPicker")],o.ColorPicker.prototype,"_messages",void 0),o.ColorPicker=n.__decorate([h.subclass("esri.widgets.support.ColorPicker")],o.ColorPicker),Object.defineProperty(o,"__esModule",{value:!0})}));
