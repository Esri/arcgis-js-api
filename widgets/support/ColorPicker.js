/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Color","../../core/asyncUtils","../../core/Handles","../../core/handleUtils","../../core/maybe","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../Widget","./Popover","./widgetUtils","./decorators/messageBundle","./jsxFactory"],(function(e,o,t,r,n,i,s,a,c,l,p,u,_,d,h,v,C,m,y,P){"use strict";const f="esri-color-picker",k={base:f,backgroundPattern:`${f}__bg-pattern`,toggleButton:`${f}__toggle-button`,popover:`${f}__popover`,opacitySliderContainer:`${f}__opacity-slider-container`,opacitySlider:`${f}__opacity-slider`};var b;function g(e,o){const t=setTimeout(e,o);return a.makeHandle((()=>clearTimeout(t)))}!function(e){e.ColorPickerFocus="hex-input-poll-timeout",e.ButtonFocusTimeout="button-focus-timeout"}(b||(b={})),o.ColorPicker=function(o){function r(e,t){var r;return(r=o.call(this,e,t)||this).value=new n,r.alphaEnabled=!0,r._handles=new s,r._containerElement=null,r._popover=null,r._popoverElement=null,r._buttonElement=null,r._colorPickerCreated=!1,r}t._inheritsLoose(r,o);var u=r.prototype;return u.initialize=function(){this.addHandles(p.watch((()=>({container:this._containerElement,value:this.value})),(({container:e,value:o})=>{c.applySome(e,(e=>{e.style.setProperty("--esri-color-picker-value",o.toCss(!0))}))}),p.syncAndInitial))},u.loadDependencies=function(){return Promise.all([new Promise(((o,t)=>e(["../../chunks/calcite-button"],o,t))),new Promise(((o,t)=>e(["../../chunks/calcite-color-picker"],o,t))),new Promise(((o,t)=>e(["../../chunks/calcite-label"],o,t))),new Promise(((o,t)=>e(["../../chunks/calcite-slider"],o,t)))])},u.destroy=function(){this._destroyPopover(),this._handles=c.destroyMaybe(this._handles),this._buttonElement=null},u.render=function(){const e=this._messages,o=c.isSome(this._popover)&&this._popover.open?e.close:e.open;return P.tsx("div",{class:this.classes(k.base,this.class),bind:this,afterCreate:this._onContainerAfterCreate},P.tsx("div",{class:k.backgroundPattern}),P.tsx("calcite-button",{appearance:"transparent",label:o,class:k.toggleButton,color:"neutral",id:this.id,scale:"s",tabIndex:-1,title:o,bind:this,onclick:this._togglePopover,afterCreate:this._onButtonAfterCreate}))},u._onContainerAfterCreate=function(e){this._containerElement=e},u._onButtonAfterCreate=function(e){this._destroyPopover(),this._buttonElement=e,this._popover=new C({owner:this,anchorElement:e,placement:"bottom-start",renderContentFunction:this._renderPopoverContent})},u._destroyPopover=function(){this._handles.remove(b.ColorPickerFocus),this._popover=c.destroyMaybe(this._popover),this._popoverElement=null},u._renderPopoverContent=function(){const e=this.value,o=this._messages;return P.tsx("div",{class:k.popover,tabIndex:-1,bind:this,afterCreate:this._onPopoverAfterCreate,onfocusout:this._onPopoverFocusOut,onkeydown:this._onPopoverKeyDown},P.tsx("calcite-color-picker",{appearance:"minimal",hideSaved:!0,hideChannels:!0,scale:"m",value:this._colorPickerCreated?e.toCss():null,bind:this,onCalciteColorPickerInput:this._onColorInput,afterCreate:this._onColorPickerAfterCreate,afterRemoved:()=>this._colorPickerCreated=!1}),this.alphaEnabled&&P.tsx("section",{class:k.opacitySliderContainer},P.tsx("calcite-label",{scale:"s"},o.opacity,P.tsx("calcite-slider",{class:k.opacitySlider,labelHandles:!0,min:0,max:1,step:.01,value:e.a,bind:this,onCalciteSliderInput:this._onOpacityChange}))))},u._onColorInput=function(e){const o=e.target.value,t="string"==typeof o?new n(o):new n;t.a=this.value.a,this._onChange(t)},u._onOpacityChange=function(e){const o=e.target,t=this.value.clone();t.a=o.value,this._onChange(t)},u._onChange=function(e){this.value=e,c.isSome(this.onChange)&&this.onChange(e)},u._onColorPickerAfterCreate=function(e){var o=this;this._handles.remove(b.ColorPickerFocus);const r=i.createTask(function(){var r=t._asyncToGenerator((function*(t){yield e.componentOnReady?.(),l.throwIfAborted(t),o._colorPickerCreated=!0,yield new Promise((e=>requestAnimationFrame(e))),l.throwIfAborted(t),e.setFocus()}));return function(e){return r.apply(this,arguments)}}());this._handles.add(a.makeHandle((()=>{r.abort(),this._colorPickerCreated=!1})),b.ColorPickerFocus)},u._togglePopover=function(e){c.isSome(this._popover)&&this._popover.open?this._closePopover():this._openPopover()},u._openPopover=function(){c.applySome(this._popover,(e=>e.open=!0))},u._closePopover=function(){this._handles.remove(b.ColorPickerFocus),c.applySome(this._popover,(e=>e.open=!1)),this._setFocusOnButton()},u._setFocusOnButton=function(){this._handles.remove(b.ButtonFocusTimeout),this._handles.add(g((()=>{c.applySome(this._buttonElement,(e=>e.setFocus()))})),b.ButtonFocusTimeout)},u._onPopoverAfterCreate=function(e){this._popoverElement=e},u._onPopoverFocusOut=function(e){const o=this._popoverElement;if(c.isNone(o))return;const t=e.relatedTarget;if(t&&t instanceof Node){if(o.contains(t))return;if(t===this._buttonElement||this._isAssociatedLabel(t))return}this._closePopover()},u._isAssociatedLabel=function(e){const o=this.id,t=e.tagName?.toLowerCase();return"calcite-label"===t&&e.for===o||"label"===t&&e.htmlFor===o},u._onPopoverKeyDown=function(e){"Escape"!==e.key&&"Enter"!==e.key||(e.stopPropagation(),this._closePopover())},r}(v),r.__decorate([u.property()],o.ColorPicker.prototype,"class",void 0),r.__decorate([u.property()],o.ColorPicker.prototype,"value",void 0),r.__decorate([u.property()],o.ColorPicker.prototype,"alphaEnabled",void 0),r.__decorate([u.property()],o.ColorPicker.prototype,"onChange",void 0),r.__decorate([u.property()],o.ColorPicker.prototype,"_containerElement",void 0),r.__decorate([u.property()],o.ColorPicker.prototype,"_popover",void 0),r.__decorate([u.property()],o.ColorPicker.prototype,"_popoverElement",void 0),r.__decorate([u.property()],o.ColorPicker.prototype,"_buttonElement",void 0),r.__decorate([u.property(),y.messageBundle("esri/widgets/support/t9n/ColorPicker")],o.ColorPicker.prototype,"_messages",void 0),r.__decorate([u.property()],o.ColorPicker.prototype,"_colorPickerCreated",void 0),o.ColorPicker=r.__decorate([h.subclass("esri.widgets.support.ColorPicker")],o.ColorPicker),Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
