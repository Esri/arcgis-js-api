/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../chunks/button","../../chunks/utils","../../chunks/label","../../Color","../../core/Handles","../../core/handleUtils","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/trackingUtils","../Widget","./jsxFactory","./Popover","./widgetUtils","./decorators/messageBundle"],(function(e,t,o,r,i,n,s,a,c,l,p,u,h,_,d,v,C,m,b,y,f){"use strict";i.register({"calcite-color-picker":i.CalciteColorPicker,"calcite-tab-title":i.CalciteTabTitle,"calcite-tab":i.CalciteTab,"calcite-input":i.CalciteInput,"calcite-color-picker-hex-input":i.CalciteColorPickerHexInput,"calcite-tabs":i.CalciteTabs,"calcite-tab-nav":i.CalciteTabNav,"calcite-button":i.CalciteButton,"calcite-color-picker-swatch":i.CalciteColorPickerSwatch,"calcite-icon":i.CalciteIcon,"calcite-progress":i.CalciteProgress,"calcite-loader":i.CalciteLoader}),i.register({"calcite-slider":i.CalciteSlider,"calcite-graph":i.CalciteGraph});const g="esri-color-picker",P={base:g,backgroundPattern:`${g}__bg-pattern`,toggleButton:`${g}__toggle-button`,popover:`${g}__popover`,opacitySliderContainer:`${g}__opacity-slider-container`,opacitySlider:`${g}__opacity-slider`};function k(e,t){const o=setTimeout(e,t);return c.makeHandle((()=>clearTimeout(o)))}function x(e,t,o=50){let r;function i(){e()?t():r=setTimeout(i,o)}return r=setTimeout(i,o),c.makeHandle((()=>clearTimeout(r)))}e.ColorPicker=function(e){function o(t,o){var r;return(r=e.call(this,t,o)||this).value=new s,r.alphaEnabled=!0,r._handles=new a,r._containerElement=null,r._popover=null,r._popoverElement=null,r._buttonElement=null,r}t._inheritsLoose(o,e);var r=o.prototype;return r.initialize=function(){this.own(v.autorun((()=>{l.applySome(this._containerElement,(e=>{e.style.setProperty("--esri-color-picker-value",this.value.toCss(!0))}))})))},r.destroy=function(){this._destroyPopover(),this._handles=l.destroyMaybe(this._handles),this._buttonElement=null},r.render=function(){const e=this._messages,t=l.isSome(this._popover)&&this._popover.open?e.close:e.open;return m.tsx("div",{class:this.classes(P.base,this.class),bind:this,afterCreate:this._onContainerAfterCreate},m.tsx("div",{class:P.backgroundPattern}),m.tsx("calcite-button",{appearance:"transparent","aria-label":t,class:P.toggleButton,color:"neutral",id:this.id,scale:"s",tabIndex:-1,title:t,bind:this,onclick:this._togglePopover,afterCreate:this._onButtonAfterCreate}))},r._onContainerAfterCreate=function(e){this._containerElement=e},r._onButtonAfterCreate=function(e){this._destroyPopover(),this._buttonElement=e,this._popover=new b({owner:this,anchorElement:e,placement:"bottom-start",renderContentFunction:this._renderPopoverContent})},r._destroyPopover=function(){this._handles.remove("hex-input-poll-timeout"),this._popover=l.destroyMaybe(this._popover),this._popoverElement=null},r._renderPopoverContent=function(){const e=this.value,t=this._messages;return m.tsx("div",{class:P.popover,tabIndex:-1,bind:this,afterCreate:this._onPopoverAfterCreate,onfocusout:this._onPopoverFocusOut,onkeydown:this._onPopoverKeyDown},m.tsx("calcite-color-picker",{appearance:"minimal",hideSaved:!0,hideChannels:!0,scale:"m",value:e.toCss(),bind:this,onCalciteColorPickerChange:this._onColorChange,afterCreate:this._onColorPickerAfterCreate}),this.alphaEnabled&&m.tsx("section",{class:P.opacitySliderContainer},m.tsx("calcite-label",{scale:"s"},t.opacity,m.tsx("calcite-slider",{class:P.opacitySlider,labelHandles:!0,min:0,max:1,step:.01,value:e.a,bind:this,onCalciteSliderChange:this._onOpacityChange}))))},r._onColorChange=function(e){const t=e.target.value,o="string"==typeof t?s.fromRgb(t):new s;o.a=this.value.a,this._onChange(o)},r._onOpacityChange=function(e){const t=e.target,o=this.value.clone();o.a=t.value,this._onChange(o)},r._onChange=function(e){this.value=e,l.isSome(this.onChange)&&this.onChange(e)},r._onColorPickerAfterCreate=function(e){this._handles.remove("hex-input-poll-timeout"),this._handles.add(x((()=>!!e.hexInputNode),(()=>{this._handles.remove("hex-input-poll-timeout"),e.setFocus()})),"hex-input-poll-timeout")},r._togglePopover=function(e){l.isSome(this._popover)&&this._popover.open?this._closePopover():this._openPopover()},r._openPopover=function(){l.applySome(this._popover,(e=>e.open=!0))},r._closePopover=function(){this._handles.remove("hex-input-poll-timeout"),l.applySome(this._popover,(e=>e.open=!1)),this._setFocusOnButton()},r._setFocusOnButton=function(){this._handles.remove("button-focus-timeout"),this._handles.add(k((()=>{l.applySome(this._buttonElement,(e=>e.setFocus()))})),"button-focus-timeout")},r._onPopoverAfterCreate=function(e){this._popoverElement=e},r._onPopoverFocusOut=function(e){const t=this._popoverElement;if(l.isNone(t))return;const o=e.relatedTarget;if(o&&o instanceof Node){if(t.contains(o))return;if(o===this._buttonElement||this._isAssociatedLabel(o))return}this._closePopover()},r._isAssociatedLabel=function(e){var t;const o=this.id,r=null==(t=e.tagName)?void 0:t.toLowerCase();return"calcite-label"===r&&e.for===o||"label"===r&&e.htmlFor===o},r._onPopoverKeyDown=function(e){"Escape"!==e.key&&"Enter"!==e.key||(e.stopPropagation(),this._closePopover())},o}(C),o.__decorate([p.property()],e.ColorPicker.prototype,"class",void 0),o.__decorate([p.property()],e.ColorPicker.prototype,"value",void 0),o.__decorate([p.property()],e.ColorPicker.prototype,"alphaEnabled",void 0),o.__decorate([p.property()],e.ColorPicker.prototype,"onChange",void 0),o.__decorate([p.property()],e.ColorPicker.prototype,"_containerElement",void 0),o.__decorate([p.property()],e.ColorPicker.prototype,"_popover",void 0),o.__decorate([p.property()],e.ColorPicker.prototype,"_popoverElement",void 0),o.__decorate([p.property()],e.ColorPicker.prototype,"_buttonElement",void 0),o.__decorate([p.property(),f.messageBundle("esri/widgets/support/t9n/ColorPicker")],e.ColorPicker.prototype,"_messages",void 0),e.ColorPicker=o.__decorate([d.subclass("esri.widgets.support.ColorPicker")],e.ColorPicker),Object.defineProperty(e,"__esModule",{value:!0})}));
