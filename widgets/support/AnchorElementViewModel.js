/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Evented","../../core/Handles","../../core/watchUtils"],(function(e,t,n,o,i,r,s,c,a,l,d,p,h){"use strict";let u=function(t){function n(...n){var o;return(o=t.call(this,...n)||this)._anchorHandles=new p,o.location=null,o.screenLocation=null,o.screenLocationEnabled=!1,o.view=null,o._anchorHandles.add([h.watch(e._assertThisInitialized(o),["screenLocationEnabled","location","view.size","view.stationary"],(()=>o._updateScreenPointAndHandle())),h.watch(e._assertThisInitialized(o),["view","view.ready"],(()=>o._wireUpView()))]),o}e._inheritsLoose(n,t);var o=n.prototype;return o.destroy=function(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null},o._wireUpView=function(){const e="view";this._anchorHandles.remove(e),this._viewpointHandle=null;if(!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,n="3d"===t.type?"camera":"viewpoint",o=h.pausable(t,n,(()=>this._viewpointChange()));this._anchorHandles.add(o,e),this._viewpointHandle=o,this._toggleWatchingViewpoint()},o._viewpointChange=function(){this._setScreenLocation(),this.emit("view-change")},o._updateScreenPointAndHandle=function(){this._setScreenLocation(),this._toggleWatchingViewpoint()},o._toggleWatchingViewpoint=function(){const{_viewpointHandle:e,location:t,screenLocationEnabled:n}=this;if(!e)return;t&&n?e.resume():e.pause()},o._setScreenLocation=function(){const{location:e,view:t,screenLocationEnabled:n}=this,o=this.get("view.ready"),i=n&&e&&o?t.toScreen(e):null;this._set("screenLocation",i)},n}(d.EventedAccessor);return t.__decorate([r.property()],u.prototype,"location",void 0),t.__decorate([r.property({readOnly:!0})],u.prototype,"screenLocation",void 0),t.__decorate([r.property()],u.prototype,"screenLocationEnabled",void 0),t.__decorate([r.property()],u.prototype,"view",void 0),u=t.__decorate([s.subclass("esri.widgets.support.AnchorElementViewModel")],u),u}));
