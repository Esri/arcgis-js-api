/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Evented","../../core/Handles","../../core/watchUtils"],(function(e,t,o,n,i,r,s,c,a,l,d,p,h,u){"use strict";let _=function(t){function o(o){var n;return(n=t.call(this,o)||this)._anchorHandles=new h,n.location=null,n.screenLocation=null,n.screenLocationEnabled=!1,n.view=null,n._anchorHandles.add([u.watch(e._assertThisInitialized(n),["screenLocationEnabled","location","view.size","view.stationary"],(()=>n._updateScreenPointAndHandle())),u.watch(e._assertThisInitialized(n),["view","view.ready"],(()=>n._wireUpView()))]),n}e._inheritsLoose(o,t);var i=o.prototype;return i.destroy=function(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null},i._wireUpView=function(){const e="view";this._anchorHandles.remove(e),this._viewpointHandle=null;if(!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,o="3d"===t.type?"camera":"viewpoint",n=u.pausable(t,o,(()=>this._viewpointChange()));this._anchorHandles.add(n,e),this._viewpointHandle=n,this._toggleWatchingViewpoint()},i._viewpointChange=function(){this._setScreenLocation(),this.emit("view-change")},i._updateScreenPointAndHandle=function(){this._setScreenLocation(),this._toggleWatchingViewpoint()},i._toggleWatchingViewpoint=function(){const{_viewpointHandle:e,location:t,screenLocationEnabled:o}=this;if(!e)return;t&&o?e.resume():e.pause()},i._setScreenLocation=function(){const{location:e,view:t,screenLocationEnabled:o}=this,i=this.get("view.ready"),r=o&&i&&n.isSome(e)?t.toScreen(e):null;this._set("screenLocation",r)},o}(p.EventedAccessor);return t.__decorate([s.property()],_.prototype,"location",void 0),t.__decorate([s.property({readOnly:!0})],_.prototype,"screenLocation",void 0),t.__decorate([s.property()],_.prototype,"screenLocationEnabled",void 0),t.__decorate([s.property()],_.prototype,"view",void 0),_=t.__decorate([c.subclass("esri.widgets.support.AnchorElementViewModel")],_),_}));
