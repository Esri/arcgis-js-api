/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as o}from"../../chunks/tslib.es6.js";import{handlesGroup as e}from"../../core/handleUtils.js";import{removeMaybe as t}from"../../core/maybe.js";import{aliasOf as s}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/arrayUtils.js";import"../../core/has.js";import{cast as i}from"../../core/accessorSupport/decorators/cast.js";import{property as l}from"../../core/accessorSupport/decorators/property.js";import{subclass as a}from"../../core/accessorSupport/decorators/subclass.js";import c from"../Widget.js";import"./widgetUtils.js";import{messageBundle as r}from"./decorators/messageBundle.js";import{tsx as n}from"./jsxFactory.js";import d from"./SelectionToolbar/SelectionToolbarViewModel.js";const p={lassoTool:!0,rectangleTool:!0},m={createTool:"polygon",createOptions:{mode:"freehand"}},h={createTool:"rectangle"},v={base:"esri-selection-toolbar",container:"esri-selection-toolbar__container",toolButton:"esri-selection-toolbar__tool-button",disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"};let g=class extends c{constructor(o,t){super(o,t),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.label=void 0,this.layers=[],this.messages=null,this.toolConfigs=[],this.view=null,this.viewModel=new d,this.visibleElements={...p},this._viewModelHandlesGroup=e([this.viewModel.on("selection-change",(o=>this.emit("selection-change",o))),this.viewModel.on("complete",(o=>{this._set("activeToolInfo",null),this.emit("complete",o)}))])}destroy(){this._viewModelHandlesGroup=t(this._viewModelHandlesGroup)}loadDependencies(){return Promise.all([import("@esri/calcite-components/dist/components/calcite-action.js"),import("@esri/calcite-components/dist/components/calcite-icon.js")])}castVisibleElements(o){return{...p,...o}}activate(o){switch(this.cancel(),o){case"lasso":this._activateTool("lasso");case"rectangle":this._activateTool("rectangle");default:this._activateTool(o)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return n("div",{"aria-label":this.label,class:this.classes(v.base,v.esriWidget)},n("div",{class:v.container},this.renderDefaultTools(),this.renderCustomTools()))}renderDefaultTools(){if("2d"===this.view?.type)return[this.renderRectangleTool(),this.renderLassoTool()]}renderCustomTools(){if(this.toolConfigs&&this.toolConfigs.length)return this.toolConfigs.map((o=>n("calcite-action",{active:this.activeToolInfo?.toolName===o.toolName,bind:this,class:v.toolButton,label:o.toolName,onclick:()=>this._onCustomToolClick(o.toolName),scale:"s",text:o.toolName,title:o.toolName},n("calcite-icon",{scale:"s",icon:o.icon||"selection"}))))}renderLassoTool(){const{activeToolInfo:o,messages:e,visibleElements:t}=this;if(t.lassoTool)return n("calcite-action",{active:"lasso"===o?.toolName,bind:this,label:e.selectByLasso,onclick:this._onLassoToolClick,scale:"s",text:e.selectByLasso,title:e.selectByLasso},n("calcite-icon",{scale:"s",icon:"lasso"}))}renderRectangleTool(){const{activeToolInfo:o,messages:e,visibleElements:t}=this;if(t.rectangleTool)return n("calcite-action",{active:"rectangle"===o?.toolName,bind:this,label:e.selectByRectangle,onclick:this._onRectangleToolClick,scale:"s",text:e.selectByRectangle,title:e.selectByRectangle},n("calcite-icon",{scale:"s",icon:"cursor-marquee"}))}_onCustomToolClick(o){this._toggleTool(o)}_onLassoToolClick(){this._toggleTool("lasso")}_onRectangleToolClick(){this._toggleTool("rectangle")}_activateTool(o){const e=this._getToolOptions(o);if(!e)return;const t=this.viewModel.activate(e);this._set("activeToolInfo",{toolName:o,operation:t})}_toggleTool(o){if(this.activeToolInfo){const e=this.activeToolInfo.toolName;if(this.cancel(),e===o)return}this._activateTool(o)}_getToolOptions(o){if("lasso"===o)return m;if("rectangle"===o)return h;const e=this.toolConfigs.find((e=>e.toolName===o));if(!e)return;const{createTool:t,createOptions:s,selectionOptions:i}=e;return{createTool:t,createOptions:s,selectionOptions:i}}};o([l({readOnly:!0})],g.prototype,"activeToolInfo",void 0),o([l({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g.prototype,"label",void 0),o([s("viewModel.layers")],g.prototype,"layers",void 0),o([l(),r("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],g.prototype,"messages",void 0),o([l()],g.prototype,"toolConfigs",void 0),o([s("viewModel.view")],g.prototype,"view",void 0),o([l()],g.prototype,"viewModel",void 0),o([l()],g.prototype,"visibleElements",void 0),o([i("visibleElements")],g.prototype,"castVisibleElements",null),g=o([a("esri.widgets.support.SelectionToolbar")],g);const u=g;export{u as default};
