/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../symbols.js";import t from"../../../core/Collection.js";import o from"../../../core/Evented.js";import s from"../../../core/Handles.js";import{property as i}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/arrayUtils.js";import"../../../core/has.js";import"../../../core/accessorSupport/ensureType.js";import{subclass as l}from"../../../core/accessorSupport/decorators/subclass.js";import r from"../../../layers/GraphicsLayer.js";import n from"../../Sketch/SketchViewModel.js";import{updateSelection as c}from"./selectorUtils.js";import a from"../../../symbols/SimpleFillSymbol.js";import p from"../../../symbols/SimpleLineSymbol.js";import h from"../../../symbols/SimpleMarkerSymbol.js";let d=class extends o.EventedAccessor{constructor({candidates:e,options:o,view:i}){super(),this._activeOptions=null,this._dashedFillSymbol=new a({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),this._dashedLineSymbol=new p({style:"dash",color:[12,207,255],width:2}),this._defaultOptions={createTool:"rectangle",createOptions:null,selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},this._completed=!1,this._handles=new s,this._sketchViewModel=new n,this._sketchGraphicsLayer=new r({listMode:"hide",internal:!0}),this._transparentPointSymbol=new h({color:[0,0,0,0],outline:{style:"none",width:0}}),this.candidates=null,this.geometry=null,this.options=null,this.selection=new t,this.view=null,this.candidates=e,this.options=o,this.view=i;const{_dashedFillSymbol:l,_dashedLineSymbol:c,_sketchViewModel:d,_sketchGraphicsLayer:m,_transparentPointSymbol:y}=this;d.set({layer:m,view:this.view,activePointSymbol:y,activeLineSymbol:c,activeVertexSymbol:y,activeFillSymbol:l,pointSymbol:y,polygonSymbol:l,polylineSymbol:c,vertexSymbol:y}),this._handles.add([d.on("create",(e=>this._onSketchEvent(e))),d.on(["undo","redo"],(e=>this._onSketchEvent(e)))])}initialize(){this._load()}destroy(){this._handles.destroy(),this._handles=null}get state(){const{_completed:e,_sketchViewModel:{state:t}}=this;return e?"complete":"active"===t?"active":"disabled"}cancel(){this._sketchViewModel.cancel()}async _load(){await this.view.whenReady();const{options:e}=this,{createTool:t,createOptions:o}=this._activeOptions={...this._defaultOptions,...e};this._sketchViewModel.create(t,o)}_onSketchEvent(e){const t=("create"===e.type?e.graphic:e.graphics[0])?.geometry||null,o="create"===e.type&&"cancel"===e.state,s="create"===e.type&&"complete"===e.state;this._processSelectionGeometry(t,s,o)}_processSelectionGeometry(e,t,o){if(this._set("geometry",e),(t||o)&&(this._completed=!0),o)return void this._onComplete([],!0);const{_activeOptions:s,candidates:i,selection:l,view:r}=this;c({selector:e,candidates:i,currentSelection:l,options:s.selectionOptions,view:r}).then((({added:e,removed:o})=>{t?this._onComplete(this.selection.toArray(),!1):(e.length||o.length)&&this.emit("selection-change",{added:e,removed:o,type:"selection-change"})}))}_onComplete(e,t){this._handles.removeAll(),this.notifyChange("state"),this.emit("complete",{aborted:t,selection:e,type:"complete"})}};e([i()],d.prototype,"_completed",void 0),e([i()],d.prototype,"candidates",void 0),e([i({readOnly:!0})],d.prototype,"geometry",void 0),e([i()],d.prototype,"options",void 0),e([i({readOnly:!0})],d.prototype,"selection",void 0),e([i({readOnly:!0})],d.prototype,"state",null),e([i({value:null})],d.prototype,"view",void 0),d=e([l("esri.widgets.support.Selector2D.SelectionOperation2D")],d);const m=d;export{m as default};
