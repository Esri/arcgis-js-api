/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/Evented","../../../core/Collection","../../../symbols/SimpleLineSymbol","../../../symbols/SimpleFillSymbol","../../../symbols/SimpleMarkerSymbol","../../../chunks/symbols","../../../core/Handles","../../../layers/GraphicsLayer","../../Sketch/SketchViewModel","./selectorUtils"],(function(e,t,o,s,i,n,l,c,r,a,d,p,h,y,_,u,m,v,S,w){"use strict";let b=function(t){function o(o){var s;(s=t.call(this)||this)._activeOptions=null,s._dashedFillSymbol=new y({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),s._dashedLineSymbol=new h({style:"dash",color:[12,207,255],width:2}),s._defaultOptions={tool:"rectangle",createOptions:null,selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},s._completed=!1,s._handles=new m,s._sketchViewModel=new S,s._sketchGraphicsLayer=new v({listMode:"hide"}),s._transparentPointSymbol=new _({color:[0,0,0,0],outline:{style:"none",width:0}}),s.candidates=null,s.geometry=null,s.options=null,s.selection=new p,s.view=null,s.candidates=o.candidates,s.options=o.options,s.view=o.view;const{_dashedFillSymbol:i,_dashedLineSymbol:n,_sketchViewModel:l,_sketchGraphicsLayer:c,_transparentPointSymbol:r}=e._assertThisInitialized(s);return l.set({layer:c,view:s.view,activePointSymbol:r,activeLineSymbol:n,activeVertexSymbol:r,activeFillSymbol:i,pointSymbol:r,polygonSymbol:i,polylineSymbol:n,vertexSymbol:r}),s._handles.add([l.on("create",(e=>s._onSketchEvent(e))),l.on(["undo","redo"],(e=>s._onSketchEvent(e)))]),s}e._inheritsLoose(o,t);var s=o.prototype;return s.initialize=function(){this._load()},s.destroy=function(){this._handles.destroy(),this._handles=null},s.cancel=function(){this._sketchViewModel.cancel()},s._load=async function(){await this.view.whenReady();const{options:e}=this,{tool:t,createOptions:o}=this._activeOptions={...this._defaultOptions,...e};this._sketchViewModel.create(t,o)},s._onSketchEvent=function(e){const t="create"===e.type?e.graphic:e.graphics[0],o=(null==t?void 0:t.geometry)||null,s="create"===e.type&&"cancel"===e.state,i="create"===e.type&&"complete"===e.state;this._processSelectionGeometry(o,i,s)},s._processSelectionGeometry=function(e,t,o){if(this._set("geometry",e),(t||o)&&(this._completed=!0),o)return void this._onComplete([],!0);const{_activeOptions:s,candidates:i,selection:n,view:l}=this;w.updateSelection({selector:e,candidates:i,currentSelection:n,options:s.selectionOptions,view:l}).then((({added:e,removed:o})=>{t?this._onComplete(this.selection.toArray(),!1):(e.length||o.length)&&this.emit("selection-change",{added:e,removed:o,type:"selection-change"})}))},s._onComplete=function(e,t){this._handles.removeAll(),this.notifyChange("state"),this.emit("complete",{aborted:t,selection:e,type:"complete"})},e._createClass(o,[{key:"state",get:function(){const{_completed:e,_sketchViewModel:{state:t}}=this;return e?"complete":"active"===t?"active":"disabled"}}]),o}(d.EventedAccessor);return t.__decorate([n.property()],b.prototype,"_completed",void 0),t.__decorate([n.property()],b.prototype,"candidates",void 0),t.__decorate([n.property({readOnly:!0})],b.prototype,"geometry",void 0),t.__decorate([n.property()],b.prototype,"options",void 0),t.__decorate([n.property({readOnly:!0})],b.prototype,"selection",void 0),t.__decorate([n.property({dependsOn:["_completed","_sketchViewModel.state"],readOnly:!0})],b.prototype,"state",null),t.__decorate([n.property({value:null})],b.prototype,"view",void 0),b=t.__decorate([l.subclass("esri.widgets.support.Selector")],b),b}));
