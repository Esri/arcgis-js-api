/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/maybe","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/promiseUtils","../core/watchUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/renderable","../chunks/index","./Widget","./ElevationProfile/css","./ElevationProfile/ChartLegend","./ElevationProfile/support/constants","./ElevationProfile/ElevationProfileViewModel","./ElevationProfile/ElevationProfileVisibleElements","./ElevationProfile/SettingsButton","./ElevationProfile/Statistics","./ElevationProfile/support/chartUtils"],(function(e,t,s,i,r,n,o,a,l,c,d,h,u,p,_,C,v,g,S,m,b,f,w,y,k,B,M){"use strict";const P=[4,0];let E=function(t){function s(e,s){var i;return(i=t.call(this,e,s)||this).viewModel=null,i.view=null,i.input=null,i.profiles=null,i.unitOptions=[],i.unit="metric",i.geodesicDistanceThreshold=1e5,i.visibleElements=new y,i.iconClass=m.CSS.widgetIcon,i.label=void 0,i.messages=null,i.messagesCommon=null,i.messagesUnits=null,i._chartContainer=null,i._chart=null,i._settingsButton=new k.SettingsButton({viewModel:i.viewModel}),i._statisticsWidget=new B.Statistics({viewModel:i.viewModel}),i._legend=new b({viewModel:i.viewModel}),i._resizeObserver=null,i._portrait=!1,i._chartInitTask=null,e.viewModel||(i._defaultViewModel=new w({view:e.view}),i.viewModel=i._defaultViewModel),i}e._inheritsLoose(s,t);var r=s.prototype;return r.postInitialize=function(){this.own([p.init(this,"_chartContainer",(()=>{this._destroyChart();const e=this._chartContainer;i.isNone(e)||(this._chartInitTask=u.createTask((t=>this._initializeChart(e,t))))})),p.init(this,"viewModel",(e=>{this._settingsButton.viewModel=e,this._statisticsWidget.viewModel=e,this._legend.viewModel=e})),p.init(this,"_chartUpdateParams",(()=>this._updateChart()))])},r.destroy=function(){this._destroyChart(),i.isSome(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy(),this._statisticsWidget.destroy(),this._statisticsWidget=null,this._legend.destroy(),this._legend=null,this._settingsButton.destroy(),this._settingsButton=null,i.isSome(this._resizeObserver)&&(this._resizeObserver.disconnect(),this._resizeObserver=null)},r.render=function(){const{viewModel:e}=this,t=e.progress;return g.jsx("div",{key:this,class:this.classes(m.CSS.base,m.CSS.esriWidget,{[m.CSS.esriWidgetDisabled]:"disabled"===e.state,[m.CSS.portrait]:this._portrait}),"aria-label":this.messages.widgetLabel,bind:this,afterCreate:this._onAfterCreate},g.jsx("div",{key:"progress-bar",class:this.classes(m.CSS.progressBar,{[m.CSS.progressBarVisible]:t<1}),styles:{width:100*t+"%"},role:"presentation","aria-hidden":"true",title:this.messagesCommon.loading}),this._renderContentForState())},r._renderContentForState=function(){switch(this.viewModel.state){case f.ElevationProfileState.Ready:return this._renderContentForReadyState();case f.ElevationProfileState.Selecting:return this._renderContentForSelectingState();case f.ElevationProfileState.Creating:return this._renderContentForCreatingState();case f.ElevationProfileState.Selected:case f.ElevationProfileState.Created:return this._renderContentForCreatedState();case f.ElevationProfileState.Disabled:return null}},r._renderContentForReadyState=function(){return this._renderContent({prompt:this.messages.readyPrompt,statistics:!1,chart:!1,legend:!1,actions:P})},r._renderContentForSelectingState=function(){return this._renderContent({prompt:this.messages.selectingPrompt,statistics:!1,chart:!1,legend:!1,actions:[5]})},r._renderContentForCreatingState=function(){const e={statistics:!1,chart:!1,legend:!1,actions:[1,3]};switch(this.viewModel.errorState){case 0:return this._renderContent({...e,prompt:this.messages.creatingPrompt});case 1:return this._renderContent({...e,prompt:this.messages.noMultiPathSupport});case 2:case 3:return this._renderContent({...e,prompt:this.messages.noProfile,legend:!0});case 4:{const e=this.viewModel.canStopCreating?2:3;return this._renderContent({statistics:!0,chart:!0,legend:!0,actions:[1,e]})}}},r._renderContentForCreatedState=function(){const e={statistics:!1,chart:!1,legend:!1,actions:P};switch(this.viewModel.errorState){case 0:return this._renderContent({...e,prompt:this.messages.noProfile});case 1:return this._renderContent({...e,prompt:this.messages.noMultiPathSupport});case 2:case 3:return this._renderContent({...e,prompt:this.messages.noProfile,legend:!0});case 4:return this._renderContent({statistics:!0,chart:!0,legend:!0,actions:P})}},r._renderContent=function({statistics:e,prompt:t,chart:s,legend:r,actions:n}){return[this._renderHeader({statistics:e}),i.isSome(t)?this._renderPrompt(t):s&&this._renderChart(),this._renderActions({legend:r,actions:n})]},r._renderHeader=function(e){const{progress:t}=this.viewModel,s=1===t&&e.statistics&&this.visibleElements.statistics,i=t>0&&t<1;return g.jsx("header",{key:"header",class:m.CSS.header},i&&g.jsx("div",{key:"loading-message",class:m.CSS.loadingMessage},this.messages.loading),s?this._statisticsWidget.render():g.jsx("div",{key:"header-spacer",class:m.CSS.headerSpacer}),this._settingsButton.render())},r._renderPrompt=function(e){return g.jsx("div",{key:"prompt-container",bind:this,class:m.CSS.promptContainer},g.jsx("p",null,e))},r._renderChart=function(){return g.jsx("div",{key:"chart-container",bind:this,class:m.CSS.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})},r._renderActions=function({legend:e,actions:t}){const s=t.map((e=>{switch(e){case 0:return this.visibleElements.sketchButton&&g.jsx("button",{key:"sketch",class:this.classes(m.CSS.actionButton,m.CSS.sketchButton),bind:this,onclick:this._onSketchButtonClick},this.messages.sketchButtonLabel);case 1:return this.visibleElements.sketchButton&&g.jsx("button",{key:"sketch-cancel",class:this.classes(m.CSS.actionButton,m.CSS.sketchCancelButton),bind:this,onclick:this._onCancelButtonClick},this.messagesCommon.cancel);case 2:return this.visibleElements.sketchButton&&g.jsx("button",{key:"sketch-done",class:this.classes(m.CSS.actionButton,m.CSS.sketchDoneButton),bind:this,onclick:this._onDoneButtonClick},this.messagesCommon.done);case 3:return this.visibleElements.sketchButton&&g.jsx("button",{key:"sketch-done-disabled",class:this.classes(m.CSS.actionButton,m.CSS.sketchDoneButton,m.CSS.buttonDisabled),bind:this,disabled:!0},this.messagesCommon.done);case 4:return this.visibleElements.selectButton&&g.jsx("button",{key:"select",class:this.classes(m.CSS.actionButton,m.CSS.selectButton),bind:this,onclick:this._onSelectButtonClick},this.messages.selectButtonLabel);case 5:return this.visibleElements.selectButton&&g.jsx("button",{key:"select-cancel",class:this.classes(m.CSS.actionButton,m.CSS.selectCancelButton),bind:this,onclick:this._onCancelButtonClick},this.messagesCommon.cancel)}}));return g.jsx("div",{class:m.CSS.footer},g.jsx("div",{class:m.CSS.legendContainer},this.visibleElements.legend&&e&&this._legend.render()),g.jsx("div",{class:m.CSS.actionsContainer},s))},r._onSketchButtonClick=function(){this.viewModel.start({mode:"sketch"})},r._onSelectButtonClick=function(){this.viewModel.start({mode:"select"})},r._onCancelButtonClick=function(){this.viewModel.cancel()},r._onDoneButtonClick=function(){this.viewModel.stop()},r._updateChart=function(){const e=this._chartUpdateParams;e.stationary&&i.isSome(e.chart)&&e.messages&&e.chart.update(e)},r._onChartContainerAfterCreate=function(e){this._chartContainer=e},r._onChartContainerRemoved=function(){this._chartContainer=null},r._initializeChart=async function(e,t){this._chart=await M.createChart({container:e,abortOptions:{signal:t},onCursorPositionChange:e=>{this.viewModel.hoveredChartPosition=e}}),this._updateChart()},r._destroyChart=function(){i.isSome(this._chartInitTask)&&(this._chartInitTask.abort(),this._chartInitTask=null),i.isSome(this._chart)&&(this._chart.destroy(),this._chart=null)},r._onAfterCreate=function(e){const t=()=>{this._portrait=e.getBoundingClientRect().width<f.PORTRAIT_MODE_PIXEL_BREAKPOINT};t(),this._resizeObserver=new ResizeObserver((()=>t())),this._resizeObserver.observe(e)},e._createClass(s,[{key:"_chartUpdateParams",get:function(){return{chart:this._chart,data:this.viewModel.chartData,stationary:this.view.stationary,elevationUnitsPerPixel:this.viewModel.elevationUnitsPerPixel,messages:{...this.messagesUnits,...this.messages}}}}]),s}(S);return t.__decorate([o.property({type:w}),v.renderable(["chartData","progress","statistics","canStopCreating"])],E.prototype,"viewModel",void 0),t.__decorate([a.aliasOf("viewModel.view"),v.renderable()],E.prototype,"view",void 0),t.__decorate([a.aliasOf("viewModel.input"),v.renderable()],E.prototype,"input",void 0),t.__decorate([a.aliasOf("viewModel.profiles"),v.renderable()],E.prototype,"profiles",void 0),t.__decorate([a.aliasOf("viewModel.unitOptions"),v.renderable()],E.prototype,"unitOptions",void 0),t.__decorate([a.aliasOf("viewModel.unit"),v.renderable()],E.prototype,"unit",void 0),t.__decorate([a.aliasOf("viewModel.geodesicDistanceThreshold"),v.renderable()],E.prototype,"geodesicDistanceThreshold",void 0),t.__decorate([o.property({type:y}),v.renderable()],E.prototype,"visibleElements",void 0),t.__decorate([o.property(),v.renderable()],E.prototype,"iconClass",void 0),t.__decorate([a.aliasOf("messages.widgetLabel",{overridable:!0}),v.renderable()],E.prototype,"label",void 0),t.__decorate([o.property(),v.renderable(),C.messageBundle("esri/widgets/ElevationProfile/t9n/ElevationProfile")],E.prototype,"messages",void 0),t.__decorate([o.property(),v.renderable(),C.messageBundle("esri/t9n/common")],E.prototype,"messagesCommon",void 0),t.__decorate([o.property(),v.renderable(),C.messageBundle("esri/core/t9n/Units")],E.prototype,"messagesUnits",void 0),t.__decorate([o.property()],E.prototype,"_chartContainer",void 0),t.__decorate([o.property()],E.prototype,"_chart",void 0),t.__decorate([o.property(),v.renderable()],E.prototype,"_portrait",void 0),t.__decorate([o.property()],E.prototype,"_chartUpdateParams",null),E=t.__decorate([l.subclass("esri.widgets.ElevationProfile")],E),E}));
