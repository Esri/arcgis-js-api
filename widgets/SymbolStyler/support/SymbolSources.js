// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.12/esri/copyright.txt for details.

define(["require","exports","../../../core/tsSupport/assignHelper","../../../core/tsSupport/declareExtendsHelper","../../../core/tsSupport/decorateHelper","dojo/i18n!../nls/SymbolStyler","../../../Color","../../../symbols","../../../core/Accessor","../../../core/devEnvironmentUtils","../../../core/maybe","../../../core/promiseUtils","../../../core/urlUtils","../../../core/accessorSupport/decorators","../../../symbols/support/gfxUtils","../../../symbols/support/jsonUtils","../../../symbols/support/styleUtils","../../../symbols/support/Symbol3DMaterial","../../../symbols/support/symbolUtils"],function(e,t,r,i,o,n,l,a,s,p,m,y,u,c,d,b,v,S,h){function f(e){var t=e.get("data.thumbnail.href"),r=e.data.title,i=document.createElement("div");if(p.isDevEnvironment()&&(t=p.adjustStaticAGOUrl(t)),!t)return i.appendChild(g(r)),y.resolve(i);var o=new a.WebStyleSymbol({name:e.data.name,styleUrl:e.portalItem.itemUrl+"/data",thumbnail:{url:t?u.makeAbsolute(t,e.get("portalItem.itemUrl")):null}}),n="flat"===e.data.dimensionality?24:48;return h.renderPreviewHTML(o,{node:i,size:n,disableUpsampling:!0}).then(function(e){return i}).catch(function(){return i.appendChild(g(r)),i})}function g(e){void 0===e&&(e=n.noTitle);var t=document.createElement("span");return t.setAttribute("alt",""),t.innerHTML=e,t}function w(e,t,r,i){var o=v.styleNameFromItem(r),n=null;o||(n=r.itemUrl+"/data");var l={data:e,baseUrl:r.itemUrl,styleName:o,styleUrl:n};return v.fetchSymbolFromStyle(l,t,{portal:r.portal},i)}Object.defineProperty(t,"__esModule",{value:!0});var C=[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Cross",type:"esriSMS",style:"esriSMSCross",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"X",type:"esriSMS",style:"esriSMSX",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Triangle",type:"esriSMS",style:"esriSMSTriangle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],I=[{title:n.circle,name:"Circle",primitive:"circle"},{title:n.square,name:"Square",primitive:"square"},{title:n.cross,name:"Cross",primitive:"cross"},{title:n.x,name:"X",primitive:"x"},{title:n.kite,name:"Kite",primitive:"kite"},{title:n.triangle,name:"Triangle",primitive:"triangle"}],_=[{title:n.sphere,name:"Sphere",primitive:"sphere"},{title:n.tallCylinder,name:"Tall_Cylinder",primitive:"cylinder",mixins:{width:5,height:10,depth:5}},{title:n.cylinder,name:"Cylinder",primitive:"cylinder"},{title:n.tallCube,name:"Tall_Cube",primitive:"cube",mixins:{width:5,height:10,depth:5,anchor:"bottom"}},{title:n.cube,name:"Cube",primitive:"cube"},{title:n.tallCone,name:"Tall_Cone",primitive:"cone",mixins:{width:5,height:10,depth:5}},{title:n.cone,name:"Cone",primitive:"cone"},{title:n.invertedCone,name:"Inverted_Cone",primitive:"invertedCone"},{title:n.diamond,name:"Diamond",primitive:"diamond"},{title:n.tetrahedron,name:"Tetrahedron",primitive:"tetrahedron"}],T=I.map(function(e){return{dimensionality:"flat",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[{type:"Icon",resource:{primitive:e.primitive},material:{color:d.defaultThematicColor},outline:{color:[0,0,0]}}]}}),M=_.map(function(e){return{dimensionality:"volumetric",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[r({type:"Object",resource:{primitive:e.primitive}},e.mixins)]}}),A={getSymbol:function(e){var t=e.data,r=e.parentData,i=e.portalItem;return w(r,t.name,i,"webRef").then(function(e){return"point-3d"===e.type&&e.symbolLayers.forEach(function(e){if(e.get("material.color"))if("icon"===e.type){var t=m.isSome(e.material)?e.material:new S.default;t.color=d.defaultThematicColor.clone(),e.material=t}else if("object"===e.type){var t=m.isSome(e.material)?e.material:new S.default;t.color=t.color||new l([255,255,255]),e.material=t}}),e})},getThumbnail:function(e){return f(e)}},O={getSymbol:function(e){return y.resolve(b.fromJSON(e.data))},getThumbnail:function(e){return e.getSymbol().then(function(e){return h.renderPreviewHTML(e,{size:24})})}},U={getSymbol:function(e){return y.resolve(b.fromJSON(e.data))},getThumbnail:function(e){return e.getSymbol().then(function(e){return h.renderPreviewHTML(e,{size:48})})}},j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getSymbol=function(){var e=this;return this._symbol?y.resolve(this._symbol):this.strategy.getSymbol(this).then(function(t){return e._symbol=t})},t.prototype.getThumbnail=function(e){var t=this;if(this._thumbnail){e.appendChild(this._thumbnail);var r=Function.prototype;return y.resolve(r)}return this.strategy.getThumbnail(this).then(function(r){return t._thumbnail=r,function(){e.appendChild(t._thumbnail)}})},o([c.property()],t.prototype,"strategy",void 0),o([c.property()],t.prototype,"data",void 0),o([c.property()],t.prototype,"parentData",void 0),o([c.property()],t.prototype,"portalItem",void 0),t=o([c.subclass("esri.widgets.SymbolStyler.SymbolItem")],t)}(c.declared(s));t.SymbolItem=j;var D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.fetchData=function(e){var t=this;return y.isAborted(e)?y.reject(y.createAbortError()):this.data?y.resolve(this.data):this.portalItem.fetchData("json",e).then(function(e){return t._set("data",e),e})},o([c.property({readOnly:!0})],t.prototype,"data",void 0),o([c.property({aliasOf:"portalItem.id"})],t.prototype,"id",void 0),o([c.property({aliasOf:"portalItem.name"})],t.prototype,"name",void 0),o([c.property({aliasOf:"portalItem.title"})],t.prototype,"title",void 0),o([c.property()],t.prototype,"portalItem",void 0),t=o([c.subclass("esri.widgets.SymbolStyler.PortalItemSymbolSourceBase")],t)}(c.declared(s)),E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="symbol-set",t}return i(t,e),t.prototype.getItems=function(e){return y.isAborted(e)?y.reject(y.createAbortError()):y.resolve(null)},o([c.property({readOnly:!0})],t.prototype,"type",void 0),t=o([c.subclass("esri.widgets.SymbolStyler.SymbolSetSymbolSource")],t)}(c.declared(D));t.SymbolSetSymbolSource=E;var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="web-style",t}return i(t,e),t.prototype.getItems=function(e){var t=this;return y.isAborted(e)?y.reject(y.createAbortError()):(this._items&&y.resolve(this._items),this.fetchData(e).then(function(e){return t._items=e.items.map(function(r){return new j({data:r,parentData:e,portalItem:t.portalItem,strategy:A})}),t._items}))},o([c.property({readOnly:!0})],t.prototype,"type",void 0),t=o([c.subclass("esri.widgets.SymbolStyler.WebStyleSymbolSource")],t)}(c.declared(D));t.WebStyleSymbolSource=P;var x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=C,t.id="basic-symbol-set",t.name="Basic",t.title=n.basic,t.type="symbol-set",t}return i(t,e),t.prototype.getItems=function(e){return y.isAborted(e)?y.reject(y.createAbortError()):y.resolve(null)},o([c.property()],t.prototype,"data",void 0),o([c.property()],t.prototype,"id",void 0),o([c.property()],t.prototype,"name",void 0),o([c.property()],t.prototype,"title",void 0),o([c.property({readOnly:!0})],t.prototype,"type",void 0),t=o([c.subclass("esri.widgets.SymbolStyler.BasicSymbolSetSource")],t)}(c.declared(s));t.BasicSymbolSetSource=x;var z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data={items:T},t.id="basic-web-style:flat",t.name="Basic",t.title=n.basic,t.type="web-style",t}return i(t,e),t.prototype.getItems=function(e){if(y.isAborted(e))return y.reject(y.createAbortError());if(this._items)return y.resolve(this._items);var t=this.data.items.map(function(e){return new j({data:e,strategy:O})});return y.resolve(this._items=t)},o([c.property()],t.prototype,"data",void 0),o([c.property()],t.prototype,"id",void 0),o([c.property()],t.prototype,"name",void 0),o([c.property()],t.prototype,"title",void 0),o([c.property({readOnly:!0})],t.prototype,"type",void 0),t=o([c.subclass("esri.widgets.SymbolStyler.IconPrimitiveWebStyleSource")],t)}(c.declared(s));t.IconPrimitiveWebStyleSource=z;var H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data={items:M},t.id="basic-web-style:volumetric",t.name="Basic",t.title=n.basic,t.type="web-style",t}return i(t,e),t.prototype.getItems=function(e){var t=this;if(y.isAborted(e))return y.reject(y.createAbortError());if(this._items)return y.resolve(this._items);var r=this.data.items.map(function(e){return new j({data:e,parentData:t.data,strategy:U})});return y.resolve(this._items=r)},o([c.property()],t.prototype,"data",void 0),o([c.property()],t.prototype,"id",void 0),o([c.property()],t.prototype,"name",void 0),o([c.property()],t.prototype,"title",void 0),o([c.property({readOnly:!0})],t.prototype,"type",void 0),t=o([c.subclass("esri.widgets.SymbolStyler.ObjectPrimitiveWebStyleSource")],t)}(c.declared(s));t.ObjectPrimitiveWebStyleSource=H});