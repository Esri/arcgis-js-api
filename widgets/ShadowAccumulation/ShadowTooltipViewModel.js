/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Accessor","../../core/Handles","../../core/handleUtils","../../core/maybe","../../core/promiseUtils","../../core/screenUtils","../../core/throttle","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/ensureType","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/trackingUtils"],(function(e,t,o,i,a,r,n,d,c,s,l,u,h,p,_,w){"use strict";var m;!function(e){e.PointerMove="pointer-move",e.Main="main"}(m||(m={}));const T=300;e.ShadowTooltipViewModel=function(e){function o(o){var i;return(i=e.call(this,o)||this)._handles=new a,i._screenPoint=null,i._accumulatedShadowTime=null,i._shadowTimeTask=null,i._updateAccumulatedShadowTime=(e,o)=>{i._shadowTimeTask=n.abortMaybe(i._shadowTimeTask),i._shadowTimeTask=d.createTask(function(){var a=t._asyncToGenerator((function*(t){const{results:a,ground:r}=yield e.hitTest(o);if(0===a.length&&!r.mapPoint)return void(i._accumulatedShadowTime=null);const n=yield i.getDuration(o,t);i._accumulatedShadowTime=n}));return function(e){return a.apply(this,arguments)}}())},i._throttledUpdateAccumulatedShadowTime=s.throttle(i._updateAccumulatedShadowTime,T),i}t._inheritsLoose(o,e);var i=o.prototype;return i.initialize=function(){this._handles.add(w.reactionInit((()=>({enabled:this.enabled,view:this.view})),(({enabled:e,view:t})=>{e&&n.isSome(t)?this._startTracking(t):this._stopTracking()})))},i.destroy=function(){this._handles=n.destroyMaybe(this._handles)},i._startTracking=function(e){const t=this._handles;if(t.has(m.Main))return;const o=()=>{t.has(m.PointerMove)||t.add(e.on("pointer-move",(t=>{const o=c.createScreenPoint(t.x,t.y);this._screenPoint=o,this._throttledUpdateAccumulatedShadowTime(e,o)})),m.PointerMove)},i=()=>{t.remove(m.PointerMove),this._screenPoint=null,this._accumulatedShadowTime=null};t.add([this._throttledUpdateAccumulatedShadowTime,e.on("pointer-enter",o),e.on("pointer-leave",i),e.on("pointer-down",i),e.on("pointer-drag",i),e.on("pointer-up",o),e.on("click",(t=>{const o=c.createScreenPoint(t.x,t.y);this._screenPoint=o,this._updateAccumulatedShadowTime(e,o)})),r.makeHandle((()=>{this._shadowTimeTask=n.abortMaybe(this._shadowTimeTask)}))],m.Main),o()},i._stopTracking=function(){this._handles.remove(m.Main)},t._createClass(o,[{key:"screenPoint",get:function(){return this.enabled?this._screenPoint:null}},{key:"accumulatedShadowTime",get:function(){return this.enabled?this._accumulatedShadowTime:null}},{key:"testData",get:function(){return{setThrottleDelay:e=>{this._throttledUpdateAccumulatedShadowTime.remove(),this._throttledUpdateAccumulatedShadowTime=s.throttle(this._updateAccumulatedShadowTime,e)}}}}]),o}(i),o.__decorate([l.property()],e.ShadowTooltipViewModel.prototype,"getDuration",void 0),o.__decorate([l.property()],e.ShadowTooltipViewModel.prototype,"view",void 0),o.__decorate([l.property()],e.ShadowTooltipViewModel.prototype,"enabled",void 0),o.__decorate([l.property()],e.ShadowTooltipViewModel.prototype,"screenPoint",null),o.__decorate([l.property()],e.ShadowTooltipViewModel.prototype,"accumulatedShadowTime",null),o.__decorate([l.property()],e.ShadowTooltipViewModel.prototype,"_screenPoint",void 0),o.__decorate([l.property()],e.ShadowTooltipViewModel.prototype,"_accumulatedShadowTime",void 0),o.__decorate([l.property()],e.ShadowTooltipViewModel.prototype,"_shadowTimeTask",void 0),e.ShadowTooltipViewModel=o.__decorate([_.subclass("esri.widgets.ShadowAccumulation.ShadowTooltipViewModel")],e.ShadowTooltipViewModel),Object.defineProperty(e,"__esModule",{value:!0})}));
