/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/Collection","../core/events","../core/lang","../core/Logger","../core/reactiveUtils","../core/urlUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","../rest/utils","./Widget","./Print/FileLink","./Print/PrintViewModel","./Print/TemplateOptions","./support/Heading","./support/Popover","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(e,t,i,n,a,s,o,l,r,c,d,p,u,h,m,_,b,y,f,g,x){"use strict";const v=i.ofType(h),T="MAP_ONLY";var w;!function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab"}(w||(w={}));const O="esri-print",C=`${O}__advanced-options-button`,k={base:O,headerTitle:`${O}__header-title`,inputText:`${O}__input-text`,layoutTabList:`${O}__layout-tab-list`,layoutTab:`${O}__layout-tab`,layoutSection:`${O}__layout-section`,mapOnlySection:`${O}__map-only-section`,scaleInput:`${O}__scale-input`,templateList:`${O}__template-list`,templateListScroller:`${O}__template-list-scroller`,templateListFooter:`${O}__template-list-footer`,loader:`${O}__loader`,advancedOptionsButton:C,advancedOptionsButtonContainer:`${C}-container`,advancedOptionsButtonTitle:`${C}-title`,advancedOptionsButtonIconOpened:`${C}-icon--opened`,advancedOptionsButtonIconClosed:`${C}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${C}-icon--closed-rtl`,refreshButton:`${O}__refresh-button`,swapButton:`${O}__swap-button`,linkButton:`${O}__link-button`,printButton:`${O}__export-button`,templateButton:`${O}__template-button`,formSectionContainer:`${O}__form-section-container`,advancedOptionsSection:`${O}__advanced-options-section`,advancedOptionsContainer:`${O}__advanced-options-container`,authorInfoContainer:`${O}__author-info-container`,copyrightInfoContainer:`${O}__copyright-info-container`,exportedFilesContainer:`${O}__export-panel-container`,exportedFilesTitle:`${O}__export-title`,exportedFile:`${O}__exported-file`,exportedFileLink:"esri-widget__anchor esri-print__exported-file-link",exportedFileLinkTitle:`${O}__exported-file-link-title`,heightContainer:`${O}__height-container`,legendInfoContainer:`${O}__legend-info-container`,printWidgetContainer:`${O}__container`,panelContainer:`${O}__panel-container`,scaleInfoContainer:`${O}__scale-info-container`,scaleInputContainer:`${O}__scale-input-container`,sizeContainer:`${O}__size-container`,widthContainer:`${O}__width-container`,widget:"esri-widget",panel:"esri-widget--panel",widgetButton:"esri-widget--button",button:"esri-button",buttonSecondary:"esri-button--secondary",buttonTertiary:"esri-button--tertiary",select:"esri-select",input:"esri-input",disabled:"esri-disabled",anchorDisabled:"esri-widget__anchor--disabled",buttonDisabled:"esri-button--disabled",panelError:`${O}__panel--error`,exportedFileError:`${O}__exported-file--error`,hide:"esri-hidden",rotate:"esri-rotating",anchor:"esri-widget__anchor",menu:"esri-menu",menuList:"esri-menu__list",menuItem:"esri-menu__list-item",menuItemFocus:"esri-menu__list-item--focus",menuHeader:"esri-menu__header",iconCheckMark:"esri-icon-check-mark",iconDownload:"esri-icon-download",iconLaunchLink:"esri-icon-launch-link-external",iconError:"esri-icon-error",iconPrinter:"esri-icon-printer",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconDownArrow:"esri-icon-down-arrow",iconRefresh:"esri-icon-refresh",iconSpinner:"esri-icon-loading-indicator",iconSwap:"esri-icon-swap",iconLinked:"esri-icon-link-horizontal",iconUnlinked:"esri-icon-unlocked-link-horizontal",widgetIcon:"esri-icon-printer"},L="User sets an invalid layout, resetting it to the default valid one...",I="User sets an invalid format, resetting it to the default valid one...";function S(e){const t=8.3333,i=11.4583;return{width:Math.round(e*t),height:Math.round(e*i)}}function $(e){return!isNaN(e)&&e>0}function M(e){return e?.toUpperCase()===T}let F=function(t){function i(i,n){var a;return(a=t.call(this,i,n)||this)._activeTabFocusRequested=!1,a._advancedOptionsVisibleForLayout=!1,a._advancedOptionsVisibleForMapOnly=!1,a._awaitingServerResponse=!1,a._exportedFileNameMap={},a._focusedTemplateIndex=0,a._layoutTabSelected=!0,a._pendingExportScroll=!1,a._rootNode=null,a._selectTemplateNode=null,a._templateListPopover=new y({owner:e._assertThisInitialized(a),placement:"top",offset:[0,-100],anchorElement:()=>a._selectTemplateNode,renderContentFunction:a.renderTemplateList}),a.exportedLinks=new v,a.headingLevel=3,a.iconClass=k.widgetIcon,a.templateOptions=new _,a.viewModel=new m,a.handleTemplateListCreation=e=>e.focus(),a.handleTemplateChildBlur=e=>{const t=e.relatedTarget?.closest(`.${k.templateList}`);t||a.handleCloseTemplateSelection()},a.handleCloseTemplateSelection=()=>{a._focusedTemplateIndex=0,a._templateListPopover.open=!1,a._selectTemplateNode.focus()},a.handleSelectTemplateClick=()=>{a._focusedTemplateIndex=0,a._templateListPopover.open=!0},a.handleTemplateListClick=e=>{const t=e.target;a.applyTemplate(t["data-template"])},a.handleTemplateListKeyDown=e=>{if(f.isActivationKey(e.key))return a.applyTemplate(a.viewModel.defaultTemplates.getItemAt(a._focusedTemplateIndex)),void e.preventDefault();if("ArrowDown"===e.key||"ArrowUp"===e.key){const{defaultTemplates:t}=a.viewModel,i="ArrowDown"===e.key?1:-1,n=(a._focusedTemplateIndex+i)%t.length;a._focusedTemplateIndex=n<0?t.length-1:n;const s=e.currentTarget;f.keepMenuItemWithinView(s.querySelectorAll(`.${k.menuItem}`)[a._focusedTemplateIndex],s.parentElement),e.preventDefault()}"Escape"===e.key&&a.handleCloseTemplateSelection()},a._removeLink=e=>{const t=e.currentTarget["data-item"];t&&"error"===t.state&&a.exportedLinks.remove(t)},a._handleLinkClick=e=>{const t=e.currentTarget,{href:i}=t,n=p.getToken(a.viewModel.effectivePrintServiceUrl);if(!n)return;if(!e.isTrusted)return void e.stopPropagation();e.preventDefault();const s=new URL(i);s.searchParams.set("token",n),t.href=s.href,t.click(),t.href=i},a._focusOnTabChange=a._focusOnTabChange.bind(e._assertThisInitialized(a)),a}e._inheritsLoose(i,t);var r=i.prototype;return r.initialize=function(){this.addHandles([o.watch((()=>this.viewModel?.templatesInfo),(e=>{const{format:t,layout:i}=this.templateOptions;if(e){const n=i===e.layout.defaultValue||M(i)||e.layout.choiceList&&e.layout.choiceList.includes(i),a=t===e.format.defaultValue||e.format.choiceList&&e.format.choiceList.includes(t);n||(i&&s.getLogger(this.declaredClass).warn(L),this.templateOptions.layout=e.layout.defaultValue),a||(t&&s.getLogger(this.declaredClass).warn(I),this.templateOptions.format=e.format.defaultValue),M(i)&&(this._layoutTabSelected=!1)}}),o.initial),o.watch((()=>this.templateOptions?.format),(e=>{const{viewModel:{templatesInfo:t}}=this;if(t&&e){let i=!1;t.format.choiceList&&t.format.choiceList.forEach((t=>{t.toUpperCase()===e.toUpperCase()&&(this.templateOptions.format=t,i=!0)})),i||(this.templateOptions.format=t.format.defaultValue,s.getLogger(this.declaredClass).warn(I)),this.scheduleRender()}}),o.initial),o.watch((()=>this.templateOptions?.layout),(e=>{const{viewModel:{templatesInfo:t}}=this;if(t&&e){this._layoutTabSelected=!M(e);let i=!this._layoutTabSelected;i||t.layout.choiceList&&t.layout.choiceList.forEach((t=>{t.toUpperCase()===e.toUpperCase()&&(this.templateOptions.layout=t,i=!0)})),i||(this.templateOptions.layout=t.layout.defaultValue,s.getLogger(this.declaredClass).warn(L));const n=this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=n?a.clone(n):null,this.scheduleRender()}}),o.initial),o.watch((()=>this.templateOptions?.dpi),(e=>{e<=0?this.templateOptions.dpi=1:this.scheduleRender()}),o.initial),o.watch((()=>this.viewModel?.view?.scale),(e=>{const{scale:t,scaleEnabled:i}=this.templateOptions;i&&t||(this.templateOptions.scale=e)}),o.initial)]);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const i=setTimeout((()=>{this._awaitingServerResponse=!0,this.scheduleRender()}),500);this.viewModel.load().then((()=>clearTimeout(i)))},r.render=function(){const{attributionEnabled:e,author:t,copyright:i,dpi:n,format:a,height:s,layout:o,legendEnabled:l,northArrowEnabled:r,scaleEnabled:c,scale:d,width:p}=this.templateOptions,u="ready"!==this.get("viewModel.state"),h=this.renderTitleOrFileNameSection(),{includeDefaultTemplates:m,messages:_,viewModel:y}=this,f=this.get("viewModel.templatesInfo.format.choiceList")||[],g=f.length>0?f.map((e=>{const t=e===a;return x.tsx("option",{key:e,selected:t,value:e},e.toUpperCase())})):x.tsx("option",{key:"format-default-option"},_.formatDefaultOption),v=x.tsx("div",{class:k.formSectionContainer},x.tsx("label",null,_.fileFormatTitle,x.tsx("select",{class:k.select,onchange:this._updateFromOption,"data-target-property":"format",bind:this},g))),T=this.get("viewModel.templatesInfo.layout.choiceList")||[],O=T.length>0?T.map((e=>{const t=e===o,i=_[e]||e;return x.tsx("option",{key:e,selected:t,value:e},i)})):x.tsx("option",{key:"layout-default-option"},_.layoutDefaultOption),C=x.tsx("div",{class:k.formSectionContainer},x.tsx("label",null,_.layoutTitle,x.tsx("select",{class:k.select,onchange:this._updateFromOption,"data-target-property":"layout",bind:this},O))),L=x.tsx("div",{class:k.formSectionContainer},x.tsx("label",null,_.dpi,x.tsx("input",{type:"number",class:this.classes(k.inputText,k.input),"data-input-name":"dpi",onchange:this._handleDPIChange,value:`${n}`,min:"1",tabIndex:0,bind:this}))),I=x.tsx("div",{class:this.classes(k.scaleInfoContainer,k.formSectionContainer)},x.tsx("label",null,x.tsx("input",{"data-option-name":"scaleEnabled",checked:c,type:"checkbox",tabIndex:0,onchange:this._toggleInputValue,bind:this}),_.scale),x.tsx("div",{class:k.scaleInputContainer},x.tsx("input",{"aria-label":_.scaleLabel,"aria-valuenow":`${d}`,role:"spinbutton",type:"number",class:this.classes(k.inputText,k.input,k.scaleInput),tabIndex:0,"data-input-name":"scale",onchange:this._updateInputValue,disabled:!c,value:`${d}`,bind:this}),x.tsx("button",{type:"button","aria-label":_.reset,class:this.classes(k.widgetButton,k.refreshButton,k.iconRefresh),tabIndex:0,onclick:this._resetToCurrentScale,bind:this}))),S=this._advancedOptionsVisibleForLayout?x.tsx("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:k.advancedOptionsContainer},I,x.tsx("div",{class:this.classes(k.authorInfoContainer,k.formSectionContainer)},x.tsx("label",null,_.author,x.tsx("input",{type:"text",value:t,class:this.classes(k.inputText,k.input),tabIndex:0,"data-input-name":"author",onchange:this._updateInputValue,bind:this}))),x.tsx("div",{class:this.classes(k.copyrightInfoContainer,k.formSectionContainer)},x.tsx("label",null,_.copyright,x.tsx("input",{type:"text",class:this.classes(k.inputText,k.input),tabIndex:0,value:i,"data-input-name":"copyright",onchange:this._updateInputValue,bind:this}))),L,x.tsx("div",{class:this.classes(k.legendInfoContainer,k.formSectionContainer)},x.tsx("label",null,x.tsx("input",{type:"checkbox","data-option-name":"legendEnabled",tabIndex:0,checked:l,onchange:this._toggleInputValue,bind:this}),_.legend)),this.viewModel.templateToNorthArrowInfo[o]?x.tsx("div",{class:this.classes(k.legendInfoContainer,k.formSectionContainer),key:"north-arrow"},x.tsx("label",null,x.tsx("input",{type:"checkbox","data-option-name":"northArrowEnabled",tabIndex:0,checked:r,onchange:this._toggleInputValue,bind:this}),_.northArrow)):null,this.renderCustomTextElementSection()):null,$=this._advancedOptionsVisibleForMapOnly?x.tsx("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:k.advancedOptionsContainer},I,L,x.tsx("div",{class:k.formSectionContainer},x.tsx("label",null,x.tsx("input",{"data-option-name":"attributionEnabled",type:"checkbox",onchange:this._toggleInputValue,tabIndex:0,checked:e,bind:this}),_.attribution)),this.renderCustomTextElementSection()):null,M=this._layoutTabSelected?x.tsx("section",{key:"esri-print__layoutContent",id:`${this.id}__layoutContent`,"aria-labelledby":`${this.id}__layoutTab`,class:k.layoutSection,role:"tabpanel"},x.tsx("div",{class:k.panelContainer},h,C,this._layoutTabSelected?v:null),x.tsx("div",{class:this.classes(k.panelContainer,k.advancedOptionsSection)},x.tsx("button",{"aria-label":_.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false",class:k.advancedOptionsButton,onclick:this._showAdvancedOptions,bind:this,type:"button"},x.tsx("div",{class:k.advancedOptionsButtonContainer},x.tsx("span",{"aria-hidden":"true",class:this.classes(k.iconRightTriangleArrow,k.advancedOptionsButtonIconClosed)}),x.tsx("span",{"aria-hidden":"true",class:this.classes(k.iconLeftTriangleArrow,k.advancedOptionsButtonIconClosed_RTL)}),x.tsx("span",{"aria-hidden":"true",class:this.classes(k.iconDownArrow,k.advancedOptionsButtonIconOpened)}),x.tsx("span",{class:k.advancedOptionsButtonTitle},_.advancedOptions))),S)):x.tsx("section",{key:"esri-print__mapOnlyContent",id:`${this.id}__mapOnlyContent`,"aria-labelledby":`${this.id}__mapOnlyTab`,class:k.mapOnlySection,role:"tabpanel"},x.tsx("div",{class:k.panelContainer},h,this._layoutTabSelected?null:v,x.tsx("div",{class:this.classes(k.sizeContainer,k.formSectionContainer)},x.tsx("div",{class:k.widthContainer},x.tsx("label",null,_.width,x.tsx("input",{type:"number",class:this.classes(k.inputText,k.input),"data-input-name":"width",onchange:this._updateInputValue,value:`${p}`,tabIndex:0,bind:this}))),x.tsx("div",{class:k.heightContainer},x.tsx("label",null,_.height,x.tsx("input",{type:"number",class:this.classes(k.inputText,k.input),"data-input-name":"height",onchange:this._updateInputValue,value:`${s}`,tabIndex:0,bind:this}))),x.tsx("button",{type:"button","aria-label":_.swap,class:this.classes(k.widgetButton,k.swapButton,k.iconSwap),onclick:this._switchInput,tabIndex:0,bind:this})),x.tsx("div",{class:this.classes(k.panelContainer,k.advancedOptionsSection)},x.tsx("button",{"aria-label":_.advancedOptions,"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false",type:"button",class:k.advancedOptionsButton,onclick:this._showAdvancedOptions,bind:this},x.tsx("div",{class:k.advancedOptionsButtonContainer},x.tsx("span",{"aria-hidden":"true",class:this.classes(k.iconRightTriangleArrow,k.advancedOptionsButtonIconClosed)}),x.tsx("span",{"aria-hidden":"true",class:this.classes(k.iconLeftTriangleArrow,k.advancedOptionsButtonIconClosed_RTL)}),x.tsx("span",{"aria-hidden":"true",class:this.classes(k.iconDownArrow,k.advancedOptionsButtonIconOpened)}),x.tsx("span",{class:k.advancedOptionsButtonTitle},_.advancedOptions))),$))),F=this.exportedLinks.toArray(),E=this._renderExportedLink(F),A={[k.buttonDisabled]:u||!o&&!a},P=null!=this.get("view")&&"2d"!==this.get("view.type"),B=x.tsx("div",{class:k.panelError},P?_.sceneViewError:_.serviceError),V=x.tsx("div",null,x.tsx("ul",{class:k.layoutTabList,role:"tablist",onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,bind:this},x.tsx("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__layoutTab`,"data-tab-id":w.layout,class:k.layoutTab,role:"tab",tabIndex:0,"aria-selected":`${this._layoutTabSelected}`},_.layoutTab),x.tsx("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,id:`${this.id}__mapOnlyTab`,"data-tab-id":w.mapOnly,class:k.layoutTab,role:"tab",tabIndex:0,"aria-selected":`${!this._layoutTabSelected}`},_.mapOnlyTab)),M,x.tsx("button",{"aria-label":_.exportDescription,type:"button",class:this.classes(k.printButton,k.button,A),disabled:u,tabIndex:0,onclick:this._handlePrintMap,bind:this},_.export),m&&y.defaultTemplates.length>0?this.renderTemplateSectionTrigger():null,x.tsx("div",{class:k.exportedFilesContainer,afterUpdate:this._scrollExportIntoView,bind:this},x.tsx(b.Heading,{class:k.exportedFilesTitle,level:this.headingLevel},_.exportText),F.length>0?null:x.tsx("div",null,x.tsx("div",null,_.exportHint)),E)),D=x.tsx("div",{class:k.printWidgetContainer},x.tsx("header",{class:k.headerTitle},_.export),this.error||P||!this.view?B:V),N="initializing"===this.get("viewModel.state")?this._renderLoader():D;return x.tsx("div",{afterCreate:this._handleRootAfterCreate,bind:this,class:this.classes(k.base,k.widget,k.panel)},N)},r.renderTemplateSectionTrigger=function(){const{messages:e,_templateListPopover:t}=this,i=t.open;return x.tsx("button",{afterCreate:e=>this._selectTemplateNode=e,"aria-controls":i?`${this.id}__template-selection`:"","aria-label":e.selectTemplateDescription,"aria-pressed":i.toString(),class:this.classes(k.button,k.buttonTertiary,k.templateButton),onclick:this.handleSelectTemplateClick,title:e.selectTemplateDescription,type:"button"},e.selectTemplate)},r.renderCustomTextElementSection=function(){const{templateOptions:{customTextElements:e}}=this;return e?x.tsx("div",{class:k.formSectionContainer,key:"custom-text-elements"},e.map((e=>{const[t,i]=Object.entries(e)[0];return"date"===t?null:x.tsx("label",{key:t},t,x.tsx("input",{bind:this,class:this.classes(k.inputText,k.input),"data-input-custom":!0,"data-input-name":t,onchange:this._updateInputValue,type:"text",value:i}))}))):null},r.renderTemplateList=function(){const{messages:e,messagesCommon:t,viewModel:i}=this,{defaultTemplates:n}=i,a=e.selectTemplateDescription,s=`${this.id}__template-selection`;return x.tsx("div",{class:this.classes(k.templateList,k.widget,k.panel),id:s},x.tsx(b.Heading,{class:k.menuHeader,level:this.headingLevel},e.selectTemplate),x.tsx("div",{class:k.templateListScroller},x.tsx("ul",{afterCreate:this.handleTemplateListCreation,"aria-activedescendant":`${this.id}__template-item--${this._focusedTemplateIndex}`,"aria-label":a,class:k.menuList,key:"templates",onblur:this.handleTemplateChildBlur,onclick:this.handleTemplateListClick,onkeydown:this.handleTemplateListKeyDown,role:"listbox",tabIndex:0,title:a},n.toArray().map(((t,i)=>{const{description:n}=t,a=i===this._focusedTemplateIndex,s=t.label;return x.tsx("li",{"aria-label":n,class:this.classes(k.menuItem,{[k.menuItemFocus]:a}),"data-template":t,id:`${this.id}__template-item--${i}`,key:s,title:n},M(s)?e.mapOnlyTab:s)})))),x.tsx("div",{class:k.templateListFooter},x.tsx("button",{type:"button",class:this.classes(k.button,k.buttonSecondary),onblur:this.handleTemplateChildBlur,onclick:this.handleCloseTemplateSelection},t.done)))},r.applyTemplate=function(e){const{format:t,layout:i,layoutOptions:n}=e,{templateOptions:a}=this;this._templateListPopover.open=!1,this._toggleTab("map-only"===i?w.mapOnly:w.layout,!1),t&&(a.format=t),i&&(a.layout=i),this._focusedTemplateIndex=null,a.legendEnabled=n?.legend??a.legendEnabled,this.handleCloseTemplateSelection()},r.renderTitleOrFileNameSection=function(){const{templateOptions:e,messages:t}=this;let i,n,a,s;return this._layoutTabSelected?(i=t.title,n=t.titlePlaceHolder,a=e.title,s="title"):(i=t.fileName,n=t.fileNamePlaceHolder,a=e.fileName,s="fileName"),x.tsx("div",{class:k.formSectionContainer,key:s},x.tsx("label",null,i,x.tsx("input",{type:"text",tabIndex:0,placeholder:n,class:this.classes(k.inputText,k.input),value:a,"data-input-name":s,onchange:this._updateInputValue,bind:this})))},r._handleRootAfterCreate=function(e){this._rootNode=e,this.addHandles(n.on(e,"scroll",(()=>{this._templateListPopover.open&&this.handleCloseTemplateSelection()})))},r._focusOnTabChange=function(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");("layoutTab"===t&&this._layoutTabSelected||"mapOnlyTab"===t&&!this._layoutTabSelected)&&(e.focus(),this._activeTabFocusRequested=!1)},r._renderLoader=function(){const e={[k.loader]:this._awaitingServerResponse};return x.tsx("div",{class:this.classes(e),key:"loader"})},r._createFileLink=function(e,t){const i=t||this.messages.untitled,n=e.format.toLowerCase(),a=n.includes("png")?"png":n,s=i+a;return void 0!==this._exportedFileNameMap[s]?this._exportedFileNameMap[s]++:this._exportedFileNameMap[s]=0,new h({name:i,extension:a,count:this._exportedFileNameMap[s]})},r._resetToCurrentScale=function(){this.templateOptions.scale=this.viewModel.view.scale},r._updateCustomTextElementValue=function(e,t,i){e.find((e=>{const[i]=Object.entries(e)[0];return i===t}))[t]=i},r._updateInputValue=function(e){const t=e.target,i=t.getAttribute("data-input-name"),n=!!t["data-input-custom"],{templateOptions:a}=this;if(n)return void this._updateCustomTextElementValue(a.customTextElements,i,t.value);let s;if("number"===t.type){if(!$(t.valueAsNumber)){const e=a[i];return void(t.value=`${e}`)}s=t.valueAsNumber}else s=t.value;a[i]=s},r._handleDPIChange=function(e){this._updateInputValue(e);const t=e.currentTarget.valueAsNumber,{height:i,width:n}=S(t),{templateOptions:a}=this;a.height=i,a.width=n},r._handlePrintMap=function(){this._pendingExportScroll=!0;const{templateOptions:e}=this,t=this.viewModel.toPrintTemplate(e),i=this._layoutTabSelected?t.layoutOptions.titleText:e.fileName,n=this._createFileLink(t,i);this.exportedLinks.add(n),this.emit("submit",{link:n}),this.viewModel.print(t).then((e=>{n.set({url:e&&e.url,state:"ready"})})).catch((e=>{n.set({error:e,state:"error"})})).then((()=>{this.emit("complete",{link:n}),this.scheduleRender()}))},r._updateFromOption=function(e){const t=e.target,i=t.selectedOptions?t.selectedOptions.item(0).value:t.options[t.selectedIndex].value,n=t.getAttribute("data-target-property");this.templateOptions[n]=i},r._switchInput=function(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]},r._showAdvancedOptions=function(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly},r._scrollExportIntoView=function(){if(this._pendingExportScroll){this._pendingExportScroll=!1;const{_rootNode:e,_rootNode:{clientHeight:t,scrollHeight:i}}=this,n=i-t;n>0&&(e.scrollTop=n)}},r._toggleInputValue=function(e){const t=e.target,i=t.getAttribute("data-option-name");this.templateOptions[i]=t.checked,"scaleEnabled"===i&&(this.templateOptions[i]||this._resetToCurrentScale())},r._renderExportedLink=function(e){const t=this.messages;return e.map((e=>{const{error:i,url:n,formattedName:a,state:s}=e,o="error"===s,r="pending"===s,c="ready"===s,d={[k.anchorDisabled]:r||o};let p=n||null;p&&(p=l.addProxy(p));const u=l.hasSameOrigin(n,location.href),h={[k.iconSpinner]:r,[k.rotate]:r,[k.iconDownload]:u&&c,[k.iconLaunchLink]:!u&&c,[k.iconError]:o,[k.exportedFileError]:o},m={[k.exportedFileError]:o};let _;_=r?t.pending:c?t.ready:t.errorMessage;const b=o?"print-task:cim-symbol-unsupported"===i.name?t.exportWebMapCIMError:t.exportWebMapError:"";return x.tsx("div",{"aria-label":_,class:k.exportedFile,"data-item":e,key:a,onclick:this._removeLink,title:b},x.tsx("a",{"aria-label":`${a}. ${t.linkReady}`,download:a,href:p,rel:"noreferrer",tabIndex:0,target:"_blank",class:this.classes(k.exportedFileLink,d),onclick:this._handleLinkClick},x.tsx("span",{class:this.classes(h)}),x.tsx("span",{class:this.classes(k.exportedFileLinkTitle,m)},a)))}))},r._toggleLayoutPanel=function(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))},r._toggleTab=function(e,t=!0){if(this._layoutTabSelected=e===w.layout,this._layoutTabSelected){const e=this.get("viewModel.templatesInfo.layout.choiceList");this.templateOptions.layout=e&&e[0]}else this.templateOptions.layout=T;t&&(this._activeTabFocusRequested=!0)},r._handleLayoutPanelKeyDown=function(e){const t=n.eventKey(e),i=e.target.getAttribute("data-tab-id");if(f.isActivationKey(t))return this._toggleTab(i),e.preventDefault(),void e.stopPropagation();"ArrowLeft"!==t&&"ArrowRight"!==t||(this._toggleTab(i===w.layout?w.mapOnly:w.layout),e.preventDefault(),e.stopPropagation())},e._createClass(i,[{key:"allowedFormats",get:function(){return this.viewModel.allowedFormats},set:function(e){this.viewModel.allowedFormats=e}},{key:"allowedLayouts",get:function(){return this.viewModel.allowedLayouts},set:function(e){this.viewModel.allowedLayouts=e}},{key:"error",get:function(){return this.viewModel.error}},{key:"extraParameters",get:function(){return this.viewModel.extraParameters},set:function(e){this.viewModel.extraParameters=e}},{key:"includeDefaultTemplates",get:function(){return this.viewModel.includeDefaultTemplates},set:function(e){this.viewModel.includeDefaultTemplates=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"portal",get:function(){return this.viewModel.portal},set:function(e){this.viewModel.portal=e}},{key:"printServiceUrl",get:function(){return this.viewModel.printServiceUrl},set:function(e){this.viewModel.printServiceUrl=e}},{key:"templateCustomTextElements",get:function(){return this.viewModel.templateCustomTextElements},set:function(e){this.viewModel.templateCustomTextElements=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}}]),i}(u);t.__decorate([r.property()],F.prototype,"allowedFormats",null),t.__decorate([r.property()],F.prototype,"allowedLayouts",null),t.__decorate([r.property()],F.prototype,"error",null),t.__decorate([r.property({type:v})],F.prototype,"exportedLinks",void 0),t.__decorate([r.property()],F.prototype,"extraParameters",null),t.__decorate([r.property()],F.prototype,"headingLevel",void 0),t.__decorate([r.property()],F.prototype,"iconClass",void 0),t.__decorate([r.property()],F.prototype,"includeDefaultTemplates",null),t.__decorate([r.property()],F.prototype,"label",null),t.__decorate([r.property(),g.messageBundle("esri/widgets/Print/t9n/Print")],F.prototype,"messages",void 0),t.__decorate([r.property(),g.messageBundle("esri/t9n/common")],F.prototype,"messagesCommon",void 0),t.__decorate([r.property()],F.prototype,"portal",null),t.__decorate([r.property()],F.prototype,"printServiceUrl",null),t.__decorate([r.property()],F.prototype,"templateCustomTextElements",null),t.__decorate([r.property({type:_})],F.prototype,"templateOptions",void 0),t.__decorate([r.property()],F.prototype,"view",null),t.__decorate([r.property({type:m})],F.prototype,"viewModel",void 0),F=t.__decorate([d.subclass("esri.widgets.Print")],F);return F}));
