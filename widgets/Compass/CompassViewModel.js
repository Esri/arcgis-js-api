/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Accessor","../../core/Handles","../../core/watchUtils","../support/GoTo"],(function(t,e,o,i,r,a,n,s,c,d,u,p,h,l){"use strict";const _="esri.widgets.CompassViewModel";let y=function(e){function o(o){var i;return(i=e.call(this,o)||this)._handles=new p,i.orientation={x:0,y:0,z:0},i.view=null,i._updateForCamera=i._updateForCamera.bind(t._assertThisInitialized(i)),i._updateForRotation=i._updateForRotation.bind(t._assertThisInitialized(i)),i._updateRotationWatcher=i._updateRotationWatcher.bind(t._assertThisInitialized(i)),i}t._inheritsLoose(o,e);var i=o.prototype;return i.initialize=function(){this._handles.add(h.init(this,"view",this._updateRotationWatcher))},i.destroy=function(){this._handles.destroy(),this._handles=null,this.view=null},i.reset=function(){if(!this.get("view.ready"))return;const t={};"2d"===this.view.type?t.rotation=0:t.heading=0,this.callGoTo({target:t})},i._updateForRotation=function(t){null!=t&&(this.orientation={z:t})},i._updateForCamera=function(t){if(!t)return;const e=-t.heading;this.orientation={x:0,y:0,z:e}},i._updateRotationWatcher=function(t){this._handles.removeAll(),t&&("2d"===t.type?this._handles.add(h.init(this,"view.rotation",this._updateForRotation)):this._handles.add(h.init(this,"view.camera",this._updateForCamera)))},t._createClass(o,[{key:"canShowNorth",get:function(){const t=this.get("view.spatialReference");return!(!t||!t.isWebMercator&&!t.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]),o}(l.GoToMixin(u));return e.__decorate([a.property({readOnly:!0})],y.prototype,"canShowNorth",null),e.__decorate([a.property()],y.prototype,"orientation",void 0),e.__decorate([a.property({readOnly:!0})],y.prototype,"state",null),e.__decorate([a.property()],y.prototype,"view",void 0),y=e.__decorate([n.subclass(_)],y),y}));
