/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../TimeInterval","../core/arrayUtils","../core/Collection","../core/compilerUtils","../core/maybe","../core/reactiveUtils","../core/timeUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","../intl/date","./Slider","./Widget","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/widgetUtils","../support/themeUtils","./TimeSlider/TimeSliderViewModel"],(function(e,t,i,n,s,o,a,r,l,u,m,c,d,p,v,h,y,f,_,w,x,b,g){"use strict";const k="esri-time-slider",S={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:`${k}`,timeSliderOutOfBounds:`${k}--out-of-bounds`,timeSliderMode:`${k}__mode--`,timeSliderLayout:`${k}__layout--`,timeSliderRow:`${k}__row`,animation:`${k}__animation`,animationButton:`${k}__animation-button`,animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:`${k}__time-extent`,timeExtentGroup:`${k}__time-extent-group`,timeExtentDate:`${k}__time-extent-date`,timeExtentTime:`${k}__time-extent-time`,timeExtentSeparator:`${k}__time-extent-separator`,playbackControls:`${k}__playback-controls`,min:`${k}__min`,minDate:`${k}__min-date`,minTime:`${k}__min-time`,slider:`${k}__slider`,sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:`${k}__max`,maxDate:`${k}__max-date`,maxTime:`${k}__max-time`,previous:`${k}__previous`,previousButton:`${k}__previous-button`,previousIcon:"esri-icon-reverse",next:`${k}__next`,nextButton:`${k}__next-button`,nextIcon:"esri-icon-forward",warning:`${k}__warning`,warningIcon:"esri-icon-notice-triangle",warningText:`${k}__warning-text`,hasActions:`${k}--has-actions`,actions:`${k}__actions`,actionsButton:`${k}__actions-button`},T=3,E=858,M=new o([{minor:new n({value:100,unit:"milliseconds"}),major:new n({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new n({value:500,unit:"milliseconds"}),major:new n({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new n({value:1,unit:"seconds"}),major:new n({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new n({value:2,unit:"seconds"}),major:new n({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new n({value:10,unit:"seconds"}),major:new n({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new n({value:15,unit:"seconds"}),major:new n({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new n({value:1,unit:"minutes"}),major:new n({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new n({value:5,unit:"minutes"}),major:new n({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new n({value:15,unit:"minutes"}),major:new n({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new n({value:1,unit:"hours"}),major:new n({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new n({value:6,unit:"hours"}),major:new n({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new n({value:1,unit:"days"}),major:new n({value:1,unit:"months"}),format:{month:"long"}},{minor:new n({value:2,unit:"days"}),major:new n({value:1,unit:"months"}),format:{month:"short"}},{minor:new n({value:3,unit:"days"}),major:new n({value:1,unit:"months"}),format:{month:"short"}},{minor:new n({value:4,unit:"days"}),major:new n({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new n({value:1,unit:"weeks"}),major:new n({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new n({value:1,unit:"months"}),major:new n({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new n({value:2,unit:"months"}),major:new n({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new n({value:1,unit:"years"}),major:new n({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new n({value:2,unit:"years"}),major:new n({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new n({value:5,unit:"decades"}),major:new n({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:1,unit:"centuries"}),major:new n({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:2,unit:"centuries"}),major:new n({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:5,unit:"centuries"}),major:new n({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:10,unit:"centuries"}),major:new n({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:20,unit:"centuries"}),major:new n({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:50,unit:"centuries"}),major:new n({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:100,unit:"centuries"}),major:new n({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:200,unit:"centuries"}),major:new n({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:500,unit:"centuries"}),major:new n({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:1e3,unit:"centuries"}),major:new n({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let j=function(i){function n(e,t){var n;return(n=i.call(this,e,t)||this)._ignoreNextSliderUpdate=!1,n._slider=new v({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),n._tickFormat=null,n.disabled=!1,n.iconClass=S.widgetIcon,n.labelFormatFunction=null,n.messages=null,n.messagesCommon=null,n.tickConfigs=null,n.timeVisible=!1,n.viewModel=new g,n}t._inheritsLoose(n,i);var o=n.prototype;return o.initialize=function(){this.addHandles([l.watch((()=>this._slider.values),(e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);r.isSome(this.timeExtent)?r.isSome(t)?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:r.isSome(t)&&(this.timeExtent=t)})),l.watch((()=>this.effectiveStops),(()=>this._updateSliderSteps()),l.initial)])},o.loadDependencies=function(){return Promise.all([new Promise(((t,i)=>e(["../chunks/calcite-action"],t,i))),new Promise(((t,i)=>e(["../chunks/calcite-action-menu"],t,i)))])},o.destroy=function(){this._slider.destroy(),this._tickFormat=null},n.getPropertiesFromWebMap=function(){var e=t._asyncToGenerator((function*(e,t){return g.getPropertiesFromWebMap(e,t)}));function i(t,i){return e.apply(this,arguments)}return i}(),o.next=function(){return this.viewModel.next()},o.play=function(){return this.viewModel.play()},o.previous=function(){return this.viewModel.previous()},o.stop=function(){return this.viewModel.stop()},o.render=function(){const{_slider:e,actions:t,domNode:i,effectiveStops:n,fullTimeExtent:o,interactive:a,messages:l,messagesCommon:u,mode:m,tickConfigs:c,timeExtent:d,timeVisible:v,viewModel:{state:h,timeExtentValues:y}}=this;if(r.isSome(o)){const{start:t,end:i}=o;if(r.isSome(t)&&r.isSome(i)){const n=t.getTime(),s=i.getTime(),o=e.min!==n||e.max!==s;if(o&&(e.min=n,e.max=s),r.isSome(c))e.tickConfigs!==c&&(e.tickConfigs=c);else{const t=(s-n)/(e.trackElement?.offsetWidth||400),i=M.find((e=>e.minor.toMilliseconds()>T*t)),a=this._tickFormat!==i&&null!=i;if(a&&(this._tickFormat=i),o||a){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t.classList.add(S.sliderMinorTick)}},n={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t.classList.add(S.sliderMajorTick)},labelFormatFunction:e=>p.formatDate(e,i.format)};e.tickConfigs=[t,n]}}}}const f=r.isNone(this.fullTimeExtent)||r.isNone(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||r.isSome(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||r.isSome(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(f)switch(this._ignoreNextSliderUpdate=!0,m){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else r.isSome(y)?s.equals(e.values,y)||(e.values=y):e.values=null;e.disabled=!a;const _="ready"===h,g="playing"===h,k=f||!a||r.isNone(n)||0===n.length,j="auto"===this.layout?i.clientWidth<E?"compact":"wide":this.layout,C=w.tsx("div",{class:S.animation},w.tsx("button",{"aria-disabled":k?"true":"false","aria-label":g?u.control.stop:u.control.play,bind:this,class:this.classes(S.esriWidgetButton,S.animationButton,k&&S.esriButtonDisabled),disabled:k,title:g?u.control.stop:u.control.play,onclick:this._playOrStopClick,type:"button"},w.tsx("div",{class:this.classes((_||k)&&S.animationPlay,g&&S.animationPause)}))),D=r.isSome(this.labelFormatFunction)?w.tsx("div",{key:"extent",bind:this,class:S.timeExtentDate,"data-type":"extent","data-layout":j,"data-date":r.applySome(d,(e=>[e.start,e.end])),afterCreate:this._createLabel,afterUpdate:this._createLabel}):r.isNone(d)||r.isSome(d)&&d.isAllTime?[w.tsx("div",{class:this.classes(S.warning,S.warningIcon)}),w.tsx("div",{key:"warning-text",class:S.warningText},l.noTimeExtent)]:d.isEmpty?[w.tsx("div",{class:this.classes(S.warning,S.warningIcon)}),w.tsx("div",{key:"warning-text",class:S.warningText},l.emptyTimeExtent)]:[r.isSome(d.start)&&w.tsx("div",{key:"start-date-group",class:S.timeExtentGroup},w.tsx("div",{key:"start-date",class:S.timeExtentDate},this._formatDate(d.start)),v&&w.tsx("div",{key:"start-time",class:S.timeExtentTime},this._formatTime(d.start))),r.isSome(d.start)&&r.isSome(d.end)&&d.start.getTime()!==d.end.getTime()&&w.tsx("div",{key:"separator",class:S.timeExtentSeparator},"–"),r.isSome(d.end)&&(r.isNone(d.start)||d.start.getTime()!==d.end.getTime())&&w.tsx("div",{key:"end-date-group",class:S.timeExtentGroup},w.tsx("div",{key:"end-date",class:S.timeExtentDate},this._formatDate(d.end)),v&&w.tsx("div",{key:"end-time",class:S.timeExtentTime},this._formatTime(d.end)))],$=w.tsx("div",{class:this.classes(S.timeExtent,!a&&S.esriButtonDisabled)},[D]),F=r.isSome(this.labelFormatFunction)?w.tsx("div",{key:"min-date",bind:this,class:S.minDate,"data-date":r.applySome(o,(e=>e.start)),"data-type":"min","data-layout":j,afterCreate:this._createLabel,afterUpdate:this._createLabel}):r.isSome(o)&&r.isSome(o.start)&&[w.tsx("div",{key:"min-date",class:S.minDate},this._formatDate(o.start)),v&&w.tsx("div",{key:"min-time",class:S.minTime},this._formatTime(o.start))],B=w.tsx("div",{class:this.classes(S.min,!a&&S.esriButtonDisabled)},[F]),L=w.tsx("div",{class:S.slider},e.render()),N=r.isSome(this.labelFormatFunction)?w.tsx("div",{key:"max-date",bind:this,class:S.maxDate,"data-date":r.applySome(o,(e=>e.end)),"data-type":"max","data-layout":j,afterCreate:this._createLabel,afterUpdate:this._createLabel}):r.isSome(o)&&r.isSome(o.end)&&[w.tsx("div",{key:"max-date",class:S.maxDate},this._formatDate(o.end)),v&&w.tsx("div",{key:"max-time",class:S.maxTime},this._formatTime(o.end))],I=w.tsx("div",{class:this.classes(S.max,!a&&S.esriButtonDisabled)},[N]),P=w.tsx("div",{class:S.previous},w.tsx("button",{"aria-disabled":k?"true":"false","aria-label":u.pagination.previous,bind:this,class:this.classes(S.esriWidgetButton,S.previousButton,(g||k)&&S.esriButtonDisabled),disabled:k,title:u.pagination.previous,onclick:this._previousClick,type:"button"},w.tsx("div",{class:S.previousIcon}))),U=w.tsx("div",{class:S.next},w.tsx("button",{"aria-disabled":k?"true":"false","aria-label":u.pagination.next,bind:this,class:this.classes(S.esriWidgetButton,S.nextButton,(g||k)&&S.esriButtonDisabled),disabled:k,title:u.pagination.next,onclick:this._nextClick,type:"button"},w.tsx("div",{class:S.nextIcon}))),W=t?.length>0,R=W&&w.tsx("div",{class:S.actions,title:u.options},w.tsx("calcite-action-menu",{label:u.options,class:S.actionsButton},t.toArray().map((e=>w.tsx("calcite-action",{bind:this,icon:e.icon,id:e.id,onCalciteActionClick:()=>this.viewModel.triggerAction(e),text:e.title,textEnabled:!0})))));return w.tsx("div",{class:this.classes(S.timeSlider,S.esriWidget,`${S.timeSliderMode}${m}`,`${S.timeSliderLayout}${j}`,!a&&S.esriDisabled,f&&S.timeSliderOutOfBounds,W&&S.hasActions,b.getCalciteThemeClass()),afterCreate:e=>{this.addHandles(x.onResize(e,(()=>this.scheduleRender())))},"aria-label":l.widgetLabel},"wide"===j&&w.tsx("div",{class:S.timeSliderRow},w.tsx("div",{class:S.playbackControls},[C,$,B,L,I,P,U]),R),"compact"===j&&[w.tsx("div",{key:"time-slider-row-1",class:S.timeSliderRow},[$,R]),w.tsx("div",{key:"time-slider-row-2",class:S.timeSliderRow},[L]),w.tsx("div",{key:"time-slider-row-3",class:S.timeSliderRow},[B,P,C,U,I])])},o.updateWebDocument=function(e){this.viewModel?.updateWebDocument(e)},o._createLabel=function(e){if(r.isNone(this.labelFormatFunction))return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),n=e["data-date"];this.labelFormatFunction(n,t,e,i)},o._getTickPositions=function(e){const{fullTimeExtent:t}=this;if(r.isNone(t)||r.isNone(t.start)||r.isNone(t.end))return[];const{start:i,end:n}=t,s=[],{value:o,unit:a}=e;let l=u.truncateDate(i,a);for(;l.getTime()<=n.getTime();)l.getTime()>=i.getTime()&&s.push(l.getTime()),l=u.offsetDate(l,o,a);return s},o._formatDate=function(e){return e?p.formatDate(e,p.convertDateFormatToIntlOptions("short-date")):null},o._formatTime=function(e){return e?p.formatDate(e,p.convertDateFormatToIntlOptions("long-time")):null},o._updateSliderSteps=function(){this._slider.steps=r.isSome(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null},o._playOrStopClick=function(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:a.neverReached(this.viewModel.state)}},o._previousClick=function(){this.viewModel.previous()},o._nextClick=function(){this.viewModel.next()},t._createClass(n,[{key:"actions",get:function(){return this.viewModel.actions},set:function(e){this.viewModel.actions=e}},{key:"effectiveStops",get:function(){return this.viewModel.effectiveStops}},{key:"fullTimeExtent",get:function(){return this.viewModel.fullTimeExtent},set:function(e){this.viewModel.fullTimeExtent=e}},{key:"interactive",get:function(){return!this.disabled&&"disabled"!==this.viewModel?.state}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"layout",set:function(e){["auto","compact","wide"].includes(e)||(e="auto"),this._set("layout",e)}},{key:"loop",get:function(){return this.viewModel.loop},set:function(e){this.viewModel.loop=e}},{key:"mode",get:function(){return this.viewModel.mode},set:function(e){this.viewModel.mode=e}},{key:"playRate",get:function(){return this.viewModel.playRate},set:function(e){this.viewModel.playRate=e}},{key:"stops",get:function(){return this.viewModel.stops},set:function(e){this.viewModel.stops=e}},{key:"timeExtent",get:function(){return this.viewModel.timeExtent},set:function(e){this.viewModel.timeExtent=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}}]),n}(h);i.__decorate([m.property()],j.prototype,"actions",null),i.__decorate([m.property()],j.prototype,"disabled",void 0),i.__decorate([m.property()],j.prototype,"effectiveStops",null),i.__decorate([m.property()],j.prototype,"fullTimeExtent",null),i.__decorate([m.property()],j.prototype,"iconClass",void 0),i.__decorate([m.property({readOnly:!0})],j.prototype,"interactive",null),i.__decorate([m.property()],j.prototype,"label",null),i.__decorate([m.property()],j.prototype,"labelFormatFunction",void 0),i.__decorate([m.property({value:"auto"})],j.prototype,"layout",null),i.__decorate([m.property()],j.prototype,"loop",null),i.__decorate([m.property(),f.messageBundle("esri/widgets/TimeSlider/t9n/TimeSlider")],j.prototype,"messages",void 0),i.__decorate([m.property(),f.messageBundle("esri/t9n/common")],j.prototype,"messagesCommon",void 0),i.__decorate([m.property()],j.prototype,"mode",null),i.__decorate([m.property()],j.prototype,"playRate",null),i.__decorate([m.property()],j.prototype,"stops",null),i.__decorate([m.property()],j.prototype,"tickConfigs",void 0),i.__decorate([m.property()],j.prototype,"timeExtent",null),i.__decorate([m.property({nonNullable:!0})],j.prototype,"timeVisible",void 0),i.__decorate([m.property()],j.prototype,"view",null),i.__decorate([m.property({type:g}),_.vmEvent("trigger-action")],j.prototype,"viewModel",void 0),i.__decorate([y.accessibleHandler()],j.prototype,"_playOrStopClick",null),i.__decorate([y.accessibleHandler()],j.prototype,"_previousClick",null),i.__decorate([y.accessibleHandler()],j.prototype,"_nextClick",null),j=i.__decorate([d.subclass("esri.widgets.TimeSlider")],j);return j}));
