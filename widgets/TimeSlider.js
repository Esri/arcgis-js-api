/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/compilerUtils","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/subclass","../core/Error","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/arrayUtils","../core/events","../core/Collection","../intl/date","../core/mathUtils","../layers/support/timeUtils","../TimeInterval","../core/watchUtils","../core/throttle","./support/widgetUtils","./support/decorators/accessibleHandler","./support/decorators/messageBundle","../chunks/index","./Widget","./Slider","./TimeSlider/TimeSliderViewModel"],(function(e,t,i,a,s,o,r,n,l,u,m,d,c,v,p,h,f,_,w,y,x,b,g,j,k,T,S,D,E){"use strict";const M={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:"esri-time-slider",timeSliderMode:"esri-time-slider__mode--",timeSliderLayout:"esri-time-slider__layout--",timeSliderRow:"esri-time-slider__row",animation:"esri-time-slider__animation",animationButton:"esri-time-slider__animation-button",animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:"esri-time-slider__time-extent",timeExtentGroup:"esri-time-slider__time-extent-group",timeExtentDate:"esri-time-slider__time-extent-date",timeExtentTime:"esri-time-slider__time-extent-time",timeExtentSeparator:"esri-time-slider__time-extent-separator",min:"esri-time-slider__min",minDate:"esri-time-slider__min-date",slider:"esri-time-slider__slider",sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:"esri-time-slider__max",maxDate:"esri-time-slider__max-date",previous:"esri-time-slider__previous",previousButton:"esri-time-slider__previous-button",previousIcon:"esri-icon-reverse",next:"esri-time-slider__next",nextButton:"esri-time-slider__next-button",nextIcon:"esri-icon-forward"},C=3,F=100,O=858,B=new h([{minor:new y({value:100,unit:"milliseconds"}),major:new y({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new y({value:500,unit:"milliseconds"}),major:new y({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new y({value:1,unit:"seconds"}),major:new y({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new y({value:2,unit:"seconds"}),major:new y({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new y({value:10,unit:"seconds"}),major:new y({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new y({value:15,unit:"seconds"}),major:new y({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new y({value:1,unit:"minutes"}),major:new y({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new y({value:5,unit:"minutes"}),major:new y({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new y({value:15,unit:"minutes"}),major:new y({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new y({value:1,unit:"hours"}),major:new y({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new y({value:6,unit:"hours"}),major:new y({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new y({value:1,unit:"days"}),major:new y({value:1,unit:"months"}),format:{month:"long"}},{minor:new y({value:2,unit:"days"}),major:new y({value:1,unit:"months"}),format:{month:"short"}},{minor:new y({value:3,unit:"days"}),major:new y({value:1,unit:"months"}),format:{month:"short"}},{minor:new y({value:4,unit:"days"}),major:new y({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new y({value:1,unit:"weeks"}),major:new y({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new y({value:1,unit:"months"}),major:new y({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new y({value:2,unit:"months"}),major:new y({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new y({value:1,unit:"years"}),major:new y({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new y({value:2,unit:"years"}),major:new y({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new y({value:5,unit:"decades"}),major:new y({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:1,unit:"centuries"}),major:new y({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:2,unit:"centuries"}),major:new y({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:5,unit:"centuries"}),major:new y({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:10,unit:"centuries"}),major:new y({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:20,unit:"centuries"}),major:new y({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:50,unit:"centuries"}),major:new y({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:100,unit:"centuries"}),major:new y({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:200,unit:"centuries"}),major:new y({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:500,unit:"centuries"}),major:new y({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new y({value:1e3,unit:"centuries"}),major:new y({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let L=function(t){function i(e,i){var a;return(a=t.call(this,e,i)||this)._slider=new D({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1}),a._tickFormat=null,a.disabled=!1,a.effectiveStops=null,a.fullTimeExtent=null,a.iconClass=M.widgetIcon,a.label=void 0,a.labelFormatFunction=null,a.loop=!1,a.messages=null,a.messagesCommon=null,a.mode="time-window",a.playRate=1e3,a.stops={count:10},a.tickConfigs=null,a.timeExtent=null,a.timeVisible=!1,a.values=null,a.view=null,a.viewModel=new E,a}e._inheritsLoose(i,t);var s=i.prototype;return s.initialize=function(){this.own([this._slider.watch("values",(e=>{var t;const i=null==(t=this.values)?void 0:t.map((e=>e.getTime()));v.equals(e,i)||this.set("values",e.map((e=>new Date(e))))})),p.on(window,"resize",b.throttle((()=>this.scheduleRender()),F)),x.init(this,"effectiveStops",(()=>this._updateSliderSteps()))]),this._validateTimeExtent()},s.destroy=function(){this._slider.destroy(),this._tickFormat=null},s.next=function(){},s.play=function(){},s.previous=function(){},s.stop=function(){return null},s.render=function(){var e;const{_slider:t,domNode:i,effectiveStops:a,fullTimeExtent:s,interactive:o,messagesCommon:r,mode:n,tickConfigs:l,timeVisible:u,values:m,viewModel:d}=this;if(null!=s){const{start:e,end:i}=s;if(null!=e&&null!=i){const a=e.getTime(),s=i.getTime(),o=t.min!==a||t.max!==s;if(o&&(t.min=a,t.max=s),null!=l)t.tickConfigs!==l&&(t.tickConfigs=l);else{var c,p;const e=(s-a)/(null!=(c=null==(p=t.trackElement)?void 0:p.offsetWidth)?c:400),i=B.find((t=>t.minor.toMilliseconds()>C*e)),r=this._tickFormat!==i&&null!=i;if(r&&(this._tickFormat=i),o||r){const e={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t.classList.add(M.sliderMinorTick)}},a={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t.classList.add(M.sliderMajorTick)},labelFormatFunction:e=>f.formatDate(e,i.format)};t.tickConfigs=[e,a]}}}}const h=null==m?void 0:m.map((e=>e.getTime()));v.equals(t.values,h)||(t.values=h),t.disabled=!o;const _=null==s?void 0:s.start,w=null==s?void 0:s.end,y=null!=(e=null==m?void 0:m.length)?e:0,x=y&&this._formatDate(m[0]),b=y&&u&&this._formatTime(m[0]),g=y>1&&"time-window"===n&&this._formatDate(m[1]),j=y>1&&"time-window"===n&&u&&this._formatTime(m[1]),{state:k}=d,S="ready"===k,D="playing"===k,E=!o||0===a.length,F="auto"===this.layout?i.clientWidth<O?"compact":"wide":this.layout,L=T.jsx("div",{class:M.animation},T.jsx("button",{"aria-disabled":E?"true":"false","aria-label":D?r.control.stop:r.control.play,bind:this,class:this.classes(M.esriWidgetButton,M.animationButton,E&&M.esriButtonDisabled),disabled:E,title:D?r.control.stop:r.control.play,onclick:this._playOrStopClick,type:"button"},T.jsx("div",{class:this.classes((S||E)&&M.animationPlay,D&&M.animationPause)}))),R=this.labelFormatFunction?T.jsx("div",{key:"extent",bind:this,class:M.timeExtentDate,"data-type":"extent","data-layout":F,"data-date":m,afterCreate:this._createLabel,afterUpdate:this._createLabel}):[x&&T.jsx("div",{key:"start-date-group",class:M.timeExtentGroup},T.jsx("div",{key:"start-date",class:M.timeExtentDate},x),b&&T.jsx("div",{key:"start-time",class:M.timeExtentTime},b)),g&&T.jsx("div",{key:"separator",class:M.timeExtentSeparator},"â€“"),x&&T.jsx("div",{key:"end-date-group",class:M.timeExtentGroup},T.jsx("div",{key:"end-date",class:M.timeExtentDate},g),j&&T.jsx("div",{key:"end-time",class:M.timeExtentTime},j))],W=T.jsx("div",{class:this.classes(M.timeExtent,!o&&M.esriButtonDisabled)},[R]),I=this.labelFormatFunction?T.jsx("div",{key:"min-date",bind:this,class:M.minDate,"data-date":_,"data-type":"min","data-layout":F,afterCreate:this._createLabel,afterUpdate:this._createLabel}):[_&&T.jsx("div",{key:"min-date",class:M.minDate},this._formatDate(_)),_&&u&&T.jsx("div",{key:"min-time"},this._formatTime(_))],U=T.jsx("div",{class:this.classes(M.min,!o&&M.esriButtonDisabled)},[I]),P=T.jsx("div",{class:M.slider},t.render()),V=this.labelFormatFunction?T.jsx("div",{key:"max-date",bind:this,class:M.maxDate,"data-date":w,"data-type":"max","data-layout":F,afterCreate:this._createLabel,afterUpdate:this._createLabel}):[w&&T.jsx("div",{key:"max-date",class:M.maxDate},this._formatDate(w)),w&&u&&T.jsx("div",{key:"max-time"},this._formatTime(w))],H=T.jsx("div",{class:this.classes(M.max,!o&&M.esriButtonDisabled)},[V]),A=T.jsx("div",{class:M.previous},T.jsx("button",{"aria-disabled":E?"true":"false","aria-label":r.pagination.previous,bind:this,class:this.classes(M.esriWidgetButton,M.previousButton,(D||E)&&M.esriButtonDisabled),disabled:E,title:r.pagination.previous,onclick:this._previousClick,type:"button"},T.jsx("div",{class:M.previousIcon}))),$=T.jsx("div",{class:M.next},T.jsx("button",{"aria-disabled":E?"true":"false","aria-label":r.pagination.next,bind:this,class:this.classes(M.esriWidgetButton,M.nextButton,(D||E)&&M.esriButtonDisabled),disabled:E,title:r.pagination.next,onclick:this._nextClick,type:"button"},T.jsx("div",{class:M.nextIcon})));return T.jsx("div",{class:this.classes(M.timeSlider,M.esriWidget,`${M.timeSliderMode}${n}`,`${M.timeSliderLayout}${F}`,!o&&M.esriDisabled)},"wide"===F&&T.jsx("div",{class:M.timeSliderRow},[L,W,U,P,H,A,$]),"compact"===F&&[T.jsx("div",{key:"time-slider-row-1",class:M.timeSliderRow},[W]),T.jsx("div",{key:"time-slider-row-2",class:M.timeSliderRow},[P]),T.jsx("div",{key:"time-slider-row-3",class:M.timeSliderRow},[U,A,L,$,H])])},s.updateWebDocument=function(e){var t;null==(t=this.viewModel)||t.updateWebDocument(e)},s._createLabel=function(e){const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),a=e["data-date"];this.labelFormatFunction(a,t,e,i)},s._getTickPositions=function(e){const{fullTimeExtent:t}=this,{start:i,end:a}=t,s=[],{value:o,unit:r}=e;let n=w.truncateDate(i,r);for(;n.getTime()<=a.getTime();)n.getTime()>=i.getTime()&&s.push(n.getTime()),n=w.offsetDate(n,o,r);return s},s._formatDate=function(e){return f.formatDate(e,f.convertDateFormatToIntlOptions("short-date"))},s._formatTime=function(e){return f.formatDate(e,f.convertDateFormatToIntlOptions("long-time"))},s._updateSliderSteps=function(){this._slider.steps=this.effectiveStops&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null},s._validateTimeExtent=function(){if(this.fullTimeExtent&&this.mode&&this.values){if(!Array.isArray(this.values))throw new u("time-slider:invalid-values","Values must be an array of dates.");if(0===this.values.length||this.values.some((e=>!(e instanceof Date))))throw new u("time-slider:invalid-values","Values must be an array of dates.");switch(this.values=this.values.map((e=>{const t=e.getTime(),i=_.clamp(t,this.fullTimeExtent.start.getTime(),this.fullTimeExtent.end.getTime());return new Date(i)})),this.mode){case"instant":case"cumulative-from-start":case"cumulative-from-end":this.values.length>1&&this.values.splice(1);break;case"time-window":1===this.values.length?this.values.push(this.fullTimeExtent.end):this.values.length>2&&this.values.splice(2),this.values.sort(((e,t)=>e.getTime()-t.getTime()));break;default:a.neverReached(this.mode)}}},s._playOrStopClick=function(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:a.neverReached(this.viewModel.state)}},s._previousClick=function(){this.viewModel.previous()},s._nextClick=function(){this.viewModel.next()},e._createClass(i,[{key:"interactive",get:function(){return!this.disabled&&this.viewModel&&"disabled"!==this.viewModel.state}},{key:"layout",set:function(e){-1===["auto","compact","wide"].indexOf(e)&&(e="auto"),this._set("layout",e)}}]),i}(S);return t.__decorate([r.property()],L.prototype,"disabled",void 0),t.__decorate([n.aliasOf("viewModel.effectiveStops")],L.prototype,"effectiveStops",void 0),t.__decorate([n.aliasOf("viewModel.fullTimeExtent")],L.prototype,"fullTimeExtent",void 0),t.__decorate([r.property()],L.prototype,"iconClass",void 0),t.__decorate([r.property({readOnly:!0})],L.prototype,"interactive",null),t.__decorate([r.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],L.prototype,"label",void 0),t.__decorate([r.property()],L.prototype,"labelFormatFunction",void 0),t.__decorate([r.property({value:"auto"})],L.prototype,"layout",null),t.__decorate([n.aliasOf("viewModel.loop")],L.prototype,"loop",void 0),t.__decorate([r.property(),k.messageBundle("esri/widgets/TimeSlider/t9n/TimeSlider")],L.prototype,"messages",void 0),t.__decorate([r.property(),k.messageBundle("esri/t9n/common")],L.prototype,"messagesCommon",void 0),t.__decorate([n.aliasOf("viewModel.mode")],L.prototype,"mode",void 0),t.__decorate([n.aliasOf("viewModel.playRate")],L.prototype,"playRate",void 0),t.__decorate([n.aliasOf("viewModel.stops")],L.prototype,"stops",void 0),t.__decorate([r.property()],L.prototype,"tickConfigs",void 0),t.__decorate([n.aliasOf("viewModel.timeExtent")],L.prototype,"timeExtent",void 0),t.__decorate([r.property({nonNullable:!0})],L.prototype,"timeVisible",void 0),t.__decorate([n.aliasOf("viewModel.values")],L.prototype,"values",void 0),t.__decorate([n.aliasOf("viewModel.view")],L.prototype,"view",void 0),t.__decorate([r.property({type:E})],L.prototype,"viewModel",void 0),t.__decorate([n.aliasOf("viewModel.next")],L.prototype,"next",null),t.__decorate([n.aliasOf("viewModel.play")],L.prototype,"play",null),t.__decorate([n.aliasOf("viewModel.previous")],L.prototype,"previous",null),t.__decorate([n.aliasOf("viewModel.stop")],L.prototype,"stop",null),t.__decorate([j.accessibleHandler()],L.prototype,"_playOrStopClick",null),t.__decorate([j.accessibleHandler()],L.prototype,"_previousClick",null),t.__decorate([j.accessibleHandler()],L.prototype,"_nextClick",null),L=t.__decorate([l.subclass("esri.widgets.TimeSlider")],L),L}));
