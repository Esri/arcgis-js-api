/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../TimeInterval","../core/arrayUtils","../core/Collection","../core/compilerUtils","../core/maybe","../core/reactiveUtils","../core/timeUtils","../core/accessorSupport/decorators/aliasOf","../core/has","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../intl/date","./Slider","./Widget","./support/decorators/accessibleHandler","./support/decorators/messageBundle","../core/Logger","./support/decorators/vmEvent","./support/jsxFactory","./support/widgetUtils","./support/widgetThemeUtils","./TimeSlider/TimeSliderViewModel"],(function(e,t,i,a,n,s,o,r,l,u,m,c,d,p,v,h,_,f,y,w,x,b,g,k,S,T){"use strict";const E="esri-time-slider",M={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:`${E}`,timeSliderOutOfBounds:`${E}--out-of-bounds`,timeSliderMode:`${E}__mode--`,timeSliderLayout:`${E}__layout--`,timeSliderRow:`${E}__row`,animation:`${E}__animation`,animationButton:`${E}__animation-button`,animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:`${E}__time-extent`,timeExtentGroup:`${E}__time-extent-group`,timeExtentDate:`${E}__time-extent-date`,timeExtentTime:`${E}__time-extent-time`,timeExtentSeparator:`${E}__time-extent-separator`,playbackControls:`${E}__playback-controls`,min:`${E}__min`,minDate:`${E}__min-date`,minTime:`${E}__min-time`,slider:`${E}__slider`,sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:`${E}__max`,maxDate:`${E}__max-date`,maxTime:`${E}__max-time`,previous:`${E}__previous`,previousButton:`${E}__previous-button`,previousIcon:"esri-icon-reverse",next:`${E}__next`,nextButton:`${E}__next-button`,nextIcon:"esri-icon-forward",warning:`${E}__warning`,warningIcon:"esri-icon-notice-triangle",warningText:`${E}__warning-text`,hasActions:`${E}--has-actions`,actions:`${E}__actions`,actionsButton:`${E}__actions-button`},j=3,C=858,D=new s([{minor:new a({value:100,unit:"milliseconds"}),major:new a({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new a({value:500,unit:"milliseconds"}),major:new a({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new a({value:1,unit:"seconds"}),major:new a({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new a({value:2,unit:"seconds"}),major:new a({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new a({value:10,unit:"seconds"}),major:new a({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new a({value:15,unit:"seconds"}),major:new a({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new a({value:1,unit:"minutes"}),major:new a({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new a({value:5,unit:"minutes"}),major:new a({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new a({value:15,unit:"minutes"}),major:new a({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new a({value:1,unit:"hours"}),major:new a({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new a({value:6,unit:"hours"}),major:new a({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new a({value:1,unit:"days"}),major:new a({value:1,unit:"months"}),format:{month:"long"}},{minor:new a({value:2,unit:"days"}),major:new a({value:1,unit:"months"}),format:{month:"short"}},{minor:new a({value:3,unit:"days"}),major:new a({value:1,unit:"months"}),format:{month:"short"}},{minor:new a({value:4,unit:"days"}),major:new a({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new a({value:1,unit:"weeks"}),major:new a({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new a({value:1,unit:"months"}),major:new a({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new a({value:2,unit:"months"}),major:new a({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new a({value:1,unit:"years"}),major:new a({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new a({value:2,unit:"years"}),major:new a({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new a({value:5,unit:"decades"}),major:new a({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:1,unit:"centuries"}),major:new a({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:2,unit:"centuries"}),major:new a({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:5,unit:"centuries"}),major:new a({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:10,unit:"centuries"}),major:new a({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:20,unit:"centuries"}),major:new a({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:50,unit:"centuries"}),major:new a({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:100,unit:"centuries"}),major:new a({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:200,unit:"centuries"}),major:new a({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:500,unit:"centuries"}),major:new a({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new a({value:1e3,unit:"centuries"}),major:new a({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let $=function(i){function a(e,t){var a;return(a=i.call(this,e,t)||this)._ignoreNextSliderUpdate=!1,a._slider=new _({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),a._tickFormat=null,a.actions=null,a.disabled=!1,a.effectiveStops=null,a.fullTimeExtent=null,a.iconClass=M.widgetIcon,a.label=void 0,a.labelFormatFunction=null,a.loop=!1,a.messages=null,a.messagesCommon=null,a.mode="time-window",a.playRate=1e3,a.stops={count:10},a.tickConfigs=null,a.timeExtent=null,a.timeVisible=!1,a.view=null,a.viewModel=new T,a}t._inheritsLoose(a,i);var s=a.prototype;return s.initialize=function(){this.own([l.watch((()=>this._slider.values),(e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);r.isSome(this.timeExtent)?r.isSome(t)?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:r.isSome(t)&&(this.timeExtent=t)})),l.watch((()=>this.effectiveStops),(()=>this._updateSliderSteps()),l.initial)])},s.loadDependencies=function(){return Promise.all([new Promise(((t,i)=>e(["../chunks/calcite-action"],t,i))),new Promise(((t,i)=>e(["../chunks/calcite-action-menu"],t,i)))])},s.destroy=function(){this._slider.destroy(),this._tickFormat=null},a.getPropertiesFromWebMap=function(){var e=t._asyncToGenerator((function*(e,t){return T.getPropertiesFromWebMap(e,t)}));function i(t,i){return e.apply(this,arguments)}return i}(),s.next=function(){},s.play=function(){},s.previous=function(){},s.stop=function(){return null},s.render=function(){const{_slider:e,actions:t,domNode:i,effectiveStops:a,fullTimeExtent:s,interactive:o,messages:l,messagesCommon:u,mode:m,tickConfigs:c,timeExtent:d,timeVisible:p,viewModel:{state:v,timeExtentValues:_}}=this;if(r.isSome(s)){const{start:t,end:i}=s;if(r.isSome(t)&&r.isSome(i)){const a=t.getTime(),n=i.getTime(),s=e.min!==a||e.max!==n;if(s&&(e.min=a,e.max=n),r.isSome(c))e.tickConfigs!==c&&(e.tickConfigs=c);else{var f;const t=(n-a)/((null==(f=e.trackElement)?void 0:f.offsetWidth)||400),i=D.find((e=>e.minor.toMilliseconds()>j*t)),o=this._tickFormat!==i&&null!=i;if(o&&(this._tickFormat=i),s||o){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t.classList.add(M.sliderMinorTick)}},a={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t.classList.add(M.sliderMajorTick)},labelFormatFunction:e=>h.formatDate(e,i.format)};e.tickConfigs=[t,a]}}}}const y=r.isNone(this.fullTimeExtent)||r.isNone(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||r.isSome(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||r.isSome(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(y)switch(this._ignoreNextSliderUpdate=!0,m){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else r.isSome(_)?n.equals(e.values,_)||(e.values=_):e.values=null;e.disabled=!o;const w="ready"===v,x="playing"===v,b=y||!o||r.isNone(a)||0===a.length,T="auto"===this.layout?i.clientWidth<C?"compact":"wide":this.layout,E=g.tsx("div",{class:M.animation},g.tsx("button",{"aria-disabled":b?"true":"false","aria-label":x?u.control.stop:u.control.play,bind:this,class:this.classes(M.esriWidgetButton,M.animationButton,b&&M.esriButtonDisabled),disabled:b,title:x?u.control.stop:u.control.play,onclick:this._playOrStopClick,type:"button"},g.tsx("div",{class:this.classes((w||b)&&M.animationPlay,x&&M.animationPause)}))),$=r.isSome(this.labelFormatFunction)?g.tsx("div",{key:"extent",bind:this,class:M.timeExtentDate,"data-type":"extent","data-layout":T,"data-date":r.applySome(d,(e=>[e.start,e.end])),afterCreate:this._createLabel,afterUpdate:this._createLabel}):r.isNone(d)||r.isSome(d)&&d.isAllTime?[g.tsx("div",{class:this.classes(M.warning,M.warningIcon)}),g.tsx("div",{key:"warning-text",class:M.warningText},l.noTimeExtent)]:d.isEmpty?[g.tsx("div",{class:this.classes(M.warning,M.warningIcon)}),g.tsx("div",{key:"warning-text",class:M.warningText},l.emptyTimeExtent)]:[r.isSome(d.start)&&g.tsx("div",{key:"start-date-group",class:M.timeExtentGroup},g.tsx("div",{key:"start-date",class:M.timeExtentDate},this._formatDate(d.start)),p&&g.tsx("div",{key:"start-time",class:M.timeExtentTime},this._formatTime(d.start))),r.isSome(d.start)&&r.isSome(d.end)&&d.start.getTime()!==d.end.getTime()&&g.tsx("div",{key:"separator",class:M.timeExtentSeparator},"â€“"),r.isSome(d.end)&&(r.isNone(d.start)||d.start.getTime()!==d.end.getTime())&&g.tsx("div",{key:"end-date-group",class:M.timeExtentGroup},g.tsx("div",{key:"end-date",class:M.timeExtentDate},this._formatDate(d.end)),p&&g.tsx("div",{key:"end-time",class:M.timeExtentTime},this._formatTime(d.end)))],F=g.tsx("div",{class:this.classes(M.timeExtent,!o&&M.esriButtonDisabled)},[$]),O=r.isSome(this.labelFormatFunction)?g.tsx("div",{key:"min-date",bind:this,class:M.minDate,"data-date":r.applySome(s,(e=>e.start)),"data-type":"min","data-layout":T,afterCreate:this._createLabel,afterUpdate:this._createLabel}):r.isSome(s)&&r.isSome(s.start)&&[g.tsx("div",{key:"min-date",class:M.minDate},this._formatDate(s.start)),p&&g.tsx("div",{key:"min-time",class:M.minTime},this._formatTime(s.start))],B=g.tsx("div",{class:this.classes(M.min,!o&&M.esriButtonDisabled)},[O]),L=g.tsx("div",{class:M.slider},e.render()),N=r.isSome(this.labelFormatFunction)?g.tsx("div",{key:"max-date",bind:this,class:M.maxDate,"data-date":r.applySome(s,(e=>e.end)),"data-type":"max","data-layout":T,afterCreate:this._createLabel,afterUpdate:this._createLabel}):r.isSome(s)&&r.isSome(s.end)&&[g.tsx("div",{key:"max-date",class:M.maxDate},this._formatDate(s.end)),p&&g.tsx("div",{key:"max-time",class:M.maxTime},this._formatTime(s.end))],I=g.tsx("div",{class:this.classes(M.max,!o&&M.esriButtonDisabled)},[N]),P=g.tsx("div",{class:M.previous},g.tsx("button",{"aria-disabled":b?"true":"false","aria-label":u.pagination.previous,bind:this,class:this.classes(M.esriWidgetButton,M.previousButton,(x||b)&&M.esriButtonDisabled),disabled:b,title:u.pagination.previous,onclick:this._previousClick,type:"button"},g.tsx("div",{class:M.previousIcon}))),U=g.tsx("div",{class:M.next},g.tsx("button",{"aria-disabled":b?"true":"false","aria-label":u.pagination.next,bind:this,class:this.classes(M.esriWidgetButton,M.nextButton,(x||b)&&M.esriButtonDisabled),disabled:b,title:u.pagination.next,onclick:this._nextClick,type:"button"},g.tsx("div",{class:M.nextIcon}))),W=(null==t?void 0:t.length)>0,R=W&&g.tsx("div",{class:M.actions,title:u.options},g.tsx("calcite-action-menu",{label:u.options,class:M.actionsButton},t.toArray().map((e=>g.tsx("calcite-action",{bind:this,icon:e.icon,id:e.id,onCalciteActionClick:()=>this.viewModel.triggerAction(e),text:e.title,textEnabled:!0})))));return g.tsx("div",{class:this.classes(M.timeSlider,M.esriWidget,`${M.timeSliderMode}${m}`,`${M.timeSliderLayout}${T}`,!o&&M.esriDisabled,y&&M.timeSliderOutOfBounds,W&&M.hasActions,S.getCalciteThemeClass()),afterCreate:e=>{this.own(k.onResize(e,(()=>this.scheduleRender())))},"aria-label":l.widgetLabel},"wide"===T&&g.tsx("div",{class:M.timeSliderRow},g.tsx("div",{class:M.playbackControls},[E,F,B,L,I,P,U]),R),"compact"===T&&[g.tsx("div",{key:"time-slider-row-1",class:M.timeSliderRow},[F,R]),g.tsx("div",{key:"time-slider-row-2",class:M.timeSliderRow},[L]),g.tsx("div",{key:"time-slider-row-3",class:M.timeSliderRow},[B,P,E,U,I])])},s.updateWebDocument=function(e){var t;null==(t=this.viewModel)||t.updateWebDocument(e)},s._createLabel=function(e){if(r.isNone(this.labelFormatFunction))return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),a=e["data-date"];this.labelFormatFunction(a,t,e,i)},s._getTickPositions=function(e){const{fullTimeExtent:t}=this;if(r.isNone(t)||r.isNone(t.start)||r.isNone(t.end))return[];const{start:i,end:a}=t,n=[],{value:s,unit:o}=e;let l=u.truncateDate(i,o);for(;l.getTime()<=a.getTime();)l.getTime()>=i.getTime()&&n.push(l.getTime()),l=u.offsetDate(l,s,o);return n},s._formatDate=function(e){return e?h.formatDate(e,h.convertDateFormatToIntlOptions("short-date")):null},s._formatTime=function(e){return e?h.formatDate(e,h.convertDateFormatToIntlOptions("long-time")):null},s._updateSliderSteps=function(){this._slider.steps=r.isSome(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null},s._playOrStopClick=function(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:o.neverReached(this.viewModel.state)}},s._previousClick=function(){this.viewModel.previous()},s._nextClick=function(){this.viewModel.next()},t._createClass(a,[{key:"interactive",get:function(){return!this.disabled&&this.viewModel&&"disabled"!==this.viewModel.state}},{key:"layout",set:function(e){-1===["auto","compact","wide"].indexOf(e)&&(e="auto"),this._set("layout",e)}}]),a}(f);i.__decorate([m.aliasOf("viewModel.actions")],$.prototype,"actions",void 0),i.__decorate([p.property()],$.prototype,"disabled",void 0),i.__decorate([m.aliasOf("viewModel.effectiveStops")],$.prototype,"effectiveStops",void 0),i.__decorate([m.aliasOf("viewModel.fullTimeExtent")],$.prototype,"fullTimeExtent",void 0),i.__decorate([p.property()],$.prototype,"iconClass",void 0),i.__decorate([p.property({readOnly:!0})],$.prototype,"interactive",null),i.__decorate([p.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],$.prototype,"label",void 0),i.__decorate([p.property()],$.prototype,"labelFormatFunction",void 0),i.__decorate([p.property({value:"auto"})],$.prototype,"layout",null),i.__decorate([m.aliasOf("viewModel.loop")],$.prototype,"loop",void 0),i.__decorate([p.property(),w.messageBundle("esri/widgets/TimeSlider/t9n/TimeSlider")],$.prototype,"messages",void 0),i.__decorate([p.property(),w.messageBundle("esri/t9n/common")],$.prototype,"messagesCommon",void 0),i.__decorate([m.aliasOf("viewModel.mode")],$.prototype,"mode",void 0),i.__decorate([m.aliasOf("viewModel.playRate")],$.prototype,"playRate",void 0),i.__decorate([m.aliasOf("viewModel.stops")],$.prototype,"stops",void 0),i.__decorate([p.property()],$.prototype,"tickConfigs",void 0),i.__decorate([m.aliasOf("viewModel.timeExtent")],$.prototype,"timeExtent",void 0),i.__decorate([p.property({nonNullable:!0})],$.prototype,"timeVisible",void 0),i.__decorate([m.aliasOf("viewModel.view")],$.prototype,"view",void 0),i.__decorate([p.property({type:T}),b.vmEvent("trigger-action")],$.prototype,"viewModel",void 0),i.__decorate([m.aliasOf("viewModel.next")],$.prototype,"next",null),i.__decorate([m.aliasOf("viewModel.play")],$.prototype,"play",null),i.__decorate([m.aliasOf("viewModel.previous")],$.prototype,"previous",null),i.__decorate([m.aliasOf("viewModel.stop")],$.prototype,"stop",null),i.__decorate([y.accessibleHandler()],$.prototype,"_playOrStopClick",null),i.__decorate([y.accessibleHandler()],$.prototype,"_previousClick",null),i.__decorate([y.accessibleHandler()],$.prototype,"_nextClick",null),$=i.__decorate([v.subclass("esri.widgets.TimeSlider")],$);return $}));
