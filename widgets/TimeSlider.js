/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../TimeInterval","../core/arrayUtils","../core/Collection","../core/compilerUtils","../core/events","../core/maybe","../core/throttle","../core/timeUtils","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/has","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../intl/date","./Slider","./Widget","./support/decorators/accessibleHandler","./support/decorators/messageBundle","../core/Logger","./support/decorators/vmEvent","./support/jsxFactory","./support/widgetUtils","./TimeSlider/TimeSliderViewModel"],(function(e,t,i,n,a,s,o,r,l,u,m,c,d,p,v,h,_,f,w,y,x,b,g,k,S,T,E){"use strict";const M="esri-time-slider",j={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:`${M}`,timeSliderOutOfBounds:`${M}--out-of-bounds`,timeSliderMode:`${M}__mode--`,timeSliderLayout:`${M}__layout--`,timeSliderRow:`${M}__row`,animation:`${M}__animation`,animationButton:`${M}__animation-button`,animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:`${M}__time-extent`,timeExtentGroup:`${M}__time-extent-group`,timeExtentDate:`${M}__time-extent-date`,timeExtentTime:`${M}__time-extent-time`,timeExtentSeparator:`${M}__time-extent-separator`,playbackControls:`${M}__playback-controls`,min:`${M}__min`,minDate:`${M}__min-date`,minTime:`${M}__min-time`,slider:`${M}__slider`,sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:`${M}__max`,maxDate:`${M}__max-date`,maxTime:`${M}__max-time`,previous:`${M}__previous`,previousButton:`${M}__previous-button`,previousIcon:"esri-icon-reverse",next:`${M}__next`,nextButton:`${M}__next-button`,nextIcon:"esri-icon-forward",warning:`${M}__warning`,warningIcon:"esri-icon-notice-triangle",warningText:`${M}__warning-text`,hasActions:`${M}--has-actions`,actions:`${M}__actions`,actionsButton:`${M}__actions-button`},C=3,D=100,$=858,F=new s([{minor:new n({value:100,unit:"milliseconds"}),major:new n({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new n({value:500,unit:"milliseconds"}),major:new n({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new n({value:1,unit:"seconds"}),major:new n({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new n({value:2,unit:"seconds"}),major:new n({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new n({value:10,unit:"seconds"}),major:new n({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new n({value:15,unit:"seconds"}),major:new n({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new n({value:1,unit:"minutes"}),major:new n({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new n({value:5,unit:"minutes"}),major:new n({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new n({value:15,unit:"minutes"}),major:new n({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new n({value:1,unit:"hours"}),major:new n({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new n({value:6,unit:"hours"}),major:new n({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new n({value:1,unit:"days"}),major:new n({value:1,unit:"months"}),format:{month:"long"}},{minor:new n({value:2,unit:"days"}),major:new n({value:1,unit:"months"}),format:{month:"short"}},{minor:new n({value:3,unit:"days"}),major:new n({value:1,unit:"months"}),format:{month:"short"}},{minor:new n({value:4,unit:"days"}),major:new n({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new n({value:1,unit:"weeks"}),major:new n({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new n({value:1,unit:"months"}),major:new n({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new n({value:2,unit:"months"}),major:new n({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new n({value:1,unit:"years"}),major:new n({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new n({value:2,unit:"years"}),major:new n({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new n({value:5,unit:"decades"}),major:new n({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:1,unit:"centuries"}),major:new n({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:2,unit:"centuries"}),major:new n({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:5,unit:"centuries"}),major:new n({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:10,unit:"centuries"}),major:new n({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:20,unit:"centuries"}),major:new n({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:50,unit:"centuries"}),major:new n({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:100,unit:"centuries"}),major:new n({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:200,unit:"centuries"}),major:new n({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:500,unit:"centuries"}),major:new n({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new n({value:1e3,unit:"centuries"}),major:new n({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let O=function(i){function n(e,t){var n;return(n=i.call(this,e,t)||this)._ignoreNextSliderUpdate=!1,n._slider=new w({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),n._tickFormat=null,n.actions=null,n.disabled=!1,n.effectiveStops=null,n.fullTimeExtent=null,n.iconClass=j.widgetIcon,n.label=void 0,n.labelFormatFunction=null,n.loop=!1,n.messages=null,n.messagesCommon=null,n.mode="time-window",n.playRate=1e3,n.stops={count:10},n.tickConfigs=null,n.timeExtent=null,n.timeVisible=!1,n.values=null,n.view=null,n.viewModel=new E,n}t._inheritsLoose(n,i);var s=n.prototype;return s.initialize=function(){this.own([this._slider.watch("values",(e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);l.isSome(this.timeExtent)?l.isSome(t)?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:l.isSome(t)&&(this.timeExtent=t)})),r.on(window,"resize",u.throttle((()=>this.scheduleRender()),D)),c.init(this,"effectiveStops",(()=>this._updateSliderSteps()))])},s.loadDependencies=function(){return Promise.all([new Promise(((t,i)=>e(["../chunks/calcite-action"],t,i))),new Promise(((t,i)=>e(["../chunks/calcite-action-menu"],t,i)))])},s.destroy=function(){this._slider.destroy(),this._tickFormat=null},n.getPropertiesFromWebMap=function(){var e=t._asyncToGenerator((function*(e,t){return E.getPropertiesFromWebMap(e,t)}));function i(t,i){return e.apply(this,arguments)}return i}(),s.next=function(){},s.play=function(){},s.previous=function(){},s.stop=function(){return null},s.render=function(){const{_slider:e,actions:t,domNode:i,effectiveStops:n,fullTimeExtent:s,interactive:o,messagesCommon:r,mode:u,tickConfigs:m,timeExtent:c,timeVisible:d,viewModel:{state:p,timeExtentValues:v}}=this;if(l.isSome(s)){const{start:t,end:i}=s;if(l.isSome(t)&&l.isSome(i)){const n=t.getTime(),a=i.getTime(),s=e.min!==n||e.max!==a;if(s&&(e.min=n,e.max=a),l.isSome(m))e.tickConfigs!==m&&(e.tickConfigs=m);else{var h;const t=(a-n)/((null==(h=e.trackElement)?void 0:h.offsetWidth)||400),i=F.find((e=>e.minor.toMilliseconds()>C*t)),o=this._tickFormat!==i&&null!=i;if(o&&(this._tickFormat=i),s||o){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t.classList.add(j.sliderMinorTick)}},n={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t.classList.add(j.sliderMajorTick)},labelFormatFunction:e=>f.formatDate(e,i.format)};e.tickConfigs=[t,n]}}}}const _=l.isNone(this.fullTimeExtent)||l.isNone(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||l.isSome(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||l.isSome(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(_)switch(this._ignoreNextSliderUpdate=!0,u){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else l.isSome(v)?a.equals(e.values,v)||(e.values=v):e.values=null;e.disabled=!o;const w="ready"===p,y="playing"===p,x=_||!o||l.isNone(n)||0===n.length,b="auto"===this.layout?i.clientWidth<$?"compact":"wide":this.layout,g=S.tsx("div",{class:j.animation},S.tsx("button",{"aria-disabled":x?"true":"false","aria-label":y?r.control.stop:r.control.play,bind:this,class:this.classes(j.esriWidgetButton,j.animationButton,x&&j.esriButtonDisabled),disabled:x,title:y?r.control.stop:r.control.play,onclick:this._playOrStopClick,type:"button"},S.tsx("div",{class:this.classes((w||x)&&j.animationPlay,y&&j.animationPause)}))),k=l.isSome(this.labelFormatFunction)?S.tsx("div",{key:"extent",bind:this,class:j.timeExtentDate,"data-type":"extent","data-layout":b,"data-date":l.andThen(c,(e=>[e.start,e.end])),afterCreate:this._createLabel,afterUpdate:this._createLabel}):l.isNone(c)||l.isSome(c)&&c.isAllTime?[S.tsx("div",{class:this.classes(j.warning,j.warningIcon)}),S.tsx("div",{key:"warning-text",class:j.warningText},this.messages.noTimeExtent)]:c.isEmpty?[S.tsx("div",{class:this.classes(j.warning,j.warningIcon)}),S.tsx("div",{key:"warning-text",class:j.warningText},this.messages.emptyTimeExtent)]:[l.isSome(c.start)&&S.tsx("div",{key:"start-date-group",class:j.timeExtentGroup},S.tsx("div",{key:"start-date",class:j.timeExtentDate},this._formatDate(c.start)),d&&S.tsx("div",{key:"start-time",class:j.timeExtentTime},this._formatTime(c.start))),l.isSome(c.start)&&l.isSome(c.end)&&c.start.getTime()!==c.end.getTime()&&S.tsx("div",{key:"separator",class:j.timeExtentSeparator},"–"),l.isSome(c.end)&&(l.isNone(c.start)||c.start.getTime()!==c.end.getTime())&&S.tsx("div",{key:"end-date-group",class:j.timeExtentGroup},S.tsx("div",{key:"end-date",class:j.timeExtentDate},this._formatDate(c.end)),d&&S.tsx("div",{key:"end-time",class:j.timeExtentTime},this._formatTime(c.end)))],E=S.tsx("div",{class:this.classes(j.timeExtent,!o&&j.esriButtonDisabled)},[k]),M=l.isSome(this.labelFormatFunction)?S.tsx("div",{key:"min-date",bind:this,class:j.minDate,"data-date":l.andThen(s,(e=>e.start)),"data-type":"min","data-layout":b,afterCreate:this._createLabel,afterUpdate:this._createLabel}):l.isSome(s)&&l.isSome(s.start)&&[S.tsx("div",{key:"min-date",class:j.minDate},this._formatDate(s.start)),d&&S.tsx("div",{key:"min-time",class:j.minTime},this._formatTime(s.start))],D=S.tsx("div",{class:this.classes(j.min,!o&&j.esriButtonDisabled)},[M]),O=S.tsx("div",{class:j.slider},e.render()),B=l.isSome(this.labelFormatFunction)?S.tsx("div",{key:"max-date",bind:this,class:j.maxDate,"data-date":l.andThen(s,(e=>e.end)),"data-type":"max","data-layout":b,afterCreate:this._createLabel,afterUpdate:this._createLabel}):l.isSome(s)&&l.isSome(s.end)&&[S.tsx("div",{key:"max-date",class:j.maxDate},this._formatDate(s.end)),d&&S.tsx("div",{key:"max-time",class:j.maxTime},this._formatTime(s.end))],L=S.tsx("div",{class:this.classes(j.max,!o&&j.esriButtonDisabled)},[B]),N=S.tsx("div",{class:j.previous},S.tsx("button",{"aria-disabled":x?"true":"false","aria-label":r.pagination.previous,bind:this,class:this.classes(j.esriWidgetButton,j.previousButton,(y||x)&&j.esriButtonDisabled),disabled:x,title:r.pagination.previous,onclick:this._previousClick,type:"button"},S.tsx("div",{class:j.previousIcon}))),I=S.tsx("div",{class:j.next},S.tsx("button",{"aria-disabled":x?"true":"false","aria-label":r.pagination.next,bind:this,class:this.classes(j.esriWidgetButton,j.nextButton,(y||x)&&j.esriButtonDisabled),disabled:x,title:r.pagination.next,onclick:this._nextClick,type:"button"},S.tsx("div",{class:j.nextIcon}))),P=(null==t?void 0:t.length)>0,W=P&&S.tsx("div",{class:j.actions,title:r.options},S.tsx("calcite-action-menu",{label:r.options,class:j.actionsButton},t.toArray().map((e=>S.tsx("calcite-action",{bind:this,icon:e.icon,id:e.id,onCalciteActionClick:()=>this.viewModel.triggerAction(e),text:e.title,textEnabled:!0})))));return S.tsx("div",{class:this.classes(j.timeSlider,j.esriWidget,`${j.timeSliderMode}${u}`,`${j.timeSliderLayout}${b}`,!o&&j.esriDisabled,_&&j.timeSliderOutOfBounds,P&&j.hasActions,T.getCalciteThemeClass())},"wide"===b&&S.tsx("div",{class:j.timeSliderRow},S.tsx("div",{class:j.playbackControls},[g,E,D,O,L,N,I]),W),"compact"===b&&[S.tsx("div",{key:"time-slider-row-1",class:j.timeSliderRow},[E,W]),S.tsx("div",{key:"time-slider-row-2",class:j.timeSliderRow},[O]),S.tsx("div",{key:"time-slider-row-3",class:j.timeSliderRow},[D,N,g,I,L])])},s.updateWebDocument=function(e){var t;null==(t=this.viewModel)||t.updateWebDocument(e)},s._createLabel=function(e){if(l.isNone(this.labelFormatFunction))return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),n=e["data-date"];this.labelFormatFunction(n,t,e,i)},s._getTickPositions=function(e){const{fullTimeExtent:t}=this;if(l.isNone(t)||l.isNone(t.start)||l.isNone(t.end))return[];const{start:i,end:n}=t,a=[],{value:s,unit:o}=e;let r=m.truncateDate(i,o);for(;r.getTime()<=n.getTime();)r.getTime()>=i.getTime()&&a.push(r.getTime()),r=m.offsetDate(r,s,o);return a},s._formatDate=function(e){return e?f.formatDate(e,f.convertDateFormatToIntlOptions("short-date")):null},s._formatTime=function(e){return e?f.formatDate(e,f.convertDateFormatToIntlOptions("long-time")):null},s._updateSliderSteps=function(){this._slider.steps=l.isSome(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null},s._playOrStopClick=function(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:o.neverReached(this.viewModel.state)}},s._previousClick=function(){this.viewModel.previous()},s._nextClick=function(){this.viewModel.next()},t._createClass(n,[{key:"interactive",get:function(){return!this.disabled&&this.viewModel&&"disabled"!==this.viewModel.state}},{key:"layout",set:function(e){-1===["auto","compact","wide"].indexOf(e)&&(e="auto"),this._set("layout",e)}}]),n}(y);i.__decorate([d.aliasOf("viewModel.actions")],O.prototype,"actions",void 0),i.__decorate([h.property()],O.prototype,"disabled",void 0),i.__decorate([d.aliasOf("viewModel.effectiveStops")],O.prototype,"effectiveStops",void 0),i.__decorate([d.aliasOf("viewModel.fullTimeExtent")],O.prototype,"fullTimeExtent",void 0),i.__decorate([h.property()],O.prototype,"iconClass",void 0),i.__decorate([h.property({readOnly:!0})],O.prototype,"interactive",null),i.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],O.prototype,"label",void 0),i.__decorate([h.property()],O.prototype,"labelFormatFunction",void 0),i.__decorate([h.property({value:"auto"})],O.prototype,"layout",null),i.__decorate([d.aliasOf("viewModel.loop")],O.prototype,"loop",void 0),i.__decorate([h.property(),b.messageBundle("esri/widgets/TimeSlider/t9n/TimeSlider")],O.prototype,"messages",void 0),i.__decorate([h.property(),b.messageBundle("esri/t9n/common")],O.prototype,"messagesCommon",void 0),i.__decorate([d.aliasOf("viewModel.mode")],O.prototype,"mode",void 0),i.__decorate([d.aliasOf("viewModel.playRate")],O.prototype,"playRate",void 0),i.__decorate([d.aliasOf("viewModel.stops")],O.prototype,"stops",void 0),i.__decorate([h.property()],O.prototype,"tickConfigs",void 0),i.__decorate([d.aliasOf("viewModel.timeExtent")],O.prototype,"timeExtent",void 0),i.__decorate([h.property({nonNullable:!0})],O.prototype,"timeVisible",void 0),i.__decorate([d.aliasOf("viewModel.values")],O.prototype,"values",void 0),i.__decorate([d.aliasOf("viewModel.view")],O.prototype,"view",void 0),i.__decorate([h.property({type:E}),k.vmEvent("trigger-action")],O.prototype,"viewModel",void 0),i.__decorate([d.aliasOf("viewModel.next")],O.prototype,"next",null),i.__decorate([d.aliasOf("viewModel.play")],O.prototype,"play",null),i.__decorate([d.aliasOf("viewModel.previous")],O.prototype,"previous",null),i.__decorate([d.aliasOf("viewModel.stop")],O.prototype,"stop",null),i.__decorate([x.accessibleHandler()],O.prototype,"_playOrStopClick",null),i.__decorate([x.accessibleHandler()],O.prototype,"_previousClick",null),i.__decorate([x.accessibleHandler()],O.prototype,"_nextClick",null),O=i.__decorate([_.subclass("esri.widgets.TimeSlider")],O);return O}));
