/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../TimeInterval","../core/arrayUtils","../core/Collection","../core/compilerUtils","../core/events","../core/maybe","../core/throttle","../core/timeUtils","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/has","../core/accessorSupport/ensureType","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../intl/date","./Slider","./Widget","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/jsxFactory","./support/widgetUtils","./TimeSlider/TimeSliderViewModel"],(function(e,t,i,s,n,a,o,r,l,m,u,d,c,p,v,h,_,f,w,y,x,b,g,S,k){"use strict";const T={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:"esri-time-slider",timeSliderOutOfBounds:"esri-time-slider--out-of-bounds",timeSliderMode:"esri-time-slider__mode--",timeSliderLayout:"esri-time-slider__layout--",timeSliderRow:"esri-time-slider__row",animation:"esri-time-slider__animation",animationButton:"esri-time-slider__animation-button",animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:"esri-time-slider__time-extent",timeExtentGroup:"esri-time-slider__time-extent-group",timeExtentDate:"esri-time-slider__time-extent-date",timeExtentTime:"esri-time-slider__time-extent-time",timeExtentSeparator:"esri-time-slider__time-extent-separator",min:"esri-time-slider__min",minDate:"esri-time-slider__min-date",slider:"esri-time-slider__slider",sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:"esri-time-slider__max",maxDate:"esri-time-slider__max-date",previous:"esri-time-slider__previous",previousButton:"esri-time-slider__previous-button",previousIcon:"esri-icon-reverse",next:"esri-time-slider__next",nextButton:"esri-time-slider__next-button",nextIcon:"esri-icon-forward",warning:"esri-time-slider__warning",warningIcon:"esri-icon-notice-triangle",warningText:"esri-time-slider__warning-text"},E=3,j=100,M=858,D=new n([{minor:new i({value:100,unit:"milliseconds"}),major:new i({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new i({value:500,unit:"milliseconds"}),major:new i({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new i({value:1,unit:"seconds"}),major:new i({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new i({value:2,unit:"seconds"}),major:new i({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new i({value:10,unit:"seconds"}),major:new i({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new i({value:15,unit:"seconds"}),major:new i({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new i({value:1,unit:"minutes"}),major:new i({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new i({value:5,unit:"minutes"}),major:new i({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new i({value:15,unit:"minutes"}),major:new i({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new i({value:1,unit:"hours"}),major:new i({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new i({value:6,unit:"hours"}),major:new i({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new i({value:1,unit:"days"}),major:new i({value:1,unit:"months"}),format:{month:"long"}},{minor:new i({value:2,unit:"days"}),major:new i({value:1,unit:"months"}),format:{month:"short"}},{minor:new i({value:3,unit:"days"}),major:new i({value:1,unit:"months"}),format:{month:"short"}},{minor:new i({value:4,unit:"days"}),major:new i({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new i({value:1,unit:"weeks"}),major:new i({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new i({value:1,unit:"months"}),major:new i({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new i({value:2,unit:"months"}),major:new i({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new i({value:1,unit:"years"}),major:new i({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new i({value:2,unit:"years"}),major:new i({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new i({value:5,unit:"decades"}),major:new i({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:1,unit:"centuries"}),major:new i({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:2,unit:"centuries"}),major:new i({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:5,unit:"centuries"}),major:new i({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:10,unit:"centuries"}),major:new i({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:20,unit:"centuries"}),major:new i({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:50,unit:"centuries"}),major:new i({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:100,unit:"centuries"}),major:new i({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:200,unit:"centuries"}),major:new i({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:500,unit:"centuries"}),major:new i({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new i({value:1e3,unit:"centuries"}),major:new i({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let C=function(t){function i(e,i){var s;return(s=t.call(this,e,i)||this)._ignoreNextSliderUpdate=!1,s._slider=new w({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1}),s._tickFormat=null,s.disabled=!1,s.effectiveStops=null,s.fullTimeExtent=null,s.iconClass=T.widgetIcon,s.label=void 0,s.labelFormatFunction=null,s.loop=!1,s.messages=null,s.messagesCommon=null,s.mode="time-window",s.playRate=1e3,s.stops={count:10},s.tickConfigs=null,s.timeExtent=null,s.timeVisible=!1,s.values=null,s.view=null,s.viewModel=new k,s}e._inheritsLoose(i,t);var n=i.prototype;return n.initialize=function(){this.own([this._slider.watch("values",(e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);r.isSome(this.timeExtent)?r.isSome(t)?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:r.isSome(t)&&(this.timeExtent=t)})),o.on(window,"resize",l.throttle((()=>this.scheduleRender()),j)),u.init(this,"effectiveStops",(()=>this._updateSliderSteps()))])},n.destroy=function(){this._slider.destroy(),this._tickFormat=null},n.next=function(){},n.play=function(){},n.previous=function(){},n.stop=function(){return null},n.render=function(){const{_slider:e,domNode:t,effectiveStops:i,fullTimeExtent:n,interactive:a,messagesCommon:o,mode:l,tickConfigs:m,timeExtent:u,timeVisible:d,viewModel:{state:c,timeExtentValues:p}}=this;if(r.isSome(n)){const{start:t,end:i}=n;if(r.isSome(t)&&r.isSome(i)){const s=t.getTime(),n=i.getTime(),a=e.min!==s||e.max!==n;if(a&&(e.min=s,e.max=n),r.isSome(m))e.tickConfigs!==m&&(e.tickConfigs=m);else{var v;const t=(n-s)/((null==(v=e.trackElement)?void 0:v.offsetWidth)||400),i=D.find((e=>e.minor.toMilliseconds()>E*t)),o=this._tickFormat!==i&&null!=i;if(o&&(this._tickFormat=i),a||o){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t.classList.add(T.sliderMinorTick)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t.classList.add(T.sliderMajorTick)},labelFormatFunction:e=>f.formatDate(e,i.format)};e.tickConfigs=[t,s]}}}}const h=r.isNone(this.fullTimeExtent)||r.isNone(this.timeExtent)||this.timeExtent.isAllTime||this.timeExtent.isEmpty||r.isSome(this.timeExtent.start)&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||r.isSome(this.timeExtent.end)&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(h)switch(this._ignoreNextSliderUpdate=!0,l){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else r.isSome(p)?s.equals(e.values,p)||(e.values=p):e.values=null;e.disabled=!a;const _="ready"===c,w="playing"===c,y=h||!a||r.isNone(i)||0===i.length,x="auto"===this.layout?t.clientWidth<M?"compact":"wide":this.layout,b=g.tsx("div",{class:T.animation},g.tsx("button",{"aria-disabled":y?"true":"false","aria-label":w?o.control.stop:o.control.play,bind:this,class:this.classes(T.esriWidgetButton,T.animationButton,y&&T.esriButtonDisabled),disabled:y,title:w?o.control.stop:o.control.play,onclick:this._playOrStopClick,type:"button"},g.tsx("div",{class:this.classes((_||y)&&T.animationPlay,w&&T.animationPause)}))),S=r.isSome(this.labelFormatFunction)?g.tsx("div",{key:"extent",bind:this,class:T.timeExtentDate,"data-type":"extent","data-layout":x,"data-date":r.andThen(u,(e=>[e.start,e.end])),afterCreate:this._createLabel,afterUpdate:this._createLabel}):r.isNone(u)||r.isSome(u)&&u.isAllTime?[g.tsx("div",{class:this.classes(T.warning,T.warningIcon)}),g.tsx("div",{key:"warning-text",class:T.warningText},this.messages.noTimeExtent)]:u.isEmpty?[g.tsx("div",{class:this.classes(T.warning,T.warningIcon)}),g.tsx("div",{key:"warning-text",class:T.warningText},this.messages.emptyTimeExtent)]:[r.isSome(u.start)&&g.tsx("div",{key:"start-date-group",class:T.timeExtentGroup},g.tsx("div",{key:"start-date",class:T.timeExtentDate},this._formatDate(u.start)),d&&g.tsx("div",{key:"start-time",class:T.timeExtentTime},this._formatTime(u.start))),r.isSome(u.start)&&r.isSome(u.end)&&u.start.getTime()!==u.end.getTime()&&g.tsx("div",{key:"separator",class:T.timeExtentSeparator},"–"),r.isSome(u.end)&&(r.isNone(u.start)||u.start.getTime()!==u.end.getTime())&&g.tsx("div",{key:"end-date-group",class:T.timeExtentGroup},g.tsx("div",{key:"end-date",class:T.timeExtentDate},this._formatDate(u.end)),d&&g.tsx("div",{key:"end-time",class:T.timeExtentTime},this._formatTime(u.end)))],k=g.tsx("div",{class:this.classes(T.timeExtent,!a&&T.esriButtonDisabled)},[S]),j=r.isSome(this.labelFormatFunction)?g.tsx("div",{key:"min-date",bind:this,class:T.minDate,"data-date":r.andThen(n,(e=>e.start)),"data-type":"min","data-layout":x,afterCreate:this._createLabel,afterUpdate:this._createLabel}):r.isSome(n)&&r.isSome(n.start)&&[g.tsx("div",{key:"min-date",class:T.minDate},this._formatDate(n.start)),d&&g.tsx("div",{key:"min-time"},this._formatTime(n.start))],C=g.tsx("div",{class:this.classes(T.min,!a&&T.esriButtonDisabled)},[j]),O=g.tsx("div",{class:T.slider},e.render()),F=r.isSome(this.labelFormatFunction)?g.tsx("div",{key:"max-date",bind:this,class:T.maxDate,"data-date":r.andThen(n,(e=>e.end)),"data-type":"max","data-layout":x,afterCreate:this._createLabel,afterUpdate:this._createLabel}):r.isSome(n)&&r.isSome(n.end)&&[g.tsx("div",{key:"max-date",class:T.maxDate},this._formatDate(n.end)),d&&g.tsx("div",{key:"max-time"},this._formatTime(n.end))],B=g.tsx("div",{class:this.classes(T.max,!a&&T.esriButtonDisabled)},[F]),L=g.tsx("div",{class:T.previous},g.tsx("button",{"aria-disabled":y?"true":"false","aria-label":o.pagination.previous,bind:this,class:this.classes(T.esriWidgetButton,T.previousButton,(w||y)&&T.esriButtonDisabled),disabled:y,title:o.pagination.previous,onclick:this._previousClick,type:"button"},g.tsx("div",{class:T.previousIcon}))),N=g.tsx("div",{class:T.next},g.tsx("button",{"aria-disabled":y?"true":"false","aria-label":o.pagination.next,bind:this,class:this.classes(T.esriWidgetButton,T.nextButton,(w||y)&&T.esriButtonDisabled),disabled:y,title:o.pagination.next,onclick:this._nextClick,type:"button"},g.tsx("div",{class:T.nextIcon})));return g.tsx("div",{class:this.classes(T.timeSlider,T.esriWidget,`${T.timeSliderMode}${l}`,`${T.timeSliderLayout}${x}`,!a&&T.esriDisabled,h&&T.timeSliderOutOfBounds)},"wide"===x&&g.tsx("div",{class:T.timeSliderRow},[b,k,C,O,B,L,N]),"compact"===x&&[g.tsx("div",{key:"time-slider-row-1",class:T.timeSliderRow},[k]),g.tsx("div",{key:"time-slider-row-2",class:T.timeSliderRow},[O]),g.tsx("div",{key:"time-slider-row-3",class:T.timeSliderRow},[C,L,b,N,B])])},n.updateWebDocument=function(e){var t;null==(t=this.viewModel)||t.updateWebDocument(e)},n._createLabel=function(e){if(r.isNone(this.labelFormatFunction))return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),s=e["data-date"];this.labelFormatFunction(s,t,e,i)},n._getTickPositions=function(e){const{fullTimeExtent:t}=this;if(r.isNone(t)||r.isNone(t.start)||r.isNone(t.end))return[];const{start:i,end:s}=t,n=[],{value:a,unit:o}=e;let l=m.truncateDate(i,o);for(;l.getTime()<=s.getTime();)l.getTime()>=i.getTime()&&n.push(l.getTime()),l=m.offsetDate(l,a,o);return n},n._formatDate=function(e){return e?f.formatDate(e,f.convertDateFormatToIntlOptions("short-date")):null},n._formatTime=function(e){return e?f.formatDate(e,f.convertDateFormatToIntlOptions("long-time")):null},n._updateSliderSteps=function(){this._slider.steps=r.isSome(this.effectiveStops)&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null},n._playOrStopClick=function(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:a.neverReached(this.viewModel.state)}},n._previousClick=function(){this.viewModel.previous()},n._nextClick=function(){this.viewModel.next()},e._createClass(i,[{key:"interactive",get:function(){return!this.disabled&&this.viewModel&&"disabled"!==this.viewModel.state}},{key:"layout",set:function(e){-1===["auto","compact","wide"].indexOf(e)&&(e="auto"),this._set("layout",e)}}]),i}(y);return t.__decorate([h.property()],C.prototype,"disabled",void 0),t.__decorate([d.aliasOf("viewModel.effectiveStops")],C.prototype,"effectiveStops",void 0),t.__decorate([d.aliasOf("viewModel.fullTimeExtent")],C.prototype,"fullTimeExtent",void 0),t.__decorate([h.property()],C.prototype,"iconClass",void 0),t.__decorate([h.property({readOnly:!0})],C.prototype,"interactive",null),t.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],C.prototype,"label",void 0),t.__decorate([h.property()],C.prototype,"labelFormatFunction",void 0),t.__decorate([h.property({value:"auto"})],C.prototype,"layout",null),t.__decorate([d.aliasOf("viewModel.loop")],C.prototype,"loop",void 0),t.__decorate([h.property(),b.messageBundle("esri/widgets/TimeSlider/t9n/TimeSlider")],C.prototype,"messages",void 0),t.__decorate([h.property(),b.messageBundle("esri/t9n/common")],C.prototype,"messagesCommon",void 0),t.__decorate([d.aliasOf("viewModel.mode")],C.prototype,"mode",void 0),t.__decorate([d.aliasOf("viewModel.playRate")],C.prototype,"playRate",void 0),t.__decorate([d.aliasOf("viewModel.stops")],C.prototype,"stops",void 0),t.__decorate([h.property()],C.prototype,"tickConfigs",void 0),t.__decorate([d.aliasOf("viewModel.timeExtent")],C.prototype,"timeExtent",void 0),t.__decorate([h.property({nonNullable:!0})],C.prototype,"timeVisible",void 0),t.__decorate([d.aliasOf("viewModel.values")],C.prototype,"values",void 0),t.__decorate([d.aliasOf("viewModel.view")],C.prototype,"view",void 0),t.__decorate([h.property({type:k})],C.prototype,"viewModel",void 0),t.__decorate([d.aliasOf("viewModel.next")],C.prototype,"next",null),t.__decorate([d.aliasOf("viewModel.play")],C.prototype,"play",null),t.__decorate([d.aliasOf("viewModel.previous")],C.prototype,"previous",null),t.__decorate([d.aliasOf("viewModel.stop")],C.prototype,"stop",null),t.__decorate([x.accessibleHandler()],C.prototype,"_playOrStopClick",null),t.__decorate([x.accessibleHandler()],C.prototype,"_previousClick",null),t.__decorate([x.accessibleHandler()],C.prototype,"_nextClick",null),C=t.__decorate([_.subclass("esri.widgets.TimeSlider")],C),C}));
