/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/HandleOwner","../core/maybe","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./FeatureTemplates/FeatureTemplatesViewModel","./FeatureTemplates/ItemList","./FeatureTemplates/TemplateItem","./support/widgetUtils","./support/decorators/messageBundle","../core/Logger","./support/decorators/vmEvent","./support/jsxFactory"],(function(e,t,r,i,o,s,n,a,l,c,d,u,p,f,m,v,h,_,b,y,I){"use strict";const g={base:"esri-feature-templates",loader:"esri-feature-templates__loader",widget:"esri-widget"};function w(e){return"items"in e}function O(e){return e.length>0&&w(e[0])}function T(e){const{label:t}=e;return w(e)?t:`${t}â€“${e.layer.id}`}const L={filter:!0};let F=function(r){function i(e,i){var s;return(s=r.call(this,e,i)||this)._iconIntersectionObserver=new IntersectionObserver(((e,r)=>{e.forEach(function(){var e=t._asyncToGenerator((function*(e){if(e.isIntersecting){const t=e.target;if(t["data-has-icon"])return void r.unobserve(t);const i=t["data-item"],{layer:s,template:n}=i;t["data-has-icon"]=!0;const a=yield v.fetchThumbnail(s,n).catch((()=>(t["data-has-icon"]=!1,null)));if(o.isNone(a))return;t.appendChild(a)}}));return function(t){return e.apply(this,arguments)}}())})),s.enableListScroll=!0,s.filterFunction=null,s.filterText="",s.groupBy=null,s.headingLevel=4,s.label=void 0,s.layers=null,s.messages=null,s.selectedItem=null,s.viewModel=new f,s.visibleElements={...L},s.renderItemIcon=s.renderItemIcon.bind(t._assertThisInitialized(s)),s._afterItemCreateOrUpdate=s._afterItemCreateOrUpdate.bind(t._assertThisInitialized(s)),s._afterItemRemoved=s._afterItemRemoved.bind(t._assertThisInitialized(s)),s}t._inheritsLoose(i,r);var n=i.prototype;return n.initialize=function(){const e=({label:e})=>!this.filterText||e.toLowerCase().indexOf(this.filterText.toLowerCase())>-1;this.own(s.init(this,"viewModel",((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)})))},n.destroy=function(){this._iconIntersectionObserver&&(this._iconIntersectionObserver.disconnect(),this._iconIntersectionObserver=null)},n.loadDependencies=function(){return Promise.all([new Promise(((t,r)=>e(["../chunks/calcite-icon"],t,r))),new Promise(((t,r)=>e(["../chunks/calcite-input"],t,r))),new Promise(((t,r)=>e(["../chunks/calcite-list-item"],t,r))),new Promise(((t,r)=>e(["../chunks/calcite-progress"],t,r)))])},n.castVisibleElements=function(e){return{...L,...e}},n.select=function(e){return null},n.render=function(){const{enableListScroll:e,filterText:t,headingLevel:r,messages:i,viewModel:{items:o,selectedItem:s,state:n}}=this,a=this.visibleElements.filter;if(O(o)){const e=o.find((e=>e.label===f.nullGroupBy.label));e&&(e.label=i.other)}return I.tsx("div",{class:this.classes(g.base,g.widget),"aria-label":i.widgetLabel},"loading"===n?this.renderLoader():"ready"===n?I.tsx(m.ItemList,{id:this.id,identify:T,filterText:t,items:o,headingLevel:r,messages:{filterPlaceholder:i.filterPlaceholder,noItems:i.noItems,noMatches:i.noMatches},filterEnabled:a,onItemSelect:e=>{this.viewModel.select(e)},onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()},renderIcon:this.renderItemIcon,selectedItem:s,enableListScroll:e}):null)},n.renderItemIcon=function({item:e}){return I.tsx("span",{key:"icon",afterCreate:this._afterItemCreateOrUpdate,afterUpdate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,"data-item":e,"data-has-icon":!1})},n.renderLoader=function(){return I.tsx("div",{class:g.loader,key:"loader"})},n._afterItemCreateOrUpdate=function(e){var t;null==(t=this._iconIntersectionObserver)||t.observe(e)},n._afterItemRemoved=function(e){var t;null==(t=this._iconIntersectionObserver)||t.unobserve(e)},i}(i.HandleOwnerMixin(p));r.__decorate([d.property()],F.prototype,"enableListScroll",void 0),r.__decorate([n.aliasOf("viewModel.filterFunction")],F.prototype,"filterFunction",void 0),r.__decorate([d.property()],F.prototype,"filterText",void 0),r.__decorate([n.aliasOf("viewModel.groupBy")],F.prototype,"groupBy",void 0),r.__decorate([d.property()],F.prototype,"headingLevel",void 0),r.__decorate([d.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],F.prototype,"label",void 0),r.__decorate([n.aliasOf("viewModel.layers")],F.prototype,"layers",void 0),r.__decorate([d.property(),_.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],F.prototype,"messages",void 0),r.__decorate([n.aliasOf("viewModel.selectedItem")],F.prototype,"selectedItem",void 0),r.__decorate([d.property(),y.vmEvent("select")],F.prototype,"viewModel",void 0),r.__decorate([d.property()],F.prototype,"visibleElements",void 0),r.__decorate([c.cast("visibleElements")],F.prototype,"castVisibleElements",null),r.__decorate([n.aliasOf("viewModel.select")],F.prototype,"select",null),F=r.__decorate([u.subclass("esri.widgets.FeatureTemplates")],F);return F}));
