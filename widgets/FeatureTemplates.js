/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/HandleOwner","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/arrayUtils","../core/accessorSupport/decorators/subclass","./Widget","./FeatureTemplates/FeatureTemplatesViewModel","./FeatureTemplates/ItemList","./FeatureTemplates/TemplateItem","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory"],(function(e,t,r,i,n,o,s,l,a,c,d,u,p,f,m,h,v,y){"use strict";const _="esri-feature-templates",b={base:_,loader:`${_}__loader`,widget:"esri-widget"};function I(e){return"items"in e}function g(e){return e.length>0&&I(e[0])}function w(e){return e.id}const T={filter:!0};let M=function(r){function i(e,i){var o;return(o=r.call(this,e,i)||this)._iconIntersectionObserver=new IntersectionObserver(((e,r)=>{e.forEach(function(){var e=t._asyncToGenerator((function*(e){if(e.isIntersecting){const t=e.target;if(t["data-has-icon"])return void r.unobserve(t);const i=t["data-item"],{layer:o,template:s}=i;t["data-has-icon"]=!0;const l=yield f.fetchThumbnail(o,s).catch((()=>(t["data-has-icon"]=!1,null)));if(n.isNone(l))return;t.appendChild(l)}}));return function(t){return e.apply(this,arguments)}}())})),o.enableListScroll=!0,o.filterText="",o.headingLevel=4,o.messages=null,o.viewModel=new u,o.visibleElements={...T},o.renderItemIcon=o.renderItemIcon.bind(t._assertThisInitialized(o)),o._afterItemCreateOrUpdate=o._afterItemCreateOrUpdate.bind(t._assertThisInitialized(o)),o._afterItemRemoved=o._afterItemRemoved.bind(t._assertThisInitialized(o)),o}t._inheritsLoose(i,r);var s=i.prototype;return s.initialize=function(){const e=({label:e})=>!this.filterText||!!e?.toLowerCase().includes(this.filterText.toLowerCase());this.addHandles(o.watch((()=>this.viewModel),((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)}),o.initial))},s.destroy=function(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null},s.loadDependencies=function(){return Promise.all([new Promise(((t,r)=>e(["../chunks/calcite-input"],t,r))),new Promise(((t,r)=>e(["../chunks/calcite-list-item"],t,r)))])},s.castVisibleElements=function(e){return{...T,...e}},s.select=function(e,t){return this.viewModel.select(e,t)},s.render=function(){const{enableListScroll:e,filterText:t,headingLevel:r,messages:i,viewModel:{items:n,numberOfFeatureTemplates:o,selectedItem:s,state:l}}=this,a=this.visibleElements.filter&&o>1;if(g(n)){const e=n.find((e=>e.label===u.nullGroupBy.label));e&&(e.label=i.other)}return y.tsx("div",{class:this.classes(b.base,b.widget),"aria-label":i.widgetLabel},"loading"===l?this.renderLoader():"ready"===l?y.tsx(p.ItemList,{id:this.id,identify:w,filterText:t,items:n,headingLevel:r,selectionMode:"single",messages:{filterPlaceholder:i.filterPlaceholder,noItems:i.noItems,noMatches:i.noMatches},filterEnabled:a,onItemSelect:e=>this.viewModel.select(e),onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()},renderIcon:this.renderItemIcon,selectedItem:s??void 0,enableListScroll:e}):null)},s.renderItemIcon=function({item:e}){return y.tsx("span",{key:"icon",afterCreate:this._afterItemCreateOrUpdate,afterUpdate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,"data-item":e,"data-has-icon":!1})},s.renderLoader=function(){return y.tsx("div",{class:b.loader,key:"loader"})},s._afterItemCreateOrUpdate=function(e){this._iconIntersectionObserver?.observe(e)},s._afterItemRemoved=function(e){this._iconIntersectionObserver?.unobserve(e)},t._createClass(i,[{key:"filterFunction",get:function(){return this.viewModel.filterFunction},set:function(e){this.viewModel.filterFunction=e}},{key:"groupBy",get:function(){return this.viewModel.groupBy},set:function(e){this.viewModel.groupBy=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"layers",get:function(){return this.viewModel.layers},set:function(e){this.viewModel.layers=e}},{key:"selectedItem",get:function(){return this.viewModel.selectedItem}}]),i}(i.HandleOwnerMixin(d));r.__decorate([s.property()],M.prototype,"enableListScroll",void 0),r.__decorate([s.property()],M.prototype,"filterFunction",null),r.__decorate([s.property()],M.prototype,"filterText",void 0),r.__decorate([s.property()],M.prototype,"groupBy",null),r.__decorate([s.property()],M.prototype,"headingLevel",void 0),r.__decorate([s.property()],M.prototype,"label",null),r.__decorate([s.property()],M.prototype,"layers",null),r.__decorate([s.property(),h.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],M.prototype,"messages",void 0),r.__decorate([s.property({readOnly:!0})],M.prototype,"selectedItem",null),r.__decorate([s.property(),v.vmEvent("select")],M.prototype,"viewModel",void 0),r.__decorate([s.property()],M.prototype,"visibleElements",void 0),r.__decorate([l.cast("visibleElements")],M.prototype,"castVisibleElements",null),M=r.__decorate([c.subclass("esri.widgets.FeatureTemplates")],M);return M}));
