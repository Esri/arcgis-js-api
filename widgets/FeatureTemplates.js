/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/HandleOwner","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/arrayUtils","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","./Widget","./FeatureTemplates/FeatureTemplatesViewModel","./FeatureTemplates/ItemList","./FeatureTemplates/TemplateItem","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory"],(function(e,t,r,i,n,s,o,l,a,c,d,u,p,f,m,h,v,y){"use strict";const _={base:"esri-feature-templates",loader:"esri-feature-templates__loader",widget:"esri-widget"};function b(e){return"items"in e}function I(e){return e.length>0&&b(e[0])}function g(e){const{label:t}=e;return b(e)?t:`${t}â€“${e.layer.id}`}const w={filter:!0};let T=function(r){function i(e,i){var s;return(s=r.call(this,e,i)||this)._iconIntersectionObserver=new IntersectionObserver(((e,r)=>{e.forEach(function(){var e=t._asyncToGenerator((function*(e){if(e.isIntersecting){const t=e.target;if(t["data-has-icon"])return void r.unobserve(t);const i=t["data-item"],{layer:s,template:o}=i;t["data-has-icon"]=!0;const l=yield f.fetchThumbnail(s,o).catch((()=>(t["data-has-icon"]=!1,null)));if(n.isNone(l))return;t.appendChild(l)}}));return function(t){return e.apply(this,arguments)}}())})),s.enableListScroll=!0,s.filterText="",s.headingLevel=4,s.messages=null,s.viewModel=new u,s.visibleElements={...w},s.renderItemIcon=s.renderItemIcon.bind(t._assertThisInitialized(s)),s._afterItemCreateOrUpdate=s._afterItemCreateOrUpdate.bind(t._assertThisInitialized(s)),s._afterItemRemoved=s._afterItemRemoved.bind(t._assertThisInitialized(s)),s}t._inheritsLoose(i,r);var o=i.prototype;return o.initialize=function(){const e=({label:e})=>!this.filterText||e.toLowerCase().includes(this.filterText.toLowerCase());this.addHandles(s.watch((()=>this.viewModel),((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)}),s.initial))},o.destroy=function(){this._iconIntersectionObserver&&(this._iconIntersectionObserver.disconnect(),this._iconIntersectionObserver=null)},o.loadDependencies=function(){return Promise.all([new Promise(((t,r)=>e(["../chunks/calcite-input"],t,r))),new Promise(((t,r)=>e(["../chunks/calcite-list-item"],t,r)))])},o.castVisibleElements=function(e){return{...w,...e}},o.select=function(e){return this.viewModel.select(e)},o.render=function(){const{enableListScroll:e,filterText:t,headingLevel:r,messages:i,viewModel:{items:n,numberOfFeatureTemplates:s,selectedItem:o,state:l}}=this,a=this.visibleElements.filter&&s>1;if(I(n)){const e=n.find((e=>e.label===u.nullGroupBy.label));e&&(e.label=i.other)}return y.tsx("div",{class:this.classes(_.base,_.widget),"aria-label":i.widgetLabel},"loading"===l?this.renderLoader():"ready"===l?y.tsx(p.ItemList,{id:this.id,identify:g,filterText:t,items:n,headingLevel:r,messages:{filterPlaceholder:i.filterPlaceholder,noItems:i.noItems,noMatches:i.noMatches},filterEnabled:a,onItemSelect:e=>{this.viewModel.select(e)},onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()},renderIcon:this.renderItemIcon,selectedItem:o,enableListScroll:e}):null)},o.renderItemIcon=function({item:e}){return y.tsx("span",{key:"icon",afterCreate:this._afterItemCreateOrUpdate,afterUpdate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,"data-item":e,"data-has-icon":!1})},o.renderLoader=function(){return y.tsx("div",{class:_.loader,key:"loader"})},o._afterItemCreateOrUpdate=function(e){this._iconIntersectionObserver?.observe(e)},o._afterItemRemoved=function(e){this._iconIntersectionObserver?.unobserve(e)},t._createClass(i,[{key:"filterFunction",get:function(){return this.viewModel.filterFunction},set:function(e){this.viewModel.filterFunction=e}},{key:"groupBy",get:function(){return this.viewModel.groupBy},set:function(e){this.viewModel.groupBy=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"layers",get:function(){return this.viewModel.layers},set:function(e){this.viewModel.layers=e}},{key:"selectedItem",get:function(){return this.viewModel.selectedItem}}]),i}(i.HandleOwnerMixin(d));r.__decorate([o.property()],T.prototype,"enableListScroll",void 0),r.__decorate([o.property()],T.prototype,"filterFunction",null),r.__decorate([o.property()],T.prototype,"filterText",void 0),r.__decorate([o.property()],T.prototype,"groupBy",null),r.__decorate([o.property()],T.prototype,"headingLevel",void 0),r.__decorate([o.property()],T.prototype,"label",null),r.__decorate([o.property()],T.prototype,"layers",null),r.__decorate([o.property(),h.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],T.prototype,"messages",void 0),r.__decorate([o.property({readOnly:!0})],T.prototype,"selectedItem",null),r.__decorate([o.property(),v.vmEvent("select")],T.prototype,"viewModel",void 0),r.__decorate([o.property()],T.prototype,"visibleElements",void 0),r.__decorate([a.cast("visibleElements")],T.prototype,"castVisibleElements",null),T=r.__decorate([c.subclass("esri.widgets.FeatureTemplates")],T);return T}));
