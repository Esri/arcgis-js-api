/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/deprecate","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/watchUtils","../core/HandleOwner","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","../chunks/index","./Widget","./FeatureTemplates/FeatureTemplatesViewModel","./FeatureTemplates/ItemList"],(function(e,t,r,i,s,o,a,n,l,c,d,p,u,f,m,h,v,_,b,I,y){"use strict";const g={base:"esri-feature-templates",loader:"esri-feature-templates__loader",itemIcon:"esri-feature-templates__list-item-icon",widget:"esri-widget"};function w(e){return e.label}const O=i.getLogger("esri.widgets.FeatureTemplates"),T={filter:!0};let E=function(t){function r(r,i){var s;return(s=t.call(this,r,i)||this)._iconIntersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((async e=>{if(e.isIntersecting){const r=e.target;if(!r["data-has-icon"]){const e=r["data-item"];r["data-has-icon"]=!0,t.unobserve(r),await e.fetchThumbnail();r["data-item"]===e&&e.thumbnail?r.appendChild(e.thumbnail):(r["data-has-icon"]=!1,t.observe(r))}}}))})),s.filterFunction=null,s.filterText="",s.groupBy=null,s.label=void 0,s.layers=null,s.messages=null,s.viewModel=new I,s.visibleElements={...T},s.renderItemIcon=s.renderItemIcon.bind(e._assertThisInitialized(s)),s._afterItemCreateOrUpdate=s._afterItemCreateOrUpdate.bind(e._assertThisInitialized(s)),s._afterItemRemoved=s._afterItemRemoved.bind(e._assertThisInitialized(s)),s}e._inheritsLoose(r,t);var i=r.prototype;return i.initialize=function(){const e=({label:e})=>!this.filterText||e.toLowerCase().indexOf(this.filterText.toLowerCase())>-1;this.own(u.init(this,"viewModel",((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)})))},i.destroy=function(){this._iconIntersectionObserver&&(this._iconIntersectionObserver.disconnect(),this._iconIntersectionObserver=null)},i.castVisibleElements=function(e){return{...T,...e}},i.render=function(){const{filterText:e,messages:t,viewModel:{items:r,state:i}}=this,s=this.visibleElements.filter;return _.jsx("div",{class:this.classes(g.base,g.widget),"aria-label":t.widgetLabel},"loading"===i?this.renderLoader():"ready"===i?y.ItemList({id:this.id,identify:w,filterText:e,items:r,messages:{filterPlaceholder:t.filterPlaceholder,noItems:t.noItems,noMatches:t.noMatches},filterEnabled:s,onItemSelect:e=>{this.viewModel.select(e)},onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()},renderIcon:this.renderItemIcon}):null)},i.renderItemIcon=function({item:e}){return _.jsx("span",{key:"icon",class:g.itemIcon,afterCreate:this._afterItemCreateOrUpdate,afterUpdate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,"data-item":e,"data-has-icon":!1})},i.renderLoader=function(){return _.jsx("div",{class:g.loader,key:"loader"})},i._afterItemCreateOrUpdate=function(e){this._iconIntersectionObserver.observe(e)},i._afterItemRemoved=function(e){this._iconIntersectionObserver.unobserve(e)},e._createClass(r,[{key:"filterEnabled",set:function(e){n.deprecatedProperty(O,"filterEnabled",{replacement:"visibleElements.filter",version:"4.15"}),this.visibleElements={...this.visibleElements,filter:e}}}]),r}(f.HandleOwnerMixin(b));return t.__decorate([s.property()],E.prototype,"filterEnabled",null),t.__decorate([o.aliasOf("viewModel.filterFunction")],E.prototype,"filterFunction",void 0),t.__decorate([s.property()],E.prototype,"filterText",void 0),t.__decorate([o.aliasOf("viewModel.groupBy")],E.prototype,"groupBy",void 0),t.__decorate([s.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],E.prototype,"label",void 0),t.__decorate([o.aliasOf("viewModel.layers")],E.prototype,"layers",void 0),t.__decorate([s.property(),h.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],E.prototype,"messages",void 0),t.__decorate([s.property(),v.vmEvent("select")],E.prototype,"viewModel",void 0),t.__decorate([s.property()],E.prototype,"visibleElements",void 0),t.__decorate([a.cast("visibleElements")],E.prototype,"castVisibleElements",null),E=t.__decorate([l.subclass("esri.widgets.FeatureTemplates")],E),E}));
