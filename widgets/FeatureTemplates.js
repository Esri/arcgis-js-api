/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/HandleOwner","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./FeatureTemplates/FeatureTemplatesViewModel","./FeatureTemplates/ItemList","./support/widgetUtils","./support/decorators/messageBundle","../core/Logger","./support/decorators/vmEvent","./support/jsxFactory"],(function(e,t,r,i,s,o,a,n,l,c,d,u,p,f,m,v,h,_){"use strict";const I={base:"esri-feature-templates",loader:"esri-feature-templates__loader",itemIcon:"esri-feature-templates__list-item-icon",widget:"esri-widget"};function b(e){return"items"in e}function y(e){const{label:t}=e;return b(e)?t:`${t}â€“${e.layer.id}`}const g={filter:!0};let w=function(t){function r(r,i){var s;return(s=t.call(this,r,i)||this)._iconIntersectionObserver=new IntersectionObserver(((t,r)=>{t.forEach(function(){var t=e._asyncToGenerator((function*(e){if(e.isIntersecting){const t=e.target;if(!t["data-has-icon"]){const e=t["data-item"];t["data-has-icon"]=!0,r.unobserve(t),yield e.fetchThumbnail();t["data-item"]===e&&e.thumbnail?t.appendChild(e.thumbnail):(t["data-has-icon"]=!1,r.observe(t))}}}));return function(e){return t.apply(this,arguments)}}())})),s.filterFunction=null,s.filterText="",s.groupBy=null,s.headingLevel=4,s.label=void 0,s.layers=null,s.messages=null,s.selectedItem=null,s.viewModel=new u,s.visibleElements={...g},s.renderItemIcon=s.renderItemIcon.bind(e._assertThisInitialized(s)),s._afterItemCreateOrUpdate=s._afterItemCreateOrUpdate.bind(e._assertThisInitialized(s)),s._afterItemRemoved=s._afterItemRemoved.bind(e._assertThisInitialized(s)),s}e._inheritsLoose(r,t);var s=r.prototype;return s.initialize=function(){const e=({label:e})=>!this.filterText||e.toLowerCase().indexOf(this.filterText.toLowerCase())>-1;this.own(i.init(this,"viewModel",((t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)})))},s.destroy=function(){this._iconIntersectionObserver&&(this._iconIntersectionObserver.disconnect(),this._iconIntersectionObserver=null)},s.castVisibleElements=function(e){return{...g,...e}},s.select=function(e){return null},s.render=function(){const{filterText:e,headingLevel:t,messages:r,viewModel:{items:i,selectedItem:s,state:o}}=this,a=this.visibleElements.filter;return _.tsx("div",{class:this.classes(I.base,I.widget),"aria-label":r.widgetLabel},"loading"===o?this.renderLoader():"ready"===o?_.tsx(p.ItemList,{id:this.id,identify:y,filterText:e,items:i,headingLevel:t,messages:{filterPlaceholder:r.filterPlaceholder,noItems:r.noItems,noMatches:r.noMatches},filterEnabled:a,onItemSelect:e=>{this.viewModel.select(e)},onFilterChange:e=>{this.filterText=e,this.viewModel.refresh()},renderIcon:this.renderItemIcon,selectedItem:s}):null)},s.renderItemIcon=function({item:e}){return _.tsx("span",{key:"icon",class:I.itemIcon,afterCreate:this._afterItemCreateOrUpdate,afterUpdate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,"data-item":e,"data-has-icon":!1})},s.renderLoader=function(){return _.tsx("div",{class:I.loader,key:"loader"})},s._afterItemCreateOrUpdate=function(e){this._iconIntersectionObserver.observe(e)},s._afterItemRemoved=function(e){this._iconIntersectionObserver.unobserve(e)},r}(r.HandleOwnerMixin(d));t.__decorate([s.aliasOf("viewModel.filterFunction")],w.prototype,"filterFunction",void 0),t.__decorate([l.property()],w.prototype,"filterText",void 0),t.__decorate([s.aliasOf("viewModel.groupBy")],w.prototype,"groupBy",void 0),t.__decorate([l.property()],w.prototype,"headingLevel",void 0),t.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],w.prototype,"label",void 0),t.__decorate([s.aliasOf("viewModel.layers")],w.prototype,"layers",void 0),t.__decorate([l.property(),m.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],w.prototype,"messages",void 0),t.__decorate([s.aliasOf("viewModel.selectedItem")],w.prototype,"selectedItem",void 0),t.__decorate([l.property(),h.vmEvent("select")],w.prototype,"viewModel",void 0),t.__decorate([l.property()],w.prototype,"visibleElements",void 0),t.__decorate([n.cast("visibleElements")],w.prototype,"castVisibleElements",null),t.__decorate([s.aliasOf("viewModel.select")],w.prototype,"select",null),w=t.__decorate([c.subclass("esri.widgets.FeatureTemplates")],w);return w}));
