/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/maybe","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../intl/substitute","../intl","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/renderable","../chunks/index","./Widget","./Histogram/HistogramViewModel"],(function(e,t,r,a,i,s,n,o,l,d,u,c,h,p,g,_,b,m,f,v){"use strict";var y;const x="esri-histogram",L="esri-histogram--horizontal",w="esri-histogram--vertical",C="esri-histogram__content",F="esri-histogram__svg",M="esri-histogram__bar",N="esri-histogram__bars",B="esri-histogram__label",S="esri-histogram__data-lines",j="esri-histogram__data-lines-subgroup",U="esri-histogram__data-line",A="esri-histogram__average-label",H="esri-histogram__average-data-line",O="esri-histogram__average-symbol",D="esri-widget",V="esri-disabled";let I=y=function(t){function r(e,r){var a;return(a=t.call(this,e,r)||this)._containerNode=null,a._defaultBarColor="#d8d8d8",a.average=null,a.barCreatedFunction=null,a.bins=null,a.dataLines=null,a.dataLineCreatedFunction=null,a.dataLineUpdatedFunction=null,a.label=void 0,a.labelFormatFunction=null,a.max=null,a.messages=null,a.min=null,a.state=null,a.viewModel=new v,a}e._inheritsLoose(r,t),r.fromHistogramResult=function(e){const{bins:t,maxValue:r,minValue:a}=e;return new y({bins:t,max:r,min:a})};var i=r.prototype;return i.render=function(){const{label:e,layout:t,state:r}=this,a=this.classes(x,D,"horizontal"===t?L:w,"disabled"===r?V:null);return m.jsx("div",{"aria-label":e,afterCreate:g.storeNode,bind:this,class:a,"data-node-ref":"_containerNode"},"ready"===r?this.renderContent():null)},i.renderContent=function(){if(this._containerNode)return m.jsx("div",{class:C},m.jsx("svg",{class:F,xmlns:"http://www.w3.org/2000/svg"},this.renderBarsGroup(),this.renderLinesGroup()))},i.renderBarsGroup=function(){return m.jsx("g",{class:this.classes(N)},this.renderBars())},i.renderBars=function(){const{layout:e,viewModel:{binRange:t,range:r}}=this;if(!t||!r)return;const a=t/r,[i,s]=this._getContainerDimensions();if(0===i&&0===s)return;if(0===i&&0!==s)return void this.scheduleRender();const[n,o]="vertical"===e?[i*a,s]:[i,s*a];return this._getBarDimensions(n,o).map((([e,t],r)=>this.renderBar(r,e,t)))},i.renderBar=function(e,t,r){const{bins:a,layout:i,max:s,messages:n,viewModel:{range:o}}=this,[l,d]=this._getContainerDimensions(),u=a.slice()[e],{count:c,maxValue:p,minValue:g}=u,_=s-p,[b,f]="vertical"===i?[0,_*(l/o)]:[d-r-_*(d/o),l-t],v=h.substitute(n.barLabel,{count:c,maxValue:p,minValue:g});return m.jsx("rect",{"aria-label":v,afterCreate:this._afterBarCreate,bind:this,class:M,"data-index":e,fill:this._defaultBarColor,height:t,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:r,x:b,y:f})},i.renderLinesGroup=function(){return m.jsx("g",{class:this.classes(S)},this.renderAverageLine(),this.renderCustomLines())},i.renderAverageLine=function(){const{average:e}=this;if(!a.isSome(e))return;const t=[m.jsx("tspan",{class:this.classes(O)},"xÌ„ "),m.jsx("tspan",{class:this.classes(A)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return m.jsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(j)},this.renderLine(e,this.classes(H)),this.renderLabel(e,t))},i.renderCustomLines=function(){if(this.dataLines&&this.dataLines.length)return this.dataLines.map((({value:e,label:t},r)=>this.renderLineSubgroup(r,e,t)))},i.renderLineSubgroup=function(e,t,r){return m.jsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(j),"data-index":e},this.renderLine(t),this.renderLabel(t,r))},i.renderLine=function(e,t){const[r,a,i,s]=this._getLinePosition(e);return m.jsx("line",{class:this.classes(U,t),x1:r,x2:a,y1:i,y2:s,"shape-rendering":"crispEdges"})},i.renderLabel=function(e,t,r){const[a,i]=this._getLabelPosition(e);return m.jsx("text",{class:this.classes(B,r),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:a,y:i-2},t)},i._afterBarCreate=function(e){if(this.barCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null;this.barCreatedFunction(isNaN(t)?null:t,e)}},i._afterLinesSubgroupCreate=function(e){if(this.dataLineCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,r=e.childNodes[0],a=e.childNodes[1]?e.childNodes[1]:null;this.dataLineCreatedFunction(r,a,isNaN(t)?null:t)}},i._afterLinesSubgroupUpdate=function(e){if(this.dataLineUpdatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,r=e.childNodes[0],a=e.childNodes[1]?e.childNodes[1]:null;this.dataLineUpdatedFunction(r,a,isNaN(t)?null:t)}},i._getContainerDimensions=function(){const{_containerNode:e}=this;return e?[e.offsetHeight,e.offsetWidth]:[0,0]},i._getBarDimensions=function(e,t){const{bins:r,layout:a}=this,i=r?r.map((e=>e.count)):[],s=Math.max.apply(Math,i);return i.map((r=>"vertical"===a?[e/i.length,0!==s?r/s*t:0]:[0!==s?r/s*e:0,t/i.length]))},i._getLinePosition=function(e){const{layout:t,min:r,viewModel:{range:a}}=this,i=Math.round((e-r)/a*100)/100,[s,n]=this._getContainerDimensions(),[o,l]=[i*n||1,s-i*s||1];return"vertical"===t?[0,"100%",l,l]:[o,o,"100%",0]},i._getLabelPosition=function(e){const{layout:t,min:r,viewModel:{range:a}}=this,i=Math.round((e-r)/a*100)/100,[s,n]=this._getContainerDimensions();return"vertical"===t?[n,s-i*s]:[0,i*n]},e._createClass(r,[{key:"layout",set:function(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}}]),r}(f);return t.__decorate([o.aliasOf("viewModel.average")],I.prototype,"average",void 0),t.__decorate([n.property(),b.renderable()],I.prototype,"barCreatedFunction",void 0),t.__decorate([o.aliasOf("viewModel.bins")],I.prototype,"bins",void 0),t.__decorate([n.property(),b.renderable()],I.prototype,"dataLines",void 0),t.__decorate([n.property(),b.renderable()],I.prototype,"dataLineCreatedFunction",void 0),t.__decorate([n.property(),b.renderable()],I.prototype,"dataLineUpdatedFunction",void 0),t.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],I.prototype,"label",void 0),t.__decorate([o.aliasOf("viewModel.labelFormatFunction")],I.prototype,"labelFormatFunction",void 0),t.__decorate([n.property({value:"horizontal"})],I.prototype,"layout",null),t.__decorate([o.aliasOf("viewModel.max")],I.prototype,"max",void 0),t.__decorate([n.property(),b.renderable(),_.messageBundle("esri/widgets/Histogram/t9n/Histogram")],I.prototype,"messages",void 0),t.__decorate([o.aliasOf("viewModel.min")],I.prototype,"min",void 0),t.__decorate([o.aliasOf("viewModel.state")],I.prototype,"state",void 0),t.__decorate([n.property(),b.renderable(["viewModel.average","viewModel.bins","viewModel.labelFormatFunction","viewModel.max","viewModel.min","viewModel.state"])],I.prototype,"viewModel",void 0),I=y=t.__decorate([l.subclass("esri.widgets.Histogram")],I),I}));
