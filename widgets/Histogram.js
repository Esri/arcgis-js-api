/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/maybe","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../chunks/ResizeObserver","./Widget","./Histogram/HistogramViewModel","./support/widgetUtils","./support/decorators/messageBundle","../core/Logger","./support/jsxFactory","../intl/substitute"],(function(e,t,i,r,a,s,n,o,l,d,u,c,h,p,g,_,b,f){"use strict";var v;const m={base:"esri-histogram",horizontalLayout:"esri-histogram--horizontal",verticalLayout:"esri-histogram--vertical",content:"esri-histogram__content",svg:"esri-histogram__svg",bar:"esri-histogram__bar",bars:"esri-histogram__bars",label:"esri-histogram__label",dataLines:"esri-histogram__data-lines",dataLinesSubgroup:"esri-histogram__data-lines-subgroup",dataLine:"esri-histogram__data-line",averageLabel:"esri-histogram__average-label",averageDataLine:"esri-histogram__average-data-line",averageSymbol:"esri-histogram__average-symbol",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"};let y=v=function(t){function i(e,i){var r;return(r=t.call(this,e,i)||this)._bgFillId=null,r._containerNode=null,r._containerOffsetHeight=0,r._containerOffsetWidth=0,r._defaultBarColor="#d8d8d8",r._observer=null,r.average=null,r.barCreatedFunction=null,r.bins=null,r.dataLines=null,r.dataLineCreatedFunction=null,r.dataLineUpdatedFunction=null,r.label=void 0,r.labelFormatFunction=null,r.max=null,r.messages=null,r.min=null,r.state=null,r.viewModel=new h,r._observer=new u.ResizeObserver((()=>{r._storeContainerDimensions(),r.scheduleRender()})),r._bgFillId=`${r.id}-bg-fill`,r}e._inheritsLoose(i,t);var a=i.prototype;return a.destroy=function(){this._containerNode&&this._observer.unobserve(this._containerNode)},i.fromHistogramResult=function(e){const{bins:t,maxValue:i,minValue:r}=e;return new v({bins:t,max:i,min:r})},a.render=function(){const{label:e,layout:t,state:i}=this,r=this.classes(m.base,m.esriWidget,"horizontal"===t?m.horizontalLayout:m.verticalLayout,"disabled"===i?m.disabled:null);return b.tsx("div",{"aria-label":e,afterCreate:this._afterContainerNodeCreate,bind:this,class:r,"data-node-ref":"_containerNode"},"ready"===i?this.renderContent():null)},a.renderContent=function(){if(!this._containerNode)return;const e=this._bgFillId,t=`clip-path: url(#${e})`;return b.tsx("div",{class:m.content},b.tsx("svg",{class:m.svg,xmlns:"http://www.w3.org/2000/svg"},b.tsx("defs",null,this.renderFillDefinition(e)),b.tsx("g",{style:t},this.renderBarsGroup()),this.renderLinesGroup()))},a.renderBarsGroup=function(){return b.tsx("g",{class:this.classes(m.bars)},this.renderBars())},a.renderBars=function(){const{layout:e,viewModel:{binRange:t,range:i}}=this;if(!t||!i)return;const r=t/i,[a,s]=this._getContainerDimensions();if(0===a&&0===s)return;if(0===a&&0!==s)return void this.scheduleRender();const[n,o]="vertical"===e?[a*r,s]:[a,s*r];return this._getBarDimensions(n,o).map((([e,t],i)=>this.renderBar(i,e,t)))},a.renderBar=function(e,t,i){const{bins:r,layout:a,max:s,messages:n,viewModel:{range:o}}=this,[l,d]=this._getContainerDimensions(),u=r.slice()[e],{count:c,maxValue:h,minValue:p}=u,g=s-h,[_,v]="vertical"===a?[0,g*(l/o)]:[d-i-g*(d/o),l-t],y=f.substitute(n.barLabel,{count:c,maxValue:h,minValue:p});return b.tsx("rect",{"aria-label":y,afterCreate:this._afterBarCreate,bind:this,class:m.bar,"data-index":e,fill:this._defaultBarColor,height:t,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:i,x:_,y:v})},a.renderLinesGroup=function(){return b.tsx("g",{class:this.classes(m.dataLines)},this.renderAverageLine(),this.renderCustomLines())},a.renderAverageLine=function(){const{average:e}=this;if(!r.isSome(e))return;const t=[b.tsx("tspan",{class:this.classes(m.averageSymbol)},"xÌ„ "),b.tsx("tspan",{class:this.classes(m.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return b.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(m.dataLinesSubgroup)},b.tsx("title",{key:"title"},e),this.renderLine(e,this.classes(m.averageDataLine)),this.renderLabel(e,t))},a.renderCustomLines=function(){if(this.dataLines&&this.dataLines.length)return this.dataLines.map((({value:e,label:t},i)=>this.renderLineSubgroup(i,e,t)))},a.renderLineSubgroup=function(e,t,i){return b.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(m.dataLinesSubgroup),"data-index":e},b.tsx("title",{key:"title"},t),this.renderLine(t),this.renderLabel(t,i))},a.renderLine=function(e,t){const[i,r,a,s]=this._getLinePosition(e);return b.tsx("line",{class:this.classes(m.dataLine,t),x1:i,x2:r,y1:a,y2:s,"shape-rendering":"crispEdges"})},a.renderLabel=function(e,t,i){const[r,a]=this._getLabelPosition(e),s=2;return b.tsx("text",{class:this.classes(m.label,i),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:r,y:a-s},t)},a.renderFillDefinition=function(e){const[t,i]=this._getContainerDimensions();return b.tsx("clipPath",{id:e},b.tsx("rect",{x:"0",y:"0",width:i,height:t}))},a._afterContainerNodeCreate=function(e){this._containerNode&&this._observer.unobserve(this._containerNode),this._containerNode=e,this._observer.observe(this._containerNode),this._storeContainerDimensions()},a._afterBarCreate=function(e){if(this.barCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null;this.barCreatedFunction(isNaN(t)?null:t,e)}},a._afterLinesSubgroupCreate=function(e){if(this.dataLineCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,i=e.childNodes[0],r=e.childNodes[1]?e.childNodes[1]:null;this.dataLineCreatedFunction(i,r,isNaN(t)?null:t)}},a._afterLinesSubgroupUpdate=function(e){if(this.dataLineUpdatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,i=e.childNodes[0],r=e.childNodes[1]?e.childNodes[1]:null;this.dataLineUpdatedFunction(i,r,isNaN(t)?null:t)}},a._storeContainerDimensions=function(){const{_containerNode:e}=this;e&&(this._containerOffsetHeight=e.offsetHeight,this._containerOffsetWidth=e.offsetWidth)},a._getContainerDimensions=function(){return[this._containerOffsetHeight,this._containerOffsetWidth]},a._getBarDimensions=function(e,t){const{bins:i,layout:r}=this,a=i?i.map((e=>e.count)):[],s=Math.max.apply(Math,a);return a.map((i=>"vertical"===r?[e/a.length,0!==s?i/s*t:0]:[0!==s?i/s*e:0,t/a.length]))},a._getLinePosition=function(e){const{layout:t,min:i,viewModel:{range:r}}=this,a=Math.round((e-i)/r*100)/100,[s,n]=this._getContainerDimensions(),[o,l]=[a*n||1,s-a*s||1];return"vertical"===t?[0,"100%",l,l]:[o,o,"100%",0]},a._getLabelPosition=function(e){const{layout:t,min:i,viewModel:{range:r}}=this,a=Math.round((e-i)/r*100)/100,[s,n]=this._getContainerDimensions();return"vertical"===t?[n,s-a*s]:[0,a*n]},e._createClass(i,[{key:"layout",set:function(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}}]),i}(c);t.__decorate([l.property()],y.prototype,"_containerOffsetHeight",void 0),t.__decorate([l.property()],y.prototype,"_containerOffsetWidth",void 0),t.__decorate([a.aliasOf("viewModel.average")],y.prototype,"average",void 0),t.__decorate([l.property()],y.prototype,"barCreatedFunction",void 0),t.__decorate([a.aliasOf("viewModel.bins")],y.prototype,"bins",void 0),t.__decorate([l.property()],y.prototype,"dataLines",void 0),t.__decorate([l.property()],y.prototype,"dataLineCreatedFunction",void 0),t.__decorate([l.property()],y.prototype,"dataLineUpdatedFunction",void 0),t.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],y.prototype,"label",void 0),t.__decorate([a.aliasOf("viewModel.labelFormatFunction")],y.prototype,"labelFormatFunction",void 0),t.__decorate([l.property({value:"horizontal"})],y.prototype,"layout",null),t.__decorate([a.aliasOf("viewModel.max")],y.prototype,"max",void 0),t.__decorate([l.property(),g.messageBundle("esri/widgets/Histogram/t9n/Histogram")],y.prototype,"messages",void 0),t.__decorate([a.aliasOf("viewModel.min")],y.prototype,"min",void 0),t.__decorate([a.aliasOf("viewModel.state")],y.prototype,"state",void 0),t.__decorate([l.property()],y.prototype,"viewModel",void 0),y=v=t.__decorate([d.subclass("esri.widgets.Histogram")],y);return y}));
