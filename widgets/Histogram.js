/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/maybe","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./Histogram/HistogramViewModel","./support/widgetUtils","./support/decorators/messageBundle","../core/Logger","./support/jsxFactory","../intl/substitute"],(function(e,t,i,a,r,s,n,o,l,d,u,c,h,p,g,_,b){"use strict";var m;const v={base:"esri-histogram",horizontalLayout:"esri-histogram--horizontal",verticalLayout:"esri-histogram--vertical",content:"esri-histogram__content",svg:"esri-histogram__svg",bar:"esri-histogram__bar",bars:"esri-histogram__bars",label:"esri-histogram__label",dataLines:"esri-histogram__data-lines",dataLinesSubgroup:"esri-histogram__data-lines-subgroup",dataLine:"esri-histogram__data-line",averageLabel:"esri-histogram__average-label",averageDataLine:"esri-histogram__average-data-line",averageSymbol:"esri-histogram__average-symbol",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"};let f=m=function(t){function i(e,i){var a;return(a=t.call(this,e,i)||this)._bgFillId=`${a.id}-bg-fill`,a._containerNode=null,a._containerDimensions={width:0,height:0},a._defaultBarColor="#d8d8d8",a.average=null,a.barCreatedFunction=null,a.bins=null,a.dataLines=null,a.dataLineCreatedFunction=null,a.dataLineUpdatedFunction=null,a.label=void 0,a.labelFormatFunction=null,a.max=null,a.messages=null,a.min=null,a.state=null,a.viewModel=new c,a}e._inheritsLoose(i,t),i.fromHistogramResult=function(e){const{bins:t,maxValue:i,minValue:a}=e;return new m({bins:t,max:i,min:a})};var r=i.prototype;return r.render=function(){const{label:e,layout:t,state:i}=this,a=this.classes(v.base,v.esriWidget,"horizontal"===t?v.horizontalLayout:v.verticalLayout,"disabled"===i?v.disabled:null);return _.tsx("div",{"aria-label":e,class:a,bind:this,afterCreate:this._afterContainerNodeCreate},"ready"===i?this.renderContent():null)},r.renderContent=function(){if(!this._containerNode)return;const e=this._bgFillId,t=`clip-path: url(#${e})`;return _.tsx("div",{class:v.content},_.tsx("svg",{class:v.svg,xmlns:"http://www.w3.org/2000/svg"},_.tsx("defs",null,this.renderFillDefinition(e)),_.tsx("g",{style:t},this.renderBarsGroup()),this.renderLinesGroup()))},r.renderBarsGroup=function(){return _.tsx("g",{class:this.classes(v.bars)},this.renderBars())},r.renderBars=function(){const{layout:e,viewModel:{binRange:t,range:i}}=this;if(!t||!i)return;const a=t/i,{width:r,height:s}=this._containerDimensions;if(0===s&&0===r)return;if(0===s&&0!==r)return void this.scheduleRender();const[n,o]="vertical"===e?[s*a,r]:[s,r*a];return this._getBarDimensions(n,o).map((([e,t],i)=>this.renderBar(i,e,t)))},r.renderBar=function(e,t,i){const{bins:a,layout:r,max:s,messages:n,viewModel:{range:o}}=this,{width:l,height:d}=this._containerDimensions,u=a.slice()[e],{count:c,maxValue:h,minValue:p}=u,g=s-h,[m,f]="vertical"===r?[0,g*(d/o)]:[l-i-g*(l/o),d-t],y=b.substitute(n.barLabel,{count:c,maxValue:h,minValue:p});return _.tsx("rect",{"aria-label":y,afterCreate:this._afterBarCreate,bind:this,class:v.bar,"data-index":e,fill:this._defaultBarColor,height:t,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:i,x:m,y:f})},r.renderLinesGroup=function(){return _.tsx("g",{class:this.classes(v.dataLines)},this.renderAverageLine(),this.renderCustomLines())},r.renderAverageLine=function(){const{average:e}=this;if(!a.isSome(e))return;const t=[_.tsx("tspan",{class:this.classes(v.averageSymbol)},"xÌ„ "),_.tsx("tspan",{class:this.classes(v.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return _.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(v.dataLinesSubgroup)},_.tsx("title",{key:"title"},e),this.renderLine(e,this.classes(v.averageDataLine)),this.renderLabel(e,t))},r.renderCustomLines=function(){if(this.dataLines&&this.dataLines.length)return this.dataLines.map((({value:e,label:t},i)=>this.renderLineSubgroup(i,e,t)))},r.renderLineSubgroup=function(e,t,i){return _.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(v.dataLinesSubgroup),"data-index":e},_.tsx("title",{key:"title"},t),this.renderLine(t),this.renderLabel(t,i))},r.renderLine=function(e,t){const[i,a,r,s]=this._getLinePosition(e);return _.tsx("line",{class:this.classes(v.dataLine,t),x1:i,x2:a,y1:r,y2:s,"shape-rendering":"crispEdges"})},r.renderLabel=function(e,t,i){const[a,r]=this._getLabelPosition(e),s=2;return _.tsx("text",{class:this.classes(v.label,i),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:a,y:r-s},t)},r.renderFillDefinition=function(e){const{width:t,height:i}=this._containerDimensions;return _.tsx("clipPath",{id:e},_.tsx("rect",{x:"0",y:"0",width:t,height:i}))},r._afterContainerNodeCreate=function(e){this._containerNode=e,this.own(h.onResize(e,(e=>{const{width:t,height:i}=e.contentRect;this._containerDimensions={width:t,height:i}})))},r._afterBarCreate=function(e){if(this.barCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null;this.barCreatedFunction(isNaN(t)?null:t,e)}},r._afterLinesSubgroupCreate=function(e){if(this.dataLineCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,i=e.childNodes[0],a=e.childNodes[1]?e.childNodes[1]:null;this.dataLineCreatedFunction(i,a,isNaN(t)?null:t)}},r._afterLinesSubgroupUpdate=function(e){if(this.dataLineUpdatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,i=e.childNodes[0],a=e.childNodes[1]?e.childNodes[1]:null;this.dataLineUpdatedFunction(i,a,isNaN(t)?null:t)}},r._getBarDimensions=function(e,t){const{bins:i,layout:a}=this,r=i?i.map((e=>e.count)):[],s=Math.max.apply(Math,r);return r.map((i=>"vertical"===a?[e/r.length,0!==s?i/s*t:0]:[0!==s?i/s*e:0,t/r.length]))},r._getLinePosition=function(e){const{layout:t,min:i,viewModel:{range:a}}=this,r=Math.round((e-i)/a*100)/100,{width:s,height:n}=this._containerDimensions,[o,l]=[r*s||1,n-r*n||1];return"vertical"===t?[0,"100%",l,l]:[o,o,"100%",0]},r._getLabelPosition=function(e){const{layout:t,min:i,viewModel:{range:a}}=this,r=Math.round((e-i)/a*100)/100,{width:s,height:n}=this._containerDimensions;return"vertical"===t?[s,n-r*n]:[0,r*s]},e._createClass(i,[{key:"layout",set:function(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}}]),i}(u);t.__decorate([l.property()],f.prototype,"_bgFillId",void 0),t.__decorate([l.property()],f.prototype,"_containerNode",void 0),t.__decorate([l.property()],f.prototype,"_containerDimensions",void 0),t.__decorate([l.property()],f.prototype,"_defaultBarColor",void 0),t.__decorate([r.aliasOf("viewModel.average")],f.prototype,"average",void 0),t.__decorate([l.property()],f.prototype,"barCreatedFunction",void 0),t.__decorate([r.aliasOf("viewModel.bins")],f.prototype,"bins",void 0),t.__decorate([l.property()],f.prototype,"dataLines",void 0),t.__decorate([l.property()],f.prototype,"dataLineCreatedFunction",void 0),t.__decorate([l.property()],f.prototype,"dataLineUpdatedFunction",void 0),t.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0),t.__decorate([r.aliasOf("viewModel.labelFormatFunction")],f.prototype,"labelFormatFunction",void 0),t.__decorate([l.property({value:"horizontal"})],f.prototype,"layout",null),t.__decorate([r.aliasOf("viewModel.max")],f.prototype,"max",void 0),t.__decorate([l.property(),p.messageBundle("esri/widgets/Histogram/t9n/Histogram")],f.prototype,"messages",void 0),t.__decorate([r.aliasOf("viewModel.min")],f.prototype,"min",void 0),t.__decorate([r.aliasOf("viewModel.state")],f.prototype,"state",void 0),t.__decorate([l.property()],f.prototype,"viewModel",void 0),f=m=t.__decorate([d.subclass("esri.widgets.Histogram")],f);return f}));
