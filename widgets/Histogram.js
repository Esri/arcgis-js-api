/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/maybe","../core/accessorSupport/decorators/property","../core/arrayUtils","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/subclass","./Widget","./Histogram/HistogramViewModel","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","../intl/substitute"],(function(e,t,i,r,n,a,s,o,l,d,u,c,h,p){"use strict";var g;const _={base:"esri-histogram",horizontalLayout:"esri-histogram--horizontal",verticalLayout:"esri-histogram--vertical",content:"esri-histogram__content",svg:"esri-histogram__svg",bar:"esri-histogram__bar",bars:"esri-histogram__bars",label:"esri-histogram__label",dataLines:"esri-histogram__data-lines",dataLinesSubgroup:"esri-histogram__data-lines-subgroup",dataLine:"esri-histogram__data-line",averageLabel:"esri-histogram__average-label",averageDataLine:"esri-histogram__average-data-line",averageSymbol:"esri-histogram__average-symbol",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"};let b=g=function(t){function i(e,i){var r;return(r=t.call(this,e,i)||this)._bgFillId=`${r.id}-bg-fill`,r._containerNode=null,r._containerDimensions={width:0,height:0},r._defaultBarColor="#d8d8d8",r.barCreatedFunction=null,r.dataLines=null,r.dataLineCreatedFunction=null,r.dataLineUpdatedFunction=null,r.messages=null,r.viewModel=new d,r}e._inheritsLoose(i,t),i.fromHistogramResult=function(e){const{bins:t,maxValue:i,minValue:r}=e;return new g({bins:t,max:i,min:r})};var n=i.prototype;return n.render=function(){const{label:e,layout:t,state:i}=this,r=this.classes(_.base,_.esriWidget,"horizontal"===t?_.horizontalLayout:_.verticalLayout,"disabled"===i?_.disabled:null);return h.tsx("div",{"aria-label":e,class:r,bind:this,afterCreate:this._afterContainerNodeCreate},"ready"===i?this.renderContent():null)},n.renderContent=function(){if(!this._containerNode)return;const e=this._bgFillId,t=`clip-path: url(#${e})`;return h.tsx("div",{class:_.content},h.tsx("svg",{class:_.svg,xmlns:"http://www.w3.org/2000/svg"},h.tsx("defs",null,this.renderFillDefinition(e)),h.tsx("g",{style:t},this.renderBarsGroup()),this.renderLinesGroup()))},n.renderBarsGroup=function(){return h.tsx("g",{class:this.classes(_.bars)},this.renderBars())},n.renderBars=function(){const{layout:e,viewModel:{binRange:t,range:i}}=this;if(!t||!i)return;const r=t/i,{width:n,height:a}=this._containerDimensions;if(0===a&&0===n)return;if(0===a&&0!==n)return void this.scheduleRender();const[s,o]="vertical"===e?[a*r,n]:[a,n*r];return this._getBarDimensions(s,o).map((([e,t],i)=>this.renderBar(i,e,t)))},n.renderBar=function(e,t,i){const{bins:r,layout:n,max:a,messages:s,viewModel:{range:o}}=this,{width:l,height:d}=this._containerDimensions,u=r.slice()[e],{count:c,maxValue:g,minValue:b}=u,m=a-g,[y,f]="vertical"===n?[0,m*(d/o)]:[l-i-m*(l/o),d-t],v=p.substitute(s.barLabel,{count:c,maxValue:g,minValue:b});return h.tsx("rect",{"aria-label":v,afterCreate:this._afterBarCreate,bind:this,class:_.bar,"data-index":e,fill:this._defaultBarColor,height:t,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:i,x:y,y:f})},n.renderLinesGroup=function(){return h.tsx("g",{class:this.classes(_.dataLines)},this.renderAverageLine(),this.renderCustomLines())},n.renderAverageLine=function(){const{average:e}=this;if(r.isNone(e))return;const t=[h.tsx("tspan",{class:this.classes(_.averageSymbol)},"xÌ„ "),h.tsx("tspan",{class:this.classes(_.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return h.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(_.dataLinesSubgroup)},h.tsx("title",{key:"title"},e),this.renderLine(e,this.classes(_.averageDataLine)),this.renderLabel(e,t))},n.renderCustomLines=function(){if(this.dataLines&&this.dataLines.length)return this.dataLines.map((({value:e,label:t},i)=>this.renderLineSubgroup(i,e,String(t))))},n.renderLineSubgroup=function(e,t,i){return h.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(_.dataLinesSubgroup),"data-index":e},h.tsx("title",{key:"title"},t),this.renderLine(t),this.renderLabel(t,i))},n.renderLine=function(e,t){const[i,r,n,a]=this._getLinePosition(e);return h.tsx("line",{class:this.classes(_.dataLine,t),x1:i,x2:r,y1:n,y2:a,"shape-rendering":"crispEdges"})},n.renderLabel=function(e,t,i){const[r,n]=this._getLabelPosition(e),a=2;return h.tsx("text",{class:this.classes(_.label,i),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:r,y:n-a},t)},n.renderFillDefinition=function(e){const{width:t,height:i}=this._containerDimensions;return h.tsx("clipPath",{id:e},h.tsx("rect",{x:"0",y:"0",width:t,height:i}))},n._afterContainerNodeCreate=function(e){this._containerNode=e,this.addHandles(u.onResize(e,(e=>{const{width:t,height:i}=e.contentRect;this._containerDimensions={width:t,height:i}})))},n._afterBarCreate=function(e){if(this.barCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null;this.barCreatedFunction(isNaN(t)?null:t,e)}},n._afterLinesSubgroupCreate=function(e){if(this.dataLineCreatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,i=e.childNodes[0],r=e.childNodes[1]?e.childNodes[1]:null;this.dataLineCreatedFunction(i,r,isNaN(t)?null:t)}},n._afterLinesSubgroupUpdate=function(e){if(this.dataLineUpdatedFunction){const t=e.dataset?parseInt(e.dataset.index,10):e.getAttribute("data-index")?parseInt(e.getAttribute("data-index"),10):null,i=e.childNodes[0],r=e.childNodes[1]?e.childNodes[1]:null;this.dataLineUpdatedFunction(i,r,isNaN(t)?null:t)}},n._getBarDimensions=function(e,t){const{bins:i,layout:r}=this,n=i?i.map((e=>e.count)):[],a=Math.max.apply(Math,n);return n.map((i=>"vertical"===r?[e/n.length,0!==a?i/a*t:0]:[0!==a?i/a*e:0,t/n.length]))},n._getLinePosition=function(e){const{layout:t,min:i,viewModel:{range:r}}=this,n=Math.round((e-i)/r*100)/100,{width:a,height:s}=this._containerDimensions,[o,l]=[n*a||1,s-n*s||1];return"vertical"===t?[0,"100%",l,l]:[o,o,"100%",0]},n._getLabelPosition=function(e){const{layout:t,min:i,viewModel:{range:r}}=this,n=Math.round((e-i)/r*100)/100,{width:a,height:s}=this._containerDimensions;return"vertical"===t?[a,s-n*s]:[0,n*a]},e._createClass(i,[{key:"average",get:function(){return this.viewModel.average},set:function(e){this.viewModel.average=e}},{key:"bins",get:function(){return this.viewModel.bins},set:function(e){this.viewModel.bins=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"labelFormatFunction",get:function(){return this.viewModel.labelFormatFunction},set:function(e){this.viewModel.labelFormatFunction=e}},{key:"layout",set:function(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}},{key:"max",get:function(){return this.viewModel.max},set:function(e){this.viewModel.max=e}},{key:"min",get:function(){return this.viewModel.min},set:function(e){this.viewModel.min=e}},{key:"state",get:function(){return this.viewModel.state}}]),i}(l);t.__decorate([n.property()],b.prototype,"_bgFillId",void 0),t.__decorate([n.property()],b.prototype,"_containerNode",void 0),t.__decorate([n.property()],b.prototype,"_containerDimensions",void 0),t.__decorate([n.property()],b.prototype,"_defaultBarColor",void 0),t.__decorate([n.property()],b.prototype,"average",null),t.__decorate([n.property()],b.prototype,"barCreatedFunction",void 0),t.__decorate([n.property()],b.prototype,"dataLines",void 0),t.__decorate([n.property()],b.prototype,"dataLineCreatedFunction",void 0),t.__decorate([n.property()],b.prototype,"dataLineUpdatedFunction",void 0),t.__decorate([n.property()],b.prototype,"label",null),t.__decorate([n.property()],b.prototype,"labelFormatFunction",null),t.__decorate([n.property({value:"horizontal"})],b.prototype,"layout",null),t.__decorate([n.property()],b.prototype,"max",null),t.__decorate([n.property(),c.messageBundle("esri/widgets/Histogram/t9n/Histogram")],b.prototype,"messages",void 0),t.__decorate([n.property()],b.prototype,"min",null),t.__decorate([n.property({readOnly:!0})],b.prototype,"state",null),t.__decorate([n.property()],b.prototype,"viewModel",void 0),b=g=t.__decorate([o.subclass("esri.widgets.Histogram")],b);return b}));
