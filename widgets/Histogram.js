/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/maybe","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/arrayUtils","../core/accessorSupport/decorators/subclass","./Widget","./Histogram/HistogramViewModel","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","../intl/substitute"],(function(e,t,i,n,r,a,s,o,l,d,u,c,h,p){"use strict";var g;const _="esri-histogram",b={base:_,horizontalLayout:`${_}--horizontal`,verticalLayout:`${_}--vertical`,content:`${_}__content`,svg:`${_}__svg`,bar:`${_}__bar`,bars:`${_}__bars`,label:`${_}__label`,dataLines:`${_}__data-lines`,dataLinesSubgroup:`${_}__data-lines-subgroup`,dataLine:`${_}__data-line`,averageLabel:`${_}__average-label`,averageDataLine:`${_}__average-data-line`,averageSymbol:`${_}__average-symbol`,esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"};let f=g=function(t){function i(e,i){var n;return(n=t.call(this,e,i)||this)._bgFillId=`${n.id}-bg-fill`,n._containerNode=null,n._containerDimensions={width:0,height:0},n._defaultBarColor="#d8d8d8",n.barCreatedFunction=null,n.dataLines=null,n.dataLineCreatedFunction=null,n.dataLineUpdatedFunction=null,n.messages=null,n.viewModel=new d,n}e._inheritsLoose(i,t),i.fromHistogramResult=function(e){const{bins:t,maxValue:i,minValue:n}=e;return new g({bins:t,max:i,min:n})};var r=i.prototype;return r.render=function(){const{label:e,layout:t,state:i}=this,n=this.classes(b.base,b.esriWidget,"horizontal"===t?b.horizontalLayout:b.verticalLayout,"disabled"===i?b.disabled:null);return h.tsx("div",{"aria-label":e,class:n,bind:this,afterCreate:this._afterContainerNodeCreate},"ready"===i?this.renderContent():null)},r.renderContent=function(){if(!this._containerNode)return;const e=this._bgFillId,t=`clip-path: url(#${e})`;return h.tsx("div",{class:b.content},h.tsx("svg",{class:b.svg,xmlns:"http://www.w3.org/2000/svg"},h.tsx("defs",null,this.renderFillDefinition(e)),h.tsx("g",{style:t},this.renderBarsGroup()),this.renderLinesGroup()))},r.renderBarsGroup=function(){return h.tsx("g",{class:this.classes(b.bars)},this.renderBars())},r.renderBars=function(){const{layout:e,viewModel:{binRange:t,range:i}}=this;if(!t||!i)return;const n=t/i,{width:r,height:a}=this._containerDimensions;if(0===a&&0===r)return;if(0===a&&0!==r)return void this.scheduleRender();const[s,o]="vertical"===e?[a*n,r]:[a,r*n];return this._getBarDimensions(s,o).map((([e,t],i)=>this.renderBar(i,e,t)))},r.renderBar=function(e,t,i){const{bins:r,layout:a,max:s,messages:o,viewModel:{range:l}}=this;if(!r||n.isNone(s))return;const{width:d,height:u}=this._containerDimensions,c=r.slice()[e],{count:g,maxValue:_,minValue:f}=c,y=s-_,[m,v]="vertical"===a?[0,y*(u/l)]:[d-i-y*(d/l),u-t],L=p.substitute(o.barLabel,{count:g,maxValue:_,minValue:f});return h.tsx("rect",{"aria-label":L,afterCreate:this._afterBarCreate,bind:this,class:b.bar,"data-index":e,fill:this._defaultBarColor,height:t,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:i,x:m,y:v})},r.renderLinesGroup=function(){return h.tsx("g",{class:this.classes(b.dataLines)},this.renderAverageLine(),this.renderCustomLines())},r.renderAverageLine=function(){const{average:e}=this;if(n.isNone(e))return;const t=[h.tsx("tspan",{class:this.classes(b.averageSymbol)},"xÌ„ "),h.tsx("tspan",{class:this.classes(b.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return h.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(b.dataLinesSubgroup)},h.tsx("title",{key:"title"},e),this.renderLine(e,this.classes(b.averageDataLine)),this.renderLabel({label:t,value:e}))},r.renderCustomLines=function(){if(this.dataLines&&this.dataLines.length)return this.dataLines.map(((e,t)=>this.renderLineSubgroup(e,t)))},r.renderLineSubgroup=function(e,t){const{value:i}=e;return h.tsx("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(b.dataLinesSubgroup),"data-index":t},h.tsx("title",{key:"title"},i),this.renderLine(i),this.renderLabel(e))},r.renderLine=function(e,t){const[i,n,r,a]=this._getLinePosition(e);return h.tsx("line",{class:this.classes(b.dataLine,t),x1:i,x2:n,y1:r,y2:a,"shape-rendering":"crispEdges"})},r.renderLabel=function(e,t){const{label:i,value:n}=e,[r,a]=this._getLabelPosition(n),s=2;return h.tsx("text",{class:this.classes(b.label,t),"text-anchor":"end",transform:"horizontal"===this.layout?"rotate(270)":null,x:r,y:a-s},i??"")},r.renderFillDefinition=function(e){const{width:t,height:i}=this._containerDimensions;return h.tsx("clipPath",{id:e},h.tsx("rect",{x:"0",y:"0",width:t,height:i}))},r._afterContainerNodeCreate=function(e){this._containerNode=e,this.addHandles(u.onResize(e,(e=>{const{width:t,height:i}=e.contentRect;this._containerDimensions={width:t,height:i}})))},r._getIndexFromElement=function(e){const t=e.dataset?.index,i=e.getAttribute("data-index");return n.isSome(t)?parseInt(t,10):n.isSome(i)?parseInt(i,10):null},r._afterBarCreate=function(e){if(this.barCreatedFunction){const t=this._getIndexFromElement(e);this.barCreatedFunction(t,e)}},r._afterLinesSubgroupCreate=function(e){if(this.dataLineCreatedFunction){const t=this._getIndexFromElement(e),i=e.childNodes[0],n=e.childNodes[1]?e.childNodes[1]:null;this.dataLineCreatedFunction(i,n,t)}},r._afterLinesSubgroupUpdate=function(e){if(this.dataLineUpdatedFunction){const t=this._getIndexFromElement(e),i=e.childNodes[0],n=e.childNodes[1]?e.childNodes[1]:null;this.dataLineUpdatedFunction(i,n,t)}},r._getBarDimensions=function(e,t){const{bins:i,layout:n}=this,r=i?i.map((e=>e.count)):[],a=Math.max.apply(Math,r);return r.map((i=>"vertical"===n?[e/r.length,0!==a?i/a*t:0]:[0!==a?i/a*e:0,t/r.length]))},r._getLinePosition=function(e){const{layout:t,min:i,viewModel:{range:r}}=this;if(n.isNone(i))return[0,0,0,0];const a=Math.round((e-i)/r*100)/100,{width:s,height:o}=this._containerDimensions,[l,d]=[a*s||1,o-a*o||1];return"vertical"===t?[0,"100%",d,d]:[l,l,"100%",0]},r._getLabelPosition=function(e){const{layout:t,min:i,viewModel:{range:r}}=this;if(n.isNone(i))return[0,0];const a=Math.round((e-i)/r*100)/100,{width:s,height:o}=this._containerDimensions;return"vertical"===t?[s,o-a*o]:[0,a*s]},e._createClass(i,[{key:"average",get:function(){return this.viewModel.average},set:function(e){this.viewModel.average=e}},{key:"bins",get:function(){return this.viewModel.bins},set:function(e){this.viewModel.bins=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"labelFormatFunction",get:function(){return this.viewModel.labelFormatFunction},set:function(e){this.viewModel.labelFormatFunction=e}},{key:"layout",set:function(e){"vertical"!==e&&(e="horizontal"),this._set("layout",e)}},{key:"max",get:function(){return this.viewModel.max},set:function(e){this.viewModel.max=e}},{key:"min",get:function(){return this.viewModel.min},set:function(e){this.viewModel.min=e}},{key:"state",get:function(){return this.viewModel.state}}]),i}(l);t.__decorate([r.property()],f.prototype,"_bgFillId",void 0),t.__decorate([r.property()],f.prototype,"_containerNode",void 0),t.__decorate([r.property()],f.prototype,"_containerDimensions",void 0),t.__decorate([r.property()],f.prototype,"_defaultBarColor",void 0),t.__decorate([r.property()],f.prototype,"average",null),t.__decorate([r.property()],f.prototype,"barCreatedFunction",void 0),t.__decorate([r.property()],f.prototype,"dataLines",void 0),t.__decorate([r.property()],f.prototype,"dataLineCreatedFunction",void 0),t.__decorate([r.property()],f.prototype,"dataLineUpdatedFunction",void 0),t.__decorate([r.property()],f.prototype,"label",null),t.__decorate([r.property()],f.prototype,"labelFormatFunction",null),t.__decorate([r.property({value:"horizontal"})],f.prototype,"layout",null),t.__decorate([r.property()],f.prototype,"max",null),t.__decorate([r.property(),c.messageBundle("esri/widgets/Histogram/t9n/Histogram")],f.prototype,"messages",void 0),t.__decorate([r.property()],f.prototype,"min",null),t.__decorate([r.property({readOnly:!0})],f.prototype,"state",null),t.__decorate([r.property()],f.prototype,"viewModel",void 0),f=g=t.__decorate([o.subclass("esri.widgets.Histogram")],f);return f}));
