/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/HandleOwner","../core/Logger","../core/maybe","../core/reactiveUtils","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","../views/interactive/snapping/SnappingOptions","./Attachments","./FeatureForm","./FeatureTemplates","./Spinner","./Widget","./Editor/deprecationUtils","./Editor/EditorViewModel","./FeatureTemplates/ItemList","./support/Heading","./support/SnappingControls","./support/decorators/accessibleHandler","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/widgetUtils","../intl/substitute"],(function(e,t,a,n,s,i,r,o,l,c,d,p,u,h,m,g,_,v,f,w,k,y,b,C,M,A,F,x,T,W,P,S,B){"use strict";const E={base:"esri-editor esri-widget esri-widget--panel",scroller:"esri-editor__scroller",content:"esri-editor__content",contentGroup:"esri-editor__content-group",message:"esri-editor__message",controls:"esri-editor__controls",progressBar:"esri-editor__progress-bar",promptContainer:"esri-editor__prompt",promptHeader:"esri-editor__prompt__header",promptHeading:"esri-editor__prompt__header__heading",promptMessage:"esri-editor__prompt__message",promptDivider:"esri-editor__prompt__divider",promptActions:"esri-editor__prompt__actions",promptOption:"esri-editor__prompt__option",promptOptionPrimary:"esri-editor__prompt__option--primary",promptOptionNegative:"esri-editor__prompt__option--negative",promptOptionPositive:"esri-editor__prompt__option--positive",controlButton:"esri-editor__control-button",overlay:"esri-editor__overlay",warningIcon:"esri-icon-notice-triangle",widgetIcon:"esri-icon-edit",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonSecondary:"esri-button--secondary",buttonTertiary:"esri-button--tertiary",input:"esri-input",interactive:"esri-interactive",select:"esri-select",panelToolbar:"esri-editor__panel-toolbar",panelToolbarSnappingButton:"esri-editor__panel-toolbar__snapping-button",panelContent:"esri-editor__panel-content",panelContentSection:"esri-editor__panel-content--section",updateFeaturesActionButtons:"esri-editor__update-features-action-buttons",updateFeaturesActionButtonsButton:"esri-editor__update-features-action-buttons--button",featureTemplatesContainer:"esri-editor__feature-templates-container",snappingControlsPopover:"esri-editor__snapping-controls-popover",scrimOverlay:"esri-editor__scrim-overlay"},L={undoRedoButtons:!1};function U(e){e.focus()}const I="esri.widgets.Editor",V=i.getLogger(I);let H=function(a){function n(e,n){var s;return(s=a.call(this,e,n)||this)._candidateCommitted=!1,s._featureForm=new f,s._stateStack=[],s._attachments=new v({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),s._featureTemplates=new w({enableListScroll:!1}),s._filterText="",s._prompt=null,s._spinner=new k,s._snappingPopover=null,s.activeWorkflow=null,s.allowedWorkflows=null,s.useDeprecatedCreateWorkflow=!1,s.headingLevel=4,s.iconClass=E.widgetIcon,s.label=void 0,s.layerInfos=null,s.messages=null,s.messagesCommon=null,s.messagesTemplates=null,s.snappingOptions=new _,s.supportingWidgetDefaults=null,s.view=null,s.viewModel=new C,s.visibleElements={...L},s._setCandidateFeature=(e,t=!1)=>{if(s._candidateCommitted)return;const a=s._assertActiveUpdateWorkflow();a.data.edits.feature=e,t&&(a.next(),s._candidateCommitted=!0)},s._handleSave=s._handleSave.bind(t._assertThisInitialized(s)),s._handleBack=s._handleBack.bind(t._assertThisInitialized(s)),s._handleDone=s._handleDone.bind(t._assertThisInitialized(s)),s._handleDelete=s._handleDelete.bind(t._assertThisInitialized(s)),s._handleAdd=s._handleAdd.bind(t._assertThisInitialized(s)),s._handleEdit=s._handleEdit.bind(t._assertThisInitialized(s)),s._handleAttachmentAdd=s._handleAttachmentAdd.bind(t._assertThisInitialized(s)),s._handleAttachmentUpdate=s._handleAttachmentUpdate.bind(t._assertThisInitialized(s)),s._handleAttachmentDelete=s._handleAttachmentDelete.bind(t._assertThisInitialized(s)),s.EditorPanel=s.EditorPanel.bind(t._assertThisInitialized(s)),s}t._inheritsLoose(n,a);var s=n.prototype;return s.initialize=function(){const{view:e,snappingOptions:t}=this;this._snappingControls=new F({snappingOptions:t,view:e,visibleElements:{header:!1}}),this.own([l.init(this,"headingLevel",(e=>{this._featureForm.headingLevel=A.incrementHeadingLevel(e),this._featureTemplates.headingLevel=A.incrementHeadingLevel(e)})),this.viewModel.featureTemplatesViewModel.on("select",(({item:e})=>this.useDeprecatedCreateWorkflow?this.startCreateWorkflowAtFeatureCreation(e):this.startCreateFeaturesWorkflowAtFeatureCreation(e))),o.watch((()=>this.viewModel.state),((e,t)=>{const a=this._stateStack.indexOf(e);-1===a?this._stateStack.push(t):this._stateStack.splice(a)})),l.init(this,"viewModel",(e=>{this._featureForm.viewModel=e?e.featureFormViewModel:null,this._attachments.viewModel=e?e.attachmentsViewModel:null,this._featureTemplates.viewModel=e?e.featureTemplatesViewModel:null,this._spinner.viewModel=e?e.spinnerViewModel:null})),l.init(this,"view",((e,t)=>{const a=`editor-${this.id}-spinner`;t&&t.ui.remove(this._spinner,a),e&&e.ui.add(this._spinner,{key:a,position:"manual"})})),l.on(this,"viewModel.sketchViewModel","create",(()=>{this.scheduleRender()})),l.on(this,"viewModel.activeWorkflow","cancel-request",(({controller:e})=>{const{messages:t,messagesCommon:a}=this;this._prompt={title:t.cancelRequestTitle,message:t.cancelRequestWarningMessage,context:"danger",actions:{primary:{label:a.form.yes,action:()=>{e.allow(),this._prompt=null}},secondary:{label:a.form.no,action:()=>(e.deny(),this._prompt=null)}}},this.scheduleRender()})),l.init(this,"supportingWidgetDefaults",(e=>{e&&(this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),this.viewModel.sketchViewModel.set(e.sketch))})),l.watch(this,"_attachments.error",(e=>{if(!e)return;const{messages:t,messagesCommon:a}=this;this._prompt={title:t.errorWarningTitle,message:e.message,context:"warning",actions:{primary:{label:a.form.ok,action:()=>{this._prompt=null}}}}})),l.watch(this,"viewModel.failures",(e=>{if(!e)return;const{messages:t}=this,[{error:a,retry:n,cancel:s}]=e;this._prompt={title:t.errorWarningTitle,message:B.substitute(t.errorWarningMessageTemplate,{errorMessage:a.message}),context:"warning",actions:{primary:{label:t.retry,action:()=>{n(),this._prompt=null}},secondary:{label:t.ignore,action:()=>(s(),this._prompt=null)}}}})),l.watch(this,"viewModel.state",(e=>{"awaiting-feature-to-update"===e&&(this._filterText=""),"awaiting-update-feature-candidate"===e&&(this._candidateCommitted=!1)})),l.watch(this,["_attachments.selectedFile","_attachments.submitting"],(()=>this.scheduleRender())),l.whenNot(this,"viewModel.activeWorkflow",(()=>this._featureTemplates.filterText=""))])},s.destroy=function(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy(),this._snappingControls.destroy()},s.loadDependencies=function(){return Promise.all([new Promise(((t,a)=>e(["../chunks/calcite-action"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-action-menu"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-button"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-flow"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-icon"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-loader"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-panel"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-popover"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-popover-manager"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-scrim"],t,a))),new Promise(((t,a)=>e(["../chunks/calcite-tooltip-manager"],t,a)))])},s.castVisibleElements=function(e){return{...L,...e}},s.startCreateWorkflowAtFeatureTypeSelection=function(){return b.workflowDeprecation(V,"startCreateWorkflowAtFeatureTypeSelection","startCreateFeaturesWorkflowAtFeatureTypeSelection"),this.viewModel.startCreateWorkflowAtFeatureTypeSelection()},s.startCreateFeaturesWorkflowAtFeatureTypeSelection=function(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()},s.startCreateWorkflowAtFeatureCreation=function(e){return b.workflowDeprecation(V,"startCreateWorkflowAtFeatureCreation","startCreateFeaturesWorkflowAtFeatureCreation"),this.viewModel.startCreateWorkflowAtFeatureCreation(e)},s.startCreateFeaturesWorkflowAtFeatureCreation=function(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)},s.startCreateWorkflowAtFeatureEdit=function(e){return b.workflowDeprecation(V,"startCreateWorkflowAtFeatureEdit"),this.viewModel.startCreateWorkflowAtFeatureEdit(e)},s.startUpdateWorkflowAtFeatureSelection=function(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()},s.startUpdateWorkflowAtMultipleFeatureSelection=function(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)},s.startUpdateWorkflowAtFeatureEdit=function(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)},s.deleteFeatureFromWorkflow=function(){return this.viewModel.deleteFeatureFromWorkflow()},s.cancelWorkflow=function(e){return this.viewModel.cancelWorkflow(e)},s.render=function(){const{_attachments:e,_prompt:t,viewModel:a}=this;if(!a)return P.tsx("div",{class:E.base});const{state:n}=a,s=r.isSome(t)?P.tsx("calcite-scrim",null,this.renderPrompt(t)):null;return P.tsx("div",{class:E.base},a.syncing||e.submitting?this.renderProgressBar():null,P.tsx("calcite-flow",null,this._stateStack.map((e=>this.renderState(e))),this.renderState(n)),s)},s.renderState=function(e){switch(e){case"disabled":break;case"ready":return this.renderLanding(e);case"awaiting-feature-creation-info":return this.renderTemplates(e);case"creating-features":case"editing-new-feature":case"editing-existing-feature":return this.renderAttributeEditing(e);case"awaiting-feature-to-update":return this.renderFeatureUpdating(e);case"awaiting-update-feature-candidate":return this.renderFeatureList(e);case"awaiting-feature-to-create":return this.renderFeatureCreation(e);case"adding-attachment":return this.renderAttachmentAdding(e);case"editing-attachment":return this.renderAttachmentEditing(e)}return P.tsx("div",null)},s.isPanelActive=function(e){return this.viewModel.state===e},s.renderTemplates=function(e){const{EditorPanel:t,headingLevel:a,messages:n,messagesCommon:s,_handleBack:i,_snappingControls:r,viewModel:{sketchViewModel:o}}=this;return P.tsx(t,{active:this.isPanelActive(e),key:"templates-panel",handleBack:i,heading:n.selectTemplate,headingLevel:a,messages:n,messagesCommon:s,sketchViewModel:o,snappingControls:r},this._featureTemplates.render())},s.renderAttributeEditing=function(e){const{activeWorkflow:t,EditorPanel:a,messages:n,messagesCommon:s,headingLevel:i,_handleBack:r,_snappingControls:o,viewModel:l}=this,{sketchViewModel:c}=l,d=l.featureFormViewModel;if("create-features"===t.type&&t.pendingFeatures.length<1)return this.renderFeatureCreation(e);const p="update"===t.type&&!t.data.edits.modified||l.syncing,u="update"===t.type?n.editFeature:n.createFeatures,h="update"===t.type?s.update:s.create,m="create-features"===t.type&&"create-new"===t.createFeatureState,g=[{label:"create-features"===t.type&&t.numPendingFeatures>1?B.substitute(n.createFeaturesTemplate,{numFeatures:t.numPendingFeatures}):h,type:"primary",disabled:p,clickHandler:this._handleSave}];let _=!1;return"update"===t.type&&(t.data.editableItem.hasAttachments&&(_=!0),t.data.editableItem.supports.includes("delete")&&g.push({label:s.delete,type:"tertiary",clickHandler:this._handleDelete})),P.tsx(a,{active:this.isPanelActive(e),key:"attribute-editing-panel",heading:u,headingLevel:i,showContentScrim:m,handleBack:r,messages:n,messagesCommon:s,sketchViewModel:c,snappingControls:o},P.tsx("div",{class:E.panelContentSection},P.tsx("div",{class:E.contentGroup},d.inputFields.length>0?this._featureForm.render():this.renderMessage(B.substitute(n.clickToFinishTemplate,{button:h})),_?P.tsx("div",{key:"attachments"},P.tsx("div",null,n.attachments),this._attachments.render()):null)),P.tsx("div",{class:this._prompt?"":E.scrimOverlay},this.renderControls(g)))},s.renderAttachmentAdding=function(e){const{_attachments:t,EditorPanel:a,_handleBack:n,headingLevel:s,messages:i,messagesCommon:r,_snappingControls:o,viewModel:{sketchViewModel:l}}=this,c=[{label:t.submitting?r.cancel:r.add,disabled:t.submitting||!t.selectedFile,type:"primary",clickHandler:this._handleAttachmentAdd}];return P.tsx(a,{active:this.isPanelActive(e),key:"attachment-adding-panel",heading:i.addAttachment,headingLevel:s,handleBack:n,messages:i,messagesCommon:r,sketchViewModel:l,snappingControls:o},P.tsx("div",{class:this.classes(E.content,E.scroller)},t.render()),this.renderControls(c))},s.renderAttachmentEditing=function(e){const{_attachments:t,EditorPanel:a,_handleBack:n,headingLevel:s,messages:i,messagesCommon:r,_snappingControls:o,viewModel:{sketchViewModel:l}}=this,c=[{label:r.update,disabled:t.submitting||!t.selectedFile,type:"primary",clickHandler:this._handleAttachmentUpdate},{label:r.delete,disabled:t.submitting,type:"tertiary",clickHandler:this._handleAttachmentDelete}];return P.tsx(a,{active:this.isPanelActive(e),key:"attachment-editing-panel",heading:i.editAttachment,headingLevel:s,handleBack:n,messages:i,messagesCommon:r,sketchViewModel:l,snappingControls:o},P.tsx("div",{class:this.classes(E.content,E.scroller)},t.render()),this.renderControls(c))},s.renderFeatureUpdating=function(e){const{EditorPanel:t,_handleBack:a,headingLevel:n,messages:s,messagesCommon:i,_snappingControls:r,viewModel:{sketchViewModel:o}}=this;return P.tsx(t,{active:this.isPanelActive(e),key:"feature-updating-panel",heading:s.selectFeature,headingLevel:n,handleBack:a,messages:s,messagesCommon:i,sketchViewModel:o,snappingControls:r},P.tsx("div",{class:this.classes(E.content,E.scroller)},this.renderMessage(s.selectFeatureToEdit)))},s.renderMessage=function(e){return P.tsx("div",{class:E.message},e)},s.renderFeatureCreation=function(e){const{EditorPanel:t,_handleBack:a,headingLevel:n,messages:s,messagesCommon:i,_snappingControls:r,viewModel:o}=this,{sketchViewModel:l}=o,c=o.sketchViewModel,d=this._assertActiveCreateWorkflow().data.creationInfo.layer,p=c.canUndo()&&c.createGraphic?c.createGraphic:null,u=this._getSketchingTip(d.geometryType,p);return P.tsx(t,{active:this.isPanelActive(e),key:"feature-creation-panel",heading:s.placeFeature,headingLevel:n,handleBack:a,messages:s,messagesCommon:i,sketchViewModel:l,snappingControls:r},P.tsx("div",{class:this.classes(E.content,E.scroller)},this.renderMessage(u)))},s.renderControls=function(e){return P.tsx("div",{class:E.controls,key:"controls"},e.map((({disabled:e=!1,label:t,type:a,clickHandler:n},s)=>this.renderButton({label:t,class:this.classes(E.controlButton,E.button,"secondary"===a?E.buttonSecondary:"tertiary"===a?E.buttonTertiary:null,e?E.buttonDisabled:null),disabled:e,clickHandler:n,key:s}))))},s.renderPrompt=function({title:e,message:t,context:a,actions:n}){const s=!!n.secondary,i=P.tsx("calcite-button",{appearance:"solid",color:"danger"===a?"red":"blue",width:s?"half":"full",onclick:n.primary.action,key:"prompt-primary-button",afterCreate:U},n.primary.label),r=s?P.tsx("calcite-button",{appearance:"clear",color:"danger"===a?"red":"blue",width:"half",onclick:n.secondary.action,key:"prompt-secondary-button"},n.secondary.label):null;return P.tsx("div",{class:`${E.promptContainer}--${a}`},P.tsx("div",{class:E.promptHeader},P.tsx("calcite-icon",{icon:"exclamation-mark-triangle"}),P.tsx(A.Heading,{class:E.promptHeading,level:this.headingLevel},e)),P.tsx("div",{class:E.promptMessage},t),P.tsx("div",{class:E.promptDivider}),P.tsx("div",{class:E.promptActions},r,i))},s.renderProgressBar=function(){return P.tsx("div",{class:this.classes(E.progressBar),key:"progress-bar"})},s.renderButton=function(e){return P.tsx("button",{class:e.class,disabled:e.disabled,key:e.key,onclick:e.clickHandler,type:"button"},e.label)},s.renderLanding=function(e){const{EditorPanel:t,headingLevel:a,messages:n,messagesCommon:s,_snappingControls:i,viewModel:{sketchViewModel:r}}=this;return P.tsx(t,{active:this.isPanelActive(e),key:"landing-panel",heading:n.widgetLabel,headingLevel:a,showBackButton:!1,messages:n,messagesCommon:s,sketchViewModel:r,snappingControls:i},P.tsx("div",{key:"edit-actions",class:E.panelContentSection},this.renderUpdateActions()),P.tsx("div",{key:"create-actions",class:E.panelContentSection},this.renderCreateActions()))},s.renderUpdateActions=function(){const{messages:e,messagesCommon:t}=this;return P.tsx("div",null,P.tsx(A.Heading,{level:A.incrementHeadingLevel(this.headingLevel)},e.editFeatures),P.tsx("div",{class:E.updateFeaturesActionButtons},P.tsx("calcite-action",{text:t.select,textEnabled:!0,icon:"cursor",alignment:"start",class:E.updateFeaturesActionButtonsButton,onclick:this._handleEdit})))},s.renderCreateActions=function(){const{messages:e}=this;return P.tsx("div",null,P.tsx(A.Heading,{level:A.incrementHeadingLevel(this.headingLevel)},e.createFeatures),P.tsx("div",{key:"templates",class:E.featureTemplatesContainer},this._featureTemplates.render()))},s.renderFeatureList=function(e){const{EditorPanel:t,_handleBack:a,headingLevel:n,messages:s,messagesCommon:i,messagesTemplates:r,_snappingControls:o,viewModel:{editableItems:l,sketchViewModel:c}}=this,d=this._assertActiveUpdateWorkflow().data.candidates,p=B.substitute(s.multipleFeaturesTemplate,{total:d.length}),u=new Map;let h=0;d.map((e=>({label:this._getLabel(e),id:e.attributes[e.layer.objectIdField],data:e}))).filter((e=>{const{label:t,data:a}=e,n=this._filterText.toLowerCase(),{title:s}=a.layer,i=this.viewModel.editableItems.find((e=>e.layer===a.layer));return i.supports.indexOf("update")>-1&&(!n||t.toLowerCase().indexOf(n)>-1||s.toLowerCase().indexOf(n)>-1)})).forEach((e=>{h++;const t=e.data.layer;u.has(t)?u.get(t).items.push(e):u.set(t,{id:`${t.id}`,label:t.title,items:[e]})}));const m=l.filter((({layer:e})=>u.has(e))).map((({layer:e})=>u.get(e))).toArray(),g=h>10||this._filterText.length>0;return P.tsx(t,{active:this.isPanelActive(e),key:"feature-list",heading:p,headingLevel:n,handleBack:a,messages:s,messagesCommon:i,sketchViewModel:c,snappingControls:o},M.ItemList({id:this.id,enableListScroll:!1,filterEnabled:g,filterText:this._filterText,items:m,messages:{filterPlaceholder:r.filterPlaceholder,noItems:r.noItems,noMatches:r.noMatches},onItemMouseEnter:({data:e})=>this._setCandidateFeature(e),onItemMouseLeave:()=>this._setCandidateFeature(null),onItemSelect:({data:e})=>this._setCandidateFeature(e,!0),onFilterChange:e=>this._filterText=e}))},s.EditorPanel=function(e,...t){const{active:a,handleBack:n,heading:s,headingLevel:i,key:r,messages:o,messagesCommon:l,showBackButton:c,showContentScrim:d,sketchViewModel:p,snappingControls:u}=e;return P.tsx("calcite-panel",{bind:this,key:r,heading:s,headingLevel:i,showBackButton:null==c||c,beforeBack:null!=n?n:null,onCalcitePanelScroll:this._onSnappingPopoverPanelScroll},P.tsx("calcite-popover-manager",{autoClose:a,class:E.panelToolbar},P.tsx("calcite-popover",{afterCreate:this._afterSnappingPopoverCreated,afterUpdate:this._afterSnappingPopoverUpdated,bind:this,label:o.snappingSettings,heading:o.snappingSettings,"reference-element":`${r}__snappingButton`,"overlay-positioning":"fixed",placement:"bottom"},P.tsx("div",{class:E.snappingControlsPopover},u.render())),P.tsx("calcite-button",{id:`${r}__snappingButton`,text:o.snapping,appearance:"transparent",color:"neutral",alignment:"icon-end-space-between","icon-start":"vertex-gps","icon-end":"caret-down",width:"full",class:E.panelToolbarSnappingButton},o.snapping),this.visibleElements.undoRedoButtons?[P.tsx("calcite-button",{key:"undo-button",text:l.undo,appearance:"transparent",color:"neutral",alignment:"center","icon-start":"undo",scale:"l",disabled:!p.canUndo(),onclick:p.undo.bind(p)}),P.tsx("calcite-button",{key:"redo-button",text:l.redo,appearance:"transparent",color:"neutral",alignment:"center","icon-start":"redo",scale:"l",disabled:!p.canRedo(),onclick:p.redo.bind(p)})]:null),P.tsx("div",{class:S.classes(E.panelContent,E.scroller)},t,d?P.tsx("calcite-scrim",null):null))},s._onSnappingPopoverPanelScroll=function(){var e;null!=(e=this._snappingPopover)&&e.open&&this._snappingPopover.toggle()},s._afterSnappingPopoverCreated=function(e){this._snappingPopover=e},s._afterSnappingPopoverUpdated=function(e){this._snappingPopover=e},s._getSketchingTip=function(e,t){const{messages:a}=this;if("point"===e)return a.tips.clickToAddPoint;if("polygon"===e||"polyline"===e){if(!t)return a.tips.clickToStart;const n=t.geometry,s="polygon"===e?"rings":"paths",[i]=n[s];return"polygon"===e&&i<4?a.tips.clickToContinue:a.tips.clickToContinueThenDoubleClickToEnd}return a.tips.clickToAddFeature},s._getLabel=function(e){const t=e.layer;if(!t)return null;const{objectIdField:a}=t,{attributes:n}=e,s=g.getDisplayFieldName(t);return s&&n[s]&&`${n[s]}`||B.substitute(this.messages.untitledFeatureTemplate,{id:n[a]})},s._handleDelete=function(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteWarningTitle,message:e.deleteWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:()=>{this.viewModel.deleteFeatureFromWorkflow(),this._prompt=null}},secondary:{label:e.keepFeature,action:()=>this._prompt=null}}}},s._handleSave=function(){const{featureFormViewModel:e}=this.viewModel;e.submit(),!e.submittable||e.validateContingencyConstraints(e.getValues(),{includeIncompleteViolations:!0}).length>0||this.viewModel.activeWorkflow.commit()},s._handleAttachmentAdd=function(){const{_attachments:e}=this,{activeWorkflow:t}=this.viewModel;e.addAttachment().then((()=>t.previous()))},s._handleAttachmentUpdate=function(){const{_attachments:e}=this,{activeWorkflow:t}=this.viewModel;e.updateAttachment().then((()=>t.previous()))},s._handleAttachmentDelete=function(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteAttachmentWarningTitle,message:e.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:()=>{const{_attachments:e}=this,{activeWorkflow:t}=this.viewModel;e.deleteAttachment(e.viewModel.activeAttachmentInfo).then((()=>{t.previous(),this._prompt=null}))}},secondary:{label:e.keepAttachment,action:()=>this._prompt=null}}}},s._handleAdd=function(){this.viewModel.canCreate},s._handleEdit=function(){this.viewModel.canUpdate&&this.viewModel.startUpdateWorkflowAtFeatureSelection()},s._handleDone=function(){this.viewModel.cancelWorkflow({force:!0})},s._handleBack=function(){var e=t._asyncToGenerator((function*(){const{messages:e}=this,t=this.activeWorkflow,a=()=>{t.hasPreviousStep?t.previous({cancelCurrentStep:!0}):this.viewModel.cancelWorkflow({force:!0})};if("create"===t.type||"create-features"===t.type&&t.numPendingFeatures>0||"update"===t.type&&t.data.edits.modified){const{type:n}=t,s="create"===n?e.cancelAddWarningMessage:e.cancelEditWarningMessage,i="create"===n?e.cancelAddTitle:e.cancelEditTitle,r="create"===n?e.continueAdding:e.continueEditing,o="create"===n?e.discardFeature:e.discardEdits;return this._prompt={title:i,message:s,context:"danger",actions:{primary:{label:o,action:()=>{a(),this._prompt=null}},secondary:{label:r,action:()=>this._prompt=null}}},this.scheduleRender(),Promise.reject()}a()}));function a(){return e.apply(this,arguments)}return a}(),s._assertActiveCreateWorkflow=function(){const{type:e}=this.viewModel.activeWorkflow;if("create"===e||"create-features"===e)return this.viewModel.activeWorkflow;throw Error("Expected activeWorkflow to be instance of CreateWorkflow or CreateFeaturesWorkflow")},s._assertActiveUpdateWorkflow=function(){if("update"===this.viewModel.activeWorkflow.type)return this.viewModel.activeWorkflow;throw Error("Expected activeWorkflow to be an UpdateWorkflow")},n}(s.HandleOwnerMixin(y));a.__decorate([h.property()],H.prototype,"_attachments",void 0),a.__decorate([c.aliasOf("viewModel.activeWorkflow")],H.prototype,"activeWorkflow",void 0),a.__decorate([c.aliasOf("viewModel.allowedWorkflows")],H.prototype,"allowedWorkflows",void 0),a.__decorate([h.property()],H.prototype,"useDeprecatedCreateWorkflow",void 0),a.__decorate([h.property()],H.prototype,"headingLevel",void 0),a.__decorate([h.property()],H.prototype,"iconClass",void 0),a.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],H.prototype,"label",void 0),a.__decorate([c.aliasOf("viewModel.layerInfos")],H.prototype,"layerInfos",void 0),a.__decorate([h.property(),T.messageBundle("esri/widgets/Editor/t9n/Editor")],H.prototype,"messages",void 0),a.__decorate([h.property(),T.messageBundle("esri/t9n/common")],H.prototype,"messagesCommon",void 0),a.__decorate([h.property(),T.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],H.prototype,"messagesTemplates",void 0),a.__decorate([c.aliasOf("viewModel.snappingOptions")],H.prototype,"snappingOptions",void 0),a.__decorate([h.property()],H.prototype,"supportingWidgetDefaults",void 0),a.__decorate([c.aliasOf("viewModel.view")],H.prototype,"view",void 0),a.__decorate([h.property(),W.vmEvent(["workflow-cancel","workflow-commit"])],H.prototype,"viewModel",void 0),a.__decorate([h.property()],H.prototype,"visibleElements",void 0),a.__decorate([u.cast("visibleElements")],H.prototype,"castVisibleElements",null),a.__decorate([x.accessibleHandler()],H.prototype,"_handleDelete",null),a.__decorate([x.accessibleHandler()],H.prototype,"_handleAttachmentAdd",null),a.__decorate([x.accessibleHandler()],H.prototype,"_handleAttachmentUpdate",null),a.__decorate([x.accessibleHandler()],H.prototype,"_handleAttachmentDelete",null),a.__decorate([x.accessibleHandler()],H.prototype,"_handleAdd",null),a.__decorate([x.accessibleHandler()],H.prototype,"_handleEdit",null),a.__decorate([x.accessibleHandler()],H.prototype,"_handleDone",null),H=a.__decorate([m.subclass(I)],H);return H}));
