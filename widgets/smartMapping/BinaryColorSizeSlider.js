/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/aliasOf","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../Color","../../renderers/visualVariables/support/SizeStop","../../symbols/support/cimSymbolUtils","../support/widgetUtils","../support/decorators/messageBundle","../../chunks/index","./support/utils","./SmartMappingSliderBase","./BinaryColorSizeSlider/BinaryColorSizeSliderViewModel"],(function(e,r,o,i,s,t,a,l,n,d,p,c,u,m,y,b,g,v,h,f,_){"use strict";var S;const z={base:"esri-binary-color-size-slider",rampElement:"esri-binary-color-size-slider__ramp",sliderContainer:"esri-binary-color-size-slider__slider-container",histogramContainer:"esri-binary-color-size-slider__histogram-container",zoomCapTop:"esri-binary-color-size-slider__zoom-cap-top",zoomCapBottom:"esri-binary-color-size-slider__zoom-cap-bottom",zoomCapLine:"esri-binary-color-size-slider__zoom-cap-line",zoomCapMask:"esri-binary-color-size-slider__zoom-cap-mask",zoomCapUnderline:"esri-binary-color-size-slider__zoom-cap-underline",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},w={trackBackgroundColor:new u([224,224,224]),trackAboveFillColor:new u([149,149,149]),trackBelowFillColor:new u([149,149,149])};let C=S=function(r){function o(e,o){var i;return(i=r.call(this,e,o)||this)._minRampFillWidth=.2,i._rampNode=null,i._rampFillId=null,i.handlesSyncedToPrimary=null,i.label=void 0,i.messages=null,i.persistSizeRangeEnabled=null,i.stops=null,i.style={...w},i.viewModel=new _,i.zoomOptions=null,i._rampFillId=`${i.id}-linear-gradient`,i}e._inheritsLoose(o,r);var s=o.prototype;return s.castStyle=function(e){return{...w,...e}},o.fromRendererResult=function(e,r){const{size:{visualVariables:o},statistics:i}=e,{avg:s,stddev:t}=i,a=o[0].stops,l=e.renderer.authoringInfo.visualVariables[0],n=l.minSliderValue,d=l.maxSliderValue,p=e.renderer.classBreakInfos;let c,u,m=null;const b=e=>{if("cim"===e.type)return y.getCIMSymbolColor(e);if(e.symbolLayers){var r,o;return null==(o=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:o.color}return e.color};if(p.length>1){const e=p[0].symbol,r=p[1].symbol;u=b(e),c=b(r)}return 1===p.length&&(m=b(p[0].symbol)),new S({max:d,min:n,stops:a,histogramConfig:{average:s,standardDeviation:t,bins:r?r.bins:[]},style:{trackAboveFillColor:c,trackBelowFillColor:u,trackFillColor:m},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})},s.updateFromRendererResult=function(e,r){const{size:{visualVariables:o},statistics:i}=e,{avg:s,stddev:t}=i,a=o[0].stops,l=e.renderer.authoringInfo.visualVariables[0],n=l.minSliderValue,d=l.maxSliderValue,p=e.renderer.classBreakInfos;let c,u,m=null;const b=e=>{if("cim"===e.type)return y.getCIMSymbolColor(e);if(e.symbolLayers){var r,o;return null==(o=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:o.color}return e.color};if(p.length>1){const e=p[0].symbol,r=p[1].symbol;u=b(e),c=b(r)}1===p.length&&(m=b(p[0].symbol)),this.set({max:d,min:n,stops:a,histogramConfig:{average:s,standardDeviation:t,bins:r?r.bins:[]},style:{trackAboveFillColor:c,trackBelowFillColor:u,trackFillColor:m},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})},s.updateRenderer=function(e){var r,o;if("univariate-color-size"!==(null==(r=e.authoringInfo)?void 0:r.type)||"above-and-below"!==(null==(o=e.authoringInfo)?void 0:o.univariateTheme))return console.error("Input renderer must be a univariate renderer with an above-and-below theme."),null;const i=e.clone(),s=i.visualVariables.find((e=>"size"===e.type&&"outline"!==e.target&&e.stops)),{stops:t}=this;if(!s||!t)return console.error("No size stops available."),null;const a=i.visualVariables.indexOf(s);i.visualVariables.splice(a,1),s.stops=t,i.visualVariables.push(s);const l=t[5===t.length?2:1].value;return i.classBreakInfos[0].maxValue=l,i.classBreakInfos[1].minValue=l,i},s.updateFromVisualVariable=function(e){if(!e)return;const{maxDataValue:r,minDataValue:o,stops:i}=e;if(i)this.stops=i;else{const[i,s]=h.getSizesFromVariable(e);this.stops=[new m({value:o,size:s}),new m({value:r,size:i})]}},s.render=function(){const{state:e,label:r}=this,o="disabled"===e,i=this.classes(z.base,z.esriWidget,z.esriWidgetPanel,{[z.disabled]:o});return v.jsx("div",{"aria-label":r,class:i},o?null:this.renderContent(this.renderRamp(),z.sliderContainer,z.histogramContainer))},s.renderRamp=function(){const{style:{trackBackgroundColor:e},zoomOptions:r}=this;return v.jsx("div",{afterCreate:b.storeNode,bind:this,class:z.rampElement,"data-node-ref":"_rampNode"},v.jsx("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},v.jsx("rect",{x:"0",y:"0",fill:h.getFillFromColor(e),height:"100%",width:"100%"}),this.renderPrimaryRamp(),this.renderPath()),r?this.renderZoomCaps():null)},s.renderPrimaryRamp=function(){const{_rampFillId:e,style:{trackAboveFillColor:r,trackBelowFillColor:o},viewModel:i}=this;return[v.jsx("defs",null,this.renderRampFillDefinition(e,i.getGradientStopInfo(r,o)))]},s.renderPath=function(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(!i.isSome(e)||!i.isSome(r))return;const{stops:o,viewModel:{max:s,min:t},_rampFillId:a,_minRampFillWidth:l}=this,n=h.getDynamicPathForSizeStops({max:s,min:t,pathHeight:e,pathWidth:r,stops:o,padding:l});return v.jsx("path",{d:n,fill:`url(#${a})`})},o}(f.SmartMappingSliderBase);return r.__decorate([a.aliasOf("viewModel.handlesSyncedToPrimary")],C.prototype,"handlesSyncedToPrimary",void 0),r.__decorate([t.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],C.prototype,"label",void 0),r.__decorate([t.property(),g.messageBundle("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],C.prototype,"messages",void 0),r.__decorate([a.aliasOf("viewModel.persistSizeRangeEnabled")],C.prototype,"persistSizeRangeEnabled",void 0),r.__decorate([a.aliasOf("viewModel.stops")],C.prototype,"stops",void 0),r.__decorate([t.property()],C.prototype,"style",void 0),r.__decorate([l.cast("style")],C.prototype,"castStyle",null),r.__decorate([t.property()],C.prototype,"viewModel",void 0),r.__decorate([a.aliasOf("viewModel.zoomOptions")],C.prototype,"zoomOptions",void 0),C=S=r.__decorate([n.subclass("esri.widgets.smartMapping.BinaryColorSizeSlider")],C),C}));
