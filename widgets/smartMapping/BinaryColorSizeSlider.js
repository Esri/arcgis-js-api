/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Color","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","../../renderers/visualVariables/support/SizeStop","../../symbols/support/cimSymbolUtils","./SmartMappingSliderBase","./BinaryColorSizeSlider/BinaryColorSizeSliderViewModel","./support/utils","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory"],(function(e,r,t,i,s,o,a,l,n,d,c,p,u,m,y,b){"use strict";var h;const g={base:"esri-binary-color-size-slider",rampElement:"esri-binary-color-size-slider__ramp",sliderContainer:"esri-binary-color-size-slider__slider-container",histogramContainer:"esri-binary-color-size-slider__histogram-container",zoomCapTop:"esri-binary-color-size-slider__zoom-cap-top",zoomCapBottom:"esri-binary-color-size-slider__zoom-cap-bottom",zoomCapLine:"esri-binary-color-size-slider__zoom-cap-line",zoomCapMask:"esri-binary-color-size-slider__zoom-cap-mask",zoomCapUnderline:"esri-binary-color-size-slider__zoom-cap-underline",primaryHandle:"esri-binary-color-size-slider--primary-handle",track:"esri-binary-color-size-slider--interactive-track",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},f={trackBackgroundColor:new t([224,224,224]),trackAboveFillColor:new t([149,149,149]),trackBelowFillColor:new t([149,149,149])};let v=h=function(r){function t(e,t){var i;return(i=r.call(this,e,t)||this)._minRampFillWidth=.2,i._rampNode=null,i._rampFillId=null,i.messages=null,i.style={...f},i.viewModel=new p,i._rampFillId=`${i.id}-linear-gradient`,i}e._inheritsLoose(t,r);var s=t.prototype;return s.castStyle=function(e){return{...f,...e}},t.fromRendererResult=function(e,r){const{size:{visualVariables:t},statistics:i}=e,{avg:s,stddev:o}=i,a=t[0].stops,l=e.renderer.authoringInfo.visualVariables[0],n=l.minSliderValue,c=l.maxSliderValue,p=e.renderer.classBreakInfos;let u,m,y=null;const b=e=>{if("cim"===e.type)return d.getCIMSymbolColor(e);if(e.symbolLayers){const r=e.symbolLayers?.getItemAt(0);return r.material?.color}return e.color};if(p.length>1){const e=p[0].symbol,r=p[1].symbol;m=b(e),u=b(r)}return 1===p.length&&(y=b(p[0].symbol)),new h({max:c,min:n,stops:a,histogramConfig:{average:s,standardDeviation:o,bins:r?r.bins:[]},style:{trackAboveFillColor:u,trackBelowFillColor:m,trackFillColor:y},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})},s.updateFromRendererResult=function(e,r){const{size:{visualVariables:t},statistics:i}=e,{avg:s,stddev:o}=i,a=t[0].stops,l=e.renderer.authoringInfo.visualVariables[0],n=l.minSliderValue,c=l.maxSliderValue,p=e.renderer.classBreakInfos;let u,m,y=null;const b=e=>{if("cim"===e.type)return d.getCIMSymbolColor(e);if(e.symbolLayers){const r=e.symbolLayers?.getItemAt(0);return r.material?.color}return e.color};if(p.length>1){const e=p[0].symbol,r=p[1].symbol;m=b(e),u=b(r)}1===p.length&&(y=b(p[0].symbol)),this.set({max:c,min:n,stops:a,histogramConfig:{average:s,standardDeviation:o,bins:r?r.bins:[]},style:{trackAboveFillColor:u,trackBelowFillColor:m,trackFillColor:y},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})},s.updateRenderer=function(e){if("univariate-color-size"!==e.authoringInfo?.type||"above-and-below"!==e.authoringInfo?.univariateTheme)return console.error("Input renderer must be a univariate renderer with an above-and-below theme."),null;const r=e.clone(),t=r.visualVariables.find((e=>"size"===e.type&&"outline"!==e.target&&e.stops)),{stops:i}=this;if(!t||!i)return console.error("No size stops available."),null;const s=r.visualVariables.indexOf(t);r.visualVariables.splice(s,1),t.stops=i,r.visualVariables.push(t);const o=i[5===i.length?2:1].value;return r.classBreakInfos[0].maxValue=o,r.classBreakInfos[1].minValue=o,r},s.updateFromVisualVariable=function(e){if(!e)return;const{maxDataValue:r,minDataValue:t,stops:i}=e;if(i)this.stops=i;else{const[i,s]=u.getSizesFromVariable(e);this.stops=[new n({value:t,size:s}),new n({value:r,size:i})]}},s.render=function(){const{label:e,state:r,viewModel:{primaryHandleEnabled:t},visibleElements:i}=this,s="disabled"===r,o=this.classes(g.base,g.esriWidget,g.esriWidgetPanel,{[g.disabled]:s,[g.primaryHandle]:t,[g.track]:i.interactiveTrack});return b.tsx("div",{"aria-label":e,class:o},s?null:this.renderContent(this.renderRamp(),g.sliderContainer,g.histogramContainer))},s.renderRamp=function(){const{style:{trackBackgroundColor:e},zoomOptions:r}=this;return b.tsx("div",{afterCreate:m.storeNode,bind:this,class:g.rampElement,"data-node-ref":"_rampNode"},b.tsx("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},b.tsx("rect",{x:"0",y:"0",fill:u.getFillFromColor(e),height:"100%",width:"100%"}),this.renderPrimaryRamp(),this.renderPath()),r?this.renderZoomCaps():null)},s.renderPrimaryRamp=function(){const{_rampFillId:e,style:{trackAboveFillColor:r,trackBelowFillColor:t},viewModel:i}=this;return[b.tsx("defs",null,this.renderRampFillDefinition(e,i.getGradientStopInfo(r,t)))]},s.renderPath=function(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(i.isNone(e)||i.isNone(r))return;const{stops:t,viewModel:{max:s,min:o},_rampFillId:a,_minRampFillWidth:l}=this,n=u.getDynamicPathForSizeStops({max:s,min:o,pathHeight:e,pathWidth:r,stops:t,padding:l});return b.tsx("path",{d:n,fill:`url(#${a})`})},e._createClass(t,[{key:"handlesSyncedToPrimary",get:function(){return this.viewModel.handlesSyncedToPrimary},set:function(e){this.viewModel.handlesSyncedToPrimary=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"persistSizeRangeEnabled",get:function(){return this.viewModel.persistSizeRangeEnabled},set:function(e){this.viewModel.persistSizeRangeEnabled=e}},{key:"stops",get:function(){return this.viewModel.stops},set:function(e){this.viewModel.stops=e}}]),t}(c.SmartMappingSliderBase);r.__decorate([s.property()],v.prototype,"handlesSyncedToPrimary",null),r.__decorate([s.property()],v.prototype,"label",null),r.__decorate([s.property(),y.messageBundle("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],v.prototype,"messages",void 0),r.__decorate([s.property()],v.prototype,"persistSizeRangeEnabled",null),r.__decorate([s.property()],v.prototype,"stops",null),r.__decorate([s.property()],v.prototype,"style",void 0),r.__decorate([a.cast("style")],v.prototype,"castStyle",null),r.__decorate([s.property()],v.prototype,"viewModel",void 0),v=h=r.__decorate([l.subclass("esri.widgets.smartMapping.BinaryColorSizeSlider")],v);return v}));
