/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Color","../../core/maybe","../../core/accessorSupport/decorators/aliasOf","../../core/arrayUtils","../../core/has","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../renderers/visualVariables/support/SizeStop","../../symbols/support/cimSymbolUtils","./SmartMappingSliderBase","./BinaryColorSizeSlider/BinaryColorSizeSliderViewModel","./support/utils","../support/widgetUtils","../support/decorators/messageBundle","../../core/Logger","../support/jsxFactory"],(function(e,r,o,i,s,t,a,l,n,d,c,p,m,u,y,b,v,g,h){"use strict";var f;const _={base:"esri-binary-color-size-slider",rampElement:"esri-binary-color-size-slider__ramp",sliderContainer:"esri-binary-color-size-slider__slider-container",histogramContainer:"esri-binary-color-size-slider__histogram-container",zoomCapTop:"esri-binary-color-size-slider__zoom-cap-top",zoomCapBottom:"esri-binary-color-size-slider__zoom-cap-bottom",zoomCapLine:"esri-binary-color-size-slider__zoom-cap-line",zoomCapMask:"esri-binary-color-size-slider__zoom-cap-mask",zoomCapUnderline:"esri-binary-color-size-slider__zoom-cap-underline",primaryHandle:"esri-binary-color-size-slider--primary-handle",track:"esri-binary-color-size-slider--interactive-track",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},z={trackBackgroundColor:new o([224,224,224]),trackAboveFillColor:new o([149,149,149]),trackBelowFillColor:new o([149,149,149])};let S=f=function(r){function o(e,o){var i;return(i=r.call(this,e,o)||this)._minRampFillWidth=.2,i._rampNode=null,i._rampFillId=null,i.handlesSyncedToPrimary=null,i.label=void 0,i.messages=null,i.persistSizeRangeEnabled=null,i.stops=null,i.style={...z},i.viewModel=new u,i.zoomOptions=null,i._rampFillId=`${i.id}-linear-gradient`,i}e._inheritsLoose(o,r);var s=o.prototype;return s.castStyle=function(e){return{...z,...e}},o.fromRendererResult=function(e,r){const{size:{visualVariables:o},statistics:i}=e,{avg:s,stddev:t}=i,a=o[0].stops,l=e.renderer.authoringInfo.visualVariables[0],n=l.minSliderValue,d=l.maxSliderValue,c=e.renderer.classBreakInfos;let m,u,y=null;const b=e=>{if("cim"===e.type)return p.getCIMSymbolColor(e);if(e.symbolLayers){var r,o;return null==(o=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:o.color}return e.color};if(c.length>1){const e=c[0].symbol,r=c[1].symbol;u=b(e),m=b(r)}return 1===c.length&&(y=b(c[0].symbol)),new f({max:d,min:n,stops:a,histogramConfig:{average:s,standardDeviation:t,bins:r?r.bins:[]},style:{trackAboveFillColor:m,trackBelowFillColor:u,trackFillColor:y},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})},s.updateFromRendererResult=function(e,r){const{size:{visualVariables:o},statistics:i}=e,{avg:s,stddev:t}=i,a=o[0].stops,l=e.renderer.authoringInfo.visualVariables[0],n=l.minSliderValue,d=l.maxSliderValue,c=e.renderer.classBreakInfos;let m,u,y=null;const b=e=>{if("cim"===e.type)return p.getCIMSymbolColor(e);if(e.symbolLayers){var r,o;return null==(o=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:o.color}return e.color};if(c.length>1){const e=c[0].symbol,r=c[1].symbol;u=b(e),m=b(r)}1===c.length&&(y=b(c[0].symbol)),this.set({max:d,min:n,stops:a,histogramConfig:{average:s,standardDeviation:t,bins:r?r.bins:[]},style:{trackAboveFillColor:m,trackBelowFillColor:u,trackFillColor:y},handlesSyncedToPrimary:!0,persistSizeRangeEnabled:!0})},s.updateRenderer=function(e){var r,o;if("univariate-color-size"!==(null==(r=e.authoringInfo)?void 0:r.type)||"above-and-below"!==(null==(o=e.authoringInfo)?void 0:o.univariateTheme))return console.error("Input renderer must be a univariate renderer with an above-and-below theme."),null;const i=e.clone(),s=i.visualVariables.find((e=>"size"===e.type&&"outline"!==e.target&&e.stops)),{stops:t}=this;if(!s||!t)return console.error("No size stops available."),null;const a=i.visualVariables.indexOf(s);i.visualVariables.splice(a,1),s.stops=t,i.visualVariables.push(s);const l=t[5===t.length?2:1].value;return i.classBreakInfos[0].maxValue=l,i.classBreakInfos[1].minValue=l,i},s.updateFromVisualVariable=function(e){if(!e)return;const{maxDataValue:r,minDataValue:o,stops:i}=e;if(i)this.stops=i;else{const[i,s]=y.getSizesFromVariable(e);this.stops=[new c({value:o,size:s}),new c({value:r,size:i})]}},s.render=function(){const{label:e,state:r,viewModel:{primaryHandleEnabled:o},visibleElements:i}=this,s="disabled"===r,t=this.classes(_.base,_.esriWidget,_.esriWidgetPanel,{[_.disabled]:s,[_.primaryHandle]:o,[_.track]:i.interactiveTrack});return h.tsx("div",{"aria-label":e,class:t},s?null:this.renderContent(this.renderRamp(),_.sliderContainer,_.histogramContainer))},s.renderRamp=function(){const{style:{trackBackgroundColor:e},zoomOptions:r}=this;return h.tsx("div",{afterCreate:b.storeNode,bind:this,class:_.rampElement,"data-node-ref":"_rampNode"},h.tsx("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},h.tsx("rect",{x:"0",y:"0",fill:y.getFillFromColor(e),height:"100%",width:"100%"}),this.renderPrimaryRamp(),this.renderPath()),r?this.renderZoomCaps():null)},s.renderPrimaryRamp=function(){const{_rampFillId:e,style:{trackAboveFillColor:r,trackBelowFillColor:o},viewModel:i}=this;return[h.tsx("defs",null,this.renderRampFillDefinition(e,i.getGradientStopInfo(r,o)))]},s.renderPath=function(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(!i.isSome(e)||!i.isSome(r))return;const{stops:o,viewModel:{max:s,min:t},_rampFillId:a,_minRampFillWidth:l}=this,n=y.getDynamicPathForSizeStops({max:s,min:t,pathHeight:e,pathWidth:r,stops:o,padding:l});return h.tsx("path",{d:n,fill:`url(#${a})`})},o}(m.SmartMappingSliderBase);r.__decorate([s.aliasOf("viewModel.handlesSyncedToPrimary")],S.prototype,"handlesSyncedToPrimary",void 0),r.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],S.prototype,"label",void 0),r.__decorate([n.property(),v.messageBundle("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],S.prototype,"messages",void 0),r.__decorate([s.aliasOf("viewModel.persistSizeRangeEnabled")],S.prototype,"persistSizeRangeEnabled",void 0),r.__decorate([s.aliasOf("viewModel.stops")],S.prototype,"stops",void 0),r.__decorate([n.property()],S.prototype,"style",void 0),r.__decorate([l.cast("style")],S.prototype,"castStyle",null),r.__decorate([n.property()],S.prototype,"viewModel",void 0),r.__decorate([s.aliasOf("viewModel.zoomOptions")],S.prototype,"zoomOptions",void 0),S=f=r.__decorate([d.subclass("esri.widgets.smartMapping.BinaryColorSizeSlider")],S);return S}));
