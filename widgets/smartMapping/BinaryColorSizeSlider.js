/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/aliasOf","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../Color","../../renderers/visualVariables/support/SizeStop","../../symbols/support/cimSymbolUtils","../support/widgetUtils","../support/decorators/messageBundle","../support/decorators/renderable","../../chunks/index","./support/utils","./SmartMappingSliderBase","./BinaryColorSizeSlider/BinaryColorSizeSliderViewModel"],(function(e,r,o,t,s,i,l,a,n,d,u,c,p,m,v,y,h,b,g,f,w,S){"use strict";var _;const F="esri-binary-color-size-slider",C="esri-binary-color-size-slider__ramp",z="esri-binary-color-size-slider__slider-container",M="esri-binary-color-size-slider__histogram-container",k="esri-widget",V="esri-widget--panel",x="esri-disabled",B={trackBackgroundColor:new p([224,224,224]),trackAboveFillColor:new p([149,149,149]),trackBelowFillColor:new p([149,149,149])};let I=_=function(r){function o(e,o){var t;return(t=r.call(this,e,o)||this)._minRampFillWidth=.2,t._rampNode=null,t._rampFillId=null,t.handlesSyncedToPrimary=null,t.label=void 0,t.messages=null,t.stops=null,t.style={...B},t.viewModel=new S,t.zoomOptions=null,t._rampFillId=`${t.id}-linear-gradient`,t}e._inheritsLoose(o,r);var s=o.prototype;return s.castStyle=function(e){return{...B,...e}},o.fromRendererResult=function(e,r){const{size:{visualVariables:o},statistics:t}=e,{avg:s,stddev:i}=t,l=o[0].stops,a=e.renderer.authoringInfo.visualVariables[0],n=a.minSliderValue,d=a.maxSliderValue,u=e.renderer.classBreakInfos;let c,p,m=null;const y=e=>{if("cim"===e.type)return v.getCIMSymbolColor(e);if(e.symbolLayers){var r,o;return null==(o=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:o.color}return e.color};if(u.length>1){const e=u[0].symbol,r=u[1].symbol;p=y(e),c=y(r)}return 1===u.length&&(m=y(u[0].symbol)),new _({max:d,min:n,stops:l,histogramConfig:{average:s,standardDeviation:i,bins:r?r.bins:[]},style:{trackAboveFillColor:c,trackBelowFillColor:p,trackFillColor:m},handlesSyncedToPrimary:!0})},s.updateFromRendererResult=function(e,r){const{size:{visualVariables:o},statistics:t}=e,{avg:s,stddev:i}=t,l=o[0].stops,a=e.renderer.authoringInfo.visualVariables[0],n=a.minSliderValue,d=a.maxSliderValue,u=e.renderer.classBreakInfos;let c,p,m=null;const y=e=>{if("cim"===e.type)return v.getCIMSymbolColor(e);if(e.symbolLayers){var r,o;return null==(o=(null==(r=e.symbolLayers)?void 0:r.getItemAt(0)).material)?void 0:o.color}return e.color};if(u.length>1){const e=u[0].symbol,r=u[1].symbol;p=y(e),c=y(r)}1===u.length&&(m=y(u[0].symbol)),this.set({max:d,min:n,stops:l,histogramConfig:{average:s,standardDeviation:i,bins:r?r.bins:[]},style:{trackAboveFillColor:c,trackBelowFillColor:p,trackFillColor:m},handlesSyncedToPrimary:!0})},s.updateRenderer=function(e){var r,o;if("univariate-color-size"!==(null==(r=e.authoringInfo)?void 0:r.type)||"above-and-below"!==(null==(o=e.authoringInfo)?void 0:o.univariateTheme))return console.error("Input renderer must be a univariate renderer with an above-and-below theme."),null;const t=e.clone(),s=t.visualVariables.find((e=>"size"===e.type&&"outline"!==e.target&&e.stops)),{stops:i}=this;if(!s||!i)return console.error("No size stops available."),null;const l=t.visualVariables.indexOf(s);t.visualVariables.splice(l,1),s.stops=i,t.visualVariables.push(s);const a=i[5===i.length?2:1].value;return t.classBreakInfos[0].maxValue=a,t.classBreakInfos[1].minValue=a,t},s.updateFromVisualVariable=function(e){if(!e)return;const{maxDataValue:r,minDataValue:o,stops:t}=e;if(t)this.stops=t;else{const[t,s]=f.getSizesFromVariable(e);this.stops=[new m({value:o,size:s}),new m({value:r,size:t})]}},s.render=function(){const{state:e,label:r}=this,o="disabled"===e,t=this.classes(F,k,V,{[x]:o});return g.jsx("div",{"aria-label":r,class:t},o?null:this.renderContent(this.renderRamp(),z,M))},s.renderRamp=function(){const{style:{trackBackgroundColor:e},zoomOptions:r}=this;return g.jsx("div",{afterCreate:y.storeNode,bind:this,class:C,"data-node-ref":"_rampNode"},g.jsx("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},g.jsx("rect",{x:"0",y:"0",fill:f.getFillFromColor(e),height:"100%",width:"100%"}),this.renderPrimaryRamp(),this.renderPath()),r?this.renderZoomCaps():null)},s.renderPrimaryRamp=function(){const{_rampFillId:e,style:{trackAboveFillColor:r,trackBelowFillColor:o},viewModel:t}=this;return[g.jsx("defs",null,this.renderRampFillDefinition(e,t.getGradientStopInfo(r,o)))]},s.renderPath=function(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(!t.isSome(e)||!t.isSome(r))return;const{stops:o,viewModel:{max:s,min:i},_rampFillId:l,_minRampFillWidth:a}=this,n=f.getDynamicPathForSizeStops({max:s,min:i,pathHeight:e,pathWidth:r,stops:o,padding:a});return g.jsx("path",{d:n,fill:`url(#${l})`})},o}(w.SmartMappingSliderBase);return r.__decorate([l.aliasOf("viewModel.handlesSyncedToPrimary")],I.prototype,"handlesSyncedToPrimary",void 0),r.__decorate([i.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],I.prototype,"label",void 0),r.__decorate([i.property(),b.renderable(),h.messageBundle("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],I.prototype,"messages",void 0),r.__decorate([l.aliasOf("viewModel.stops")],I.prototype,"stops",void 0),r.__decorate([i.property(),b.renderable()],I.prototype,"style",void 0),r.__decorate([a.cast("style")],I.prototype,"castStyle",null),r.__decorate([i.property(),b.renderable(["viewModel.hasTimeData","viewModel.inputFormatFunction","viewModel.inputParseFunction","viewModel.labelFormatFunction","viewModel.max","viewModel.min","viewModel.stops","viewModel.values","viewModel.zoomOptions"])],I.prototype,"viewModel",void 0),r.__decorate([l.aliasOf("viewModel.zoomOptions")],I.prototype,"zoomOptions",void 0),I=_=r.__decorate([n.subclass("esri.widgets.smartMapping.BinaryColorSizeSlider")],I),I}));
