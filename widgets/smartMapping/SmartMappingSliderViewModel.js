/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../Slider/SliderViewModel","./support/utils"],(function(t,e,o,i,s,n,r,a,l,m,p,u,h){"use strict";let c=function(e){function o(o){var i;return(i=e.call(this,o)||this)._max=null,i._min=null,i.stops=null,i.hasTimeData=!1,i.inputFormatFunction=(t,e)=>"max"===e?i.getUnzoomedMax().toString():"min"===e?i.getUnzoomedMin().toString():t.toString(),i.inputParseFunction=null,i.labelFormatFunction=e=>{if(i.hasTimeData)return h.formatDateLabel(e);const{max:o,min:s,precision:n}=t._assertThisInitialized(i),r=o-s>10?2:n;return h.formatNumberLabel(parseFloat(e.toFixed(r)))},i.zoomingEnabled=!0,i}t._inheritsLoose(o,e);var s=o.prototype;return s.getStopIndexFromValueIndex=function(t){const{stops:e}=this;return 0===t?0:e.length-1},s.getStopChanges=function(t,e){const{max:o,min:i,stops:s,values:n}=this,r=this.getStopIndexFromValueIndex(t),a=0===t?i:n[t-1],l=t===n.length-1?o:n[t+1],m=s.map((t=>t.hasOwnProperty("ratio")?t.ratio:t.value));m[r]=Math.max(Math.min(e,l),a);const p=m[m.length-1]-m[0],u=s.length-1;return m.map(((t,e)=>({index:e,value:this.toPrecision(m[0]+e*p/u)})))},s.getValuesFromStops=function(){var t;return null==(t=this.stops)?void 0:t.map((t=>t.hasOwnProperty("ratio")?t.ratio:t.value))},s.updateStops=function(t){const{stops:e}=this,o=this.getValuesFromStops();for(const i of t)o[i.index]=i.value;e.forEach(((t,e)=>{t.hasOwnProperty("ratio")?t.ratio=o[e]:t.value=o[e]}))},s.getUnzoomedMax=function(){return this.zoomOptions&&i.isSome(this._max)?this._max:this.max},s.getUnzoomedMin=function(){return this.zoomOptions&&i.isSome(this._min)?this._min:this.min},s._storeZoomMax=function(t,e){this._max=e,this.setMax(t)},s._storeZoomMin=function(t,e){this._min=e,this.setMin(t)},t._createClass(o,[{key:"labels",get:function(){const{values:t}=this,e=t&&t.length?t.map(((t,e)=>this.getLabelForValue(t,"value",e))):[],o=this.getUnzoomedMax(),i=this.getUnzoomedMin();return{max:this.getLabelForValue(o,"max"),min:this.getLabelForValue(i,"min"),values:e}}},{key:"max",set:function(t){const{zoomOptions:e}=this;if(e&&i.isSome(e.max)){const o=this.values;let i=e.max;if(t<i&&(i=t,e.max=t),o&&o.length)for(let e=0;e<o.length;e++)t<o[e]&&this.setValue(e,t);this._storeZoomMax(i,t)}else this.setMax(t);this.notifyChange("labels")}},{key:"min",set:function(t){const{zoomOptions:e}=this;if(e&&i.isSome(e.min)){const o=this.values;let i=e.min;if(t>i&&(i=t,e.min=t),o&&o.length)for(let e=0;e<o.length;e++)t>o[e]&&this.setValue(e,t);this._storeZoomMin(i,t)}else this.setMin(t);this.notifyChange("labels")}},{key:"state",get:function(){const{max:t,min:e,values:o}=this;return i.isSome(t)&&i.isSome(e)&&o.length>0?"ready":"disabled"}},{key:"values",get:function(){const{stops:t}=this;if(!t||!t.length||t.length<2)return[];const e=this.getValuesFromStops();return[e[0],e[e.length-1]]}},{key:"zoomOptions",set:function(t){const{zoomingEnabled:e,zoomOptions:o}=this;if(e){if(o){const e=i.isSome(this._max)?this._max:this.max,o=i.isSome(this._min)?this._min:this.min;if(t){const{max:s,min:n}=t,r=i.isSome(s),a=i.isSome(n),l=a?t.min:o,m=a?o:null,p=r?t.max:e,u=r?e:null;this._storeZoomMin(l,m),this._storeZoomMax(p,u)}else this.setMax(e),this.setMin(o),this._min=null,this._max=null}else if(t){const{max:e,min:o}=t;i.isSome(o)&&this._storeZoomMin(t.min,this.min),i.isSome(e)&&this._storeZoomMax(t.max,this.max)}this._set("zoomOptions",t),this.notifyChange("max"),this.notifyChange("min")}}}]),o}(u);return e.__decorate([r.property()],c.prototype,"stops",void 0),e.__decorate([r.property()],c.prototype,"hasTimeData",void 0),e.__decorate([r.property()],c.prototype,"inputFormatFunction",void 0),e.__decorate([r.property()],c.prototype,"inputParseFunction",void 0),e.__decorate([r.property()],c.prototype,"labelFormatFunction",void 0),e.__decorate([r.property({readOnly:!0})],c.prototype,"labels",null),e.__decorate([r.property()],c.prototype,"max",null),e.__decorate([r.property()],c.prototype,"min",null),e.__decorate([r.property({readOnly:!0})],c.prototype,"state",null),e.__decorate([r.property({readOnly:!0})],c.prototype,"values",null),e.__decorate([r.property()],c.prototype,"zoomingEnabled",void 0),e.__decorate([r.property()],c.prototype,"zoomOptions",null),c=e.__decorate([a.subclass("esri.widgets.smartMapping.SmartMappingSliderViewModel")],c),c}));
