/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Error","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../../renderers/visualVariables/support/ColorSizeStop","../../renderers/visualVariables/support/ColorStop","../../renderers/visualVariables/support/SizeStop","./SmartMappingSliderBase","./ColorSizeSlider/ColorSizeSliderViewModel","./support/utils","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory"],(function(e,i,r,t,s,l,a,o,n,d,u,p,c,m,h,g,b){"use strict";var v;const f={base:"esri-color-size-slider",rampElement:"esri-color-size-slider__ramp",sliderContainer:"esri-color-size-slider__slider-container",histogramContainer:"esri-color-size-slider__histogram-container",primaryHandle:"esri-color-size-slider--primary-handle",track:"esri-color-size-slider--interactive-track",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"};let S=v=function(i){function s(e,r){var t;return(t=i.call(this,e,r)||this)._bgFillId=null,t._backgroundFillColor="#e0e0e0",t._minRampFillWidth=.2,t._rampFillId=null,t._rampNode=null,t._maxRampFillWidth=1,t.messages=null,t.viewModel=new c,t._bgFillId=`${t.id}-bg-fill`,t._rampFillId=`${t.id}-linear-gradient`,t}e._inheritsLoose(s,i),s.fromRendererResult=function(e,i){const{renderer:{authoringInfo:{univariateTheme:t}},color:{visualVariable:{stops:s}},size:{visualVariables:l},statistics:a}=e,{avg:o,stddev:d}=a;if(!s)throw new r("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const u="above-and-below"===t,p=e.renderer.authoringInfo.visualVariables[0],c=p.minSliderValue,m=p.maxSliderValue,h=l.find((e=>"outline"!==e?.target&&!(e?.axis&&!e?.field&&!e?.valueExpression)&&(e?.field||e?.valueExpression))),g=h.stops,b=s.map(((e,i)=>{const{color:r,label:t,value:l}=e;let a;return a=g&&g.length>0?g[i].size:0===i?h.minSize:i===s.length-1?h.maxSize:null,new n({color:r,label:t,value:l,size:a})}));return new v({max:m,min:c,stops:b,primaryHandleEnabled:u,handlesSyncedToPrimary:u,persistSizeRangeEnabled:u,histogramConfig:{average:o,standardDeviation:d,bins:i?i.bins:[]}})};var l=s.prototype;return l.updateFromRendererResult=function(e,i){const{renderer:{authoringInfo:{univariateTheme:t}},color:{visualVariable:{stops:s}},size:{visualVariables:l},statistics:a}=e,{avg:o,stddev:d}=a;if(!s)throw new r("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const u="above-and-below"===t,p=e.renderer.authoringInfo.visualVariables[0],c=p.minSliderValue,m=p.maxSliderValue,h=l.find((e=>"outline"!==e?.target&&!(e?.axis&&!e?.field&&!e?.valueExpression)&&(e?.field||e?.valueExpression))),g=h.stops,b=s.map(((e,i)=>{const{color:r,label:t,value:l}=e;let a;return a=g&&g.length>0?g[i].size:0===i?h.minSize:i===s.length-1?h.maxSize:null,new n({color:r,label:t,value:l,size:a})}));this.set({max:m,min:c,stops:b,primaryHandleEnabled:u,handlesSyncedToPrimary:u,persistSizeRangeEnabled:u,histogramConfig:{average:o,standardDeviation:d,bins:i?i.bins:[]}})},l.updateRenderer=function(e){const{stops:i}=this,r=i[0],s=i[i.length-1],l=i[Math.floor(i.length/2)],a=e.clone(),o=a.visualVariables.map((e=>{if("size"===e.type){if("outline"===e?.target||e?.axis&&!e?.field&&!e?.valueExpression)return e;t.isSome(e.minSize)&&t.isSome(e.maxSize)?e.set({maxDataValue:s.value,minDataValue:r.value,maxSize:s.size,minSize:r.size}):e.stops&&e.set({stops:i.map((e=>{const{label:i,size:r,value:t}=e;return new u({label:i,size:r,value:t})}))})}else"color"===e.type&&e.set({stops:this.stops.map((e=>{const{color:i,label:r,value:t}=e;return new d({color:i,label:r,value:t})}))});return e}));if(a.visualVariables=o,a.classBreakInfos.length>1){const e=l.value;a.classBreakInfos[0].maxValue=e,a.classBreakInfos[1].minValue=e}return a},l.updateVisualVariables=function(e){return e.map((e=>{const i=e.clone();if("size"===e.type){if("outline"===e?.target||e?.axis&&!e?.field&&!e?.valueExpression)return i;if(t.isSome(e.minSize)&&t.isSome(e.maxSize)){const{stops:e}=this,r=e[0],t=e[e.length-1];i.set({maxDataValue:t.value,minDataValue:r.value,maxSize:t.size,minSize:r.size})}else e.stops&&i.set({stops:this.stops.map((e=>{const{label:i,size:r,value:t}=e;return new u({label:i,size:r,value:t})}))})}else"color"===e.type&&i.set({stops:this.stops.map((e=>{const{color:i,label:r,value:t}=e;return new d({color:i,label:r,value:t})}))});return i}))},l.render=function(){const{label:e,primaryHandleEnabled:i,state:r,visibleElements:t}=this,s="disabled"===r,l=this.classes(f.base,f.esriWidget,f.esriWidgetPanel,{[f.disabled]:s,[f.primaryHandle]:i,[f.track]:t.interactiveTrack});return b.tsx("div",{"aria-label":e,class:l},s?null:this.renderContent(this.renderRamp(),f.sliderContainer,f.histogramContainer))},l.renderRamp=function(){const{_bgFillId:e,_rampFillId:i,viewModel:r,zoomOptions:t}=this,s=r.getStopInfo();return b.tsx("div",{afterCreate:h.storeNode,bind:this,class:f.rampElement,"data-node-ref":"_rampNode"},b.tsx("svg",{xmlns:"http://www.w3.org/2000/svg"},b.tsx("defs",null,this.renderRampFillDefinition(i,s),this.renderBackgroundFillDefinition(e)),b.tsx("rect",{x:"0",y:"0",fill:this._backgroundFillColor,height:"100%",width:"100%"}),this.renderPaths()),t?this.renderZoomCaps():null)},l.renderPaths=function(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:i=0}=this._rampNode;if(t.isNone(e)||t.isNone(i))return;const{primaryHandleEnabled:r,stops:s,values:l,viewModel:{max:a,min:o},_bgFillId:n,_maxRampFillWidth:d,_minRampFillWidth:u,_rampFillId:p}=this,c=[d,u];s[0].size<s[s.length-1].size&&c.reverse();const h=l.slice().sort(((e,i)=>e>i?1:-1)),[g,v]=c,[f,S]=h,z=r?m.getDynamicPathForSizeStops({max:a,min:o,pathHeight:e,pathWidth:i,stops:s,padding:u}):m.getPathForSizeStops({bottomValue:f,bottomWidth:g,max:a,min:o,pathHeight:e,pathWidth:i,topValue:S,topWidth:v});return[b.tsx("path",{key:"background",d:z,fill:`url(#${n})`}),b.tsx("path",{key:"fill",d:z,fill:`url(#${p})`})]},e._createClass(s,[{key:"handlesSyncedToPrimary",get:function(){return this.viewModel.handlesSyncedToPrimary},set:function(e){this.viewModel.handlesSyncedToPrimary=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"persistSizeRangeEnabled",get:function(){return this.viewModel.persistSizeRangeEnabled},set:function(e){this.viewModel.persistSizeRangeEnabled=e}},{key:"primaryHandleEnabled",get:function(){return this.viewModel.primaryHandleEnabled},set:function(e){this.viewModel.primaryHandleEnabled=e}},{key:"stops",get:function(){return this.viewModel.stops},set:function(e){this.viewModel.stops=e}}]),s}(p.SmartMappingSliderBase);i.__decorate([s.property()],S.prototype,"label",null),i.__decorate([s.property(),g.messageBundle("esri/widgets/smartMapping/ColorSizeSlider/t9n/ColorSizeSlider")],S.prototype,"messages",void 0),i.__decorate([s.property()],S.prototype,"persistSizeRangeEnabled",null),i.__decorate([s.property()],S.prototype,"primaryHandleEnabled",null),i.__decorate([s.property()],S.prototype,"stops",null),i.__decorate([s.property()],S.prototype,"viewModel",void 0),S=v=i.__decorate([o.subclass("esri.widgets.smartMapping.ColorSizeSlider")],S);return S}));
