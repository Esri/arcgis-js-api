/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Error","../../core/maybe","../../core/accessorSupport/decorators/aliasOf","../../core/arrayUtils","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../renderers/visualVariables/support/ColorSizeStop","../../renderers/visualVariables/support/ColorStop","../../renderers/visualVariables/support/SizeStop","./SmartMappingSliderBase","./ColorSizeSlider/ColorSizeSliderViewModel","./support/utils","../support/widgetUtils","../support/decorators/messageBundle","../../core/Logger","../support/jsxFactory"],(function(e,i,l,r,s,a,t,o,n,d,u,p,c,m,v,h,g,b,f,S){"use strict";var z;const y={base:"esri-color-size-slider",rampElement:"esri-color-size-slider__ramp",sliderContainer:"esri-color-size-slider__slider-container",histogramContainer:"esri-color-size-slider__histogram-container",primaryHandle:"esri-color-size-slider--primary-handle",track:"esri-color-size-slider--interactive-track",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"};let _=z=function(i){function s(e,l){var r;return(r=i.call(this,e,l)||this)._bgFillId=null,r._backgroundFillColor="#e0e0e0",r._minRampFillWidth=.2,r._rampFillId=null,r._rampNode=null,r._maxRampFillWidth=1,r.handlesSyncedToPrimary=null,r.label=void 0,r.messages=null,r.persistSizeRangeEnabled=null,r.primaryHandleEnabled=null,r.stops=null,r.viewModel=new v,r.zoomOptions=null,r._bgFillId=`${r.id}-bg-fill`,r._rampFillId=`${r.id}-linear-gradient`,r}e._inheritsLoose(s,i),s.fromRendererResult=function(e,i){const{renderer:{authoringInfo:{univariateTheme:r}},color:{visualVariable:{stops:s}},size:{visualVariables:a},statistics:t}=e,{avg:o,stddev:n}=t;if(!s)throw new l("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const d="above-and-below"===r,p=e.renderer.authoringInfo.visualVariables[0],c=p.minSliderValue,m=p.maxSliderValue,v=a.find((e=>"outline"!==(null==e?void 0:e.target)&&!(null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))&&((null==e?void 0:e.field)||(null==e?void 0:e.valueExpression)))),h=v.stops,g=s.map(((e,i)=>{const{color:l,label:r,value:a}=e;let t;return t=h&&h.length>0?h[i].size:0===i?v.minSize:i===s.length-1?v.maxSize:null,new u({color:l,label:r,value:a,size:t})}));return new z({max:m,min:c,stops:g,primaryHandleEnabled:d,handlesSyncedToPrimary:d,persistSizeRangeEnabled:d,histogramConfig:{average:o,standardDeviation:n,bins:i?i.bins:[]}})};var a=s.prototype;return a.updateFromRendererResult=function(e,i){const{renderer:{authoringInfo:{univariateTheme:r}},color:{visualVariable:{stops:s}},size:{visualVariables:a},statistics:t}=e,{avg:o,stddev:n}=t;if(!s)throw new l("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const d="above-and-below"===r,p=e.renderer.authoringInfo.visualVariables[0],c=p.minSliderValue,m=p.maxSliderValue,v=a.find((e=>"outline"!==(null==e?void 0:e.target)&&!(null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))&&((null==e?void 0:e.field)||(null==e?void 0:e.valueExpression)))),h=v.stops,g=s.map(((e,i)=>{const{color:l,label:r,value:a}=e;let t;return t=h&&h.length>0?h[i].size:0===i?v.minSize:i===s.length-1?v.maxSize:null,new u({color:l,label:r,value:a,size:t})}));this.set({max:m,min:c,stops:g,primaryHandleEnabled:d,handlesSyncedToPrimary:d,persistSizeRangeEnabled:d,histogramConfig:{average:o,standardDeviation:n,bins:i?i.bins:[]}})},a.updateRenderer=function(e){const{stops:i}=this,l=i[0],s=i[i.length-1],a=i[Math.floor(i.length/2)],t=e.clone(),o=t.visualVariables.map((e=>{if("size"===e.type){if("outline"===(null==e?void 0:e.target)||null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))return e;r.isSome(e.minSize)&&r.isSome(e.maxSize)?e.set({maxDataValue:s.value,minDataValue:l.value,maxSize:s.size,minSize:l.size}):e.stops&&e.set({stops:i.map((e=>{const{label:i,size:l,value:r}=e;return new c({label:i,size:l,value:r})}))})}else"color"===e.type&&e.set({stops:this.stops.map((e=>{const{color:i,label:l,value:r}=e;return new p({color:i,label:l,value:r})}))});return e}));if(t.visualVariables=o,t.classBreakInfos.length>1){const e=a.value;t.classBreakInfos[0].maxValue=e,t.classBreakInfos[1].minValue=e}return t},a.updateVisualVariables=function(e){return e.map((e=>{const i=e.clone();if("size"===e.type){if("outline"===(null==e?void 0:e.target)||null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))return i;if(r.isSome(e.minSize)&&r.isSome(e.maxSize)){const{stops:e}=this,l=e[0],r=e[e.length-1];i.set({maxDataValue:r.value,minDataValue:l.value,maxSize:r.size,minSize:l.size})}else e.stops&&i.set({stops:this.stops.map((e=>{const{label:i,size:l,value:r}=e;return new c({label:i,size:l,value:r})}))})}else"color"===e.type&&i.set({stops:this.stops.map((e=>{const{color:i,label:l,value:r}=e;return new p({color:i,label:l,value:r})}))});return i}))},a.render=function(){const{label:e,primaryHandleEnabled:i,state:l,visibleElements:r}=this,s="disabled"===l,a=this.classes(y.base,y.esriWidget,y.esriWidgetPanel,{[y.disabled]:s,[y.primaryHandle]:i,[y.track]:r.interactiveTrack});return S.tsx("div",{"aria-label":e,class:a},s?null:this.renderContent(this.renderRamp(),y.sliderContainer,y.histogramContainer))},a.renderRamp=function(){const{_bgFillId:e,_rampFillId:i,viewModel:l,zoomOptions:r}=this,s=l.getStopInfo();return S.tsx("div",{afterCreate:g.storeNode,bind:this,class:y.rampElement,"data-node-ref":"_rampNode"},S.tsx("svg",{xmlns:"http://www.w3.org/2000/svg"},S.tsx("defs",null,this.renderRampFillDefinition(i,s),this.renderBackgroundFillDefinition(e)),S.tsx("rect",{x:"0",y:"0",fill:this._backgroundFillColor,height:"100%",width:"100%"}),this.renderPaths()),r?this.renderZoomCaps():null)},a.renderPaths=function(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:i=0}=this._rampNode;if(!r.isSome(e)||!r.isSome(i))return;const{primaryHandleEnabled:l,stops:s,values:a,viewModel:{max:t,min:o},_bgFillId:n,_maxRampFillWidth:d,_minRampFillWidth:u,_rampFillId:p}=this,c=[d,u];s[0].size<s[s.length-1].size&&c.reverse();const m=a.slice().sort(((e,i)=>e>i?1:-1)),[v,g]=c,[b,f]=m,z=l?h.getDynamicPathForSizeStops({max:t,min:o,pathHeight:e,pathWidth:i,stops:s,padding:u}):h.getPathForSizeStops({bottomValue:b,bottomWidth:v,max:t,min:o,pathHeight:e,pathWidth:i,topValue:f,topWidth:g});return[S.tsx("path",{key:"background",d:z,fill:`url(#${n})`}),S.tsx("path",{key:"fill",d:z,fill:`url(#${p})`})]},s}(m.SmartMappingSliderBase);i.__decorate([s.aliasOf("viewModel.handlesSyncedToPrimary")],_.prototype,"handlesSyncedToPrimary",void 0),i.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],_.prototype,"label",void 0),i.__decorate([n.property(),b.messageBundle("esri/widgets/smartMapping/ColorSizeSlider/t9n/ColorSizeSlider")],_.prototype,"messages",void 0),i.__decorate([s.aliasOf("viewModel.persistSizeRangeEnabled")],_.prototype,"persistSizeRangeEnabled",void 0),i.__decorate([s.aliasOf("viewModel.primaryHandleEnabled")],_.prototype,"primaryHandleEnabled",void 0),i.__decorate([s.aliasOf("viewModel.stops")],_.prototype,"stops",void 0),i.__decorate([n.property()],_.prototype,"viewModel",void 0),i.__decorate([s.aliasOf("viewModel.zoomOptions")],_.prototype,"zoomOptions",void 0),_=z=i.__decorate([d.subclass("esri.widgets.smartMapping.ColorSizeSlider")],_);return _}));
