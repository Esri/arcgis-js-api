/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/aliasOf","../../core/accessorSupport/decorators/subclass","../../core/Error","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../renderers/visualVariables/support/ColorStop","../../renderers/visualVariables/support/SizeStop","../support/widgetUtils","../support/decorators/messageBundle","../support/decorators/renderable","../../chunks/index","./support/utils","./SmartMappingSliderBase","../../renderers/visualVariables/support/ColorSizeStop","./ColorSizeSlider/ColorSizeSliderViewModel"],(function(e,l,i,r,s,o,a,t,n,d,u,p,c,m,v,h,b,g,f,S,z,w,_){"use strict";var y;const x="esri-color-size-slider",V="esri-color-size-slider__ramp",M="esri-color-size-slider__slider-container",F="esri-color-size-slider__histogram-container",C="esri-widget",I="esri-widget--panel",R="esri-disabled";let E=y=function(l){function i(e,i){var r;return(r=l.call(this,e,i)||this)._bgFillId=null,r._backgroundFillColor="#e0e0e0",r._minRampFillWidth=.2,r._rampFillId=null,r._rampNode=null,r._maxRampFillWidth=1,r.handlesSyncedToPrimary=null,r.label=void 0,r.messages=null,r.primaryHandleEnabled=null,r.stops=null,r.viewModel=new _,r.zoomOptions=null,r._bgFillId=`${r.id}-bg-fill`,r._rampFillId=`${r.id}-linear-gradient`,r}e._inheritsLoose(i,l),i.fromRendererResult=function(e,l){const{renderer:{authoringInfo:{univariateTheme:i}},color:{visualVariable:{stops:r}},size:{visualVariables:s},statistics:o}=e,{avg:a,stddev:t}=o;if(!r)throw new d("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const n="above-and-below"===i,u=e.renderer.authoringInfo.visualVariables[0],p=u.minSliderValue,c=u.maxSliderValue,m=s.find((e=>"outline"!==(null==e?void 0:e.target)&&!(null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))&&((null==e?void 0:e.field)||(null==e?void 0:e.valueExpression)))),v=m.stops,h=r.map(((e,l)=>{const{color:i,label:s,value:o}=e;let a;return a=v&&v.length>0?v[l].size:0===l?m.minSize:l===r.length-1?m.maxSize:null,new w({color:i,label:s,value:o,size:a})}));return new y({max:c,min:p,stops:h,primaryHandleEnabled:n,handlesSyncedToPrimary:n,histogramConfig:{average:a,standardDeviation:t,bins:l?l.bins:[]}})};var s=i.prototype;return s.updateFromRendererResult=function(e,l){const{renderer:{authoringInfo:{univariateTheme:i}},color:{visualVariable:{stops:r}},size:{visualVariables:s},statistics:o}=e,{avg:a,stddev:t}=o;if(!r)throw new d("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const n="above-and-below"===i,u=e.renderer.authoringInfo.visualVariables[0],p=u.minSliderValue,c=u.maxSliderValue,m=s.find((e=>"outline"!==(null==e?void 0:e.target)&&!(null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))&&((null==e?void 0:e.field)||(null==e?void 0:e.valueExpression)))),v=m.stops,h=r.map(((e,l)=>{const{color:i,label:s,value:o}=e;let a;return a=v&&v.length>0?v[l].size:0===l?m.minSize:l===r.length-1?m.maxSize:null,new w({color:i,label:s,value:o,size:a})}));this.set({max:c,min:p,stops:h,primaryHandleEnabled:n,handlesSyncedToPrimary:n,histogramConfig:{average:a,standardDeviation:t,bins:l?l.bins:[]}})},s.updateRenderer=function(e){const{stops:l}=this,i=l[0],s=l[l.length-1],o=l[Math.floor(l.length/2)],a=e.clone(),t=a.visualVariables.map((e=>{if("size"===e.type){if("outline"===(null==e?void 0:e.target)||null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))return e;r.isSome(e.minSize)&&r.isSome(e.maxSize)?e.set({maxDataValue:s.value,minDataValue:i.value,maxSize:s.size,minSize:i.size}):e.stops&&e.set({stops:l.map((e=>{const{label:l,size:i,value:r}=e;return new v({label:l,size:i,value:r})}))})}else"color"===e.type&&e.set({stops:this.stops.map((e=>{const{color:l,label:i,value:r}=e;return new m({color:l,label:i,value:r})}))});return e}));if(a.visualVariables=t,a.classBreakInfos.length>1){const e=o.value;a.classBreakInfos[0].maxValue=e,a.classBreakInfos[1].minValue=e}return a},s.updateVisualVariables=function(e){return e.map((e=>{const l=e.clone();if("size"===e.type){if("outline"===(null==e?void 0:e.target)||null!=e&&e.axis&&(null==e||!e.field)&&(null==e||!e.valueExpression))return l;if(r.isSome(e.minSize)&&r.isSome(e.maxSize)){const{stops:e}=this,i=e[0],r=e[e.length-1];l.set({maxDataValue:r.value,minDataValue:i.value,maxSize:r.size,minSize:i.size})}else e.stops&&l.set({stops:this.stops.map((e=>{const{label:l,size:i,value:r}=e;return new v({label:l,size:i,value:r})}))})}else"color"===e.type&&l.set({stops:this.stops.map((e=>{const{color:l,label:i,value:r}=e;return new m({color:l,label:i,value:r})}))});return l}))},s.render=function(){const{state:e,label:l}=this,i="disabled"===e,r=this.classes(x,C,I,{[R]:i});return f.jsx("div",{"aria-label":l,class:r},i?null:this.renderContent(this.renderRamp(),M,F))},s.renderRamp=function(){const{_bgFillId:e,_rampFillId:l,viewModel:i,zoomOptions:r}=this,s=i.getStopInfo();return f.jsx("div",{afterCreate:h.storeNode,bind:this,class:V,"data-node-ref":"_rampNode"},f.jsx("svg",{xmlns:"http://www.w3.org/2000/svg"},f.jsx("defs",null,this.renderRampFillDefinition(l,s),this.renderBackgroundFillDefinition(e)),f.jsx("rect",{x:"0",y:"0",fill:this._backgroundFillColor,height:"100%",width:"100%"}),this.renderPaths()),r?this.renderZoomCaps():null)},s.renderPaths=function(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:l=0}=this._rampNode;if(!r.isSome(e)||!r.isSome(l))return;const{primaryHandleEnabled:i,stops:s,values:o,viewModel:{max:a,min:t},_bgFillId:n,_maxRampFillWidth:d,_minRampFillWidth:u,_rampFillId:p}=this,c=[d,u];s[0].size<s[s.length-1].size&&c.reverse();const[m,v]=c,[h,b]=o,g=i?S.getDynamicPathForSizeStops({max:a,min:t,pathHeight:e,pathWidth:l,stops:s,padding:v}):S.getPathForSizeStops({bottomValue:h,bottomWidth:m,max:a,min:t,pathHeight:e,pathWidth:l,topValue:b,topWidth:v});return[f.jsx("path",{key:"background",d:g,fill:`url(#${n})`}),f.jsx("path",{key:"fill",d:g,fill:`url(#${p})`})]},i}(z.SmartMappingSliderBase);return l.__decorate([t.aliasOf("viewModel.handlesSyncedToPrimary")],E.prototype,"handlesSyncedToPrimary",void 0),l.__decorate([a.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],E.prototype,"label",void 0),l.__decorate([a.property(),g.renderable(),b.messageBundle("esri/widgets/smartMapping/ColorSizeSlider/t9n/ColorSizeSlider")],E.prototype,"messages",void 0),l.__decorate([t.aliasOf("viewModel.primaryHandleEnabled")],E.prototype,"primaryHandleEnabled",void 0),l.__decorate([t.aliasOf("viewModel.stops")],E.prototype,"stops",void 0),l.__decorate([a.property(),g.renderable(["viewModel.handlesSyncedToPrimary","viewModel.hasTimeData","viewModel.inputFormatFunction","viewModel.inputParseFunction","viewModel.labelFormatFunction","viewModel.max","viewModel.min","viewModel.primaryHandleEnabled","viewModel.stops","viewModel.values","viewModel.zoomOptions"])],E.prototype,"viewModel",void 0),l.__decorate([t.aliasOf("viewModel.zoomOptions")],E.prototype,"zoomOptions",void 0),E=y=l.__decorate([n.subclass("esri.widgets.smartMapping.ColorSizeSlider")],E),E}));
