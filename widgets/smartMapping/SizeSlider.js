/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import s from"../../Color.js";import{isNone as i}from"../../core/maybe.js";import{aliasOf as r}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/arrayUtils.js";import"../../core/has.js";import{cast as t}from"../../core/accessorSupport/decorators/cast.js";import{property as a}from"../../core/accessorSupport/decorators/property.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import l from"../../renderers/visualVariables/SizeVariable.js";import n from"../../renderers/visualVariables/support/SizeStop.js";import{SmartMappingSliderBase as d}from"./SmartMappingSliderBase.js";import p from"./SizeSlider/SizeSliderViewModel.js";import{getSizesFromVariable as m,getFillFromColor as c,getDynamicPathForSizeStops as u,getPathForSizeStops as h}from"./support/utils.js";import{storeNode as z}from"../support/widgetUtils.js";import{messageBundle as v}from"../support/decorators/messageBundle.js";import{tsx as g}from"../support/jsxFactory.js";var b;const f={base:"esri-size-slider",rampElement:"esri-size-slider__ramp",sliderContainer:"esri-size-slider__slider-container",histogramContainer:"esri-size-slider__histogram-container",zoomCapTop:"esri-size-slider__zoom-cap-top",zoomCapBottom:"esri-size-slider__zoom-cap-bottom",zoomCapLine:"esri-size-slider__zoom-cap-line",zoomCapMask:"esri-size-slider__zoom-cap-mask",zoomCapUnderline:"esri-size-slider__zoom-cap-underline",primaryHandle:"esri-size-slider--primary-handle",track:"esri-size-slider--interactive-track",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},y={trackFillColor:new s([149,149,149]),trackBackgroundColor:new s([224,224,224])};let S=b=class extends d{constructor(e,s){super(e,s),this._maxRampFillWidth=1,this._minRampFillWidth=.2,this._rampNode=null,this.handlesSyncedToPrimary=null,this.label=void 0,this.messages=null,this.persistSizeRangeEnabled=null,this.primaryHandleEnabled=null,this.stops=null,this.style={...y},this.viewModel=new p,this.zoomOptions=null}castStyle(e){return{...y,...e}}static fromRendererResult(e,s){const{visualVariables:i,statistics:r}=e,{avg:t,stddev:a}=r,o=i[0],[l,n]=m(o),d=e.renderer.authoringInfo.visualVariables[0],p=d.minSliderValue,c=d.maxSliderValue;return new b({max:c,min:p,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:t,standardDeviation:a,bins:s?s.bins:[]}})}updateFromRendererResult(e,s){const{visualVariables:i,statistics:r}=e,{avg:t,stddev:a}=r,o=i[0],[l,n]=m(o),d=e.renderer.authoringInfo.visualVariables[0],p=d.minSliderValue,c=d.maxSliderValue;this.set({max:c,min:p,stops:[{value:o.minDataValue,size:n},{value:o.maxDataValue,size:l}],histogramConfig:{average:t,standardDeviation:a,bins:s?s.bins:[]}})}updateVisualVariable(e){const s=e.clone(),{stops:i}=this;if(!e||!i)return null;if(s.stops)return s.stops=i,s;const r=i[0],t=i[i.length-1];let a=s.maxSize,o=s.minSize;if(a instanceof l){const e=a.stops,s=t.size/e[0].size,i=e.map((e=>(e.size*=s,e)));a.stops=i}else a=t.size;if(o instanceof l){const e=o.stops,s=r.size/e[0].size,i=e.map((e=>(e.size*=s,e)));o.stops=i}else o=r.size;return s.set({maxDataValue:t.value,minDataValue:r.value,maxSize:a,minSize:o}),s}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:s,minDataValue:i,stops:r}=e;if(r)this.stops=r;else{const[r,t]=m(e);this.stops=[new n({value:i,size:t}),new n({value:s,size:r})]}}render(){const{label:e,primaryHandleEnabled:s,state:i,visibleElements:r}=this,t="disabled"===i,a=this.classes(f.base,f.esriWidget,f.esriWidgetPanel,{[f.disabled]:t,[f.primaryHandle]:s,[f.track]:r.interactiveTrack});return g("div",{"aria-label":e,class:a},t?null:this.renderContent(this.renderRamp(),f.sliderContainer,f.histogramContainer))}renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:s}=this;return g("div",{afterCreate:z,bind:this,class:f.rampElement,"data-node-ref":"_rampNode"},g("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},g("rect",{x:"0",y:"0",fill:c(e),height:"100%",width:"100%"}),this.renderPath()),s?this.renderZoomCaps():null)}renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:s=0}=this._rampNode;if(i(e)||i(s))return;const{primaryHandleEnabled:r,stops:t,style:{trackFillColor:a},values:o,viewModel:{max:l,min:n},_maxRampFillWidth:d,_minRampFillWidth:p}=this,m=[d,p];t[0].size<t[t.length-1].size&&m.reverse();const z=o.slice().sort(((e,s)=>e>s?1:-1)),[v,b]=m,[f,y]=z,S=r?u({max:l,min:n,pathHeight:e,pathWidth:s,stops:t,padding:b}):h({bottomValue:f,bottomWidth:v,max:l,min:n,pathHeight:e,pathWidth:s,topValue:y,topWidth:b});return g("path",{d:S,fill:c(a)})}};e([r("viewModel.handlesSyncedToPrimary")],S.prototype,"handlesSyncedToPrimary",void 0),e([a({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],S.prototype,"label",void 0),e([a(),v("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],S.prototype,"messages",void 0),e([r("viewModel.persistSizeRangeEnabled")],S.prototype,"persistSizeRangeEnabled",void 0),e([r("viewModel.primaryHandleEnabled")],S.prototype,"primaryHandleEnabled",void 0),e([r("viewModel.stops")],S.prototype,"stops",void 0),e([a()],S.prototype,"style",void 0),e([t("style")],S.prototype,"castStyle",null),e([a()],S.prototype,"viewModel",void 0),e([r("viewModel.zoomOptions")],S.prototype,"zoomOptions",void 0),S=b=e([o("esri.widgets.smartMapping.SizeSlider")],S);const w=S;export{w as default};
