/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Color","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","../../renderers/visualVariables/SizeVariable","../../renderers/visualVariables/support/SizeStop","./SmartMappingSliderBase","./SizeSlider/SizeSliderViewModel","./support/utils","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory"],(function(e,t,i,s,r,a,o,n,l,d,p,u,c,m,h,g){"use strict";var z;const y={base:"esri-size-slider",rampElement:"esri-size-slider__ramp",sliderContainer:"esri-size-slider__slider-container",histogramContainer:"esri-size-slider__histogram-container",zoomCapTop:"esri-size-slider__zoom-cap-top",zoomCapBottom:"esri-size-slider__zoom-cap-bottom",zoomCapLine:"esri-size-slider__zoom-cap-line",zoomCapMask:"esri-size-slider__zoom-cap-mask",zoomCapUnderline:"esri-size-slider__zoom-cap-underline",primaryHandle:"esri-size-slider--primary-handle",track:"esri-size-slider--interactive-track",esriWidget:"esri-widget",esriWidgetPanel:"esri-widget--panel",widgetIcon:"esri-icon-edit",disabled:"esri-disabled"},v={trackFillColor:new i([149,149,149]),trackBackgroundColor:new i([224,224,224])};let b=z=function(t){function i(e,i){var s;return(s=t.call(this,e,i)||this)._maxRampFillWidth=1,s._minRampFillWidth=.2,s._rampNode=null,s.messages=null,s.style={...v},s.viewModel=new u,s}e._inheritsLoose(i,t);var r=i.prototype;return r.castStyle=function(e){return{...v,...e}},i.fromRendererResult=function(e,t){const{visualVariables:i,statistics:s}=e,{avg:r,stddev:a}=s,o=i[0],[n,l]=c.getSizesFromVariable(o),d=e.renderer.authoringInfo.visualVariables[0],p=d.minSliderValue,u=d.maxSliderValue;return new z({max:u,min:p,stops:[{value:o.minDataValue,size:l},{value:o.maxDataValue,size:n}],histogramConfig:{average:r,standardDeviation:a,bins:t?t.bins:[]}})},r.updateFromRendererResult=function(e,t){const{visualVariables:i,statistics:s}=e,{avg:r,stddev:a}=s,o=i[0],[n,l]=c.getSizesFromVariable(o),d=e.renderer.authoringInfo.visualVariables[0],p=d.minSliderValue,u=d.maxSliderValue;this.set({max:u,min:p,stops:[{value:o.minDataValue,size:l},{value:o.maxDataValue,size:n}],histogramConfig:{average:r,standardDeviation:a,bins:t?t.bins:[]}})},r.updateVisualVariable=function(e){const t=e.clone(),{stops:i}=this;if(!e||!i)return null;if(t.stops)return t.stops=i,t;const s=i[0],r=i[i.length-1];let a=t.maxSize,o=t.minSize;if(a instanceof l){const e=a.stops,t=r.size/e[0].size,i=e.map((e=>(e.size*=t,e)));a.stops=i}else a=r.size;if(o instanceof l){const e=o.stops,t=s.size/e[0].size,i=e.map((e=>(e.size*=t,e)));o.stops=i}else o=s.size;return t.set({maxDataValue:r.value,minDataValue:s.value,maxSize:a,minSize:o}),t},r.updateFromVisualVariable=function(e){if(!e)return;const{maxDataValue:t,minDataValue:i,stops:s}=e;if(s)this.stops=s;else{const[s,r]=c.getSizesFromVariable(e);this.stops=[new d({value:i,size:r}),new d({value:t,size:s})]}},r.render=function(){const{label:e,primaryHandleEnabled:t,state:i,visibleElements:s}=this,r="disabled"===i,a=this.classes(y.base,y.esriWidget,y.esriWidgetPanel,{[y.disabled]:r,[y.primaryHandle]:t,[y.track]:s.interactiveTrack});return g.tsx("div",{"aria-label":e,class:a},r?null:this.renderContent(this.renderRamp(),y.sliderContainer,y.histogramContainer))},r.renderRamp=function(){const{style:{trackBackgroundColor:e},zoomOptions:t}=this;return g.tsx("div",{afterCreate:m.storeNode,bind:this,class:y.rampElement,"data-node-ref":"_rampNode"},g.tsx("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},g.tsx("rect",{x:"0",y:"0",fill:c.getFillFromColor(e),height:"100%",width:"100%"}),this.renderPath()),t?this.renderZoomCaps():null)},r.renderPath=function(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:t=0}=this._rampNode;if(s.isNone(e)||s.isNone(t))return;const{primaryHandleEnabled:i,stops:r,style:{trackFillColor:a},values:o,viewModel:{max:n,min:l},_maxRampFillWidth:d,_minRampFillWidth:p}=this,u=[d,p];r[0].size<r[r.length-1].size&&u.reverse();const m=o.slice().sort(((e,t)=>e>t?1:-1)),[h,z]=u,[y,v]=m,b=i?c.getDynamicPathForSizeStops({max:n,min:l,pathHeight:e,pathWidth:t,stops:r,padding:z}):c.getPathForSizeStops({bottomValue:y,bottomWidth:h,max:n,min:l,pathHeight:e,pathWidth:t,topValue:v,topWidth:z});return g.tsx("path",{d:b,fill:c.getFillFromColor(a)})},e._createClass(i,[{key:"handlesSyncedToPrimary",get:function(){return this.viewModel.handlesSyncedToPrimary},set:function(e){this.viewModel.handlesSyncedToPrimary=e}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(e){this._overrideIfSome("label",e)}},{key:"persistSizeRangeEnabled",get:function(){return this.viewModel.persistSizeRangeEnabled},set:function(e){this.viewModel.persistSizeRangeEnabled=e}},{key:"primaryHandleEnabled",get:function(){return this.viewModel.primaryHandleEnabled},set:function(e){this.viewModel.primaryHandleEnabled=e}},{key:"stops",get:function(){return this.viewModel.stops},set:function(e){this.viewModel.stops=e}}]),i}(p.SmartMappingSliderBase);t.__decorate([r.property()],b.prototype,"handlesSyncedToPrimary",null),t.__decorate([r.property()],b.prototype,"label",null),t.__decorate([r.property(),h.messageBundle("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],b.prototype,"messages",void 0),t.__decorate([r.property()],b.prototype,"persistSizeRangeEnabled",null),t.__decorate([r.property()],b.prototype,"primaryHandleEnabled",null),t.__decorate([r.property()],b.prototype,"stops",null),t.__decorate([r.property()],b.prototype,"style",void 0),t.__decorate([o.cast("style")],b.prototype,"castStyle",null),t.__decorate([r.property()],b.prototype,"viewModel",void 0),b=z=t.__decorate([n.subclass("esri.widgets.smartMapping.SizeSlider")],b);return b}));
