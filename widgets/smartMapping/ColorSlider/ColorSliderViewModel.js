// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../../../core/maybe","../../../core/accessorSupport/decorators","../SmartMappingSliderViewModel"],(function(e,t,n,r,o,i){"use strict";return function(e){function t(t){var n=e.call(this,t)||this;return n.handlesSyncedToPrimary=!0,n}return n.__extends(t,e),Object.defineProperty(t.prototype,"primaryHandleEnabled",{get:function(){var e=this.stops;if(!e||!e.length)return!1;var t=e.length;return(3===t||5===t)&&this._get("primaryHandleEnabled")},set:function(e){this._set("primaryHandleEnabled",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stops",{set:function(e){if(e&&e.length){var t=e.map((function(e){return e.value})),o=this.max,i=this.min,a={};r.isSome(i)&&t.some((function(e){return e<i}))&&(a.min=Math.min.apply(Math,t)),r.isSome(o)&&t.some((function(e){return e>o}))&&(a.max=Math.max.apply(Math,t)),this.set(n.__assign({},a))}this._set("stops",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){var e=this.primaryHandleEnabled,t=this.stops;if(!t||!t.length||t.length<2)return[];var n=t.map((function(e){return e.value}));return e?3===n.length?[n[0],n[1],n[2]]:[n[0],n[2],n[4]]:[n[0],n[n.length-1]]},enumerable:!1,configurable:!0}),t.prototype.setValue=function(e,t){var n=this.values;if(n[e]!==(t=this.toPrecision(t))){var r=this.max,o=this.min;if(!(t>r||t<o)){if(this.primaryHandleEnabled){var i=n[1];0===e&&t>i?t=i:2===e&&t<i&&(t=i)}var a=this._getColorStopChanges(e,t);this._updateColorStops(a),this.notifyChange("values"),this.notifyChange("labels")}}},t.prototype.getStopInfo=function(){var e=this.min,t=this.max,n=this.stops;return n&&n.length?n.map((function(n){return{color:n.color,offset:(t-n.value)/(t-e)}})):[]},t.prototype._getStopIndexFromValueIndex=function(e){var t=this.primaryHandleEnabled,n=this.stops;return 0===e?0:t&&1===e?2:n.length-1},t.prototype._getColorStopChanges=function(e,t){return this.primaryHandleEnabled?1===e?this._getColorStopChangesAfterPrimaryHandleMove(e,t):this._getColorStopChangesAfterSecondaryHandleMove(e,t):this._getColorStopChangesAfterHandleMove(e,t)},t.prototype._getColorStopChangesAfterPrimaryHandleMove=function(e,t){var n=this.handlesSyncedToPrimary,r=this.stops,o=this.values,i=this._getStopIndexFromValueIndex(e);if(n){var a=this.max,s=this.min,l=t-o[e],p=Math.max(Math.min(o[0]+l,a),s),u=Math.max(Math.min(o[2]+l,a),s);return 5===r.length?[{index:0,value:this.toPrecision(p)},{index:1,value:this.toPrecision((t+p)/2)},{index:2,value:t},{index:3,value:this.toPrecision((t+u)/2)},{index:4,value:this.toPrecision(u)}]:[{index:0,value:p},{index:1,value:t},{index:2,value:u}]}return 5===r.length?[{index:1,value:this.toPrecision((o[1]+o[0])/2)},{index:2,value:t},{index:3,value:this.toPrecision((o[1]+o[2])/2)}]:[{index:i,value:t}]},t.prototype._getColorStopChangesAfterSecondaryHandleMove=function(e,t){var n=this.stops,r=this.values,o=this._getStopIndexFromValueIndex(e);return 5===n.length?[{index:o,value:t},{index:0===o?1:3,value:this.toPrecision((t+r[1])/2)}]:[{index:o,value:t}]},t.prototype._getColorStopChangesAfterHandleMove=function(e,t){var n=this,r=this.max,o=this.min,i=this.stops,a=this.values,s=this._getStopIndexFromValueIndex(e),l=0===e?o:a[e-1],p=e===a.length-1?r:a[e+1],u=i.map((function(e){return e.value}));u[s]=Math.max(Math.min(t,p),l);var h=u[u.length-1]-u[0],d=i.length-1;return u.map((function(e,t){return{index:t,value:n.toPrecision(u[0]+t*h/d)}}))},t.prototype._updateColorStops=function(e){for(var t=this.stops,n=t.map((function(e){return e.value})),r=0,o=e;r<o.length;r++){var i=o[r];n[i.index]=i.value}t.forEach((function(e,t){return e.value=n[t]}))},n.__decorate([o.property()],t.prototype,"handlesSyncedToPrimary",void 0),n.__decorate([o.property({dependsOn:["stops"]})],t.prototype,"primaryHandleEnabled",null),n.__decorate([o.property()],t.prototype,"stops",null),n.__decorate([o.property({dependsOn:["primaryHandleEnabled","stops"],readOnly:!0})],t.prototype,"values",null),t=n.__decorate([o.subclass("esri.widgets.smartMapping.ColorSlider.ColorSliderViewModel")],t)}(i)}));