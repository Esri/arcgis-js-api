/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/aliasOf","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../Color","../../core/watchUtils","../support/widgetUtils","../../chunks/index","../Widget","../Slider","../Histogram","./support/utils"],(function(o,e,t,i,n,a,s,r,l,p,m,d,c,u,g,h,M,C,w,f,S){"use strict";const v={zoomCap:"zoom-cap",maxZoomCap:"zoom-cap--max",minZoomCap:"zoom-cap--min",zoomCapLine:"zoom-cap--line",zoomCapMask:"zoom-cap--mask",zoomCapUnderline:"zoom-cap--underline"};o.SmartMappingSliderBase=function(o){function t(t,i){var n;(n=o.call(this,t,i)||this).hasTimeData=null,n.histogram=new f({layout:"vertical"}),n.histogramConfig=null,n.inputFormatFunction=null,n.inputParseFunction=null,n.labelFormatFunction=null,n.precision=4,n.slider=new w({layout:"vertical",visibleElements:{labels:!0,rangeLabels:!0},labelInputsEnabled:!0,rangeLabelInputsEnabled:!0}),n.state=null,n.viewModel=null,n.zoomOptions=null;const a=n.slider;return null==t||!t.hasTimeData||null!=t&&t.inputParseFunction||null!=t&&t.inputFormatFunction||a.set({labelInputsEnabled:!1,rangeLabelInputsEnabled:!1}),n.own(a.on("max-change",(o=>n.emit("max-change",o))),a.on("min-change",(o=>n.emit("min-change",o))),a.on("thumb-change",(o=>n.emit("thumb-change",o))),a.on("thumb-drag",(o=>n.emit("thumb-drag",o))),g.watch(e._assertThisInitialized(n),["histogramConfig","max","min","zoomOptions"],(()=>{const{histogram:o,histogramConfig:t,viewModel:{max:i,min:a}}=e._assertThisInitialized(n),s=n.getParamsFromHistogramConfig(t);o.set({...s,max:i,min:a})})),g.watch(e._assertThisInitialized(n),"labelFormatFunction",(()=>{const{histogram:o,labelFormatFunction:t}=e._assertThisInitialized(n);o.set({labelFormatFunction:t})})),g.watch(e._assertThisInitialized(n),"hasTimeData",(o=>{const e=!o||n.inputFormatFunction&&n.inputParseFunction;a.set({labelInputsEnabled:e,rangeLabelInputsEnabled:e})}))),n._onMaxZoomCapPointerDown=n._onMaxZoomCapPointerDown.bind(e._assertThisInitialized(n)),n._onMinZoomCapPointerDown=n._onMinZoomCapPointerDown.bind(e._assertThisInitialized(n)),n}e._inheritsLoose(t,o);var i=t.prototype;return i.initialize=function(){const{histogramConfig:o={},viewModel:e}=this,{labelFormatFunction:t,max:i,min:n}=e,a=this.getParamsFromHistogramConfig(o);this.own(g.watch(e,"max",(()=>this.notifyChange("max"))),g.watch(e,"min",(()=>this.notifyChange("min")))),this.histogram.set({labelFormatFunction:t,...a,max:i,min:n}),this.slider.set({viewModel:e})},i.renderContent=function(o,e,t){return this.slider.extraNodes=[o,this.renderHistogram(t)],M.jsx("div",{class:e},this.slider.render())},i.renderHistogram=function(o){return this.histogramConfig?M.jsx("div",{class:o||null},this.histogram.render()):null},i.renderBackgroundFillDefinition=function(o){return M.jsx("pattern",{id:o,patternUnits:"userSpaceOnUse",x:"0",y:"0",width:"15",height:"15"},M.jsx("image",{x:"0",y:"0",width:"15",height:"15",href:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgaGVpZ2h0PSIxNiIgd2lkdGg9IjE2Ij48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNjY2MiIC8+PHBhdGggZD0iTTAgMCBMOCAwIEw4IDggTDAgOCBaIiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDgpIiAvPjxwYXRoIGQ9Ik0wIDAgTDggMCBMOCA4IEwwIDggWiIgZmlsbD0iI2NjYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCw4KSIgLz48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgsMCkiIC8+PC9zdmc+"}))},i.renderRampFillDefinition=function(o,e){return M.jsx("linearGradient",{id:o,x1:"0",x2:"0",y1:"0",y2:"1"},this.renderRampFillStops(e))},i.renderRampFillStops=function(o){return o.reverse().map(((o,e)=>this.renderStop(o,e)))},i.renderStop=function(o,e){const{color:t,offset:i,opacity:n}=this.getPropsForStop(o);return M.jsx("stop",{key:`${e}-stop`,offset:i,"stop-color":t,"stop-opacity":n})},i.renderZoomCaps=function(){return[this.renderMaxZoomCap(),this.renderMinZoomCap()]},i.renderMinZoomCap=function(){if(this.zoomOptions&&n.isSome(this.zoomOptions.min))return M.jsx("svg",{key:"bottom",class:this.classes(v.zoomCap,v.minZoomCap),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMinZoomCapPointerDown},M.jsx("polygon",{class:v.zoomCapMask,key:"mask",fill:"#1B8617",points:"0 11.3846154 30 11.3846154 30 1 25 5.38461538 20 1 15 5.38461538 10 1 5 5.38461538 0 1"}),M.jsx("polygon",{class:v.zoomCapUnderline,key:"underline",fill:"#69DCFF",points:"0 0 5 4.38461538 10 0 15 4.38461538 20 0 25 4.38461538 30 0 30 4.61538462 25 9 20 4.61538462 15 9 10 4.61538462 5 9 0 4.61538462"}),M.jsx("polygon",{class:v.zoomCapLine,key:"line",fill:"#DA5656",points:"0 1 5 5.38461538 10 1 15 5.38461538 20 1 25 5.38461538 30 1 30 5.61538462 25 10 20 5.61538462 15 10 10 5.61538462 5 10 0 5.61538462"}))},i.renderMaxZoomCap=function(){if(this.zoomOptions&&n.isSome(this.zoomOptions.max))return M.jsx("svg",{key:"top",class:this.classes(v.zoomCap,v.maxZoomCap),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMaxZoomCapPointerDown},M.jsx("polygon",{class:v.zoomCapMask,key:"mask",points:"0 -1.81994377e-12 30 -1.81994377e-12 30 8.23076923 25 3.61538462 20 8.23076923 15 3.61538462 10 8.23076923 5 3.61538462 0 8.23076923"}),M.jsx("polygon",{class:v.zoomCapUnderline,key:"underline",points:"0 5.61538462 5 1 10 5.61538462 15 1 20 5.61538462 25 1 30 5.61538462 30 10.2307692 25 5.61538462 20 10.2307692 15 5.61538462 10 10.2307692 5 5.61538462 0 10.2307692"}),M.jsx("polygon",{class:v.zoomCapLine,key:"line",points:"0 4.61538462 5 -1.87329639e-12 10 4.61538462 15 -1.87329639e-12 20 4.61538462 25 -1.87329639e-12 30 4.61538462 30 9.23076923 25 4.61538462 20 9.23076923 15 4.61538462 10 9.23076923 5 4.61538462 0 9.23076923"}))},i.getPropsForStop=function(o){const{color:e,offset:t}=o;return{color:e instanceof u?e.toCss(!0):u.fromString(e).toCss(!0),offset:(100*t).toFixed(2)+"%",opacity:e instanceof u?e.toRgba()[3]:null}},i.getParamsFromHistogramConfig=function(o){if(!o)return null;const{average:e,barCreatedFunction:t,bins:i,dataLineCreatedFunction:n,dataLineUpdatedFunction:a}=o;return{average:e,barCreatedFunction:t,bins:i,dataLineCreatedFunction:n,dataLineUpdatedFunction:a,dataLines:this._getDataLines(o)}},i._onMaxZoomCapPointerDown=function(){const{zoomOptions:o}=this;if(o&&n.isSome(o.max)){const{min:e}=o;this.zoomOptions=n.isSome(e)?{min:e}:null}},i._onMinZoomCapPointerDown=function(){const{zoomOptions:o}=this;if(o&&n.isSome(o.min)){const{max:e}=o;this.zoomOptions=n.isSome(e)?{max:e}:null}},i._getDataLines=function(o){const{average:e,standardDeviation:t,standardDeviationCount:i}=o;return[...this._getStandardDeviationDataLines(t,e,i||1),...o.dataLines||[]]},i._getStandardDeviationDataLines=function(o,e,t){return S.getDeviationValues(o,e,t).map((o=>({value:o})))},e._createClass(t,[{key:"max",get:function(){return this.viewModel?this.viewModel.getUnzoomedMax():null},set:function(o){this.viewModel.max=o,this._set("max",o)}},{key:"min",get:function(){return this.viewModel?this.viewModel.getUnzoomedMin():null},set:function(o){this.viewModel.min=o,this._set("min",o)}}]),t}(C),t.__decorate([l.aliasOf("viewModel.hasTimeData")],o.SmartMappingSliderBase.prototype,"hasTimeData",void 0),t.__decorate([r.property()],o.SmartMappingSliderBase.prototype,"histogram",void 0),t.__decorate([r.property()],o.SmartMappingSliderBase.prototype,"histogramConfig",void 0),t.__decorate([l.aliasOf("viewModel.inputFormatFunction")],o.SmartMappingSliderBase.prototype,"inputFormatFunction",void 0),t.__decorate([l.aliasOf("viewModel.inputParseFunction")],o.SmartMappingSliderBase.prototype,"inputParseFunction",void 0),t.__decorate([l.aliasOf("viewModel.labelFormatFunction")],o.SmartMappingSliderBase.prototype,"labelFormatFunction",void 0),t.__decorate([r.property()],o.SmartMappingSliderBase.prototype,"max",null),t.__decorate([r.property()],o.SmartMappingSliderBase.prototype,"min",null),t.__decorate([l.aliasOf("viewModel.precision")],o.SmartMappingSliderBase.prototype,"precision",void 0),t.__decorate([r.property()],o.SmartMappingSliderBase.prototype,"slider",void 0),t.__decorate([l.aliasOf("viewModel.state")],o.SmartMappingSliderBase.prototype,"state",void 0),t.__decorate([l.aliasOf("viewModel.values")],o.SmartMappingSliderBase.prototype,"values",void 0),t.__decorate([r.property()],o.SmartMappingSliderBase.prototype,"viewModel",void 0),t.__decorate([l.aliasOf("viewModel.zoomOptions")],o.SmartMappingSliderBase.prototype,"zoomOptions",void 0),o.SmartMappingSliderBase=t.__decorate([p.subclass("esri.widgets.smartMapping.SmartMappingSliderBase")],o.SmartMappingSliderBase),Object.defineProperty(o,"__esModule",{value:!0})}));
