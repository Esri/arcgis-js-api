// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../../Color","../../core/maybe","../../core/watchUtils","../../core/accessorSupport/decorators","../Histogram","../Slider","../Widget","./support/utils","../support/widget"],(function(o,t,e,i,n,a,r,s,p,l,m,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmartMappingSliderBase=void 0;var c="zoom-cap",u="zoom-cap--max",g="zoom-cap--min",h="zoom-cap--line",v="zoom-cap--mask",f="zoom-cap--underline",y=function(o){function t(t,i){var n=o.call(this,t,i)||this;n.hasTimeData=null,n.histogram=new s({layout:"vertical"}),n.histogramConfig=null,n.inputFormatFunction=null,n.inputParseFunction=null,n.labelFormatFunction=null,n.precision=4,n.slider=new p({layout:"vertical",visibleElements:{labels:!0,rangeLabels:!0},labelInputsEnabled:!0,rangeLabelInputsEnabled:!0}),n.state=null,n.viewModel=null,n.zoomOptions=null;var r=n.slider;return n.own(r.on("max-change",(function(o){return n.emit("max-change",o)})),r.on("min-change",(function(o){return n.emit("min-change",o)})),r.on("thumb-change",(function(o){return n.emit("thumb-change",o)})),r.on("thumb-drag",(function(o){return n.emit("thumb-drag",o)})),a.watch(n,["histogramConfig","max","min","zoomOptions"],(function(){var o=n,t=o.histogram,i=o.histogramConfig,a=o.viewModel,r=a.max,s=a.min,p=n.getParamsFromHistogramConfig(i);t.set(e.__assign(e.__assign({},p),{max:r,min:s}))})),a.watch(n,"labelFormatFunction",(function(){var o=n,t=o.histogram,e=o.labelFormatFunction;t.set({labelFormatFunction:e})}))),n._onMaxZoomCapPointerDown=n._onMaxZoomCapPointerDown.bind(n),n._onMinZoomCapPointerDown=n._onMinZoomCapPointerDown.bind(n),n}return e.__extends(t,o),t.prototype.initialize=function(){var o=this,t=this.histogramConfig,i=void 0===t?{}:t,n=this.viewModel,r=n.labelFormatFunction,s=n.max,p=n.min,l=this.getParamsFromHistogramConfig(i);this.own(a.watch(n,"max",(function(){return o.notifyChange("max")})),a.watch(n,"min",(function(){return o.notifyChange("min")}))),this.histogram.set(e.__assign(e.__assign({labelFormatFunction:r},l),{max:s,min:p})),this.slider.set({viewModel:n})},Object.defineProperty(t.prototype,"max",{get:function(){return this.viewModel?this.viewModel.getUnzoomedMax():null},set:function(o){this.viewModel.max=o,this._set("max",o)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"min",{get:function(){return this.viewModel?this.viewModel.getUnzoomedMin():null},set:function(o){this.viewModel.min=o,this._set("min",o)},enumerable:!1,configurable:!0}),t.prototype.renderContent=function(o,t,e){return this.slider.extraNodes=[o,this.renderHistogram(e)],d.tsx("div",{class:t},this.slider.render())},t.prototype.renderHistogram=function(o){return this.histogramConfig?d.tsx("div",{class:o||null},this.histogram.render()):null},t.prototype.renderBackgroundFillDefinition=function(o){return d.tsx("pattern",{id:o,patternUnits:"userSpaceOnUse",x:"0",y:"0",width:"15",height:"15"},d.tsx("image",{x:"0",y:"0",width:"15",height:"15",href:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgaGVpZ2h0PSIxNiIgd2lkdGg9IjE2Ij48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNjY2MiIC8+PHBhdGggZD0iTTAgMCBMOCAwIEw4IDggTDAgOCBaIiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDgpIiAvPjxwYXRoIGQ9Ik0wIDAgTDggMCBMOCA4IEwwIDggWiIgZmlsbD0iI2NjYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCw4KSIgLz48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgsMCkiIC8+PC9zdmc+"}))},t.prototype.renderRampFillDefinition=function(o,t){return d.tsx("linearGradient",{id:o,x1:"0",x2:"0",y1:"0",y2:"1"},this.renderRampFillStops(t))},t.prototype.renderRampFillStops=function(o){var t=this;return o.reverse().map((function(o,e){return t.renderStop(o,e)}))},t.prototype.renderStop=function(o,t){var e=this.getPropsForStop(o),i=e.color,n=e.offset,a=e.opacity;return d.tsx("stop",{key:t+"-stop",offset:n,"stop-color":i,"stop-opacity":a})},t.prototype.renderZoomCaps=function(){return[this.renderMaxZoomCap(),this.renderMinZoomCap()]},t.prototype.renderMinZoomCap=function(){if(this.zoomOptions&&n.isSome(this.zoomOptions.min))return d.tsx("svg",{key:"bottom",class:this.classes(c,g),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMinZoomCapPointerDown},d.tsx("polygon",{class:v,key:"mask",fill:"#1B8617",points:"0 11.3846154 30 11.3846154 30 1 25 5.38461538 20 1 15 5.38461538 10 1 5 5.38461538 0 1"}),d.tsx("polygon",{class:f,key:"underline",fill:"#69DCFF",points:"0 0 5 4.38461538 10 0 15 4.38461538 20 0 25 4.38461538 30 0 30 4.61538462 25 9 20 4.61538462 15 9 10 4.61538462 5 9 0 4.61538462"}),d.tsx("polygon",{class:h,key:"line",fill:"#DA5656",points:"0 1 5 5.38461538 10 1 15 5.38461538 20 1 25 5.38461538 30 1 30 5.61538462 25 10 20 5.61538462 15 10 10 5.61538462 5 10 0 5.61538462"}))},t.prototype.renderMaxZoomCap=function(){if(this.zoomOptions&&n.isSome(this.zoomOptions.max))return d.tsx("svg",{key:"top",class:this.classes(c,u),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMaxZoomCapPointerDown},d.tsx("polygon",{class:v,key:"mask",points:"0 -1.81994377e-12 30 -1.81994377e-12 30 8.23076923 25 3.61538462 20 8.23076923 15 3.61538462 10 8.23076923 5 3.61538462 0 8.23076923"}),d.tsx("polygon",{class:f,key:"underline",points:"0 5.61538462 5 1 10 5.61538462 15 1 20 5.61538462 25 1 30 5.61538462 30 10.2307692 25 5.61538462 20 10.2307692 15 5.61538462 10 10.2307692 5 5.61538462 0 10.2307692"}),d.tsx("polygon",{class:h,key:"line",points:"0 4.61538462 5 -1.87329639e-12 10 4.61538462 15 -1.87329639e-12 20 4.61538462 25 -1.87329639e-12 30 4.61538462 30 9.23076923 25 4.61538462 20 9.23076923 15 4.61538462 10 9.23076923 5 4.61538462 0 9.23076923"}))},t.prototype.getPropsForStop=function(o){var t=o.color,e=o.offset;return{color:t instanceof i?t.toCss(!0):i.fromString(t).toCss(!0),offset:(100*e).toFixed(2)+"%",opacity:t instanceof i?t.toRgba()[3]:null}},t.prototype.getParamsFromHistogramConfig=function(o){return o?{average:o.average,barCreatedFunction:o.barCreatedFunction,bins:o.bins,dataLineCreatedFunction:o.dataLineCreatedFunction,dataLines:this._getDataLines(o)}:null},t.prototype._onMaxZoomCapPointerDown=function(){var o=this.zoomOptions;if(o&&n.isSome(o.max)){var t=o.min;this.zoomOptions=n.isSome(t)?{min:t}:null}},t.prototype._onMinZoomCapPointerDown=function(){var o=this.zoomOptions;if(o&&n.isSome(o.min)){var t=o.max;this.zoomOptions=n.isSome(t)?{max:t}:null}},t.prototype._getDataLines=function(o){var t=o.average,i=o.standardDeviation,n=o.standardDeviationCount;return e.__spreadArrays(this._getStandardDeviationDataLines(i,t,n||1),o.dataLines||[])},t.prototype._getStandardDeviationDataLines=function(o,t,e){return m.getDeviationValues(o,t,e).map((function(o){return{value:o}}))},e.__decorate([r.aliasOf("viewModel.hasTimeData")],t.prototype,"hasTimeData",void 0),e.__decorate([r.property()],t.prototype,"histogram",void 0),e.__decorate([r.property()],t.prototype,"histogramConfig",void 0),e.__decorate([r.aliasOf("viewModel.inputFormatFunction")],t.prototype,"inputFormatFunction",void 0),e.__decorate([r.aliasOf("viewModel.inputParseFunction")],t.prototype,"inputParseFunction",void 0),e.__decorate([r.aliasOf("viewModel.labelFormatFunction")],t.prototype,"labelFormatFunction",void 0),e.__decorate([r.property({dependsOn:["viewModel.max","viewModel.zoomOptions"]})],t.prototype,"max",null),e.__decorate([r.property({dependsOn:["viewModel.min","viewModel.zoomOptions"]})],t.prototype,"min",null),e.__decorate([r.aliasOf("viewModel.precision")],t.prototype,"precision",void 0),e.__decorate([r.property()],t.prototype,"slider",void 0),e.__decorate([r.aliasOf("viewModel.state")],t.prototype,"state",void 0),e.__decorate([r.aliasOf("viewModel.values")],t.prototype,"values",void 0),e.__decorate([r.property()],t.prototype,"viewModel",void 0),e.__decorate([r.aliasOf("viewModel.zoomOptions")],t.prototype,"zoomOptions",void 0),t=e.__decorate([r.subclass("esri.widgets.smartMapping.SmartMappingSliderBase")],t)}(l);t.SmartMappingSliderBase=y}));