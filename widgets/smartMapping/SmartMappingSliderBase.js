/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../Color","../../core/maybe","../../core/watchUtils","../../core/accessorSupport/decorators/aliasOf","../../core/has","../../core/accessorSupport/decorators/cast","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../Histogram","../Slider","../Widget","./support/utils","../support/widgetUtils","../support/jsxFactory"],(function(e,t,i,o,n,a,s,r,l,m,p,c,d,u,g,h,b,M){"use strict";const S={zoomCap:"zoom-cap",maxZoomCap:"zoom-cap--max",minZoomCap:"zoom-cap--min",zoomCapLine:"zoom-cap--line",zoomCapMask:"zoom-cap--mask",zoomCapUnderline:"zoom-cap--underline"},v={interactiveTrack:!1};e.SmartMappingSliderBase=function(e){function i(i,o){var n,s;(s=e.call(this,i,o)||this).hasTimeData=null,s.histogram=new d({layout:"vertical"}),s.histogramConfig=null,s.inputFormatFunction=null,s.inputParseFunction=null,s.labelFormatFunction=null,s.precision=4,s.slider=new u({syncedSegmentsEnabled:!0,thumbsConstrained:!1,layout:"vertical",visibleElements:{labels:!0,rangeLabels:!0},labelInputsEnabled:!0,rangeLabelInputsEnabled:!0}),s.state=null,s.syncedSegmentsEnabled=!1,s.viewModel=null,s.visibleElements={...v},s.zoomOptions=null;const r=s.slider;return null==i||!i.hasTimeData||null!=i&&i.inputParseFunction||null!=i&&i.inputFormatFunction||r.set({labelInputsEnabled:!1,rangeLabelInputsEnabled:!1}),r.draggableSegmentsEnabled=!(null==i||null==(n=i.visibleElements)||!n.interactiveTrack),s.own(r.on("max-change",(e=>s.emit("max-change",e))),r.on("max-click",(e=>s.emit("max-click",e))),r.on("min-change",(e=>s.emit("min-change",e))),r.on("min-click",(e=>s.emit("min-click",e))),r.on("segment-click",(e=>s.emit("segment-click",e))),r.on("segment-drag",(e=>s.emit("segment-drag",e))),r.on("thumb-change",(e=>s.emit("thumb-change",e))),r.on("thumb-click",(e=>s.emit("thumb-click",e))),r.on("thumb-drag",(e=>s.emit("thumb-drag",e))),r.on("track-click",(e=>s.emit("track-click",e))),a.watch(t._assertThisInitialized(s),["histogramConfig","max","min","zoomOptions"],(()=>{const{histogram:e,histogramConfig:i,viewModel:{max:o,min:n}}=t._assertThisInitialized(s),a=s.getParamsFromHistogramConfig(i);e.set({...a,max:o,min:n})})),a.watch(t._assertThisInitialized(s),"labelFormatFunction",(()=>{const{histogram:e,labelFormatFunction:i}=t._assertThisInitialized(s);e.set({labelFormatFunction:i})})),a.watch(t._assertThisInitialized(s),"hasTimeData",(e=>{const{labelInputsEnabled:t,rangeLabelInputsEnabled:i}=s.slider,o=!e||s.inputFormatFunction&&s.inputParseFunction;r.set({labelInputsEnabled:t&&o,rangeLabelInputsEnabled:i&&o})})),a.watch(t._assertThisInitialized(s),"visibleElements.interactiveTrack",(e=>{r.draggableSegmentsEnabled=!!e}))),s._onMaxZoomCapPointerDown=s._onMaxZoomCapPointerDown.bind(t._assertThisInitialized(s)),s._onMinZoomCapPointerDown=s._onMinZoomCapPointerDown.bind(t._assertThisInitialized(s)),s}t._inheritsLoose(i,e);var s=i.prototype;return s.initialize=function(){const{histogramConfig:e={},viewModel:t}=this,{labelFormatFunction:i,max:o,min:n}=t,s=this.getParamsFromHistogramConfig(e);this.own(a.watch(t,"max",(()=>this.notifyChange("max"))),a.watch(t,"min",(()=>this.notifyChange("min")))),this.histogram.set({labelFormatFunction:i,...s,max:o,min:n}),this.slider.set({viewModel:t})},s.castVisibleElements=function(e){return{...v,...e}},s.renderContent=function(e,t,i){return this.slider.extraNodes=[e,this.renderHistogram(i)],M.tsx("div",{class:t},this.slider.render())},s.renderHistogram=function(e){return this.histogramConfig?M.tsx("div",{key:"histogram",class:e||null},this.histogram.render()):null},s.renderBackgroundFillDefinition=function(e){return M.tsx("pattern",{id:e,patternUnits:"userSpaceOnUse",x:"0",y:"0",width:"15",height:"15"},M.tsx("image",{x:"0",y:"0",width:"15",height:"15",href:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgaGVpZ2h0PSIxNiIgd2lkdGg9IjE2Ij48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNjY2MiIC8+PHBhdGggZD0iTTAgMCBMOCAwIEw4IDggTDAgOCBaIiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDgpIiAvPjxwYXRoIGQ9Ik0wIDAgTDggMCBMOCA4IEwwIDggWiIgZmlsbD0iI2NjYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCw4KSIgLz48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgsMCkiIC8+PC9zdmc+"}))},s.renderRampFillDefinition=function(e,t){return M.tsx("linearGradient",{id:e,x1:"0",x2:"0",y1:"0",y2:"1"},this.renderRampFillStops(t))},s.renderRampFillStops=function(e){return e.reverse().map(((e,t)=>this.renderStop(e,t)))},s.renderStop=function(e,t){const{color:i,offset:o,opacity:n}=this.getPropsForStop(e);return M.tsx("stop",{key:`${t}-stop`,offset:o,"stop-color":i,"stop-opacity":n})},s.renderZoomCaps=function(){return[this.renderMaxZoomCap(),this.renderMinZoomCap()]},s.renderMinZoomCap=function(){if(this.zoomOptions&&n.isSome(this.zoomOptions.min))return M.tsx("svg",{key:"bottom",class:this.classes(S.zoomCap,S.minZoomCap),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMinZoomCapPointerDown},M.tsx("polygon",{class:S.zoomCapMask,key:"mask",fill:"#1B8617",points:"0 11.3846154 30 11.3846154 30 1 25 5.38461538 20 1 15 5.38461538 10 1 5 5.38461538 0 1"}),M.tsx("polygon",{class:S.zoomCapUnderline,key:"underline",fill:"#69DCFF",points:"0 0 5 4.38461538 10 0 15 4.38461538 20 0 25 4.38461538 30 0 30 4.61538462 25 9 20 4.61538462 15 9 10 4.61538462 5 9 0 4.61538462"}),M.tsx("polygon",{class:S.zoomCapLine,key:"line",fill:"#DA5656",points:"0 1 5 5.38461538 10 1 15 5.38461538 20 1 25 5.38461538 30 1 30 5.61538462 25 10 20 5.61538462 15 10 10 5.61538462 5 10 0 5.61538462"}))},s.renderMaxZoomCap=function(){if(this.zoomOptions&&n.isSome(this.zoomOptions.max))return M.tsx("svg",{key:"top",class:this.classes(S.zoomCap,S.maxZoomCap),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMaxZoomCapPointerDown},M.tsx("polygon",{class:S.zoomCapMask,key:"mask",points:"0 -1.81994377e-12 30 -1.81994377e-12 30 8.23076923 25 3.61538462 20 8.23076923 15 3.61538462 10 8.23076923 5 3.61538462 0 8.23076923"}),M.tsx("polygon",{class:S.zoomCapUnderline,key:"underline",points:"0 5.61538462 5 1 10 5.61538462 15 1 20 5.61538462 25 1 30 5.61538462 30 10.2307692 25 5.61538462 20 10.2307692 15 5.61538462 10 10.2307692 5 5.61538462 0 10.2307692"}),M.tsx("polygon",{class:S.zoomCapLine,key:"line",points:"0 4.61538462 5 -1.87329639e-12 10 4.61538462 15 -1.87329639e-12 20 4.61538462 25 -1.87329639e-12 30 4.61538462 30 9.23076923 25 4.61538462 20 9.23076923 15 4.61538462 10 9.23076923 5 4.61538462 0 9.23076923"}))},s.getPropsForStop=function(e){const{color:t,offset:i}=e;return{color:t instanceof o?t.toCss(!0):o.fromString(t).toCss(!0),offset:(100*i).toFixed(2)+"%",opacity:t instanceof o?t.toRgba()[3]:null}},s.getParamsFromHistogramConfig=function(e){if(!e)return null;const{average:t,barCreatedFunction:i,bins:o,dataLineCreatedFunction:n,dataLineUpdatedFunction:a}=e;return{average:t,barCreatedFunction:i,bins:o,dataLineCreatedFunction:n,dataLineUpdatedFunction:a,dataLines:this._getDataLines(e)}},s._onMaxZoomCapPointerDown=function(){const{zoomOptions:e}=this;if(e&&n.isSome(e.max)){const{min:t}=e;this.zoomOptions=n.isSome(t)?{min:t}:null}},s._onMinZoomCapPointerDown=function(){const{zoomOptions:e}=this;if(e&&n.isSome(e.min)){const{max:t}=e;this.zoomOptions=n.isSome(t)?{max:t}:null}},s._getDataLines=function(e){const{average:t,standardDeviation:i,standardDeviationCount:o}=e,{max:n,min:a}=this;return[...this._getStandardDeviationDataLines(i,t,o||1),...e.dataLines||[]].filter((({value:e})=>e<=n&&e>=a))},s._getStandardDeviationDataLines=function(e,t,i){const{max:o,min:n}=this.viewModel,a=.06*(o-n);return h.getDeviationValues(e,t,i).filter((e=>Math.abs(t-e)>a)).map(((e,i,o)=>{const n=this.labelFormatFunction?this.labelFormatFunction(e):e,a=o.length/2,s=i>=a?i-a+1:a-i;return{value:e,label:`${e>t?"+":"-"}${1===s?"":s}Ïƒ ${n}`}}))},t._createClass(i,[{key:"max",get:function(){return this.viewModel?this.viewModel.getUnzoomedMax():null},set:function(e){this.viewModel.max=e,this._set("max",e)}},{key:"min",get:function(){return this.viewModel?this.viewModel.getUnzoomedMin():null},set:function(e){this.viewModel.min=e,this._set("min",e)}}]),i}(g),i.__decorate([s.aliasOf("viewModel.hasTimeData")],e.SmartMappingSliderBase.prototype,"hasTimeData",void 0),i.__decorate([p.property()],e.SmartMappingSliderBase.prototype,"histogram",void 0),i.__decorate([p.property()],e.SmartMappingSliderBase.prototype,"histogramConfig",void 0),i.__decorate([s.aliasOf("viewModel.inputFormatFunction")],e.SmartMappingSliderBase.prototype,"inputFormatFunction",void 0),i.__decorate([s.aliasOf("viewModel.inputParseFunction")],e.SmartMappingSliderBase.prototype,"inputParseFunction",void 0),i.__decorate([s.aliasOf("viewModel.labelFormatFunction")],e.SmartMappingSliderBase.prototype,"labelFormatFunction",void 0),i.__decorate([p.property()],e.SmartMappingSliderBase.prototype,"max",null),i.__decorate([p.property()],e.SmartMappingSliderBase.prototype,"min",null),i.__decorate([s.aliasOf("viewModel.precision")],e.SmartMappingSliderBase.prototype,"precision",void 0),i.__decorate([p.property()],e.SmartMappingSliderBase.prototype,"slider",void 0),i.__decorate([s.aliasOf("viewModel.state")],e.SmartMappingSliderBase.prototype,"state",void 0),i.__decorate([s.aliasOf("slider.syncedSegmentsEnabled")],e.SmartMappingSliderBase.prototype,"syncedSegmentsEnabled",void 0),i.__decorate([s.aliasOf("viewModel.values")],e.SmartMappingSliderBase.prototype,"values",void 0),i.__decorate([p.property()],e.SmartMappingSliderBase.prototype,"viewModel",void 0),i.__decorate([p.property()],e.SmartMappingSliderBase.prototype,"visibleElements",void 0),i.__decorate([l.cast("visibleElements")],e.SmartMappingSliderBase.prototype,"castVisibleElements",null),i.__decorate([s.aliasOf("viewModel.zoomOptions")],e.SmartMappingSliderBase.prototype,"zoomOptions",void 0),e.SmartMappingSliderBase=i.__decorate([c.subclass("esri.widgets.smartMapping.SmartMappingSliderBase")],e.SmartMappingSliderBase),Object.defineProperty(e,"__esModule",{value:!0})}));
