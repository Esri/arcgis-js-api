/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/aliasOf","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../Color","../../core/watchUtils","../support/widgetUtils","../../chunks/index","../Widget","../Slider","../Histogram","./support/utils"],(function(e,o,i,t,n,a,s,r,l,p,m,d,c,u,g,h,M,w,f,v,S){"use strict";const y="zoom-cap",x="zoom-cap--max",_="zoom-cap--min",C="zoom-cap--line",F="zoom-cap--mask",b="zoom-cap--underline";e.SmartMappingSliderBase=function(e){function i(i,t){var n;(n=e.call(this,i,t)||this).hasTimeData=null,n.histogram=new v({layout:"vertical"}),n.histogramConfig=null,n.inputFormatFunction=null,n.inputParseFunction=null,n.labelFormatFunction=null,n.precision=4,n.slider=new f({layout:"vertical",visibleElements:{labels:!0,rangeLabels:!0},labelInputsEnabled:!0,rangeLabelInputsEnabled:!0}),n.state=null,n.viewModel=null,n.zoomOptions=null;const a=n.slider;return n.own(a.on("max-change",(e=>n.emit("max-change",e))),a.on("min-change",(e=>n.emit("min-change",e))),a.on("thumb-change",(e=>n.emit("thumb-change",e))),a.on("thumb-drag",(e=>n.emit("thumb-drag",e))),g.watch(o._assertThisInitialized(n),["histogramConfig","max","min","zoomOptions"],(()=>{const{histogram:e,histogramConfig:i,viewModel:{max:t,min:a}}=o._assertThisInitialized(n),s=n.getParamsFromHistogramConfig(i);e.set({...s,max:t,min:a})})),g.watch(o._assertThisInitialized(n),"labelFormatFunction",(()=>{const{histogram:e,labelFormatFunction:i}=o._assertThisInitialized(n);e.set({labelFormatFunction:i})}))),n._onMaxZoomCapPointerDown=n._onMaxZoomCapPointerDown.bind(o._assertThisInitialized(n)),n._onMinZoomCapPointerDown=n._onMinZoomCapPointerDown.bind(o._assertThisInitialized(n)),n}o._inheritsLoose(i,e);var t=i.prototype;return t.initialize=function(){const{histogramConfig:e={},viewModel:o}=this,{labelFormatFunction:i,max:t,min:n}=o,a=this.getParamsFromHistogramConfig(e);this.own(g.watch(o,"max",(()=>this.notifyChange("max"))),g.watch(o,"min",(()=>this.notifyChange("min")))),this.histogram.set({labelFormatFunction:i,...a,max:t,min:n}),this.slider.set({viewModel:o})},t.renderContent=function(e,o,i){return this.slider.extraNodes=[e,this.renderHistogram(i)],M.jsx("div",{class:o},this.slider.render())},t.renderHistogram=function(e){return this.histogramConfig?M.jsx("div",{class:e||null},this.histogram.render()):null},t.renderBackgroundFillDefinition=function(e){return M.jsx("pattern",{id:e,patternUnits:"userSpaceOnUse",x:"0",y:"0",width:"15",height:"15"},M.jsx("image",{x:"0",y:"0",width:"15",height:"15",href:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgaGVpZ2h0PSIxNiIgd2lkdGg9IjE2Ij48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNjY2MiIC8+PHBhdGggZD0iTTAgMCBMOCAwIEw4IDggTDAgOCBaIiBmaWxsPSIjZmZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLDgpIiAvPjxwYXRoIGQ9Ik0wIDAgTDggMCBMOCA4IEwwIDggWiIgZmlsbD0iI2NjYyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOCw4KSIgLz48cGF0aCBkPSJNMCAwIEw4IDAgTDggOCBMMCA4IFoiIGZpbGw9IiNmZmYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgsMCkiIC8+PC9zdmc+"}))},t.renderRampFillDefinition=function(e,o){return M.jsx("linearGradient",{id:e,x1:"0",x2:"0",y1:"0",y2:"1"},this.renderRampFillStops(o))},t.renderRampFillStops=function(e){return e.reverse().map(((e,o)=>this.renderStop(e,o)))},t.renderStop=function(e,o){const{color:i,offset:t,opacity:n}=this.getPropsForStop(e);return M.jsx("stop",{key:`${o}-stop`,offset:t,"stop-color":i,"stop-opacity":n})},t.renderZoomCaps=function(){return[this.renderMaxZoomCap(),this.renderMinZoomCap()]},t.renderMinZoomCap=function(){if(this.zoomOptions&&n.isSome(this.zoomOptions.min))return M.jsx("svg",{key:"bottom",class:this.classes(y,_),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMinZoomCapPointerDown},M.jsx("polygon",{class:F,key:"mask",fill:"#1B8617",points:"0 11.3846154 30 11.3846154 30 1 25 5.38461538 20 1 15 5.38461538 10 1 5 5.38461538 0 1"}),M.jsx("polygon",{class:b,key:"underline",fill:"#69DCFF",points:"0 0 5 4.38461538 10 0 15 4.38461538 20 0 25 4.38461538 30 0 30 4.61538462 25 9 20 4.61538462 15 9 10 4.61538462 5 9 0 4.61538462"}),M.jsx("polygon",{class:C,key:"line",fill:"#DA5656",points:"0 1 5 5.38461538 10 1 15 5.38461538 20 1 25 5.38461538 30 1 30 5.61538462 25 10 20 5.61538462 15 10 10 5.61538462 5 10 0 5.61538462"}))},t.renderMaxZoomCap=function(){if(this.zoomOptions&&n.isSome(this.zoomOptions.max))return M.jsx("svg",{key:"top",class:this.classes(y,x),viewBox:"0 0 30 11",xmlns:"http://www.w3.org/2000/svg",onpointerdown:this._onMaxZoomCapPointerDown},M.jsx("polygon",{class:F,key:"mask",points:"0 -1.81994377e-12 30 -1.81994377e-12 30 8.23076923 25 3.61538462 20 8.23076923 15 3.61538462 10 8.23076923 5 3.61538462 0 8.23076923"}),M.jsx("polygon",{class:b,key:"underline",points:"0 5.61538462 5 1 10 5.61538462 15 1 20 5.61538462 25 1 30 5.61538462 30 10.2307692 25 5.61538462 20 10.2307692 15 5.61538462 10 10.2307692 5 5.61538462 0 10.2307692"}),M.jsx("polygon",{class:C,key:"line",points:"0 4.61538462 5 -1.87329639e-12 10 4.61538462 15 -1.87329639e-12 20 4.61538462 25 -1.87329639e-12 30 4.61538462 30 9.23076923 25 4.61538462 20 9.23076923 15 4.61538462 10 9.23076923 5 4.61538462 0 9.23076923"}))},t.getPropsForStop=function(e){const{color:o,offset:i}=e;return{color:o instanceof u?o.toCss(!0):u.fromString(o).toCss(!0),offset:(100*i).toFixed(2)+"%",opacity:o instanceof u?o.toRgba()[3]:null}},t.getParamsFromHistogramConfig=function(e){if(!e)return null;const{average:o,barCreatedFunction:i,bins:t,dataLineCreatedFunction:n,dataLineUpdatedFunction:a}=e;return{average:o,barCreatedFunction:i,bins:t,dataLineCreatedFunction:n,dataLineUpdatedFunction:a,dataLines:this._getDataLines(e)}},t._onMaxZoomCapPointerDown=function(){const{zoomOptions:e}=this;if(e&&n.isSome(e.max)){const{min:o}=e;this.zoomOptions=n.isSome(o)?{min:o}:null}},t._onMinZoomCapPointerDown=function(){const{zoomOptions:e}=this;if(e&&n.isSome(e.min)){const{max:o}=e;this.zoomOptions=n.isSome(o)?{max:o}:null}},t._getDataLines=function(e){const{average:o,standardDeviation:i,standardDeviationCount:t}=e;return[...this._getStandardDeviationDataLines(i,o,t||1),...e.dataLines||[]]},t._getStandardDeviationDataLines=function(e,o,i){return S.getDeviationValues(e,o,i).map((e=>({value:e})))},o._createClass(i,[{key:"max",get:function(){return this.viewModel?this.viewModel.getUnzoomedMax():null},set:function(e){this.viewModel.max=e,this._set("max",e)}},{key:"min",get:function(){return this.viewModel?this.viewModel.getUnzoomedMin():null},set:function(e){this.viewModel.min=e,this._set("min",e)}}]),i}(w),i.__decorate([l.aliasOf("viewModel.hasTimeData")],e.SmartMappingSliderBase.prototype,"hasTimeData",void 0),i.__decorate([r.property()],e.SmartMappingSliderBase.prototype,"histogram",void 0),i.__decorate([r.property()],e.SmartMappingSliderBase.prototype,"histogramConfig",void 0),i.__decorate([l.aliasOf("viewModel.inputFormatFunction")],e.SmartMappingSliderBase.prototype,"inputFormatFunction",void 0),i.__decorate([l.aliasOf("viewModel.inputParseFunction")],e.SmartMappingSliderBase.prototype,"inputParseFunction",void 0),i.__decorate([l.aliasOf("viewModel.labelFormatFunction")],e.SmartMappingSliderBase.prototype,"labelFormatFunction",void 0),i.__decorate([r.property({dependsOn:["viewModel.max","viewModel.zoomOptions"]})],e.SmartMappingSliderBase.prototype,"max",null),i.__decorate([r.property({dependsOn:["viewModel.min","viewModel.zoomOptions"]})],e.SmartMappingSliderBase.prototype,"min",null),i.__decorate([l.aliasOf("viewModel.precision")],e.SmartMappingSliderBase.prototype,"precision",void 0),i.__decorate([r.property()],e.SmartMappingSliderBase.prototype,"slider",void 0),i.__decorate([l.aliasOf("viewModel.state")],e.SmartMappingSliderBase.prototype,"state",void 0),i.__decorate([l.aliasOf("viewModel.values")],e.SmartMappingSliderBase.prototype,"values",void 0),i.__decorate([r.property()],e.SmartMappingSliderBase.prototype,"viewModel",void 0),i.__decorate([l.aliasOf("viewModel.zoomOptions")],e.SmartMappingSliderBase.prototype,"zoomOptions",void 0),e.SmartMappingSliderBase=i.__decorate([p.subclass("esri.widgets.smartMapping.SmartMappingSliderBase")],e.SmartMappingSliderBase),Object.defineProperty(e,"__esModule",{value:!0})}));
