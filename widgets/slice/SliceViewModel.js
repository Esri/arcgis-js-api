/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../analysis/Slice","../../core/Collection","../../core/Handles","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/watchUtils","../../core/accessorSupport/decorators/aliasOf","../../core/arrayUtils","../../core/has","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../views/3d/interactive/analysisTools/slice/SliceTool","../support/InteractiveToolViewModel"],(function(e,t,o,s,r,i,a,l,n,c,d,u,h,p,y,f,_){"use strict";const w=i.getLogger("esri.widgets.Slice.SliceViewModel"),S=new Set;let T=function(t){function i(s){var i;return(i=t.call(this,s)||this).analysisView=null,i.logger=w,i.supportedViewType="3d",i.unsupportedErrorMessage="SliceViewModel is only supported in 3D views.",i.handles=new r,i.analysis=new o,i.shape=null,i.tiltEnabled=!1,i.ready=!1,S.add(e._assertThisInitialized(i)),i}e._inheritsLoose(i,t);var c=i.prototype;return c.initialize=function(){this.handles.add(this.watch("shape",((e,t)=>{a.isNone(t)&&a.isSome(e)?a.isNone(this.tool)&&!this.creatingTool&&this.createTool():a.isSome(t)&&a.isNone(e)&&this.removeTool()}),!0)),this.handles.add(this.watch("tiltEnabled",(e=>this._updateToolOrRecreate((t=>t.tiltEnabled=e))),!0))},c.destroy=function(){S.delete(this),this.handles=a.destroyMaybe(this.handles)},c.start=function(){var t=e._asyncToGenerator((function*(){return this.removeTool(),this.ready||(yield n.whenTrueOnce(this,"ready")),S.forEach((e=>{e.view===this.view&&e!==this&&e.clear()})),this.createTool()}));function o(){return t.apply(this,arguments)}return o}(),c.clear=function(){this.removeTool(),this.shape=null,this.excludeGroundSurface=!1,this.excludedLayers=new s},c.removeSliceAndStart=function(){return this.removeTool(),this.shape=null,this.start()},c.enterExcludeLayerMode=function(){a.isSome(this.tool)&&this.tool.enterExcludeLayerMode()},c.exitExcludeLayerMode=function(){a.isSome(this.tool)&&this.tool.exitExcludeLayerMode()},c._updateToolOrRecreate=function(e){a.isSome(this.tool)?e(this.tool):this.creatingTool&&l.ignoreAbortErrors(this.createTool())},c.onConnectToAnalysisView=function(e){this.analysisView=e,this.ready=!0},c.onDisconnectFromAnalysisView=function(){this.ready=!1,this.analysisView=null},c.createToolParams=function(){return{toolConstructor:f,constructorArguments:()=>({tiltEnabled:this.tiltEnabled})}},e._createClass(i,[{key:"state",get:function(){return this.disabled||!this.ready?"disabled":a.isNone(this.tool)||"pending"===this.tool.toolState?"ready":this.tool.state}},{key:"excludedLayers",get:function(){return this.analysis.excludedLayers},set:function(e){this.analysis.excludedLayers=e}},{key:"excludeGroundSurface",get:function(){return this.analysis.excludeGroundSurface},set:function(e){this.analysis.excludeGroundSurface=e}}]),i}(_.InteractiveToolViewModel);t.__decorate([p.property()],T.prototype,"analysisView",void 0),t.__decorate([p.property()],T.prototype,"analysis",void 0),t.__decorate([p.property({readOnly:!0})],T.prototype,"state",null),t.__decorate([p.property({aliasOf:"analysis.shape"})],T.prototype,"shape",void 0),t.__decorate([p.property({aliasOf:"analysis.tiltEnabled"})],T.prototype,"tiltEnabled",void 0),t.__decorate([c.aliasOf("tool.layersMode")],T.prototype,"layersMode",void 0),t.__decorate([p.property()],T.prototype,"excludedLayers",null),t.__decorate([p.property({nonNullable:!0})],T.prototype,"excludeGroundSurface",null),t.__decorate([p.property()],T.prototype,"ready",void 0),T=t.__decorate([y.subclass("esri.widgets.slice.SliceViewModel")],T);return T}));
