/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/maybe","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/aliasOf","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/promiseUtils","../../core/Collection","../../core/collectionUtils","../../core/Handles","../support/InteractiveToolViewModel","../../views/3d/interactive/analysisTools/slice/SliceTool","../../views/3d/interactive/graphics/Slice"],(function(e,t,o,r,s,l,i,c,n,a,d,u,p,h,y,f,_,S,x){"use strict";const g=s.getLogger("esri.widgets.Slice.SliceViewModel"),v=new Set;let T=function(t){function o(o){var r;return(r=t.call(this,o)||this).supportedViewType="3d",r.handles=new f,r.model=new x.Slice,r.shape=null,v.add(e._assertThisInitialized(r)),r}e._inheritsLoose(o,t);var s=o.prototype;return s.initialize=function(){this.handles.add(this.watch("shape",((e,t)=>{r.isNone(t)&&r.isSome(e)?this.tool||this.creatingTool||this.createTool():r.isSome(t)&&r.isNone(e)&&this.removeTool()}),!0))},s.destroy=function(){v.delete(this),this.handles.destroy()},s.start=function(){return v.forEach((e=>{e.view===this.view&&e!==this&&e.clear()})),this.createTool()},s.clear=function(){this.removeTool(),this._set("excludeGroundSurface",!1),this._set("excludedLayers",new h)},s.removeSliceAndStart=function(){return this.removeTool(),this.shape=null,this.start()},s.enterExcludeLayerMode=function(){this.tool&&this.tool.enterExcludeLayerMode()},s.exitExcludeLayerMode=function(){this.tool&&this.tool.exitExcludeLayerMode()},s._updateToolOrRecreate=function(e){this.tool?e(this.tool):this.creatingTool&&p.ignoreAbortErrors(this.createTool())},s.createToolParams=function(){return{toolConstructor:S,constructorArguments:()=>({excludeGroundSurface:this.excludeGroundSurface,excludedLayers:this.excludedLayers,tiltEnabled:this.tiltEnabled,model:this.model})}},s.logUnsupportedError=function(){this.logError("Slice widget is not implemented for MapView")},s.logError=function(...e){g.error(...e)},e._createClass(o,[{key:"state",get:function(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"}},{key:"tiltEnabled",get:function(){var e,t,o;return null!=(e=null!=(t=null==(o=this.tool)?void 0:o.tiltEnabled)?t:this._get("tiltEnabled"))&&e},set:function(e){this._set("tiltEnabled",e),this._updateToolOrRecreate((t=>t.tiltEnabled=e))}},{key:"excludedLayers",get:function(){return this.tool?this.tool.excludedLayers:this._get("excludedLayers")||new h},set:function(e){this._set("excludedLayers",y.referenceSetter(e,this.excludedLayers)),this._updateToolOrRecreate((t=>t.excludedLayers=e))}},{key:"excludeGroundSurface",get:function(){return this.tool?this.tool.excludeGroundSurface:this._get("excludeGroundSurface")||!1},set:function(e){this._set("excludeGroundSurface",e),this._updateToolOrRecreate((t=>t.excludeGroundSurface=e))}}]),o}(_.InteractiveToolViewModel);return t.__decorate([i.property({readOnly:!0})],T.prototype,"state",null),t.__decorate([i.property()],T.prototype,"tool",void 0),t.__decorate([i.property()],T.prototype,"model",void 0),t.__decorate([i.property({aliasOf:"model.plane"})],T.prototype,"shape",void 0),t.__decorate([i.property({type:Boolean})],T.prototype,"tiltEnabled",null),t.__decorate([c.aliasOf("tool.layersMode")],T.prototype,"layersMode",void 0),t.__decorate([i.property({cast:y.castForReferenceSetter})],T.prototype,"excludedLayers",null),t.__decorate([i.property({nonNullable:!0})],T.prototype,"excludeGroundSurface",null),T=t.__decorate([n.subclass("esri.widgets.slice.SliceViewModel")],T),T}));
