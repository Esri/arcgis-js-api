/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Accessor","../../layers/support/CodedValueDomain","../../layers/support/domains","../../layers/support/fieldUtils","../../intl/substitute","../../intl"],(function(e,t,i,r,o,n,l,a,d,s,u,p,c,y,f,g){"use strict";const h={type:"number"},_={type:"number",intlOptions:{notation:"scientific"}},m={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"2-digit",hour:"numeric",minute:"numeric",second:"numeric"}};let v=function(t){function i(e){var i;return(i=t.call(this,e)||this).arcade=null,i.config=null,i.feature=null,i.field=null,i.layer=null,i.description=null,i.editorType=null,i.error=null,i.format=null,i.group=null,i.hint=null,i.messages=null,i.name=null,i}e._inheritsLoose(i,t);var r=i.prototype;return r._isDomainCompatible=function(e){const{field:t}=this;if("coded-value"===(null==e?void 0:e.type)){const i=typeof e.codedValues[0].code;if("string"===i&&y.isStringField(t)||"number"===i&&y.isNumericField(t))return!0}return!!("range"===(null==e?void 0:e.type)&&y.isNumericField(t)||y.isDateField(t))},r._validate=function(){const{domain:e,field:t,minLength:i,required:r,type:o,value:n}=this;return"text"===o&&i>-1&&"string"==typeof n&&n.length<i?"length-validation-error::too-short":e?null!==n||r?c.validateDomainValue(e,n):null:r&&null===n?y.TypeValidationError.INVALID_TYPE:y.validateFieldValue(t,n)},r._shownByDefault=function(){var e;const t=null==(e=this.field)?void 0:e.type;return"oid"!==t&&"global-id"!==t&&!this._isGeometryField()},r._isEditorField=function(){return y.getFeatureEditFields(this.layer).indexOf(this.name)>-1},r._isGeometryField=function(){return y.getFeatureGeometryFields(this.layer).indexOf(this.name)>-1},r._toErrorMessage=function(){const{domain:e,field:t,messages:i,minLength:r,value:o,required:n,type:l}=this,a=this.error;if(n&&null===o)return i.validationErrors.cannotBeNull;if(a===c.DomainValidationError.VALUE_OUT_OF_RANGE||a===y.NumericRangeValidationError.OUT_OF_RANGE){const r=c.getDomainRange(e)||y.getFieldRange(t);return f.substitute(i.validationErrors.outsideRange,r,{format:{max:"date"===l?m:r.isInteger?h:_,min:"date"===l?m:r.isInteger?h:_}})}return a===c.DomainValidationError.INVALID_CODED_VALUE?i.validationErrors.invalidCodedValue:a===y.TypeValidationError.INVALID_TYPE?i.validationErrors.invalidType:"length-validation-error::too-short"===a?f.substitute(i.validationErrors.tooShort,{min:r}):null},e._createClass(i,[{key:"compiledFunc",get:function(){var e;const{arcade:t}=this;return t&&t.arcadeUtils.createFunction(null==(e=this.config)?void 0:e.visibilityExpression)}},{key:"compiledRequiredFunc",get:function(){var e;const{arcade:t}=this;return t&&t.arcadeUtils.createFunction(null==(e=this.config)?void 0:e.requiredExpression)}},{key:"evaluatedRequirement",get:function(){const e=this.compiledRequiredFunc;if(!e)return null;const{arcade:t}=this;return t.arcadeUtils.executeFunction(e,t.arcadeUtils.createExecContext(this.feature))}},{key:"evaluatedVisibility",get:function(){const e=this.compiledFunc;if(!e)return null;const{arcade:t}=this;return t.arcadeUtils.executeFunction(e,t.arcadeUtils.createExecContext(this.feature))}},{key:"domain",get:function(){var e,t;const{typeIdField:i}=this.layer,r=i===this.name,o=null==(e=this.field)?void 0:e.domain;if(r&&!o)return new p({name:"__internal-type-based-coded-value-domain__",codedValues:this.layer.types.map((({id:e,name:t})=>({code:e,name:t})))});const{feature:n}=this,l=i&&this.layer.getFieldDomain(this.name,{feature:n})||o,a=null==(t=this.config)?void 0:t.domain;return this._isDomainCompatible(a)?a:l}},{key:"editable",get:function(){var e;return this.layer.capabilities.operations.supportsEditing&&this.field.editable&&!1!==(null==(e=this.config)?void 0:e.editable)}},{key:"errorMessage",get:function(){return this._toErrorMessage()}},{key:"includeTime",get:function(){var e;const t=null==(e=this.config)?void 0:e.includeTime;return void 0===t||t}},{key:"label",get:function(){var e;return(null==(e=this.config)?void 0:e.label)||this.field.alias||this.field.name}},{key:"maxLength",get:function(){var e,t;if("date"===this.type)return-1;const i=null==(e=this.field)?void 0:e.length,r=null==(t=this.config)?void 0:t.maxLength;return!isNaN(r)&&r>=-1&&(-1===i||r<=i)?r:i}},{key:"minLength",get:function(){var e,t;if("date"===this.type)return-1;const i=null==(e=this.field)?void 0:e.length,r=null==(t=this.config)?void 0:t.minLength;return!isNaN(r)&&r>=-1&&(-1===i||r<=i)?r:-1}},{key:"required",get:function(){var e,t;if(!this.editable)return!1;if(!(null==(e=this.field)?void 0:e.nullable))return!0;if("boolean"==typeof this.evaluatedRequirement)return this.evaluatedRequirement;return!0===(null==(t=this.config)?void 0:t.required)}},{key:"type",get:function(){const{field:e}=this;return y.isNumericField(e)?"number":y.isStringField(e)?"text":y.isDateField(e)?"date":"unsupported"}},{key:"valid",get:function(){const e=this.editable?this._validate():null;return this._set("error",e),null===e}},{key:"value",get:function(){return this._get("value")},set:function(e){this.notifyChange("evaluatedVisibility"),this._set("value",e)}},{key:"visible",get:function(){if(this._isEditorField())return!1;return"boolean"==typeof this.evaluatedVisibility?this.evaluatedVisibility:!!this.config||this._shownByDefault()}}]),i}(u);return t.__decorate([n.property()],v.prototype,"arcade",void 0),t.__decorate([n.property({dependsOn:["arcade","config.visibilityExpression"]})],v.prototype,"compiledFunc",null),t.__decorate([n.property({dependsOn:["arcade","config.requiredExpression"]})],v.prototype,"compiledRequiredFunc",null),t.__decorate([n.property()],v.prototype,"config",void 0),t.__decorate([n.property({dependsOn:["compiledRequiredFunc","feature"]})],v.prototype,"evaluatedRequirement",null),t.__decorate([n.property({dependsOn:["compiledFunc","feature"]})],v.prototype,"evaluatedVisibility",null),t.__decorate([n.property()],v.prototype,"feature",void 0),t.__decorate([n.property()],v.prototype,"field",void 0),t.__decorate([n.property()],v.prototype,"layer",void 0),t.__decorate([n.property({aliasOf:"config.description"})],v.prototype,"description",void 0),t.__decorate([n.property({dependsOn:["config","feature","field","layer"]})],v.prototype,"domain",null),t.__decorate([n.property({dependsOn:["config","field","layer"]})],v.prototype,"editable",null),t.__decorate([n.property({aliasOf:"config.editorType"})],v.prototype,"editorType",void 0),t.__decorate([n.property({readOnly:!0})],v.prototype,"error",void 0),t.__decorate([n.property({dependsOn:["error","messages","value"],autoTracked:!1})],v.prototype,"errorMessage",null),t.__decorate([n.property({aliasOf:"config.format"})],v.prototype,"format",void 0),t.__decorate([n.property()],v.prototype,"group",void 0),t.__decorate([n.property({aliasOf:"config.hint"})],v.prototype,"hint",void 0),t.__decorate([n.property({dependsOn:["config.includeTime"]})],v.prototype,"includeTime",null),t.__decorate([n.property({dependsOn:["field","config"]})],v.prototype,"label",null),t.__decorate([n.property({dependsOn:["field.length","config"]})],v.prototype,"maxLength",null),t.__decorate([n.property({dependsOn:["field.length","config"]})],v.prototype,"minLength",null),t.__decorate([n.property()],v.prototype,"messages",void 0),t.__decorate([n.property({aliasOf:"field.name"})],v.prototype,"name",void 0),t.__decorate([n.property({dependsOn:["config","evaluatedRequirement","field"]})],v.prototype,"required",null),t.__decorate([n.property({dependsOn:["field"]})],v.prototype,"type",null),t.__decorate([n.property({dependsOn:["config","domain","field","layer","value"]})],v.prototype,"valid",null),t.__decorate([n.property({value:null})],v.prototype,"value",null),t.__decorate([n.property({dependsOn:["config","evaluatedVisibility","field","layer"]})],v.prototype,"visible",null),v=t.__decorate([l.subclass("esri.widgets.FeatureForm.InputField")],v),v}));
