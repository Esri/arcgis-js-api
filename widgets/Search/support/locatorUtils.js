/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../../core/maybe","../../../geometry/Polygon","../../../Graphic","../../../tasks/support/AddressToLocationsParameters","../../../tasks/support/LocationToAddressParameters","../../../tasks/support/SuggestLocationsParameters","./geometryUtils"],(function(e,t,o,r,n,s,c,i){"use strict";const a="Single Line Input",u=3e5;function l(e,t){return e.location?p(e,t):S(e,t)}function d(e){const t=null==e?void 0:e.scale;return"number"==typeof t&&t<=u?e.get("extent.center"):null}function g(e,o){const{source:r,spatialReference:n,view:s,suggestTerm:i,maxSuggestions:a,sourceIndex:u}=e,l=new c,{apiKey:g,locator:m}=r,f=x(r,s),y=o&&o.signal;if(!m)return Promise.resolve(null);g&&(l.apiKey=g),r.categories&&(l.categories=r.categories),n&&(l.outSpatialReference=n);const p=d(s);p&&(l.location=p);if(!i.trim())return Promise.resolve(null);const{prefix:S="",suffix:v=""}=r,I=`${S}${i}${v}`;return l.text=I,f&&(l.searchExtent=t.unwrap(f)),l.maxSuggestions=a,r.countryCode&&(l.countryCode=r.countryCode),m.suggestLocations(l,{signal:y}).then((e=>w(e,u)))}function m(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e)}function f(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(e)}function y(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e)}function p(e,t){const{source:o,spatialReference:r,location:n,sourceIndex:c,view:i}=e,{apiKey:a,locator:u,zoomScale:l,defaultZoomScale:d}=o,g=i&&i.scale,m=t&&t.signal,f=new s;return f.location=n,a&&(f.apiKey=a),r&&(f.outSpatialReference=r),u.locationToAddress(f,{signal:m}).then((e=>k([e],{sourceIndex:c,scale:g,view:i,zoomScale:l,defaultZoomScale:d})))}function x(e,t){const{filter:o,withinViewEnabled:r}=e,n=t&&t.scale,s=t&&t.extent,c=o&&o.geometry;return i.createExtentFromGeometry(c,t,n)||(r&&s?s:void 0)}function S(e,o){const{source:r,suggestResult:s,spatialReference:c,view:i,maxResults:u,sourceIndex:l}=e,g=r&&r.zoomScale,m=r&&r.defaultZoomScale;if(!s.text.trim())return Promise.resolve(null);const f=!s.key&&r.prefix?r.prefix:"",y=!s.key&&r.suffix?r.suffix:"",p=`${f}${s.text}${y}`,S=new n,{apiKey:v,locator:w}=r,I=i&&i.scale,P=x(r,i),G=o&&o.signal;if(v&&(S.apiKey=v),!w)return Promise.resolve(null);r.categories&&(S.categories=r.categories),r.locationType&&(S.locationType=r.locationType),c&&(S.outSpatialReference=c);const L=d(i);L&&(S.location=L),S.maxLocations=u,P&&(S.searchExtent=t.unwrap(P)),r.countryCode&&(S.countryCode=r.countryCode);const{key:R}=s;return R&&(S.magicKey=R),S.address={},S.address[r.singleLineFieldName||a]=p,r.outFields&&(S.outFields=r.outFields),w.addressToLocations(S,{signal:G}).then((e=>k(e,{key:R,scale:I,sourceIndex:l,view:i,zoomScale:g,defaultZoomScale:m})))}function v(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}function w(e,t){return e.map((e=>v(e,t)))}function I(e,n){const{key:s,scale:c,sourceIndex:a,view:u,zoomScale:l,defaultZoomScale:d}=n,{attributes:g,extent:m,location:f,address:y}=e,p=new r({geometry:f,attributes:g}),x=m||f,S=i.createExtentFromGeometry(x,u,c),v="number"==typeof l?i.scaleExtent(S,u,l):"number"==typeof d&&"point"===x.type?i.scaleExtent(S,u,d):S,w=f?`${f.x},${f.y}`:"",I=y||w,k=p.clone();return t.isSome(v)&&(k.geometry=o.fromExtent(v)),{extent:v,feature:p,target:k,key:s,name:I,sourceIndex:a}}function k(e,t){return e.map((e=>I(e,t)))}e.getLocation=d,e.getResults=l,e.getSuggestions=g,e.isArcGISWorldGeocoder=y,e.isMeteredArcGISWorldGeocoder=m,e.isProxiedArcGISWorldGeocoder=f,Object.defineProperty(e,"__esModule",{value:!0})}));
