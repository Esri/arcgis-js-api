/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/Handles","../core/watchUtils","./support/widgetUtils","./support/decorators/messageBundle","../chunks/index","./Widget","./Legend/LegendViewModel","./Legend/styles/Card","./Legend/styles/Classic"],(function(e,t,r,s,o,i,n,a,d,l,c,p,y,h,u,f,v,g,_,w){"use strict";const L={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let b=function(t){function r(e,r){var s;return(s=t.call(this,e,r)||this)._handles=new p,s.activeLayerInfos=null,s.basemapLegendVisible=!1,s.groundLegendVisible=!1,s.keepCacheOnDestroy=!1,s.respectLayerVisibility=!0,s.iconClass=L.widgetIcon,s.label=void 0,s.layerInfos=null,s.messages=null,s.style=new w,s.view=null,s.viewModel=new g,s}e._inheritsLoose(r,t);var s=r.prototype;return s.initialize=function(){this.own(y.on(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),y.init(this,"style",((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view))})))},s.destroy=function(){this._handles.destroy(),this._handles=null},s.castStyle=function(e){if(e instanceof _||e instanceof w)return e;if("string"==typeof e)return"card"===e?new _:new w;if(e&&"string"==typeof e.type){const t={...e};delete t.type;return new("card"===e.type?_:w)(t)}return new w},s.render=function(){return f.jsx("div",{class:this.classes(L.base,L.widget,this.style instanceof w?L.panel:null)},this.style.render())},s._refreshActiveLayerInfos=function(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()},s._renderOnActiveLayerInfoChange=function(e){const t=y.init(e,"version",(()=>this.scheduleRender()));this._handles.add(t,`version_${e.layer.uid}`);const r=y.on(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(r,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))},r}(v);return t.__decorate([i.aliasOf("viewModel.activeLayerInfos")],b.prototype,"activeLayerInfos",void 0),t.__decorate([i.aliasOf("viewModel.basemapLegendVisible")],b.prototype,"basemapLegendVisible",void 0),t.__decorate([i.aliasOf("viewModel.groundLegendVisible")],b.prototype,"groundLegendVisible",void 0),t.__decorate([i.aliasOf("viewModel.keepCacheOnDestroy")],b.prototype,"keepCacheOnDestroy",void 0),t.__decorate([i.aliasOf("viewModel.respectLayerVisibility")],b.prototype,"respectLayerVisibility",void 0),t.__decorate([o.property()],b.prototype,"iconClass",void 0),t.__decorate([o.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],b.prototype,"label",void 0),t.__decorate([i.aliasOf("viewModel.layerInfos")],b.prototype,"layerInfos",void 0),t.__decorate([o.property(),u.messageBundle("esri/widgets/Legend/t9n/Legend")],b.prototype,"messages",void 0),t.__decorate([o.property()],b.prototype,"style",void 0),t.__decorate([n.cast("style")],b.prototype,"castStyle",null),t.__decorate([i.aliasOf("viewModel.view")],b.prototype,"view",void 0),t.__decorate([o.property()],b.prototype,"viewModel",void 0),b=t.__decorate([a.subclass("esri.widgets.Legend")],b),b}));
