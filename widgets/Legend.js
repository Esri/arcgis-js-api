/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/Handles","../core/watchUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/renderable","../chunks/index","./Widget","./Legend/LegendViewModel","./Legend/styles/Card","./Legend/styles/Classic"],(function(e,r,t,s,o,i,n,a,d,l,c,p,y,h,u,f,v,_,g,L,w){"use strict";const b="esri-legend",I="esri-widget",O="esri-widget--panel",C="esri-icon-layer-list";let M=function(r){function t(e,t){var s;return(s=r.call(this,e,t)||this)._handles=new p,s.activeLayerInfos=null,s.basemapLegendVisible=!1,s.groundLegendVisible=!1,s.keepCacheOnDestroy=!1,s.respectLayerVisibility=!0,s.iconClass=C,s.label=void 0,s.layerInfos=null,s.messages=null,s.style=new w,s.view=null,s.viewModel=new g,s}e._inheritsLoose(t,r);var s=t.prototype;return s.initialize=function(){this.own(y.on(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),y.init(this,"style",((e,r)=>{r&&e!==r&&r.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view))})))},s.destroy=function(){this._handles.destroy(),this._handles=null},s.castStyle=function(e){if(e instanceof L||e instanceof w)return e;if("string"==typeof e)return"card"===e?new L:new w;if(e&&"string"==typeof e.type){const r={...e};delete r.type;return new("card"===e.type?L:w)(r)}return new w},s.render=function(){return v.jsx("div",{class:this.classes(b,I,this.style instanceof w?O:null)},this.style.render())},s._refreshActiveLayerInfos=function(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()},s._renderOnActiveLayerInfoChange=function(e){const r=y.init(e,"version",(()=>this.scheduleRender()));this._handles.add(r,`version_${e.layer.uid}`);const t=y.on(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(t,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))},t}(_);return r.__decorate([i.aliasOf("viewModel.activeLayerInfos"),f.renderable()],M.prototype,"activeLayerInfos",void 0),r.__decorate([i.aliasOf("viewModel.basemapLegendVisible"),f.renderable()],M.prototype,"basemapLegendVisible",void 0),r.__decorate([i.aliasOf("viewModel.groundLegendVisible"),f.renderable()],M.prototype,"groundLegendVisible",void 0),r.__decorate([i.aliasOf("viewModel.keepCacheOnDestroy")],M.prototype,"keepCacheOnDestroy",void 0),r.__decorate([i.aliasOf("viewModel.respectLayerVisibility"),f.renderable()],M.prototype,"respectLayerVisibility",void 0),r.__decorate([o.property()],M.prototype,"iconClass",void 0),r.__decorate([o.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],M.prototype,"label",void 0),r.__decorate([i.aliasOf("viewModel.layerInfos"),f.renderable()],M.prototype,"layerInfos",void 0),r.__decorate([o.property(),f.renderable(),u.messageBundle("esri/widgets/Legend/t9n/Legend")],M.prototype,"messages",void 0),r.__decorate([o.property(),f.renderable()],M.prototype,"style",void 0),r.__decorate([n.cast("style")],M.prototype,"castStyle",null),r.__decorate([i.aliasOf("viewModel.view"),f.renderable()],M.prototype,"view",void 0),r.__decorate([o.property(),f.renderable(["view.size"])],M.prototype,"viewModel",void 0),M=r.__decorate([a.subclass("esri.widgets.Legend")],M),M}));
