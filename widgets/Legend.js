/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/Handles","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/has","../core/accessorSupport/decorators/cast","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./Legend/LegendViewModel","./Legend/styles/Card","./Legend/styles/Classic","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],(function(e,t,s,r,i,o,n,a,d,l,c,p,y,h,v,g,f){"use strict";const u={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let _=function(t){function i(e,r){var i;return(i=t.call(this,e,r)||this)._handles=new s,i.activeLayerInfos=null,i.basemapLegendVisible=!1,i.groundLegendVisible=!1,i.headingLevel=3,i.keepCacheOnDestroy=!1,i.respectLayerVisibility=!0,i.iconClass=u.widgetIcon,i.label=void 0,i.layerInfos=null,i.messages=null,i.style=new h,i.view=null,i.viewModel=new p,i}e._inheritsLoose(i,t);var o=i.prototype;return o.initialize=function(){this.own(r.on(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),r.watch(this,"headingLevel",(e=>{const{style:t}=this;t&&(t.headingLevel=e)})),r.init(this,"style",((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)})))},o.destroy=function(){this._handles.destroy(),this._handles=null},o.castStyle=function(e){if(e instanceof y||e instanceof h)return e;if("string"==typeof e)return"card"===e?new y:new h;if(e&&"string"==typeof e.type){const t={...e};delete t.type;return new("card"===e.type?y:h)(t)}return new h},o.render=function(){return f.tsx("div",{class:this.classes(u.base,u.widget,this.style instanceof h?u.panel:null)},this.style.render())},o._refreshActiveLayerInfos=function(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()},o._renderOnActiveLayerInfoChange=function(e){const t=r.init(e,"version",(()=>this.scheduleRender()));this._handles.add(t,`version_${e.layer.uid}`);const s=r.on(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(s,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))},i}(c);return t.__decorate([i.aliasOf("viewModel.activeLayerInfos")],_.prototype,"activeLayerInfos",void 0),t.__decorate([i.aliasOf("viewModel.basemapLegendVisible")],_.prototype,"basemapLegendVisible",void 0),t.__decorate([i.aliasOf("viewModel.groundLegendVisible")],_.prototype,"groundLegendVisible",void 0),t.__decorate([d.property()],_.prototype,"headingLevel",void 0),t.__decorate([i.aliasOf("viewModel.keepCacheOnDestroy")],_.prototype,"keepCacheOnDestroy",void 0),t.__decorate([i.aliasOf("viewModel.respectLayerVisibility")],_.prototype,"respectLayerVisibility",void 0),t.__decorate([d.property()],_.prototype,"iconClass",void 0),t.__decorate([d.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],_.prototype,"label",void 0),t.__decorate([i.aliasOf("viewModel.layerInfos")],_.prototype,"layerInfos",void 0),t.__decorate([d.property(),g.messageBundle("esri/widgets/Legend/t9n/Legend")],_.prototype,"messages",void 0),t.__decorate([d.property()],_.prototype,"style",void 0),t.__decorate([n.cast("style")],_.prototype,"castStyle",null),t.__decorate([i.aliasOf("viewModel.view")],_.prototype,"view",void 0),t.__decorate([d.property()],_.prototype,"viewModel",void 0),_=t.__decorate([l.subclass("esri.widgets.Legend")],_),_}));
