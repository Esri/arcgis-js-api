/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Evented","../../core/Collection","../../core/Handles","../../core/watchUtils","../LayerList/support/layerListUtils","./ListItem"],(function(e,t,s,i,o,r,a,l,n,c,d,m,p,h,u,_){"use strict";const f={map:"map",tables:"tables",layerListMode:"layer-list-mode"},y="hide",b=m.ofType(_);let I=function(t){function s(e){var s;return(s=t.call(this,e)||this)._handles=new p,s.listItemCreatedFunction=null,s.tableItems=new b,s.map=null,s}e._inheritsLoose(s,t);var i=s.prototype;return i.initialize=function(){this._handles.add([h.init(this,["map","map.loaded"],(()=>this._mapHandles()))],f.map)},i.destroy=function(){this._handles.destroy(),this._handles=null,this.map=null,this.tableItems.removeAll()},i.triggerAction=function(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})},i._mapHandles=function(){const{_handles:e,map:t}=this;e.remove(f.tables),this._compileList(),t&&e.add([h.on(this,"map.allTables","change",(()=>this._compileList())),h.init(this,"map.allTables",(()=>this._compileList())),h.init(this,"listItemCreatedFunction",(()=>this._compileList()))],f.tables)},i._modifyListItem=function(e){if("function"==typeof this.listItemCreatedFunction){const t={item:e};this.listItemCreatedFunction.call(null,t)}},i._removeAllItems=function(){this.tableItems.removeAll()},i._getViewableTables=function(e){if(e)return e.filter((e=>u.findLayerListMode(e)!==y))},i._watchTablesListMode=function(e){const{_handles:t}=this;t.remove(f.layerListMode),e&&e.forEach((e=>{t.add(h.watch(e,"listMode",(()=>this._compileList())),f.layerListMode)}))},i._compileList=function(){var e;const t=null==(e=this.map)?void 0:e.tables;this._watchTablesListMode(t);const s=this._getViewableTables(t);s&&s.length?(this._createNewItems(s),this._modifyOrRemoveItems(s),this._sortItems(s)):this._removeAllItems()},i._createNewItems=function(e){const{tableItems:t}=this;e.forEach((e=>{t.find((t=>t.layer===e))||t.add(new _({layer:e}))}))},i._modifyOrRemoveItems=function(e){const{tableItems:t}=this;t.forEach((s=>{if(!s)return;e&&e.find((e=>s.layer===e))?this._modifyListItem(s):t.remove(s)}))},i._sortItems=function(e){const{tableItems:t}=this;t.sort(((t,s)=>{const i=e.indexOf(t.layer),o=e.indexOf(s.layer);return i>o?-1:i<o?1:0}))},e._createClass(s,[{key:"state",get:function(){var e;const t=null==(e=this.map)?void 0:e.loadStatus;return"string"==typeof t?"loaded"===t?"ready":"loading"===t?"loading":"disabled":"ready"}}]),s}(d.EventedAccessor);return t.__decorate([r.property()],I.prototype,"listItemCreatedFunction",void 0),t.__decorate([r.property({type:b})],I.prototype,"tableItems",void 0),t.__decorate([r.property()],I.prototype,"map",void 0),t.__decorate([r.property({readOnly:!0})],I.prototype,"state",null),I=t.__decorate([a.subclass("esri.widgets.TableList.TableListViewModel")],I),I}));
