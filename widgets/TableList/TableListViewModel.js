/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Evented","../../core/Collection","../../core/Handles","../../core/watchUtils","../LayerList/support/layerListUtils","./ListItem"],(function(t,e,s,i,o,r,n,a,l,c,d,m,p,u,h,_){"use strict";const f="map",y="tables",b="layer-list-mode",I=m.ofType(_);let v=function(e){function s(t){var s;return(s=e.call(this,t)||this)._handles=new p,s.listItemCreatedFunction=null,s.tableItems=new I,s.map=null,s}t._inheritsLoose(s,e);var i=s.prototype;return i.initialize=function(){this._handles.add([u.init(this,["map","map.loaded"],(()=>this._mapHandles()))],f)},i.destroy=function(){this._handles.destroy(),this._handles=null,this.map=null,this.tableItems.removeAll()},i.triggerAction=function(t,e){t&&!t.disabled&&this.emit("trigger-action",{action:t,item:e})},i._mapHandles=function(){const{_handles:t,map:e}=this;t.remove(y),this._compileList(),e&&t.add([u.on(this,"map.tables","change",(()=>this._compileList())),u.init(this,"map.tables",(()=>this._compileList())),u.init(this,"listItemCreatedFunction",(()=>this._compileList()))],y)},i._modifyListItem=function(t){if("function"==typeof this.listItemCreatedFunction){const e={item:t};this.listItemCreatedFunction.call(null,e)}},i._removeAllItems=function(){this.tableItems.removeAll()},i._getViewableTables=function(t){if(t)return t.filter((t=>"hide"!==h.findLayerListMode(t)))},i._watchTablesListMode=function(t){const{_handles:e}=this;e.remove(b),t&&t.forEach((t=>{e.add(u.watch(t,"listMode",(()=>this._compileList())),b)}))},i._compileList=function(){var t;const e=null==(t=this.map)?void 0:t.tables;this._watchTablesListMode(e);const s=this._getViewableTables(e);s&&s.length?(this._createNewItems(s),this._modifyOrRemoveItems(s),this._sortItems(s)):this._removeAllItems()},i._createNewItems=function(t){const{tableItems:e}=this;t.forEach((t=>{e.find((e=>e.layer===t))||e.add(new _({layer:t}))}))},i._modifyOrRemoveItems=function(t){const{tableItems:e}=this;e.forEach((s=>{if(!s)return;t&&t.find((t=>s.layer===t))?this._modifyListItem(s):e.remove(s)}))},i._sortItems=function(t){const{tableItems:e}=this;e.sort(((e,s)=>{const i=t.indexOf(e.layer),o=t.indexOf(s.layer);return i>o?-1:i<o?1:0}))},t._createClass(s,[{key:"state",get:function(){var t;const e=null==(t=this.map)?void 0:t.loadStatus;return"string"==typeof e?"loaded"===e?"ready":"loading"===e?"loading":"disabled":"ready"}}]),s}(d.EventedAccessor);return e.__decorate([r.property()],v.prototype,"listItemCreatedFunction",void 0),e.__decorate([r.property({type:I})],v.prototype,"tableItems",void 0),e.__decorate([r.property()],v.prototype,"map",void 0),e.__decorate([r.property({dependsOn:["map","map.loadStatus"],readOnly:!0})],v.prototype,"state",null),v=e.__decorate([n.subclass("esri.widgets.TableList.TableListViewModel")],v),v}));
