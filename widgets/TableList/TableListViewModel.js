/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Collection","../../core/Evented","../../core/Handles","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/arrayUtils","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","../LayerList/support/layerListUtils","./ListItem"],(function(e,t,s,i,a,o,r,l,n,c,d,h){"use strict";const p={map:"map",tables:"tables",layerListMode:"layer-list-mode"},m="hide",u=s.ofType(h);let _=function(t){function s(e){var s;return(s=t.call(this,e)||this)._handles=new a,s.checkPublishStatusEnabled=!1,s.listItemCreatedFunction=null,s.tableItems=new u,s.map=null,s}e._inheritsLoose(s,t);var i=s.prototype;return i.initialize=function(){this._handles.add([o.watch((()=>[this.map,this.map?.loaded]),(()=>this._mapHandles()),o.initial),o.watch((()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled]),(()=>this._recompileList()))],p.map)},i.destroy=function(){this._handles.destroy(),this._handles=null,this.map=null,this.tableItems.removeAll()},i.triggerAction=function(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})},i._mapHandles=function(){const{_handles:e,map:t}=this;e.remove(p.tables),this._compileList(),t&&e.add(o.watch((()=>this.map?.allTables?.toArray()),(()=>this._compileList()),o.initial),p.tables)},i._removeAllItems=function(){this.tableItems.removeAll()},i._getViewableTables=function(e){if(e)return e.filter((e=>d.findLayerListMode(e)!==m))},i._watchTablesListMode=function(e){const{_handles:t}=this;t.remove(p.layerListMode),e&&e.forEach((e=>{t.add(o.watch((()=>e.listMode),(()=>this._compileList())),p.layerListMode)}))},i._compileList=function(){const e=this.map?.tables;this._watchTablesListMode(e);const t=this._getViewableTables(e);t&&t.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()},i._createNewItems=function(e){const{tableItems:t,listItemCreatedFunction:s,checkPublishStatusEnabled:i}=this;e.forEach((e=>{t.find((t=>t.layer===e))||t.add(new h({checkPublishStatusEnabled:i,layer:e,listItemCreatedFunction:s}))}))},i._removeItems=function(e){const{tableItems:t}=this;t.forEach((s=>{if(!s)return;e&&e.find((e=>s.layer===e))||t.remove(s)}))},i._sortItems=function(e){const{tableItems:t}=this;t.sort(((t,s)=>{const i=e.indexOf(t.layer),a=e.indexOf(s.layer);return i>a?-1:i<a?1:0}))},i._recompileList=function(){this._removeAllItems(),this._compileList()},e._createClass(s,[{key:"state",get:function(){const e=this.map?.loadStatus;return"string"==typeof e?"loaded"===e?"ready":"loading"===e?"loading":"disabled":"disabled"}}]),s}(i.EventedAccessor);t.__decorate([r.property()],_.prototype,"checkPublishStatusEnabled",void 0),t.__decorate([r.property()],_.prototype,"listItemCreatedFunction",void 0),t.__decorate([r.property({type:u,readOnly:!0})],_.prototype,"tableItems",void 0),t.__decorate([r.property()],_.prototype,"map",void 0),t.__decorate([r.property({readOnly:!0})],_.prototype,"state",null),_=t.__decorate([c.subclass("esri.widgets.TableList.TableListViewModel")],_);return _}));
