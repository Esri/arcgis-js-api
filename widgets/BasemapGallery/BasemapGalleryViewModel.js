/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/promiseUtils","../../core/Collection","../../core/Loadable","../../core/Handles","../../support/basemapUtils","../../core/watchUtils","./support/basemapCompatibilityUtils","./support/BasemapGalleryItem","./support/LocalBasemapsSource","./support/PortalBasemapsSource"],(function(e,t,o,i,s,r,a,n,c,p,l,u,d,y,m,h,_,b,f,v){"use strict";const w=u.ofType(b);let g=function(t){function o(e){var o;return(o=t.call(this,e)||this)._handles=new y,o.activeBasemap=null,o.items=new w,o.source=new v,o.view=null,o}e._inheritsLoose(o,t);var i=o.prototype;return i.initialize=function(){const e=()=>this._recreateItems();this._handles.add([h.watch(this,["compatibilityFunction","state"],(()=>this._updateItems())),h.on(this,"source.basemaps","change",e,e)])},i.destroy=function(){this._handles.destroy(),this._handles=null},i.castSource=function(e){return Array.isArray(e)||u.isCollection(e)?new f({basemaps:e}):function(e){return e&&"esri.portal.Portal"===e.declaredClass}(e)?new v({portal:e}):function(e){return e&&!(e instanceof v)&&(!!e.portal||!!e.query)}(e)?new v(e):function(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}(e)?e:null},i.basemapEquals=function(e,t){return m.contentEquals(e,t)},i.refresh=function(){this._recreateItems()},i.load=function(e){return this.addResolvingPromise(d.isLoadable(this.source)?this.source.load(e):l.resolve()),l.resolve(this)},i._recreateItems=function(){const e=this.get("source.basemaps"),{view:t,compatibilityFunction:o}=this;this.items.removeAll().forEach((e=>e.destroy())),this.items.addMany(e.map((e=>new b({basemap:e,compatibilityFunction:o,view:t}))))},i._updateItems=function(){this.items.forEach((e=>{e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}))},e._createClass(o,[{key:"compatibilityFunction",get:function(){if(void 0===this._get("compatibilityFunction")){return"3d"===this.get("view.type")?_.default3DCompatibility:_.default2DCompatibility}return this._get("compatibilityFunction")},set:function(e){this._set("compatibilityFunction",e)}},{key:"state",get:function(){return this.get("view.ready")&&this.source?"ready":"disabled"}}]),o}(d);return t.__decorate([s.property({aliasOf:"view.map.basemap"})],g.prototype,"activeBasemap",void 0),t.__decorate([s.property({dependsOn:["view.type"]})],g.prototype,"compatibilityFunction",null),t.__decorate([s.property({readOnly:!0,type:w})],g.prototype,"items",void 0),t.__decorate([s.property()],g.prototype,"source",void 0),t.__decorate([r.cast("source")],g.prototype,"castSource",null),t.__decorate([s.property({readOnly:!0,dependsOn:["view.ready"]})],g.prototype,"state",null),t.__decorate([s.property()],g.prototype,"view",void 0),g=t.__decorate([a.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],g),g}));
