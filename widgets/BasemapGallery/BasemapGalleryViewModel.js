/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/Collection","../../core/Handles","../../core/Loadable","../../core/watchUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/decorators/cast","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../support/basemapUtils","./support/basemapCompatibilityUtils","./support/BasemapGalleryItem","./support/LocalBasemapsSource","./support/PortalBasemapsSource"],(function(t,e,o,i,s,r,a,n,c,p,l,u,d,y,m,h){"use strict";const _=o.ofType(y);function b(t){return t&&"esri.portal.Portal"===t.declaredClass}function f(t){return t&&!(t instanceof h)&&(!!t.portal||!!t.query)}function v(t){return t&&"basemaps"in t&&"state"in t&&"refresh"in t}let w=function(e){function a(t){var o;return(o=e.call(this,t)||this)._handles=new i,o.activeBasemap=null,o.items=new _,o.source=new h,o.view=null,o}t._inheritsLoose(a,e);var n=a.prototype;return n.initialize=function(){const t=()=>this._recreateItems();this._handles.add([r.watch(this,["compatibilityFunction","state"],(()=>this._updateItems())),r.on(this,"source.basemaps","change",t,t)])},n.destroy=function(){this._handles.destroy(),this._handles=null},n.castSource=function(t){return Array.isArray(t)||o.isCollection(t)?new m({basemaps:t}):b(t)?new h({portal:t}):f(t)?new h(t):v(t)?t:null},n.basemapEquals=function(t,e){return u.contentEquals(t,e)},n.refresh=function(){this._recreateItems()},n.load=function(t){return this.addResolvingPromise(s.isLoadable(this.source)?this.source.load(t):Promise.resolve()),Promise.resolve(this)},n._recreateItems=function(){const t=this.get("source.basemaps"),{view:e,compatibilityFunction:o}=this;this.items.removeAll().forEach((t=>t.destroy())),this.items.addMany(t.map((t=>new y({basemap:t,compatibilityFunction:o,view:e}))))},n._updateItems=function(){this.items.forEach((t=>{t.compatibilityFunction=this.compatibilityFunction,t.view=this.view}))},t._createClass(a,[{key:"compatibilityFunction",get:function(){if(void 0===this._get("compatibilityFunction")){return"3d"===this.get("view.type")?d.default3DCompatibility:d.default2DCompatibility}return this._get("compatibilityFunction")},set:function(t){this._set("compatibilityFunction",t)}},{key:"state",get:function(){return this.get("view.ready")&&this.source?"ready":"disabled"}}]),a}(s);return e.__decorate([a.property({aliasOf:"view.map.basemap"})],w.prototype,"activeBasemap",void 0),e.__decorate([a.property()],w.prototype,"compatibilityFunction",null),e.__decorate([a.property({readOnly:!0,type:_})],w.prototype,"items",void 0),e.__decorate([a.property()],w.prototype,"source",void 0),e.__decorate([c.cast("source")],w.prototype,"castSource",null),e.__decorate([a.property({readOnly:!0})],w.prototype,"state",null),e.__decorate([a.property()],w.prototype,"view",void 0),w=e.__decorate([l.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],w),w}));
