/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","../../core/urlUtils","../../core/uuid","../../portal/support/resourceExtension","../../core/Collection","../../core/Loadable","../../core/Handles","../../support/basemapUtils","../../core/watchUtils","./support/basemapCompatibilityUtils","./support/BasemapGalleryItem","./support/LocalBasemapsSource","./support/PortalBasemapsSource"],(function(e,t,o,i,r,s,a,n,c,p,l,u,d,y,m,h,_,b,f){"use strict";const v=l.ofType(_);function w(e){return e&&"esri.portal.Portal"===e.declaredClass}function g(e){return e&&!(e instanceof f)&&(!!e.portal||!!e.query)}function F(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}let B=function(t){function o(e){var o;return(o=t.call(this,e)||this)._handles=new d,o.activeBasemap=null,o.items=new v,o.source=new f,o.view=null,o}e._inheritsLoose(o,t);var i=o.prototype;return i.initialize=function(){const e=()=>this._recreateItems();this._handles.add([m.watch(this,["compatibilityFunction","state"],(()=>this._updateItems())),m.on(this,"source.basemaps","change",e,e)])},i.destroy=function(){this._handles.destroy(),this._handles=null},i.castSource=function(e){return Array.isArray(e)||l.isCollection(e)?new b({basemaps:e}):w(e)?new f({portal:e}):g(e)?new f(e):F(e)?e:null},i.basemapEquals=function(e,t){return y.contentEquals(e,t)},i.refresh=function(){this._recreateItems()},i.load=function(e){return this.addResolvingPromise(u.isLoadable(this.source)?this.source.load(e):Promise.resolve()),Promise.resolve(this)},i._recreateItems=function(){const e=this.get("source.basemaps"),{view:t,compatibilityFunction:o}=this;this.items.removeAll().forEach((e=>e.destroy())),this.items.addMany(e.map((e=>new _({basemap:e,compatibilityFunction:o,view:t}))))},i._updateItems=function(){this.items.forEach((e=>{e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}))},e._createClass(o,[{key:"compatibilityFunction",get:function(){if(void 0===this._get("compatibilityFunction")){return"3d"===this.get("view.type")?h.default3DCompatibility:h.default2DCompatibility}return this._get("compatibilityFunction")},set:function(e){this._set("compatibilityFunction",e)}},{key:"state",get:function(){return this.get("view.ready")&&this.source?"ready":"disabled"}}]),o}(u);return t.__decorate([r.property({aliasOf:"view.map.basemap"})],B.prototype,"activeBasemap",void 0),t.__decorate([r.property()],B.prototype,"compatibilityFunction",null),t.__decorate([r.property({readOnly:!0,type:v})],B.prototype,"items",void 0),t.__decorate([r.property()],B.prototype,"source",void 0),t.__decorate([s.cast("source")],B.prototype,"castSource",null),t.__decorate([r.property({readOnly:!0})],B.prototype,"state",null),t.__decorate([r.property()],B.prototype,"view",void 0),B=t.__decorate([a.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],B),B}));
