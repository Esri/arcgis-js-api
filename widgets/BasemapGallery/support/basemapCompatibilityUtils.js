/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Error","../../../core/promiseUtils","../../../layers/support/layerUtils","../../../views/ViewingMode","../../../views/3d/terrain/terrainUtils","../../../views/3d/terrain/TilingScheme","../../../views/support/spatialReferenceSupport"],(function(e,t,i,a,r,n,o,l,s){"use strict";function p(e){return c.apply(this,arguments)}function c(){return(c=t._asyncToGenerator((function*(e,t={}){yield y(e,t),a.throwIfAborted(t)}))).apply(this,arguments)}function u(e){return f.apply(this,arguments)}function f(){return(f=t._asyncToGenerator((function*(e,t={}){const{basemap:i,view:n}=e;if(yield i.load(t),a.throwIfAborted(t),0===i.baseLayers.length)return;const o=i.baseLayers.getItemAt(0);if(!r.isTiledLayer(o))return;if(i.spatialReference){if(n.spatialReference.equals(i.spatialReference))return;m()}yield o.load(t),a.throwIfAborted(t);const l=(o.get("supportedSpatialReferences")||[o.get("tileInfo.spatialReference")]).filter(Boolean);0!==l.length&&l.every((e=>!n.spatialReference.equals(e)))&&m()}))).apply(this,arguments)}function m(){throw new i("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}function y(e,t){return d.apply(this,arguments)}function d(){return(d=t._asyncToGenerator((function*(e,t){const{basemap:a,view:r}=e;if(yield a.load(t),0===a.baseLayers.length)return;const n=b(a.baseLayers.concat(a.referenceLayers));if(n.length)throw n[0];const o=a.baseLayers.getItemAt(0);try{yield o.load(t)}catch(l){const e="basemap-compatibility:unknown-error",t="Unknown basemap compatibility error",{name:a=e,message:r=t,details:n}=l;throw new i(a,r,n)}h(o,r)}))).apply(this,arguments)}function b(e){const t=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return e.toArray().filter((e=>-1===t.indexOf(e.operationalLayerType))).map((e=>new i("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})))}function h(e,t){const a=e.tileInfo;if(!a)return;const r=t.state.viewingMode;if(!r)return;if(!s.isSpatialReferenceSupported(a.spatialReference,r))throw new i(`basemapgalleryitem:spatial-reference-unsupported-${n.stringFromViewingMode(r)}`,`Basemap spatial reference is unsupported in ${n.stringFromViewingMode(r)} mode`);if(1===r){let t=o.checkIfTileInfoSupportedForView(a,e.fullExtent,null,1);if(t&&e.compatibleTileInfo256&&!o.checkIfTileInfoSupportedForView(e.compatibleTileInfo256,e.fullExtent,null,1)&&(t=null),t){const e=a.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new i(`basemapgalleryitem:tiling-scheme-unsupported-${e}-global`,"Basemap tiling scheme is unsupported in global mode",{error:t})}}else if(l.checkUnsupported(a))throw new i("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const p=t.get("basemapTerrain.tilingScheme");if(p&&!p.compatibleWith(a)&&(!e.compatibleTileInfo256||!p.compatibleWith(e.compatibleTileInfo256)))throw new i("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}e.default2DCompatibility=u,e.default3DCompatibility=p,Object.defineProperty(e,"__esModule",{value:!0})}));
