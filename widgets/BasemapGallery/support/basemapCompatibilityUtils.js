/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/compilerUtils","../../../core/Error","../../../core/promiseUtils","../../../views/support/spatialReferenceSupport","../../../layers/support/layerUtils","../../../views/3d/terrain/TilingScheme","../../../views/3d/terrain/terrainUtils"],(function(e,t,a,i,r,n,o,l){"use strict";function s(){throw new a("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}e.default2DCompatibility=async function(e,t={}){const{basemap:a,view:r}=e;if(await a.load(t),i.throwIfAborted(t),0===a.baseLayers.length)return;const o=a.baseLayers.getItemAt(0);if(!n.isTiledLayer(o))return;if(a.spatialReference){if(r.spatialReference.equals(a.spatialReference))return;s()}await o.load(t),i.throwIfAborted(t);const l=(o.get("supportedSpatialReferences")||[o.get("tileInfo.spatialReference")]).filter(Boolean);0!==l.length&&l.every((e=>!r.spatialReference.equals(e)))&&s()},e.default3DCompatibility=async function(e,n={}){await async function(e,i){const{basemap:n,view:s}=e;if(await n.load(i),0===n.baseLayers.length)return;const p=function(e){const t=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return e.toArray().filter((e=>-1===t.indexOf(e.operationalLayerType))).map((e=>new a("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})))}(n.baseLayers.concat(n.referenceLayers));if(p.length)throw p[0];const c=t.typeCast(n.baseLayers.getItemAt(0))();try{await c.load(i)}catch(e){const t="basemap-compatibility:unknown-error",i="Unknown basemap compatibility error",{name:r=t,message:n=i,details:o}=e;throw new a(r,n,o)}!function(e,t){const i=e.tileInfo;if(!i)return;const n=t.viewingMode;if(!n)return;if(!r.isSpatialReferenceSupported(i.spatialReference,n))throw new a(`basemapgalleryitem:spatial-reference-unsupported-${n}`,`Basemap spatial reference is unsupported in ${n} mode`);if("global"===n){let t=l.checkIfTileInfoSupportedForView(i,e.fullExtent,null,1);if(t&&e.compatibleTileInfo256&&!l.checkIfTileInfoSupportedForView(e.compatibleTileInfo256,e.fullExtent,null,1)&&(t=null),t){const e=i.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new a(`basemapgalleryitem:tiling-scheme-unsupported-${e}-global`,"Basemap tiling scheme is unsupported in global mode",{error:t})}}else if(o.checkUnsupported(i))throw new a("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const s=t.get("basemapTerrain.tilingScheme");if(s&&!s.compatibleWith(i)&&(!e.compatibleTileInfo256||!s.compatibleWith(e.compatibleTileInfo256)))throw new a("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}(c,s)}(e,n),i.throwIfAborted(n)},Object.defineProperty(e,"__esModule",{value:!0})}));
