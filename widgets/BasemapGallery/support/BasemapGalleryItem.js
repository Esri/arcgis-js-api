/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/urlUtils","../../../core/uuid","../../../portal/support/resourceExtension","../../../core/promiseUtils","../../../core/Accessor","../../../core/Handles","../../../core/watchUtils"],(function(t,e,r,i,o,s,a,l,n,c,p,h,u,d){"use strict";let _=function(e){function r(t){var r;return(r=e.call(this,t)||this)._handles=new u,r.compatibilityFunction=null,r.error=null,r.state="loading",r.view=null,r}t._inheritsLoose(r,e);var i=r.prototype;return i.initialize=function(){this._handles.add(d.init(this,["basemap.loadStatus","compatibilityFunction","view.basemapTerrain?.tilingScheme","view.ready","view.spatialReference"],(()=>this.refresh())))},i.destroy=function(){this._cancelCompatibilityCheck(),this._handles.destroy(),this._handles=null,this.basemap=null,this.compatibilityFunction=null,this.view=null},i.refresh=function(){this._cancelCompatibilityCheck(),this._set("state","loading");const t=this.get("basemap.loadStatus");if("loaded"!==t&&"failed"!==t)return;if(!this.compatibilityFunction)return void("loaded"===t?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const e=new AbortController,{signal:r}=e;this.compatibilityFunction(this,{signal:r}).then((()=>{this._set("state","ready"),this._set("error",null)})).catch((t=>{p.isAbortError(t)||(this._set("state","error"),this._set("error",t))})),this._lastCompatibilityCheckController=e},i._cancelCompatibilityCheck=function(){this._lastCompatibilityCheckController&&(this._lastCompatibilityCheckController.abort(),this._lastCompatibilityCheckController=null)},t._createClass(r,[{key:"basemap",set:function(t){const e=this._get("basemap");e&&e.cancelLoad(),t&&t.load().catch((()=>{})),this._set("basemap",t)}}]),r}(h);return e.__decorate([s.property()],_.prototype,"basemap",null),e.__decorate([s.property()],_.prototype,"compatibilityFunction",void 0),e.__decorate([s.property({readOnly:!0})],_.prototype,"error",void 0),e.__decorate([s.property({readOnly:!0})],_.prototype,"state",void 0),e.__decorate([s.property()],_.prototype,"view",void 0),_=e.__decorate([a.subclass("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],_),_}));
