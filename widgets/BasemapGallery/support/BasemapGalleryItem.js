/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Handles","../../../core/promiseUtils","../../../core/watchUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/ensureType","../../../core/Logger","../../../core/accessorSupport/decorators/subclass"],(function(t,e,i,r,o,s,a,l,n,c,p){"use strict";let h=function(e){function i(t){var i;return(i=e.call(this,t)||this)._handles=new r,i.compatibilityFunction=null,i.error=null,i.state="loading",i.view=null,i}t._inheritsLoose(i,e);var a=i.prototype;return a.initialize=function(){this._handles.add(s.init(this,["basemap.loadStatus","compatibilityFunction","view.basemapTerrain?.tilingScheme","view.ready","view.spatialReference"],(()=>this.refresh())))},a.destroy=function(){this._cancelCompatibilityCheck(),this._handles.destroy(),this._handles=null,this.basemap=null,this.compatibilityFunction=null,this.view=null},a.refresh=function(){this._cancelCompatibilityCheck(),this._set("state","loading");const t=this.get("basemap.loadStatus");if("loaded"!==t&&"failed"!==t)return;if(!this.compatibilityFunction)return void("loaded"===t?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const e=new AbortController,{signal:i}=e;this.compatibilityFunction(this,{signal:i}).then((()=>{this._set("state","ready"),this._set("error",null)})).catch((t=>{o.isAbortError(t)||(this._set("state","error"),this._set("error",t))})),this._lastCompatibilityCheckController=e},a._cancelCompatibilityCheck=function(){this._lastCompatibilityCheckController&&(this._lastCompatibilityCheckController.abort(),this._lastCompatibilityCheckController=null)},t._createClass(i,[{key:"basemap",set:function(t){const e=this._get("basemap");e&&e.cancelLoad(),t&&t.load().catch((()=>{})),this._set("basemap",t)}}]),i}(i);return e.__decorate([a.property()],h.prototype,"basemap",null),e.__decorate([a.property()],h.prototype,"compatibilityFunction",void 0),e.__decorate([a.property({readOnly:!0})],h.prototype,"error",void 0),e.__decorate([a.property({readOnly:!0})],h.prototype,"state",void 0),e.__decorate([a.property()],h.prototype,"view",void 0),h=e.__decorate([p.subclass("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],h),h}));
