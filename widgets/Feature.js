/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../intl/substitute","../intl","../core/watchUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/renderable","../chunks/index","./Widget","./Attachments","./Feature/FeatureContent","./Feature/FeatureFields","./Feature/FeatureMedia","./Feature/FeatureViewModel","./Feature/support/FeatureContentMixin"],(function(e,t,n,s,i,r,o,d,l,a,c,u,p,h,_,f,v,y,g,w,m,M,b,x,E){"use strict";const C="esri-icon-loading-indicator esri-rotating",W="esri-widget",F="esri-feature",j="esri-feature__size-container",k="esri-feature__title",T="esri-feature__main-container",U="esri-feature__content-element",A="esri-feature__text",I="esri-feature__last-edited-info",L="esri-feature__attachments",O="esri-feature__loading-container",B="esri-feature__loading-spinner",K={title:!0,content:!0,lastEditedInfo:!0};let R=function(t){function n(e,n){var s;return(s=t.call(this,e,n)||this)._contentWidgets=[],s.graphic=null,s.defaultPopupTemplateEnabled=!1,s.label=void 0,s.messages=null,s.messagesURIUtils=null,s.spatialReference=null,s.title=null,s.visibleElements={...K},s.map=null,s.view=null,s.viewModel=new x,s}e._inheritsLoose(n,t);var s=n.prototype;return s.initialize=function(){this.own(h.init(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))},s.destroy=function(){this._destroyContentWidgets()},s.castVisibleElements=function(e){return{...K,...e}},s.render=function(){const{waitingForContent:e}=this.viewModel;return y.jsx("div",{class:this.classes(F,W)},y.jsx("div",{class:j},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))},s.setActiveMedia=function(e,t){this.viewModel.setActiveMedia(e,t)},s.nextMedia=function(e){this.viewModel.nextMedia(e)},s.previousMedia=function(e){this.viewModel.previousMedia(e)},s.renderLoading=function(){return y.jsx("div",{key:"loading-container",class:O},y.jsx("span",{class:this.classes(C,B)}))},s.renderContentContainer=function(){const{visibleElements:e}=this;return e.content?y.jsx("div",{class:T},[this.renderContent(),this.renderLastEditInfo()]):null},s.renderTitle=function(){const{visibleElements:e,title:t}=this;return e.title?y.jsx("h4",{class:k,innerHTML:t}):null},s.renderContent=function(){const e=this.viewModel.content;if(!e)return null;if(Array.isArray(e))return e.length?y.jsx("div",{key:"content-content-elements"},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:y.jsx("div",{key:"content-content"},e.render())}return this.renderNodeContent(e)},s.renderContentElement=function(e,t){const{visibleElements:n}=this;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}},s.renderAttachments=function(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:n,attachmentInfos:s}=t.viewModel;return"loading"===n||s.length>0?y.jsx("div",{key:this._buildKey("attachments-element",e),class:this.classes(L,U)},y.jsx("h2",null,this.messages.attach),t.render()):null},s.renderCustom=function(e,t){const{creator:n}=e,s=this._contentWidgets[t];return!s||s.destroyed?null:n?y.jsx("div",{key:this._buildKey("custom-element",t),class:U},s.render()):null},s.renderFields=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:y.jsx("div",{key:this._buildKey("fields-element",e),class:U},t.render())},s.renderMedia=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:y.jsx("div",{key:this._buildKey("media-element",e),class:U},t.render())},s.renderLastEditInfo=function(){const{visibleElements:e,messages:t}=this,{lastEditInfo:n}=this.viewModel;if(!n||!e.lastEditedInfo)return null;const{date:s,user:i}=n,r="edit"===n.type?i?t.lastEditedByUser:t.lastEdited:i?t.lastCreatedByUser:t.lastCreated,o=u.substitute(r,{date:s,user:i});return y.jsx("div",{key:"edit-info-element",class:this.classes(I,U)},o)},s.renderText=function(e,t){const n=e.text,s=this._contentWidgets[t];return!s||s.destroyed?null:n?y.jsx("div",{key:this._buildKey("text-element",t),class:this.classes(U,A)},s.render()):null},s._buildKey=function(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`},s._destroyContentWidgets=function(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]},s._setupContentWidgets=function(){this._destroyContentWidgets();const e=this.get("viewModel.content"),{contentViewModels:t}=this.viewModel;if(Array.isArray(e))e.forEach(((e,n)=>{"attachments"===e.type&&(this._contentWidgets[n]=new w({displayType:e.displayType,viewModel:t[n]})),"fields"===e.type&&(this._contentWidgets[n]=new M({viewModel:t[n]})),"media"===e.type&&(this._contentWidgets[n]=new b({viewModel:t[n]})),"text"===e.type&&(this._contentWidgets[n]=new m({viewModel:t[n]})),"custom"===e.type&&(this._contentWidgets[n]=new m({viewModel:t[n]}))}),this);else{const e=t[0];e&&!e.destroyed&&(this._contentWidgets[0]=new m({viewModel:e}))}this.scheduleRender()},n}(E.FeatureContentMixin(g));return t.__decorate([r.aliasOf("viewModel.graphic")],R.prototype,"graphic",void 0),t.__decorate([r.aliasOf("viewModel.defaultPopupTemplateEnabled")],R.prototype,"defaultPopupTemplateEnabled",void 0),t.__decorate([i.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],R.prototype,"label",void 0),t.__decorate([i.property(),v.renderable(),f.messageBundle("esri/widgets/Feature/t9n/Feature")],R.prototype,"messages",void 0),t.__decorate([i.property(),v.renderable(),f.messageBundle("esri/widgets/support/t9n/uriUtils")],R.prototype,"messagesURIUtils",void 0),t.__decorate([r.aliasOf("viewModel.spatialReference")],R.prototype,"spatialReference",void 0),t.__decorate([r.aliasOf("viewModel.title")],R.prototype,"title",void 0),t.__decorate([i.property(),v.renderable()],R.prototype,"visibleElements",void 0),t.__decorate([o.cast("visibleElements")],R.prototype,"castVisibleElements",null),t.__decorate([r.aliasOf("viewModel.map")],R.prototype,"map",void 0),t.__decorate([r.aliasOf("viewModel.view")],R.prototype,"view",void 0),t.__decorate([i.property({type:x}),v.renderable(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo","viewModel.contentViewModels"])],R.prototype,"viewModel",void 0),R=t.__decorate([d.subclass("esri.widgets.Feature")],R),R}));
