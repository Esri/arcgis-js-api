/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/has","../core/accessorSupport/decorators/cast","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./Feature/FeatureAttachments","./Feature/FeatureContent","./Feature/FeatureFields","./Feature/FeatureMedia","./Feature/FeatureViewModel","./Feature/support/FeatureContentMixin","./support/Heading","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","../intl/substitute"],(function(e,t,n,i,s,r,o,l,a,d,c,u,p,f,h,_,g,m,v,y,w,M,b){"use strict";const E={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},x={title:!0,content:!0,lastEditedInfo:!0};let C=function(n){function i(e,t){var i;return(i=n.call(this,e,t)||this)._contentWidgets=[],i.graphic=null,i.defaultPopupTemplateEnabled=!1,i.headingLevel=2,i.label=void 0,i.messages=null,i.messagesCommon=null,i.messagesURIUtils=null,i.spatialReference=null,i.title=null,i.visibleElements={...x},i.map=null,i.view=null,i.viewModel=new g,i}t._inheritsLoose(i,n);var r=i.prototype;return r.initialize=function(){this.own(s.init(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))},r.loadDependencies=function(){return new Promise((function(t,n){e(["../chunks/notice"],t,n)}))},r.destroy=function(){this._destroyContentWidgets()},r.castVisibleElements=function(e){return{...x,...e}},r.render=function(){const{state:e}=this.viewModel,t=M.tsx("div",{class:E.container,key:"container"},this.renderTitle(),"error"===e?this.renderError():"loading"===e?this.renderLoading():this.renderContentContainer());return M.tsx("div",{class:this.classes(E.base,E.esriWidget)},t)},r.setActiveMedia=function(e,t){this.viewModel.setActiveMedia(e,t)},r.nextMedia=function(e){this.viewModel.nextMedia(e)},r.previousMedia=function(e){this.viewModel.previousMedia(e)},r.renderError=function(){const{messagesCommon:e,messages:t,visibleElements:n}=this;return M.tsx("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},n.title?M.tsx("div",{key:"error-title",slot:"title"},e.errorMessage):null,M.tsx("div",{key:"error-message",slot:"message"},t.loadingError))},r.renderLoading=function(){return M.tsx("div",{key:"loading-container",class:E.loadingSpinnerContainer},M.tsx("span",{class:this.classes(E.iconLoading,E.spinner)}))},r.renderContentContainer=function(){const{visibleElements:e}=this;return e.content?M.tsx("div",{class:E.main},[this.renderContent(),this.renderLastEditInfo()]):null},r.renderTitle=function(){const{visibleElements:e,title:t}=this;return e.title?M.tsx(v.Heading,{level:this.headingLevel,class:E.title,innerHTML:t}):null},r.renderContent=function(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?M.tsx("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:M.tsx("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)},r.renderContentElement=function(e,t){const{visibleElements:n}=this;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}},r.renderAttachments=function(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:n,attachmentInfos:i}=t.viewModel;return"loading"===n||i.length>0?M.tsx("div",{key:this._buildKey("attachments-element",e),class:this.classes(E.contentElement)},t.render()):null},r.renderCustom=function(e,t){const{creator:n}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:n?M.tsx("div",{key:this._buildKey("custom-element",t),class:E.contentElement},i.render()):null},r.renderFields=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:M.tsx("div",{key:this._buildKey("fields-element",e),class:E.contentElement},t.render())},r.renderMedia=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:M.tsx("div",{key:this._buildKey("media-element",e),class:E.contentElement},t.render())},r.renderLastEditInfo=function(){const{visibleElements:e,messages:t}=this,{lastEditInfo:n}=this.viewModel;if(!n||!e.lastEditedInfo)return null;const{date:i,user:s}=n,r="edit"===n.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=b.substitute(r,{date:i,user:s});return M.tsx("div",{key:"edit-info-element",class:this.classes(E.lastEditedInfo,E.contentElement)},o)},r.renderText=function(e,t){const n=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:n?M.tsx("div",{key:this._buildKey("text-element",t),class:this.classes(E.contentElement,E.text)},i.render()):null},r._buildKey=function(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`},r._destroyContentWidgets=function(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]},r._setupContentWidgets=function(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,n=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(n))n.forEach(((n,s)=>{"attachments"===n.type&&(this._contentWidgets[s]=new p({displayType:n.displayType,headingLevel:t.title?e+1:e,viewModel:i[s]})),"fields"===n.type&&(this._contentWidgets[s]=new h({viewModel:i[s]})),"media"===n.type&&(this._contentWidgets[s]=new _({viewModel:i[s]})),"text"===n.type&&(this._contentWidgets[s]=new f({viewModel:i[s]})),"custom"===n.type&&(this._contentWidgets[s]=new f({viewModel:i[s]}))}),this);else{const e=i[0];e&&!e.destroyed&&(this._contentWidgets[0]=new f({viewModel:e}))}this.scheduleRender()},i}(m.FeatureContentMixin(u));return n.__decorate([r.aliasOf("viewModel.graphic")],C.prototype,"graphic",void 0),n.__decorate([r.aliasOf("viewModel.defaultPopupTemplateEnabled")],C.prototype,"defaultPopupTemplateEnabled",void 0),n.__decorate([d.property()],C.prototype,"headingLevel",void 0),n.__decorate([d.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],C.prototype,"label",void 0),n.__decorate([d.property(),w.messageBundle("esri/widgets/Feature/t9n/Feature")],C.prototype,"messages",void 0),n.__decorate([d.property(),w.messageBundle("esri/t9n/common")],C.prototype,"messagesCommon",void 0),n.__decorate([d.property(),w.messageBundle("esri/widgets/support/t9n/uriUtils")],C.prototype,"messagesURIUtils",void 0),n.__decorate([r.aliasOf("viewModel.spatialReference")],C.prototype,"spatialReference",void 0),n.__decorate([r.aliasOf("viewModel.title")],C.prototype,"title",void 0),n.__decorate([d.property()],C.prototype,"visibleElements",void 0),n.__decorate([l.cast("visibleElements")],C.prototype,"castVisibleElements",null),n.__decorate([r.aliasOf("viewModel.map")],C.prototype,"map",void 0),n.__decorate([r.aliasOf("viewModel.view")],C.prototype,"view",void 0),n.__decorate([d.property({type:g})],C.prototype,"viewModel",void 0),C=n.__decorate([c.subclass("esri.widgets.Feature")],C),C}));
