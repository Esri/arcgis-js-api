/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/aliasOf","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../intl/substitute","../intl","../core/watchUtils","./support/widgetUtils","./support/decorators/messageBundle","../chunks/index","./Widget","./Feature/FeatureAttachments","./Feature/FeatureContent","./Feature/FeatureFields","./Feature/FeatureMedia","./Feature/FeatureViewModel","./Feature/support/FeatureContentMixin"],(function(e,t,n,i,s,r,o,d,l,a,c,u,p,f,_,h,y,v,g,m,w,M,b,E){"use strict";const x={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},C={title:!0,content:!0,lastEditedInfo:!0};let W=function(t){function n(e,n){var i;return(i=t.call(this,e,n)||this)._contentWidgets=[],i.graphic=null,i.defaultPopupTemplateEnabled=!1,i.label=void 0,i.messages=null,i.messagesURIUtils=null,i.spatialReference=null,i.title=null,i.visibleElements={...C},i.map=null,i.view=null,i.viewModel=new b,i}e._inheritsLoose(n,t);var i=n.prototype;return i.initialize=function(){this.own(f.init(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))},i.destroy=function(){this._destroyContentWidgets()},i.castVisibleElements=function(e){return{...C,...e}},i.render=function(){const{waitingForContent:e}=this.viewModel;return y.jsx("div",{class:this.classes(x.base,x.esriWidget)},y.jsx("div",{class:x.container},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))},i.setActiveMedia=function(e,t){this.viewModel.setActiveMedia(e,t)},i.nextMedia=function(e){this.viewModel.nextMedia(e)},i.previousMedia=function(e){this.viewModel.previousMedia(e)},i.renderLoading=function(){return y.jsx("div",{key:"loading-container",class:x.loadingSpinnerContainer},y.jsx("span",{class:this.classes(x.iconLoading,x.spinner)}))},i.renderContentContainer=function(){const{visibleElements:e}=this;return e.content?y.jsx("div",{class:x.main},[this.renderContent(),this.renderLastEditInfo()]):null},i.renderTitle=function(){const{visibleElements:e,title:t}=this;return e.title?y.jsx("h4",{class:x.title,innerHTML:t}):null},i.renderContent=function(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?y.jsx("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:y.jsx("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)},i.renderContentElement=function(e,t){const{visibleElements:n}=this;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}},i.renderAttachments=function(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:n,attachmentInfos:i}=t.viewModel;return"loading"===n||i.length>0?y.jsx("div",{key:this._buildKey("attachments-element",e),class:this.classes(x.contentElement)},t.render()):null},i.renderCustom=function(e,t){const{creator:n}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:n?y.jsx("div",{key:this._buildKey("custom-element",t),class:x.contentElement},i.render()):null},i.renderFields=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:y.jsx("div",{key:this._buildKey("fields-element",e),class:x.contentElement},t.render())},i.renderMedia=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:y.jsx("div",{key:this._buildKey("media-element",e),class:x.contentElement},t.render())},i.renderLastEditInfo=function(){const{visibleElements:e,messages:t}=this,{lastEditInfo:n}=this.viewModel;if(!n||!e.lastEditedInfo)return null;const{date:i,user:s}=n,r="edit"===n.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=u.substitute(r,{date:i,user:s});return y.jsx("div",{key:"edit-info-element",class:this.classes(x.lastEditedInfo,x.contentElement)},o)},i.renderText=function(e,t){const n=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:n?y.jsx("div",{key:this._buildKey("text-element",t),class:this.classes(x.contentElement,x.text)},i.render()):null},i._buildKey=function(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`},i._destroyContentWidgets=function(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]},i._setupContentWidgets=function(){this._destroyContentWidgets();const e=this.get("viewModel.content"),{contentViewModels:t}=this.viewModel;if(Array.isArray(e))e.forEach(((e,n)=>{"attachments"===e.type&&(this._contentWidgets[n]=new g({displayType:e.displayType,viewModel:t[n]})),"fields"===e.type&&(this._contentWidgets[n]=new w({viewModel:t[n]})),"media"===e.type&&(this._contentWidgets[n]=new M({viewModel:t[n]})),"text"===e.type&&(this._contentWidgets[n]=new m({viewModel:t[n]})),"custom"===e.type&&(this._contentWidgets[n]=new m({viewModel:t[n]}))}),this);else{const e=t[0];e&&!e.destroyed&&(this._contentWidgets[0]=new m({viewModel:e}))}this.scheduleRender()},n}(E.FeatureContentMixin(v));return t.__decorate([r.aliasOf("viewModel.graphic")],W.prototype,"graphic",void 0),t.__decorate([r.aliasOf("viewModel.defaultPopupTemplateEnabled")],W.prototype,"defaultPopupTemplateEnabled",void 0),t.__decorate([s.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],W.prototype,"label",void 0),t.__decorate([s.property(),h.messageBundle("esri/widgets/Feature/t9n/Feature")],W.prototype,"messages",void 0),t.__decorate([s.property(),h.messageBundle("esri/widgets/support/t9n/uriUtils")],W.prototype,"messagesURIUtils",void 0),t.__decorate([r.aliasOf("viewModel.spatialReference")],W.prototype,"spatialReference",void 0),t.__decorate([r.aliasOf("viewModel.title")],W.prototype,"title",void 0),t.__decorate([s.property()],W.prototype,"visibleElements",void 0),t.__decorate([o.cast("visibleElements")],W.prototype,"castVisibleElements",null),t.__decorate([r.aliasOf("viewModel.map")],W.prototype,"map",void 0),t.__decorate([r.aliasOf("viewModel.view")],W.prototype,"view",void 0),t.__decorate([s.property({type:b})],W.prototype,"viewModel",void 0),W=t.__decorate([d.subclass("esri.widgets.Feature")],W),W}));
