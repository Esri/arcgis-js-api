// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../intl","../core/watchUtils","../core/accessorSupport/decorators","./Attachments","./Widget","./Feature/FeatureContent","./Feature/FeatureFields","./Feature/FeatureMedia","./Feature/FeatureViewModel","./Feature/support/FeatureContentMixin","./support/widget"],(function(e,t,n,i,r,s,o,d,a,l,u,c,p,v){"use strict";var y="esri-icon-loading-indicator esri-rotating",h="esri-widget",_="esri-feature",f="esri-feature__size-container",g="esri-feature__title",w="esri-feature__main-container",m="esri-feature__content-element",M="esri-feature__text",b="esri-feature__last-edited-info",x="esri-feature__attachments",E="esri-feature__loading-container",C="esri-feature__loading-spinner",W={title:!0,content:!0,lastEditedInfo:!0};return function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._contentWidgets=[],r.graphic=null,r.defaultPopupTemplateEnabled=!1,r.label=void 0,r.messages=null,r.messagesURIUtils=null,r.spatialReference=null,r.title=null,r.visibleElements=n.__assign({},W),r.map=null,r.view=null,r.viewModel=new c,r}return n.__extends(t,e),t.prototype.initialize=function(){var e=this;this.own(r.init(this,"viewModel.contentViewModels",(function(){return e._setupContentWidgets()})))},t.prototype.destroy=function(){this._destroyContentWidgets()},t.prototype.castVisibleElements=function(e){return n.__assign(n.__assign({},W),e)},t.prototype.render=function(){var e=this.viewModel.waitingForContent;return v.tsx("div",{class:this.classes(_,h)},v.tsx("div",{class:f},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))},t.prototype.setActiveMedia=function(e,t){this.viewModel.setActiveMedia(e,t)},t.prototype.nextMedia=function(e){this.viewModel.nextMedia(e)},t.prototype.previousMedia=function(e){this.viewModel.previousMedia(e)},t.prototype.renderLoading=function(){return v.tsx("div",{key:"loading-container",class:E},v.tsx("span",{class:this.classes(y,C)}))},t.prototype.renderContentContainer=function(){return this.visibleElements.content?v.tsx("div",{class:w},[this.renderContent(),this.renderLastEditInfo()]):null},t.prototype.renderTitle=function(){var e=this.visibleElements,t=this.title;return e.title?v.tsx("h4",{class:g,innerHTML:t}):null},t.prototype.renderContent=function(){var e=this.viewModel.content;if(!e)return null;if(Array.isArray(e))return e.length?v.tsx("div",{key:"content-content-elements"},e.map(this.renderContentElement,this)):null;if("string"==typeof e){var t=this._contentWidgets[0];return!t||t.destroyed?null:v.tsx("div",{key:"content-content"},t.render())}return this.renderNodeContent(e)},t.prototype.renderContentElement=function(e,t){var n=this.visibleElements;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}},t.prototype.renderAttachments=function(e){var t=this._contentWidgets[e];if(!t||t.destroyed)return null;var n=t.viewModel,i=n.state,r=n.attachmentInfos;return"loading"===i||r.length>0?v.tsx("div",{key:this._buildKey("attachments-element",e),class:this.classes(x,m)},v.tsx("h2",null,this.messages.attach),t.render()):null},t.prototype.renderCustom=function(e,t){var n=e.creator,i=this._contentWidgets[t];return!i||i.destroyed?null:n?v.tsx("div",{key:this._buildKey("custom-element",t),class:m},i.render()):null},t.prototype.renderFields=function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:v.tsx("div",{key:this._buildKey("fields-element",e),class:m},t.render())},t.prototype.renderMedia=function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:v.tsx("div",{key:this._buildKey("media-element",e),class:m},t.render())},t.prototype.renderLastEditInfo=function(){var e=this.visibleElements,t=this.messages,n=this.viewModel.lastEditInfo;if(!n||!e.lastEditedInfo)return null;var r=n.date,s=n.user,o="edit"===n.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,d=i.substitute(o,{date:r,user:s});return v.tsx("div",{key:"edit-info-element",class:this.classes(b,m)},d)},t.prototype.renderText=function(e,t){var n=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:n?v.tsx("div",{key:this._buildKey("text-element",t),class:this.classes(m,M)},i.render()):null},t.prototype._buildKey=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=this.get("viewModel.graphic.uid")||"0",r=t.join("-");return e+"__"+i+"-"+r},t.prototype._destroyContentWidgets=function(){this._contentWidgets.forEach((function(e){e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]},t.prototype._setupContentWidgets=function(){var e=this;this._destroyContentWidgets();var t=this.get("viewModel.content"),n=this.viewModel.contentViewModels;if(Array.isArray(t))t.forEach((function(t,i){"attachments"===t.type&&(e._contentWidgets[i]=new o({displayType:t.displayType,viewModel:n[i]})),"fields"===t.type&&(e._contentWidgets[i]=new l({viewModel:n[i]})),"media"===t.type&&(e._contentWidgets[i]=new u({viewModel:n[i]})),"text"===t.type&&(e._contentWidgets[i]=new a({viewModel:n[i]})),"custom"===t.type&&(e._contentWidgets[i]=new a({viewModel:n[i]}))}),this);else{var i=n[0];i&&!i.destroyed&&(this._contentWidgets[0]=new a({viewModel:i}))}this.scheduleRender()},n.__decorate([s.aliasOf("viewModel.graphic")],t.prototype,"graphic",void 0),n.__decorate([s.aliasOf("viewModel.defaultPopupTemplateEnabled")],t.prototype,"defaultPopupTemplateEnabled",void 0),n.__decorate([s.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],t.prototype,"label",void 0),n.__decorate([s.property(),v.renderable(),v.messageBundle("esri/widgets/Feature/t9n/Feature")],t.prototype,"messages",void 0),n.__decorate([s.property(),v.renderable(),v.messageBundle("esri/widgets/support/t9n/uriUtils")],t.prototype,"messagesURIUtils",void 0),n.__decorate([s.aliasOf("viewModel.spatialReference")],t.prototype,"spatialReference",void 0),n.__decorate([s.aliasOf("viewModel.title")],t.prototype,"title",void 0),n.__decorate([s.property(),v.renderable()],t.prototype,"visibleElements",void 0),n.__decorate([s.cast("visibleElements")],t.prototype,"castVisibleElements",null),n.__decorate([s.aliasOf("viewModel.map")],t.prototype,"map",void 0),n.__decorate([s.aliasOf("viewModel.view")],t.prototype,"view",void 0),n.__decorate([s.property({type:c}),v.renderable(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo","viewModel.contentViewModels"])],t.prototype,"viewModel",void 0),t=n.__decorate([s.subclass("esri.widgets.Feature")],t)}(p.FeatureContentMixin(d))}));