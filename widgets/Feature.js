/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/has","../core/accessorSupport/decorators/cast","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./Feature/FeatureAttachments","./Feature/FeatureContent","./Feature/FeatureFields","./Feature/FeatureMedia","./Feature/FeatureViewModel","./Feature/support/FeatureContentMixin","./support/Heading","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","../intl/substitute"],(function(e,t,n,i,s,r,o,d,l,a,c,u,p,f,_,h,v,g,y,m,w,M){"use strict";const b={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},E={title:!0,content:!0,lastEditedInfo:!0};let x=function(t){function n(e,n){var i;return(i=t.call(this,e,n)||this)._contentWidgets=[],i.graphic=null,i.defaultPopupTemplateEnabled=!1,i.headingLevel=2,i.label=void 0,i.messages=null,i.messagesURIUtils=null,i.spatialReference=null,i.title=null,i.visibleElements={...E},i.map=null,i.view=null,i.viewModel=new h,i}e._inheritsLoose(n,t);var s=n.prototype;return s.initialize=function(){this.own(i.init(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))},s.destroy=function(){this._destroyContentWidgets()},s.castVisibleElements=function(e){return{...E,...e}},s.render=function(){const{waitingForContent:e}=this.viewModel;return w.tsx("div",{class:this.classes(b.base,b.esriWidget)},w.tsx("div",{class:b.container},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))},s.setActiveMedia=function(e,t){this.viewModel.setActiveMedia(e,t)},s.nextMedia=function(e){this.viewModel.nextMedia(e)},s.previousMedia=function(e){this.viewModel.previousMedia(e)},s.renderLoading=function(){return w.tsx("div",{key:"loading-container",class:b.loadingSpinnerContainer},w.tsx("span",{class:this.classes(b.iconLoading,b.spinner)}))},s.renderContentContainer=function(){const{visibleElements:e}=this;return e.content?w.tsx("div",{class:b.main},[this.renderContent(),this.renderLastEditInfo()]):null},s.renderTitle=function(){const{visibleElements:e,title:t}=this;return e.title?w.tsx(g.Heading,{level:this.headingLevel,class:b.title,innerHTML:t}):null},s.renderContent=function(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?w.tsx("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:w.tsx("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)},s.renderContentElement=function(e,t){const{visibleElements:n}=this;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}},s.renderAttachments=function(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:n,attachmentInfos:i}=t.viewModel;return"loading"===n||i.length>0?w.tsx("div",{key:this._buildKey("attachments-element",e),class:this.classes(b.contentElement)},t.render()):null},s.renderCustom=function(e,t){const{creator:n}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:n?w.tsx("div",{key:this._buildKey("custom-element",t),class:b.contentElement},i.render()):null},s.renderFields=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:w.tsx("div",{key:this._buildKey("fields-element",e),class:b.contentElement},t.render())},s.renderMedia=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:w.tsx("div",{key:this._buildKey("media-element",e),class:b.contentElement},t.render())},s.renderLastEditInfo=function(){const{visibleElements:e,messages:t}=this,{lastEditInfo:n}=this.viewModel;if(!n||!e.lastEditedInfo)return null;const{date:i,user:s}=n,r="edit"===n.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=M.substitute(r,{date:i,user:s});return w.tsx("div",{key:"edit-info-element",class:this.classes(b.lastEditedInfo,b.contentElement)},o)},s.renderText=function(e,t){const n=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:n?w.tsx("div",{key:this._buildKey("text-element",t),class:this.classes(b.contentElement,b.text)},i.render()):null},s._buildKey=function(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`},s._destroyContentWidgets=function(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]},s._setupContentWidgets=function(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,n=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(n))n.forEach(((n,s)=>{"attachments"===n.type&&(this._contentWidgets[s]=new u({displayType:n.displayType,headingLevel:t.title?e+1:e,viewModel:i[s]})),"fields"===n.type&&(this._contentWidgets[s]=new f({viewModel:i[s]})),"media"===n.type&&(this._contentWidgets[s]=new _({viewModel:i[s]})),"text"===n.type&&(this._contentWidgets[s]=new p({viewModel:i[s]})),"custom"===n.type&&(this._contentWidgets[s]=new p({viewModel:i[s]}))}),this);else{const e=i[0];e&&!e.destroyed&&(this._contentWidgets[0]=new p({viewModel:e}))}this.scheduleRender()},n}(v.FeatureContentMixin(c));return t.__decorate([s.aliasOf("viewModel.graphic")],x.prototype,"graphic",void 0),t.__decorate([s.aliasOf("viewModel.defaultPopupTemplateEnabled")],x.prototype,"defaultPopupTemplateEnabled",void 0),t.__decorate([l.property()],x.prototype,"headingLevel",void 0),t.__decorate([l.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],x.prototype,"label",void 0),t.__decorate([l.property(),m.messageBundle("esri/widgets/Feature/t9n/Feature")],x.prototype,"messages",void 0),t.__decorate([l.property(),m.messageBundle("esri/widgets/support/t9n/uriUtils")],x.prototype,"messagesURIUtils",void 0),t.__decorate([s.aliasOf("viewModel.spatialReference")],x.prototype,"spatialReference",void 0),t.__decorate([s.aliasOf("viewModel.title")],x.prototype,"title",void 0),t.__decorate([l.property()],x.prototype,"visibleElements",void 0),t.__decorate([o.cast("visibleElements")],x.prototype,"castVisibleElements",null),t.__decorate([s.aliasOf("viewModel.map")],x.prototype,"map",void 0),t.__decorate([s.aliasOf("viewModel.view")],x.prototype,"view",void 0),t.__decorate([l.property({type:h})],x.prototype,"viewModel",void 0),x=t.__decorate([a.subclass("esri.widgets.Feature")],x),x}));
