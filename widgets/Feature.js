/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../intl","../core/watchUtils","../core/accessorSupport/decorators/aliasOf","../core/arrayUtils","../core/has","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","./Widget","./Feature/FeatureAttachments","./Feature/FeatureContent","./Feature/FeatureExpression","./Feature/FeatureFields","./Feature/FeatureMedia","./Feature/FeatureViewModel","./Feature/support/FeatureContentMixin","./support/Heading","./support/widgetUtils","./support/decorators/messageBundle","../core/Logger","./support/jsxFactory","../intl/substitute"],(function(e,t,n,i,s,r,o,l,d,a,c,u,p,h,_,f,g,y,m,v,w,M,x,E,b){"use strict";const C={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},W={title:!0,content:!0,lastEditedInfo:!0};let F=function(n){function i(e,t){var i;return(i=n.call(this,e,t)||this)._contentWidgets=[],i.graphic=null,i.defaultPopupTemplateEnabled=!1,i.headingLevel=2,i.label=void 0,i.messages=null,i.messagesCommon=null,i.messagesURIUtils=null,i.spatialReference=null,i.title=null,i.visibleElements={...W},i.map=null,i.view=null,i.viewModel=new y,i}t._inheritsLoose(i,n);var r=i.prototype;return r.initialize=function(){this.own(s.init(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))},r.loadDependencies=function(){return new Promise(((t,n)=>e(["../chunks/calcite-notice"],t,n)))},r.destroy=function(){this._destroyContentWidgets()},r.castVisibleElements=function(e){return{...W,...e}},r.render=function(){const{state:e}=this.viewModel,t=E.tsx("div",{class:C.container,key:"container"},this.renderTitle(),"error"===e?this.renderError():"loading"===e?this.renderLoading():this.renderContentContainer());return E.tsx("div",{class:this.classes(C.base,C.esriWidget)},t)},r.setActiveMedia=function(e,t){this.viewModel.setActiveMedia(e,t)},r.nextMedia=function(e){this.viewModel.nextMedia(e)},r.previousMedia=function(e){this.viewModel.previousMedia(e)},r.renderError=function(){const{messagesCommon:e,messages:t,visibleElements:n}=this;return E.tsx("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},n.title?E.tsx("div",{key:"error-title",slot:"title"},e.errorMessage):null,E.tsx("div",{key:"error-message",slot:"message"},t.loadingError))},r.renderLoading=function(){return E.tsx("div",{key:"loading-container",class:C.loadingSpinnerContainer},E.tsx("span",{class:this.classes(C.iconLoading,C.spinner)}))},r.renderContentContainer=function(){const{visibleElements:e}=this;return e.content?E.tsx("div",{class:C.main},[this.renderContent(),this.renderLastEditInfo()]):null},r.renderTitle=function(){const{visibleElements:e,title:t}=this;return e.title?E.tsx(v.Heading,{level:this.headingLevel,class:C.title,innerHTML:t}):null},r.renderContent=function(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?E.tsx("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:E.tsx("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)},r.renderContentElement=function(e,t){const{visibleElements:n}=this;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}},r.renderAttachments=function(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:n,attachmentInfos:i}=t.viewModel;return"loading"===n||i.length>0?E.tsx("div",{key:this._buildKey("attachments-element",e),class:this.classes(C.contentElement)},t.render()):null},r.renderExpression=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:E.tsx("div",{key:this._buildKey("expression-element",e),class:C.contentElement},t.render())},r.renderCustom=function(e,t){const{creator:n}=e,i=this._contentWidgets[t];return!i||i.destroyed?null:n?E.tsx("div",{key:this._buildKey("custom-element",t),class:C.contentElement},i.render()):null},r.renderFields=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:E.tsx("div",{key:this._buildKey("fields-element",e),class:C.contentElement},t.render())},r.renderMedia=function(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:E.tsx("div",{key:this._buildKey("media-element",e),class:C.contentElement},t.render())},r.renderLastEditInfo=function(){const{visibleElements:e,messages:t}=this,{lastEditInfo:n}=this.viewModel;if(!n||!e.lastEditedInfo)return null;const{date:i,user:s}=n,r="edit"===n.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=b.substitute(r,{date:i,user:s});return E.tsx("div",{key:"edit-info-element",class:this.classes(C.lastEditedInfo,C.contentElement)},o)},r.renderText=function(e,t){const n=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:n?E.tsx("div",{key:this._buildKey("text-element",t),class:this.classes(C.contentElement,C.text)},i.render()):null},r._buildKey=function(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`},r._destroyContentWidget=function(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())},r._destroyContentWidgets=function(){this._contentWidgets.forEach((e=>this._destroyContentWidget(e))),this._contentWidgets=[]},r._setupContentWidgets=function(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,n=this.get("viewModel.content"),{contentViewModels:i}=this.viewModel;if(Array.isArray(n))n.forEach(((n,s)=>{"attachments"===n.type&&(this._contentWidgets[s]=new p({displayType:n.displayType,headingLevel:t.title?e+1:e,viewModel:i[s]})),"fields"===n.type&&(this._contentWidgets[s]=new f({viewModel:i[s]})),"media"===n.type&&(this._contentWidgets[s]=new g({viewModel:i[s]})),"text"===n.type&&(this._contentWidgets[s]=new h({viewModel:i[s]})),"custom"===n.type&&(this._contentWidgets[s]=new h({viewModel:i[s]})),"expression"===n.type&&(this._contentWidgets[s]=new _({viewModel:i[s]}))}),this);else{const e=i[0];e&&!e.destroyed&&(this._contentWidgets[0]=new h({viewModel:e}))}this.scheduleRender()},i}(m.FeatureContentMixin(u));n.__decorate([r.aliasOf("viewModel.graphic")],F.prototype,"graphic",void 0),n.__decorate([r.aliasOf("viewModel.defaultPopupTemplateEnabled")],F.prototype,"defaultPopupTemplateEnabled",void 0),n.__decorate([a.property()],F.prototype,"headingLevel",void 0),n.__decorate([a.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],F.prototype,"label",void 0),n.__decorate([a.property(),M.messageBundle("esri/widgets/Feature/t9n/Feature")],F.prototype,"messages",void 0),n.__decorate([a.property(),M.messageBundle("esri/t9n/common")],F.prototype,"messagesCommon",void 0),n.__decorate([a.property(),M.messageBundle("esri/widgets/support/t9n/uriUtils")],F.prototype,"messagesURIUtils",void 0),n.__decorate([r.aliasOf("viewModel.spatialReference")],F.prototype,"spatialReference",void 0),n.__decorate([r.aliasOf("viewModel.title")],F.prototype,"title",void 0),n.__decorate([a.property()],F.prototype,"visibleElements",void 0),n.__decorate([d.cast("visibleElements")],F.prototype,"castVisibleElements",null),n.__decorate([r.aliasOf("viewModel.map")],F.prototype,"map",void 0),n.__decorate([r.aliasOf("viewModel.view")],F.prototype,"view",void 0),n.__decorate([a.property({type:y})],F.prototype,"viewModel",void 0),F=n.__decorate([c.subclass("esri.widgets.Feature")],F);return F}));
