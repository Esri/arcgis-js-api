// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../../Color","./support/colors","./support/SymbologyBase","./support/utils"],(function(e,r,a,o,n,t,s){"use strict";var i={light:{color:[153,153,153,.25],width:"1px"},dark:{color:[153,153,153,.25],width:"1px"},darker:{color:[26,26,26,.25],width:"1px"}},l={lightBasemaps:{primary:"relationship-blue-orange-brown",secondary:["relationship-brewer-yellow-blue-black","relationship-brewer-pink-blue-purple","relationship-purple-green-blue","relationship-blue-green-purple","relationship-blue-orange-green","relationship-mustard-blue-wine","relationship-pink-blue-purple","relationship-olive-blue-green","relationship-yellow-cyan-blue","relationship-blue-pink-purple","relationship-purple-green-wine","relationship-blue-peach-purple","relationship-mint-mustard-green","relationship-purple-mustard-darkpurple","relationship-blue-orange-purple","relationship-pink-periwinkle-violet","relationship-blue-tan-green","relationship-blue-red-pink","relationship-blue-green-brightgreen","relationship-blue-orange-lavender","relationship-pink-purple-peach","relationship-purple-mustard-eggshell","relationship-blue-brick-green","relationship-orange-purple-lavender","relationship-brown-purple-lilac","relationship-teal-yellow-lightteal"]},darkBasemaps:{primary:"relationship-blue-green-brightgreen",secondary:["relationship-blue-red-pink","relationship-blue-orange-lavender","relationship-pink-purple-peach","relationship-purple-mustard-eggshell","relationship-blue-brick-green","relationship-orange-purple-lavender","relationship-brown-purple-lilac","relationship-teal-yellow-lightteal","relationship-blue-orange-brown","relationship-brewer-yellow-blue-black","relationship-brewer-pink-blue-purple","relationship-purple-green-blue","relationship-blue-green-purple","relationship-blue-orange-green","relationship-mustard-blue-wine","relationship-pink-blue-purple","relationship-olive-blue-green","relationship-yellow-cyan-blue","relationship-blue-pink-purple","relationship-purple-green-wine","relationship-blue-peach-purple","relationship-mint-mustard-green","relationship-purple-mustard-darkpurple","relationship-blue-orange-purple","relationship-pink-periwinkle-violet","relationship-blue-tan-green"]}},p={default:{name:"default",label:"Default",description:"Default theme for visualizing features based on relationship between two attributes.",schemes:{point:{light:{common:{noDataColor:"#aaaaaa",outline:i.light,size:"8px"},primary:l.lightBasemaps.primary,secondary:l.lightBasemaps.secondary},dark:{common:{noDataColor:"#aaaaaa",outline:i.darker,size:"8px"},primary:l.darkBasemaps.primary,secondary:l.darkBasemaps.secondary}},polyline:{light:{common:{noDataColor:"#aaaaaa",width:"2px"},primary:l.lightBasemaps.primary,secondary:l.lightBasemaps.secondary},dark:{common:{noDataColor:"#aaaaaa",width:"2px"},primary:l.darkBasemaps.primary,secondary:l.darkBasemaps.secondary}},polygon:{light:{common:{noDataColor:"#aaaaaa",outline:i.light,fillOpacity:.8},primary:l.lightBasemaps.primary,secondary:l.lightBasemaps.secondary},dark:{common:{noDataColor:"#aaaaaa",outline:i.dark,fillOpacity:.8},primary:l.darkBasemaps.primary,secondary:l.darkBasemaps.secondary}}}}};function u(e,r,t){var i="mesh"!==e.geometryType&&e.worldScale?e.view:null,l=n[r],p=e.theme||"default";if(l){var u,m=p+"/"+e.basemap+"/"+r,h=[];for(var y in l)if("stops"!==y&&"name"!==y&&"tags"!==y){var d=+y,g=l[y];h.push({numClasses:d,colors:g})}switch(e.geometryType){case"point":case"multipoint":var f=t;return function(e,r){return{id:e.id,name:e.name,tags:a.__spreadArrays(e.tags),colorsForClassBreaks:c(e.colorsForClassBreaks),noDataColor:new o(e.noDataColor),outline:{color:new o(e.outline.color),width:e.outline.width},size:r?s.toWorldScale(e.size,r):e.size,opacity:e.opacity}}({id:m,name:l.name,tags:l.tags,colorsForClassBreaks:h,noDataColor:f.noDataColor,opacity:1,outline:f.outline,size:f.size},i);case"polyline":var C=t;return function(e,r){return{id:e.id,name:e.name,tags:a.__spreadArrays(e.tags),colorsForClassBreaks:c(e.colorsForClassBreaks),noDataColor:new o(e.noDataColor),opacity:e.opacity,width:r?s.toWorldScale(e.width,r):e.width}}({id:m,name:l.name,tags:l.tags,colorsForClassBreaks:h,noDataColor:C.noDataColor,opacity:1,width:C.width},i);case"polygon":var b=t,w={id:m,name:l.name,tags:l.tags,colorsForClassBreaks:h,noDataColor:b.noDataColor,opacity:b.fillOpacity,outline:b.outline};return{id:(u=w).id,name:u.name,tags:a.__spreadArrays(u.tags),colorsForClassBreaks:c(u.colorsForClassBreaks),noDataColor:new o(u.noDataColor),outline:{color:new o(u.outline.color),width:u.outline.width},opacity:u.opacity};case"mesh":var k=t;return function(e){return{id:e.id,name:e.name,tags:a.__spreadArrays(e.tags),colorsForClassBreaks:c(e.colorsForClassBreaks),noDataColor:new o(e.noDataColor),opacity:e.opacity}}({id:m,name:l.name,tags:l.tags,colorsForClassBreaks:h,noDataColor:k.noDataColor,opacity:k.fillOpacity})}}}function c(e){return e.map((function(e){return{numClasses:e.numClasses,colors:e.colors.map((function(e){return e.map((function(e){return new o(e)}))}))}}))}return new(function(e){function r(){return e.call(this,{themeDictionary:p})||this}return a.__extends(r,e),r.prototype.getSchemes=function(e){var r=this.getRawSchemes({theme:"default",basemap:e.basemap,geometryType:e.geometryType,basemapTheme:e.basemapTheme});if(r){var o=r.schemesInfo,n=r.basemapId,t=r.basemapTheme,s=a.__assign(a.__assign({},e),{basemap:n});return{primaryScheme:u(s,o.primary,o.common),secondarySchemes:o.secondary.map((function(e){return u(s,e,o.common)})).filter(Boolean),basemapId:n,basemapTheme:t}}},r.prototype.getSchemeByName=function(e){return this.filterSchemesByName(e)},r.prototype.getSchemesByTag=function(e){return this.filterSchemesByTag(e)},r.prototype.cloneScheme=function(e){if(e){var r=a.__assign({},e);return r.colorsForClassBreaks=r.colorsForClassBreaks.map((function(e){return{numClasses:e.numClasses,colors:e.colors.map((function(e){return e.map((function(e){return new o(e)}))}))}})),r.noDataColor&&(r.noDataColor=new o(r.noDataColor)),"outline"in r&&r.outline&&(r.outline={color:r.outline.color&&new o(r.outline.color),width:r.outline.width}),r}},r.prototype.flatten2DArray=function(e,r){var a=[],o=(r||"HH").split(""),n=o[0],t=o[1];"L"===n&&e.reverse();var s="H"===t;return e.forEach((function(e){s&&e.reverse(),a=a.concat(e)})),a},r.prototype.getColors=function(e,r,a){var n;return e.colorsForClassBreaks.some((function(e){return e.numClasses===r&&(n=e.colors),!!n})),(n=n.map((function(e){return e.map((function(e){return new o(e)}))})))?this.flatten2DArray(n,a):null},r.prototype.flipColors=function(e,r){var a=r?e:this.cloneScheme(e);return a.colorsForClassBreaks.forEach((function(e){for(var r=e.colors.reverse(),a=[],o=function(e){var o=[];r.forEach((function(r){o.push(r[e])})),a.push(o)},n=0;n<e.numClasses;n++)o(n);e.colors=a})),a},r.prototype.getMatchingSchemes=function(e){var r=this,a=e.theme||"default",o=e.geometryType,n=e.colors,t=e.numClasses,s=this.themes.get(a);if(s){var i=s.supportedBasemaps,l=[];return i.forEach((function(e){var s=r.getSchemes({theme:a,basemap:e,geometryType:o});if(s){var i=r._compareColorsComprehensive(s.primaryScheme,n,t);i&&l.push(i),s.secondarySchemes.forEach((function(e){(i=r._compareColorsComprehensive(e,n,t))&&l.push(i)}))}})),l}},r.prototype._compareColors=function(e,r,a,o){var n,t=this.getColors(e,a,o);t&&(1===s.hasIdenticalColors(r,t)&&(n=e));return n},r.prototype._compareColorsByFocus=function(e,r,a,o){var n,t=1;do{(n=this._compareColors(e,r,a,o))||(e=this.flipColors(e),t++)}while(!n&&t<=4);return n},r.prototype._compareColorsComprehensive=function(e,r,a){return this._compareColorsByFocus(e,r,a,"HH")||this._compareColorsByFocus(e,r,a,"HL")||this._compareColorsByFocus(e,r,a,"LH")||this._compareColorsByFocus(e,r,a,"LL")},r}(t))}));