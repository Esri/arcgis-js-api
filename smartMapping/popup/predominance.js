// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.17/esri/copyright.txt for details.

define(["require","exports","tslib","../../PopupTemplate","../../core/Error","../../core/promiseUtils","../../intl/messages","../../intl/substitute","../../popup/ExpressionInfo","../../popup/FieldInfo","./support/utils","../statistics/support/predominanceUtils"],(function(e,n,t,i,o,r,s,a,f,l,d,p){"use strict";function u(e,n){return e.legendOptions&&e.legendOptions.title?e.legendOptions.title:n.competingFields}function m(e,n){return{fieldInfo:new l({fieldName:"expression/predominant-category"}),expressionInfo:new f({name:"predominant-category",title:n.predominantCategory,expression:p.getArcadeForPredominantCategoryAlias(e)})}}function I(e,n){var t=e.map((function(e){return e.fieldName}));return{fieldInfo:new l({fieldName:"expression/predominant-value",format:{digitSeparator:!0,places:1}}),expressionInfo:new f({name:"predominant-value",title:n.predominantCategoryValue,expression:p.getArcadeForPredominantCategoryValue(t),returnType:"number"})}}function c(e,n){var t=e.map((function(e){return e.fieldName}));return{fieldInfo:new l({fieldName:"expression/predominant-strength",format:{digitSeparator:!0,places:0}}),expressionInfo:new f({name:"predominant-strength",title:n.strengthOfPredominance,expression:p.getArcadeForStrengthOfPredominance(t),returnType:"number"})}}function g(e,n){var t=m(e.fieldInfos,n),o=new i({expressionInfos:[t.expressionInfo],fieldInfos:[t.fieldInfo],content:a.substitute(n.predominantCategoryContent,{expression:"<b>{"+t.fieldInfo.fieldName+"}</b>"})});return{name:"predominant-category",title:n.predominantCategory,value:o}}function x(e,n){var t=e.fieldInfos,o=m(t,n),r=I(t,n),s=new i({expressionInfos:[r.expressionInfo,o.expressionInfo],fieldInfos:[r.fieldInfo,o.fieldInfo],content:a.substitute(n.predominantCategoryValueContent,{expression1:"<b>{"+o.fieldInfo.fieldName+"}</b>",expression2:"<b>{"+r.fieldInfo.fieldName+"}</b>"})});return{name:"predominant-category-value",title:n.predominantCategoryValue,value:s}}function b(e,n){var t=e.fieldInfos,o=m(t,n),r=I(t,n),s=function(e,n){var t=e.map((function(e){return e.fieldName}));return{fieldInfo:new l({fieldName:"expression/predominant-margin",format:{digitSeparator:!0,places:0}}),expressionInfo:new f({name:"predominant-margin",title:n.marginOfVictory,expression:p.getArcadeForPredominanceMargin(t),returnType:"number"})}}(t,n),d=new i({expressionInfos:[r.expressionInfo,o.expressionInfo,s.expressionInfo],fieldInfos:[r.fieldInfo,o.fieldInfo,s.fieldInfo],title:a.substitute(n.mostCommon,{expression:"{expression/predominant-category}"}),content:a.substitute(n.predominantCategoryValueMarginContent,{expression1:"<b>{"+o.fieldInfo.fieldName+"}</b>",expression2:"<b>{"+r.fieldInfo.fieldName+"}</b>",expression3:"<b>{"+s.fieldInfo.fieldName+"}</b>"})});return{name:"predominant-category-value-margin",title:n.marginOfVictory,value:d}}function y(e,n){var t=e.fieldInfos,o=m(t,n),r=I(t,n),s=c(t,n),f=new i({expressionInfos:[r.expressionInfo,o.expressionInfo,s.expressionInfo],fieldInfos:[r.fieldInfo,o.fieldInfo,s.fieldInfo],content:a.substitute(n.predominantCategoryStrengthContent,{expression1:"{"+r.fieldInfo.fieldName+"}",expression2:"<b>{"+o.fieldInfo.fieldName+"}</b>",expression3:"<b>{"+s.fieldInfo.fieldName+"}%</b>"})});return{name:"predominant-category-strength",title:n.strengthOfPredominance,value:f}}function v(e,n){var t=e.renderer,o=e.fieldInfos,r=m(o,n),s=I(o,n),d=c(o,n),g=function(e,n){return{fieldInfo:new l({fieldName:"expression/predominant-categories-list"}),expressionInfo:new f({name:"predominant-categories-list",title:n.listOfCategories,expression:p.getArcadeForOrderedFields(e)})}}(o,n),x=new i({expressionInfos:[r.expressionInfo,s.expressionInfo,d.expressionInfo,g.expressionInfo],fieldInfos:[r.fieldInfo,s.fieldInfo,d.fieldInfo,g.fieldInfo],title:u(t,n),content:[{type:"text",text:a.substitute(n.predominantCategoryStrengthContent,{expression1:"{"+s.fieldInfo.fieldName+"}",expression2:"<b>{"+r.fieldInfo.fieldName+"}</b>",expression3:"<b>{"+d.fieldInfo.fieldName+"}%</b>"})},{type:"text",text:"{"+g.fieldInfo.fieldName+"}"}]});return{name:"predominant-categories-list",title:n.orderedListOfValues,value:x}}function h(e,n){var t=e.fieldInfos,o=m(t,n),r=I(t,n),s=c(t,n),d=function(e,n){var t=e.map((function(e){return e.fieldName}));return{fieldInfo:new l({fieldName:"expression/predominant-total",format:{digitSeparator:!0,places:0}}),expressionInfo:new f({name:"predominant-total",title:n.sumOfCategories,expression:p.getArcadeForSumOfFields(t),returnType:"number"})}}(t,n),u=new i({expressionInfos:[r.expressionInfo,o.expressionInfo,d.expressionInfo,s.expressionInfo],fieldInfos:[r.fieldInfo,o.fieldInfo,d.fieldInfo,s.fieldInfo],content:a.substitute(n.predominantCategoryTotalStrengthContent,{expression1:"{"+r.fieldInfo.fieldName+"}",expression2:"<b>{"+o.fieldInfo.fieldName+"}</b>",expression3:"<b>{"+s.fieldInfo.fieldName+"}%</b>",expression4:"{"+d.fieldInfo.fieldName+"}"})});return{name:"predominant-category-total-strength",title:n.predominantCategoryWithTotalAndStrength,value:u}}function N(e,n){var t=e.renderer,o=e.fieldInfos,r=m(o,n),s=I(o,n),f=c(o,n),l=new i({expressionInfos:[s.expressionInfo,r.expressionInfo,f.expressionInfo],fieldInfos:[s.fieldInfo,r.fieldInfo,f.fieldInfo],title:u(t,n),content:[{type:"text",text:a.substitute(n.predominantCategoryStrengthContent,{expression1:"{"+s.fieldInfo.fieldName+"}",expression2:"<b>{"+r.fieldInfo.fieldName+"}</b>",expression3:"<b>{"+f.fieldInfo.fieldName+"}%</b>"})},{type:"media",mediaInfos:{type:"pie-chart",value:{fields:o.map((function(e){return e.fieldName}))}}}]});return{name:"predominant-category-chart",title:n.predominantCategoryWithChart,value:l}}function w(e){return t.__awaiter(this,void 0,void 0,(function(){var n,i,r,s;return t.__generator(this,(function(t){switch(t.label){case 0:return n=e.layer,i=e.renderer,[4,n.load()];case 1:if(t.sent(),"unique-value"!==(r=i||n.renderer).type)throw new o("predmoinance-popup:invalid-parameters","renderer.type must be 'unique-value'");return s=function(e,n){var t=e.authoringInfo,i="predominance"===t.type?t.fields:[];if(!i||!i.length)throw new o("predominance-popup:insufficient-info","unable to find input fields in authoringInfo");return i.map((function(e){return d.getFieldInfo(n,e)}))}(r,n),[2,{renderer:r,fieldInfos:s}]}}))}))}function C(e){return t.__awaiter(this,void 0,void 0,(function(){var n,i,o;return t.__generator(this,(function(t){switch(t.label){case 0:return[4,r.all([w(e),s.loadMessageBundle("esri/smartMapping/t9n/smartMapping")])];case 1:return n=t.sent(),i=n[0],o=n[1],[2,[g(i,o),x(i,o),b(i,o),h(i,o),v(i,o),y(i,o),N(i,o)]]}}))}))}Object.defineProperty(n,"__esModule",{value:!0}),n.getTemplates=n.getAllTemplates=void 0,n.getAllTemplates=C,n.getTemplates=function(e){return t.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,f;return t.__generator(this,(function(t){switch(t.label){case 0:return[4,r.all([w(e),s.loadMessageBundle("esri/smartMapping/t9n/smartMapping")])];case 1:return n=t.sent(),i=n[0],o=n[1],a=v(i,o),[4,C(e)];case 2:return f=t.sent(),[2,{primaryTemplate:a,secondaryTemplates:f.filter((function(e){return e.name!==a.name}))}]}}))}))}}));