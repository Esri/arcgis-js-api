/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/Error","../../popup/FieldInfo","../../popup/ExpressionInfo","../../PopupTemplate","../../intl/substitute","../../intl/messages","../statistics/support/predominanceUtils","./support/utils"],(function(e,n,t,o,i,r,s,f,a){"use strict";function l(e,n){return e.legendOptions&&e.legendOptions.title?e.legendOptions.title:n.competingFields}function d(e,n){return{fieldInfo:new t({fieldName:"expression/predominant-category"}),expressionInfo:new o({name:"predominant-category",title:n.predominantCategory,expression:f.getArcadeForPredominantCategoryAlias(e)})}}function p(e,n){const i=e.map((e=>e.fieldName));return{fieldInfo:new t({fieldName:"expression/predominant-value",format:{digitSeparator:!0,places:1}}),expressionInfo:new o({name:"predominant-value",title:n.predominantCategoryValue,expression:f.getArcadeForPredominantCategoryValue(i),returnType:"number"})}}function m(e,n){const i=e.map((e=>e.fieldName));return{fieldInfo:new t({fieldName:"expression/predominant-margin",format:{digitSeparator:!0,places:0}}),expressionInfo:new o({name:"predominant-margin",title:n.marginOfVictory,expression:f.getArcadeForPredominanceMargin(i),returnType:"number"})}}function u(e,n){const i=e.map((e=>e.fieldName));return{fieldInfo:new t({fieldName:"expression/predominant-strength",format:{digitSeparator:!0,places:0}}),expressionInfo:new o({name:"predominant-strength",title:n.strengthOfPredominance,expression:f.getArcadeForStrengthOfPredominance(i),returnType:"number"})}}function I(e,n){return{fieldInfo:new t({fieldName:"expression/predominant-categories-list"}),expressionInfo:new o({name:"predominant-categories-list",title:n.listOfCategories,expression:f.getArcadeForOrderedFields(e)})}}function c(e,n){const i=e.map((e=>e.fieldName));return{fieldInfo:new t({fieldName:"expression/predominant-total",format:{digitSeparator:!0,places:0}}),expressionInfo:new o({name:"predominant-total",title:n.sumOfCategories,expression:f.getArcadeForSumOfFields(i),returnType:"number"})}}function g(e,n){const t=d(e.fieldInfos,n),o=new i({expressionInfos:[t.expressionInfo],fieldInfos:[t.fieldInfo],content:r.substitute(n.predominantCategoryContent,{expression:`<b>{${t.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category",title:n.predominantCategory,value:o}}function x(e,n){const{fieldInfos:t}=e,o=d(t,n),s=p(t,n),f=new i({expressionInfos:[s.expressionInfo,o.expressionInfo],fieldInfos:[s.fieldInfo,o.fieldInfo],content:r.substitute(n.predominantCategoryValueContent,{expression1:`<b>{${o.fieldInfo.fieldName}}</b>`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value",title:n.predominantCategoryValue,value:f}}function y(e,n){const{fieldInfos:t}=e,o=d(t,n),s=p(t,n),f=m(t,n),a=new i({expressionInfos:[s.expressionInfo,o.expressionInfo,f.expressionInfo],fieldInfos:[s.fieldInfo,o.fieldInfo,f.fieldInfo],title:r.substitute(n.mostCommon,{expression:"{expression/predominant-category}"}),content:r.substitute(n.predominantCategoryValueMarginContent,{expression1:`<b>{${o.fieldInfo.fieldName}}</b>`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value-margin",title:n.marginOfVictory,value:a}}function b(e,n){const{fieldInfos:t}=e,o=d(t,n),s=p(t,n),f=u(t,n),a=new i({expressionInfos:[s.expressionInfo,o.expressionInfo,f.expressionInfo],fieldInfos:[s.fieldInfo,o.fieldInfo,f.fieldInfo],content:r.substitute(n.predominantCategoryStrengthContent,{expression1:`{${s.fieldInfo.fieldName}}`,expression2:`<b>{${o.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}%</b>`})});return{name:"predominant-category-strength",title:n.strengthOfPredominance,value:a}}function N(e,n){const{renderer:t,fieldInfos:o}=e,s=d(o,n),f=p(o,n),a=u(o,n),m=I(o,n),c=new i({expressionInfos:[s.expressionInfo,f.expressionInfo,a.expressionInfo,m.expressionInfo],fieldInfos:[s.fieldInfo,f.fieldInfo,a.fieldInfo,m.fieldInfo],title:l(t,n),content:[{type:"text",text:r.substitute(n.predominantCategoryStrengthContent,{expression1:`{${f.fieldInfo.fieldName}}`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`,expression3:`<b>{${a.fieldInfo.fieldName}}%</b>`})},{type:"text",text:`{${m.fieldInfo.fieldName}}`}]});return{name:"predominant-categories-list",title:n.orderedListOfValues,value:c}}function w(e,n){const{fieldInfos:t}=e,o=d(t,n),s=p(t,n),f=u(t,n),a=c(t,n),l=new i({expressionInfos:[s.expressionInfo,o.expressionInfo,a.expressionInfo,f.expressionInfo],fieldInfos:[s.fieldInfo,o.fieldInfo,a.fieldInfo,f.fieldInfo],content:r.substitute(n.predominantCategoryTotalStrengthContent,{expression1:`{${s.fieldInfo.fieldName}}`,expression2:`<b>{${o.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}%</b>`,expression4:`{${a.fieldInfo.fieldName}}`})});return{name:"predominant-category-total-strength",title:n.predominantCategoryWithTotalAndStrength,value:l}}function C(e,n){const{renderer:t,fieldInfos:o}=e,s=d(o,n),f=p(o,n),a=u(o,n),m=new i({expressionInfos:[f.expressionInfo,s.expressionInfo,a.expressionInfo],fieldInfos:[f.fieldInfo,s.fieldInfo,a.fieldInfo],title:l(t,n),content:[{type:"text",text:r.substitute(n.predominantCategoryStrengthContent,{expression1:`{${f.fieldInfo.fieldName}}`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`,expression3:`<b>{${a.fieldInfo.fieldName}}%</b>`})},{type:"media",mediaInfos:{type:"pie-chart",value:{fields:o.map((e=>e.fieldName))}}}]});return{name:"predominant-category-chart",title:n.predominantCategoryWithChart,value:m}}function h(e,t){const o=e.authoringInfo,i="predominance"===o.type?o.fields:[];if(!i||!i.length)throw new n("predominance-popup:insufficient-info","unable to find input fields in authoringInfo");return i.map((e=>a.getFieldInfo(t,e)))}async function $(e){const{layer:t,renderer:o}=e;await t.load();const i=o||t.renderer;if("unique-value"!==i.type)throw new n("predmoinance-popup:invalid-parameters","renderer.type must be 'unique-value'");return{renderer:i,fieldInfos:h(i,t)}}async function v(e){const[n,t]=await Promise.all([$(e),s.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]);return[g(n,t),x(n,t),y(n,t),w(n,t),N(n,t),b(n,t),C(n,t)]}async function O(e){const[n,t]=await Promise.all([$(e),s.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]),o=N(n,t),i=await v(e);return{primaryTemplate:o,secondaryTemplates:i.filter((e=>e.name!==o.name))}}e.getAllTemplates=v,e.getTemplates=O,Object.defineProperty(e,"__esModule",{value:!0})}));
