/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/Error","../../core/promiseUtils","../../popup/FieldInfo","../../popup/ExpressionInfo","../../PopupTemplate","../../intl/substitute","../../intl/messages","../statistics/support/predominanceUtils","./support/utils"],(function(e,n,t,o,i,r,s,f,a,l){"use strict";function d(e,n){return e.legendOptions&&e.legendOptions.title?e.legendOptions.title:n.competingFields}function p(e,n){return{fieldInfo:new o({fieldName:"expression/predominant-category"}),expressionInfo:new i({name:"predominant-category",title:n.predominantCategory,expression:a.getArcadeForPredominantCategoryAlias(e)})}}function m(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new o({fieldName:"expression/predominant-value",format:{digitSeparator:!0,places:1}}),expressionInfo:new i({name:"predominant-value",title:n.predominantCategoryValue,expression:a.getArcadeForPredominantCategoryValue(t),returnType:"number"})}}function u(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new o({fieldName:"expression/predominant-strength",format:{digitSeparator:!0,places:0}}),expressionInfo:new i({name:"predominant-strength",title:n.strengthOfPredominance,expression:a.getArcadeForStrengthOfPredominance(t),returnType:"number"})}}function I(e,n){const t=p(e.fieldInfos,n),o=new r({expressionInfos:[t.expressionInfo],fieldInfos:[t.fieldInfo],content:s.substitute(n.predominantCategoryContent,{expression:`<b>{${t.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category",title:n.predominantCategory,value:o}}function c(e,n){const{fieldInfos:t}=e,o=p(t,n),i=m(t,n),f=new r({expressionInfos:[i.expressionInfo,o.expressionInfo],fieldInfos:[i.fieldInfo,o.fieldInfo],content:s.substitute(n.predominantCategoryValueContent,{expression1:`<b>{${o.fieldInfo.fieldName}}</b>`,expression2:`<b>{${i.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value",title:n.predominantCategoryValue,value:f}}function g(e,n){const{fieldInfos:t}=e,f=p(t,n),l=m(t,n),d=function(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new o({fieldName:"expression/predominant-margin",format:{digitSeparator:!0,places:0}}),expressionInfo:new i({name:"predominant-margin",title:n.marginOfVictory,expression:a.getArcadeForPredominanceMargin(t),returnType:"number"})}}(t,n),u=new r({expressionInfos:[l.expressionInfo,f.expressionInfo,d.expressionInfo],fieldInfos:[l.fieldInfo,f.fieldInfo,d.fieldInfo],title:s.substitute(n.mostCommon,{expression:"{expression/predominant-category}"}),content:s.substitute(n.predominantCategoryValueMarginContent,{expression1:`<b>{${f.fieldInfo.fieldName}}</b>`,expression2:`<b>{${l.fieldInfo.fieldName}}</b>`,expression3:`<b>{${d.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value-margin",title:n.marginOfVictory,value:u}}function x(e,n){const{fieldInfos:t}=e,o=p(t,n),i=m(t,n),f=u(t,n),a=new r({expressionInfos:[i.expressionInfo,o.expressionInfo,f.expressionInfo],fieldInfos:[i.fieldInfo,o.fieldInfo,f.fieldInfo],content:s.substitute(n.predominantCategoryStrengthContent,{expression1:`{${i.fieldInfo.fieldName}}`,expression2:`<b>{${o.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}%</b>`})});return{name:"predominant-category-strength",title:n.strengthOfPredominance,value:a}}function y(e,n){const{renderer:t,fieldInfos:f}=e,l=p(f,n),I=m(f,n),c=u(f,n),g=function(e,n){return{fieldInfo:new o({fieldName:"expression/predominant-categories-list"}),expressionInfo:new i({name:"predominant-categories-list",title:n.listOfCategories,expression:a.getArcadeForOrderedFields(e)})}}(f,n),x=new r({expressionInfos:[l.expressionInfo,I.expressionInfo,c.expressionInfo,g.expressionInfo],fieldInfos:[l.fieldInfo,I.fieldInfo,c.fieldInfo,g.fieldInfo],title:d(t,n),content:[{type:"text",text:s.substitute(n.predominantCategoryStrengthContent,{expression1:`{${I.fieldInfo.fieldName}}`,expression2:`<b>{${l.fieldInfo.fieldName}}</b>`,expression3:`<b>{${c.fieldInfo.fieldName}}%</b>`})},{type:"text",text:`{${g.fieldInfo.fieldName}}`}]});return{name:"predominant-categories-list",title:n.orderedListOfValues,value:x}}function b(e,n){const{fieldInfos:t}=e,f=p(t,n),l=m(t,n),d=u(t,n),I=function(e,n){const t=e.map((e=>e.fieldName));return{fieldInfo:new o({fieldName:"expression/predominant-total",format:{digitSeparator:!0,places:0}}),expressionInfo:new i({name:"predominant-total",title:n.sumOfCategories,expression:a.getArcadeForSumOfFields(t),returnType:"number"})}}(t,n),c=new r({expressionInfos:[l.expressionInfo,f.expressionInfo,I.expressionInfo,d.expressionInfo],fieldInfos:[l.fieldInfo,f.fieldInfo,I.fieldInfo,d.fieldInfo],content:s.substitute(n.predominantCategoryTotalStrengthContent,{expression1:`{${l.fieldInfo.fieldName}}`,expression2:`<b>{${f.fieldInfo.fieldName}}</b>`,expression3:`<b>{${d.fieldInfo.fieldName}}%</b>`,expression4:`{${I.fieldInfo.fieldName}}`})});return{name:"predominant-category-total-strength",title:n.predominantCategoryWithTotalAndStrength,value:c}}function N(e,n){const{renderer:t,fieldInfos:o}=e,i=p(o,n),f=m(o,n),a=u(o,n),l=new r({expressionInfos:[f.expressionInfo,i.expressionInfo,a.expressionInfo],fieldInfos:[f.fieldInfo,i.fieldInfo,a.fieldInfo],title:d(t,n),content:[{type:"text",text:s.substitute(n.predominantCategoryStrengthContent,{expression1:`{${f.fieldInfo.fieldName}}`,expression2:`<b>{${i.fieldInfo.fieldName}}</b>`,expression3:`<b>{${a.fieldInfo.fieldName}}%</b>`})},{type:"media",mediaInfos:{type:"pie-chart",value:{fields:o.map((e=>e.fieldName))}}}]});return{name:"predominant-category-chart",title:n.predominantCategoryWithChart,value:l}}async function w(e){const{layer:t,renderer:o}=e;await t.load();const i=o||t.renderer;if("unique-value"!==i.type)throw new n("predmoinance-popup:invalid-parameters","renderer.type must be 'unique-value'");return{renderer:i,fieldInfos:function(e,t){const o=e.authoringInfo,i="predominance"===o.type?o.fields:[];if(!i||!i.length)throw new n("predominance-popup:insufficient-info","unable to find input fields in authoringInfo");return i.map((e=>l.getFieldInfo(t,e)))}(i,t)}}async function C(e){const[n,o]=await t.all([w(e),f.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]);return[I(n,o),c(n,o),g(n,o),b(n,o),y(n,o),x(n,o),N(n,o)]}e.getAllTemplates=C,e.getTemplates=async function(e){const[n,o]=await t.all([w(e),f.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]),i=y(n,o),r=await C(e);return{primaryTemplate:i,secondaryTemplates:r.filter((e=>e.name!==i.name))}},Object.defineProperty(e,"__esModule",{value:!0})}));
