/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/Error","../../core/promiseUtils","../../popup/FieldInfo","../../popup/ExpressionInfo","../../PopupTemplate","../../intl/messages","../statistics/support/predominanceUtils","./support/utils"],(function(e,n,t,i,s,o,r,a,d){"use strict";async function f(e){const{layer:t,renderer:i}=e;await t.load();const s=i||t.renderer;if("dot-density"!==s.type)throw new n("dot-density-popup:invalid-parameters","renderer.type must be 'dot-density'");return{layer:t,renderer:s}}async function l(e,n){const{fieldInfos:t,expressionInfos:i}=await d.getFieldAndExpressionInfos({renderer:e,layer:n});return new o({content:await d.getContentFromFieldInfos(n,{fieldInfos:t,expressionInfos:i}),expressionInfos:i,fieldInfos:t})}async function p(e,n,t){const{fieldInfos:r,expressionInfos:f}=await d.getFieldAndExpressionInfos({renderer:e,layer:n}),l=r.filter((e=>-1===e.fieldName.indexOf(d.expressionFieldPrefix))),p={fieldInfo:new i({fieldName:"expression/dot-density-categories-list"}),expressionInfo:new s({name:"dot-density-categories-list",title:t.listOfCategories,expression:a.getArcadeForOrderedFields(l,f)})},c=new o({expressionInfos:[p.expressionInfo],fieldInfos:[p.fieldInfo],title:t.competingFields,content:`{${p.fieldInfo.fieldName}}`});return{name:"dot-density-categories-list",title:t.orderedListOfValues,value:c}}async function c(e,n,t){const{fieldInfos:r,expressionInfos:f}=await d.getFieldAndExpressionInfos({renderer:e,layer:n}),l=r.filter((e=>-1===e.fieldName.indexOf(d.expressionFieldPrefix))),p={fieldInfo:new i({fieldName:"expression/dot-density-category"}),expressionInfo:new s({name:"dot-density-category",title:t.predominantCategory,expression:a.getArcadeForPredominantCategoryAlias(l,f)})},c=new o({expressionInfos:[p.expressionInfo,...f],fieldInfos:[p.fieldInfo,...r],content:[{type:"text",text:`<div><b><font size="3">{${p.fieldInfo.fieldName}}</font></b></div>`},{type:"media",mediaInfos:{type:"pie-chart",title:t.competingFields,value:{fields:r.map((e=>e.fieldName))}}}]});return{name:"dot-density-category-chart",title:t.predominantCategoryWithChart,value:c}}e.getTemplates=async function(e){const[{renderer:n,layer:i},s]=await t.all([f(e),r.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]);return{primaryTemplate:{name:"dot-density",title:s.dotDensity,value:await l(n,i)},secondaryTemplates:[await p(n,i,s),await c(n,i,s)]}},Object.defineProperty(e,"__esModule",{value:!0})}));
