/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/Error","../../popup/FieldInfo","../../popup/ExpressionInfo","../../PopupTemplate","../../intl/messages","../statistics/support/predominanceUtils","./support/utils"],(function(e,n,t,i,s,o,r,a){"use strict";async function d(e){const{layer:t,renderer:i}=e;await t.load();const s=i||t.renderer;if("dot-density"!==s.type)throw new n("dot-density-popup:invalid-parameters","renderer.type must be 'dot-density'");return{layer:t,renderer:s}}async function f(e,n){const{fieldInfos:t,expressionInfos:i}=await a.getFieldAndExpressionInfos({renderer:e,layer:n});return new s({content:await a.getContentFromFieldInfos(n,{fieldInfos:t,expressionInfos:i}),expressionInfos:i,fieldInfos:t})}async function l(e,n,o){const{fieldInfos:d,expressionInfos:f}=await a.getFieldAndExpressionInfos({renderer:e,layer:n}),l=d.filter((e=>-1===e.fieldName.indexOf(a.expressionFieldPrefix))),p={fieldInfo:new t({fieldName:"expression/dot-density-categories-list"}),expressionInfo:new i({name:"dot-density-categories-list",title:o.listOfCategories,expression:r.getArcadeForOrderedFields(l,f)})},c=new s({expressionInfos:[p.expressionInfo],fieldInfos:[p.fieldInfo],title:o.competingFields,content:`{${p.fieldInfo.fieldName}}`});return{name:"dot-density-categories-list",title:o.orderedListOfValues,value:c}}async function p(e,n,o){const{fieldInfos:d,expressionInfos:f}=await a.getFieldAndExpressionInfos({renderer:e,layer:n}),l=d.filter((e=>-1===e.fieldName.indexOf(a.expressionFieldPrefix))),p={fieldInfo:new t({fieldName:"expression/dot-density-category"}),expressionInfo:new i({name:"dot-density-category",title:o.predominantCategory,expression:r.getArcadeForPredominantCategoryAlias(l,f)})},c=new s({expressionInfos:[p.expressionInfo,...f],fieldInfos:[p.fieldInfo,...d],content:[{type:"text",text:`<div><b><font size="3">{${p.fieldInfo.fieldName}}</font></b></div>`},{type:"media",mediaInfos:{type:"pie-chart",title:o.competingFields,value:{fields:d.map((e=>e.fieldName))}}}]});return{name:"dot-density-category-chart",title:o.predominantCategoryWithChart,value:c}}async function c(e){const[{renderer:n,layer:t},i]=await Promise.all([d(e),o.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]);return{primaryTemplate:{name:"dot-density",title:i.dotDensity,value:await f(n,t)},secondaryTemplates:[await l(n,t,i),await p(n,t,i)]}}e.getTemplates=c,Object.defineProperty(e,"__esModule",{value:!0})}));
