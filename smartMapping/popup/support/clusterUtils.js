/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../intl/substitute","../../../layers/support/fieldUtils","../../../popup/content/AttachmentsContent","../../../popup/content/Content","../../../popup/content/CustomContent","../../../popup/content/ExpressionContent","../../../popup/content/FieldsContent","../../../popup/content/MediaContent","../../../popup/content/RelationshipContent","../../../popup/content/TextContent","../../../popup/ExpressionInfo","../../../popup/FieldInfo","../../../popup/support/FieldInfoFormat","./utils","../../support/clusterUtils","../../../views/2d/layers/support/clusterUtils"],(function(e,t,n,s,o,i,l,r,u,p,a,f,d,c,m,y,b,F){"use strict";function g(e){const{fieldName:t,label:n,type:o}=e,i=s.numericTypes.includes(o),l=new c({fieldName:t,label:n,visible:!0,format:i?{places:"integer"===o||"small-integer"===o?0:2,digitSeparator:!0}:null});return"date"===o&&(l.format=new m({dateFormat:"short-date-short-time"})),l}function I(e,t){const n=t.getField(e);return n&&(n.alias||n.name)}function C(e,t,s){const{attributeInfo:o,statisticType:i}=t,{field:l,normalizationField:r}=o;let u,p="";if("avg"===i?u=r?s.clusters.avgNormFieldLabel:s.clusters.avgFieldLabel:"type"===i&&(u=s.clusters.predominantFieldLabel),u){const t=o.valueExpression?o.valueExpressionTitle:I(l,e),s=r&&I(r,e);p=n.substitute(u,{fieldLabel:t||"",normFieldLabel:s||""})}return p}function x(e,t,s,o){const{attributeInfo:i,statisticType:l}=t,{field:r,normalizationField:u}=i;let p,a="";if("avg"===l?p=u?o.clusters.avgNormFieldSummary:o.clusters.avgFieldSummary:"type"===l&&(p=o.clusters.predominantFieldSummary),p){const t=i.valueExpression?i.valueExpressionTitle:I(r,e),o=u&&I(u,e);a=n.substitute(p,{fieldLabel:t||"",normFieldLabel:o||"",fieldValue:"{"+s+"}"})}return a}function h(e){return{fieldInfo:g({fieldName:b.clusterCountField,label:e.clusters.numFeatures,type:"integer"}),fieldSummary:new f({text:n.substitute(e.clusters.countSummary,{count:`{${b.clusterCountField}}`})})}}function v(e,t,n){return T.apply(this,arguments)}function T(){return(T=t._asyncToGenerator((function*(e,t,n){if(!F.isClusterCompatibleRenderer(t))return null;const s=b.getStatisticInfos(e,t),o=n.clusters.predominantNoneValue,i="unique-value"===t.type?t.uniqueValueInfos:[],{fieldInfo:l,fieldSummary:r}=h(n),u=[r],p=[l],a=[];for(const c of s){const{statisticType:t,attributeInfo:s}=c,l=b.getClusterField(s,t),r=C(e,c,n);if("avg"===t)u.push(new f({text:x(e,c,l,n)})),p.push(g({fieldName:l,label:r,type:"double"}));else if("type"===t){const t=`expression/${l}`;u.push(new f({text:x(e,c,t,n)})),a.push(new d({name:l,title:r,returnType:"string",expression:b.getPredominantTypeExpression(i,l,o)})),p.push(g({fieldName:t}))}}return{fieldInfos:p,expressionInfos:a,content:u}}))).apply(this,arguments)}function S(e,t,n){return E.apply(this,arguments)}function E(){return(E=t._asyncToGenerator((function*(e,t,n){if(!F.isClusterCompatibleRenderer(t))return null;const{fieldInfo:s,fieldSummary:o}=h(n),i=[o],l=[s],r=[],{fieldInfos:u,expressionInfos:p}=yield y.getFieldAndExpressionInfos({renderer:t,layer:e,isFeatureReduction:!0}),a=yield y.getContentFromFieldInfos(e,{fieldInfos:u,expressionInfos:p},!0);return i.push(...a),l.push(...u),r.push(...p),{fieldInfos:l,expressionInfos:r,content:i}}))).apply(this,arguments)}e.getContentAndInfos=v,e.getContentAndInfosForPieChart=S,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
