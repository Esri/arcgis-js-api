/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../renderers/PointCloudClassBreaksRenderer","../../renderers/PointCloudRenderer","../../renderers/PointCloudRGBRenderer","../../renderers/PointCloudStretchRenderer","../../renderers/PointCloudUniqueValueRenderer","../../renderers/ClassBreaksRenderer","../../renderers/DictionaryRenderer","../../renderers/DotDensityRenderer","../../renderers/HeatmapRenderer","../../renderers/PieChartRenderer","../../renderers/Renderer","../../renderers/SimpleRenderer","../../renderers/UniqueValueRenderer","../../renderers/support/jsonUtils","../../core/Error","../../core/lang","../../core/maybe","../../intl/messages","../../renderers/support/LegendOptions","../../renderers/support/utils","../heuristics/outline","../heuristics/sizeRange","./support/utils","../statistics/uniqueValues","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils","../symbology/type"],(function(e,l,n,r,i,t,s,o,a,u,d,p,c,y,m,f,b,h,g,v,T,w,S,E,I,V,z,M,x,C){"use strict";const L="date";function R(e){if(e.name?.toLowerCase()?.includes(":insufficient-info"))return null;throw e}function q(e){return B.apply(this,arguments)}function B(){return(B=l._asyncToGenerator((function*(e){if(!e||!e.layer||!e.field&&!e.valueExpression)throw new b("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(e.valueExpression&&!e.view)throw new b("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&z.verifyBinningParams(e,"type-renderer");const l={...e};l.symbolType=l.symbolType||"2d",l.numTypes=null==l.numTypes?10:l.numTypes,l.defaultSymbolEnabled=null==l.defaultSymbolEnabled||l.defaultSymbolEnabled,l.sortBy=null==l.sortBy?"count":l.sortBy,l.sortEnabled=null==l.sortEnabled||l.sortEnabled,l.statistics=h.clone(l.statistics);const n=e.forBinning?x.binningCapableLayerTypes:x.featureCapableLayerTypes,r=x.createLayerAdapter(l.layer,n,e.forBinning);if(l.layer=r,!r)throw new b("type-renderer:invalid-parameters","'layer' must be one of these types: "+x.getLayerTypeLabels(n).join(", "));const i=g.isSome(l.signal)?{signal:l.signal}:null;yield r.load(i);const t=r.geometryType;if(l.outlineOptimizationEnabled="polygon"===t&&l.outlineOptimizationEnabled,l.sizeOptimizationEnabled=("point"===t||"multipoint"===t||"polyline"===t)&&l.sizeOptimizationEnabled,"mesh"===t)l.symbolType="3d-volumetric",l.colorMixMode=l.colorMixMode||"replace",l.edgesType=l.edgesType||"none";else{if("3d-volumetric-uniform"===l.symbolType&&"point"!==t)throw new b("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(l.symbolType.includes("3d-volumetric")&&(!l.view||"3d"!==l.view.type))throw new b("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'")}const s=yield M.getFieldsList({field:l.field,field2:l.field2,field3:l.field3,valueExpression:l.valueExpression}),o=I.verifyBasicFieldValidity(r,s,"type-renderer:invalid-parameters");if(o)throw o;return l}))).apply(this,arguments)}function P(e){return O.apply(this,arguments)}function O(){return(O=l._asyncToGenerator((function*(e){if(!(e&&e.layer&&e.field))throw new b("type-point-cloud-class-renderer:missing-parameters","'layer' and 'field' parameters are required");const l={...e};l.statistics=h.clone(l.statistics);const n=[x.LayerType.PointCloudLayer],r=x.createLayerAdapter(l.layer,n);if(l.layer=r,l.density=l.density||25,l.size=l.size||"100%",!I.isValidPointSize(l.size))throw new b("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");if(!r)throw new b("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+x.getLayerTypeLabels(n).join(", "));const i=g.isSome(l.signal)?{signal:l.signal}:null;yield r.load(i);const t=yield M.getFieldsList({field:l.field}),s=I.verifyBasicFieldValidity(r,t,"type-point-cloud-class-renderer:invalid-parameters");if(s)throw s;return l}))).apply(this,arguments)}function F(e){return _.apply(this,arguments)}function _(){return(_=l._asyncToGenerator((function*(e){let l=e.typeScheme,n=null,r=null;const i=yield I.getBasemapInfo(e.basemap,e.view);if(n=g.isSome(i.basemapId)?i.basemapId:null,r=g.isSome(i.basemapTheme)?i.basemapTheme:null,l)return{scheme:C.cloneScheme(l),basemapId:n,basemapTheme:r};const t=C.getSchemes({basemap:n,basemapTheme:r,geometryType:e.geometryType,theme:e.theme,worldScale:e.worldScale,view:e.view});return t&&(l=t.primaryScheme,n=t.basemapId,r=t.basemapTheme),{scheme:l,basemapId:n,basemapTheme:r}}))).apply(this,arguments)}function D(e,l){let n;return n=e.label<l.label?-1:e.label>l.label?1:0,n}function U(e,l){let n;return n=e.value<l.value?-1:e.value>l.value?1:0,n}function G(e,l){let n=l.count-e.count;return 0===n&&(n=D(e,l)),n}function A(e,l){let n=l.count-e.count;return 0===n&&(n=U(e,l)),n}function j(e,l,n){let r;"count"===l?(r=A,n&&n.codedValues&&(r=G)):"value"===l&&(r=U,n&&n.codedValues&&(r=D)),r&&e.sort(r)}function k(e,l,n,r){return H.apply(this,arguments)}function H(){return(H=l._asyncToGenerator((function*(e,l,n,r){const i=yield v.fetchMessageBundle("esri/smartMapping/t9n/smartMapping"),{field:t,field2:s,field3:o}=l,a=e.uniqueValueInfos,u=l.layer,d=t?u.getField(t):null,p=d?u.getFieldDomain(d.name):null,c=-1===l.numTypes?a.length:l.numTypes,y=u.geometryType,f=yield F({basemap:l.basemap,geometryType:y,typeScheme:l.typeScheme,worldScale:l.symbolType.includes("3d-volumetric"),view:l.view}),b=f.scheme,h=new m({field:t,field2:s,field3:o,fieldDelimiter:t&&s?M.FIELD_DELIMITER:null}),g=[],S=[],E={value:null,domain:p,fieldInfo:d};a.forEach(((e,l)=>{E.value=e.value,e.label=w.createUniqueValueLabel(E);const n=e.value;(null===n||"string"==typeof n&&n.toLowerCase().includes("<null>"))&&g.unshift(l)}));for(const m of g)S.unshift(a.splice(m,1)[0]);if(!1!==l.sortEnabled&&j(a,l.sortBy,p),d&&d.type===L){const e=a.filter(((e,l)=>l<c)).map((e=>e.value));E.dateFormatInterval=w.calculateDateFormatInterval(e)}const V=n&&n.opacity;let z=I.createColors(b.colors,a.length);const x=I.getSymbolSizeFromScheme(b,y),R=I.getSymbolOutlineFromScheme(b,y,V);a.forEach(((e,n)=>{E.value=e.value,e.label=w.createUniqueValueLabel(E),e.symbol=I.createSymbol(y,{type:l.symbolType,color:z[n],size:x,outline:R,meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}})})),l.valueExpression&&(h.valueExpression=l.valueExpression,h.valueExpressionTitle=l.valueExpressionTitle),l.legendOptions&&(h.legendOptions=new T.LegendOptions(l.legendOptions)),z=I.createColors(b.colors,c);for(let m=0;m<c;m++){const e=a[m];e&&h.addUniqueValueInfo({value:e.value,label:e.label,symbol:I.createSymbol(y,{type:l.symbolType,color:z[m],size:x,outline:R,meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}})})}l.defaultSymbolEnabled&&(h.defaultSymbol=I.createSymbol(y,{type:l.symbolType,color:b.noDataColor,size:x,outline:R,meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}}),h.defaultLabel=i.other);for(const m of S)m.symbol=I.createSymbol(y,{type:l.symbolType,color:b.noDataColor,size:x,outline:R,meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}}),a.push(m);const q=[],B=h.uniqueValueInfos.length===a.length?-1:h.uniqueValueInfos.length;if(B>-1)for(let m=B;m<a.length;m++)q.push({...a[m]});return n&&n.visualVariables&&n.visualVariables.length&&(h.visualVariables=n.visualVariables.map((e=>e.clone()))),r&&r.minSize&&(h.visualVariables?h.visualVariables.push(r.minSize):h.visualVariables=[r.minSize]),{renderer:h,uniqueValueInfos:a,excludedUniqueValueInfos:q,typeScheme:C.cloneScheme(b),basemapId:f.basemapId,basemapTheme:f.basemapTheme}}))).apply(this,arguments)}function J(e,l){return K.apply(this,arguments)}function K(){return(K=l._asyncToGenerator((function*(e,l){const n=e.uniqueValueInfos,r=yield F({basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:l}),i=r&&r.scheme,t="point-cloud-class"===i.theme,s=t?i.colors:I.createColors(i.colors,n.length);return j(n,"value"),n.map(((e,l)=>{const n=e.value;let r=null;return t?(r=s[n],r||(r=s[s.length-1])):r=s[l],{values:[n],color:r,label:e.label}}))}))).apply(this,arguments)}function N(e){return Q.apply(this,arguments)}function Q(){return(Q=l._asyncToGenerator((function*(e){const l=yield q(e),{layer:n,view:r,signal:i}=l,t={layer:n,field:l.field,field2:l.field2,field3:l.field3,valueExpression:l.valueExpression,returnAllCodedValues:l.returnAllCodedValues,view:r,signal:i},[s,o,a]=yield Promise.all([null!=l.statistics?l.statistics:V(t),l.outlineOptimizationEnabled?S({layer:n,view:r,signal:i}).catch(R):null,l.sizeOptimizationEnabled?E({layer:n,view:r,signal:i}).catch(R):null]);return k(s,l,o,a)}))).apply(this,arguments)}function W(e){return X.apply(this,arguments)}function X(){return(X=l._asyncToGenerator((function*(e){const l=yield P(e),n=null!=l.statistics?l.statistics:yield V({layer:l.layer,field:l.field,signal:l.signal});return{renderer:new s({field:l.field,pointsPerInch:l.density,pointSizeAlgorithm:I.getPointSizeAlgorithm(l.size),colorUniqueValueInfos:yield J(n,l.typeScheme)})}}))).apply(this,arguments)}e.createPCClassRenderer=W,e.createRenderer=N,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
