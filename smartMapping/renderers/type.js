/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../renderers/PointCloudClassBreaksRenderer","../../renderers/PointCloudRenderer","../../renderers/PointCloudRGBRenderer","../../renderers/PointCloudStretchRenderer","../../renderers/PointCloudUniqueValueRenderer","../../renderers/ClassBreaksRenderer","../../renderers/DictionaryRenderer","../../renderers/DotDensityRenderer","../../renderers/HeatmapRenderer","../../renderers/Renderer","../../renderers/SimpleRenderer","../../renderers/UniqueValueRenderer","../../renderers/support/jsonUtils","../../core/Error","../../core/lang","../../core/maybe","../../intl/messages","../../renderers/support/LegendOptions","../../renderers/support/utils","../heuristics/outline","../heuristics/sizeRange","./support/utils","../statistics/uniqueValues","../support/utils","../support/adapters/support/layerUtils","../../chunks/type"],(function(e,l,r,n,t,s,i,a,o,u,p,d,c,y,m,f,b,h,g,v,T,S,w,E,V,x,z,I){"use strict";const M="date";function C(e){return L.apply(this,arguments)}function L(){return(L=l._asyncToGenerator((function*(e){if(!e||!e.layer||!e.field&&!e.valueExpression)throw new f("type-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(e.valueExpression&&!e.view)throw new f("type-renderer:missing-parameters","View is required when 'valueExpression' is specified");const l={...e};l.symbolType=l.symbolType||"2d",l.numTypes=null==l.numTypes?10:l.numTypes,l.defaultSymbolEnabled=null==l.defaultSymbolEnabled||l.defaultSymbolEnabled,l.sortBy=null==l.sortBy?"count":l.sortBy,l.sortEnabled=null==l.sortEnabled||l.sortEnabled,l.statistics=b.clone(l.statistics);const r=z.createLayerAdapter(l.layer,z.featureCapableLayerTypes);if(l.layer=r,!r)throw new f("type-renderer:invalid-parameters","'layer' must be one of these types: "+z.getLayerTypeLabels(z.featureCapableLayerTypes).join(", "));const n=h.isSome(l.signal)?{signal:l.signal}:null;yield r.load(n);const t=r.geometryType;if(l.outlineOptimizationEnabled="polygon"===t&&l.outlineOptimizationEnabled,l.sizeOptimizationEnabled=("point"===t||"multipoint"===t||"polyline"===t)&&l.sizeOptimizationEnabled,"mesh"===t)l.symbolType="3d-volumetric",l.colorMixMode=l.colorMixMode||"replace",l.edgesType=l.edgesType||"none";else{if("3d-volumetric-uniform"===l.symbolType&&"point"!==t)throw new f("type-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(l.symbolType.indexOf("3d-volumetric")>-1&&(!l.view||"3d"!==l.view.type))throw new f("type-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'")}const s=yield x.getFieldsList({field:l.field,valueExpression:l.valueExpression}),i=E.verifyBasicFieldValidity(r,s,"type-renderer:invalid-parameters");if(i)throw i;return l}))).apply(this,arguments)}function q(e){return R.apply(this,arguments)}function R(){return(R=l._asyncToGenerator((function*(e){if(!(e&&e.layer&&e.field))throw new f("type-point-cloud-class-renderer:missing-parameters","'layer' and 'field' parameters are required");const l={...e};l.statistics=b.clone(l.statistics);const r=[z.LayerType.PointCloudLayer],n=z.createLayerAdapter(l.layer,r);if(l.layer=n,l.density=l.density||25,l.size=l.size||"100%",!E.isValidPointSize(l.size))throw new f("type-point-cloud-class-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");if(!n)throw new f("type-point-cloud-class-renderer:invalid-parameters","'layer' must be one of these types: "+z.getLayerTypeLabels(r).join(", "));const t=h.isSome(l.signal)?{signal:l.signal}:null;yield n.load(t);const s=yield x.getFieldsList({field:l.field}),i=E.verifyBasicFieldValidity(n,s,"type-point-cloud-class-renderer:invalid-parameters");if(i)throw i;return l}))).apply(this,arguments)}function O(e){return P.apply(this,arguments)}function P(){return(P=l._asyncToGenerator((function*(e){let l=e.typeScheme,r=null,n=null;const t=yield E.getBasemapInfo(e.basemap,e.view);if(r=h.isSome(t.basemapId)?t.basemapId:null,n=h.isSome(t.basemapTheme)?t.basemapTheme:null,l)return{scheme:I.cloneScheme(l),basemapId:r,basemapTheme:n};const s=I.getSchemes({basemap:r,basemapTheme:n,geometryType:e.geometryType,theme:e.theme,worldScale:e.worldScale,view:e.view});return s&&(l=s.primaryScheme,r=s.basemapId,n=s.basemapTheme),{scheme:l,basemapId:r,basemapTheme:n}}))).apply(this,arguments)}function B(e,l){let r;return r=e.label<l.label?-1:e.label>l.label?1:0,r}function F(e,l){let r;return r=e.value<l.value?-1:e.value>l.value?1:0,r}function _(e,l){let r=l.count-e.count;return 0===r&&(r=B(e,l)),r}function U(e,l){let r=l.count-e.count;return 0===r&&(r=F(e,l)),r}function G(e,l,r){let n;"count"===l?(n=U,r&&r.codedValues&&(n=_)):"value"===l&&(n=F,r&&r.codedValues&&(n=B)),n&&e.sort(n)}function D(e,l,r,n){return A.apply(this,arguments)}function A(){return(A=l._asyncToGenerator((function*(e,l,r,n){const t=yield g.fetchMessageBundle("esri/smartMapping/t9n/smartMapping"),s=e.uniqueValueInfos,i=l.layer,a=l.field,o=a?i.getField(a):null,u=o?i.getFieldDomain(o.name):null,p=-1===l.numTypes?s.length:l.numTypes,d=i.geometryType,c=yield O({basemap:l.basemap,geometryType:d,typeScheme:l.typeScheme,worldScale:l.symbolType.indexOf("3d-volumetric")>-1,view:l.view}),m=c.scheme,f=new y({field:a});let b,h=-1;const S={value:null,domain:u,fieldInfo:o};if(s.forEach(((e,l)=>{S.value=e.value,e.label=T.createUniqueValueLabel(S),null===e.value&&(h=l)})),h>-1&&(b=s.splice(h,1)[0]),!1!==l.sortEnabled&&G(s,l.sortBy,u),o&&o.type===M){const e=s.filter(((e,l)=>l<p)).map((e=>e.value));S.dateFormatInterval=T.calculateDateFormatInterval(e)}const w=r&&r.opacity;let V=E.createColors(m.colors,s.length);const x=E.getSymbolSizeFromScheme(m,d),z=E.getSymbolOutlineFromScheme(m,d,w);s.forEach(((e,r)=>{S.value=e.value,e.label=T.createUniqueValueLabel(S),e.symbol=E.createSymbol(d,{type:l.symbolType,color:V[r],size:x,outline:z,meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}})})),l.valueExpression&&(f.valueExpression=l.valueExpression,f.valueExpressionTitle=l.valueExpressionTitle),l.legendOptions&&(f.legendOptions=new v.LegendOptions(l.legendOptions)),V=E.createColors(m.colors,p);for(let y=0;y<p;y++){const e=s[y];e&&f.addUniqueValueInfo({value:e.value,label:e.label,symbol:E.createSymbol(d,{type:l.symbolType,color:V[y],size:x,outline:z,meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}})})}l.defaultSymbolEnabled&&(f.defaultSymbol=E.createSymbol(d,{type:l.symbolType,color:m.noDataColor,size:x,outline:z,meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}}),f.defaultLabel=t.other),b&&(b.symbol=E.createSymbol(d,{type:l.symbolType,color:m.noDataColor,size:x,outline:z,meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}}),s.push(b));const C=[],L=f.uniqueValueInfos.length===s.length?-1:f.uniqueValueInfos.length;if(L>-1)for(let y=L;y<s.length;y++)C.push({...s[y]});return r&&r.visualVariables&&r.visualVariables.length&&(f.visualVariables=r.visualVariables.map((e=>e.clone()))),n&&n.minSize&&(f.visualVariables?f.visualVariables.push(n.minSize):f.visualVariables=[n.minSize]),{renderer:f,uniqueValueInfos:s,excludedUniqueValueInfos:C,typeScheme:I.cloneScheme(m),basemapId:c.basemapId,basemapTheme:c.basemapTheme}}))).apply(this,arguments)}function j(e,l){return k.apply(this,arguments)}function k(){return(k=l._asyncToGenerator((function*(e,l){const r=e.uniqueValueInfos,n=yield O({basemap:"gray",theme:"point-cloud-class",geometryType:"point",typeScheme:l}),t=n&&n.scheme,s="point-cloud-class"===t.theme,i=s?t.colors:E.createColors(t.colors,r.length);return G(r,"value"),r.map(((e,l)=>{const r=e.value;let n=null;return s?(n=i[r],n||(n=i[i.length-1])):n=i[l],{values:[r],color:n,label:e.label}}))}))).apply(this,arguments)}function H(e){return J.apply(this,arguments)}function J(){return(J=l._asyncToGenerator((function*(e){const l=yield C(e),{layer:r,view:n,signal:t}=l,s={layer:r,field:l.field,valueExpression:l.valueExpression,returnAllCodedValues:l.returnAllCodedValues,view:n,signal:t},[i,a,o]=yield Promise.all([null!=l.statistics?l.statistics:V(s),l.outlineOptimizationEnabled?S({layer:r,view:n,signal:t}):null,l.sizeOptimizationEnabled?w({layer:r,view:n,signal:t}):null]);return D(i,l,a,o)}))).apply(this,arguments)}function K(e){return N.apply(this,arguments)}function N(){return(N=l._asyncToGenerator((function*(e){const l=yield q(e),r=null!=l.statistics?l.statistics:yield V({layer:l.layer,field:l.field,signal:l.signal});return{renderer:new i({field:l.field,pointsPerInch:l.density,pointSizeAlgorithm:E.getPointSizeAlgorithm(l.size),colorUniqueValueInfos:yield j(r,l.typeScheme)})}}))).apply(this,arguments)}e.createPCClassRenderer=K,e.createRenderer=H,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
