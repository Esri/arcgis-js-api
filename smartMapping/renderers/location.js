/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/maybe","../../core/Error","../../core/promiseUtils","../../renderers/Renderer","../../renderers/ClassBreaksRenderer","../../renderers/UniqueValueRenderer","../../renderers/DictionaryRenderer","../../renderers/DotDensityRenderer","../../renderers/HeatmapRenderer","../../renderers/SimpleRenderer","../../renderers/support/jsonUtils","../../chunks/location","../support/adapters/support/layerUtils","../heuristics/outline","../heuristics/sizeRange","./support/utils"],(function(e,r,a,i,n,o,s,l,t,m,p,c,d,y,u,b,h){"use strict";e.createRenderer=async function(e){const n=await async function(e){if(!e||!e.layer)throw new a("location-renderer:missing-parameters","'layer' parameter is required");const i={...e};i.symbolType=i.symbolType||"2d";const n=[0,2,1,3],o=y.createLayerAdapter(i.layer,n);if(i.layer=o,!o)throw new a("location-renderer:invalid-parameters","'layer' must be one of these types: "+y.getLayerTypeLabels(n).join(", "));const s=r.isSome(i.signal)?{signal:i.signal}:null;await o.load(s);const l=o.geometryType;if(i.outlineOptimizationEnabled="polygon"===l&&i.outlineOptimizationEnabled,i.sizeOptimizationEnabled=("point"===l||"multipoint"===l||"polyline"===l)&&i.sizeOptimizationEnabled,"mesh"===l)i.symbolType="3d-volumetric",i.colorMixMode=i.colorMixMode||"replace",i.edgesType=i.edgesType||"none";else{if("3d-volumetric-uniform"===i.symbolType&&"point"!==l)throw new a("location-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(i.symbolType.indexOf("3d-volumetric")>-1&&(!i.view||"3d"!==i.view.type))throw new a("location-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'")}return i}(e),o=n.layer.geometryType,s=await async function(e,a){let i=e.locationScheme,n=null,o=null;const s=await h.getBasemapInfo(e.basemap,e.view);if(n=r.isSome(s.basemapId)?s.basemapId:null,o=r.isSome(s.basemapTheme)?s.basemapTheme:null,i)return{scheme:d.cloneScheme(i),basemapId:n,basemapTheme:o};const l=d.getSchemes({basemap:n,basemapTheme:o,geometryType:a,worldScale:e.symbolType.indexOf("3d-volumetric")>-1,view:e.view});return l&&(i=l.primaryScheme,n=l.basemapId,o=l.basemapTheme),{scheme:i,basemapId:n,basemapTheme:o}}(n,o),l=s.scheme;if(!l)throw new a("location-renderer:insufficient-info","Unable to find location scheme");const{view:t,layer:m,signal:c}=n,[w,f]=await i.all([n.outlineOptimizationEnabled?u({view:t,layer:m,signal:c}):null,n.sizeOptimizationEnabled?b({view:t,layer:m,signal:c}):null]),v=w&&w.opacity,T=new p({symbol:h.createSymbol(o,{type:n.symbolType,color:l.color,size:h.getSymbolSizeFromScheme(l,o),outline:h.getSymbolOutlineFromScheme(l,o,v),meshInfo:{colorMixMode:n.colorMixMode,edgesType:n.edgesType}})});return w&&w.visualVariables&&w.visualVariables.length&&(T.visualVariables=w.visualVariables.map((e=>e.clone()))),f&&f.minSize&&(T.visualVariables?T.visualVariables.push(f.minSize):T.visualVariables=[f.minSize]),{renderer:T,locationScheme:d.cloneScheme(l),basemapId:s.basemapId,basemapTheme:s.basemapTheme}},Object.defineProperty(e,"__esModule",{value:!0})}));
