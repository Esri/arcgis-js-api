/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../Color","../../../symbols","../../../core/has","../../../core/Error","../../../core/maybe","../../../intl/date","../../../renderers/support/numberUtils","../../../renderers/support/pointCloud/PointSizeSplatAlgorithm","../../heuristics/outline","../../statistics/classBreaks","../../statistics/summaryStatistics","../../support/utils","../../../views/support/colorUtils","../../../symbols/MeshSymbol3D","../../../symbols/FillSymbol3DLayer","../../../symbols/SimpleFillSymbol","../../../symbols/PolygonSymbol3D","../../../symbols/ExtrudeSymbol3DLayer","../../../symbols/SimpleLineSymbol","../../../symbols/LineSymbol3D","../../../symbols/LineSymbol3DLayer","../../../symbols/PathSymbol3DLayer","../../../symbols/SimpleMarkerSymbol","../../../symbols/PointSymbol3D","../../../symbols/IconSymbol3DLayer","../../../symbols/ObjectSymbol3DLayer"],(function(e,t,n,l,o,i,s,a,r,u,c,m,d,f,y,p,h,b,g,w,S,D,v,x,V,z,B,k){"use strict";const I=/^(\d+(\.\d+)?)\s*(%)$/i,L=[0,0,0,.4],F=["hours","minutes","seconds"],T=[].concat(f.defaultBasemapGroups.light).concat(f.defaultBasemapGroups.dark);function U(e,t,n){if("string"==typeof e){const t=n.getField(e);if(t&&"date"===t.type)return t.alias||t.name}else if("number"==typeof e||e instanceof Date){const n=F.indexOf(t)>-1?"short-date-short-time":"short-date";return a.formatDate(e,a.convertDateFormatToIntlOptions(n))}return e}function A(e,t){return new i(e,t)}function C(e,t,n){return e+t>0&&0>e-t&&n<0?0:e}function M(e,t,n,l,o=!0){const i="90-10"===n&&t?{min:t.classBreakInfos[0].maxValue,max:t.classBreakInfos[t.classBreakInfos.length-1].minValue,avg:null,stddev:null}:e,{avg:s,stddev:a,min:r,max:u}=i,c=P(i,l,o);let m=c?c[0]:r,d=c?c[1]:u;return c?{minDataValue:m,maxDataValue:d,defaultValuesUsed:!0}:("above"===n?m=C(s,a,r):"below"===n&&(d=C(s,a,r)),{minDataValue:m,maxDataValue:d,defaultValuesUsed:!1})}function P(e,t,n){let l,o;const i=R({statistics:e,isDate:t});return i.defaultValuesUsed?(l=i.min,o=i.max):!n||null!=e.avg&&e.stddev||(l=e.min,o=e.max),null!=l?[l,o]:null}function R(e){let t,n,l=e&&e.statistics;if(l||(l={}),null==l.min)if(e.isDate){const e=O();t=e[0],n=e[1]}else t=0,n=100;else if(l.min===l.max)if(e.isDate){const e=O(l.min);t=e[0],n=e[1]}else l.min<0?(t=2*l.min,n=0):l.min>0?(t=0,n=2*l.min):(t=0,n=100);return{min:null!=t?t:l.min,max:null!=n?n:l.max,defaultValuesUsed:null!=t||null!=n}}function O(e){const t=("number"==typeof e?new Date(e):new Date).getUTCFullYear();let n=Date.UTC(t,0,1,12,0,0,0),l=Date.UTC(t,11,31,12,0,0,0);return"number"==typeof e&&(e<n&&(n=e),e>l&&(l=e)),[n,l]}function G(e,t){const l=[],o=e.length;for(let i=0;i<t;i++)l.push(new n(e[i%o]));return l}function _(e,t,n,l=!0){const{minDataValue:o,maxDataValue:i,defaultValuesUsed:s}=e;return s||"above"===n||"below"===n||"90-10"===n?Y(o,i,5):W(t,l)}function j(e){const{avg:t,stddev:n,min:l,max:o}=e;if(null==t||null==n)return Y(l,o,5);const i=C(t,n,l),s=o-i,a=i-l,u=Math.max(s,a),c=i+u,m=i-u,d=i-u/2,f=u/2+i;return r.round([m,d,i,f,c],{strictBounds:!0})}function E(e,t){const{min:n,max:l}=t,[o,i,s,a,u]=e,c=null!=n&&o<n,m=null!=l&&u>l;if(null==n||null==l||!c&&!m)return e;const d=c?n:o,f=c?d+(s-d)/2:i,y=m?l:u,p=m?s+(y-s)/2:a;return r.round([d,f,s,p,y],{strictBounds:!0})}function Y(e,t,n){const l=(t-e)/(n-1),o=[e];for(let i=1;i<=n-2;i++)o.push(e+i*l);return o.push(t),r.round(o,{strictBounds:!0})}function W(e,t=!0){let n=e.avg,l=n-e.stddev,o=n+e.stddev;l<e.min&&(l=e.min),o>e.max&&(o=e.max),t&&(n=l+(o-l)/2);let i=r.round([l,o],{strictBounds:!0});return l=i[0],o=i[1],i=[l,l+(n-l)/2,n,n+(o-n)/2,o],r.round(i,{strictBounds:!0})}function q(e,t,n){switch(t){case"point":case"multipoint":return n?"noDataSize"in e?e.noDataSize:null:"size"in e?e.size:null;case"polyline":return n?"noDataWidth"in e?e.noDataWidth:null:"width"in e?e.width:null;case"polygon":return"size"in e?e.size:null;case"mesh":default:return}}function H(e,t,n){switch(t){case"point":case"multipoint":case"polygon":{if(!("outline"in e))return null;const t={color:e.outline.color,width:e.outline.width};if(null!=n&&t.color){const e=t.color.clone();e.a=n,t.color=e}return t}case"polyline":case"mesh":default:return}}function N(e,t){const{type:n,size:l,color:o,outline:i}=t;let s;switch(e){case"point":case"multipoint":if("2d"===n)s=new V({color:o,size:l,outline:{color:i.color,width:i.width}});else if("3d-flat"===n)s=new z({symbolLayers:[new B({size:l,resource:{primitive:"circle"},material:{color:o},outline:{color:i.color,size:i.width}})]});else if(n.indexOf("3d-volumetric")>-1){const e="3d-volumetric-uniform"===n,i=new k({height:l,resource:{primitive:e?"sphere":"cylinder"},material:{color:o}});e||(i.width=t.widthAndDepth,i.depth=t.widthAndDepth),s=new z({symbolLayers:[i]})}break;case"polyline":"2d"===n?s=new S({color:o,width:l}):"3d-flat"===n?s=new D({symbolLayers:[new v({size:l,material:{color:o}})]}):"3d-volumetric"===n&&(s=new D({symbolLayers:[new x({size:l,material:{color:o}})]}));break;case"polygon":"2d"===n?s=new b({color:o,outline:{color:i.color,width:i.width}}):"3d-flat"===n?s=new g({symbolLayers:[new h({material:{color:o},outline:{color:i.color,size:i.width}})]}):"3d-volumetric"===n&&(s=new g({symbolLayers:[new w({size:l,material:{color:o}})]}));break;case"mesh":{const e=t.meshInfo&&t.meshInfo.colorMixMode,n=t.meshInfo&&t.meshInfo.edgesType;s=new p({symbolLayers:[new h({material:{color:o,colorMixMode:e},edges:null==n||"none"===n?null:{type:n,color:L}})]});break}}return s}function $(e,t,n){const l=J({layer:e,fields:t});if(l.length)return A(n,"Unknown fields: "+l.join(", ")+". You can only use fields defined in the layer schema");const o=K({layer:e,fields:t});return o.length?A(n,"Unsupported fields: "+o.join(", ")+". You can only use fields that are accessible to the renderer i.e. FieldUsageInfo.supportsRenderer must be true"):void 0}function J(e){const t=e.layer;return e.fields.filter((e=>!t.getField(e)))}function K(e){const t=e.layer;return e.fields.filter((e=>{const n=t.getFieldUsageInfo(e);return!n||!n.supportsRenderer}))}function Q(e,t){return X.apply(this,arguments)}function X(){return(X=t._asyncToGenerator((function*(e,t){const n={layer:e.layer,view:e.view,signal:e.signal},[l,o]=yield Promise.all([m(e),t?c(n):null]),i=P({min:l.minValue,max:l.maxValue,avg:null,stddev:null},!1,!1);return{result:i?yield m({...e,classificationMethod:"equal-interval",numClasses:1,analyzeData:!1,minValue:i[0],maxValue:i[1],normalizationTotal:i[0]+i[1]}):l,defaultValuesUsed:!!i,outlineResult:o}}))).apply(this,arguments)}function Z(e){return d(e)}function ee(e,t){let{minSize:n,maxSize:l}=e;if("height"===t){n=((l-n)/2+n)/(2*2.3),l*=2}return{minSize:n,maxSize:l}}function te(e){return I.test(e)}function ne(e){const t=e.match(I),n=Number(t[1]);if("%"===t[3])return new u.default({scaleFactor:n/100})}function le(e,t,n,l){e.startTime=t instanceof Date?t.getTime():t,e.endTime=n instanceof Date?n.getTime():n,e.units=l,e.field="string"==typeof t?t:"string"==typeof n?n:null}function oe(e,t){return ie.apply(this,arguments)}function ie(){return(ie=t._asyncToGenerator((function*(e,t){let n=null,l=null;if(!e&&!t)return{basemapId:n,basemapTheme:l};var o;!e&&t&&(e=t&&(null==(o=t.map)?void 0:o.basemap));if(e&&(n=f.getBasemapId(e,T,!1),n)){const e=f.getBasemapGroup(n);s.isSome(e)&&(l=e)}return n||"2d"!==(null==t?void 0:t.type)||(l=yield y.getBackgroundColorTheme(t),s.isSome(l)&&(n="dark"===l?"dark-gray":"gray")),{basemapId:n,basemapTheme:l}}))).apply(this,arguments)}e.clampAboveAndBelowStopValues=E,e.createColors=G,e.createDataValues=_,e.createDefaultStopValues=Y,e.createError=A,e.createStopValues=W,e.createStopValuesForAboveBelow=j,e.createSymbol=N,e.formatDate=U,e.getBaseValueForAboveBelow=C,e.getBasemapInfo=oe,e.getClassBreaks=Q,e.getDataRange=M,e.getDefaultDataRange=P,e.getPointSizeAlgorithm=ne,e.getSizeRangeForAxis=ee,e.getSummaryStatistics=Z,e.getSymbolOutlineFromScheme=H,e.getSymbolSizeFromScheme=q,e.isValidPointSize=te,e.updateAgeRendererAuthoringInfoVV=le,e.verifyBasicFieldValidity=$,Object.defineProperty(e,"__esModule",{value:!0})}));
