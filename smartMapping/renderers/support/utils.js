/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import e from"../../../Color.js";import"../../../symbols.js";import"../../../core/has.js";import t from"../../../core/Error.js";import{isSome as o}from"../../../core/maybe.js";import{formatDate as n,convertDateFormatToIntlOptions as s}from"../../../intl/date.js";import{round as i}from"../../../renderers/support/numberUtils.js";import l from"../../../renderers/support/pointCloud/PointSizeSplatAlgorithm.js";import r from"../../heuristics/outline.js";import a from"../../statistics/classBreaks.js";import m from"../../statistics/summaryStatistics.js";import{defaultBasemapGroups as u,getBasemapId as c,getBasemapGroup as f}from"../../support/utils.js";import d from"../../../symbols/edges/SketchEdges3D.js";import p from"../../../symbols/edges/SolidEdges3D.js";import{getBackgroundColorTheme as y}from"../../../views/support/colorUtils.js";import h from"../../../symbols/MeshSymbol3D.js";import b from"../../../symbols/FillSymbol3DLayer.js";import w from"../../../symbols/SimpleFillSymbol.js";import g from"../../../symbols/PolygonSymbol3D.js";import D from"../../../symbols/ExtrudeSymbol3DLayer.js";import j from"../../../symbols/SimpleLineSymbol.js";import S from"../../../symbols/LineSymbol3D.js";import v from"../../../symbols/LineSymbol3DLayer.js";import x from"../../../symbols/PathSymbol3DLayer.js";import z from"../../../symbols/SimpleMarkerSymbol.js";import V from"../../../symbols/PointSymbol3D.js";import L from"../../../symbols/IconSymbol3DLayer.js";import k from"../../../symbols/ObjectSymbol3DLayer.js";const U=/^(\d+(\.\d+)?)\s*(%)$/i,I=[0,0,0,.4],T=["hours","minutes","seconds"],F=[].concat(u.light).concat(u.dark);function B(e,t,o){if("string"==typeof e){const t=o.getField(e);if(t&&"date"===t.type)return t.alias||t.name}else if("number"==typeof e||e instanceof Date){const o=T.includes(t)?"short-date-short-time":"short-date";return n(e,s(o))}return e}function M(e,o){return new t(e,o)}function C(e,t,o){return e+t>0&&0>e-t&&o<0?0:e}function P(e,t,o,n,s=!0){const i="90-10"===o&&t?{min:t.classBreakInfos[0].maxValue,max:t.classBreakInfos[t.classBreakInfos.length-1].minValue,avg:null,stddev:null}:e,{avg:l,stddev:r,min:a,max:m}=i,u=E(i,n,s);let c=u?u[0]:a,f=u?u[1]:m;return u?{minDataValue:c,maxDataValue:f,defaultValuesUsed:!0}:("above"===o?c=C(l,r,a):"below"===o&&(f=C(l,r,a)),{minDataValue:c,maxDataValue:f,defaultValuesUsed:!1})}function E(e,t,o){let n,s;const i=A({statistics:e,isDate:t});return i.defaultValuesUsed?(n=i.min,s=i.max):!o||null!=e.avg&&e.stddev||(n=e.min,s=e.max),null!=n?[n,s]:null}function A(e){let t,o,n=e&&e.statistics;if(n||(n={}),null==n.min)if(e.isDate){const e=R();t=e[0],o=e[1]}else t=0,o=100;else if(n.min===n.max)if(e.isDate){const e=R(n.min);t=e[0],o=e[1]}else n.min<0?(t=2*n.min,o=0):n.min>0?(t=0,o=2*n.min):(t=0,o=100);return{min:null!=t?t:n.min,max:null!=o?o:n.max,defaultValuesUsed:null!=t||null!=o}}function R(e){const t=("number"==typeof e?new Date(e):new Date).getUTCFullYear();let o=Date.UTC(t,0,1,12,0,0,0),n=Date.UTC(t,11,31,12,0,0,0);return"number"==typeof e&&(e<o&&(o=e),e>n&&(n=e)),[o,n]}function Y(t,o){const n=[],s=t.length;for(let i=0;i<o;i++)n.push(new e(t[i%s]));return n}function W(e,t,o,n=!0){const{minDataValue:s,maxDataValue:i,defaultValuesUsed:l}=e;return l||"above"===o||"below"===o||"90-10"===o?O(s,i,5):$(t,n)}function q(e){const{avg:t,stddev:o,min:n,max:s}=e;if(null==t||null==o)return O(n,s,5);const l=C(t,o,n),r=s-l,a=l-n,m=Math.max(r,a);return i([l-m,l-m/2,l,m/2+l,l+m],{strictBounds:!0})}function N(e,t){const{min:o,max:n}=t,[s,l,r,a,m]=e,u=null!=o&&s<o,c=null!=n&&m>n;if(null==o||null==n||!u&&!c)return e;const f=u?o:s,d=c?n:m;return i([f,u?f+(r-f)/2:l,r,c?r+(d-r)/2:a,d],{strictBounds:!0})}function O(e,t,o){const n=(t-e)/(o-1),s=[e];for(let i=1;i<=o-2;i++)s.push(e+i*n);return s.push(t),i(s,{strictBounds:!0})}function $(e,t=!0){let o=e.avg,n=o-e.stddev,s=o+e.stddev;n<e.min&&(n=e.min),s>e.max&&(s=e.max),t&&(o=n+(s-n)/2);let l=i([n,s],{strictBounds:!0});return n=l[0],s=l[1],l=[n,n+(o-n)/2,o,o+(s-o)/2,s],i(l,{strictBounds:!0})}function G(e,t,o){switch(t){case"point":case"multipoint":return o?"noDataSize"in e?e.noDataSize:null:"size"in e?e.size:null;case"polyline":return o?"noDataWidth"in e?e.noDataWidth:null:"width"in e?e.width:null;case"polygon":return"size"in e?e.size:null;default:return}}function H(e,t,o){switch(t){case"point":case"multipoint":case"polygon":{if(!("outline"in e))return null;const t={color:e.outline.color,width:e.outline.width};if(null!=o&&t.color){const e=t.color.clone();e.a=o,t.color=e}return t}default:return}}function J(e,t){const{type:o,size:n,color:s,outline:i}=t;let l;switch(e){case"point":case"multipoint":if("2d"===o)l=new z({color:s,size:n,outline:{color:i.color,width:i.width}});else if("3d-flat"===o)l=new V({symbolLayers:[new L({size:n,resource:{primitive:"circle"},material:{color:s},outline:{color:i.color,size:i.width}})]});else if(o.includes("3d-volumetric")){const e="3d-volumetric-uniform"===o,i=new k({height:n,resource:{primitive:e?"sphere":"cylinder"},material:{color:s}});e||(i.width=t.widthAndDepth,i.depth=t.widthAndDepth),l=new V({symbolLayers:[i]})}break;case"polyline":"2d"===o?l=new j({color:s,width:n}):"3d-flat"===o?l=new S({symbolLayers:[new v({size:n,material:{color:s}})]}):"3d-volumetric"===o&&(l=new S({symbolLayers:[new x({width:"number"==typeof n?n:parseFloat(n),height:"number"==typeof n?n:parseFloat(n),material:{color:s}})]}));break;case"polygon":"2d"===o?l=new w({color:s,outline:{color:i.color,width:i.width}}):"3d-flat"===o?l=new g({symbolLayers:[new b({material:{color:s},outline:{color:i.color,size:i.width}})]}):"3d-volumetric"===o&&(l=new g({symbolLayers:[new D({size:n,material:{color:s}})]}));break;case"mesh":{const e=t.meshInfo&&t.meshInfo.colorMixMode,o=t.meshInfo&&t.meshInfo.edgesType;l=new h({symbolLayers:[new b({material:{color:s,colorMixMode:e||null},edges:"solid"===o?new p({color:I}):"sketch"===o?new d({color:I}):null})]});break}}return l}function K(e,t,o){const n=Q({layer:e,fields:t});if(n.length)return M(o,"Unknown fields: "+n.join(", ")+". You can only use fields defined in the layer schema");const s=X({layer:e,fields:t});return s.length?M(o,"Unsupported fields: "+s.join(", ")+". You can only use fields that are accessible to the renderer i.e. FieldUsageInfo.supportsRenderer must be true"):void 0}function Q(e){const t=e.layer;return e.fields.filter((e=>!t.getField(e)))}function X(e){const t=e.layer;return e.fields.filter((e=>{const o=t.getFieldUsageInfo(e);return!o||!o.supportsRenderer}))}async function Z(e,t){const o={layer:e.layer,view:e.view,signal:e.signal},[n,s]=await Promise.all([a(e),t?r(o):null]),i=E({min:n.minValue,max:n.maxValue,avg:null,stddev:null},!1,!1);return{result:i?await a({...e,classificationMethod:"equal-interval",numClasses:1,analyzeData:!1,minValue:i[0],maxValue:i[1],normalizationTotal:i[0]+i[1]}):n,defaultValuesUsed:!!i,outlineResult:s}}function _(e){return m(e)}function ee(e,t){let{minSize:o,maxSize:n}=e;if("height"===t){o=((n-o)/2+o)/(2*2.3),n*=2}return{minSize:o,maxSize:n}}function te(e){return U.test(e)}function oe(e){const t=e.match(U),o=Number(t[1]);if("%"===t[3])return new l({scaleFactor:o/100})}function ne(e,t,o,n){e.startTime=t instanceof Date?t.getTime():t,e.endTime=o instanceof Date?o.getTime():o,e.units=n,e.field="string"==typeof t?t:"string"==typeof o?o:null}async function se(e,t){let n=null,s=null;if(!e&&!t)return{basemapId:n,basemapTheme:s};if(!e&&t&&(e=t&&t.map?.basemap),e&&(n=c(e,F,!1),n)){const e=f(n);o(e)&&(s=e)}return n||"2d"!==t?.type||(s=await y(t),o(s)&&(n="dark"===s?"dark-gray":"gray")),{basemapId:n,basemapTheme:s}}export{N as clampAboveAndBelowStopValues,Y as createColors,W as createDataValues,O as createDefaultStopValues,M as createError,$ as createStopValues,q as createStopValuesForAboveBelow,J as createSymbol,B as formatDate,C as getBaseValueForAboveBelow,se as getBasemapInfo,Z as getClassBreaks,P as getDataRange,E as getDefaultDataRange,oe as getPointSizeAlgorithm,ee as getSizeRangeForAxis,_ as getSummaryStatistics,H as getSymbolOutlineFromScheme,G as getSymbolSizeFromScheme,te as isValidPointSize,ne as updateAgeRendererAuthoringInfoVV,K as verifyBasicFieldValidity};
