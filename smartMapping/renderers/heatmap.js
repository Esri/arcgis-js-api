/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/maybe","../../core/Error","../../Color","../../renderers/Renderer","../../renderers/ClassBreaksRenderer","../../renderers/UniqueValueRenderer","../../renderers/DictionaryRenderer","../../renderers/DotDensityRenderer","../../renderers/support/HeatmapColorStop","../../renderers/HeatmapRenderer","../../renderers/SimpleRenderer","../../renderers/support/jsonUtils","../support/utils","../support/adapters/support/layerUtils","./support/utils","../statistics/heatmapStatistics","../../chunks/heatmap"],(function(e,a,r,s,t,n,i,l,o,m,d,p,c,u,f,h,b,w){"use strict";async function y(e,r){const{fieldOffset:t}=e,{field:n,basemap:i,blurRadius:l,minRatio:o,maxRatio:p,fadeToTransparent:c,heatmapScheme:u,view:f}=r,{scheme:b,basemapId:y,basemapTheme:R}=await async function(e){let r=e.scheme,s=null,t=null;const n=await h.getBasemapInfo(e.basemap,e.view);if(s=a.isSome(n.basemapId)?n.basemapId:null,t=a.isSome(n.basemapTheme)?n.basemapTheme:null,r)return{scheme:w.cloneScheme(r),basemapId:s,basemapTheme:t};const i=w.getSchemes({basemap:s,basemapTheme:t});return i&&(r=i.primaryScheme,s=i.basemapId,t=i.basemapTheme),{scheme:r,basemapId:s,basemapTheme:t}}({basemap:i,scheme:u,view:f}),T=b.colors,g=T.length,S=!e.count,v=S?[0,100]:[e.min,e.max],I=(p-o)/(g-1),x=T[0],O=[new m({ratio:0,color:new s([x.r,x.g,x.b,0])}),new m({ratio:.01,color:new s([x.r,x.g,x.b,0])}),new m({ratio:c?o:.01,color:x})];h.createColors(T,g).forEach(((e,a)=>{O.push(new m({ratio:o+I*a,color:e}))}));const C=new d({blurRadius:l,colorStops:O,field:n,minPixelIntensity:v[0],maxPixelIntensity:v[1]});return null!=t&&(C.fieldOffset=t),{renderer:C,statistics:e,defaultValuesUsed:S,scheme:w.cloneScheme(b),basemapId:y,basemapTheme:R}}e.createRenderer=async function(e){const s=await async function(e){if(!(e&&e.layer&&e.view))throw new r("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");const{blurRadius:s,minRatio:t,maxRatio:n,fadeToTransparent:i}=e,l={...e};l.blurRadius=null==s?10:s,l.minRatio=null==t?.01:t,l.maxRatio=null==n?1:n,l.fadeToTransparent=null==i||i;const o=[0,2,1],m=f.createLayerAdapter(l.layer,o);if(l.layer=m,!m)throw new r("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+f.getLayerTypeLabels(o).join(", "));const d=a.isSome(l.signal)?{signal:l.signal}:null;await m.load(d);const p=await u.getFieldsList({field:l.field}),c=h.verifyBasicFieldValidity(m,p,"heatmap-renderer:invalid-parameters");if(c)throw c;return l}(e);return y(s.statistics?s.statistics:await b({layer:s.layer,field:s.field,fieldOffset:s.fieldOffset,blurRadius:s.blurRadius,view:s.view,signal:s.signal}),s)},Object.defineProperty(e,"__esModule",{value:!0})}));
