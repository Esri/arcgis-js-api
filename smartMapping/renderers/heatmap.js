/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../renderers/ClassBreaksRenderer","../../renderers/DictionaryRenderer","../../renderers/DotDensityRenderer","../../renderers/HeatmapRenderer","../../renderers/PieChartRenderer","../../renderers/Renderer","../../renderers/SimpleRenderer","../../renderers/UniqueValueRenderer","../../renderers/support/jsonUtils","../../core/Error","../../core/maybe","../../renderers/support/AuthoringInfo","../../renderers/support/HeatmapColorStop","../../renderers/support/heatmapUtils","./support/utils","../statistics/heatmapStatistics","../support/utils","../support/adapters/support/layerUtils","../symbology/heatmap"],(function(e,r,a,t,n,s,i,o,l,p,d,u,c,m,f,y,h,b,R,T,g,w){"use strict";const S=.01;function I(e){return L.apply(this,arguments)}function L(){return(L=r._asyncToGenerator((function*(e){if(!(e&&e.layer&&e.view))throw new c("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");const{blurRadius:r,radius:a,minRatio:t,maxRatio:n,fadeToTransparent:s,fadeRatio:i}=e,o={...e};o.radius=a??(null==r?18:h.gaussianBlurRadiusPxToKernelDensityRadiusPt(r)),o.minRatio=t??.01,o.maxRatio=n??1,o.fadeRatio=i??.2,o.fadeToTransparent=s??!0;const l=[g.LayerType.CSVLayer,g.LayerType.FeatureLayer,g.LayerType.OGCFeatureLayer,g.LayerType.GeoJSONLayer,g.LayerType.WFSLayer],p=g.createLayerAdapter(o.layer,l);if(o.layer=p,!p)throw new c("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+g.getLayerTypeLabels(l).join(", "));const d=m.isSome(o.signal)?{signal:o.signal}:null;yield p.load(d);const u=yield T.getFieldsList({field:o.field}),f=b.verifyBasicFieldValidity(p,u,"heatmap-renderer:invalid-parameters");if(f)throw f;return o}))).apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return(x=r._asyncToGenerator((function*(e){let r=e.scheme,a=null,t=null;const n=yield b.getBasemapInfo(e.basemap,e.view);if(a=m.isSome(n.basemapId)?n.basemapId:null,t=m.isSome(n.basemapTheme)?n.basemapTheme:null,r)return{scheme:w.cloneScheme(r),basemapId:a,basemapTheme:t};const s=w.getSchemes({basemap:a,basemapTheme:t});return s&&(r=s.primaryScheme,a=s.basemapId,t=s.basemapTheme),{scheme:r,basemapId:a,basemapTheme:t}}))).apply(this,arguments)}function C(e,r){return O.apply(this,arguments)}function O(){return(O=r._asyncToGenerator((function*(e,r){const{fieldOffset:t}=e,{field:n,basemap:s,radius:o,minRatio:l,maxRatio:p,fadeToTransparent:d,fadeRatio:u,heatmapScheme:c,view:m}=r,{scheme:h,basemapId:R,basemapTheme:T}=yield v({basemap:s,scheme:c,view:m}),g=h.colors,I=g.length,L=!e.count,x=L?[0,.04]:[e.min,e.max];let C;const O=(p-l)/(I-1),G=g[0],B=d?l:S,F=[new y({ratio:0,color:new a([G.r,G.g,G.b,0])}),new y({ratio:S,color:new a([G.r,G.g,G.b,0])}),new y({ratio:B,color:new a([G.r,G.g,G.b,B])})];b.createColors(g,I).forEach(((e,r)=>{const a=l+O*r;F.push(new y({ratio:a,color:e}))})),d&&(D(F,u),C=new f({fadeRatio:u}));const P=new i({authoringInfo:C,radius:o,colorStops:F,field:n,minDensity:x[0],maxDensity:x[1]});return null!=t&&(P.fieldOffset=t),{renderer:P,statistics:e,defaultValuesUsed:L,scheme:w.cloneScheme(h),basemapId:R,basemapTheme:T}}))).apply(this,arguments)}function D(e,r){const a=10*(1-r)+1;e.forEach(((e,t)=>{if(t<=2)return;const{ratio:n,color:s}=e;s.a=0===r?1:Math.min(Math.max(n*a,0),1)}))}function G(e){return B.apply(this,arguments)}function B(){return(B=r._asyncToGenerator((function*(e){const r=yield I(e);return C(r.statistics?r.statistics:yield R({layer:r.layer,field:r.field,fieldOffset:r.fieldOffset,radius:r.radius,view:r.view,signal:r.signal}),r)}))).apply(this,arguments)}function F(e){const{fadeRatio:r,renderer:a}=e,t=a.clone(),n=r??(t?.authoringInfo?.fadeRatio||0);return D(t.colorStops,n),t.authoringInfo?t.authoringInfo.fadeRatio=n:t.authoringInfo=new f({fadeRatio:n}),t}e.createRenderer=G,e.updateRenderer=F,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
