/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/Error","../../core/maybe","../../renderers/support/AuthoringInfo","../../renderers/support/AuthoringInfoVisualVariable","../../renderers/visualVariables/OpacityVariable","./support/utils","../statistics/summaryStatistics","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],(function(e,i,a,l,r,n,s,t,o,u,p,d){"use strict";const y="date";function c(e){return f.apply(this,arguments)}function f(){return(f=i._asyncToGenerator((function*(e){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new a("opacity-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.view)throw new a("opacity-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&u.verifyBinningParams(e,"opacity-visual-variable");const i={...e},r=e.forBinning?d.binningCapableLayerTypes:d.featureCapableLayerTypes,n=d.createLayerAdapter(i.layer,r,e.forBinning);if(i.layer=n,!n)throw new a("opacity-visual-variable:invalid-parameters","'layer' must be one of these types: "+d.getLayerTypeLabels(r).join(", "));const s=l.isSome(i.signal)?{signal:i.signal}:null;yield n.load(s);const o=yield p.getFieldsList({field:i.field,normalizationField:i.normalizationField,valueExpression:i.valueExpression}),y=t.verifyBasicFieldValidity(n,o,"opacity-visual-variable:invalid-parameters");if(y)throw y;return i}))).apply(this,arguments)}function v(e,i){const a=i.layer,l=i.field,o=l&&!("function"==typeof l)?a.getField(l):null,u=o&&o.type===y,p=t.createStopValues(e),d=t.getDefaultDataRange(e,u,!0),c=d||[p[0],p[4]],f=new s({field:l,valueExpression:i.valueExpression,valueExpressionTitle:i.valueExpressionTitle,normalizationField:i.normalizationField,stops:[{value:c[0],opacity:.3},{value:c[1],opacity:1}],legendOptions:i.legendOptions}),v=new n({type:"opacity",minSliderValue:null!=i.minValue?i.minValue:e.min,maxSliderValue:null!=i.maxValue?i.maxValue:e.max}),m=new r({visualVariables:[v]});return Promise.resolve({visualVariable:f,statistics:e,defaultValuesUsed:!!d,authoringInfo:m})}function m(e){return g.apply(this,arguments)}function g(){return(g=i._asyncToGenerator((function*(e){const i=yield c(e);let a=null;return a=i.statistics?i.statistics:yield o({layer:i.layer,field:i.field,valueExpression:i.valueExpression,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,normalizationType:i.normalizationField?"field":void 0,normalizationField:i.normalizationField,minValue:i.minValue,maxValue:i.maxValue,view:i.view,signal:i.signal}),v(a,i)}))).apply(this,arguments)}e.createVisualVariable=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
