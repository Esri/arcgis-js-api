/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/Error","../../core/maybe","../../renderers/support/AuthoringInfo","../../renderers/support/AuthoringInfoVisualVariable","../../renderers/visualVariables/OpacityVariable","./support/utils","../statistics/summaryStatistics","../support/utils","../support/adapters/support/layerUtils"],(function(e,i,a,l,s,r,n,t,o,u,p){"use strict";const d="date";function c(e){return y.apply(this,arguments)}function y(){return(y=i._asyncToGenerator((function*(e){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new a("opacity-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.view)throw new a("opacity-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");const i={...e},s=[0,2,1,3,5],r=p.createLayerAdapter(i.layer,s);if(i.layer=r,!r)throw new a("opacity-visual-variable:invalid-parameters","'layer' must be one of these types: "+p.getLayerTypeLabels(s).join(", "));const n=l.isSome(i.signal)?{signal:i.signal}:null;yield r.load(n);const o=yield u.getFieldsList({field:i.field,normalizationField:i.normalizationField,valueExpression:i.valueExpression}),d=t.verifyBasicFieldValidity(r,o,"opacity-visual-variable:invalid-parameters");if(d)throw d;return i}))).apply(this,arguments)}function v(e,i){const a=i.layer,l=i.field,o=l&&!("function"==typeof l)?a.getField(l):null,u=o&&o.type===d,p=t.createStopValues(e),c=t.getDefaultDataRange(e,u,!0),y=c||[p[0],p[4]],v=new n({field:l,valueExpression:i.valueExpression,valueExpressionTitle:i.valueExpressionTitle,normalizationField:i.normalizationField,stops:[{value:y[0],opacity:.3},{value:y[1],opacity:1}],legendOptions:i.legendOptions}),f=new r({type:"opacity",minSliderValue:null!=i.minValue?i.minValue:e.min,maxSliderValue:null!=i.maxValue?i.maxValue:e.max}),m=new s({visualVariables:[f]});return Promise.resolve({visualVariable:v,statistics:e,defaultValuesUsed:!!c,authoringInfo:m})}function f(e){return m.apply(this,arguments)}function m(){return(m=i._asyncToGenerator((function*(e){const i=yield c(e);let a=null;return a=i.statistics?i.statistics:yield o({layer:i.layer,field:i.field,valueExpression:i.valueExpression,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,normalizationType:i.normalizationField?"field":void 0,normalizationField:i.normalizationField,minValue:i.minValue,maxValue:i.maxValue,view:i.view,signal:i.signal}),v(a,i)}))).apply(this,arguments)}e.createVisualVariable=f,Object.defineProperty(e,"__esModule",{value:!0})}));
