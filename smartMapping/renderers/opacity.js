/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/maybe","../../core/Error","../../core/promiseUtils","../../renderers/support/AuthoringInfoVisualVariable","../../renderers/support/AuthoringInfo","../../renderers/visualVariables/OpacityVariable","../support/utils","../support/adapters/support/layerUtils","../statistics/summaryStatistics","./support/utils"],(function(e,i,a,l,s,r,t,n,o,u,p){"use strict";e.createVisualVariable=async function(e){const d=await async function(e){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new a("opacity-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.view)throw new a("opacity-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");const l={...e},s=[0,2,1,3],r=o.createLayerAdapter(l.layer,s);if(l.layer=r,!r)throw new a("opacity-visual-variable:invalid-parameters","'layer' must be one of these types: "+o.getLayerTypeLabels(s).join(", "));const t=i.isSome(l.signal)?{signal:l.signal}:null;await r.load(t);const u=await n.getFieldsList({field:l.field,normalizationField:l.normalizationField,valueExpression:l.valueExpression}),d=p.verifyBasicFieldValidity(r,u,"opacity-visual-variable:invalid-parameters");if(d)throw d;return l}(e);let c=null;return c=d.statistics?d.statistics:await u({layer:d.layer,field:d.field,valueExpression:d.valueExpression,sqlExpression:d.sqlExpression,sqlWhere:d.sqlWhere,normalizationType:d.normalizationField?"field":void 0,normalizationField:d.normalizationField,minValue:d.minValue,maxValue:d.maxValue,view:d.view,signal:d.signal}),function(e,i){const a=i.layer,n=i.field,o=n&&"function"!=typeof n?a.getField(n):null,u=o&&"date"===o.type,d=p.createStopValues(e),c=p.getDefaultDataRange(e,u,!0),v=c||[d[0],d[4]],m=new t({field:n,valueExpression:i.valueExpression,valueExpressionTitle:i.valueExpressionTitle,normalizationField:i.normalizationField,stops:[{value:v[0],opacity:.3},{value:v[1],opacity:1}],legendOptions:i.legendOptions}),y=new s({type:"opacity",minSliderValue:null!=i.minValue?i.minValue:e.min,maxSliderValue:null!=i.maxValue?i.maxValue:e.max}),f=new r({visualVariables:[y]});return l.resolve({visualVariable:m,statistics:e,defaultValuesUsed:!!c,authoringInfo:f})}(c,d)},Object.defineProperty(e,"__esModule",{value:!0})}));
