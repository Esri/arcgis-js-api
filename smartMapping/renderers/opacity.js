/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/maybe","../../core/Error","../../renderers/support/AuthoringInfoVisualVariable","../../renderers/support/AuthoringInfo","../../renderers/visualVariables/OpacityVariable","../support/utils","../support/adapters/support/layerUtils","../statistics/summaryStatistics","./support/utils"],(function(e,i,a,s,l,r,t,n,o,u){"use strict";const p="date";async function d(e){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new a("opacity-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.view)throw new a("opacity-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");const s={...e},l=[0,2,1,3],r=n.createLayerAdapter(s.layer,l);if(s.layer=r,!r)throw new a("opacity-visual-variable:invalid-parameters","'layer' must be one of these types: "+n.getLayerTypeLabels(l).join(", "));const o=i.isSome(s.signal)?{signal:s.signal}:null;await r.load(o);const p=await t.getFieldsList({field:s.field,normalizationField:s.normalizationField,valueExpression:s.valueExpression}),d=u.verifyBasicFieldValidity(r,p,"opacity-visual-variable:invalid-parameters");if(d)throw d;return s}function c(e,i){const a=i.layer,t=i.field,n=t&&!("function"==typeof t)?a.getField(t):null,o=n&&n.type===p,d=u.createStopValues(e),c=u.getDefaultDataRange(e,o,!0),v=c||[d[0],d[4]],m=new r({field:t,valueExpression:i.valueExpression,valueExpressionTitle:i.valueExpressionTitle,normalizationField:i.normalizationField,stops:[{value:v[0],opacity:.3},{value:v[1],opacity:1}],legendOptions:i.legendOptions}),y=new s({type:"opacity",minSliderValue:null!=i.minValue?i.minValue:e.min,maxSliderValue:null!=i.maxValue?i.maxValue:e.max}),f=new l({visualVariables:[y]});return Promise.resolve({visualVariable:m,statistics:e,defaultValuesUsed:!!c,authoringInfo:f})}async function v(e){const i=await d(e);let a=null;return a=i.statistics?i.statistics:await o({layer:i.layer,field:i.field,valueExpression:i.valueExpression,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,normalizationType:i.normalizationField?"field":void 0,normalizationField:i.normalizationField,minValue:i.minValue,maxValue:i.maxValue,view:i.view,signal:i.signal}),c(a,i)}e.createVisualVariable=v,Object.defineProperty(e,"__esModule",{value:!0})}));
