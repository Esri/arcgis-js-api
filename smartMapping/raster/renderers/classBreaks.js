/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import e from"../../../core/Error.js";import{isNone as r,isSome as a}from"../../../core/maybe.js";import{formatNumber as t}from"../../../intl/number.js";import{createClassBreaksRenderer as s,getField as n}from"../../../renderers/support/rasterRendererHelper.js";import{processRasterRendererParameters as o}from"../support/utils.js";async function i(t){const s=(t=await o(t)).layer,{rasterInfo:i}=s;if(i.bandCount>1)throw new e("raster-class-breaks-renderer:not-supported","Multiband raster is not supported");t.field||(t.field=a(i.attributeTable)?n(i.attributeTable,"value").name:"value");if(!(a(i.attributeTable)&&i.attributeTable.fields.find((e=>e.name.toLowerCase()===t.field.toLowerCase())))&&!a(i.histograms)&&(await s.updateRasterInfoWithEstimatedStats({renderingRule:t.renderingRule,signal:t.signal}),r(i.histograms)))throw new e("raster-class-breaks-renderer:not-supported","Histograms or raster attribute table is required on the source raster. Unable to estimate histograms");const{colors:l,numClasses:u}=t;if(l&&u&&l.length!==u)throw new e("raster-class-breaks-renderer:not-supported","The size of the `colors` parameter does not match 'numClasses'");return t.classificationMethod||(t.classificationMethod="natural-breaks"),t}async function l(a){a=await i(a);const t=s(a.layer.rasterInfo,a);if(r(t))throw new e("raster-class-breaks-renderer:not-supported","Class breaks renderer is not supported on this data");const n={minValue:t.minValue,maxValue:t.classBreakInfos[t.classBreakInfos.length-1].maxValue,normalizationTotal:null,classBreakInfos:t.classBreakInfos.map((e=>{const r=u(e.minValue,e.maxValue);return e.label=r,{minValue:e.minValue,maxValue:e.maxValue,label:r}}))};return{renderer:t,classBreaksResult:n}}function u(e,r){return t(e,{maximumFractionDigits:3})+" - "+t(r,{maximumFractionDigits:3})}export{l as createRenderer};
