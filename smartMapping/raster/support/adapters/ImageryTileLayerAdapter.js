/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/has","../../../../core/Logger","../../../../core/accessorSupport/ensureType","../../../../core/accessorSupport/decorators/property","../../../../core/accessorSupport/decorators/subclass","../../../../core/Error","../../../../core/urlUtils","../../../../core/uuid","../../../../portal/support/resourceExtension","../../../../core/promiseUtils","../../../../geometry/Extent","../../../../layers/support/rasterFunctions/pixelUtils","./RasterLayerAdapter"],(function(t,e,r,s,a,i,o,n,l,c,h,p,u,m,x){"use strict";let y=function(e){function r(){return e.apply(this,arguments)||this}t._inheritsLoose(r,e);var s=r.prototype;return s.generateRasterInfo=function(t){return p.resolve(this.rasterInfo)},s.estimateStatisticsHistograms=async function(t){if(null!==this._statsCache)return this._statsCache;const{raster:e}=this.layer,{extent:r,width:s,height:a}=this.getSamplePixelBlockDescriptor(e.rasterInfo),{pixelBlock:i}=await e.fetchPixels(r,s,a,t);if(null==i)throw new n("raster-layer-adapter","Unable to estimate histograms");return this._statsCache=m.estimateStatisticsHistograms(i),this._statsCache},s.supportsMultidirectionalHillshade=function(){return!0},s.load=function(t){return this.addResolvingPromise(this.layer.load(t).then((()=>this.rasterInfo=this.layer.raster.rasterInfo))),p.resolve(this)},s.getSamplePixelBlockDescriptor=function(t,e=1e3){const{pyramidScalingFactor:r,maximumPyramidLevel:s}=t.storageInfo;let{extent:a,width:i,height:o,pixelSize:n}=t,l=Math.ceil(Math.log(Math.max(i,o)/e)/Math.log(r))-1,c=0,h=0;if(l<=s){const t=Math.pow(r,l);i=Math.floor(i/t),o=Math.floor(o/t)}else l=0,i=Math.min(i,e),o=Math.min(o,e),c=Math.max(Math.floor(i/2-500),0),h=Math.max(Math.floor(o/2-500),0),a=new u({xmin:a.xmin+c*n.x,xmax:Math.min(a.xmax,a.xmin+c*n.x*e),ymin:a.ymin+h*n.y,ymax:Math.min(a.ymax,a.ymin+h*n.y*e)});return{extent:a,width:i,height:o,origin:{x:c,y:h}}},r}(x);return e.__decorate([i.property()],y.prototype,"layer",void 0),y=e.__decorate([o.subclass("esri.smartMapping.support.adapters.ImageryTileLayerAdapter")],y),y}));
