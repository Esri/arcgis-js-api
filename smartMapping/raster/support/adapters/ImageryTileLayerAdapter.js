/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../../../../core/Error","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/accessorSupport/ensureType","../../../../core/Logger","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Extent","../../../../layers/support/rasterFunctions/pixelUtils","./RasterLayerAdapter"],(function(t,e,r,s,a,i,o,n,l,c,h){"use strict";let p=function(e){function s(){return e.apply(this,arguments)||this}t._inheritsLoose(s,e);var a=s.prototype;return a.generateRasterInfo=function(t){return Promise.resolve(this.rasterInfo)},a.estimateStatisticsHistograms=function(){var e=t._asyncToGenerator((function*(t){if(null!==this._statsCache)return this._statsCache;const{raster:e}=this.layer,{extent:s,width:a,height:i}=this.getSamplePixelBlockDescriptor(e.rasterInfo),{pixelBlock:o}=yield e.fetchPixels(s,a,i,t);if(null==o)throw new r("raster-layer-adapter","Unable to estimate histograms");return this._statsCache=c.estimateStatisticsHistograms(o),this._statsCache}));function s(t){return e.apply(this,arguments)}return s}(),a.supportsMultidirectionalHillshade=function(){return!0},a.load=function(t){return this.addResolvingPromise(this.layer.load(t).then((()=>this.rasterInfo=this.layer.raster.rasterInfo))),Promise.resolve(this)},a.getSamplePixelBlockDescriptor=function(t,e=1e3){const{pyramidScalingFactor:r,maximumPyramidLevel:s}=t.storageInfo;let{extent:a,width:i,height:o,pixelSize:n}=t,c=Math.ceil(Math.log(Math.max(i,o)/e)/Math.log(r))-1,h=0,p=0;if(c<=s){const t=r**c;i=Math.floor(i/t),o=Math.floor(o/t)}else c=0,i=Math.min(i,e),o=Math.min(o,e),h=Math.max(Math.floor(i/2-500),0),p=Math.max(Math.floor(o/2-500),0),a=new l({xmin:a.xmin+h*n.x,xmax:Math.min(a.xmax,a.xmin+h*n.x*e),ymin:a.ymin+p*n.y,ymax:Math.min(a.ymax,a.ymin+p*n.y*e)});return{extent:a,width:i,height:o,origin:{x:h,y:p}}},s}(h);return e.__decorate([s.property()],p.prototype,"layer",void 0),p=e.__decorate([n.subclass("esri.smartMapping.support.adapters.ImageryTileLayerAdapter")],p),p}));
