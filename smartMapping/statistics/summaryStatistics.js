/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../core/maybe","../../core/Error","../../layers/support/fieldUtils","../support/utils","./support/utils","../support/adapters/support/layerUtils"],(function(e,i,s,a,r,t){"use strict";const n="date",l=[...s.numericTypes,n];async function o(n){if(!(n&&n.layer&&(n.field||n.valueExpression||n.sqlExpression)))throw new i("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(n.valueExpression&&!n.sqlExpression&&!n.view)throw new i("summary-statistics:missing-parameters","View is required when 'valueExpression' is specified");const o=[0,2,1,3,4],{layer:p,...m}=n,u=t.createLayerAdapter(p,o),d={layerAdapter:u,...m};if(d.normalizationType=a.getNormalizationType(d),!u)throw new i("summary-statistics:invalid-parameters","'layer' must be one of these types: "+t.getLayerTypeLabels(o).join(", "));const y=e.isSome(d.signal)?{signal:d.signal}:null;await u.load(y);const c=d.field,f=d.normalizationType,w=d.valueExpression||d.sqlExpression,v=c?u.getField(c):null,E=await a.getFieldsList({field:d.field,normalizationField:d.normalizationField,valueExpression:d.valueExpression}),x=r.verifyBasicFieldValidity(u,E,"summary-statistics:invalid-parameters");if(x)throw x;if(v){const e=r.verifyFieldType(u,v,"summary-statistics:invalid-parameters",l);if(e)throw e;if(s.isDateField(v)&&f)throw new i("summary-statistics:invalid-parameters","Normalization is not allowed for date fields")}else if(w&&f)throw new i("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");return d}async function p(e){const{layerAdapter:i,...s}=await o(e);return i.summaryStatistics(s)}return p}));
