/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/Error","../../core/maybe","../../layers/support/fieldUtils","./support/utils","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],(function(i,e,s,r,t,a,n,l){"use strict";const o=[...r.numericTypes,"date","string"];function p(i){return u.apply(this,arguments)}function u(){return(u=i._asyncToGenerator((function*(i){if(!(i&&i.layer&&(i.field||i.valueExpression||i.sqlExpression)))throw new e("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(i.valueExpression&&!i.sqlExpression&&!i.view)throw new e("summary-statistics:missing-parameters","View is required when 'valueExpression' is specified");i.forBinning&&a.verifyBinningParams(i,"summary-statistics");const{layer:p,...u}=i,y=i.forBinning?l.binningCapableLayerTypes:l.defaultSupportedLayerTypes,m=l.createLayerAdapter(p,y,i.forBinning),d={layerAdapter:m,...u};if(d.normalizationType=n.getNormalizationType(d),!m)throw new e("summary-statistics:invalid-parameters","'layer' must be one of these types: "+l.getLayerTypeLabels(y).join(", "));const f=s.isSome(d.signal)?{signal:d.signal}:null;yield m.load(f);const c=d.field,v=d.normalizationType,w=d.valueExpression||d.sqlExpression,g=c?m.getField(c):null,h=yield n.getFieldsList({field:d.field,normalizationField:d.normalizationField,valueExpression:d.valueExpression}),E=t.verifyBasicFieldValidity(m,h,"summary-statistics:invalid-parameters");if(E)throw E;if(g){const i=t.verifyFieldType(m,g,"summary-statistics:invalid-parameters",o);if(i)throw i;if(r.isDateField(g)&&v)throw new e("summary-statistics:invalid-parameters","Normalization is not allowed for date fields")}else if(w&&v)throw new e("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");const x=t.verifyFilterValidty(d.filter,"summary-statistics:invalid-parameters");if(x)throw x;return d}))).apply(this,arguments)}function y(i){return m.apply(this,arguments)}function m(){return(m=i._asyncToGenerator((function*(i){const{layerAdapter:e,...s}=yield p(i);return e.summaryStatistics(s)}))).apply(this,arguments)}return y}));
