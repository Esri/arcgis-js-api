/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/mathUtils","../../../support/arcadeOnDemand"],(function(e,t,n){"use strict";function i(e,n=!0,i=!0){return t.isFinite(e)&&(n||0!==e)&&(i||e>=0)}function s(e){return l.apply(this,arguments)}function l(){return(l=e._asyncToGenerator((function*(e){const{features:t,attributes:s,includeZeros:l,includeNegatives:o,view:c}=e;let r=0,a=0,u=1/0,f=-1/0,p=null;const d=new Map;for(let i=0;i<s.length;i++){const{valueExpression:e}=s[i];if(e){if(!p){const{arcadeUtils:e}=yield n.loadArcade();p=e}d.set(i,p.createFunction(e))}}const g=c&&p&&p.getViewInfo({viewingMode:"2d"===c.type?"map":c.viewingMode,scale:c.scale,spatialReference:c.spatialReference});for(const n of t){const e=n.geometry,t=n.attributes;if(e){const c=e.extent;if(c){const e=c.width*c.height;if(e>0){let c=0;const h=p&&p.createExecContext(n,g);for(let e=0;e<s.length;e++){const{field:n,valueExpression:r}=s[e];let a=null;if(n)a=t[n];else if(r){const t=d.get(e);a=p.executeFunction(t,h)}i(a,l,o)&&(c+=a||0)}if(i(c,l,o)){const t=c/e;++r,a+=t,t<u&&(u=t),t>f&&(f=t)}}}}}return{minDensity:u!==1/0?u:null,maxDensity:f!==-1/0?f:null,avgDensity:r?a/r:null}}))).apply(this,arguments)}return s}));
