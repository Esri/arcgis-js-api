/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../../support/arcadeOnDemand","../../support/adapters/support/utils"],(function(e,t){"use strict";function n(e,n=!0,i=!0){return t.isValidNumber(e)&&(n||0!==e)&&(i||e>=0)}return async function(t){const{features:i,attributes:s,includeZeros:o,includeNegatives:c,view:a}=t;let l=0,r=0,u=1/0,f=-1/0,d=null;const p=new Map;for(let t=0;t<s.length;t++){const{valueExpression:n}=s[t];if(n){if(!d){const{arcadeUtils:t}=await e.loadArcade();d=t}p.set(t,d.createFunction(n))}}const g=a&&d&&d.getViewInfo({viewingMode:"2d"===a.type?"map":a.viewingMode,scale:a.scale,spatialReference:a.spatialReference});for(const e of i){const t=e.geometry,i=e.attributes;if(t){const a=t.extent;if(a){const t=a.width*a.height;if(t>0){let a=0;const v=d&&d.createExecContext(e,g);for(let e=0;e<s.length;e++){const{field:t,valueExpression:l}=s[e];let r=null;if(t)r=i[t];else if(l){const t=p.get(e);r=d.executeFunction(t,v)}n(r,o,c)&&(a+=r||0)}if(n(a,o,c)){const e=a/t;++l,r+=e,e<u&&(u=e),e>f&&(f=e)}}}}}return{minDensity:u!==1/0?u:null,maxDensity:f!==-1/0?f:null,avgDensity:l?r/l:null}}}));
