/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../core/maybe","../../core/Error","../support/adapters/support/layerUtils","./summaryStatistics","./support/ageUtils"],(function(e,a,t,r,s){"use strict";async function i(r){if(!(r&&r.layer&&r.startTime&&r.endTime&&r.unit))throw new a("summary-statistics-for-age:missing-parameters","'layer', 'startTime', 'endTime' and 'unit' parameters are required");const i=[0,2,1,3],{layer:n,...m}=r,o=t.createLayerAdapter(n,i),u={layerAdapter:o,...m};if(!o)throw new a("summary-statistics-for-age:invalid-parameters","'layer' must be one of these types: "+t.getLayerTypeLabels(i).join(", "));const l=u.view,p=e.isSome(u.signal)?{signal:u.signal}:null;await Promise.all([l&&l.when(),o.load(p)]);const y=s.verifyDates(o,u.startTime,u.endTime,"summary-statistics-for-age:invalid-parameters");if(y)throw y;if(-1===s.supportedAgeUnits.indexOf(u.unit))throw new a("summary-statistics-for-age:invalid-parameters",`Supported units are: ${s.supportedAgeUnits.join(", ")}`);return u}async function n(e){const{layerAdapter:a,...t}=await i(e),{view:n,startTime:m,endTime:o,unit:u,minValue:l,maxValue:p,signal:y}=t,{valueExpression:d,statisticsQuery:c}=s.getAgeExpressions({layer:a,startTime:m,endTime:o,unit:u}),g={layer:a,valueExpression:d,...c,minValue:l,maxValue:p,view:n,signal:y};return r(g)}return n}));
