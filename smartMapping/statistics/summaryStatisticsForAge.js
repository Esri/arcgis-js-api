/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../../core/maybe","../../core/Error","../../core/promiseUtils","../support/adapters/support/layerUtils","./summaryStatistics","./support/ageUtils"],(function(e,t,a,r,s,i){"use strict";return async function(n){const{layerAdapter:o,...m}=await async function(s){if(!(s&&s.layer&&s.startTime&&s.endTime&&s.unit))throw new t("summary-statistics-for-age:missing-parameters","'layer', 'startTime', 'endTime' and 'unit' parameters are required");const n=[0,2,1,3],{layer:o,...m}=s,u=r.createLayerAdapter(o,n),l={layerAdapter:u,...m};if(!u)throw new t("summary-statistics-for-age:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(n).join(", "));const p=l.view,y=e.isSome(l.signal)?{signal:l.signal}:null;await a.all([p&&p.when(),u.load(y)]);const c=i.verifyDates(u,l.startTime,l.endTime,"summary-statistics-for-age:invalid-parameters");if(c)throw c;if(-1===i.supportedAgeUnits.indexOf(l.unit))throw new t("summary-statistics-for-age:invalid-parameters",`Supported units are: ${i.supportedAgeUnits.join(", ")}`);return l}(n),{view:u,startTime:l,endTime:p,unit:y,minValue:c,maxValue:d,signal:g}=m,{valueExpression:f,statisticsQuery:w}=i.getAgeExpressions({layer:o,startTime:l,endTime:p,unit:y}),T={layer:o,valueExpression:f,...w,minValue:c,maxValue:d,view:u,signal:g};return s(T)}}));
