/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/Error","../../core/maybe","./support/utils","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],(function(e,r,t,s,i,a,n){"use strict";function u(e){return l.apply(this,arguments)}function l(){return(l=e._asyncToGenerator((function*(e){if(!(e&&e.layer&&e.attributes))throw new r("summary-statistics-for-attributes:missing-parameters","'layer' and 'attributes' parameters are required");if(e.attributes.some((e=>!!e.valueExpression))&&!e.view)throw new r("summary-statistics-for-attributes:missing-parameters","View is required when 'valueExpression' is specified in attributes");e.forBinning&&i.verifyBinningParams(e,"summary-statistics-for-attributes");const{layer:u,...l}=e,o=[n.LayerType.CSVLayer,n.LayerType.FeatureLayer,n.LayerType.OGCFeatureLayer,n.LayerType.GeoJSONLayer,n.LayerType.WFSLayer],p=e.forBinning?n.binningCapableLayerTypes:o,y=n.createLayerAdapter(u,p,e.forBinning),c={layerAdapter:y,...l};if(c.includeZeros=null==c.includeZeros||c.includeZeros,c.includeNegatives=null==c.includeNegatives||c.includeNegatives,!y)throw new r("summary-statistics-for-attributes:invalid-parameters","'layer' must be one of these types: "+n.getLayerTypeLabels(p).join(", "));const f=c.view,d=t.isSome(c.signal)?{signal:c.signal}:null;yield Promise.all([f&&f.when(),y.load(d)]);const m=[];for(const r of c.attributes){const e=yield a.getFieldsList({field:r.field,valueExpression:r.valueExpression});Array.prototype.push.apply(m,e)}const g=s.verifyBasicFieldValidity(y,m,"summary-statistics-for-attributes:invalid-parameters");if(g)throw g;return c}))).apply(this,arguments)}function o(e){return p.apply(this,arguments)}function p(){return(p=e._asyncToGenerator((function*(e){const{layerAdapter:r,...t}=yield u(e),i=s.getSumOfAttributesExpr(t.attributes,t.includeZeros,t.includeNegatives);return r.summaryStatistics({valueExpression:i.valueExpression,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,view:t.view,signal:t.signal})}))).apply(this,arguments)}return o}));
