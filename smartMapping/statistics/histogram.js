/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/Error","../../core/maybe","../../layers/support/fieldUtils","./support/utils","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],(function(e,i,r,a,s,n,t,o){"use strict";const l=["date",...a.numericTypes];function p(e){return d.apply(this,arguments)}function d(){return(d=e._asyncToGenerator((function*(e){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new i("histogram:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.sqlExpression&&!e.view)throw new i("histogram:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&n.verifyBinningParams(e,"histogram");const{layer:p,...d}=e,f=e.forBinning?o.binningCapableLayerTypes:o.defaultSupportedLayerTypes,u=o.createLayerAdapter(p,f,e.forBinning),h={layerAdapter:u,...d};if(h.normalizationType=t.getNormalizationType(h),!u)throw new i("histogram:invalid-parameters","'layer' must be one of these types: "+o.getLayerTypeLabels(f).join(", "));const m=r.isSome(h.signal)?{signal:h.signal}:null;yield u.load(m);const y=h.valueExpression||h.sqlExpression,c=h.field,g=c?u.getField(c):null,w=!h.classificationMethod||"equal-interval"===h.classificationMethod,v=yield t.getFieldsList({field:c,normalizationField:h.normalizationField,valueExpression:h.valueExpression}),E=s.verifyBasicFieldValidity(u,v,"histogram:invalid-parameters");if(E)throw E;if(g){const e=s.verifyFieldType(u,g,"histogram:invalid-parameters",l);if(e)throw e;if(a.isDateField(g)){if(h.normalizationType)throw new i("histogram:invalid-parameters","Normalization is not allowed for date fields");if(!w)throw new i("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed for date fields")}}else if(y){if(h.normalizationType)throw new i("histogram:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified");if(!w)throw new i("histogram:invalid-parameters","'classificationMethod' other than 'equal-interval' is not allowed when 'valueExpression' or 'sqlExpression' is specified")}const x=s.verifyFilterValidty(h.filter,"histogram:invalid-parameters");if(x)throw x;return h}))).apply(this,arguments)}function f(e){return u.apply(this,arguments)}function u(){return(u=e._asyncToGenerator((function*(e){const{layerAdapter:i,...r}=yield p(e);return i.histogram(r)}))).apply(this,arguments)}return f}));
