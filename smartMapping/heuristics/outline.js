/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/Error","../../core/maybe","../../geometry/support/scaleUtils","../../renderers/visualVariables/SizeVariable","../statistics/spatialStatistics","../support/binningUtils","../support/adapters/support/layerUtils"],(function(e,i,t,n,r,a,s,o){"use strict";const l=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];function u(e){return p.apply(this,arguments)}function p(){return(p=e._asyncToGenerator((function*(e){const{view:n}=e;if(!(e&&n&&e.layer))throw new i("outline:missing-parameters","'view' and 'layer' parameters are required");e.forBinning&&s.verifyBinningParams(e,"outline");const{layer:r,...a}=e,l=e.forBinning?o.binningCapableLayerTypes:o.featureCapableLayerTypes,u=o.createLayerAdapter(r,l,e.forBinning),p={layerAdapter:u,...a};if(!u)throw new i("outline:invalid-parameters","'layer' must be one of these types: "+o.getLayerTypeLabels(l).join(", "));yield n.when();const y=t.isSome(p.signal)?{signal:p.signal}:null;if(yield u.load(y),"polygon"!==u.geometryType)throw new i("outline:not-supported",`outline is not supported for geometryType: ${u.geometryType}`);return p}))).apply(this,arguments)}function y(e,i){const t=e.avgSize,a=n.getScaleForResolution(1,i.spatialReference),s=l.map((e=>({size:e.width,value:Math.round(t/e.size*a)})));s.sort(((e,i)=>e.value-i.value));return{visualVariables:[new r({target:"outline",valueExpression:"$view.scale",stops:s})],opacity:.25}}function c(e){return f.apply(this,arguments)}function f(){return(f=e._asyncToGenerator((function*(e){const{layerAdapter:t,...n}=yield u(e),r=-1,s=yield t.getSampleFeatures({sampleSize:r,returnGeometry:!0,...n});if(!s?.length)throw new i("outline:insufficient-info","No features are available to calculate statistics");const o=yield a({features:s,geometryType:t.geometryType});if(!("avgSize"in o)||!o.avgSize)throw new i("outline:insufficient-info","average polygon size is invalid");return y(o,n.view)}))).apply(this,arguments)}return c}));
