/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["../../core/maybe","../../core/Error","../../renderers/visualVariables/SizeVariable","../../geometry/support/scaleUtils","../support/adapters/support/layerUtils","../statistics/spatialStatistics"],(function(e,t,a,i,r,s){"use strict";const n=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];async function o(a){const{view:i}=a;if(!(a&&i&&a.layer))throw new t("outline:missing-parameters","'view' and 'layer' parameters are required");const s=[0,2,3,1],{layer:n,...o}=a,l=r.createLayerAdapter(n,s),u={layerAdapter:l,...o};if(!l)throw new t("outline:invalid-parameters","'layer' must be one of these types: "+r.getLayerTypeLabels(s).join(", "));await i.when();const p=e.isSome(u.signal)?{signal:u.signal}:null;if(await l.load(p),"polygon"!==l.geometryType)throw new t("outline:not-supported",`outline is not supported for geometryType: ${l.geometryType}`);return u}function l(e,t){const r=e.avgSize,s=i.getScaleForResolution(1,t.spatialReference),o=n.map((e=>({size:e.width,value:Math.round(r/e.size*s)})));o.sort(((e,t)=>e.value-t.value));return{visualVariables:[new a({target:"outline",valueExpression:"$view.scale",stops:o})],opacity:.25}}async function u(e){const{layerAdapter:a,...i}=await o(e),r=-1,n=await a.getSampleFeatures({sampleSize:r,returnGeometry:!0,...i}),u=await s({features:n,geometryType:a.geometryType});if(!("avgSize"in u)||!u.avgSize)throw new t("outline:insufficient-info","average polygon size is invalid");return l(u,i.view)}return u}));
