/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["../../chunks/_rollupPluginBabelHelpers","../../core/Error","../../core/maybe","../../geometry/support/scaleUtils","../statistics/spatialStatistics","../support/adapters/support/layerUtils"],(function(e,t,n,a,r,l){"use strict";const i=500,s=1e8,o=1280,c=12,u=30,p=15;function y(e){return f.apply(this,arguments)}function f(){return(f=e._asyncToGenerator((function*(e){const{view:a,sampleSize:r}=e;if(!(e&&a&&e.layer))throw new t("scale-range:missing-parameters","'view' and 'layer' parameters are required");const s=[0,2,3,1,5],{layer:o,...c}=e,u=l.createLayerAdapter(o,s),p={layerAdapter:u,...c};if(p.sampleSize=r||i,!u)throw new t("scale-range:invalid-parameters","'layer' must be one of these types: "+l.getLayerTypeLabels(s).join(", "));yield a.when();const y=n.isSome(p.signal)?{signal:p.signal}:null;return yield u.load(y),p}))).apply(this,arguments)}function m(e,t){const n=c,a=o/4,r=u,l=o/4,i=p,s=o/2;let y=null,f=null,m=null,g=null;switch(e){case"point":case"multipoint":{const e=t;y=e.avgMinDistance,f=n,m=e.minDistance,g=a;break}case"polyline":{const e=t;y=e.avgLength,f=r,m=e.minLength,g=l;break}case"polygon":{const e=t;y=e.avgSize,f=i,m=e.minSize,g=s;break}}return{resolutionForMinScale:y>0?y/f:null,resolutionForMaxScale:m>0?m/g:null}}function g(e,t,n){const r=m(e.geometryType,t);return{minScale:a.getScaleForResolution(r.resolutionForMinScale,n.spatialReference),maxScale:a.getScaleForResolution(r.resolutionForMaxScale,n.spatialReference)}}function S(e,t,n=!0){if(e.constraints&&"effectiveLODs"in e.constraints){const a=e.constraints.effectiveLODs,r=n?a:a.slice(0).reverse();let l=null;for(const e of r)if(!(n?e.scale>t:e.scale<t)){l=e;break}return l}}function d(e,n,a,r){const{view:l,snapToLOD:i,layerAdapter:o}=e;if(i){const e=S(l,n),t=S(l,a,!1);n=e?e.scale:n,a=t?t.scale:a}if(n<a)throw new t("scale-range:invalid","calculated minScale is less than maxScale.");return a>n/2&&(a=Math.floor(a/2)),n>s&&(n=0),"polygon"!==o.geometryType&&(a=0),{minScale:Math.ceil(n),maxScale:Math.floor(a),spatialStatistics:r}}function h(e){return v.apply(this,arguments)}function v(){return(v=e._asyncToGenerator((function*(e){const t=yield y(e),{view:n,sampleSize:a,layerAdapter:l,signal:i}=t,s=yield l.getSampleFeatures({view:n,sampleSize:a,returnGeometry:!0,signal:i}),o=yield r({features:s,geometryType:l.geometryType}),{minScale:c,maxScale:u}=g(l,o,n);return d(t,c,u,o)}))).apply(this,arguments)}return h}));
