// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.15/esri/copyright.txt for details.

define(["require","exports","../../widgets/support/widgetUtils"],(function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o="http://www.w3.org/2000/svg",n=[];t.extend=function(e,t){var r={};return Object.keys(e).forEach((function(t){r[t]=e[t]})),t&&Object.keys(t).forEach((function(e){r[e]=t[e]})),r};var i,s=function(e,t){return e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties)},p=function(e){if("string"!=typeof e)throw new Error("Style values must be strings")},a=function(e,t,r){if(""!==t.vnodeSelector)for(var o=r;o<e.length;o++)if(s(e[o],t))return o;return-1},d=function(e,t,r,o){var n=e[t];if(""!==n.vnodeSelector){var i=n.properties;if(!(i?void 0===i.key?i.bind:i.key:void 0))for(var p=0;p<e.length;p++)if(p!==t){var a=e[p];if(s(a,n))throw new Error(r.vnodeSelector+" had a "+n.vnodeSelector+" child "+("added"===o?o:"removed")+", but there is now more than one. You must add unique key properties to make them distinguishable.")}}},l=function(e){if(e.properties){var t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},c=[],f=!1,v=function(e){(e.children||[]).forEach(v),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},u=function(){f=!1,c.forEach(v),c.length=0},h=function(e){c.push(e),f||(f=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(u,{timeout:16}):setTimeout(u,16))},m=function(e){var t=e.domNode;if(e.properties){var r=e.properties.exitAnimation;if(r){t.style.pointerEvents="none";return void r(t,(function(){t.parentNode&&(t.parentNode.removeChild(t),h(e))}),e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),h(e))};t.initPropertiesAndChildren=function(e,n,i){!function(e,r,o){if(r)for(var n=0,i=r;n<i.length;n++){var s=i[n];t.createDom(s,e,void 0,o)}}(e,n.children,i),n.text&&(e.textContent=n.text),function(e,t,n){if(t)for(var i=n.eventHandlerInterceptor,s=Object.keys(t),a=s.length,d=function(a){var d,l=s[a],c=t[l];if("className"===l)throw new Error('Property "className" is not supported, use "class".');if("class"===l)y(e,c,!0);else if("classes"===l)for(var f=Object.keys(c),v=f.length,u=0;u<v;u++){var h=f[u];c[h]&&e.classList.add(h)}else if("styles"===l){var m=Object.keys(c),g=m.length;for(u=0;u<g;u++){var w=m[u],b=c[w];b&&(p(b),n.styleApplyer(e,w,b))}}else if("key"!==l&&null!=c){var N=typeof c;"function"===N?0===l.lastIndexOf("on",0)&&(i&&(c=i(l,c,e,t)),"oninput"===l&&(d=c,c=function(e){d.apply(this,[e]),e.target["oninput-value"]=e.target.value}),e[l]=c):n.namespace===o?"href"===l?e.setAttributeNS("http://www.w3.org/1999/xlink",l,c):e.setAttribute(l,c):"string"===N&&"value"!==l?"innerHTML"===l?e[l]=r.renderingSanitizer.sanitize(c):e.setAttribute(l,c):e[l]=c}},l=0;l<a;l++)d(l)}(e,n.properties,i),n.properties&&n.properties.afterCreate&&n.properties.afterCreate.apply(n.properties.bind||n.properties,[e,i,n.vnodeSelector,n.properties,n.children])},t.createDom=function(e,r,n,i){var s,p=0,a=e.vnodeSelector,d=r.ownerDocument;if(""===a)s=e.domNode=d.createTextNode(e.text),void 0!==n?r.insertBefore(s,n):r.appendChild(s);else{for(var l=0;l<=a.length;++l){var c=a.charAt(l);if(l===a.length||"."===c||"#"===c){var f=a.charAt(p-1),v=a.slice(p,l);"."===f?s.classList.add(v):"#"===f?s.id=v:("svg"===v&&(i=t.extend(i,{namespace:o})),void 0!==i.namespace?s=e.domNode=d.createElementNS(i.namespace,v):(s=e.domNode=e.domNode||d.createElement(v),"input"===v&&e.properties&&void 0!==e.properties.type&&s.setAttribute("type",e.properties.type)),void 0!==n?r.insertBefore(s,n):s.parentNode!==r&&r.appendChild(s)),p=l+1}}t.initPropertiesAndChildren(s,e,i)}};var y=function(e,t,r){t&&t.split(" ").forEach((function(t){t&&e.classList.toggle(t,r)}))};i=function(e,c,f){var v=e.domNode,u=!1;if(e===c)return!1;var h=!1;if(""===c.vnodeSelector){if(c.text!==e.text){var g=v.ownerDocument.createTextNode(c.text);return v.parentNode.replaceChild(g,v),c.domNode=g,u=!0}c.domNode=v}else 0===c.vnodeSelector.lastIndexOf("svg",0)&&(f=t.extend(f,{namespace:o})),e.text!==c.text&&(h=!0,void 0===c.text?v.removeChild(v.firstChild):v.textContent=c.text),c.domNode=v,h=function(e,r,o,p,c){if(o===p)return!1;p=p||n;for(var f,v=(o=o||n).length,u=p.length,h=0,y=0,g=!1;y<u;){var w=h<v?o[h]:void 0,b=p[y];if(void 0!==w&&s(w,b))g=i(w,b,c)||g,h++;else{var N=a(o,b,h+1);if(N>=0){for(f=h;f<N;f++)m(o[f]),d(o,f,e,"removed");g=i(o[N],b,c)||g,h=N+1}else t.createDom(b,r,h<v?o[h].domNode:void 0,c),l(b),d(p,y,e,"added")}y++}if(v>h)for(f=h;f<v;f++)m(o[f]),d(o,f,e,"removed");return g}(c,v,e.children,c.children,f)||h,h=function(e,t,n,i){if(n){for(var s=!1,a=Object.keys(n),d=a.length,l=0;l<d;l++){var c=a[l],f=n[c],v=t[c];if("class"===c)v!==f&&(y(e,v,!1),y(e,f,!0));else if("classes"===c)for(var u=e.classList,h=Object.keys(f),m=h.length,g=0;g<m;g++){var w=h[g],b=!!f[w];b!==!!v[w]&&(s=!0,b?u.add(w):u.remove(w))}else if("styles"===c){var N=Object.keys(f),x=N.length;for(g=0;g<x;g++){var k=N[g],A=f[k];A!==v[k]&&(s=!0,A?(p(A),i.styleApplyer(e,k,A)):i.styleApplyer(e,k,""))}}else if(f||"string"!=typeof v||(f=""),"value"===c){var S=e[c];S!==f&&(e["oninput-value"]?S===e["oninput-value"]:f!==v)&&(e[c]=f,e["oninput-value"]=void 0),f!==v&&(s=!0)}else if(f!==v){var C=typeof f;"function"===C&&i.eventHandlerInterceptor||(i.namespace===o?"href"===c?e.setAttributeNS("http://www.w3.org/1999/xlink",c,f):e.setAttribute(c,f):"string"===C?"innerHTML"===c?e[c]=r.renderingSanitizer.sanitize(f):"role"===c&&""===f?e.removeAttribute(c):e.setAttribute(c,f):e[c]!==f&&(e[c]=f),s=!0)}}return s}}(v,e.properties,c.properties,f)||h,c.properties&&c.properties.afterUpdate&&c.properties.afterUpdate.apply(c.properties.bind||c.properties,[v,f,c.vnodeSelector,c.properties,c.children]);return h&&c.properties&&c.properties.updateAnimation&&c.properties.updateAnimation(v,c.properties,e.properties),u},t.createProjection=function(e,t){return{getLastRender:function(){return e},update:function(r){if(e.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");var o=e;e=r,i(o,r,t)},domNode:e.domNode}}}));