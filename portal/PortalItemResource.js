/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["require","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/maybe","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/subclass","../core/Error","../core/urlUtils","../core/uuid","./support/resourceExtension","../core/Accessor"],(function(t,e,r,o,s,a,p,i,l,n,c,u,h,m){"use strict";const d=a.getLogger("esri.portal.PortalItemResource");let y=function(r){function o(t){var e;return(e=r.call(this,t)||this).portalItem=null,e}e._inheritsLoose(o,r);var a=o.prototype;return a.normalizeCtorArgs=function(t){return t&&t.portalItem&&t.path?{...t,path:this.normalizePath(t.path,t.portalItem)}:t},a._castPath=function(t){return this.normalizePath(t,this.portalItem)},a.fetch=function(t="json",e){const r=this.url;if(s.isNone(r))throw new n("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(r,{responseType:t,signal:s.get(e,"signal")})},a.update=async function(e,r){return(await new Promise((function(e,r){t(["./support/resourceUtils"],e,r)}))).addOrUpdateResource(this,"update",e,r)},a.hasPath=function(){return s.isSome(this.path)},a.normalizePath=function(t,e){return s.isNone(t)?t:(t=t.replace(/^\/+/,""),s.isSome(e)&&c.isAbsolute(t)&&(t=c.makeRelative(t,e.itemUrl)),t.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))},e._createClass(o,[{key:"path",set:function(t){s.isSome(t)&&c.isAbsolute(t)?d.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",t)}},{key:"url",get:function(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}},{key:"itemRelativeUrl",get:function(){return this.portalItem&&this.path?`./resources/${this.path}`:null}}]),o}(m);return r.__decorate([p.property()],y.prototype,"portalItem",void 0),r.__decorate([p.property({type:String,value:null})],y.prototype,"path",null),r.__decorate([i.cast("path")],y.prototype,"_castPath",null),r.__decorate([p.property({type:String,readOnly:!0,dependsOn:["portalItem","path"]})],y.prototype,"url",null),r.__decorate([p.property({type:String,readOnly:!0,dependsOn:["portalItem","path"]})],y.prototype,"itemRelativeUrl",null),y=r.__decorate([l.subclass("esri.portal.PortalItemResource")],y),y}));
