/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../core/Error","../core/urlUtils","../core/uuid","./support/resourceExtension","../core/JSONSupport","./PortalQueryParams"],(function(t,e,r,o,n,p,u,l,s,a,i,c,y){"use strict";let d=function(e){function r(t){var r;return(r=e.call(this,t)||this).access=null,r.created=null,r.description=null,r.id=null,r.isInvitationOnly=!1,r.modified=null,r.owner=null,r.portal=null,r.snippet=null,r.sortField=null,r.sortOrder=null,r.tags=null,r.title=null,r}t._inheritsLoose(r,e);var o=r.prototype;return o.fetchCategorySchema=function(t){return this.portal._request(this.url+"/categorySchema",t).then((e=>{const r=e.categorySchema||[];return r.some((t=>"contentCategorySetsGroupQuery.LivingAtlas"===t.source))?this._fetchCategorySchemaSet("LivingAtlas",t):r}))},o.fetchMembers=function(t){return this.portal._request(this.url+"/users",t)},o.getThumbnailUrl=function(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e},o.toJSON=function(){throw new l("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")},o.queryItems=function(t,e){let r=n.ensureType(y,t);return parseFloat(this.portal.currentVersion)>5?(r=r||new y,this.portal._queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",e)):(r=r?r.clone():new y,r.query="group:"+this.id+(r.query?" "+r.query:""),this.portal.queryItems(r,e))},o._fetchCategorySchemaSet=function(t,e){return this.portal._fetchSelf(this.portal.authMode,!0,e).then((t=>{const r=t.contentCategorySetsGroupQuery;if(r){const t=new y;return t.disableExtraQuery=!0,t.num=1,t.query=r,this.portal.queryGroups(t,e)}throw new l("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")})).then((r=>{if(r.total){const o=r.results[0],n=new y;return n.num=1,n.query=`typekeywords:"${t}"`,o.queryItems(n,e)}throw new l("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")})).then((t=>{if(t.total){return t.results[0].fetchData("json",e).then((t=>{const e=t&&t.categorySchema;return e&&e.length?e:[]}))}return[]}))},t._createClass(r,[{key:"thumbnailUrl",get:function(){const t=this.url,e=this.thumbnail;return t&&e?this.portal._normalizeUrl(`${t}/info/${e}?f=json`):null}},{key:"url",get:function(){const t=this.get("portal.restUrl");return t?t+"/community/groups/"+this.id:null}}]),r}(c.JSONSupport);return e.__decorate([p.property()],d.prototype,"access",void 0),e.__decorate([p.property({type:Date})],d.prototype,"created",void 0),e.__decorate([p.property()],d.prototype,"description",void 0),e.__decorate([p.property()],d.prototype,"id",void 0),e.__decorate([p.property()],d.prototype,"isInvitationOnly",void 0),e.__decorate([p.property({type:Date})],d.prototype,"modified",void 0),e.__decorate([p.property()],d.prototype,"owner",void 0),e.__decorate([p.property()],d.prototype,"portal",void 0),e.__decorate([p.property()],d.prototype,"snippet",void 0),e.__decorate([p.property()],d.prototype,"sortField",void 0),e.__decorate([p.property()],d.prototype,"sortOrder",void 0),e.__decorate([p.property()],d.prototype,"tags",void 0),e.__decorate([p.property()],d.prototype,"thumbnail",void 0),e.__decorate([p.property({dependsOn:["url","thumbnail","portal.credential.token"],readOnly:!0})],d.prototype,"thumbnailUrl",null),e.__decorate([p.property()],d.prototype,"title",void 0),e.__decorate([p.property({dependsOn:["portal.restUrl"],readOnly:!0})],d.prototype,"url",null),d=e.__decorate([u.subclass("esri.portal.PortalGroup")],d),d}));
