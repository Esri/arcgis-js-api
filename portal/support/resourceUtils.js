/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../core/Error","../../core/maybe","../../core/urlUtils"],(function(e,t,r,n,o,s){"use strict";function a(e){return i.apply(this,arguments)}function i(){return(i=t._asyncToGenerator((function*(e,t={},r){yield e.load(r);const n=s.join(e.itemUrl,"resources"),{start:a=1,num:i=10,sortOrder:u="asc",sortField:l="created"}=t,c={query:{start:a,num:i,sortOrder:u,sortField:l,token:e.apiKey},signal:o.get(r,"signal")},p=yield e.portal.request(n,c);return{total:p.total,nextStart:p.nextStart,resources:p.resources.map((({created:t,size:r,resource:n})=>({created:new Date(t),size:r,resource:e.resourceFromPath(n)})))}}))).apply(this,arguments)}function u(e,t,r,n){return l.apply(this,arguments)}function l(){return(l=t._asyncToGenerator((function*(e,t,r,a){if(!e.hasPath())throw new n(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const i=e.portalItem;yield i.load(a);const u=s.join(i.userItemUrl,"add"===t?"addResources":"updateResources"),[l,c]=f(e.path),p=yield g(r),d=new FormData;return l&&"."!==l&&d.append("resourcesPrefix",l),o.isSome(a)&&a.compress&&d.append("compress","true"),d.append("fileName",c),d.append("file",p,c),d.append("f","json"),o.isSome(a)&&a.access&&d.append("access",a.access),yield i.portal.request(u,{method:"post",body:d,signal:o.get(a,"signal")}),e}))).apply(this,arguments)}function c(e,t,r){return p.apply(this,arguments)}function p(){return(p=t._asyncToGenerator((function*(e,t,r){if(!t.hasPath())throw new n("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield e.load(r);const a=s.join(e.userItemUrl,"removeResources");yield e.portal.request(a,{method:"post",query:{resource:t.path},signal:o.get(r,"signal")}),t.portalItem=null}))).apply(this,arguments)}function d(e,t){return h.apply(this,arguments)}function h(){return(h=t._asyncToGenerator((function*(e,t){yield e.load(t);const r=s.join(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:o.get(t,"signal")})}))).apply(this,arguments)}function f(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function m(e){const[t,r]=y(e),[n,o]=f(t);return[n,o,r]}function y(e){const t=s.getPathExtension(e);return o.isNone(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}function g(e){return v.apply(this,arguments)}function v(){return(v=t._asyncToGenerator((function*(e){if(e instanceof Blob)return e;return(yield r(e.url,{responseType:"blob"})).data}))).apply(this,arguments)}function P(e,t){if(!e.hasPath())return null;const[r,,n]=m(e.path);return e.portalItem.resourceFromPath(s.join(r,t+n))}function b(e,t){if(!e.hasPath())return null;const[r,,n]=m(e.path);return e.portalItem.resourceFromPath(s.join(r,t+n))}e.addOrUpdateResource=u,e.contentToBlob=g,e.fetchResources=a,e.getSiblingOfSameType=P,e.getSiblingOfSameTypeI=b,e.removeAllResources=d,e.removeResource=c,e.splitPrefixFileNameAndExtension=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
