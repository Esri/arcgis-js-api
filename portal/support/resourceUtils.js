/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../core/maybe","../../core/Error","../../core/urlUtils","../../request"],(function(e,t,r,a,o){"use strict";async function s(e,r={},o){await e.load(o);const s=a.join(e.itemUrl,"resources"),{start:n=1,num:i=10,sortOrder:c="asc",sortField:l="created"}=r,u={query:{start:n,num:i,sortOrder:c,sortField:l},signal:t.get(o,"signal")},p=await e.portal._request(s,u);return{total:p.total,nextStart:p.nextStart,resources:p.resources.map((({created:t,size:r,resource:a})=>({created:new Date(t),size:r,resource:e.resourceFromPath(a)})))}}async function n(e,o,s,n){if(!e.hasPath())throw new r(`portal-item-resource-${o}:invalid-path`,"Resource does not have a valid path");await e.portalItem.load(n);const i=a.join(e.portalItem.userItemUrl,"add"===o?"addResources":"updateResources"),[c,u]=l(e.path),p=await d(s),m=new FormData;return c&&"."!==c&&m.append("resourcesPrefix",c),m.append("fileName",u),m.append("file",p,u),m.append("f","json"),t.isSome(n)&&n.access&&m.append("access",n.access),await e.portalItem.portal._request(i,{method:"post",body:m,signal:t.get(n,"signal")}),e}async function i(e,o,s){if(!o.hasPath())throw new r("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(s);const n=a.join(e.userItemUrl,"removeResources");await e.portal._request(n,{method:"post",query:{resource:o.path},signal:t.get(s,"signal")}),o.portalItem=null}async function c(e,r){await e.load(r);const o=a.join(e.userItemUrl,"removeResources");return e.portal._request(o,{method:"post",query:{deleteAll:!0},signal:t.get(r,"signal")})}function l(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function u(e){const[t,r]=p(e),[a,o]=l(t);return[a,o,r]}function p(e){const r=a.getPathExtension(e);return t.isNone(r)?[e,""]:[e.slice(0,e.length-r.length-1),`.${r}`]}async function d(e){if(e instanceof Blob)return e;return(await o(e.url,{responseType:"blob"})).data}function m(e,t){if(!e.hasPath())return null;const[r,,o]=u(e.path);return e.portalItem.resourceFromPath(a.join(r,t+o))}function h(e,t){if(!e.hasPath())return null;const[r,,o]=u(e.path);return e.portalItem.resourceFromPath(a.join(r,t+o))}e.addOrUpdateResource=n,e.contentToBlob=d,e.fetchResources=s,e.getSiblingOfSameType=m,e.getSiblingOfSameTypeI=h,e.removeAllResources=c,e.removeResource=i,e.splitPrefixFileNameAndExtension=u,Object.defineProperty(e,"__esModule",{value:!0})}));
