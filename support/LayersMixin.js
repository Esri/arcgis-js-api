/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","../chunks/tslib.es6","../core/has","../core/Logger","../core/accessorSupport/ensureType","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../core/urlUtils","../core/uuid","../portal/support/resourceExtension","../core/promiseUtils","../core/Collection","../core/collectionUtils","../layers/Layer"],(function(e,r,t,o,s,n,i,a,l,d,c,u,y,p,f){"use strict";function h(e){return e&&"group"===e.type}function v(e,r,t){let o,s;if(e)for(let n=0,i=e.length;n<i;n++){if(o=e.getItemAt(n),o[r]===t)return o;if(h(o)&&(s=v(o.layers,r,t),s))return s}}const m=s.getLogger("esri.support.LayersMixin");e.LayersMixin=e=>{let o=function(e){function t(...t){var o;(o=e.call(this,...t)||this).layers=new y;return o.layers.on("before-add",(e=>{var r;(r=e.item).parent&&"remove"in r.parent&&r.parent.remove(r)})),o.layers.on("after-add",(e=>{return(t=e.item).parent=r._assertThisInitialized(o),o.layerAdded(t),void("elevation"!==t.type&&"base-elevation"!==t.type||m.error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as an operational layer and will therefore be ignored.`));var t})),o.layers.on("after-remove",(e=>{return(r=e.item).parent=null,void o.layerRemoved(r);var r})),o}r._inheritsLoose(t,e);var o=t.prototype;return o.destroy=function(){const e=this.layers.removeAll();for(const r of e)this.layerRemoved(r),r.destroy();this.layers.destroy()},o.add=function(e,r){const t=this.layers;r=t.getNextIndex(r),e instanceof f?e.parent===this?this.reorder(e,r):t.add(e,r):u.isPromiseLike(e)?e.then((e=>{this.destroyed||this.add(e,r)})):m.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")},o.addMany=function(e,r){const t=this.layers;r=t.getNextIndex(r),e.slice().forEach((e=>{e.parent!==this?(t.add(e,r),r+=1):this.reorder(e,r)}))},o.findLayerById=function(e){return v(this.layers,"id",e)},o.findLayerByUid=function(e){return v(this.layers,"uid",e)},o.remove=function(e){return this.layers.remove(e)},o.removeMany=function(e){return this.layers.removeMany(e)},o.removeAll=function(){return this.layers.removeAll()},o.reorder=function(e,r){return this.layers.reorder(e,r)},o.layerAdded=function(e){},o.layerRemoved=function(e){},r._createClass(t,[{key:"layers",set:function(e){this._set("layers",p.referenceSetter(e,this._get("layers")))}}]),t}(e);return t.__decorate([i.property()],o.prototype,"layers",null),o=t.__decorate([a.subclass("esri.support.LayersMixin")],o),o},Object.defineProperty(e,"__esModule",{value:!0})}));
