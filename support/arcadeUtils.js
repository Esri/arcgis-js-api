/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../chunks/arcade","../arcade/Dictionary","../arcade/Feature","../core/lang","../renderers/visualVariables/support/sizeVariableUtils"],(function(e,r,t,n,i,u){"use strict";const a=/^\$(feature|aggregatedFeatures)\./i,c={vars:{$feature:"any",$view:"any"},spatialReference:null};function o(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function s(e){if(!e)return null;try{return r.parseScript(e)}catch(t){}return null}function l(e,t){const n="string"==typeof e?s(e):e;if(!n)return null;try{return t=t||i.clone(c),r.compileScript(n,t)}catch(u){}return null}function p(e,r){return{vars:{$feature:null==e?new n:n.createFromGraphic(e),$view:r&&r.view},spatialReference:r&&r.sr}}function f(e,r,t){return n.createFromGraphicLikeObject(r,e,t)}function y(e,r){e.vars.$feature=r}function d(e,t){let n;try{n=r.executeScript(e,t)}catch(i){n=null}return n}function v(e,r){let t;try{t=e?e(r):null}catch(n){t=null}return t}function x(e,r){try{return e?e(r):Promise.resolve(null)}catch(t){return Promise.resolve(null)}}function m(e,t){if(!e)return[];const n="string"==typeof e?s(e):e;if(!n)return[];const i=r.extractExpectedFieldLiterals(n);let u=new Array;i.forEach((e=>{a.test(e)&&(e=e.replace(a,""),u.push(e))}));const c=u.filter((e=>e.includes("*")));return u=u.filter((e=>!c.includes(e))),t&&c.forEach((e=>{const r=new RegExp(`^${e.split(/\*+/).map(o).join(".*")}$`,"i");t.forEach((e=>r.test(e)?u.push(e):null))})),[...new Set(u.sort())]}function S(e){return r.referencesMember(e,"$view")}function F(e,t){return!!e&&r.referencesMember(e,t)}function h(e){if(!e||null==e.spatialReference&&(null==e.scale||null==e.viewingMode))return;return{view:e.viewingMode&&null!=e.scale?new t({viewingMode:e.viewingMode,scale:e.scale}):null,sr:e.spatialReference}}function b({url:e,spatialReference:t,lrucache:n,interceptor:i}){const u=r.featureSetUtils();return u?u.createFeatureSetCollectionFromService(e,t,n,i):null}function w({layer:e,spatialReference:t,outFields:n,returnGeometry:i,lrucache:u,interceptor:a}){if(null===e)return null;const c=r.featureSetUtils();return c?c.constructFeatureSet(e,t,n,null==i||i,u,a):null}function E(e){if(null===(null==e?void 0:e.map))return null;const t=r.featureSetUtils();return t?t.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function g(e,t,n=[]){return r.loadScriptDependencies(e,t,n)}function $(){return r.enableGeometrySupport()}function G(){return r.enableFeatureSetSupport()}function M(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type||"dot-density"===e.type||"dictionary"===e.type}function z(e){return"esri.layers.support.LabelClass"===e.declaredClass}function C(e){return"esri.PopupTemplate"===e.declaredClass}function R(e,r){if(!e)return!1;if("string"==typeof e)return r(e);const t=e;if(M(t)){if("dot-density"===t.type){const e=t.attributes.some((e=>r(e.valueExpression)));if(e)return e}const e=t.visualVariables,n=!!e&&e.some((e=>{let t=r(e.valueExpression);return"size"===e.type&&(u.isSizeVariable(e.minSize)&&(t=t||r(e.minSize.valueExpression)),u.isSizeVariable(e.maxSize)&&(t=t||r(e.maxSize.valueExpression))),t}));return!(!("valueExpression"in t)||!r(t.valueExpression))||n}if(z(t)){const e=t.labelExpressionInfo&&t.labelExpressionInfo.expression;return!(!e||!r(e))||!1}return!!C(t)&&(!!t.expressionInfos&&t.expressionInfos.some((e=>r(e.expression)))||Array.isArray(t.content)&&t.content.some((e=>{var t;return"expression"===e.type&&r(null==(t=e.expressionInfo)?void 0:t.expression)})))}function V(e){const t=s(e);return!!t&&r.scriptTouchesGeometry(t)}function T(e){return R(e,V)}function I(e){const t=s(e);return!!t&&r.scriptUsesGeometryEngine(t)}function O(e){return R(e,I)}e.arcade=r.arcade,e.Dictionary=t,e.arcadeFeature=n,e.convertFeatureLayerToFeatureSet=w,e.convertMapToFeatureSetCollection=E,e.convertServiceUrlToWorkspace=b,e.createExecContext=p,e.createFeature=f,e.createFunction=l,e.createSyntaxTree=s,e.dependsOnView=S,e.enableFeatureSetOperations=G,e.enableGeometryOperations=$,e.evalSyntaxTree=d,e.executeAsyncFunction=x,e.executeFunction=v,e.extractFieldNames=m,e.getViewInfo=h,e.hasGeometryFunctions=T,e.hasGeometryOperations=O,e.hasVariable=F,e.loadScriptDependencies=g,e.updateExecContext=y,Object.defineProperty(e,"__esModule",{value:!0})}));
