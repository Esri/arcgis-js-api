/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../core/lang","../core/promiseUtils","../renderers/visualVariables/support/sizeVariableUtils","../arcade/Dictionary","../arcade/Feature","../chunks/arcade"],(function(e,r,t,n,i,a,u){"use strict";const l=/^\$feature\./i,s={vars:{$feature:"any",$view:"any"},spatialReference:null};function c(e){if(!e)return null;try{return u.parseScript(e)}catch(e){}return null}function o(e){const r=c(e);return!!r&&u.scriptUsesGeometryEngine(r)}e.Dictionary=i,e.arcadeFeature=a,e.arcade=u.arcade,e.convertFeatureLayerToFeatureSet=function(e,r){if(null===e)return null;const t=u.featureSetUtils();return t?t.constructFeatureSet(e,r):null},e.convertMapToFeatureSetCollection=function(e){if(null===e||null===e.map)return null;const r=u.featureSetUtils();return r?r.createFeatureSetCollectionFromMap(e.map,e.spatialReference):null},e.convertServiceUrlToWorkspace=function(e,r){const t=u.featureSetUtils();return t?t.createFeatureSetCollectionFromService(e,r):null},e.createExecContext=function(e,r){return{vars:{$feature:null==e?new a:a.createFromGraphic(e),$view:r&&r.view},spatialReference:r&&r.sr}},e.createFeature=function(e,r,t){return a.createFromGraphicLikeObject(r,e,t)},e.createFunction=function(e,t){const n="string"==typeof e?c(e):e;if(!n)return null;try{return t=t||r.clone(s),u.compileScript(n,t)}catch(e){}return null},e.createSyntaxTree=c,e.dependsOnView=function(e){return u.referencesMember(e,"$view")},e.enableFeatureSetOperations=function(){return u.enableFeatureSetSupport()},e.enableGeometryOperations=function(){return u.enableGeometrySupport()},e.evalSyntaxTree=function(e,r){let t;try{t=u.executeScript(e,r)}catch(e){t=null}return t},e.executeAsyncFunction=function(e,r){try{return e?e(r):t.resolve(null)}catch(e){return t.resolve(null)}},e.executeFunction=function(e,r){let t;try{t=e?e(r):null}catch(e){t=null}return t},e.extractFieldNames=function(e){if(!e)return[];const r="string"==typeof e?c(e):e;if(!r)return[];const t=u.extractFieldLiterals(r),n=new Array;return t.forEach((e=>{l.test(e)&&(e=e.replace(l,""),n.push(e))})),n.sort(),n.filter(((e,r)=>0===r||n[r-1]!==e))},e.getViewInfo=function(e){if(!e||null==e.spatialReference&&(null==e.scale||null==e.viewingMode))return;return{view:e.viewingMode&&null!=e.scale?new i({viewingMode:e.viewingMode,scale:e.scale}):null,sr:e.spatialReference}},e.hasGeometryOperations=function(e){if(!e)return!1;if("string"==typeof e)return o(e);const r=e;if("simple"===(t=r).type||"class-breaks"===t.type||"unique-value"===t.type||"dot-density"===t.type||"dictionary"===t.type){if("dot-density"===r.type){const e=r.attributes.some((e=>o(e.valueExpression)));if(e)return e}const e=r.visualVariables,t=!!e&&e.some((e=>{let r=o(e.valueExpression);return"size"===e.type&&(n.isSizeVariable(e.minSize)&&(r=r||o(e.minSize.valueExpression)),n.isSizeVariable(e.maxSize)&&(r=r||o(e.maxSize.valueExpression))),r}));return!(!("valueExpression"in r)||!o(r.valueExpression))||t}var t;if("esri.layers.support.LabelClass"===r.declaredClass){const e=r.labelExpressionInfo&&r.labelExpressionInfo.expression;return!(!e||!o(e))||!1}return"esri.PopupTemplate"===r.declaredClass&&(!!r.expressionInfos&&r.expressionInfos.some((e=>o(e.expression))))},e.hasVariable=function(e,r){return!!e&&u.referencesMember(e,r)},e.loadScriptDependencies=function(e,r,t=[]){return u.loadScriptDependencies(e,r,t)},e.updateExecContext=function(e,r){e.vars.$feature=r},Object.defineProperty(e,"__esModule",{value:!0})}));
