/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../chunks/arcade","../arcade/Dictionary","../arcade/Feature","../core/lang","../renderers/visualVariables/support/sizeVariableUtils"],(function(e,r,t,n,i,u){"use strict";const a=/^\$feature\./i,c={vars:{$feature:"any",$view:"any"},spatialReference:null};function o(e){if(!e)return null;try{return r.parseScript(e)}catch(t){}return null}function s(e,t){const n="string"==typeof e?o(e):e;if(!n)return null;try{return t=t||i.clone(c),r.compileScript(n,t)}catch(u){}return null}function l(e,r){return{vars:{$feature:null==e?new n:n.createFromGraphic(e),$view:r&&r.view},spatialReference:r&&r.sr}}function f(e,r,t){return n.createFromGraphicLikeObject(r,e,t)}function p(e,r){e.vars.$feature=r}function y(e,t){let n;try{n=r.executeScript(e,t)}catch(i){n=null}return n}function d(e,r){let t;try{t=e?e(r):null}catch(n){t=null}return t}function v(e,r){try{return e?e(r):Promise.resolve(null)}catch(t){return Promise.resolve(null)}}function m(e){if(!e)return[];const t="string"==typeof e?o(e):e;if(!t)return[];const n=r.extractFieldLiterals(t),i=new Array;return n.forEach((e=>{a.test(e)&&(e=e.replace(a,""),i.push(e))})),i.sort(),i.filter(((e,r)=>0===r||i[r-1]!==e))}function S(e){return r.referencesMember(e,"$view")}function x(e,t){return!!e&&r.referencesMember(e,t)}function F(e){if(!e||null==e.spatialReference&&(null==e.scale||null==e.viewingMode))return;return{view:e.viewingMode&&null!=e.scale?new t({viewingMode:e.viewingMode,scale:e.scale}):null,sr:e.spatialReference}}function b(e,t){const n=r.featureSetUtils();return n?n.createFeatureSetCollectionFromService(e,t):null}function h(e,t){if(null===e)return null;const n=r.featureSetUtils();return n?n.constructFeatureSet(e,t):null}function w(e){if(null===e||null===e.map)return null;const t=r.featureSetUtils();return t?t.createFeatureSetCollectionFromMap(e.map,e.spatialReference):null}function E(e,t,n=[]){return r.loadScriptDependencies(e,t,n)}function g(){return r.enableGeometrySupport()}function M(){return r.enableFeatureSetSupport()}function z(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type||"dot-density"===e.type||"dictionary"===e.type}function C(e){return"esri.layers.support.LabelClass"===e.declaredClass}function G(e){return"esri.PopupTemplate"===e.declaredClass}function V(e,r){if(!e)return!1;if("string"==typeof e)return r(e);const t=e;if(z(t)){if("dot-density"===t.type){const e=t.attributes.some((e=>r(e.valueExpression)));if(e)return e}const e=t.visualVariables,n=!!e&&e.some((e=>{let t=r(e.valueExpression);return"size"===e.type&&(u.isSizeVariable(e.minSize)&&(t=t||r(e.minSize.valueExpression)),u.isSizeVariable(e.maxSize)&&(t=t||r(e.maxSize.valueExpression))),t}));return!(!("valueExpression"in t)||!r(t.valueExpression))||n}if(C(t)){const e=t.labelExpressionInfo&&t.labelExpressionInfo.expression;return!(!e||!r(e))||!1}return!!G(t)&&(!!t.expressionInfos&&t.expressionInfos.some((e=>r(e.expression))))}function T(e){const t=o(e);return!!t&&r.scriptTouchesGeometry(t)}function $(e){return V(e,T)}function O(e){const t=o(e);return!!t&&r.scriptUsesGeometryEngine(t)}function U(e){return V(e,O)}e.arcade=r.arcade,e.Dictionary=t,e.arcadeFeature=n,e.convertFeatureLayerToFeatureSet=h,e.convertMapToFeatureSetCollection=w,e.convertServiceUrlToWorkspace=b,e.createExecContext=l,e.createFeature=f,e.createFunction=s,e.createSyntaxTree=o,e.dependsOnView=S,e.enableFeatureSetOperations=M,e.enableGeometryOperations=g,e.evalSyntaxTree=y,e.executeAsyncFunction=v,e.executeFunction=d,e.extractFieldNames=m,e.getViewInfo=F,e.hasGeometryFunctions=$,e.hasGeometryOperations=U,e.hasVariable=x,e.loadScriptDependencies=E,e.updateExecContext=p,Object.defineProperty(e,"__esModule",{value:!0})}));
