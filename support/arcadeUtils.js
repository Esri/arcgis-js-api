/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../core/lang","../renderers/visualVariables/support/sizeVariableUtils","../arcade/Dictionary","../arcade/Feature","../chunks/arcade"],(function(e,r,t,n,i,a){"use strict";const u=/^\$feature\./i,s={vars:{$feature:"any",$view:"any"},spatialReference:null};function l(e){if(!e)return null;try{return a.parseScript(e)}catch(r){}return null}function c(e,t){const n="string"==typeof e?l(e):e;if(!n)return null;try{return t=t||r.clone(s),a.compileScript(n,t)}catch(i){}return null}function o(e,r){return{vars:{$feature:null==e?new i:i.createFromGraphic(e),$view:r&&r.view},spatialReference:r&&r.sr}}function p(e,r,t){return i.createFromGraphicLikeObject(r,e,t)}function f(e,r){e.vars.$feature=r}function y(e,r){let t;try{t=a.executeScript(e,r)}catch(n){t=null}return t}function d(e,r){let t;try{t=e?e(r):null}catch(n){t=null}return t}function v(e,r){try{return e?e(r):Promise.resolve(null)}catch(t){return Promise.resolve(null)}}function S(e){if(!e)return[];const r="string"==typeof e?l(e):e;if(!r)return[];const t=a.extractFieldLiterals(r),n=new Array;return t.forEach((e=>{u.test(e)&&(e=e.replace(u,""),n.push(e))})),n.sort(),n.filter(((e,r)=>0===r||n[r-1]!==e))}function x(e){return a.referencesMember(e,"$view")}function m(e,r){return!!e&&a.referencesMember(e,r)}function F(e){if(!e||null==e.spatialReference&&(null==e.scale||null==e.viewingMode))return;return{view:e.viewingMode&&null!=e.scale?new n({viewingMode:e.viewingMode,scale:e.scale}):null,sr:e.spatialReference}}function b(e,r){const t=a.featureSetUtils();return t?t.createFeatureSetCollectionFromService(e,r):null}function w(e,r){if(null===e)return null;const t=a.featureSetUtils();return t?t.constructFeatureSet(e,r):null}function h(e){if(null===e||null===e.map)return null;const r=a.featureSetUtils();return r?r.createFeatureSetCollectionFromMap(e.map,e.spatialReference):null}function E(e,r,t=[]){return a.loadScriptDependencies(e,r,t)}function g(){return a.enableGeometrySupport()}function M(){return a.enableFeatureSetSupport()}function z(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type||"dot-density"===e.type||"dictionary"===e.type}function C(e){return"esri.layers.support.LabelClass"===e.declaredClass}function V(e){return"esri.PopupTemplate"===e.declaredClass}function $(e){const r=l(e);return!!r&&a.scriptUsesGeometryEngine(r)}function G(e){if(!e)return!1;if("string"==typeof e)return $(e);const r=e;if(z(r)){if("dot-density"===r.type){const e=r.attributes.some((e=>$(e.valueExpression)));if(e)return e}const e=r.visualVariables,n=!!e&&e.some((e=>{let r=$(e.valueExpression);return"size"===e.type&&(t.isSizeVariable(e.minSize)&&(r=r||$(e.minSize.valueExpression)),t.isSizeVariable(e.maxSize)&&(r=r||$(e.maxSize.valueExpression))),r}));return!(!("valueExpression"in r)||!$(r.valueExpression))||n}if(C(r)){const e=r.labelExpressionInfo&&r.labelExpressionInfo.expression;return!(!e||!$(e))||!1}return!!V(r)&&(!!r.expressionInfos&&r.expressionInfos.some((e=>$(e.expression))))}e.Dictionary=n,e.arcadeFeature=i,e.arcade=a.arcade,e.convertFeatureLayerToFeatureSet=w,e.convertMapToFeatureSetCollection=h,e.convertServiceUrlToWorkspace=b,e.createExecContext=o,e.createFeature=p,e.createFunction=c,e.createSyntaxTree=l,e.dependsOnView=x,e.enableFeatureSetOperations=M,e.enableGeometryOperations=g,e.evalSyntaxTree=y,e.executeAsyncFunction=v,e.executeFunction=d,e.extractFieldNames=S,e.getViewInfo=F,e.hasGeometryOperations=G,e.hasVariable=m,e.loadScriptDependencies=E,e.updateExecContext=f,Object.defineProperty(e,"__esModule",{value:!0})}));
