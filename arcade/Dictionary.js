/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["./ImmutableArray","../chunks/languageUtils","../core/promiseUtils","../geometry/Geometry"],(function(t,n,i,s){"use strict";function e(t,i=!1){if(null==t)return null;if(n.isNumber(t))return n.toNumber(t);if(n.isBoolean(t))return n.toBoolean(t);if(n.isString(t))return n.toString(t);if(n.isDate(t))return n.toDate(t);if(n.isArray(t)){const n=[];for(const s of t)n.push(e(s,i));return n}const s=new r;s.immutable=!1;for(const n of Object.keys(t)){const r=t[n];void 0!==r&&s.setField(n,e(r,i))}return s.immutable=i,s}let r=function(){function r(t){this.declaredClass="esri.arcade.Dictionary",this.attributes=null,this.plain=!1,this.immutable=!0,this.attributes=t instanceof r?t.attributes:null==t?{}:t}var o=r.prototype;return o.field=function(t){const n=t.toLowerCase(),i=this.attributes[t];if(void 0!==i)return i;for(const s in this.attributes)if(s.toLowerCase()===n)return this.attributes[s];throw new Error("Field not Found : "+t)},o.setField=function(t,n){if(this.immutable)throw new Error("Dictionary is Immutable");const i=t.toLowerCase();if(void 0===this.attributes[t]){for(const t in this.attributes)if(t.toLowerCase()===i)return void(this.attributes[t]=n);this.attributes[t]=n}else this.attributes[t]=n},o.hasField=function(t){const n=t.toLowerCase();if(void 0!==this.attributes[t])return!0;for(const i in this.attributes)if(i.toLowerCase()===n)return!0;return!1},o.keys=function(){let t=[];for(const n in this.attributes)t.push(n);return t=t.sort(),t},o.castToText=function(){let i="";for(const e in this.attributes){""!==i&&(i+=",");const r=this.attributes[e];null==r?i+=JSON.stringify(e)+":null":n.isBoolean(r)||n.isNumber(r)||n.isString(r)?i+=JSON.stringify(e)+":"+JSON.stringify(r):r instanceof s||r instanceof t||r instanceof Array?i+=JSON.stringify(e)+":"+n.toStringExplicit(r):r instanceof Date?i+=JSON.stringify(e)+":"+JSON.stringify(r):null!==r&&"object"==typeof r&&void 0!==r.castToText&&(i+=JSON.stringify(e)+":"+r.castToText())}return"{"+i+"}"},r.convertObjectToArcadeDictionary=function(t,n=!0){const i=new r;i.immutable=!1;for(const s in t){const n=t[s];void 0!==n&&i.setField(s.toString(),e(n))}return i.immutable=n,i},r.convertJsonToArcade=function(t,n=!1){return e(t,n)},o.castAsJson=function(t=null){const i={};for(let s in this.attributes){const e=this.attributes[s];void 0!==e&&(null!=t&&t.keyTranslate&&(s=t.keyTranslate(s)),i[s]=n.castAsJson(e,t))}return i},o.castDictionaryValueAsJsonAsync=function(t,i,s,e=null,r){return n.castAsJsonAsync(s,e,r).then((n=>(t[i]=n,n)))},o.castAsJsonAsync=function(t=null,e=null){const r={},o=[];for(let i in this.attributes){const u=this.attributes[i];null!=e&&e.keyTranslate&&(i=e.keyTranslate(i)),void 0!==u&&(n.isSimpleType(u)||u instanceof s||u instanceof Date?r[i]=n.castAsJson(u,e):o.push(this.castDictionaryValueAsJsonAsync(r,i,u,t,e)))}return o.length>0?i.all(o).then((()=>r)):i.resolve(r)},r}();return r}));
