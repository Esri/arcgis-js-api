/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","./ArcadeModule","./ArcadeModuleLoader","./Dictionary","./executionError","./Feature","./FunctionWrapper","../chunks/languageUtils","./treeAnalysis","../chunks/array","./functions/date","./functions/geomasync","./functions/geometry","./functions/maths","./functions/stats","./functions/string","../geometry/Geometry","../geometry/SpatialReference"],(function(e,r,t,n,o,i,a,u,c,l,s,d,p,f,E,y,h,x,m){"use strict";function w(e){return e&&"function"==typeof e.then}const g=100;function v(e,r){return b.apply(this,arguments)}function b(){return(b=r._asyncToGenerator((function*(e,r){const t=[];for(let n=0;n<r.arguments.length;n++)t.push(yield N(e,r.arguments[n]));return t}))).apply(this,arguments)}function A(e,r,t){return C.apply(this,arguments)}function C(){return(C=r._asyncToGenerator((function*(e,r,t){if(!0===r.preparsed)return t(e,null,r.arguments);return t(e,r,yield v(e,r))}))).apply(this,arguments)}let S=function(e){function t(r,t){var n;return(n=e.call(this)||this).definition=null,n.context=null,n.definition=r,n.context=t,n}r._inheritsLoose(t,e);var n=t.prototype;return n.createFunction=function(e){return(...r)=>{const t={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(t.depthCounter.depth>64)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.MaximumCallDepth,null);return He(this.definition,t,r,null)}},n.call=function(e,r){return F(e,r,((t,n,o)=>{const a={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(a.depthCounter.depth>64)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.MaximumCallDepth,r);return He(this.definition,a,o,r)}))},n.marshalledCall=function(e,t,n,o){var i=this;return o(e,t,function(){var a=r._asyncToGenerator((function*(r,a,l){const s={spatialReference:e.spatialReference,globalScope:n.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{}};return l=l.map((r=>!c.isFunctionParameter(r)||r instanceof u.ScopeMarshalledFunction?r:u.wrapModuleScopedResponse(r,e,o))),u.wrapModuleScopedResponse(yield He(i.definition,s,l,t),n,o)}));return function(e,r,t){return a.apply(this,arguments)}}())},t}(u.ArcadeFunction),R=function(e){function t(r){return e.call(this,r)||this}r._inheritsLoose(t,e);var o=t.prototype;return o.global=function(){var e=r._asyncToGenerator((function*(e){const r=this.executingContext.globalScope[e.toLowerCase()];if(r.valueset||(r.value=yield N(this.executingContext,r.node),r.valueset=!0),c.isFunctionParameter(r.value)&&!(r.value instanceof u.ScopeMarshalledFunction)){const e=new u.ScopeMarshalledFunction;e.fn=r.value,e.parameterEvaluator=F,e.context=this.executingContext,r.value=e}return r.value}));function t(r){return e.apply(this,arguments)}return t}(),o.setGlobal=function(e,r){if(c.isFunctionParameter(r))throw new i.ArcadeExecutionError(null,i.ExecutionErrorCodes.AssignModuleFunction,null);this.executingContext.globalScope[e.toLowerCase()]={value:r,valueset:!0,node:null}},o.hasGlobal=function(e){return void 0===this.executingContext.exports[e]&&(e=e.toLowerCase()),void 0!==this.executingContext.exports[e]},o.loadModule=function(){var e=r._asyncToGenerator((function*(e){let r=e.spatialReference;null==r&&(r=new m({wkid:102100})),this.moduleScope=Qe({},e.customfunctions),this.executingContext={spatialReference:r,services:e.services,libraryResolver:new n.ArcadeModuleLoader(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:void 0===e.abortSignal||null===e.abortSignal?{aborted:!1}:e.abortSignal,globalScope:this.moduleScope,console:e.console?e.console:Xe,lrucache:e.lrucache,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},yield N(this.executingContext,this.source.syntax)}));function t(r){return e.apply(this,arguments)}return t}(),t}(t.ArcadeModule);function F(e,r,t){return I.apply(this,arguments)}function I(){return(I=r._asyncToGenerator((function*(e,r,t){if(!0===r.preparsed){const n=t(e,null,r.arguments);return w(n),n}const n=t(e,r,yield v(e,r));return w(n),n}))).apply(this,arguments)}function N(e,r,t){return O.apply(this,arguments)}function O(){return(O=r._asyncToGenerator((function*(e,r,t){if(r.breakpoint&&!0!==t){const t=r.breakpoint();return yield t,N(e,r,!0)}try{switch(r?.type){case"VariableDeclarator":return yield ge(e,r);case"ImportDeclaration":return yield Ee(e,r);case"ExportNamedDeclaration":return yield he(e,r);case"VariableDeclaration":return yield me(e,r,0);case"BlockStatement":case"Program":return yield ae(e,r);case"FunctionDeclaration":return yield pe(e,r);case"ReturnStatement":return yield se(e,r);case"IfStatement":return yield oe(e,r);case"ExpressionStatement":return yield te(e,r);case"UpdateExpression":return yield X(e,r);case"AssignmentExpression":return yield ee(e,r);case"ForStatement":return yield q(e,r);case"WhileStatement":return yield k(e,r);case"ForInStatement":return yield J(e,r);case"BreakStatement":return c.breakResult;case"EmptyStatement":return c.voidOperation;case"ContinueStatement":return c.continueResult;case"TemplateElement":return yield Le(e,r);case"TemplateLiteral":return yield je(e,r);case"Identifier":return yield Me(e,r);case"MemberExpression":return yield be(e,r);case"Literal":return r.value;case"CallExpression":return yield _e(e,r);case"UnaryExpression":return yield Ce(e,r);case"BinaryExpression":return yield Ie(e,r);case"LogicalExpression":return yield Oe(e,r);case"ArrayExpression":return yield Re(e,r);case"ObjectExpression":return yield T(e,r);case"Property":return yield G(e,r);default:throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.Unrecognised,r)}}catch(n){throw i.ensureArcadeExecutionError(e,r,n)}}))).apply(this,arguments)}function T(e,r){return M.apply(this,arguments)}function M(){return(M=r._asyncToGenerator((function*(e,r){const t=[];for(let o=0;o<r.properties.length;o++)t[o]=yield N(e,r.properties[o]);const n={},a=new Map;for(let o=0;o<t.length;o++){const u=t[o];if(c.isFunctionParameter(u.value))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.NoFunctionInDictionary,r);if(!1===c.isString(u.key))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.KeyMustBeString,r);let l=u.key.toString();const s=l.toLowerCase();a.has(s)?l=a.get(s):a.set(s,l),u.value===c.voidOperation?n[l]=null:n[l]=u.value}const u=new o(n);return u.immutable=!1,u}))).apply(this,arguments)}function G(e,r){return _.apply(this,arguments)}function _(){return(_=r._asyncToGenerator((function*(e,r){const t=yield N(e,r.value);if("Identifier"===r.key.type)return{key:r.key.name,value:t};return{key:yield N(e,r.key),value:t}}))).apply(this,arguments)}function k(e,r){return L.apply(this,arguments)}function L(){return(L=r._asyncToGenerator((function*(e,r){const t={testResult:!0,lastAction:c.voidOperation};if(t.testResult=yield N(e,r.test),!1===t.testResult)return c.voidOperation;if(!0!==t.testResult)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.BooleanConditionRequired,r);for(;!0===t.testResult&&(t.lastAction=yield N(e,r.body),t.lastAction!==c.breakResult)&&!(t.lastAction instanceof c.ReturnResult);)if(t.testResult=yield N(e,r.test),!0!==t.testResult&&!1!==t.testResult)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.BooleanConditionRequired,r);return t.lastAction instanceof c.ReturnResult?t.lastAction:c.voidOperation}))).apply(this,arguments)}function B(e,r,t){return P.apply(this,arguments)}function P(){return(P=r._asyncToGenerator((function*(e,r,t){const n=yield N(e,r.body);return t.lastAction=n,t.lastAction===c.breakResult||t.lastAction instanceof c.ReturnResult?(t.testResult=!1,t):null!==r.update?(yield N(e,r.update),t):t}))).apply(this,arguments)}function j(e,r,t){return K.apply(this,arguments)}function K(){return(K=r._asyncToGenerator((function*(e,r,t){if(null!==r.test){const n=yield N(e,r.test);if(!0===e.abortSignal?.aborted)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.Cancelled,r);if(t.testResult=n,!1===t.testResult)return t;if(!0!==t.testResult)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.BooleanConditionRequired,r);return B(e,r,t)}return B(e,r,t)}))).apply(this,arguments)}function D(e,r,t,n,o,i){try{j(e,r,t).then((()=>{try{!0===t.testResult?++i>g?(i=0,setTimeout((()=>{D(e,r,t,n,o,i)}),0)):D(e,r,t,n,o,i):t.lastAction instanceof c.ReturnResult?n(t.lastAction):n(c.voidOperation)}catch(a){o(a)}}),(e=>{o(e)}))}catch(a){o(a)}}function q(e,r){try{return null!==r.init?N(e,r.init).then((()=>new Promise(((t,n)=>{const o={testResult:!0,lastAction:c.voidOperation};D(e,r,o,(e=>{t(e)}),(e=>{n(e)}),0)})))):new Promise(((t,n)=>{const o={testResult:!0,lastAction:c.voidOperation};D(e,r,o,(e=>{t(e)}),(e=>{n(e)}),0)}))}catch(t){return Promise.reject(t)}}function U(e,r,t,n,o,i,a,u,l,s){try{if(n<=i)return void u(c.voidOperation);o.value="k"===a?t[i]:i,N(e,r.body).then((d=>{try{d instanceof c.ReturnResult?u(d):d===c.breakResult?u(c.voidOperation):++s>g?(s=0,setTimeout((()=>{U(e,r,t,n,o,i+1,a,u,l,s)}),0)):U(e,r,t,n,o,i+1,a,u,l,s)}catch(p){l(p)}}),(e=>{l(e)}))}catch(d){l(d)}}function W(e,r,t,n,o,i,a,u,l){try{if(t.length()<=o)return void a(c.voidOperation);n.value="k"===i?t.get(o):o,N(e,r.body).then((s=>{s instanceof c.ReturnResult?a(s):s===c.breakResult?a(c.voidOperation):++l>g?(l=0,setTimeout((()=>{W(e,r,t,n,o+1,i,a,u,l)}),0)):W(e,r,t,n,o+1,i,a,u,l)}),(e=>{u(e)}))}catch(s){u(s)}}function V(e,r,t,n,o,i){try{if(void 0===i&&(i="i"),0===t.length)return void n.resolve(c.voidOperation);U(e,r,t,t.length,o,0,i,(e=>{n.resolve(e)}),(e=>{n.reject(e)}),0)}catch(a){n.reject(a)}}function H(e,r,t,n,o,i){try{if(void 0===i&&(i="i"),0===t.length)return void n.resolve(c.voidOperation);W(e,r,t,o,0,i,(e=>{n.resolve(e)}),(e=>{n.reject(e)}),0)}catch(a){n.reject(a)}}function Y(e,r,t,n,o){try{V(e,r,t.keys(),n,o,"k")}catch(i){n.reject(i)}}function z(e,r,t,n,o,i,u,l){try{e.next().then((s=>{try{if(null===s)i(c.voidOperation);else{const d=a.createFromGraphicLikeObject(s.geometry,s.attributes,n);d._underlyingGraphic=s,o.value=d;N(r,t.body).then((a=>{try{a===c.breakResult?i(c.voidOperation):a instanceof c.ReturnResult?i(a):++l>g?(l=0,setTimeout((()=>{z(e,r,t,n,o,i,u,l)}),0)):z(e,r,t,n,o,i,u,l)}catch(s){u(s)}}),(e=>{u(e)}))}}catch(d){u(d)}}),(e=>{u(e)}))}catch(s){u(s)}}function J(e,r){return Q.apply(this,arguments)}function Q(){return(Q=r._asyncToGenerator((function*(e,r){return new Promise(((t,n)=>{N(e,r.right).then((a=>{try{let u=null;u="VariableDeclaration"===r.left.type?N(e,r.left):Promise.resolve(),u.then((()=>{try{let u="";if("VariableDeclaration"===r.left.type){const e=r.left.declarations[0].id;"Identifier"===e.type&&(u=e.name)}else"Identifier"===r.left.type&&(u=r.left.name);if(!u)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r);u=u.toLowerCase();let l=null;if(null!=e.localScope&&void 0!==e.localScope[u]&&(l=e.localScope[u]),null===l&&void 0!==e.globalScope[u]&&(l=e.globalScope[u]),null===l)return void n(new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r));c.isArray(a)||c.isString(a)?V(e,r,a,{reject:n,resolve:t},l):c.isImmutableArray(a)?H(e,r,a,{reject:n,resolve:t},l):a instanceof o||c.isFeature(a)?Y(e,r,a,{reject:n,resolve:t},l):c.isFeatureSet(a)?z(a.iterator(e.abortSignal),e,r,a,l,(e=>{t(e)}),(e=>{n(e)}),0):V(e,r,[],{reject:n,resolve:t},l)}catch(u){n(u)}}),n)}catch(u){n(u)}}),n)}))}))).apply(this,arguments)}function X(e,r){return Z.apply(this,arguments)}function Z(){return(Z=r._asyncToGenerator((function*(e,r){const t=r.argument;if("MemberExpression"===t.type){const n={t:null},a=yield N(e,t.object);let u=null;n.t=a,!0===t.computed?u=yield N(e,t.property):"Identifier"===t.property.type&&(u=t.property.name);const l=n.t;let s;if(c.isArray(l)){if(!c.isNumber(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.ArrayAccessorMustBeNumber,r);if(u<0&&(u=l.length+u),u<0||u>=l.length)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.OutOfBounds,r);s=c.toNumber(l[u]),l[u]="++"===r.operator?s+1:s-1}else if(l instanceof o){if(!1===c.isString(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0!==l.hasField(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.FieldNotFound,r,{key:u});s=c.toNumber(l.field(u)),l.setField(u,"++"===r.operator?s+1:s-1)}else if(l instanceof R){if(!1===c.isString(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.ModuleAccessorMustBeString,r);if(!0!==l.hasGlobal(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.ModuleExportNotFound,r);s=c.toNumber(yield l.global(u)),l.setGlobal(u,"++"===r.operator?s+1:s-1)}else{if(!c.isFeature(l))throw c.isImmutableArray(l)?new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.Immutable,r):new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidParameter,r);if(!1===c.isString(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0!==l.hasField(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.FieldNotFound,r,{key:u});s=c.toNumber(l.field(u)),l.setField(u,"++"===r.operator?s+1:s-1)}return!1===r.prefix?s:"++"===r.operator?s+1:s-1}const n="Identifier"===r.argument.type?r.argument.name.toLowerCase():"";if(!n)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r);let a;if(null!=e.localScope&&void 0!==e.localScope[n])return a=c.toNumber(e.localScope[n].value),e.localScope[n]={value:"++"===r.operator?a+1:a-1,valueset:!0,node:r},!1===r.prefix?a:"++"===r.operator?a+1:a-1;if(void 0!==e.globalScope[n])return a=c.toNumber(e.globalScope[n].value),e.globalScope[n]={value:"++"===r.operator?a+1:a-1,valueset:!0,node:r},!1===r.prefix?a:"++"===r.operator?a+1:a-1;throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r)}))).apply(this,arguments)}function $(e,r,t,n,o){switch(r){case"=":return e===c.voidOperation?null:e;case"/=":return c.toNumber(t)/c.toNumber(e);case"*=":return c.toNumber(t)*c.toNumber(e);case"-=":return c.toNumber(t)-c.toNumber(e);case"+=":return c.isString(t)||c.isString(e)?c.toString(t)+c.toString(e):c.toNumber(t)+c.toNumber(e);case"%=":return c.toNumber(t)%c.toNumber(e);default:throw new i.ArcadeExecutionError(o,i.ExecutionErrorCodes.UnsupportedOperator,n)}}function ee(e,r){return re.apply(this,arguments)}function re(){return(re=r._asyncToGenerator((function*(e,r){const t=r.left;if("MemberExpression"===t.type){const n=yield N(e,r.right),a=yield N(e,t.object);let u=null;if(!0===t.computed)u=yield N(e,t.property);else{if("Identifier"!==t.property.type)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r);u=t.property.name}if(c.isArray(a)){if(!c.isNumber(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.ArrayAccessorMustBeNumber,r);if(u<0&&(u=a.length+u),u<0||u>a.length)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.OutOfBounds,r);if(u===a.length){if("="!==r.operator)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.OutOfBounds,r);a[u]=$(n,r.operator,a[u],r,e)}else a[u]=$(n,r.operator,a[u],r,e)}else if(a instanceof o){if(!1===c.isString(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0===a.hasField(u))a.setField(u,$(n,r.operator,a.field(u),r,e));else{if("="!==r.operator)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.FieldNotFound,r,{key:u});a.setField(u,$(n,r.operator,null,r,e))}}else if(a instanceof R){if(!1===c.isString(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0!==a.hasGlobal(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.ModuleExportNotFound,r);a.setGlobal(u,$(n,r.operator,yield a.global(u),r,e))}else{if(!c.isFeature(a))throw c.isImmutableArray(a)?new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.Immutable,r):new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidParameter,r);if(!1===c.isString(u))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0===a.hasField(u))a.setField(u,$(n,r.operator,a.field(u),r,e));else{if("="!==r.operator)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.FieldNotFound,r,{key:u});a.setField(u,$(n,r.operator,null,r,e))}}return c.voidOperation}const n=t.name.toLowerCase();if(null!=e.localScope&&void 0!==e.localScope[n]){const t=yield N(e,r.right);return e.localScope[n]={value:$(t,r.operator,e.localScope[n].value,r,e),valueset:!0,node:r.right},c.voidOperation}if(void 0!==e.globalScope[n]){const t=yield N(e,r.right);return e.globalScope[n]={value:$(t,r.operator,e.globalScope[n].value,r,e),valueset:!0,node:r.right},c.voidOperation}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r)}))).apply(this,arguments)}function te(e,r){return ne.apply(this,arguments)}function ne(){return(ne=r._asyncToGenerator((function*(e,r){if("AssignmentExpression"===r.expression.type)return N(e,r.expression);if("CallExpression"===r.expression.type){const t=yield N(e,r.expression);return t===c.voidOperation?c.voidOperation:new c.ImplicitResult(t)}const t=yield N(e,r.expression);return t===c.voidOperation?c.voidOperation:new c.ImplicitResult(t)}))).apply(this,arguments)}function oe(e,r){return ie.apply(this,arguments)}function ie(){return(ie=r._asyncToGenerator((function*(e,r){const t=yield N(e,r.test);if(!0===t)return N(e,r.consequent);if(!1===t)return null!==r.alternate?N(e,r.alternate):c.voidOperation;throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.BooleanConditionRequired,r)}))).apply(this,arguments)}function ae(e,r){return ue.apply(this,arguments)}function ue(){return(ue=r._asyncToGenerator((function*(e,r){return ce(e,r,0)}))).apply(this,arguments)}function ce(e,r,t){return le.apply(this,arguments)}function le(){return(le=r._asyncToGenerator((function*(e,r,t){if(t>=r.body.length)return c.voidOperation;const n=yield N(e,r.body[t]);return n instanceof c.ReturnResult||n===c.breakResult||n===c.continueResult||t===r.body.length-1?n:ce(e,r,t+1)}))).apply(this,arguments)}function se(e,r){return de.apply(this,arguments)}function de(){return(de=r._asyncToGenerator((function*(e,r){if(null===r.argument)return new c.ReturnResult(c.voidOperation);const t=yield N(e,r.argument);return new c.ReturnResult(t)}))).apply(this,arguments)}function pe(e,r){return fe.apply(this,arguments)}function fe(){return(fe=r._asyncToGenerator((function*(e,r){const t=r.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new S(r,e)},c.voidOperation}))).apply(this,arguments)}function Ee(e,r){return ye.apply(this,arguments)}function ye(){return(ye=r._asyncToGenerator((function*(e,r){const t=r.specifiers[0].local.name.toLowerCase(),n=e.libraryResolver.loadLibrary(t);let o=null;return e.libraryResolver._moduleSingletons?.has(n.uri)?o=e.libraryResolver._moduleSingletons.get(n.uri):(o=new R(n),yield o.loadModule(e),e.libraryResolver._moduleSingletons?.set(n.uri,o)),e.globalScope[t]={value:o,valueset:!0,node:r},c.voidOperation}))).apply(this,arguments)}function he(e,r){return xe.apply(this,arguments)}function xe(){return(xe=r._asyncToGenerator((function*(e,r){if(yield N(e,r.declaration),"FunctionDeclaration"===r.declaration.type)e.exports[r.declaration.id.name.toLowerCase()]="function";else if("VariableDeclaration"===r.declaration.type)for(const t of r.declaration.declarations)e.exports[t.id.name.toLowerCase()]="variable";return c.voidOperation}))).apply(this,arguments)}function me(e,r,t){return we.apply(this,arguments)}function we(){return(we=r._asyncToGenerator((function*(e,r,t){return t>=r.declarations.length?c.voidOperation:(yield N(e,r.declarations[t]),t===r.declarations.length-1||(yield me(e,r,t+1)),c.voidOperation)}))).apply(this,arguments)}function ge(e,r){return ve.apply(this,arguments)}function ve(){return(ve=r._asyncToGenerator((function*(e,r){let t=null;if(t=null===r.init?null:yield N(e,r.init),null!==e.localScope){if(t===c.voidOperation&&(t=null),"Identifier"!==r.id.type)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r);const n=r.id.name.toLowerCase();return null!=e.localScope&&(e.localScope[n]={value:t,valueset:!0,node:r.init}),c.voidOperation}if("Identifier"!==r.id.type)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r);const n=r.id.name.toLowerCase();return t===c.voidOperation&&(t=null),e.globalScope[n]={value:t,valueset:!0,node:r.init},c.voidOperation}))).apply(this,arguments)}function be(e,r){return Ae.apply(this,arguments)}function Ae(){return(Ae=r._asyncToGenerator((function*(e,r){const t=yield N(e,r.object);if(null===t)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.MemberOfNull,r);if(!1===r.computed){if("Identifier"===r.property.type){if(t instanceof o||c.isFeature(t))return t.field(r.property.name);if(t instanceof x)return f.geometryMember(t,r.property.name,e,r);if(t instanceof R){if(!t.hasGlobal(r.property.name))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r);return t.global(r.property.name)}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidMemberAccessKey,r)}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidMemberAccessKey,r)}let n=yield N(e,r.property);if(t instanceof o||c.isFeature(t)){if(c.isString(n))return t.field(n);throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(t instanceof R){if(c.isString(n))return t.global(n);throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(t instanceof x){if(c.isString(n))return f.geometryMember(t,n,e,r);throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(c.isArray(t)){if(c.isNumber(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=t.length+n),n>=t.length||n<0)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.OutOfBounds,r);return t[n]}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(c.isImmutableArray(t)){if(c.isNumber(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=t.length()+n),n>=t.length()||n<0)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.OutOfBounds,r);return t.get(n)}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(c.isString(t)){if(c.isNumber(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=t.length+n),n>=t.length||n<0)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.OutOfBounds,r);return t[n]}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidMemberAccessKey,r)}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidMemberAccessKey,r)}))).apply(this,arguments)}function Ce(e,r){return Se.apply(this,arguments)}function Se(){return(Se=r._asyncToGenerator((function*(e,r){const t=yield N(e,r.argument);if(c.isBoolean(t)){if("!"===r.operator)return!t;if("-"===r.operator)return-1*c.toNumber(t);if("+"===r.operator)return 1*c.toNumber(t);if("~"===r.operator)return~c.toNumber(t);throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.UnsupportedUnaryOperator,r)}if("-"===r.operator)return-1*c.toNumber(t);if("+"===r.operator)return 1*c.toNumber(t);if("~"===r.operator)return~c.toNumber(t);throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.UnsupportedUnaryOperator,r)}))).apply(this,arguments)}function Re(e,r){return Fe.apply(this,arguments)}function Fe(){return(Fe=r._asyncToGenerator((function*(e,r){const t=[];for(let n=0;n<r.elements.length;n++)t.push(yield N(e,r.elements[n]));for(let n=0;n<t.length;n++){if(c.isFunctionParameter(t[n]))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.NoFunctionInArray,r);t[n]===c.voidOperation&&(t[n]=null)}return t}))).apply(this,arguments)}function Ie(e,r){return Ne.apply(this,arguments)}function Ne(){return(Ne=r._asyncToGenerator((function*(e,r){const t=[];t[0]=yield N(e,r.left),t[1]=yield N(e,r.right);const n=t[0],o=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return c.binaryOperator(c.toNumber(n),c.toNumber(o),r.operator);case"==":return c.equalityTest(n,o);case"!=":return!c.equalityTest(n,o);case"<":case">":case"<=":case">=":return c.greaterThanLessThan(n,o,r.operator);case"+":return c.isString(n)||c.isString(o)?c.toString(n)+c.toString(o):c.toNumber(n)+c.toNumber(o);case"-":return c.toNumber(n)-c.toNumber(o);case"*":return c.toNumber(n)*c.toNumber(o);case"/":return c.toNumber(n)/c.toNumber(o);case"%":return c.toNumber(n)%c.toNumber(o);default:throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.UnsupportedOperator,r)}}))).apply(this,arguments)}function Oe(e,r){return Te.apply(this,arguments)}function Te(){return(Te=r._asyncToGenerator((function*(e,r){const t=yield N(e,r.left);let n=null;if(!c.isBoolean(t))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.LogicalExpressionOnlyBoolean,r);switch(r.operator){case"||":if(!0===t)return t;if(n=yield N(e,r.right),c.isBoolean(n))return n;throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.LogicExpressionOrAnd,r);case"&&":if(!1===t)return t;if(n=yield N(e,r.right),c.isBoolean(n))return n;throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.LogicExpressionOrAnd,r);default:throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.LogicExpressionOrAnd,r)}}))).apply(this,arguments)}function Me(e,r){return Ge.apply(this,arguments)}function Ge(){return(Ge=r._asyncToGenerator((function*(e,r){const t=r.name.toLowerCase();if(null!=e.localScope&&void 0!==e.localScope[t]){const r=e.localScope[t];if(!0===r.valueset)return r.value;if(null!==r.d)return r.d;r.d=N(e,r.node);const n=yield r.d;return r.value=n,r.valueset=!0,n}if(void 0!==e.globalScope[t]){const r=e.globalScope[t];if(!0===r.valueset)return r.value;if(null!==r.d)return r.d;r.d=N(e,r.node);const n=yield r.d;return r.value=n,r.valueset=!0,n}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.InvalidIdentifier,r)}))).apply(this,arguments)}function _e(e,r){return ke.apply(this,arguments)}function ke(){return(ke=r._asyncToGenerator((function*(e,r){if("MemberExpression"===r.callee.type){const t=yield N(e,r.callee.object);if(!(t instanceof R))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.FuncionNotFound,r);const n=!1===r.callee.computed?r.callee.property.name:yield N(e,r.callee.property);if(!t.hasGlobal(n))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.FuncionNotFound,r);const o=yield t.global(n);if(!c.isFunctionParameter(o))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.CallNonFunction,r);return o.call(e,r)}if("Identifier"!==r.callee.type)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.FuncionNotFound,r);if(null!=e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){const t=e.localScope[r.callee.name.toLowerCase()];if(c.isFunctionParameter(t.value))return t.value.call(e,r);throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.CallNonFunction,r)}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){const t=e.globalScope[r.callee.name.toLowerCase()];if(c.isFunctionParameter(t.value))return t.value.call(e,r);throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.CallNonFunction,r)}throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.FuncionNotFound,r)}))).apply(this,arguments)}function Le(e,r){return Be.apply(this,arguments)}function Be(){return(Be=r._asyncToGenerator((function*(e,r){return r.value?r.value.cooked:""}))).apply(this,arguments)}function Pe(e,r,t){if(c.isFunctionParameter(e))throw new i.ArcadeExecutionError(r,i.ExecutionErrorCodes.NoFunctionInTemplateLiteral,t);return e}function je(e,r){return Ke.apply(this,arguments)}function Ke(){return(Ke=r._asyncToGenerator((function*(e,r){const t=[];for(let i=0;i<r.expressions.length;i++){const n=yield N(e,r.expressions[i]);t[i]=c.toString(n)}let n="",o=0;for(const i of r.quasis)if(n+=i.value?i.value.cooked:"",!1===i.tail){n+=t[o]?Pe(t[o],e,r):"",o++}return n}))).apply(this,arguments)}const De={};function qe(e,r,t,n){return Ue.apply(this,arguments)}function Ue(){return(Ue=r._asyncToGenerator((function*(e,r,t,n){const o=yield N(e,r.arguments[t]);if(c.equalityTest(o,n))return N(e,r.arguments[t+1]);const i=r.arguments.length-t;return 1===i?N(e,r.arguments[t]):2===i?null:3===i?N(e,r.arguments[t+2]):qe(e,r,t+2,n)}))).apply(this,arguments)}function We(e,r,t,n){return Ve.apply(this,arguments)}function Ve(){return(Ve=r._asyncToGenerator((function*(e,r,t,n){if(!0===n)return N(e,r.arguments[t+1]);if(3===r.arguments.length-t)return N(e,r.arguments[t+2]);const o=yield N(e,r.arguments[t+2]);if(!1===c.isBoolean(o))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.ModuleExportNotFound,r.arguments[t+2]);return We(e,r,t+2,o)}))).apply(this,arguments)}function He(e,r,t,n){return Ye.apply(this,arguments)}function Ye(){return(Ye=r._asyncToGenerator((function*(e,r,t,n){const o=e.body;if(t.length!==e.params.length)throw new i.ArcadeExecutionError(r,i.ExecutionErrorCodes.WrongNumberOfParameters,null);for(let i=0;i<t.length;i++){const n=e.params[i];"Identifier"===n.type&&null!=r.localScope&&(r.localScope[n.name.toLowerCase()]={d:null,value:t[i],valueset:!0,node:null})}const a=yield N(r,o);if(a instanceof c.ReturnResult)return a.value;if(a===c.breakResult)throw new i.ArcadeExecutionError(r,i.ExecutionErrorCodes.UnexpectedToken,n);if(a===c.continueResult)throw new i.ArcadeExecutionError(r,i.ExecutionErrorCodes.UnexpectedToken,n);return a instanceof c.ImplicitResult?a.value:a}))).apply(this,arguments)}d.registerFunctions(De,A),h.registerFunctions(De,A),E.registerFunctions(De,A),f.registerFunctions(De,A),y.registerFunctions(De,A),p.registerFunctions({functions:De,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:A,standardFunctionAsync:F}),De.iif=function(){var e=r._asyncToGenerator((function*(e,r){c.pcCheck(null===r.arguments?[]:r.arguments,3,3,e,r);const t=yield N(e,r.arguments[0]);if(!1===c.isBoolean(t))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.BooleanConditionRequired,r);return N(e,t?r.arguments[1]:r.arguments[2])}));return function(r,t){return e.apply(this,arguments)}}(),De.decode=function(){var e=r._asyncToGenerator((function*(e,r){if(r.arguments.length<2)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.WrongNumberOfParameters,r);if(2===r.arguments.length)return N(e,r.arguments[1]);if((r.arguments.length-1)%2==0)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.WrongNumberOfParameters,r);return qe(e,r,1,yield N(e,r.arguments[0]))}));return function(r,t){return e.apply(this,arguments)}}(),De.when=function(){var e=r._asyncToGenerator((function*(e,r){if(r.arguments.length<3)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.WrongNumberOfParameters,r);if(r.arguments.length%2==0)throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.WrongNumberOfParameters,r);const t=yield N(e,r.arguments[0]);if(!1===c.isBoolean(t))throw new i.ArcadeExecutionError(e,i.ExecutionErrorCodes.BooleanConditionRequired,r.arguments[0]);return We(e,r,0,t)}));return function(r,t){return e.apply(this,arguments)}}();const ze={fixSpatialReference:c.fixSpatialReference,parseArguments:v,standardFunction:A,standardFunctionAsync:F,evaluateIdentifier:Me};for(const tr in De)De[tr]={value:new u.NativeFunction(De[tr]),valueset:!0,node:null};const Je=function(){};function Qe(e,r){const t=new Je;null==e&&(e={}),null==r&&(r={});const n=new o({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});n.immutable=!1,t.textformatting={value:n,valueset:!0,node:null};for(const o in r)t[o]={value:new u.NativeFunction(r[o]),native:!0,valueset:!0,node:null};for(const o in e)e[o]&&"esri.Graphic"===e[o].declaredClass?t[o]={value:a.createFromGraphic(e[o]),valueset:!0,node:null}:t[o]={value:e[o],valueset:!0,node:null};return t}function Xe(e){console.log(e)}Je.prototype=De,Je.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},Je.prototype.pi={value:Math.PI,valueset:!0,node:null};const Ze=ze;function $e(e){const r={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:A,standardFunctionAsync:F,evaluateIdentifier:Me};for(let t=0;t<e.length;t++)e[t].registerFunctions(r);for(const t in r.functions)De[t]={value:new u.NativeFunction(r.functions[t]),valueset:!0,node:null},Je.prototype[t]=De[t];for(let t=0;t<r.signatures.length;t++)l.addFunctionDeclaration(r.signatures[t],"async")}function er(e,r){return rr.apply(this,arguments)}function rr(){return(rr=r._asyncToGenerator((function*(e,r){let t=r.spatialReference;null==t&&(t=new m({wkid:102100}));let o=null;e.usesModules&&(o=new n.ArcadeModuleLoader(new Map,e.loadedModules));const a=Qe(r.vars,r.customfunctions),u={spatialReference:t,services:r.services,exports:{},libraryResolver:o,abortSignal:void 0===r.abortSignal||null===r.abortSignal?{aborted:!1}:r.abortSignal,globalScope:a,console:r.console?r.console:Xe,lrucache:r.lrucache,interceptor:r.interceptor,localScope:null,depthCounter:{depth:1}};let l=yield N(u,e);if(l instanceof c.ReturnResult&&(l=l.value),l instanceof c.ImplicitResult&&(l=l.value),l===c.voidOperation&&(l=null),l===c.breakResult)throw new i.ArcadeExecutionError(u,i.ExecutionErrorCodes.IllegalResult,null);if(l===c.continueResult)throw new i.ArcadeExecutionError(u,i.ExecutionErrorCodes.IllegalResult,null);if(c.isFunctionParameter(l))throw new i.ArcadeExecutionError(u,i.ExecutionErrorCodes.IllegalResult,null);return l}))).apply(this,arguments)}$e([s.ArrayFunctions]),e.executeScript=er,e.extend=$e,e.functionHelper=Ze,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
