// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.41/esri/copyright.txt for details.

define(["require","exports","./polyfill/tsSupport/awaiter","./polyfill/tsSupport/generator","./polyfill/tsSupport/assign","./polyfill/tsSupport/spreadarray","./ArcadePortal","./Attachment","./Dictionary","./Feature","./FunctionWrapper","./ImmutablePathArray","./ImmutablePointArray","./languageUtils","./treeAnalysis","./functions/array","./functions/date","./functions/geomasync","./functions/geometry","./functions/maths","./functions/stats","./functions/string","../geometry/Extent","../geometry/Geometry","../geometry/Multipoint","../geometry/Point","../geometry/Polygon","../geometry/Polyline","../SpatialReference"],(function(e,r,t,n,o,i,a,s,u,c,l,f,d,h,p,v,g,w,m,E,b,N,y,I,R,S,O,T,M){"use strict";function F(e){return e&&"function"==typeof e.then}Object.defineProperty(r,"__esModule",{value:!0}),r.findFunctionCalls=r.referencesFunction=r.referencesMember=r.validateScript=r.extractFieldLiterals=r.executeScript=r.extend=r.functionHelper=void 0;function A(e,r){return t(this,void 0,void 0,(function(){var t,o,i,a;return n(this,(function(n){switch(n.label){case 0:t=[],o=0,n.label=1;case 1:return o<r.arguments.length?(a=(i=t).push,[4,x(e,r.arguments[o])]):[3,4];case 2:a.apply(i,[n.sent()]),n.label=3;case 3:return o++,[3,1];case 4:return[2,t]}}))}))}function C(e,r,o){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return!0===r.preparsed?[2,o(e,null,r.arguments)]:[4,A(e,r)];case 1:return t=n.sent(),[2,o(e,r,t)]}}))}))}function U(e,r,o){return t(this,void 0,void 0,(function(){var t,i,a;return n(this,(function(n){switch(n.label){case 0:return!0===r.preparsed?(F(t=o(e,null,r.arguments)),[2,t]):[4,A(e,r)];case 1:return i=n.sent(),F(a=o(e,r,i)),[2,a]}}))}))}function x(e,r,o){return t(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return r.breakpoint&&!0!==o?[4,r.breakpoint()]:[3,2];case 1:return t.sent(),[2,x(e,r,!0)];case 2:switch(r.type){case"VariableDeclarator":return[2,Q(e,r)];case"VariableDeclaration":return[2,J(e,r,0)];case"BlockStatement":return[2,Z(e,r)];case"FunctionDeclaration":return[2,X(e,r)];case"ReturnStatement":return[2,K(e,r)];case"IfStatement":return[2,H(e,r)];case"ExpressionStatement":return[2,z(e,r)];case"UpdateExpression":return[2,Y(e,r)];case"AssignmentExpression":return[2,q(e,r)];case"ForStatement":return[2,_(e,r)];case"ForInStatement":return[2,j(e,r)];case"BreakStatement":return[2,h.breakResult];case"EmptyStatement":return[2,h.voidOperation];case"ContinueStatement":return[2,h.continueResult];case"TemplateElement":return[2,ue(e,r)];case"TemplateLiteral":return[2,ce(e,r)];case"Identifier":return[2,ae(e,r)];case"MemberExpression":return[2,re(e,r)];case"Literal":return[2,r.value];case"CallExpression":return[2,se(e,r)];case"UnaryExpression":return[2,te(e,r)];case"BinaryExpression":return[2,oe(e,r)];case"LogicalExpression":return[2,ie(e,r)];case"ArrayExpression":return[2,ne(e,r)];case"ObjectExpression":return[2,P(e,r)];case"Property":return[2,D(e,r)];default:throw new Error(p.nodeErrorMessage(r,"RUNTIME","UNREOGNISED"))}return[2]}}))}))}function P(e,r){return t(this,void 0,void 0,(function(){var t,o,i,a,s,c,l;return n(this,(function(n){switch(n.label){case 0:t=[],s=0,n.label=1;case 1:return s<r.properties.length?(o=t,i=s,[4,x(e,r.properties[s])]):[3,4];case 2:o[i]=n.sent(),n.label=3;case 3:return s++,[3,1];case 4:for(a={},s=0;s<t.length;s++){if(c=t[s],h.isFunctionParameter(c.value))throw new Error("Illegal Argument");if(!1===h.isString(c.key))throw new Error("Illegal Argument");c.value===h.voidOperation?a[c.key.toString()]=null:a[c.key.toString()]=c.value}return(l=new u(a)).immutable=!1,[2,l]}}))}))}function D(e,r){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return[4,x(e,r.value)];case 1:return t=n.sent(),"Identifier"===r.key.type?[2,{key:r.key.name,value:t}]:[4,x(e,r.key)];case 2:return[2,{key:n.sent(),value:t}]}}))}))}function L(e,r,o){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return[4,x(e,r.body)];case 1:return t=n.sent(),o.lastAction=t,o.lastAction===h.breakResult?(o.testResult=!1,[2,o]):o.lastAction instanceof h.ReturnResult?(o.testResult=!1,[2,o]):null===r.update?[3,3]:[4,x(e,r.update)];case 2:return n.sent(),[2,o];case 3:return[2,o]}}))}))}function k(e,r,o,i,a,s){try{(function(e,r,o){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return null===r.test?[3,2]:[4,x(e,r.test)];case 1:if(t=n.sent(),!0===e.abortSignal.aborted)throw new Error("Cancelled");if(o.testResult=t,!1===o.testResult)return[2,o];if(!0!==o.testResult)throw new Error(p.nodeErrorMessage(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));return[2,L(e,r,o)];case 2:return[2,L(e,r,o)]}}))}))})(e,r,o).then((function(){try{!0===o.testResult?++s>100?(s=0,setTimeout((function(){k(e,r,o,i,a,s)}),0)):k(e,r,o,i,a,s):o.lastAction instanceof h.ReturnResult?i(o.lastAction):i(h.voidOperation)}catch(e){a(e)}}),(function(e){a(e)}))}catch(e){a(e)}}function _(e,r){try{return null!==r.init?x(e,r.init).then((function(){return new Promise((function(t,n){var o={testResult:!0,lastAction:h.voidOperation};k(e,r,o,(function(e){t(e)}),(function(e){n(e)}),0)}))})):new Promise((function(t,n){var o={testResult:!0,lastAction:h.voidOperation};k(e,r,o,(function(e){t(e)}),(function(e){n(e)}),0)}))}catch(e){return Promise.reject(e)}}function B(e,r,t,n,o,i){try{if(void 0===i&&(i="i"),0===t.length)return void n.resolve(h.voidOperation);!function e(r,t,n,o,i,a,s,u,c,l){try{if(o<=a)return void u(h.voidOperation);i.value="k"===s?n[a]:a,x(r,t.body).then((function(f){try{f instanceof h.ReturnResult?u(f):f===h.breakResult?u(h.voidOperation):++l>100?(l=0,setTimeout((function(){e(r,t,n,o,i,a+1,s,u,c,l)}),0)):e(r,t,n,o,i,a+1,s,u,c,l)}catch(e){c(e)}}),(function(e){c(e)}))}catch(e){c(e)}}(e,r,t,t.length,o,0,i,(function(e){n.resolve(e)}),(function(e){n.reject(e)}),0)}catch(e){n.reject(e)}}function V(e,r,t,n,o,i){try{if(void 0===i&&(i="i"),0===t.length)return void n.resolve(h.voidOperation);!function e(r,t,n,o,i,a,s,u,c){try{if(n.length()<=i)return void s(h.voidOperation);o.value="k"===a?n.get(i):i,x(r,t.body).then((function(l){l instanceof h.ReturnResult?s(l):l===h.breakResult?s(h.voidOperation):++c>100?(c=0,setTimeout((function(){e(r,t,n,o,i+1,a,s,u,c)}),0)):e(r,t,n,o,i+1,a,s,u,c)}),(function(e){u(e)}))}catch(e){u(e)}}(e,r,t,o,0,i,(function(e){n.resolve(e)}),(function(e){n.reject(e)}),0)}catch(e){n.reject(e)}}function j(e,r){return t(this,void 0,void 0,(function(){return n(this,(function(t){return[2,new Promise((function(t,n){x(e,r.right).then((function(o){try{("VariableDeclaration"===r.left.type?x(e,r.left):Promise.resolve()).then((function(){try{var i="";if("VariableDeclaration"===r.left.type){var a=r.left.declarations[0].id;"Identifier"===a.type&&(i=a.name)}else"Identifier"===r.left.type&&(i=r.left.name);if(!i)throw new Error(p.nodeErrorMessage(r,"RUNTIME","INVALIDVARIABLE"));i=i.toLowerCase();var s=null;if(null!==e.localScope&&void 0!==e.localScope[i]&&(s=e.localScope[i]),null===s&&void 0!==e.globalScope[i]&&(s=e.globalScope[i]),null===s)return void n(new Error(p.nodeErrorMessage(r,"RUNTIME","VARIABLENOTDECLARED")));h.isArray(o)||h.isString(o)?B(e,r,o,{reject:n,resolve:t},s):h.isImmutableArray(o)?V(e,r,o,{reject:n,resolve:t},s):o instanceof u||h.isFeature(o)?function(e,r,t,n,o){try{B(e,r,t.keys(),n,o,"k")}catch(e){n.reject(e)}}(e,r,o,{reject:n,resolve:t},s):h.isFeatureSet(o)?function e(r,t,n,o,i,a,s,u){try{r.next().then((function(l){try{if(null===l)a(h.voidOperation);else{var f=c.createFromGraphicLikeObject(l.geometry,l.attributes,o);f._underlyingGraphic=l,i.value=f,x(t,n.body).then((function(c){try{c===h.breakResult?a(h.voidOperation):c instanceof h.ReturnResult?a(c):++u>100?(u=0,setTimeout((function(){e(r,t,n,o,i,a,s,u)}),0)):e(r,t,n,o,i,a,s,u)}catch(e){s(e)}}),(function(e){s(e)}))}}catch(e){s(e)}}),(function(e){s(e)}))}catch(e){s(e)}}(o.iterator(e.abortSignal),e,r,o,s,(function(e){t(e)}),(function(e){n(e)}),0):B(e,r,[],{reject:n,resolve:t},s)}catch(e){n(e)}}),n)}catch(e){n(e)}}),n)}))]}))}))}function Y(e,r){return t(this,void 0,void 0,(function(){var t,o,i,a,s,c,l,f;return n(this,(function(n){switch(n.label){case 0:return"MemberExpression"!==(t=r.argument).type?[3,5]:(o={t:null},[4,x(e,t.object)]);case 1:return i=n.sent(),a=null,o.t=i,!0!==t.computed?[3,3]:[4,x(e,t.property)];case 2:return a=n.sent(),[3,4];case 3:"Identifier"===t.property.type&&(a=t.property.name),n.label=4;case 4:if(s=o.t,h.isArray(s)){if(!h.isNumber(a))throw new Error("Invalid Parameter");if(a<0&&(a=s.length+a),a<0||a>=s.length)throw new Error("Assignment outside of array bounds");c=h.toNumber(s[a]),s[a]="++"===r.operator?c+1:c-1}else if(s instanceof u){if(!1===h.isString(a))throw new Error("Dictionary accessor must be a string");if(!0!==s.hasField(a))throw new Error("Invalid Parameter");c=h.toNumber(s.field(a)),s.setField(a,"++"===r.operator?c+1:c-1)}else{if(!h.isFeature(s))throw h.isImmutableArray(s)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===h.isString(a))throw new Error("Feature accessor must be a string");if(!0!==s.hasField(a))throw new Error("Invalid Parameter");c=h.toNumber(s.field(a)),s.setField(a,"++"===r.operator?c+1:c-1)}return!1===r.prefix?[2,c]:[2,"++"===r.operator?c+1:c-1];case 5:if(!(l="Identifier"===r.argument.type?r.argument.name.toLowerCase():""))throw new Error("Invalid identifier");if(null!==e.localScope&&void 0!==e.localScope[l])return f=h.toNumber(e.localScope[l].value),e.localScope[l]={value:"++"===r.operator?f+1:f-1,valueset:!0,node:r},!1===r.prefix?[2,f]:[2,"++"===r.operator?f+1:f-1];if(void 0!==e.globalScope[l])return f=h.toNumber(e.globalScope[l].value),e.globalScope[l]={value:"++"===r.operator?f+1:f-1,valueset:!0,node:r},!1===r.prefix?[2,f]:[2,"++"===r.operator?f+1:f-1];throw new Error("Variable not recognised")}}))}))}function G(e,r,t,n){switch(r){case"=":return e===h.voidOperation?null:e;case"/=":return h.toNumber(t)/h.toNumber(e);case"*=":return h.toNumber(t)*h.toNumber(e);case"-=":return h.toNumber(t)-h.toNumber(e);case"+=":return h.isString(t)||h.isString(e)?h.toString(t)+h.toString(e):h.toNumber(t)+h.toNumber(e);case"%=":return h.toNumber(t)%h.toNumber(e);default:throw new Error(p.nodeErrorMessage(n,"RUNTIME","OPERATORNOTRECOGNISED"))}}function q(e,r){return t(this,void 0,void 0,(function(){var t,o,i,a,s;return n(this,(function(n){switch(n.label){case 0:return"MemberExpression"!==(t=r.left).type?[3,6]:[4,x(e,r.right)];case 1:return s=n.sent(),[4,x(e,t.object)];case 2:return o=n.sent(),i=null,!0!==t.computed?[3,4]:[4,x(e,t.property)];case 3:return i=n.sent(),[3,5];case 4:if("Identifier"!==t.property.type)throw new Error("Expected computed or identifier for assignemnt target");i=t.property.name,n.label=5;case 5:if(h.isArray(o)){if(!h.isNumber(i))throw new Error("Invalid Parameter");if(i<0&&(i=o.length+i),i<0||i>o.length)throw new Error("Assignment outside of array bounds");if(i===o.length){if("="!==r.operator)throw new Error("Invalid Parameter");o[i]=G(s,r.operator,o[i],r)}else o[i]=G(s,r.operator,o[i],r)}else if(o instanceof u){if(!1===h.isString(i))throw new Error("Dictionary accessor must be a string");if(!0===o.hasField(i))o.setField(i,G(s,r.operator,o.field(i),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");o.setField(i,G(s,r.operator,null,r))}}else{if(!h.isFeature(o))throw h.isImmutableArray(o)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===h.isString(i))throw new Error("Feature accessor must be a string");if(!0===o.hasField(i))o.setField(i,G(s,r.operator,o.field(i),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");o.setField(i,G(s,r.operator,null,r))}}return[2,h.voidOperation];case 6:return a=t.name.toLowerCase(),null===e.localScope?[3,8]:void 0===e.localScope[a]?[3,8]:[4,x(e,r.right)];case 7:return s=n.sent(),e.localScope[a]={value:G(s,r.operator,e.localScope[a].value,r),valueset:!0,node:r.right},[2,h.voidOperation];case 8:return void 0===e.globalScope[a]?[3,10]:[4,x(e,r.right)];case 9:return s=n.sent(),e.globalScope[a]={value:G(s,r.operator,e.globalScope[a].value,r),valueset:!0,node:r.right},[2,h.voidOperation];case 10:throw new Error("Cannot assign undeclared variable")}}))}))}function z(e,r){return t(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:return"AssignmentExpression"===r.expression.type?[2,x(e,r.expression)]:"CallExpression"!==r.expression.type?[3,2]:[4,x(e,r.expression)];case 1:return(t=n.sent())===h.voidOperation?[2,h.voidOperation]:[2,new h.ImplicitResult(t)];case 2:return[4,x(e,r.expression)];case 3:return(o=n.sent())===h.voidOperation?[2,h.voidOperation]:[2,new h.ImplicitResult(o)]}}))}))}function H(e,r){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:if("AssignmentExpression"===r.test.type||"UpdateExpression"===r.test.type)throw new Error(p.nodeErrorMessage(r.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));return[4,x(e,r.test)];case 1:if(!0===(t=n.sent()))return[2,x(e,r.consequent)];if(!1===t)return null!==r.alternate?[2,x(e,r.alternate)]:[2,h.voidOperation];throw new Error(p.nodeErrorMessage(r.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}}))}))}function Z(e,r){return t(this,void 0,void 0,(function(){return n(this,(function(t){return[2,W(e,r,0)]}))}))}function W(e,r,o){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return o>=r.body.length?[2,h.voidOperation]:[4,x(e,r.body[o])];case 1:return(t=n.sent())instanceof h.ReturnResult||t===h.breakResult||t===h.continueResult?[2,t]:o===r.body.length-1?[2,t]:[2,W(e,r,o+1)]}}))}))}function K(e,r){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return null===r.argument?[2,new h.ReturnResult(h.voidOperation)]:[4,x(e,r.argument)];case 1:return t=n.sent(),[2,new h.ReturnResult(t)]}}))}))}function X(e,r){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){return t=r.id.name.toLowerCase(),e.globalScope[t]={valueset:!0,node:null,value:new l(r,e)},[2,h.voidOperation]}))}))}function J(e,r,o){return t(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return o>=r.declarations.length?[2,h.voidOperation]:[4,x(e,r.declarations[o])];case 1:return t.sent(),o===r.declarations.length-1?[2,h.voidOperation]:[4,J(e,r,o+1)];case 2:return t.sent(),[2,h.voidOperation]}}))}))}function Q(e,r){return t(this,void 0,void 0,(function(){var t,o,i;return n(this,(function(n){switch(n.label){case 0:return t=null,null!==r.init?[3,1]:(t=null,[3,3]);case 1:return[4,x(e,r.init)];case 2:t=n.sent(),n.label=3;case 3:if(null!==e.localScope){if(t===h.voidOperation&&(t=null),"Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");return o=r.id.name.toLowerCase(),e.localScope[o]={value:t,valueset:!0,node:r.init},[2,h.voidOperation]}if("Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");return i=r.id.name.toLowerCase(),t===h.voidOperation&&(t=null),e.globalScope[i]={value:t,valueset:!0,node:r.init},[2,h.voidOperation]}}))}))}var $=0;function ee(e,r,t,n){var o;switch(r=r.toLowerCase()){case"hasz":var i=e.hasZ;return void 0!==i&&i;case"hasm":var a=e.hasM;return void 0!==a&&a;case"spatialreference":var s=e.spatialReference._arcadeCacheId;if(void 0===s){var c=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(c=!1),c&&($++,e.spatialReference._arcadeCacheId=$,s=$)}var l=new u({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==s&&(l._arcadeCacheId="SPREF"+s.toString()),l}switch(e.type){case"extent":switch(r){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":var h=e[r];return void 0!==h?h:null;case"type":return"Extent"}break;case"polygon":switch(r){case"rings":return void 0===(o=e.getCacheValue("_arcadeCacheId"))&&(o=++$,e.setCacheValue("_arcadeCacheId",o)),new f(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polygon"}break;case"point":switch(r){case"x":case"y":case"z":case"m":return void 0!==e[r]?e[r]:null;case"type":return"Point"}break;case"polyline":switch(r){case"paths":return void 0===(o=e.getCacheValue("_arcadeCacheId"))&&(o=++$,e.setCacheValue("_arcadeCacheId",o)),new f(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polyline"}break;case"multipoint":switch(r){case"points":return void 0===(o=e.getCacheValue("_arcadeCacheId"))&&(o=++$,e.setCacheValue("_arcadeCacheId",o)),new d(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,o,1);case"type":return"Multipoint"}}throw new Error(p.nodeErrorMessage(n,"RUNTIME","PROPERTYNOTFOUND"))}function re(e,r){return t(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:return[4,x(e,r.object)];case 1:if(null===(t=n.sent()))throw new Error(p.nodeErrorMessage(r,"RUNTIME","NOTFOUND"));if(!1===r.computed){if("Identifier"===r.property.type){if(t instanceof u||h.isFeature(t))return[2,t.field(r.property.name)];if(t instanceof I)return[2,ee(t,r.property.name,0,r)];throw new Error(p.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}throw new Error(p.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}return[4,x(e,r.property)];case 2:if(o=n.sent(),t instanceof u||h.isFeature(t)){if(h.isString(o))return[2,t.field(o)];throw new Error(p.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(t instanceof I){if(h.isString(o))return[2,ee(t,o,0,r)];throw new Error(p.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(h.isArray(t)){if(h.isNumber(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=t.length+o),o>=t.length||o<0)throw new Error(p.nodeErrorMessage(r,"RUNTIME","OUTOFBOUNDS"));return[2,t[o]]}throw new Error(p.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(h.isImmutableArray(t)){if(h.isNumber(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=t.length()+o),o>=t.length()||o<0)throw new Error(p.nodeErrorMessage(r,"RUNTIME","OUTOFBOUNDS"));return[2,t.get(o)]}throw new Error(p.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(h.isString(t)){if(h.isNumber(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=t.length+o),o>=t.length||o<0)throw new Error(p.nodeErrorMessage(r,"RUNTIME","OUTOFBOUNDS"));return[2,t[o]]}throw new Error(p.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}throw new Error(p.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}}))}))}function te(e,r){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return[4,x(e,r.argument)];case 1:if(t=n.sent(),h.isBoolean(t)){if("!"===r.operator)return[2,!t];if("-"===r.operator)return[2,-1*h.toNumber(t)];if("+"===r.operator)return[2,1*h.toNumber(t)];if("~"===r.operator)return[2,~h.toNumber(t)];throw new Error(p.nodeErrorMessage(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if("-"===r.operator)return[2,-1*h.toNumber(t)];if("+"===r.operator)return[2,1*h.toNumber(t)];if("~"===r.operator)return[2,~h.toNumber(t)];throw new Error(p.nodeErrorMessage(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}}))}))}function ne(e,r){return t(this,void 0,void 0,(function(){var t,o,i,a;return n(this,(function(n){switch(n.label){case 0:t=[],a=0,n.label=1;case 1:return a<r.elements.length?(i=(o=t).push,[4,x(e,r.elements[a])]):[3,4];case 2:i.apply(o,[n.sent()]),n.label=3;case 3:return a++,[3,1];case 4:for(a=0;a<t.length;a++){if(h.isFunctionParameter(t[a]))throw new Error(p.nodeErrorMessage(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));t[a]===h.voidOperation&&(t[a]=null)}return[2,t]}}))}))}function oe(e,r){return t(this,void 0,void 0,(function(){var t,o,i,a,s,u,c;return n(this,(function(n){switch(n.label){case 0:return o=t=[],i=0,[4,x(e,r.left)];case 1:return o[i]=n.sent(),a=t,s=1,[4,x(e,r.right)];case 2:switch(a[s]=n.sent(),u=t[0],c=t[1],r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return[2,h.binaryOperator(h.toNumber(u),h.toNumber(c),r.operator)];case"==":return[2,h.equalityTest(u,c)];case"!=":return[2,!h.equalityTest(u,c)];case"<":case">":case"<=":case">=":return[2,h.greaterThanLessThan(u,c,r.operator)];case"+":return h.isString(u)||h.isString(c)?[2,h.toString(u)+h.toString(c)]:[2,h.toNumber(u)+h.toNumber(c)];case"-":return[2,h.toNumber(u)-h.toNumber(c)];case"*":return[2,h.toNumber(u)*h.toNumber(c)];case"/":return[2,h.toNumber(u)/h.toNumber(c)];case"%":return[2,h.toNumber(u)%h.toNumber(c)];default:throw new Error(p.nodeErrorMessage(r,"RUNTIME","OPERATORNOTRECOGNISED"))}return[2]}}))}))}function ie(e,r){return t(this,void 0,void 0,(function(){var t,o;return n(this,(function(n){switch(n.label){case 0:if("AssignmentExpression"===r.left.type||"UpdateExpression"===r.left.type)throw new Error(p.nodeErrorMessage(r.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===r.right.type||"UpdateExpression"===r.right.type)throw new Error(p.nodeErrorMessage(r.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));return[4,x(e,r.left)];case 1:if(t=n.sent(),o=null,!h.isBoolean(t))return[3,8];switch(r.operator){case"||":return[3,2];case"&&":return[3,4]}return[3,6];case 2:return!0===t?[2,t]:[4,x(e,r.right)];case 3:if(o=n.sent(),h.isBoolean(o))return[2,o];throw new Error(p.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"));case 4:return!1===t?[2,t]:[4,x(e,r.right)];case 5:if(o=n.sent(),h.isBoolean(o))return[2,o];throw new Error(p.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"));case 6:throw new Error(p.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"));case 7:return[3,9];case 8:throw new Error(p.nodeErrorMessage(r,"RUNTIME","ONLYBOOLEAN"));case 9:return[2]}}))}))}function ae(e,r){return t(this,void 0,void 0,(function(){var t,o,i;return n(this,(function(n){switch(n.label){case 0:return t=r.name.toLowerCase(),null===e.localScope?[3,2]:void 0===e.localScope[t]?[3,2]:!0===(o=e.localScope[t]).valueset?[2,o.value]:null!==o.d?[2,o.d]:(o.d=x(e,o.node),[4,o.d]);case 1:return i=n.sent(),o.value=i,o.valueset=!0,[2,i];case 2:return void 0===e.globalScope[t]?[3,4]:!0===(o=e.globalScope[t]).valueset?[2,o.value]:null!==o.d?[2,o.d]:(o.d=x(e,o.node),[4,o.d]);case 3:return i=n.sent(),o.value=i,o.valueset=!0,[2,i];case 4:throw new Error(p.nodeErrorMessage(r,"RUNTIME","VARIABLENOTFOUND"))}}))}))}function se(e,r){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){if("Identifier"!==r.callee.type)throw new Error(p.nodeErrorMessage(r,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){if((t=e.localScope[r.callee.name.toLowerCase()]).value instanceof h.NativeFunction)return[2,t.value.fn(e,r)];if(t.value instanceof l)return[2,me(e,r,t.value.definition)];throw new Error(p.nodeErrorMessage(r,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){if((t=e.globalScope[r.callee.name.toLowerCase()]).value instanceof h.NativeFunction)return[2,t.value.fn(e,r)];if(t.value instanceof l)return[2,me(e,r,t.value.definition)];throw new Error(p.nodeErrorMessage(r,"RUNTIME","NOTAFUNCTION"))}throw new Error(p.nodeErrorMessage(r,"RUNTIME","NOTFOUND"))}))}))}function ue(e,r){return t(this,void 0,void 0,(function(){return n(this,(function(e){return[2,r.value?r.value.cooked:""]}))}))}function ce(e,r){return t(this,void 0,void 0,(function(){var t,o,i,a,s,u,c,l,f;return n(this,(function(n){switch(n.label){case 0:t=[],o=0,n.label=1;case 1:return o<r.expressions.length?[4,x(e,r.expressions[o])]:[3,4];case 2:i=n.sent(),t[o]=h.toString(i),n.label=3;case 3:return o++,[3,1];case 4:for(a="",s=0,u=0,c=r.quasis;u<c.length;u++)l=c[u],a+=l.value?l.value.cooked:"",!1===l.tail&&(f=t[s]?t[s]:"",a+=f,s++);return[2,a]}}))}))}var le={};function fe(e){return null===e?"":h.isArray(e)?"Array":h.isImmutableArray(e)?"Array":h.isDate(e)?"Date":h.isString(e)?"String":h.isBoolean(e)?"Boolean":h.isNumber(e)?"Number":e instanceof s?"Attachment":e instanceof a?"Portal":e instanceof u?"Dictionary":h.isFeature(e)?"Feature":e instanceof S?"Point":e instanceof O?"Polygon":e instanceof T?"Polyline":e instanceof R?"Multipoint":e instanceof y?"Extent":h.isFunctionParameter(e)?"Function":h.isFeatureSet(e)?"FeatureSet":h.isFeatureSetCollection(e)?"FeatureSetCollection":e===h.voidOperation?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function de(e,r,o,i){return t(this,void 0,void 0,(function(){var t,a;return n(this,(function(n){switch(n.label){case 0:return[4,x(e,r.arguments[o])];case 1:return t=n.sent(),h.equalityTest(t,i)?[2,x(e,r.arguments[o+1])]:1===(a=r.arguments.length-o)?[2,x(e,r.arguments[o])]:2===a?[2,null]:3===a?[2,x(e,r.arguments[o+2])]:[2,de(e,r,o+2,i)]}}))}))}function he(e,r,o,i){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:return!0===i?[2,x(e,r.arguments[o+1])]:3===r.arguments.length-o?[2,x(e,r.arguments[o+2])]:[4,x(e,r.arguments[o+2])];case 1:if(t=n.sent(),!1===h.isBoolean(t))throw new Error("WHEN needs boolean test conditions");return[2,he(e,r,o+2,t)]}}))}))}function pe(e,r){return t(this,void 0,void 0,(function(){var t,o,i,a;return n(this,(function(n){switch(n.label){case 0:return t=e.length,o=Math.floor(t/2),0===t?[2,[]]:1===t?[2,[e[0]]]:(i=[pe(e.slice(0,o),r),pe(e.slice(o,t),r)],[4,Promise.all(i)]);case 1:return[2,ve((a=n.sent())[0],a[1],r,[])]}}))}))}function ve(e,r,o,i){return t(this,void 0,void 0,(function(){var t,a;return n(this,(function(n){switch(n.label){case 0:return t=i,e.length>0||r.length>0?e.length>0&&r.length>0?[4,o(e[0],r[0])]:[3,2]:[3,4];case 1:return a=n.sent(),isNaN(a)&&(a=1),a<=0?(t.push(e[0]),e=e.slice(1)):(t.push(r[0]),r=r.slice(1)),[2,ve(e,r,o,i)];case 2:if(e.length>0)return t.push(e[0]),[2,ve(e=e.slice(1),r,o,i)];if(r.length>0)return t.push(r[0]),r=r.slice(1),[2,ve(e,r,o,i)];n.label=3;case 3:return[3,5];case 4:return[2,i];case 5:return[2]}}))}))}function ge(e,r){var t=e.length,n=Math.floor(t/2);return r||(r=function(e,r){return e<r?-1:e===r?0:1}),0===t?[]:1===t?[e[0]]:function(e,r,t){var n=[];for(;e.length>0||r.length>0;)if(e.length>0&&r.length>0){var o=t(e[0],r[0]);isNaN(o)&&(o=1),o<=0?(n.push(e[0]),e=e.slice(1)):(n.push(r[0]),r=r.slice(1))}else e.length>0?(n.push(e[0]),e=e.slice(1)):r.length>0&&(n.push(r[0]),r=r.slice(1));return n}(ge(e.slice(0,n),r),ge(e.slice(n,t),r),r)}function we(e,r,o){return t(this,void 0,void 0,(function(){var t,i,a,s;return n(this,(function(n){switch(n.label){case 0:if(t=e.body,o.length!==e.params.length)throw new Error("Invalid Parameter calls to function.");for(i=0;i<o.length;i++)"Identifier"===(a=e.params[i]).type&&(r.localScope[a.name.toLowerCase()]={d:null,value:o[i],valueset:!0,node:null});return[4,x(r,t)];case 1:if((s=n.sent())instanceof h.ReturnResult)return[2,s.value];if(s===h.breakResult)throw new Error("Cannot Break from a Function");if(s===h.continueResult)throw new Error("Cannot Continue from a Function");return s instanceof h.ImplicitResult?[2,s.value]:[2,s]}}))}))}function me(e,r,t){return U(e,r,(function(r,n,o){var i={spatialReference:e.spatialReference,services:e.services,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:e.depthCounter+1};if(i.depthCounter>64)throw new Error("Exceeded maximum function depth");return we(t,i,o)}))}function Ee(e){return function(){var r={abortSignal:e.context.abortSignal,spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,interceptor:e.context.interceptor,services:e.context.services,localScope:{},globalScope:e.context.globalScope,depthCounter:e.context.depthCounter+1};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");return we(e.definition,r,arguments)}}g.registerFunctions(le,C),N.registerFunctions(le,C),E.registerFunctions(le,C),m.registerFunctions(le,C),b.registerFunctions(le,C),w.registerFunctions({functions:le,compiled:!1,signatures:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:C,standardFunctionAsync:U}),le.typeof=function(e,r){return C(e,r,(function(e,r,t){h.pcCheck(t,1,1);var n=fe(t[0]);if("Unrecognised Type"===n)throw new Error("Unrecognised Type");return n}))},le.iif=function(e,r){return t(this,void 0,void 0,(function(){var t,o,i,a,s,u;return n(this,(function(n){switch(n.label){case 0:return h.pcCheck(null===r.arguments?[]:r.arguments,3,3),[4,x(e,r.arguments[0])];case 1:if(t=n.sent(),!1===h.isBoolean(t))throw new Error("IF Function must have a boolean test condition");return i=o=[],a=0,[4,x(e,r.arguments[1])];case 2:return i[a]=n.sent(),s=o,u=1,[4,x(e,r.arguments[2])];case 3:return s[u]=n.sent(),t?[2,o[0]]:[2,o[1]]}}))}))},le.decode=function(e,r){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:if(r.arguments.length<2)throw new Error("Missing Parameters");if(2===r.arguments.length)return[2,x(e,r.arguments[1])];if((r.arguments.length-1)%2==0)throw new Error("Must have a default value result.");return[4,x(e,r.arguments[0])];case 1:return t=n.sent(),1,[2,de(e,r,1,t)]}}))}))},le.when=function(e,r){return t(this,void 0,void 0,(function(){var t;return n(this,(function(n){switch(n.label){case 0:if(r.arguments.length<3)throw new Error("Missing Parameters");if(r.arguments.length%2==0)throw new Error("Must have a default value result.");return[4,x(e,r.arguments[0])];case 1:if(t=n.sent(),!1===h.isBoolean(t))throw new Error("WHEN needs boolean test conditions");return 0,[2,he(e,r,0,t)]}}))}))},le.sort=function(e,r){return U(e,r,(function(e,r,o){return t(this,void 0,void 0,(function(){var e,r,t,i,a,s,u,c,l,f;return n(this,(function(n){if(h.pcCheck(o,1,2),e=o[0],h.isImmutableArray(e)&&(e=e.toArray()),!1===h.isArray(e))throw new Error("Illegal Argument");if(o.length>1){if(!1===h.isFunctionParameter(o[1]))throw new Error("Illegal Argument");return r=e,t=Ee(o[1]),[2,pe(r,t)]}if(0===(i=e).length)return[2,[]];for(a={},s=0;s<i.length;s++)""!==(u=fe(i[s]))&&(a[u]=!0);if(!0===a.Array||!0===a.Dictionary||!0===a.Feature||!0===a.Point||!0===a.Polygon||!0===a.Polyline||!0===a.Multipoint||!0===a.Extent||!0===a.Function)return[2,i.slice(0)];for(f in c=0,l="",a)c++,l=f;return c>1||"String"===l?i=ge(i,(function(e,r){if(null==e||e===h.voidOperation)return null==r||r===h.voidOperation?0:1;if(null==r||r===h.voidOperation)return-1;var t=h.toString(e),n=h.toString(r);return t<n?-1:t===n?0:1})):"Number"===l?i=ge(i,(function(e,r){return e-r})):"Boolean"===l?i=ge(i,(function(e,r){return e===r?0:r?-1:1})):"Date"===l&&(i=ge(i,(function(e,r){return r-e}))),[2,i]}))}))}))};var be={fixSpatialReference:h.fixSpatialReference,parseArguments:A,standardFunction:C,standardFunctionAsync:U,evaluateIdentifier:ae,arcadeCustomFunction:Ee};for(var Ne in le)le[Ne]={value:new h.NativeFunction(le[Ne]),valueset:!0,node:null};var ye=function(){};function Ie(e){console.log(e)}function Re(e){for(var r={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:C,standardFunctionAsync:U,evaluateIdentifier:ae,arcadeCustomFunctionHandler:Ee},t=0;t<e.length;t++)e[t].registerFunctions(r);for(var n in r.functions)le[n]={value:new h.NativeFunction(r.functions[n]),valueset:!0,node:null},ye.prototype[n]=le[n];for(t=0;t<r.signatures.length;t++)p.addFunctionDeclaration(r.signatures[t],"async")}(ye.prototype=le).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},ye.prototype.pi={value:Math.PI,valueset:!0,node:null},r.functionHelper=be,r.extend=Re,Re([v]),r.executeScript=function(e,r){return t(this,void 0,void 0,(function(){var t,o,i;return n(this,(function(n){switch(n.label){case 0:return null==(t=r.spatialReference)&&(t=new M({wkid:102100})),o=function(e,r){var t=new ye;null==e&&(e={}),null==r&&(r={});var n=new u({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});for(var o in n.immutable=!1,t.textformatting={value:n,valueset:!0,node:null},r)t[o]={value:new h.NativeFunction(r[o]),native:!0,valueset:!0,node:null};for(var o in e)e[o]&&"esri.Graphic"===e[o].declaredClass?t[o]={value:c.createFromGraphic(e[o]),valueset:!0,node:null}:t[o]={value:e[o],valueset:!0,node:null};return t}(r.vars,r.customfunctions),[4,x({spatialReference:t,services:r.services,abortSignal:void 0===r.abortSignal||null===r.abortSignal?{aborted:!1}:r.abortSignal,globalScope:o,console:r.console?r.console:Ie,lrucache:r.lrucache,interceptor:r.interceptor,localScope:null,depthCounter:1},e.body[0].body)];case 1:if((i=n.sent())instanceof h.ReturnResult&&(i=i.value),i instanceof h.ImplicitResult&&(i=i.value),i===h.voidOperation&&(i=null),i===h.breakResult)throw new Error("Cannot return BREAK");if(i===h.continueResult)throw new Error("Cannot return CONTINUE");if(i instanceof h.NativeFunction)throw new Error("Cannot return FUNCTION");if(i instanceof l)throw new Error("Cannot return FUNCTION");return[2,i]}}))}))},r.extractFieldLiterals=function(e,r){return void 0===r&&(r=!1),p.findFieldLiterals(e)},r.validateScript=function(e,r){return p.validateScript(e,r,"full")},r.referencesMember=function(e,r){return p.referencesMember(e,r)},r.referencesFunction=function(e,r){return p.referencesFunction(e,r)},r.findFunctionCalls=function(e){return p.findFunctionCalls(e)}}));