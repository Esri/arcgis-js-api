/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","./ArcadePortal","./Attachment","./Dictionary","./Feature","./FunctionWrapper","./ImmutablePathArray","./ImmutablePointArray","../chunks/languageUtils","./treeAnalysis","../chunks/array","./functions/date","./functions/geometry","./functions/geomsync","./functions/maths","./functions/stats","./functions/string","../geometry/Extent","../geometry/Geometry","../geometry/Multipoint","../geometry/Point","../geometry/Polygon","../geometry/Polyline","../geometry/SpatialReference"],(function(e,r,t,n,o,a,i,s,u,l,c,f,p,d,h,g,m,E,w,N,y,v,I,b){"use strict";function R(e,r){const t=[];for(let n=0;n<r.arguments.length;n++)t.push(S(e,r.arguments[n]));return t}function O(e,r,t){try{return!0===r.preparsed?t(e,null,r.arguments):t(e,r,R(e,r))}catch(n){throw n}}function S(e,r){try{switch(r.type){case"EmptyStatement":return u.voidOperation;case"VariableDeclarator":return Y(e,r);case"VariableDeclaration":return V(e,r);case"BlockStatement":return k(e,r);case"FunctionDeclaration":return B(e,r);case"ReturnStatement":return _(e,r);case"IfStatement":return L(e,r);case"ExpressionStatement":return D(e,r);case"AssignmentExpression":return P(e,r);case"UpdateExpression":return C(e,r);case"BreakStatement":return u.breakResult;case"ContinueStatement":return u.continueResult;case"TemplateElement":return K(e,r);case"TemplateLiteral":return X(e,r);case"ForStatement":return F(e,r);case"ForInStatement":return A(e,r);case"Identifier":return J(e,r);case"MemberExpression":return q(e,r);case"Literal":return r.value;case"CallExpression":return Q(e,r);case"UnaryExpression":return z(e,r);case"BinaryExpression":return Z(e,r);case"LogicalExpression":return W(e,r);case"ArrayExpression":return H(e,r);case"ObjectExpression":return T(e,r);case"Property":return M(e,r);default:throw new Error(l.nodeErrorMessage(r,"RUNTIME","UNREOGNISED"))}}catch(t){throw t}}function T(e,r){const t={};for(let n=0;n<r.properties.length;n++){const o=S(e,r.properties[n]);if(u.isFunctionParameter(o.value))throw new Error("Illegal Argument");if(!1===u.isString(o.key))throw new Error("Illegal Argument");o.value===u.voidOperation?t[o.key.toString()]=null:t[o.key.toString()]=o.value}const o=new n(t);return o.immutable=!1,o}function M(e,r){return{key:"Identifier"===r.key.type?r.key.name:S(e,r.key),value:S(e,r.value)}}function A(e,r){const t=S(e,r.right);"VariableDeclaration"===r.left.type&&S(e,r.left);let o=null,a="";if("VariableDeclaration"===r.left.type){const e=r.left.declarations[0].id;"Identifier"===e.type&&(a=e.name)}else"Identifier"===r.left.type&&(a=r.left.name);if(!a)throw new Error(l.nodeErrorMessage(r,"RUNTIME","INVALIDVARIABLE"));if(a=a.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[a]&&(o=e.localScope[a]),null===o&&void 0!==e.globalScope[a]&&(o=e.globalScope[a]),null===o)throw new Error(l.nodeErrorMessage(r,"RUNTIME","VARIABLENOTDECLARED"));if(u.isArray(t)||u.isString(t)){const n=t.length;for(let t=0;t<n;t++){o.value=t;const n=S(e,r.body);if(n===u.breakResult)break;if(n instanceof u.ReturnResult)return n}return u.voidOperation}if(u.isImmutableArray(t)){for(let n=0;n<t.length();n++){o.value=n;const t=S(e,r.body);if(t===u.breakResult)break;if(t instanceof u.ReturnResult)return t}return u.voidOperation}if(!(t instanceof n||u.isFeature(t)))return u.voidOperation;{const n=t.keys();for(let t=0;t<n.length;t++){o.value=n[t];const a=S(e,r.body);if(a===u.breakResult)break;if(a instanceof u.ReturnResult)return a}}}function F(e,r){null!==r.init&&S(e,r.init);const t={testResult:!0,lastAction:u.voidOperation};do{U(e,r,t)}while(!0===t.testResult);return t.lastAction instanceof u.ReturnResult?t.lastAction:u.voidOperation}function U(e,r,t){if(null!==r.test){if(t.testResult=S(e,r.test),!1===t.testResult)return;if(!0!==t.testResult)throw new Error(l.nodeErrorMessage(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}t.lastAction=S(e,r.body),t.lastAction!==u.breakResult?t.lastAction instanceof u.ReturnResult?t.testResult=!1:null!==r.update&&S(e,r.update):t.testResult=!1}function C(e,r){let t,o=null,a="";if("MemberExpression"===r.argument.type){if(o=S(e,r.argument.object),!0===r.argument.computed?a=S(e,r.argument.property):"Identifier"===r.argument.property.type&&(a=r.argument.property.name),u.isArray(o)){if(!u.isNumber(a))throw new Error("Invalid Parameter");if(a<0&&(a=o.length+a),a<0||a>=o.length)throw new Error("Assignment outside of array bounds");t=u.toNumber(o[a]),o[a]="++"===r.operator?t+1:t-1}else if(o instanceof n){if(!1===u.isString(a))throw new Error("Dictionary accessor must be a string");if(!0!==o.hasField(a))throw new Error("Invalid Parameter");t=u.toNumber(o.field(a)),o.setField(a,"++"===r.operator?t+1:t-1)}else{if(!u.isFeature(o))throw u.isImmutableArray(o)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===u.isString(a))throw new Error("Feature accessor must be a string");if(!0!==o.hasField(a))throw new Error("Invalid Parameter");t=u.toNumber(o.field(a)),o.setField(a,"++"===r.operator?t+1:t-1)}return!1===r.prefix?t:"++"===r.operator?t+1:t-1}if(o="Identifier"===r.argument.type?r.argument.name.toLowerCase():"",!o)throw new Error("Invalid identifier");if(null!==e.localScope&&void 0!==e.localScope[o])return t=u.toNumber(e.localScope[o].value),e.localScope[o]={value:"++"===r.operator?t+1:t-1,valueset:!0,node:r},!1===r.prefix?t:"++"===r.operator?t+1:t-1;if(void 0!==e.globalScope[o])return t=u.toNumber(e.globalScope[o].value),e.globalScope[o]={value:"++"===r.operator?t+1:t-1,valueset:!0,node:r},!1===r.prefix?t:"++"===r.operator?t+1:t-1;throw new Error("Variable not recognised")}function x(e,r,t,n){switch(r){case"=":return e===u.voidOperation?null:e;case"/=":return u.toNumber(t)/u.toNumber(e);case"*=":return u.toNumber(t)*u.toNumber(e);case"-=":return u.toNumber(t)-u.toNumber(e);case"+=":return u.isString(t)||u.isString(e)?u.toString(t)+u.toString(e):u.toNumber(t)+u.toNumber(e);case"%=":return u.toNumber(t)%u.toNumber(e);default:throw new Error(l.nodeErrorMessage(n,"RUNTIME","OPERATORNOTRECOGNISED"))}}function P(e,r){const t=S(e,r.right);let o=null,a="";if("MemberExpression"===r.left.type){if(o=S(e,r.left.object),!0===r.left.computed?a=S(e,r.left.property):"Identifier"===r.left.property.type&&(a=r.left.property.name),u.isArray(o)){if(!u.isNumber(a))throw new Error("Invalid Parameter");if(a<0&&(a=o.length+a),a<0||a>o.length)throw new Error("Assignment outside of array bounds");if(a===o.length){if("="!==r.operator)throw new Error("Invalid Parameter");o[a]=x(t,r.operator,o[a],r)}else o[a]=x(t,r.operator,o[a],r)}else if(o instanceof n){if(!1===u.isString(a))throw new Error("Dictionary accessor must be a string");if(!0===o.hasField(a))o.setField(a,x(t,r.operator,o.field(a),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");o.setField(a,x(t,r.operator,null,r))}}else{if(!u.isFeature(o))throw u.isImmutableArray(o)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===u.isString(a))throw new Error("Feature accessor must be a string");if(!0===o.hasField(a))o.setField(a,x(t,r.operator,o.field(a),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");o.setField(a,x(t,r.operator,null,r))}}return u.voidOperation}if(o=r.left.name.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[o])return e.localScope[o]={value:x(t,r.operator,e.localScope[o].value,r),valueset:!0,node:r.right},u.voidOperation;if(void 0!==e.globalScope[o])return e.globalScope[o]={value:x(t,r.operator,e.globalScope[o].value,r),valueset:!0,node:r.right},u.voidOperation;throw new Error("Variable not recognised")}function D(e,r){if("AssignmentExpression"===r.expression.type||"UpdateExpression"===r.expression.type)return S(e,r.expression);if("CallExpression"===r.expression.type){const t=S(e,r.expression);return t===u.voidOperation?u.voidOperation:new u.ImplicitResult(t)}{const t=S(e,r.expression);return t===u.voidOperation?u.voidOperation:new u.ImplicitResult(t)}}function L(e,r){if("AssignmentExpression"===r.test.type||"UpdateExpression"===r.test.type)throw new Error(l.nodeErrorMessage(r.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=S(e,r.test);if(!0===t)return S(e,r.consequent);if(!1===t)return null!==r.alternate?S(e,r.alternate):u.voidOperation;throw new Error(l.nodeErrorMessage(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}function k(e,r){let t=u.voidOperation;for(let n=0;n<r.body.length;n++)if(t=S(e,r.body[n]),t instanceof u.ReturnResult||t===u.breakResult||t===u.continueResult)return t;return t}function _(e,r){if(null===r.argument)return new u.ReturnResult(u.voidOperation);const t=S(e,r.argument);return new u.ReturnResult(t)}function B(e,r){const t=r.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new a(r,e)},u.voidOperation}function V(e,r){for(let t=0;t<r.declarations.length;t++)S(e,r.declarations[t]);return u.voidOperation}function Y(e,r){let t=null===r.init?null:S(e,r.init);if(t===u.voidOperation&&(t=null),"Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");const n=r.id.name.toLowerCase();return null!==e.localScope?e.localScope[n]={value:t,valueset:!0,node:r.init}:e.globalScope[n]={value:t,valueset:!0,node:r.init},u.voidOperation}let G=0;function j(e,r,t){let o;switch(r=r.toLowerCase()){case"hasz":{const r=e.hasZ;return void 0!==r&&r}case"hasm":{const r=e.hasM;return void 0!==r&&r}case"spatialreference":{let r=e.spatialReference._arcadeCacheId;if(void 0===r){let t=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(t=!1),t&&(G++,e.spatialReference._arcadeCacheId=G,r=G)}const t=new n({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==r&&(t._arcadeCacheId="SPREF"+r.toString()),t}}switch(e.type){case"extent":switch(r){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const t=e[r];return void 0!==t?t:null}case"type":return"Extent"}break;case"polygon":switch(r){case"rings":o=e.cache._arcadeCacheId,void 0===o&&(G++,o=G,e.cache._arcadeCacheId=o);return new i(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polygon"}break;case"point":switch(r){case"x":case"y":case"z":case"m":return void 0!==e[r]?e[r]:null;case"type":return"Point"}break;case"polyline":switch(r){case"paths":o=e.cache._arcadeCacheId,void 0===o&&(G++,o=G,e.cache._arcadeCacheId=o);return new i(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polyline"}break;case"multipoint":switch(r){case"points":o=e.cache._arcadeCacheId,void 0===o&&(G++,o=G,e.cache._arcadeCacheId=o);return new s(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,o,1);case"type":return"Multipoint"}}throw new Error(l.nodeErrorMessage(t,"RUNTIME","PROPERTYNOTFOUND"))}function q(e,r){try{const t=S(e,r.object);if(null===t)throw new Error(l.nodeErrorMessage(r,"RUNTIME","NOTFOUND"));if(!1===r.computed){if("Identifier"===r.property.type){if(t instanceof n||u.isFeature(t))return t.field(r.property.name);if(t instanceof w)return j(t,r.property.name,r)}throw new Error(l.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}{let o=S(e,r.property);if(t instanceof n||u.isFeature(t)){if(u.isString(o))return t.field(o);throw new Error(l.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(t instanceof w){if(u.isString(o))return j(t,o,r);throw new Error(l.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(u.isArray(t)){if(u.isNumber(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=t.length+o),o>=t.length||o<0)throw new Error(l.nodeErrorMessage(r,"RUNTIME","OUTOFBOUNDS"));return t[o]}throw new Error(l.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(u.isString(t)){if(u.isNumber(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=t.length+o),o>=t.length||o<0)throw new Error(l.nodeErrorMessage(r,"RUNTIME","OUTOFBOUNDS"));return t[o]}throw new Error(l.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(u.isImmutableArray(t)){if(u.isNumber(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=t.length()+o),o>=t.length()||o<0)throw new Error(l.nodeErrorMessage(r,"RUNTIME","OUTOFBOUNDS"));return t.get(o)}throw new Error(l.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}throw new Error(l.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}}catch(t){throw t}}function z(e,r){try{const t=S(e,r.argument);if(u.isBoolean(t)){if("!"===r.operator)return!t;if("-"===r.operator)return-1*u.toNumber(t);if("+"===r.operator)return 1*u.toNumber(t);if("~"===r.operator)return~u.toNumber(t);throw new Error(l.nodeErrorMessage(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if("~"===r.operator)return~u.toNumber(t);if("-"===r.operator)return-1*u.toNumber(t);if("+"===r.operator)return 1*u.toNumber(t);throw new Error(l.nodeErrorMessage(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}catch(t){throw t}}function H(e,r){try{const t=[];for(let n=0;n<r.elements.length;n++){const o=S(e,r.elements[n]);if(u.isFunctionParameter(o))throw new Error(l.nodeErrorMessage(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));o===u.voidOperation?t.push(null):t.push(o)}return t}catch(t){throw t}}function Z(e,r){try{const t=[S(e,r.left),S(e,r.right)],n=t[0],o=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return u.binaryOperator(u.toNumber(n),u.toNumber(o),r.operator);case"==":return u.equalityTest(n,o);case"!=":return!u.equalityTest(n,o);case"<":case">":case"<=":case">=":return u.greaterThanLessThan(n,o,r.operator);case"+":return u.isString(n)||u.isString(o)?u.toString(n)+u.toString(o):u.toNumber(n)+u.toNumber(o);case"-":return u.toNumber(n)-u.toNumber(o);case"*":return u.toNumber(n)*u.toNumber(o);case"/":return u.toNumber(n)/u.toNumber(o);case"%":return u.toNumber(n)%u.toNumber(o);default:throw new Error(l.nodeErrorMessage(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}catch(t){throw t}}function W(e,r){try{if("AssignmentExpression"===r.left.type||"UpdateExpression"===r.left.type)throw new Error(l.nodeErrorMessage(r.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===r.right.type||"UpdateExpression"===r.right.type)throw new Error(l.nodeErrorMessage(r.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=S(e,r.left);if(u.isBoolean(t))switch(r.operator){case"||":if(!0===t)return t;{const t=S(e,r.right);if(u.isBoolean(t))return t;throw new Error(l.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"))}case"&&":if(!1===t)return t;{const t=S(e,r.right);if(u.isBoolean(t))return t;throw new Error(l.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"))}default:throw new Error(l.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"))}throw new Error(l.nodeErrorMessage(r,"RUNTIME","ONLYBOOLEAN"))}catch(t){throw t}}function K(e,r){return r.value?r.value.cooked:""}function X(e,r){let t="",n=0;for(const o of r.quasis)if(t+=o.value?o.value.cooked:"",!1===o.tail){t+=r.expressions[n]?u.toString(S(e,r.expressions[n])):"",n++}return t}function J(e,r){let t;try{const n=r.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[n])return t=e.localScope[n],!0===t.valueset||(t.value=S(e,t.node),t.valueset=!0),t.value;if(void 0!==e.globalScope[n])return t=e.globalScope[n],!0===t.valueset||(t.value=S(e,t.node),t.valueset=!0),t.value;throw new Error(l.nodeErrorMessage(r,"RUNTIME","VARIABLENOTFOUND"))}catch(n){throw n}}function Q(e,r){try{if("Identifier"!==r.callee.type)throw new Error(l.nodeErrorMessage(r,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){const t=e.localScope[r.callee.name.toLowerCase()];if(t.value instanceof u.NativeFunction)return t.value.fn(e,r);if(t.value instanceof a)return ie(e,r,t.value.definition);throw new Error(l.nodeErrorMessage(r,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){const t=e.globalScope[r.callee.name.toLowerCase()];if(t.value instanceof u.NativeFunction)return t.value.fn(e,r);if(t.value instanceof a)return ie(e,r,t.value.definition);throw new Error(l.nodeErrorMessage(r,"RUNTIME","NOTAFUNCTION"))}throw new Error(l.nodeErrorMessage(r,"RUNTIME","NOTFOUND"))}catch(t){throw t}}const $={};function ee(e){return null==e?"":u.isArray(e)||u.isImmutableArray(e)?"Array":u.isDate(e)?"Date":u.isString(e)?"String":u.isBoolean(e)?"Boolean":u.isNumber(e)?"Number":e instanceof t?"Attachment":e instanceof r?"Portal":e instanceof n?"Dictionary":u.isFeature(e)?"Feature":e instanceof y?"Point":e instanceof v?"Polygon":e instanceof I?"Polyline":e instanceof N?"Multipoint":e instanceof E?"Extent":u.isFunctionParameter(e)?"Function":u.isFeatureSet(e)?"FeatureSet":u.isFeatureSetCollection(e)?"FeatureSetCollection":e===u.voidOperation?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function re(e,r,t,n){try{const o=S(e,r.arguments[t]);if(u.equalityTest(o,n))return S(e,r.arguments[t+1]);{const o=r.arguments.length-t;return 1===o?S(e,r.arguments[t]):2===o?null:3===o?S(e,r.arguments[t+2]):re(e,r,t+2,n)}}catch(o){throw o}}function te(e,r,t,n){try{if(!0===n)return S(e,r.arguments[t+1]);if(3===r.arguments.length-t)return S(e,r.arguments[t+2]);{const n=S(e,r.arguments[t+2]);if(!1===u.isBoolean(n))throw new Error("WHEN needs boolean test conditions");return te(e,r,t+2,n)}}catch(o){throw o}}function ne(e,r){const t=e.length,n=Math.floor(t/2);return 0===t?[]:1===t?[e[0]]:oe(ne(e.slice(0,n),r),ne(e.slice(n,t),r),r)}function oe(e,r,t){const n=[];for(;e.length>0||r.length>0;)if(e.length>0&&r.length>0){let o=t(e[0],r[0]);isNaN(o)&&(o=0),o<=0?(n.push(e[0]),e=e.slice(1)):(n.push(r[0]),r=r.slice(1))}else e.length>0?(n.push(e[0]),e=e.slice(1)):r.length>0&&(n.push(r[0]),r=r.slice(1));return n}function ae(e,r,t){try{const n=e.body;if(t.length!==e.params.length)throw new Error("Invalid Parameter calls to function.");for(let a=0;a<t.length;a++)r.localScope[e.params[a].name.toLowerCase()]={value:t[a],valueset:!0,node:null};const o=S(r,n);if(o instanceof u.ReturnResult)return o.value;if(o===u.breakResult)throw new Error("Cannot Break from a Function");if(o===u.continueResult)throw new Error("Cannot Continue from a Function");return o instanceof u.ImplicitResult?o.value:o}catch(n){throw n}}function ie(e,r,t){return O(e,r,(function(r,n,o){const a={spatialReference:e.spatialReference,globalScope:e.globalScope,depthCounter:e.depthCounter+1,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{}};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return ae(t,a,o)}))}function se(e){const r=function(){const r={spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,interceptor:e.context.interceptor,localScope:{},depthCounter:e.context.depthCounter+1,globalScope:e.context.globalScope};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");return ae(e.definition,r,arguments)};return r}f.registerFunctions($,O),m.registerFunctions($,O),h.registerFunctions($,O),p.registerFunctions($,O),g.registerFunctions($,O),d.registerFunctions($,O),$.typeof=function(e,r){return O(e,r,(function(e,r,t){u.pcCheck(t,1,1);const n=ee(t[0]);if("Unrecognised Type"===n)throw new Error("Unrecognised Type");return n}))},$.iif=function(e,r){try{u.pcCheck(null===r.arguments?[]:r.arguments,3,3);const t=S(e,r.arguments[0]);if(!1===u.isBoolean(t))throw new Error("IF Function must have a boolean test condition");const n=S(e,r.arguments[1]),o=S(e,r.arguments[2]);return!0===t?n:o}catch(t){throw t}},$.decode=function(e,r){try{if(r.arguments.length<2)throw new Error("Missing Parameters");if(2===r.arguments.length)return S(e,r.arguments[1]);{if((r.arguments.length-1)%2==0)throw new Error("Must have a default value result.");const t=S(e,r.arguments[0]);return re(e,r,1,t)}}catch(t){throw t}},$.when=function(e,r){try{if(r.arguments.length<3)throw new Error("Missing Parameters");if(r.arguments.length%2==0)throw new Error("Must have a default value result.");const t=S(e,r.arguments[0]);if(!1===u.isBoolean(t))throw new Error("WHEN needs boolean test conditions");return te(e,r,0,t)}catch(t){throw t}},$.top=function(e,r){return O(e,r,(function(e,r,t){if(u.pcCheck(t,2,2),u.isArray(t[0]))return u.toNumber(t[1])>=t[0].length?t[0].slice(0):t[0].slice(0,u.toNumber(t[1]));if(u.isImmutableArray(t[0]))return u.toNumber(t[1])>=t[0].length()?t[0].slice(0):t[0].slice(0,u.toNumber(t[1]));throw new Error("Top cannot accept this parameter type")}))},$.first=function(e,r){return O(e,r,(function(e,r,t){return u.pcCheck(t,1,1),u.isArray(t[0])?0===t[0].length?null:t[0][0]:u.isImmutableArray(t[0])?0===t[0].length()?null:t[0].get(0):null}))},$.sort=function(e,r){return O(e,r,(function(e,r,t){u.pcCheck(t,1,2);let n=t[0];if(u.isImmutableArray(n)&&(n=n.toArray()),!1===u.isArray(n))throw new Error("Illegal Argument");if(t.length>1){if(!1===u.isFunctionParameter(t[1]))throw new Error("Illegal Argument");let e=n;const r=se(t[1]);return e=ne(e,(function(e,t){return r(e,t)})),e}{let e=n;if(0===e.length)return[];const r={};for(let n=0;n<e.length;n++){const t=ee(e[n]);""!==t&&(r[t]=!0)}if(!0===r.Array||!0===r.Dictionary||!0===r.Feature||!0===r.Point||!0===r.Polygon||!0===r.Polyline||!0===r.Multipoint||!0===r.Extent||!0===r.Function)return e.slice(0);let t=0,o="";for(const n in r)t++,o=n;return e=t>1||"String"===o?ne(e,(function(e,r){if(null==e||e===u.voidOperation)return null==r||r===u.voidOperation?0:1;if(null==r||r===u.voidOperation)return-1;const t=u.toString(e),n=u.toString(r);return t<n?-1:t===n?0:1})):"Number"===o?ne(e,(function(e,r){return e-r})):"Boolean"===o?ne(e,(function(e,r){return e===r?0:r?-1:1})):"Date"===o?ne(e,(function(e,r){return r-e})):e.slice(0),e}}))};for(const ye in $)$[ye]={value:new u.NativeFunction($[ye]),valueset:!0,node:null};const ue=function(){};function le(e,r){const t=new ue;e||(e={}),r||(r={});const a=new n({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});a.immutable=!1,t.textformatting={value:a,valueset:!0,node:null};for(const n in r)t[n]={value:new u.NativeFunction(r[n]),native:!0,valueset:!0,node:null};for(const n in e)e[n]&&"esri.Graphic"===e[n].declaredClass?t[n]={value:o.createFromGraphic(e[n]),valueset:!0,node:null}:t[n]={value:e[n],valueset:!0,node:null};return t}ue.prototype=$,ue.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},ue.prototype.pi={value:Math.PI,valueset:!0,node:null};const ce={fixSpatialReference:u.fixSpatialReference,parseArguments:R,standardFunction:O};function fe(e){console.log(e)}function pe(e){const r={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:O,evaluateIdentifier:J,arcadeCustomFunctionHandler:se};for(let t=0;t<e.length;t++)e[t].registerFunctions(r);for(const t in r.functions)$[t]={value:new u.NativeFunction(r.functions[t]),valueset:!0,node:null},ue.prototype[t]=$[t];for(let t=0;t<r.signatures.length;t++)l.addFunctionDeclaration(r.signatures[t],"async")}function de(e,r){let t=r.spatialReference;null==t&&(t=new b({wkid:102100}));let n=S({spatialReference:t,globalScope:le(r.vars,r.customfunctions),localScope:null,console:r.console?r.console:fe,lrucache:r.lrucache,interceptor:r.interceptor,depthCounter:1},e.body[0].body);if(n instanceof u.ReturnResult&&(n=n.value),n instanceof u.ImplicitResult&&(n=n.value),n===u.voidOperation&&(n=null),n===u.breakResult)throw new Error("Cannot return BREAK");if(n===u.continueResult)throw new Error("Cannot return CONTINUE");if(n instanceof a)throw new Error("Cannot return FUNCTION");if(n instanceof u.NativeFunction)throw new Error("Cannot return FUNCTION");return n}function he(e,r){return l.findFieldLiterals(e)}function ge(e){return l.findExpectedFieldLiterals(e)}function me(e,r){return l.validateScript(e,r,"simple")}function Ee(e,r){return l.referencesMember(e,r)}function we(e,r){return l.referencesFunction(e,r)}function Ne(e){return l.findFunctionCalls(e)}pe([c.ArrayFunctions]),e.executeScript=de,e.extend=pe,e.extractExpectedFieldLiterals=ge,e.extractFieldLiterals=he,e.findFunctionCalls=Ne,e.functionHelper=ce,e.referencesFunction=we,e.referencesMember=Ee,e.validateScript=me,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
