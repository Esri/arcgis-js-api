// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.41/esri/copyright.txt for details.

define(["require","exports","./polyfill/tsSupport/awaiter","./polyfill/tsSupport/generator","./polyfill/tsSupport/assign","./polyfill/tsSupport/spreadarray","./ArcadePortal","./Attachment","./Dictionary","./Feature","./FunctionWrapper","./ImmutablePathArray","./ImmutablePointArray","./languageUtils","./treeAnalysis","./functions/array","./functions/date","./functions/geometry","./functions/geomsync","./functions/maths","./functions/stats","./functions/string","../geometry/Extent","../geometry/Geometry","../geometry/Multipoint","../geometry/Point","../geometry/Polygon","../geometry/Polyline","../SpatialReference"],(function(e,r,t,n,o,a,i,s,u,l,c,f,p,d,h,g,m,v,E,w,N,y,I,b,R,S,O,T,M){"use strict";function F(e,r){for(var t=[],n=0;n<r.arguments.length;n++)t.push(C(e,r.arguments[n]));return t}function A(e,r,t){try{return!0===r.preparsed?t(e,null,r.arguments):t(e,r,F(e,r))}catch(e){throw e}}function C(e,r){try{switch(r.type){case"EmptyStatement":return d.voidOperation;case"VariableDeclarator":return function(e,r){var t=null===r.init?null:C(e,r.init);t===d.voidOperation&&(t=null);if("Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");var n=r.id.name.toLowerCase();null!==e.localScope?e.localScope[n]={value:t,valueset:!0,node:r.init}:e.globalScope[n]={value:t,valueset:!0,node:r.init};return d.voidOperation}(e,r);case"VariableDeclaration":return function(e,r){for(var t=0;t<r.declarations.length;t++)C(e,r.declarations[t]);return d.voidOperation}(e,r);case"BlockStatement":return function(e,r){for(var t=d.voidOperation,n=0;n<r.body.length;n++)if((t=C(e,r.body[n]))instanceof d.ReturnResult||t===d.breakResult||t===d.continueResult)return t;return t}(e,r);case"FunctionDeclaration":return function(e,r){var t=r.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new c(r,e)},d.voidOperation}(e,r);case"ReturnStatement":return function(e,r){if(null===r.argument)return new d.ReturnResult(d.voidOperation);var t=C(e,r.argument);return new d.ReturnResult(t)}(e,r);case"IfStatement":return function(e,r){if("AssignmentExpression"===r.test.type||"UpdateExpression"===r.test.type)throw new Error(h.nodeErrorMessage(r.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var t=C(e,r.test);if(!0===t)return C(e,r.consequent);if(!1===t)return null!==r.alternate?C(e,r.alternate):d.voidOperation;throw new Error(h.nodeErrorMessage(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}(e,r);case"ExpressionStatement":return function(e,r){if("AssignmentExpression"===r.expression.type||"UpdateExpression"===r.expression.type)return C(e,r.expression);if("CallExpression"===r.expression.type){return(t=C(e,r.expression))===d.voidOperation?d.voidOperation:new d.ImplicitResult(t)}var t;if((t=C(e,r.expression))===d.voidOperation)return d.voidOperation;return new d.ImplicitResult(t)}(e,r);case"AssignmentExpression":return function(e,r){var t=C(e,r.right),n=null,o="";if("MemberExpression"===r.left.type){if(n=C(e,r.left.object),!0===r.left.computed?o=C(e,r.left.property):"Identifier"===r.left.property.type&&(o=r.left.property.name),d.isArray(n)){if(!d.isNumber(o))throw new Error("Invalid Parameter");if(o<0&&(o=n.length+o),o<0||o>n.length)throw new Error("Assignment outside of array bounds");if(o===n.length){if("="!==r.operator)throw new Error("Invalid Parameter");n[o]=x(t,r.operator,n[o],r)}else n[o]=x(t,r.operator,n[o],r)}else if(n instanceof u){if(!1===d.isString(o))throw new Error("Dictionary accessor must be a string");if(!0===n.hasField(o))n.setField(o,x(t,r.operator,n.field(o),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");n.setField(o,x(t,r.operator,null,r))}}else{if(!d.isFeature(n))throw d.isImmutableArray(n)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===d.isString(o))throw new Error("Feature accessor must be a string");if(!0===n.hasField(o))n.setField(o,x(t,r.operator,n.field(o),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");n.setField(o,x(t,r.operator,null,r))}}return d.voidOperation}if(n=r.left.name.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[n])return e.localScope[n]={value:x(t,r.operator,e.localScope[n].value,r),valueset:!0,node:r.right},d.voidOperation;if(void 0!==e.globalScope[n])return e.globalScope[n]={value:x(t,r.operator,e.globalScope[n].value,r),valueset:!0,node:r.right},d.voidOperation;throw new Error("Variable not recognised")}(e,r);case"UpdateExpression":return function(e,r){var t,n=null,o="";if("MemberExpression"===r.argument.type){if(n=C(e,r.argument.object),!0===r.argument.computed?o=C(e,r.argument.property):"Identifier"===r.argument.property.type&&(o=r.argument.property.name),d.isArray(n)){if(!d.isNumber(o))throw new Error("Invalid Parameter");if(o<0&&(o=n.length+o),o<0||o>=n.length)throw new Error("Assignment outside of array bounds");t=d.toNumber(n[o]),n[o]="++"===r.operator?t+1:t-1}else if(n instanceof u){if(!1===d.isString(o))throw new Error("Dictionary accessor must be a string");if(!0!==n.hasField(o))throw new Error("Invalid Parameter");t=d.toNumber(n.field(o)),n.setField(o,"++"===r.operator?t+1:t-1)}else{if(!d.isFeature(n))throw d.isImmutableArray(n)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===d.isString(o))throw new Error("Feature accessor must be a string");if(!0!==n.hasField(o))throw new Error("Invalid Parameter");t=d.toNumber(n.field(o)),n.setField(o,"++"===r.operator?t+1:t-1)}return!1===r.prefix?t:"++"===r.operator?t+1:t-1}if(!(n="Identifier"===r.argument.type?r.argument.name.toLowerCase():""))throw new Error("Invalid identifier");if(null!==e.localScope&&void 0!==e.localScope[n])return t=d.toNumber(e.localScope[n].value),e.localScope[n]={value:"++"===r.operator?t+1:t-1,valueset:!0,node:r},!1===r.prefix?t:"++"===r.operator?t+1:t-1;if(void 0!==e.globalScope[n])return t=d.toNumber(e.globalScope[n].value),e.globalScope[n]={value:"++"===r.operator?t+1:t-1,valueset:!0,node:r},!1===r.prefix?t:"++"===r.operator?t+1:t-1;throw new Error("Variable not recognised")}(e,r);case"BreakStatement":return d.breakResult;case"ContinueStatement":return d.continueResult;case"TemplateElement":return function(e,r){return r.value?r.value.cooked:""}(0,r);case"TemplateLiteral":return function(e,r){for(var t="",n=0,o=0,a=r.quasis;o<a.length;o++){var i=a[o];if(t+=i.value?i.value.cooked:"",!1===i.tail){var s=r.expressions[n]?d.toString(C(e,r.expressions[n])):"";t+=s,n++}}return t}(e,r);case"ForStatement":return function(e,r){null!==r.init&&C(e,r.init);var t={testResult:!0,lastAction:d.voidOperation};do{U(e,r,t)}while(!0===t.testResult);if(t.lastAction instanceof d.ReturnResult)return t.lastAction;return d.voidOperation}(e,r);case"ForInStatement":return function(e,r){var t=C(e,r.right);"VariableDeclaration"===r.left.type&&C(e,r.left);var n=null,o="";if("VariableDeclaration"===r.left.type){var a=r.left.declarations[0].id;"Identifier"===a.type&&(o=a.name)}else"Identifier"===r.left.type&&(o=r.left.name);if(!o)throw new Error(h.nodeErrorMessage(r,"RUNTIME","INVALIDVARIABLE"));o=o.toLowerCase(),null!==e.localScope&&void 0!==e.localScope[o]&&(n=e.localScope[o]);null===n&&void 0!==e.globalScope[o]&&(n=e.globalScope[o]);if(null===n)throw new Error(h.nodeErrorMessage(r,"RUNTIME","VARIABLENOTDECLARED"));if(d.isArray(t)||d.isString(t)){for(var i=t.length,s=0;s<i;s++){if(n.value=s,(f=C(e,r.body))===d.breakResult)break;if(f instanceof d.ReturnResult)return f}return d.voidOperation}if(d.isImmutableArray(t)){for(s=0;s<t.length();s++){if(n.value=s,(f=C(e,r.body))===d.breakResult)break;if(f instanceof d.ReturnResult)return f}return d.voidOperation}if(!(t instanceof u||d.isFeature(t)))return d.voidOperation;for(var l=t.keys(),c=0;c<l.length;c++){var f;if(n.value=l[c],(f=C(e,r.body))===d.breakResult)break;if(f instanceof d.ReturnResult)return f}}(e,r);case"Identifier":return L(e,r);case"MemberExpression":return function(e,r){try{var t=C(e,r.object);if(null===t)throw new Error(h.nodeErrorMessage(r,"RUNTIME","NOTFOUND"));if(!1===r.computed){if("Identifier"===r.property.type){if(t instanceof u||d.isFeature(t))return t.field(r.property.name);if(t instanceof b)return D(t,r.property.name,r)}throw new Error(h.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}var n=C(e,r.property);if(t instanceof u||d.isFeature(t)){if(d.isString(n))return t.field(n);throw new Error(h.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(t instanceof b){if(d.isString(n))return D(t,n,r);throw new Error(h.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(d.isArray(t)){if(d.isNumber(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=t.length+n),n>=t.length||n<0)throw new Error(h.nodeErrorMessage(r,"RUNTIME","OUTOFBOUNDS"));return t[n]}throw new Error(h.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(d.isString(t)){if(d.isNumber(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=t.length+n),n>=t.length||n<0)throw new Error(h.nodeErrorMessage(r,"RUNTIME","OUTOFBOUNDS"));return t[n]}throw new Error(h.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}if(d.isImmutableArray(t)){if(d.isNumber(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=t.length()+n),n>=t.length()||n<0)throw new Error(h.nodeErrorMessage(r,"RUNTIME","OUTOFBOUNDS"));return t.get(n)}throw new Error(h.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}throw new Error(h.nodeErrorMessage(r,"RUNTIME","INVALIDTYPE"))}catch(e){throw e}}(e,r);case"Literal":return r.value;case"CallExpression":return function(e,r){try{if("Identifier"!==r.callee.type)throw new Error(h.nodeErrorMessage(r,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){if((t=e.localScope[r.callee.name.toLowerCase()]).value instanceof d.NativeFunction)return t.value.fn(e,r);if(t.value instanceof c)return Y(e,r,t.value.definition);throw new Error(h.nodeErrorMessage(r,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){var t;if((t=e.globalScope[r.callee.name.toLowerCase()]).value instanceof d.NativeFunction)return t.value.fn(e,r);if(t.value instanceof c)return Y(e,r,t.value.definition);throw new Error(h.nodeErrorMessage(r,"RUNTIME","NOTAFUNCTION"))}throw new Error(h.nodeErrorMessage(r,"RUNTIME","NOTFOUND"))}catch(e){throw e}}(e,r);case"UnaryExpression":return function(e,r){try{var t=C(e,r.argument);if(d.isBoolean(t)){if("!"===r.operator)return!t;if("-"===r.operator)return-1*d.toNumber(t);if("+"===r.operator)return 1*d.toNumber(t);if("~"===r.operator)return~d.toNumber(t);throw new Error(h.nodeErrorMessage(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if("~"===r.operator)return~d.toNumber(t);if("-"===r.operator)return-1*d.toNumber(t);if("+"===r.operator)return 1*d.toNumber(t);throw new Error(h.nodeErrorMessage(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}catch(e){throw e}}(e,r);case"BinaryExpression":return function(e,r){try{var t=[C(e,r.left),C(e,r.right)],n=t[0],o=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return d.binaryOperator(d.toNumber(n),d.toNumber(o),r.operator);case"==":return d.equalityTest(n,o);case"!=":return!d.equalityTest(n,o);case"<":case">":case"<=":case">=":return d.greaterThanLessThan(n,o,r.operator);case"+":return d.isString(n)||d.isString(o)?d.toString(n)+d.toString(o):d.toNumber(n)+d.toNumber(o);case"-":return d.toNumber(n)-d.toNumber(o);case"*":return d.toNumber(n)*d.toNumber(o);case"/":return d.toNumber(n)/d.toNumber(o);case"%":return d.toNumber(n)%d.toNumber(o);default:throw new Error(h.nodeErrorMessage(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}catch(e){throw e}}(e,r);case"LogicalExpression":return function(e,r){try{if("AssignmentExpression"===r.left.type||"UpdateExpression"===r.left.type)throw new Error(h.nodeErrorMessage(r.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===r.right.type||"UpdateExpression"===r.right.type)throw new Error(h.nodeErrorMessage(r.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var t=C(e,r.left);if(d.isBoolean(t))switch(r.operator){case"||":if(!0===t)return t;var n=C(e,r.right);if(d.isBoolean(n))return n;throw new Error(h.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"));case"&&":if(!1===t)return t;n=C(e,r.right);if(d.isBoolean(n))return n;throw new Error(h.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"));default:throw new Error(h.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"))}throw new Error(h.nodeErrorMessage(r,"RUNTIME","ONLYBOOLEAN"))}catch(e){throw e}}(e,r);case"ArrayExpression":return function(e,r){try{for(var t=[],n=0;n<r.elements.length;n++){var o=C(e,r.elements[n]);if(d.isFunctionParameter(o))throw new Error(h.nodeErrorMessage(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));o===d.voidOperation?t.push(null):t.push(o)}return t}catch(e){throw e}}(e,r);case"ObjectExpression":return function(e,r){for(var t={},n=0;n<r.properties.length;n++){var o=C(e,r.properties[n]);if(d.isFunctionParameter(o.value))throw new Error("Illegal Argument");if(!1===d.isString(o.key))throw new Error("Illegal Argument");o.value===d.voidOperation?t[o.key.toString()]=null:t[o.key.toString()]=o.value}var a=new u(t);return a.immutable=!1,a}(e,r);case"Property":return function(e,r){return{key:"Identifier"===r.key.type?r.key.name:C(e,r.key),value:C(e,r.value)}}(e,r);default:throw new Error(h.nodeErrorMessage(r,"RUNTIME","UNREOGNISED"))}}catch(e){throw e}}function U(e,r,t){if(null!==r.test){if(t.testResult=C(e,r.test),!1===t.testResult)return;if(!0!==t.testResult)throw new Error(h.nodeErrorMessage(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}t.lastAction=C(e,r.body),t.lastAction!==d.breakResult?t.lastAction instanceof d.ReturnResult?t.testResult=!1:null!==r.update&&C(e,r.update):t.testResult=!1}function x(e,r,t,n){switch(r){case"=":return e===d.voidOperation?null:e;case"/=":return d.toNumber(t)/d.toNumber(e);case"*=":return d.toNumber(t)*d.toNumber(e);case"-=":return d.toNumber(t)-d.toNumber(e);case"+=":return d.isString(t)||d.isString(e)?d.toString(t)+d.toString(e):d.toNumber(t)+d.toNumber(e);case"%=":return d.toNumber(t)%d.toNumber(e);default:throw new Error(h.nodeErrorMessage(n,"RUNTIME","OPERATORNOTRECOGNISED"))}}Object.defineProperty(r,"__esModule",{value:!0}),r.findFunctionCalls=r.referencesFunction=r.referencesMember=r.validateScript=r.extractExpectedFieldLiterals=r.extractFieldLiterals=r.executeScript=r.extend=r.functionHelper=void 0;var P=0;function D(e,r,t){var n;switch(r=r.toLowerCase()){case"hasz":var o=e.hasZ;return void 0!==o&&o;case"hasm":var a=e.hasM;return void 0!==a&&a;case"spatialreference":var i=e.spatialReference._arcadeCacheId;if(void 0===i){var s=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(s=!1),s&&(P++,e.spatialReference._arcadeCacheId=P,i=P)}var l=new u({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==i&&(l._arcadeCacheId="SPREF"+i.toString()),l}switch(e.type){case"extent":switch(r){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":var c=e[r];return void 0!==c?c:null;case"type":return"Extent"}break;case"polygon":switch(r){case"rings":return void 0===(n=e.getCacheValue("_arcadeCacheId"))&&(n=++P,e.setCacheValue("_arcadeCacheId",n)),new f(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,n);case"type":return"Polygon"}break;case"point":switch(r){case"x":case"y":case"z":case"m":return void 0!==e[r]?e[r]:null;case"type":return"Point"}break;case"polyline":switch(r){case"paths":return void 0===(n=e.getCacheValue("_arcadeCacheId"))&&(n=++P,e.setCacheValue("_arcadeCacheId",n)),new f(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,n);case"type":return"Polyline"}break;case"multipoint":switch(r){case"points":return void 0===(n=e.getCacheValue("_arcadeCacheId"))&&(n=++P,e.setCacheValue("_arcadeCacheId",n)),new p(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,n,1);case"type":return"Multipoint"}}throw new Error(h.nodeErrorMessage(t,"RUNTIME","PROPERTYNOTFOUND"))}function L(e,r){var t;try{var n=r.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[n])return!0===(t=e.localScope[n]).valueset?t.value:(t.value=C(e,t.node),t.valueset=!0,t.value);if(void 0!==e.globalScope[n])return!0===(t=e.globalScope[n]).valueset?t.value:(t.value=C(e,t.node),t.valueset=!0,t.value);throw new Error(h.nodeErrorMessage(r,"RUNTIME","VARIABLENOTFOUND"))}catch(e){throw e}}var k={};function _(e){return null==e?"":d.isArray(e)?"Array":d.isImmutableArray(e)?"Array":d.isDate(e)?"Date":d.isString(e)?"String":d.isBoolean(e)?"Boolean":d.isNumber(e)?"Number":e instanceof s?"Attachment":e instanceof i?"Portal":e instanceof u?"Dictionary":d.isFeature(e)?"Feature":e instanceof S?"Point":e instanceof O?"Polygon":e instanceof T?"Polyline":e instanceof R?"Multipoint":e instanceof I?"Extent":d.isFunctionParameter(e)?"Function":d.isFeatureSet(e)?"FeatureSet":d.isFeatureSetCollection(e)?"FeatureSetCollection":e===d.voidOperation?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function B(e,r){var t=e.length,n=Math.floor(t/2);return 0===t?[]:1===t?[e[0]]:function(e,r,t){var n=[];for(;e.length>0||r.length>0;)if(e.length>0&&r.length>0){var o=t(e[0],r[0]);isNaN(o)&&(o=0),o<=0?(n.push(e[0]),e=e.slice(1)):(n.push(r[0]),r=r.slice(1))}else e.length>0?(n.push(e[0]),e=e.slice(1)):r.length>0&&(n.push(r[0]),r=r.slice(1));return n}(B(e.slice(0,n),r),B(e.slice(n,t),r),r)}function V(e,r,t){try{var n=e.body;if(t.length!==e.params.length)throw new Error("Invalid Parameter calls to function.");for(var o=0;o<t.length;o++)r.localScope[e.params[o].name.toLowerCase()]={value:t[o],valueset:!0,node:null};var a=C(r,n);if(a instanceof d.ReturnResult)return a.value;if(a===d.breakResult)throw new Error("Cannot Break from a Function");if(a===d.continueResult)throw new Error("Cannot Continue from a Function");return a instanceof d.ImplicitResult?a.value:a}catch(e){throw e}}function Y(e,r,t){return A(e,r,(function(r,n,o){var a={spatialReference:e.spatialReference,globalScope:e.globalScope,depthCounter:e.depthCounter+1,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{}};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return V(t,a,o)}))}function G(e){return function(){var r={spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,interceptor:e.context.interceptor,localScope:{},depthCounter:e.context.depthCounter+1,globalScope:e.context.globalScope};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");return V(e.definition,r,arguments)}}for(var q in m.registerFunctions(k,A),y.registerFunctions(k,A),w.registerFunctions(k,A),v.registerFunctions(k,A),N.registerFunctions(k,A),E.registerFunctions(k,A),k.typeof=function(e,r){return A(e,r,(function(e,r,t){d.pcCheck(t,1,1);var n=_(t[0]);if("Unrecognised Type"===n)throw new Error("Unrecognised Type");return n}))},k.iif=function(e,r){try{d.pcCheck(null===r.arguments?[]:r.arguments,3,3);var t=C(e,r.arguments[0]);if(!1===d.isBoolean(t))throw new Error("IF Function must have a boolean test condition");var n=C(e,r.arguments[1]),o=C(e,r.arguments[2]);return!0===t?n:o}catch(e){throw e}},k.decode=function(e,r){try{if(r.arguments.length<2)throw new Error("Missing Parameters");if(2===r.arguments.length)return C(e,r.arguments[1]);if((r.arguments.length-1)%2==0)throw new Error("Must have a default value result.");var t=C(e,r.arguments[0]);return function e(r,t,n,o){try{var a=C(r,t.arguments[n]);if(d.equalityTest(a,o))return C(r,t.arguments[n+1]);var i=t.arguments.length-n;return 1===i?C(r,t.arguments[n]):2===i?null:3===i?C(r,t.arguments[n+2]):e(r,t,n+2,o)}catch(e){throw e}}(e,r,1,t)}catch(e){throw e}},k.when=function(e,r){try{if(r.arguments.length<3)throw new Error("Missing Parameters");if(r.arguments.length%2==0)throw new Error("Must have a default value result.");var t=C(e,r.arguments[0]);if(!1===d.isBoolean(t))throw new Error("WHEN needs boolean test conditions");return function e(r,t,n,o){try{if(!0===o)return C(r,t.arguments[n+1]);if(3===t.arguments.length-n)return C(r,t.arguments[n+2]);var a=C(r,t.arguments[n+2]);if(!1===d.isBoolean(a))throw new Error("WHEN needs boolean test conditions");return e(r,t,n+2,a)}catch(e){throw e}}(e,r,0,t)}catch(e){throw e}},k.top=function(e,r){return A(e,r,(function(e,r,t){if(d.pcCheck(t,2,2),d.isArray(t[0]))return d.toNumber(t[1])>=t[0].length?t[0].slice(0):t[0].slice(0,d.toNumber(t[1]));if(d.isImmutableArray(t[0]))return d.toNumber(t[1])>=t[0].length()?t[0].slice(0):t[0].slice(0,d.toNumber(t[1]));throw new Error("Top cannot accept this parameter type")}))},k.first=function(e,r){return A(e,r,(function(e,r,t){return d.pcCheck(t,1,1),d.isArray(t[0])?0===t[0].length?null:t[0][0]:d.isImmutableArray(t[0])?0===t[0].length()?null:t[0].get(0):null}))},k.sort=function(e,r){return A(e,r,(function(e,r,t){d.pcCheck(t,1,2);var n=t[0];if(d.isImmutableArray(n)&&(n=n.toArray()),!1===d.isArray(n))throw new Error("Illegal Argument");if(t.length>1){if(!1===d.isFunctionParameter(t[1]))throw new Error("Illegal Argument");var o=n,a=G(t[1]);return o=B(o,(function(e,r){return a(e,r)}))}if(0===(o=n).length)return[];for(var i={},s=0;s<o.length;s++){var u=_(o[s]);""!==u&&(i[u]=!0)}if(!0===i.Array||!0===i.Dictionary||!0===i.Feature||!0===i.Point||!0===i.Polygon||!0===i.Polyline||!0===i.Multipoint||!0===i.Extent||!0===i.Function)return o.slice(0);var l=0,c="";for(var f in i)l++,c=f;return o=l>1||"String"===c?B(o,(function(e,r){if(null==e||e===d.voidOperation)return null==r||r===d.voidOperation?0:1;if(null==r||r===d.voidOperation)return-1;var t=d.toString(e),n=d.toString(r);return t<n?-1:t===n?0:1})):"Number"===c?B(o,(function(e,r){return e-r})):"Boolean"===c?B(o,(function(e,r){return e===r?0:r?-1:1})):"Date"===c?B(o,(function(e,r){return r-e})):o.slice(0)}))},k)k[q]={value:new d.NativeFunction(k[q]),valueset:!0,node:null};var j=function(){};(j.prototype=k).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},j.prototype.pi={value:Math.PI,valueset:!0,node:null};var z={fixSpatialReference:d.fixSpatialReference,parseArguments:F,standardFunction:A};function H(e){console.log(e)}function Z(e){for(var r={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:A,evaluateIdentifier:L,arcadeCustomFunctionHandler:G},t=0;t<e.length;t++)e[t].registerFunctions(r);for(var n in r.functions)k[n]={value:new d.NativeFunction(r.functions[n]),valueset:!0,node:null},j.prototype[n]=k[n];for(t=0;t<r.signatures.length;t++)h.addFunctionDeclaration(r.signatures[t],"async")}r.functionHelper=z,r.extend=Z,Z([g]),r.executeScript=function(e,r){var t=r.spatialReference;null==t&&(t=new M({wkid:102100}));var n=C({spatialReference:t,globalScope:function(e,r){var t=new j;e||(e={}),r||(r={});var n=new u({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});for(var o in n.immutable=!1,t.textformatting={value:n,valueset:!0,node:null},r)t[o]={value:new d.NativeFunction(r[o]),native:!0,valueset:!0,node:null};for(var o in e)e[o]&&"esri.Graphic"===e[o].declaredClass?t[o]={value:l.createFromGraphic(e[o]),valueset:!0,node:null}:t[o]={value:e[o],valueset:!0,node:null};return t}(r.vars,r.customfunctions),localScope:null,console:r.console?r.console:H,lrucache:r.lrucache,interceptor:r.interceptor,depthCounter:1},e.body[0].body);if(n instanceof d.ReturnResult&&(n=n.value),n instanceof d.ImplicitResult&&(n=n.value),n===d.voidOperation&&(n=null),n===d.breakResult)throw new Error("Cannot return BREAK");if(n===d.continueResult)throw new Error("Cannot return CONTINUE");if(n instanceof c)throw new Error("Cannot return FUNCTION");if(n instanceof d.NativeFunction)throw new Error("Cannot return FUNCTION");return n},r.extractFieldLiterals=function(e,r){return void 0===r&&(r=!1),h.findFieldLiterals(e)},r.extractExpectedFieldLiterals=function(e){return h.findExpectedFieldLiterals(e)},r.validateScript=function(e,r){return h.validateScript(e,r,"simple")},r.referencesMember=function(e,r){return h.referencesMember(e,r)},r.referencesFunction=function(e,r){return h.referencesFunction(e,r)},r.findFunctionCalls=function(e){return h.findFunctionCalls(e)}}));