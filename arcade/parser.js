/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","./treeAnalysis","./lib/esprima"],(function(e,n,r){"use strict";e.extractFieldLiterals=function(e,r){return n.findFieldLiterals(e)},e.parseScript=function(e,t=[]){const o=r.parse("function _() { "+e+"\n}");if(null===o.body||void 0===o.body)throw new Error("No formula provided.");if(0===o.body.length)throw new Error("No formula provided.");if(0===o.body.length)throw new Error("No formula provided.");if("BlockStatement"!==o.body[0].body.type)throw new Error("Invalid formula content.");const i=n.validateLanguage(o);if(""!==i)throw new Error(i);return n.findScriptDependencies(o,t),o},e.referencesFunction=function(e,r){return n.referencesFunction(e,r)},e.referencesMember=function(e,r){return n.referencesMember(e,r)},e.scriptCheck=function(e,t,o,i,c){const l=[],a="function _() { \n".length-1,s="function _() { \n"+e+"\n}";try{const e=r.parse(s,{tolerant:!0,loc:!0,range:!0}),u=e.errors;if(u.length>0)for(let e=0;e<u.length;e++)l.push({line:u[e].lineNumber-2,character:u[e].column,reason:u[e].description});const d=n.checkScript(e,t,o,i,c);for(let e=0;e<d.length;e++)d[e].line=d[e].line-2,d[e].range&&(d[e].range=[d[e][0]-a,d[e][1]-a]),d[e].loc&&(d[e].loc.start.line=d[e].loc.start.line-2,d[e].loc.end.line=d[e].loc.end.line-2),l.push(d[e])}catch(e){try{if("Unexpected token }"===e.description){const n=s.split("\n").length;e.lineNumber===n?(e.index=s.length-1,l.push({line:e.lineNumber-4,character:e.column,reason:"Unexpected end of script"})):(e.index=s.length-1,l.push({line:e.lineNumber-2,character:e.column,reason:"Unexpected end of script"}))}else l.push({line:e.lineNumber-2,character:e.column,reason:e.description})}catch(e){}}return l},e.validateScript=function(e,r,t){return n.validateScript(e,r,t)},Object.defineProperty(e,"__esModule",{value:!0})}));
