/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","./treeAnalysis","./lib/arcade-parser"],(function(e,n,r){"use strict";function t(e,t=[]){const i=r.parse("function _() { "+e+"\n}");if(null===i.body||void 0===i.body)throw new Error("No formula provided.");if(0===i.body.length)throw new Error("No formula provided.");if(0===i.body.length)throw new Error("No formula provided.");if("BlockStatement"!==i.body[0].body.type)throw new Error("Invalid formula content.");const o=n.validateLanguage(i);if(""!==o)throw new Error(o);return n.findScriptDependencies(i,t),i}function i(e,t,i,o,c){const l=[],a="function _() { \n".length-1,s="function _() { \n"+e+"\n}";try{const e=r.parse(s,{tolerant:!0,loc:!0,range:!0}),d=e.errors;if(d.length>0)for(let n=0;n<d.length;n++)l.push({line:d[n].lineNumber-2,character:d[n].column,reason:d[n].description});const u=n.checkScript(e,t,i,o,c);for(let n=0;n<u.length;n++)u[n].line=u[n].line-2,u[n].range&&(u[n].range=[u[n][0]-a,u[n][1]-a]),u[n].loc&&(u[n].loc.start.line=u[n].loc.start.line-2,u[n].loc.end.line=u[n].loc.end.line-2),l.push(u[n])}catch(d){try{if("Unexpected token }"===d.description){const e=s.split("\n").length;d.lineNumber===e?(d.index=s.length-1,l.push({line:d.lineNumber-4,character:d.column,reason:"Unexpected end of script"})):(d.index=s.length-1,l.push({line:d.lineNumber-2,character:d.column,reason:"Unexpected end of script"}))}else l.push({line:d.lineNumber-2,character:d.column,reason:d.description})}catch(u){}}return l}function o(e,r){return n.findFieldLiterals(e)}function c(e,r,t){return n.validateScript(e,r,t)}function l(e){return n.findExpectedFieldLiterals(e)}function a(e,r){return n.referencesMember(e,r)}function s(e,r){return n.referencesFunction(e,r)}e.extractExpectedFieldLiterals=l,e.extractFieldLiterals=o,e.parseScript=t,e.referencesFunction=s,e.referencesMember=a,e.scriptCheck=i,e.validateScript=c,Object.defineProperty(e,"__esModule",{value:!0})}));
