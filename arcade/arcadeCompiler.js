// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.41/esri/copyright.txt for details.

define(["require","exports","./polyfill/tsSupport/awaiter","./polyfill/tsSupport/generator","./polyfill/tsSupport/assign","./polyfill/tsSupport/spreadarray","./ArcadePortal","./Attachment","./Dictionary","./Feature","./ImmutablePathArray","./ImmutablePointArray","./languageUtils","./treeAnalysis","./functions/array","./functions/date","./functions/geometry","./functions/geomsync","./functions/maths","./functions/stats","./functions/string","./polyfill/promiseUtils","../geometry/Extent","../geometry/Geometry","../geometry/Multipoint","../geometry/Point","../geometry/Polygon","../geometry/Polyline","../SpatialReference"],(function(e,r,t,n,o,a,i,l,s,c,u,p,f,g,m,h,d,y,b,S,v,E,w,N,M,O,I,x,T){"use strict";function C(e,r,t){try{return t(e,null,r.arguments)}catch(e){throw e}}function R(e,r){try{switch(r.type){case"EmptyStatement":return"lc.voidOperation";case"VariableDeclarator":return function(e,r){var t=null===r.init?null:R(e,r.init);t===f.voidOperation&&(t=null);var n=r.id.name.toLowerCase();if(null!==e.localScope){if(void 0!==e.localScope[n])return"lscope['"+n+"']="+t+"; ";if(void 0!==e.localScope._SymbolsMap[n])return"lscope['"+e.localScope._SymbolsMap[n]+"']="+t+"; ";var o=L(e);return e.localScope._SymbolsMap[n]=o,e.mangleMap[n]=o,"lscope['"+o+"']="+t+"; "}if(void 0!==e.globalScope[n])return"gscope['"+n+"']="+t+"; ";if(void 0!==e.globalScope._SymbolsMap[n])return"gscope['"+e.globalScope._SymbolsMap[n]+"']="+t+"; ";o=L(e);return e.globalScope._SymbolsMap[n]=o,e.mangleMap[n]=o,"gscope['"+o+"']="+t+"; "}(e,r);case"VariableDeclaration":return function(e,r){for(var t=[],n=0;n<r.declarations.length;n++)t.push(R(e,r.declarations[n]));return t.join("\n")+" \n lastStatement=  lc.voidOperation; \n"}(e,r);case"BlockStatement":return A(e,r);case"FunctionDeclaration":return function(e,r){var t=r.id.name.toLowerCase(),n={isAsync:e.isAsync,spatialReference:e.spatialReference,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,services:e.services,symbols:e.symbols,mangleMap:e.mangleMap,localScope:{_SymbolsMap:{}},depthCounter:e.depthCounter+1,globalScope:e.globalScope};if(n.depthCounter>64)throw new Error("Exceeded maximum function depth");for(var o="new lc.SizzleFunction( lang.functionDepthchecker(function() { var lastStatement = lc.voidOperation; \n   var lscope = runtimeCtx.localStack[runtimeCtx.localStack.length-1];\n",a=0;a<r.params.length;a++){var i=r.params[a].name.toLowerCase(),l=L(e);n.localScope._SymbolsMap[i]=l,n.mangleMap[i]=l,o+="lscope['"+l+"']=arguments["+a.toString()+"];\n"}!0===e.isAsync?(o+="return lang.__awaiter(this, void 0, void 0, function* () {\n",o+=A(n,r.body)+"\n return lastStatement; ",o+="});  }",o+=", runtimeCtx),"+r.params.length+")",o+="\n lastStatement = lc.voidOperation; \n"):(o+=A(n,r.body)+"\n return lastStatement; }, runtimeCtx),"+r.params.length+")",o+="\n lastStatement = lc.voidOperation; \n");if(void 0!==e.globalScope[t])return"gscope['"+t+"']="+o;if(void 0!==e.globalScope._SymbolsMap[t])return"gscope['"+e.globalScope._SymbolsMap[t]+"']="+o;l=L(e);return e.globalScope._SymbolsMap[t]=l,e.mangleMap[t]=l,"gscope['"+l+"']="+o}(e,r);case"ReturnStatement":return function(e,r){if(null===r.argument)return"return lc.voidOperation";return"return "+R(e,r.argument)}(e,r);case"IfStatement":return function(e,r){if("AssignmentExpression"===r.test.type||"UpdateExpression"===r.test.type)throw new Error(g.nodeErrorMessage(r.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var t=R(e,r.test),n=B(e),o="var "+n+" = "+t+";\n if ("+n+" === true) {\n"+F(e,r.consequent)+"\n }\n";null!==r.alternate?o+="else if ("+n+"===false)   { \n"+F(e,r.alternate)+"}\n":o+="else if ("+n+"===false) { \n lastStatement = lc.voidOperation;\n }\n";return o+="else { lang.error({type: '"+r.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION'); \n}\n"}(e,r);case"ExpressionStatement":return function(e,r){if("AssignmentExpression"===r.expression.type)return"lastStatement = lc.voidOperation; "+R(e,r.expression)+"; \n ";if("CallExpression"===r.expression.type)return"lastStatement = "+R(e,r.expression)+"; ";return"lastStatement = "+R(e,r.expression)+"; "}(e,r);case"AssignmentExpression":return function(e,r){var t=R(e,r.right),n=null,o="";if("MemberExpression"===r.left.type)return n=R(e,r.left.object),o=!0===r.left.computed?R(e,r.left.property):"'"+r.left.property.name+"'","lang.assignmember("+n+","+o+",'"+r.operator+"',"+t+")";if(n=r.left.name.toLowerCase(),null!==e.localScope){if(void 0!==e.localScope[n])return"lscope['"+n+"']=lang.assign("+t+",'"+r.operator+"', lscope['"+n+"'])";if(void 0!==e.localScope._SymbolsMap[n])return"lscope['"+e.localScope._SymbolsMap[n]+"']=lang.assign("+t+",'"+r.operator+"', lscope['"+e.localScope._SymbolsMap[n]+"'])"}if(void 0!==e.globalScope[n])return"gscope['"+n+"']=lang.assign("+t+",'"+r.operator+"', gscope['"+n+"'])";if(void 0!==e.globalScope._SymbolsMap[n])return"gscope['"+e.globalScope._SymbolsMap[n]+"']=lang.assign("+t+",'"+r.operator+"', gscope['"+e.globalScope._SymbolsMap[n]+"'])";throw new Error("Variable not recognised")}(e,r);case"UpdateExpression":return function(e,r){var t=null,n="";if("MemberExpression"===r.argument.type)return t=R(e,r.argument.object),n=!0===r.argument.computed?R(e,r.argument.property):"'"+r.argument.property.name+"'","lang.memberupdate("+t+","+n+",'"+r.operator+"',"+r.prefix+")";if(t=r.argument.name.toLowerCase(),null!==e.localScope){if(void 0!==e.localScope[t])return"lang.update(lscope, '"+t+"','"+r.operator+"',"+r.prefix+")";if(void 0!==e.localScope._SymbolsMap[t])return"lang.update(lscope, '"+e.localScope._SymbolsMap[t]+"','"+r.operator+"',"+r.prefix+")"}if(void 0!==e.globalScope[t])return"lang.update(gscope, '"+t+"','"+r.operator+"',"+r.prefix+")";if(void 0!==e.globalScope._SymbolsMap[t])return"lang.update(gscope, '"+e.globalScope._SymbolsMap[t]+"','"+r.operator+"',"+r.prefix+")";throw new Error("Variable not recognised")}(e,r);case"BreakStatement":return"break";case"ContinueStatement":return"continue";case"TemplateLiteral":return function(e,r){try{for(var t=[],n=0,o=0,a=r.quasis;o<a.length;o++){var i=a[o];t.push(i.value?JSON.stringify(i.value.cooked):JSON.stringify("")),!1===i.tail&&(t.push(r.expressions[n]?"lang.castString(lang.aCheck("+R(e,r.expressions[n])+", 'TemplateLiteral'))":""),n++)}return"(["+t.join(",")+"]).join('')"}catch(e){throw e}}(e,r);case"TemplateElement":return JSON.stringify(r.value?r.value.cooked:"");case"ForStatement":return function(e,r){var t="lastStatement = lc.voidOperation; \n";null!==r.init&&(t+=R(e,r.init)+"; ");var n=B(e),o=B(e);t+="var "+n+" = true; ",t+="\n do { ",null!==r.update&&(t+=" if ("+n+"===false) {\n "+R(e,r.update)+"  \n}\n "+n+"=false; \n");null!==r.test&&(t+="var "+o+" = "+R(e,r.test)+"; ",t+="if ("+o+"===false) { break; } else if ("+o+"!==true) { lang.error({type: '"+r.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION');   }\n");t+=R(e,r.body),null!==r.update&&(t+="\n "+R(e,r.update));return t+="\n"+n+" = true; \n} while(true);  lastStatement = lc.voidOperation; "}(e,r);case"ForInStatement":return function(e,r){var t=B(e),n=B(e),o=B(e),a="var "+t+" = "+R(e,r.right)+";\n";"VariableDeclaration"===r.left.type&&(a+=R(e,r.left));var i="VariableDeclaration"===r.left.type?r.left.declarations[0].id.name:r.left.name;i=i.toLowerCase();var l="";null!==e.localScope&&(void 0!==e.localScope[i]?l="lscope['"+i+"']":void 0!==e.localScope._SymbolsMap[i]&&(l="lscope['"+e.localScope._SymbolsMap[i]+"']"));""===l&&(void 0!==e.globalScope[i]?l="gscope['"+i+"']":void 0!==e.globalScope._SymbolsMap[i]&&(l="gscope['"+e.globalScope._SymbolsMap[i]+"']"));a+="if ("+t+"===null) {  lastStatement = lc.voidOperation; }\n ",a+="else if (lc.isArray("+t+") || lc.isString("+t+")) {",a+="var "+n+"="+t+".length; \n",a+="for(var "+o+"=0; "+o+"<"+n+"; "+o+"++) {\n",a+=l+"="+o+";\n",a+=R(e,r.body),a+="\n}\n",a+=" lastStatement = lc.voidOperation; \n",a+=" \n}\n",a+="else if (lc.isImmutableArray("+t+")) {",a+="var "+n+"="+t+".length(); \n",a+="for(var "+o+"=0; "+o+"<"+n+"; "+o+"++) {\n",a+=l+"="+o+";\n",a+=R(e,r.body),a+="\n}\n",a+=" lastStatement = lc.voidOperation; \n",a+=" \n}\n",a+="else if (( "+t+" instanceof lang.Dictionary) || ( "+t+" instanceof lang.Feature)) {",a+="var "+n+"="+t+".keys(); \n",a+="for(var "+o+"=0; "+o+"<"+n+".length; "+o+"++) {\n",a+=l+"="+n+"["+o+"];\n",a+=R(e,r.body),a+="\n}\n",a+=" lastStatement = lc.voidOperation; \n",a+=" \n}\n",e.isAsync&&(a+="else if (lc.isFeatureSet("+t+")) {",a+="var "+n+"="+t+".iterator(runtimeCtx.abortSignal); \n",a+="for(var "+o+"=lang. graphicToFeature( yield "+n+".next(),"+t+"); "+o+"!=null; "+o+"=lang. graphicToFeature( yield "+n+".next(),"+t+")) {\n",a+=l+"="+o+";\n",a+=R(e,r.body),a+="\n}\n",a+=" lastStatement = lc.voidOperation; \n",a+=" \n}\n");return a+="else { lastStatement = lc.voidOperation; } \n"}(e,r);case"Identifier":return function(e,r){try{var t=r.name.toLowerCase();if(null!==e.localScope){if(void 0!==e.localScope[t])return"lscope['"+t+"']";if(void 0!==e.localScope._SymbolsMap[t])return"lscope['"+e.localScope._SymbolsMap[t]+"']"}if(void 0!==e.globalScope[t])return"gscope['"+t+"']";if(void 0!==e.globalScope._SymbolsMap[t])return"gscope['"+e.globalScope._SymbolsMap[t]+"']";throw new Error(g.nodeErrorMessage(r,"RUNTIME","VARIABLENOTFOUND"))}catch(e){throw e}}(e,r);case"MemberExpression":return function(e,r){try{var t=void 0;return t=!0===r.computed?R(e,r.property):"'"+r.property.name+"'","lang.member("+R(e,r.object)+","+t+")"}catch(e){throw e}}(e,r);case"Literal":return null===r.value||void 0===r.value?"null":JSON.stringify(r.value);case"ThisExpression":throw new Error(g.nodeErrorMessage(r,"RUNTIME","NOTSUPPORTED"));case"CallExpression":return function(e,r){try{if("Identifier"!==r.callee.type)throw new Error(g.nodeErrorMessage(r,"RUNTIME","ONLYNODESSUPPORTED"));var t=r.callee.name.toLowerCase(),n="";if(null!==e.localScope&&(void 0!==e.localScope[t]?n="lscope['"+t+"']":void 0!==e.localScope._SymbolsMap[t]&&(n="lscope['"+e.localScope._SymbolsMap[t]+"']")),""===n&&(void 0!==e.globalScope[t]?n="gscope['"+t+"']":void 0!==e.globalScope._SymbolsMap[t]&&(n="gscope['"+e.globalScope._SymbolsMap[t]+"']")),""!==n){for(var o="[",a=0;a<r.arguments.length;a++)a>0&&(o+=", "),o+=R(e,r.arguments[a]);return o+="]",e.isAsync?"(yield lang.callfunc("+n+","+o+",runtimeCtx) )":"lang.callfunc("+n+","+o+",runtimeCtx)"}throw new Error(g.nodeErrorMessage(r,"RUNTIME","NOTFOUND"))}catch(e){throw e}}(e,r);case"UnaryExpression":return function(e,r){try{return"lang.unary("+R(e,r.argument)+",'"+r.operator+"')"}catch(e){throw e}}(e,r);case"BinaryExpression":return function(e,r){try{return"lang.binary("+R(e,r.left)+","+R(e,r.right)+",'"+r.operator+"')"}catch(e){throw e}}(e,r);case"LogicalExpression":return function(e,r){try{if("AssignmentExpression"===r.left.type||"UpdateExpression"===r.left.type)throw new Error(g.nodeErrorMessage(r.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===r.right.type||"UpdateExpression"===r.right.type)throw new Error(g.nodeErrorMessage(r.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("&&"===r.operator||"||"===r.operator)return"(lang.logicalCheck("+R(e,r.left)+") "+r.operator+" lang.logicalCheck("+R(e,r.right)+"))";throw new Error(g.nodeErrorMessage(r,"RUNTIME","ONLYORORAND"))}catch(e){throw e}}(e,r);case"ConditionalExpression":throw new Error(g.nodeErrorMessage(r,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":return function(e,r){try{for(var t=[],n=0;n<r.elements.length;n++)"Literal"===r.elements[n].type?t.push(R(e,r.elements[n])):t.push("lang.aCheck("+R(e,r.elements[n])+",'ArrayExpression')");return"["+t.join(",")+"]"}catch(e){throw e}}(e,r);case"ObjectExpression":return function(e,r){for(var t="lang.dictionary([",n=0;n<r.properties.length;n++){var o=r.properties[n],a="Identifier"===o.key.type?"'"+o.key.name+"'":R(e,o.key),i=R(e,o.value);n>0&&(t+=","),t+="lang.strCheck("+a+",'ObjectExpression'),lang.aCheck("+i+", 'ObjectExpression')"}return t+="])"}(e,r);case"Property":return function(e,r){throw new Error("Should not get here")}();case"Array":throw new Error(g.nodeErrorMessage(r,"RUNTIME","NOTSUPPORTED"));default:throw new Error(g.nodeErrorMessage(r,"RUNTIME","UNREOGNISED"))}}catch(e){throw e}}function F(e,r){return"BlockStatement"===r.type?R(e,r):"ReturnStatement"===r.type?R(e,r)+"; ":"BreakStatement"===r.type?R(e,r)+"; ":"ContinueStatement"===r.type?R(e,r)+"; ":"UpdateExpression"===r.type?"lastStatement = "+R(e,r)+"; ":"ExpressionStatement"===r.type?R(e,r):"ObjectExpression"===r.type?"lastStatement = "+R(e,r)+"; ":R(e,r)+"; "}function A(e,r){for(var t="",n=0;n<r.body.length;n++)"ReturnStatement"===r.body[n].type?t+=R(e,r.body[n])+"; \n":"BreakStatement"===r.body[n].type?t+=R(e,r.body[n])+"; \n":"ContinueStatement"===r.body[n].type?t+=R(e,r.body[n])+"; \n":"UpdateExpression"===r.body[n].type?t+="lastStatement = "+R(e,r.body[n])+"; \n":"ObjectExpression"===r.body[n].type?t+="lastStatement = "+R(e,r.body[n])+"; \n":t+=R(e,r.body[n])+" \n";return t}Object.defineProperty(r,"__esModule",{value:!0}),r.enableAsyncSupport=r.compileScript=r.referencesFunction=r.referencesMember=r.validateScript=r.extractExpectedFieldLiterals=r.extractFieldLiterals=r.executeScript=r.extend=r.functionHelper=void 0;var _=0;var U={};function P(e){return null===e?"":f.isArray(e)?"Array":f.isImmutableArray(e)?"Array":f.isDate(e)?"Date":f.isString(e)?"String":f.isBoolean(e)?"Boolean":f.isNumber(e)?"Number":e instanceof l?"Attachment":e instanceof i?"Portal":e instanceof s?"Dictionary":f.isFeature(e)?"Feature":e instanceof O?"Point":e instanceof I?"Polygon":e instanceof x?"Polyline":e instanceof M?"Multipoint":e instanceof w?"Extent":f.isFunctionParameter(e)?"Function":f.isFeatureSet(e)?"FeatureSet":f.isFeatureSetCollection(e)?"FeatureSetCollection":e===f.voidOperation?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function k(e,r){var t=e.length,n=Math.floor(t/2);return 0===t?[]:1===t?[e[0]]:function(e,r,t){var n=[];for(;e.length>0||r.length>0;)if(e.length>0&&r.length>0){var o=t(e[0],r[0]);isNaN(o)&&(o=0),o<=0?(n.push(e[0]),e=e.slice(1)):(n.push(r[0]),r=r.slice(1))}else e.length>0?(n.push(e[0]),e=e.slice(1)):r.length>0&&(n.push(r[0]),r=r.slice(1));return n}(k(e.slice(0,n),r),k(e.slice(n,t),r),r)}function D(e,r,o,a){return t(this,void 0,void 0,(function(){var t,i;return n(this,(function(n){switch(n.label){case 0:return t=a,e.length>0||r.length>0?e.length>0&&r.length>0?[4,o(e[0],r[0])]:[3,2]:[3,4];case 1:return i=n.sent(),isNaN(i)&&(i=1),i<=0?(t.push(e[0]),e=e.slice(1)):(t.push(r[0]),r=r.slice(1)),[2,D(e,r,o,a)];case 2:if(e.length>0)return t.push(e[0]),[2,D(e=e.slice(1),r,o,a)];if(r.length>0)return t.push(r[0]),r=r.slice(1),[2,D(e,r,o,a)];n.label=3;case 3:return[3,5];case 4:return[2,a];case 5:return[2]}}))}))}function L(e){return e.symbols.symbolCounter++,"_T"+e.symbols.symbolCounter.toString()}function B(e){return e.symbols.symbolCounter++,"_Tvar"+e.symbols.symbolCounter.toString()}h.registerFunctions(U,C),v.registerFunctions(U,C),b.registerFunctions(U,C),d.registerFunctions(U,C),S.registerFunctions(U,C),U.typeof=function(e,r){return C(e,r,(function(e,r,t){f.pcCheck(t,1,1);var n=P(t[0]);if("Unrecognised Type"===n)throw new Error("Unrecognised Type");return n}))},U.iif=function(e,r){try{return C(e,r,(function(e,r,t){if(f.pcCheck(t,3,3),!1===f.isBoolean(t[0]))throw new Error("IF Function must have a boolean test condition");return t[0]?t[1]:t[2]}))}catch(e){throw e}},U.decode=function(e,r){try{return C(e,r,(function(r,t,n){if(n.length<2)throw new Error("Missing Parameters");if(2===n.length)return n[1];if((n.length-1)%2==0)throw new Error("Must have a default value result.");var o=n[0];return function e(r,t,n,o){try{var a=t[n];if(f.equalityTest(a,o))return t[n+1];var i=t.length-n;return 1===i?t[n]:2===i?null:3===i?t[n+2]:e(r,t,n+2,o)}catch(e){throw e}}(e,n,1,o)}))}catch(e){throw e}},U.when=function(e,r){try{return C(e,r,(function(r,t,n){if(n.length<3)throw new Error("Missing Parameters");if(n.length%2==0)throw new Error("Must have a default value result.");var o=n[0];if(!1===f.isBoolean(o))throw new Error("WHEN needs boolean test conditions");return function e(r,t,n,o){try{if(!0===o)return t[n+1];if(3===t.length-n)return t[n+2];var a=t[n+2];if(!1===f.isBoolean(a))throw new Error("WHEN needs boolean test conditions");return e(r,t,n+2,a)}catch(e){throw e}}(e,n,0,o)}))}catch(e){throw e}},U.top=function(e,r){return C(e,r,(function(e,r,t){if(f.pcCheck(t,2,2),f.isArray(t[0]))return f.toNumber(t[1])>=t[0].length?t[0].slice(0):t[0].slice(0,f.toNumber(t[1]));if(f.isImmutableArray(t[0]))return f.toNumber(t[1])>=t[0].length()?t[0].slice(0):t[0].slice(0,f.toNumber(t[1]));throw new Error("Top cannot accept this parameter type")}))},U.first=function(e,r){return C(e,r,(function(e,r,t){return f.pcCheck(t,1,1),f.isArray(t[0])?0===t[0].length?null:t[0][0]:f.isImmutableArray(t[0])?0===t[0].length()?null:t[0].get(0):null}))},U.sort=function(e,r){return C(e,r,(function(r,o,a){f.pcCheck(a,1,2);var i=a[0];if(f.isImmutableArray(i)&&(i=i.toArray()),!1===f.isArray(i))throw new Error("Illegal Argument");if(a.length>1){if(!1===f.isFunctionParameter(a[1]))throw new Error("Illegal Argument");var l=i,s=function(e,t){return W.callfunc(a[1],[e,t],r)};return e.isAsync?function e(r,o){return t(this,void 0,void 0,(function(){var t,a,i,l;return n(this,(function(n){switch(n.label){case 0:return t=r.length,a=Math.floor(t/2),0===t?[2,[]]:1===t?[2,[r[0]]]:(i=[e(r.slice(0,a),o),e(r.slice(a,t),o)],[4,Promise.all(i)]);case 1:return[2,D((l=n.sent())[0],l[1],o,[])]}}))}))}(l,s):l=k(l,(function(e,r){return s(e,r)}))}if(0===(l=i).length)return[];for(var c={},u=0;u<l.length;u++){var p=P(l[u]);""!==p&&(c[p]=!0)}if(!0===c.Array||!0===c.Dictionary||!0===c.Feature||!0===c.Point||!0===c.Polygon||!0===c.Polyline||!0===c.Multipoint||!0===c.Extent||!0===c.Function)return l.slice(0);var g=0,m="";for(var h in c)g++,m=h;return l=g>1||"String"===m?k(l,(function(e,r){if(null==e||e===f.voidOperation)return null==r||r===f.voidOperation?0:1;if(null==r||r===f.voidOperation)return-1;var t=f.toString(e),n=f.toString(r);return t<n?-1:t===n?0:1})):"Number"===m?k(l,(function(e,r){return e-r})):"Boolean"===m?k(l,(function(e,r){return e===r?0:r?-1:1})):"Date"===m?k(l,(function(e,r){return r-e})):l.slice(0)}))};var j={};for(var V in U)j[V]=new f.NativeFunction(U[V]);for(var V in y.registerFunctions(U,C),U)U[V]=new f.NativeFunction(U[V]);var Y=function(){};Y.prototype=U;var G=function(){};function z(e,r,t){var n={};for(var o in e||(e={}),t||(t={}),n._SymbolsMap={},n.textformatting=1,n.infinity=1,n.pi=1,r)n[o]=1;for(var o in t)n[o]=1;for(var o in e)n[o]=1;return n}G.prototype=j;var q={fixSpatialReference:f.fixSpatialReference,parseArguments:function(e,r){for(var t=[],n=0;n<r.arguments.length;n++)t.push(R(e,r.arguments[n]));return t},standardFunction:C};function H(e,r){for(var t={mode:r,compiled:!0,functions:{},signatures:[],standardFunction:C,standardFunctionAsync:C,evaluateIdentifier:J},n=0;n<e.length;n++)e[n].registerFunctions(t);if("sync"===r){for(var o in t.functions)U[o]=new f.NativeFunction(t.functions[o]),Y.prototype[o]=U[o];for(n=0;n<t.signatures.length;n++)g.addFunctionDeclaration(t.signatures[n],"sync")}else{for(var o in t.functions)j[o]=new f.NativeFunction(t.functions[o]),G.prototype[o]=j[o];for(n=0;n<t.signatures.length;n++)g.addFunctionDeclaration(t.signatures[n],"async")}}function J(e,r){var t=r.name;if("_SymbolsMap"===t)throw new Error("Illegal");if(e.localStack.length>0){if("_t"!==t.substr(0,2).toLowerCase()&&void 0!==e.localStack[e.localStack.length-1][t])return e.localStack[e.localStack.length-1][t];var n=e.mangleMap[t];if(void 0!==n&&void 0!==e.localStack[e.localStack.length-1][n])return e.localStack[e.localStack.length-1][n]}if("_t"!==t.substr(0,2).toLowerCase()&&void 0!==e.globalScope[t])return e.globalScope[t];if(1===e.globalScope._SymbolsMap[t])return e.globalScope[t];var o=e.mangleMap[t];return void 0!==o?e.globalScope[o]:void 0}r.functionHelper=q,r.extend=H,H([m],"sync"),H([m],"async"),r.executeScript=function(e,r){return e(r)},r.extractFieldLiterals=function(e,r){return void 0===r&&(r=!1),g.findFieldLiterals(e)},r.extractExpectedFieldLiterals=function(e){return g.findExpectedFieldLiterals(e)},r.validateScript=function(e,r){return g.validateScript(e,r,"sync")},r.referencesMember=function(e,r){return g.referencesMember(e,r)},r.referencesFunction=function(e,r){return g.referencesFunction(e,r)};var Z=0,W={error:function(e,r,t){throw new Error(g.nodeErrorMessage(e,r,t))},__awaiter:function(e,r,t,n){return new Promise((function(t,o){function a(e){try{l(n.next(e))}catch(e){o(e)}}function i(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?t(e.value):e.value&&e.value.then?e.value.then(a,i):++Z%100==0?setTimeout((function(){Z=0,a(e.value)}),0):a(e.value)}l((n=n.apply(e,r||[])).next())}))},functionDepthchecker:function(e,r){return function(){if(r.depthCounter++,r.localStack.push([]),r.depthCounter>64)throw new Error("Exceeded maximum function depth");var t=e.apply(this,arguments);return E.isPromiseLike(t)?t.then((function(e){return r.depthCounter--,r.localStack.length=r.localStack.length-1,e})):(r.depthCounter--,r.localStack.length=r.localStack.length-1,t)}},castString:function(e){return f.toString(e)},aCheck:function(e,r){if(f.isFunctionParameter(e))throw new Error(g.nodeErrorMessage({type:r},"RUNTIME","FUNCTIONCONTEXTILLEGAL"));return e===f.voidOperation?null:e},Dictionary:s,Feature:c,dictionary:function(e){for(var r={},t=0;t<e.length;t+=2){if(f.isFunctionParameter(e[t+1]))throw new Error("Illegal Argument");if(!1===f.isString(e[t]))throw new Error("Illegal Argument");e[t+1]===f.voidOperation?r[e[t].toString()]=null:r[e[t].toString()]=e[t+1]}var n=new s(r);return n.immutable=!1,n},strCheck:function(e){if(!1===f.isString(e))throw new Error("Illegal Argument");return e},unary:function(e,r){if(f.isBoolean(e)){if("!"===r)return!e;if("-"===r)return-1*f.toNumber(e);if("+"===r)return 1*f.toNumber(e);if("~"===r)return~f.toNumber(e);var t={type:"UnaryExpression",operator:r,prefix:null,argument:null};throw new Error(g.nodeErrorMessage(t,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if("-"===r)return-1*f.toNumber(e);if("+"===r)return 1*f.toNumber(e);if("~"===r)return~f.toNumber(e);var n={type:"UnaryExpression",operator:r,prefix:null,argument:null};throw new Error(g.nodeErrorMessage(n,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))},logicalCheck:function(e){if(!1===f.isBoolean(e)){throw new Error(g.nodeErrorMessage({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"))}return e},logical:function(e,r,t){if(f.isBoolean(e)&&f.isBoolean(r))switch(t){case"||":return e||r;case"&&":return e&&r;default:throw new Error(g.nodeErrorMessage({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"))}throw new Error(g.nodeErrorMessage({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"))},binary:function(e,r,t){switch(t){case"|":case"<<":case">>":case">>>":case"^":case"&":return f.binaryOperator(f.toNumber(e),f.toNumber(r),t);case"==":case"=":return f.equalityTest(e,r);case"!=":return!f.equalityTest(e,r);case"<":case">":case"<=":case">=":return f.greaterThanLessThan(e,r,t);case"+":return f.isString(e)||f.isString(r)?f.toString(e)+f.toString(r):f.toNumber(e)+f.toNumber(r);case"-":return f.toNumber(e)-f.toNumber(r);case"*":return f.toNumber(e)*f.toNumber(r);case"/":return f.toNumber(e)/f.toNumber(r);case"%":return f.toNumber(e)%f.toNumber(r);default:var n={type:"BinaryExpression",operator:t,left:e,right:r};throw new Error(g.nodeErrorMessage(n,"RUNTIME","OPERATORNOTRECOGNISED"))}},assign:function(e,r,t){switch(r){case"=":return e===f.voidOperation?null:e;case"/=":return f.toNumber(t)/f.toNumber(e);case"*=":return f.toNumber(t)*f.toNumber(e);case"-=":return f.toNumber(t)-f.toNumber(e);case"+=":return f.isString(t)||f.isString(e)?f.toString(t)+f.toString(e):f.toNumber(t)+f.toNumber(e);case"%=":return f.toNumber(t)%f.toNumber(e);default:var n={type:"AssignmentExpression",operator:r,left:null,right:null};throw new Error(g.nodeErrorMessage(n,"RUNTIME","OPERATORNOTRECOGNISED"))}},update:function(e,r,t,n){var o=f.toNumber(e[r]);return e[r]="++"===t?o+1:o-1,!1===n?o:"++"===t?o+1:o-1},graphicToFeature:function(e,r){return null===e?null:c.createFromGraphicLikeObject(e.geometry,e.attributes,r)},memberupdate:function(e,r,t,n){var o;if(f.isArray(e)){if(!f.isNumber(r))throw new Error("Invalid Parameter");if(r<0&&(r=e.length+r),r<0||r>=e.length)throw new Error("Assignment outside of array bounds");o=f.toNumber(e[r]),e[r]="++"===t?o+1:o-1}else if(e instanceof s){if(!1===f.isString(r))throw new Error("Dictionary accessor must be a string");if(!0!==e.hasField(r))throw new Error("Invalid Parameter");o=f.toNumber(e.field(r)),e.setField(r,"++"===t?o+1:o-1)}else{if(!f.isFeature(e))throw f.isImmutableArray(e)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===f.isString(r))throw new Error("Feature accessor must be a string");if(!0!==e.hasField(r))throw new Error("Invalid Parameter");o=f.toNumber(e.field(r)),e.setField(r,"++"===t?o+1:o-1)}return!1===n?o:"++"===t?o+1:o-1},assignmember:function(e,r,t,n){if(f.isArray(e)){if(!f.isNumber(r))throw new Error("Invalid Parameter");if(r<0&&(r=e.length+r),r<0||r>e.length)throw new Error("Assignment outside of array bounds");if(r===e.length){if("="!==t)throw new Error("Invalid Parameter");e[r]=this.assign(n,t,e[r])}else e[r]=this.assign(n,t,e[r])}else if(e instanceof s){if(!1===f.isString(r))throw new Error("Dictionary accessor must be a string");if(!0===e.hasField(r))e.setField(r,this.assign(n,t,e.field(r)));else{if("="!==t)throw new Error("Invalid Parameter");e.setField(r,this.assign(n,t,null))}}else{if(!f.isFeature(e))throw f.isImmutableArray(e)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===f.isString(r))throw new Error("Feature accessor must be a string");if(!0===e.hasField(r))e.setField(r,this.assign(n,t,e.field(r)));else{if("="!==t)throw new Error("Invalid Parameter");e.setField(r,this.assign(n,t,null))}}},member:function(e,r){if(null===e){throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","NOTFOUND"))}if(e instanceof s||f.isFeature(e)){if(f.isString(r))return e.field(r);throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}if(e instanceof N){if(f.isString(r))return function(e,r,t){var n;switch(r=r.toLowerCase()){case"hasz":var o=e.hasZ;return void 0!==o&&o;case"hasm":var a=e.hasM;return void 0!==a&&a;case"spatialreference":var i=e.spatialReference._arcadeCacheId;if(void 0===i){var l=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(l=!1),l&&(_++,e.spatialReference._arcadeCacheId=_,i=_)}var c=new s({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==i&&(c._arcadeCacheId="SPREF"+i.toString()),c}switch(e.type){case"extent":switch(r){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":var f=e[r];return void 0!==f?f:null;case"type":return"Extent"}break;case"polygon":switch(r){case"rings":return void 0===(n=e.getCacheValue("_arcadeCacheId"))&&(n=++_,e.setCacheValue("_arcadeCacheId",n)),new u(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,n);case"type":return"Polygon"}break;case"point":switch(r){case"x":case"y":case"z":case"m":return void 0!==e[r]?e[r]:null;case"type":return"Point"}break;case"polyline":switch(r){case"paths":return void 0===(n=e.getCacheValue("_arcadeCacheId"))&&(n=++_,e.setCacheValue("_arcadeCacheId",n)),new u(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,n);case"type":return"Polyline"}break;case"multipoint":switch(r){case"points":return void 0===(n=e.getCacheValue("_arcadeCacheId"))&&(n=++_,e.setCacheValue("_arcadeCacheId",n)),new p(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,n,1);case"type":return"Multipoint"}}throw new Error(g.nodeErrorMessage(t,"RUNTIME","PROPERTYNOTFOUND"))}(e,r,"MemberExpression");throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}if(f.isArray(e)){if(f.isNumber(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=e.length+r),r>=e.length||r<0){throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"))}return e[r]}throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}if(f.isString(e)){if(f.isNumber(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=e.length+r),r>=e.length||r<0){throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"))}return e[r]}throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}if(f.isImmutableArray(e)){if(f.isNumber(r)&&isFinite(r)&&Math.floor(r)===r){if(r<0&&(r=e.length()+r),r>=e.length()||r<0){throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"))}return e.get(r)}throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}throw new Error(g.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))},callfunc:function(e,r,t){return e instanceof f.NativeFunction?e.fn(t,{arguments:r,preparsed:!0}):e instanceof f.SizzleFunction?e.fn.apply(this,r):e.apply(this,r)}};function K(e){console.log(e)}r.compileScript=function(e,r,t){void 0===r&&(r=null),void 0===t&&(t=!1),null===r&&(r={vars:{},customfunctions:{}});var n={isAsync:t,globalScope:z(r.vars,t?j:U,r.customfunctions),localScope:null,mangleMap:{},console:K,lrucache:r.lrucache,interceptor:r.interceptor,services:r.services,symbols:{symbolCounter:0}},o=R(n,e.body[0].body);""===o&&(o="lc.voidOperation; ");var a="";a=t?"var runtimeCtx=this.prepare(context, true);\n var lc = this.lc;  var lang = this.lang; var gscope=runtimeCtx.globalScope; \nreturn lang.__awaiter(this, void 0, void 0, function* () {\n\n function mainBody() {\n var lastStatement=lc.voidOperation;\n return lang.__awaiter(this, void 0, void 0, function* () {\n"+o+"\n return lastStatement; }); } \n return this.postProcess(yield mainBody()); }); ":"var runtimeCtx=this.prepare(context, false);\n var lc = this.lc;  var lang = this.lang; var gscope=runtimeCtx.globalScope; \n function mainBody() {\n var lastStatement=lc.voidOperation;\n "+o+"\n return lastStatement; } \n return this.postProcess(mainBody()); ";var i={lc:f,lang:W,mangles:n.mangleMap,postProcess:function(e){if(e instanceof f.ReturnResult&&(e=e.value),e instanceof f.ImplicitResult&&(e=e.value),e===f.voidOperation&&(e=null),e===f.breakResult)throw new Error("Cannot return BREAK");if(e===f.continueResult)throw new Error("Cannot return CONTINUE");if(f.isFunctionParameter(e))throw new Error("Cannot return FUNCTION");return e},prepare:function(e,r){var t=e.spatialReference;null==t&&(t=new T({wkid:102100}));var n=function(e,r,t){var n=t?new G:new Y;e||(e={}),r||(r={});var o=new s({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});for(var a in o.immutable=!1,n._SymbolsMap={textformatting:1,infinity:1,pi:1},n.textformatting=o,n.infinity=Number.POSITIVE_INFINITY,n.pi=Math.PI,r)n[a]=r[a],n._SymbolsMap[a]=1;for(var a in e)n._SymbolsMap[a]=1,e[a]&&"esri.Graphic"===e[a].declaredClass?n[a]=c.createFromGraphic(e[a]):n[a]=e[a];return n}(e.vars,e.customfunctions,r);return{localStack:[],isAsync:r,mangleMap:this.mangles,spatialReference:t,globalScope:n,abortSignal:void 0===e.abortSignal||null===e.abortSignal?{aborted:!1}:e.abortSignal,localScope:null,services:e.services,console:e.console?e.console:K,lrucache:e.lrucache,interceptor:e.interceptor,symbols:{symbolCounter:0},depthCounter:1}}};return new Function("context","spatialReference",a).bind(i)},r.enableAsyncSupport=function(){return new Promise((function(r,t){e(["./functions/geomasync"],(function(e){H([e],"async"),r(!0)}),(function(e){t(e)}))}))}}));