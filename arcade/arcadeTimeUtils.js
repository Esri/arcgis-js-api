// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.43/esri/copyright.txt for details.

define(["require","exports","./ArcadeDate","./polyfill/sql/FieldsIndex","./polyfill/time/timeReferenceUtils","./polyfill/time/timeReference","../libs/luxon/luxon"],(function(e,i,n,t,a,o,r){"use strict";function d(e){var i;return(null==e?void 0:e.timeZoneIANA)?null==e?void 0:e.timeZoneIANA:(null===(i=e)||void 0===i?void 0:i.timeZone)?a.convertLegacyTimeZone(e,""):""}Object.defineProperty(i,"__esModule",{value:!0}),i.DateTimeReferenceFieldIndex=i.convertToIANA=i.convertTimeReference=void 0,i.convertTimeReference=function(e){if(!e)return null;if(e instanceof o.TimeReference&&(e=d(e.toJson())),e instanceof r.Zone)return e;if("unknown"===e.toLowerCase())return n.UnknownTimeZone.instance;if("system"===e.toLowerCase())return r.SystemZone.instance;if("utc"===e.toLowerCase())return r.FixedOffsetZone.utcInstance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){var i=r.FixedOffsetZone.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(i)return i}var t=r.IANAZone.create(e);if(!t.isValid)throw new n.ArcadeDateError(n.ArcadeDateErrorCodes.TimeZoneNotRecognised);return t},i.convertToIANA=d;var l=function(){function e(){this.dateTimeReferenceMetaData=null,this._fieldTimeZoneIndex={},this._fieldIndex=null,this._ianaPreferred=null,this._ianaTimeInfo=null,this._ianaEditFields=null,this._ianaLayerDateFields=null}return e.create=function(i,n){var a=new e;return a.dateTimeReferenceMetaData=n,a._fieldIndex=i instanceof t?i:new t(i),a},e.prototype.fieldTimeZone=function(e){var i,n,t,a,o,r,d,l,f,s,u,v,c,m,T,h,I,R,D,F,_,y,p,A=null===(i=this._fieldIndex)||void 0===i?void 0:i.get(e);if(!A)return null;if("date"!==A.type&&"esriFieldTypeDate"!==A.type)return null;var M=this._fieldTimeZoneIndex[A.name];if(void 0!==M)return M;for(var w=0,Z=[{field:null===(t=null===(n=this.dateTimeReferenceMetaData)||void 0===n?void 0:n.editFieldsInfo)||void 0===t?void 0:t.creationDateField,timeReference:null===(o=null===(a=this.dateTimeReferenceMetaData)||void 0===a?void 0:a.editFieldsInfo)||void 0===o?void 0:o.dateFieldsTimeReference,isunknown:!0===(null===(r=this.dateTimeReferenceMetaData)||void 0===r?void 0:r.datesInUnknownTimezone)},{field:null===(l=null===(d=this.dateTimeReferenceMetaData)||void 0===d?void 0:d.editFieldsInfo)||void 0===l?void 0:l.editDateField,timeReference:null===(s=null===(f=this.dateTimeReferenceMetaData)||void 0===f?void 0:f.editFieldsInfo)||void 0===s?void 0:s.dateFieldsTimeReference,isunknown:!0===(null===(u=this.dateTimeReferenceMetaData)||void 0===u?void 0:u.datesInUnknownTimezone)},{field:null===(c=null===(v=this.dateTimeReferenceMetaData)||void 0===v?void 0:v.timeInfo)||void 0===c?void 0:c.startTimeField,timeReference:null===(T=null===(m=this.dateTimeReferenceMetaData)||void 0===m?void 0:m.timeInfo)||void 0===T?void 0:T.timeReference,isunknown:!0===(null===(h=this.dateTimeReferenceMetaData)||void 0===h?void 0:h.datesInUnknownTimezone)},{field:null===(R=null===(I=this.dateTimeReferenceMetaData)||void 0===I?void 0:I.timeInfo)||void 0===R?void 0:R.endTimeField,timeReference:null===(F=null===(D=this.dateTimeReferenceMetaData)||void 0===D?void 0:D.timeInfo)||void 0===F?void 0:F.timeReference,isunknown:!0===(null===(_=this.dateTimeReferenceMetaData)||void 0===_?void 0:_.datesInUnknownTimezone)}];w<Z.length;w++){var k=Z[w];if(k.field===A.name){var x=this.convertToIANA(k.timeReference,k.isunknown);return this._fieldTimeZoneIndex[A.name]=x,x}}var b=this.convertToIANA(null===(y=this.dateTimeReferenceMetaData)||void 0===y?void 0:y.dateFieldsTimeReference,null===(p=this.dateTimeReferenceMetaData)||void 0===p?void 0:p.datesInUnknownTimezone);return this._fieldTimeZoneIndex[A.name]=b,b},e.prototype.convertToIANA=function(e,i){return i?"unknown":d(e)},Object.defineProperty(e.prototype,"layerPreferredTimeZone",{get:function(){var e,i;if(null!==this._ianaPreferred)return this._ianaPreferred;this._ianaPreferred="";var n=null===(e=this.dateTimeReferenceMetaData)||void 0===e?void 0:e.preferredTimeReference;return this._ianaPreferred=this.convertToIANA(n,!0===(null===(i=this.dateTimeReferenceMetaData)||void 0===i?void 0:i.datesInUnknownTimezone)),this._ianaPreferred},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerTimeInfoTimeZone",{get:function(){var e,i;if(null!==this._ianaTimeInfo)return this._ianaTimeInfo;this._ianaTimeInfo="";var n=null===(i=null===(e=this.dateTimeReferenceMetaData)||void 0===e?void 0:e.timeInfo)||void 0===i?void 0:i.timeReference;return this._ianaTimeInfo=this.convertToIANA(n,!1),this._ianaTimeInfo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerEditFieldsTimeZone",{get:function(){var e,i,n;if(null!==this._ianaEditFields)return this._ianaEditFields;this._ianaEditFields="";var t=null===(i=null===(e=this.dateTimeReferenceMetaData)||void 0===e?void 0:e.editFieldsInfo)||void 0===i?void 0:i.dateFieldsTimeReference;return this._ianaEditFields=this.convertToIANA(t,null===(n=this.dateTimeReferenceMetaData)||void 0===n?void 0:n.datesInUnknownTimezone),this._ianaEditFields},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerDateFieldsTimeZone",{get:function(){var e,i;if(null!==this._ianaLayerDateFields)return this._ianaLayerDateFields;this._ianaLayerDateFields="";var n=null===(e=this.dateTimeReferenceMetaData)||void 0===e?void 0:e.dateFieldsTimeReference;return this._ianaLayerDateFields=this.convertToIANA(n,!0===(null===(i=this.dateTimeReferenceMetaData)||void 0===i?void 0:i.datesInUnknownTimezone)),this._ianaLayerDateFields},enumerable:!1,configurable:!0}),e}();i.DateTimeReferenceFieldIndex=l}));