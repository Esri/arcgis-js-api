// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.41/esri/copyright.txt for details.

define(["require","exports","../polyfill/tsSupport/assign","../polyfill/tsSupport/spreadarray","../Dictionary","../Feature","../ImmutablePointArray","../languageUtils","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","./centroid","../../geometry/jsonUtils"],(function(e,r,n,t,i,a,o,l,f,s,c,u,m,g,p,h){"use strict";function y(e){return e&&"esri.arcade.Feature"===e.arcadeDeclaredClass}Object.defineProperty(r,"__esModule",{value:!0}),r.registerFunctions=void 0,r.registerFunctions=function(e,r){e.ringisclockwise=function(e,n){return r(e,n,(function(e,r,n){l.pcCheck(n,1,1);var t=[];if(null===n[0])return!1;if(l.isArray(n[0])){for(var i=0,a=n[0];i<a.length;i++){if(!((c=a[i])instanceof u))throw new Error("Invalid Argument");t.push([c.x,c.y])}t.length>0&&(n[0][0].hasZ,n[0][0].hasM)}else if(n[0]instanceof o)(t=n[0]._elements).length>0&&(n[0]._hasZ,n[0]._hasM);else{if(!l.isImmutableArray(n[0]))throw new Error("Invalid Argument");for(var f=0,s=n[0].toArray();f<s.length;f++){var c;if(!((c=s[f])instanceof u))throw new Error("Invalid Argument");t.push([c.x,c.y])}t.length>0&&(n[0].get(0).hasZ,n[0].get(0).hasM)}return!(t.length<3)&&new m({rings:[],spatialReference:{wkid:4326}}).isClockwise(t)}))},e.polygon=function(e,n){return r(e,n,(function(r,n,t){l.pcCheck(t,1,1);var o=null;if(t[0]instanceof i){if((o=l.fixSpatialReference(a.parseGeometryFromDictionary(t[0]),e.spatialReference))instanceof m==!1)throw new Error("Illegal Parameter")}else o=t[0]instanceof m?h.fromJson(t[0].toJson()):l.fixSpatialReference(new m(JSON.parse(t[0])),e.spatialReference);if(null!==o&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return l.fixNullGeometry(o)}))},e.polyline=function(e,n){return r(e,n,(function(r,n,t){l.pcCheck(t,1,1);var o=null;if(t[0]instanceof i){if((o=l.fixSpatialReference(a.parseGeometryFromDictionary(t[0]),e.spatialReference))instanceof g==!1)throw new Error("Illegal Parameter")}else o=t[0]instanceof g?h.fromJson(t[0].toJson()):l.fixSpatialReference(new g(JSON.parse(t[0])),e.spatialReference);if(null!==o&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return l.fixNullGeometry(o)}))},e.point=function(e,n){return r(e,n,(function(r,n,t){l.pcCheck(t,1,1);var o=null;if(t[0]instanceof i){if((o=l.fixSpatialReference(a.parseGeometryFromDictionary(t[0]),e.spatialReference))instanceof u==!1)throw new Error("Illegal Parameter")}else o=t[0]instanceof u?h.fromJson(t[0].toJson()):l.fixSpatialReference(new u(JSON.parse(t[0])),e.spatialReference);if(null!==o&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return l.fixNullGeometry(o)}))},e.multipoint=function(e,n){return r(e,n,(function(r,n,t){l.pcCheck(t,1,1);var o=null;if(t[0]instanceof i){if((o=l.fixSpatialReference(a.parseGeometryFromDictionary(t[0]),e.spatialReference))instanceof c==!1)throw new Error("Illegal Parameter")}else o=t[0]instanceof c?h.fromJson(t[0].toJson()):l.fixSpatialReference(new c(JSON.parse(t[0])),e.spatialReference);if(null!==o&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return l.fixNullGeometry(o)}))},e.extent=function(e,n){return r(e,n,(function(r,n,t){t=l.autoCastFeatureToGeometry(t),l.pcCheck(t,1,1);var o=null;if(t[0]instanceof i)o=l.fixSpatialReference(a.parseGeometryFromDictionary(t[0]),e.spatialReference);else if(t[0]instanceof u){var s={xmin:t[0].x,ymin:t[0].y,xmax:t[0].x,ymax:t[0].y,spatialReference:t[0].spatialReference.toJson()},p=t[0];p.hasZ?(s.zmin=p.z,s.zmax=p.z):p.hasM&&(s.mmin=p.m,s.mmax=p.m),o=h.fromJson(s)}else o=t[0]instanceof m?h.fromJson(t[0].getExtent().toJson()):t[0]instanceof g?h.fromJson(t[0].getExtent().toJson()):t[0]instanceof c?h.fromJson(t[0].getExtent().toJson()):t[0]instanceof f?h.fromJson(t[0].toJson()):l.fixSpatialReference(new f(JSON.parse(t[0])),e.spatialReference);if(null!==o&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return l.fixNullGeometry(o)}))},e.geometry=function(e,n){return r(e,n,(function(r,n,t){l.pcCheck(t,1,1);var o=null;if(null===t[0])return null;if(null!==(o=y(t[0])?l.fixSpatialReference(t[0].geometry(),e.spatialReference):t[0]instanceof i?l.fixSpatialReference(a.parseGeometryFromDictionary(t[0]),e.spatialReference):l.fixSpatialReference(h.fromJson(JSON.parse(t[0])),e.spatialReference))&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return l.fixNullGeometry(o)}))},e.setgeometry=function(e,n){return r(e,n,(function(e,r,n){if(l.pcCheck(n,2,2),!y(n[0]))throw new Error("Illegal Argument");if(!0===n[0].immutable)throw new Error("Feature is Immutable");if(!(n[1]instanceof s||null===n[1]))throw new Error("Illegal Argument");return n[0]._geometry=n[1],l.voidOperation}))},e.feature=function(e,n){return r(e,n,(function(r,n,t){if(0===t.length)throw new Error("Missing Parameters");var o=null;if(1===t.length)if(l.isString(t[0]))o=a.fromJson(JSON.parse(t[0]));else if(y(t[0]))o=a.createFromArcadeFeature(t[0]);else if(t[0]instanceof s)o=a.createFromGraphicLikeObject(t[0],null,null);else{if(!(t[0]instanceof i))throw new Error("Illegal Argument");var f=t[0].hasField("geometry")?t[0].field("geometry"):null,c=t[0].hasField("attributes")?t[0].field("attributes"):null;null!==f&&f instanceof i&&(f=a.parseGeometryFromDictionary(f)),null!==c&&(c=a.parseAttributesFromDictionary(c)),o=a.createFromGraphicLikeObject(f,c,null)}else if(2===t.length){f=null,c=null;if(null!==t[0])if(t[0]instanceof s)f=t[0];else{if(!(f instanceof i))throw new Error("Illegal Argument");f=a.parseGeometryFromDictionary(t[0])}if(null!==t[1]){if(!(t[1]instanceof i))throw new Error("Illegal Argument");c=a.parseAttributesFromDictionary(t[1])}o=a.createFromGraphicLikeObject(f,c,null)}else{f=null,c={};if(null!==t[0])if(t[0]instanceof s)f=t[0];else{if(!(f instanceof i))throw new Error("Illegal Argument");f=a.parseGeometryFromDictionary(t[0])}for(var u=1;u<t.length;u+=2){var m=l.toString(t[u]),g=t[u+1];if(!(null==g||l.isString(g)||isNaN(g)||l.isDate(g)||l.isNumber(g)||l.isBoolean(g)))throw new Error("Illegal Argument");if(l.isFunctionParameter(g)||!1===l.isSimpleType(g))throw new Error("Illegal Argument");g===l.voidOperation?c[m]=null:c[m]=g}o=a.createFromGraphicLikeObject(f,c,null)}return o._geometry=l.fixSpatialReference(o.geometry(),e.spatialReference),o.immutable=!1,o}))},e.dictionary=function(e,n){return r(e,n,(function(e,r,n){if(0===n.length){var t=new i;return t.immutable=!1,t}if(1===n.length&&l.isString(n[0]))try{var a=JSON.parse(n[0]),o=i.convertObjectToArcadeDictionary(a,!1);return o.immutable=!1,o}catch(e){throw new Error("Missing Parameters or Illegal Json")}if(n.length%2!=0)throw new Error("Missing Parameters");for(var f={},s=0;s<n.length;s+=2){var c=l.toString(n[s]),u=n[s+1];if(!(null==u||l.isString(u)||isNaN(u)||l.isDate(u)||l.isNumber(u)||l.isBoolean(u)||l.isArray(u)||l.isImmutableArray(u)))throw new Error("Illegal Argument");if(l.isFunctionParameter(u))throw new Error("Illegal Argument");u===l.voidOperation?f[c]=null:f[c]=u}var m=new i(f);return m.immutable=!1,m}))},e.haskey=function(e,n){return r(e,n,(function(e,r,n){l.pcCheck(n,2,2);var t=l.toString(n[1]);if(y(n[0]))return n[0].hasField(t);if(n[0]instanceof i)return n[0].hasField(t);throw new Error("Illegal Argument")}))},e.indexof=function(e,n){return r(e,n,(function(e,r,n){l.pcCheck(n,2,2);var t=n[1];if(l.isArray(n[0])){for(var i=0;i<n[0].length;i++)if(l.equalityTest(t,n[0][i]))return i;return-1}if(l.isImmutableArray(n[0])){var a=n[0].length();for(i=0;i<a;i++)if(l.equalityTest(t,n[0].get(i)))return i;return-1}throw new Error("Illegal Argument")}))},e.angle=function(e,n){return r(e,n,(function(e,r,n){if(n=l.autoCastFeatureToGeometry(n),l.pcCheck(n,2,3),!(n[0]instanceof u))throw new Error("Illegal Argument");if(!(n[1]instanceof u))throw new Error("Illegal Argument");if(n.length>2&&!(n[2]instanceof u))throw new Error("Illegal Argument");return 2===n.length?p.angle2D(n[0],n[1]):p.angleBetween2D(n[0],n[1],n[2])}))},e.bearing=function(e,n){return r(e,n,(function(e,r,n){if(n=l.autoCastFeatureToGeometry(n),l.pcCheck(n,2,3),!(n[0]instanceof u))throw new Error("Illegal Argument");if(!(n[1]instanceof u))throw new Error("Illegal Argument");if(n.length>2&&!(n[2]instanceof u))throw new Error("Illegal Argument");return 2===n.length?p.bearing2D(n[0],n[1]):p.bearingBetween2D(n[0],n[1],n[2])}))},e.isselfintersecting=function(e,n){return r(e,n,(function(r,n,t){t=l.autoCastFeatureToGeometry(t),l.pcCheck(t,1,1);var i=t[0];if(i instanceof m)return i.isSelfIntersecting(i);if(i instanceof g)return i=i.paths,p.pathsSelfIntersecting(i);if(i instanceof c)for(var a=i.points,o=0;o<a.length;o++)for(var f=0;f<a.length;f++)if(f!==o){for(var s=!0,u=0;u<a[o].length;u++)if(a[o][u]!==a[f][u]){s=!1;break}if(!0===s)return!0}return!(!l.isArray(i)&&!l.isImmutableArray(i))&&(null!==(i=l.autoCastArrayOfPointsToPolyline(i,e.spatialReference))&&(i=i.paths),p.pathsSelfIntersecting(i))}))}}}));