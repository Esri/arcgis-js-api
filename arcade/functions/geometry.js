/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../Dictionary","../Feature","../ImmutablePointArray","../../chunks/languageUtils","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","./centroid","../../geometry/support/jsonUtils","../executionError","../ImmutablePathArray","../../geometry/support/coordsUtils"],(function(e,r,t,n,a,i,o,c,s,l,u,f,m,d,E,h){"use strict";function p(e){return e&&"esri.arcade.Feature"===e.arcadeDeclaredClass}function x(e,E){e.ringisclockwise=function(e,r){return E(e,r,((t,i,o)=>{a.pcCheck(o,1,1,e,r);let c=[],l=!1,u=!1;if(null===o[0])return!1;if(a.isArray(o[0])){for(const t of o[0]){if(!(t instanceof s))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);c.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}c.length>0&&(l=o[0][0].hasZ,u=o[0][0].hasM)}else if(o[0]instanceof n)c=o[0]._elements,c.length>0&&(l=o[0]._hasZ,u=o[0]._hasM);else{if(!a.isImmutableArray(o[0]))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);for(const t of o[0].toArray()){if(!(t instanceof s))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);c.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}c.length>0&&(l=o[0].get(0).hasZ,u=o[0].get(0).hasM)}return!(c.length<3)&&h.isClockwise(c,u,l)}))},e.polygon=function(e,n){return E(e,n,((i,o,c)=>{a.pcCheck(c,1,1,e,n);let s=null;if(c[0]instanceof r){if(s=a.fixSpatialReference(t.parseGeometryFromDictionary(c[0]),e.spatialReference),s instanceof l==!1)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n)}else s=c[0]instanceof l?m.fromJSON(c[0].toJSON()):a.fixSpatialReference(new l(JSON.parse(c[0])),e.spatialReference);if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(s)}))},e.polyline=function(e,n){return E(e,n,((i,o,c)=>{a.pcCheck(c,1,1,e,n);let s=null;if(c[0]instanceof r){if(s=a.fixSpatialReference(t.parseGeometryFromDictionary(c[0]),e.spatialReference),s instanceof u==!1)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n)}else s=c[0]instanceof u?m.fromJSON(c[0].toJSON()):a.fixSpatialReference(new u(JSON.parse(c[0])),e.spatialReference);if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(s)}))},e.point=function(e,n){return E(e,n,((i,o,c)=>{a.pcCheck(c,1,1,e,n);let l=null;if(c[0]instanceof r){if(l=a.fixSpatialReference(t.parseGeometryFromDictionary(c[0]),e.spatialReference),l instanceof s==!1)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n)}else l=c[0]instanceof s?m.fromJSON(c[0].toJSON()):a.fixSpatialReference(new s(JSON.parse(c[0])),e.spatialReference);if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(l)}))},e.multipoint=function(e,n){return E(e,n,((i,o,s)=>{a.pcCheck(s,1,1,e,n);let l=null;if(s[0]instanceof r){if(l=a.fixSpatialReference(t.parseGeometryFromDictionary(s[0]),e.spatialReference),l instanceof c==!1)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n)}else l=s[0]instanceof c?m.fromJSON(s[0].toJSON()):a.fixSpatialReference(new c(JSON.parse(s[0])),e.spatialReference);if(null!==l&&!1===l.spatialReference.equals(e.spatialReference))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(l)}))},e.extent=function(e,n){return E(e,n,((o,f,E)=>{E=a.autoCastFeatureToGeometry(E),a.pcCheck(E,1,1,e,n);let h=null;if(E[0]instanceof r)h=a.fixSpatialReference(t.parseGeometryFromDictionary(E[0]),e.spatialReference);else if(E[0]instanceof s){const e={xmin:E[0].x,ymin:E[0].y,xmax:E[0].x,ymax:E[0].y,spatialReference:E[0].spatialReference.toJSON()},r=E[0];r.hasZ?(e.zmin=r.z,e.zmax=r.z):r.hasM&&(e.mmin=r.m,e.mmax=r.m),h=m.fromJSON(e)}else h=E[0]instanceof l||E[0]instanceof u||E[0]instanceof c?m.fromJSON(E[0].extent?.toJSON()):E[0]instanceof i?m.fromJSON(E[0].toJSON()):a.fixSpatialReference(new i(JSON.parse(E[0])),e.spatialReference);if(null!==h&&!1===h.spatialReference.equals(e.spatialReference))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(h)}))},e.geometry=function(e,n){return E(e,n,((i,o,c)=>{a.pcCheck(c,1,1,e,n);let s=null;if(null===c[0])return null;if(s=p(c[0])?a.fixSpatialReference(c[0].geometry(),e.spatialReference):c[0]instanceof r?a.fixSpatialReference(t.parseGeometryFromDictionary(c[0]),e.spatialReference):a.fixSpatialReference(m.fromJSON(JSON.parse(c[0])),e.spatialReference),null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.WrongSpatialReference,n);return a.fixNullGeometry(s)}))},e.setgeometry=function(e,r){return E(e,r,((t,n,i)=>{if(a.pcCheck(i,2,2,e,r),!p(i[0]))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);if(!0===i[0].immutable)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.Immutable,r);if(!(i[1]instanceof o||null===i[1]))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);return i[0]._geometry=i[1],a.voidOperation}))},e.feature=function(e,n){return E(e,n,((i,c,s)=>{if(0===s.length)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.WrongNumberOfParameters,n);let l=null;if(1===s.length)if(a.isString(s[0]))l=t.fromJson(JSON.parse(s[0]),e.timeReference);else if(p(s[0]))l=t.createFromArcadeFeature(s[0]);else if(s[0]instanceof o)l=t.createFromGraphicLikeObject(s[0],null,null,e.timeReference);else{if(!(s[0]instanceof r))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);{let n=s[0].hasField("geometry")?s[0].field("geometry"):null,a=s[0].hasField("attributes")?s[0].field("attributes"):null;null!==n&&n instanceof r&&(n=t.parseGeometryFromDictionary(n)),null!==a&&(a=t.parseAttributesFromDictionary(a)),l=t.createFromGraphicLikeObject(n,a,null,e.timeReference)}}else if(2===s.length){let a=null,i=null;if(null!==s[0])if(s[0]instanceof o)a=s[0];else{if(!(a instanceof r))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);a=t.parseGeometryFromDictionary(s[0])}if(null!==s[1]){if(!(s[1]instanceof r))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);i=t.parseAttributesFromDictionary(s[1])}l=t.createFromGraphicLikeObject(a,i,null,e.timeReference)}else{let i=null;const c={};if(null!==s[0])if(s[0]instanceof o)i=s[0];else{if(!(i instanceof r))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);i=t.parseGeometryFromDictionary(s[0])}for(let r=1;r<s.length;r+=2){const t=a.toString(s[r]),i=s[r+1];if(!(null==i||a.isString(i)||isNaN(i)||a.isDate(i)||a.isNumber(i)||a.isBoolean(i)))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);if(a.isFunctionParameter(i)||!1===a.isSimpleType(i))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);i===a.voidOperation?c[t]=null:c[t]=i}l=t.createFromGraphicLikeObject(i,c,null,e.timeReference)}return l._geometry=a.fixSpatialReference(l.geometry(),e.spatialReference),l.immutable=!1,l}))},e.dictionary=function(e,t){return E(e,t,((n,i,o)=>{if(0===o.length){const e=new r;return e.immutable=!1,e}if(1===o.length&&a.isString(o[0]))try{const t=JSON.parse(o[0]),n=r.convertObjectToArcadeDictionary(t,a.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(l){throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,t)}if(o.length%2!=0)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.WrongNumberOfParameters,t);const c={};for(let r=0;r<o.length;r+=2){const n=a.toString(o[r]),i=o[r+1];if(!(null==i||a.isString(i)||isNaN(i)||a.isDate(i)||a.isNumber(i)||a.isBoolean(i)||a.isArray(i)||a.isImmutableArray(i)))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,t);if(a.isFunctionParameter(i))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,t);i===a.voidOperation?c[n]=null:c[n]=i}const s=new r(c);return s.immutable=!1,s}))},e.haskey=function(e,t){return E(e,t,((n,i,c)=>{a.pcCheck(c,2,2,e,t);const s=a.toString(c[1]);if(p(c[0]))return c[0].hasField(s);if(c[0]instanceof r)return c[0].hasField(s);if(c[0]instanceof o){const e=w(c[0],s,null,null,2);return!e||"notfound"!==e.keystate}throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,t)}))},e.hasvalue=function(e,t){return E(e,t,((n,i,c)=>{if(a.pcCheck(c,2,2,e,t),null===c[0]||null===c[1])return!1;const s=a.toString(c[1]);if(a.isFeature(c[0]))return!!c[0].hasField(s)&&null!==c[0].field(s);if(c[0]instanceof r)return!!c[0].hasField(s)&&null!==c[0].field(s);if(c[0]instanceof o){return null!==w(c[0],s,null,null,0)}return!1}))},e.indexof=function(e,r){return E(e,r,((t,n,i)=>{a.pcCheck(i,2,2,e,r);const o=i[1];if(a.isArray(i[0])){for(let e=0;e<i[0].length;e++)if(a.equalityTest(o,i[0][e]))return e;return-1}if(a.isImmutableArray(i[0])){const e=i[0].length();for(let r=0;r<e;r++)if(a.equalityTest(o,i[0].get(r)))return r;return-1}throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r)}))},e.angle=function(e,r){return E(e,r,((t,n,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,r),!(i[0]instanceof s))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);if(!(i[1]instanceof s))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);if(i.length>2&&!(i[2]instanceof s))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);return 2===i.length?f.angle2D(i[0],i[1]):f.angleBetween2D(i[0],i[1],i[2])}))},e.bearing=function(e,r){return E(e,r,((t,n,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,r),!(i[0]instanceof s))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);if(!(i[1]instanceof s))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);if(i.length>2&&!(i[2]instanceof s))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r);return 2===i.length?f.bearing2D(i[0],i[1]):f.bearingBetween2D(i[0],i[1],i[2])}))},e.isselfintersecting=function(e,r){return E(e,r,((t,n,i)=>{i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,1,1,e,r);let o=i[0];if(o instanceof l)return o.isSelfIntersecting;if(o instanceof u)return o=o.paths,f.pathsSelfIntersecting(o);if(o instanceof c){const e=o.points;for(let r=0;r<e.length;r++)for(let t=0;t<e.length;t++)if(t!==r){let n=!0;for(let a=0;a<e[r].length;a++)if(e[r][a]!==e[t][a]){n=!1;break}if(!0===n)return!0}}return!(!a.isArray(o)&&!a.isImmutableArray(o))&&(o=a.autoCastArrayOfPointsToPolyline(o,e.spatialReference),null!==o&&(o=o.paths),f.pathsSelfIntersecting(o))}))}}let y=0;function w(e,t,a,i,o=1){let c;switch(t=t.toLowerCase()){case"hasz":{const r=e.hasZ;return void 0!==r&&r}case"hasm":{const r=e.hasM;return void 0!==r&&r}case"spatialreference":{let t=e.spatialReference._arcadeCacheId;if(void 0===t){let r=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(r=!1),r&&(y++,e.spatialReference._arcadeCacheId=y,t=y)}const n=new r({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==t&&(n._arcadeCacheId="SPREF"+t.toString()),n}}switch(e.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const r=e[t];return void 0!==r?r:null}case"type":return"Extent"}break;case"polygon":switch(t){case"rings":c=e.cache._arcadeCacheId,void 0===c&&(y++,c=y,e.cache._arcadeCacheId=c);return new E(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,c);case"type":return"Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==e[t]?e[t]:null;case"type":return"Point"}break;case"polyline":switch(t){case"paths":c=e.cache._arcadeCacheId,void 0===c&&(y++,c=y,e.cache._arcadeCacheId=c);return new E(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,c);case"type":return"Polyline"}break;case"multipoint":switch(t){case"points":c=e.cache._arcadeCacheId,void 0===c&&(y++,c=y,e.cache._arcadeCacheId=c);return new n(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,c,1);case"type":return"Multipoint"}}if(1===o)throw new d.ArcadeExecutionError(a,d.ExecutionErrorCodes.InvalidIdentifier,i);return 2===o?{keystate:"notfound"}:null}e.geometryMember=w,e.registerFunctions=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
