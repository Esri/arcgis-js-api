/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../Dictionary","../Feature","../ImmutablePointArray","../../chunks/languageUtils","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","./centroid","../../geometry/support/jsonUtils","../../geometry/support/coordsUtils"],(function(e,r,n,t,i,a,l,o,f,s,c,u,m,g){"use strict";function p(e){return e&&"esri.arcade.Feature"===e.arcadeDeclaredClass}function h(e,h){e.ringisclockwise=function(e,r){return h(e,r,(function(e,r,n){i.pcCheck(n,1,1);let a=[],l=!1,o=!1;if(null===n[0])return!1;if(i.isArray(n[0])){for(const e of n[0]){if(!(e instanceof f))throw new Error("Invalid Argument");a.push(e.hasZ?e.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])}a.length>0&&(l=n[0][0].hasZ,o=n[0][0].hasM)}else if(n[0]instanceof t)a=n[0]._elements,a.length>0&&(l=n[0]._hasZ,o=n[0]._hasM);else{if(!i.isImmutableArray(n[0]))throw new Error("Invalid Argument");for(const e of n[0].toArray()){if(!(e instanceof f))throw new Error("Invalid Argument");a.push(e.hasZ?e.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])}a.length>0&&(l=n[0].get(0).hasZ,o=n[0].get(0).hasM)}return!(a.length<3)&&g.isClockwise(a,o,l)}))},e.polygon=function(e,t){return h(e,t,(function(t,a,l){i.pcCheck(l,1,1);let o=null;if(l[0]instanceof r){if(o=i.fixSpatialReference(n.parseGeometryFromDictionary(l[0]),e.spatialReference),o instanceof s==!1)throw new Error("Illegal Parameter")}else o=l[0]instanceof s?m.fromJSON(l[0].toJSON()):i.fixSpatialReference(new s(JSON.parse(l[0])),e.spatialReference);if(null!==o&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return i.fixNullGeometry(o)}))},e.polyline=function(e,t){return h(e,t,(function(t,a,l){i.pcCheck(l,1,1);let o=null;if(l[0]instanceof r){if(o=i.fixSpatialReference(n.parseGeometryFromDictionary(l[0]),e.spatialReference),o instanceof c==!1)throw new Error("Illegal Parameter")}else o=l[0]instanceof c?m.fromJSON(l[0].toJSON()):i.fixSpatialReference(new c(JSON.parse(l[0])),e.spatialReference);if(null!==o&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return i.fixNullGeometry(o)}))},e.point=function(e,t){return h(e,t,(function(t,a,l){i.pcCheck(l,1,1);let o=null;if(l[0]instanceof r){if(o=i.fixSpatialReference(n.parseGeometryFromDictionary(l[0]),e.spatialReference),o instanceof f==!1)throw new Error("Illegal Parameter")}else o=l[0]instanceof f?m.fromJSON(l[0].toJSON()):i.fixSpatialReference(new f(JSON.parse(l[0])),e.spatialReference);if(null!==o&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return i.fixNullGeometry(o)}))},e.multipoint=function(e,t){return h(e,t,(function(t,a,l){i.pcCheck(l,1,1);let f=null;if(l[0]instanceof r){if(f=i.fixSpatialReference(n.parseGeometryFromDictionary(l[0]),e.spatialReference),f instanceof o==!1)throw new Error("Illegal Parameter")}else f=l[0]instanceof o?m.fromJSON(l[0].toJSON()):i.fixSpatialReference(new o(JSON.parse(l[0])),e.spatialReference);if(null!==f&&!1===f.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return i.fixNullGeometry(f)}))},e.extent=function(e,t){return h(e,t,(function(t,l,u){u=i.autoCastFeatureToGeometry(u),i.pcCheck(u,1,1);let g=null;if(u[0]instanceof r)g=i.fixSpatialReference(n.parseGeometryFromDictionary(u[0]),e.spatialReference);else if(u[0]instanceof f){const e={xmin:u[0].x,ymin:u[0].y,xmax:u[0].x,ymax:u[0].y,spatialReference:u[0].spatialReference.toJSON()},r=u[0];r.hasZ?(e.zmin=r.z,e.zmax=r.z):r.hasM&&(e.mmin=r.m,e.mmax=r.m),g=m.fromJSON(e)}else g=u[0]instanceof s||u[0]instanceof c||u[0]instanceof o?m.fromJSON(u[0].extent.toJSON()):u[0]instanceof a?m.fromJSON(u[0].toJSON()):i.fixSpatialReference(new a(JSON.parse(u[0])),e.spatialReference);if(null!==g&&!1===g.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return i.fixNullGeometry(g)}))},e.geometry=function(e,t){return h(e,t,(function(t,a,l){i.pcCheck(l,1,1);let o=null;if(null===l[0])return null;if(o=p(l[0])?i.fixSpatialReference(l[0].geometry(),e.spatialReference):l[0]instanceof r?i.fixSpatialReference(n.parseGeometryFromDictionary(l[0]),e.spatialReference):i.fixSpatialReference(m.fromJSON(JSON.parse(l[0])),e.spatialReference),null!==o&&!1===o.spatialReference.equals(e.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return i.fixNullGeometry(o)}))},e.setgeometry=function(e,r){return h(e,r,(function(e,r,n){if(i.pcCheck(n,2,2),!p(n[0]))throw new Error("Illegal Argument");if(!0===n[0].immutable)throw new Error("Feature is Immutable");if(!(n[1]instanceof l||null===n[1]))throw new Error("Illegal Argument");return n[0]._geometry=n[1],i.voidOperation}))},e.feature=function(e,t){return h(e,t,(function(t,a,o){if(0===o.length)throw new Error("Missing Parameters");let f=null;if(1===o.length)if(i.isString(o[0]))f=n.fromJson(JSON.parse(o[0]));else if(p(o[0]))f=n.createFromArcadeFeature(o[0]);else if(o[0]instanceof l)f=n.createFromGraphicLikeObject(o[0],null,null);else{if(!(o[0]instanceof r))throw new Error("Illegal Argument");{let e=o[0].hasField("geometry")?o[0].field("geometry"):null,t=o[0].hasField("attributes")?o[0].field("attributes"):null;null!==e&&e instanceof r&&(e=n.parseGeometryFromDictionary(e)),null!==t&&(t=n.parseAttributesFromDictionary(t)),f=n.createFromGraphicLikeObject(e,t,null)}}else if(2===o.length){let e=null,t=null;if(null!==o[0])if(o[0]instanceof l)e=o[0];else{if(!(e instanceof r))throw new Error("Illegal Argument");e=n.parseGeometryFromDictionary(o[0])}if(null!==o[1]){if(!(o[1]instanceof r))throw new Error("Illegal Argument");t=n.parseAttributesFromDictionary(o[1])}f=n.createFromGraphicLikeObject(e,t,null)}else{let e=null;const t={};if(null!==o[0])if(o[0]instanceof l)e=o[0];else{if(!(e instanceof r))throw new Error("Illegal Argument");e=n.parseGeometryFromDictionary(o[0])}for(let r=1;r<o.length;r+=2){const e=i.toString(o[r]),n=o[r+1];if(!(null==n||i.isString(n)||isNaN(n)||i.isDate(n)||i.isNumber(n)||i.isBoolean(n)))throw new Error("Illegal Argument");if(i.isFunctionParameter(n)||!1===i.isSimpleType(n))throw new Error("Illegal Argument");n===i.voidOperation?t[e]=null:t[e]=n}f=n.createFromGraphicLikeObject(e,t,null)}return f._geometry=i.fixSpatialReference(f.geometry(),e.spatialReference),f.immutable=!1,f}))},e.dictionary=function(e,n){return h(e,n,(function(e,n,t){if(0===t.length){const e=new r;return e.immutable=!1,e}if(1===t.length&&i.isString(t[0]))try{const e=JSON.parse(t[0]),n=r.convertObjectToArcadeDictionary(e,!1);return n.immutable=!1,n}catch(o){throw new Error("Missing Parameters or Illegal Json")}if(t.length%2!=0)throw new Error("Missing Parameters");const a={};for(let r=0;r<t.length;r+=2){const e=i.toString(t[r]),n=t[r+1];if(!(null==n||i.isString(n)||isNaN(n)||i.isDate(n)||i.isNumber(n)||i.isBoolean(n)||i.isArray(n)||i.isImmutableArray(n)))throw new Error("Illegal Argument");if(i.isFunctionParameter(n))throw new Error("Illegal Argument");n===i.voidOperation?a[e]=null:a[e]=n}const l=new r(a);return l.immutable=!1,l}))},e.haskey=function(e,n){return h(e,n,(function(e,n,t){i.pcCheck(t,2,2);const a=i.toString(t[1]);if(p(t[0]))return t[0].hasField(a);if(t[0]instanceof r)return t[0].hasField(a);throw new Error("Illegal Argument")}))},e.indexof=function(e,r){return h(e,r,(function(e,r,n){i.pcCheck(n,2,2);const t=n[1];if(i.isArray(n[0])){for(let e=0;e<n[0].length;e++)if(i.equalityTest(t,n[0][e]))return e;return-1}if(i.isImmutableArray(n[0])){const e=n[0].length();for(let r=0;r<e;r++)if(i.equalityTest(t,n[0].get(r)))return r;return-1}throw new Error("Illegal Argument")}))},e.angle=function(e,r){return h(e,r,(function(e,r,n){if(n=i.autoCastFeatureToGeometry(n),i.pcCheck(n,2,3),!(n[0]instanceof f))throw new Error("Illegal Argument");if(!(n[1]instanceof f))throw new Error("Illegal Argument");if(n.length>2&&!(n[2]instanceof f))throw new Error("Illegal Argument");return 2===n.length?u.angle2D(n[0],n[1]):u.angleBetween2D(n[0],n[1],n[2])}))},e.bearing=function(e,r){return h(e,r,(function(e,r,n){if(n=i.autoCastFeatureToGeometry(n),i.pcCheck(n,2,3),!(n[0]instanceof f))throw new Error("Illegal Argument");if(!(n[1]instanceof f))throw new Error("Illegal Argument");if(n.length>2&&!(n[2]instanceof f))throw new Error("Illegal Argument");return 2===n.length?u.bearing2D(n[0],n[1]):u.bearingBetween2D(n[0],n[1],n[2])}))},e.isselfintersecting=function(e,r){return h(e,r,(function(r,n,t){t=i.autoCastFeatureToGeometry(t),i.pcCheck(t,1,1);let a=t[0];if(a instanceof s)return a.isSelfIntersecting;if(a instanceof c)return a=a.paths,u.pathsSelfIntersecting(a);if(a instanceof o){const e=a.points;for(let r=0;r<e.length;r++)for(let n=0;n<e.length;n++)if(n!==r){let t=!0;for(let i=0;i<e[r].length;i++)if(e[r][i]!==e[n][i]){t=!1;break}if(!0===t)return!0}}return!(!i.isArray(a)&&!i.isImmutableArray(a))&&(a=i.autoCastArrayOfPointsToPolyline(a,e.spatialReference),null!==a&&(a=a.paths),u.pathsSelfIntersecting(a))}))}}e.registerFunctions=h,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
