// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.41/esri/copyright.txt for details.

define(["require","exports","../polyfill/tsSupport/awaiter","../polyfill/tsSupport/generator","../../kernel","../kernel","../languageUtils","./centroid","../../geometry/Extent","../../geometry/Geometry","../../geometry/geometryEngineAsync","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/jsonUtils"],(function(n,e,t,r,o,i,a,u,l,s,c,f,d,g,m,y){"use strict";function h(n){return 0===o.version.indexOf("4.")?g.fromExtent(n):new g({spatialReference:n.spatialReference,rings:[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]})}function A(n){if(a.pcCheck(n,2,2),n[0]instanceof s&&n[1]instanceof s);else if(n[0]instanceof s&&null===n[1]);else if(n[1]instanceof s&&null===n[0]);else if(null!==n[0]||null!==n[1])throw new Error("Illegal Argument")}Object.defineProperty(e,"__esModule",{value:!0}),e.registerFunctions=void 0,e.registerFunctions=function(n){"async"===n.mode&&(n.functions.disjoint=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null===t[0]||null===t[1]||c.disjoint(t[0],t[1])}))},n.functions.intersects=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.intersects(t[0],t[1])}))},n.functions.touches=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.touches(t[0],t[1])}))},n.functions.crosses=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.crosses(t[0],t[1])}))},n.functions.within=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.within(t[0],t[1])}))},n.functions.contains=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.contains(t[0],t[1])}))},n.functions.overlaps=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.overlaps(t[0],t[1])}))},n.functions.equals=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return a.pcCheck(t,2,2),t[0]===t[1]||(t[0]instanceof s&&t[1]instanceof s?c.equals(t[0],t[1]):!(!a.isDate(t[0])||!a.isDate(t[1]))&&t[0].getTime()===t[1].getTime())}))},n.functions.relate=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,3,3),t[0]instanceof s&&t[1]instanceof s)return c.relate(t[0],t[1],a.toString(t[2]));if(t[0]instanceof s&&null===t[1])return!1;if(t[1]instanceof s&&null===t[0])return!1;if(null===t[0]&&null===t[1])return!1;throw new Error("Illegal Argument")}))},n.functions.intersection=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null===t[0]||null===t[1]?null:c.intersect(t[0],t[1])}))},n.functions.union=function(e,t){return n.standardFunctionAsync(e,t,(function(n,t,r){var o=[];if(0===(r=a.autoCastFeatureToGeometry(r)).length)throw new Error("Function called with wrong number of Parameters");if(1===r.length)if(a.isArray(r[0])){for(var u=a.autoCastFeatureToGeometry(r[0]),l=0;l<u.length;l++)if(null!==u[l]){if(!(u[l]instanceof s))throw new Error("Illegal Argument");o.push(u[l])}}else{if(!a.isImmutableArray(r[0])){if(r[0]instanceof s)return a.fixSpatialReference(i.cloneGeometry(r[0]),e.spatialReference);if(null===r[0])return null;throw new Error("Illegal Argument")}var f=a.autoCastFeatureToGeometry(r[0].toArray());for(l=0;l<f.length;l++)if(null!==f[l]){if(!(f[l]instanceof s))throw new Error("Illegal Argument");o.push(f[l])}}else for(l=0;l<r.length;l++)if(null!==r[l]){if(!(r[l]instanceof s))throw new Error("Illegal Argument");o.push(r[l])}return 0===o.length?null:c.union(o)}))},n.functions.difference=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null!==t[0]&&null===t[1]?i.cloneGeometry(t[0]):null===t[0]?null:c.difference(t[0],t[1])}))},n.functions.symmetricdifference=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){return A(t=a.autoCastFeatureToGeometry(t)),null===t[0]&&null===t[1]?null:null===t[0]?i.cloneGeometry(t[1]):null===t[1]?i.cloneGeometry(t[0]):c.symmetricDifference(t[0],t[1])}))},n.functions.clip=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,2),!(t[1]instanceof l)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return null;if(!(t[0]instanceof s))throw new Error("Illegal Argument");return null===t[1]?null:c.clip(t[0],t[1])}))},n.functions.cut=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,2),!(t[1]instanceof m)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return[];if(!(t[0]instanceof s))throw new Error("Illegal Argument");return null===t[1]?[i.cloneGeometry(t[0])]:c.cut(t[0],t[1])}))},n.functions.area=function(e,o){return n.standardFunctionAsync(e,o,(function(n,o,u){return t(this,void 0,void 0,(function(){var n,t;return r(this,(function(r){switch(r.label){case 0:return a.pcCheck(u,1,2),null===(u=a.autoCastFeatureToGeometry(u))[0]?[2,0]:a.isFeatureSet(u[0])?[4,u[0].sumArea(i.convertSquareUnitsToCode(a.defaultUndefined(u[1],-1)),!1,e.abortSignal)]:[3,2];case 1:if(n=r.sent(),e.abortSignal.aborted)throw new Error("Operation has been cancelled.");return[2,n];case 2:if(a.isArray(u[0])||a.isImmutableArray(u[0]))return null===(t=a.autoCastArrayOfPointsToPolygon(u[0],e.spatialReference))?[2,0]:[2,c.planarArea(t,i.convertSquareUnitsToCode(a.defaultUndefined(u[1],-1)))];if(!(u[0]instanceof s))throw new Error("Illegal Argument");return[2,c.planarArea(u[0],i.convertSquareUnitsToCode(a.defaultUndefined(u[1],-1)))]}}))}))}))},n.functions.areageodetic=function(e,o){return n.standardFunctionAsync(e,o,(function(n,o,u){return t(this,void 0,void 0,(function(){var n,t;return r(this,(function(r){switch(r.label){case 0:return a.pcCheck(u,1,2),null===(u=a.autoCastFeatureToGeometry(u))[0]?[2,0]:a.isFeatureSet(u[0])?[4,u[0].sumArea(i.convertSquareUnitsToCode(a.defaultUndefined(u[1],-1)),!0,e.abortSignal)]:[3,2];case 1:if(n=r.sent(),e.abortSignal.aborted)throw new Error("Operation has been cancelled.");return[2,n];case 2:if(a.isArray(u[0])||a.isImmutableArray(u[0]))return null===(t=a.autoCastArrayOfPointsToPolygon(u[0],e.spatialReference))?[2,0]:[2,c.geodesicArea(t,i.convertSquareUnitsToCode(a.defaultUndefined(u[1],-1)))];if(!(u[0]instanceof s))throw new Error("Illegal Argument");return[2,c.geodesicArea(u[0],i.convertSquareUnitsToCode(a.defaultUndefined(u[1],-1)))]}}))}))}))},n.functions.length=function(e,o){return n.standardFunctionAsync(e,o,(function(n,o,u){return t(this,void 0,void 0,(function(){var n,t;return r(this,(function(r){switch(r.label){case 0:return a.pcCheck(u,1,2),null===(u=a.autoCastFeatureToGeometry(u))[0]?[2,0]:a.isFeatureSet(u[0])?[4,u[0].sumLength(i.convertLinearUnitsToCode(a.defaultUndefined(u[1],-1)),!1,e.abortSignal)]:[3,2];case 1:if(n=r.sent(),e.abortSignal.aborted)throw new Error("Operation has been cancelled.");return[2,n];case 2:if(a.isArray(u[0])||a.isImmutableArray(u[0]))return null===(t=a.autoCastArrayOfPointsToPolyline(u[0],e.spatialReference))?[2,0]:[2,c.planarLength(t,i.convertLinearUnitsToCode(a.defaultUndefined(u[1],-1)))];if(!(u[0]instanceof s))throw new Error("Illegal Argument");return[2,c.planarLength(u[0],i.convertLinearUnitsToCode(a.defaultUndefined(u[1],-1)))]}}))}))}))},n.functions.length3d=function(e,t){return n.standardFunctionAsync(e,t,(function(n,t,r){if(a.pcCheck(r,1,2),null===(r=a.autoCastFeatureToGeometry(r))[0])return 0;if(a.isArray(r[0])||a.isImmutableArray(r[0])){var o=a.autoCastArrayOfPointsToPolyline(r[0],e.spatialReference);return null===o?0:c.planarLength(o,i.convertLinearUnitsToCode(a.defaultUndefined(r[1],-1)))}if(!(r[0]instanceof s))throw new Error("Illegal Argument");return c.planarLength(r[0],i.convertLinearUnitsToCode(a.defaultUndefined(r[1],-1)))}))},n.functions.lengthgeodetic=function(e,o){return n.standardFunctionAsync(e,o,(function(n,o,u){return t(this,void 0,void 0,(function(){var n,t;return r(this,(function(r){switch(r.label){case 0:return a.pcCheck(u,1,2),null===(u=a.autoCastFeatureToGeometry(u))[0]?[2,0]:a.isFeatureSet(u[0])?[4,u[0].sumLength(i.convertLinearUnitsToCode(a.defaultUndefined(u[1],-1)),!0,e.abortSignal)]:[3,2];case 1:if(n=r.sent(),e.abortSignal.aborted)throw new Error("Operation has been cancelled.");return[2,n];case 2:if(a.isArray(u[0])||a.isImmutableArray(u[0]))return null===(t=a.autoCastArrayOfPointsToPolyline(u[0],e.spatialReference))?[2,0]:[2,c.geodesicLength(t,i.convertLinearUnitsToCode(a.defaultUndefined(u[1],-1)))];if(!(u[0]instanceof s))throw new Error("Illegal Argument");return[2,c.geodesicLength(u[0],i.convertLinearUnitsToCode(a.defaultUndefined(u[1],-1)))]}}))}))}))},n.functions.distance=function(e,t){return n.standardFunctionAsync(e,t,(function(n,t,r){r=a.autoCastFeatureToGeometry(r),a.pcCheck(r,2,3);var o=r[0];(a.isArray(r[0])||a.isImmutableArray(r[0]))&&(o=a.autoCastArrayOfPointsToMultiPoint(r[0],e.spatialReference));var u=r[1];if((a.isArray(r[1])||a.isImmutableArray(r[1]))&&(u=a.autoCastArrayOfPointsToMultiPoint(r[1],e.spatialReference)),!(o instanceof s))throw new Error("Illegal Argument");if(!(u instanceof s))throw new Error("Illegal Argument");return c.distance(o,u,i.convertLinearUnitsToCode(a.defaultUndefined(r[2],-1)))}))},n.functions.distancegeodetic=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,3);var r=t[0],o=t[1];if(!(r instanceof d))throw new Error("Illegal Argument");if(!(o instanceof d))throw new Error("Illegal Argument");var u=new m({paths:[],spatialReference:r.spatialReference});return u.addPath([r,o]),c.geodesicLength(u,i.convertLinearUnitsToCode(a.defaultUndefined(t[2],-1)))}))},n.functions.densify=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof s))throw new Error("Illegal Argument");var r=a.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");if(r<=0)throw new Error("Illegal Argument");return t[0]instanceof g||t[0]instanceof m?c.densify(t[0],r,i.convertLinearUnitsToCode(a.defaultUndefined(t[2],-1))):t[0]instanceof l?c.densify(h(t[0]),r,i.convertLinearUnitsToCode(a.defaultUndefined(t[2],-1))):t[0]}))},n.functions.densifygeodetic=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof s))throw new Error("Illegal Argument");var r=a.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");if(r<=0)throw new Error("Illegal Argument");return t[0]instanceof g||t[0]instanceof m?c.geodesicDensify(t[0],r,i.convertLinearUnitsToCode(a.defaultUndefined(t[2],-1))):t[0]instanceof l?c.geodesicDensify(h(t[0]),r,i.convertLinearUnitsToCode(a.defaultUndefined(t[2],-1))):t[0]}))},n.functions.generalize=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,4),null===t[0])return null;if(!(t[0]instanceof s))throw new Error("Illegal Argument");var r=a.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");return c.generalize(t[0],r,a.toBoolean(a.defaultUndefined(t[2],!0)),i.convertLinearUnitsToCode(a.defaultUndefined(t[3],-1)))}))},n.functions.buffer=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof s))throw new Error("Illegal Argument");var r=a.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");return 0===r?i.cloneGeometry(t[0]):c.buffer(t[0],r,i.convertLinearUnitsToCode(a.defaultUndefined(t[2],-1)))}))},n.functions.buffergeodetic=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof s))throw new Error("Illegal Argument");var r=a.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");return 0===r?i.cloneGeometry(t[0]):c.geodesicBuffer(t[0],r,i.convertLinearUnitsToCode(a.defaultUndefined(t[2],-1)))}))},n.functions.offset=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,6),null===t[0])return null;if(!(t[0]instanceof g||t[0]instanceof m))throw new Error("Illegal Argument");var r=a.toNumber(t[1]);if(isNaN(r))throw new Error("Illegal Argument");var o=a.toNumber(a.defaultUndefined(t[4],10));if(isNaN(o))throw new Error("Illegal Argument");var u=a.toNumber(a.defaultUndefined(t[5],0));if(isNaN(u))throw new Error("Illegal Argument");return c.offset(t[0],r,i.convertLinearUnitsToCode(a.defaultUndefined(t[2],-1)),a.toString(a.defaultUndefined(t[3],"round")).toLowerCase(),o,u)}))},n.functions.rotate=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,2,3);var r=t[0];if(null===r)return null;if(!(r instanceof s))throw new Error("Illegal Argument");r instanceof l&&(r=g.fromExtent(r));var o=a.toNumber(t[1]);if(isNaN(o))throw new Error("Illegal Argument");var i=a.defaultUndefined(t[2],null);if(null===i)return c.rotate(r,o);if(i instanceof d)return c.rotate(r,o,i);throw new Error("Illegal Argument")}))},n.functions.centroid=function(e,t){return n.standardFunctionAsync(e,t,(function(n,t,r){if(r=a.autoCastFeatureToGeometry(r),a.pcCheck(r,1,1),null===r[0])return null;var o=r[0];if((a.isArray(r[0])||a.isImmutableArray(r[0]))&&(o=a.autoCastArrayOfPointsToMultiPoint(r[0],e.spatialReference)),null===o)return null;if(!(o instanceof s))throw new Error("Illegal Argument");return o instanceof d?a.fixSpatialReference(i.cloneGeometry(r[0]),e.spatialReference):o instanceof g?o.getCentroid():o instanceof m?u.centroidPolyline(o):o instanceof f?u.centroidMultiPoint(o):o instanceof l?o.getCenter():null}))},n.functions.multiparttosinglepart=function(e,o){return n.standardFunctionAsync(e,o,(function(n,o,u){return t(this,void 0,void 0,(function(){var n,t,o,h,A,w,p,C,F,T,v;return r(this,(function(r){switch(r.label){case 0:if(u=a.autoCastFeatureToGeometry(u),a.pcCheck(u,1,1),n=[],null===u[0])return[2,null];if(!(u[0]instanceof s))throw new Error("Illegal Argument");return u[0]instanceof d?[2,[a.fixSpatialReference(i.cloneGeometry(u[0]),e.spatialReference)]]:u[0]instanceof l?[2,[a.fixSpatialReference(i.cloneGeometry(u[0]),e.spatialReference)]]:[4,c.simplify(u[0])];case 1:if((t=r.sent())instanceof g){for(o=[],h=[],v=0;v<t.rings.length;v++)t.isClockwise(t.rings[v])?(A=y.fromJson({rings:[t.rings[v]],hasZ:!0===t.hasZ,hazM:!0===t.hasM,spatialReference:t.spatialReference.toJson()}),o.push(A)):h.push({ring:t.rings[v],pt:t.getPoint(v,0)});for(w=0;w<h.length;w++)for(p=0;p<o.length;p++)if(o[p].contains(h[w].pt)){o[p].addRing(h[w].ring);break}return[2,o]}if(t instanceof m){for(C=[],v=0;v<t.paths.length;v++)F=y.fromJson({paths:[t.paths[v]],hasZ:!0===t.hasZ,hazM:!0===t.hasM,spatialReference:t.spatialReference.toJson()}),C.push(F);return[2,C]}if(u[0]instanceof f){for(T=a.fixSpatialReference(i.cloneGeometry(u[0]),e.spatialReference),v=0;v<T.points.length;v++)n.push(T.getPoint(v));return[2,n]}return[2,null]}}))}))}))},n.functions.issimple=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,1,1),null===t[0])return!0;if(!(t[0]instanceof s))throw new Error("Illegal Argument");return c.isSimple(t[0])}))},n.functions.simplify=function(e,t){return n.standardFunctionAsync(e,t,(function(n,e,t){if(t=a.autoCastFeatureToGeometry(t),a.pcCheck(t,1,1),null===t[0])return null;if(!(t[0]instanceof s))throw new Error("Illegal Argument");return c.simplify(t[0])}))})}}));