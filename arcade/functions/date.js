// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.42/esri/copyright.txt for details.

define(["require","exports","../languageUtils","../executionError","../../libs/luxon/luxon","dojo/_base/kernel"],(function(e,t,n,r,u,a){"use strict";function o(e){var t=new Date(e.getTime()),n=t.getFullYear(),r=new Date(0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);var u=c(r),a=new Date(0);a.setFullYear(n,0,4),a.setHours(0,0,0,0);var o=c(a);return t.getTime()>=u.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function c(e){var t=new Date(e.getTime()),n=t.getDay(),r=(n<1?7:0)+n-1;return t.setDate(t.getDate()-r),t.setHours(0,0,0,0),t}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=void 0;var i=[0,31,59,90,120,151,181,212,243,273,304,334],s=[0,31,60,91,121,152,182,213,244,274,305,335];function l(e){return null===e?e:isNaN(e.getTime())?null:e}t.registerFunctions=function(e,t){e.today=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,0,0,e,r);var o=new Date;return o.setHours(0,0,0,0),o}))},e.now=function(e,r){return t(e,r,(function(t,u,a){return n.pcCheck(a,0,0,e,r),new Date}))},e.timestamp=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,0,0,e,r);var o=new Date;return o=new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds())}))},e.toutc=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?null:new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds())}))},e.tolocal=function(e,r){return t(e,r,(function(t,a,o){n.pcCheck(o,1,1,e,r);var c=n.toDate(o[0]);return null===c?null:u.DateTime.utc(c.getFullYear(),c.getMonth()+1,c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds()).toJSDate()}))},e.day=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?NaN:o.getDate()}))},e.month=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?NaN:o.getMonth()}))},e.year=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?NaN:o.getFullYear()}))},e.hour=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?NaN:o.getHours()}))},e.second=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?NaN:o.getSeconds()}))},e.millisecond=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?NaN:o.getMilliseconds()}))},e.minute=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?NaN:o.getMinutes()}))},e.week=function(e,u){return t(e,u,(function(t,a,o){n.pcCheck(o,1,2,e,u);var c=n.toDate(o[0]);if(null===c)return NaN;var l=n.toNumber(n.defaultUndefined(o[1],0));if(l<0||l>6)throw new r.ArcadeExecutionError(e,r.ExecutionErrorCodes.InvalidParameter,u);var f=c.getDate(),m=c.getMonth(),d=c.getFullYear(),g=c.getDay(),N=function(e,t,n){return e+(function(e){return e%4==0&&(e%100!=0||e%400==0)}(n)?s:i)[t]}(f,m,d)-1,h=Math.floor(N/7);return g-l+(g-l<0?7:0)<N-7*h?h+1:h}))},e.weekday=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?NaN:o.getDay()}))},e.isoweekday=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);if(null===o)return NaN;var c=o.getDay();return 0===c&&(c=7),c}))},e.isomonth=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var o=n.toDate(a[0]);return null===o?NaN:o.getMonth()+1}))},e.isoweek=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var i=n.toDate(a[0]);if(null===i)return NaN;var s,l,f,m=c(i).getTime()-(s=i,l=o(s),f=new Date(0),f.setFullYear(l,0,4),f.setHours(0,0,0,0),c(f)).getTime();return Math.round(m/6048e5)+1}))},e.isoyear=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,1,1,e,r);var c=n.toDate(a[0]);return null===c?NaN:o(c)}))},e.date=function(e,r){return t(e,r,(function(t,o,c){if(n.pcCheck(c,0,7,e,r),3===c.length)return l(new Date(n.toNumber(c[0]),n.toNumber(c[1]),n.toNumber(c[2]),0,0,0,0));if(4===c.length)return l(new Date(n.toNumber(c[0]),n.toNumber(c[1]),n.toNumber(c[2]),n.toNumber(c[3]),0,0,0));if(5===c.length)return l(new Date(n.toNumber(c[0]),n.toNumber(c[1]),n.toNumber(c[2]),n.toNumber(c[3]),n.toNumber(c[4]),0,0));if(6===c.length)return l(new Date(n.toNumber(c[0]),n.toNumber(c[1]),n.toNumber(c[2]),n.toNumber(c[3]),n.toNumber(c[4]),n.toNumber(c[5]),0));if(7===c.length)return l(new Date(n.toNumber(c[0]),n.toNumber(c[1]),n.toNumber(c[2]),n.toNumber(c[3]),n.toNumber(c[4]),n.toNumber(c[5]),n.toNumber(c[6])));if(2===c.length){var i=n.toString(c[1]);if(""===i)return null;var s=void 0;return(s="X"===(i=n.standardiseDateFormat(i))?u.DateTime.fromSeconds(n.toNumber(c[0])):"x"===i?u.DateTime.fromMillis(n.toNumber(c[0])):u.DateTime.fromFormat(n.toString(c[0]),i,{locale:a.locale,numberingSystem:"latn"})).isValid?s.toJSDate():null}if(1===c.length){if(n.isString(c[0])){if(""===c[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))return null;if(!0===/^[0-9][0-9][0-9][0-9]$/.test(c[0]))return n.toDate(c[0]+"-01-01")}var f=n.toNumber(c[0]);return!1===isNaN(f)?l(new Date(f)):n.toDate(c[0])}return 0===c.length?new Date:void 0}))},e.datediff=function(e,r){return t(e,r,(function(t,u,a){n.pcCheck(a,2,3,e,r);var o=n.toDateTime(a[0]),c=n.toDateTime(a[1]);if(null===o||null===c)return NaN;switch(n.toString(a[2]).toLowerCase()){case"days":case"day":case"d":return o.diff(c,"days").days;case"months":case"month":return o.diff(c,"months").months;case"minutes":case"minute":case"m":return"M"===a[2]?o.diff(c,"months").months:o.diff(c,"minutes").minutes;case"seconds":case"second":case"s":return o.diff(c,"seconds").seconds;case"milliseconds":case"millisecond":case"ms":return o.diff(c).milliseconds;case"hours":case"hour":case"h":return o.diff(c,"hours").hours;case"years":case"year":case"y":return o.diff(c,"years").years;default:return o.diff(c).milliseconds}}))},e.dateadd=function(e,r){return t(e,r,(function(t,u,a){var o;n.pcCheck(a,2,3,e,r);var c=n.toDateTime(a[0]);if(null===c)return null;var i=n.toNumber(a[1]);if(isNaN(i))return c.toJSDate();var s="milliseconds";switch(n.toString(a[2]).toLowerCase()){case"days":case"day":case"d":s="days",i=n.absRound(i);break;case"months":case"month":s="months",i=n.absRound(i);break;case"minutes":case"minute":case"m":s="M"===a[2]?"months":"minutes";break;case"seconds":case"second":case"s":s="seconds";break;case"milliseconds":case"millisecond":case"ms":s="milliseconds";break;case"hours":case"hour":case"h":s="hours";break;case"years":case"year":case"y":s="years"}return c.plus((o={},o[s]=i,o)).toJSDate()}))}}}));