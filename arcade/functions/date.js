// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.37/esri/copyright.txt for details.

define(["require","exports","../languageUtils"],(function(e,t,n){"use strict";function r(e){var t=new Date(e.getTime()),n=t.getFullYear(),r=new Date(0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);var a=u(r),o=new Date(0);o.setFullYear(n,0,4),o.setHours(0,0,0,0);var c=u(o);return t.getTime()>=a.getTime()?n+1:t.getTime()>=c.getTime()?n:n-1}function u(e){var t=new Date(e.getTime()),n=t.getDay(),r=(n<1?7:0)+n-1;return t.setDate(t.getDate()-r),t.setHours(0,0,0,0),t}function a(e){return null===e?e:isNaN(e.getTime())?null:e}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=void 0,t.registerFunctions=function(e,t){e.today=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,0,0);var u=new Date;return u.setHours(0,0,0,0),u}))},e.now=function(e,r){return t(e,r,(function(e,t,r){return n.pcCheck(r,0,0),new Date}))},e.timestamp=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,0,0);var u=new Date;return u=new Date(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate(),u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds())}))},e.toutc=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?null:new Date(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate(),u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds())}))},e.tolocal=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?null:n.MomentLibrary.Moment.utc([u.getFullYear(),u.getMonth(),u.getDate(),u.getHours(),u.getMinutes(),u.getSeconds(),u.getMilliseconds()]).toDate()}))},e.day=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getDate()}))},e.month=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getMonth()}))},e.year=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getFullYear()}))},e.hour=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getHours()}))},e.second=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getSeconds()}))},e.millisecond=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getMilliseconds()}))},e.minute=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getMinutes()}))},e.weekday=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getDay()}))},e.isoweekday=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);if(null===u)return NaN;var a=u.getDay();return 0===a&&(a=7),a}))},e.isomonth=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getMonth()+1}))},e.isoweek=function(e,a){return t(e,a,(function(e,t,a){n.pcCheck(a,1,1);var o=n.toDate(a[0]);if(null===o)return NaN;var c,s,i,l=u(o).getTime()-(c=o,s=r(c),i=new Date(0),i.setFullYear(s,0,4),i.setHours(0,0,0,0),u(i)).getTime();return Math.round(l/6048e5)+1}))},e.isoyear=function(e,u){return t(e,u,(function(e,t,u){n.pcCheck(u,1,1);var a=n.toDate(u[0]);return null===a?NaN:r(a)}))},e.date=function(e,r){return t(e,r,(function(e,t,r){if(n.pcCheck(r,0,7),3===r.length)return a(new Date(n.toNumber(r[0]),n.toNumber(r[1]),n.toNumber(r[2]),0,0,0,0));if(4===r.length)return a(new Date(n.toNumber(r[0]),n.toNumber(r[1]),n.toNumber(r[2]),n.toNumber(r[3]),0,0,0));if(5===r.length)return a(new Date(n.toNumber(r[0]),n.toNumber(r[1]),n.toNumber(r[2]),n.toNumber(r[3]),n.toNumber(r[4]),0,0));if(6===r.length)return a(new Date(n.toNumber(r[0]),n.toNumber(r[1]),n.toNumber(r[2]),n.toNumber(r[3]),n.toNumber(r[4]),n.toNumber(r[5]),0));if(7===r.length)return a(new Date(n.toNumber(r[0]),n.toNumber(r[1]),n.toNumber(r[2]),n.toNumber(r[3]),n.toNumber(r[4]),n.toNumber(r[5]),n.toNumber(r[6])));if(2===r.length){var u=n.toString(r[1]);if(""===u)return null;u=n.standardiseDateFormat(u);var o=n.MomentLibrary.Moment(n.toString(r[0]),u,!0);return!0===o.isValid()?o.toDate():null}if(1===r.length){if(n.isString(r[0])){if(""===r[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))return null;if(!0===/^[0-9][0-9][0-9][0-9]$/.test(r[0]))return n.toDate(r[0]+"-01-01")}var c=n.toNumber(r[0]);return!1===isNaN(c)?a(new Date(c)):n.toDate(r[0])}return 0===r.length?new Date:void 0}))},e.datediff=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,2,3);var u=n.toDateM(r[0]),a=n.toDateM(r[1]);if(null===u||null===a)return NaN;switch(n.toString(r[2]).toLowerCase()){case"days":case"day":case"d":return u.diff(a,"days",!0);case"months":case"month":return u.diff(a,"months",!0);case"minutes":case"minute":case"m":return"M"===r[2]?u.diff(a,"months",!0):u.diff(a,"minutes",!0);case"seconds":case"second":case"s":return u.diff(a,"seconds",!0);case"milliseconds":case"millisecond":case"ms":return u.diff(a);case"hours":case"hour":case"h":return u.diff(a,"hours",!0);case"years":case"year":case"y":return u.diff(a,"years",!0);default:return u.diff(a)}}))},e.dateadd=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,2,3);var u=n.toDateM(r[0]);if(null===u)return null;var a="milliseconds";switch(n.toString(r[2]).toLowerCase()){case"days":case"day":case"d":a="days";break;case"months":case"month":a="months";break;case"minutes":case"minute":case"m":a="M"===r[2]?"months":"minutes";break;case"seconds":case"second":case"s":a="seconds";break;case"milliseconds":case"millisecond":case"ms":a="milliseconds";break;case"hours":case"hour":case"h":a="hours";break;case"years":case"year":case"y":a="years"}return u.add(n.toNumber(r[1]),a),u.toDate()}))}}}));