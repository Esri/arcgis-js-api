// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.43/esri/copyright.txt for details.

define(["require","exports","../ArcadeDate","../languageUtils","../executionError","../../libs/luxon/luxon","dojo/_base/kernel"],(function(e,t,n,r,a,o,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=void 0;var i=[0,31,59,90,120,151,181,212,243,273,304,334],c=[0,31,60,91,121,152,182,213,244,274,305,335];function l(e){return null===e?e:!1===e.isValid?null:e}function d(e,t){return""===e||"default"===e.toLowerCase().trim()?r.defaultTimeZone(t):e}t.registerFunctions=function(e,t){e.today=function(e,a){return t(e,a,(function(t,o,u){r.pcCheck(u,0,0,e,a);var i=new Date;return i.setHours(0,0,0,0),n.ArcadeDate.dateJSAndZoneToArcadeDate(i,r.defaultTimeZone(e))}))},e.changetimezone=function(e,a){return t(e,a,(function(t,o,u){r.pcCheck(u,2,2,e,a);var i=r.toDate(u[0],r.defaultTimeZone(e));if(null===i)return null;var c=n.ArcadeDate.arcadeDateAndZoneToArcadeDate(i,d(r.toString(u[1]),e));return!1===c.isValid?null:c}))},e.timezone=function(e,a){return t(e,a,(function(t,o,u){r.pcCheck(u,1,2,e,a);var i=r.toDate(u[0],r.defaultTimeZone(e));if(null===i)return null;var c=i.timeZone;return"system"===c?n.ArcadeDate.systemTimeZoneCanonicalName:c}))},e.timezoneoffset=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?null:u.timeZoneOffset}))},e.now=function(e,a){return t(e,a,(function(t,o,u){r.pcCheck(u,0,0,e,a);var i=n.ArcadeDate.nowToArcadeDate(r.defaultTimeZone(e));return!1===i.isValid?null:i}))},e.timestamp=function(e,a){return t(e,a,(function(t,o,u){r.pcCheck(u,0,0,e,a);var i=n.ArcadeDate.nowUTCToArcadeDate();return!1===i.isValid?null:i}))},e.toutc=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?null:u.toUTC()}))},e.tolocal=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?null:u.toLocal()}))},e.day=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.day}))},e.month=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.monthJS}))},e.year=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.year}))},e.hour=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.hour}))},e.second=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.second}))},e.millisecond=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.millisecond}))},e.minute=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.minute}))},e.week=function(e,n){return t(e,n,(function(t,o,u){r.pcCheck(u,1,2,e,n);var l=r.toDate(u[0],r.defaultTimeZone(e));if(null===l)return NaN;var d=r.toNumber(r.defaultUndefined(u[1],0));if(d<0||d>6)throw new a.ArcadeExecutionError(e,a.ExecutionErrorCodes.InvalidParameter,n);var f=l.day,s=l.monthJS,m=l.year,N=l.dayOfWeekJS,D=function(e,t,n){return e+(function(e){return e%4==0&&(e%100!=0||e%400==0)}(n)?c:i)[t]}(f,s,m)-1,h=Math.floor(D/7);return N-d+(N-d<0?7:0)<D-7*h?h+1:h}))},e.weekday=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.dayOfWeekJS}))},e.isoweekday=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.dayOfWeekISO}))},e.isomonth=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.monthISO}))},e.isoweek=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.weekISO}))},e.isoyear=function(e,n){return t(e,n,(function(t,a,o){r.pcCheck(o,1,1,e,n);var u=r.toDate(o[0],r.defaultTimeZone(e));return null===u?NaN:u.yearISO}))},e.date=function(e,a){return t(e,a,(function(t,i,c){if(r.pcCheck(c,0,8,e,a),3===c.length)return l(n.ArcadeDate.fromParts(r.toNumber(c[0]),r.toNumber(c[1])+1,r.toNumber(c[2]),0,0,0,0,r.defaultTimeZone(e)));if(4===c.length)return l(n.ArcadeDate.fromParts(r.toNumber(c[0]),r.toNumber(c[1])+1,r.toNumber(c[2]),r.toNumber(c[3]),0,0,0,r.defaultTimeZone(e)));if(5===c.length)return l(n.ArcadeDate.fromParts(r.toNumber(c[0]),r.toNumber(c[1])+1,r.toNumber(c[2]),r.toNumber(c[3]),r.toNumber(c[4]),0,0,r.defaultTimeZone(e)));if(6===c.length)return l(n.ArcadeDate.fromParts(r.toNumber(c[0]),r.toNumber(c[1])+1,r.toNumber(c[2]),r.toNumber(c[3]),r.toNumber(c[4]),r.toNumber(c[5]),0,r.defaultTimeZone(e)));if(7===c.length)return l(n.ArcadeDate.fromParts(r.toNumber(c[0]),r.toNumber(c[1])+1,r.toNumber(c[2]),r.toNumber(c[3]),r.toNumber(c[4]),r.toNumber(c[5]),r.toNumber(c[6]),r.defaultTimeZone(e)));if(8===c.length)return l(n.ArcadeDate.fromParts(r.toNumber(c[0]),r.toNumber(c[1])+1,r.toNumber(c[2]),r.toNumber(c[3]),r.toNumber(c[4]),r.toNumber(c[5]),r.toNumber(c[6]),d(r.toString(c[7]),e)));if(2===c.length){var f=r.toString(c[1]);if(""===f)return null;var s=void 0;return(s="X"===(f=r.standardiseDateFormat(f))?o.DateTime.fromSeconds(r.toNumber(c[0])):"x"===f?o.DateTime.fromMillis(r.toNumber(c[0])):o.DateTime.fromFormat(r.toString(c[0]),f,{locale:u.locale,numberingSystem:"latn"})).isValid?n.ArcadeDate.dateTimeToArcadeDate(s):null}if(1===c.length){if(r.isString(c[0])){if(""===c[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))return null;if(!0===/^[0-9][0-9][0-9][0-9]$/.test(c[0]))return r.toDate(c[0]+"-01-01",r.defaultTimeZone(e))}var m=r.toNumber(c[0]);return!1===isNaN(m)?(s=o.DateTime.fromMillis(m)).isValid?n.ArcadeDate.dateTimeAndZoneToArcadeDate(s,r.defaultTimeZone(e)):null:r.toDate(c[0],r.defaultTimeZone(e))}return 0===c.length?n.ArcadeDate.nowToArcadeDate(r.defaultTimeZone(e)):null}))},e.datediff=function(e,a){return t(e,a,(function(t,o,u){r.pcCheck(u,2,4,e,a);var i=r.toDate(u[0],r.defaultTimeZone(e)),c=r.toDate(u[1],r.defaultTimeZone(e));if(null===i||null===c)return NaN;var l=r.defaultUndefined(u[3],"");switch(""!==l&&null!==l?(l=r.toString(l),i=n.ArcadeDate.arcadeDateAndZoneToArcadeDate(i,l),c=n.ArcadeDate.arcadeDateAndZoneToArcadeDate(c,l)):i.timeZone!==c.timeZone&&(i.isUnknownTimeZone?i=n.ArcadeDate.arcadeDateAndZoneToArcadeDate(i,c.timeZone):c=(c.isUnknownTimeZone,n.ArcadeDate.arcadeDateAndZoneToArcadeDate(c,i.timeZone))),r.toString(u[2]).toLowerCase()){case"days":case"day":case"d":return i.diff(c,"days");case"months":case"month":return i.diff(c,"months");case"minutes":case"minute":case"m":return"M"===u[2]?i.diff(c,"months"):i.diff(c,"minutes");case"seconds":case"second":case"s":return i.diff(c,"seconds");case"milliseconds":case"millisecond":case"ms":return i.diff(c);case"hours":case"hour":case"h":return i.diff(c,"hours");case"years":case"year":case"y":return i.diff(c,"years");default:return i.diff(c)}}))},e.dateadd=function(e,n){return t(e,n,(function(t,a,o){var u;r.pcCheck(o,2,3,e,n);var i=r.toDate(o[0],r.defaultTimeZone(e));if(null===i)return null;var c=r.toNumber(o[1]);if(isNaN(c))return i;var l="milliseconds";switch(r.toString(o[2]).toLowerCase()){case"days":case"day":case"d":l="days",c=r.absRound(c);break;case"months":case"month":l="months",c=r.absRound(c);break;case"minutes":case"minute":case"m":l="M"===o[2]?"months":"minutes";break;case"seconds":case"second":case"s":l="seconds";break;case"milliseconds":case"millisecond":case"ms":l="milliseconds";break;case"hours":case"hour":case"h":l="hours";break;case"years":case"year":case"y":l="years"}return i.plus(((u={})[l]=c,u))}))}}}));