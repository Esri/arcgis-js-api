// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.38/esri/copyright.txt for details.

define(["require","exports","../languageUtils","../../libs/luxon/luxon","dojo/_base/kernel"],(function(e,t,n,r,u){"use strict";function a(e){var t=new Date(e.getTime()),n=t.getFullYear(),r=new Date(0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);var u=o(r),a=new Date(0);a.setFullYear(n,0,4),a.setHours(0,0,0,0);var s=o(a);return t.getTime()>=u.getTime()?n+1:t.getTime()>=s.getTime()?n:n-1}function o(e){var t=new Date(e.getTime()),n=t.getDay(),r=(n<1?7:0)+n-1;return t.setDate(t.getDate()-r),t.setHours(0,0,0,0),t}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=void 0;var s=[0,31,59,90,120,151,181,212,243,273,304,334],c=[0,31,60,91,121,152,182,213,244,274,305,335];function i(e){return null===e?e:isNaN(e.getTime())?null:e}t.registerFunctions=function(e,t){e.today=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,0,0);var u=new Date;return u.setHours(0,0,0,0),u}))},e.now=function(e,r){return t(e,r,(function(e,t,r){return n.pcCheck(r,0,0),new Date}))},e.timestamp=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,0,0);var u=new Date;return u=new Date(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate(),u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds())}))},e.toutc=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?null:new Date(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate(),u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds())}))},e.tolocal=function(e,u){return t(e,u,(function(e,t,u){n.pcCheck(u,1,1);var a=n.toDate(u[0]);return null===a?null:r.DateTime.utc(a.getFullYear(),a.getMonth()+1,a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()).toJSDate()}))},e.day=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getDate()}))},e.month=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getMonth()}))},e.year=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getFullYear()}))},e.hour=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getHours()}))},e.second=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getSeconds()}))},e.millisecond=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getMilliseconds()}))},e.minute=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getMinutes()}))},e.week=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,2);var u=n.toDate(r[0]);if(null===u)return NaN;var a=n.toNumber(n.defaultUndefined(r[1],0));if(a<0||a>6)throw new Error("Invalid Parameter");var o=u.getDate(),i=u.getMonth(),l=u.getFullYear(),f=u.getDay(),m=function(e,t,n){return e+(function(e){return e%4==0&&(e%100!=0||e%400==0)}(n)?c:s)[t]}(o,i,l)-1,d=Math.floor(m/7);return f-a+(f-a<0?7:0)<m-7*d?d+1:d}))},e.weekday=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getDay()}))},e.isoweekday=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);if(null===u)return NaN;var a=u.getDay();return 0===a&&(a=7),a}))},e.isomonth=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:u.getMonth()+1}))},e.isoweek=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);if(null===u)return NaN;var s,c,i,l=o(u).getTime()-(s=u,c=a(s),i=new Date(0),i.setFullYear(c,0,4),i.setHours(0,0,0,0),o(i)).getTime();return Math.round(l/6048e5)+1}))},e.isoyear=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,1,1);var u=n.toDate(r[0]);return null===u?NaN:a(u)}))},e.date=function(e,a){return t(e,a,(function(e,t,a){if(n.pcCheck(a,0,7),3===a.length)return i(new Date(n.toNumber(a[0]),n.toNumber(a[1]),n.toNumber(a[2]),0,0,0,0));if(4===a.length)return i(new Date(n.toNumber(a[0]),n.toNumber(a[1]),n.toNumber(a[2]),n.toNumber(a[3]),0,0,0));if(5===a.length)return i(new Date(n.toNumber(a[0]),n.toNumber(a[1]),n.toNumber(a[2]),n.toNumber(a[3]),n.toNumber(a[4]),0,0));if(6===a.length)return i(new Date(n.toNumber(a[0]),n.toNumber(a[1]),n.toNumber(a[2]),n.toNumber(a[3]),n.toNumber(a[4]),n.toNumber(a[5]),0));if(7===a.length)return i(new Date(n.toNumber(a[0]),n.toNumber(a[1]),n.toNumber(a[2]),n.toNumber(a[3]),n.toNumber(a[4]),n.toNumber(a[5]),n.toNumber(a[6])));if(2===a.length){var o=n.toString(a[1]);if(""===o)return null;var s=void 0;return(s="X"===(o=n.standardiseDateFormat(o))?r.DateTime.fromSeconds(n.toNumber(a[0])):"x"===o?r.DateTime.fromMillis(n.toNumber(a[0])):r.DateTime.fromFormat(n.toString(a[0]),o,{locale:u.locale,numberingSystem:"latn"})).isValid?s.toJSDate():null}if(1===a.length){if(n.isString(a[0])){if(""===a[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))return null;if(!0===/^[0-9][0-9][0-9][0-9]$/.test(a[0]))return n.toDate(a[0]+"-01-01")}var c=n.toNumber(a[0]);return!1===isNaN(c)?i(new Date(c)):n.toDate(a[0])}return 0===a.length?new Date:void 0}))},e.datediff=function(e,r){return t(e,r,(function(e,t,r){n.pcCheck(r,2,3);var u=n.toDateTime(r[0]),a=n.toDateTime(r[1]);if(null===u||null===a)return NaN;switch(n.toString(r[2]).toLowerCase()){case"days":case"day":case"d":return u.diff(a,"days").days;case"months":case"month":return u.diff(a,"months").months;case"minutes":case"minute":case"m":return"M"===r[2]?u.diff(a,"months").months:u.diff(a,"minutes").minutes;case"seconds":case"second":case"s":return u.diff(a,"seconds").seconds;case"milliseconds":case"millisecond":case"ms":return u.diff(a).milliseconds;case"hours":case"hour":case"h":return u.diff(a,"hours").hours;case"years":case"year":case"y":return u.diff(a,"years").years;default:return u.diff(a).milliseconds}}))},e.dateadd=function(e,r){return t(e,r,(function(e,t,r){var u;n.pcCheck(r,2,3);var a=n.toDateTime(r[0]);if(null===a)return null;var o=n.toNumber(r[1]);if(isNaN(o))return a.toJSDate();var s="milliseconds";switch(n.toString(r[2]).toLowerCase()){case"days":case"day":case"d":s="days",o=n.absRound(o);break;case"months":case"month":s="months",o=n.absRound(o);break;case"minutes":case"minute":case"m":s="M"===r[2]?"months":"minutes";break;case"seconds":case"second":case"s":s="seconds";break;case"milliseconds":case"millisecond":case"ms":s="milliseconds";break;case"hours":case"hour":case"h":s="hours";break;case"years":case"year":case"y":s="years"}return a.plus((u={},u[s]=o,u)).toJSDate()}))}}}));