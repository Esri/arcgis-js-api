// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.42/esri/copyright.txt for details.

define(["require","exports","../polyfill/tsSupport/awaiter","../polyfill/tsSupport/generator","../polyfill/tsSupport/assign","../polyfill/tsSupport/spreadarray","../executionError","../ImmutableArray","../languageUtils","../polyfill/promiseUtils"],(function(r,n,e,t,i,o,u,c,a,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.registerFunctions=void 0,n.registerFunctions=function(r){function n(r,n,e){if(r instanceof c)return r.toArray();if(a.isArray(r))return r;throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}function i(r,n){var e=r.length,t=Math.floor(e/2);return 0===e?[]:1===e?[r[0]]:function(r,n,e){var t=[];for(;r.length>0||n.length>0;)if(r.length>0&&n.length>0){var i=e(r[0],n[0]);isNaN(i)&&(i=0),i<=0?(t.push(r[0]),r=r.slice(1)):(t.push(n[0]),n=n.slice(1))}else r.length>0?(t.push(r[0]),r=r.slice(1)):n.length>0&&(t.push(n[0]),n=n.slice(1));return t}(i(r.slice(0,t),n),i(r.slice(t,e),n),n)}function o(r,n,i,u){return e(this,void 0,void 0,(function(){var e,c;return t(this,(function(t){switch(t.label){case 0:return e=u,r.length>0||n.length>0?r.length>0&&n.length>0?[4,i(r[0],n[0])]:[3,2]:[3,4];case 1:return c=t.sent(),isNaN(c)&&(c=1),c<=0?(e.push(r[0]),r=r.slice(1)):(e.push(n[0]),n=n.slice(1)),[2,o(r,n,i,u)];case 2:if(r.length>0)return e.push(r[0]),[2,o(r=r.slice(1),n,i,u)];if(n.length>0)return e.push(n[0]),n=n.slice(1),[2,o(r,n,i,u)];t.label=3;case 3:return[3,5];case 4:return[2,u];case 5:return[2]}}))}))}function l(r,n,c,s){a.pcCheck(c,1,2,r,n);var l=c[0];if(a.isImmutableArray(l)&&(l=l.toArray()),!1===a.isArray(l))throw new u.ArcadeExecutionError(r,u.ExecutionErrorCodes.InvalidParameter,n);if(c.length>1){if(!1===a.isFunctionParameter(c[1]))throw new u.ArcadeExecutionError(r,u.ExecutionErrorCodes.InvalidParameter,n);var d=l,f=c[1].createFunction(r);return s?function r(n,i){return e(this,void 0,void 0,(function(){var e,u,c,a;return t(this,(function(t){switch(t.label){case 0:return e=n.length,u=Math.floor(e/2),0===e?[2,[]]:1===e?[2,[n[0]]]:[4,r(n.slice(0,u),i)];case 1:return a=[t.sent()],[4,r(n.slice(u,e),i)];case 2:return[2,o((c=a.concat([t.sent()]))[0],c[1],i,[])]}}))}))}(d,f):d=i(d,(function(r,n){return f(r,n)}))}var h=l;if(0===h.length)return[];for(var E={},v=0;v<h.length;v++){var p=a.getType(h[v]);""!==p&&(E[p]=!0)}if(!0===E.Array||!0===E.Dictionary||!0===E.Feature||!0===E.Point||!0===E.Polygon||!0===E.Polyline||!0===E.Multipoint||!0===E.Extent||!0===E.Function)return h.slice(0);var g=0,w="";for(var x in E)g++,w=x;return h=g>1||"String"===w?i(h,(function(r,n){if(null==r||r===a.voidOperation)return null==n||n===a.voidOperation?0:1;if(null==n||n===a.voidOperation)return-1;var e=a.toString(r),t=a.toString(n);return e<t?-1:e===t?0:1})):"Number"===w?i(h,(function(r,n){return r-n})):"Boolean"===w?i(h,(function(r,n){return r===n?0:n?-1:1})):"Date"===w?i(h,(function(r,n){return n-r})):h.slice(0)}r.functions.array=function(n,e){return r.standardFunction(n,e,(function(r,t,i){a.pcCheck(i,1,2,n,e);var o=a.toNumber(i[0]);if(isNaN(o)||!1===a.isInteger(o))throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e);var c=a.defaultUndefined(i[1],null),s=new Array(o);return s.fill(c),s}))},r.functions.front=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,1,1,n,e),a.isImmutableArray(i[0])){if(i[0].length()<=0)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);return i[0].get(0)}if(a.isArray(i[0])){if(i[0].length<=0)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);return i[0][0]}throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.back=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,1,1,n,e),a.isImmutableArray(i[0])){if(i[0].length()<=0)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);return i[0].get(i[0].length()-1)}if(a.isArray(i[0])){if(i[0].length<=0)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);return i[0][i[0].length-1]}throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.push=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,1,2,n,e),a.isArray(i[0]))return i[0][i[0].length]=i[1],i[0].length;throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.pop=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,1,1,n,e),a.isArray(i[0])){if(i[0].length<=0)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);var o=i[0][i[0].length-1];return i[0].length=i[0].length-1,o}throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.erase=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,2,2,n,e),a.isArray(i[0])){var o=a.toNumber(i[1]);if(isNaN(o)||!1===a.isInteger(o))throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e);var c=i[0];if(c.length<=0)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);if(o<0&&(o=c.length+o),o<0)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);if(o>=c.length)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);return c.splice(o,1),a.voidOperation}throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.insert=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,3,3,n,e),a.isArray(i[0])){var o=a.toNumber(i[1]);if(isNaN(o)||!1===a.isInteger(o))throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e);var c=i[2],s=i[0];if(o>s.length)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);if(o<0&&o<-1*s.length)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.OutOfBounds,e);return o===s.length?(s[o]=c,a.voidOperation):(s.splice(o,0,c),a.voidOperation)}throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.resize=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,2,3,n,e),a.isArray(i[0])){var o=a.toNumber(i[1]);if(isNaN(o)||!1===a.isInteger(o))throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e);if(o<0)throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e);var c=a.defaultUndefined(i[2],null),s=i[0];if(s.length>=o)return s.length=o,a.voidOperation;var l=s.length;s.length=o;for(var d=l;d<s.length;d++)s[d]=c;return a.voidOperation}throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.includes=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,2,2,n,e),a.isArray(i[0])){var o=i[1];return i[0].findIndex((function(r){return a.equalityTest(r,o)}))>-1}if(a.isImmutableArray(i[0])){var c=i[1];return i[0].toArray().findIndex((function(r){return a.equalityTest(r,c)}))>-1}throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.slice=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,1,3,n,e),a.isArray(i[0])){var o=a.toNumber(a.defaultUndefined(i[1],0)),c=a.toNumber(a.defaultUndefined(i[2],i[0].length));if(isNaN(o)||!1===a.isInteger(o))throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e);if(isNaN(c)||!1===a.isInteger(c))throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e);return(s=i[0]).slice(o,c)}if(a.isImmutableArray(i[0])){var s=i[0];o=a.toNumber(a.defaultUndefined(i[1],0)),c=a.toNumber(a.defaultUndefined(i[2],s.length()));if(isNaN(o)||!1===a.isInteger(o))throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e);if(isNaN(c)||!1===a.isInteger(c))throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e);return s.toArray().slice(o,c)}throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.splice=function(n,e){return r.standardFunction(n,e,(function(r,n,e){for(var t=[],i=0;i<e.length;i++)a.isArray(e[i])?t.push.apply(t,e[i]):a.isImmutableArray(e[i])?t.push.apply(t,e[i].toArray()):t.push(e[i]);return t}))},r.functions.top=function(n,e){return r.standardFunction(n,e,(function(r,t,i){if(a.pcCheck(i,2,2,n,e),a.isArray(i[0]))return a.toNumber(i[1])>=i[0].length?i[0].slice(0):i[0].slice(0,a.toNumber(i[1]));if(a.isImmutableArray(i[0]))return a.toNumber(i[1])>=i[0].length()?i[0].slice(0):i[0].slice(0,a.toNumber(i[1]));throw new u.ArcadeExecutionError(n,u.ExecutionErrorCodes.InvalidParameter,e)}))},r.functions.first=function(n,e){return r.standardFunction(n,e,(function(r,t,i){return a.pcCheck(i,1,1,n,e),a.isArray(i[0])?0===i[0].length?null:i[0][0]:a.isImmutableArray(i[0])?0===i[0].length()?null:i[0].get(0):null}))},"sync"===r.mode&&(r.functions.sort=function(n,e){return r.standardFunction(n,e,(function(r,t,i){return l(n,e,i,!1)}))},r.functions.any=function(e,t){return r.standardFunction(e,t,(function(r,i,o){a.pcCheck(o,2,2,e,t);for(var u=o[1].createFunction(e),c=0,s=n(o[0],e,t);c<s.length;c++){var l=u(s[c]);if(a.isBoolean(l)&&!0===l)return!0}return!1}))},r.functions.all=function(e,t){return r.standardFunction(e,t,(function(r,i,o){a.pcCheck(o,2,2,e,t);for(var u=o[1].createFunction(e),c=0,s=n(o[0],e,t);c<s.length;c++){if(!0!==u(s[c]))return!1}return!0}))},r.functions.none=function(e,t){return r.standardFunction(e,t,(function(r,i,o){a.pcCheck(o,2,2,e,t);for(var u=o[1].createFunction(e),c=0,s=n(o[0],e,t);c<s.length;c++){if(!0===u(s[c]))return!1}return!0}))},r.functions.reduce=function(e,t){return r.standardFunction(e,t,(function(r,i,o){a.pcCheck(o,2,3,e,t);var u=o[1].createFunction(e),c=n(o[0],e,t);return 2===o.length?0===c.length?null:c.reduce((function(r,n){var e=u(r,n);return r=void 0!==e&&e!==a.voidOperation?e:null})):c.reduce((function(r,n){var e=u(r,n);return r=void 0!==e&&e!==a.voidOperation?e:null}),o[2])}))},r.functions.map=function(e,t){return r.standardFunction(e,t,(function(r,i,o){a.pcCheck(o,2,2,e,t);for(var u=o[1].createFunction(e),c=[],s=0,l=n(o[0],e,t);s<l.length;s++){var d=u(l[s]);void 0!==d&&d!==a.voidOperation?c.push(d):c.push(null)}return c}))},r.functions.filter=function(e,t){return r.standardFunction(e,t,(function(r,i,o){a.pcCheck(o,2,2,e,t);for(var u=o[1].createFunction(e),c=[],s=0,l=n(o[0],e,t);s<l.length;s++){var d=l[s];!0===u(d)&&c.push(d)}return c}))}),"async"===r.mode&&(r.functions.sort=function(n,e){return r.standardFunctionAsync(n,e,(function(r,t,i){return l(n,e,i,!0)}))},r.functions.any=function(i,o){var u=this;return r.standardFunctionAsync(i,o,(function(r,c,l){return e(u,void 0,void 0,(function(){var r,e,u,c,d,f,h;return t(this,(function(t){switch(t.label){case 0:a.pcCheck(l,2,2,i,o),r=l[1].createFunction(i),e=n(l[0],i,o),u=0,c=e,t.label=1;case 1:return u<c.length?(d=c[u],[4,r(d)]):[3,7];case 2:return f=t.sent(),h=null,s.isPromiseLike(h)?[4,f]:[3,4];case 3:return h=t.sent(),[3,5];case 4:h=f,t.label=5;case 5:if(a.isBoolean(h)&&!0===h)return[2,!0];t.label=6;case 6:return u++,[3,1];case 7:return[2,!1]}}))}))}))},r.functions.all=function(i,o){var u=this;return r.standardFunctionAsync(i,o,(function(r,c,l){return e(u,void 0,void 0,(function(){var r,e,u,c,d,f,h;return t(this,(function(t){switch(t.label){case 0:a.pcCheck(l,2,2,i,o),r=l[1].createFunction(i),e=n(l[0],i,o),u=0,c=e,t.label=1;case 1:return u<c.length?(d=c[u],[4,r(d)]):[3,7];case 2:return f=t.sent(),h=null,s.isPromiseLike(h)?[4,f]:[3,4];case 3:return h=t.sent(),[3,5];case 4:h=f,t.label=5;case 5:if(!0!==h)return[2,!1];t.label=6;case 6:return u++,[3,1];case 7:return[2,!0]}}))}))}))},r.functions.none=function(i,o){var u=this;return r.standardFunctionAsync(i,o,(function(r,c,l){return e(u,void 0,void 0,(function(){var r,e,u,c,d,f,h;return t(this,(function(t){switch(t.label){case 0:a.pcCheck(l,2,2,i,o),r=l[1].createFunction(i),e=n(l[0],i,o),u=0,c=e,t.label=1;case 1:return u<c.length?(d=c[u],[4,r(d)]):[3,7];case 2:return f=t.sent(),h=null,s.isPromiseLike(h)?[4,f]:[3,4];case 3:return h=t.sent(),[3,5];case 4:h=f,t.label=5;case 5:if(!0===h)return[2,!1];t.label=6;case 6:return u++,[3,1];case 7:return[2,!0]}}))}))}))},r.functions.filter=function(i,o){var u=this;return r.standardFunctionAsync(i,o,(function(r,c,l){return e(u,void 0,void 0,(function(){var r,e,u,c,d,f,h,E;return t(this,(function(t){switch(t.label){case 0:a.pcCheck(l,2,2,i,o),r=l[1].createFunction(i),e=n(l[0],i,o),u=[],c=0,d=e,t.label=1;case 1:return c<d.length?(f=d[c],[4,r(f)]):[3,7];case 2:return h=t.sent(),E=null,s.isPromiseLike(E)?[4,h]:[3,4];case 3:return E=t.sent(),[3,5];case 4:E=h,t.label=5;case 5:!0===E&&u.push(f),t.label=6;case 6:return c++,[3,1];case 7:return[2,u]}}))}))}))},r.functions.reduce=function(i,o){var u=this;return r.standardFunctionAsync(i,o,(function(r,c,s){a.pcCheck(s,2,3,i,o);var l=s[1].createFunction(i),d=n(s[0],i,o),f=null;if(s.length>2){var h=a.defaultUndefined(s[2],null);f=d.reduce((function(r,n){return e(u,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,r];case 1:return void 0!==(e=t.sent())&&e!==a.voidOperation||(e=null),[2,l(e,n)]}}))}))}),Promise.resolve(h))}else{if(0===d.length)return null;f=d.reduce((function(r,n,i){return e(u,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return i<=1?[2,l(r,n)]:[4,r];case 1:return void 0!==(e=t.sent())&&e!==a.voidOperation||(e=null),[2,l(e,n)]}}))}))}))}return f.then((function(r){return void 0!==r&&r!==a.voidOperation?r:null}))}))},r.functions.map=function(i,o){var u=this;return r.standardFunctionAsync(i,o,(function(r,c,l){return e(u,void 0,void 0,(function(){var r,e,u,c,d,f,h,E;return t(this,(function(t){switch(t.label){case 0:a.pcCheck(l,2,2,i,o),r=l[1].createFunction(i),e=n(l[0],i,o),u=[],c=0,d=e,t.label=1;case 1:return c<d.length?(f=d[c],[4,r(f)]):[3,7];case 2:return h=t.sent(),E=null,s.isPromiseLike(E)?[4,h]:[3,4];case 3:return E=t.sent(),[3,5];case 4:E=h,t.label=5;case 5:void 0!==E&&E!==a.voidOperation?u.push(E):u.push(null),t.label=6;case 6:return c++,[3,1];case 7:return[2,u]}}))}))}))})}}));