// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.40/esri/copyright.txt for details.

define(["require","exports","../FunctionWrapper","../ImmutableArray","../languageUtils","../polyfill/promiseUtils"],(function(r,n,e,t,i,u){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.registerFunctions=void 0,n.registerFunctions=function(r){function n(n,t){if(t instanceof e)return r.arcadeCustomFunctionHandler(t);if(t instanceof i.NativeFunction)return function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return t.fn(n,{preparsed:!0,arguments:r})};if(t instanceof i.SizzleFunction)return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(r.length!==t.paramCount)throw new Error("Invalid parameters");return t.fn.apply(t,r)};throw new Error("Invalid Parameter")}function o(r){if(r instanceof t)return r.toArray();if(i.isArray(r))return r;throw new Error("Invalid Parameter")}r.functions.array=function(n,e){return r.standardFunction(n,e,(function(r,n,e){i.pcCheck(e,1,2);var t=i.toNumber(e[0]);if(isNaN(t)||!1===i.isInteger(t))throw new Error("Invalid Parameter");var u=i.defaultUndefined(e[1],null),o=new Array(t);return o.fill(u),o}))},r.functions.front=function(n,e){return r.standardFunction(n,e,(function(r,n,e){if(i.pcCheck(e,1,1),i.isImmutableArray(e[0])){if(e[0].length()<=0)throw new Error("Array is empty");return e[0].get(0)}if(i.isArray(e[0])){if(e[0].length<=0)throw new Error("Array is empty");return e[0][0]}throw new Error("Invalid Parameter")}))},r.functions.back=function(n,e){return r.standardFunction(n,e,(function(r,n,e){if(i.pcCheck(e,1,1),i.isImmutableArray(e[0])){if(e[0].length()<=0)throw new Error("Array is empty");return e[0].get(e[0].length()-1)}if(i.isArray(e[0])){if(e[0].length<=0)throw new Error("Array is empty");return e[0][e[0].length-1]}throw new Error("Invalid Parameter")}))},r.functions.push=function(n,e){return r.standardFunction(n,e,(function(r,n,e){if(i.pcCheck(e,1,2),i.isArray(e[0]))return e[0][e[0].length]=e[1],e[0].length;throw new Error("Invalid Parameter")}))},r.functions.pop=function(n,e){return r.standardFunction(n,e,(function(r,n,e){if(i.pcCheck(e,1,1),i.isArray(e[0])){if(e[0].length<=0)throw new Error("Array is empty");var t=e[0][e[0].length-1];return e[0].length=e[0].length-1,t}throw new Error("Invalid Parameter")}))},r.functions.erase=function(n,e){return r.standardFunction(n,e,(function(r,n,e){if(i.pcCheck(e,2,2),i.isArray(e[0])){var t=i.toNumber(e[1]);if(isNaN(t)||!1===i.isInteger(t))throw new Error("Invalid Parameter");var u=e[0];if(u.length<=0)throw new Error("Array is empty");if(t<0&&(t=u.length+t),t<0)throw new Error("Element not found");if(t>=u.length)throw new Error("Index is greater than array");return u.splice(t,1),i.voidOperation}throw new Error("Invalid Parameter")}))},r.functions.insert=function(n,e){return r.standardFunction(n,e,(function(r,n,e){if(i.pcCheck(e,3,3),i.isArray(e[0])){var t=i.toNumber(e[1]);if(isNaN(t)||!1===i.isInteger(t))throw new Error("Invalid Parameter");var u=e[2],o=e[0];if(t>o.length)throw new Error("Index is greater than array");if(t<0&&t<-1*o.length)throw new Error("Index is greater than array");return t===o.length?(o[t]=u,i.voidOperation):(o.splice(t,0,u),i.voidOperation)}throw new Error("Invalid Parameter")}))},r.functions.resize=function(n,e){return r.standardFunction(n,e,(function(r,n,e){if(i.pcCheck(e,2,3),i.isArray(e[0])){var t=i.toNumber(e[1]);if(isNaN(t)||!1===i.isInteger(t))throw new Error("Invalid Parameter");if(t<0)throw new Error("Size cannot be negative");var u=i.defaultUndefined(e[2],null),o=e[0];if(o.length>=t)return o.length=t,i.voidOperation;var a=o.length;o.length=t;for(var c=a;c<o.length;c++)o[c]=u;return i.voidOperation}throw new Error("Invalid Parameter")}))},r.functions.includes=function(n,e){return r.standardFunction(n,e,(function(r,n,e){if(i.pcCheck(e,2,2),i.isArray(e[0])){var t=e[1];return e[0].findIndex((function(r){return i.equalityTest(r,t)}))>-1}if(i.isImmutableArray(e[0])){var u=e[1];return e[0].toArray().findIndex((function(r){return i.equalityTest(r,u)}))>-1}throw new Error("Invalid Parameter")}))},r.functions.slice=function(n,e){return r.standardFunction(n,e,(function(r,n,e){if(i.pcCheck(e,1,3),i.isArray(e[0])){var t=i.toNumber(i.defaultUndefined(e[1],0)),u=i.toNumber(i.defaultUndefined(e[2],e[0].length));if(isNaN(t)||!1===i.isInteger(t))throw new Error("Invalid Parameter");if(isNaN(u)||!1===i.isInteger(u))throw new Error("Invalid Parameter");return(o=e[0]).slice(t,u)}if(i.isImmutableArray(e[0])){var o=e[0];t=i.toNumber(i.defaultUndefined(e[1],0)),u=i.toNumber(i.defaultUndefined(e[2],o.length()));if(isNaN(t)||!1===i.isInteger(t))throw new Error("Invalid Parameter");if(isNaN(u)||!1===i.isInteger(u))throw new Error("Invalid Parameter");return o.toArray().slice(t,u)}throw new Error("Invalid Parameter")}))},r.functions.splice=function(n,e){return r.standardFunction(n,e,(function(r,n,e){for(var t=[],u=0;u<e.length;u++)i.isArray(e[u])?t.push.apply(t,e[u]):i.isImmutableArray(e[u])?t.push.apply(t,e[u].toArray()):t.push(e[u]);return t}))},"sync"===r.mode&&(r.functions.any=function(e,t){return r.standardFunction(e,t,(function(r,t,u){i.pcCheck(u,2,2);for(var a=n(e,u[1]),c=0,s=o(u[0]);c<s.length;c++){var f=a(s[c]);if(i.isBoolean(f)&&!0===f)return!0}return!1}))},r.functions.all=function(e,t){return r.standardFunction(e,t,(function(r,t,u){i.pcCheck(u,2,2);for(var a=n(e,u[1]),c=0,s=o(u[0]);c<s.length;c++){if(!0!==a(s[c]))return!1}return!0}))},r.functions.none=function(e,t){return r.standardFunction(e,t,(function(r,t,u){i.pcCheck(u,2,2);for(var a=n(e,u[1]),c=0,s=o(u[0]);c<s.length;c++){if(!0===a(s[c]))return!1}return!0}))},r.functions.reduce=function(e,t){return r.standardFunction(e,t,(function(r,t,u){i.pcCheck(u,2,3);var a=n(e,u[1]),c=o(u[0]);return 2===u.length?0===c.length?null:c.reduce((function(r,n){var e=a(r,n);return r=void 0!==e&&e!==i.voidOperation?e:null})):c.reduce((function(r,n){var e=a(r,n);return r=void 0!==e&&e!==i.voidOperation?e:null}),u[2])}))},r.functions.map=function(e,t){return r.standardFunction(e,t,(function(r,t,u){i.pcCheck(u,2,2);for(var a=n(e,u[1]),c=[],s=0,f=o(u[0]);s<f.length;s++){var l=a(f[s]);void 0!==l&&l!==i.voidOperation?c.push(l):c.push(null)}return c}))},r.functions.filter=function(e,t){return r.standardFunction(e,t,(function(r,t,u){i.pcCheck(u,2,2);for(var a=n(e,u[1]),c=[],s=0,f=o(u[0]);s<f.length;s++){var l=f[s];!0===a(l)&&c.push(l)}return c}))}),"async"===r.mode&&(r.functions.any=function(e,t){return r.standardFunctionAsync(e,t,(function(r,t,a){i.pcCheck(a,2,2);var c=n(e,a[1]),s=o(a[0]),f={result:!1};return s.reduce((function(r,n,e){return r.then((function(r){if(e>0&&!0===r&&(f.result=!0),!0===f.result)return u.resolve(!0);var t=c(n);return u.isPromiseLike(t)?t:u.resolve(t)}))}),Promise.resolve(!1)).then((function(r){return!0===r&&(f.result=!0),f.result}))}))},r.functions.all=function(e,t){return r.standardFunctionAsync(e,t,(function(r,t,a){i.pcCheck(a,2,2);var c=n(e,a[1]),s=o(a[0]),f={result:!0};return s.reduce((function(r,n,e){return r.then((function(r){if(e>0&&!0!==r&&(f.result=!1),!1===f.result)return u.resolve(!1);var t=c(n);return u.isPromiseLike(t)?t:u.resolve(t)}))}),Promise.resolve(!0)).then((function(r){return!0!==r&&(f.result=!1),f.result}))}))},r.functions.none=function(e,t){return r.standardFunctionAsync(e,t,(function(r,t,a){i.pcCheck(a,2,2);var c=n(e,a[1]),s=o(a[0]),f={result:!0};return s.reduce((function(r,n,e){return r.then((function(r){if(e>0&&!0===r&&(f.result=!1),!1===f.result)return u.resolve(!0);var t=c(n);return u.isPromiseLike(t)?t:u.resolve(t)}))}),Promise.resolve(!1)).then((function(r){return!0===r&&(f.result=!1),f.result}))}))},r.functions.filter=function(e,t){return r.standardFunctionAsync(e,t,(function(r,t,a){i.pcCheck(a,2,2);var c=n(e,a[1]),s=o(a[0]),f=[];return s.reduce((function(r,n,e){return r.then((function(r){e>0&&!0===r&&f.push(s[e-1]);var t=c(n);return u.isPromiseLike(t)?t:u.resolve(t)}))}),Promise.resolve(!1)).then((function(r){return!0===r&&s.length>0&&f.push(s[s.length-1]),f}))}))},r.functions.reduce=function(e,t){return r.standardFunctionAsync(e,t,(function(r,t,a){i.pcCheck(a,2,3);var c=n(e,a[1]),s=o(a[0]),f=null;if(a.length>2){var l=i.defaultUndefined(a[2],null);f=s.reduce((function(r,n){return r.then((function(r){void 0!==r&&r!==i.voidOperation||(r=null);var e=c(r,n);return u.isPromiseLike(e)?e:u.resolve(e)}))}),Promise.resolve(l))}else{if(0===s.length)return null;f=s.reduce((function(r,n,e){if(e<=1){var t=c(r,n);return u.isPromiseLike(t)?t:u.resolve(t)}return r.then((function(r){void 0!==r&&r!==i.voidOperation||(r=null);var e=c(r,n);return u.isPromiseLike(e)?e:u.resolve(e)}))}))}return f.then((function(r){return void 0!==r&&r!==i.voidOperation?r:null}))}))},r.functions.map=function(e,t){return r.standardFunctionAsync(e,t,(function(r,t,a){i.pcCheck(a,2,2);var c=n(e,a[1]),s=o(a[0]),f={result:[]};return s.reduce((function(r,n,e){return r.then((function(r){e>0&&(void 0!==r&&r!==i.voidOperation?f.result.push(r):f.result.push(null));var t=c(n);return u.isPromiseLike(t)?t:u.resolve(t)}))}),Promise.resolve()).then((function(r){return s.length>0&&(void 0!==r&&r!==i.voidOperation?f.result.push(r):f.result.push(null)),f.result}))}))})}}));