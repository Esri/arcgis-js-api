/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../geometry/SpatialReference","../../geometry/Point","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Polygon","../../geometry/Polyline","../../chunks/languageUtils","../Dictionary","../ArcadePortal","../Attachment","../featureset/support/shared","../Feature","./hash"],(function(t,e,r,n,o,i,a,u,c,s,p,d,f,l){"use strict";function y(t,e){if(t.x===e.x&&t.y===e.y){if(t.hasZ){if(t.z!==e.z)return!1}else if(e.hasZ)return!1;if(t.hasM){if(t.m!==e.m)return!1}else if(e.hasM)return!1;return!0}return!1}function h(t,d,l){if(null!==t)if(u.isArray(t)){if(d.updateUint8Array([61]),l.map.has(t)){const e=l.map.get(t);d.updateIntArray([61237541^e])}else{l.map.set(t,l.currentLength++);for(const e of t)h(e,d,l);l.map.delete(t),l.currentLength--}d.updateUint8Array([199])}else if(u.isImmutableArray(t)){if(d.updateUint8Array([61]),l.map.has(t)){const e=l.map.get(t);d.updateIntArray([61237541^e])}else{l.map.set(t,l.currentLength++);for(const e of t.toArray())h(e,d,l);l.map.delete(t),l.currentLength--}d.updateUint8Array([199])}else{if(u.isDate(t))return d.updateIntArray([t.getTime()]),void d.updateUint8Array([241]);if(u.isString(t))return d.updateIntArray([t.length]),d.updateWithString(t),void d.updateUint8Array([41]);if(u.isBoolean(t))d.updateUint8Array([!0===t?1:0,113]);else{if(u.isNumber(t))return d.updateFloatArray([t]),void d.updateUint8Array([173]);if(t instanceof p)throw new Error("Type not supported in Hash");if(t instanceof s)throw new Error("Type not supported in Hash");if(!(t instanceof c)){if(t instanceof f)throw new Error("Type not supported in Hash");if(t instanceof r)return d.updateIntArray([3833836621]),d.updateIntArray([0]),d.updateFloatArray([t.x]),d.updateIntArray([1]),d.updateFloatArray([t.y]),t.hasZ&&(d.updateIntArray([2]),d.updateFloatArray([t.z])),t.hasM&&(d.updateIntArray([3]),d.updateFloatArray([t.m])),d.updateIntArray([3765347959]),void h(t.spatialReference.wkid,d,l);if(t instanceof i){d.updateIntArray([1266616829]);for(let e=0;e<t.rings.length;e++){const r=t.rings[e],n=[];let o=null,i=null;for(let a=0;a<r.length;a++){const u=t.getPoint(e,a);if(0===a)o=u;else if(y(i,u))continue;i=u,a===r.length-1&&y(o,u)||n.push(u)}d.updateIntArray([1397116793,n.length]);for(let t=0;t<n.length;t++){const e=n[t];d.updateIntArray([3962308117,t]),h(e,d,l),d.updateIntArray([2716288009])}d.updateIntArray([2278822459])}return d.updateIntArray([3878477243]),void h(t.spatialReference.wkid,d,l)}if(t instanceof a){d.updateIntArray([4106883559]);for(let e=0;e<t.paths.length;e++){const r=t.paths[e];d.updateIntArray([1397116793,r.length]);for(let n=0;n<r.length;n++)d.updateIntArray([3962308117,n]),h(t.getPoint(e,n),d,l),d.updateIntArray([2716288009]);d.updateIntArray([2278822459])}return d.updateIntArray([2568784753]),void h(t.spatialReference.wkid,d,l)}if(t instanceof o){d.updateIntArray([588535921,t.points.length]);for(let e=0;e<t.points.length;e++){const r=t.getPoint(e);d.updateIntArray([e]),h(r,d,l)}return d.updateIntArray([1700171621]),void h(t.spatialReference.wkid,d,l)}if(t instanceof n)return d.updateIntArray([3483648373]),d.updateIntArray([0]),d.updateFloatArray([t.xmax]),d.updateIntArray([1]),d.updateFloatArray([t.xmin]),d.updateIntArray([2]),d.updateFloatArray([t.ymax]),d.updateIntArray([3]),d.updateFloatArray([t.ymin]),t.hasZ&&(d.updateIntArray([4]),d.updateFloatArray([t.zmax]),d.updateIntArray([5]),d.updateFloatArray([t.zmin])),t.hasM&&(d.updateIntArray([6]),d.updateFloatArray([t.mmax]),d.updateIntArray([7]),d.updateFloatArray([t.mmin])),d.updateIntArray([3622027469]),void h(t.spatialReference.wkid,d,l);if(t instanceof e)return d.updateIntArray([14]),void 0!==t.wkid&&null!==t.wkid&&d.updateIntArray([t.wkid]),void(t.wkt&&d.updateWithString(t.wkt));if(u.isFunctionParameter(t))throw new Error("Type not supported in Hash");if(u.isFeatureSet(t))throw new Error("Type not supported in Hash");if(u.isFeatureSetCollection(t))throw new Error("Type not supported in Hash");if(t===u.voidOperation)throw new Error("Type not supported in Hash");throw new Error("Type not supported in Hash")}if(d.updateUint8Array([223]),l.map.has(t)){const e=l.map.get(t);d.updateIntArray([61237541^e])}else{l.map.set(t,l.currentLength++);for(const e of t.keys()){d.updateIntArray([e.length]),d.updateWithString(e),d.updateUint8Array([251]);h(t.field(e),d,l),d.updateUint8Array([239])}l.map.delete(t),l.currentLength--}d.updateUint8Array([73])}}else d.updateUint8Array([0,139])}t.registerFunctions=function(t,e){t.portal=function(t,r){return e(t,r,(function(t,e,r){return u.pcCheck(r,1,1),new s(u.toString(r[0]))}))},t.trim=function(t,r){return e(t,r,(function(t,e,r){return u.pcCheck(r,1,1),u.toString(r[0]).trim()}))},t.tohex=function(t,r){return e(t,r,(function(t,e,r){u.pcCheck(r,1,1);const n=u.toNumber(r[0]);return isNaN(n)?n:n.toString(16)}))},t.upper=function(t,r){return e(t,r,(function(t,e,r){return u.pcCheck(r,1,1),u.toString(r[0]).toUpperCase()}))},t.proper=function(t,r){return e(t,r,(function(t,e,r){u.pcCheck(r,1,2);let n=1;2===r.length&&"firstword"===u.toString(r[1]).toLowerCase()&&(n=2);const o=/\s/,i=u.toString(r[0]);let a="",c=!0;for(let t=0;t<i.length;t++){let e=i[t];if(o.test(e))1===n&&(c=!0);else{e.toUpperCase()!==e.toLowerCase()&&(c?(e=e.toUpperCase(),c=!1):e=e.toLowerCase())}a+=e}return a}))},t.lower=function(t,r){return e(t,r,(function(t,e,r){return u.pcCheck(r,1,1),u.toString(r[0]).toLowerCase()}))},t.guid=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,0,1),r.length>0)switch(u.toString(r[0]).toLowerCase()){case"digits":return u.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return u.generateUUID();case"digits-hyphen-braces":return"{"+u.generateUUID()+"}";case"digits-hyphen-parentheses":return"("+u.generateUUID()+")"}return"{"+u.generateUUID()+"}"}))},t.console=function(t,r){return e(t,r,(function(e,r,n){return 0===n.length||(1===n.length?t.console(u.toString(n[0])):t.console(u.toString(n))),u.voidOperation}))},t.mid=function(t,r){return e(t,r,(function(t,e,r){u.pcCheck(r,2,3);let n=u.toNumber(r[1]);if(isNaN(n))return"";if(n<0&&(n=0),2===r.length)return u.toString(r[0]).substr(n);let o=u.toNumber(r[2]);return isNaN(o)?"":(o<0&&(o=0),u.toString(r[0]).substr(n,o))}))},t.find=function(t,r){return e(t,r,(function(t,e,r){u.pcCheck(r,2,3);let n=0;if(r.length>2){if(n=u.toNumber(u.defaultUndefined(r[2],0)),isNaN(n))return-1;n<0&&(n=0)}return u.toString(r[1]).indexOf(u.toString(r[0]),n)}))},t.left=function(t,r){return e(t,r,(function(t,e,r){u.pcCheck(r,2,2);let n=u.toNumber(r[1]);return isNaN(n)?"":(n<0&&(n=0),u.toString(r[0]).substr(0,n))}))},t.right=function(t,r){return e(t,r,(function(t,e,r){u.pcCheck(r,2,2);let n=u.toNumber(r[1]);return isNaN(n)?"":(n<0&&(n=0),u.toString(r[0]).substr(-1*n,n))}))},t.split=function(t,r){return e(t,r,(function(t,e,r){let n;u.pcCheck(r,2,4);let o=u.toNumber(u.defaultUndefined(r[2],-1));const i=u.toBoolean(u.defaultUndefined(r[3],!1));if(-1===o||null===o||!0===i?n=u.toString(r[0]).split(u.toString(r[1])):(isNaN(o)&&(o=-1),o<-1&&(o=-1),n=u.toString(r[0]).split(u.toString(r[1]),o)),!1===i)return n;const a=[];for(let t=0;t<n.length&&!(-1!==o&&a.length>=o);t++)""!==n[t]&&void 0!==n[t]&&a.push(n[t]);return a}))},t.text=function(t,r){return e(t,r,(function(t,e,r){return u.pcCheck(r,1,2),u.toStringExplicit(r[0],r[1])}))},t.concatenate=function(t,r){return e(t,r,(function(t,e,r){const n=[];if(r.length<1)return"";if(u.isArray(r[0])){const t=u.defaultUndefined(r[2],"");for(let e=0;e<r[0].length;e++)n[e]=u.toStringExplicit(r[0][e],t);return r.length>1?n.join(r[1]):n.join("")}if(u.isImmutableArray(r[0])){const t=u.defaultUndefined(r[2],"");for(let e=0;e<r[0].length();e++)n[e]=u.toStringExplicit(r[0].get(e),t);return r.length>1?n.join(r[1]):n.join("")}for(let t=0;t<r.length;t++)n[t]=u.toStringExplicit(r[t]);return n.join("")}))},t.reverse=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,1,1),u.isArray(r[0])){const t=r[0].slice(0);return t.reverse(),t}if(u.isImmutableArray(r[0])){const t=r[0].toArray().slice(0);return t.reverse(),t}throw new Error("Invalid Parameter")}))},t.replace=function(t,r){return e(t,r,(function(t,e,r){u.pcCheck(r,3,4);const n=u.toString(r[0]),o=u.toString(r[1]),i=u.toString(r[2]);return 4!==r.length||u.toBoolean(r[3])?u.multiReplace(n,o,i):n.replace(o,i)}))},t.schema=function(t,r){return e(t,r,(function(t,e,r){if(r[0]instanceof f){const t=r[0].schema();return t?c.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypes=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,1,1),r[0]instanceof f){const t=r[0].subtypes();return t?c.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypecode=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,1,1),r[0]instanceof f){const t=r[0].subtypes();if(!t)return null;if(t.subtypeField&&r[0].hasField(t.subtypeField)){const e=r[0].field(t.subtypeField);for(const r of t.subtypes)if(r.code===e)return r.code;return null}return null}throw new Error("Invalid Parameter")}))},t.subtypename=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,1,1),r[0]instanceof f){const t=r[0].subtypes();if(!t)return"";if(t.subtypeField&&r[0].hasField(t.subtypeField)){const e=r[0].field(t.subtypeField);for(const r of t.subtypes)if(r.code===e)return r.name;return""}return""}throw new Error("Invalid Parameter")}))},t.gdbversion=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,1,1),r[0]instanceof f)return r[0].gdbVersion();throw new Error("Invalid Parameter")}))},t.domain=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,2,3),r[0]instanceof f){const t=r[0].fullDomain(u.toString(r[1]),void 0===r[2]?void 0:u.toNumber(r[2]));return t&&t.domain?"coded-value"===t.domain.type||"codedValue"===t.domain.type?c.convertObjectToArcadeDictionary({type:"codedValue",name:t.domain.name,dataType:d.layerFieldEsriConstants[t.field.type],codedValues:t.domain.codedValues.map((t=>({name:t.name,code:t.code})))}):c.convertObjectToArcadeDictionary({type:"range",name:t.domain.name,dataType:d.layerFieldEsriConstants[t.field.type],min:t.domain.min,max:t.domain.max}):null}throw new Error("Invalid Parameter")}))},t.domainname=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,2,4),r[0]instanceof f)return r[0].domainValueLookup(u.toString(r[1]),r[2],void 0===r[3]?void 0:u.toNumber(r[3]));throw new Error("Invalid Parameter")}))},t.domaincode=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,2,4),r[0]instanceof f)return r[0].domainCodeLookup(u.toString(r[1]),r[2],void 0===r[3]?void 0:u.toNumber(r[3]));throw new Error("Invalid Parameter")}))},t.urlencode=function(t,r){return e(t,r,(function(t,e,r){if(u.pcCheck(r,1,1),null===r[0])return"";if(r[0]instanceof c){let t="";for(const e of r[0].keys()){const n=r[0].field(e);""!==t&&(t+="&"),t+=null===n?encodeURIComponent(e)+"=":encodeURIComponent(e)+"="+encodeURIComponent(n)}return t}return encodeURIComponent(u.toString(r[0]))}))},t.hash=function(t,r){return e(t,r,(function(t,e,r){u.pcCheck(r,1,1);const n=new l.XXH(0);return h(r[0],n,{map:new Map,currentLength:0}),n.digest()}))}},Object.defineProperty(t,"__esModule",{value:!0})}));
