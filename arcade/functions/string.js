/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","../ArcadePortal","../Attachment","../Dictionary","../executionError","../../chunks/languageUtils","../featureset/support/shared","./convertdirection","./hash","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/SpatialReference"],(function(e,t,r,n,o,a,i,u,c,d,s,p,l,f,h){"use strict";function g(e,t){if(!e||!t)return e===t;if(e.x===t.x&&e.y===t.y){if(e.hasZ){if(e.z!==t.z)return!1}else if(t.hasZ)return!1;if(e.hasM){if(e.m!==t.m)return!1}else if(t.hasM)return!1;return!0}return!1}function y(e,i,u){if(null!==e)if(a.isArray(e)){if(i.updateUint8Array([61]),u.map.has(e)){const t=u.map.get(e);i.updateIntArray([61237541^t])}else{u.map.set(e,u.currentLength++);for(const t of e)y(t,i,u);u.map.delete(e),u.currentLength--}i.updateUint8Array([199])}else if(a.isImmutableArray(e)){if(i.updateUint8Array([61]),u.map.has(e)){const t=u.map.get(e);i.updateIntArray([61237541^t])}else{u.map.set(e,u.currentLength++);for(const t of e.toArray())y(t,i,u);u.map.delete(e),u.currentLength--}i.updateUint8Array([199])}else{if(a.isDate(e))return i.updateIntArray([e.getTime()]),void i.updateUint8Array([241]);if(a.isString(e))return i.updateIntArray([e.length]),i.updateWithString(e),void i.updateUint8Array([41]);if(a.isBoolean(e))i.updateUint8Array([!0===e?1:0,113]);else{if(a.isNumber(e))return i.updateFloatArray([e]),void i.updateUint8Array([173]);if(e instanceof r)throw new o.ArcadeExecutionError(u.context,o.ExecutionErrorCodes.UnsupportedHashType,u.node);if(e instanceof t)throw new o.ArcadeExecutionError(u.context,o.ExecutionErrorCodes.UnsupportedHashType,u.node);if(!(e instanceof n)){if(a.isFeature(e))throw new o.ArcadeExecutionError(u.context,o.ExecutionErrorCodes.UnsupportedHashType,u.node);if(e instanceof p)return i.updateIntArray([3833836621]),i.updateIntArray([0]),i.updateFloatArray([e.x]),i.updateIntArray([1]),i.updateFloatArray([e.y]),e.hasZ&&(i.updateIntArray([2]),i.updateFloatArray([e.z])),e.hasM&&(i.updateIntArray([3]),i.updateFloatArray([e.m])),i.updateIntArray([3765347959]),void y(e.spatialReference.wkid,i,u);if(e instanceof l){i.updateIntArray([1266616829]);for(let t=0;t<e.rings.length;t++){const r=e.rings[t],n=[];let o=null,a=null;for(let i=0;i<r.length;i++){const u=e.getPoint(t,i);if(0===i)o=u;else if(g(a,u))continue;a=u,i===r.length-1&&g(o,u)||n.push(u)}i.updateIntArray([1397116793,n.length]);for(let e=0;e<n.length;e++){const t=n[e];i.updateIntArray([3962308117,e]),y(t,i,u),i.updateIntArray([2716288009])}i.updateIntArray([2278822459])}return i.updateIntArray([3878477243]),void y(e.spatialReference.wkid,i,u)}if(e instanceof f){i.updateIntArray([4106883559]);for(let t=0;t<e.paths.length;t++){const r=e.paths[t];i.updateIntArray([1397116793,r.length]);for(let n=0;n<r.length;n++)i.updateIntArray([3962308117,n]),y(e.getPoint(t,n),i,u),i.updateIntArray([2716288009]);i.updateIntArray([2278822459])}return i.updateIntArray([2568784753]),void y(e.spatialReference.wkid,i,u)}if(e instanceof s){i.updateIntArray([588535921,e.points.length]);for(let t=0;t<e.points.length;t++){const r=e.getPoint(t);i.updateIntArray([t]),y(r,i,u)}return i.updateIntArray([1700171621]),void y(e.spatialReference.wkid,i,u)}if(e instanceof d)return i.updateIntArray([3483648373]),i.updateIntArray([0]),i.updateFloatArray([e.xmax]),i.updateIntArray([1]),i.updateFloatArray([e.xmin]),i.updateIntArray([2]),i.updateFloatArray([e.ymax]),i.updateIntArray([3]),i.updateFloatArray([e.ymin]),e.hasZ&&(i.updateIntArray([4]),i.updateFloatArray([e.zmax]),i.updateIntArray([5]),i.updateFloatArray([e.zmin])),e.hasM&&(i.updateIntArray([6]),i.updateFloatArray([e.mmax]),i.updateIntArray([7]),i.updateFloatArray([e.mmin])),i.updateIntArray([3622027469]),void y(e.spatialReference.wkid,i,u);if(e instanceof h)return i.updateIntArray([14]),void 0!==e.wkid&&null!==e.wkid&&i.updateIntArray([e.wkid]),void(e.wkt&&i.updateWithString(e.wkt));if(a.isFunctionParameter(e))throw new o.ArcadeExecutionError(u.context,o.ExecutionErrorCodes.UnsupportedHashType,u.node);if(a.isFeatureSet(e))throw new o.ArcadeExecutionError(u.context,o.ExecutionErrorCodes.UnsupportedHashType,u.node);if(a.isFeatureSetCollection(e))throw new o.ArcadeExecutionError(u.context,o.ExecutionErrorCodes.UnsupportedHashType,u.node);if(e===a.voidOperation)throw new o.ArcadeExecutionError(u.context,o.ExecutionErrorCodes.UnsupportedHashType,u.node);throw new o.ArcadeExecutionError(u.context,o.ExecutionErrorCodes.UnsupportedHashType,u.node)}if(i.updateUint8Array([223]),u.map.has(e)){const t=u.map.get(e);i.updateIntArray([61237541^t])}else{u.map.set(e,u.currentLength++);for(const t of e.keys()){i.updateIntArray([t.length]),i.updateWithString(t),i.updateUint8Array([251]);y(e.field(t),i,u),i.updateUint8Array([239])}u.map.delete(e),u.currentLength--}i.updateUint8Array([73])}}else i.updateUint8Array([0,139])}function m(e,r){e.portal=function(e,n){return r(e,n,((r,o,i)=>(a.pcCheck(i,1,1,e,n),new t(a.toString(i[0])))))},e.typeof=function(e,t){return r(e,t,((r,n,i)=>{a.pcCheck(i,1,1,e,t);const u=a.getType(i[0]);if("Unrecognised Type"===u)throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.UnrecognisedType,t);return u}))},e.trim=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,1,1,e,t),a.toString(o[0]).trim())))},e.tohex=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,1,1,e,t);const i=a.toNumber(o[0]);return isNaN(i)?i:i.toString(16)}))},e.upper=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,1,1,e,t),a.toString(o[0]).toUpperCase())))},e.proper=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,1,2,e,t);let i=1;2===o.length&&"firstword"===a.toString(o[1]).toLowerCase()&&(i=2);const u=/\s/,c=a.toString(o[0]);let d="",s=!0;for(let e=0;e<c.length;e++){let t=c[e];if(u.test(t))1===i&&(s=!0);else{t.toUpperCase()!==t.toLowerCase()&&(s?(t=t.toUpperCase(),s=!1):t=t.toLowerCase())}d+=t}return d}))},e.lower=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,1,1,e,t),a.toString(o[0]).toLowerCase())))},e.guid=function(e,t){return r(e,t,((r,n,o)=>{if(a.pcCheck(o,0,1,e,t),o.length>0)switch(a.toString(o[0]).toLowerCase()){case"digits":return a.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return a.generateUUID();case"digits-hyphen-braces":return"{"+a.generateUUID()+"}";case"digits-hyphen-parentheses":return"("+a.generateUUID()+")"}return"{"+a.generateUUID()+"}"}))},e.standardizeguid=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,2,e,t);let i=a.toString(o[0]);if(""===i||null===i)return"";const u=/^(\{|\()?(?<partA>[0-9a-z]{8})(\-?)(?<partB>[0-9a-z]{4})(\-?)(?<partC>[0-9a-z]{4})(\-?)(?<partD>[0-9a-z]{4})(\-?)(?<partE>[0-9a-z]{12})(\}|\))?$/gim.exec(i);if(!u)return"";const c=u.groups;switch(i=c.partA+"-"+c.partB+"-"+c.partC+"-"+c.partD+"-"+c.partE,a.toString(o[1]).toLowerCase()){case"digits":return i.replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return i;case"digits-hyphen-braces":return"{"+i+"}";case"digits-hyphen-parentheses":return"("+i+")"}return"{"+i+"}"}))},e.console=function(e,t){return r(e,t,((t,r,n)=>(0===n.length||(1===n.length?e.console(a.toString(n[0])):e.console(a.toString(n))),a.voidOperation)))},e.mid=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,3,e,t);let i=a.toNumber(o[1]);if(isNaN(i))return"";if(i<0&&(i=0),2===o.length)return a.toString(o[0]).substr(i);let u=a.toNumber(o[2]);return isNaN(u)?"":(u<0&&(u=0),a.toString(o[0]).substr(i,u))}))},e.find=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,3,e,t);let i=0;if(o.length>2){if(i=a.toNumber(a.defaultUndefined(o[2],0)),isNaN(i))return-1;i<0&&(i=0)}return a.toString(o[1]).indexOf(a.toString(o[0]),i)}))},e.left=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,2,e,t);let i=a.toNumber(o[1]);return isNaN(i)?"":(i<0&&(i=0),a.toString(o[0]).substr(0,i))}))},e.right=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,2,2,e,t);let i=a.toNumber(o[1]);return isNaN(i)?"":(i<0&&(i=0),a.toString(o[0]).substr(-1*i,i))}))},e.split=function(e,t){return r(e,t,((r,n,o)=>{let i;a.pcCheck(o,2,4,e,t);let u=a.toNumber(a.defaultUndefined(o[2],-1));const c=a.toBoolean(a.defaultUndefined(o[3],!1));if(-1===u||null===u||!0===c?i=a.toString(o[0]).split(a.toString(o[1])):(isNaN(u)&&(u=-1),u<-1&&(u=-1),i=a.toString(o[0]).split(a.toString(o[1]),u)),!1===c)return i;const d=[];for(let e=0;e<i.length&&!(-1!==u&&d.length>=u);e++)""!==i[e]&&void 0!==i[e]&&d.push(i[e]);return d}))},e.text=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,1,2,e,t),a.toStringExplicit(o[0],o[1]))))},e.concatenate=function(e,t){return r(e,t,((e,t,r)=>{const n=[];if(r.length<1)return"";if(a.isArray(r[0])){const e=a.defaultUndefined(r[2],"");for(let t=0;t<r[0].length;t++)n[t]=a.toStringExplicit(r[0][t],e);return r.length>1?n.join(r[1]):n.join("")}if(a.isImmutableArray(r[0])){const e=a.defaultUndefined(r[2],"");for(let t=0;t<r[0].length();t++)n[t]=a.toStringExplicit(r[0].get(t),e);return r.length>1?n.join(r[1]):n.join("")}for(let o=0;o<r.length;o++)n[o]=a.toStringExplicit(r[o]);return n.join("")}))},e.reverse=function(e,t){return r(e,t,((r,n,i)=>{if(a.pcCheck(i,1,1,e,t),a.isArray(i[0])){const e=i[0].slice(0);return e.reverse(),e}if(a.isImmutableArray(i[0])){const e=i[0].toArray().slice(0);return e.reverse(),e}throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t)}))},e.replace=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,3,4,e,t);const i=a.toString(o[0]),u=a.toString(o[1]),c=a.toString(o[2]);return 4!==o.length||a.toBoolean(o[3])?a.multiReplace(i,u,c):i.replace(u,c)}))},e.schema=function(e,t){return r(e,t,((r,i,u)=>{if(a.isFeature(u[0])){const e=a.featureSchema(u[0]);return e?n.convertObjectToArcadeDictionary(e):null}throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t)}))},e.subtypes=function(e,t){return r(e,t,((r,i,u)=>{if(a.pcCheck(u,1,1,e,t),a.isFeature(u[0])){const e=a.featureSubtypes(u[0]);return e?n.convertObjectToArcadeDictionary(e):null}throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t)}))},e.subtypecode=function(e,t){return r(e,t,((r,n,i)=>{if(a.pcCheck(i,1,1,e,t),a.isFeature(i[0])){const e=a.featureSubtypes(i[0]);if(!e)return null;if(e.subtypeField&&i[0].hasField(e.subtypeField)){const t=i[0].field(e.subtypeField);for(const r of e.subtypes)if(r.code===t)return r.code;return null}return null}throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t)}))},e.subtypename=function(e,t){return r(e,t,((r,n,i)=>{if(a.pcCheck(i,1,1,e,t),a.isFeature(i[0])){const e=a.featureSubtypes(i[0]);if(!e)return"";if(e.subtypeField&&i[0].hasField(e.subtypeField)){const t=i[0].field(e.subtypeField);for(const r of e.subtypes)if(r.code===t)return r.name;return""}return""}throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t)}))},e.gdbversion=function(e,t){return r(e,t,((r,n,i)=>{if(a.pcCheck(i,1,1,e,t),a.isFeature(i[0]))return i[0].gdbVersion();throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t)}))},e.domain=function(e,t){return r(e,t,((r,u,c)=>{if(a.pcCheck(c,2,3,e,t),a.isFeature(c[0])){const e=a.featureFullDomain(c[0],a.toString(c[1]),void 0===c[2]?void 0:a.toNumber(c[2]));return e&&e.domain?"coded-value"===e.domain.type||"codedValue"===e.domain.type?n.convertObjectToArcadeDictionary({type:"codedValue",name:e.domain.name,dataType:i.layerFieldEsriConstants[e.field.type],codedValues:e.domain.codedValues.map((e=>({name:e.name,code:e.code})))}):n.convertObjectToArcadeDictionary({type:"range",name:e.domain.name,dataType:i.layerFieldEsriConstants[e.field.type],min:e.domain.min,max:e.domain.max}):null}throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t)}))},e.domainname=function(e,t){return r(e,t,((r,n,i)=>{if(a.pcCheck(i,2,4,e,t),a.isFeature(i[0]))return a.featureDomainValueLookup(i[0],a.toString(i[1]),i[2],void 0===i[3]?void 0:a.toNumber(i[3]));throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t)}))},e.domaincode=function(e,t){return r(e,t,((r,n,i)=>{if(a.pcCheck(i,2,4,e,t),a.isFeature(i[0]))return a.featureDomainCodeLookup(i[0],a.toString(i[1]),i[2],void 0===i[3]?void 0:a.toNumber(i[3]));throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t)}))},e.urlencode=function(e,t){return r(e,t,((r,o,i)=>{if(a.pcCheck(i,1,1,e,t),null===i[0])return"";if(i[0]instanceof n){let e="";for(const t of i[0].keys()){const r=i[0].field(t);""!==e&&(e+="&"),e+=null===r?encodeURIComponent(t)+"=":encodeURIComponent(t)+"="+encodeURIComponent(r)}return e}return encodeURIComponent(a.toString(i[0]))}))},e.hash=function(e,t){return r(e,t,((r,n,o)=>{a.pcCheck(o,1,1,e,t);const i=new c.XXH(0);return y(o[0],i,{context:e,node:t,map:new Map,currentLength:0}),i.digest()}))},e.convertdirection=function(e,t){return r(e,t,((r,n,o)=>(a.pcCheck(o,3,3,e,t),u.convertDirection(o[0],o[1],o[2]))))},e.fromjson=function(e,t){return r(e,t,((r,i,u)=>{if(a.pcCheck(u,1,1,e,t),!1===a.isString(u[0]))throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.InvalidParameter,t);return n.convertJsonToArcade(JSON.parse(a.toString(u[0])))}))},e.expects=function(e,t){return r(e,t,((r,n,i)=>{if(i.length<1)throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.WrongNumberOfParameters,t);return a.voidOperation}))},e.tocharcode=function(e,t){return r(e,t,((r,n,i)=>{a.pcCheck(i,1,2,e,t);const u=a.toNumber(a.defaultUndefined(i[1],0)),c=a.toString(i[0]);if(0===c.length&&1===i.length)return null;if(c.length<=u||u<0)throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.OutOfBounds,t);return c.charCodeAt(u)}))},e.tocodepoint=function(e,t){return r(e,t,((r,n,i)=>{a.pcCheck(i,1,2,e,t);const u=a.toNumber(a.defaultUndefined(i[1],0)),c=a.toString(i[0]);if(0===c.length&&1===i.length)return null;if(c.length<=u||u<0)throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.OutOfBounds,t);return c.codePointAt(u)}))},e.fromcharcode=function(e,t){return r(e,t,((r,n,i)=>{if(i.length<1)throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.WrongNumberOfParameters,t);const u=i.map((e=>Math.trunc(a.toNumber(e)))).filter((e=>e>=0&&e<=65535));return 0===u.length?null:String.fromCharCode.apply(null,u)}))},e.fromcodepoint=function(e,t){return r(e,t,((r,n,i)=>{if(i.length<1)throw new o.ArcadeExecutionError(e,o.ExecutionErrorCodes.WrongNumberOfParameters,t);let u;try{u=i.map((e=>Math.trunc(a.toNumber(e)))).filter((e=>e<=1114111&&e>>>0===e))}catch(c){return null}return 0===u.length?null:String.fromCodePoint.apply(null,u)}))}}e.registerFunctions=m,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
