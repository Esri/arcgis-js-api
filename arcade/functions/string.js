/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../ArcadePortal","../Attachment","../Dictionary","../Feature","../../chunks/languageUtils","../featureset/support/shared","./convertdirection","./hash","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/SpatialReference"],(function(t,e,r,n,o,i,a,u,c,s,p,d,f,l,h){"use strict";function y(t,e){if(t.x===e.x&&t.y===e.y){if(t.hasZ){if(t.z!==e.z)return!1}else if(e.hasZ)return!1;if(t.hasM){if(t.m!==e.m)return!1}else if(e.hasM)return!1;return!0}return!1}function g(t,a,u){if(null!==t)if(i.isArray(t)){if(a.updateUint8Array([61]),u.map.has(t)){const e=u.map.get(t);a.updateIntArray([61237541^e])}else{u.map.set(t,u.currentLength++);for(const e of t)g(e,a,u);u.map.delete(t),u.currentLength--}a.updateUint8Array([199])}else if(i.isImmutableArray(t)){if(a.updateUint8Array([61]),u.map.has(t)){const e=u.map.get(t);a.updateIntArray([61237541^e])}else{u.map.set(t,u.currentLength++);for(const e of t.toArray())g(e,a,u);u.map.delete(t),u.currentLength--}a.updateUint8Array([199])}else{if(i.isDate(t))return a.updateIntArray([t.getTime()]),void a.updateUint8Array([241]);if(i.isString(t))return a.updateIntArray([t.length]),a.updateWithString(t),void a.updateUint8Array([41]);if(i.isBoolean(t))a.updateUint8Array([!0===t?1:0,113]);else{if(i.isNumber(t))return a.updateFloatArray([t]),void a.updateUint8Array([173]);if(t instanceof r)throw new Error("Type not supported in Hash");if(t instanceof e)throw new Error("Type not supported in Hash");if(!(t instanceof n)){if(t instanceof o)throw new Error("Type not supported in Hash");if(t instanceof d)return a.updateIntArray([3833836621]),a.updateIntArray([0]),a.updateFloatArray([t.x]),a.updateIntArray([1]),a.updateFloatArray([t.y]),t.hasZ&&(a.updateIntArray([2]),a.updateFloatArray([t.z])),t.hasM&&(a.updateIntArray([3]),a.updateFloatArray([t.m])),a.updateIntArray([3765347959]),void g(t.spatialReference.wkid,a,u);if(t instanceof f){a.updateIntArray([1266616829]);for(let e=0;e<t.rings.length;e++){const r=t.rings[e],n=[];let o=null,i=null;for(let a=0;a<r.length;a++){const u=t.getPoint(e,a);if(0===a)o=u;else if(y(i,u))continue;i=u,a===r.length-1&&y(o,u)||n.push(u)}a.updateIntArray([1397116793,n.length]);for(let t=0;t<n.length;t++){const e=n[t];a.updateIntArray([3962308117,t]),g(e,a,u),a.updateIntArray([2716288009])}a.updateIntArray([2278822459])}return a.updateIntArray([3878477243]),void g(t.spatialReference.wkid,a,u)}if(t instanceof l){a.updateIntArray([4106883559]);for(let e=0;e<t.paths.length;e++){const r=t.paths[e];a.updateIntArray([1397116793,r.length]);for(let n=0;n<r.length;n++)a.updateIntArray([3962308117,n]),g(t.getPoint(e,n),a,u),a.updateIntArray([2716288009]);a.updateIntArray([2278822459])}return a.updateIntArray([2568784753]),void g(t.spatialReference.wkid,a,u)}if(t instanceof p){a.updateIntArray([588535921,t.points.length]);for(let e=0;e<t.points.length;e++){const r=t.getPoint(e);a.updateIntArray([e]),g(r,a,u)}return a.updateIntArray([1700171621]),void g(t.spatialReference.wkid,a,u)}if(t instanceof s)return a.updateIntArray([3483648373]),a.updateIntArray([0]),a.updateFloatArray([t.xmax]),a.updateIntArray([1]),a.updateFloatArray([t.xmin]),a.updateIntArray([2]),a.updateFloatArray([t.ymax]),a.updateIntArray([3]),a.updateFloatArray([t.ymin]),t.hasZ&&(a.updateIntArray([4]),a.updateFloatArray([t.zmax]),a.updateIntArray([5]),a.updateFloatArray([t.zmin])),t.hasM&&(a.updateIntArray([6]),a.updateFloatArray([t.mmax]),a.updateIntArray([7]),a.updateFloatArray([t.mmin])),a.updateIntArray([3622027469]),void g(t.spatialReference.wkid,a,u);if(t instanceof h)return a.updateIntArray([14]),void 0!==t.wkid&&null!==t.wkid&&a.updateIntArray([t.wkid]),void(t.wkt&&a.updateWithString(t.wkt));if(i.isFunctionParameter(t))throw new Error("Type not supported in Hash");if(i.isFeatureSet(t))throw new Error("Type not supported in Hash");if(i.isFeatureSetCollection(t))throw new Error("Type not supported in Hash");if(t===i.voidOperation)throw new Error("Type not supported in Hash");throw new Error("Type not supported in Hash")}if(a.updateUint8Array([223]),u.map.has(t)){const e=u.map.get(t);a.updateIntArray([61237541^e])}else{u.map.set(t,u.currentLength++);for(const e of t.keys()){a.updateIntArray([e.length]),a.updateWithString(e),a.updateUint8Array([251]);g(t.field(e),a,u),a.updateUint8Array([239])}u.map.delete(t),u.currentLength--}a.updateUint8Array([73])}}else a.updateUint8Array([0,139])}function m(t,r){t.portal=function(t,n){return r(t,n,(function(t,r,n){return i.pcCheck(n,1,1),new e(i.toString(n[0]))}))},t.trim=function(t,e){return r(t,e,(function(t,e,r){return i.pcCheck(r,1,1),i.toString(r[0]).trim()}))},t.tohex=function(t,e){return r(t,e,(function(t,e,r){i.pcCheck(r,1,1);const n=i.toNumber(r[0]);return isNaN(n)?n:n.toString(16)}))},t.upper=function(t,e){return r(t,e,(function(t,e,r){return i.pcCheck(r,1,1),i.toString(r[0]).toUpperCase()}))},t.proper=function(t,e){return r(t,e,(function(t,e,r){i.pcCheck(r,1,2);let n=1;2===r.length&&"firstword"===i.toString(r[1]).toLowerCase()&&(n=2);const o=/\s/,a=i.toString(r[0]);let u="",c=!0;for(let i=0;i<a.length;i++){let t=a[i];if(o.test(t))1===n&&(c=!0);else{t.toUpperCase()!==t.toLowerCase()&&(c?(t=t.toUpperCase(),c=!1):t=t.toLowerCase())}u+=t}return u}))},t.lower=function(t,e){return r(t,e,(function(t,e,r){return i.pcCheck(r,1,1),i.toString(r[0]).toLowerCase()}))},t.guid=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,0,1),r.length>0)switch(i.toString(r[0]).toLowerCase()){case"digits":return i.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return i.generateUUID();case"digits-hyphen-braces":return"{"+i.generateUUID()+"}";case"digits-hyphen-parentheses":return"("+i.generateUUID()+")"}return"{"+i.generateUUID()+"}"}))},t.console=function(t,e){return r(t,e,(function(e,r,n){return 0===n.length||(1===n.length?t.console(i.toString(n[0])):t.console(i.toString(n))),i.voidOperation}))},t.mid=function(t,e){return r(t,e,(function(t,e,r){i.pcCheck(r,2,3);let n=i.toNumber(r[1]);if(isNaN(n))return"";if(n<0&&(n=0),2===r.length)return i.toString(r[0]).substr(n);let o=i.toNumber(r[2]);return isNaN(o)?"":(o<0&&(o=0),i.toString(r[0]).substr(n,o))}))},t.find=function(t,e){return r(t,e,(function(t,e,r){i.pcCheck(r,2,3);let n=0;if(r.length>2){if(n=i.toNumber(i.defaultUndefined(r[2],0)),isNaN(n))return-1;n<0&&(n=0)}return i.toString(r[1]).indexOf(i.toString(r[0]),n)}))},t.left=function(t,e){return r(t,e,(function(t,e,r){i.pcCheck(r,2,2);let n=i.toNumber(r[1]);return isNaN(n)?"":(n<0&&(n=0),i.toString(r[0]).substr(0,n))}))},t.right=function(t,e){return r(t,e,(function(t,e,r){i.pcCheck(r,2,2);let n=i.toNumber(r[1]);return isNaN(n)?"":(n<0&&(n=0),i.toString(r[0]).substr(-1*n,n))}))},t.split=function(t,e){return r(t,e,(function(t,e,r){let n;i.pcCheck(r,2,4);let o=i.toNumber(i.defaultUndefined(r[2],-1));const a=i.toBoolean(i.defaultUndefined(r[3],!1));if(-1===o||null===o||!0===a?n=i.toString(r[0]).split(i.toString(r[1])):(isNaN(o)&&(o=-1),o<-1&&(o=-1),n=i.toString(r[0]).split(i.toString(r[1]),o)),!1===a)return n;const u=[];for(let i=0;i<n.length&&!(-1!==o&&u.length>=o);i++)""!==n[i]&&void 0!==n[i]&&u.push(n[i]);return u}))},t.text=function(t,e){return r(t,e,(function(t,e,r){return i.pcCheck(r,1,2),i.toStringExplicit(r[0],r[1])}))},t.concatenate=function(t,e){return r(t,e,(function(t,e,r){const n=[];if(r.length<1)return"";if(i.isArray(r[0])){const t=i.defaultUndefined(r[2],"");for(let e=0;e<r[0].length;e++)n[e]=i.toStringExplicit(r[0][e],t);return r.length>1?n.join(r[1]):n.join("")}if(i.isImmutableArray(r[0])){const t=i.defaultUndefined(r[2],"");for(let e=0;e<r[0].length();e++)n[e]=i.toStringExplicit(r[0].get(e),t);return r.length>1?n.join(r[1]):n.join("")}for(let o=0;o<r.length;o++)n[o]=i.toStringExplicit(r[o]);return n.join("")}))},t.reverse=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,1,1),i.isArray(r[0])){const t=r[0].slice(0);return t.reverse(),t}if(i.isImmutableArray(r[0])){const t=r[0].toArray().slice(0);return t.reverse(),t}throw new Error("Invalid Parameter")}))},t.replace=function(t,e){return r(t,e,(function(t,e,r){i.pcCheck(r,3,4);const n=i.toString(r[0]),o=i.toString(r[1]),a=i.toString(r[2]);return 4!==r.length||i.toBoolean(r[3])?i.multiReplace(n,o,a):n.replace(o,a)}))},t.schema=function(t,e){return r(t,e,(function(t,e,r){if(r[0]instanceof o){const t=r[0].schema();return t?n.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypes=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,1,1),r[0]instanceof o){const t=r[0].subtypes();return t?n.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypecode=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,1,1),r[0]instanceof o){const t=r[0].subtypes();if(!t)return null;if(t.subtypeField&&r[0].hasField(t.subtypeField)){const e=r[0].field(t.subtypeField);for(const r of t.subtypes)if(r.code===e)return r.code;return null}return null}throw new Error("Invalid Parameter")}))},t.subtypename=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,1,1),r[0]instanceof o){const t=r[0].subtypes();if(!t)return"";if(t.subtypeField&&r[0].hasField(t.subtypeField)){const e=r[0].field(t.subtypeField);for(const r of t.subtypes)if(r.code===e)return r.name;return""}return""}throw new Error("Invalid Parameter")}))},t.gdbversion=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,1,1),r[0]instanceof o)return r[0].gdbVersion();throw new Error("Invalid Parameter")}))},t.domain=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,2,3),r[0]instanceof o){const t=r[0].fullDomain(i.toString(r[1]),void 0===r[2]?void 0:i.toNumber(r[2]));return t&&t.domain?"coded-value"===t.domain.type||"codedValue"===t.domain.type?n.convertObjectToArcadeDictionary({type:"codedValue",name:t.domain.name,dataType:a.layerFieldEsriConstants[t.field.type],codedValues:t.domain.codedValues.map((t=>({name:t.name,code:t.code})))}):n.convertObjectToArcadeDictionary({type:"range",name:t.domain.name,dataType:a.layerFieldEsriConstants[t.field.type],min:t.domain.min,max:t.domain.max}):null}throw new Error("Invalid Parameter")}))},t.domainname=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,2,4),r[0]instanceof o)return r[0].domainValueLookup(i.toString(r[1]),r[2],void 0===r[3]?void 0:i.toNumber(r[3]));throw new Error("Invalid Parameter")}))},t.domaincode=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,2,4),r[0]instanceof o)return r[0].domainCodeLookup(i.toString(r[1]),r[2],void 0===r[3]?void 0:i.toNumber(r[3]));throw new Error("Invalid Parameter")}))},t.urlencode=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,1,1),null===r[0])return"";if(r[0]instanceof n){let t="";for(const e of r[0].keys()){const n=r[0].field(e);""!==t&&(t+="&"),t+=null===n?encodeURIComponent(e)+"=":encodeURIComponent(e)+"="+encodeURIComponent(n)}return t}return encodeURIComponent(i.toString(r[0]))}))},t.hash=function(t,e){return r(t,e,(function(t,e,r){i.pcCheck(r,1,1);const n=new c.XXH(0);return g(r[0],n,{map:new Map,currentLength:0}),n.digest()}))},t.convertdirection=function(t,e){return r(t,e,(function(t,e,r){return i.pcCheck(r,3,3),u.convertDirection(r[0],r[1],r[2])}))},t.fromjson=function(t,e){return r(t,e,(function(t,e,r){if(i.pcCheck(r,1,1),!1===i.isString(r[0]))throw new Error("Invalid Parameter");return n.convertJsonToArcade(JSON.parse(i.toString(r[0])))}))},t.expects=function(t,e){return r(t,e,(function(t,e,r){if(r.length<1)throw new Error("Function called with wrong number of Parameters");return i.voidOperation}))}}t.registerFunctions=m,Object.defineProperty(t,"__esModule",{value:!0})}));
