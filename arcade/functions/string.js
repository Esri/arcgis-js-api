/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
define(["exports","../../geometry/SpatialReference","../../geometry/Point","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Polygon","../../geometry/Polyline","../../chunks/languageUtils","../Dictionary","../ArcadePortal","../Attachment","../featureset/support/shared","../Feature","./convertdirection","./hash"],(function(t,e,n,r,o,i,a,u,c,s,p,d,f,l,y){"use strict";function h(t,e){if(t.x===e.x&&t.y===e.y){if(t.hasZ){if(t.z!==e.z)return!1}else if(e.hasZ)return!1;if(t.hasM){if(t.m!==e.m)return!1}else if(e.hasM)return!1;return!0}return!1}function g(t,d,l){if(null!==t)if(u.isArray(t)){if(d.updateUint8Array([61]),l.map.has(t)){const e=l.map.get(t);d.updateIntArray([61237541^e])}else{l.map.set(t,l.currentLength++);for(const e of t)g(e,d,l);l.map.delete(t),l.currentLength--}d.updateUint8Array([199])}else if(u.isImmutableArray(t)){if(d.updateUint8Array([61]),l.map.has(t)){const e=l.map.get(t);d.updateIntArray([61237541^e])}else{l.map.set(t,l.currentLength++);for(const e of t.toArray())g(e,d,l);l.map.delete(t),l.currentLength--}d.updateUint8Array([199])}else{if(u.isDate(t))return d.updateIntArray([t.getTime()]),void d.updateUint8Array([241]);if(u.isString(t))return d.updateIntArray([t.length]),d.updateWithString(t),void d.updateUint8Array([41]);if(u.isBoolean(t))d.updateUint8Array([!0===t?1:0,113]);else{if(u.isNumber(t))return d.updateFloatArray([t]),void d.updateUint8Array([173]);if(t instanceof p)throw new Error("Type not supported in Hash");if(t instanceof s)throw new Error("Type not supported in Hash");if(!(t instanceof c)){if(t instanceof f)throw new Error("Type not supported in Hash");if(t instanceof n)return d.updateIntArray([3833836621]),d.updateIntArray([0]),d.updateFloatArray([t.x]),d.updateIntArray([1]),d.updateFloatArray([t.y]),t.hasZ&&(d.updateIntArray([2]),d.updateFloatArray([t.z])),t.hasM&&(d.updateIntArray([3]),d.updateFloatArray([t.m])),d.updateIntArray([3765347959]),void g(t.spatialReference.wkid,d,l);if(t instanceof i){d.updateIntArray([1266616829]);for(let e=0;e<t.rings.length;e++){const n=t.rings[e],r=[];let o=null,i=null;for(let a=0;a<n.length;a++){const u=t.getPoint(e,a);if(0===a)o=u;else if(h(i,u))continue;i=u,a===n.length-1&&h(o,u)||r.push(u)}d.updateIntArray([1397116793,r.length]);for(let t=0;t<r.length;t++){const e=r[t];d.updateIntArray([3962308117,t]),g(e,d,l),d.updateIntArray([2716288009])}d.updateIntArray([2278822459])}return d.updateIntArray([3878477243]),void g(t.spatialReference.wkid,d,l)}if(t instanceof a){d.updateIntArray([4106883559]);for(let e=0;e<t.paths.length;e++){const n=t.paths[e];d.updateIntArray([1397116793,n.length]);for(let r=0;r<n.length;r++)d.updateIntArray([3962308117,r]),g(t.getPoint(e,r),d,l),d.updateIntArray([2716288009]);d.updateIntArray([2278822459])}return d.updateIntArray([2568784753]),void g(t.spatialReference.wkid,d,l)}if(t instanceof o){d.updateIntArray([588535921,t.points.length]);for(let e=0;e<t.points.length;e++){const n=t.getPoint(e);d.updateIntArray([e]),g(n,d,l)}return d.updateIntArray([1700171621]),void g(t.spatialReference.wkid,d,l)}if(t instanceof r)return d.updateIntArray([3483648373]),d.updateIntArray([0]),d.updateFloatArray([t.xmax]),d.updateIntArray([1]),d.updateFloatArray([t.xmin]),d.updateIntArray([2]),d.updateFloatArray([t.ymax]),d.updateIntArray([3]),d.updateFloatArray([t.ymin]),t.hasZ&&(d.updateIntArray([4]),d.updateFloatArray([t.zmax]),d.updateIntArray([5]),d.updateFloatArray([t.zmin])),t.hasM&&(d.updateIntArray([6]),d.updateFloatArray([t.mmax]),d.updateIntArray([7]),d.updateFloatArray([t.mmin])),d.updateIntArray([3622027469]),void g(t.spatialReference.wkid,d,l);if(t instanceof e)return d.updateIntArray([14]),void 0!==t.wkid&&null!==t.wkid&&d.updateIntArray([t.wkid]),void(t.wkt&&d.updateWithString(t.wkt));if(u.isFunctionParameter(t))throw new Error("Type not supported in Hash");if(u.isFeatureSet(t))throw new Error("Type not supported in Hash");if(u.isFeatureSetCollection(t))throw new Error("Type not supported in Hash");if(t===u.voidOperation)throw new Error("Type not supported in Hash");throw new Error("Type not supported in Hash")}if(d.updateUint8Array([223]),l.map.has(t)){const e=l.map.get(t);d.updateIntArray([61237541^e])}else{l.map.set(t,l.currentLength++);for(const e of t.keys()){d.updateIntArray([e.length]),d.updateWithString(e),d.updateUint8Array([251]);g(t.field(e),d,l),d.updateUint8Array([239])}l.map.delete(t),l.currentLength--}d.updateUint8Array([73])}}else d.updateUint8Array([0,139])}function m(t,e){t.portal=function(t,n){return e(t,n,(function(t,e,n){return u.pcCheck(n,1,1),new s(u.toString(n[0]))}))},t.trim=function(t,n){return e(t,n,(function(t,e,n){return u.pcCheck(n,1,1),u.toString(n[0]).trim()}))},t.tohex=function(t,n){return e(t,n,(function(t,e,n){u.pcCheck(n,1,1);const r=u.toNumber(n[0]);return isNaN(r)?r:r.toString(16)}))},t.upper=function(t,n){return e(t,n,(function(t,e,n){return u.pcCheck(n,1,1),u.toString(n[0]).toUpperCase()}))},t.proper=function(t,n){return e(t,n,(function(t,e,n){u.pcCheck(n,1,2);let r=1;2===n.length&&"firstword"===u.toString(n[1]).toLowerCase()&&(r=2);const o=/\s/,i=u.toString(n[0]);let a="",c=!0;for(let u=0;u<i.length;u++){let t=i[u];if(o.test(t))1===r&&(c=!0);else{t.toUpperCase()!==t.toLowerCase()&&(c?(t=t.toUpperCase(),c=!1):t=t.toLowerCase())}a+=t}return a}))},t.lower=function(t,n){return e(t,n,(function(t,e,n){return u.pcCheck(n,1,1),u.toString(n[0]).toLowerCase()}))},t.guid=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,0,1),n.length>0)switch(u.toString(n[0]).toLowerCase()){case"digits":return u.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return u.generateUUID();case"digits-hyphen-braces":return"{"+u.generateUUID()+"}";case"digits-hyphen-parentheses":return"("+u.generateUUID()+")"}return"{"+u.generateUUID()+"}"}))},t.console=function(t,n){return e(t,n,(function(e,n,r){return 0===r.length||(1===r.length?t.console(u.toString(r[0])):t.console(u.toString(r))),u.voidOperation}))},t.mid=function(t,n){return e(t,n,(function(t,e,n){u.pcCheck(n,2,3);let r=u.toNumber(n[1]);if(isNaN(r))return"";if(r<0&&(r=0),2===n.length)return u.toString(n[0]).substr(r);let o=u.toNumber(n[2]);return isNaN(o)?"":(o<0&&(o=0),u.toString(n[0]).substr(r,o))}))},t.find=function(t,n){return e(t,n,(function(t,e,n){u.pcCheck(n,2,3);let r=0;if(n.length>2){if(r=u.toNumber(u.defaultUndefined(n[2],0)),isNaN(r))return-1;r<0&&(r=0)}return u.toString(n[1]).indexOf(u.toString(n[0]),r)}))},t.left=function(t,n){return e(t,n,(function(t,e,n){u.pcCheck(n,2,2);let r=u.toNumber(n[1]);return isNaN(r)?"":(r<0&&(r=0),u.toString(n[0]).substr(0,r))}))},t.right=function(t,n){return e(t,n,(function(t,e,n){u.pcCheck(n,2,2);let r=u.toNumber(n[1]);return isNaN(r)?"":(r<0&&(r=0),u.toString(n[0]).substr(-1*r,r))}))},t.split=function(t,n){return e(t,n,(function(t,e,n){let r;u.pcCheck(n,2,4);let o=u.toNumber(u.defaultUndefined(n[2],-1));const i=u.toBoolean(u.defaultUndefined(n[3],!1));if(-1===o||null===o||!0===i?r=u.toString(n[0]).split(u.toString(n[1])):(isNaN(o)&&(o=-1),o<-1&&(o=-1),r=u.toString(n[0]).split(u.toString(n[1]),o)),!1===i)return r;const a=[];for(let u=0;u<r.length&&!(-1!==o&&a.length>=o);u++)""!==r[u]&&void 0!==r[u]&&a.push(r[u]);return a}))},t.text=function(t,n){return e(t,n,(function(t,e,n){return u.pcCheck(n,1,2),u.toStringExplicit(n[0],n[1])}))},t.concatenate=function(t,n){return e(t,n,(function(t,e,n){const r=[];if(n.length<1)return"";if(u.isArray(n[0])){const t=u.defaultUndefined(n[2],"");for(let e=0;e<n[0].length;e++)r[e]=u.toStringExplicit(n[0][e],t);return n.length>1?r.join(n[1]):r.join("")}if(u.isImmutableArray(n[0])){const t=u.defaultUndefined(n[2],"");for(let e=0;e<n[0].length();e++)r[e]=u.toStringExplicit(n[0].get(e),t);return n.length>1?r.join(n[1]):r.join("")}for(let o=0;o<n.length;o++)r[o]=u.toStringExplicit(n[o]);return r.join("")}))},t.reverse=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,1,1),u.isArray(n[0])){const t=n[0].slice(0);return t.reverse(),t}if(u.isImmutableArray(n[0])){const t=n[0].toArray().slice(0);return t.reverse(),t}throw new Error("Invalid Parameter")}))},t.replace=function(t,n){return e(t,n,(function(t,e,n){u.pcCheck(n,3,4);const r=u.toString(n[0]),o=u.toString(n[1]),i=u.toString(n[2]);return 4!==n.length||u.toBoolean(n[3])?u.multiReplace(r,o,i):r.replace(o,i)}))},t.schema=function(t,n){return e(t,n,(function(t,e,n){if(n[0]instanceof f){const t=n[0].schema();return t?c.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypes=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,1,1),n[0]instanceof f){const t=n[0].subtypes();return t?c.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypecode=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,1,1),n[0]instanceof f){const t=n[0].subtypes();if(!t)return null;if(t.subtypeField&&n[0].hasField(t.subtypeField)){const e=n[0].field(t.subtypeField);for(const n of t.subtypes)if(n.code===e)return n.code;return null}return null}throw new Error("Invalid Parameter")}))},t.subtypename=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,1,1),n[0]instanceof f){const t=n[0].subtypes();if(!t)return"";if(t.subtypeField&&n[0].hasField(t.subtypeField)){const e=n[0].field(t.subtypeField);for(const n of t.subtypes)if(n.code===e)return n.name;return""}return""}throw new Error("Invalid Parameter")}))},t.gdbversion=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,1,1),n[0]instanceof f)return n[0].gdbVersion();throw new Error("Invalid Parameter")}))},t.domain=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,2,3),n[0]instanceof f){const t=n[0].fullDomain(u.toString(n[1]),void 0===n[2]?void 0:u.toNumber(n[2]));return t&&t.domain?"coded-value"===t.domain.type||"codedValue"===t.domain.type?c.convertObjectToArcadeDictionary({type:"codedValue",name:t.domain.name,dataType:d.layerFieldEsriConstants[t.field.type],codedValues:t.domain.codedValues.map((t=>({name:t.name,code:t.code})))}):c.convertObjectToArcadeDictionary({type:"range",name:t.domain.name,dataType:d.layerFieldEsriConstants[t.field.type],min:t.domain.min,max:t.domain.max}):null}throw new Error("Invalid Parameter")}))},t.domainname=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,2,4),n[0]instanceof f)return n[0].domainValueLookup(u.toString(n[1]),n[2],void 0===n[3]?void 0:u.toNumber(n[3]));throw new Error("Invalid Parameter")}))},t.domaincode=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,2,4),n[0]instanceof f)return n[0].domainCodeLookup(u.toString(n[1]),n[2],void 0===n[3]?void 0:u.toNumber(n[3]));throw new Error("Invalid Parameter")}))},t.urlencode=function(t,n){return e(t,n,(function(t,e,n){if(u.pcCheck(n,1,1),null===n[0])return"";if(n[0]instanceof c){let t="";for(const e of n[0].keys()){const r=n[0].field(e);""!==t&&(t+="&"),t+=null===r?encodeURIComponent(e)+"=":encodeURIComponent(e)+"="+encodeURIComponent(r)}return t}return encodeURIComponent(u.toString(n[0]))}))},t.hash=function(t,n){return e(t,n,(function(t,e,n){u.pcCheck(n,1,1);const r=new y.XXH(0);return g(n[0],r,{map:new Map,currentLength:0}),r.digest()}))},t.convertdirection=function(t,n){return e(t,n,(function(t,e,n){return u.pcCheck(n,3,3),l.convertDirection(n[0],n[1],n[2])}))}}t.registerFunctions=m,Object.defineProperty(t,"__esModule",{value:!0})}));
