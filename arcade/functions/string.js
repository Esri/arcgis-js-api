// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.40/esri/copyright.txt for details.

define(["require","exports","../ArcadePortal","../Attachment","../Dictionary","../Feature","../languageUtils","../featureset/support/shared","./convertdirection","./hash","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../SpatialReference"],(function(r,t,e,n,i,o,a,u,c,f,d,l,p,s,h,g){"use strict";function y(r,t){return r.x===t.x&&r.y===t.y}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=void 0,t.registerFunctions=function(r,t){r.portal=function(r,n){return t(r,n,(function(r,t,n){return a.pcCheck(n,1,1),new e(a.toString(n[0]))}))},r.trim=function(r,e){return t(r,e,(function(r,t,e){return a.pcCheck(e,1,1),a.toString(e[0]).trim()}))},r.tohex=function(r,e){return t(r,e,(function(r,t,e){a.pcCheck(e,1,1);var n=a.toNumber(e[0]);return isNaN(n)?n:n.toString(16)}))},r.upper=function(r,e){return t(r,e,(function(r,t,e){return a.pcCheck(e,1,1),a.toString(e[0]).toUpperCase()}))},r.proper=function(r,e){return t(r,e,(function(r,t,e){a.pcCheck(e,1,2);var n=1;2===e.length&&"firstword"===a.toString(e[1]).toLowerCase()&&(n=2);for(var i=/\s/,o=a.toString(e[0]),u="",c=!0,f=0;f<o.length;f++){var d=o[f];if(i.test(d))1===n&&(c=!0);else d.toUpperCase()!==d.toLowerCase()&&(c?(d=d.toUpperCase(),c=!1):d=d.toLowerCase());u+=d}return u}))},r.lower=function(r,e){return t(r,e,(function(r,t,e){return a.pcCheck(e,1,1),a.toString(e[0]).toLowerCase()}))},r.guid=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,0,1),e.length>0)switch(a.toString(e[0]).toLowerCase()){case"digits":return a.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return a.generateUUID();case"digits-hyphen-braces":return"{"+a.generateUUID()+"}";case"digits-hyphen-parentheses":return"("+a.generateUUID()+")"}return"{"+a.generateUUID()+"}"}))},r.console=function(r,e){return t(r,e,(function(t,e,n){return 0===n.length||(1===n.length?r.console(a.toString(n[0])):r.console(a.toString(n))),a.voidOperation}))},r.mid=function(r,e){return t(r,e,(function(r,t,e){a.pcCheck(e,2,3);var n=a.toNumber(e[1]);if(isNaN(n))return"";if(n<0&&(n=0),2===e.length)return a.toString(e[0]).substr(n);var i=a.toNumber(e[2]);return isNaN(i)?"":(i<0&&(i=0),a.toString(e[0]).substr(n,i))}))},r.find=function(r,e){return t(r,e,(function(r,t,e){a.pcCheck(e,2,3);var n=0;if(e.length>2){if(n=a.toNumber(a.defaultUndefined(e[2],0)),isNaN(n))return-1;n<0&&(n=0)}return a.toString(e[1]).indexOf(a.toString(e[0]),n)}))},r.left=function(r,e){return t(r,e,(function(r,t,e){a.pcCheck(e,2,2);var n=a.toNumber(e[1]);return isNaN(n)?"":(n<0&&(n=0),a.toString(e[0]).substr(0,n))}))},r.right=function(r,e){return t(r,e,(function(r,t,e){a.pcCheck(e,2,2);var n=a.toNumber(e[1]);return isNaN(n)?"":(n<0&&(n=0),a.toString(e[0]).substr(-1*n,n))}))},r.split=function(r,e){return t(r,e,(function(r,t,e){var n;a.pcCheck(e,2,4);var i=a.toNumber(a.defaultUndefined(e[2],-1)),o=a.toBoolean(a.defaultUndefined(e[3],!1));if(-1===i||null===i||!0===o?n=a.toString(e[0]).split(a.toString(e[1])):(isNaN(i)&&(i=-1),i<-1&&(i=-1),n=a.toString(e[0]).split(a.toString(e[1]),i)),!1===o)return n;for(var u=[],c=0;c<n.length&&!(-1!==i&&u.length>=i);c++)""!==n[c]&&void 0!==n[c]&&u.push(n[c]);return u}))},r.text=function(r,e){return t(r,e,(function(r,t,e){return a.pcCheck(e,1,2),a.toStringExplicit(e[0],e[1])}))},r.concatenate=function(r,e){return t(r,e,(function(r,t,e){var n=[];if(e.length<1)return"";if(a.isArray(e[0])){for(var i=a.defaultUndefined(e[2],""),o=0;o<e[0].length;o++)n[o]=a.toStringExplicit(e[0][o],i);return e.length>1?n.join(e[1]):n.join("")}if(a.isImmutableArray(e[0])){for(i=a.defaultUndefined(e[2],""),o=0;o<e[0].length();o++)n[o]=a.toStringExplicit(e[0].get(o),i);return e.length>1?n.join(e[1]):n.join("")}for(o=0;o<e.length;o++)n[o]=a.toStringExplicit(e[o]);return n.join("")}))},r.reverse=function(r,e){return t(r,e,(function(r,t,e){var n;if(a.pcCheck(e,1,1),a.isArray(e[0]))return(n=e[0].slice(0)).reverse(),n;if(a.isImmutableArray(e[0]))return(n=e[0].toArray().slice(0)).reverse(),n;throw new Error("Invalid Parameter")}))},r.replace=function(r,e){return t(r,e,(function(r,t,e){a.pcCheck(e,3,4);var n=a.toString(e[0]),i=a.toString(e[1]),o=a.toString(e[2]);return 4!==e.length||a.toBoolean(e[3])?a.multiReplace(n,i,o):n.replace(i,o)}))},r.schema=function(r,e){return t(r,e,(function(r,t,e){if(e[0]instanceof o){var n=e[0].schema();return n?i.convertObjectToArcadeDictionary(n):null}throw new Error("Invalid Parameter")}))},r.subtypes=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,1,1),e[0]instanceof o){var n=e[0].subtypes();return n?i.convertObjectToArcadeDictionary(n):null}throw new Error("Invalid Parameter")}))},r.subtypecode=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,1,1),e[0]instanceof o){var n=e[0].subtypes();if(!n)return null;if(n.subtypeField&&e[0].hasField(n.subtypeField)){for(var i=e[0].field(n.subtypeField),u=0,c=n.subtypes;u<c.length;u++){var f=c[u];if(f.code===i)return f.code}return null}return null}throw new Error("Invalid Parameter")}))},r.subtypename=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,1,1),e[0]instanceof o){var n=e[0].subtypes();if(!n)return"";if(n.subtypeField&&e[0].hasField(n.subtypeField)){for(var i=e[0].field(n.subtypeField),u=0,c=n.subtypes;u<c.length;u++){var f=c[u];if(f.code===i)return f.name}return""}return""}throw new Error("Invalid Parameter")}))},r.gdbversion=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,1,1),e[0]instanceof o)return e[0].gdbVersion();throw new Error("Invalid Parameter")}))},r.domain=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,2,3),e[0]instanceof o){var n=e[0].fullDomain(a.toString(e[1]),void 0===e[2]?void 0:a.toNumber(e[2]));return n&&n.domain?"coded-value"===n.domain.type||"codedValue"===n.domain.type?i.convertObjectToArcadeDictionary({type:"codedValue",name:n.domain.name,dataType:u.layerFieldEsriConstants[n.field.type],codedValues:n.domain.codedValues.map((function(r){return{name:r.name,code:r.code}}))}):i.convertObjectToArcadeDictionary({type:"range",name:n.domain.name,dataType:u.layerFieldEsriConstants[n.field.type],min:n.domain.min,max:n.domain.max}):null}throw new Error("Invalid Parameter")}))},r.domainname=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,2,4),e[0]instanceof o)return e[0].domainValueLookup(a.toString(e[1]),e[2],void 0===e[3]?void 0:a.toNumber(e[3]));throw new Error("Invalid Parameter")}))},r.domaincode=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,2,4),e[0]instanceof o)return e[0].domainCodeLookup(a.toString(e[1]),e[2],void 0===e[3]?void 0:a.toNumber(e[3]));throw new Error("Invalid Parameter")}))},r.urlencode=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,1,1),null===e[0])return"";if(e[0]instanceof i){for(var n="",o=0,u=e[0].keys();o<u.length;o++){var c=u[o],f=e[0].field(c);""!==n&&(n+="&"),n+=null===f?encodeURIComponent(c)+"=":encodeURIComponent(c)+"="+encodeURIComponent(f)}return n}return encodeURIComponent(a.toString(e[0]))}))},r.hash=function(r,u){return t(r,u,(function(r,t,u){a.pcCheck(u,1,1);var c=new f.XXH(0);return function r(t,u,c){if(null!==t)if(a.isArray(t)){if(u.updateUint8Array([61]),c.map.has(t)){var f=c.map.get(t);u.updateIntArray([61237541^f])}else{c.map.set(t,c.currentLength++);for(var m=0,v=t;m<v.length;m++){r(v[m],u,c)}c.map.delete(t),c.currentLength--}u.updateUint8Array([199])}else if(a.isImmutableArray(t)){if(u.updateUint8Array([61]),c.map.has(t)){f=c.map.get(t);u.updateIntArray([61237541^f])}else{c.map.set(t,c.currentLength++);for(var w=0,A=t.toArray();w<A.length;w++){r(A[w],u,c)}c.map.delete(t),c.currentLength--}u.updateUint8Array([199])}else{if(a.isDate(t))return u.updateIntArray([t.getTime()]),void u.updateUint8Array([241]);if(a.isString(t))return u.updateIntArray([t.length]),u.updateWithString(t),void u.updateUint8Array([41]);if(a.isBoolean(t))u.updateUint8Array([!0===t?1:0,113]);else{if(a.isNumber(t))return u.updateFloatArray([t]),void u.updateUint8Array([173]);if(t instanceof n)throw new Error("Type not supported in Hash");if(t instanceof e)throw new Error("Type not supported in Hash");if(!(t instanceof i)){if(t instanceof o)throw new Error("Type not supported in Hash");if(t instanceof p)return u.updateIntArray([3833836621]),u.updateIntArray([0]),u.updateFloatArray([t.x]),u.updateIntArray([1]),u.updateFloatArray([t.y]),u.updateIntArray([3765347959]),void r(t.spatialReference.wkid,u,c);if(t instanceof s){u.updateIntArray([1266616829]);for(var I=0;I<t.rings.length;I++){for(var C=t.rings[I],b=[],S=null,k=null,U=0;U<C.length;U++){var E=t.getPoint(I,U);if(0===U)S=E;else if(y(k,E))continue;k=E,U===C.length-1&&y(S,E)||b.push(E)}u.updateIntArray([1397116793,b.length]);for(U=0;U<b.length;U++){E=b[U];u.updateIntArray([3962308117,U]),r(E,u,c),u.updateIntArray([2716288009])}u.updateIntArray([2278822459])}return u.updateIntArray([3878477243]),void r(t.spatialReference.wkid,u,c)}if(t instanceof h){u.updateIntArray([4106883559]);for(I=0;I<t.paths.length;I++){C=t.paths[I];u.updateIntArray([1397116793,C.length]);for(U=0;U<C.length;U++)u.updateIntArray([3962308117,U]),r(t.getPoint(I,U),u,c),u.updateIntArray([2716288009]);u.updateIntArray([2278822459])}return u.updateIntArray([2568784753]),void r(t.spatialReference.wkid,u,c)}if(t instanceof l){u.updateIntArray([588535921,t.points.length]);for(U=0;U<t.points.length;U++){var N=t.getPoint(U);u.updateIntArray([U]),r(N,u,c)}return u.updateIntArray([1700171621]),void r(t.spatialReference.wkid,u,c)}if(t instanceof d)return u.updateIntArray([3483648373]),u.updateIntArray([0]),u.updateFloatArray([t.xmax]),u.updateIntArray([1]),u.updateFloatArray([t.xmin]),u.updateIntArray([2]),u.updateFloatArray([t.ymax]),u.updateIntArray([3]),u.updateFloatArray([t.ymin]),u.updateIntArray([3622027469]),void r(t.spatialReference.wkid,u,c);if(t instanceof g)return u.updateIntArray([14]),void 0!==t.wkid&&null!==t.wkid&&u.updateIntArray([t.wkid]),void(t.wkt&&u.updateWithString(t.wkt));if(a.isFunctionParameter(t))throw new Error("Type not supported in Hash");if(a.isFeatureSet(t))throw new Error("Type not supported in Hash");if(a.isFeatureSetCollection(t))throw new Error("Type not supported in Hash");if(t===a.voidOperation)throw new Error("Type not supported in Hash");throw new Error("Type not supported in Hash")}if(u.updateUint8Array([223]),c.map.has(t)){f=c.map.get(t);u.updateIntArray([61237541^f])}else{c.map.set(t,c.currentLength++);for(var F=0,P=t.keys();F<P.length;F++){var x=P[F];u.updateIntArray([x.length]),u.updateWithString(x),u.updateUint8Array([251]),r(t.field(x),u,c),u.updateUint8Array([239])}c.map.delete(t),c.currentLength--}u.updateUint8Array([73])}}else u.updateUint8Array([0,139])}(u[0],c,{map:new Map,currentLength:0}),c.digest()}))},r.convertdirection=function(r,e){return t(r,e,(function(r,t,e){return a.pcCheck(e,3,3),c.convertDirection(e[0],e[1],e[2])}))},r.fromjson=function(r,e){return t(r,e,(function(r,t,e){if(a.pcCheck(e,1,1),!1===a.isString(e[0]))throw new Error("Invalid Parameter");return i.convertJsonToArcade(JSON.parse(a.toString(e[0])))}))},r.expects=function(r,e){return t(r,e,(function(r,t,e){if(e.length<1)throw new Error("Function called with wrong number of Parameters");return a.voidOperation}))},r.tocharcode=function(r,e){return t(r,e,(function(r,t,e){a.pcCheck(e,1,2);var n=a.toNumber(a.defaultUndefined(e[1],0)),i=a.toString(e[0]);if(0===i.length&&1===e.length)return null;if(i.length<=n||n<0)throw new Error("Illegal argument");return i.charCodeAt(n)}))},r.tocodepoint=function(r,e){return t(r,e,(function(r,t,e){a.pcCheck(e,1,2);var n=a.toNumber(a.defaultUndefined(e[1],0)),i=a.toString(e[0]);if(0===i.length&&1===e.length)return null;if(i.length<=n||n<0)throw new Error("Illegal argument");return i.codePointAt(n)}))},r.fromcharcode=function(r,e){return t(r,e,(function(r,t,e){if(e.length<1)throw new Error("Function called with wrong number of Parameters");var n=e.map((function(r){return Math.trunc(a.toNumber(r))})).filter((function(r){return r>=0&&r<=65535}));return 0===n.length?null:String.fromCharCode.apply(null,n)}))},r.fromcodepoint=function(r,e){return t(r,e,(function(r,t,e){if(e.length<1)throw new Error("Function called with wrong number of Parameters");var n;try{n=e.map((function(r){return Math.trunc(a.toNumber(r))})).filter((function(r){return r<=1114111&&r>>>0===r}))}catch(r){return null}return 0===n.length?null:String.fromCodePoint.apply(null,n)}))}}}));