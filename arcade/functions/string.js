/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.22/esri/copyright.txt for details.
*/
define(["exports","../ArcadePortal","../Attachment","../Dictionary","../Feature","../../chunks/languageUtils","../featureset/support/shared","./convertdirection","./hash","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/SpatialReference"],(function(t,e,n,r,o,i,a,u,c,l,s,d,f,p,h){"use strict";function y(t,e){if(t.x===e.x&&t.y===e.y){if(t.hasZ){if(t.z!==e.z)return!1}else if(e.hasZ)return!1;if(t.hasM){if(t.m!==e.m)return!1}else if(e.hasM)return!1;return!0}return!1}function g(t,a,u){if(null!==t)if(i.isArray(t)){if(a.updateUint8Array([61]),u.map.has(t)){const e=u.map.get(t);a.updateIntArray([61237541^e])}else{u.map.set(t,u.currentLength++);for(const e of t)g(e,a,u);u.map.delete(t),u.currentLength--}a.updateUint8Array([199])}else if(i.isImmutableArray(t)){if(a.updateUint8Array([61]),u.map.has(t)){const e=u.map.get(t);a.updateIntArray([61237541^e])}else{u.map.set(t,u.currentLength++);for(const e of t.toArray())g(e,a,u);u.map.delete(t),u.currentLength--}a.updateUint8Array([199])}else{if(i.isDate(t))return a.updateIntArray([t.getTime()]),void a.updateUint8Array([241]);if(i.isString(t))return a.updateIntArray([t.length]),a.updateWithString(t),void a.updateUint8Array([41]);if(i.isBoolean(t))a.updateUint8Array([!0===t?1:0,113]);else{if(i.isNumber(t))return a.updateFloatArray([t]),void a.updateUint8Array([173]);if(t instanceof n)throw new Error("Type not supported in Hash");if(t instanceof e)throw new Error("Type not supported in Hash");if(!(t instanceof r)){if(t instanceof o)throw new Error("Type not supported in Hash");if(t instanceof d)return a.updateIntArray([3833836621]),a.updateIntArray([0]),a.updateFloatArray([t.x]),a.updateIntArray([1]),a.updateFloatArray([t.y]),t.hasZ&&(a.updateIntArray([2]),a.updateFloatArray([t.z])),t.hasM&&(a.updateIntArray([3]),a.updateFloatArray([t.m])),a.updateIntArray([3765347959]),void g(t.spatialReference.wkid,a,u);if(t instanceof f){a.updateIntArray([1266616829]);for(let e=0;e<t.rings.length;e++){const n=t.rings[e],r=[];let o=null,i=null;for(let a=0;a<n.length;a++){const u=t.getPoint(e,a);if(0===a)o=u;else if(y(i,u))continue;i=u,a===n.length-1&&y(o,u)||r.push(u)}a.updateIntArray([1397116793,r.length]);for(let t=0;t<r.length;t++){const e=r[t];a.updateIntArray([3962308117,t]),g(e,a,u),a.updateIntArray([2716288009])}a.updateIntArray([2278822459])}return a.updateIntArray([3878477243]),void g(t.spatialReference.wkid,a,u)}if(t instanceof p){a.updateIntArray([4106883559]);for(let e=0;e<t.paths.length;e++){const n=t.paths[e];a.updateIntArray([1397116793,n.length]);for(let r=0;r<n.length;r++)a.updateIntArray([3962308117,r]),g(t.getPoint(e,r),a,u),a.updateIntArray([2716288009]);a.updateIntArray([2278822459])}return a.updateIntArray([2568784753]),void g(t.spatialReference.wkid,a,u)}if(t instanceof s){a.updateIntArray([588535921,t.points.length]);for(let e=0;e<t.points.length;e++){const n=t.getPoint(e);a.updateIntArray([e]),g(n,a,u)}return a.updateIntArray([1700171621]),void g(t.spatialReference.wkid,a,u)}if(t instanceof l)return a.updateIntArray([3483648373]),a.updateIntArray([0]),a.updateFloatArray([t.xmax]),a.updateIntArray([1]),a.updateFloatArray([t.xmin]),a.updateIntArray([2]),a.updateFloatArray([t.ymax]),a.updateIntArray([3]),a.updateFloatArray([t.ymin]),t.hasZ&&(a.updateIntArray([4]),a.updateFloatArray([t.zmax]),a.updateIntArray([5]),a.updateFloatArray([t.zmin])),t.hasM&&(a.updateIntArray([6]),a.updateFloatArray([t.mmax]),a.updateIntArray([7]),a.updateFloatArray([t.mmin])),a.updateIntArray([3622027469]),void g(t.spatialReference.wkid,a,u);if(t instanceof h)return a.updateIntArray([14]),void 0!==t.wkid&&null!==t.wkid&&a.updateIntArray([t.wkid]),void(t.wkt&&a.updateWithString(t.wkt));if(i.isFunctionParameter(t))throw new Error("Type not supported in Hash");if(i.isFeatureSet(t))throw new Error("Type not supported in Hash");if(i.isFeatureSetCollection(t))throw new Error("Type not supported in Hash");if(t===i.voidOperation)throw new Error("Type not supported in Hash");throw new Error("Type not supported in Hash")}if(a.updateUint8Array([223]),u.map.has(t)){const e=u.map.get(t);a.updateIntArray([61237541^e])}else{u.map.set(t,u.currentLength++);for(const e of t.keys()){a.updateIntArray([e.length]),a.updateWithString(e),a.updateUint8Array([251]);g(t.field(e),a,u),a.updateUint8Array([239])}u.map.delete(t),u.currentLength--}a.updateUint8Array([73])}}else a.updateUint8Array([0,139])}function m(t,n){t.portal=function(t,r){return n(t,r,(function(t,n,r){return i.pcCheck(r,1,1),new e(i.toString(r[0]))}))},t.trim=function(t,e){return n(t,e,(function(t,e,n){return i.pcCheck(n,1,1),i.toString(n[0]).trim()}))},t.tohex=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,1,1);const r=i.toNumber(n[0]);return isNaN(r)?r:r.toString(16)}))},t.upper=function(t,e){return n(t,e,(function(t,e,n){return i.pcCheck(n,1,1),i.toString(n[0]).toUpperCase()}))},t.proper=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,1,2);let r=1;2===n.length&&"firstword"===i.toString(n[1]).toLowerCase()&&(r=2);const o=/\s/,a=i.toString(n[0]);let u="",c=!0;for(let i=0;i<a.length;i++){let t=a[i];if(o.test(t))1===r&&(c=!0);else{t.toUpperCase()!==t.toLowerCase()&&(c?(t=t.toUpperCase(),c=!1):t=t.toLowerCase())}u+=t}return u}))},t.lower=function(t,e){return n(t,e,(function(t,e,n){return i.pcCheck(n,1,1),i.toString(n[0]).toLowerCase()}))},t.guid=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,0,1),n.length>0)switch(i.toString(n[0]).toLowerCase()){case"digits":return i.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return i.generateUUID();case"digits-hyphen-braces":return"{"+i.generateUUID()+"}";case"digits-hyphen-parentheses":return"("+i.generateUUID()+")"}return"{"+i.generateUUID()+"}"}))},t.console=function(t,e){return n(t,e,(function(e,n,r){return 0===r.length||(1===r.length?t.console(i.toString(r[0])):t.console(i.toString(r))),i.voidOperation}))},t.mid=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,2,3);let r=i.toNumber(n[1]);if(isNaN(r))return"";if(r<0&&(r=0),2===n.length)return i.toString(n[0]).substr(r);let o=i.toNumber(n[2]);return isNaN(o)?"":(o<0&&(o=0),i.toString(n[0]).substr(r,o))}))},t.find=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,2,3);let r=0;if(n.length>2){if(r=i.toNumber(i.defaultUndefined(n[2],0)),isNaN(r))return-1;r<0&&(r=0)}return i.toString(n[1]).indexOf(i.toString(n[0]),r)}))},t.left=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,2,2);let r=i.toNumber(n[1]);return isNaN(r)?"":(r<0&&(r=0),i.toString(n[0]).substr(0,r))}))},t.right=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,2,2);let r=i.toNumber(n[1]);return isNaN(r)?"":(r<0&&(r=0),i.toString(n[0]).substr(-1*r,r))}))},t.split=function(t,e){return n(t,e,(function(t,e,n){let r;i.pcCheck(n,2,4);let o=i.toNumber(i.defaultUndefined(n[2],-1));const a=i.toBoolean(i.defaultUndefined(n[3],!1));if(-1===o||null===o||!0===a?r=i.toString(n[0]).split(i.toString(n[1])):(isNaN(o)&&(o=-1),o<-1&&(o=-1),r=i.toString(n[0]).split(i.toString(n[1]),o)),!1===a)return r;const u=[];for(let i=0;i<r.length&&!(-1!==o&&u.length>=o);i++)""!==r[i]&&void 0!==r[i]&&u.push(r[i]);return u}))},t.text=function(t,e){return n(t,e,(function(t,e,n){return i.pcCheck(n,1,2),i.toStringExplicit(n[0],n[1])}))},t.concatenate=function(t,e){return n(t,e,(function(t,e,n){const r=[];if(n.length<1)return"";if(i.isArray(n[0])){const t=i.defaultUndefined(n[2],"");for(let e=0;e<n[0].length;e++)r[e]=i.toStringExplicit(n[0][e],t);return n.length>1?r.join(n[1]):r.join("")}if(i.isImmutableArray(n[0])){const t=i.defaultUndefined(n[2],"");for(let e=0;e<n[0].length();e++)r[e]=i.toStringExplicit(n[0].get(e),t);return n.length>1?r.join(n[1]):r.join("")}for(let o=0;o<n.length;o++)r[o]=i.toStringExplicit(n[o]);return r.join("")}))},t.reverse=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,1,1),i.isArray(n[0])){const t=n[0].slice(0);return t.reverse(),t}if(i.isImmutableArray(n[0])){const t=n[0].toArray().slice(0);return t.reverse(),t}throw new Error("Invalid Parameter")}))},t.replace=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,3,4);const r=i.toString(n[0]),o=i.toString(n[1]),a=i.toString(n[2]);return 4!==n.length||i.toBoolean(n[3])?i.multiReplace(r,o,a):r.replace(o,a)}))},t.schema=function(t,e){return n(t,e,(function(t,e,n){if(n[0]instanceof o){const t=n[0].schema();return t?r.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypes=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,1,1),n[0]instanceof o){const t=n[0].subtypes();return t?r.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypecode=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,1,1),n[0]instanceof o){const t=n[0].subtypes();if(!t)return null;if(t.subtypeField&&n[0].hasField(t.subtypeField)){const e=n[0].field(t.subtypeField);for(const n of t.subtypes)if(n.code===e)return n.code;return null}return null}throw new Error("Invalid Parameter")}))},t.subtypename=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,1,1),n[0]instanceof o){const t=n[0].subtypes();if(!t)return"";if(t.subtypeField&&n[0].hasField(t.subtypeField)){const e=n[0].field(t.subtypeField);for(const n of t.subtypes)if(n.code===e)return n.name;return""}return""}throw new Error("Invalid Parameter")}))},t.gdbversion=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,1,1),n[0]instanceof o)return n[0].gdbVersion();throw new Error("Invalid Parameter")}))},t.domain=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,2,3),n[0]instanceof o){const t=n[0].fullDomain(i.toString(n[1]),void 0===n[2]?void 0:i.toNumber(n[2]));return t&&t.domain?"coded-value"===t.domain.type||"codedValue"===t.domain.type?r.convertObjectToArcadeDictionary({type:"codedValue",name:t.domain.name,dataType:a.layerFieldEsriConstants[t.field.type],codedValues:t.domain.codedValues.map((t=>({name:t.name,code:t.code})))}):r.convertObjectToArcadeDictionary({type:"range",name:t.domain.name,dataType:a.layerFieldEsriConstants[t.field.type],min:t.domain.min,max:t.domain.max}):null}throw new Error("Invalid Parameter")}))},t.domainname=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,2,4),n[0]instanceof o)return n[0].domainValueLookup(i.toString(n[1]),n[2],void 0===n[3]?void 0:i.toNumber(n[3]));throw new Error("Invalid Parameter")}))},t.domaincode=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,2,4),n[0]instanceof o)return n[0].domainCodeLookup(i.toString(n[1]),n[2],void 0===n[3]?void 0:i.toNumber(n[3]));throw new Error("Invalid Parameter")}))},t.urlencode=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,1,1),null===n[0])return"";if(n[0]instanceof r){let t="";for(const e of n[0].keys()){const r=n[0].field(e);""!==t&&(t+="&"),t+=null===r?encodeURIComponent(e)+"=":encodeURIComponent(e)+"="+encodeURIComponent(r)}return t}return encodeURIComponent(i.toString(n[0]))}))},t.hash=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,1,1);const r=new c.XXH(0);return g(n[0],r,{map:new Map,currentLength:0}),r.digest()}))},t.convertdirection=function(t,e){return n(t,e,(function(t,e,n){return i.pcCheck(n,3,3),u.convertDirection(n[0],n[1],n[2])}))},t.fromjson=function(t,e){return n(t,e,(function(t,e,n){if(i.pcCheck(n,1,1),!1===i.isString(n[0]))throw new Error("Invalid Parameter");return r.convertJsonToArcade(JSON.parse(i.toString(n[0])))}))},t.expects=function(t,e){return n(t,e,(function(t,e,n){if(n.length<1)throw new Error("Function called with wrong number of Parameters");return i.voidOperation}))},t.tocharcode=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,1,2);const r=i.toNumber(i.defaultUndefined(n[1],0)),o=i.toString(n[0]);if(0===o.length&&1===n.length)return null;if(o.length<=r||r<0)throw new Error("Illegal argument");return o.charCodeAt(r)}))},t.tocodepoint=function(t,e){return n(t,e,(function(t,e,n){i.pcCheck(n,1,2);const r=i.toNumber(i.defaultUndefined(n[1],0)),o=i.toString(n[0]);if(0===o.length&&1===n.length)return null;if(o.length<=r||r<0)throw new Error("Illegal argument");return o.codePointAt(r)}))},t.fromcharcode=function(t,e){return n(t,e,(function(t,e,n){if(n.length<1)throw new Error("Function called with wrong number of Parameters");const r=n.map((t=>Math.trunc(i.toNumber(t)))).filter((t=>t>=0&&t<=65535));return 0===r.length?null:String.fromCharCode.apply(null,r)}))},t.fromcodepoint=function(t,e){return n(t,e,(function(t,e,n){if(n.length<1)throw new Error("Function called with wrong number of Parameters");let r;try{r=n.map((t=>Math.trunc(i.toNumber(t)))).filter((t=>t<=1114111&&t>>>0===t))}catch(o){return null}return 0===r.length?null:String.fromCodePoint.apply(null,r)}))}}t.registerFunctions=m,Object.defineProperty(t,"__esModule",{value:!0})}));
