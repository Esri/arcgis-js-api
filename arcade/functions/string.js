/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../ArcadePortal","../Attachment","../Dictionary","../../chunks/languageUtils","../featureset/support/shared","./convertdirection","./hash","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/SpatialReference"],(function(t,e,r,n,o,i,a,u,c,l,d,s,f,p){"use strict";function h(t,e){if(t.x===e.x&&t.y===e.y){if(t.hasZ){if(t.z!==e.z)return!1}else if(e.hasZ)return!1;if(t.hasM){if(t.m!==e.m)return!1}else if(e.hasM)return!1;return!0}return!1}function y(t,i,a){if(null!==t)if(o.isArray(t)){if(i.updateUint8Array([61]),a.map.has(t)){const e=a.map.get(t);i.updateIntArray([61237541^e])}else{a.map.set(t,a.currentLength++);for(const e of t)y(e,i,a);a.map.delete(t),a.currentLength--}i.updateUint8Array([199])}else if(o.isImmutableArray(t)){if(i.updateUint8Array([61]),a.map.has(t)){const e=a.map.get(t);i.updateIntArray([61237541^e])}else{a.map.set(t,a.currentLength++);for(const e of t.toArray())y(e,i,a);a.map.delete(t),a.currentLength--}i.updateUint8Array([199])}else{if(o.isDate(t))return i.updateIntArray([t.getTime()]),void i.updateUint8Array([241]);if(o.isString(t))return i.updateIntArray([t.length]),i.updateWithString(t),void i.updateUint8Array([41]);if(o.isBoolean(t))i.updateUint8Array([!0===t?1:0,113]);else{if(o.isNumber(t))return i.updateFloatArray([t]),void i.updateUint8Array([173]);if(t instanceof r)throw new Error("Type not supported in Hash");if(t instanceof e)throw new Error("Type not supported in Hash");if(!(t instanceof n)){if(o.isFeature(t))throw new Error("Type not supported in Hash");if(t instanceof d)return i.updateIntArray([3833836621]),i.updateIntArray([0]),i.updateFloatArray([t.x]),i.updateIntArray([1]),i.updateFloatArray([t.y]),t.hasZ&&(i.updateIntArray([2]),i.updateFloatArray([t.z])),t.hasM&&(i.updateIntArray([3]),i.updateFloatArray([t.m])),i.updateIntArray([3765347959]),void y(t.spatialReference.wkid,i,a);if(t instanceof s){i.updateIntArray([1266616829]);for(let e=0;e<t.rings.length;e++){const r=t.rings[e],n=[];let o=null,u=null;for(let i=0;i<r.length;i++){const a=t.getPoint(e,i);if(0===i)o=a;else if(h(u,a))continue;u=a,i===r.length-1&&h(o,a)||n.push(a)}i.updateIntArray([1397116793,n.length]);for(let t=0;t<n.length;t++){const e=n[t];i.updateIntArray([3962308117,t]),y(e,i,a),i.updateIntArray([2716288009])}i.updateIntArray([2278822459])}return i.updateIntArray([3878477243]),void y(t.spatialReference.wkid,i,a)}if(t instanceof f){i.updateIntArray([4106883559]);for(let e=0;e<t.paths.length;e++){const r=t.paths[e];i.updateIntArray([1397116793,r.length]);for(let n=0;n<r.length;n++)i.updateIntArray([3962308117,n]),y(t.getPoint(e,n),i,a),i.updateIntArray([2716288009]);i.updateIntArray([2278822459])}return i.updateIntArray([2568784753]),void y(t.spatialReference.wkid,i,a)}if(t instanceof l){i.updateIntArray([588535921,t.points.length]);for(let e=0;e<t.points.length;e++){const r=t.getPoint(e);i.updateIntArray([e]),y(r,i,a)}return i.updateIntArray([1700171621]),void y(t.spatialReference.wkid,i,a)}if(t instanceof c)return i.updateIntArray([3483648373]),i.updateIntArray([0]),i.updateFloatArray([t.xmax]),i.updateIntArray([1]),i.updateFloatArray([t.xmin]),i.updateIntArray([2]),i.updateFloatArray([t.ymax]),i.updateIntArray([3]),i.updateFloatArray([t.ymin]),t.hasZ&&(i.updateIntArray([4]),i.updateFloatArray([t.zmax]),i.updateIntArray([5]),i.updateFloatArray([t.zmin])),t.hasM&&(i.updateIntArray([6]),i.updateFloatArray([t.mmax]),i.updateIntArray([7]),i.updateFloatArray([t.mmin])),i.updateIntArray([3622027469]),void y(t.spatialReference.wkid,i,a);if(t instanceof p)return i.updateIntArray([14]),void 0!==t.wkid&&null!==t.wkid&&i.updateIntArray([t.wkid]),void(t.wkt&&i.updateWithString(t.wkt));if(o.isFunctionParameter(t))throw new Error("Type not supported in Hash");if(o.isFeatureSet(t))throw new Error("Type not supported in Hash");if(o.isFeatureSetCollection(t))throw new Error("Type not supported in Hash");if(t===o.voidOperation)throw new Error("Type not supported in Hash");throw new Error("Type not supported in Hash")}if(i.updateUint8Array([223]),a.map.has(t)){const e=a.map.get(t);i.updateIntArray([61237541^e])}else{a.map.set(t,a.currentLength++);for(const e of t.keys()){i.updateIntArray([e.length]),i.updateWithString(e),i.updateUint8Array([251]);y(t.field(e),i,a),i.updateUint8Array([239])}a.map.delete(t),a.currentLength--}i.updateUint8Array([73])}}else i.updateUint8Array([0,139])}function g(t,r){t.portal=function(t,n){return r(t,n,(function(t,r,n){return o.pcCheck(n,1,1),new e(o.toString(n[0]))}))},t.trim=function(t,e){return r(t,e,(function(t,e,r){return o.pcCheck(r,1,1),o.toString(r[0]).trim()}))},t.tohex=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,1,1);const n=o.toNumber(r[0]);return isNaN(n)?n:n.toString(16)}))},t.upper=function(t,e){return r(t,e,(function(t,e,r){return o.pcCheck(r,1,1),o.toString(r[0]).toUpperCase()}))},t.proper=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,1,2);let n=1;2===r.length&&"firstword"===o.toString(r[1]).toLowerCase()&&(n=2);const i=/\s/,a=o.toString(r[0]);let u="",c=!0;for(let o=0;o<a.length;o++){let t=a[o];if(i.test(t))1===n&&(c=!0);else{t.toUpperCase()!==t.toLowerCase()&&(c?(t=t.toUpperCase(),c=!1):t=t.toLowerCase())}u+=t}return u}))},t.lower=function(t,e){return r(t,e,(function(t,e,r){return o.pcCheck(r,1,1),o.toString(r[0]).toLowerCase()}))},t.guid=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,0,1),r.length>0)switch(o.toString(r[0]).toLowerCase()){case"digits":return o.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return o.generateUUID();case"digits-hyphen-braces":return"{"+o.generateUUID()+"}";case"digits-hyphen-parentheses":return"("+o.generateUUID()+")"}return"{"+o.generateUUID()+"}"}))},t.console=function(t,e){return r(t,e,(function(e,r,n){return 0===n.length||(1===n.length?t.console(o.toString(n[0])):t.console(o.toString(n))),o.voidOperation}))},t.mid=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,2,3);let n=o.toNumber(r[1]);if(isNaN(n))return"";if(n<0&&(n=0),2===r.length)return o.toString(r[0]).substr(n);let i=o.toNumber(r[2]);return isNaN(i)?"":(i<0&&(i=0),o.toString(r[0]).substr(n,i))}))},t.find=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,2,3);let n=0;if(r.length>2){if(n=o.toNumber(o.defaultUndefined(r[2],0)),isNaN(n))return-1;n<0&&(n=0)}return o.toString(r[1]).indexOf(o.toString(r[0]),n)}))},t.left=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,2,2);let n=o.toNumber(r[1]);return isNaN(n)?"":(n<0&&(n=0),o.toString(r[0]).substr(0,n))}))},t.right=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,2,2);let n=o.toNumber(r[1]);return isNaN(n)?"":(n<0&&(n=0),o.toString(r[0]).substr(-1*n,n))}))},t.split=function(t,e){return r(t,e,(function(t,e,r){let n;o.pcCheck(r,2,4);let i=o.toNumber(o.defaultUndefined(r[2],-1));const a=o.toBoolean(o.defaultUndefined(r[3],!1));if(-1===i||null===i||!0===a?n=o.toString(r[0]).split(o.toString(r[1])):(isNaN(i)&&(i=-1),i<-1&&(i=-1),n=o.toString(r[0]).split(o.toString(r[1]),i)),!1===a)return n;const u=[];for(let o=0;o<n.length&&!(-1!==i&&u.length>=i);o++)""!==n[o]&&void 0!==n[o]&&u.push(n[o]);return u}))},t.text=function(t,e){return r(t,e,(function(t,e,r){return o.pcCheck(r,1,2),o.toStringExplicit(r[0],r[1])}))},t.concatenate=function(t,e){return r(t,e,(function(t,e,r){const n=[];if(r.length<1)return"";if(o.isArray(r[0])){const t=o.defaultUndefined(r[2],"");for(let e=0;e<r[0].length;e++)n[e]=o.toStringExplicit(r[0][e],t);return r.length>1?n.join(r[1]):n.join("")}if(o.isImmutableArray(r[0])){const t=o.defaultUndefined(r[2],"");for(let e=0;e<r[0].length();e++)n[e]=o.toStringExplicit(r[0].get(e),t);return r.length>1?n.join(r[1]):n.join("")}for(let i=0;i<r.length;i++)n[i]=o.toStringExplicit(r[i]);return n.join("")}))},t.reverse=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,1,1),o.isArray(r[0])){const t=r[0].slice(0);return t.reverse(),t}if(o.isImmutableArray(r[0])){const t=r[0].toArray().slice(0);return t.reverse(),t}throw new Error("Invalid Parameter")}))},t.replace=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,3,4);const n=o.toString(r[0]),i=o.toString(r[1]),a=o.toString(r[2]);return 4!==r.length||o.toBoolean(r[3])?o.multiReplace(n,i,a):n.replace(i,a)}))},t.schema=function(t,e){return r(t,e,(function(t,e,r){if(o.isFeature(r[0])){const t=o.featureSchema(r[0]);return t?n.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypes=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,1,1),o.isFeature(r[0])){const t=o.featureSubtypes(r[0]);return t?n.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},t.subtypecode=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,1,1),o.isFeature(r[0])){const t=o.featureSubtypes(r[0]);if(!t)return null;if(t.subtypeField&&r[0].hasField(t.subtypeField)){const e=r[0].field(t.subtypeField);for(const r of t.subtypes)if(r.code===e)return r.code;return null}return null}throw new Error("Invalid Parameter")}))},t.subtypename=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,1,1),o.isFeature(r[0])){const t=o.featureSubtypes(r[0]);if(!t)return"";if(t.subtypeField&&r[0].hasField(t.subtypeField)){const e=r[0].field(t.subtypeField);for(const r of t.subtypes)if(r.code===e)return r.name;return""}return""}throw new Error("Invalid Parameter")}))},t.gdbversion=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,1,1),o.isFeature(r[0]))return r[0].gdbVersion();throw new Error("Invalid Parameter")}))},t.domain=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,2,3),o.isFeature(r[0])){const t=o.featureFullDomain(r[0],o.toString(r[1]),void 0===r[2]?void 0:o.toNumber(r[2]));return t&&t.domain?"coded-value"===t.domain.type||"codedValue"===t.domain.type?n.convertObjectToArcadeDictionary({type:"codedValue",name:t.domain.name,dataType:i.layerFieldEsriConstants[t.field.type],codedValues:t.domain.codedValues.map((t=>({name:t.name,code:t.code})))}):n.convertObjectToArcadeDictionary({type:"range",name:t.domain.name,dataType:i.layerFieldEsriConstants[t.field.type],min:t.domain.min,max:t.domain.max}):null}throw new Error("Invalid Parameter")}))},t.domainname=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,2,4),o.isFeature(r[0]))return o.featureDomainValueLookup(r[0],o.toString(r[1]),r[2],void 0===r[3]?void 0:o.toNumber(r[3]));throw new Error("Invalid Parameter")}))},t.domaincode=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,2,4),o.isFeature(r[0]))return o.featureDomainCodeLookup(r[0],o.toString(r[1]),r[2],void 0===r[3]?void 0:o.toNumber(r[3]));throw new Error("Invalid Parameter")}))},t.urlencode=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,1,1),null===r[0])return"";if(r[0]instanceof n){let t="";for(const e of r[0].keys()){const n=r[0].field(e);""!==t&&(t+="&"),t+=null===n?encodeURIComponent(e)+"=":encodeURIComponent(e)+"="+encodeURIComponent(n)}return t}return encodeURIComponent(o.toString(r[0]))}))},t.hash=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,1,1);const n=new u.XXH(0);return y(r[0],n,{map:new Map,currentLength:0}),n.digest()}))},t.convertdirection=function(t,e){return r(t,e,(function(t,e,r){return o.pcCheck(r,3,3),a.convertDirection(r[0],r[1],r[2])}))},t.fromjson=function(t,e){return r(t,e,(function(t,e,r){if(o.pcCheck(r,1,1),!1===o.isString(r[0]))throw new Error("Invalid Parameter");return n.convertJsonToArcade(JSON.parse(o.toString(r[0])))}))},t.expects=function(t,e){return r(t,e,(function(t,e,r){if(r.length<1)throw new Error("Function called with wrong number of Parameters");return o.voidOperation}))},t.tocharcode=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,1,2);const n=o.toNumber(o.defaultUndefined(r[1],0)),i=o.toString(r[0]);if(0===i.length&&1===r.length)return null;if(i.length<=n||n<0)throw new Error("Illegal argument");return i.charCodeAt(n)}))},t.tocodepoint=function(t,e){return r(t,e,(function(t,e,r){o.pcCheck(r,1,2);const n=o.toNumber(o.defaultUndefined(r[1],0)),i=o.toString(r[0]);if(0===i.length&&1===r.length)return null;if(i.length<=n||n<0)throw new Error("Illegal argument");return i.codePointAt(n)}))},t.fromcharcode=function(t,e){return r(t,e,(function(t,e,r){if(r.length<1)throw new Error("Function called with wrong number of Parameters");const n=r.map((t=>Math.trunc(o.toNumber(t)))).filter((t=>t>=0&&t<=65535));return 0===n.length?null:String.fromCharCode.apply(null,n)}))},t.fromcodepoint=function(t,e){return r(t,e,(function(t,e,r){if(r.length<1)throw new Error("Function called with wrong number of Parameters");let n;try{n=r.map((t=>Math.trunc(o.toNumber(t)))).filter((t=>t<=1114111&&t>>>0===t))}catch(i){return null}return 0===n.length?null:String.fromCodePoint.apply(null,n)}))}}t.registerFunctions=g,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
