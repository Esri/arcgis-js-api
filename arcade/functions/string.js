// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.41/esri/copyright.txt for details.

define(["require","exports","../polyfill/tsSupport/assign","../polyfill/tsSupport/spreadarray","../ArcadePortal","../Attachment","../Dictionary","../languageUtils","../featureset/support/shared","./convertdirection","./hash","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../SpatialReference"],(function(r,e,t,n,i,o,a,u,c,f,p,l,d,s,h,g,y){"use strict";function m(r,e){return r.x===e.x&&r.y===e.y}Object.defineProperty(e,"__esModule",{value:!0}),e.registerFunctions=void 0,e.registerFunctions=function(r,e){r.portal=function(r,t){return e(r,t,(function(r,e,t){return u.pcCheck(t,1,1),new i(u.toString(t[0]))}))},r.trim=function(r,t){return e(r,t,(function(r,e,t){return u.pcCheck(t,1,1),u.toString(t[0]).trim()}))},r.tohex=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,1,1);var n=u.toNumber(t[0]);return isNaN(n)?n:n.toString(16)}))},r.upper=function(r,t){return e(r,t,(function(r,e,t){return u.pcCheck(t,1,1),u.toString(t[0]).toUpperCase()}))},r.proper=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,1,2);var n=1;2===t.length&&"firstword"===u.toString(t[1]).toLowerCase()&&(n=2);for(var i=/\s/,o=u.toString(t[0]),a="",c=!0,f=0;f<o.length;f++){var p=o[f];if(i.test(p))1===n&&(c=!0);else p.toUpperCase()!==p.toLowerCase()&&(c?(p=p.toUpperCase(),c=!1):p=p.toLowerCase());a+=p}return a}))},r.lower=function(r,t){return e(r,t,(function(r,e,t){return u.pcCheck(t,1,1),u.toString(t[0]).toLowerCase()}))},r.guid=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,0,1),t.length>0)switch(u.toString(t[0]).toLowerCase()){case"digits":return u.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return u.generateUUID();case"digits-hyphen-braces":return"{"+u.generateUUID()+"}";case"digits-hyphen-parentheses":return"("+u.generateUUID()+")"}return"{"+u.generateUUID()+"}"}))},r.console=function(r,t){return e(r,t,(function(e,t,n){return 0===n.length||(1===n.length?r.console(u.toString(n[0])):r.console(u.toString(n))),u.voidOperation}))},r.mid=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,2,3);var n=u.toNumber(t[1]);if(isNaN(n))return"";if(n<0&&(n=0),2===t.length)return u.toString(t[0]).substr(n);var i=u.toNumber(t[2]);return isNaN(i)?"":(i<0&&(i=0),u.toString(t[0]).substr(n,i))}))},r.find=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,2,3);var n=0;if(t.length>2){if(n=u.toNumber(u.defaultUndefined(t[2],0)),isNaN(n))return-1;n<0&&(n=0)}return u.toString(t[1]).indexOf(u.toString(t[0]),n)}))},r.left=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,2,2);var n=u.toNumber(t[1]);return isNaN(n)?"":(n<0&&(n=0),u.toString(t[0]).substr(0,n))}))},r.right=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,2,2);var n=u.toNumber(t[1]);return isNaN(n)?"":(n<0&&(n=0),u.toString(t[0]).substr(-1*n,n))}))},r.split=function(r,t){return e(r,t,(function(r,e,t){var n;u.pcCheck(t,2,4);var i=u.toNumber(u.defaultUndefined(t[2],-1)),o=u.toBoolean(u.defaultUndefined(t[3],!1));if(-1===i||null===i||!0===o?n=u.toString(t[0]).split(u.toString(t[1])):(isNaN(i)&&(i=-1),i<-1&&(i=-1),n=u.toString(t[0]).split(u.toString(t[1]),i)),!1===o)return n;for(var a=[],c=0;c<n.length&&!(-1!==i&&a.length>=i);c++)""!==n[c]&&void 0!==n[c]&&a.push(n[c]);return a}))},r.text=function(r,t){return e(r,t,(function(r,e,t){return u.pcCheck(t,1,2),u.toStringExplicit(t[0],t[1])}))},r.concatenate=function(r,t){return e(r,t,(function(r,e,t){var n=[];if(t.length<1)return"";if(u.isArray(t[0])){for(var i=u.defaultUndefined(t[2],""),o=0;o<t[0].length;o++)n[o]=u.toStringExplicit(t[0][o],i);return t.length>1?n.join(t[1]):n.join("")}if(u.isImmutableArray(t[0])){for(i=u.defaultUndefined(t[2],""),o=0;o<t[0].length();o++)n[o]=u.toStringExplicit(t[0].get(o),i);return t.length>1?n.join(t[1]):n.join("")}for(o=0;o<t.length;o++)n[o]=u.toStringExplicit(t[o]);return n.join("")}))},r.reverse=function(r,t){return e(r,t,(function(r,e,t){var n;if(u.pcCheck(t,1,1),u.isArray(t[0]))return(n=t[0].slice(0)).reverse(),n;if(u.isImmutableArray(t[0]))return(n=t[0].toArray().slice(0)).reverse(),n;throw new Error("Invalid Parameter")}))},r.replace=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,3,4);var n=u.toString(t[0]),i=u.toString(t[1]),o=u.toString(t[2]);return 4!==t.length||u.toBoolean(t[3])?u.multiReplace(n,i,o):n.replace(i,o)}))},r.schema=function(r,t){return e(r,t,(function(r,e,t){if(u.isFeature(t[0])){var n=u.featureSchema(t[0]);return n?a.convertObjectToArcadeDictionary(n):null}throw new Error("Invalid Parameter")}))},r.subtypes=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,1,1),u.isFeature(t[0])){var n=u.featureSubtypes(t[0]);return n?a.convertObjectToArcadeDictionary(n):null}throw new Error("Invalid Parameter")}))},r.subtypecode=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,1,1),u.isFeature(t[0])){var n=u.featureSubtypes(t[0]);if(!n)return null;if(n.subtypeField&&t[0].hasField(n.subtypeField)){for(var i=t[0].field(n.subtypeField),o=0,a=n.subtypes;o<a.length;o++){var c=a[o];if(c.code===i)return c.code}return null}return null}throw new Error("Invalid Parameter")}))},r.subtypename=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,1,1),u.isFeature(t[0])){var n=u.featureSubtypes(t[0]);if(!n)return"";if(n.subtypeField&&t[0].hasField(n.subtypeField)){for(var i=t[0].field(n.subtypeField),o=0,a=n.subtypes;o<a.length;o++){var c=a[o];if(c.code===i)return c.name}return""}return""}throw new Error("Invalid Parameter")}))},r.gdbversion=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,1,1),u.isFeature(t[0]))return t[0].gdbVersion();throw new Error("Invalid Parameter")}))},r.domain=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,2,3),u.isFeature(t[0])){var n=u.featureFullDomain(t[0],u.toString(t[1]),void 0===t[2]?void 0:u.toNumber(t[2]));return n&&n.domain?"coded-value"===n.domain.type||"codedValue"===n.domain.type?a.convertObjectToArcadeDictionary({type:"codedValue",name:n.domain.name,dataType:c.layerFieldEsriConstants[n.field.type],codedValues:n.domain.codedValues.map((function(r){return{name:r.name,code:r.code}}))}):a.convertObjectToArcadeDictionary({type:"range",name:n.domain.name,dataType:c.layerFieldEsriConstants[n.field.type],min:n.domain.min,max:n.domain.max}):null}throw new Error("Invalid Parameter")}))},r.domainname=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,2,4),u.isFeature(t[0]))return u.featureDomainValueLookup(t[0],u.toString(t[1]),t[2],void 0===t[3]?void 0:u.toNumber(t[3]));throw new Error("Invalid Parameter")}))},r.domaincode=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,2,4),u.isFeature(t[0]))return u.featureDomainCodeLookup(t[0],u.toString(t[1]),t[2],void 0===t[3]?void 0:u.toNumber(t[3]));throw new Error("Invalid Parameter")}))},r.urlencode=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,1,1),null===t[0])return"";if(t[0]instanceof a){for(var n="",i=0,o=t[0].keys();i<o.length;i++){var c=o[i],f=t[0].field(c);""!==n&&(n+="&"),n+=null===f?encodeURIComponent(c)+"=":encodeURIComponent(c)+"="+encodeURIComponent(f)}return n}return encodeURIComponent(u.toString(t[0]))}))},r.hash=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,1,1);var n=new p.XXH(0);return function r(e,t,n){if(null!==e)if(u.isArray(e)){if(t.updateUint8Array([61]),n.map.has(e)){var c=n.map.get(e);t.updateIntArray([61237541^c])}else{n.map.set(e,n.currentLength++);for(var f=0,p=e;f<p.length;f++){r(p[f],t,n)}n.map.delete(e),n.currentLength--}t.updateUint8Array([199])}else if(u.isImmutableArray(e)){if(t.updateUint8Array([61]),n.map.has(e)){c=n.map.get(e);t.updateIntArray([61237541^c])}else{n.map.set(e,n.currentLength++);for(var v=0,w=e.toArray();v<w.length;v++){r(w[v],t,n)}n.map.delete(e),n.currentLength--}t.updateUint8Array([199])}else{if(u.isDate(e))return t.updateIntArray([e.getTime()]),void t.updateUint8Array([241]);if(u.isString(e))return t.updateIntArray([e.length]),t.updateWithString(e),void t.updateUint8Array([41]);if(u.isBoolean(e))t.updateUint8Array([!0===e?1:0,113]);else{if(u.isNumber(e))return t.updateFloatArray([e]),void t.updateUint8Array([173]);if(e instanceof o)throw new Error("Type not supported in Hash");if(e instanceof i)throw new Error("Type not supported in Hash");if(!(e instanceof a)){if(u.isFeature(e))throw new Error("Type not supported in Hash");if(e instanceof s)return t.updateIntArray([3833836621]),t.updateIntArray([0]),t.updateFloatArray([e.x]),t.updateIntArray([1]),t.updateFloatArray([e.y]),t.updateIntArray([3765347959]),void r(e.spatialReference.wkid,t,n);if(e instanceof h){t.updateIntArray([1266616829]);for(var A=0;A<e.rings.length;A++){for(var I=e.rings[A],S=[],C=null,b=null,k=0;k<I.length;k++){var U=e.getPoint(A,k);if(0===k)C=U;else if(m(b,U))continue;b=U,k===I.length-1&&m(C,U)||S.push(U)}t.updateIntArray([1397116793,S.length]);for(k=0;k<S.length;k++){U=S[k];t.updateIntArray([3962308117,k]),r(U,t,n),t.updateIntArray([2716288009])}t.updateIntArray([2278822459])}return t.updateIntArray([3878477243]),void r(e.spatialReference.wkid,t,n)}if(e instanceof g){t.updateIntArray([4106883559]);for(A=0;A<e.paths.length;A++){I=e.paths[A];t.updateIntArray([1397116793,I.length]);for(k=0;k<I.length;k++)t.updateIntArray([3962308117,k]),r(e.getPoint(A,k),t,n),t.updateIntArray([2716288009]);t.updateIntArray([2278822459])}return t.updateIntArray([2568784753]),void r(e.spatialReference.wkid,t,n)}if(e instanceof d){t.updateIntArray([588535921,e.points.length]);for(k=0;k<e.points.length;k++){var F=e.getPoint(k);t.updateIntArray([k]),r(F,t,n)}return t.updateIntArray([1700171621]),void r(e.spatialReference.wkid,t,n)}if(e instanceof l)return t.updateIntArray([3483648373]),t.updateIntArray([0]),t.updateFloatArray([e.xmax]),t.updateIntArray([1]),t.updateFloatArray([e.xmin]),t.updateIntArray([2]),t.updateFloatArray([e.ymax]),t.updateIntArray([3]),t.updateFloatArray([e.ymin]),t.updateIntArray([3622027469]),void r(e.spatialReference.wkid,t,n);if(e instanceof y)return t.updateIntArray([14]),void 0!==e.wkid&&null!==e.wkid&&t.updateIntArray([e.wkid]),void(e.wkt&&t.updateWithString(e.wkt));if(u.isFunctionParameter(e))throw new Error("Type not supported in Hash");if(u.isFeatureSet(e))throw new Error("Type not supported in Hash");if(u.isFeatureSetCollection(e))throw new Error("Type not supported in Hash");if(e===u.voidOperation)throw new Error("Type not supported in Hash");throw new Error("Type not supported in Hash")}if(t.updateUint8Array([223]),n.map.has(e)){c=n.map.get(e);t.updateIntArray([61237541^c])}else{n.map.set(e,n.currentLength++);for(var E=0,N=e.keys();E<N.length;E++){var P=N[E];t.updateIntArray([P.length]),t.updateWithString(P),t.updateUint8Array([251]),r(e.field(P),t,n),t.updateUint8Array([239])}n.map.delete(e),n.currentLength--}t.updateUint8Array([73])}}else t.updateUint8Array([0,139])}(t[0],n,{map:new Map,currentLength:0}),n.digest()}))},r.convertdirection=function(r,t){return e(r,t,(function(r,e,t){return u.pcCheck(t,3,3),f.convertDirection(t[0],t[1],t[2])}))},r.fromjson=function(r,t){return e(r,t,(function(r,e,t){if(u.pcCheck(t,1,1),!1===u.isString(t[0]))throw new Error("Invalid Parameter");return a.convertJsonToArcade(JSON.parse(u.toString(t[0])))}))},r.expects=function(r,t){return e(r,t,(function(r,e,t){if(t.length<1)throw new Error("Function called with wrong number of Parameters");return u.voidOperation}))},r.tocharcode=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,1,2);var n=u.toNumber(u.defaultUndefined(t[1],0)),i=u.toString(t[0]);if(0===i.length&&1===t.length)return null;if(i.length<=n||n<0)throw new Error("Illegal argument");return i.charCodeAt(n)}))},r.tocodepoint=function(r,t){return e(r,t,(function(r,e,t){u.pcCheck(t,1,2);var n=u.toNumber(u.defaultUndefined(t[1],0)),i=u.toString(t[0]);if(0===i.length&&1===t.length)return null;if(i.length<=n||n<0)throw new Error("Illegal argument");return i.codePointAt(n)}))},r.fromcharcode=function(r,t){return e(r,t,(function(r,e,t){if(t.length<1)throw new Error("Function called with wrong number of Parameters");var n=t.map((function(r){return Math.trunc(u.toNumber(r))})).filter((function(r){return r>=0&&r<=65535}));return 0===n.length?null:String.fromCharCode.apply(null,n)}))},r.fromcodepoint=function(r,t){return e(r,t,(function(r,e,t){if(t.length<1)throw new Error("Function called with wrong number of Parameters");var n;try{n=t.map((function(r){return Math.trunc(u.toNumber(r))})).filter((function(r){return r<=1114111&&r>>>0===r}))}catch(r){return null}return 0===n.length?null:String.fromCodePoint.apply(null,n)}))}}}));