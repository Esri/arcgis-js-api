/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../core/promiseUtils","../../chunks/languageUtils","./fieldStats","../../core/sql/WhereClause"],(function(n,t,e,r,u){"use strict";function a(n,a,c,s,o,l){if(1===s.length){if(e.isArray(s[0]))return t.resolve(r.calculateStat(n,s[0],e.defaultUndefined(s[1],-1)));if(e.isImmutableArray(s[0]))return t.resolve(r.calculateStat(n,s[0].toArray(),e.defaultUndefined(s[1],-1)))}else if(2===s.length){if(e.isArray(s[0]))return t.resolve(r.calculateStat(n,s[0],e.defaultUndefined(s[1],-1)));if(e.isImmutableArray(s[0]))return t.resolve(r.calculateStat(n,s[0].toArray(),e.defaultUndefined(s[1],-1)));if(e.isFeatureSet(s[0]))return s[0].load().then((t=>i(u.WhereClause.create(s[1],t.getFieldsIndex()),l,o).then((t=>s[0].calculateStatistic(n,t,e.defaultUndefined(s[2],1e3),a.abortSignal)))))}else if(3===s.length&&e.isFeatureSet(s[0]))return s[0].load().then((t=>i(u.WhereClause.create(s[1],t.getFieldsIndex()),l,o).then((t=>s[0].calculateStatistic(n,t,e.defaultUndefined(s[2],1e3),a.abortSignal)))));return t.resolve(r.calculateStat(n,s,-1))}function i(n,e,r){try{const u=n.getVariables();if(u.length>0){const a=[];for(let n=0;n<u.length;n++){const t={name:u[n]};a.push(e.evaluateIdentifier(r,t))}return t.all(a).then((t=>{const e={};for(let n=0;n<u.length;n++)e[u[n]]=t[n];return n.parameters=e,n}))}return t.resolve(n)}catch(n){return t.reject(n)}}n.registerFunctions=function(n){"async"===n.mode&&(n.functions.stdev=function(t,e){return n.standardFunctionAsync(t,e,(function(e,r,u){return a("stdev",e,0,u,t,n)}))},n.functions.variance=function(t,e){return n.standardFunctionAsync(t,e,(function(e,r,u){return a("variance",e,0,u,t,n)}))},n.functions.average=function(t,e){return n.standardFunctionAsync(t,e,(function(e,r,u){return a("mean",e,0,u,t,n)}))},n.functions.mean=function(t,e){return n.standardFunctionAsync(t,e,(function(e,r,u){return a("mean",e,0,u,t,n)}))},n.functions.sum=function(t,e){return n.standardFunctionAsync(t,e,(function(e,r,u){return a("sum",e,0,u,t,n)}))},n.functions.min=function(t,e){return n.standardFunctionAsync(t,e,(function(e,r,u){return a("min",e,0,u,t,n)}))},n.functions.max=function(t,e){return n.standardFunctionAsync(t,e,(function(e,r,u){return a("max",e,0,u,t,n)}))},n.functions.count=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(e.pcCheck(r,1,1),e.isFeatureSet(r[0]))return r[0].count(n.abortSignal);if(e.isArray(r[0])||e.isString(r[0]))return r[0].length;if(e.isImmutableArray(r[0]))return r[0].length();throw new Error("Invalid Parameters for Count")}))})},Object.defineProperty(n,"__esModule",{value:!0})}));
