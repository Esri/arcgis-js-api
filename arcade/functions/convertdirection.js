/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../Dictionary","../executionError","../../chunks/languageUtils","../../core/maybe"],(function(e,r,n,t,o){"use strict";const s=e=>(r,n,t)=>(t=t||14,+e(r,n).toFixed(t)),i=(e,r)=>e+r,c=(e,r)=>e-r,a=(e,r)=>e*r,u=(e,r)=>e/r,d=(e,r,n)=>s(i)(e,r,n),l=(e,r,n)=>s(c)(e,r,n),h=(e,r,n)=>s(a)(e,r,n),g=(e,r,n)=>s(u)(e,r,n),m=360,E=400,f=2*Math.PI,_=3600,A=3240,w=60,x=60,p=180*_/Math.PI,D=m*w*x,S=90*_,T=180*_,R=270*_,M=String.fromCharCode(7501),v="Â°";function C(e){if(!1===t.isString(e))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.InvalidParameter,null);return e}function F(e,r){const n=10**r;return Math.round(e*n)/n}function L(e,r){return e%r}function U(e){const r=parseFloat(e.toString().replace(Math.trunc(e).toString(),"0"))*Math.sign(e);if(e<0){return{fraction:r,integer:Math.ceil(e)}}return{fraction:r,integer:Math.floor(e)}}var N,b,y,I;function O(e,r){switch(e){case N.north:return"SHORT"===r?"N":"North";case N.east:return"SHORT"===r?"E":"East";case N.south:return"SHORT"===r?"S":"South";case N.west:return"SHORT"===r?"W":"West"}}function z(e,r,n){for(;e.length<n;)e=r+e;return e}function G(e,r){return e-Math.floor(e/r)*r}function H(e){switch(e){case b.truncated_degrees:case b.decimal_degrees:return m;case b.radians:return f;case b.gradians:return E;case b.seconds:return D;case b.fractional_degree_minutes:return w;case b.fractional_minute_seconds:return x;default:throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"unsupported evaluations"})}}function q(e){switch(e.toUpperCase().trim()){case"NORTH":case"NORTHAZIMUTH":case"NORTH AZIMUTH":return y.north_azimuth;case"POLAR":return y.polar;case"QUADRANT":return y.quadrant;case"SOUTH":case"SOUTHAZIMUTH":case"SOUTH AZIMUTH":return y.south_azimuth}throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"unsupported directionType"})}function k(e){switch(e.toUpperCase().trim()){case"D":case"DD":case"DECIMALDEGREE":case"DECIMAL DEGREE":case"DEGREE":case"DECIMALDEGREES":case"DECIMAL DEGREES":case"DEGREES":return b.decimal_degrees;case"DMS":case"DEGREESMINUTESSECONDS":case"DEGREES MINUTES SECONDS":return b.degrees_minutes_seconds;case"R":case"RAD":case"RADS":case"RADIAN":case"RADIANS":return b.radians;case"G":case"GON":case"GONS":case"GRAD":case"GRADS":case"GRADIAN":case"GRADIANS":return b.gradians}throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"unsupported units"})}!function(e){e[e.north=0]="north",e[e.east=1]="east",e[e.south=2]="south",e[e.west=3]="west"}(N||(N={})),function(e){e[e.decimal_degrees=1]="decimal_degrees",e[e.seconds=2]="seconds",e[e.degrees_minutes_seconds=3]="degrees_minutes_seconds",e[e.radians=4]="radians",e[e.gradians=5]="gradians",e[e.truncated_degrees=6]="truncated_degrees",e[e.fractional_degree_minutes=7]="fractional_degree_minutes",e[e.fractional_minute_seconds=8]="fractional_minute_seconds"}(b||(b={})),function(e){e[e.north_azimuth=1]="north_azimuth",e[e.polar=2]="polar",e[e.quadrant=3]="quadrant",e[e.south_azimuth=4]="south_azimuth"}(y||(y={})),function(e){e[e.meridian=0]="meridian",e[e.direction=1]="direction"}(I||(I={}));let P=function(){function e(e,r,n){this.m_degrees=e,this.m_minutes=r,this.m_seconds=n}var r=e.prototype;return r.getField=function(e){switch(e){case b.decimal_degrees:case b.truncated_degrees:return this.m_degrees;case b.fractional_degree_minutes:return this.m_minutes;case b.seconds:case b.fractional_minute_seconds:return this.m_seconds;default:throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}},e.secondsToDMS=function(r){const n=U(r).fraction;let t=U(r).integer;const o=Math.floor(t/_);t-=o*_;const s=Math.floor(t/x);return t-=s*x,new e(o,s,t+n)},e.numberToDms=function(r){const n=U(r).fraction,t=U(r).integer,o=h(U(100*n).fraction,100);return new e(t,U(100*n).integer,o)},r.format=function(r,n){let t=F(this.m_seconds,n),o=this.m_minutes,s=this.m_degrees;if(r===b.seconds||r===b.fractional_minute_seconds)x<=t&&(t-=x,++o),w<=o&&(o=0,++s),m<=s&&(s=0);else if(r===b.fractional_degree_minutes)t=0,o=30<=this.m_seconds?this.m_minutes+1:this.m_minutes,s=this.m_degrees,w<=o&&(o=0,++s),m<=s&&(s=0);else if(r===b.decimal_degrees||r===b.truncated_degrees){const e=g(this.m_seconds,_),r=g(this.m_minutes,w);s=Math.round(this.m_degrees+r+e),o=0,t=0}return new e(s,o,t)},e.dmsToSeconds=function(e,r,n){return e*_+r*x+n},e}(),Q=function(){function e(e,r,n){this.meridian=e,this.angle=r,this.direction=n}return e.prototype.fetchAzimuth=function(e){return e===I.meridian?this.meridian:this.direction},e}(),W=function(){function e(e){this._angle=e}e.createFromAngleAndDirection=function(r,n){return new e(new B(e._convertDirectionFormat(r.extractAngularUnits(b.seconds),n,y.north_azimuth)))};var r=e.prototype;return r.getAngle=function(r){const n=this._angle.extractAngularUnits(b.seconds);switch(r){case y.north_azimuth:case y.south_azimuth:case y.polar:return new B(e._convertDirectionFormat(n,y.north_azimuth,r));case y.quadrant:{const r=e.secondsNorthAzimuthToQuadrant(n);return new B(r.angle)}}},r.getMeridian=function(r){const n=this._angle.extractAngularUnits(b.seconds);switch(r){case y.north_azimuth:return N.north;case y.south_azimuth:return N.south;case y.polar:return N.east;case y.quadrant:return e.secondsNorthAzimuthToQuadrant(n).meridian}},r.getDirection=function(r){const n=this._angle.extractAngularUnits(b.seconds);switch(r){case y.north_azimuth:return N.east;case y.south_azimuth:return N.west;case y.polar:return N.north;case y.quadrant:return e.secondsNorthAzimuthToQuadrant(n).direction}},e.secondsNorthAzimuthToQuadrant=function(e){const r=e<=S||e>=R?N.north:N.south,n=r===N.north?Math.min(D-e,e):Math.abs(e-T),t=e>T?N.west:N.east;return new Q(r,n,t)},e.createFromAngleMeridianAndDirection=function(r,n,t){return new e(new B(e.secondsQuadrantToNorthAzimuth(r.extractAngularUnits(b.seconds),n,t)))},e.secondsQuadrantToNorthAzimuth=function(e,r,n){return r===N.north?n===N.east?e:D-e:n===N.east?T-e:T+e},e._convertDirectionFormat=function(e,r,t){let o=0;switch(r){case y.north_azimuth:o=e;break;case y.polar:o=S-e;break;case y.quadrant:throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"});case y.south_azimuth:o=e+T}let s=0;switch(t){case y.north_azimuth:s=o;break;case y.polar:s=S-o;break;case y.quadrant:throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"});case y.south_azimuth:s=o-T}return s=L(s,D),s<0?D+s:s},e}();function Z(e,r,t){let o=null;switch(r){case b.decimal_degrees:o=h(e,_);break;case b.seconds:o=e;break;case b.gradians:o=h(e,A);break;case b.radians:o=h(e,p);break;default:throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}switch(t){case b.decimal_degrees:return g(o,_);case b.seconds:return o;case b.gradians:return g(o,A);case b.radians:return o/p;default:throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}}let B=function(){function e(e){this._seconds=e}return e.createFromAngleAndUnits=function(r,n){return new e(Z(r,n,b.seconds))},e.prototype.extractAngularUnits=function(e){return Z(this._seconds,b.seconds,V(e))},e.createFromDegreesMinutesSeconds=function(r,n,t){return new e(d(d(h(r,_),h(n,x)),t))},e}();function V(e){switch(o.assertIsSome(e),e){case b.decimal_degrees:case b.truncated_degrees:case b.degrees_minutes_seconds:return b.decimal_degrees;case b.gradians:return b.gradians;case b.fractional_degree_minutes:return b.fractional_degree_minutes;case b.radians:return b.radians;case b.seconds:case b.fractional_minute_seconds:return b.seconds}}let X=function(){function e(e,r,n,t){this.view=e,this.angle=r,this.merdian=n,this.direction=t,this._dms=null,this._formattedDms=null}e.createFromStringAndBearing=function(r,n,t){return new e(r,n.getAngle(t),n.getMeridian(t),n.getDirection(t))};var r=e.prototype;return r.fetchAngle=function(){return this.angle},r.fetchMeridian=function(){return this.merdian},r.fetchDirection=function(){return this.direction},r.fetchView=function(){return this.view},r.fetchDms=function(){return null===this._dms&&this._calculateDms(),this._dms},r.fetchFormattedDms=function(){return null===this._formattedDms&&this._calculateDms(),this._formattedDms},r._calculateDms=function(){let e=null,r=b.truncated_degrees,n=0;for(let t=0;t<this.view.length;t++){const o=this.view[t];switch(o){case"m":e=ie(this.view,t,o),r=r===b.truncated_degrees?b.fractional_degree_minutes:r,t=e.newpos;continue;case"s":e=ie(this.view,t,o),r=b.fractional_minute_seconds,n=n<e.rounding?e.rounding:n,t=e.newpos;continue;default:continue}}this._dms=P.secondsToDMS(this.angle.extractAngularUnits(b.seconds)),this._formattedDms=P.secondsToDMS(this.angle.extractAngularUnits(b.seconds)).format(r,n)},e}();function j(e,r,t,o,s){let i=null;switch(r){case b.decimal_degrees:case b.radians:case b.gradians:return i=G(F(e.extractAngularUnits(r),o),H(r)),z(i.toFixed(o),"0",t+o+(o>0?1:0));case b.truncated_degrees:case b.fractional_degree_minutes:return i=G(s.fetchFormattedDms().getField(r),H(r)),z(i.toFixed(o),"0",t+o+(o>0?1:0));case b.fractional_minute_seconds:return i=G(F(s.fetchDms().getField(r),o),H(r)),z(i.toFixed(o),"0",t+o+(o>0?1:0));default:throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"unexpected evaluation"})}}function J(e,r,t){if(t===y.quadrant)throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"});if(r===b.degrees_minutes_seconds){const r=P.numberToDms(e);return W.createFromAngleAndDirection(B.createFromDegreesMinutesSeconds(r.m_degrees,r.m_minutes,r.m_seconds),t)}return W.createFromAngleAndDirection(B.createFromAngleAndUnits(e,V(r)),t)}function K(e){switch(t.toNumber(e)){case 1:return{first:N.north,second:N.east};case 2:return{first:N.south,second:N.east};case 3:return{first:N.south,second:N.west};case 4:return{first:N.north,second:N.west}}return null}function Y(e){switch(e.toUpperCase().trim()){case"N":case"NORTH":return N.north;case"E":case"EAST":return N.east;case"S":case"SOUTH":return N.south;case"W":case"WEST":return N.west}return null}function $(e){const r=parseFloat(e);if(t.isNumber(r)){if(isNaN(r))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"});return r}throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"})}function ee(e,r,o){const s=o===y.quadrant;let i=null,c=null,a=0,u=0,d=0;if(s){if(e.length<2)throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"});d=1;const r=K(t.toString(e[e.length-1]));if(r?(i=r.first,c=r.second):(a=1,i=Y(t.toString(e[0])),c=Y(t.toString(e[e.length-1]))),null===i||null===c)throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"})}switch(r){case b.decimal_degrees:case b.radians:case b.gradians:if(0===e.length)throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"});return s?W.createFromAngleMeridianAndDirection(B.createFromAngleAndUnits($(e[a]),V(r)),i,c):W.createFromAngleAndDirection(B.createFromAngleAndUnits($(e[a]),V(r)),o);case b.degrees_minutes_seconds:if(u=e.length-d-a,3===u){const r=B.createFromDegreesMinutesSeconds($(e[a]),$(e[a+1]),$(e[a+2]));return s?W.createFromAngleMeridianAndDirection(r,i,c):W.createFromAngleAndDirection(r,o)}if(1===u){const r=$(e[a]),n=P.numberToDms(r),t=B.createFromDegreesMinutesSeconds(n.m_degrees,n.m_minutes,n.m_seconds);return s?W.createFromAngleMeridianAndDirection(t,i,c):W.createFromAngleAndDirection(t,o)}}throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"invalid conversion"})}function re(e){const r=[" ","-","/","'",'"',"\\","^",v,M,"\t","\r","\n","*"];let n="";for(let t=0;t<e.length;t++){const o=e.charAt(t);r.includes(o)?n+="RRSPLITRRSPLITRR":n+=o}return n.split("RRSPLITRRSPLITRR").filter((e=>""!==e))}function ne(e,r,o){if(t.isNumber(e))return J(t.toNumber(e),r,o);if(t.isString(e))return ee(re(e),r,o);if(t.isArray(e))return ee(e,r,o);if(t.isImmutableArray(e))return ee(e.toArray(),r,o);throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"})}function te(e,r,t){const o=V(t);if(o&&t!==b.degrees_minutes_seconds){return e.getAngle(r).extractAngularUnits(o)}throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"})}function oe(e,r,n){const t=e.getAngle(r);if(r===y.quadrant&&n===b.degrees_minutes_seconds){const n=P.secondsToDMS(t.extractAngularUnits(b.seconds));return[O(e.getMeridian(r),"SHORT"),n.m_degrees,n.m_minutes,n.m_seconds,O(e.getDirection(r),"SHORT")]}if(n===b.degrees_minutes_seconds){const e=P.secondsToDMS(t.extractAngularUnits(b.seconds));return[e.m_degrees,e.m_minutes,e.m_seconds]}return r===y.quadrant?[O(e.getMeridian(r),"SHORT"),t.extractAngularUnits(n),O(e.getDirection(r),"SHORT")]:[t.extractAngularUnits(n)]}function se(e,r){let t="";switch(e){case b.decimal_degrees:t=r===y.quadrant?"DD.DD"+v:"DDD.DD"+v;break;case b.degrees_minutes_seconds:t=r===y.quadrant?"dd"+v+" mm' ss\"":"ddd"+v+" mm' ss.ss\"";break;case b.radians:t="R.RR";break;case b.gradians:t="GGG.GG"+M;break;default:throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"})}return r===y.quadrant&&(t="p "+t+" b"),t}function ie(e,r,n){const t={padding:0,rounding:0,newpos:r};let o=!1;for(;r<e.length;){const s=e[r];if(s===n)o?t.rounding++:t.padding++,r++;else{if("."!==s)break;o=!0,r++}}return t.newpos=r-1,t}function ce(e,r,n){const t={escaped:"",newpos:r};for(r++;r<e.length;){const n=e[r];if(r++,"]"===n)break;t.escaped+=n}return t.newpos=r-1,t}function ae(e,r,n){let t="",o=null,s=null;const i=X.createFromStringAndBearing(r,e,n),c={D:b.decimal_degrees,d:b.truncated_degrees,m:b.fractional_degree_minutes,s:b.fractional_minute_seconds,R:b.radians,G:b.gradians};for(let a=0;a<r.length;a++){const u=r[a];switch(u){case"[":o=ce(r,a),t+=o.escaped,a=o.newpos;continue;case"D":case"d":case"m":case"s":case"R":case"G":o=ie(r,a,u),s=e.getAngle(n),t+=j(s,c[u],o.padding,o.rounding,i),a=o.newpos;continue;case"P":case"p":t+=O(i.fetchMeridian(),"p"===u?"SHORT":"LONG");continue;case"B":case"b":t+=O(i.fetchDirection(),"b"===u?"SHORT":"LONG");continue;default:t+=u}}return t}function ue(e,o,s){if(!(o instanceof r))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.InvalidParameter,null);if(!1===o.hasField("directionType"))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"missing directionType"});if(!1===o.hasField("angleType"))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"missing angleType"});const i=q(C(o.field("directiontype"))),c=ne(e,k(C(o.field("angletype"))),i);if(!(s instanceof r))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.InvalidParameter,null);if(!1===s.hasField("directionType"))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"missing directionType"});if(!1===s.hasField("outputType"))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"missing angleType"});const a=q(C(s.field("directiontype"))),u=s.hasField("angleType")?k(C(s.field("angletype"))):null,d=C(s.field("outputType")).toUpperCase().trim();if(!a||!d)throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"conversion error"});if(!(u||"TEXT"===d&&s.hasField("format")))throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.LogicError,null,{reason:"invalid unit"});switch(d){case"VALUE":return a===y.quadrant||u===b.degrees_minutes_seconds?oe(c,a,u):te(c,a,u);case"TEXT":{let e="";return s.hasField("format")&&(e=t.toString(s.field("format"))),null!==e&&""!==e||(e=se(u,a)),ae(c,e,a)}default:throw new n.ArcadeExecutionError(null,n.ExecutionErrorCodes.InvalidParameter,null)}}e.convertDirection=ue,e.preciseAdd=d,e.preciseDivide=g,e.preciseMinus=l,e.preciseMultiply=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
