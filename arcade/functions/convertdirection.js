/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","../Dictionary","../../chunks/languageUtils"],(function(e,t,n){"use strict";const r=e=>(t,n,r)=>(r=r||14,+e(t,n).toFixed(r)),i=(e,t)=>e+t,s=(e,t)=>e-t,c=(e,t)=>e*t,o=(e,t)=>e/t,a=(e,t,n)=>r(i)(e,t,n),u=(e,t,n)=>r(s)(e,t,n),d=(e,t,n)=>r(c)(e,t,n),l=(e,t,n)=>r(o)(e,t,n),f=360,m=400,h=2*Math.PI,_=3600,g=3240,w=60,p=60,E=180*_/Math.PI,D=f*w*p,A=90*_,S=180*_,R=270*_,M=String.fromCharCode(7501),v="Â°";function T(e){if(!1===n.isString(e))throw new Error("Invalid Parameter");return e}function F(e,t){const n=10**t;return Math.round(e*n)/n}function I(e,t){return e%t}function U(e){const t=parseFloat(e.toString().replace(Math.trunc(e).toString(),"0"))*Math.sign(e);if(e<0){return{fraction:t,integer:Math.ceil(e)}}return{fraction:t,integer:Math.floor(e)}}function N(e,t){switch(e){case 0:return"SHORT"===t?"N":"North";case 1:return"SHORT"===t?"E":"East";case 2:return"SHORT"===t?"S":"South";case 3:return"SHORT"===t?"W":"West"}}function b(e,t,n){for(;e.length<n;)e=t+e;return e}function x(e,t){return e-Math.floor(e/t)*t}function O(e){switch(e){case 6:case 1:return f;case 4:return h;case 5:return m;case 2:return D;case 7:return w;case 8:return p;default:throw new Error("Unnexpected evaluations")}}function y(e){switch(e.toUpperCase().trim()){case"NORTH":case"NORTHAZIMUTH":case"NORTH AZIMUTH":return 1;case"POLAR":return 2;case"QUADRANT":return 3;case"SOUTH":case"SOUTHAZIMUTH":case"SOUTH AZIMUTH":return 4}throw new Error("Unsupported direction type")}function G(e){switch(e.toUpperCase().trim()){case"D":case"DD":case"DECIMALDEGREE":case"DECIMAL DEGREE":case"DEGREE":case"DECIMALDEGREES":case"DECIMAL DEGREES":case"DEGREES":return 1;case"DMS":case"DEGREESMINUTESSECONDS":case"DEGREES MINUTES SECONDS":return 3;case"R":case"RAD":case"RADS":case"RADIAN":case"RADIANS":return 4;case"G":case"GON":case"GONS":case"GRAD":case"GRADS":case"GRADIAN":case"GRADIANS":return 5}throw new Error("Unsupported units")}let H=function(){function e(e,t,n){this.m_degrees=e,this.m_minutes=t,this.m_seconds=n}var t=e.prototype;return t.get_field=function(e){switch(e){case 1:case 6:return this.m_degrees;case 7:return this.m_minutes;case 2:case 8:return this.m_seconds;default:throw new Error("Unnexpected evaluation")}},e.seconds_to_DMS=function(t){const n=U(t).fraction;let r=U(t).integer;const i=Math.floor(r/_);r-=i*_;const s=Math.floor(r/p);return r-=s*p,new e(i,s,r+n)},e.number_to_dms=function(t){const n=U(t).fraction,r=U(t).integer,i=d(U(100*n).fraction,100);return new e(r,U(100*n).integer,i)},t.format=function(t,n){let r=F(this.m_seconds,n),i=this.m_minutes,s=this.m_degrees;if(2===t||8===t)p<=r&&(r-=p,++i),w<=i&&(i=0,++s),f<=s&&(s=0);else if(7===t)r=0,i=30<=this.m_seconds?this.m_minutes+1:this.m_minutes,s=this.m_degrees,w<=i&&(i=0,++s),f<=s&&(s=0);else if(1===t||6===t){const e=l(this.m_seconds,_),t=l(this.m_minutes,w);s=Math.round(this.m_degrees+t+e),i=0,r=0}return new e(s,i,r)},e.DMS_to_seconds=function(e,t,n){return e*_+t*p+n},e}(),C=function(){function e(e,t,n){this.meridian=e,this.angle=t,this.direction=n}return e.prototype.fetch_azimuth=function(e){return 0===e?this.meridian:this.direction},e}(),P=function(){function e(e){this.m_angle=e}e.createFromAngleAndDirection=function(t,n){return new e(new L(e.convertDirectionFormat(t.extract_angular_units(2),n,1)))};var t=e.prototype;return t.getAngle=function(t){const n=this.m_angle.extract_angular_units(2);switch(t){case 1:case 4:case 2:return new L(e.convertDirectionFormat(n,1,t));case 3:{const t=e.seconds_north_azimuth_to_quadrant(n);return new L(t.angle)}}},t.getMeridian=function(t){const n=this.m_angle.extract_angular_units(2);switch(t){case 1:return 0;case 4:return 2;case 2:return 1;case 3:return e.seconds_north_azimuth_to_quadrant(n).meridian}},t.getDirection=function(t){const n=this.m_angle.extract_angular_units(2);switch(t){case 1:return 1;case 4:return 3;case 2:return 0;case 3:return e.seconds_north_azimuth_to_quadrant(n).direction}},e.seconds_north_azimuth_to_quadrant=function(e){const t=e<=A||e>=R?0:2,n=0===t?Math.min(D-e,e):Math.abs(e-S);return new C(t,n,e>S?3:1)},e.createFromAngleMeridianAndDirection=function(t,n,r){return new e(new L(e.secondsQuadrantToNorthAzimuth(t.extract_angular_units(2),n,r)))},e.secondsQuadrantToNorthAzimuth=function(e,t,n){return 0===t?1===n?e:D-e:1===n?S-e:S+e},e.convertDirectionFormat=function(e,t,n){let r=0;switch(t){case 1:r=e;break;case 2:r=A-e;break;case 3:throw new Error("Unnexpected evaluation");case 4:r=e+S}let i=0;switch(n){case 1:i=r;break;case 2:i=A-r;break;case 3:throw new Error("Unnexpected evaluation");case 4:i=r-S}return i=I(i,D),i<0?D+i:i},e}();function k(e,t,n){let r=null;switch(t){case 1:r=d(e,_);break;case 2:r=e;break;case 5:r=d(e,g);break;case 4:r=d(e,E);break;default:throw new Error("Unnexpected evaluation")}switch(n){case 1:return l(r,_);case 2:return r;case 5:return l(r,g);case 4:return r/E;default:throw new Error("Unnexpected evaluation")}}let L=function(){function e(e){this.m_seconds=e}return e.createFromAngleAndUnits=function(t,n){return new e(k(t,n,2))},e.prototype.extract_angular_units=function(e){return k(this.m_seconds,2,z(e))},e.createFromDegreesMinutesSeconds=function(t,n,r){return new e(a(a(d(t,_),d(n,p)),r))},e}();function z(e){switch(e){case 1:case 6:case 3:return 1;case 5:return 5;case 7:return 7;case 4:return 4;case 2:case 8:return 2}}let q=function(){function e(e,t,n,r){this.m_view=e,this.m_angle=t,this.m_merdian=n,this.m_direction=r,this.m_dms=null,this.m_formatted_dms=null}e.createFromStringAndBearing=function(t,n,r){return new e(t,n.getAngle(r),n.getMeridian(r),n.getDirection(r))};var t=e.prototype;return t.fetch_angle=function(){return this.m_angle},t.fetch_meridian=function(){return this.m_merdian},t.fetch_direction=function(){return this.m_direction},t.fetch_m_view=function(){return this.m_view},t.fetch_dms=function(){return null===this.m_dms&&this.calculate_dms(),this.m_dms},t.fetch_formatted_dms=function(){return null===this.m_formatted_dms&&this.calculate_dms(),this.m_formatted_dms},t.calculate_dms=function(){let e=null,t=6,n=0;for(let r=0;r<this.m_view.length;r++){const i=this.m_view[r];switch(i){case"m":e=ee(this.m_view,r,i),t=6===t?7:t,r=e.newpos;continue;case"s":e=ee(this.m_view,r,i),t=8,n=n<e.rounding?e.rounding:n,r=e.newpos;continue;default:continue}}this.m_dms=H.seconds_to_DMS(this.m_angle.extract_angular_units(2)),this.m_formatted_dms=H.seconds_to_DMS(this.m_angle.extract_angular_units(2)).format(t,n)},e}();function W(e,t,n,r,i){let s=null;switch(t){case 1:case 4:case 5:return s=x(F(e.extract_angular_units(t),r),O(t)),b(s.toFixed(r),"0",n+r+(r>0?1:0));case 6:case 7:return s=x(i.fetch_formatted_dms().get_field(t),O(t)),b(s.toFixed(r),"0",n+r+(r>0?1:0));case 8:return s=x(F(i.fetch_dms().get_field(t),r),O(t)),b(s.toFixed(r),"0",n+r+(r>0?1:0));default:throw new Error("Unnexepected evaluation")}}function Z(e,t,n){if(3===n)throw new Error("Conversion error");if(3===t){const t=H.number_to_dms(e);return P.createFromAngleAndDirection(L.createFromDegreesMinutesSeconds(t.m_degrees,t.m_minutes,t.m_seconds),n)}return P.createFromAngleAndDirection(L.createFromAngleAndUnits(e,z(t)),n)}function B(e){switch(n.toNumber(e)){case 1:return{first:0,second:1};case 2:return{first:2,second:1};case 3:return{first:2,second:3};case 4:return{first:0,second:3}}return null}function Q(e){switch(e.toUpperCase().trim()){case"N":case"NORTH":return 0;case"E":case"EAST":return 1;case"S":case"SOUTH":return 2;case"W":case"WEST":return 3}return null}function X(e){const t=parseFloat(e);if(n.isNumber(t)){if(isNaN(t))throw new Error("Invalid conversion");return t}throw new Error("Invalid conversion")}function j(e,t,r){const i=3===r;let s=null,c=null,o=0,a=0,u=0;if(i){if(e.length<2)throw new Error("Conversion Error");u=1;const t=B(n.toString(e[e.length-1]));if(t?(s=t.first,c=t.second):(o=1,s=Q(n.toString(e[0])),c=Q(n.toString(e[e.length-1]))),null===s||null===c)throw new Error("Invalid Conversion")}switch(t){case 1:case 4:case 5:if(0===e.length)throw new Error("Invalid Conversion");return i?P.createFromAngleMeridianAndDirection(L.createFromAngleAndUnits(X(e[o]),z(t)),s,c):P.createFromAngleAndDirection(L.createFromAngleAndUnits(X(e[o]),z(t)),r);case 3:if(a=e.length-u-o,3===a){const t=L.createFromDegreesMinutesSeconds(X(e[o]),X(e[o+1]),X(e[o+2]));return i?P.createFromAngleMeridianAndDirection(t,s,c):P.createFromAngleAndDirection(t,r)}if(1===a){const t=X(e[o]),n=H.number_to_dms(t),a=L.createFromDegreesMinutesSeconds(n.m_degrees,n.m_minutes,n.m_seconds);return i?P.createFromAngleMeridianAndDirection(a,s,c):P.createFromAngleAndDirection(a,r)}}throw new Error("Conversion Error")}function V(e){const t=[" ","-","/","'",'"',"\\","^",v,M,"\t","\r","\n","*"];let n="";for(let r=0;r<e.length;r++){const i=e.charAt(r);-1!==t.indexOf(i)?n+="RRSPLITRRSPLITRR":n+=i}return n.split("RRSPLITRRSPLITRR").filter((e=>""!==e))}function J(e,t,r){if(n.isNumber(e))return Z(n.toNumber(e),t,r);if(n.isString(e))return j(V(e),t,r);if(n.isArray(e))return j(e,t,r);if(n.isImmutableArray(e))return j(e.toArray(),t,r);throw new Error("Conversion Error")}function K(e,t,n){const r=z(n);if(r&&3!==n){return e.getAngle(t).extract_angular_units(r)}throw new Error("Conversion Error")}function Y(e,t,n){const r=e.getAngle(t);if(3===t&&3===n){const n=H.seconds_to_DMS(r.extract_angular_units(2));return[N(e.getMeridian(t),"SHORT"),n.m_degrees,n.m_minutes,n.m_seconds,N(e.getDirection(t),"SHORT")]}if(3===n){const e=H.seconds_to_DMS(r.extract_angular_units(2));return[e.m_degrees,e.m_minutes,e.m_seconds]}return 3===t?[N(e.getMeridian(t),"SHORT"),r.extract_angular_units(n),N(e.getDirection(t),"SHORT")]:[r.extract_angular_units(n)]}function $(e,t){let n="";switch(e){case 1:n=3===t?"DD.DD"+v:"DDD.DD"+v;break;case 3:n=3===t?"dd"+v+" mm' ss\"":"ddd"+v+" mm' ss.ss\"";break;case 4:n="R.RR";break;case 5:n="GGG.GG"+M;break;default:throw new Error("Conversion error")}return 3===t&&(n="p "+n+" b"),n}function ee(e,t,n){const r={padding:0,rounding:0,newpos:t};let i=!1;for(;t<e.length;){const s=e[t];if(s===n)i?r.rounding++:r.padding++,t++;else{if("."!==s)break;i=!0,t++}}return r.newpos=t-1,r}function te(e,t,n){const r={escaped:"",newpos:t};for(t++;t<e.length;){const n=e[t];if(t++,"]"===n)break;r.escaped+=n}return r.newpos=t-1,r}function ne(e,t,n){let r="",i=null,s=null;const c=q.createFromStringAndBearing(t,e,n),o={D:1,d:6,m:7,s:8,R:4,G:5};for(let a=0;a<t.length;a++){const u=t[a];switch(u){case"[":i=te(t,a),r+=i.escaped,a=i.newpos;continue;case"D":case"d":case"m":case"s":case"R":case"G":i=ee(t,a,u),s=e.getAngle(n),r+=W(s,o[u],i.padding,i.rounding,c),a=i.newpos;continue;case"P":case"p":r+=N(c.fetch_meridian(),"p"===u?"SHORT":"LONG");continue;case"B":case"b":r+=N(c.fetch_direction(),"b"===u?"SHORT":"LONG");continue;default:r+=u}}return r}function re(e,r,i){if(!(r instanceof t))throw new Error("Invalid Parameter");if(!1===r.hasField("directionType"))throw new Error("Invalid Parameter - Missing directionType");if(!1===r.hasField("angleType"))throw new Error("Invalid Parameter - Missing directionType");const s=y(T(r.field("directiontype"))),c=J(e,G(T(r.field("angletype"))),s);if(!(i instanceof t))throw new Error("Invalid Parameter");if(!1===i.hasField("directionType"))throw new Error("Invalid Parameter - Missing directionType");if(!1===i.hasField("outputType"))throw new Error("Invalid Parameter - Missing directionType");const o=y(T(i.field("directiontype"))),a=i.hasField("angleType")?G(T(i.field("angletype"))):null,u=T(i.field("outputType")).toUpperCase().trim();if(!o||!u)throw new Error("Conversion error");if(!(a||"TEXT"===u&&i.hasField("format")))throw new Error("Invalid unit");switch(u){case"VALUE":return 3===o||3===a?Y(c,o,a):K(c,o,a);case"TEXT":{let e="";return i.hasField("format")&&(e=n.toString(i.field("format"))),null!==e&&""!==e||(e=$(a,o)),ne(c,e,o)}default:throw new Error("Invalid Parameter")}}e.convertDirection=re,e.preciseAdd=a,e.preciseDivide=l,e.preciseMinus=u,e.preciseMultiply=d,Object.defineProperty(e,"__esModule",{value:!0})}));
