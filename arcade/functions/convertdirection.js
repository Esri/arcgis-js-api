// COPYRIGHT © 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.41/esri/copyright.txt for details.

define(["require","exports","../Dictionary","../languageUtils"],(function(e,r,n,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.convertDirection=r.preciseDivide=r.preciseMultiply=r.preciseMinus=r.preciseAdd=void 0;var i=function(e){return function(r,n,t){return t=t||14,+e(r,n).toFixed(t)}},s=function(e,r){return e+r},a=function(e,r){return e-r},o=function(e,r){return e*r},c=function(e,r){return e/r};r.preciseAdd=function(e,r,n){return i(s)(e,r,n)};r.preciseMinus=function(e,r,n){return i(a)(e,r,n)};r.preciseMultiply=function(e,r,n){return i(o)(e,r,n)};r.preciseDivide=function(e,r,n){return i(c)(e,r,n)};var u,d,l,m,f=2*Math.PI,h=648e3/Math.PI,g=String.fromCharCode(7501);function p(e){if(!1===t.isString(e))throw new Error("Invalid Parameter");return e}function w(e,r){var n=Math.pow(10,r);return Math.round(e*n)/n}function v(e){var r,n=parseFloat(e.toString().replace(function(e){return e=+e,isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e}(e).toString(),"0"))*(((r=e)>0)-(r<0)||+r);return e<0?{fraction:n,integer:Math.ceil(e)}:{fraction:n,integer:Math.floor(e)}}function A(e,r){switch(e){case 0:return"SHORT"===r?"N":"North";case 1:return"SHORT"===r?"E":"East";case 2:return"SHORT"===r?"S":"South";case 3:return"SHORT"===r?"W":"West"}}function _(e,r,n){for(;e.length<n;)e=r+e;return e}function D(e,r){return e-Math.floor(e/r)*r}function E(e){switch(e){case 6:case 1:return 360;case 4:return f;case 5:return 400;case 2:return 1296e3;case 7:case 8:return 60;default:throw new Error("Unnexpected evaluations")}}function S(e){switch(e.toUpperCase().trim()){case"NORTH":case"NORTHAZIMUTH":case"NORTH AZIMUTH":return 1;case"POLAR":return 2;case"QUADRANT":return 3;case"SOUTH":case"SOUTHAZIMUTH":case"SOUTH AZIMUTH":return 4}throw new Error("Unsupported direction type")}function T(e){switch(e.toUpperCase().trim()){case"D":case"DD":case"DECIMALDEGREE":case"DECIMAL DEGREE":case"DEGREE":case"DECIMALDEGREES":case"DECIMAL DEGREES":case"DEGREES":return 1;case"DMS":case"DEGREESMINUTESSECONDS":case"DEGREES MINUTES SECONDS":return 3;case"R":case"RAD":case"RADS":case"RADIAN":case"RADIANS":return 4;case"G":case"GON":case"GONS":case"GRAD":case"GRADS":case"GRADIAN":case"GRADIANS":return 5}throw new Error("Unsupported units")}!function(e){e[e.north=0]="north",e[e.east=1]="east",e[e.south=2]="south",e[e.west=3]="west"}(u||(u={})),function(e){e[e.decimal_degrees=1]="decimal_degrees",e[e.seconds=2]="seconds",e[e.degrees_minutes_seconds=3]="degrees_minutes_seconds",e[e.radians=4]="radians",e[e.gradians=5]="gradians",e[e.truncated_degrees=6]="truncated_degrees",e[e.fractional_degree_minutes=7]="fractional_degree_minutes",e[e.fractional_minute_seconds=8]="fractional_minute_seconds"}(d||(d={})),function(e){e[e.north_azimuth=1]="north_azimuth",e[e.polar=2]="polar",e[e.quadrant=3]="quadrant",e[e.south_azimuth=4]="south_azimuth"}(l||(l={})),function(e){e[e.meridian=0]="meridian",e[e.direction=1]="direction"}(m||(m={}));var M=function(){function e(e,r,n){this.m_degrees=e,this.m_minutes=r,this.m_seconds=n}return e.prototype.getField=function(e){switch(e){case 1:case 6:return this.m_degrees;case 7:return this.m_minutes;case 2:case 8:return this.m_seconds;default:throw new Error("Unnexpected evaluation")}},e.secondsToDMS=function(r){var n=v(r).fraction,t=v(r).integer,i=Math.floor(t/3600);t-=3600*i;var s=Math.floor(t/60);return new e(i,s,(t-=60*s)+n)},e.numberToDms=function(n){var t=v(n).fraction,i=v(n).integer,s=r.preciseMultiply(v(100*t).fraction,100);return new e(i,v(100*t).integer,s)},e.prototype.format=function(n,t){var i=w(this.m_seconds,t),s=this.m_minutes,a=this.m_degrees;if(2===n||8===n)60<=i&&(i-=60,++s),60<=s&&(s=0,++a),360<=a&&(a=0);else if(7===n)i=0,s=30<=this.m_seconds?this.m_minutes+1:this.m_minutes,a=this.m_degrees,60<=s&&(s=0,++a),360<=a&&(a=0);else if(1===n||6===n){var o=r.preciseDivide(this.m_seconds,3600),c=r.preciseDivide(this.m_minutes,60);a=Math.round(this.m_degrees+c+o),s=0,i=0}return new e(a,s,i)},e.dmsToSeconds=function(e,r,n){return 3600*e+60*r+n},e}(),R=function(){function e(e,r,n){this.meridian=e,this.angle=r,this.direction=n}return e.prototype.fetchAzimuth=function(e){return e===m.meridian?this.meridian:this.direction},e}(),U=function(){function e(e){this.m_angle=e}return e.createFromAngleAndDirection=function(r,n){return new e(new F(e._convertDirectionFormat(r.extractAngularUnits(2),n,1)))},e.prototype.getAngle=function(r){var n=this.m_angle.extractAngularUnits(2);switch(r){case 1:case 4:case 2:return new F(e._convertDirectionFormat(n,1,r));case 3:var t=e.secondsNorthAzimuthToQuadrant(n);return new F(t.angle)}},e.prototype.getMeridian=function(r){var n=this.m_angle.extractAngularUnits(2);switch(r){case 1:return 0;case 4:return 2;case 2:return 1;case 3:return e.secondsNorthAzimuthToQuadrant(n).meridian}},e.prototype.getDirection=function(r){var n=this.m_angle.extractAngularUnits(2);switch(r){case 1:return 1;case 4:return 3;case 2:return 0;case 3:return e.secondsNorthAzimuthToQuadrant(n).direction}},e.secondsNorthAzimuthToQuadrant=function(e){var r=e<=324e3||e>=972e3?0:2,n=0===r?Math.min(1296e3-e,e):Math.abs(e-648e3);return new R(r,n,e>648e3?3:1)},e.createFromAngleMeridianAndDirection=function(r,n,t){return new e(new F(e.secondsQuadrantToNorthAzimuth(r.extractAngularUnits(2),n,t)))},e.secondsQuadrantToNorthAzimuth=function(e,r,n){return 0===r?1===n?e:1296e3-e:1===n?648e3-e:648e3+e},e._convertDirectionFormat=function(e,r,n){var t=0;switch(r){case 1:t=e;break;case 2:t=324e3-e;break;case 3:throw new Error("Unnexpected evaluation");case 4:t=e+648e3}var i=0;switch(n){case 1:i=t;break;case 2:i=324e3-t;break;case 3:throw new Error("Unnexpected evaluation");case 4:i=t-648e3}return(i=i%1296e3)<0?1296e3+i:i},e}();function y(e,n,t){var i=null;switch(n){case 1:i=r.preciseMultiply(e,3600);break;case 2:i=e;break;case 5:i=r.preciseMultiply(e,3240);break;case 4:i=r.preciseMultiply(e,h);break;default:throw new Error("Unnexpected evaluation")}switch(t){case 1:return r.preciseDivide(i,3600);case 2:return i;case 5:return r.preciseDivide(i,3240);case 4:return i/h;default:throw new Error("Unnexpected evaluation")}}var F=function(){function e(e){this.m_seconds=e}return e.createFromAngleAndUnits=function(r,n){return new e(y(r,n,2))},e.prototype.extractAngularUnits=function(e){return y(this.m_seconds,2,I(e))},e.createFromDegreesMinutesSeconds=function(n,t,i){return new e(r.preciseAdd(r.preciseAdd(r.preciseMultiply(n,3600),r.preciseMultiply(t,60)),i))},e}();function I(e){switch(e){case 1:case 6:case 3:return 1;case 5:return 5;case 7:return 7;case 4:return 4;case 2:case 8:return 2}}var N=function(){function e(e,r,n,t){this.m_view=e,this.m_angle=r,this.m_merdian=n,this.m_direction=t,this.m_dms=null,this.m_formatted_dms=null}return e.createFromStringAndBearing=function(r,n,t){return new e(r,n.getAngle(t),n.getMeridian(t),n.getDirection(t))},e.prototype.fetchAngle=function(){return this.m_angle},e.prototype.fetchMeridian=function(){return this.m_merdian},e.prototype.fetchDirection=function(){return this.m_direction},e.prototype.fetchView=function(){return this.m_view},e.prototype.fetchDms=function(){return null===this.m_dms&&this._calculateDms(),this.m_dms},e.prototype.fetchFormattedDms=function(){return null===this.m_formatted_dms&&this._calculateDms(),this.m_formatted_dms},e.prototype._calculateDms=function(){for(var e=null,r=6,n=0,t=0;t<this.m_view.length;t++){var i=this.m_view[t];switch(i){case"m":r=6===r?7:r,t=(e=C(this.m_view,t,i)).newpos;continue;case"s":r=8,n=n<(e=C(this.m_view,t,i)).rounding?e.rounding:n,t=e.newpos;continue;default:continue}}this.m_dms=M.secondsToDMS(this.m_angle.extractAngularUnits(2)),this.m_formatted_dms=M.secondsToDMS(this.m_angle.extractAngularUnits(2)).format(r,n)},e}();function b(e,r,n,t,i){switch(r){case 1:case 4:case 5:return _(D(w(e.extractAngularUnits(r),t),E(r)).toFixed(t),"0",n+t+(t>0?1:0));case 6:case 7:return _(D(i.fetchFormattedDms().getField(r),E(r)).toFixed(t),"0",n+t+(t>0?1:0));case 8:return _(D(w(i.fetchDms().getField(r),t),E(r)).toFixed(t),"0",n+t+(t>0?1:0));default:throw new Error("Unnexepected evaluation")}}function x(e){switch(e.toUpperCase().trim()){case"N":case"NORTH":return 0;case"E":case"EAST":return 1;case"S":case"SOUTH":return 2;case"W":case"WEST":return 3}return null}function O(e){var r=parseFloat(e);if(t.isNumber(r)){if(isNaN(r))throw new Error("Invalid conversion");return r}throw new Error("Invalid conversion")}function G(e,r,n){var i=3===n,s=null,a=null,o=0,c=0,u=0;if(i){if(e.length<2)throw new Error("Conversion Error");u=1;var d=function(e){switch(t.toNumber(e)){case 1:return{first:0,second:1};case 2:return{first:2,second:1};case 3:return{first:2,second:3};case 4:return{first:0,second:3}}return null}(t.toString(e[e.length-1]));if(d?(s=d.first,a=d.second):(o=1,s=x(t.toString(e[0])),a=x(t.toString(e[e.length-1]))),null===s||null===a)throw new Error("Invalid Conversion")}switch(r){case 1:case 4:case 5:if(0===e.length)throw new Error("Invalid Conversion");return i?U.createFromAngleMeridianAndDirection(F.createFromAngleAndUnits(O(e[o]),I(r)),s,a):U.createFromAngleAndDirection(F.createFromAngleAndUnits(O(e[o]),I(r)),n);case 3:if(3===(c=e.length-u-o)){var l=F.createFromDegreesMinutesSeconds(O(e[o]),O(e[o+1]),O(e[o+2]));return i?U.createFromAngleMeridianAndDirection(l,s,a):U.createFromAngleAndDirection(l,n)}if(1===c){var m=O(e[o]),f=M.numberToDms(m),h=F.createFromDegreesMinutesSeconds(f.m_degrees,f.m_minutes,f.m_seconds);return i?U.createFromAngleMeridianAndDirection(h,s,a):U.createFromAngleAndDirection(h,n)}}throw new Error("Conversion Error")}function H(e,r,n){if(t.isNumber(e))return function(e,r,n){if(3===n)throw new Error("Conversion error");if(3===r){var t=M.numberToDms(e);return U.createFromAngleAndDirection(F.createFromDegreesMinutesSeconds(t.m_degrees,t.m_minutes,t.m_seconds),n)}return U.createFromAngleAndDirection(F.createFromAngleAndUnits(e,I(r)),n)}(t.toNumber(e),r,n);if(t.isString(e))return G(function(e){for(var r=[" ","-","/","'",'"',"\\","^","°",g,"\t","\r","\n","*"],n="",t=0;t<e.length;t++){var i=e.charAt(t);r.includes(i)?n+="RRSPLITRRSPLITRR":n+=i}return n.split("RRSPLITRRSPLITRR").filter((function(e){return""!==e}))}(e),r,n);if(t.isArray(e))return G(e,r,n);if(t.isImmutableArray(e))return G(e.toArray(),r,n);throw new Error("Conversion Error")}function C(e,r,n){for(var t={padding:0,rounding:0,newpos:r},i=!1;r<e.length;){var s=e[r];if(s===n)i?t.rounding++:t.padding++,r++;else{if("."!==s)break;i=!0,r++}}return t.newpos=r-1,t}function P(e,r,n){var t={escaped:"",newpos:r};for(r++;r<e.length;){var i=e[r];if(r++,"]"===i)break;t.escaped+=i}return t.newpos=r-1,t}r.convertDirection=function(e,r,i){if(!(r instanceof n))throw new Error("Invalid Parameter");if(!1===r.hasField("directionType"))throw new Error("Invalid Parameter - Missing directionType");if(!1===r.hasField("angleType"))throw new Error("Invalid Parameter - Missing directionType");var s=S(p(r.field("directiontype"))),a=H(e,T(p(r.field("angletype"))),s);if(!(i instanceof n))throw new Error("Invalid Parameter");if(!1===i.hasField("directionType"))throw new Error("Invalid Parameter - Missing directionType");if(!1===i.hasField("outputType"))throw new Error("Invalid Parameter - Missing directionType");var o=S(p(i.field("directiontype"))),c=i.hasField("angleType")?T(p(i.field("angletype"))):null,u=p(i.field("outputType")).toUpperCase().trim();if(!o||!u)throw new Error("Conversion error");if(!(c||"TEXT"===u&&i.hasField("format")))throw new Error("Invalid unit");switch(u){case"VALUE":return 3===o||3===c?function(e,r,n){var t=e.getAngle(r);if(3===r&&3===n){var i=M.secondsToDMS(t.extractAngularUnits(2));return[A(e.getMeridian(r),"SHORT"),i.m_degrees,i.m_minutes,i.m_seconds,A(e.getDirection(r),"SHORT")]}return 3===n?[(i=M.secondsToDMS(t.extractAngularUnits(2))).m_degrees,i.m_minutes,i.m_seconds]:3===r?[A(e.getMeridian(r),"SHORT"),t.extractAngularUnits(n),A(e.getDirection(r),"SHORT")]:[t.extractAngularUnits(n)]}(a,o,c):function(e,r,n){var t=I(n);if(t&&3!==n)return e.getAngle(r).extractAngularUnits(t);throw new Error("Conversion Error")}(a,o,c);case"TEXT":var d="";return i.hasField("format")&&(d=t.toString(i.field("format"))),null!==d&&""!==d||(d=function(e,r){var n="";switch(e){case 1:n=3===r?"DD.DD°":"DDD.DD°";break;case 3:n=3===r?"dd° mm' ss\"":"ddd° mm' ss.ss\"";break;case 4:n="R.RR";break;case 5:n="GGG.GG"+g;break;default:throw new Error("Conversion error")}return 3===r&&(n="p "+n+" b"),n}(c,o)),function(e,r,n){for(var t="",i=null,s=N.createFromStringAndBearing(r,e,n),a={D:1,d:6,m:7,s:8,R:4,G:5},o=0;o<r.length;o++){var c=r[o];switch(c){case"[":t+=(i=P(r,o)).escaped,o=i.newpos;continue;case"D":case"d":case"m":case"s":case"R":case"G":i=C(r,o,c),t+=b(e.getAngle(n),a[c],i.padding,i.rounding,s),o=i.newpos;continue;case"P":case"p":t+=A(s.fetchMeridian(),"p"===c?"SHORT":"LONG");continue;case"B":case"b":t+=A(s.fetchDirection(),"b"===c?"SHORT":"LONG");continue;default:t+=c}}return t}(a,d,o);default:throw new Error("Invalid Parameter")}}}));