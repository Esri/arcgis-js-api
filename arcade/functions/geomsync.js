/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../../kernel","../kernel","../../chunks/languageUtils","./centroid","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/jsonUtils","../executionError","../../core/unitUtils"],(function(e,r,n,t,o,i,a,u,c,l,s,f,d,E){"use strict";let m=null;function C(e){return 0===r.version.indexOf("4.")?l.fromExtent(e):new l({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function h(e){m=e}function y(e,r){if("polygon"!==e.type&&"polyline"!==e.type&&"extent"!==e.type)return 0;let n=1;if(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid){n=o.getMetersPerVerticalUnitForSR(e.spatialReference)/E.getMetersPerUnitForSR(e.spatialReference)}let i=0;if("polyline"===e.type)for(const t of e.paths)for(let e=1;e<t.length;e++)i+=o.segmentLength3d(t[e],t[e-1],n);else if("polygon"===e.type)for(const t of e.rings){for(let e=1;e<t.length;e++)i+=o.segmentLength3d(t[e],t[e-1],n);(t[0][0]!==t[t.length-1][0]||t[0][1]!==t[t.length-1][1]||void 0!==t[0][2]&&t[0][2]!==t[t.length-1][2])&&(i+=o.segmentLength3d(t[0],t[t.length-1],n))}else"extent"===e.type&&(i+=2*o.segmentLength3d([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],n),i+=2*o.segmentLength3d([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],n),i*=2,i+=4*Math.abs(t.defaultUndefined(e.zmax,0)*n-t.defaultUndefined(e.zmin,0)*n));const a=new s({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:[[0,0],[0,i]]});return m.planarLength(a,r)}function x(e,r){function E(e,r,n){if(t.pcCheck(n,2,2,e,r),n[0]instanceof a&&n[1]instanceof a);else if(n[0]instanceof a&&null===n[1]);else if(n[1]instanceof a&&null===n[0]);else if(null!==n[0]||null!==n[1])throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,r)}e.disjoint=function(e,n){return r(e,n,((r,o,i)=>(i=t.autoCastFeatureToGeometry(i),E(e,n,i),null===i[0]||null===i[1]||m.disjoint(i[0],i[1]))))},e.intersects=function(e,n){return r(e,n,((r,o,i)=>(i=t.autoCastFeatureToGeometry(i),E(e,n,i),null!==i[0]&&null!==i[1]&&m.intersects(i[0],i[1]))))},e.touches=function(e,n){return r(e,n,((r,o,i)=>(i=t.autoCastFeatureToGeometry(i),E(e,n,i),null!==i[0]&&null!==i[1]&&m.touches(i[0],i[1]))))},e.crosses=function(e,n){return r(e,n,((r,o,i)=>(i=t.autoCastFeatureToGeometry(i),E(e,n,i),null!==i[0]&&null!==i[1]&&m.crosses(i[0],i[1]))))},e.within=function(e,n){return r(e,n,((r,o,i)=>(i=t.autoCastFeatureToGeometry(i),E(e,n,i),null!==i[0]&&null!==i[1]&&m.within(i[0],i[1]))))},e.contains=function(e,n){return r(e,n,((r,o,i)=>(i=t.autoCastFeatureToGeometry(i),E(e,n,i),null!==i[0]&&null!==i[1]&&m.contains(i[0],i[1]))))},e.overlaps=function(e,n){return r(e,n,((r,o,i)=>(i=t.autoCastFeatureToGeometry(i),E(e,n,i),null!==i[0]&&null!==i[1]&&m.overlaps(i[0],i[1]))))},e.equals=function(e,n){return r(e,n,((r,o,i)=>(t.pcCheck(i,2,2,e,n),i[0]===i[1]||(i[0]instanceof a&&i[1]instanceof a?m.equals(i[0],i[1]):!(!t.isDate(i[0])||!t.isDate(i[1]))&&i[0].equals(i[1])))))},e.relate=function(e,n){return r(e,n,((r,o,i)=>{if(i=t.autoCastFeatureToGeometry(i),t.pcCheck(i,3,3,e,n),i[0]instanceof a&&i[1]instanceof a)return m.relate(i[0],i[1],t.toString(i[2]));if(i[0]instanceof a&&null===i[1])return!1;if(i[1]instanceof a&&null===i[0])return!1;if(null===i[0]&&null===i[1])return!1;throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n)}))},e.intersection=function(e,n){return r(e,n,((r,o,i)=>(i=t.autoCastFeatureToGeometry(i),E(e,n,i),null===i[0]||null===i[1]?null:m.intersect(i[0],i[1]))))},e.union=function(e,o){return r(e,o,((r,i,u)=>{const c=[];if(0===(u=t.autoCastFeatureToGeometry(u)).length)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.WrongNumberOfParameters,o);if(1===u.length)if(t.isArray(u[0])){const r=t.autoCastFeatureToGeometry(u[0]);for(let n=0;n<r.length;n++)if(null!==r[n]){if(!(r[n]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);c.push(r[n])}}else{if(!t.isImmutableArray(u[0])){if(u[0]instanceof a)return t.fixSpatialReference(n.cloneGeometry(u[0]),e.spatialReference);if(null===u[0])return null;throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o)}{const r=t.autoCastFeatureToGeometry(u[0].toArray());for(let n=0;n<r.length;n++)if(null!==r[n]){if(!(r[n]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);c.push(r[n])}}}else for(let n=0;n<u.length;n++)if(null!==u[n]){if(!(u[n]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);c.push(u[n])}return 0===c.length?null:m.union(c)}))},e.difference=function(e,o){return r(e,o,((r,i,a)=>(a=t.autoCastFeatureToGeometry(a),E(e,o,a),null!==a[0]&&null===a[1]?n.cloneGeometry(a[0]):null===a[0]?null:m.difference(a[0],a[1]))))},e.symmetricdifference=function(e,o){return r(e,o,((r,i,a)=>(a=t.autoCastFeatureToGeometry(a),E(e,o,a),null===a[0]&&null===a[1]?null:null===a[0]?n.cloneGeometry(a[1]):null===a[1]?n.cloneGeometry(a[0]):m.symmetricDifference(a[0],a[1]))))},e.clip=function(e,n){return r(e,n,((r,o,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,2,e,n),!(u[1]instanceof i)&&null!==u[1])throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);if(null===u[0])return null;if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);return null===u[1]?null:m.clip(u[0],u[1])}))},e.cut=function(e,o){return r(e,o,((r,i,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,2,e,o),!(u[1]instanceof s)&&null!==u[1])throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);if(null===u[0])return[];if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return null===u[1]?[n.cloneGeometry(u[0])]:m.cut(u[0],u[1])}))},e.area=function(e,o){return r(e,o,((r,i,u)=>{if(t.pcCheck(u,1,2,e,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isArray(u[0])||t.isImmutableArray(u[0])){const r=t.autoCastArrayOfPointsToPolygon(u[0],e.spatialReference);return null===r?0:m.planarArea(r,n.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return m.planarArea(u[0],n.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.areageodetic=function(e,o){return r(e,o,((r,i,u)=>{if(t.pcCheck(u,1,2,e,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isArray(u[0])||t.isImmutableArray(u[0])){const r=t.autoCastArrayOfPointsToPolygon(u[0],e.spatialReference);return null===r?0:m.geodesicArea(r,n.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return m.geodesicArea(u[0],n.convertSquareUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.length=function(e,o){return r(e,o,((r,i,u)=>{if(t.pcCheck(u,1,2,e,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isArray(u[0])||t.isImmutableArray(u[0])){const r=t.autoCastArrayOfPointsToPolyline(u[0],e.spatialReference);return null===r?0:m.planarLength(r,n.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return m.planarLength(u[0],n.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.length3d=function(e,o){return r(e,o,((r,i,u)=>{if(t.pcCheck(u,1,2,e,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isArray(u[0])||t.isImmutableArray(u[0])){const r=t.autoCastArrayOfPointsToPolyline(u[0],e.spatialReference);return null===r?0:!0===r.hasZ?y(r,n.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1))):m.planarLength(r,n.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return!0===u[0].hasZ?y(u[0],n.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1))):m.planarLength(u[0],n.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.lengthgeodetic=function(e,o){return r(e,o,((r,i,u)=>{if(t.pcCheck(u,1,2,e,o),null===(u=t.autoCastFeatureToGeometry(u))[0])return 0;if(t.isArray(u[0])||t.isImmutableArray(u[0])){const r=t.autoCastArrayOfPointsToPolyline(u[0],e.spatialReference);return null===r?0:m.geodesicLength(r,n.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return m.geodesicLength(u[0],n.convertLinearUnitsToCode(t.defaultUndefined(u[1],-1)))}))},e.distance=function(e,o){return r(e,o,((r,i,u)=>{u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,3,e,o);let c=u[0];(t.isArray(u[0])||t.isImmutableArray(u[0]))&&(c=t.autoCastArrayOfPointsToMultiPoint(u[0],e.spatialReference));let l=u[1];if((t.isArray(u[1])||t.isImmutableArray(u[1]))&&(l=t.autoCastArrayOfPointsToMultiPoint(u[1],e.spatialReference)),!(c instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);if(!(l instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return m.distance(c,l,n.convertLinearUnitsToCode(t.defaultUndefined(u[2],-1)))}))},e.distancegeodetic=function(e,o){return r(e,o,((r,i,a)=>{a=t.autoCastFeatureToGeometry(a),t.pcCheck(a,2,3,e,o);const u=a[0],l=a[1];if(!(u instanceof c))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);if(!(l instanceof c))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);const f=new s({paths:[],spatialReference:u.spatialReference});return f.addPath([u,l]),m.geodesicLength(f,n.convertLinearUnitsToCode(t.defaultUndefined(a[2],-1)))}))},e.densify=function(e,o){return r(e,o,((r,u,c)=>{if(c=t.autoCastFeatureToGeometry(c),t.pcCheck(c,2,3,e,o),null===c[0])return null;if(!(c[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);const f=t.toNumber(c[1]);if(isNaN(f))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);if(f<=0)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return c[0]instanceof l||c[0]instanceof s?m.densify(c[0],f,n.convertLinearUnitsToCode(t.defaultUndefined(c[2],-1))):c[0]instanceof i?m.densify(C(c[0]),f,n.convertLinearUnitsToCode(t.defaultUndefined(c[2],-1))):c[0]}))},e.densifygeodetic=function(e,o){return r(e,o,((r,u,c)=>{if(c=t.autoCastFeatureToGeometry(c),t.pcCheck(c,2,3,e,o),null===c[0])return null;if(!(c[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);const f=t.toNumber(c[1]);if(isNaN(f))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);if(f<=0)throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return c[0]instanceof l||c[0]instanceof s?m.geodesicDensify(c[0],f,n.convertLinearUnitsToCode(t.defaultUndefined(c[2],-1))):c[0]instanceof i?m.geodesicDensify(C(c[0]),f,n.convertLinearUnitsToCode(t.defaultUndefined(c[2],-1))):c[0]}))},e.generalize=function(e,o){return r(e,o,((r,i,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,4,e,o),null===u[0])return null;if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);const c=t.toNumber(u[1]);if(isNaN(c))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return m.generalize(u[0],c,t.toBoolean(t.defaultUndefined(u[2],!0)),n.convertLinearUnitsToCode(t.defaultUndefined(u[3],-1)))}))},e.buffer=function(e,o){return r(e,o,((r,i,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,3,e,o),null===u[0])return null;if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);const c=t.toNumber(u[1]);if(isNaN(c))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return 0===c?n.cloneGeometry(u[0]):m.buffer(u[0],c,n.convertLinearUnitsToCode(t.defaultUndefined(u[2],-1)))}))},e.buffergeodetic=function(e,o){return r(e,o,((r,i,u)=>{if(u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,3,e,o),null===u[0])return null;if(!(u[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);const c=t.toNumber(u[1]);if(isNaN(c))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return 0===c?n.cloneGeometry(u[0]):m.geodesicBuffer(u[0],c,n.convertLinearUnitsToCode(t.defaultUndefined(u[2],-1)))}))},e.offset=function(e,o){return r(e,o,((r,i,a)=>{if(a=t.autoCastFeatureToGeometry(a),t.pcCheck(a,2,6,e,o),null===a[0])return null;if(!(a[0]instanceof l||a[0]instanceof s))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);const u=t.toNumber(a[1]);if(isNaN(u))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);const c=t.toNumber(t.defaultUndefined(a[4],10));if(isNaN(c))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);const f=t.toNumber(t.defaultUndefined(a[5],0));if(isNaN(f))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);return m.offset(a[0],u,n.convertLinearUnitsToCode(t.defaultUndefined(a[2],-1)),t.toString(t.defaultUndefined(a[3],"round")).toLowerCase(),c,f)}))},e.rotate=function(e,n){return r(e,n,((r,o,u)=>{u=t.autoCastFeatureToGeometry(u),t.pcCheck(u,2,3,e,n);let s=u[0];if(null===s)return null;if(!(s instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);s instanceof i&&(s=l.fromExtent(s));const f=t.toNumber(u[1]);if(isNaN(f))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);const E=t.defaultUndefined(u[2],null);if(null===E)return m.rotate(s,f);if(E instanceof c)return m.rotate(s,f,E);throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n)}))},e.centroid=function(e,f){return r(e,f,((r,E,m)=>{if(m=t.autoCastFeatureToGeometry(m),t.pcCheck(m,1,1,e,f),null===m[0])return null;let C=m[0];if((t.isArray(m[0])||t.isImmutableArray(m[0]))&&(C=t.autoCastArrayOfPointsToMultiPoint(m[0],e.spatialReference)),null===C)return null;if(!(C instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,f);return C instanceof c?t.fixSpatialReference(n.cloneGeometry(m[0]),e.spatialReference):C instanceof l?C.centroid:C instanceof s?o.centroidPolyline(C):C instanceof u?o.centroidMultiPoint(C):C instanceof i?C.center:null}))},e.multiparttosinglepart=function(e,o){return r(e,o,((r,E,C)=>{C=t.autoCastFeatureToGeometry(C),t.pcCheck(C,1,1,e,o);const h=[];if(null===C[0])return null;if(!(C[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,o);if(C[0]instanceof c)return[t.fixSpatialReference(n.cloneGeometry(C[0]),e.spatialReference)];if(C[0]instanceof i)return[t.fixSpatialReference(n.cloneGeometry(C[0]),e.spatialReference)];const y=m.simplify(C[0]);if(y instanceof l){const e=[],r=[];for(let n=0;n<y.rings.length;n++)if(y.isClockwise(y.rings[n])){const r=f.fromJSON({rings:[y.rings[n]],hasZ:!0===y.hasZ,hasM:!0===y.hasM,spatialReference:y.spatialReference.toJSON()});e.push(r)}else r.push({ring:y.rings[n],pt:y.getPoint(n,0)});for(let n=0;n<r.length;n++)for(let t=0;t<e.length;t++)if(e[t].contains(r[n].pt)){e[t].addRing(r[n].ring);break}return e}if(y instanceof s){const e=[];for(let r=0;r<y.paths.length;r++){const n=f.fromJSON({paths:[y.paths[r]],hasZ:!0===y.hasZ,hasM:!0===y.hasM,spatialReference:y.spatialReference.toJSON()});e.push(n)}return e}if(C[0]instanceof u){const r=t.fixSpatialReference(n.cloneGeometry(C[0]),e.spatialReference);for(let e=0;e<r.points.length;e++)h.push(r.getPoint(e));return h}return null}))},e.issimple=function(e,n){return r(e,n,((r,o,i)=>{if(i=t.autoCastFeatureToGeometry(i),t.pcCheck(i,1,1,e,n),null===i[0])return!0;if(!(i[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);return m.isSimple(i[0])}))},e.simplify=function(e,n){return r(e,n,((r,o,i)=>{if(i=t.autoCastFeatureToGeometry(i),t.pcCheck(i,1,1,e,n),null===i[0])return null;if(!(i[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);return m.simplify(i[0])}))},e.convexhull=function(e,n){return r(e,n,((r,o,i)=>{if(i=t.autoCastFeatureToGeometry(i),t.pcCheck(i,1,1,e,n),null===i[0])return null;if(!(i[0]instanceof a))throw new d.ArcadeExecutionError(e,d.ExecutionErrorCodes.InvalidParameter,n);return m.convexHull(i[0])}))}}e.registerFunctions=x,e.setGeometryEngine=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
