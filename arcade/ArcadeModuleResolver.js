/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","../chunks/_rollupPluginBabelHelpers","../request","../portal/Portal","./parser","./featureset/support/RecentlyUsedCache","./executionError"],(function(e,r,t,o,n,l,u){"use strict";let i=function(){function e(e){this.portalUri=e}var l=e.prototype;return l.normalizeModuleUri=function(r){const t=/^[a-z0-9A-Z]+(@[0-9]+\.[0-9]+\.[0-9]+)?([\?|\/].*)?$/gi,n=/(?<portalurl>.+)\/home\/item\.html\?id\=(?<itemid>.+)$/gi,l=/(?<portalurl>.+)\/sharing\/rest\/content\/users\/[a-zA-Z0-9]+\/items\/(?<itemid>.+)$/gi,i=/(?<portalurl>.+)\/sharing\/rest\/content\/items\/(?<itemid>.+)$/gi,s=/(?<itemid>.*)@(?<versionstring>[0-9]+\.[0-9]+\.[0-9]+)([\?|\/].*)?$/gi;if(r.startsWith("portal+")){let e=r.substring(7),c="",a=e,d=!1;for(const r of[n,i,l]){const t=r.exec(e);if(null!==t){const e=t.groups;a=e.itemid,c=e.portalurl,d=!0;break}}if(!1===d){if(!t.test(e))throw new u.ModuleError(u.ModuleErrorCodes.UnsupportedUriProtocol,{uri:r});a=e,c=this.portalUri}a.includes("/")&&(a=a.split("/")[0]),a.includes("?")&&(a=a.split("?")[0]);let f="current";const p=s.exec(a);if(null!==p){const e=p.groups;a=e.itemid,f=e.versionstring}return e=new o({url:c}).restUrl+"/content/items/"+a+"/resources/"+f+".arc",{url:e,scheme:"portal",uri:"PO:"+e}}if(r.startsWith("mock")){if("mock"===r){return{url:"",scheme:"mock",data:'\n      export var hello = 1;\n      export function helloWorld() {\n          return "Hello World " + hello;\n      }\n  ',uri:"mock"}}const t=r.replace("mock:","");if(void 0!==e.mocks[t])return{url:"",scheme:"mock",data:e.mocks[t],uri:r}}throw new u.ModuleError(u.ModuleErrorCodes.UnrecognisedUri,{uri:r})},l.fetchModule=function(){var t=r._asyncToGenerator((function*(r){const t=e.cachedModules.getFromCache(r.uri);if(t)return t;const o=this.fetchSource(r);e.cachedModules.addToCache(r.uri,o);let n=null;try{n=yield o}catch(l){throw e.cachedModules.removeFromCache(r.uri),l}return n}));function o(e){return t.apply(this,arguments)}return o}(),l.fetchSource=function(){var e=r._asyncToGenerator((function*(e){if("portal"===e.scheme){const r=yield t(e.url,{responseType:"text",query:{}});if(r.data)return n.parseScript(r.data,[])}if("mock"===e.scheme)return n.parseScript(e.data??"",[]);throw new u.ModuleError(u.ModuleErrorCodes.UnsupportedUriProtocol)}));function o(r){return e.apply(this,arguments)}return o}(),e.create=function(r){return new e(r)},e.getDefault=function(){return this._default??(e._default=e._moduleResolverFactory())},r._createClass(e,null,[{key:"moduleResolverClass",set:function(e){this._moduleResolverFactory=e,this._default=null}}]),e}();i.mocks={},i.cachedModules=new l(30),i._default=null,i._moduleResolverFactory=()=>{const e=o.getDefault();return new i(e.url)},e.ArcadeModuleResolver=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
