// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.43/esri/copyright.txt for details.

define(["require","exports","dojo/regexp","../../featureset/support/errorsupport","../../../libs/luxon/luxon"],(function(a,r,e,n,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isStandardized=r.evaluateFunction=r.SqlInterval=void 0;var l=function(){function a(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0,this.millis=0}return a._fixDefaults=function(a){if(null!==a.precision||null!==a.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")},a._parseSecondsComponent=function(a,r){if(r.includes(".")){var e=r.split(".");a.second=parseFloat(e[0]),a.millis=parseInt(e[1],10)}else a.second=parseFloat(r)},a.createFromMilliseconds=function(r){var e=new a;return e.second=r/1e3,e},a.createFromValueAndQualifer=function(r,e,n){var t=new a;if(t.op="-"===n?"-":"+","interval-period"===e.type){a._fixDefaults(e);var l=new RegExp("^[0-9]{1,}$");if("year"===e.period||"month"===e.period)throw new Error("Year-Month Intervals not supported");if("second"===e.period){if(!/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(r))throw new Error("Illegal Interval");a._parseSecondsComponent(t,r)}else{if(!l.test(r))throw new Error("Illegal Interval");t[e.period]=parseFloat(r)}}else{if(a._fixDefaults(e.start),a._fixDefaults(e.end),"year"===e.start.period||"month"===e.start.period)throw new Error("Year-Month Intervals not supported");if("year"===e.end.period||"month"===e.end.period)throw new Error("Year-Month Intervals not supported");switch(e.start.period){case"day":switch(e.end.period){case"hour":if(!new RegExp("^[0-9]{1,} [0-9]{1,}$").test(r))throw new Error("Illegal Interval");t[e.start.period]=parseFloat(r.split(" ")[0]),t[e.end.period]=parseFloat(r.split(" ")[1]);break;case"minute":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$").test(r))throw new Error("Illegal Interval");t[e.start.period]=parseFloat(r.split(" ")[0]);var o=r.split(" ")[1].split(":");t.hour=parseFloat(o[0]),t.minute=parseFloat(o[1]);break;case"second":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(r))throw new Error("Illegal Interval");t[e.start.period]=parseFloat(r.split(" ")[0]);o=r.split(" ")[1].split(":");t.hour=parseFloat(o[0]),t.minute=parseFloat(o[1]),a._parseSecondsComponent(t,o[2]);break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(e.end.period){case"minute":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}$").test(r))throw new Error("Illegal Interval");t.hour=parseFloat(r.split(":")[0]),t.minute=parseFloat(r.split(":")[1]);break;case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(r))throw new Error("Illegal Interval");o=r.split(":");t.hour=parseFloat(o[0]),t.minute=parseFloat(o[1]),a._parseSecondsComponent(t,o[2]);break;default:throw new Error("Invalid Interval.")}break;case"minute":switch(e.end.period){case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(r))throw new Error("Illegal Interval");o=r.split(":");t.minute=parseFloat(o[0]),a._parseSecondsComponent(t,o[1]);break;default:throw new Error("Invalid Interval.")}break;default:throw new Error("Invalid Interval.")}}return t},a.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(this.millis+1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)},a}();function o(a){var r=new Date(a.getTime());return r.setHours(0,0,0,0),r}function s(a,r){if(a instanceof Date)return r?o(a):a;if(function(a){return"string"==typeof a||a instanceof String}(a)){var e=t.DateTime.fromSQL(a);if(e.isValid)return r?o(e.toJSDate()):e.toJSDate()}throw new n.SqlError(n.SqlErrorCodes.CannotCastValue)}r.SqlInterval=l,r.evaluateFunction=function(a,r){var e=u[a.toLowerCase()];if(null==e)throw new Error("Function Not Recognised");if(r.length<e.minParams||r.length>e.maxParams)throw new Error("Invalid Parameter count for call to "+a.toUpperCase());return e.evaluate(r)},r.isStandardized=function(a,r){var e=u[a.toLowerCase()];return null!=e&&r>=e.minParams&&r<=e.maxParams};var u={extract:{minParams:2,maxParams:2,evaluate:function(a){var r=a[0],e=a[1];if(null==e)return null;if(e instanceof Date)switch(r.toUpperCase()){case"SECOND":return e.getSeconds();case"MINUTE":return e.getMinutes();case"HOUR":return e.getHours();case"DAY":return e.getDate();case"MONTH":return e.getMonth()+1;case"YEAR":return e.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var r=a[0],e=a[1];return null==r||null==e?null:r.toString().substring(e-1)}if(3===a.length){r=a[0],e=a[1];var n=a[2];return null==r||null==e||null==n?null:n<=0?"":r.toString().substring(e-1,e+n-1)}}},position:{minParams:2,maxParams:2,evaluate:function(a){var r=a[0],e=a[1];return null==r||null==e?null:e.indexOf(r)+1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var r=3===a.length,n=r?a[1]:" ",t=r?a[2]:a[1];if(null==n||null==t)return null;var l="("+e.escapeString(n)+")";switch(a[0]){case"BOTH":return t.replace(new RegExp("^"+l+"*|"+l+"*$","g"),"");case"LEADING":return t.replace(new RegExp("^"+l+"*","g"),"");case"TRAILING":return t.replace(new RegExp(l+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0]>0?1:a[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var r=a[0],e=2===a.length?Math.pow(10,a[1]):1;return null==r?null:Math.round(r*e)/e}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"==typeof a[0]||a[0]instanceof String?a[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(a){for(var r="",e=0;e<a.length;e++){if(null==a[e])return null;r+=a[e].toString()}return r}},lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}},coalesce:{minParams:1,maxParams:1/0,evaluate:function(a){for(var r=0,e=a;r<e.length;r++){var n=e[r];if(null!==n)return n}return null}},cosh:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cosh(a[0])}},sinh:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sinh(a[0])}},tanh:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tanh(a[0])}},nullif:{minParams:2,maxParams:2,evaluate:function(a){var r=a[0],e=a[1];return(r instanceof Date?r.valueOf():r)===(e instanceof Date?e.valueOf():e)?null:r}},cast:{minParams:2,maxParams:2,evaluate:function(a){var r=a[0],e=a[1];if(null===r)return null;switch(e.type){case"integer":var t=parseInt(r,10);if(isNaN(t))throw new n.SqlError(n.SqlErrorCodes.CannotCastValue);return t;case"smallint":t=parseInt(r,10);if(isNaN(t))throw new n.SqlError(n.SqlErrorCodes.CannotCastValue);if(t>32767||t<-32767)throw new n.SqlError(n.SqlErrorCodes.CannotCastValue);return t;case"float":case"real":t=parseFloat(r);if(isNaN(t))throw new n.SqlError(n.SqlErrorCodes.CannotCastValue);return t;case"date":return s(r,!0);case"timestamp":return s(r,!1);case"varchar":if((t=r.toString()).length>e.size)throw new n.SqlError(n.SqlErrorCodes.CannotCastValue);return t;default:throw new n.SqlError(n.SqlErrorCodes.InvalidDataType)}}}}}));