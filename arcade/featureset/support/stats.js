// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.43/esri/copyright.txt for details.

define(["require","exports","../../polyfill/tsSupport/awaiter","../../polyfill/tsSupport/generator","./errorsupport","./shared","./sqlUtils"],(function(e,t,n,r,i,u,a){"use strict";function s(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length}function c(e){for(var t=s(e),n=0,r=0;r<e.length;r++)n+=Math.pow(t-e[r],2);return n/e.length}function o(e){for(var t=s(e),n=0,r=0;r<e.length;r++)n+=Math.pow(t-e[r],2);return n/(e.length-1)}function l(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function h(e,t,u,a){return void 0===a&&(a=!1),n(this,void 0,void 0,(function(){var n,s,c,o,l;return r(this,(function(r){switch(r.label){case 0:return n=e.iterator(u),s=[],c={ticker:0},[4,n.next()];case 1:o=r.sent(),r.label=2;case 2:if(null===o)return[3,6];if(c.ticker++,u.aborted)throw new i.FeatureSetError(i.FeatureSetErrorCodes.Cancelled);return c.ticker%100!=0?[3,4]:(c.ticker=0,[4,new Promise((function(e){setTimeout(e,0)}))]);case 3:r.sent(),r.label=4;case 4:return null===(l=null==t?void 0:t.calculateValue(o))?!1===a&&(s[s.length]=l):s[s.length]=l,[4,n.next()];case 5:return o=r.sent(),[3,2];case 6:return[2,s]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.distinct=t.count=t.sum=t.stdev=t.variance=t.mean=t.max=t.min=t.calculateStat=t.decodeStatType=void 0,t.decodeStatType=function(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""},t.calculateStat=function(e,t,n){switch(void 0===n&&(n=1e3),e.toLowerCase()){case"distinct":return function(e,t){for(var n=[],r={},i=[],a=0;a<e.length;a++){if(void 0!==e[a]&&null!==e[a]){var s=e[a];if(u.isNumber(s)||u.isString(s))void 0===r[s]&&(n.push(s),r[s]=1);else{for(var c=!1,o=0;o<i.length;o++)!0===u.equalityTest(i[o],s)&&(c=!0);!1===c&&(i.push(s),n.push(s))}}if(n.length>=t&&-1!==t)return n}return n}(t,n);case"avg":case"mean":return s(t);case"min":return Math.min.apply(Math,t);case"sum":return l(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(c(t));case"var":case"variance":return c(t);case"count":return t.length}return 0},t.min=function(e,t,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,h(e,t,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,Math.min.apply(Math,n)]}}))}))},t.max=function(e,t,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,h(e,t,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,Math.max.apply(Math,n)]}}))}))},t.mean=function(e,t,i){return n(this,void 0,void 0,(function(){var n,u,c;return r(this,(function(r){switch(r.label){case 0:return n="",t&&!a.isSingleField(t)&&(n=a.predictType(t,e.fields)),[4,h(e,t,i,!0)];case 1:return 0===(u=r.sent()).length?[2,null]:null===(c=s(u))?[2,c]:"integer"===n?[2,(o=c,o=+o,isFinite(o)?o-o%1||(o<0?-0:0===o?o:0):o)]:[2,c]}var o}))}))},t.variance=function(e,t,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,h(e,t,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,o(n)]}}))}))},t.stdev=function(e,t,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,h(e,t,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,Math.sqrt(o(n))]}}))}))},t.sum=function(e,t,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,h(e,t,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,l(n)]}}))}))},t.count=function(e,t){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,e.iterator(t).count()]}))}))},t.distinct=function(e,t,u,a){return void 0===u&&(u=1e3),void 0===a&&(a=null),n(this,void 0,void 0,(function(){var n,s,c,o,l,h;return r(this,(function(r){switch(r.label){case 0:return n=e.iterator(a),s=[],c={},o={ticker:0},[4,n.next()];case 1:l=r.sent(),r.label=2;case 2:if(null===l)return[3,6];if(o.ticker++,a&&a.aborted)throw new i.FeatureSetError(i.FeatureSetErrorCodes.Cancelled);return o.ticker%100!=0?[3,4]:(o.ticker=0,[4,new Promise((function(e){setTimeout(e,0)}))]);case 3:r.sent(),r.label=4;case 4:return null!=(h=null==t?void 0:t.calculateValue(l))&&void 0===c[h]&&(s.push(h),c[h]=1),s.length>=u&&-1!==u?[2,s]:[4,n.next()];case 5:return l=r.sent(),[3,2];case 6:return[2,s]}}))}))}}));