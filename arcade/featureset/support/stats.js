/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","../../../core/promiseUtils","../../../chunks/languageUtils","./shared","./sqlUtils"],(function(t,e,n,r,u){"use strict";function c(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}function a(t){const e=c(t);let n=0;for(let r=0;r<t.length;r++)n+=Math.pow(e-t[r],2);return n/t.length}function l(t){const e=c(t);let n=0;for(let r=0;r<t.length;r++)n+=Math.pow(e-t[r],2);return n/(t.length-1)}function i(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function s(t,n,r,u=!1){try{const c=t.iterator(r);return e.create(((t,e)=>{o(c,[],n,u,t,e)}))}catch(t){return e.reject(t)}}function o(t,e,r,u,c,a){n.tick(t.next().then((n=>{try{if(null!==n){const l=r.calculateValue(n);return null===l?!1===u&&(e[e.length]=l):e[e.length]=l,o(t,e,r,u,c,a)}c(e)}catch(t){a(t)}}),a))}function h(t,e,n,r,u){return t.next().then((c=>{if(null!==c){const a=r.calculateValue(c);return null!=a&&void 0===e[a]&&(n.push(a),e[a]=1),n.length>=u&&-1!==u?n:h(t,e,n,r,u)}return n}))}t.calculateStat=function(t,e,n=1e3){switch(t.toLowerCase()){case"distinct":return function(t,e){const n=[],u={},c=[];for(let a=0;a<t.length;a++){if(void 0!==t[a]&&null!==t[a]){const e=t[a];if(r.isNumber(e)||r.isString(e))void 0===u[e]&&(n.push(e),u[e]=1);else{let t=!1;for(let n=0;n<c.length;n++)!0===r.equalityTest(c[n],e)&&(t=!0);!1===t&&(c.push(e),n.push(e))}}if(n.length>=e&&-1!==e)return n}return n}(e,n);case"avg":case"mean":return c(e);case"min":return Math.min.apply(Math,e);case"sum":return i(e);case"max":return Math.max.apply(Math,e);case"stdev":case"stddev":return Math.sqrt(a(e));case"var":case"variance":return a(e);case"count":return e.length}return 0},t.count=function(t,n){try{return t.iterator(n).count()}catch(t){return e.reject(t)}},t.decodeStatType=function(t){switch(t.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""},t.distinct=function(t,n,r=1e3,u=null){return function(t,n,r,u){try{return h(t.iterator(u),{},[],n,r)}catch(t){return e.reject(t)}}(t,n,r,u)},t.max=function(t,e,n){return s(t,e,n,!0).then((t=>0===t.length?null:Math.max.apply(Math,t)))},t.mean=function(t,e,n){let r="";return!1===u.isSingleField(e)&&(r=u.predictType(e,t.fields,null)),s(t,e,n,!0).then((t=>{if(0===t.length)return null;const e=c(t);return null===e?e:"integer"===r?(n=+(n=e),isFinite(n)?n-n%1||(n<0?-0:0===n?n:0):n):e;var n}))},t.min=function(t,e,n){return s(t,e,n,!0).then((t=>0===t.length?null:Math.min.apply(Math,t)))},t.stdev=function(t,e,n){return s(t,e,n,!0).then((t=>0===t.length?null:Math.sqrt(l(t))))},t.sum=function(t,e,n){return s(t,e,n,!0).then((t=>0===t.length?null:i(t)))},t.variance=function(t,e,n){return s(t,e,n,!0).then((t=>0===t.length?null:l(t)))},Object.defineProperty(t,"__esModule",{value:!0})}));
