// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.41/esri/copyright.txt for details.

define(["require","exports","../../polyfill/tsSupport/awaiter","../../polyfill/tsSupport/generator","./shared","./sqlUtils"],(function(t,e,n,r,i,u){"use strict";function a(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e/t.length}function c(t){for(var e=a(t),n=0,r=0;r<t.length;r++)n+=Math.pow(e-t[r],2);return n/t.length}function s(t){for(var e=a(t),n=0,r=0;r<t.length;r++)n+=Math.pow(e-t[r],2);return n/(t.length-1)}function l(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function o(t,e,i,u){return void 0===u&&(u=!1),n(this,void 0,void 0,(function(){var n,a,c,s,l;return r(this,(function(r){switch(r.label){case 0:return n=t.iterator(i),a=[],c={ticker:0},[4,n.next()];case 1:s=r.sent(),r.label=2;case 2:if(null===s)return[3,6];if(c.ticker++,i.aborted)throw new Error("Cancelled");return c.ticker%100!=0?[3,4]:(c.ticker=0,[4,new Promise((function(t){setTimeout(t,0)}))]);case 3:r.sent(),r.label=4;case 4:return null===(l=e.calculateValue(s))?!1===u&&(a[a.length]=l):a[a.length]=l,[4,n.next()];case 5:return s=r.sent(),[3,2];case 6:return[2,a]}}))}))}Object.defineProperty(e,"__esModule",{value:!0}),e.distinct=e.count=e.sum=e.stdev=e.variance=e.mean=e.max=e.min=e.calculateStat=e.decodeStatType=void 0,e.decodeStatType=function(t){switch(t.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""},e.calculateStat=function(t,e,n){switch(void 0===n&&(n=1e3),t.toLowerCase()){case"distinct":return function(t,e){for(var n=[],r={},u=[],a=0;a<t.length;a++){if(void 0!==t[a]&&null!==t[a]){var c=t[a];if(i.isNumber(c)||i.isString(c))void 0===r[c]&&(n.push(c),r[c]=1);else{for(var s=!1,l=0;l<u.length;l++)!0===i.equalityTest(u[l],c)&&(s=!0);!1===s&&(u.push(c),n.push(c))}}if(n.length>=e&&-1!==e)return n}return n}(e,n);case"avg":case"mean":return a(e);case"min":return Math.min.apply(Math,e);case"sum":return l(e);case"max":return Math.max.apply(Math,e);case"stdev":case"stddev":return Math.sqrt(c(e));case"var":case"variance":return c(e);case"count":return e.length}return 0},e.min=function(t,e,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,o(t,e,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,Math.min.apply(Math,n)]}}))}))},e.max=function(t,e,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,o(t,e,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,Math.max.apply(Math,n)]}}))}))},e.mean=function(t,e,i){return n(this,void 0,void 0,(function(){var n,c,s;return r(this,(function(r){switch(r.label){case 0:return n="",!1===u.isSingleField(e)&&(n=u.predictType(e,t.fields,null)),[4,o(t,e,i,!0)];case 1:return 0===(c=r.sent()).length?[2,null]:null===(s=a(c))?[2,s]:"integer"===n?[2,(l=s,l=+l,isFinite(l)?l-l%1||(l<0?-0:0===l?l:0):l)]:[2,s]}var l}))}))},e.variance=function(t,e,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,o(t,e,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,s(n)]}}))}))},e.stdev=function(t,e,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,o(t,e,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,Math.sqrt(s(n))]}}))}))},e.sum=function(t,e,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,o(t,e,i,!0)];case 1:return 0===(n=r.sent()).length?[2,null]:[2,l(n)]}}))}))},e.count=function(t,e){return n(this,void 0,void 0,(function(){return r(this,(function(n){return[2,t.iterator(e).count()]}))}))},e.distinct=function(t,e,i,u){return void 0===i&&(i=1e3),void 0===u&&(u=null),n(this,void 0,void 0,(function(){var n,a,c,s,l,o;return r(this,(function(r){switch(r.label){case 0:return n=t.iterator(u),a=[],c={},s={ticker:0},[4,n.next()];case 1:l=r.sent(),r.label=2;case 2:if(null===l)return[3,6];if(s.ticker++,u.aborted)throw new Error("Cancelled");return s.ticker%100!=0?[3,4]:(s.ticker=0,[4,new Promise((function(t){setTimeout(t,0)}))]);case 3:r.sent(),r.label=4;case 4:return null!=(o=e.calculateValue(l))&&void 0===c[o]&&(a.push(o),c[o]=1),a.length>=i&&-1!==i?[2,a]:[4,n.next()];case 5:return l=r.sent(),[3,2];case 6:return[2,a]}}))}))}}));