/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","../../FunctionWrapper","../../../chunks/languageUtils","../../../geometry/Geometry"],(function(e,n,t,r){"use strict";function o(e,n){let t="{";for(let r=0;r<n.properties.length;r++){const o=n.properties[r];t+=("Identifier"===o.key.type?JSON.stringify(o.key.name):M(e,o.key))+":"+M(e,o.value)}return t+="}",t}function a(e,n){let t="{\n";for(let r=0;r<n.body.length;r++)t+=M(e,n.body[r])+" \n";return t+="}\n",t}function s(e,n){if(null===n.argument)return"return;";return"return "+M(e,n.argument)+";\n"}function l(e,n){let t="function "+D(n.id.name,e.globalMangles,{});const r=[];let o={};o={};const a={};for(const s of n.params){const e=A(s.name,a);r.push(e),o[s.name]=1}t+="("+r.join(",")+") ";return t+=M({functions:e.functions,globals:e.globals,symbols:e.symbols,context:e.context,globalMangles:e.globalMangles,localMangles:a,locals:o},n.body),t}function u(e,n){const t=[];for(let r=0;r<n.declarations.length;r++)t.push(M(e,n.declarations[r]));return"var "+t.join(",")+"; "}function i(e,n){const t=null===n.init?null:M(e,n.init),r=A(n.name,e.mangles);return""===t?r:r+" = "+t}function c(){throw new Error("Not Supported")}function f(e,n){return"true"===n.computed?M(e,n.object)+"["+M(e,n.property)+"]":M(e,n.object)+"."+n.property.name}function p(e,n){return"for( "+M(e,n.left)+" in "+M(e,n.right)+") "+M(e,n.body)+"\n"}function m(e,n){let t="for(";return null!==n.init&&(t+=M(e,n.init)),t+=";",null!==n.test?t+=M(e,n.test):t+=" ;",null!==n.update?t+=M(e,n.update):t+=" ;",t+=") ",t+=M(e,n.body)+"\n",t}function g(e,n){return!0===n.prefix?n.operator+M(e,n.argument):M(e,n.argument)+n.operator}function b(e,n){return"if "+M(e,n.test)+" "+M(e,n.consequent)+(null!==n.alternate?"else "+M(e,n.alternate):"")}function y(e,n){return M(e,n.expression)+";"}function d(e,n){return"("+M(e,n.left)+" "+n.operator+" "+M(e,n.right)+")"}function h(e,n){return!0===n.prefix?n.operator+M(e,n.argument):M(e,n.argument)+n.operator}function x(e,n){const t=[];for(let r=0;r<n.elements.length;r++)t.push(M(e,n.elements[r]));return"["+t.join(",")+"]"}function v(e,n){return M(e,n.left)+" "+n.operator+" "+M(e,n.right)}function S(e,n){return M(e,n.left)+" "+n.operator+" "+M(e,n.right)}function E(e,n){let t=M(e,n.callee)+"(";const r=[];for(const o of n.arguments)r.push(M(e,o));return t+=r.join(",")+")",t}function M(e,n){switch(n.type){case"EmptyStatement":return"";case"VariableDeclarator":return i(e,n);case"VariableDeclaration":return u(e,n);case"BlockStatement":return a(e,n);case"FunctionDeclaration":return l(e,n);case"ReturnStatement":return s(e,n);case"IfStatement":return b(e,n);case"ExpressionStatement":return y(e,n);case"AssignmentExpression":return S(e,n);case"UpdateExpression":return g(e,n);case"BreakStatement":return"break;";case"ContinueStatement":return"continue;";case"ForStatement":return m(e,n);case"ForInStatement":return p(e,n);case"Identifier":return k(e,n);case"MemberExpression":return f(e,n);case"Literal":return null===n.value||void 0===n.value?"null":JSON.stringify(n.value);case"ThisExpression":case"ConditionalExpression":case"Array":throw new Error("NOTSUPPORTED");case"CallExpression":return E(e,n);case"UnaryExpression":return h(e,n);case"BinaryExpression":return d(e,n);case"LogicalExpression":return v(e,n);case"ArrayExpression":return x(e,n);case"ObjectExpression":return o(e,n);case"Property":return c();default:throw new Error("UNREOGNISED")}}function k(e,o){const a=o.name.toLowerCase();if(void 0!==e.locals[a])return D(o.name,e.globalMangles,e.localMangles);{const s=e.context.globalScope[a];if(void 0===s)return o.name;if(null!==s){if(s.value instanceof n){return N(s.value,e.functions,e.globals,e.symbols)}if(null==s){const n=w(e.symbols);return e.globals.push({name:n,type:"null",params:{value:null}}),n}if(s instanceof r){const n=w(e.symbols);return e.globals.push({name:n,type:"geometry",params:{value:s}}),n}if(t.isNumber(s)){const n=w(e.symbols);return e.globals.push({name:n,type:"number",params:{value:s}}),n}if(t.isDate(s)){const n=w(e.symbols);return e.globals.push({name:n,type:"date",params:{value:t.toDate(s).getTime()}}),n}if(t.isString(s)){const n=w(e.symbols);return e.globals.push({name:n,type:"string",params:{value:s}}),n}if(t.isFeatureSet(s));else if(t.isImmutableArray(s));else if(!t.isArray(s))throw new Error("Unsupported Type")}}return o.name}function w(e){let n=!1,t="";for(;!1===n;)t="$gi_"+j.toString(),j++,void 0===e.syms[t]&&(n=!0);return t}let j=0;function A(e,n){const t="$$fc_"+j.toString();return j++,n[e]=t,t}function D(e,n,t){return void 0===t[e]?void 0===n[e]?e:n[e]:t[e]}function N(e,n,t,r){const o={functions:n,globals:t,symbols:r,context:e.context,locals:{},globalMangles:{},localMangles:{}},a=e.definition.id.name;if(void 0!==n.lkp[a])return n.lkp[a].mangledname;const s=A(a,o.globalMangles),l={name:a,mangledname:s,script:""};return l.script=M(o,e.definition),n.lkp[l.name]=l,n.stack.push(l),s}e.exportFunctionAsArcade=N,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
