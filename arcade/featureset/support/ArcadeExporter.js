/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
define(["exports","../../FunctionWrapper","../../../chunks/languageUtils","../../../geometry/Geometry"],(function(e,n,t,r){"use strict";function o(e,n){let t="{";for(let r=0;r<n.properties.length;r++){const o=n.properties[r];t+=("Identifier"===o.key.type?JSON.stringify(o.key.name):w(e,o.key))+":"+w(e,o.value)}return t+="}",t}function a(e,n){let t="{\n";for(let r=0;r<n.body.length;r++)t+=w(e,n.body[r])+" \n";return t+="}\n",t}function s(e,n){if(null===n.argument)return"return;";return"return "+w(e,n.argument)+";\n"}function u(e,n){let t="function "+N(n.id.name,e.globalMangles,{});const r=[];let o={};o={};const a={};for(const s of n.params){const e=D(s.name,a);r.push(e),o[s.name]=1}t+="("+r.join(",")+") ";return t+=w({functions:e.functions,globals:e.globals,symbols:e.symbols,context:e.context,globalMangles:e.globalMangles,localMangles:a,locals:o},n.body),t}function l(e,n){const t=[];for(let r=0;r<n.declarations.length;r++)t.push(w(e,n.declarations[r]));return"var "+t.join(",")+"; "}function i(e,n){const t=null===n.init?null:w(e,n.init),r=D(n.name,e.mangles);return""===t?r:r+" = "+t}function c(){throw new Error("Not Supported")}function f(e,n){return"true"===n.computed?w(e,n.object)+"["+w(e,n.property)+"]":w(e,n.object)+"."+n.property.name}function p(e,n){return"for( "+w(e,n.left)+" in "+w(e,n.right)+") "+w(e,n.body)+"\n"}function m(e,n){let t="for(";return null!==n.init&&(t+=w(e,n.init)),t+=";",null!==n.test?t+=w(e,n.test):t+=" ;",null!==n.update?t+=w(e,n.update):t+=" ;",t+=") ",t+=w(e,n.body)+"\n",t}function g(e,n){return!0===n.prefix?n.operator+w(e,n.argument):w(e,n.argument)+n.operator}function y(e,n){return"if "+w(e,n.test)+" "+w(e,n.consequent)+(null!==n.alternate?"else "+w(e,n.alternate):"")}function b(e,n){return w(e,n.expression)+";"}function d(e,n){return"("+w(e,n.left)+" "+n.operator+" "+w(e,n.right)+")"}function h(e,n){return!0===n.prefix?n.operator+w(e,n.argument):w(e,n.argument)+n.operator}function E(e,n){const t=[];for(let r=0;r<n.elements.length;r++)t.push(w(e,n.elements[r]));return"["+t.join(",")+"]"}function x(e,n){return w(e,n.left)+" "+n.operator+" "+w(e,n.right)}function S(e,n){return w(e,n.left)+" "+n.operator+" "+w(e,n.right)}function v(e,n){let t=w(e,n.callee)+"(";const r=[];for(const o of n.arguments)r.push(w(e,o));return t+=r.join(",")+")",t}function w(e,n){switch(n.type){case"EmptyStatement":return"";case"VariableDeclarator":return i(e,n);case"VariableDeclaration":return l(e,n);case"BlockStatement":return a(e,n);case"FunctionDeclaration":return u(e,n);case"ReturnStatement":return s(e,n);case"IfStatement":return y(e,n);case"ExpressionStatement":return b(e,n);case"AssignmentExpression":return S(e,n);case"UpdateExpression":return g(e,n);case"BreakStatement":return"break;";case"ContinueStatement":return"continue;";case"ForStatement":return m(e,n);case"ForInStatement":return p(e,n);case"Identifier":return k(e,n);case"MemberExpression":return f(e,n);case"Literal":return null===n.value||void 0===n.value?"null":JSON.stringify(n.value);case"ThisExpression":throw new Error("NOTSUPPORTED");case"CallExpression":return v(e,n);case"UnaryExpression":return h(e,n);case"BinaryExpression":return d(e,n);case"LogicalExpression":return x(e,n);case"ConditionalExpression":throw new Error("NOTSUPPORTED");case"ArrayExpression":return E(e,n);case"ObjectExpression":return o(e,n);case"Property":return c();case"Array":throw new Error("NOTSUPPORTED");default:throw new Error("UNREOGNISED")}}function k(e,o){const a=o.name.toLowerCase();if(void 0!==e.locals[a])return N(o.name,e.globalMangles,e.localMangles);{const s=e.context.globalScope[a];if(void 0===s)return o.name;if(null!==s){if(s.value instanceof n){return T(s.value,e.functions,e.globals,e.symbols)}if(null==s){const n=M(e.symbols);return e.globals.push({name:n,type:"null",params:{value:null}}),n}if(s instanceof r){const n=M(e.symbols);return e.globals.push({name:n,type:"geometry",params:{value:s}}),n}if(t.isNumber(s)){const n=M(e.symbols);return e.globals.push({name:n,type:"number",params:{value:s}}),n}if(t.isDate(s)){const n=M(e.symbols);return e.globals.push({name:n,type:"date",params:{value:t.toDate(s).getTime()}}),n}if(t.isString(s)){const n=M(e.symbols);return e.globals.push({name:n,type:"string",params:{value:s}}),n}if(t.isFeatureSet(s));else if(t.isImmutableArray(s));else if(!t.isArray(s))throw new Error("Unsupported Type")}}return o.name}function M(e){let n=!1,t="";for(;!1===n;)t="$gi_"+O.toString(),O++,void 0===e.syms[t]&&(n=!0);return t}let O=0;function D(e,n){const t="$$fc_"+O.toString();return O++,n[e]=t,t}function N(e,n,t){return void 0===t[e]?void 0===n[e]?e:n[e]:t[e]}function T(e,n,t,r){const o={functions:n,globals:t,symbols:r,context:e.context,locals:{},globalMangles:{},localMangles:{}},a=e.definition.id.name;if(void 0!==n.lkp[a])return n.lkp[a].mangledname;const s=D(a,o.globalMangles),u={name:a,mangledname:s,script:""};return u.script=w(o,e.definition),n.lkp[u.name]=u,n.stack.push(u),s}e.exportFunctionAsArcade=T,Object.defineProperty(e,"__esModule",{value:!0})}));
