// COPYRIGHT Â© 2018 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.12/esri/copyright.txt for details.

define(["require","exports","../../../core/promiseUtils","../../../geometry/Extent","../../../layers/support/Field"],function(e,t,r,n,o){function i(e){return o.fromJSON(e.toJSON())}function u(e){return e.toJSON()}function l(e){return"string"==typeof e||e instanceof String}function s(e){return"boolean"==typeof e}function a(e){return"number"==typeof e}function c(e){return e instanceof Array}function y(e){return e instanceof Date}function f(e,t){return e===t||!(!y(e)||!y(t))&&e.getTime()===t.getTime()}function p(e){var t={};for(var r in e)t[r]=e[r];return t}function m(e){if(void 0===e)return null;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function v(e){if(null===e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new n({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function d(e){if(void 0===e)return null;if("number"==typeof e)return e;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}function S(e,t){return e===t||("point"===e&&"esriGeometryPoint"===t||("polyline"===e&&"esriGeometryPolyline"===t||("polygon"===e&&"esriGeometryPolygon"===t||("extent"===e&&"esriGeometryEnvelope"===t||("multipoint"===e&&"esriGeometryMultipoint"===t||("point"===t&&"esriGeometryPoint"===e||("polyline"===t&&"esriGeometryPolyline"===e||("polygon"===t&&"esriGeometryPolygon"===e||("extent"===t&&"esriGeometryEnvelope"===e||"multipoint"===t&&"esriGeometryMultipoint"===e)))))))))}function G(e){return function(t){e.reject(t)}}function g(e,t){return function(r){try{e.apply(null,arguments)}catch(e){t.reject(e)}}}function x(e){switch(e){case"point":return"esriGeometryPoint";case"polygon":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";case"polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}}function P(e,t,n){return r.create(function(n,o){var i=r.resolve(!0);e.reduce(function(e,n,o,i){return e.then(function(e){try{return t(e,n,o,i)}catch(e){return r.reject(e)}},function(e){return r.reject(e)})},i).then(n,o)})}function b(e){return void 0===e?"":(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer"),e=e.replace(/\/mapserver\/[0-9]*/i,"/MapServer"),e=e.split("?")[0])}function N(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r="boolean"==typeof t.cycles&&t.cycles,n=t.cmp&&function(e){return function(t){return function(r,n){var o={key:r,value:t[r]},i={key:n,value:t[n]};return e(o,i)}}}(t.cmp),o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var i,u;if(Array.isArray(t)){for(u="[",i=0;i<t.length;i++)i&&(u+=","),u+=e(t[i])||"null";return u+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=o.push(t)-1,s=Object.keys(t).sort(n&&n(t));for(u="",i=0;i<s.length;i++){var a=s[i],c=e(t[a]);c&&(u&&(u+=","),u+=JSON.stringify(a)+":"+c)}return o.splice(l,1),"{"+u+"}"}}(e)}Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"}(t.FeatureServiceDatabaseType||(t.FeatureServiceDatabaseType={})),t.cloneField=i,t.esriFieldToJson=u;!function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(t.IdState||(t.IdState={})),t.isString=l,t.isBoolean=s,t.isNumber=a,t.isArray=c,t.isDate=y,t.equalityTest=f,t.cloneAttributes=p,t.convertSquareUnitsToCode=m,t.shapeExtent=v,t.convertLinearUnitsToCode=d,t.sameGeomType=S,t.defaultMaxRecords=1e3,t.errback=G,t.callback=g,t.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},t.toEsriGeometryType=x,t.reduceArrayWithPromises=P,t.extractServiceUrl=b,t.stableStringify=N});