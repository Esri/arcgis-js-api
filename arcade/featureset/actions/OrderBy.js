/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/languageUtils","../support/errorsupport","../support/FeatureSet","../support/IdSet","../support/OrderbyClause"],(function(e,t,n,r,i,s){"use strict";let u=function(u){function o(e){var t;return(t=u.call(this,e)||this)._orderbyclause=null,t.declaredClass="esri.arcade.featureset.actions.OrderBy",t._maxProcessing=100,t._orderbyclause=e.orderbyclause,t._parent=e.parentfeatureset,t}e._inheritsLoose(o,u);var a=o.prototype;return a._getSet=function(){var t=e._asyncToGenerator((function*(e){if(null===this._wset){yield this._ensureLoaded();const t=yield this._getFilteredSet("",null,null,this._orderbyclause,e);return this._checkCancelled(e),this._wset=t,this._wset}return this._wset}));function n(e){return t.apply(this,arguments)}return n}(),a.manualOrderSet=function(){var t=e._asyncToGenerator((function*(e,t){const n=yield this.getIdColumnDictionary(e,[],-1,t);this._orderbyclause?.order(n);const r=new i([],[],!0,null);for(let i=0;i<n.length;i++)r._known.push(n[i].id);return r}));function n(e,n){return t.apply(this,arguments)}return n}(),a.getIdColumnDictionary=function(){var n=e._asyncToGenerator((function*(e,n,r,i){if(r<e._known.length-1){const s=this._maxQueryRate();if("GETPAGES"===e._known[r+1])return yield t.tick(this._parent._expandPagedSet(e,s,0,0,i)),this.getIdColumnDictionary(e,n,r,i);let u=r+1;const o=[];for(;u<e._known.length&&"GETPAGES"!==e._known[u];)o.push(e._known[u]),u++;r+=o.length;const a=yield t.tick(this._parent._getFeatureBatch(o,i));this._checkCancelled(i);for(const e of a)n.push({id:e.attributes[this.objectIdField],feature:e});return this.getIdColumnDictionary(e,n,r,i)}return e._candidates.length>0?(yield t.tick(this._refineSetBlock(e,this._maxProcessingRate(),i)),this._checkCancelled(i),this.getIdColumnDictionary(e,n,r,i)):n}));function r(e,t,r,i){return n.apply(this,arguments)}return r}(),a._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},a._getFeatures=function(e,t,n,r){return this._parent._getFeatures(e,t,n,r)},a._featureFromCache=function(e){if(void 0===this._featureCache[e]){const t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]},a._fetchAndRefineFeatures=function(){var t=e._asyncToGenerator((function*(){throw new n.FeatureSetError(n.FeatureSetErrorCodes.NeverReach)}));function r(){return t.apply(this,arguments)}return r}(),a._getFilteredSet=function(){var t=e._asyncToGenerator((function*(e,t,n,r,s){yield this._ensureLoaded();const u=yield this._parent._getFilteredSet(e,t,n,null===r?this._orderbyclause:r,s);this._checkCancelled(s);const o=new i(u._candidates.slice(0),u._known.slice(0),u._ordered,this._clonePageDefinition(u.pagesDefinition));let a=!0;if(u._candidates.length>0&&(a=!1),!1===o._ordered){let e=yield this.manualOrderSet(o,s);return!1===a&&(null===t&&null===n||(e=new i(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,this._clonePageDefinition(e.pagesDefinition)))),e}return o}));function n(e,n,r,i,s){return t.apply(this,arguments)}return n}(),o.registerAction=function(){r._featuresetFunctions.orderBy=function(e){return""===e?this:new o({parentfeatureset:this,orderbyclause:new s(e)})}},o}(r);return u}));
