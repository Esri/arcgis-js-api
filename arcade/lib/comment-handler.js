/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.25/esri/copyright.txt for details.
*/
define(["exports","./types"],(function(t,n){"use strict";function e(t,n){return!!n&&(n.loc.end.line===t.loc.start.line&&n.loc.end.column<=t.loc.start.column)}function i(t,n){return t.range[0]>=n.range[0]&&t.range[1]<=n.range[1]}let s=function(){function t(){this.comments=[],this._nodeStack=[],this._newComments=[]}var s=t.prototype;return s.insertInnerComments=function(t){if(!n.isBlockStatement(t)||0!==t.body.length)return;const e=[];for(let n=this._newComments.length-1;n>=0;--n){const i=this._newComments[n];t.range[1]>=i.range[0]&&(e.unshift(i),this._newComments.splice(n,1))}e.length&&(t.innerComments=e)},s.attachTrailingComments=function(t){if(!t)return;const s=this._nodeStack[this._nodeStack.length-1];if(n.isBlockStatement(t)&&i(s,t))for(let n=this._newComments.length-1;n>=0;--n){const e=this._newComments[n];i(e,t)&&(s.trailingComments=[...s.trailingComments??[],e],this._newComments.splice(n,1))}let o=[];if(this._newComments.length>0)for(let n=this._newComments.length-1;n>=0;--n){const i=this._newComments[n];e(i,s)?(s.trailingComments=[...s.trailingComments??[],i],this._newComments.splice(n,1)):e(i,t)&&(o.unshift(i),this._newComments.splice(n,1))}if(s?.trailingComments){e(s.trailingComments[0],t)&&(o=[...o,...s.trailingComments],delete s.trailingComments)}o.length>0&&(t.trailingComments=o)},s.attachLeadingComments=function(t){if(!t)return;let e;for(;this._nodeStack.length>0;){const n=this._nodeStack[this._nodeStack.length-1];if(!(t.range[0]<=n.range[0]))break;e=n,this._nodeStack.pop()}const i=[],s=[];if(e){for(let o=(e.leadingComments?.length??0)-1;o>=0;--o){const m=e.leadingComments[o];t.range[0]>=m.range[1]?(i.unshift(m),e.leadingComments.splice(o,1)):n.isVariableDeclarator(t)&&!n.isBlockComment(m)&&(s.unshift(m),e.leadingComments.splice(o,1))}return 0===e.leadingComments?.length&&delete e.leadingComments,i.length&&(t.leadingComments=i),void(s.length&&(t.trailingComments=[...s,...t.trailingComments??[]]))}for(let n=this._newComments.length-1;n>=0;--n){const e=this._newComments[n];t.range[0]>=e.range[0]&&(i.unshift(e),this._newComments.splice(n,1))}i.length&&(t.leadingComments=i)},s.attachComments=function(t){if(n.isProgram(t)&&t.body.length>0){const n=this._nodeStack[this._nodeStack.length-1];return n?(n.trailingComments=[...n.trailingComments??[],...this._newComments],this._newComments.length=0,void this._nodeStack.pop()):(t.trailingComments=[...this._newComments],void(this._newComments.length=0))}this.attachTrailingComments(t),this.attachLeadingComments(t),this.insertInnerComments(t),this._nodeStack.push(t)},s.collectComment=function(t){this.comments.push(t),this._newComments.push(t)},t}();t.CommentHandler=s,Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
