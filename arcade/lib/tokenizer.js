/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
define(["exports","./error-handler","./scanner","./token"],(function(e,t,n,s){"use strict";let r=function(){function e(){this.values=[],this.curly=this.paren=-1}var t=e.prototype;return t.beforeFunctionExpression=function(e){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(e)>=0},t.isRegexStart=function(){const e=this.values[this.values.length-1];let t=null!==e;switch(e){case"this":case"]":t=!1;break;case")":{const e=this.values[this.paren-1];t="if"===e||"while"===e||"for"===e||"with"===e;break}case"}":if(t=!0,"function"===this.values[this.curly-3]){const e=this.values[this.curly-4];t=!!e&&!this.beforeFunctionExpression(e)}else if("function"===this.values[this.curly-4]){const e=this.values[this.curly-5];t=!e||!this.beforeFunctionExpression(e)}}return t},t.push=function(e){7===e.type||4===e.type?("{"===e.value?this.curly=this.values.length:"("===e.value&&(this.paren=this.values.length),this.values.push(e.value)):this.values.push(null)},e}(),i=function(){function e(e,s){this.errorHandler=new t.ErrorHandler,this.errorHandler.tolerant=!!s&&("boolean"==typeof s.tolerant&&s.tolerant),this.scanner=new n.Scanner(e,this.errorHandler),this.scanner.trackComment=!!s&&("boolean"==typeof s.comment&&s.comment),this.trackRange=!!s&&("boolean"==typeof s.range&&s.range),this.trackLoc=!!s&&("boolean"==typeof s.loc&&s.loc),this.buffer=[],this.reader=new r}var i=e.prototype;return i.errors=function(){return this.errorHandler.errors},i.getNextToken=function(){if(0===this.buffer.length){const e=this.scanner.scanComments();if(this.scanner.trackComment)for(let t=0;t<e.length;++t){const n=e[t],s=this.scanner.source.slice(n.slice[0],n.slice[1]),r={type:n.multiLine?"BlockComment":"LineComment",value:s};this.trackRange&&(r.range=n.range),this.trackLoc&&(r.loc=n.loc),this.buffer.push(r)}if(!this.scanner.eof()){let e;this.trackLoc&&(e={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});let t;if("/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()){const e=this.scanner.saveState();try{t=this.scanner.scanRegExp()}catch(n){this.scanner.restoreState(e),t=this.scanner.lex()}}else t=this.scanner.lex();this.reader.push(t);const n={type:s.TokenName[t.type],value:this.scanner.source.slice(t.start,t.end)};if(this.trackRange&&(n.range=[t.start,t.end]),this.trackLoc&&(e.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},n.loc=e),9===t.type){const e=t.pattern,s=t.flags;n.regex={pattern:e,flags:s}}this.buffer.push(n)}}return this.buffer.shift()},e}();e.Tokenizer=i,Object.defineProperty(e,"__esModule",{value:!0})}));
