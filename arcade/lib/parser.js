// COPYRIGHT Â© 2021 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.39/esri/copyright.txt for details.

define(["require","exports","./assert","./error-handler","./messages","./nodes","./scanner","./syntax","./token"],(function(e,t,i,n,s,r,a,o,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var c=function(){function e(e,t,i){void 0===t&&(t={}),this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant,globalReturn:!!t.globalReturn},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=i,this.errorHandler=new n.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new a.Scanner(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={allowIn:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,curlyParsing:"asObject"},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return e.prototype.tolerateError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var s=t.slice(),r=e.replace(/%(\d)/g,(function(e,t){return i.assert(t<s.length,"Message reference must be in range"),s[t]})),a=this.lastMarker.index,o=this.scanner.lineNumber,h=this.lastMarker.column+1;this.errorHandler.tolerateError(a,o,h,r)},e.prototype.unexpectedTokenError=function(e,t){var i,n=t||s.Messages.UnexpectedToken;if(e?(t||(n=2===e.type?s.Messages.UnexpectedEOS:3===e.type?s.Messages.UnexpectedIdentifier:6===e.type?s.Messages.UnexpectedNumber:8===e.type?s.Messages.UnexpectedString:10===e.type?s.Messages.UnexpectedTemplate:s.Messages.UnexpectedToken),i=e.value.toString()):i="ILLEGAL",n=n.replace("%0",i),e&&"number"==typeof e.lineNumber){var r=e.start,a=e.lineNumber,o=this.lastMarker.index-this.lastMarker.column,h=e.start-o+1;return this.errorHandler.createError(r,a,h,n)}var c=this.lastMarker.index,l=this.lastMarker.line,p=this.lastMarker.column+1;return this.errorHandler.createError(c,l,p,n)},e.prototype.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},e.prototype.tolerateUnexpectedToken=function(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},e.prototype.collectComments=function(){if(this.config.comment){var e=this.scanner.scanComments();if(e&&e.length>0&&this.delegate)for(var t=0;t<e.length;++t){var i=e[t],n=new r.Comment(i.multiLine?"Block":"Line",this.scanner.source.slice(i.slice[0],i.slice[1]));this.config.range&&(n.range=i.range),this.config.loc&&(n.loc=i.loc);var s={start:{line:i.loc.start.line,column:i.loc.start.column,offset:i.range[0]},end:{line:i.loc.end.line,column:i.loc.end.column,offset:i.range[1]}};this.delegate(n,s)}}else this.scanner.scanComments()},e.prototype.peekAhead=function(e){var t=this,i=this.scanner.saveState();e.call(this,(function(){return t.scanner.scanComments(),t.scanner.lex()})),this.scanner.restoreState(i)},e.prototype.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},e.prototype.convertToken=function(e){var t={type:h.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===e.type){var i=e.pattern,n=e.flags;t.regex={pattern:i,flags:n}}return t},e.prototype.nextToken=function(){var e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,this.lookahead=t,this.config.tokens&&2!==t.type&&this.tokens.push(this.convertToken(t)),e},e.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},e.prototype.startNode=function(e,t){void 0===t&&(t=0);var i=e.start-e.lineStart,n=e.lineNumber;return i<0&&(i+=t,n--),{index:e.start,line:n,column:i}},e.prototype.finalize=function(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){var i={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,i)}return t},e.prototype.expect=function(e){var t=this.nextToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var e=this.lookahead;7===e.type&&","===e.value?this.nextToken():7===e.type&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,s.Messages.UnexpectedToken)}else this.expect(",")},e.prototype.expectKeyword=function(e){var t=this.nextToken();4===t.type&&t.value.toString().toLowerCase()===e.toLowerCase()||this.throwUnexpectedToken(t)},e.prototype.match=function(e){return 7===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchKeyword=function(e){return 4===this.lookahead.type&&this.lookahead.value.toLowerCase()===e.toLowerCase()},e.prototype.matchContextualKeyword=function(e){return 3===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var e=this.lookahead.value;return r.AssignmentOperators.includes(e)},e.prototype.isolateCoverGrammar=function(e){var t=this.context.isBindingElement,i=this.context.isAssignmentTarget,n=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var s=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=i,this.context.firstCoverInitializedNameError=n,s},e.prototype.inheritCoverGrammar=function(e){var t=this.context.isBindingElement,i=this.context.isAssignmentTarget,n=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var s=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&i,this.context.firstCoverInitializedNameError=n||this.context.firstCoverInitializedNameError,s},e.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},e.prototype.parsePrimaryExpression=function(){var e,t,i,n=this.createNode();switch(this.lookahead.type){case 3:e=this.finalize(n,new r.Identifier(this.nextToken().value));break;case 6:case 8:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),i=this.getTokenRaw(t),e=this.finalize(n,new r.Literal(t.value,i));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),i=this.getTokenRaw(t),e=this.finalize(n,new r.Literal("true"===t.value.toString().toLowerCase(),i));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),i=this.getTokenRaw(t),e=this.finalize(n,new r.Literal(null,i));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;default:e=this.throwUnexpectedToken(this.nextToken())}break;case 4:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,e=this.throwUnexpectedToken(this.nextToken());break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},e.prototype.parseArrayInitializer=function(){var e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)this.match(",")?(this.nextToken(),t.push(null)):(t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(","));return this.expect("]"),this.finalize(e,new r.ArrayExpression(t))},e.prototype.parseObjectPropertyKey=function(){var e,t=this.createNode(),i=this.nextToken();switch(i.type){case 8:case 6:e=this.finalize(t,new r.Literal(i.value,this.getTokenRaw(i)));break;case 3:case 1:case 5:case 4:e=this.finalize(t,new r.Identifier(i.value));break;default:e=this.throwUnexpectedToken(i)}return e},e.prototype.parseObjectProperty=function(){var e=this.createNode(),t=this.lookahead,i=!1,n=!1,s=null;if(3===t.type){var a=t.value;this.nextToken(),i=this.match("["),s=this.finalize(e,new r.Identifier(a))}else this.match("*")?this.nextToken():(i=this.match("["),s=this.parseObjectPropertyKey());s||this.throwUnexpectedToken(this.lookahead);var o=null;if(this.match(":"))this.nextToken(),o=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(3===t.type){n=!0,o=a=this.finalize(e,new r.Identifier(t.value))}else this.throwUnexpectedToken(this.nextToken());return this.finalize(e,new r.Property("init",s,i,o,!1,n))},e.prototype.parseObjectInitializer=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseObjectProperty()),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new r.ObjectExpression(t))},e.prototype.parseTemplateHead=function(){i.assert(this.lookahead.head,"Template literal must start with a template head");var e=this.createNode(),t=this.nextToken(),n=t.value,s=t.cooked;return this.finalize(e,new r.TemplateElement({raw:n,cooked:s},t.tail))},e.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var e=this.createNode(),t=this.nextToken(),i=t.value,n=t.cooked;return this.finalize(e,new r.TemplateElement({raw:i,cooked:n},t.tail))},e.prototype.parseTemplateLiteral=function(){var e=this.createNode(),t=[],i=[],n=this.parseTemplateHead();for(i.push(n);!n.tail;)t.push(this.parseExpression()),n=this.parseTemplateElement(),i.push(n);return this.finalize(e,new r.TemplateLiteral(i,t))},e.prototype.parseGroupExpression=function(){this.expect("("),this.context.isBindingElement=!0;var e=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.expect(")"),this.context.isBindingElement=!1,e},e.prototype.parseArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.isIdentifierName=function(e){return 3===e.type||4===e.type||1===e.type||5===e.type},e.prototype.parseIdentifierName=function(){var e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new r.Identifier(t.value))},e.prototype.parseLeftHandSideExpressionAllowCall=function(){var e=this.lookahead,t=this.context.allowIn;this.context.allowIn=!0;for(var i=this.inheritCoverGrammar(this.parsePrimaryExpression);;)if(this.match("(")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var n=this.parseArguments();i=this.finalize(this.startNode(e),new r.CallExpression(i,n))}else if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var s=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),i=this.finalize(this.startNode(e),new r.ComputedMemberExpression(i,s))}else{if(!this.match("."))break;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");s=this.parseIdentifierName();i=this.finalize(this.startNode(e),new r.StaticMemberExpression(i,s))}return this.context.allowIn=t,i},e.prototype.parseLeftHandSideExpression=function(){i.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var e=this.startNode(this.lookahead),t=this.inheritCoverGrammar(this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var n=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new r.ComputedMemberExpression(t,n))}else{if(!this.match("."))break;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");n=this.parseIdentifierName();t=this.finalize(e,new r.StaticMemberExpression(t,n))}return t},e.prototype.parseUpdateExpression=function(){var e,t=this.lookahead;if(this.match("++")||this.match("--")){var i=this.startNode(t),n=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.isAssignmentTarget||this.tolerateError(s.Messages.InvalidLHSInAssignment);var a=!0;e=this.finalize(i,new r.UpdateExpression(n.value,e,a)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.isAssignmentTarget||this.tolerateError(s.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var o=this.nextToken().value;a=!1;e=this.finalize(this.startNode(t),new r.UpdateExpression(o,e,a))}return e},e.prototype.parseUnaryExpression=function(){var e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")){var t=this.startNode(this.lookahead),i=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new r.UnaryExpression(i.value,e)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.parseUpdateExpression();return e},e.prototype.binaryPrecedence=function(e){var t=e.value;return 7===e.type?this.operatorPrecedence[t]||0:4===e.type&&this.context.allowIn&&"in"===t?12:0},e.prototype.parseBinaryExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseUnaryExpression),i=this.lookahead,n=this.binaryPrecedence(i);if(n>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var s=[e,this.lookahead],a=t,o=this.inheritCoverGrammar(this.parseUnaryExpression),h=[a,i.value,o],c=[n];!((n=this.binaryPrecedence(this.lookahead))<=0);){for(;h.length>2&&n<=c[c.length-1];){o=h.pop();var l=h.pop();c.pop(),a=h.pop(),s.pop();var p=s[s.length-1],m=this.startNode(p,p.lineStart);h.push(this.finalize(m,new r.BinaryExpression(l,a,o)))}h.push(this.nextToken().value),c.push(n),s.push(this.lookahead),h.push(this.inheritCoverGrammar(this.parseUnaryExpression))}var u=h.length-1;t=h[u];for(var x=s.pop();u>1;){if(!(p=s.pop()))break;var d=x&&x.lineStart;m=this.startNode(p,d),l=h[u-1];t=this.finalize(m,new r.BinaryExpression(l,h[u-2],t)),u-=2,x=p}}return t},e.prototype.parseAssignmentExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.matchAssign()){this.context.isAssignmentTarget||this.tolerateError(s.Messages.InvalidLHSInAssignment),this.match("=")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var i=this.nextToken().value,n=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new r.AssignmentExpression(i,t,n)),this.context.firstCoverInitializedNameError=null}return t},e.prototype.parseExpression=function(){return this.isolateCoverGrammar(this.parseAssignmentExpression)},e.prototype.parseStatementListItem=function(){var e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"function":e=this.parseFunctionDeclaration();break;default:e=this.parseStatement()}else e=this.parseStatement();return e},e.prototype.parseBlock=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new r.BlockStatement(t))},e.prototype.parseObjectStatement=function(){var e=this.createNode(),t=this.parseObjectInitializer();return this.finalize(e,new r.ExpressionStatement(t))},e.prototype.parseBlockOrObjectStatement=function(){var e="asObject"===this.context.curlyParsing;return"asObjectOrBlock"===this.context.curlyParsing&&this.peekAhead((function(t){var i=t();3!==i.type&&8!==i.type||7===(i=t()).type&&":"===i.value&&(e=!0)})),e?this.parseObjectStatement():this.parseBlock()},e.prototype.parseVariableIdentifier=function(){var e=this.createNode(),t=this.nextToken();return 3!==t.type&&this.throwUnexpectedToken(t,s.Messages.IdentiferExpected),this.finalize(e,new r.Identifier(t.value))},e.prototype.parseVariableDeclaration=function(e){var t=this.createNode(),i=this.parseVariableIdentifier(),n=null;return this.match("=")?(this.nextToken(),n=this.isolateCoverGrammar(this.parseAssignmentExpression)):i.type===o.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new r.VariableDeclarator(i,n))},e.prototype.parseVariableDeclarationList=function(e){for(var t=[this.parseVariableDeclaration(e)];this.match(",");)this.nextToken(),t.push(this.parseVariableDeclaration(e));return t},e.prototype.parseVariableStatement=function(){var e=this.createNode();this.expectKeyword("var");var t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new r.VariableDeclaration(t,"var"))},e.prototype.parseEmptyStatement=function(){var e=this.createNode();return this.expect(";"),this.finalize(e,new r.EmptyStatement)},e.prototype.parseExpressionStatement=function(){var e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new r.ExpressionStatement(t))},e.prototype.parseIfClause=function(){var e=this.context.curlyParsing;this.context.curlyParsing="asObjectOrBlock";var t=this.parseStatement();return this.context.curlyParsing=e,t},e.prototype.parseIfStatement=function(){var e,t=this.createNode(),i=null;this.expectKeyword("if"),this.expect("(");var n=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new r.EmptyStatement)):(this.expect(")"),e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),i=this.parseIfClause())),this.finalize(t,new r.IfStatement(n,e,i))},e.prototype.parseForStatement=function(){var e,t=null,i=null,n=null,a=null,h=null,c=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){var l=this.createNode();this.nextToken();var p=this.context.allowIn;this.context.allowIn=!1;var m=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=p,1===m.length&&this.matchKeyword("in"))m[0].init&&this.tolerateError(s.Messages.ForInOfLoopInitializer,"for-in"),a=this.finalize(l,new r.VariableDeclaration(m,"var")),this.nextToken(),h=this.parseExpression();else t=this.finalize(l,new r.VariableDeclaration(m,"var")),this.expect(";")}else{var u=this.context.isBindingElement,x=this.context.isAssignmentTarget,d=this.context.firstCoverInitializedNameError;p=this.context.allowIn;this.context.allowIn=!1,t=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=p,this.matchKeyword("in")?(this.context.isAssignmentTarget&&t.type!==o.Syntax.AssignmentExpression||this.tolerateError(s.Messages.InvalidLHSInForIn),this.nextToken(),a=t,h=this.parseExpression(),t=null):(this.context.isBindingElement=u,this.context.isAssignmentTarget=x,this.context.firstCoverInitializedNameError=d,this.expect(";"))}if(a||(this.match(";")||(i=this.isolateCoverGrammar(this.parseExpression)),this.expect(";"),this.match(")")||(n=this.isolateCoverGrammar(this.parseExpression))),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new r.EmptyStatement);else{this.expect(")");var f=this.context.inIteration,k=this.context.curlyParsing;this.context.inIteration=!0,this.context.curlyParsing="asObjectOrBlock",e=this.isolateCoverGrammar(this.parseStatement),this.context.curlyParsing=k,this.context.inIteration=f}return a&&h?this.finalize(c,new r.ForInStatement(a,h,e)):this.finalize(c,new r.ForStatement(t,i,n,e))},e.prototype.parseContinueStatement=function(){var e=this.createNode();return this.expectKeyword("continue"),this.consumeSemicolon(),this.finalize(e,new r.ContinueStatement)},e.prototype.parseBreakStatement=function(){var e=this.createNode();return this.expectKeyword("break"),this.consumeSemicolon(),this.finalize(e,new r.BreakStatement)},e.prototype.parseReturnStatement=function(){this.config.globalReturn||this.context.inFunctionBody||this.tolerateError(s.Messages.IllegalReturn);var e=this.createNode();this.expectKeyword("return");var t=!this.match(";")&&!this.match("}")&&!this.hasLineTerminator&&2!==this.lookahead.type||8===this.lookahead.type||10===this.lookahead.type?this.parseExpression():null;return this.consumeSemicolon(),this.finalize(e,new r.ReturnStatement(t))},e.prototype.parseStatement=function(){var e;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 3:e=this.parseExpressionStatement();break;case 7:var t=this.lookahead.value;e="{"===t?this.parseBlockOrObjectStatement():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break;case 4:switch(this.lookahead.value.toLowerCase()){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"var":e=this.parseVariableStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},e.prototype.parseFunctionSourceElements=function(){var e=this.createNode();this.expect("{");var t=this.context.inIteration,i=this.context.inFunctionBody;this.context.inIteration=!1,this.context.inFunctionBody=!0;for(var n=[];2!==this.lookahead.type&&!this.match("}");)n.push(this.parseStatementListItem());return this.expect("}"),this.context.inIteration=t,this.context.inFunctionBody=i,this.finalize(e,new r.BlockStatement(n))},e.prototype.parseFormalParameters=function(){var e=[];if(this.expect("("),!this.match(")"))for(;2!==this.lookahead.type&&(e.push(this.parseVariableIdentifier()),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),e},e.prototype.parseFunctionDeclaration=function(){var e=this.createNode();this.expectKeyword("function");var t=this.parseVariableIdentifier(),i=this.parseFormalParameters(),n=this.parseFunctionSourceElements();return this.finalize(e,new r.FunctionDeclaration(t,i,n))},e.prototype.parseScript=function(){for(var e=this.createNode(),t=[];2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new r.Program(t))},e}();t.Parser=c}));