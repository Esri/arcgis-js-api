/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.23/esri/copyright.txt for details.
*/
define(["exports","./assert","./error-handler","./messages","./nodes","./scanner","./syntax","./token"],(function(e,t,n,i,s,r,a,o){"use strict";let h=function(){function e(e,t={},i){this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant,globalReturn:!!t.globalReturn},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=i,this.errorHandler=new n.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new r.Scanner(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:o.TokenType.EOF,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={allowIn:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,curlyParsing:"asObject"},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}var h=e.prototype;return h.tolerateError=function(e,...n){const i=n.slice(),s=e.replace(/%(\d)/g,((e,n)=>(t.assert(n<i.length,"Message reference must be in range"),i[n]))),r=this.lastMarker.index,a=this.scanner.lineNumber,o=this.lastMarker.column+1;this.errorHandler.tolerateError(r,a,o,s)},h.unexpectedTokenError=function(e,t){let n,s=t||i.Messages.UnexpectedToken;if(e?(t||(s=e.type===o.TokenType.EOF?i.Messages.UnexpectedEOS:e.type===o.TokenType.Identifier?i.Messages.UnexpectedIdentifier:e.type===o.TokenType.NumericLiteral?i.Messages.UnexpectedNumber:e.type===o.TokenType.StringLiteral?i.Messages.UnexpectedString:e.type===o.TokenType.Template?i.Messages.UnexpectedTemplate:i.Messages.UnexpectedToken),n=e.value.toString()):n="ILLEGAL",s=s.replace("%0",n),e&&"number"==typeof e.lineNumber){const t=e.start,n=e.lineNumber,i=this.lastMarker.index-this.lastMarker.column,r=e.start-i+1;return this.errorHandler.createError(t,n,r,s)}const r=this.lastMarker.index,a=this.lastMarker.line,h=this.lastMarker.column+1;return this.errorHandler.createError(r,a,h,s)},h.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},h.tolerateUnexpectedToken=function(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},h.collectComments=function(){if(this.config.comment){const e=this.scanner.scanComments();if(e&&e.length>0&&this.delegate)for(let t=0;t<e.length;++t){const n=e[t],i=new s.Comment(n.multiLine?"Block":"Line",this.scanner.source.slice(n.slice[0],n.slice[1]));this.config.range&&(i.range=n.range),this.config.loc&&(i.loc=n.loc);const r={start:{line:n.loc.start.line,column:n.loc.start.column,offset:n.range[0]},end:{line:n.loc.end.line,column:n.loc.end.column,offset:n.range[1]}};this.delegate(i,r)}}else this.scanner.scanComments()},h.peekAhead=function(e){const t=()=>(this.scanner.scanComments(),this.scanner.lex()),n=this.scanner.saveState();e.call(this,t),this.scanner.restoreState(n)},h.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},h.convertToken=function(e){const t={type:o.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),e.type===o.TokenType.RegularExpression){const n=e.pattern,i=e.flags;t.regex={pattern:n,flags:i}}return t},h.nextToken=function(){const e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);const t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,this.lookahead=t,this.config.tokens&&t.type!==o.TokenType.EOF&&this.tokens.push(this.convertToken(t)),e},h.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},h.startNode=function(e,t=0){let n=e.start-e.lineStart,i=e.lineNumber;return n<0&&(n+=t,i--),{index:e.start,line:i,column:n}},h.finalize=function(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){const n={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,n)}return t},h.expect=function(e){const t=this.nextToken();t.type===o.TokenType.Punctuator&&t.value===e||this.throwUnexpectedToken(t)},h.expectCommaSeparator=function(){if(this.config.tolerant){const e=this.lookahead;e.type===o.TokenType.Punctuator&&","===e.value?this.nextToken():e.type===o.TokenType.Punctuator&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,i.Messages.UnexpectedToken)}else this.expect(",")},h.expectKeyword=function(e){const t=this.nextToken();t.type===o.TokenType.Keyword&&t.value.toString().toLowerCase()===e.toLowerCase()||this.throwUnexpectedToken(t)},h.match=function(e){return this.lookahead.type===o.TokenType.Punctuator&&this.lookahead.value===e},h.matchKeyword=function(e){return this.lookahead.type===o.TokenType.Keyword&&this.lookahead.value.toLowerCase()===e.toLowerCase()},h.matchContextualKeyword=function(e){return this.lookahead.type===o.TokenType.Identifier&&this.lookahead.value===e},h.matchAssign=function(){if(this.lookahead.type!==o.TokenType.Punctuator)return!1;const e=this.lookahead.value;return s.AssignmentOperators.includes(e)},h.isolateCoverGrammar=function(e){const t=this.context.isBindingElement,n=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;const s=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=n,this.context.firstCoverInitializedNameError=i,s},h.inheritCoverGrammar=function(e){const t=this.context.isBindingElement,n=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;const s=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&n,this.context.firstCoverInitializedNameError=i||this.context.firstCoverInitializedNameError,s},h.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(this.lookahead.type===o.TokenType.EOF||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},h.parsePrimaryExpression=function(){const e=this.createNode();let t,n,i;switch(this.lookahead.type){case o.TokenType.Identifier:t=this.finalize(e,new s.Identifier(this.nextToken().value));break;case o.TokenType.NumericLiteral:case o.TokenType.StringLiteral:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,n=this.nextToken(),i=this.getTokenRaw(n),t=this.finalize(e,new s.Literal(n.value,i));break;case o.TokenType.BooleanLiteral:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,n=this.nextToken(),i=this.getTokenRaw(n),t=this.finalize(e,new s.Literal("true"===n.value.toString().toLowerCase(),i));break;case o.TokenType.NullLiteral:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,n=this.nextToken(),i=this.getTokenRaw(n),t=this.finalize(e,new s.Literal(null,i));break;case o.TokenType.Template:t=this.parseTemplateLiteral();break;case o.TokenType.Punctuator:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,t=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":t=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":t=this.inheritCoverGrammar(this.parseObjectInitializer);break;default:t=this.throwUnexpectedToken(this.nextToken())}break;case o.TokenType.Keyword:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.throwUnexpectedToken(this.nextToken());break;default:t=this.throwUnexpectedToken(this.nextToken())}return t},h.parseArrayInitializer=function(){const e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)this.match(",")?(this.nextToken(),t.push(null)):(t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(","));return this.expect("]"),this.finalize(e,new s.ArrayExpression(t))},h.parseObjectPropertyKey=function(){const e=this.createNode(),t=this.nextToken();let n;switch(t.type){case o.TokenType.StringLiteral:case o.TokenType.NumericLiteral:n=this.finalize(e,new s.Literal(t.value,this.getTokenRaw(t)));break;case o.TokenType.Identifier:case o.TokenType.BooleanLiteral:case o.TokenType.NullLiteral:case o.TokenType.Keyword:n=this.finalize(e,new s.Identifier(t.value));break;default:n=this.throwUnexpectedToken(t)}return n},h.parseObjectProperty=function(){const e=this.createNode(),t=this.lookahead;let n=!1;const i=!1;let r=!1,a=null;if(t.type===o.TokenType.Identifier){const i=t.value;this.nextToken(),n=this.match("["),a=this.finalize(e,new s.Identifier(i))}else this.match("*")?this.nextToken():(n=this.match("["),a=this.parseObjectPropertyKey());a||this.throwUnexpectedToken(this.lookahead);let h=null;const c="init";if(this.match(":"))this.nextToken(),h=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(t.type===o.TokenType.Identifier){r=!0,h=this.finalize(e,new s.Identifier(t.value))}else this.throwUnexpectedToken(this.nextToken());return this.finalize(e,new s.Property(c,a,n,h,i,r))},h.parseObjectInitializer=function(){const e=this.createNode();this.expect("{");const t=[];for(;!this.match("}");)t.push(this.parseObjectProperty()),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new s.ObjectExpression(t))},h.parseTemplateHead=function(){t.assert(this.lookahead.head,"Template literal must start with a template head");const e=this.createNode(),n=this.nextToken(),i=n.value,r=n.cooked;return this.finalize(e,new s.TemplateElement({raw:i,cooked:r},n.tail))},h.parseTemplateElement=function(){this.lookahead.type!==o.TokenType.Template&&this.throwUnexpectedToken();const e=this.createNode(),t=this.nextToken(),n=t.value,i=t.cooked;return this.finalize(e,new s.TemplateElement({raw:n,cooked:i},t.tail))},h.parseTemplateLiteral=function(){const e=this.createNode(),t=[],n=[];let i=this.parseTemplateHead();for(n.push(i);!i.tail;)t.push(this.parseExpression()),i=this.parseTemplateElement(),n.push(i);return this.finalize(e,new s.TemplateLiteral(n,t))},h.parseGroupExpression=function(){this.expect("("),this.context.isBindingElement=!0;const e=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.expect(")"),this.context.isBindingElement=!1,e},h.parseArguments=function(){this.expect("(");const e=[];if(!this.match(")"))for(;;){const t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},h.isIdentifierName=function(e){return e.type===o.TokenType.Identifier||e.type===o.TokenType.Keyword||e.type===o.TokenType.BooleanLiteral||e.type===o.TokenType.NullLiteral},h.parseIdentifierName=function(){const e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new s.Identifier(t.value))},h.parseLeftHandSideExpressionAllowCall=function(){const e=this.lookahead,t=this.context.allowIn;this.context.allowIn=!0;let n=this.inheritCoverGrammar(this.parsePrimaryExpression);for(;;)if(this.match("(")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;const t=this.parseArguments();n=this.finalize(this.startNode(e),new s.CallExpression(n,t))}else if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");const t=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),n=this.finalize(this.startNode(e),new s.ComputedMemberExpression(n,t))}else{if(!this.match("."))break;{this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");const t=this.parseIdentifierName();n=this.finalize(this.startNode(e),new s.StaticMemberExpression(n,t))}}return this.context.allowIn=t,n},h.parseLeftHandSideExpression=function(){t.assert(this.context.allowIn,"callee of new expression always allow in keyword.");const e=this.startNode(this.lookahead);let n=this.inheritCoverGrammar(this.parsePrimaryExpression);for(;;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");const t=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),n=this.finalize(e,new s.ComputedMemberExpression(n,t))}else{if(!this.match("."))break;{this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");const t=this.parseIdentifierName();n=this.finalize(e,new s.StaticMemberExpression(n,t))}}return n},h.parseUpdateExpression=function(){let e;const t=this.lookahead;if(this.match("++")||this.match("--")){const n=this.startNode(t),r=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.isAssignmentTarget||this.tolerateError(i.Messages.InvalidLHSInAssignment);const a=!0;e=this.finalize(n,new s.UpdateExpression(r.value,e,a)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&this.lookahead.type===o.TokenType.Punctuator&&(this.match("++")||this.match("--"))){this.context.isAssignmentTarget||this.tolerateError(i.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;const n=this.nextToken().value,r=!1;e=this.finalize(this.startNode(t),new s.UpdateExpression(n,e,r))}return e},h.parseUnaryExpression=function(){let e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")){const t=this.startNode(this.lookahead),n=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new s.UnaryExpression(n.value,e)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.parseUpdateExpression();return e},h.binaryPrecedence=function(e){const t=e.value;let n;return n=e.type===o.TokenType.Punctuator?this.operatorPrecedence[t]||0:e.type===o.TokenType.Keyword&&this.context.allowIn&&"in"===t?12:0,n},h.parseBinaryExpression=function(){const e=this.lookahead;let t=this.inheritCoverGrammar(this.parseUnaryExpression);const n=this.lookahead;let i=this.binaryPrecedence(n);if(i>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;const r=[e,this.lookahead];let a=t,o=this.inheritCoverGrammar(this.parseUnaryExpression);const h=[a,n.value,o],c=[i];for(;i=this.binaryPrecedence(this.lookahead),!(i<=0);){for(;h.length>2&&i<=c[c.length-1];){o=h.pop();const e=h.pop();c.pop(),a=h.pop(),r.pop();const t=r[r.length-1],n=this.startNode(t,t.lineStart);h.push(this.finalize(n,new s.BinaryExpression(e,a,o)))}h.push(this.nextToken().value),c.push(i),r.push(this.lookahead),h.push(this.inheritCoverGrammar(this.parseUnaryExpression))}let l=h.length-1;t=h[l];let p=r.pop();for(;l>1;){const e=r.pop();if(!e)break;const n=p&&p.lineStart,i=this.startNode(e,n),a=h[l-1];t=this.finalize(i,new s.BinaryExpression(a,h[l-2],t)),l-=2,p=e}}return t},h.parseAssignmentExpression=function(){const e=this.lookahead;let t=e,n=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.matchAssign()){this.context.isAssignmentTarget||this.tolerateError(i.Messages.InvalidLHSInAssignment),this.match("=")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1),t=this.nextToken();const r=t.value,a=this.isolateCoverGrammar(this.parseAssignmentExpression);n=this.finalize(this.startNode(e),new s.AssignmentExpression(r,n,a)),this.context.firstCoverInitializedNameError=null}return n},h.parseExpression=function(){return this.isolateCoverGrammar(this.parseAssignmentExpression)},h.parseStatementListItem=function(){let e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,this.lookahead.type===o.TokenType.Keyword)if("function"===this.lookahead.value)e=this.parseFunctionDeclaration();else e=this.parseStatement();else e=this.parseStatement();return e},h.parseBlock=function(){const e=this.createNode();this.expect("{");const t=[];for(;!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new s.BlockStatement(t))},h.parseObjectStatement=function(){const e=this.createNode(),t=this.parseObjectInitializer();return this.finalize(e,new s.ExpressionStatement(t))},h.parseBlockOrObjectStatement=function(){let e="asObject"===this.context.curlyParsing;return"asObjectOrBlock"===this.context.curlyParsing&&this.peekAhead((t=>{let n=t();n.type!==o.TokenType.Identifier&&n.type!==o.TokenType.StringLiteral||(n=t(),n.type===o.TokenType.Punctuator&&":"===n.value&&(e=!0))})),e?this.parseObjectStatement():this.parseBlock()},h.parseVariableIdentifier=function(){const e=this.createNode(),t=this.nextToken();return t.type!==o.TokenType.Identifier&&this.throwUnexpectedToken(t,i.Messages.IdentiferExpected),this.finalize(e,new s.Identifier(t.value))},h.parseVariableDeclaration=function(e){const t=this.createNode(),n=this.parseVariableIdentifier();let i=null;return this.match("=")?(this.nextToken(),i=this.isolateCoverGrammar(this.parseAssignmentExpression)):n.type===a.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new s.VariableDeclarator(n,i))},h.parseVariableDeclarationList=function(e){const t=[this.parseVariableDeclaration(e)];for(;this.match(",");)this.nextToken(),t.push(this.parseVariableDeclaration(e));return t},h.parseVariableStatement=function(){const e=this.createNode();this.expectKeyword("var");const t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new s.VariableDeclaration(t,"var"))},h.parseEmptyStatement=function(){const e=this.createNode();return this.expect(";"),this.finalize(e,new s.EmptyStatement)},h.parseExpressionStatement=function(){const e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ExpressionStatement(t))},h.parseIfClause=function(){const e=this.context.curlyParsing;this.context.curlyParsing="asObjectOrBlock";const t=this.parseStatement();return this.context.curlyParsing=e,t},h.parseIfStatement=function(){const e=this.createNode();let t,n=null;this.expectKeyword("if"),this.expect("(");const i=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),t=this.finalize(this.createNode(),new s.EmptyStatement)):(this.expect(")"),t=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),n=this.parseIfClause())),this.finalize(e,new s.IfStatement(i,t,n))},h.parseForStatement=function(){let e=null,t=null,n=null,r=null,o=null;const h=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){const t=this.createNode();this.nextToken();const n=this.context.allowIn;this.context.allowIn=!1;const a=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=n,1===a.length&&this.matchKeyword("in")){a[0].init&&this.tolerateError(i.Messages.ForInOfLoopInitializer,"for-in"),r=this.finalize(t,new s.VariableDeclaration(a,"var")),this.nextToken(),o=this.parseExpression()}else e=this.finalize(t,new s.VariableDeclaration(a,"var")),this.expect(";")}else{const t=this.context.isBindingElement,n=this.context.isAssignmentTarget,s=this.context.firstCoverInitializedNameError,h=this.context.allowIn;this.context.allowIn=!1,e=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=h,this.matchKeyword("in")?(this.context.isAssignmentTarget&&e.type!==a.Syntax.AssignmentExpression||this.tolerateError(i.Messages.InvalidLHSInForIn),this.nextToken(),r=e,o=this.parseExpression(),e=null):(this.context.isBindingElement=t,this.context.isAssignmentTarget=n,this.context.firstCoverInitializedNameError=s,this.expect(";"))}let c;if(r||(this.match(";")||(t=this.isolateCoverGrammar(this.parseExpression)),this.expect(";"),this.match(")")||(n=this.isolateCoverGrammar(this.parseExpression))),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),c=this.finalize(this.createNode(),new s.EmptyStatement);else{this.expect(")");const e=this.context.inIteration,t=this.context.curlyParsing;this.context.inIteration=!0,this.context.curlyParsing="asObjectOrBlock",c=this.isolateCoverGrammar(this.parseStatement),this.context.curlyParsing=t,this.context.inIteration=e}return r&&o?this.finalize(h,new s.ForInStatement(r,o,c)):this.finalize(h,new s.ForStatement(e,t,n,c))},h.parseContinueStatement=function(){const e=this.createNode();return this.expectKeyword("continue"),this.consumeSemicolon(),this.finalize(e,new s.ContinueStatement)},h.parseBreakStatement=function(){const e=this.createNode();return this.expectKeyword("break"),this.consumeSemicolon(),this.finalize(e,new s.BreakStatement)},h.parseReturnStatement=function(){this.config.globalReturn||this.context.inFunctionBody||this.tolerateError(i.Messages.IllegalReturn);const e=this.createNode();this.expectKeyword("return");const t=!this.match(";")&&!this.match("}")&&!this.hasLineTerminator&&this.lookahead.type!==o.TokenType.EOF||this.lookahead.type===o.TokenType.StringLiteral||this.lookahead.type===o.TokenType.Template?this.parseExpression():null;return this.consumeSemicolon(),this.finalize(e,new s.ReturnStatement(t))},h.parseStatement=function(){let e;switch(this.lookahead.type){case o.TokenType.BooleanLiteral:case o.TokenType.NullLiteral:case o.TokenType.NumericLiteral:case o.TokenType.StringLiteral:case o.TokenType.Template:case o.TokenType.Identifier:e=this.parseExpressionStatement();break;case o.TokenType.Punctuator:{const t=this.lookahead.value;e="{"===t?this.parseBlockOrObjectStatement():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break}case o.TokenType.Keyword:switch(this.lookahead.value.toLowerCase()){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"var":e=this.parseVariableStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},h.parseFunctionSourceElements=function(){const e=this.createNode();this.expect("{");const t=this.context.inIteration,n=this.context.inFunctionBody;this.context.inIteration=!1,this.context.inFunctionBody=!0;const i=[];for(;this.lookahead.type!==o.TokenType.EOF&&!this.match("}");)i.push(this.parseStatementListItem());return this.expect("}"),this.context.inIteration=t,this.context.inFunctionBody=n,this.finalize(e,new s.BlockStatement(i))},h.parseFormalParameters=function(){const e=[];if(this.expect("("),!this.match(")"))for(;this.lookahead.type!==o.TokenType.EOF&&(e.push(this.parseVariableIdentifier()),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),e},h.parseFunctionDeclaration=function(){const e=this.createNode();this.expectKeyword("function");const t=this.parseVariableIdentifier(),n=this.parseFormalParameters(),i=this.parseFunctionSourceElements();return this.finalize(e,new s.FunctionDeclaration(t,n,i))},h.parseScript=function(){const e=this.createNode(),t=[];for(;this.lookahead.type!==o.TokenType.EOF;)t.push(this.parseStatementListItem());return this.finalize(e,new s.Program(t))},e}();e.Parser=h,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
