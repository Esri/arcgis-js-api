/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.26/esri/copyright.txt for details.
*/
define(["exports","./comment-handler","./error-handler","./scanner","./types"],(function(t,e,r,n,i){"use strict";var s,a;function o(t,e=0){let r=t.start-t.lineStart,n=t.lineNumber;return r<0&&(r+=e,n--),{index:t.start,line:n,column:r}}function c(t){return[{index:t.range[0],...t.loc.start},{index:t.range[1],...t.loc.end}]}function h(t){return i.OperatorPrecedence[t]??0}!function(t){t[t.None=0]="None",t[t.Function=1]="Function",t[t.IfClause=2]="IfClause",t[t.ForLoop=4]="ForLoop",t[t.WhileLoop=8]="WhileLoop"}(s||(s={})),function(t){t[t.AsObject=0]="AsObject",t[t.Automatic=1]="Automatic"}(a||(a={}));let p=function(){function t(t,o={},c){this.delegate=c,this.hasLineTerminator=!1,this.options={tokens:"boolean"==typeof o.tokens&&o.tokens,comments:"boolean"==typeof o.comments&&o.comments,tolerant:"boolean"==typeof o.tolerant&&o.tolerant},this.options.comments&&(this.commentHandler=new e.CommentHandler),this.errorHandler=new r.ErrorHandler(this.options.tolerant),this.scanner=new n.Scanner(t,this.errorHandler),this.context={isAssignmentTarget:!1,blockContext:s.None,curlyParsingType:a.AsObject},this.rawToken={type:i.TokenType.EOF,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.endMarker={index:0,line:this.scanner.lineNumber,column:0},this.readNextRawToken(),this.endMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}var p=t.prototype;return p.throwIfInvalidType=function(t,e,{validTypes:r,invalidTypes:n}){r?.some((e=>t.type===e))||n?.some((e=>t.type===e))&&this.throwError(i.ParsingErrorCodes.InvalidExpression,e)},p.throwError=function(t,e,r=this.endMarker){const{index:n,line:i,column:s}=e,a=r.index-n-1;this.errorHandler.throwError({code:t,index:n,line:i,column:s+1,len:a})},p.tolerateError=function(t,e){throw new Error("######################################### !!!")},p.unexpectedTokenError=function(t={}){const{rawToken:e}=t;let n,{code:s,data:a}=t;if(e){if(!s)switch(e.type){case i.TokenType.EOF:s=i.ParsingErrorCodes.UnexpectedEndOfScript;break;case i.TokenType.Identifier:s=i.ParsingErrorCodes.UnexpectedIdentifier;break;case i.TokenType.NumericLiteral:s=i.ParsingErrorCodes.UnexpectedNumber;break;case i.TokenType.StringLiteral:s=i.ParsingErrorCodes.UnexpectedString;break;case i.TokenType.Template:s=i.ParsingErrorCodes.UnexpectedTemplate}n=e.value.toString()}else n="ILLEGAL";s=s??i.ParsingErrorCodes.UnexpectedToken,a||(a={value:n});const o=r.formatErrorDescription(s,a);if(e){const t=e.start,r=e.lineNumber,n=e.start-e.lineStart+1;return new i.ParsingError({code:s,index:t,line:r,column:n,len:e.end-e.start-1,data:a,description:o})}const{index:c,line:h}=this.endMarker;return new i.ParsingError({code:s,index:c,line:h,column:this.endMarker.column+1,data:a,description:o})},p.throwUnexpectedToken=function(t={}){throw t.rawToken=t.rawToken??this.rawToken,this.unexpectedTokenError(t)},p.collectComments=function(t){const{commentHandler:e}=this;e&&t.length&&t.forEach((t=>{const r={type:t.multiLine?i.Syntax.BlockComment:i.Syntax.LineComment,value:this.getSourceValue(t),range:t.range,loc:t.loc};e.collectComment(r)}))},p.peekAhead=function(t){const e=()=>(this.scanner.scanComments(),this.scanner.lex()),r=this.scanner.saveState(),n=t.call(this,e);return this.scanner.restoreState(r),n},p.getSourceValue=function(t){return this.scanner.source.slice(t.start,t.end)},p.convertToToken=function(t){return{type:i.TokenNames[t.type],value:this.getSourceValue(t),range:[t.start,t.end],loc:{start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}}},p.readNextRawToken=function(){this.endMarker.index=this.scanner.index,this.endMarker.line=this.scanner.lineNumber,this.endMarker.column=this.scanner.index-this.scanner.lineStart;const t=this.rawToken;this.collectComments(this.scanner.scanComments()),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart),this.rawToken=this.scanner.lex(),this.hasLineTerminator=t.lineNumber!==this.rawToken.lineNumber,this.options.tokens&&this.rawToken.type!==i.TokenType.EOF&&this.tokens.push(this.convertToToken(this.rawToken))},p.captureStartMarker=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},p.getItemLocation=function(t){return{range:[t.index,this.endMarker.index],loc:{start:{line:t.line,column:t.column},end:{line:this.endMarker.line,column:this.endMarker.column}}}},p.finalize=function(t){return(this.delegate||this.commentHandler)&&(this.commentHandler?.attachComments(t),this.delegate?.(t)),t},p.expectPunctuator=function(t){const e=this.rawToken;this.matchPunctuator(t)?this.readNextRawToken():this.throwUnexpectedToken({rawToken:e,code:i.ParsingErrorCodes.PunctuatorExpected,data:{value:t}})},p.expectKeyword=function(t){this.rawToken.type!==i.TokenType.Keyword||this.rawToken.value.toLowerCase()!==t?this.throwUnexpectedToken({rawToken:this.rawToken}):this.readNextRawToken()},p.expectContextualKeyword=function(t){this.rawToken.type!==i.TokenType.Identifier||this.rawToken.value.toLowerCase()!==t?this.throwUnexpectedToken({rawToken:this.rawToken}):this.readNextRawToken()},p.matchKeyword=function(t){return this.rawToken.type===i.TokenType.Keyword&&this.rawToken.value.toLowerCase()===t},p.matchContextualKeyword=function(t){return this.rawToken.type===i.TokenType.Identifier&&this.rawToken.value===t},p.matchPunctuator=function(t){return this.rawToken.type===i.TokenType.Punctuator&&this.rawToken.value===t},p.getMatchingPunctuator=function(t){if("string"==typeof t&&(t=t.split("")),this.rawToken.type===i.TokenType.Punctuator&&t?.length)return t.find(this.matchPunctuator,this)},p.isolateCoverGrammar=function(t){const e=this.context.isAssignmentTarget;this.context.isAssignmentTarget=!0;const r=t.call(this);return this.context.isAssignmentTarget=e,r},p.inheritCoverGrammar=function(t){const e=this.context.isAssignmentTarget;this.context.isAssignmentTarget=!0;const r=t.call(this);return this.context.isAssignmentTarget=this.context.isAssignmentTarget&&e,r},p.withBlockContext=function(t,e){const r=this.context.blockContext;this.context.blockContext=this.context.blockContext|t;const n=this.context.curlyParsingType;this.context.curlyParsingType=a.Automatic;const i=e.call(this);return this.context.blockContext=r,this.context.curlyParsingType=n,i},p.consumeSemicolon=function(){if(this.matchPunctuator(";"))this.readNextRawToken();else if(!this.hasLineTerminator)return this.rawToken.type===i.TokenType.EOF||this.matchPunctuator("}")?(this.endMarker.index=this.startMarker.index,this.endMarker.line=this.startMarker.line,void(this.endMarker.column=this.startMarker.column)):void this.throwUnexpectedToken({rawToken:this.rawToken})},p.parsePrimaryExpression=function(){const t=this.captureStartMarker(),e=this.rawToken;switch(e.type){case i.TokenType.Identifier:return this.readNextRawToken(),this.finalize({type:i.Syntax.Identifier,name:e.value,...this.getItemLocation(t)});case i.TokenType.NumericLiteral:case i.TokenType.StringLiteral:return this.context.isAssignmentTarget=!1,this.readNextRawToken(),this.finalize({type:i.Syntax.Literal,value:e.value,raw:this.getSourceValue(e),isString:"string"==typeof e.value,...this.getItemLocation(t)});case i.TokenType.BooleanLiteral:return this.context.isAssignmentTarget=!1,this.readNextRawToken(),this.finalize({type:i.Syntax.Literal,value:e.value.toLowerCase()===i.Keywords.True,raw:this.getSourceValue(e),isString:!1,...this.getItemLocation(t)});case i.TokenType.NullLiteral:return this.context.isAssignmentTarget=!1,this.readNextRawToken(),this.finalize({type:i.Syntax.Literal,value:null,raw:this.getSourceValue(e),isString:!1,...this.getItemLocation(t)});case i.TokenType.Template:return this.parseTemplateLiteral();case i.TokenType.Punctuator:switch(e.value){case"(":return this.inheritCoverGrammar(this.parseGroupExpression);case"[":return this.inheritCoverGrammar(this.parseArrayInitializer);case"{":return this.inheritCoverGrammar(this.parseObjectExpression);default:return this.throwUnexpectedToken({rawToken:this.rawToken})}case i.TokenType.Keyword:return this.context.isAssignmentTarget=!1,this.throwUnexpectedToken({rawToken:this.rawToken});default:return this.throwUnexpectedToken({rawToken:this.rawToken})}},p.parseArrayInitializer=function(){const t=this.captureStartMarker();this.expectPunctuator("[");const e=[];for(;!this.matchPunctuator("]");){const t=this.captureStartMarker();this.matchPunctuator(",")?(this.readNextRawToken(),this.throwError(i.ParsingErrorCodes.InvalidExpression,t)):(e.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.matchPunctuator("]")||this.expectPunctuator(","))}return this.expectPunctuator("]"),this.finalize({type:i.Syntax.ArrayExpression,elements:e,...this.getItemLocation(t)})},p.parseObjectPropertyKey=function(){const t=this.captureStartMarker(),e=this.rawToken;switch(e.type){case i.TokenType.StringLiteral:return this.readNextRawToken(),this.finalize({type:i.Syntax.Literal,value:e.value,raw:this.getSourceValue(e),isString:!0,...this.getItemLocation(t)});case i.TokenType.Identifier:case i.TokenType.BooleanLiteral:case i.TokenType.NullLiteral:case i.TokenType.Keyword:return this.readNextRawToken(),this.finalize({type:i.Syntax.Identifier,name:e.value,...this.getItemLocation(t)});default:this.throwError(i.ParsingErrorCodes.KeyMustBeString,t)}},p.parseObjectProperty=function(){const t=this.rawToken,e=this.captureStartMarker(),r=this.parseObjectPropertyKey();let n=!1,s=null;return this.matchPunctuator(":")?(this.readNextRawToken(),s=this.inheritCoverGrammar(this.parseAssignmentExpression)):t.type===i.TokenType.Identifier?(n=!0,s=this.finalize({type:i.Syntax.Identifier,name:t.value,...this.getItemLocation(e)})):this.throwUnexpectedToken({rawToken:this.rawToken}),this.finalize({type:i.Syntax.Property,kind:"init",key:r,value:s,shorthand:n,...this.getItemLocation(e)})},p.parseObjectExpression=function(){const t=this.captureStartMarker();this.expectPunctuator("{");const e=[];for(;!this.matchPunctuator("}");)e.push(this.parseObjectProperty()),this.matchPunctuator("}")||this.expectPunctuator(",");return this.expectPunctuator("}"),this.finalize({type:i.Syntax.ObjectExpression,properties:e,...this.getItemLocation(t)})},p.parseTemplateElement=function(t=!1){const e=this.rawToken;e.type!==i.TokenType.Template&&this.throwUnexpectedToken({rawToken:e}),t&&!e.head&&this.throwUnexpectedToken({code:i.ParsingErrorCodes.InvalidTemplateHead,rawToken:e});const r=this.captureStartMarker();this.readNextRawToken();const{value:n,cooked:s,tail:a}=e,o=this.finalize({type:i.Syntax.TemplateElement,value:{raw:n,cooked:s},tail:a,...this.getItemLocation(r)});return o.loc.start.column++,o.loc.end.column=o.loc.end.column-(a?1:2),o},p.parseTemplateLiteral=function(){const t=this.captureStartMarker(),e=[],r=[];let n=this.parseTemplateElement(!0);for(r.push(n);!n.tail;)e.push(this.parseExpression()),n=this.parseTemplateElement(),r.push(n);return this.finalize({type:i.Syntax.TemplateLiteral,quasis:r,expressions:e,...this.getItemLocation(t)})},p.parseGroupExpression=function(){this.expectPunctuator("(");const t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.expectPunctuator(")"),t},p.parseArguments=function(){this.expectPunctuator("(");const t=[];if(!this.matchPunctuator(")"))for(;;){const e=this.isolateCoverGrammar(this.parseAssignmentExpression);if(t.push(e),this.matchPunctuator(")"))break;if(this.expectPunctuator(","),this.matchPunctuator(")"))break}return this.expectPunctuator(")"),t},p.parseMemberName=function(){const t=this.rawToken,e=this.captureStartMarker();return this.readNextRawToken(),t.type!==i.TokenType.NullLiteral&&t.type!==i.TokenType.Identifier&&t.type!==i.TokenType.Keyword&&t.type!==i.TokenType.BooleanLiteral&&this.throwUnexpectedToken({rawToken:t}),this.finalize({type:i.Syntax.Identifier,name:t.value,...this.getItemLocation(e)})},p.parseLeftHandSideExpression=function(){const t=this.captureStartMarker();let e=this.inheritCoverGrammar(this.parsePrimaryExpression);const r=this.captureStartMarker();let n;for(;n=this.getMatchingPunctuator("([.");)switch(n){case"(":{this.context.isAssignmentTarget=!1,e.type!==i.Syntax.Identifier&&e.type!==i.Syntax.MemberExpression&&this.throwError(i.ParsingErrorCodes.IdentiferExpected,t,r);const n=this.parseArguments();e=this.finalize({type:i.Syntax.CallExpression,callee:e,arguments:n,...this.getItemLocation(t)});continue}case"[":{this.context.isAssignmentTarget=!0,this.expectPunctuator("[");const r=this.isolateCoverGrammar(this.parseExpression);this.expectPunctuator("]"),e=this.finalize({type:i.Syntax.MemberExpression,computed:!0,object:e,property:r,...this.getItemLocation(t)});continue}case".":{this.context.isAssignmentTarget=!0,this.expectPunctuator(".");const r=this.parseMemberName();e=this.finalize({type:i.Syntax.MemberExpression,computed:!1,object:e,property:r,...this.getItemLocation(t)});continue}}return e},p.parseUpdateExpression=function(){const t=this.captureStartMarker();let e=this.getMatchingPunctuator(i.UpdateOperators);if(e){this.readNextRawToken();const r=this.captureStartMarker(),n=this.inheritCoverGrammar(this.parseUnaryExpression);return n.type!==i.Syntax.Identifier&&n.type!==i.Syntax.MemberExpression&&n.type!==i.Syntax.CallExpression&&this.throwError(i.ParsingErrorCodes.InvalidExpression,r),this.context.isAssignmentTarget||this.tolerateError(i.ParsingErrorCodes.InvalidLeftHandSideInAssignment,t),this.context.isAssignmentTarget=!1,this.finalize({type:i.Syntax.UpdateExpression,operator:e,argument:n,prefix:!0,...this.getItemLocation(t)})}const r=this.captureStartMarker(),n=this.inheritCoverGrammar(this.parseLeftHandSideExpression),s=this.captureStartMarker();return this.hasLineTerminator?n:(e=this.getMatchingPunctuator(i.UpdateOperators),e?(n.type!==i.Syntax.Identifier&&n.type!==i.Syntax.MemberExpression&&this.throwError(i.ParsingErrorCodes.InvalidExpression,r,s),this.context.isAssignmentTarget||this.tolerateError(i.ParsingErrorCodes.InvalidLeftHandSideInAssignment,t),this.readNextRawToken(),this.context.isAssignmentTarget=!1,this.finalize({type:i.Syntax.UpdateExpression,operator:e,argument:n,prefix:!1,...this.getItemLocation(t)})):n)},p.parseUnaryExpression=function(){const t=this.getMatchingPunctuator(i.UnaryOperators);if(t){const e=this.captureStartMarker();this.readNextRawToken();const r=this.inheritCoverGrammar(this.parseUnaryExpression);return this.context.isAssignmentTarget=!1,this.finalize({type:i.Syntax.UnaryExpression,operator:t,argument:r,prefix:!0,...this.getItemLocation(e)})}return this.parseUpdateExpression()},p.parseBinaryExpression=function(){const t=this.rawToken;let e=this.inheritCoverGrammar(this.parseUnaryExpression);if(this.rawToken.type!==i.TokenType.Punctuator)return e;const r=this.rawToken.value;let n=h(r);if(0===n)return e;this.readNextRawToken(),this.context.isAssignmentTarget=!1;const s=[t,this.rawToken];let a=e,c=this.inheritCoverGrammar(this.parseUnaryExpression);const p=[a,r,c],u=[n];for(;this.rawToken.type===i.TokenType.Punctuator&&(n=h(this.rawToken.value))>0;){for(;p.length>2&&n<=u[u.length-1];){c=p.pop();const t=p.pop();u.pop(),a=p.pop(),s.pop();const e=s[s.length-1],r=o(e,e.lineStart);p.push(this.finalize(this.createBinaryOrLogicalExpression(r,t,a,c)))}p.push(this.rawToken.value),u.push(n),s.push(this.rawToken),this.readNextRawToken(),p.push(this.inheritCoverGrammar(this.parseUnaryExpression))}let l=p.length-1;e=p[l];let m=s.pop();for(;l>1;){const t=s.pop();if(!t)break;const r=m?.lineStart,n=o(t,r),i=p[l-1];e=this.finalize(this.createBinaryOrLogicalExpression(n,i,p[l-2],e)),l-=2,m=t}return e},p.createBinaryOrLogicalExpression=function(t,e,r,n){const s=i.LogicalOperators.includes(e)?i.Syntax.LogicalExpression:i.Syntax.BinaryExpression;return s===i.Syntax.BinaryExpression||(r.type!==i.Syntax.AssignmentExpression&&r.type!==i.Syntax.UpdateExpression||this.throwError(i.ParsingErrorCodes.InvalidExpression,...c(r)),n.type!==i.Syntax.AssignmentExpression&&n.type!==i.Syntax.UpdateExpression||this.throwError(i.ParsingErrorCodes.InvalidExpression,...c(r))),{type:s,operator:e,left:r,right:n,...this.getItemLocation(t)}},p.parseAssignmentExpression=function(){const t=this.captureStartMarker(),e=this.inheritCoverGrammar(this.parseBinaryExpression),r=this.captureStartMarker(),n=this.getMatchingPunctuator(i.AssignmentOperators);if(!n)return e;e.type!==i.Syntax.Identifier&&e.type!==i.Syntax.MemberExpression&&this.throwError(i.ParsingErrorCodes.InvalidExpression,t,r),this.context.isAssignmentTarget||this.tolerateError(i.ParsingErrorCodes.InvalidLeftHandSideInAssignment,t),this.matchPunctuator("=")||(this.context.isAssignmentTarget=!1),this.readNextRawToken();const s=this.isolateCoverGrammar(this.parseAssignmentExpression);return this.finalize({type:i.Syntax.AssignmentExpression,left:e,operator:n,right:s,...this.getItemLocation(t)})},p.parseExpression=function(){return this.isolateCoverGrammar(this.parseAssignmentExpression)},p.parseStatements=function(t){const e=[];for(;this.rawToken.type!==i.TokenType.EOF&&!this.matchPunctuator(t);){const t=this.parseStatementListItem();i.isEmptyStatement(t)||e.push(t)}return e},p.parseStatementListItem=function(){return this.context.isAssignmentTarget=!0,this.matchKeyword(i.Keywords.Function)?this.parseFunctionDeclaration():this.matchKeyword(i.Keywords.Export)?this.parseExportDeclaration():this.matchKeyword(i.Keywords.Import)?this.parseImportDeclaration():this.parseStatement()},p.parseBlock=function(){const t=this.captureStartMarker();this.expectPunctuator("{");const e=this.parseStatements("}");return this.expectPunctuator("}"),this.finalize({type:i.Syntax.BlockStatement,body:e,...this.getItemLocation(t)})},p.parseObjectStatement=function(){const t=this.captureStartMarker(),e=this.parseObjectExpression();return this.finalize({type:i.Syntax.ExpressionStatement,expression:e,...this.getItemLocation(t)})},p.parseBlockOrObjectStatement=function(){if(this.context.curlyParsingType===a.AsObject)return this.parseObjectStatement();return this.peekAhead((t=>{let e=t();return(e.type===i.TokenType.Identifier||e.type===i.TokenType.StringLiteral)&&(e=t(),e.type===i.TokenType.Punctuator&&":"===e.value)}))?this.parseObjectStatement():this.parseBlock()},p.parseIdentifier=function(){const t=this.rawToken;if(t.type!==i.TokenType.Identifier)return null;const e=this.captureStartMarker();return this.readNextRawToken(),this.finalize({type:i.Syntax.Identifier,name:t.value,...this.getItemLocation(e)})},p.parseVariableDeclarator=function(){const t=this.captureStartMarker(),e=this.parseIdentifier();e||this.throwUnexpectedToken({code:i.ParsingErrorCodes.IdentiferExpected});let r=null;if(this.matchPunctuator("=")){this.readNextRawToken();const t=this.rawToken;try{r=this.isolateCoverGrammar(this.parseAssignmentExpression)}catch(n){this.throwUnexpectedToken({rawToken:t,code:i.ParsingErrorCodes.InvalidVariableAssignment})}}return this.finalize({type:i.Syntax.VariableDeclarator,id:e,init:r,...this.getItemLocation(t)})},p.parseVariableDeclarationList=function(){const t=[this.parseVariableDeclarator()];for(;this.matchPunctuator(",");)this.readNextRawToken(),t.push(this.parseVariableDeclarator());return t},p.parseVariableDeclaration=function(){const t=this.captureStartMarker();this.expectKeyword(i.Keywords.Var);const e=this.parseVariableDeclarationList();return this.consumeSemicolon(),this.finalize({type:i.Syntax.VariableDeclaration,declarations:e,kind:"var",...this.getItemLocation(t)})},p.parseEmptyStatement=function(){const t=this.captureStartMarker();return this.expectPunctuator(";"),this.finalize({type:i.Syntax.EmptyStatement,...this.getItemLocation(t)})},p.parseExpressionStatement=function(){const t=this.captureStartMarker(),e=this.parseExpression();return this.consumeSemicolon(),this.finalize({type:i.Syntax.ExpressionStatement,expression:e,...this.getItemLocation(t)})},p.parseIfClause=function(){return this.withBlockContext(s.IfClause,this.parseStatement)},p.parseIfStatement=function(){const t=this.captureStartMarker();this.expectKeyword(i.Keywords.If),this.expectPunctuator("(");const e=this.captureStartMarker(),r=this.parseExpression(),n=this.captureStartMarker();this.expectPunctuator(")"),r.type!==i.Syntax.AssignmentExpression&&r.type!==i.Syntax.UpdateExpression||this.throwError(i.ParsingErrorCodes.InvalidExpression,e,n);const s=this.parseIfClause();let a=null;return this.matchKeyword(i.Keywords.Else)&&(this.readNextRawToken(),a=this.parseIfClause()),this.finalize({type:i.Syntax.IfStatement,test:r,consequent:s,alternate:a,...this.getItemLocation(t)})},p.parseWhileStatement=function(){const t=this.captureStartMarker();this.expectKeyword(i.Keywords.While),this.expectPunctuator("(");const e=this.captureStartMarker(),r=this.parseExpression(),n=this.captureStartMarker();this.expectPunctuator(")"),r.type!==i.Syntax.AssignmentExpression&&r.type!==i.Syntax.UpdateExpression||this.throwError(i.ParsingErrorCodes.InvalidExpression,e,n);const a=this.withBlockContext(s.WhileLoop,this.parseStatement);return this.finalize({type:i.Syntax.WhileStatement,test:r,body:a,...this.getItemLocation(t)})},p.parseForStatement=function(){let t=null,e=null,r=null,n=null,a=null;const o=this.captureStartMarker();if(this.expectKeyword(i.Keywords.For),this.expectPunctuator("("),this.matchPunctuator(";"))this.readNextRawToken();else if(this.matchKeyword(i.Keywords.Var)){const e=this.captureStartMarker();this.readNextRawToken();const r=this.parseVariableDeclarationList();if(1===r.length&&this.matchKeyword(i.Keywords.In)){r[0].init&&this.throwError(i.ParsingErrorCodes.ForInOfLoopInitializer,e),n=this.finalize({type:i.Syntax.VariableDeclaration,declarations:r,kind:"var",...this.getItemLocation(e)}),this.readNextRawToken(),a=this.parseExpression()}else this.matchKeyword(i.Keywords.In)&&this.throwError(i.ParsingErrorCodes.InvalidLeftHandSideInForIn,e),t=this.finalize({type:i.Syntax.VariableDeclaration,declarations:r,kind:"var",...this.getItemLocation(e)}),this.expectPunctuator(";")}else{const e=this.context.isAssignmentTarget,r=this.captureStartMarker();t=this.inheritCoverGrammar(this.parseAssignmentExpression),this.matchKeyword(i.Keywords.In)?(this.context.isAssignmentTarget||this.tolerateError(i.ParsingErrorCodes.InvalidLeftHandSideInForIn,r),t.type!==i.Syntax.Identifier&&this.throwError(i.ParsingErrorCodes.InvalidLeftHandSideInForIn,r),this.readNextRawToken(),n=t,a=this.parseExpression(),t=null):(this.context.isAssignmentTarget=e,this.expectPunctuator(";"))}n||(this.matchPunctuator(";")||(e=this.isolateCoverGrammar(this.parseExpression)),this.expectPunctuator(";"),this.matchPunctuator(")")||(r=this.isolateCoverGrammar(this.parseExpression))),this.expectPunctuator(")");const c=this.withBlockContext(s.ForLoop,(()=>this.isolateCoverGrammar(this.parseStatement)));return n&&a?this.finalize({type:i.Syntax.ForInStatement,left:n,right:a,body:c,...this.getItemLocation(o)}):this.finalize({type:i.Syntax.ForStatement,init:t,test:e,update:r,body:c,...this.getItemLocation(o)})},p.parseContinueStatement=function(){const t=this.captureStartMarker();return this.expectKeyword(i.Keywords.Continue),this.consumeSemicolon(),this.finalize({type:i.Syntax.ContinueStatement,...this.getItemLocation(t)})},p.parseBreakStatement=function(){const t=this.captureStartMarker();return this.expectKeyword(i.Keywords.Break),this.consumeSemicolon(),this.finalize({type:i.Syntax.BreakStatement,...this.getItemLocation(t)})},p.parseReturnStatement=function(){const t=this.captureStartMarker();this.expectKeyword(i.Keywords.Return);const e=!this.matchPunctuator(";")&&!this.matchPunctuator("}")&&!this.hasLineTerminator&&this.rawToken.type!==i.TokenType.EOF||this.rawToken.type===i.TokenType.StringLiteral||this.rawToken.type===i.TokenType.Template?this.parseExpression():null;return this.consumeSemicolon(),this.finalize({type:i.Syntax.ReturnStatement,argument:e,...this.getItemLocation(t)})},p.parseStatement=function(){switch(this.rawToken.type){case i.TokenType.BooleanLiteral:case i.TokenType.NullLiteral:case i.TokenType.NumericLiteral:case i.TokenType.StringLiteral:case i.TokenType.Template:case i.TokenType.Identifier:return this.parseExpressionStatement();case i.TokenType.Punctuator:return"{"===this.rawToken.value?this.parseBlockOrObjectStatement():"("===this.rawToken.value?this.parseExpressionStatement():";"===this.rawToken.value?this.parseEmptyStatement():this.parseExpressionStatement();case i.TokenType.Keyword:switch(this.rawToken.value.toLowerCase()){case i.Keywords.Break:return this.parseBreakStatement();case i.Keywords.Continue:return this.parseContinueStatement();case i.Keywords.For:return this.parseForStatement();case i.Keywords.Function:return this.parseFunctionDeclaration();case i.Keywords.If:return this.parseIfStatement();case i.Keywords.Return:return this.parseReturnStatement();case i.Keywords.Var:return this.parseVariableDeclaration();case i.Keywords.While:return this.parseWhileStatement();default:return this.parseExpressionStatement()}default:return this.throwUnexpectedToken({rawToken:this.rawToken})}},p.parseFormalParameters=function(){const t=[];if(this.expectPunctuator("("),!this.matchPunctuator(")"))for(;this.rawToken.type!==i.TokenType.EOF;){const e=this.parseIdentifier();if(e||this.throwUnexpectedToken({rawToken:this.rawToken,code:i.ParsingErrorCodes.IdentiferExpected}),t.push(e),this.matchPunctuator(")"))break;if(this.expectPunctuator(","),this.matchPunctuator(")"))break}return this.expectPunctuator(")"),t},p.parseFunctionDeclaration=function(){(this.context.blockContext&s.Function)===s.Function&&this.throwUnexpectedToken({code:i.ParsingErrorCodes.NoFunctionInsideFunction}),(this.context.blockContext&s.WhileLoop)!==s.WhileLoop&&(this.context.blockContext&s.IfClause)!==s.IfClause||this.throwUnexpectedToken({code:i.ParsingErrorCodes.NoFunctionInsideBlock});const t=this.captureStartMarker();this.expectKeyword(i.Keywords.Function);const e=this.parseIdentifier();e||this.throwUnexpectedToken({code:i.ParsingErrorCodes.InvalidFunctionIdentifier});const r=this.parseFormalParameters(),n=this.context.blockContext;this.context.blockContext=this.context.blockContext|s.Function;const a=this.parseBlock();return this.context.blockContext=n,this.finalize({type:i.Syntax.FunctionDeclaration,id:e,params:r,body:a,...this.getItemLocation(t)})},p.parseScript=function(){const t=this.captureStartMarker(),e=this.parseStatements(),r=this.finalize({type:i.Syntax.Program,body:e,...this.getItemLocation(t)});return this.options.tokens&&(r.tokens=this.tokens),this.options.tolerant&&(r.errors=this.errorHandler.errors),r},p.parseExportDeclaration=function(){this.context.blockContext!==s.None&&this.throwUnexpectedToken({code:i.ParsingErrorCodes.ModuleExportRootOnly});let t=null;const e=this.captureStartMarker();return this.expectKeyword(i.Keywords.Export),this.matchKeyword(i.Keywords.Var)?t=this.parseVariableDeclaration():this.matchKeyword("function")?t=this.parseFunctionDeclaration():this.throwUnexpectedToken({code:i.ParsingErrorCodes.InvalidExpression}),this.finalize({type:i.Syntax.ExportNamedDeclaration,declaration:t,specifiers:[],source:null,...this.getItemLocation(e)})},p.parseModuleSpecifier=function(){const t=this.captureStartMarker(),e=this.rawToken;if(e.type===i.TokenType.StringLiteral)return this.readNextRawToken(),this.finalize({type:i.Syntax.Literal,value:e.value,raw:this.getSourceValue(e),isString:!0,...this.getItemLocation(t)});this.throwError(i.ParsingErrorCodes.InvalidModuleUri,t)},p.parseDefaultSpecifier=function(){const t=this.captureStartMarker(),e=this.parseIdentifier();return e||this.throwUnexpectedToken({code:i.ParsingErrorCodes.IdentiferExpected}),this.finalize({type:i.Syntax.ImportDefaultSpecifier,local:e,...this.getItemLocation(t)})},p.parseImportDeclaration=function(){this.context.blockContext!==s.None&&this.throwUnexpectedToken({code:i.ParsingErrorCodes.ModuleImportRootOnly});const t=this.captureStartMarker();this.expectKeyword(i.Keywords.Import);const e=this.parseDefaultSpecifier();this.expectContextualKeyword(i.Keywords.From);const r=this.parseModuleSpecifier();return this.finalize({type:i.Syntax.ImportDeclaration,specifiers:[e],source:r,...this.getItemLocation(t)})},t}();t.Parser=p,t.binaryOperatorPrecedence=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
