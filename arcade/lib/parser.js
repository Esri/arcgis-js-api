/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.20/esri/copyright.txt for details.
*/
define(["exports","./assert","./error-handler","./messages","./nodes","./scanner","./syntax","./token"],(function(t,e,s,i,n,r,a,o){"use strict";const h="ArrowParameterPlaceHolder";let c=function(){function t(t,e={},i){this.config={range:"boolean"==typeof e.range&&e.range,loc:"boolean"==typeof e.loc&&e.loc,source:null,tokens:"boolean"==typeof e.tokens&&e.tokens,comment:"boolean"==typeof e.comment&&e.comment,tolerant:"boolean"==typeof e.tolerant&&e.tolerant},this.config.loc&&e.source&&null!==e.source&&(this.config.source=String(e.source)),this.delegate=i,this.errorHandler=new s.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new r.Scanner(t,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,allowIn:!0,allowStrictDirective:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}var c=t.prototype;return c.throwError=function(t,...s){const i=s.slice(),n=t.replace(/%(\d)/g,((t,s)=>(e.assert(s<i.length,"Message reference must be in range"),i[s]))),r=this.lastMarker.index,a=this.lastMarker.line,o=this.lastMarker.column+1;throw this.errorHandler.createError(r,a,o,n)},c.tolerateError=function(t,...s){const i=s.slice(),n=t.replace(/%(\d)/g,((t,s)=>(e.assert(s<i.length,"Message reference must be in range"),i[s]))),r=this.lastMarker.index,a=this.scanner.lineNumber,o=this.lastMarker.column+1;this.errorHandler.tolerateError(r,a,o,n)},c.unexpectedTokenError=function(t,e){let s,n=e||i.Messages.UnexpectedToken;if(t?(e||(n=2===t.type?i.Messages.UnexpectedEOS:3===t.type?i.Messages.UnexpectedIdentifier:6===t.type?i.Messages.UnexpectedNumber:8===t.type?i.Messages.UnexpectedString:10===t.type?i.Messages.UnexpectedTemplate:i.Messages.UnexpectedToken,4===t.type&&(this.scanner.isFutureReservedWord(t.value)?n=i.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(t.value)&&(n=i.Messages.StrictReservedWord))),s=t.value):s="ILLEGAL",n=n.replace("%0",s),t&&"number"==typeof t.lineNumber){const e=t.start,s=t.lineNumber,i=this.lastMarker.index-this.lastMarker.column,r=t.start-i+1;return this.errorHandler.createError(e,s,r,n)}{const t=this.lastMarker.index,e=this.lastMarker.line,s=this.lastMarker.column+1;return this.errorHandler.createError(t,e,s,n)}},c.throwUnexpectedToken=function(t,e){throw this.unexpectedTokenError(t,e)},c.tolerateUnexpectedToken=function(t,e){this.errorHandler.tolerate(this.unexpectedTokenError(t,e))},c.collectComments=function(){if(this.config.comment){const t=this.scanner.scanComments();if(t.length>0&&this.delegate)for(let e=0;e<t.length;++e){const s=t[e],i={type:s.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(s.slice[0],s.slice[1])};this.config.range&&(i.range=s.range),this.config.loc&&(i.loc=s.loc);const n={start:{line:s.loc.start.line,column:s.loc.start.column,offset:s.range[0]},end:{line:s.loc.end.line,column:s.loc.end.column,offset:s.range[1]}};this.delegate(i,n)}}else this.scanner.scanComments()},c.getTokenRaw=function(t){return this.scanner.source.slice(t.start,t.end)},c.convertToken=function(t){const e={type:o.TokenName[t.type],value:this.getTokenRaw(t)};if(this.config.range&&(e.range=[t.start,t.end]),this.config.loc&&(e.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===t.type){const s=t.pattern,i=t.flags;e.regex={pattern:s,flags:i}}return e},c.nextToken=function(){const t=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);const e=this.scanner.lex();return this.hasLineTerminator=t.lineNumber!==e.lineNumber,e&&this.context.strict&&3===e.type&&this.scanner.isStrictModeReservedWord(e.value)&&(e.type=4),this.lookahead=e,this.config.tokens&&2!==e.type&&this.tokens.push(this.convertToken(e)),t},c.nextRegexToken=function(){this.collectComments();const t=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(t))),this.lookahead=t,this.nextToken(),t},c.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},c.startNode=function(t,e=0){let s=t.start-t.lineStart,i=t.lineNumber;return s<0&&(s+=e,i--),{index:t.start,line:i,column:s}},c.finalize=function(t,e){if(this.config.range&&(e.range=[t.index,this.lastMarker.index]),this.config.loc&&(e.loc={start:{line:t.line,column:t.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(e.loc.source=this.config.source)),this.delegate){const s={start:{line:t.line,column:t.column,offset:t.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(e,s)}return e},c.expect=function(t){const e=this.nextToken();7===e.type&&e.value===t||this.throwUnexpectedToken(e)},c.expectCommaSeparator=function(){if(this.config.tolerant){const t=this.lookahead;7===t.type&&","===t.value?this.nextToken():7===t.type&&";"===t.value?(this.nextToken(),this.tolerateUnexpectedToken(t)):this.tolerateUnexpectedToken(t,i.Messages.UnexpectedToken)}else this.expect(",")},c.expectKeyword=function(t){const e=this.nextToken();4===e.type&&e.value.toLowerCase()===t.toLowerCase()||this.throwUnexpectedToken(e)},c.match=function(t){return 7===this.lookahead.type&&this.lookahead.value===t},c.matchKeyword=function(t){return 4===this.lookahead.type&&this.lookahead.value.toLowerCase()===t.toLowerCase()},c.matchContextualKeyword=function(t){return 3===this.lookahead.type&&this.lookahead.value===t},c.matchAssign=function(){if(7!==this.lookahead.type)return!1;const t=this.lookahead.value;return"="===t||"*="===t||"**="===t||"/="===t||"%="===t||"+="===t||"-="===t||"<<="===t||">>="===t||">>>="===t||"&="===t||"^="===t||"|="===t},c.isolateCoverGrammar=function(t){const e=this.context.isBindingElement,s=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;const n=t.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=e,this.context.isAssignmentTarget=s,this.context.firstCoverInitializedNameError=i,n},c.inheritCoverGrammar=function(t){const e=this.context.isBindingElement,s=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;const n=t.call(this);return this.context.isBindingElement=this.context.isBindingElement&&e,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&s,this.context.firstCoverInitializedNameError=i||this.context.firstCoverInitializedNameError,n},c.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},c.parsePrimaryExpression=function(){const t=this.createNode();let e,s,r;switch(this.lookahead.type){case 3:e=this.finalize(t,new n.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,i.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,s=this.nextToken(),r=this.getTokenRaw(s),e=this.finalize(t,new n.Literal(s.value,r));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,s=this.nextToken(),r=this.getTokenRaw(s),e=this.finalize(t,new n.Literal("true"===s.value.toLowerCase(),r));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,s=this.nextToken(),r=this.getTokenRaw(s),e=this.finalize(t,new n.Literal(null,r));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;default:e=this.throwUnexpectedToken(this.nextToken())}break;case 4:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,e=this.matchKeyword("function")?this.parseFunctionExpression():this.throwUnexpectedToken(this.nextToken());break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},c.parseArrayInitializer=function(){const t=this.createNode(),e=[];for(this.expect("[");!this.match("]");)this.match(",")?(this.nextToken(),e.push(null)):(e.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(","));return this.expect("]"),this.finalize(t,new n.ArrayExpression(e))},c.parsePropertyMethod=function(t){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;const e=this.context.strict,s=this.context.allowStrictDirective;this.context.allowStrictDirective=t.simple;const i=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&t.firstRestricted&&this.tolerateUnexpectedToken(t.firstRestricted,t.message),this.context.strict&&t.stricted&&this.tolerateUnexpectedToken(t.stricted,t.message),this.context.strict=e,this.context.allowStrictDirective=s,i},c.parsePropertyMethodFunction=function(){const t=!1,e=this.createNode(),s=this.parseFormalParameters(),i=this.parsePropertyMethod(s);return this.finalize(e,new n.FunctionExpression(null,s.params,i,t))},c.parseObjectPropertyKey=function(){const t=this.createNode(),e=this.nextToken();let s;switch(e.type){case 8:case 6:{this.context.strict&&e.octal&&this.tolerateUnexpectedToken(e,i.Messages.StrictOctalLiteral);const r=this.getTokenRaw(e);s=this.finalize(t,new n.Literal(e.value,r));break}case 3:case 1:case 5:case 4:s=this.finalize(t,new n.Identifier(e.value));break;case 7:"["===e.value?(s=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):s=this.throwUnexpectedToken(e);break;default:s=this.throwUnexpectedToken(e)}return s},c.isPropertyKey=function(t,e){return t.type===a.Syntax.Identifier&&t.name===e||t.type===a.Syntax.Literal&&t.value===e},c.parseObjectProperty=function(t){const e=this.createNode(),s=this.lookahead;let r,a=null,o=null,h=!1,c=!1,l=!1,p=!1;if(3===s.type){const t=s.value;this.nextToken(),h=this.match("["),p=!(this.hasLineTerminator||"async"!==t||this.match(":")||this.match("(")||this.match("*")||this.match(",")),a=p?this.parseObjectPropertyKey():this.finalize(e,new n.Identifier(t))}else this.match("*")?this.nextToken():(h=this.match("["),a=this.parseObjectPropertyKey());if(a||this.throwUnexpectedToken(this.lookahead),r="init",this.match(":")&&!p)!h&&this.isPropertyKey(a,"__proto__")&&(t.value&&this.tolerateError(i.Messages.DuplicateProtoProperty),t.value=!0),this.nextToken(),o=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))o=this.parsePropertyMethodFunction(),c=!0;else if(3===s.type){const t=this.finalize(e,new n.Identifier(s.value));if(this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),l=!0;const s=this.isolateCoverGrammar(this.parseAssignmentExpression);o=this.finalize(e,new n.AssignmentPattern(t,s))}else l=!0,o=t}else this.throwUnexpectedToken(this.nextToken());return this.finalize(e,new n.Property(r,a,h,o,c,l))},c.parseObjectInitializer=function(){const t=this.createNode();this.expect("{");const e=[],s={value:!1};for(;!this.match("}");)e.push(this.parseObjectProperty(s)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(t,new n.ObjectExpression(e))},c.parseTemplateHead=function(){e.assert(this.lookahead.head,"Template literal must start with a template head");const t=this.createNode(),s=this.nextToken(),i=s.value,r=s.cooked;return this.finalize(t,new n.TemplateElement({raw:i,cooked:r},s.tail))},c.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();const t=this.createNode(),e=this.nextToken(),s=e.value,i=e.cooked;return this.finalize(t,new n.TemplateElement({raw:s,cooked:i},e.tail))},c.parseTemplateLiteral=function(){const t=this.createNode(),e=[],s=[];let i=this.parseTemplateHead();for(s.push(i);!i.tail;)e.push(this.parseExpression()),i=this.parseTemplateElement(),s.push(i);return this.finalize(t,new n.TemplateLiteral(s,e))},c.reinterpretExpressionAsPattern=function(t){switch(t.type){case a.Syntax.Identifier:case a.Syntax.MemberExpression:case a.Syntax.AssignmentPattern:break;case a.Syntax.ArrayExpression:t.type=a.Syntax.ArrayPattern;for(let e=0;e<t.elements.length;e++)null!==t.elements[e]&&this.reinterpretExpressionAsPattern(t.elements[e]);break;case a.Syntax.ObjectExpression:t.type=a.Syntax.ObjectPattern;for(let e=0;e<t.properties.length;e++){const s=t.properties[e];this.reinterpretExpressionAsPattern(s.value)}break;case a.Syntax.AssignmentExpression:t.type=a.Syntax.AssignmentPattern,delete t.operator,this.reinterpretExpressionAsPattern(t.left)}},c.parseGroupExpression=function(){let t;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),t={type:h,params:[],async:!1};else{const e=this.lookahead;let s=!1;if(this.context.isBindingElement=!0,t=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){const i=[];for(this.context.isAssignmentTarget=!1,i.push(t);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(let t=0;t<i.length;t++)this.reinterpretExpressionAsPattern(i[t]);s=!0,t={type:h,params:i,async:!1}}else i.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(s)break}s||(t=this.finalize(this.startNode(e),new n.SequenceExpression(i)))}if(!s){if(this.expect(")"),this.match("=>")&&(t.type===a.Syntax.Identifier&&"yield"===t.name&&(s=!0,t={type:h,params:[t],async:!1}),!s)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),t.type===a.Syntax.SequenceExpression)for(let s=0;s<t.expressions.length;s++)this.reinterpretExpressionAsPattern(t.expressions[s]);else this.reinterpretExpressionAsPattern(t);const e=t.type===a.Syntax.SequenceExpression?t.expressions:[t];t={type:h,params:e,async:!1}}this.context.isBindingElement=!1}}return t},c.parseArguments=function(){this.expect("(");const t=[];if(!this.match(")"))for(;;){const e=this.isolateCoverGrammar(this.parseAssignmentExpression);if(t.push(e),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),t},c.isIdentifierName=function(t){return 3===t.type||4===t.type||1===t.type||5===t.type},c.parseIdentifierName=function(){const t=this.createNode(),e=this.nextToken();return this.isIdentifierName(e)||this.throwUnexpectedToken(e),this.finalize(t,new n.Identifier(e.value))},c.parseLeftHandSideExpressionAllowCall=function(){const t=this.lookahead,e=this.context.allowIn;let s;for(this.context.allowIn=!0,s=this.inheritCoverGrammar(this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");const e=this.parseIdentifierName();s=this.finalize(this.startNode(t),new n.StaticMemberExpression(s,e))}else if(this.match("(")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;const e=this.parseArguments();s=this.finalize(this.startNode(t),new n.CallExpression(s,e))}else{if(!this.match("["))break;{this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");const e=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),s=this.finalize(this.startNode(t),new n.ComputedMemberExpression(s,e))}}return this.context.allowIn=e,s},c.parseLeftHandSideExpression=function(){e.assert(this.context.allowIn,"callee of new expression always allow in keyword.");const t=this.startNode(this.lookahead);let s=this.inheritCoverGrammar(this.parsePrimaryExpression);for(;;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");const e=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),s=this.finalize(t,new n.ComputedMemberExpression(s,e))}else{if(!this.match("."))break;{this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");const e=this.parseIdentifierName();s=this.finalize(t,new n.StaticMemberExpression(s,e))}}return s},c.parseUpdateExpression=function(){let t;const e=this.lookahead;if(this.match("++")||this.match("--")){const s=this.startNode(e),r=this.nextToken();t=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&t.type===a.Syntax.Identifier&&this.scanner.isRestrictedWord(t.name)&&this.tolerateError(i.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(i.Messages.InvalidLHSInAssignment);const o=!0;t=this.finalize(s,new n.UpdateExpression(r.value,t,o)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(t=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&t.type===a.Syntax.Identifier&&this.scanner.isRestrictedWord(t.name)&&this.tolerateError(i.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(i.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;const s=this.nextToken().value,r=!1;t=this.finalize(this.startNode(e),new n.UpdateExpression(s,t,r))}return t},c.parseUnaryExpression=function(){let t;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){const e=this.startNode(this.lookahead),s=this.nextToken();t=this.inheritCoverGrammar(this.parseUnaryExpression),t=this.finalize(e,new n.UnaryExpression(s.value,t)),this.context.strict&&"delete"===t.operator&&t.argument.type===a.Syntax.Identifier&&this.tolerateError(i.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else t=this.parseUpdateExpression();return t},c.parseExponentiationExpression=function(){const t=this.lookahead;let e=this.inheritCoverGrammar(this.parseUnaryExpression);if(e.type!==a.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;const s=e,i=this.isolateCoverGrammar(this.parseExponentiationExpression);e=this.finalize(this.startNode(t),new n.BinaryExpression("**",s,i))}return e},c.binaryPrecedence=function(t){const e=t.value;let s;return s=7===t.type?this.operatorPrecedence[e]||0:4===t.type&&("instanceof"===e||this.context.allowIn&&"in"===e)?7:0,s},c.parseBinaryExpression=function(){const t=this.lookahead;let e=this.inheritCoverGrammar(this.parseExponentiationExpression);const s=this.lookahead;let i=this.binaryPrecedence(s);if(i>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;const r=[t,this.lookahead];let a=e,o=this.isolateCoverGrammar(this.parseExponentiationExpression);const h=[a,s.value,o],c=[i];for(;i=this.binaryPrecedence(this.lookahead),!(i<=0);){for(;h.length>2&&i<=c[c.length-1];){o=h.pop();const t=h.pop();c.pop(),a=h.pop(),r.pop();const e=r[r.length-1],s=this.startNode(e,e.lineStart);h.push(this.finalize(s,new n.BinaryExpression(t,a,o)))}h.push(this.nextToken().value),c.push(i),r.push(this.lookahead),h.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}let l=h.length-1;e=h[l];let p=r.pop();for(;l>1;){const t=r.pop(),s=p&&p.lineStart,i=this.startNode(t,s),a=h[l-1];e=this.finalize(i,new n.BinaryExpression(a,h[l-2],e)),l-=2,p=t}}return e},c.parseConditionalExpression=function(){const t=this.lookahead;let e=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();const s=this.context.allowIn;this.context.allowIn=!0;const i=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=s,this.expect(":");const r=this.isolateCoverGrammar(this.parseAssignmentExpression);e=this.finalize(this.startNode(t),new n.ConditionalExpression(e,i,r)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return e},c.checkPatternParam=function(t,e){switch(e.type){case a.Syntax.Identifier:this.validateParam(t,e,e.name);break;case a.Syntax.AssignmentPattern:this.checkPatternParam(t,e.left);break;case a.Syntax.ArrayPattern:for(let s=0;s<e.elements.length;s++)null!==e.elements[s]&&this.checkPatternParam(t,e.elements[s]);break;case a.Syntax.ObjectPattern:for(let s=0;s<e.properties.length;s++){const i=e.properties[s];this.checkPatternParam(t,i.value)}}t.simple=t.simple&&e instanceof n.Identifier},c.reinterpretAsCoverFormalsList=function(t){const e=[t],s={simple:!0,paramSet:{}};switch(t.type){case a.Syntax.Identifier:break;default:return null}for(let i=0;i<e.length;++i){const t=e[i];this.checkPatternParam(s,t),e[i]=t}if(s.message===i.Messages.StrictParamDupe){const t=this.context.strict?s.stricted:s.firstRestricted;this.throwUnexpectedToken(t,s.message)}return{simple:s.simple,params:e,stricted:s.stricted,firstRestricted:s.firstRestricted,message:s.message}},c.parseAssignmentExpression=function(){let t;const e=this.lookahead;let s=e;if(t=this.parseConditionalExpression(),this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(i.Messages.InvalidLHSInAssignment),this.context.strict&&t.type===a.Syntax.Identifier){const e=t;this.scanner.isRestrictedWord(e.name)&&this.tolerateUnexpectedToken(s,i.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(e.name)&&this.tolerateUnexpectedToken(s,i.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(t):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1),s=this.nextToken();const r=s.value,o=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new n.AssignmentExpression(r,t,o)),this.context.firstCoverInitializedNameError=null}return t},c.parseExpression=function(){const t=this.lookahead;let e=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){const s=[];for(s.push(e);2!==this.lookahead.type&&this.match(",");)this.nextToken(),s.push(this.isolateCoverGrammar(this.parseAssignmentExpression));e=this.finalize(this.startNode(t),new n.SequenceExpression(s))}return e},c.parseStatementListItem=function(){let t;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"function":t=this.parseFunctionDeclaration();break;default:t=this.parseStatement()}else t=this.parseStatement();return t},c.parseBlock=function(){const t=this.createNode();this.expect("{");const e=[];for(;!this.match("}");)e.push(this.parseStatementListItem());return this.expect("}"),this.finalize(t,new n.BlockStatement(e))},c.parseBlockOrObjectInitialiser=function(){const t=this.createNode();if(this.expect("{"),3===this.lookahead.type||8===this.lookahead.type){const e=this.scanner.saveState();this.scanner.scanComments();const s=this.scanner.lex();if(this.scanner.restoreState(e),7===s.type&&":"===s.value){const e=[],s={value:!1};for(;!this.match("}");)e.push(this.parseObjectProperty(s)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(t,new n.ObjectExpression(e))}}const e=[];for(;!this.match("}");)e.push(this.parseStatementListItem());return this.expect("}"),this.finalize(t,new n.BlockStatement(e))},c.parseLexicalBinding=function(t,e){const s=this.createNode(),r=[],o=this.parsePattern(r,t);this.context.strict&&o.type===a.Syntax.Identifier&&this.scanner.isRestrictedWord(o.name)&&this.tolerateError(i.Messages.StrictVarName);let h=null;return(!e.inFor&&o.type!==a.Syntax.Identifier||this.match("="))&&(this.expect("="),h=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(s,new n.VariableDeclarator(o,h))},c.parseBindingList=function(t,e){const s=[this.parseLexicalBinding(t,e)];for(;this.match(",");)this.nextToken(),s.push(this.parseLexicalBinding(t,e));return s},c.parseArrayPattern=function(t,e){const s=this.createNode();this.expect("[");const i=[];for(;!this.match("]");)this.match(",")?(this.nextToken(),i.push(null)):(i.push(this.parsePatternWithDefault(t,e)),this.match("]")||this.expect(","));return this.expect("]"),this.finalize(s,new n.ArrayPattern(i))},c.parsePropertyPattern=function(t,e){const s=this.createNode();let i=!1,r=!1;const a=!1;let o,h;if(3===this.lookahead.type){const i=this.lookahead;o=this.parseVariableIdentifier();const a=this.finalize(s,new n.Identifier(i.value));if(this.match("=")){t.push(i),r=!0,this.nextToken();const e=this.parseAssignmentExpression();h=this.finalize(this.startNode(i),new n.AssignmentPattern(a,e))}else this.match(":")?(this.expect(":"),h=this.parsePatternWithDefault(t,e)):(t.push(i),r=!0,h=a)}else i=this.match("["),o=this.parseObjectPropertyKey(),this.expect(":"),h=this.parsePatternWithDefault(t,e);return this.finalize(s,new n.Property("init",o,i,h,a,r))},c.parseObjectPattern=function(t,e){const s=this.createNode(),i=[];for(this.expect("{");!this.match("}");)i.push(this.parsePropertyPattern(t,e)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(s,new n.ObjectPattern(i))},c.parsePattern=function(t,e){let s;return this.match("[")?s=this.parseArrayPattern(t,e):this.match("{")?s=this.parseObjectPattern(t,e):(!this.matchKeyword("let")||"const"!==e&&"let"!==e||this.tolerateUnexpectedToken(this.lookahead,i.Messages.LetInLexicalBinding),t.push(this.lookahead),s=this.parseVariableIdentifier(e)),s},c.parsePatternWithDefault=function(t,e){const s=this.lookahead;let i=this.parsePattern(t,e);if(this.match("=")){this.nextToken();const t=this.isolateCoverGrammar(this.parseAssignmentExpression);i=this.finalize(this.startNode(s),new n.AssignmentPattern(i,t))}return i},c.parseVariableIdentifier=function(t){const e=this.createNode(),s=this.nextToken();return 3!==s.type&&(this.context.strict&&4===s.type&&this.scanner.isStrictModeReservedWord(s.value)?this.tolerateUnexpectedToken(s,i.Messages.StrictReservedWord):(this.context.strict||"let"!==s.value||"var"!==t)&&this.throwUnexpectedToken(s)),this.finalize(e,new n.Identifier(s.value))},c.parseVariableDeclaration=function(t){const e=this.createNode(),s=[],r=this.parsePattern(s,"var");this.context.strict&&r.type===a.Syntax.Identifier&&this.scanner.isRestrictedWord(r.name)&&this.tolerateError(i.Messages.StrictVarName);let o=null;return this.match("=")?(this.nextToken(),o=this.isolateCoverGrammar(this.parseAssignmentExpression)):r.type===a.Syntax.Identifier||t.inFor||this.expect("="),this.finalize(e,new n.VariableDeclarator(r,o))},c.parseVariableDeclarationList=function(t){const e={inFor:t.inFor},s=[];for(s.push(this.parseVariableDeclaration(e));this.match(",");)this.nextToken(),s.push(this.parseVariableDeclaration(e));return s},c.parseVariableStatement=function(){const t=this.createNode();this.expectKeyword("var");const e=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(t,new n.VariableDeclaration(e,"var"))},c.parseEmptyStatement=function(){const t=this.createNode();return this.expect(";"),this.finalize(t,new n.EmptyStatement)},c.parseExpressionStatement=function(){const t=this.createNode(),e=this.parseExpression();return this.consumeSemicolon(),this.finalize(t,new n.ExpressionStatement(e))},c.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(i.Messages.StrictFunction),this.parseStatement(!0)},c.parseIfStatement=function(){const t=this.createNode();let e,s=null;this.expectKeyword("if"),this.expect("(");const i=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new n.EmptyStatement)):(this.expect(")"),e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),s=this.parseIfClause())),this.finalize(t,new n.IfStatement(i,e,s))},c.parseForStatement=function(){let t,e,s=null,r=null,o=null;const h=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){s=this.createNode(),this.nextToken();const r=this.context.allowIn;this.context.allowIn=!1;const o=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=r,1===o.length&&this.matchKeyword("in")){const r=o[0];r.init&&(r.id.type===a.Syntax.ArrayPattern||r.id.type===a.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(i.Messages.ForInOfLoopInitializer,"for-in"),s=this.finalize(s,new n.VariableDeclaration(o,"var")),this.nextToken(),t=s,e=this.parseExpression(),s=null}else 1===o.length&&null===o[0].init&&this.matchContextualKeyword("of")?(s=this.finalize(s,new n.VariableDeclaration(o,"var")),this.nextToken(),t=s,e=this.parseAssignmentExpression(),s=null):(s=this.finalize(s,new n.VariableDeclaration(o,"var")),this.expect(";"))}else{const r=this.lookahead,o=this.context.isBindingElement,h=this.context.isAssignmentTarget,c=this.context.firstCoverInitializedNameError,l=this.context.allowIn;if(this.context.allowIn=!1,s=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=l,this.matchKeyword("in"))this.context.isAssignmentTarget&&s.type!==a.Syntax.AssignmentExpression||this.tolerateError(i.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(s),t=s,e=this.parseExpression(),s=null;else{if(this.context.isBindingElement=o,this.context.isAssignmentTarget=h,this.context.firstCoverInitializedNameError=c,this.match(",")){const t=[s];for(;this.match(",");)this.nextToken(),t.push(this.isolateCoverGrammar(this.parseAssignmentExpression));s=this.finalize(this.startNode(r),new n.SequenceExpression(t))}this.expect(";")}}let c;if(void 0===t&&(this.match(";")||(r=this.isolateCoverGrammar(this.parseExpression)),this.expect(";"),this.match(")")||(o=this.isolateCoverGrammar(this.parseExpression))),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),c=this.finalize(this.createNode(),new n.EmptyStatement);else{this.expect(")");const t=this.context.inIteration;this.context.inIteration=!0,c=this.isolateCoverGrammar(this.parseStatementBlockAllowed),this.context.inIteration=t}return void 0===t?this.finalize(h,new n.ForStatement(s,r,o,c)):this.finalize(h,new n.ForInStatement(t,e,c))},c.parseContinueStatement=function(){const t=this.createNode();this.expectKeyword("continue");let e=null;if(3===this.lookahead.type&&!this.hasLineTerminator){const t=this.parseVariableIdentifier();e=t;const s="$"+t.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,s)||this.throwError(i.Messages.UnknownLabel,t.name)}return this.consumeSemicolon(),null!==e||this.context.inIteration||this.throwError(i.Messages.IllegalContinue),this.finalize(t,new n.ContinueStatement(e))},c.parseBreakStatement=function(){const t=this.createNode();this.expectKeyword("break");let e=null;if(3===this.lookahead.type&&!this.hasLineTerminator){const t=this.parseVariableIdentifier(),s="$"+t.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,s)||this.throwError(i.Messages.UnknownLabel,t.name),e=t}return this.consumeSemicolon(),null!==e||this.context.inIteration||this.context.inSwitch||this.throwError(i.Messages.IllegalBreak),this.finalize(t,new n.BreakStatement(e))},c.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(i.Messages.IllegalReturn);const t=this.createNode();this.expectKeyword("return");const e=!this.match(";")&&!this.match("}")&&!this.hasLineTerminator&&2!==this.lookahead.type||8===this.lookahead.type||10===this.lookahead.type?this.parseExpression():null;return this.consumeSemicolon(),this.finalize(t,new n.ReturnStatement(e))},c.parseLabelledStatement=function(){const t=this.createNode(),e=this.parseExpression();let s;return this.consumeSemicolon(),s=new n.ExpressionStatement(e),this.finalize(t,s)},c.parseStatementBlockAllowed=function(){return this.parseStatement(!0)},c.parseStatement=function(t=!1){let e;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:e=this.parseExpressionStatement();break;case 7:{const s=this.lookahead.value;e="{"===s?t?this.parseBlockOrObjectInitialiser():this.parseObjectInitializer():"("===s?this.parseExpressionStatement():";"===s?this.parseEmptyStatement():this.parseExpressionStatement();break}case 3:e=this.parseLabelledStatement();break;case 4:switch(this.lookahead.value.toLowerCase()){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"var":e=this.parseVariableStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},c.parseFunctionSourceElements=function(){const t=this.createNode();this.expect("{");const e=[],s=this.context.labelSet,i=this.context.inIteration,r=this.context.inSwitch,a=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)e.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=s,this.context.inIteration=i,this.context.inSwitch=r,this.context.inFunctionBody=a,this.finalize(t,new n.BlockStatement(e))},c.validateParam=function(t,e,s){const n="$"+s;this.context.strict?(this.scanner.isRestrictedWord(s)&&(t.stricted=e,t.message=i.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(t.paramSet,n)&&(t.stricted=e,t.message=i.Messages.StrictParamDupe)):t.firstRestricted||(this.scanner.isRestrictedWord(s)?(t.firstRestricted=e,t.message=i.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(s)?(t.firstRestricted=e,t.message=i.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(t.paramSet,n)&&(t.stricted=e,t.message=i.Messages.StrictParamDupe)),"function"==typeof Object.defineProperty?Object.defineProperty(t.paramSet,n,{value:!0,enumerable:!0,writable:!0,configurable:!0}):t.paramSet[n]=!0},c.parseFormalParameter=function(t){const e=[],s=this.parsePatternWithDefault(e);for(let i=0;i<e.length;i++)this.validateParam(t,e[i],e[i].value);t.simple=t.simple&&s instanceof n.Identifier,t.params.push(s)},c.parseFormalParameters=function(t){const e={simple:!0,params:[],firstRestricted:t};if(this.expect("("),!this.match(")"))for(e.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(e),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:e.simple,params:e.params,stricted:e.stricted,firstRestricted:e.firstRestricted,message:e.message}},c.parseFunctionDeclaration=function(t){const e=this.createNode();let s;this.expectKeyword("function");let r=null,a=null;if(!t||!this.match("(")){const t=this.lookahead;r=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(t.value)&&this.tolerateUnexpectedToken(t,i.Messages.StrictFunctionName):this.scanner.isRestrictedWord(t.value)?(a=t,s=i.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(t.value)&&(a=t,s=i.Messages.StrictReservedWord)}const o=this.parseFormalParameters(a),h=o.params,c=o.stricted;a=o.firstRestricted,o.message&&(s=o.message);const l=this.context.strict,p=this.context.allowStrictDirective;this.context.allowStrictDirective=o.simple;const m=this.parseFunctionSourceElements();return this.context.strict&&a&&this.throwUnexpectedToken(a,s),this.context.strict&&c&&this.tolerateUnexpectedToken(c,s),this.context.strict=l,this.context.allowStrictDirective=p,this.finalize(e,new n.FunctionDeclaration(r,h,m,!1))},c.parseFunctionExpression=function(){const t=this.createNode();let e;this.expectKeyword("function");let s,r=null;if(!this.match("(")){const t=this.lookahead;r=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(t.value)&&this.tolerateUnexpectedToken(t,i.Messages.StrictFunctionName):this.scanner.isRestrictedWord(t.value)?(s=t,e=i.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(t.value)&&(s=t,e=i.Messages.StrictReservedWord)}const a=this.parseFormalParameters(s),o=a.params,h=a.stricted;s=a.firstRestricted,a.message&&(e=a.message);const c=this.context.strict,l=this.context.allowStrictDirective;this.context.allowStrictDirective=a.simple;const p=this.parseFunctionSourceElements();return this.context.strict&&s&&this.throwUnexpectedToken(s,e),this.context.strict&&h&&this.tolerateUnexpectedToken(h,e),this.context.strict=c,this.context.allowStrictDirective=l,this.finalize(t,new n.FunctionExpression(r,o,p,!1))},c.qualifiedPropertyName=function(t){switch(t.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===t.value}return!1},c.isStartOfExpression=function(){let t=!0;const e=this.lookahead.value;switch(this.lookahead.type){case 7:t="["===e||"("===e||"{"===e||"+"===e||"-"===e||"!"===e||"~"===e||"++"===e||"--"===e||"/"===e||"/="===e;break;case 4:t="class"===e||"delete"===e||"function"===e||"let"===e||"new"===e||"super"===e||"this"===e||"typeof"===e||"void"===e||"yield"===e}return t},c.parseScript=function(){const t=this.createNode(),e=[];for(;2!==this.lookahead.type;)e.push(this.parseStatementListItem());return this.finalize(t,new n.Script(e))},t}();t.Parser=c,Object.defineProperty(t,"__esModule",{value:!0})}));
