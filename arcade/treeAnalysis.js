// COPYRIGHT Â© 2022 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.42/esri/copyright.txt for details.

define(["require","exports","./polyfill/tsSupport/awaiter","./polyfill/tsSupport/generator"],(function(e,n,a,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.scriptUsesFeatureSet=n.findScriptDependencies=n.findFunctionCalls=n.extractFunctionDeclaration=n.findExpectedFieldLiterals=n.findFieldLiterals=n.referencesFunction=n.findModuleImports=n.referencesMember=n.walk=n.addFunctionDeclaration=n.fullArcadeApiAsync=n.fullArcadeApiSync=void 0;var i={all:{min:2,max:2},none:{min:2,max:2},any:{min:2,max:2},reduce:{min:2,max:3},map:{min:2,max:2},filter:{min:2,max:2},fromcodepoint:{min:1,max:-1},fromcharcode:{min:1,max:-1},tocodepoint:{min:1,max:2},tocharcode:{min:1,max:2},concatenate:{min:0,max:-1},expects:{min:1,max:-1},getfeatureset:{min:1,max:2},week:{min:1,max:2},fromjson:{min:1,max:1},length3d:{min:1,max:2},tohex:{min:1,max:1},hash:{min:1,max:1},isoweek:{min:1,max:1},isoweekday:{min:1,max:1},hasvalue:{min:2,max:2},isomonth:{min:1,max:1},isoyear:{min:1,max:1},resize:{min:2,max:3},slice:{min:0,max:-1},splice:{min:0,max:-1},push:{min:2,max:2},pop:{min:1,max:1},includes:{min:2,max:2},array:{min:1,max:2},front:{min:1,max:1},back:{min:1,max:1},insert:{min:3,max:3},erase:{min:2,max:2},split:{min:2,max:4},guid:{min:0,max:1},standardizeguid:{min:2,max:2},today:{min:0,max:0},angle:{min:2,max:3},bearing:{min:2,max:3},urlencode:{min:1,max:1},now:{min:0,max:0},timestamp:{min:0,max:0},day:{min:1,max:1},month:{min:1,max:1},year:{min:1,max:1},hour:{min:1,max:1},second:{min:1,max:1},millisecond:{min:1,max:1},minute:{min:1,max:1},weekday:{min:1,max:1},toutc:{min:1,max:1},tolocal:{min:1,max:1},date:{min:0,max:7},datediff:{min:2,max:3},dateadd:{min:2,max:3},trim:{min:1,max:1},text:{min:1,max:2},left:{min:2,max:2},right:{min:2,max:2},mid:{min:2,max:3},upper:{min:1,max:1},proper:{min:1,max:2},lower:{min:1,max:1},find:{min:2,max:3},iif:{min:3,max:3},decode:{min:2,max:-1},when:{min:2,max:-1},defaultvalue:{min:2,max:2},isempty:{min:1,max:1},domaincode:{min:2,max:4},domainname:{min:2,max:4},polygon:{min:1,max:1},point:{min:1,max:1},polyline:{min:1,max:1},extent:{min:1,max:1},multipoint:{min:1,max:1},ringisclockwise:{min:1,max:1},geometry:{min:1,max:1},count:{min:0,max:-1},number:{min:1,max:2},acos:{min:1,max:1},asin:{min:1,max:1},atan:{min:1,max:1},atan2:{min:2,max:2},ceil:{min:1,max:2},floor:{min:1,max:2},round:{min:1,max:2},cos:{min:1,max:1},exp:{min:1,max:1},log:{min:1,max:1},min:{min:0,max:-1},constrain:{min:3,max:3},console:{min:0,max:-1},max:{min:0,max:-1},pow:{min:2,max:2},random:{min:0,max:0},sqrt:{min:1,max:1},sin:{min:1,max:1},tan:{min:1,max:1},abs:{min:1,max:1},isnan:{min:1,max:1},stdev:{min:0,max:-1},average:{min:0,max:-1},mean:{min:0,max:-1},sum:{min:0,max:-1},variance:{min:0,max:-1},distinct:{min:0,max:-1},first:{min:1,max:1},top:{min:2,max:2},boolean:{min:1,max:1},dictionary:{min:0,max:-1},typeof:{min:1,max:1},reverse:{min:1,max:1},replace:{min:3,max:4},sort:{min:1,max:2},feature:{min:1,max:-1},haskey:{min:2,max:2},indexof:{min:2,max:2},disjoint:{min:2,max:2},intersects:{min:2,max:2},touches:{min:2,max:2},crosses:{min:2,max:2},within:{min:2,max:2},contains:{min:2,max:2},overlaps:{min:2,max:2},equals:{min:2,max:2},relate:{min:3,max:3},intersection:{min:2,max:2},union:{min:1,max:2},difference:{min:2,max:2},symmetricdifference:{min:2,max:2},clip:{min:2,max:2},cut:{min:2,max:2},area:{min:1,max:2},areageodetic:{min:1,max:2},length:{min:1,max:2},lengthgeodetic:{min:1,max:2},distancegeodetic:{min:2,max:3},distance:{min:2,max:3},densify:{min:2,max:3},densifygeodetic:{min:2,max:3},generalize:{min:2,max:4},buffer:{min:2,max:3},buffergeodetic:{min:2,max:3},offset:{min:2,max:6},rotate:{min:2,max:3},issimple:{min:1,max:1},simplify:{min:1,max:1},convexhull:{min:1,max:1},centroid:{min:1,max:1},isselfintersecting:{min:1,max:1},multiparttosinglepart:{min:1,max:1},setgeometry:{min:2,max:2},portal:{min:1,max:1},getuser:{min:0,max:2},subtypes:{min:1,max:1},subtypecode:{min:1,max:1},subtypename:{min:1,max:1},domain:{min:2,max:3},convertdirection:{min:3,max:3},schema:{min:1,max:1}};n.fullArcadeApiSync={functionDefinitions:new Map,constantDefinitions:new Map},n.fullArcadeApiAsync={functionDefinitions:new Map,constantDefinitions:new Map};for(var m=0,r=["pi","infinity"];m<r.length;m++){var o=r[m];n.fullArcadeApiAsync.constantDefinitions.set(o,{type:"constant"}),n.fullArcadeApiSync.constantDefinitions.set(o,{type:"constant"})}for(var s in n.fullArcadeApiAsync.constantDefinitions.set("textformatting",{type:"namespace",key:"textformatting",members:[{key:"backwardslash",type:"constant"},{key:"doublequote",type:"constant"},{key:"forwardslash",type:"constant"},{key:"tab",type:"constant"},{key:"singlequote",type:"constant"},{key:"newline",type:"constant"}]}),n.fullArcadeApiSync.constantDefinitions.set("textformatting",{type:"namespace",key:"textformatting",members:[{key:"backwardslash",type:"constant"},{key:"tab",type:"constant"},{key:"singlequote",type:"constant"},{key:"doublequote",type:"constant"},{key:"forwardslash",type:"constant"},{key:"newline",type:"constant"}]}),i){var c=i[s];n.fullArcadeApiAsync.functionDefinitions.set(s,{overloads:[{type:"function",parametersInfo:{min:c.min,max:c.max}}]}),n.fullArcadeApiSync.functionDefinitions.set(s,{overloads:[{type:"function",parametersInfo:{min:c.min,max:c.max}}]})}var l=["featureset","getuser","featuresetbyid","featuresetbyname","featuresetbyassociation","featuresetbyrelationshipname","featuresetbyurl","getfeatureset","attachments","featuresetbyportalitem"],u=["disjoint","intersects","touches","crosses","within","contains","overlaps","equals","relate","intersection","union","difference","symmetricdifference","clip","cut","area","areageodetic","length","length3d","lengthgeodetic","distance","distancegeodetic","densify","densifygeodetic","generalize","buffer","buffergeodetic","offset","rotate","issimple","convexhull","simplify","multiparttosinglepart"];function p(e){return"string"==typeof e||e instanceof String}function x(e,n){if(e)for(var a=0,t=e;a<t.length;a++){f(t[a],n)}}function f(e,n){if(e&&!1!==n(e))switch(e.type){case"ImportDeclaration":x(e.specifiers,n),f(e.source,n);break;case"ExportNamedDeclaration":f(e.declaration,n);break;case"ArrayExpression":x(e.elements,n);break;case"AssignmentExpression":case"BinaryExpression":f(e.left,n),f(e.right,n);break;case"BlockStatement":case"Program":x(e.body,n);break;case"BreakStatement":break;case"CallExpression":f(e.callee,n),x(e.arguments,n);break;case"ContinueStatement":case"EmptyStatement":break;case"ExpressionStatement":f(e.expression,n);break;case"ForInStatement":f(e.left,n),f(e.right,n),f(e.body,n);break;case"ForStatement":f(e.init,n),f(e.test,n),f(e.update,n),f(e.body,n);break;case"WhileStatement":f(e.test,n),f(e.body,n);break;case"FunctionDeclaration":f(e.id,n),x(e.params,n),f(e.body,n);break;case"Identifier":break;case"IfStatement":f(e.test,n),f(e.consequent,n),f(e.alternate,n);break;case"Literal":break;case"LogicalExpression":f(e.left,n),f(e.right,n);break;case"MemberExpression":f(e.object,n),f(e.property,n);break;case"ObjectExpression":x(e.properties,n);break;case"Property":f(e.key,n),f(e.value,n);break;case"ReturnStatement":case"UnaryExpression":case"UpdateExpression":f(e.argument,n);break;case"VariableDeclaration":x(e.declarations,n);break;case"VariableDeclarator":f(e.id,n),f(e.init,n);break;case"TemplateLiteral":x(e.expressions,n),x(e.quasis,n)}}function d(e,n){var a=!1,t=n.toLowerCase();return f(e,(function(e){return!a&&("Identifier"===e.type&&e.name&&e.name.toLowerCase()===t&&(a=!0),!0)})),a}function y(e){var n=[];return f(e,(function(e){return"ImportDeclaration"===e.type&&e.source&&e.source.value&&n.push({libname:e.specifiers[0].local.name.toLowerCase(),source:e.source.value}),!0})),n}function g(e){var n=[];return f(e,(function(e){return"CallExpression"===e.type&&"Identifier"===e.callee.type&&n.push(e.callee.name.toLowerCase()),!0})),n}n.addFunctionDeclaration=function(e,a){var t,i="sync"===a?n.fullArcadeApiSync:n.fullArcadeApiAsync;i.functionDefinitions.has(e.name.toLowerCase())?null===(t=i.functionDefinitions.get(e.name.toLowerCase()))||void 0===t||t.overloads.push({type:"function",parametersInfo:{min:e.min,max:e.max}}):i.functionDefinitions.set(e.name.toLowerCase(),{overloads:[{type:"function",parametersInfo:{min:e.min,max:e.max}}]})},n.walk=f,n.referencesMember=d,n.findModuleImports=y,n.referencesFunction=function(e,n){var a=!1,t=n.toLowerCase();return f(e,(function(e){return!a&&("CallExpression"!==e.type||"Identifier"!==e.callee.type||!e.callee.name||e.callee.name.toLowerCase()!==t||(a=!0,!1))})),a},n.findFieldLiterals=function(e){var n=[];return f(e,(function(e){var a;return"MemberExpression"!==e.type||"Identifier"!==e.object.type||(!1===e.computed&&e.object&&e.object.name&&e.property&&"Identifier"===e.property.type&&e.property.name?n.push(e.object.name.toLowerCase()+"."+e.property.name.toLowerCase()):e.object&&e.object.name&&e.property&&"Literal"===e.property.type&&"string"==typeof e.property.value&&n.push(e.object.name.toLowerCase()+"."+(null===(a=e.property.value)||void 0===a?void 0:a.toString().toLowerCase())),!1)})),n},n.findExpectedFieldLiterals=function(e){var n=[];return f(e,(function(e){var a;if("CallExpression"===e.type){if("Identifier"===e.callee.type&&"expects"===e.callee.name.toLowerCase()){for(var t="",i=0;i<(e.arguments||[]).length;i++)0===i?"Identifier"===e.arguments[i].type&&(t=e.arguments[i].name.toLowerCase()):t&&"Literal"===e.arguments[i].type&&p(e.arguments[i].value)&&n.push(t+"."+e.arguments[i].value.toLowerCase());return!1}if("Identifier"===e.callee.type&&["domainname","domaincode","domain","haskey"].includes(e.callee.name.toLowerCase())&&e.arguments.length>=2){t="";return"Identifier"===e.arguments[0].type&&(t=e.arguments[0].name.toLowerCase()),t&&"Literal"===e.arguments[1].type&&p(e.arguments[1].value)&&n.push(t+"."+e.arguments[1].value.toLowerCase()),!1}}return"MemberExpression"!==e.type||"Identifier"!==e.object.type||(!1===e.computed&&e.object&&e.object.name&&e.property&&"Identifier"===e.property.type&&e.property.name?n.push(e.object.name.toLowerCase()+"."+e.property.name.toLowerCase()):e.object&&e.object.name&&e.property&&"Literal"===e.property.type&&"string"==typeof e.property.value&&n.push(e.object.name.toLowerCase()+"."+(null===(a=e.property.value)||void 0===a?void 0:a.toString().toLowerCase())),!1)})),n},n.extractFunctionDeclaration=function(e,n){var a=[];if(void 0!==n.params&&null!==n.params)for(var t=0;t<n.params.length;t++)a.push("any");return{name:e,return:"any",params:a}},n.findFunctionCalls=g,n.findScriptDependencies=function(e,n){void 0===n&&(n=[]);var a=null;if(void 0===e.usesFeatureSet){null===a&&(a=g(e)),e.usesFeatureSet=!1;for(var t=0;t<a.length;t++)l.includes(a[t])&&(e.usesFeatureSet=!0,e.isAsync=!0);if(!1===e.usesFeatureSet&&n&&n.length>0)for(var i=0,m=n;i<m.length;i++){if(d(e,m[i])){e.usesFeatureSet=!0,e.isAsync=!0;break}}}if(void 0===e.usesModules&&(e.usesModules=!1,y(e).length>0&&(e.usesModules=!0)),void 0===e.usesGeometry){e.usesGeometry=!1,null===a&&(a=g(e));for(t=0;t<a.length;t++)u.includes(a[t])&&(e.usesGeometry=!0)}},n.scriptUsesFeatureSet=function(e){for(var n=g(e),a=0;a<n.length;a++)if(l.includes(n[a]))return!0;return!1}}));